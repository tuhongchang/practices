cscope 15 $HOME/class/teacher/practice/7-dictionary/simple -q 0000010486 0002922273
	@client.c

1 
	~"comm.h
"

2 
	~<¡ddef.h
>

4 
	#BUFF_SIZE
 1024

	)

6 
ÃtwÜk_š™
();

7 
»cv_mesg
(
sockfd
, *
buff
, 
size
);

8 
£nd_mesg
(
sockfd
, *
buff
, 
size
);

10 
	$maš
()

12 
sockfd
;

13 
buff
[
BUFF_SIZE
];

14 
qmesg_t
 
msgbuf
;

16 
sockfd
 = 
	`ÃtwÜk_š™
();

19 
	`fg‘s
(
buff
, 
BUFF_SIZE
, 
¡dš
);

20 
buff
[
	`¡¾’
(buff)-1] = '\0';

22 ià(!
	`¡rcmp
(
buff
, "#"))

25 
msgbuf
.
æag
 = 
QMESG_FLAG_REQ
;

26 
	`¡ºýy
(
msgbuf
.
wÜd
, 
buff
, 
QMESG_WORD_LEN
);

27 ià(-1 =ð
	`£nd_mesg
(
sockfd
, &
msgbuf
, 
	`off£tof
(
qmesg_t
, 
ex¶ª
)))

30 ià(-1 =ð
	`»cv_mesg
(
sockfd
, &
msgbuf
, (msgbuf)))

32 ià(
msgbuf
.
æag
 =ð
QMESG_FLAG_ACK
)

33 
	`´štf
("% --- %s\n", 
msgbuf
.
wÜd
, msgbuf.
ex¶ª
);

35 
	`´štf
("% *** NO FOUND !!\n", 
msgbuf
.
wÜd
);

38 
	`þo£
(
sockfd
);

41 
	}
}

43 
	$ÃtwÜk_š™
()

45  
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

46 
	}
}

48 
	$»cv_mesg
(
sockfd
, *
buff
, 
size
)

50  
	`»cväom
(
sockfd
, 
buff
, 
size
, 0, 
NULL
, NULL);

51 
	}
}

53 
	$£nd_mesg
(
sockfd
, *
buff
, 
size
)

55 
sockaddr_š
 
£¿ddr
;

57 
£¿ddr
.
sš_çmžy
 = 
AF_INET
;

58 
£¿ddr
.
sš_pÜt
 = 
	`htÚs
(
SER_PORT
);

59 
£¿ddr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(
SER_ADDR
);

61  
	`£ndto
(
sockfd
, 
buff
, 
size
, 0, (
sockaddr
 *)&
£¿ddr
, (seraddr));

62 
	}
}

	@comm.h

1 #iâdeà
__HEAD_H__


2 
	#__HEAD_H__


	)

4 
	~<sys/ty³s.h
>

5 
	~<sys/sock‘.h
>

6 
	~<¬·/š‘.h
>

7 
	~<”ºo.h
>

8 
	~<uni¡d.h
>

9 
	~<¡dlib.h
>

10 
	~<¡dio.h
>

11 
	~<¡ršg.h
>

13 
	#SER_PORT
 10000

	)

14 
	#SER_ADDR
 "192.168.3.10"

	)

17 
	#DB_TABLE_NAME
 "wÜd"

	)

18 
	#QMESG_WORD_LEN
 30

	)

19 
	#QMESG_EXPLAN_LEN
 300

	)

21 
	#QMESG_FLAG_REQ
 'R'

	)

22 
	#QMESG_FLAG_ACK
 'A'

	)

23 
	#QMESG_FLAG_ERR
 'E'

	)

24 
	squ”y_´ÙocÞ
 {

25 
	mæag
;

26 
	mwÜd
[
QMESG_WORD_LEN
];

27 
	mex¶ª
[
QMESG_EXPLAN_LEN
];

28 }
	tqmesg_t
;

	@loaddatabase.c

1 
	~<¡dio.h
>

2 
	~<”rÜ.h
>

3 
	~<”ºo.h
>

4 
	~<¡dlib.h
>

5 
	~<¡ršg.h
>

6 
	~"sql™e3.h
"

8 
	#”rÜ_ex™
(
_”rmsg_
è
	`”rÜ
(
EXIT_FAILURE
, 
”ºo
, _”rmsg_)

	)

9 
	#BUFF_SIZE
 1024

	)

11 
	swÜd
 {

12 
	mÇme
[32];

13 
	mex¶ª
[300];

16 
·r£_wÜd
(*
buff
, 
wÜd
 *
wÜdbuf
);

18 
	$maš
(
¬gc
, cÚ¡ **
¬gv
)

20 cÚ¡ *
¤úame
 = 
¬gv
[1];

21 cÚ¡ *
dbÇme
 = 
¬gv
[2];

22 
FILE
 *
å
;

23 
sql™e3
 *
db
;

24 
buff
[
BUFF_SIZE
];

25 *
p
;

26 
wÜd
 
wÜdbuf
;

27 *
”rmsg
;

28 
n
 = 0;

29 
tsize
;

30 
csize
;

32 ià(
¬gc
 != 3) {

33 
	`puts
("USAGE:");

34 
	`puts
("./loaddatabase srcfile databasefile");

38 ià(
NULL
 =ð(
å
 = 
	`fÝ’
(
¤úame
, "r")))

39 
	`”rÜ_ex™
("fopen");

42 ià(
SQLITE_OK
 !ð
	`sql™e3_Ý’
(
dbÇme
, &
db
)) {

43 
	`årštf
(
¡d”r
, "sql™e3_Ý’: %s\n", 
	`sql™e3_”rmsg
(
db
));

44 
	`ex™
(
EXIT_FAILURE
);

48 ià(
SQLITE_OK
 !ð
	`sql™e3_exec
(
db
, "CREATE TABLE word (word char,ƒxplan char)",

49 
NULL
, NULL, &
”rmsg
)) {

50 
	`årštf
(
¡d”r
, "sql™e3_exec:%s\n", 
”rmsg
);

51 
	`sql™e3_ä“
(
”rmsg
);

52 
	`ex™
(
EXIT_FAILURE
);

55 
	`f£ek
(
å
, 0, 
SEEK_END
);

56 
tsize
 = 
	`á–l
(
å
);

57 
	`»wšd
(
å
);

59 
NULL
 !ð
	`fg‘s
(
buff
, 
BUFF_SIZE
, 
å
)) {

61 
	`·r£_wÜd
(
buff
, &
wÜdbuf
);

62 
	`¥rštf
(
buff
, "INSERT INTO wÜd VALUES (\"%s\", \"%s\")", 
wÜdbuf
.
Çme
, wÜdbuf.
ex¶ª
);

64 ià(
SQLITE_OK
 !ð
	`sql™e3_exec
(
db
, 
buff
, 
NULL
, NULL, &
”rmsg
)) {

65 
	`årštf
(
¡d”r
, "sql™e3_exec:%s\n", 
”rmsg
);

66 
	`sql™e3_ä“
(
”rmsg
);

69 
n
++;

71 
csize
 = 
	`á–l
(
å
);

72 
	`´štf
("%%%.2f\r", 
csize
 / ()
tsize
 * 100);

76 
	`´štf
("\r%d\n", 
n
);

78 
	`fþo£
(
å
);

79 
	`sql™e3_þo£
(
db
);

82 
	}
}

84 
	$·r£_wÜd
(*
buff
, 
wÜd
 *
wÜdbuf
)

86 *
p
 = 
buff
;

87 
i
 = 0;

89 *
p
 != ' ')

90 
wÜdbuf
->
Çme
[
i
++] = *
p
++;

91 
wÜdbuf
->
Çme
[
i
] = '\0';

93 *
p
 == ' ')

94 
p
++;

96 
i
 = 0;

97 *
p
 != '\r')

98 
wÜdbuf
->
ex¶ª
[
i
++] = *
p
++;

99 
wÜdbuf
->
ex¶ª
[
i
] = '\0';

100 
	}
}

	@server.c

1 
	~"comm.h
"

2 
	~"sql™e3.h
"

4 
ÃtwÜk_š™
();

5 
ÃtwÜk_de¡roy
(
sockfd
);

6 
»cv_mesg
(
sockfd
, *
buff
, 
size
);

7 
£nd_mesg
(
sockfd
, *
buff
, 
size
);

8 
sql™e3
 *
d©aba£_š™
(cÚ¡ *
Çme
);

9 
d©aba£_de¡roy
(
sql™e3
 *
db
);

10 
£¬ch_d©aba£
(
sql™e3
 *
db
, 
qmesg_t
 *
msgbuf
);

11 
£¬ch_ÿÎback
(*
¬g
, 
¬gc
, **
d©a
, **
cÞumn
);

13 
sockaddr_š
 
	g³”addr
;

15 
	$maš
(
¬gc
, cÚ¡ **
¬gv
)

17 
qmesg_t
 
msgbuf
;

19 
sql™e3
 *
db
;

20 
sockfd
;

22 ià(
¬gc
 != 2) {

23 
	`puts
("invalid‡rgument !");

27 
sockfd
 = 
	`ÃtwÜk_š™
();

28 
db
 = 
	`d©aba£_š™
(
¬gv
[1]);

31 ià(-1 =ð
	`»cv_mesg
(
sockfd
, &
msgbuf
, (msgbuf)))

34 
	`£¬ch_d©aba£
(
db
, &
msgbuf
);

36 ià(-1 =ð
	`£nd_mesg
(
sockfd
, &
msgbuf
, (msgbuf)))

40 
	`ÃtwÜk_de¡roy
(
sockfd
);

41 
	`d©aba£_de¡roy
(
db
);

44 
	}
}

46 
	$ÃtwÜk_š™
()

48 
sockaddr_š
 
£¿ddr
;

49 
sockfd
;

51 ià(-1 =ð(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)))

54 
£¿ddr
.
sš_çmžy
 = 
AF_INET
;

55 
£¿ddr
.
sš_pÜt
 = 
	`htÚs
(
SER_PORT
);

56 
£¿ddr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(
SER_ADDR
);

58 ià(-1 =ð
	`bšd
(
sockfd
, (
sockaddr
 *)&
£¿ddr
, (seraddr)))

61  
sockfd
;

62 
	}
}

64 
	$ÃtwÜk_de¡roy
(
sockfd
)

66 
	`þo£
(
sockfd
);

67 
	}
}

69 
	$»cv_mesg
(
sockfd
, *
buff
, 
size
)

71 
sockËn_t
 
add¾’
 = (
sockaddr_š
);

72  
	`»cväom
(
sockfd
, 
buff
, 
size
, 0, (
sockaddr
 *)&
³”addr
, &
add¾’
);

73 
	}
}

75 
	$£nd_mesg
(
sockfd
, *
buff
, 
size
)

77  
	`£ndto
(
sockfd
, 
buff
, 
size
, 0, (
sockaddr
 *)&
³”addr
, (peeraddr));

78 
	}
}

80 
sql™e3
 *
	$d©aba£_š™
(cÚ¡ *
dbÇme
)

82 
sql™e3
 *
db
;

84 ià(
SQLITE_OK
 !ð
	`sql™e3_Ý’
(
dbÇme
, &
db
)) {

85 
	`årštf
(
¡d”r
, "sql™e3_Ý’: %s\n", 
	`sql™e3_”rmsg
(
db
));

86 
	`ex™
(1);

89  
db
;

90 
	}
}

92 
	$d©aba£_de¡roy
(
sql™e3
 *
db
)

94 
	`sql™e3_þo£
(
db
);

95 
	}
}

97 
	$£¬ch_d©aba£
(
sql™e3
 *
db
, 
qmesg_t
 *
msgbuf
)

99 *
”rmsg
;

100 
sqlbuf
[1024];

102 
	`¥rštf
(
sqlbuf
, "SELECTƒxplan from %s where word = '%s'",

103 
DB_TABLE_NAME
, 
msgbuf
->
wÜd
);

104 
msgbuf
->
æag
 = 
QMESG_FLAG_ERR
;

106 ià(-1 =ð
	`sql™e3_exec
(
db
, 
sqlbuf
, 
£¬ch_ÿÎback
, 
msgbuf
, &
”rmsg
)) {

107 
	`årštf
(
¡d”r
, "sql™e3_exec: %s\n", 
”rmsg
);

108 
	`sql™e3_ä“
(
”rmsg
);

111 
	}
}

113 
	$£¬ch_ÿÎback
(*
¬g
, 
¬gc
, **
d©a
, **
cÞumn
)

115 
qmesg_t
 *
msgbuf
 = 
¬g
;

117 
	`¡rýy
(
msgbuf
->
ex¶ª
, 
d©a
[0]);

118 
msgbuf
->
æag
 = 
QMESG_FLAG_ACK
;

121 
	}
}

	@sqlite3.c

20 
	#SQLITE_CORE
 1

	)

21 
	#SQLITE_AMALGAMATION
 1

	)

22 #iâdeà
SQLITE_PRIVATE


23 
	#SQLITE_PRIVATE
 

	)

25 #iâdeà
SQLITE_API


26 
	#SQLITE_API


	)

43 #iâdeà
_SQLITEINT_H_


44 
	#_SQLITEINT_H_


	)

70 #iâdeà
SQLITE_DISABLE_LFS


71 
	#_LARGE_FILE
 1

	)

72 #iâdeà
_FILE_OFFSET_BITS


73 
	#_FILE_OFFSET_BITS
 64

	)

75 
	#_LARGEFILE_SOURCE
 1

	)

79 #ià
defšed
(
__GNUC__
è&& !defšed(
_GNU_SOURCE
)

80 
	#_GNU_SOURCE


	)

83 #ià
defšed
(
__O³nBSD__
è&& !defšed(
_BSD_SOURCE
)

84 
	#_BSD_SOURCE


	)

101 #ià
defšed
(
_HAVE_MINGW_H
)

102 
	~"mšgw.h
"

103 #–ià
defšed
(
_HAVE__MINGW_H
)

104 
	~"_mšgw.h
"

112 #ià!
defšed
(
_USE_32BIT_TIME_T
è&& !defšed(
_USE_64BIT_TIME_T
) && \

113 
defšed
(
_WIN32
è&& !defšed(
_WIN64
) && \

114 
defšed
(
__MINGW_MAJOR_VERSION
è&& 
	g__MINGW_MAJOR_VERSION
 >= 4 && \

115 
	$defšed
(
__MSVCRT__
)

116 
	#_USE_32BIT_TIME_T


	)

157 #iâdeà
_SQLITE3_H_


158 
	#_SQLITE3_H_


	)

159 
	~<¡d¬g.h
>

172 #iâdeà
SQLITE_EXTERN


173 
	#SQLITE_EXTERN
 

	)

176 #iâdeà
SQLITE_API


177 
	#SQLITE_API


	)

194 
	#SQLITE_DEPRECATED


	)

195 
	#SQLITE_EXPERIMENTAL


	)

200 #ifdeà
SQLITE_VERSION


201 #undeà
SQLITE_VERSION


203 #ifdeà
SQLITE_VERSION_NUMBER


204 #undeà
SQLITE_VERSION_NUMBER


234 
	#SQLITE_VERSION
 "3.8.7.4"

	)

235 
	#SQLITE_VERSION_NUMBER
 3008007

	)

236 
	#SQLITE_SOURCE_ID
 "2014-12-09 01:34:36 f66f7a17b78ba617acde90fc810107f34f1a1f2e"

	)

268 
SQLITE_API
 cÚ¡ 
sql™e3_v”siÚ
[] = 
SQLITE_VERSION
;

269 
SQLITE_API
 cÚ¡ *
	`sql™e3_libv”siÚ
();

270 
SQLITE_API
 cÚ¡ *
	`sql™e3_sourûid
();

271 
SQLITE_API
 
	`sql™e3_libv”siÚ_numb”
();

295 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


296 
SQLITE_API
 
	`sql™e3_compžeÝtiÚ_u£d
(cÚ¡ *
zO±Name
);

297 
SQLITE_API
 cÚ¡ *
	`sql™e3_compžeÝtiÚ_g‘
(
N
);

336 
SQLITE_API
 
	`sql™e3_th»ad§ã
();

352 
sql™e3
 
	tsql™e3
;

370 #ifdeà
SQLITE_INT64_TYPE


371 
SQLITE_INT64_TYPE
 
	tsql™e_št64
;

372 
	tSQLITE_INT64_TYPE
 
	tsql™e_ušt64
;

373 #–ià
	`defšed
(
_MSC_VER
è|| defšed(
__BORLANDC__
)

374 
__št64
 
	tsql™e_št64
;

375 
	t__št64
 
	tsql™e_ušt64
;

377 
	tsql™e_št64
;

378 
	tsql™e_ušt64
;

380 
sql™e_št64
 
	tsql™e3_št64
;

381 
sql™e_ušt64
 
	tsql™e3_ušt64
;

387 #ifdeà
SQLITE_OMIT_FLOATING_POINT


388 
sql™e3_št64


	)

432 
SQLITE_API
 
	`sql™e3_þo£
(
sql™e3
*);

433 
SQLITE_API
 
	`sql™e3_þo£_v2
(
sql™e3
*);

440 (*
	tsql™e3_ÿÎback
)(*,,**, **);

503 
SQLITE_API
 
	`sql™e3_exec
(

504 
sql™e3
*,

505 cÚ¡ *
sql
,

506 (*
ÿÎback
)(*,,**,**),

508 **
”rmsg


522 
	#SQLITE_OK
 0

	)

524 
	#SQLITE_ERROR
 1

	)

525 
	#SQLITE_INTERNAL
 2

	)

526 
	#SQLITE_PERM
 3

	)

527 
	#SQLITE_ABORT
 4

	)

528 
	#SQLITE_BUSY
 5

	)

529 
	#SQLITE_LOCKED
 6

	)

530 
	#SQLITE_NOMEM
 7

	)

531 
	#SQLITE_READONLY
 8

	)

532 
	#SQLITE_INTERRUPT
 9

	)

533 
	#SQLITE_IOERR
 10

	)

534 
	#SQLITE_CORRUPT
 11

	)

535 
	#SQLITE_NOTFOUND
 12

	)

536 
	#SQLITE_FULL
 13

	)

537 
	#SQLITE_CANTOPEN
 14

	)

538 
	#SQLITE_PROTOCOL
 15

	)

539 
	#SQLITE_EMPTY
 16

	)

540 
	#SQLITE_SCHEMA
 17

	)

541 
	#SQLITE_TOOBIG
 18

	)

542 
	#SQLITE_CONSTRAINT
 19

	)

543 
	#SQLITE_MISMATCH
 20

	)

544 
	#SQLITE_MISUSE
 21

	)

545 
	#SQLITE_NOLFS
 22

	)

546 
	#SQLITE_AUTH
 23

	)

547 
	#SQLITE_FORMAT
 24

	)

548 
	#SQLITE_RANGE
 25

	)

549 
	#SQLITE_NOTADB
 26

	)

550 
	#SQLITE_NOTICE
 27

	)

551 
	#SQLITE_WARNING
 28

	)

552 
	#SQLITE_ROW
 100

	)

553 
	#SQLITE_DONE
 101

	)

572 
	#SQLITE_IOERR_READ
 (
SQLITE_IOERR
 | (1<<8))

	)

573 
	#SQLITE_IOERR_SHORT_READ
 (
SQLITE_IOERR
 | (2<<8))

	)

574 
	#SQLITE_IOERR_WRITE
 (
SQLITE_IOERR
 | (3<<8))

	)

575 
	#SQLITE_IOERR_FSYNC
 (
SQLITE_IOERR
 | (4<<8))

	)

576 
	#SQLITE_IOERR_DIR_FSYNC
 (
SQLITE_IOERR
 | (5<<8))

	)

577 
	#SQLITE_IOERR_TRUNCATE
 (
SQLITE_IOERR
 | (6<<8))

	)

578 
	#SQLITE_IOERR_FSTAT
 (
SQLITE_IOERR
 | (7<<8))

	)

579 
	#SQLITE_IOERR_UNLOCK
 (
SQLITE_IOERR
 | (8<<8))

	)

580 
	#SQLITE_IOERR_RDLOCK
 (
SQLITE_IOERR
 | (9<<8))

	)

581 
	#SQLITE_IOERR_DELETE
 (
SQLITE_IOERR
 | (10<<8))

	)

582 
	#SQLITE_IOERR_BLOCKED
 (
SQLITE_IOERR
 | (11<<8))

	)

583 
	#SQLITE_IOERR_NOMEM
 (
SQLITE_IOERR
 | (12<<8))

	)

584 
	#SQLITE_IOERR_ACCESS
 (
SQLITE_IOERR
 | (13<<8))

	)

585 
	#SQLITE_IOERR_CHECKRESERVEDLOCK
 (
SQLITE_IOERR
 | (14<<8))

	)

586 
	#SQLITE_IOERR_LOCK
 (
SQLITE_IOERR
 | (15<<8))

	)

587 
	#SQLITE_IOERR_CLOSE
 (
SQLITE_IOERR
 | (16<<8))

	)

588 
	#SQLITE_IOERR_DIR_CLOSE
 (
SQLITE_IOERR
 | (17<<8))

	)

589 
	#SQLITE_IOERR_SHMOPEN
 (
SQLITE_IOERR
 | (18<<8))

	)

590 
	#SQLITE_IOERR_SHMSIZE
 (
SQLITE_IOERR
 | (19<<8))

	)

591 
	#SQLITE_IOERR_SHMLOCK
 (
SQLITE_IOERR
 | (20<<8))

	)

592 
	#SQLITE_IOERR_SHMMAP
 (
SQLITE_IOERR
 | (21<<8))

	)

593 
	#SQLITE_IOERR_SEEK
 (
SQLITE_IOERR
 | (22<<8))

	)

594 
	#SQLITE_IOERR_DELETE_NOENT
 (
SQLITE_IOERR
 | (23<<8))

	)

595 
	#SQLITE_IOERR_MMAP
 (
SQLITE_IOERR
 | (24<<8))

	)

596 
	#SQLITE_IOERR_GETTEMPPATH
 (
SQLITE_IOERR
 | (25<<8))

	)

597 
	#SQLITE_IOERR_CONVPATH
 (
SQLITE_IOERR
 | (26<<8))

	)

598 
	#SQLITE_LOCKED_SHAREDCACHE
 (
SQLITE_LOCKED
 | (1<<8))

	)

599 
	#SQLITE_BUSY_RECOVERY
 (
SQLITE_BUSY
 | (1<<8))

	)

600 
	#SQLITE_BUSY_SNAPSHOT
 (
SQLITE_BUSY
 | (2<<8))

	)

601 
	#SQLITE_CANTOPEN_NOTEMPDIR
 (
SQLITE_CANTOPEN
 | (1<<8))

	)

602 
	#SQLITE_CANTOPEN_ISDIR
 (
SQLITE_CANTOPEN
 | (2<<8))

	)

603 
	#SQLITE_CANTOPEN_FULLPATH
 (
SQLITE_CANTOPEN
 | (3<<8))

	)

604 
	#SQLITE_CANTOPEN_CONVPATH
 (
SQLITE_CANTOPEN
 | (4<<8))

	)

605 
	#SQLITE_CORRUPT_VTAB
 (
SQLITE_CORRUPT
 | (1<<8))

	)

606 
	#SQLITE_READONLY_RECOVERY
 (
SQLITE_READONLY
 | (1<<8))

	)

607 
	#SQLITE_READONLY_CANTLOCK
 (
SQLITE_READONLY
 | (2<<8))

	)

608 
	#SQLITE_READONLY_ROLLBACK
 (
SQLITE_READONLY
 | (3<<8))

	)

609 
	#SQLITE_READONLY_DBMOVED
 (
SQLITE_READONLY
 | (4<<8))

	)

610 
	#SQLITE_ABORT_ROLLBACK
 (
SQLITE_ABORT
 | (2<<8))

	)

611 
	#SQLITE_CONSTRAINT_CHECK
 (
SQLITE_CONSTRAINT
 | (1<<8))

	)

612 
	#SQLITE_CONSTRAINT_COMMITHOOK
 (
SQLITE_CONSTRAINT
 | (2<<8))

	)

613 
	#SQLITE_CONSTRAINT_FOREIGNKEY
 (
SQLITE_CONSTRAINT
 | (3<<8))

	)

614 
	#SQLITE_CONSTRAINT_FUNCTION
 (
SQLITE_CONSTRAINT
 | (4<<8))

	)

615 
	#SQLITE_CONSTRAINT_NOTNULL
 (
SQLITE_CONSTRAINT
 | (5<<8))

	)

616 
	#SQLITE_CONSTRAINT_PRIMARYKEY
 (
SQLITE_CONSTRAINT
 | (6<<8))

	)

617 
	#SQLITE_CONSTRAINT_TRIGGER
 (
SQLITE_CONSTRAINT
 | (7<<8))

	)

618 
	#SQLITE_CONSTRAINT_UNIQUE
 (
SQLITE_CONSTRAINT
 | (8<<8))

	)

619 
	#SQLITE_CONSTRAINT_VTAB
 (
SQLITE_CONSTRAINT
 | (9<<8))

	)

620 
	#SQLITE_CONSTRAINT_ROWID
 (
SQLITE_CONSTRAINT
 |(10<<8))

	)

621 
	#SQLITE_NOTICE_RECOVER_WAL
 (
SQLITE_NOTICE
 | (1<<8))

	)

622 
	#SQLITE_NOTICE_RECOVER_ROLLBACK
 (
SQLITE_NOTICE
 | (2<<8))

	)

623 
	#SQLITE_WARNING_AUTOINDEX
 (
SQLITE_WARNING
 | (1<<8))

	)

624 
	#SQLITE_AUTH_USER
 (
SQLITE_AUTH
 | (1<<8))

	)

633 
	#SQLITE_OPEN_READONLY
 0x00000001

	)

634 
	#SQLITE_OPEN_READWRITE
 0x00000002

	)

635 
	#SQLITE_OPEN_CREATE
 0x00000004

	)

636 
	#SQLITE_OPEN_DELETEONCLOSE
 0x00000008

	)

637 
	#SQLITE_OPEN_EXCLUSIVE
 0x00000010

	)

638 
	#SQLITE_OPEN_AUTOPROXY
 0x00000020

	)

639 
	#SQLITE_OPEN_URI
 0x00000040

	)

640 
	#SQLITE_OPEN_MEMORY
 0x00000080

	)

641 
	#SQLITE_OPEN_MAIN_DB
 0x00000100

	)

642 
	#SQLITE_OPEN_TEMP_DB
 0x00000200

	)

643 
	#SQLITE_OPEN_TRANSIENT_DB
 0x00000400

	)

644 
	#SQLITE_OPEN_MAIN_JOURNAL
 0x00000800

	)

645 
	#SQLITE_OPEN_TEMP_JOURNAL
 0x00001000

	)

646 
	#SQLITE_OPEN_SUBJOURNAL
 0x00002000

	)

647 
	#SQLITE_OPEN_MASTER_JOURNAL
 0x00004000

	)

648 
	#SQLITE_OPEN_NOMUTEX
 0x00008000

	)

649 
	#SQLITE_OPEN_FULLMUTEX
 0x00010000

	)

650 
	#SQLITE_OPEN_SHAREDCACHE
 0x00020000

	)

651 
	#SQLITE_OPEN_PRIVATECACHE
 0x00040000

	)

652 
	#SQLITE_OPEN_WAL
 0x00080000

	)

684 
	#SQLITE_IOCAP_ATOMIC
 0x00000001

	)

685 
	#SQLITE_IOCAP_ATOMIC512
 0x00000002

	)

686 
	#SQLITE_IOCAP_ATOMIC1K
 0x00000004

	)

687 
	#SQLITE_IOCAP_ATOMIC2K
 0x00000008

	)

688 
	#SQLITE_IOCAP_ATOMIC4K
 0x00000010

	)

689 
	#SQLITE_IOCAP_ATOMIC8K
 0x00000020

	)

690 
	#SQLITE_IOCAP_ATOMIC16K
 0x00000040

	)

691 
	#SQLITE_IOCAP_ATOMIC32K
 0x00000080

	)

692 
	#SQLITE_IOCAP_ATOMIC64K
 0x00000100

	)

693 
	#SQLITE_IOCAP_SAFE_APPEND
 0x00000200

	)

694 
	#SQLITE_IOCAP_SEQUENTIAL
 0x00000400

	)

695 
	#SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
 0x00000800

	)

696 
	#SQLITE_IOCAP_POWERSAFE_OVERWRITE
 0x00001000

	)

697 
	#SQLITE_IOCAP_IMMUTABLE
 0x00002000

	)

706 
	#SQLITE_LOCK_NONE
 0

	)

707 
	#SQLITE_LOCK_SHARED
 1

	)

708 
	#SQLITE_LOCK_RESERVED
 2

	)

709 
	#SQLITE_LOCK_PENDING
 3

	)

710 
	#SQLITE_LOCK_EXCLUSIVE
 4

	)

738 
	#SQLITE_SYNC_NORMAL
 0x00002

	)

739 
	#SQLITE_SYNC_FULL
 0x00003

	)

740 
	#SQLITE_SYNC_DATAONLY
 0x00010

	)

753 
sql™e3_fže
 
	tsql™e3_fže
;

754 
	ssql™e3_fže
 {

755 cÚ¡ 
sql™e3_io_m‘hods
 *
pM‘hods
;

848 
sql™e3_io_m‘hods
 
	tsql™e3_io_m‘hods
;

849 
	ssql™e3_io_m‘hods
 {

850 
iV”siÚ
;

851 (*
xClo£
)(
sql™e3_fže
*);

852 (*
xR—d
)(
sql™e3_fže
*, *, 
iAmt
, 
sql™e3_št64
 
iOf¡
);

853 (*
xWr™e
)(
sql™e3_fže
*, cÚ¡ *, 
iAmt
, 
sql™e3_št64
 
iOf¡
);

854 (*
xTrunÿ‹
)(
sql™e3_fže
*, 
sql™e3_št64
 
size
);

855 (*
xSync
)(
sql™e3_fže
*, 
æags
);

856 (*
xFžeSize
)(
sql™e3_fže
*, 
sql™e3_št64
 *
pSize
);

857 (*
xLock
)(
sql™e3_fže
*, );

858 (*
xUÆock
)(
sql™e3_fže
*, );

859 (*
xCheckRe£rvedLock
)(
sql™e3_fže
*, *
pResOut
);

860 (*
xFžeCÚŒÞ
)(
sql™e3_fže
*, 
Ý
, *
pArg
);

861 (*
xSeùÜSize
)(
sql™e3_fže
*);

862 (*
xDeviûCh¬aù”i¡ics
)(
sql™e3_fže
*);

864 (*
xShmM­
)(
sql™e3_fže
*, 
iPg
, 
pgsz
, , volatile**);

865 (*
xShmLock
)(
sql™e3_fže
*, 
off£t
, 
n
, 
æags
);

866 (*
xShmB¬r›r
)(
sql™e3_fže
*);

867 (*
xShmUnm­
)(
sql™e3_fže
*, 
d–‘eFÏg
);

869 (*
xF‘ch
)(
sql™e3_fže
*, 
sql™e3_št64
 
iOf¡
, 
iAmt
, **
µ
);

870 (*
xUnãtch
)(
sql™e3_fže
*, 
sql™e3_št64
 
iOf¡
, *
p
);

1075 
	#SQLITE_FCNTL_LOCKSTATE
 1

	)

1076 
	#SQLITE_GET_LOCKPROXYFILE
 2

	)

1077 
	#SQLITE_SET_LOCKPROXYFILE
 3

	)

1078 
	#SQLITE_LAST_ERRNO
 4

	)

1079 
	#SQLITE_FCNTL_SIZE_HINT
 5

	)

1080 
	#SQLITE_FCNTL_CHUNK_SIZE
 6

	)

1081 
	#SQLITE_FCNTL_FILE_POINTER
 7

	)

1082 
	#SQLITE_FCNTL_SYNC_OMITTED
 8

	)

1083 
	#SQLITE_FCNTL_WIN32_AV_RETRY
 9

	)

1084 
	#SQLITE_FCNTL_PERSIST_WAL
 10

	)

1085 
	#SQLITE_FCNTL_OVERWRITE
 11

	)

1086 
	#SQLITE_FCNTL_VFSNAME
 12

	)

1087 
	#SQLITE_FCNTL_POWERSAFE_OVERWRITE
 13

	)

1088 
	#SQLITE_FCNTL_PRAGMA
 14

	)

1089 
	#SQLITE_FCNTL_BUSYHANDLER
 15

	)

1090 
	#SQLITE_FCNTL_TEMPFILENAME
 16

	)

1091 
	#SQLITE_FCNTL_MMAP_SIZE
 18

	)

1092 
	#SQLITE_FCNTL_TRACE
 19

	)

1093 
	#SQLITE_FCNTL_HAS_MOVED
 20

	)

1094 
	#SQLITE_FCNTL_SYNC
 21

	)

1095 
	#SQLITE_FCNTL_COMMIT_PHASETWO
 22

	)

1096 
	#SQLITE_FCNTL_WIN32_SET_HANDLE
 23

	)

1108 
sql™e3_mu‹x
 
	tsql™e3_mu‹x
;

1267 
sql™e3_vfs
 
	tsql™e3_vfs
;

1268 (*
	tsql™e3_sysÿÎ_±r
)();

1269 
	ssql™e3_vfs
 {

1270 
iV”siÚ
;

1271 
szOsFže
;

1272 
mxP©hÇme
;

1273 
sql™e3_vfs
 *
pNext
;

1274 cÚ¡ *
zName
;

1275 *
pAµD©a
;

1276 (*
xO³n
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
sql™e3_fže
*,

1277 
æags
, *
pOutFÏgs
);

1278 (*
xD–‘e
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
syncDœ
);

1279 (*
xAcûss
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
æags
, *
pResOut
);

1280 (*
xFuÎP©hÇme
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
nOut
, *
zOut
);

1281 *(*
xDlO³n
)(
sql™e3_vfs
*, cÚ¡ *
zFž’ame
);

1282 (*
xDlE¼Ü
)(
sql™e3_vfs
*, 
nBy‹
, *
zE¼Msg
);

1283 (*(*
xDlSym
)(
sql™e3_vfs
*,*, cÚ¡ *
zSymbÞ
))();

1284 (*
xDlClo£
)(
sql™e3_vfs
*, *);

1285 (*
xRªdomÃss
)(
sql™e3_vfs
*, 
nBy‹
, *
zOut
);

1286 (*
xSË•
)(
sql™e3_vfs
*, 
miüo£cÚds
);

1287 (*
xCu¼’tTime
)(
sql™e3_vfs
*, *);

1288 (*
xG‘La¡E¼Ü
)(
sql™e3_vfs
*, , *);

1293 (*
xCu¼’tTimeIÁ64
)(
sql™e3_vfs
*, 
sql™e3_št64
*);

1298 (*
xS‘Sy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
sql™e3_sysÿÎ_±r
);

1299 
	`sql™e3_sysÿÎ_±r
 (*
xG‘Sy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
);

1300 cÚ¡ *(*
xNextSy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
);

1328 
	#SQLITE_ACCESS_EXISTS
 0

	)

1329 
	#SQLITE_ACCESS_READWRITE
 1

	)

1330 
	#SQLITE_ACCESS_READ
 2

	)

1354 
	#SQLITE_SHM_UNLOCK
 1

	)

1355 
	#SQLITE_SHM_LOCK
 2

	)

1356 
	#SQLITE_SHM_SHARED
 4

	)

1357 
	#SQLITE_SHM_EXCLUSIVE
 8

	)

1367 
	#SQLITE_SHM_NLOCK
 8

	)

1445 
SQLITE_API
 
	`sql™e3_š™Ÿlize
();

1446 
SQLITE_API
 
	`sql™e3_shutdown
();

1447 
SQLITE_API
 
	`sql™e3_os_š™
();

1448 
SQLITE_API
 
	`sql™e3_os_’d
();

1479 
SQLITE_API
 
	`sql™e3_cÚfig
(, ...);

1497 
SQLITE_API
 
	`sql™e3_db_cÚfig
(
sql™e3
*, 
Ý
, ...);

1562 
sql™e3_mem_m‘hods
 
	tsql™e3_mem_m‘hods
;

1563 
	ssql™e3_mem_m‘hods
 {

1564 *(*
xM®loc
)();

1565 (*
xF»e
)(*);

1566 *(*
xR—Îoc
)(*,);

1567 (*
xSize
)(*);

1568 (*
xRoundup
)();

1569 (*
xIn™
)(*);

1570 (*
xShutdown
)(*);

1571 *
pAµD©a
;

1852 
	#SQLITE_CONFIG_SINGLETHREAD
 1

	)

1853 
	#SQLITE_CONFIG_MULTITHREAD
 2

	)

1854 
	#SQLITE_CONFIG_SERIALIZED
 3

	)

1855 
	#SQLITE_CONFIG_MALLOC
 4

	)

1856 
	#SQLITE_CONFIG_GETMALLOC
 5

	)

1857 
	#SQLITE_CONFIG_SCRATCH
 6

	)

1858 
	#SQLITE_CONFIG_PAGECACHE
 7

	)

1859 
	#SQLITE_CONFIG_HEAP
 8

	)

1860 
	#SQLITE_CONFIG_MEMSTATUS
 9

	)

1861 
	#SQLITE_CONFIG_MUTEX
 10

	)

1862 
	#SQLITE_CONFIG_GETMUTEX
 11

	)

1864 
	#SQLITE_CONFIG_LOOKASIDE
 13

	)

1865 
	#SQLITE_CONFIG_PCACHE
 14

	)

1866 
	#SQLITE_CONFIG_GETPCACHE
 15

	)

1867 
	#SQLITE_CONFIG_LOG
 16

	)

1868 
	#SQLITE_CONFIG_URI
 17

	)

1869 
	#SQLITE_CONFIG_PCACHE2
 18

	)

1870 
	#SQLITE_CONFIG_GETPCACHE2
 19

	)

1871 
	#SQLITE_CONFIG_COVERING_INDEX_SCAN
 20

	)

1872 
	#SQLITE_CONFIG_SQLLOG
 21

	)

1873 
	#SQLITE_CONFIG_MMAP_SIZE
 22

	)

1874 
	#SQLITE_CONFIG_WIN32_HEAPSIZE
 23

	)

1934 
	#SQLITE_DBCONFIG_LOOKASIDE
 1001

	)

1935 
	#SQLITE_DBCONFIG_ENABLE_FKEY
 1002

	)

1936 
	#SQLITE_DBCONFIG_ENABLE_TRIGGER
 1003

	)

1946 
SQLITE_API
 
	`sql™e3_ex‹nded_»suÉ_codes
(
sql™e3
*, 
Úoff
);

1997 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_Ï¡_š£¹_rowid
(
sql™e3
*);

2051 
SQLITE_API
 
	`sql™e3_chªges
(
sql™e3
*);

2077 
SQLITE_API
 
	`sql™e3_tÙ®_chªges
(
sql™e3
*);

2116 
SQLITE_API
 
	`sql™e3_š‹¼u±
(
sql™e3
*);

2151 
SQLITE_API
 
	`sql™e3_com¶‘e
(cÚ¡ *
sql
);

2152 
SQLITE_API
 
	`sql™e3_com¶‘e16
(cÚ¡ *
sql
);

2211 
SQLITE_API
 
	`sql™e3_busy_hªdËr
(
sql™e3
*, (*)(*,), *);

2233 
SQLITE_API
 
	`sql™e3_busy_timeout
(
sql™e3
*, 
ms
);

2307 
SQLITE_API
 
	`sql™e3_g‘_bË
(

2308 
sql™e3
 *
db
,

2309 cÚ¡ *
zSql
,

2310 ***
·zResuÉ
,

2311 *
²Row
,

2312 *
²CÞumn
,

2313 **
pzE¼msg


2315 
SQLITE_API
 
	`sql™e3_ä“_bË
(**
»suÉ
);

2411 
SQLITE_API
 *
	`sql™e3_m´štf
(const *,...);

2412 
SQLITE_API
 *
	`sql™e3_vm´štf
(cÚ¡ *, 
va_li¡
);

2413 
SQLITE_API
 *
	`sql™e3_¢´štf
(,*,const *, ...);

2414 
SQLITE_API
 *
	`sql™e3_v¢´štf
(,*,cÚ¡ *, 
va_li¡
);

2504 
SQLITE_API
 *
	`sql™e3_m®loc
();

2505 
SQLITE_API
 *
	`sql™e3_m®loc64
(
sql™e3_ušt64
);

2506 
SQLITE_API
 *
	`sql™e3_»®loc
(*, );

2507 
SQLITE_API
 *
	`sql™e3_»®loc64
(*, 
sql™e3_ušt64
);

2508 
SQLITE_API
 
	`sql™e3_ä“
(*);

2509 
SQLITE_API
 
sql™e3_ušt64
 
	`sql™e3_msize
(*);

2534 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_memÜy_u£d
();

2535 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_memÜy_highw©”
(
»£tFÏg
);

2557 
SQLITE_API
 
	`sql™e3_¿ndomÃss
(
N
, *
P
);

2639 
SQLITE_API
 
	`sql™e3_£t_authÜiz”
(

2640 
sql™e3
*,

2641 (*
xAuth
)(*,,const *,const *,const *,const *),

2642 *
pU£rD©a


2657 
	#SQLITE_DENY
 1

	)

2658 
	#SQLITE_IGNORE
 2

	)

2680 
	#SQLITE_CREATE_INDEX
 1

	)

2681 
	#SQLITE_CREATE_TABLE
 2

	)

2682 
	#SQLITE_CREATE_TEMP_INDEX
 3

	)

2683 
	#SQLITE_CREATE_TEMP_TABLE
 4

	)

2684 
	#SQLITE_CREATE_TEMP_TRIGGER
 5

	)

2685 
	#SQLITE_CREATE_TEMP_VIEW
 6

	)

2686 
	#SQLITE_CREATE_TRIGGER
 7

	)

2687 
	#SQLITE_CREATE_VIEW
 8

	)

2688 
	#SQLITE_DELETE
 9

	)

2689 
	#SQLITE_DROP_INDEX
 10

	)

2690 
	#SQLITE_DROP_TABLE
 11

	)

2691 
	#SQLITE_DROP_TEMP_INDEX
 12

	)

2692 
	#SQLITE_DROP_TEMP_TABLE
 13

	)

2693 
	#SQLITE_DROP_TEMP_TRIGGER
 14

	)

2694 
	#SQLITE_DROP_TEMP_VIEW
 15

	)

2695 
	#SQLITE_DROP_TRIGGER
 16

	)

2696 
	#SQLITE_DROP_VIEW
 17

	)

2697 
	#SQLITE_INSERT
 18

	)

2698 
	#SQLITE_PRAGMA
 19

	)

2699 
	#SQLITE_READ
 20

	)

2700 
	#SQLITE_SELECT
 21

	)

2701 
	#SQLITE_TRANSACTION
 22

	)

2702 
	#SQLITE_UPDATE
 23

	)

2703 
	#SQLITE_ATTACH
 24

	)

2704 
	#SQLITE_DETACH
 25

	)

2705 
	#SQLITE_ALTER_TABLE
 26

	)

2706 
	#SQLITE_REINDEX
 27

	)

2707 
	#SQLITE_ANALYZE
 28

	)

2708 
	#SQLITE_CREATE_VTABLE
 29

	)

2709 
	#SQLITE_DROP_VTABLE
 30

	)

2710 
	#SQLITE_FUNCTION
 31

	)

2711 
	#SQLITE_SAVEPOINT
 32

	)

2712 
	#SQLITE_COPY
 0

	)

2713 
	#SQLITE_RECURSIVE
 33

	)

2743 
SQLITE_API
 *
	`sql™e3_Œaû
(
sql™e3
*, (*
xT¿û
)(*,const *), *);

2744 
SQLITE_API
 
SQLITE_EXPERIMENTAL
 *
	`sql™e3_´ofže
(
sql™e3
*,

2745 (*
xProfže
)(*,cÚ¡ *,
sql™e3_ušt64
), *);

2778 
SQLITE_API
 
	`sql™e3_´og»ss_hªdËr
(
sql™e3
*, , (*)(*), *);

3006 
SQLITE_API
 
	`sql™e3_Ý’
(

3007 cÚ¡ *
fž’ame
,

3008 
sql™e3
 **
µDb


3010 
SQLITE_API
 
	`sql™e3_Ý’16
(

3011 cÚ¡ *
fž’ame
,

3012 
sql™e3
 **
µDb


3014 
SQLITE_API
 
	`sql™e3_Ý’_v2
(

3015 cÚ¡ *
fž’ame
,

3016 
sql™e3
 **
µDb
,

3017 
æags
,

3018 cÚ¡ *
zVfs


3060 
SQLITE_API
 cÚ¡ *
	`sql™e3_uri_·¿m‘”
(cÚ¡ *
zFž’ame
, cÚ¡ *
zP¬am
);

3061 
SQLITE_API
 
	`sql™e3_uri_boÞ—n
(cÚ¡ *
zFže
, cÚ¡ *
zP¬am
, 
bDeçuÉ
);

3062 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_uri_št64
(const *, const *, sqlite3_int64);

3103 
SQLITE_API
 
	`sql™e3_”rcode
(
sql™e3
 *
db
);

3104 
SQLITE_API
 
	`sql™e3_ex‹nded_”rcode
(
sql™e3
 *
db
);

3105 
SQLITE_API
 cÚ¡ *
	`sql™e3_”rmsg
(
sql™e3
*);

3106 
SQLITE_API
 cÚ¡ *
	`sql™e3_”rmsg16
(
sql™e3
*);

3107 
SQLITE_API
 cÚ¡ *
	`sql™e3_”r¡r
();

3133 
sql™e3_¡mt
 
	tsql™e3_¡mt
;

3174 
SQLITE_API
 
	`sql™e3_lim™
(
sql™e3
*, 
id
, 
ÃwV®
);

3232 
	#SQLITE_LIMIT_LENGTH
 0

	)

3233 
	#SQLITE_LIMIT_SQL_LENGTH
 1

	)

3234 
	#SQLITE_LIMIT_COLUMN
 2

	)

3235 
	#SQLITE_LIMIT_EXPR_DEPTH
 3

	)

3236 
	#SQLITE_LIMIT_COMPOUND_SELECT
 4

	)

3237 
	#SQLITE_LIMIT_VDBE_OP
 5

	)

3238 
	#SQLITE_LIMIT_FUNCTION_ARG
 6

	)

3239 
	#SQLITE_LIMIT_ATTACHED
 7

	)

3240 
	#SQLITE_LIMIT_LIKE_PATTERN_LENGTH
 8

	)

3241 
	#SQLITE_LIMIT_VARIABLE_NUMBER
 9

	)

3242 
	#SQLITE_LIMIT_TRIGGER_DEPTH
 10

	)

3243 
	#SQLITE_LIMIT_WORKER_THREADS
 11

	)

3326 
SQLITE_API
 
	`sql™e3_´•¬e
(

3327 
sql™e3
 *
db
,

3328 cÚ¡ *
zSql
,

3329 
nBy‹
,

3330 
sql™e3_¡mt
 **
µStmt
,

3331 cÚ¡ **
pzTaž


3333 
SQLITE_API
 
	`sql™e3_´•¬e_v2
(

3334 
sql™e3
 *
db
,

3335 cÚ¡ *
zSql
,

3336 
nBy‹
,

3337 
sql™e3_¡mt
 **
µStmt
,

3338 cÚ¡ **
pzTaž


3340 
SQLITE_API
 
	`sql™e3_´•¬e16
(

3341 
sql™e3
 *
db
,

3342 cÚ¡ *
zSql
,

3343 
nBy‹
,

3344 
sql™e3_¡mt
 **
µStmt
,

3345 cÚ¡ **
pzTaž


3347 
SQLITE_API
 
	`sql™e3_´•¬e16_v2
(

3348 
sql™e3
 *
db
,

3349 cÚ¡ *
zSql
,

3350 
nBy‹
,

3351 
sql™e3_¡mt
 **
µStmt
,

3352 cÚ¡ **
pzTaž


3362 
SQLITE_API
 cÚ¡ *
	`sql™e3_sql
(
sql™e3_¡mt
 *
pStmt
);

3393 
SQLITE_API
 
	`sql™e3_¡mt_»adÚly
(
sql™e3_¡mt
 *
pStmt
);

3412 
SQLITE_API
 
	`sql™e3_¡mt_busy
(
sql™e3_¡mt
*);

3451 
Mem
 
	tsql™e3_v®ue
;

3465 
sql™e3_cÚ‹xt
 
	tsql™e3_cÚ‹xt
;

3573 
SQLITE_API
 
	`sql™e3_bšd_blob
(
sql™e3_¡mt
*, , cÚ¡ *, 
n
, (*)(*));

3574 
SQLITE_API
 
	`sql™e3_bšd_blob64
(
sql™e3_¡mt
*, , cÚ¡ *, 
sql™e3_ušt64
,

3576 
SQLITE_API
 
	`sql™e3_bšd_doubË
(
sql™e3_¡mt
*, , );

3577 
SQLITE_API
 
	`sql™e3_bšd_št
(
sql™e3_¡mt
*, , );

3578 
SQLITE_API
 
	`sql™e3_bšd_št64
(
sql™e3_¡mt
*, , 
sql™e3_št64
);

3579 
SQLITE_API
 
	`sql™e3_bšd_nuÎ
(
sql™e3_¡mt
*, );

3580 
SQLITE_API
 
	`sql™e3_bšd_‹xt
(
sql™e3_¡mt
*,,const *,,(*)(*));

3581 
SQLITE_API
 
	`sql™e3_bšd_‹xt16
(
sql™e3_¡mt
*, , const *, , (*)(*));

3582 
SQLITE_API
 
	`sql™e3_bšd_‹xt64
(
sql™e3_¡mt
*, , cÚ¡ *, 
sql™e3_ušt64
,

3583 (*)(*), 
’codšg
);

3584 
SQLITE_API
 
	`sql™e3_bšd_v®ue
(
sql™e3_¡mt
*, , cÚ¡ 
sql™e3_v®ue
*);

3585 
SQLITE_API
 
	`sql™e3_bšd_z”oblob
(
sql™e3_¡mt
*, , 
n
);

3605 
SQLITE_API
 
	`sql™e3_bšd_·¿m‘”_couÁ
(
sql™e3_¡mt
*);

3632 
SQLITE_API
 cÚ¡ *
	`sql™e3_bšd_·¿m‘”_Çme
(
sql™e3_¡mt
*, );

3648 
SQLITE_API
 
	`sql™e3_bšd_·¿m‘”_šdex
(
sql™e3_¡mt
*, cÚ¡ *
zName
);

3657 
SQLITE_API
 
	`sql™e3_þ—r_bšdšgs
(
sql™e3_¡mt
*);

3668 
SQLITE_API
 
	`sql™e3_cÞumn_couÁ
(
sql™e3_¡mt
 *
pStmt
);

3696 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_Çme
(
sql™e3_¡mt
*, 
N
);

3697 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_Çme16
(
sql™e3_¡mt
*, 
N
);

3744 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_d©aba£_Çme
(
sql™e3_¡mt
*,);

3745 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_d©aba£_Çme16
(
sql™e3_¡mt
*,);

3746 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_bË_Çme
(
sql™e3_¡mt
*,);

3747 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_bË_Çme16
(
sql™e3_¡mt
*,);

3748 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_Üigš_Çme
(
sql™e3_¡mt
*,);

3749 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_Üigš_Çme16
(
sql™e3_¡mt
*,);

3780 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_deþty³
(
sql™e3_¡mt
*,);

3781 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_deþty³16
(
sql™e3_¡mt
*,);

3860 
SQLITE_API
 
	`sql™e3_¡•
(
sql™e3_¡mt
*);

3880 
SQLITE_API
 
	`sql™e3_d©a_couÁ
(
sql™e3_¡mt
 *
pStmt
);

3903 
	#SQLITE_INTEGER
 1

	)

3904 
	#SQLITE_FLOAT
 2

	)

3905 
	#SQLITE_BLOB
 4

	)

3906 
	#SQLITE_NULL
 5

	)

3907 #ifdeà
SQLITE_TEXT


3908 #undeà
SQLITE_TEXT


3910 
	#SQLITE_TEXT
 3

	)

3912 
	#SQLITE3_TEXT
 3

	)

4076 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_blob
(
sql™e3_¡mt
*, 
iCÞ
);

4077 
SQLITE_API
 
	`sql™e3_cÞumn_by‹s
(
sql™e3_¡mt
*, 
iCÞ
);

4078 
SQLITE_API
 
	`sql™e3_cÞumn_by‹s16
(
sql™e3_¡mt
*, 
iCÞ
);

4079 
SQLITE_API
 
	`sql™e3_cÞumn_doubË
(
sql™e3_¡mt
*, 
iCÞ
);

4080 
SQLITE_API
 
	`sql™e3_cÞumn_št
(
sql™e3_¡mt
*, 
iCÞ
);

4081 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_cÞumn_št64
(
sql™e3_¡mt
*, 
iCÞ
);

4082 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_‹xt
(
sql™e3_¡mt
*, 
iCÞ
);

4083 
SQLITE_API
 cÚ¡ *
	`sql™e3_cÞumn_‹xt16
(
sql™e3_¡mt
*, 
iCÞ
);

4084 
SQLITE_API
 
	`sql™e3_cÞumn_ty³
(
sql™e3_¡mt
*, 
iCÞ
);

4085 
SQLITE_API
 
sql™e3_v®ue
 *
	`sql™e3_cÞumn_v®ue
(
sql™e3_¡mt
*, 
iCÞ
);

4112 
SQLITE_API
 
	`sql™e3_fš®ize
(
sql™e3_¡mt
 *
pStmt
);

4138 
SQLITE_API
 
	`sql™e3_»£t
(
sql™e3_¡mt
 *
pStmt
);

4237 
SQLITE_API
 
	`sql™e3_ü—‹_funùiÚ
(

4238 
sql™e3
 *
db
,

4239 cÚ¡ *
zFunùiÚName
,

4240 
nArg
,

4241 
eTextR•
,

4242 *
pAµ
,

4243 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4244 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4245 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

4247 
SQLITE_API
 
	`sql™e3_ü—‹_funùiÚ16
(

4248 
sql™e3
 *
db
,

4249 cÚ¡ *
zFunùiÚName
,

4250 
nArg
,

4251 
eTextR•
,

4252 *
pAµ
,

4253 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4254 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4255 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

4257 
SQLITE_API
 
	`sql™e3_ü—‹_funùiÚ_v2
(

4258 
sql™e3
 *
db
,

4259 cÚ¡ *
zFunùiÚName
,

4260 
nArg
,

4261 
eTextR•
,

4262 *
pAµ
,

4263 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4264 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4265 (*
xFš®
)(
sql™e3_cÚ‹xt
*),

4266 (*
xDe¡roy
)(*)

4275 
	#SQLITE_UTF8
 1

	)

4276 
	#SQLITE_UTF16LE
 2

	)

4277 
	#SQLITE_UTF16BE
 3

	)

4278 
	#SQLITE_UTF16
 4

	)

4279 
	#SQLITE_ANY
 5

	)

4280 
	#SQLITE_UTF16_ALIGNED
 8

	)

4290 
	#SQLITE_DETERMINISTIC
 0x800

	)

4302 #iâdeà
SQLITE_OMIT_DEPRECATED


4303 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_agg»g©e_couÁ
(
sql™e3_cÚ‹xt
*);

4304 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_expœed
(
sql™e3_¡mt
*);

4305 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_Œªsãr_bšdšgs
(
sql™e3_¡mt
*, sqlite3_stmt*);

4306 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_glob®_»cov”
();

4307 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_th»ad_þ—nup
();

4308 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_memÜy_®¬m
((*)(*,
sql™e3_št64
,),

4309 *,
sql™e3_št64
);

4357 
SQLITE_API
 cÚ¡ *
	`sql™e3_v®ue_blob
(
sql™e3_v®ue
*);

4358 
SQLITE_API
 
	`sql™e3_v®ue_by‹s
(
sql™e3_v®ue
*);

4359 
SQLITE_API
 
	`sql™e3_v®ue_by‹s16
(
sql™e3_v®ue
*);

4360 
SQLITE_API
 
	`sql™e3_v®ue_doubË
(
sql™e3_v®ue
*);

4361 
SQLITE_API
 
	`sql™e3_v®ue_št
(
sql™e3_v®ue
*);

4362 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_v®ue_št64
(
sql™e3_v®ue
*);

4363 
SQLITE_API
 cÚ¡ *
	`sql™e3_v®ue_‹xt
(
sql™e3_v®ue
*);

4364 
SQLITE_API
 cÚ¡ *
	`sql™e3_v®ue_‹xt16
(
sql™e3_v®ue
*);

4365 
SQLITE_API
 cÚ¡ *
	`sql™e3_v®ue_‹xt16Ë
(
sql™e3_v®ue
*);

4366 
SQLITE_API
 cÚ¡ *
	`sql™e3_v®ue_‹xt16be
(
sql™e3_v®ue
*);

4367 
SQLITE_API
 
	`sql™e3_v®ue_ty³
(
sql™e3_v®ue
*);

4368 
SQLITE_API
 
	`sql™e3_v®ue_num”ic_ty³
(
sql™e3_v®ue
*);

4412 
SQLITE_API
 *
	`sql™e3_agg»g©e_cÚ‹xt
(
sql™e3_cÚ‹xt
*, 
nBy‹s
);

4426 
SQLITE_API
 *
	`sql™e3_u£r_d©a
(
sql™e3_cÚ‹xt
*);

4437 
SQLITE_API
 
sql™e3
 *
	`sql™e3_cÚ‹xt_db_hªdË
(
sql™e3_cÚ‹xt
*);

4489 
SQLITE_API
 *
	`sql™e3_g‘_auxd©a
(
sql™e3_cÚ‹xt
*, 
N
);

4490 
SQLITE_API
 
	`sql™e3_£t_auxd©a
(
sql™e3_cÚ‹xt
*, 
N
, *, (*)(*));

4507 (*
	tsql™e3_de¡ruùÜ_ty³
)(*);

4508 
	#SQLITE_STATIC
 ((
sql™e3_de¡ruùÜ_ty³
)0)

	)

4509 
	#SQLITE_TRANSIENT
 ((
sql™e3_de¡ruùÜ_ty³
)-1)

	)

4625 
SQLITE_API
 
	`sql™e3_»suÉ_blob
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4626 
SQLITE_API
 
	`sql™e3_»suÉ_blob64
(
sql™e3_cÚ‹xt
*,cÚ¡ *,
sql™e3_ušt64
,(*)(*));

4627 
SQLITE_API
 
	`sql™e3_»suÉ_doubË
(
sql™e3_cÚ‹xt
*, );

4628 
SQLITE_API
 
	`sql™e3_»suÉ_”rÜ
(
sql™e3_cÚ‹xt
*, const *, );

4629 
SQLITE_API
 
	`sql™e3_»suÉ_”rÜ16
(
sql™e3_cÚ‹xt
*, const *, );

4630 
SQLITE_API
 
	`sql™e3_»suÉ_”rÜ_toobig
(
sql™e3_cÚ‹xt
*);

4631 
SQLITE_API
 
	`sql™e3_»suÉ_”rÜ_nomem
(
sql™e3_cÚ‹xt
*);

4632 
SQLITE_API
 
	`sql™e3_»suÉ_”rÜ_code
(
sql™e3_cÚ‹xt
*, );

4633 
SQLITE_API
 
	`sql™e3_»suÉ_št
(
sql™e3_cÚ‹xt
*, );

4634 
SQLITE_API
 
	`sql™e3_»suÉ_št64
(
sql™e3_cÚ‹xt
*, 
sql™e3_št64
);

4635 
SQLITE_API
 
	`sql™e3_»suÉ_nuÎ
(
sql™e3_cÚ‹xt
*);

4636 
SQLITE_API
 
	`sql™e3_»suÉ_‹xt
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4637 
SQLITE_API
 
	`sql™e3_»suÉ_‹xt64
(
sql™e3_cÚ‹xt
*, cÚ¡ *,
sql™e3_ušt64
,

4638 (*)(*), 
’codšg
);

4639 
SQLITE_API
 
	`sql™e3_»suÉ_‹xt16
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4640 
SQLITE_API
 
	`sql™e3_»suÉ_‹xt16Ë
(
sql™e3_cÚ‹xt
*, const *, ,(*)(*));

4641 
SQLITE_API
 
	`sql™e3_»suÉ_‹xt16be
(
sql™e3_cÚ‹xt
*, const *, ,(*)(*));

4642 
SQLITE_API
 
	`sql™e3_»suÉ_v®ue
(
sql™e3_cÚ‹xt
*, 
sql™e3_v®ue
*);

4643 
SQLITE_API
 
	`sql™e3_»suÉ_z”oblob
(
sql™e3_cÚ‹xt
*, 
n
);

4724 
SQLITE_API
 
	`sql™e3_ü—‹_cÞÏtiÚ
(

4725 
sql™e3
*,

4726 cÚ¡ *
zName
,

4727 
eTextR•
,

4728 *
pArg
,

4729 (*
xCom·»
)(*,,const *,,const *)

4731 
SQLITE_API
 
	`sql™e3_ü—‹_cÞÏtiÚ_v2
(

4732 
sql™e3
*,

4733 cÚ¡ *
zName
,

4734 
eTextR•
,

4735 *
pArg
,

4736 (*
xCom·»
)(*,,const *,,const *),

4737 (*
xDe¡roy
)(*)

4739 
SQLITE_API
 
	`sql™e3_ü—‹_cÞÏtiÚ16
(

4740 
sql™e3
*,

4741 cÚ¡ *
zName
,

4742 
eTextR•
,

4743 *
pArg
,

4744 (*
xCom·»
)(*,,const *,,const *)

4773 
SQLITE_API
 
	`sql™e3_cÞÏtiÚ_Ãeded
(

4774 
sql™e3
*,

4776 (*)(*,
sql™e3
*,
eTextR•
,const *)

4778 
SQLITE_API
 
	`sql™e3_cÞÏtiÚ_Ãeded16
(

4779 
sql™e3
*,

4781 (*)(*,
sql™e3
*,
eTextR•
,const *)

4784 #ifdeà
SQLITE_HAS_CODEC


4792 
SQLITE_API
 
	`sql™e3_key
(

4793 
sql™e3
 *
db
,

4794 cÚ¡ *
pKey
, 
nKey


4796 
SQLITE_API
 
	`sql™e3_key_v2
(

4797 
sql™e3
 *
db
,

4798 cÚ¡ *
zDbName
,

4799 cÚ¡ *
pKey
, 
nKey


4810 
SQLITE_API
 
	`sql™e3_»key
(

4811 
sql™e3
 *
db
,

4812 cÚ¡ *
pKey
, 
nKey


4814 
SQLITE_API
 
	`sql™e3_»key_v2
(

4815 
sql™e3
 *
db
,

4816 cÚ¡ *
zDbName
,

4817 cÚ¡ *
pKey
, 
nKey


4824 
SQLITE_API
 
	`sql™e3_aùiv©e_£e
(

4825 cÚ¡ *
zPassPh¿£


4829 #ifdeà
SQLITE_ENABLE_CEROD


4834 
SQLITE_API
 
	`sql™e3_aùiv©e_ûrod
(

4835 cÚ¡ *
zPassPh¿£


4856 
SQLITE_API
 
	`sql™e3_¦“p
();

4914 
SQLITE_API
 *
sql™e3_‹mp_dœeùÜy
;

4951 
SQLITE_API
 *
sql™e3_d©a_dœeùÜy
;

4974 
SQLITE_API
 
	`sql™e3_g‘_autocomm™
(
sql™e3
*);

4986 
SQLITE_API
 
sql™e3
 *
	`sql™e3_db_hªdË
(
sql™e3_¡mt
*);

5002 
SQLITE_API
 cÚ¡ *
	`sql™e3_db_fž’ame
(
sql™e3
 *
db
, cÚ¡ *
zDbName
);

5011 
SQLITE_API
 
	`sql™e3_db_»adÚly
(
sql™e3
 *
db
, cÚ¡ *
zDbName
);

5026 
SQLITE_API
 
sql™e3_¡mt
 *
	`sql™e3_Ãxt_¡mt
(
sql™e3
 *
pDb
, sql™e3_¡mˆ*
pStmt
);

5074 
SQLITE_API
 *
	`sql™e3_comm™_hook
(
sql™e3
*, (*)(*), *);

5075 
SQLITE_API
 *
	`sql™e3_rÞlback_hook
(
sql™e3
*, (*)(*), *);

5125 
SQLITE_API
 *
	`sql™e3_upd©e_hook
(

5126 
sql™e3
*,

5127 (*)(*,,cÚ¡ *,cÚ¡ *,
sql™e3_št64
),

5160 
SQLITE_API
 
	`sql™e3_’abË_sh¬ed_ÿche
();

5176 
SQLITE_API
 
	`sql™e3_»Ëa£_memÜy
();

5189 
SQLITE_API
 
	`sql™e3_db_»Ëa£_memÜy
(
sql™e3
*);

5241 
SQLITE_API
 
sql™e3_št64
 
	`sql™e3_soá_h—p_lim™64
(sql™e3_št64 
N
);

5252 
SQLITE_API
 
SQLITE_DEPRECATED
 
	`sql™e3_soá_h—p_lim™
(
N
);

5317 
SQLITE_API
 
	`sql™e3_bË_cÞumn_m‘ad©a
(

5318 
sql™e3
 *
db
,

5319 cÚ¡ *
zDbName
,

5320 cÚ¡ *
zTabËName
,

5321 cÚ¡ *
zCÞumnName
,

5322 cÚ¡ **
pzD©aTy³
,

5323 cÚ¡ **
pzCÞlSeq
,

5324 *
pNÙNuÎ
,

5325 *
pPrim¬yKey
,

5326 *
pAutošc


5363 
SQLITE_API
 
	`sql™e3_lßd_ex‹nsiÚ
(

5364 
sql™e3
 *
db
,

5365 cÚ¡ *
zFže
,

5366 cÚ¡ *
zProc
,

5367 **
pzE¼Msg


5383 
SQLITE_API
 
	`sql™e3_’abË_lßd_ex‹nsiÚ
(
sql™e3
 *
db
, 
Úoff
);

5421 
SQLITE_API
 
	`sql™e3_auto_ex‹nsiÚ
((*
xEÁryPošt
)());

5433 
SQLITE_API
 
	`sql™e3_ÿnûl_auto_ex‹nsiÚ
((*
xEÁryPošt
)());

5441 
SQLITE_API
 
	`sql™e3_»£t_auto_ex‹nsiÚ
();

5455 
sql™e3_vb
 
	tsql™e3_vb
;

5456 
sql™e3_šdex_šfo
 
	tsql™e3_šdex_šfo
;

5457 
sql™e3_vb_cursÜ
 
	tsql™e3_vb_cursÜ
;

5458 
sql™e3_moduË
 
	tsql™e3_moduË
;

5476 
	ssql™e3_moduË
 {

5477 
iV”siÚ
;

5478 (*
xC»©e
)(
sql™e3
*, *
pAux
,

5479 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

5480 
sql™e3_vb
 **
µVTab
, **);

5481 (*
xCÚÃù
)(
sql™e3
*, *
pAux
,

5482 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

5483 
sql™e3_vb
 **
µVTab
, **);

5484 (*
xBe¡Index
)(
sql™e3_vb
 *
pVTab
, 
sql™e3_šdex_šfo
*);

5485 (*
xDiscÚÃù
)(
sql™e3_vb
 *
pVTab
);

5486 (*
xDe¡roy
)(
sql™e3_vb
 *
pVTab
);

5487 (*
xO³n
)(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µCursÜ
);

5488 (*
xClo£
)(
sql™e3_vb_cursÜ
*);

5489 (*
xFž‹r
)(
sql™e3_vb_cursÜ
*, 
idxNum
, cÚ¡ *
idxSŒ
,

5490 
¬gc
, 
sql™e3_v®ue
 **
¬gv
);

5491 (*
xNext
)(
sql™e3_vb_cursÜ
*);

5492 (*
xEof
)(
sql™e3_vb_cursÜ
*);

5493 (*
xCÞumn
)(
sql™e3_vb_cursÜ
*, 
sql™e3_cÚ‹xt
*, );

5494 (*
xRowid
)(
sql™e3_vb_cursÜ
*, 
sql™e3_št64
 *
pRowid
);

5495 (*
xUpd©e
)(
sql™e3_vb
 *, , 
sql™e3_v®ue
 **, 
sql™e3_št64
 *);

5496 (*
xBegš
)(
sql™e3_vb
 *
pVTab
);

5497 (*
xSync
)(
sql™e3_vb
 *
pVTab
);

5498 (*
xComm™
)(
sql™e3_vb
 *
pVTab
);

5499 (*
xRÞlback
)(
sql™e3_vb
 *
pVTab
);

5500 (*
xFšdFunùiÚ
)(
sql™e3_vb
 *
pVb
, 
nArg
, cÚ¡ *
zName
,

5501 (**
pxFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

5502 **
µArg
);

5503 (*
xR’ame
)(
sql™e3_vb
 *
pVb
, cÚ¡ *
zNew
);

5506 (*
xSav•ošt
)(
sql™e3_vb
 *
pVTab
, );

5507 (*
xR–—£
)(
sql™e3_vb
 *
pVTab
, );

5508 (*
xRÞlbackTo
)(
sql™e3_vb
 *
pVTab
, );

5576 
	ssql™e3_šdex_šfo
 {

5578 
nCÚ¡¿št
;

5579 
	ssql™e3_šdex_cÚ¡¿št
 {

5580 
iCÞumn
;

5581 
Ý
;

5582 
u§bË
;

5583 
iT”mOff£t
;

5584 } *
aCÚ¡¿št
;

5585 
nOrd”By
;

5586 
	ssql™e3_šdex_Üd”by
 {

5587 
iCÞumn
;

5588 
desc
;

5589 } *
aOrd”By
;

5591 
	ssql™e3_šdex_cÚ¡¿št_u§ge
 {

5592 
¬gvIndex
;

5593 
om™
;

5594 } *
aCÚ¡¿štU§ge
;

5595 
idxNum
;

5596 *
idxSŒ
;

5597 
ÃedToF»eIdxSŒ
;

5598 
Üd”ByCÚsumed
;

5599 
e¡im©edCo¡
;

5601 
sql™e3_št64
 
e¡im©edRows
;

5612 
	#SQLITE_INDEX_CONSTRAINT_EQ
 2

	)

5613 
	#SQLITE_INDEX_CONSTRAINT_GT
 4

	)

5614 
	#SQLITE_INDEX_CONSTRAINT_LE
 8

	)

5615 
	#SQLITE_INDEX_CONSTRAINT_LT
 16

	)

5616 
	#SQLITE_INDEX_CONSTRAINT_GE
 32

	)

5617 
	#SQLITE_INDEX_CONSTRAINT_MATCH
 64

	)

5644 
SQLITE_API
 
	`sql™e3_ü—‹_moduË
(

5645 
sql™e3
 *
db
,

5646 cÚ¡ *
zName
,

5647 cÚ¡ 
sql™e3_moduË
 *
p
,

5648 *
pCl›ÁD©a


5650 
SQLITE_API
 
	`sql™e3_ü—‹_moduË_v2
(

5651 
sql™e3
 *
db
,

5652 cÚ¡ *
zName
,

5653 cÚ¡ 
sql™e3_moduË
 *
p
,

5654 *
pCl›ÁD©a
,

5655 (*
xDe¡roy
)(*)

5676 
	ssql™e3_vb
 {

5677 cÚ¡ 
sql™e3_moduË
 *
pModuË
;

5678 
nRef
;

5679 *
zE¼Msg
;

5700 
	ssql™e3_vb_cursÜ
 {

5701 
sql™e3_vb
 *
pVb
;

5713 
SQLITE_API
 
	`sql™e3_deþ¬e_vb
(
sql™e3
*, cÚ¡ *
zSQL
);

5731 
SQLITE_API
 
	`sql™e3_ov”lßd_funùiÚ
(
sql™e3
*, cÚ¡ *
zFuncName
, 
nArg
);

5755 
sql™e3_blob
 
	tsql™e3_blob
;

5816 
SQLITE_API
 
	`sql™e3_blob_Ý’
(

5817 
sql™e3
*,

5818 cÚ¡ *
zDb
,

5819 cÚ¡ *
zTabË
,

5820 cÚ¡ *
zCÞumn
,

5821 
sql™e3_št64
 
iRow
,

5822 
æags
,

5823 
sql™e3_blob
 **
µBlob


5848 
SQLITE_API
 
SQLITE_EXPERIMENTAL
 
	`sql™e3_blob_»Ý’
(
sql™e3_blob
 *, 
sql™e3_št64
);

5872 
SQLITE_API
 
	`sql™e3_blob_þo£
(
sql™e3_blob
 *);

5887 
SQLITE_API
 
	`sql™e3_blob_by‹s
(
sql™e3_blob
 *);

5915 
SQLITE_API
 
	`sql™e3_blob_»ad
(
sql™e3_blob
 *, *
Z
, 
N
, 
iOff£t
);

5953 
SQLITE_API
 
	`sql™e3_blob_wr™e
(
sql™e3_blob
 *, cÚ¡ *
z
, 
n
, 
iOff£t
);

5984 
SQLITE_API
 
sql™e3_vfs
 *
	`sql™e3_vfs_fšd
(cÚ¡ *
zVfsName
);

5985 
SQLITE_API
 
	`sql™e3_vfs_»gi¡”
(
sql™e3_vfs
*, 
makeDæt
);

5986 
SQLITE_API
 
	`sql™e3_vfs_uÄegi¡”
(
sql™e3_vfs
*);

6103 
SQLITE_API
 
sql™e3_mu‹x
 *
	`sql™e3_mu‹x_®loc
();

6104 
SQLITE_API
 
	`sql™e3_mu‹x_ä“
(
sql™e3_mu‹x
*);

6105 
SQLITE_API
 
	`sql™e3_mu‹x_’‹r
(
sql™e3_mu‹x
*);

6106 
SQLITE_API
 
	`sql™e3_mu‹x_Œy
(
sql™e3_mu‹x
*);

6107 
SQLITE_API
 
	`sql™e3_mu‹x_Ëave
(
sql™e3_mu‹x
*);

6174 
sql™e3_mu‹x_m‘hods
 
	tsql™e3_mu‹x_m‘hods
;

6175 
	ssql™e3_mu‹x_m‘hods
 {

6176 (*
xMu‹xIn™
)();

6177 (*
xMu‹xEnd
)();

6178 
sql™e3_mu‹x
 *(*
xMu‹xAÎoc
)();

6179 (*
xMu‹xF»e
)(
sql™e3_mu‹x
 *);

6180 (*
xMu‹xEÁ”
)(
sql™e3_mu‹x
 *);

6181 (*
xMu‹xTry
)(
sql™e3_mu‹x
 *);

6182 (*
xMu‹xL—ve
)(
sql™e3_mu‹x
 *);

6183 (*
xMu‹xH–d
)(
sql™e3_mu‹x
 *);

6184 (*
xMu‹xNÙh–d
)(
sql™e3_mu‹x
 *);

6216 #iâdeà
NDEBUG


6217 
SQLITE_API
 
	`sql™e3_mu‹x_h–d
(
sql™e3_mu‹x
*);

6218 
SQLITE_API
 
	`sql™e3_mu‹x_nÙh–d
(
sql™e3_mu‹x
*);

6231 
	#SQLITE_MUTEX_FAST
 0

	)

6232 
	#SQLITE_MUTEX_RECURSIVE
 1

	)

6233 
	#SQLITE_MUTEX_STATIC_MASTER
 2

	)

6234 
	#SQLITE_MUTEX_STATIC_MEM
 3

	)

6235 
	#SQLITE_MUTEX_STATIC_MEM2
 4

	)

6236 
	#SQLITE_MUTEX_STATIC_OPEN
 4

	)

6237 
	#SQLITE_MUTEX_STATIC_PRNG
 5

	)

6238 
	#SQLITE_MUTEX_STATIC_LRU
 6

	)

6239 
	#SQLITE_MUTEX_STATIC_LRU2
 7

	)

6240 
	#SQLITE_MUTEX_STATIC_PMEM
 7

	)

6241 
	#SQLITE_MUTEX_STATIC_APP1
 8

	)

6242 
	#SQLITE_MUTEX_STATIC_APP2
 9

	)

6243 
	#SQLITE_MUTEX_STATIC_APP3
 10

	)

6254 
SQLITE_API
 
sql™e3_mu‹x
 *
	`sql™e3_db_mu‹x
(
sql™e3
*);

6288 
SQLITE_API
 
	`sql™e3_fže_cÚŒÞ
(
sql™e3
*, cÚ¡ *
zDbName
, 
Ý
, *);

6307 
SQLITE_API
 
	`sql™e3_‹¡_cÚŒÞ
(
Ý
, ...);

6320 
	#SQLITE_TESTCTRL_FIRST
 5

	)

6321 
	#SQLITE_TESTCTRL_PRNG_SAVE
 5

	)

6322 
	#SQLITE_TESTCTRL_PRNG_RESTORE
 6

	)

6323 
	#SQLITE_TESTCTRL_PRNG_RESET
 7

	)

6324 
	#SQLITE_TESTCTRL_BITVEC_TEST
 8

	)

6325 
	#SQLITE_TESTCTRL_FAULT_INSTALL
 9

	)

6326 
	#SQLITE_TESTCTRL_BENIGN_MALLOC_HOOKS
 10

	)

6327 
	#SQLITE_TESTCTRL_PENDING_BYTE
 11

	)

6328 
	#SQLITE_TESTCTRL_ASSERT
 12

	)

6329 
	#SQLITE_TESTCTRL_ALWAYS
 13

	)

6330 
	#SQLITE_TESTCTRL_RESERVE
 14

	)

6331 
	#SQLITE_TESTCTRL_OPTIMIZATIONS
 15

	)

6332 
	#SQLITE_TESTCTRL_ISKEYWORD
 16

	)

6333 
	#SQLITE_TESTCTRL_SCRATCHMALLOC
 17

	)

6334 
	#SQLITE_TESTCTRL_LOCALTIME_FAULT
 18

	)

6335 
	#SQLITE_TESTCTRL_EXPLAIN_STMT
 19

	)

6336 
	#SQLITE_TESTCTRL_NEVER_CORRUPT
 20

	)

6337 
	#SQLITE_TESTCTRL_VDBE_COVERAGE
 21

	)

6338 
	#SQLITE_TESTCTRL_BYTEORDER
 22

	)

6339 
	#SQLITE_TESTCTRL_ISINIT
 23

	)

6340 
	#SQLITE_TESTCTRL_SORTER_MMAP
 24

	)

6341 
	#SQLITE_TESTCTRL_LAST
 24

	)

6372 
SQLITE_API
 
	`sql™e3_¡©us
(
Ý
, *
pCu¼’t
, *
pHighw©”
, 
»£tFÏg
);

6457 
	#SQLITE_STATUS_MEMORY_USED
 0

	)

6458 
	#SQLITE_STATUS_PAGECACHE_USED
 1

	)

6459 
	#SQLITE_STATUS_PAGECACHE_OVERFLOW
 2

	)

6460 
	#SQLITE_STATUS_SCRATCH_USED
 3

	)

6461 
	#SQLITE_STATUS_SCRATCH_OVERFLOW
 4

	)

6462 
	#SQLITE_STATUS_MALLOC_SIZE
 5

	)

6463 
	#SQLITE_STATUS_PARSER_STACK
 6

	)

6464 
	#SQLITE_STATUS_PAGECACHE_SIZE
 7

	)

6465 
	#SQLITE_STATUS_SCRATCH_SIZE
 8

	)

6466 
	#SQLITE_STATUS_MALLOC_COUNT
 9

	)

6490 
SQLITE_API
 
	`sql™e3_db_¡©us
(
sql™e3
*, 
Ý
, *
pCur
, *
pHiwŒ
, 
»£tFlg
);

6582 
	#SQLITE_DBSTATUS_LOOKASIDE_USED
 0

	)

6583 
	#SQLITE_DBSTATUS_CACHE_USED
 1

	)

6584 
	#SQLITE_DBSTATUS_SCHEMA_USED
 2

	)

6585 
	#SQLITE_DBSTATUS_STMT_USED
 3

	)

6586 
	#SQLITE_DBSTATUS_LOOKASIDE_HIT
 4

	)

6587 
	#SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE
 5

	)

6588 
	#SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL
 6

	)

6589 
	#SQLITE_DBSTATUS_CACHE_HIT
 7

	)

6590 
	#SQLITE_DBSTATUS_CACHE_MISS
 8

	)

6591 
	#SQLITE_DBSTATUS_CACHE_WRITE
 9

	)

6592 
	#SQLITE_DBSTATUS_DEFERRED_FKS
 10

	)

6593 
	#SQLITE_DBSTATUS_MAX
 10

	)

6619 
SQLITE_API
 
	`sql™e3_¡mt_¡©us
(
sql™e3_¡mt
*, 
Ý
,
»£tFlg
);

6658 
	#SQLITE_STMTSTATUS_FULLSCAN_STEP
 1

	)

6659 
	#SQLITE_STMTSTATUS_SORT
 2

	)

6660 
	#SQLITE_STMTSTATUS_AUTOINDEX
 3

	)

6661 
	#SQLITE_STMTSTATUS_VM_STEP
 4

	)

6674 
sql™e3_pÿche
 
	tsql™e3_pÿche
;

6686 
sql™e3_pÿche_·ge
 
	tsql™e3_pÿche_·ge
;

6687 
	ssql™e3_pÿche_·ge
 {

6688 *
pBuf
;

6689 *
pExŒa
;

6851 
sql™e3_pÿche_m‘hods2
 
	tsql™e3_pÿche_m‘hods2
;

6852 
	ssql™e3_pÿche_m‘hods2
 {

6853 
iV”siÚ
;

6854 *
pArg
;

6855 (*
xIn™
)(*);

6856 (*
xShutdown
)(*);

6857 
sql™e3_pÿche
 *(*
xC»©e
)(
szPage
, 
szExŒa
, 
bPurg—bË
);

6858 (*
xCachesize
)(
sql™e3_pÿche
*, 
nCachesize
);

6859 (*
xPagecouÁ
)(
sql™e3_pÿche
*);

6860 
sql™e3_pÿche_·ge
 *(*
xF‘ch
)(
sql™e3_pÿche
*, 
key
, 
ü—‹FÏg
);

6861 (*
xUÅš
)(
sql™e3_pÿche
*, 
sql™e3_pÿche_·ge
*, 
disÿrd
);

6862 (*
xRekey
)(
sql™e3_pÿche
*, 
sql™e3_pÿche_·ge
*,

6863 
ÞdKey
, 
ÃwKey
);

6864 (*
xTrunÿ‹
)(
sql™e3_pÿche
*, 
iLim™
);

6865 (*
xDe¡roy
)(
sql™e3_pÿche
*);

6866 (*
xShršk
)(
sql™e3_pÿche
*);

6874 
sql™e3_pÿche_m‘hods
 
	tsql™e3_pÿche_m‘hods
;

6875 
	ssql™e3_pÿche_m‘hods
 {

6876 *
pArg
;

6877 (*
xIn™
)(*);

6878 (*
xShutdown
)(*);

6879 
sql™e3_pÿche
 *(*
xC»©e
)(
szPage
, 
bPurg—bË
);

6880 (*
xCachesize
)(
sql™e3_pÿche
*, 
nCachesize
);

6881 (*
xPagecouÁ
)(
sql™e3_pÿche
*);

6882 *(*
xF‘ch
)(
sql™e3_pÿche
*, 
key
, 
ü—‹FÏg
);

6883 (*
xUÅš
)(
sql™e3_pÿche
*, *, 
disÿrd
);

6884 (*
xRekey
)(
sql™e3_pÿche
*, *, 
ÞdKey
, 
ÃwKey
);

6885 (*
xTrunÿ‹
)(
sql™e3_pÿche
*, 
iLim™
);

6886 (*
xDe¡roy
)(
sql™e3_pÿche
*);

6900 
sql™e3_backup
 
	tsql™e3_backup
;

7084 
SQLITE_API
 
sql™e3_backup
 *
	`sql™e3_backup_š™
(

7085 
sql™e3
 *
pDe¡
,

7086 cÚ¡ *
zDe¡Name
,

7087 
sql™e3
 *
pSourû
,

7088 cÚ¡ *
zSourûName


7090 
SQLITE_API
 
	`sql™e3_backup_¡•
(
sql™e3_backup
 *
p
, 
nPage
);

7091 
SQLITE_API
 
	`sql™e3_backup_fšish
(
sql™e3_backup
 *
p
);

7092 
SQLITE_API
 
	`sql™e3_backup_»maššg
(
sql™e3_backup
 *
p
);

7093 
SQLITE_API
 
	`sql™e3_backup_·gecouÁ
(
sql™e3_backup
 *
p
);

7209 
SQLITE_API
 
	`sql™e3_uÆock_nÙify
(

7210 
sql™e3
 *
pBlocked
,

7211 (*
xNÙify
)(**
­Arg
, 
nArg
),

7212 *
pNÙifyArg


7224 
SQLITE_API
 
	`sql™e3_¡ricmp
(const *, const *);

7225 
SQLITE_API
 
	`sql™e3_¡ºicmp
(const *, const *, );

7240 
SQLITE_API
 
	`sql™e3_¡rglob
(cÚ¡ *
zGlob
, cÚ¡ *
zSŒ
);

7263 
SQLITE_API
 
	`sql™e3_log
(
iE¼Code
, cÚ¡ *
zFÜm©
, ...);

7300 
SQLITE_API
 *
	`sql™e3_w®_hook
(

7301 
sql™e3
*,

7302 (*)(*,
sql™e3
*,const *,),

7334 
SQLITE_API
 
	`sql™e3_w®_autocheckpošt
(
sql™e3
 *
db
, 
N
);

7356 
SQLITE_API
 
	`sql™e3_w®_checkpošt
(
sql™e3
 *
db
, cÚ¡ *
zDb
);

7431 
SQLITE_API
 
	`sql™e3_w®_checkpošt_v2
(

7432 
sql™e3
 *
db
,

7433 cÚ¡ *
zDb
,

7434 
eMode
,

7435 *
²Log
,

7436 *
²Ck±


7447 
	#SQLITE_CHECKPOINT_PASSIVE
 0

	)

7448 
	#SQLITE_CHECKPOINT_FULL
 1

	)

7449 
	#SQLITE_CHECKPOINT_RESTART
 2

	)

7465 
SQLITE_API
 
	`sql™e3_vb_cÚfig
(
sql™e3
*, 
Ý
, ...);

7506 
	#SQLITE_VTAB_CONSTRAINT_SUPPORT
 1

	)

7518 
SQLITE_API
 
	`sql™e3_vb_Ú_cÚæiù
(
sql™e3
 *);

7532 
	#SQLITE_ROLLBACK
 1

	)

7534 
	#SQLITE_FAIL
 3

	)

7536 
	#SQLITE_REPLACE
 5

	)

7544 #ifdeà
SQLITE_OMIT_FLOATING_POINT


7549 
	}
}

7566 #iâdeà
_SQLITE3RTREE_H_


7567 
	#_SQLITE3RTREE_H_


	)

7574 
sql™e3_¹»e_geom‘ry
 
	tsql™e3_¹»e_geom‘ry
;

7575 
sql™e3_¹»e_qu”y_šfo
 
	tsql™e3_¹»e_qu”y_šfo
;

7580 #ifdeà
SQLITE_RTREE_INT_ONLY


7581 
sql™e3_št64
 
	tsql™e3_¹»e_dbl
;

7583 
	tsql™e3_¹»e_dbl
;

7592 
SQLITE_API
 
sql™e3_¹»e_geom‘ry_ÿÎback
(

7593 
sql™e3
 *
db
,

7594 cÚ¡ *
zGeom
,

7595 (*
xGeom
)(
sql™e3_¹»e_geom‘ry
*, , 
sql™e3_¹»e_dbl
*,*),

7596 *
pCÚ‹xt


7604 
	ssql™e3_¹»e_geom‘ry
 {

7605 *
pCÚ‹xt
;

7606 
nP¬am
;

7607 
sql™e3_¹»e_dbl
 *
aP¬am
;

7608 *
pU£r
;

7609 (*
xD–U£r
)(*);

7618 
SQLITE_API
 
sql™e3_¹»e_qu”y_ÿÎback
(

7619 
sql™e3
 *
db
,

7620 cÚ¡ *
zQu”yFunc
,

7621 (*
xQu”yFunc
)(
sql™e3_¹»e_qu”y_šfo
*),

7622 *
pCÚ‹xt
,

7623 (*
xDe¡ruùÜ
)(*)

7636 
	ssql™e3_¹»e_qu”y_šfo
 {

7637 *
pCÚ‹xt
;

7638 
nP¬am
;

7639 
sql™e3_¹»e_dbl
 *
aP¬am
;

7640 *
pU£r
;

7641 (*
xD–U£r
)(*);

7642 
sql™e3_¹»e_dbl
 *
aCoÜd
;

7643 *
ªQueue
;

7644 
nCoÜd
;

7645 
iLev–
;

7646 
mxLev–
;

7647 
sql™e3_št64
 
iRowid
;

7648 
sql™e3_¹»e_dbl
 
rP¬’tScÜe
;

7649 
eP¬’tW™hš
;

7650 
eW™hš
;

7651 
sql™e3_¹»e_dbl
 
rScÜe
;

7657 
	#NOT_WITHIN
 0

	)

7658 
	#PARTLY_WITHIN
 1

	)

7659 
	#FULLY_WITHIN
 2

	)

7676 #ifdeà
_HAVE_SQLITE_CONFIG_H


7677 
	~"cÚfig.h
"

7704 #iâdeà
SQLITE_MAX_LENGTH


7705 
	#SQLITE_MAX_LENGTH
 1000000000

	)

7725 #iâdeà
SQLITE_MAX_COLUMN


7726 
	#SQLITE_MAX_COLUMN
 2000

	)

7736 #iâdeà
SQLITE_MAX_SQL_LENGTH


7737 
	#SQLITE_MAX_SQL_LENGTH
 1000000000

	)

7750 #iâdeà
SQLITE_MAX_EXPR_DEPTH


7751 
	#SQLITE_MAX_EXPR_DEPTH
 1000

	)

7762 #iâdeà
SQLITE_MAX_COMPOUND_SELECT


7763 
	#SQLITE_MAX_COMPOUND_SELECT
 500

	)

7770 #iâdeà
SQLITE_MAX_VDBE_OP


7771 
	#SQLITE_MAX_VDBE_OP
 25000

	)

7777 #iâdeà
SQLITE_MAX_FUNCTION_ARG


7778 
	#SQLITE_MAX_FUNCTION_ARG
 127

	)

7785 #iâdeà
SQLITE_DEFAULT_CACHE_SIZE


7786 
	#SQLITE_DEFAULT_CACHE_SIZE
 2000

	)

7788 #iâdeà
SQLITE_DEFAULT_TEMP_CACHE_SIZE


7789 
	#SQLITE_DEFAULT_TEMP_CACHE_SIZE
 500

	)

7796 #iâdeà
SQLITE_DEFAULT_WAL_AUTOCHECKPOINT


7797 
	#SQLITE_DEFAULT_WAL_AUTOCHECKPOINT
 1000

	)

7805 #iâdeà
SQLITE_MAX_ATTACHED


7806 
	#SQLITE_MAX_ATTACHED
 10

	)

7813 #iâdeà
SQLITE_MAX_VARIABLE_NUMBER


7814 
	#SQLITE_MAX_VARIABLE_NUMBER
 999

	)

7828 #ifdeà
SQLITE_MAX_PAGE_SIZE


7829 #undeà
SQLITE_MAX_PAGE_SIZE


7831 
	#SQLITE_MAX_PAGE_SIZE
 65536

	)

7837 #iâdeà
SQLITE_DEFAULT_PAGE_SIZE


7838 
	#SQLITE_DEFAULT_PAGE_SIZE
 1024

	)

7840 #ià
SQLITE_DEFAULT_PAGE_SIZE
>
SQLITE_MAX_PAGE_SIZE


7841 #undeà
SQLITE_DEFAULT_PAGE_SIZE


7842 
	#SQLITE_DEFAULT_PAGE_SIZE
 
SQLITE_MAX_PAGE_SIZE


	)

7852 #iâdeà
SQLITE_MAX_DEFAULT_PAGE_SIZE


7853 
	#SQLITE_MAX_DEFAULT_PAGE_SIZE
 8192

	)

7855 #ià
SQLITE_MAX_DEFAULT_PAGE_SIZE
>
SQLITE_MAX_PAGE_SIZE


7856 #undeà
SQLITE_MAX_DEFAULT_PAGE_SIZE


7857 
	#SQLITE_MAX_DEFAULT_PAGE_SIZE
 
SQLITE_MAX_PAGE_SIZE


	)

7868 #iâdeà
SQLITE_MAX_PAGE_COUNT


7869 
	#SQLITE_MAX_PAGE_COUNT
 1073741823

	)

7876 #iâdeà
SQLITE_MAX_LIKE_PATTERN_LENGTH


7877 
	#SQLITE_MAX_LIKE_PATTERN_LENGTH
 50000

	)

7887 #iâdeà
SQLITE_MAX_TRIGGER_DEPTH


7888 
	#SQLITE_MAX_TRIGGER_DEPTH
 1000

	)

7895 #ià
defšed
(
__BORLANDC__
)

7896 #´agm¨
w¬n
 -
rch


7897 #´agm¨
w¬n
 -
ccc


7898 #´agm¨
w¬n
 -
aus


7899 #´agm¨
w¬n
 -
csu


7900 #´agm¨
w¬n
 -
¥a


7906 #ifdeà
HAVE_STDINT_H


7907 
	~<¡dšt.h
>

7909 #ifdeà
HAVE_INTTYPES_H


7910 
	~<š‰y³s.h
>

7929 #ià
defšed
(
__PTRDIFF_TYPE__
)

7930 
	#SQLITE_INT_TO_PTR
(
X
è((*)(
__PTRDIFF_TYPE__
)(X))

	)

7931 
	#SQLITE_PTR_TO_INT
(
X
è(()(
__PTRDIFF_TYPE__
)(X))

	)

7932 #–ià!
defšed
(
__GNUC__
)

7933 
	#SQLITE_INT_TO_PTR
(
X
è((*)&((*)0)[X])

	)

7934 
	#SQLITE_PTR_TO_INT
(
X
è(()(((*)X)-(*)0))

	)

7935 #–ià
defšed
(
HAVE_STDINT_H
)

7936 
	#SQLITE_INT_TO_PTR
(
X
è((*)(
šŒ_t
)(X))

	)

7937 
	#SQLITE_PTR_TO_INT
(
X
è(()(
šŒ_t
)(X))

	)

7939 
	#SQLITE_INT_TO_PTR
(
X
è((*)(X))

	)

7940 
	#SQLITE_PTR_TO_INT
(
X
è(()(X))

	)

7947 #ià
defšed
(
__GNUC__
)

7948 
	#SQLITE_NOINLINE
 
	`__©Œibu‹__
((
nošlše
))

	)

7949 #–ià
defšed
(
_MSC_VER
) && _MSC_VER>=1310

7950 
	#SQLITE_NOINLINE
 
	`__deþ¥ec
(
nošlše
)

	)

7952 
	#SQLITE_NOINLINE


	)

7966 #ià!
defšed
(
SQLITE_THREADSAFE
)

7967 #ià
defšed
(
THREADSAFE
)

7968 
	#SQLITE_THREADSAFE
 
THREADSAFE


	)

7970 
	#SQLITE_THREADSAFE
 1

	)

7978 #iâdeà
SQLITE_POWERSAFE_OVERWRITE


7979 
	#SQLITE_POWERSAFE_OVERWRITE
 1

	)

7988 #ià!
defšed
(
SQLITE_DEFAULT_MEMSTATUS
)

7989 
	#SQLITE_DEFAULT_MEMSTATUS
 1

	)

8009 #ià
defšed
(
SQLITE_SYSTEM_MALLOC
) \

8010 + 
defšed
(
SQLITE_WIN32_MALLOC
) \

8011 + 
defšed
(
SQLITE_ZERO_MALLOC
) \

8012 + 
defšed
(
SQLITE_MEMDEBUG
)>1

8018 #ià
defšed
(
SQLITE_SYSTEM_MALLOC
) \

8019 + 
defšed
(
SQLITE_WIN32_MALLOC
) \

8020 + 
defšed
(
SQLITE_ZERO_MALLOC
) \

8021 + 
defšed
(
SQLITE_MEMDEBUG
)==0

8022 
	#SQLITE_SYSTEM_MALLOC
 1

	)

8029 #ià!
defšed
(
SQLITE_MALLOC_SOFT_LIMIT
)

8030 
	#SQLITE_MALLOC_SOFT_LIMIT
 1024

	)

8039 #ià!
defšed
(
_XOPEN_SOURCE
è&& !defšed(
__DARWIN__
è&& !defšed(
__APPLE__
)

8040 
	#_XOPEN_SOURCE
 600

	)

8054 #ià!
defšed
(
NDEBUG
è&& !defšed(
SQLITE_DEBUG
)

8055 
	#NDEBUG
 1

	)

8057 #ià
defšed
(
NDEBUG
è&& defšed(
SQLITE_DEBUG
)

8058 #undeà
NDEBUG


8064 #ià!
defšed
(
SQLITE_ENABLE_EXPLAIN_COMMENTS
è&& defšed(
SQLITE_DEBUG
)

8065 
	#SQLITE_ENABLE_EXPLAIN_COMMENTS
 1

	)

8082 #ifdeà
SQLITE_COVERAGE_TEST


8083 
SQLITE_PRIVATE
 
sql™e3Cov”age
();

8084 
	#‹¡ÿ£
(
X
èifÐX ){ 
	`sql™e3Cov”age
(
__LINE__
); }

	)

8086 
	#‹¡ÿ£
(
X
)

	)

8094 #ià!
defšed
(
NDEBUG
è|| defšed(
SQLITE_COVERAGE_TEST
)

8095 
	#TESTONLY
(
X
è
	)
X

8097 
	#TESTONLY
(
X
)

	)

8108 #iâdeà
NDEBUG


8109 
	#VVA_ONLY
(
X
è
	)
X

8111 
	#VVA_ONLY
(
X
)

	)

8129 #ià
defšed
(
SQLITE_COVERAGE_TEST
)

8130 
	#ALWAYS
(
X
è(1)

	)

8131 
	#NEVER
(
X
è(0)

	)

8132 #–ià!
defšed
(
NDEBUG
)

8133 
	#ALWAYS
(
X
è((X)?1:(
	`as£¹
(0),0))

	)

8134 
	#NEVER
(
X
è((X)?(
	`as£¹
(0),1):0)

	)

8136 
	#ALWAYS
(
X
è(X)

	)

8137 
	#NEVER
(
X
è(X)

	)

8145 
	#IS_BIG_INT
(
X
è(((X)&~(
i64
)0xffffffff)!=0)

	)

8154 
	#lik–y
(
X
è(X)

	)

8155 
	#uÆik–y
(
X
è(X)

	)

8173 #iâdeà
_SQLITE_HASH_H_


8174 
	#_SQLITE_HASH_H_


	)

8177 
Hash
 
	tHash
;

8178 
HashEËm
 
	tHashEËm
;

8201 
	sHash
 {

8202 
htsize
;

8203 
couÁ
;

8204 
HashEËm
 *
fœ¡
;

8205 
	s_ht
 {

8206 
couÁ
;

8207 
HashEËm
 *
chaš
;

8208 } *
ht
;

8217 
	sHashEËm
 {

8218 
HashEËm
 *
Ãxt
, *
´ev
;

8219 *
d©a
;

8220 cÚ¡ *
pKey
;

8226 
SQLITE_PRIVATE
 
sql™e3HashIn™
(
Hash
*);

8227 
SQLITE_PRIVATE
 *
sql™e3HashIn£¹
(
Hash
*, cÚ¡ *
pKey
, *
pD©a
);

8228 
SQLITE_PRIVATE
 *
sql™e3HashFšd
(cÚ¡ 
Hash
*, cÚ¡ *
pKey
);

8229 
SQLITE_PRIVATE
 
sql™e3HashCË¬
(
Hash
*);

8243 
	#sql™eHashFœ¡
(
H
è((H)->
fœ¡
)

	)

8244 
	#sql™eHashNext
(
E
è((E)->
Ãxt
)

	)

8245 
	#sql™eHashD©a
(
E
è((E)->
d©a
)

	)

8260 
	#TK_SEMI
 1

	)

8261 
	#TK_EXPLAIN
 2

	)

8262 
	#TK_QUERY
 3

	)

8263 
	#TK_PLAN
 4

	)

8264 
	#TK_BEGIN
 5

	)

8265 
	#TK_TRANSACTION
 6

	)

8266 
	#TK_DEFERRED
 7

	)

8267 
	#TK_IMMEDIATE
 8

	)

8268 
	#TK_EXCLUSIVE
 9

	)

8269 
	#TK_COMMIT
 10

	)

8270 
	#TK_END
 11

	)

8271 
	#TK_ROLLBACK
 12

	)

8272 
	#TK_SAVEPOINT
 13

	)

8273 
	#TK_RELEASE
 14

	)

8274 
	#TK_TO
 15

	)

8275 
	#TK_TABLE
 16

	)

8276 
	#TK_CREATE
 17

	)

8277 
	#TK_IF
 18

	)

8278 
	#TK_NOT
 19

	)

8279 
	#TK_EXISTS
 20

	)

8280 
	#TK_TEMP
 21

	)

8281 
	#TK_LP
 22

	)

8282 
	#TK_RP
 23

	)

8283 
	#TK_AS
 24

	)

8284 
	#TK_WITHOUT
 25

	)

8285 
	#TK_COMMA
 26

	)

8286 
	#TK_ID
 27

	)

8287 
	#TK_INDEXED
 28

	)

8288 
	#TK_ABORT
 29

	)

8289 
	#TK_ACTION
 30

	)

8290 
	#TK_AFTER
 31

	)

8291 
	#TK_ANALYZE
 32

	)

8292 
	#TK_ASC
 33

	)

8293 
	#TK_ATTACH
 34

	)

8294 
	#TK_BEFORE
 35

	)

8295 
	#TK_BY
 36

	)

8296 
	#TK_CASCADE
 37

	)

8297 
	#TK_CAST
 38

	)

8298 
	#TK_COLUMNKW
 39

	)

8299 
	#TK_CONFLICT
 40

	)

8300 
	#TK_DATABASE
 41

	)

8301 
	#TK_DESC
 42

	)

8302 
	#TK_DETACH
 43

	)

8303 
	#TK_EACH
 44

	)

8304 
	#TK_FAIL
 45

	)

8305 
	#TK_FOR
 46

	)

8306 
	#TK_IGNORE
 47

	)

8307 
	#TK_INITIALLY
 48

	)

8308 
	#TK_INSTEAD
 49

	)

8309 
	#TK_LIKE_KW
 50

	)

8310 
	#TK_MATCH
 51

	)

8311 
	#TK_NO
 52

	)

8312 
	#TK_KEY
 53

	)

8313 
	#TK_OF
 54

	)

8314 
	#TK_OFFSET
 55

	)

8315 
	#TK_PRAGMA
 56

	)

8316 
	#TK_RAISE
 57

	)

8317 
	#TK_RECURSIVE
 58

	)

8318 
	#TK_REPLACE
 59

	)

8319 
	#TK_RESTRICT
 60

	)

8320 
	#TK_ROW
 61

	)

8321 
	#TK_TRIGGER
 62

	)

8322 
	#TK_VACUUM
 63

	)

8323 
	#TK_VIEW
 64

	)

8324 
	#TK_VIRTUAL
 65

	)

8325 
	#TK_WITH
 66

	)

8326 
	#TK_REINDEX
 67

	)

8327 
	#TK_RENAME
 68

	)

8328 
	#TK_CTIME_KW
 69

	)

8329 
	#TK_ANY
 70

	)

8330 
	#TK_OR
 71

	)

8331 
	#TK_AND
 72

	)

8332 
	#TK_IS
 73

	)

8333 
	#TK_BETWEEN
 74

	)

8334 
	#TK_IN
 75

	)

8335 
	#TK_ISNULL
 76

	)

8336 
	#TK_NOTNULL
 77

	)

8337 
	#TK_NE
 78

	)

8338 
	#TK_EQ
 79

	)

8339 
	#TK_GT
 80

	)

8340 
	#TK_LE
 81

	)

8341 
	#TK_LT
 82

	)

8342 
	#TK_GE
 83

	)

8343 
	#TK_ESCAPE
 84

	)

8344 
	#TK_BITAND
 85

	)

8345 
	#TK_BITOR
 86

	)

8346 
	#TK_LSHIFT
 87

	)

8347 
	#TK_RSHIFT
 88

	)

8348 
	#TK_PLUS
 89

	)

8349 
	#TK_MINUS
 90

	)

8350 
	#TK_STAR
 91

	)

8351 
	#TK_SLASH
 92

	)

8352 
	#TK_REM
 93

	)

8353 
	#TK_CONCAT
 94

	)

8354 
	#TK_COLLATE
 95

	)

8355 
	#TK_BITNOT
 96

	)

8356 
	#TK_STRING
 97

	)

8357 
	#TK_JOIN_KW
 98

	)

8358 
	#TK_CONSTRAINT
 99

	)

8359 
	#TK_DEFAULT
 100

	)

8360 
	#TK_NULL
 101

	)

8361 
	#TK_PRIMARY
 102

	)

8362 
	#TK_UNIQUE
 103

	)

8363 
	#TK_CHECK
 104

	)

8364 
	#TK_REFERENCES
 105

	)

8365 
	#TK_AUTOINCR
 106

	)

8366 
	#TK_ON
 107

	)

8367 
	#TK_INSERT
 108

	)

8368 
	#TK_DELETE
 109

	)

8369 
	#TK_UPDATE
 110

	)

8370 
	#TK_SET
 111

	)

8371 
	#TK_DEFERRABLE
 112

	)

8372 
	#TK_FOREIGN
 113

	)

8373 
	#TK_DROP
 114

	)

8374 
	#TK_UNION
 115

	)

8375 
	#TK_ALL
 116

	)

8376 
	#TK_EXCEPT
 117

	)

8377 
	#TK_INTERSECT
 118

	)

8378 
	#TK_SELECT
 119

	)

8379 
	#TK_VALUES
 120

	)

8380 
	#TK_DISTINCT
 121

	)

8381 
	#TK_DOT
 122

	)

8382 
	#TK_FROM
 123

	)

8383 
	#TK_JOIN
 124

	)

8384 
	#TK_USING
 125

	)

8385 
	#TK_ORDER
 126

	)

8386 
	#TK_GROUP
 127

	)

8387 
	#TK_HAVING
 128

	)

8388 
	#TK_LIMIT
 129

	)

8389 
	#TK_WHERE
 130

	)

8390 
	#TK_INTO
 131

	)

8391 
	#TK_INTEGER
 132

	)

8392 
	#TK_FLOAT
 133

	)

8393 
	#TK_BLOB
 134

	)

8394 
	#TK_VARIABLE
 135

	)

8395 
	#TK_CASE
 136

	)

8396 
	#TK_WHEN
 137

	)

8397 
	#TK_THEN
 138

	)

8398 
	#TK_ELSE
 139

	)

8399 
	#TK_INDEX
 140

	)

8400 
	#TK_ALTER
 141

	)

8401 
	#TK_ADD
 142

	)

8402 
	#TK_TO_TEXT
 143

	)

8403 
	#TK_TO_BLOB
 144

	)

8404 
	#TK_TO_NUMERIC
 145

	)

8405 
	#TK_TO_INT
 146

	)

8406 
	#TK_TO_REAL
 147

	)

8407 
	#TK_ISNOT
 148

	)

8408 
	#TK_END_OF_FILE
 149

	)

8409 
	#TK_ILLEGAL
 150

	)

8410 
	#TK_SPACE
 151

	)

8411 
	#TK_UNCLOSED_STRING
 152

	)

8412 
	#TK_FUNCTION
 153

	)

8413 
	#TK_COLUMN
 154

	)

8414 
	#TK_AGG_FUNCTION
 155

	)

8415 
	#TK_AGG_COLUMN
 156

	)

8416 
	#TK_UMINUS
 157

	)

8417 
	#TK_UPLUS
 158

	)

8418 
	#TK_REGISTER
 159

	)

8422 
	~<¡dio.h
>

8423 
	~<¡dlib.h
>

8424 
	~<¡ršg.h
>

8425 
	~<as£¹.h
>

8426 
	~<¡ddef.h
>

8432 #ifdeà
SQLITE_OMIT_FLOATING_POINT


8433 
sql™e_št64


	)

8434 
sql™e_št64


	)

8435 
	#LONGDOUBLE_TYPE
 
sql™e_št64


	)

8436 #iâdeà
SQLITE_BIG_DBL


8437 
	#SQLITE_BIG_DBL
 (((
sql™e3_št64
)1)<<50)

	)

8439 
	#SQLITE_OMIT_DATETIME_FUNCS
 1

	)

8440 
	#SQLITE_OMIT_TRACE
 1

	)

8441 #undeà
SQLITE_MIXED_ENDIAN_64BIT_FLOAT


8442 #undeà
SQLITE_HAVE_ISNAN


8444 #iâdeà
SQLITE_BIG_DBL


8445 
	#SQLITE_BIG_DBL
 (1e99)

	)

8453 #ifdeà
SQLITE_OMIT_TEMPDB


8454 
	#OMIT_TEMPDB
 1

	)

8456 
	#OMIT_TEMPDB
 0

	)

8465 
	#SQLITE_MAX_FILE_FORMAT
 4

	)

8466 #iâdeà
SQLITE_DEFAULT_FILE_FORMAT


8467 
	#SQLITE_DEFAULT_FILE_FORMAT
 4

	)

8474 #iâdeà
SQLITE_DEFAULT_RECURSIVE_TRIGGERS


8475 
	#SQLITE_DEFAULT_RECURSIVE_TRIGGERS
 0

	)

8482 #iâdeà
SQLITE_TEMP_STORE


8483 
	#SQLITE_TEMP_STORE
 1

	)

8484 
	#SQLITE_TEMP_STORE_xc
 1

	)

8492 #ià
SQLITE_TEMP_STORE
==3 || 
SQLITE_THREADSAFE
==0

8493 #undeà
SQLITE_MAX_WORKER_THREADS


8494 
	#SQLITE_MAX_WORKER_THREADS
 0

	)

8496 #iâdeà
SQLITE_MAX_WORKER_THREADS


8497 
	#SQLITE_MAX_WORKER_THREADS
 8

	)

8499 #iâdeà
SQLITE_DEFAULT_WORKER_THREADS


8500 
	#SQLITE_DEFAULT_WORKER_THREADS
 0

	)

8502 #ià
SQLITE_DEFAULT_WORKER_THREADS
>
SQLITE_MAX_WORKER_THREADS


8503 #undeà
SQLITE_MAX_WORKER_THREADS


8504 
	#SQLITE_MAX_WORKER_THREADS
 
SQLITE_DEFAULT_WORKER_THREADS


	)

8512 #iâdeà
off£tof


8513 
	#off£tof
(
STRUCTURE
,
FIELD
è(()((*)&((STRUCTURE*)0)->FIELD))

	)

8519 
	#MIN
(
A
,
B
è((A)<(B)?(A):(B))

	)

8520 
	#MAX
(
A
,
B
è((A)>(B)?(A):(B))

	)

8525 
	#SWAP
(
TYPE
,
A
,
B
è{TYPE 
t
=A; A=B; Bñ;}

	)

8532 
	#SQLITE_EBCDIC
 1

	)

8534 
	#SQLITE_ASCII
 1

	)

8544 #iâdeà
UINT32_TYPE


8545 #ifdeà
HAVE_UINT32_T


8546 
	#UINT32_TYPE
 
ušt32_t


	)

8548 
	#UINT32_TYPE
 

	)

8551 #iâdeà
UINT16_TYPE


8552 #ifdeà
HAVE_UINT16_T


8553 
	#UINT16_TYPE
 
ušt16_t


	)

8555 
	#UINT16_TYPE
 

	)

8558 #iâdeà
INT16_TYPE


8559 #ifdeà
HAVE_INT16_T


8560 
	#INT16_TYPE
 
št16_t


	)

8562 
	#INT16_TYPE
 

	)

8565 #iâdeà
UINT8_TYPE


8566 #ifdeà
HAVE_UINT8_T


8567 
	#UINT8_TYPE
 
ušt8_t


	)

8569 
	#UINT8_TYPE
 

	)

8572 #iâdeà
INT8_TYPE


8573 #ifdeà
HAVE_INT8_T


8574 
	#INT8_TYPE
 
št8_t


	)

8576 
	#INT8_TYPE
 sigÃd 

	)

8579 #iâdeà
LONGDOUBLE_TYPE


8580 
	#LONGDOUBLE_TYPE
 

	)

8582 
sql™e_št64
 
	ti64
;

8583 
sql™e_ušt64
 
	tu64
;

8584 
UINT32_TYPE
 
	tu32
;

8585 
UINT16_TYPE
 
	tu16
;

8586 
INT16_TYPE
 
	ti16
;

8587 
UINT8_TYPE
 
	tu8
;

8588 
INT8_TYPE
 
	ti8
;

8596 
	#SQLITE_MAX_U32
 ((((
u64
)1)<<32)-1)

	)

8604 #ifdeà
SQLITE_64BIT_STATS


8605 
u64
 
	ttRowút
;

8607 
u32
 
	ttRowút
;

8633 
INT16_TYPE
 
	tLogE¡
;

8644 #ifdeà
SQLITE_AMALGAMATION


8645 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Úe
 = 1;

8647 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Úe
;

8649 #ià(
defšed
(
i386
è|| defšed(
__i386__
è|| defšed(
_M_IX86
) || \

8650 
defšed
(
__x86_64
è|| defšed(
__x86_64__
è|| defšed(
_M_X64
) || \

8651 
defšed
(
_M_AMD64
è|| defšed(
_M_ARM
è|| defšed(
__x86
) || \

8652 
defšed
(
__¬m__
)è&& !defšed(
SQLITE_RUNTIME_BYTEORDER
)

8653 
	#SQLITE_BYTEORDER
 1234

	)

8654 
	#SQLITE_BIGENDIAN
 0

	)

8655 
	#SQLITE_LITTLEENDIAN
 1

	)

8656 
	#SQLITE_UTF16NATIVE
 
SQLITE_UTF16LE


	)

8658 #ià(
defšed
(
¥¬c
è|| defšed(
__µc__
)) \

8659 && !
defšed
(
SQLITE_RUNTIME_BYTEORDER
)

8660 
	#SQLITE_BYTEORDER
 4321

	)

8661 
	#SQLITE_BIGENDIAN
 1

	)

8662 
	#SQLITE_LITTLEENDIAN
 0

	)

8663 
	#SQLITE_UTF16NATIVE
 
SQLITE_UTF16BE


	)

8665 #ià!
defšed
(
SQLITE_BYTEORDER
)

8666 
	#SQLITE_BYTEORDER
 0

	)

8667 
	#SQLITE_BIGENDIAN
 (*(*)(&
sql™e3Úe
)==0)

	)

8668 
	#SQLITE_LITTLEENDIAN
 (*(*)(&
sql™e3Úe
)==1)

	)

8669 
	#SQLITE_UTF16NATIVE
 (
SQLITE_BIGENDIAN
?
SQLITE_UTF16BE
:
SQLITE_UTF16LE
)

	)

8677 
	#LARGEST_INT64
 (0xffffffff|(((
i64
)0x7fffffff)<<32))

	)

8678 
	#SMALLEST_INT64
 (((
i64
)-1è- 
LARGEST_INT64
)

	)

8684 
	#ROUND8
(
x
è(((x)+7)&~7)

	)

8689 
	#ROUNDDOWN8
(
x
è((x)&~7)

	)

8700 #ifdeà
SQLITE_4_BYTE_ALIGNED_MALLOC


8701 
	#EIGHT_BYTE_ALIGNMENT
(
X
è((((*)(Xè- (*)0)&3)==0)

	)

8703 
	#EIGHT_BYTE_ALIGNMENT
(
X
è((((*)(Xè- (*)0)&7)==0)

	)

8709 #ià
defšed
(
__O³nBSD__
è|| defšed(
__QNXNTO__
)

8710 #undeà
SQLITE_MAX_MMAP_SIZE


8711 
	#SQLITE_MAX_MMAP_SIZE
 0

	)

8717 #ifdeà
__APPLE__


8718 
	~<T¬g‘CÚd™iÚ®s.h
>

8719 #ià
TARGET_OS_IPHONE


8720 #undeà
SQLITE_MAX_MMAP_SIZE


8721 
	#SQLITE_MAX_MMAP_SIZE
 0

	)

8724 #iâdeà
SQLITE_MAX_MMAP_SIZE


8725 #ià
defšed
(
__lšux__
) \

8726 || 
defšed
(
_WIN32
) \

8727 || (
defšed
(
__APPLE__
è&& defšed(
__MACH__
)) \

8728 || 
defšed
(
__sun
)

8729 
	#SQLITE_MAX_MMAP_SIZE
 0x7fff0000

	)

8731 
	#SQLITE_MAX_MMAP_SIZE
 0

	)

8733 
	#SQLITE_MAX_MMAP_SIZE_xc
 1

	)

8741 #iâdeà
SQLITE_DEFAULT_MMAP_SIZE


8742 
	#SQLITE_DEFAULT_MMAP_SIZE
 0

	)

8743 
	#SQLITE_DEFAULT_MMAP_SIZE_xc
 1

	)

8745 #ià
SQLITE_DEFAULT_MMAP_SIZE
>
SQLITE_MAX_MMAP_SIZE


8746 #undeà
SQLITE_DEFAULT_MMAP_SIZE


8747 
	#SQLITE_DEFAULT_MMAP_SIZE
 
SQLITE_MAX_MMAP_SIZE


	)

8755 #ifdeà
SQLITE_ENABLE_STAT4


8756 #undeà
SQLITE_ENABLE_STAT3


8757 
	#SQLITE_ENABLE_STAT3_OR_STAT4
 1

	)

8758 #–ià
SQLITE_ENABLE_STAT3


8759 
	#SQLITE_ENABLE_STAT3_OR_STAT4
 1

	)

8760 #–ià
SQLITE_ENABLE_STAT3_OR_STAT4


8761 #undeà
SQLITE_ENABLE_STAT3_OR_STAT4


8768 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_ENABLE_SELECTTRACE
)

8769 
	#SELECTTRACE_ENABLED
 1

	)

8771 
	#SELECTTRACE_ENABLED
 0

	)

8783 
BusyHªdËr
 
	tBusyHªdËr
;

8784 
	sBusyHªdËr
 {

8785 (*
xFunc
)(*,);

8786 *
pArg
;

8787 
nBusy
;

8795 
	#MASTER_NAME
 "sql™e_ma¡”"

	)

8796 
	#TEMP_MASTER_NAME
 "sql™e_‹mp_ma¡”"

	)

8801 
	#MASTER_ROOT
 1

	)

8806 
	#SCHEMA_TABLE
(
x
è((!
OMIT_TEMPDB
)&&(x==1)?
TEMP_MASTER_NAME
:
MASTER_NAME
)

	)

8812 
	#A¼aySize
(
X
è(()((X)/(X[0])))

	)

8817 
	#IsPow”OfTwo
(
X
è(((X)&((X)-1))==0)

	)

8827 
	#SQLITE_DYNAMIC
 ((
sql™e3_de¡ruùÜ_ty³
)
sql™e3M®locSize
)

	)

8843 #ifdeà
SQLITE_OMIT_WSD


8844 
	#SQLITE_WSD
 cÚ¡

	)

8845 
	#GLOBAL
(
t
,
v
è(*Ñ*)
	`sql™e3_wsd_fšd
((*)&(v), (v)))

	)

8846 
	#sql™e3Glob®CÚfig
 
	`GLOBAL
(
Sql™e3CÚfig
, 
sql™e3CÚfig
)

	)

8847 
SQLITE_API
 
sql™e3_wsd_š™
(
N
, 
J
);

8848 
SQLITE_API
 *
sql™e3_wsd_fšd
(*
K
, 
L
);

8850 
	#SQLITE_WSD


	)

8851 
	#GLOBAL
(
t
,
v
è
	)
v

8852 
	#sql™e3Glob®CÚfig
 
sql™e3CÚfig


	)

8871 
	#UNUSED_PARAMETER
(
x
è()(x)

	)

8872 
	#UNUSED_PARAMETER2
(
x
,
y
è
	`UNUSED_PARAMETER
(x),UNUSED_PARAMETER(y)

	)

8877 
AggInfo
 
	tAggInfo
;

8878 
AuthCÚ‹xt
 
	tAuthCÚ‹xt
;

8879 
AutošcInfo
 
	tAutošcInfo
;

8880 
B™vec
 
	tB™vec
;

8881 
CÞlSeq
 
	tCÞlSeq
;

8882 
CÞumn
 
	tCÞumn
;

8883 
Db
 
	tDb
;

8884 
Schema
 
	tSchema
;

8885 
Ex´
 
	tEx´
;

8886 
Ex´Li¡
 
	tEx´Li¡
;

8887 
Ex´S·n
 
	tEx´S·n
;

8888 
FKey
 
	tFKey
;

8889 
FuncDe¡ruùÜ
 
	tFuncDe¡ruùÜ
;

8890 
FuncDef
 
	tFuncDef
;

8891 
FuncDefHash
 
	tFuncDefHash
;

8892 
IdLi¡
 
	tIdLi¡
;

8893 
Index
 
	tIndex
;

8894 
IndexSam¶e
 
	tIndexSam¶e
;

8895 
KeyCÏss
 
	tKeyCÏss
;

8896 
KeyInfo
 
	tKeyInfo
;

8897 
Lookaside
 
	tLookaside
;

8898 
LookasideSlÙ
 
	tLookasideSlÙ
;

8899 
ModuË
 
	tModuË
;

8900 
NameCÚ‹xt
 
	tNameCÚ‹xt
;

8901 
P¬£
 
	tP¬£
;

8902 
PrštfArgum’ts
 
	tPrštfArgum’ts
;

8903 
RowS‘
 
	tRowS‘
;

8904 
Sav•ošt
 
	tSav•ošt
;

8905 
S–eù
 
	tS–eù
;

8906 
SQL™eTh»ad
 
	tSQL™eTh»ad
;

8907 
S–eùDe¡
 
	tS–eùDe¡
;

8908 
SrcLi¡
 
	tSrcLi¡
;

8909 
SŒAccum
 
	tSŒAccum
;

8910 
TabË
 
	tTabË
;

8911 
TabËLock
 
	tTabËLock
;

8912 
Tok’
 
	tTok’
;

8913 
T»eV›w
 
	tT»eV›w
;

8914 
Trigg”
 
	tTrigg”
;

8915 
Trigg”Prg
 
	tTrigg”Prg
;

8916 
Trigg”S‹p
 
	tTrigg”S‹p
;

8917 
UÅackedRecÜd
 
	tUÅackedRecÜd
;

8918 
VTabË
 
	tVTabË
;

8919 
VbCtx
 
	tVbCtx
;

8920 
W®k”
 
	tW®k”
;

8921 
Wh”eInfo
 
	tWh”eInfo
;

8922 
W™h
 
	tW™h
;

8946 #iâdeà
_BTREE_H_


8947 
	#_BTREE_H_


	)

8952 
	#SQLITE_N_BTREE_META
 10

	)

8958 #iâdeà
SQLITE_DEFAULT_AUTOVACUUM


8959 
	#SQLITE_DEFAULT_AUTOVACUUM
 0

	)

8962 
	#BTREE_AUTOVACUUM_NONE
 0

	)

8963 
	#BTREE_AUTOVACUUM_FULL
 1

	)

8964 
	#BTREE_AUTOVACUUM_INCR
 2

	)

8969 
BŒ“
 
	tBŒ“
;

8970 
BtCursÜ
 
	tBtCursÜ
;

8971 
BtSh¬ed
 
	tBtSh¬ed
;

8974 
SQLITE_PRIVATE
 
sql™e3BŒ“O³n
(

8975 
sql™e3_vfs
 *
pVfs
,

8976 cÚ¡ *
zFž’ame
,

8977 
sql™e3
 *
db
,

8978 
BŒ“
 **
µBŒ“
,

8979 
æags
,

8980 
vfsFÏgs


8989 
	#BTREE_OMIT_JOURNAL
 1

	)

8990 
	#BTREE_MEMORY
 2

	)

8991 
	#BTREE_SINGLE
 4

	)

8992 
	#BTREE_UNORDERED
 8

	)

8994 
SQLITE_PRIVATE
 
sql™e3BŒ“Clo£
(
BŒ“
*);

8995 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘CacheSize
(
BŒ“
*,);

8996 #ià
SQLITE_MAX_MMAP_SIZE
>0

8997 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘Mm­Lim™
(
BŒ“
*,
sql™e3_št64
);

8999 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘Pag”FÏgs
(
BŒ“
*,);

9000 
SQLITE_PRIVATE
 
sql™e3BŒ“SyncDi§bËd
(
BŒ“
*);

9001 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘PageSize
(
BŒ“
 *
p
, 
nPagesize
, 
nRe£rve
, 
eFix
);

9002 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘PageSize
(
BŒ“
*);

9003 
SQLITE_PRIVATE
 
sql™e3BŒ“MaxPageCouÁ
(
BŒ“
*,);

9004 
SQLITE_PRIVATE
 
u32
 
sql™e3BŒ“La¡Page
(
BŒ“
*);

9005 
SQLITE_PRIVATE
 
sql™e3BŒ“Secu»D–‘e
(
BŒ“
*,);

9006 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘Re£rve
(
BŒ“
*);

9007 #ià
defšed
(
SQLITE_HAS_CODEC
è|| defšed(
SQLITE_DEBUG
)

9008 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘Re£rveNoMu‹x
(
BŒ“
 *
p
);

9010 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘AutoVacuum
(
BŒ“
 *, );

9011 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘AutoVacuum
(
BŒ“
 *);

9012 
SQLITE_PRIVATE
 
sql™e3BŒ“BegšT¿ns
(
BŒ“
*,);

9013 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™Pha£OÃ
(
BŒ“
*, cÚ¡ *
zMa¡”
);

9014 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™Pha£Two
(
BŒ“
*, );

9015 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™
(
BŒ“
*);

9016 
SQLITE_PRIVATE
 
sql™e3BŒ“RÞlback
(
BŒ“
*,,);

9017 
SQLITE_PRIVATE
 
sql™e3BŒ“BegšStmt
(
BŒ“
*,);

9018 
SQLITE_PRIVATE
 
sql™e3BŒ“C»©eTabË
(
BŒ“
*, *, 
æags
);

9019 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInT¿ns
(
BŒ“
*);

9020 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInR—dT¿ns
(
BŒ“
*);

9021 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInBackup
(
BŒ“
*);

9022 
SQLITE_PRIVATE
 *
sql™e3BŒ“Schema
(
BŒ“
 *, , (*)(*));

9023 
SQLITE_PRIVATE
 
sql™e3BŒ“SchemaLocked
(
BŒ“
 *
pBŒ“
);

9024 
SQLITE_PRIVATE
 
sql™e3BŒ“LockTabË
(
BŒ“
 *
pBŒ“
, 
iTab
, 
u8
 
isWr™eLock
);

9025 
SQLITE_PRIVATE
 
sql™e3BŒ“Sav•ošt
(
BŒ“
 *, , );

9027 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“G‘Fž’ame
(
BŒ“
 *);

9028 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“G‘Jouº®Çme
(
BŒ“
 *);

9029 
SQLITE_PRIVATE
 
sql™e3BŒ“CÝyFže
(
BŒ“
 *, Btree *);

9031 
SQLITE_PRIVATE
 
sql™e3BŒ“InüVacuum
(
BŒ“
 *);

9043 
	#BTREE_INTKEY
 1

	)

9044 
	#BTREE_BLOBKEY
 2

	)

9046 
SQLITE_PRIVATE
 
sql™e3BŒ“DrÝTabË
(
BŒ“
*, , *);

9047 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬TabË
(
BŒ“
*, , *);

9048 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬TabËOfCursÜ
(
BtCursÜ
*);

9049 
SQLITE_PRIVATE
 
sql™e3BŒ“TrAÎCursÜs
(
BŒ“
*, , );

9051 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘M‘a
(
BŒ“
 *
pBŒ“
, 
idx
, 
u32
 *
pV®ue
);

9052 
SQLITE_PRIVATE
 
sql™e3BŒ“Upd©eM‘a
(
BŒ“
*, 
idx
, 
u32
 
v®ue
);

9054 
SQLITE_PRIVATE
 
sql™e3BŒ“NewDb
(
BŒ“
 *
p
);

9068 
	#BTREE_FREE_PAGE_COUNT
 0

	)

9069 
	#BTREE_SCHEMA_VERSION
 1

	)

9070 
	#BTREE_FILE_FORMAT
 2

	)

9071 
	#BTREE_DEFAULT_CACHE_SIZE
 3

	)

9072 
	#BTREE_LARGEST_ROOT_PAGE
 4

	)

9073 
	#BTREE_TEXT_ENCODING
 5

	)

9074 
	#BTREE_USER_VERSION
 6

	)

9075 
	#BTREE_INCR_VACUUM
 7

	)

9076 
	#BTREE_APPLICATION_ID
 8

	)

9082 
	#BTREE_BULKLOAD
 0x00000001

	)

9084 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜ
(

9085 
BŒ“
*,

9086 
iTabË
,

9087 
wrFÏg
,

9088 
KeyInfo
*,

9089 
BtCursÜ
 *
pCursÜ


9091 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜSize
();

9092 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜZ”o
(
BtCursÜ
*);

9094 
SQLITE_PRIVATE
 
sql™e3BŒ“Clo£CursÜ
(
BtCursÜ
*);

9095 
SQLITE_PRIVATE
 
sql™e3BŒ“Mov‘oUÅacked
(

9096 
BtCursÜ
*,

9097 
UÅackedRecÜd
 *
pUnKey
,

9098 
i64
 
štKey
,

9099 
bŸs
,

9100 *
pRes


9102 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜHasMoved
(
BtCursÜ
*);

9103 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜRe¡Üe
(
BtCursÜ
*, *);

9104 
SQLITE_PRIVATE
 
sql™e3BŒ“D–‘e
(
BtCursÜ
*);

9105 
SQLITE_PRIVATE
 
sql™e3BŒ“In£¹
(
BtCursÜ
*, cÚ¡ *
pKey
, 
i64
 
nKey
,

9106 cÚ¡ *
pD©a
, 
nD©a
,

9107 
nZ”o
, 
bŸs
, 
£ekResuÉ
);

9108 
SQLITE_PRIVATE
 
sql™e3BŒ“Fœ¡
(
BtCursÜ
*, *
pRes
);

9109 
SQLITE_PRIVATE
 
sql™e3BŒ“La¡
(
BtCursÜ
*, *
pRes
);

9110 
SQLITE_PRIVATE
 
sql™e3BŒ“Next
(
BtCursÜ
*, *
pRes
);

9111 
SQLITE_PRIVATE
 
sql™e3BŒ“Eof
(
BtCursÜ
*);

9112 
SQLITE_PRIVATE
 
sql™e3BŒ“P»vious
(
BtCursÜ
*, *
pRes
);

9113 
SQLITE_PRIVATE
 
sql™e3BŒ“KeySize
(
BtCursÜ
*, 
i64
 *
pSize
);

9114 
SQLITE_PRIVATE
 
sql™e3BŒ“Key
(
BtCursÜ
*, 
u32
 
off£t
, u32 
amt
, *);

9115 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“KeyF‘ch
(
BtCursÜ
*, 
u32
 *
pAmt
);

9116 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“D©aF‘ch
(
BtCursÜ
*, 
u32
 *
pAmt
);

9117 
SQLITE_PRIVATE
 
sql™e3BŒ“D©aSize
(
BtCursÜ
*, 
u32
 *
pSize
);

9118 
SQLITE_PRIVATE
 
sql™e3BŒ“D©a
(
BtCursÜ
*, 
u32
 
off£t
, u32 
amt
, *);

9120 
SQLITE_PRIVATE
 *
sql™e3BŒ“IÁegr™yCheck
(
BŒ“
*, *
aRoÙ
, 
nRoÙ
, , *);

9121 
SQLITE_PRIVATE
 
Pag”
 *
sql™e3BŒ“Pag”
(
BŒ“
*);

9123 
SQLITE_PRIVATE
 
sql™e3BŒ“PutD©a
(
BtCursÜ
*, 
u32
 
off£t
, u32 
amt
, *);

9124 
SQLITE_PRIVATE
 
sql™e3BŒ“InüblobCursÜ
(
BtCursÜ
 *);

9125 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬CursÜ
(
BtCursÜ
 *);

9126 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘V”siÚ
(
BŒ“
 *
pBt
, 
iV”siÚ
);

9127 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜHšts
(
BtCursÜ
 *, 
mask
);

9128 
SQLITE_PRIVATE
 
sql™e3BŒ“IsR—dÚly
(
BŒ“
 *
pBt
);

9130 #iâdeà
NDEBUG


9131 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜIsV®id
(
BtCursÜ
*);

9134 #iâdeà
SQLITE_OMIT_BTREECOUNT


9135 
SQLITE_PRIVATE
 
sql™e3BŒ“CouÁ
(
BtCursÜ
 *, 
i64
 *);

9138 #ifdeà
SQLITE_TEST


9139 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜInfo
(
BtCursÜ
*, *, );

9140 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜLi¡
(
BŒ“
*);

9143 #iâdeà
SQLITE_OMIT_WAL


9144 
SQLITE_PRIVATE
 
sql™e3BŒ“Checkpošt
(
BŒ“
*, , *, *);

9152 #iâdeà
SQLITE_OMIT_SHARED_CACHE


9153 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”
(
BŒ“
*);

9154 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”AÎ
(
sql™e3
*);

9156 
	#sql™e3BŒ“EÁ”
(
X
)

	)

9157 
	#sql™e3BŒ“EÁ”AÎ
(
X
)

	)

9160 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& 
SQLITE_THREADSAFE


9161 
SQLITE_PRIVATE
 
sql™e3BŒ“Sh¬abË
(
BŒ“
*);

9162 
SQLITE_PRIVATE
 
sql™e3BŒ“L—ve
(
BŒ“
*);

9163 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”CursÜ
(
BtCursÜ
*);

9164 
SQLITE_PRIVATE
 
sql™e3BŒ“L—veCursÜ
(
BtCursÜ
*);

9165 
SQLITE_PRIVATE
 
sql™e3BŒ“L—veAÎ
(
sql™e3
*);

9166 #iâdeà
NDEBUG


9168 
SQLITE_PRIVATE
 
sql™e3BŒ“HÞdsMu‹x
(
BŒ“
*);

9169 
SQLITE_PRIVATE
 
sql™e3BŒ“HÞdsAÎMu‹xes
(
sql™e3
*);

9170 
SQLITE_PRIVATE
 
sql™e3SchemaMu‹xH–d
(
sql™e3
*,,
Schema
*);

9174 
	#sql™e3BŒ“Sh¬abË
(
X
è0

	)

9175 
	#sql™e3BŒ“L—ve
(
X
)

	)

9176 
	#sql™e3BŒ“EÁ”CursÜ
(
X
)

	)

9177 
	#sql™e3BŒ“L—veCursÜ
(
X
)

	)

9178 
	#sql™e3BŒ“L—veAÎ
(
X
)

	)

9180 
	#sql™e3BŒ“HÞdsMu‹x
(
X
è1

	)

9181 
	#sql™e3BŒ“HÞdsAÎMu‹xes
(
X
è1

	)

9182 
	#sql™e3SchemaMu‹xH–d
(
X
,
Y
,
Z
è1

	)

9209 #iâdeà
_SQLITE_VDBE_H_


9210 
	#_SQLITE_VDBE_H_


	)

9218 
Vdbe
 
	tVdbe
;

9224 
Mem
 
	tMem
;

9225 
SubProg¿m
 
	tSubProg¿m
;

9232 
	sVdbeOp
 {

9233 
u8
 
Ýcode
;

9234 sigÃd 
p4ty³
;

9235 
u8
 
Ýæags
;

9236 
u8
 
p5
;

9237 
p1
;

9238 
p2
;

9239 
p3
;

9241 
i
;

9242 *
p
;

9243 *
z
;

9244 
i64
 *
pI64
;

9245 *
pR—l
;

9246 
FuncDef
 *
pFunc
;

9247 
CÞlSeq
 *
pCÞl
;

9248 
Mem
 *
pMem
;

9249 
VTabË
 *
pVb
;

9250 
KeyInfo
 *
pKeyInfo
;

9251 *
ai
;

9252 
SubProg¿m
 *
pProg¿m
;

9253 (*
xAdvªû
)(
BtCursÜ
 *, *);

9254 } 
p4
;

9255 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


9256 *
zComm’t
;

9258 #ifdeà
VDBE_PROFILE


9259 
u32
 
út
;

9260 
u64
 
cyþes
;

9262 #ifdeà
SQLITE_VDBE_COVERAGE


9263 
iSrcLše
;

9266 
VdbeOp
 
	tVdbeOp
;

9272 
	sSubProg¿m
 {

9273 
VdbeOp
 *
aOp
;

9274 
nOp
;

9275 
nMem
;

9276 
nC¤
;

9277 
nOnû
;

9278 *
tok’
;

9279 
SubProg¿m
 *
pNext
;

9286 
	sVdbeOpLi¡
 {

9287 
u8
 
Ýcode
;

9288 sigÃd 
p1
;

9289 sigÃd 
p2
;

9290 sigÃd 
p3
;

9292 
VdbeOpLi¡
 
	tVdbeOpLi¡
;

9297 
	#P4_NOTUSED
 0

	)

9298 
	#P4_DYNAMIC
 (-1è

	)

9299 
	#P4_STATIC
 (-2è

	)

9300 
	#P4_COLLSEQ
 (-4è

	)

9301 
	#P4_FUNCDEF
 (-5è

	)

9302 
	#P4_KEYINFO
 (-6è

	)

9303 
	#P4_MEM
 (-8è

	)

9304 
	#P4_TRANSIENT
 0

	)

9305 
	#P4_VTAB
 (-10è

	)

9306 
	#P4_MPRINTF
 (-11è

	)

9307 
	#P4_REAL
 (-12è

	)

9308 
	#P4_INT64
 (-13è

	)

9309 
	#P4_INT32
 (-14è

	)

9310 
	#P4_INTARRAY
 (-15è

	)

9311 
	#P4_SUBPROGRAM
 (-18è

	)

9312 
	#P4_ADVANCE
 (-19è

	)

9315 
	#P5_CÚ¡¿štNÙNuÎ
 1

	)

9316 
	#P5_CÚ¡¿štUnique
 2

	)

9317 
	#P5_CÚ¡¿štCheck
 3

	)

9318 
	#P5_CÚ¡¿štFK
 4

	)

9324 
	#COLNAME_NAME
 0

	)

9325 
	#COLNAME_DECLTYPE
 1

	)

9326 
	#COLNAME_DATABASE
 2

	)

9327 
	#COLNAME_TABLE
 3

	)

9328 
	#COLNAME_COLUMN
 4

	)

9329 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


9330 
	#COLNAME_N
 5

	)

9332 #ifdeà
SQLITE_OMIT_DECLTYPE


9333 
	#COLNAME_N
 1

	)

9335 
	#COLNAME_N
 2

	)

9345 
	#ADDR
(
X
è(-1-(X))

	)

9355 
	#OP_FunùiÚ
 1

	)

9356 
	#OP_Sav•ošt
 2

	)

9357 
	#OP_AutoComm™
 3

	)

9358 
	#OP_T¿n§ùiÚ
 4

	)

9359 
	#OP_SÜ‹rNext
 5

	)

9360 
	#OP_P»vIfO³n
 6

	)

9361 
	#OP_NextIfO³n
 7

	)

9362 
	#OP_P»v
 8

	)

9363 
	#OP_Next
 9

	)

9364 
	#OP_AggS‹p
 10

	)

9365 
	#OP_Checkpošt
 11

	)

9366 
	#OP_Jouº®Mode
 12

	)

9367 
	#OP_Vacuum
 13

	)

9368 
	#OP_VFž‹r
 14

	)

9369 
	#OP_VUpd©e
 15

	)

9370 
	#OP_GÙo
 16

	)

9371 
	#OP_Gosub
 17

	)

9372 
	#OP_R‘uº
 18

	)

9373 
	#OP_NÙ
 19

	)

9374 
	#OP_In™CÜoutše
 20

	)

9375 
	#OP_EndCÜoutše
 21

	)

9376 
	#OP_Y›ld
 22

	)

9377 
	#OP_H®tIfNuÎ
 23

	)

9378 
	#OP_H®t
 24

	)

9379 
	#OP_IÁeg”
 25

	)

9380 
	#OP_IÁ64
 26

	)

9381 
	#OP_SŒšg
 27

	)

9382 
	#OP_NuÎ
 28

	)

9383 
	#OP_SoáNuÎ
 29

	)

9384 
	#OP_Blob
 30

	)

9385 
	#OP_V¬ŸbË
 31

	)

9386 
	#OP_Move
 32

	)

9387 
	#OP_CÝy
 33

	)

9388 
	#OP_SCÝy
 34

	)

9389 
	#OP_ResuÉRow
 35

	)

9390 
	#OP_CÞlSeq
 36

	)

9391 
	#OP_AddImm
 37

	)

9392 
	#OP_Mu¡BeIÁ
 38

	)

9393 
	#OP_R—lAffš™y
 39

	)

9394 
	#OP_Ca¡
 40

	)

9395 
	#OP_P”mutiÚ
 41

	)

9396 
	#OP_Com·»
 42

	)

9397 
	#OP_Jump
 43

	)

9398 
	#OP_Onû
 44

	)

9399 
	#OP_If
 45

	)

9400 
	#OP_IfNÙ
 46

	)

9401 
	#OP_CÞumn
 47

	)

9402 
	#OP_Affš™y
 48

	)

9403 
	#OP_MakeRecÜd
 49

	)

9404 
	#OP_CouÁ
 50

	)

9405 
	#OP_R—dCook›
 51

	)

9406 
	#OP_S‘Cook›
 52

	)

9407 
	#OP_ReÝ’Idx
 53

	)

9408 
	#OP_O³nR—d
 54

	)

9409 
	#OP_O³nWr™e
 55

	)

9410 
	#OP_O³nAutošdex
 56

	)

9411 
	#OP_O³nEphem”®
 57

	)

9412 
	#OP_SÜ‹rO³n
 58

	)

9413 
	#OP_Sequ’ûTe¡
 59

	)

9414 
	#OP_O³nP£udo
 60

	)

9415 
	#OP_Clo£
 61

	)

9416 
	#OP_S“kLT
 62

	)

9417 
	#OP_S“kLE
 63

	)

9418 
	#OP_S“kGE
 64

	)

9419 
	#OP_S“kGT
 65

	)

9420 
	#OP_S“k
 66

	)

9421 
	#OP_NoCÚæiù
 67

	)

9422 
	#OP_NÙFound
 68

	)

9423 
	#OP_Found
 69

	)

9424 
	#OP_NÙExi¡s
 70

	)

9425 
	#OP_Or
 71

	)

9426 
	#OP_And
 72

	)

9427 
	#OP_Sequ’û
 73

	)

9428 
	#OP_NewRowid
 74

	)

9429 
	#OP_In£¹
 75

	)

9430 
	#OP_IsNuÎ
 76

	)

9431 
	#OP_NÙNuÎ
 77

	)

9432 
	#OP_Ne
 78

	)

9433 
	#OP_Eq
 79

	)

9434 
	#OP_Gt
 80

	)

9435 
	#OP_Le
 81

	)

9436 
	#OP_Lt
 82

	)

9437 
	#OP_Ge
 83

	)

9438 
	#OP_In£¹IÁ
 84

	)

9439 
	#OP_B™And
 85

	)

9440 
	#OP_B™Or
 86

	)

9441 
	#OP_ShiáLeá
 87

	)

9442 
	#OP_ShiáRight
 88

	)

9443 
	#OP_Add
 89

	)

9444 
	#OP_SubŒaù
 90

	)

9445 
	#OP_MuÉly
 91

	)

9446 
	#OP_Divide
 92

	)

9447 
	#OP_Remašd”
 93

	)

9448 
	#OP_CÚÿt
 94

	)

9449 
	#OP_D–‘e
 95

	)

9450 
	#OP_B™NÙ
 96

	)

9451 
	#OP_SŒšg8
 97

	)

9452 
	#OP_Re£tCouÁ
 98

	)

9453 
	#OP_SÜ‹rCom·»
 99

	)

9454 
	#OP_SÜ‹rD©a
 100

	)

9455 
	#OP_RowKey
 101

	)

9456 
	#OP_RowD©a
 102

	)

9457 
	#OP_Rowid
 103

	)

9458 
	#OP_NuÎRow
 104

	)

9459 
	#OP_La¡
 105

	)

9460 
	#OP_SÜ‹rSÜt
 106

	)

9461 
	#OP_SÜt
 107

	)

9462 
	#OP_Rewšd
 108

	)

9463 
	#OP_SÜ‹rIn£¹
 109

	)

9464 
	#OP_IdxIn£¹
 110

	)

9465 
	#OP_IdxD–‘e
 111

	)

9466 
	#OP_IdxRowid
 112

	)

9467 
	#OP_IdxLE
 113

	)

9468 
	#OP_IdxGT
 114

	)

9469 
	#OP_IdxLT
 115

	)

9470 
	#OP_IdxGE
 116

	)

9471 
	#OP_De¡roy
 117

	)

9472 
	#OP_CË¬
 118

	)

9473 
	#OP_Re£tSÜ‹r
 119

	)

9474 
	#OP_C»©eIndex
 120

	)

9475 
	#OP_C»©eTabË
 121

	)

9476 
	#OP_P¬£Schema
 122

	)

9477 
	#OP_LßdAÇlysis
 123

	)

9478 
	#OP_DrÝTabË
 124

	)

9479 
	#OP_DrÝIndex
 125

	)

9480 
	#OP_DrÝTrigg”
 126

	)

9481 
	#OP_IÁegr™yCk
 127

	)

9482 
	#OP_RowS‘Add
 128

	)

9483 
	#OP_RowS‘R—d
 129

	)

9484 
	#OP_RowS‘Te¡
 130

	)

9485 
	#OP_Prog¿m
 131

	)

9486 
	#OP_P¬am
 132

	)

9487 
	#OP_R—l
 133

	)

9488 
	#OP_FkCouÁ”
 134

	)

9489 
	#OP_FkIfZ”o
 135

	)

9490 
	#OP_MemMax
 136

	)

9491 
	#OP_IfPos
 137

	)

9492 
	#OP_IfNeg
 138

	)

9493 
	#OP_IfZ”o
 139

	)

9494 
	#OP_AggFš®
 140

	)

9495 
	#OP_InüVacuum
 141

	)

9496 
	#OP_Expœe
 142

	)

9497 
	#OP_TabËLock
 143

	)

9498 
	#OP_VBegš
 144

	)

9499 
	#OP_VC»©e
 145

	)

9500 
	#OP_VDe¡roy
 146

	)

9501 
	#OP_VO³n
 147

	)

9502 
	#OP_VCÞumn
 148

	)

9503 
	#OP_VNext
 149

	)

9504 
	#OP_VR’ame
 150

	)

9505 
	#OP_PagecouÁ
 151

	)

9506 
	#OP_MaxPgút
 152

	)

9507 
	#OP_In™
 153

	)

9508 
	#OP_NoÝ
 154

	)

9509 
	#OP_Ex¶aš
 155

	)

9516 
	#OPFLG_JUMP
 0x0001

	)

9517 
	#OPFLG_OUT2_PRERELEASE
 0x0002

	)

9518 
	#OPFLG_IN1
 0x0004

	)

9519 
	#OPFLG_IN2
 0x0008

	)

9520 
	#OPFLG_IN3
 0x0010

	)

9521 
	#OPFLG_OUT2
 0x0020

	)

9522 
	#OPFLG_OUT3
 0x0040

	)

9523 
	#OPFLG_INITIALIZER
 {\

9543  0x02, 0x01, 0x00, 0x00,}

	)

9552 
SQLITE_PRIVATE
 
Vdbe
 *
sql™e3VdbeC»©e
(
P¬£
*);

9553 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp0
(
Vdbe
*,);

9554 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp1
(
Vdbe
*,,);

9555 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp2
(
Vdbe
*,,,);

9556 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp3
(
Vdbe
*,,,,);

9557 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp4
(
Vdbe
*,,,,,cÚ¡ *
zP4
,);

9558 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp4IÁ
(
Vdbe
*,,,,,);

9559 
SQLITE_PRIVATE
 
sql™e3VdbeAddOpLi¡
(
Vdbe
*, 
nOp
, 
VdbeOpLi¡
 cÚ¡ *
aOp
, 
iLš’o
);

9560 
SQLITE_PRIVATE
 
sql™e3VdbeAddP¬£SchemaOp
(
Vdbe
*,,*);

9561 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP1
(
Vdbe
*, 
u32
 
addr
, 
P1
);

9562 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP2
(
Vdbe
*, 
u32
 
addr
, 
P2
);

9563 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP3
(
Vdbe
*, 
u32
 
addr
, 
P3
);

9564 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP5
(
Vdbe
*, 
u8
 
P5
);

9565 
SQLITE_PRIVATE
 
sql™e3VdbeJumpH”e
(
Vdbe
*, 
addr
);

9566 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeToNoÝ
(
Vdbe
*, 
addr
);

9567 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘ePriÜOpcode
(
Vdbe
*, 
u8
 
Ý
);

9568 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP4
(
Vdbe
*, 
addr
, cÚ¡ *
zP4
, 
N
);

9569 
SQLITE_PRIVATE
 
sql™e3VdbeS‘P4KeyInfo
(
P¬£
*, 
Index
*);

9570 
SQLITE_PRIVATE
 
sql™e3VdbeU£sBŒ“
(
Vdbe
*, );

9571 
SQLITE_PRIVATE
 
VdbeOp
 *
sql™e3VdbeG‘Op
(
Vdbe
*, );

9572 
SQLITE_PRIVATE
 
sql™e3VdbeMakeLab–
(
Vdbe
*);

9573 
SQLITE_PRIVATE
 
sql™e3VdbeRunOÆyOnû
(
Vdbe
*);

9574 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘e
(
Vdbe
*);

9575 
SQLITE_PRIVATE
 
sql™e3VdbeCË¬Objeù
(
sql™e3
*,
Vdbe
*);

9576 
SQLITE_PRIVATE
 
sql™e3VdbeMakeR—dy
(
Vdbe
*,
P¬£
*);

9577 
SQLITE_PRIVATE
 
sql™e3VdbeFš®ize
(
Vdbe
*);

9578 
SQLITE_PRIVATE
 
sql™e3VdbeResÞveLab–
(
Vdbe
*, );

9579 
SQLITE_PRIVATE
 
sql™e3VdbeCu¼’tAddr
(
Vdbe
*);

9580 #ifdeà
SQLITE_DEBUG


9581 
SQLITE_PRIVATE
 
sql™e3VdbeAs£¹MayAbÜt
(
Vdbe
 *, );

9583 
SQLITE_PRIVATE
 
sql™e3VdbeRe£tS‹pResuÉ
(
Vdbe
*);

9584 
SQLITE_PRIVATE
 
sql™e3VdbeRewšd
(
Vdbe
*);

9585 
SQLITE_PRIVATE
 
sql™e3VdbeRe£t
(
Vdbe
*);

9586 
SQLITE_PRIVATE
 
sql™e3VdbeS‘NumCÞs
(
Vdbe
*,);

9587 
SQLITE_PRIVATE
 
sql™e3VdbeS‘CÞName
(
Vdbe
*, , , const *, (*)(*));

9588 
SQLITE_PRIVATE
 
sql™e3VdbeCouÁChªges
(
Vdbe
*);

9589 
SQLITE_PRIVATE
 
sql™e3
 *
sql™e3VdbeDb
(
Vdbe
*);

9590 
SQLITE_PRIVATE
 
sql™e3VdbeS‘Sql
(
Vdbe
*, cÚ¡ *
z
, 
n
, );

9591 
SQLITE_PRIVATE
 
sql™e3VdbeSw­
(
Vdbe
*,Vdbe*);

9592 
SQLITE_PRIVATE
 
VdbeOp
 *
sql™e3VdbeTakeOpA¼ay
(
Vdbe
*, *, *);

9593 
SQLITE_PRIVATE
 
sql™e3_v®ue
 *
sql™e3VdbeG‘BoundV®ue
(
Vdbe
*, , 
u8
);

9594 
SQLITE_PRIVATE
 
sql™e3VdbeS‘V¬mask
(
Vdbe
*, );

9595 #iâdeà
SQLITE_OMIT_TRACE


9596 
SQLITE_PRIVATE
 *
sql™e3VdbeEx·ndSql
(
Vdbe
*, const *);

9598 
SQLITE_PRIVATE
 
sql™e3MemCom·»
(cÚ¡ 
Mem
*, cÚ¡ Mem*, cÚ¡ 
CÞlSeq
*);

9600 
SQLITE_PRIVATE
 
sql™e3VdbeRecÜdUÅack
(
KeyInfo
*,,cÚ¡ *,
UÅackedRecÜd
*);

9601 
SQLITE_PRIVATE
 
sql™e3VdbeRecÜdCom·»
(,cÚ¡ *,
UÅackedRecÜd
*);

9602 
SQLITE_PRIVATE
 
UÅackedRecÜd
 *
sql™e3VdbeAÎocUÅackedRecÜd
(
KeyInfo
 *, *, , **);

9604 (*
RecÜdCom·»
)(,cÚ¡ *,
	tUÅackedRecÜd
*);

9605 
SQLITE_PRIVATE
 
RecÜdCom·»
 
sql™e3VdbeFšdCom·»
(
UÅackedRecÜd
*);

9607 #iâdeà
SQLITE_OMIT_TRIGGER


9608 
SQLITE_PRIVATE
 
sql™e3VdbeLškSubProg¿m
(
Vdbe
 *, 
SubProg¿m
 *);

9618 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


9619 
SQLITE_PRIVATE
 
sql™e3VdbeComm’t
(
Vdbe
*, const *, ...);

9620 
	#VdbeComm’t
(
X
è
sql™e3VdbeComm’t
 
	)
X

9621 
SQLITE_PRIVATE
 
sql™e3VdbeNoÝComm’t
(
Vdbe
*, const *, ...);

9622 
	#VdbeNoÝComm’t
(
X
è
sql™e3VdbeNoÝComm’t
 
	)
X

9623 #ifdeà
SQLITE_ENABLE_MODULE_COMMENTS


9624 
	#VdbeModuËComm’t
(
X
è
sql™e3VdbeNoÝComm’t
 
	)
X

9626 
	#VdbeModuËComm’t
(
X
)

	)

9629 
	#VdbeComm’t
(
X
)

	)

9630 
	#VdbeNoÝComm’t
(
X
)

	)

9631 
	#VdbeModuËComm’t
(
X
)

	)

9656 #ifdeà
SQLITE_VDBE_COVERAGE


9657 
SQLITE_PRIVATE
 
sql™e3VdbeS‘LšeNumb”
(
Vdbe
*,);

9658 
	#VdbeCov”age
(
v
è
	`sql™e3VdbeS‘LšeNumb”
(v,
__LINE__
)

	)

9659 
	#VdbeCov”ageIf
(
v
,
x
èif(x)
	`sql™e3VdbeS‘LšeNumb”
(v,
__LINE__
)

	)

9660 
	#VdbeCov”ageAlwaysTak’
(
v
è
	`sql™e3VdbeS‘LšeNumb”
(v,2);

	)

9661 
	#VdbeCov”ageNev”Tak’
(
v
è
	`sql™e3VdbeS‘LšeNumb”
(v,1);

	)

9662 
	#VDBE_OFFSET_LINENO
(
x
è(
__LINE__
+x)

	)

9664 
	#VdbeCov”age
(
v
)

	)

9665 
	#VdbeCov”ageIf
(
v
,
x
)

	)

9666 
	#VdbeCov”ageAlwaysTak’
(
v
)

	)

9667 
	#VdbeCov”ageNev”Tak’
(
v
)

	)

9668 
	#VDBE_OFFSET_LINENO
(
x
è0

	)

9693 #iâdeà
_PAGER_H_


9694 
	#_PAGER_H_


	)

9701 #iâdeà
SQLITE_DEFAULT_JOURNAL_SIZE_LIMIT


9702 
	#SQLITE_DEFAULT_JOURNAL_SIZE_LIMIT
 -1

	)

9709 
u32
 
	tPgno
;

9714 
Pag”
 
	tPag”
;

9719 
PgHdr
 
	tDbPage
;

9729 
	#PAGER_MJ_PGNO
(
x
è((
Pgno
)((
PENDING_BYTE
/((x)->
·geSize
))+1))

	)

9736 
	#PAGER_OMIT_JOURNAL
 0x0001

	)

9737 
	#PAGER_MEMORY
 0x0002

	)

9742 
	#PAGER_LOCKINGMODE_QUERY
 -1

	)

9743 
	#PAGER_LOCKINGMODE_NORMAL
 0

	)

9744 
	#PAGER_LOCKINGMODE_EXCLUSIVE
 1

	)

9749 
	#PAGER_JOURNALMODE_QUERY
 (-1è

	)

9750 
	#PAGER_JOURNALMODE_DELETE
 0

	)

9751 
	#PAGER_JOURNALMODE_PERSIST
 1

	)

9752 
	#PAGER_JOURNALMODE_OFF
 2

	)

9753 
	#PAGER_JOURNALMODE_TRUNCATE
 3

	)

9754 
	#PAGER_JOURNALMODE_MEMORY
 4

	)

9755 
	#PAGER_JOURNALMODE_WAL
 5

	)

9760 
	#PAGER_GET_NOCONTENT
 0x01

	)

9761 
	#PAGER_GET_READONLY
 0x02

	)

9766 
	#PAGER_SYNCHRONOUS_OFF
 0x01

	)

9767 
	#PAGER_SYNCHRONOUS_NORMAL
 0x02

	)

9768 
	#PAGER_SYNCHRONOUS_FULL
 0x03

	)

9769 
	#PAGER_SYNCHRONOUS_MASK
 0x03

	)

9770 
	#PAGER_FULLFSYNC
 0x04

	)

9771 
	#PAGER_CKPT_FULLFSYNC
 0x08

	)

9772 
	#PAGER_CACHESPILL
 0x10

	)

9773 
	#PAGER_FLAGS_MASK
 0x1ø

	)

9782 
SQLITE_PRIVATE
 
sql™e3Pag”O³n
(

9783 
sql™e3_vfs
*,

9784 
Pag”
 **
µPag”
,

9789 (*)(
DbPage
*)

9791 
SQLITE_PRIVATE
 
sql™e3Pag”Clo£
(
Pag”
 *
pPag”
);

9792 
SQLITE_PRIVATE
 
sql™e3Pag”R—dFžeh—d”
(
Pag”
*, , *);

9795 
SQLITE_PRIVATE
 
sql™e3Pag”S‘BusyhªdËr
(
Pag”
*, (*)(*), *);

9796 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Pagesize
(
Pag”
*, 
u32
*, );

9797 
SQLITE_PRIVATE
 
sql™e3Pag”MaxPageCouÁ
(
Pag”
*, );

9798 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Cachesize
(
Pag”
*, );

9799 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Mm­Lim™
(
Pag”
 *, 
sql™e3_št64
);

9800 
SQLITE_PRIVATE
 
sql™e3Pag”Shršk
(
Pag”
*);

9801 
SQLITE_PRIVATE
 
sql™e3Pag”S‘FÏgs
(
Pag”
*,);

9802 
SQLITE_PRIVATE
 
sql™e3Pag”LockšgMode
(
Pag”
 *, );

9803 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Jouº®Mode
(
Pag”
 *, );

9804 
SQLITE_PRIVATE
 
sql™e3Pag”G‘Jouº®Mode
(
Pag”
*);

9805 
SQLITE_PRIVATE
 
sql™e3Pag”OkToChªgeJouº®Mode
(
Pag”
*);

9806 
SQLITE_PRIVATE
 
i64
 
sql™e3Pag”Jouº®SizeLim™
(
Pag”
 *, i64);

9807 
SQLITE_PRIVATE
 
sql™e3_backup
 **
sql™e3Pag”BackupPŒ
(
Pag”
*);

9810 
SQLITE_PRIVATE
 
sql™e3Pag”Acquœe
(
Pag”
 *
pPag”
, 
Pgno
 
pgno
, 
DbPage
 **
µPage
, 
þrFÏg
);

9811 
	#sql™e3Pag”G‘
(
A
,
B
,
C
è
	`sql™e3Pag”Acquœe
(A,B,C,0)

	)

9812 
SQLITE_PRIVATE
 
DbPage
 *
sql™e3Pag”Lookup
(
Pag”
 *
pPag”
, 
Pgno
 
pgno
);

9813 
SQLITE_PRIVATE
 
sql™e3Pag”Ref
(
DbPage
*);

9814 
SQLITE_PRIVATE
 
sql™e3Pag”UÄef
(
DbPage
*);

9815 
SQLITE_PRIVATE
 
sql™e3Pag”UÄefNÙNuÎ
(
DbPage
*);

9818 
SQLITE_PRIVATE
 
sql™e3Pag”Wr™e
(
DbPage
*);

9819 
SQLITE_PRIVATE
 
sql™e3Pag”DÚtWr™e
(
DbPage
*);

9820 
SQLITE_PRIVATE
 
sql™e3Pag”Mov•age
(
Pag”
*,
DbPage
*,
Pgno
,);

9821 
SQLITE_PRIVATE
 
sql™e3Pag”PageRefcouÁ
(
DbPage
*);

9822 
SQLITE_PRIVATE
 *
sql™e3Pag”G‘D©a
(
DbPage
 *);

9823 
SQLITE_PRIVATE
 *
sql™e3Pag”G‘ExŒa
(
DbPage
 *);

9826 
SQLITE_PRIVATE
 
sql™e3Pag”PagecouÁ
(
Pag”
*, *);

9827 
SQLITE_PRIVATE
 
sql™e3Pag”Begš
(
Pag”
*, 
exFÏg
, );

9828 
SQLITE_PRIVATE
 
sql™e3Pag”Comm™Pha£OÃ
(
Pag”
*,cÚ¡ *
zMa¡”
, );

9829 
SQLITE_PRIVATE
 
sql™e3Pag”ExþusiveLock
(
Pag”
*);

9830 
SQLITE_PRIVATE
 
sql™e3Pag”Sync
(
Pag”
 *
pPag”
, cÚ¡ *
zMa¡”
);

9831 
SQLITE_PRIVATE
 
sql™e3Pag”Comm™Pha£Two
(
Pag”
*);

9832 
SQLITE_PRIVATE
 
sql™e3Pag”RÞlback
(
Pag”
*);

9833 
SQLITE_PRIVATE
 
sql™e3Pag”O³nSav•ošt
(
Pag”
 *
pPag”
, 
n
);

9834 
SQLITE_PRIVATE
 
sql™e3Pag”Sav•ošt
(
Pag”
 *
pPag”
, 
Ý
, 
iSav•ošt
);

9835 
SQLITE_PRIVATE
 
sql™e3Pag”Sh¬edLock
(
Pag”
 *
pPag”
);

9837 #iâdeà
SQLITE_OMIT_WAL


9838 
SQLITE_PRIVATE
 
sql™e3Pag”Checkpošt
(
Pag”
 *
pPag”
, , *, *);

9839 
SQLITE_PRIVATE
 
sql™e3Pag”W®SuµÜ‹d
(
Pag”
 *
pPag”
);

9840 
SQLITE_PRIVATE
 
sql™e3Pag”W®C®lback
(
Pag”
 *
pPag”
);

9841 
SQLITE_PRIVATE
 
sql™e3Pag”O³nW®
(
Pag”
 *
pPag”
, *
pisO³n
);

9842 
SQLITE_PRIVATE
 
sql™e3Pag”Clo£W®
(
Pag”
 *
pPag”
);

9845 #ifdeà
SQLITE_ENABLE_ZIPVFS


9846 
SQLITE_PRIVATE
 
sql™e3Pag”W®F¿mesize
(
Pag”
 *
pPag”
);

9850 
SQLITE_PRIVATE
 
u8
 
sql™e3Pag”I¤—dÚly
(
Pag”
*);

9851 
SQLITE_PRIVATE
 
sql™e3Pag”RefcouÁ
(
Pag”
*);

9852 
SQLITE_PRIVATE
 
sql™e3Pag”MemU£d
(
Pag”
*);

9853 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Pag”Fž’ame
(
Pag”
*, );

9854 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_vfs
 *
sql™e3Pag”Vfs
(
Pag”
*);

9855 
SQLITE_PRIVATE
 
sql™e3_fže
 *
sql™e3Pag”Fže
(
Pag”
*);

9856 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Pag”Jouº®Çme
(
Pag”
*);

9857 
SQLITE_PRIVATE
 
sql™e3Pag”Nosync
(
Pag”
*);

9858 
SQLITE_PRIVATE
 *
sql™e3Pag”TempS·û
(
Pag”
*);

9859 
SQLITE_PRIVATE
 
sql™e3Pag”IsMemdb
(
Pag”
*);

9860 
SQLITE_PRIVATE
 
sql™e3Pag”CacheSt
(
Pag”
 *, , , *);

9861 
SQLITE_PRIVATE
 
sql™e3Pag”CË¬Cache
(
Pag”
 *);

9862 
SQLITE_PRIVATE
 
sql™e3SeùÜSize
(
sql™e3_fže
 *);

9865 
SQLITE_PRIVATE
 
sql™e3Pag”Trunÿ‹Image
(
Pag”
*,
Pgno
);

9867 #ià
defšed
(
SQLITE_HAS_CODEC
è&& !defšed(
SQLITE_OMIT_WAL
)

9868 
SQLITE_PRIVATE
 *
sql™e3Pag”Codec
(
DbPage
 *);

9872 #ià!
defšed
(
NDEBUG
è|| defšed(
SQLITE_TEST
)

9873 
SQLITE_PRIVATE
 
Pgno
 
sql™e3Pag”Pag’umb”
(
DbPage
*);

9874 
SQLITE_PRIVATE
 
sql™e3Pag”Iswr™—bË
(
DbPage
*);

9876 #ifdeà
SQLITE_TEST


9877 
SQLITE_PRIVATE
 *
sql™e3Pag”Sts
(
Pag”
*);

9878 
SQLITE_PRIVATE
 
sql™e3Pag”Refdump
(
Pag”
*);

9879 
di§bË_simuÏ‹d_io_”rÜs
();

9880 
’abË_simuÏ‹d_io_”rÜs
();

9882 
	#di§bË_simuÏ‹d_io_”rÜs
()

	)

9883 
	#’abË_simuÏ‹d_io_”rÜs
()

	)

9907 #iâdeà
_PCACHE_H_


9909 
PgHdr
 
	tPgHdr
;

9910 
PCache
 
	tPCache
;

9916 
	sPgHdr
 {

9917 
sql™e3_pÿche_·ge
 *
pPage
;

9918 *
pD©a
;

9919 *
pExŒa
;

9920 
PgHdr
 *
pDœty
;

9921 
Pag”
 *
pPag”
;

9922 
Pgno
 
pgno
;

9923 #ifdeà
SQLITE_CHECK_PAGES


9924 
u32
 
·geHash
;

9926 
u16
 
æags
;

9932 
i16
 
nRef
;

9933 
PCache
 *
pCache
;

9935 
PgHdr
 *
pDœtyNext
;

9936 
PgHdr
 *
pDœtyP»v
;

9940 
	#PGHDR_DIRTY
 0x002

	)

9941 
	#PGHDR_NEED_SYNC
 0x004

	)

9943 
	#PGHDR_NEED_READ
 0x008

	)

9944 
	#PGHDR_REUSE_UNLIKELY
 0x010

	)

9945 
	#PGHDR_DONT_WRITE
 0x020

	)

9947 
	#PGHDR_MMAP
 0x040

	)

9950 
SQLITE_PRIVATE
 
sql™e3PÿcheIn™Ÿlize
();

9951 
SQLITE_PRIVATE
 
sql™e3PÿcheShutdown
();

9956 
SQLITE_PRIVATE
 
sql™e3PCacheBufãrS‘up
(*, 
sz
, 
n
);

9962 
SQLITE_PRIVATE
 
sql™e3PÿcheO³n
(

9963 
szPage
,

9964 
szExŒa
,

9965 
bPurg—bË
,

9966 (*
xSŒess
)(*, 
PgHdr
*),

9967 *
pSŒess
,

9968 
PCache
 *
pToIn™


9972 
SQLITE_PRIVATE
 
sql™e3PÿcheS‘PageSize
(
PCache
 *, );

9977 
SQLITE_PRIVATE
 
sql™e3PÿcheSize
();

9982 
SQLITE_PRIVATE
 
sql™e3_pÿche_·ge
 *
sql™e3PÿcheF‘ch
(
PCache
*, 
Pgno
, 
ü—‹FÏg
);

9983 
SQLITE_PRIVATE
 
sql™e3PÿcheF‘chSŒess
(
PCache
*, 
Pgno
, 
sql™e3_pÿche_·ge
**);

9984 
SQLITE_PRIVATE
 
PgHdr
 *
sql™e3PÿcheF‘chFšish
(
PCache
*, 
Pgno
, 
sql™e3_pÿche_·ge
 *
pPage
);

9985 
SQLITE_PRIVATE
 
sql™e3PÿcheR–—£
(
PgHdr
*);

9987 
SQLITE_PRIVATE
 
sql™e3PÿcheDrÝ
(
PgHdr
*);

9988 
SQLITE_PRIVATE
 
sql™e3PÿcheMakeDœty
(
PgHdr
*);

9989 
SQLITE_PRIVATE
 
sql™e3PÿcheMakeCËª
(
PgHdr
*);

9990 
SQLITE_PRIVATE
 
sql™e3PÿcheCËªAÎ
(
PCache
*);

9993 
SQLITE_PRIVATE
 
sql™e3PÿcheMove
(
PgHdr
*, 
Pgno
);

9996 
SQLITE_PRIVATE
 
sql™e3PÿcheTrunÿ‹
(
PCache
*, 
Pgno
 
x
);

9999 
SQLITE_PRIVATE
 
PgHdr
 *
sql™e3PÿcheDœtyLi¡
(
PCache
*);

10002 
SQLITE_PRIVATE
 
sql™e3PÿcheClo£
(
PCache
*);

10005 
SQLITE_PRIVATE
 
sql™e3PÿcheCË¬SyncFÏgs
(
PCache
 *);

10008 
SQLITE_PRIVATE
 
sql™e3PÿcheCË¬
(
PCache
*);

10011 
SQLITE_PRIVATE
 
sql™e3PÿcheRefCouÁ
(
PCache
*);

10014 
SQLITE_PRIVATE
 
sql™e3PÿcheRef
(
PgHdr
*);

10016 
SQLITE_PRIVATE
 
sql™e3PÿchePageRefcouÁ
(
PgHdr
*);

10019 
SQLITE_PRIVATE
 
sql™e3PÿchePagecouÁ
(
PCache
*);

10021 #ià
defšed
(
SQLITE_CHECK_PAGES
è|| defšed(
SQLITE_DEBUG
)

10026 
SQLITE_PRIVATE
 
sql™e3PÿcheI‹¿‹Dœty
(
PCache
 *
pCache
, (*
xI‹r
)(
PgHdr
 *));

10035 
SQLITE_PRIVATE
 
sql™e3PÿcheS‘Cachesize
(
PCache
 *, );

10036 #ifdeà
SQLITE_TEST


10037 
SQLITE_PRIVATE
 
sql™e3PÿcheG‘Cachesize
(
PCache
 *);

10041 
SQLITE_PRIVATE
 
sql™e3PÿcheShršk
(
PCache
*);

10043 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


10045 
SQLITE_PRIVATE
 
sql™e3PÿcheR–—£MemÜy
();

10048 #ifdeà
SQLITE_TEST


10049 
SQLITE_PRIVATE
 
sql™e3PÿcheSts
(*,*,*,*);

10052 
SQLITE_PRIVATE
 
sql™e3PCacheS‘DeçuÉ
();

10080 #iâdeà
_SQLITE_OS_H_


10081 
	#_SQLITE_OS_H_


	)

10104 #iâdeà
_OS_SETUP_H_


10105 
	#_OS_SETUP_H_


	)

10115 #ià
defšed
(
SQLITE_OS_OTHER
)

10116 #ià
SQLITE_OS_OTHER
==1

10117 #undeà
SQLITE_OS_UNIX


10118 
	#SQLITE_OS_UNIX
 0

	)

10119 #undeà
SQLITE_OS_WIN


10120 
	#SQLITE_OS_WIN
 0

	)

10122 #undeà
SQLITE_OS_OTHER


10125 #ià!
defšed
(
SQLITE_OS_UNIX
è&& !defšed(
SQLITE_OS_OTHER
)

10126 
	#SQLITE_OS_OTHER
 0

	)

10127 #iâdeà
SQLITE_OS_WIN


10128 #ià
defšed
(
_WIN32
è|| defšed(
WIN32
è|| defšed(
__CYGWIN__
) || \

10129 
defšed
(
__MINGW32__
è|| defšed(
__BORLANDC__
)

10130 
	#SQLITE_OS_WIN
 1

	)

10131 
	#SQLITE_OS_UNIX
 0

	)

10133 
	#SQLITE_OS_WIN
 0

	)

10134 
	#SQLITE_OS_UNIX
 1

	)

10137 
	#SQLITE_OS_UNIX
 0

	)

10140 #iâdeà
SQLITE_OS_WIN


10141 
	#SQLITE_OS_WIN
 0

	)

10153 #iâdeà
SET_FULLSYNC


10154 
	#SET_FULLSYNC
(
x
,
y
)

	)

10160 #iâdeà
SQLITE_DEFAULT_SECTOR_SIZE


10161 
	#SQLITE_DEFAULT_SECTOR_SIZE
 4096

	)

10185 #iâdeà
SQLITE_TEMP_FILE_PREFIX


10186 
	#SQLITE_TEMP_FILE_PREFIX
 "‘žqs_"

	)

10206 
	#NO_LOCK
 0

	)

10207 
	#SHARED_LOCK
 1

	)

10208 
	#RESERVED_LOCK
 2

	)

10209 
	#PENDING_LOCK
 3

	)

10210 
	#EXCLUSIVE_LOCK
 4

	)

10267 #ifdeà
SQLITE_OMIT_WSD


10268 
	#PENDING_BYTE
 (0x40000000)

	)

10270 
	#PENDING_BYTE
 
sql™e3P’dšgBy‹


	)

10272 
	#RESERVED_BYTE
 (
PENDING_BYTE
+1)

	)

10273 
	#SHARED_FIRST
 (
PENDING_BYTE
+2)

	)

10274 
	#SHARED_SIZE
 510

	)

10279 
SQLITE_PRIVATE
 
sql™e3OsIn™
();

10284 
SQLITE_PRIVATE
 
sql™e3OsClo£
(
sql™e3_fže
*);

10285 
SQLITE_PRIVATE
 
sql™e3OsR—d
(
sql™e3_fže
*, *, 
amt
, 
i64
 
off£t
);

10286 
SQLITE_PRIVATE
 
sql™e3OsWr™e
(
sql™e3_fže
*, cÚ¡ *, 
amt
, 
i64
 
off£t
);

10287 
SQLITE_PRIVATE
 
sql™e3OsTrunÿ‹
(
sql™e3_fže
*, 
i64
 
size
);

10288 
SQLITE_PRIVATE
 
sql™e3OsSync
(
sql™e3_fže
*, );

10289 
SQLITE_PRIVATE
 
sql™e3OsFžeSize
(
sql™e3_fže
*, 
i64
 *
pSize
);

10290 
SQLITE_PRIVATE
 
sql™e3OsLock
(
sql™e3_fže
*, );

10291 
SQLITE_PRIVATE
 
sql™e3OsUÆock
(
sql™e3_fže
*, );

10292 
SQLITE_PRIVATE
 
sql™e3OsCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
);

10293 
SQLITE_PRIVATE
 
sql™e3OsFžeCÚŒÞ
(
sql™e3_fže
*,,*);

10294 
SQLITE_PRIVATE
 
sql™e3OsFžeCÚŒÞHšt
(
sql™e3_fže
*,,*);

10295 
	#SQLITE_FCNTL_DB_UNCHANGED
 0xÿ093ç0

	)

10296 
SQLITE_PRIVATE
 
sql™e3OsSeùÜSize
(
sql™e3_fže
 *
id
);

10297 
SQLITE_PRIVATE
 
sql™e3OsDeviûCh¬aù”i¡ics
(
sql™e3_fže
 *
id
);

10298 
SQLITE_PRIVATE
 
sql™e3OsShmM­
(
sql™e3_fže
 *,,,,volatile **);

10299 
SQLITE_PRIVATE
 
sql™e3OsShmLock
(
sql™e3_fže
 *
id
, , , );

10300 
SQLITE_PRIVATE
 
sql™e3OsShmB¬r›r
(
sql™e3_fže
 *
id
);

10301 
SQLITE_PRIVATE
 
sql™e3OsShmUnm­
(
sql™e3_fže
 *
id
, );

10302 
SQLITE_PRIVATE
 
sql™e3OsF‘ch
(
sql™e3_fže
 *
id
, 
i64
, , **);

10303 
SQLITE_PRIVATE
 
sql™e3OsUnãtch
(
sql™e3_fže
 *, 
i64
, *);

10309 
SQLITE_PRIVATE
 
sql™e3OsO³n
(
sql™e3_vfs
 *, cÚ¡ *, 
sql™e3_fže
*, , *);

10310 
SQLITE_PRIVATE
 
sql™e3OsD–‘e
(
sql™e3_vfs
 *, const *, );

10311 
SQLITE_PRIVATE
 
sql™e3OsAcûss
(
sql™e3_vfs
 *, cÚ¡ *, , *
pResOut
);

10312 
SQLITE_PRIVATE
 
sql™e3OsFuÎP©hÇme
(
sql™e3_vfs
 *, const *, , *);

10313 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


10314 
SQLITE_PRIVATE
 *
sql™e3OsDlO³n
(
sql™e3_vfs
 *, const *);

10315 
SQLITE_PRIVATE
 
sql™e3OsDlE¼Ü
(
sql™e3_vfs
 *, , *);

10316 
SQLITE_PRIVATE
 (*
sql™e3OsDlSym
(
sql™e3_vfs
 *, *, const *))();

10317 
SQLITE_PRIVATE
 
sql™e3OsDlClo£
(
sql™e3_vfs
 *, *);

10319 
SQLITE_PRIVATE
 
sql™e3OsRªdomÃss
(
sql™e3_vfs
 *, , *);

10320 
SQLITE_PRIVATE
 
sql™e3OsSË•
(
sql™e3_vfs
 *, );

10321 
SQLITE_PRIVATE
 
sql™e3OsCu¼’tTimeIÁ64
(
sql™e3_vfs
 *, 
sql™e3_št64
*);

10327 
SQLITE_PRIVATE
 
sql™e3OsO³nM®loc
(
sql™e3_vfs
 *, cÚ¡ *, 
sql™e3_fže
 **, ,*);

10328 
SQLITE_PRIVATE
 
sql™e3OsClo£F»e
(
sql™e3_fže
 *);

10375 #ià!
SQLITE_THREADSAFE


10376 
	#SQLITE_MUTEX_OMIT


	)

10378 #ià
SQLITE_THREADSAFE
 && !
defšed
(
SQLITE_MUTEX_NOOP
)

10379 #ià
SQLITE_OS_UNIX


10380 
	#SQLITE_MUTEX_PTHREADS


	)

10381 #–ià
SQLITE_OS_WIN


10382 
	#SQLITE_MUTEX_W32


	)

10384 
	#SQLITE_MUTEX_NOOP


	)

10388 #ifdeà
SQLITE_MUTEX_OMIT


10392 
	#sql™e3_mu‹x_®loc
(
X
è((
sql™e3_mu‹x
*)8)

	)

10393 
	#sql™e3_mu‹x_ä“
(
X
)

	)

10394 
	#sql™e3_mu‹x_’‹r
(
X
)

	)

10395 
	#sql™e3_mu‹x_Œy
(
X
è
SQLITE_OK


	)

10396 
	#sql™e3_mu‹x_Ëave
(
X
)

	)

10397 
	#sql™e3_mu‹x_h–d
(
X
è(()(X),1)

	)

10398 
	#sql™e3_mu‹x_nÙh–d
(
X
è(()(X),1)

	)

10399 
	#sql™e3Mu‹xAÎoc
(
X
è((
sql™e3_mu‹x
*)8)

	)

10400 
	#sql™e3Mu‹xIn™
(è
SQLITE_OK


	)

10401 
	#sql™e3Mu‹xEnd
()

	)

10402 
	#MUTEX_LOGIC
(
X
)

	)

10404 
	#MUTEX_LOGIC
(
X
è
	)
X

10418 
	sDb
 {

10419 *
zName
;

10420 
BŒ“
 *
pBt
;

10421 
u8
 
§ãty_Ëv–
;

10422 
Schema
 *
pSchema
;

10442 
	sSchema
 {

10443 
schema_cook›
;

10444 
iG’”©iÚ
;

10445 
Hash
 
tblHash
;

10446 
Hash
 
idxHash
;

10447 
Hash
 
ŒigHash
;

10448 
Hash
 
fkeyHash
;

10449 
TabË
 *
pSeqTab
;

10450 
u8
 
fže_fÜm©
;

10451 
u8
 
’c
;

10452 
u16
 
schemaFÏgs
;

10453 
ÿche_size
;

10460 
	#DbHasPrÝ”ty
(
D
,
I
,
P
è(((D)->
aDb
[I].
pSchema
->
schemaFÏgs
&(P))==(P))

	)

10461 
	#DbHasAnyPrÝ”ty
(
D
,
I
,
P
è(((D)->
aDb
[I].
pSchema
->
schemaFÏgs
&(P))!=0)

	)

10462 
	#DbS‘PrÝ”ty
(
D
,
I
,
P
è(D)->
aDb
[I].
pSchema
->
schemaFÏgs
|=(P)

	)

10463 
	#DbCË¬PrÝ”ty
(
D
,
I
,
P
è(D)->
aDb
[I].
pSchema
->
schemaFÏgs
&=~(P)

	)

10475 
	#DB_SchemaLßded
 0x0001

	)

10476 
	#DB_UÄe£tV›ws
 0x0002

	)

10477 
	#DB_Em±y
 0x0004

	)

10483 
	#SQLITE_N_LIMIT
 (
SQLITE_LIMIT_WORKER_THREADS
+1)

	)

10505 
	sLookaside
 {

10506 
u16
 
sz
;

10507 
u8
 
bEÇbËd
;

10508 
u8
 
bM®loûd
;

10509 
nOut
;

10510 
mxOut
;

10511 
ªSt
[3];

10512 
LookasideSlÙ
 *
pF»e
;

10513 *
pS¹
;

10514 *
pEnd
;

10516 
	sLookasideSlÙ
 {

10517 
LookasideSlÙ
 *
pNext
;

10526 
	sFuncDefHash
 {

10527 
FuncDef
 *
a
[23];

10530 #ifdeà
SQLITE_USER_AUTHENTICATION


10535 
sql™e3_u£¿uth
 
	tsql™e3_u£¿uth
;

10536 
	ssql™e3_u£¿uth
 {

10537 
u8
 
authLev–
;

10538 
nAuthPW
;

10539 *
zAuthPW
;

10540 *
zAuthU£r
;

10544 
	#UAUTH_Unknown
 0

	)

10545 
	#UAUTH_Faž
 1

	)

10546 
	#UAUTH_U£r
 2

	)

10547 
	#UAUTH_Admš
 3

	)

10550 
SQLITE_PRIVATE
 
sql™e3U£rAuthTabË
(const *);

10551 
SQLITE_PRIVATE
 
sql™e3U£rAuthCheckLogš
(
sql™e3
*,cÚ¡ *,
u8
*);

10552 
SQLITE_PRIVATE
 
sql™e3U£rAuthIn™
(
sql™e3
*);

10553 
SQLITE_PRIVATE
 
sql™e3Cry±Func
(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**);

10560 #ifdeà
SQLITE_USER_AUTHENTICATION


10561 (*
sql™e3_xauth
)(*,,const *,const *,const *,

10564 (*
sql™e3_xauth
)(*,,const *,const *,const *,

10572 
	ssql™e3
 {

10573 
sql™e3_vfs
 *
pVfs
;

10574 
Vdbe
 *
pVdbe
;

10575 
CÞlSeq
 *
pDætCÞl
;

10576 
sql™e3_mu‹x
 *
mu‹x
;

10577 
Db
 *
aDb
;

10578 
nDb
;

10579 
æags
;

10580 
i64
 
Ï¡Rowid
;

10581 
i64
 
szMm­
;

10582 
Ý’FÏgs
;

10583 
”rCode
;

10584 
”rMask
;

10585 
u16
 
dbO±FÏgs
;

10586 
u8
 
autoComm™
;

10587 
u8
 
‹mp_¡Üe
;

10588 
u8
 
m®locFažed
;

10589 
u8
 
dætLockMode
;

10590 sigÃd 
ÃxtAutovac
;

10591 
u8
 
suµ»ssE¼
;

10592 
u8
 
vbOnCÚæiù
;

10593 
u8
 
isT¿n§ùiÚSav•ošt
;

10594 
ÃxtPagesize
;

10595 
u32
 
magic
;

10596 
nChªge
;

10597 
nTÙ®Chªge
;

10598 
aLim™
[
SQLITE_N_LIMIT
];

10599 
nMaxSÜ‹rMm­
;

10600 
	ssql™e3In™Info
 {

10601 
ÃwTnum
;

10602 
u8
 
iDb
;

10603 
u8
 
busy
;

10604 
u8
 
ÜphªTrigg”
;

10605 } 
š™
;

10606 
nVdbeAùive
;

10607 
nVdbeR—d
;

10608 
nVdbeWr™e
;

10609 
nVdbeExec
;

10610 
nEx‹nsiÚ
;

10611 **
aEx‹nsiÚ
;

10612 (*
xT¿û
)(*,const *);

10613 *
pT¿ûArg
;

10614 (*
xProfže
)(*,cÚ¡ *,
u64
);

10615 *
pProfžeArg
;

10616 *
pComm™Arg
;

10617 (*
xComm™C®lback
)(*);

10618 *
pRÞlbackArg
;

10619 (*
xRÞlbackC®lback
)(*);

10620 *
pUpd©eArg
;

10621 (*
xUpd©eC®lback
)(*,, cÚ¡ *,cÚ¡ *,
sql™e_št64
);

10622 #iâdeà
SQLITE_OMIT_WAL


10623 (*
xW®C®lback
)(*, 
sql™e3
 *, const *, );

10624 *
pW®Arg
;

10626 (*
xCÞlN“ded
)(*,
sql™e3
*,
eTextR•
,const *);

10627 (*
xCÞlN“ded16
)(*,
sql™e3
*,
eTextR•
,const *);

10628 *
pCÞlN“dedArg
;

10629 
sql™e3_v®ue
 *
pE¼
;

10631 vÞ©ž
isIÁ”ru±ed
;

10632 
nÙU£d1
;

10633 } 
u1
;

10634 
Lookaside
 
lookaside
;

10635 #iâdeà
SQLITE_OMIT_AUTHORIZATION


10636 
sql™e3_xauth
 
xAuth
;

10637 *
pAuthArg
;

10639 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


10640 (*
xProg»ss
)(*);

10641 *
pProg»ssArg
;

10642 
nProg»ssOps
;

10644 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


10645 
nVT¿ns
;

10646 
Hash
 
aModuË
;

10647 
VbCtx
 *
pVbCtx
;

10648 
VTabË
 **
aVT¿ns
;

10649 
VTabË
 *
pDiscÚÃù
;

10651 
FuncDefHash
 
aFunc
;

10652 
Hash
 
aCÞlSeq
;

10653 
BusyHªdËr
 
busyHªdËr
;

10654 
Db
 
aDbStic
[2];

10655 
Sav•ošt
 *
pSav•ošt
;

10656 
busyTimeout
;

10657 
nSav•ošt
;

10658 
nS‹m’t
;

10659 
i64
 
nDeã¼edCÚs
;

10660 
i64
 
nDeã¼edImmCÚs
;

10661 *
²By‹sF»ed
;

10662 #ifdeà
SQLITE_ENABLE_UNLOCK_NOTIFY


10673 
sql™e3
 *
pBlockšgCÚÃùiÚ
;

10674 
sql™e3
 *
pUÆockCÚÃùiÚ
;

10675 *
pUÆockArg
;

10676 (*
xUÆockNÙify
)(**, );

10677 
sql™e3
 *
pNextBlocked
;

10679 #ifdeà
SQLITE_USER_AUTHENTICATION


10680 
sql™e3_u£¿uth
 
auth
;

10687 
	#ENC
(
db
è((db)->
aDb
[0].
pSchema
->
’c
)

	)

10692 
	#SQLITE_VdbeT¿û
 0x00000001

	)

10693 
	#SQLITE_IÁ”nChªges
 0x00000002

	)

10694 
	#SQLITE_FuÎFSync
 0x00000004

	)

10695 
	#SQLITE_Ck±FuÎFSync
 0x00000008

	)

10696 
	#SQLITE_CacheSpžl
 0x00000010

	)

10697 
	#SQLITE_FuÎCÞNames
 0x00000020

	)

10698 
	#SQLITE_ShÜtCÞNames
 0x00000040

	)

10699 
	#SQLITE_CouÁRows
 0x00000080

	)

10702 
	#SQLITE_NuÎC®lback
 0x00000100

	)

10704 
	#SQLITE_SqlT¿û
 0x00000200

	)

10705 
	#SQLITE_VdbeLi¡šg
 0x00000400

	)

10706 
	#SQLITE_Wr™eSchema
 0x00000800

	)

10707 
	#SQLITE_VdbeAddÝT¿û
 0x00001000

	)

10708 
	#SQLITE_IgnÜeChecks
 0x00002000

	)

10709 
	#SQLITE_R—dUncomm™‹d
 0x0004000

	)

10710 
	#SQLITE_LegacyFžeFmt
 0x00008000

	)

10711 
	#SQLITE_Recov”yMode
 0x00010000

	)

10712 
	#SQLITE_Rev”£Ord”
 0x00020000

	)

10713 
	#SQLITE_RecTrigg”s
 0x00040000

	)

10714 
	#SQLITE_FÜeignKeys
 0x00080000

	)

10715 
	#SQLITE_AutoIndex
 0x00100000

	)

10716 
	#SQLITE_P»ãrBužtš
 0x00200000

	)

10717 
	#SQLITE_LßdEx‹nsiÚ
 0x00400000

	)

10718 
	#SQLITE_EÇbËTrigg”
 0x00800000

	)

10719 
	#SQLITE_DeãrFKs
 0x01000000

	)

10720 
	#SQLITE_Qu”yOÆy
 0x02000000

	)

10721 
	#SQLITE_VdbeEQP
 0x04000000

	)

10729 
	#SQLITE_Qu”yFÏ‰’”
 0x0001

	)

10730 
	#SQLITE_CÞumnCache
 0x0002

	)

10731 
	#SQLITE_GroupByOrd”
 0x0004

	)

10732 
	#SQLITE_FaùÜOutCÚ¡
 0x0008

	)

10734 
	#SQLITE_Di¡šùO±
 0x0020

	)

10735 
	#SQLITE_Cov”IdxSÿn
 0x0040

	)

10736 
	#SQLITE_Ord”ByIdxJoš
 0x0080

	)

10737 
	#SQLITE_SubqCÜoutše
 0x0100

	)

10738 
	#SQLITE_T¿ns™ive
 0x0200

	)

10739 
	#SQLITE_Om™NoÝJoš
 0x0400

	)

10740 
	#SQLITE_St3
 0x0800

	)

10741 
	#SQLITE_AÎO±s
 0xfffà

	)

10746 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


10747 
	#O±imiz©iÚDi§bËd
(
db
, 
mask
è(((db)->
dbO±FÏgs
&(mask))!=0)

	)

10748 
	#O±imiz©iÚEÇbËd
(
db
, 
mask
è(((db)->
dbO±FÏgs
&(mask))==0)

	)

10750 
	#O±imiz©iÚDi§bËd
(
db
, 
mask
è0

	)

10751 
	#O±imiz©iÚEÇbËd
(
db
, 
mask
è1

	)

10758 
	#CÚ¡FaùÜOk
(
P
è((P)->
okCÚ¡FaùÜ
)

	)

10765 
	#SQLITE_MAGIC_OPEN
 0xa029a697

	)

10766 
	#SQLITE_MAGIC_CLOSED
 0x9f3c2d33

	)

10767 
	#SQLITE_MAGIC_SICK
 0x4b771290

	)

10768 
	#SQLITE_MAGIC_BUSY
 0xf03b7906

	)

10769 
	#SQLITE_MAGIC_ERROR
 0xb5357930

	)

10770 
	#SQLITE_MAGIC_ZOMBIE
 0x64cffc7à

	)

10778 
	sFuncDef
 {

10779 
i16
 
nArg
;

10780 
u16
 
funcFÏgs
;

10781 *
pU£rD©a
;

10782 
FuncDef
 *
pNext
;

10783 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**);

10784 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**);

10785 (*
xFš®ize
)(
sql™e3_cÚ‹xt
*);

10786 *
zName
;

10787 
FuncDef
 *
pHash
;

10788 
FuncDe¡ruùÜ
 *
pDe¡ruùÜ
;

10805 
	sFuncDe¡ruùÜ
 {

10806 
nRef
;

10807 (*
xDe¡roy
)(*);

10808 *
pU£rD©a
;

10816 
	#SQLITE_FUNC_ENCMASK
 0x003

	)

10817 
	#SQLITE_FUNC_LIKE
 0x004

	)

10818 
	#SQLITE_FUNC_CASE
 0x008

	)

10819 
	#SQLITE_FUNC_EPHEM
 0x010

	)

10820 
	#SQLITE_FUNC_NEEDCOLL
 0x020

	)

10821 
	#SQLITE_FUNC_LENGTH
 0x040

	)

10822 
	#SQLITE_FUNC_TYPEOF
 0x080

	)

10823 
	#SQLITE_FUNC_COUNT
 0x100

	)

10824 
	#SQLITE_FUNC_COALESCE
 0x200

	)

10825 
	#SQLITE_FUNC_UNLIKELY
 0x400

	)

10826 
	#SQLITE_FUNC_CONSTANT
 0x800

	)

10827 
	#SQLITE_FUNC_MINMAX
 0x1000

	)

10857 
	#FUNCTION
(
zName
, 
nArg
, 
iArg
, 
bNC
, 
xFunc
) \

10858 {
nArg
, 
SQLITE_FUNC_CONSTANT
|
SQLITE_UTF8
|(
bNC
*
SQLITE_FUNC_NEEDCOLL
), \

10859 
	`SQLITE_INT_TO_PTR
(
iArg
), 0, 
xFunc
, 0, 0, #zName, 0, 0}

	)

10860 
	#VFUNCTION
(
zName
, 
nArg
, 
iArg
, 
bNC
, 
xFunc
) \

10861 {
nArg
, 
SQLITE_UTF8
|(
bNC
*
SQLITE_FUNC_NEEDCOLL
), \

10862 
	`SQLITE_INT_TO_PTR
(
iArg
), 0, 
xFunc
, 0, 0, #zName, 0, 0}

	)

10863 
	#FUNCTION2
(
zName
, 
nArg
, 
iArg
, 
bNC
, 
xFunc
, 
exŒaFÏgs
) \

10864 {
nArg
,
SQLITE_FUNC_CONSTANT
|
SQLITE_UTF8
|(
bNC
*
SQLITE_FUNC_NEEDCOLL
)|
exŒaFÏgs
,\

10865 
	`SQLITE_INT_TO_PTR
(
iArg
), 0, 
xFunc
, 0, 0, #zName, 0, 0}

	)

10866 
	#STR_FUNCTION
(
zName
, 
nArg
, 
pArg
, 
bNC
, 
xFunc
) \

10867 {
nArg
, 
SQLITE_FUNC_CONSTANT
|
SQLITE_UTF8
|(
bNC
*
SQLITE_FUNC_NEEDCOLL
), \

10868 
pArg
, 0, 
xFunc
, 0, 0, #zName, 0, 0}

	)

10869 
	#LIKEFUNC
(
zName
, 
nArg
, 
¬g
, 
æags
) \

10870 {
nArg
, 
SQLITE_FUNC_CONSTANT
|
SQLITE_UTF8
|
æags
, \

10871 (*)
¬g
, 0, 
likeFunc
, 0, 0, #zName, 0, 0}

	)

10872 
	#AGGREGATE
(
zName
, 
nArg
, 
¬g
, 
nc
, 
xS‹p
, 
xFš®
) \

10873 {
nArg
, 
SQLITE_UTF8
|(
nc
*
SQLITE_FUNC_NEEDCOLL
), \

10874 
	`SQLITE_INT_TO_PTR
(
¬g
), 0, 0, 
xS‹p
,
xFš®
,#zName,0,0}

	)

10875 
	#AGGREGATE2
(
zName
, 
nArg
, 
¬g
, 
nc
, 
xS‹p
, 
xFš®
, 
exŒaFÏgs
) \

10876 {
nArg
, 
SQLITE_UTF8
|(
nc
*
SQLITE_FUNC_NEEDCOLL
)|
exŒaFÏgs
, \

10877 
	`SQLITE_INT_TO_PTR
(
¬g
), 0, 0, 
xS‹p
,
xFš®
,#zName,0,0}

	)

10885 
	sSav•ošt
 {

10886 *
zName
;

10887 
i64
 
nDeã¼edCÚs
;

10888 
i64
 
nDeã¼edImmCÚs
;

10889 
Sav•ošt
 *
pNext
;

10896 
	#SAVEPOINT_BEGIN
 0

	)

10897 
	#SAVEPOINT_RELEASE
 1

	)

10898 
	#SAVEPOINT_ROLLBACK
 2

	)

10906 
	sModuË
 {

10907 cÚ¡ 
sql™e3_moduË
 *
pModuË
;

10908 cÚ¡ *
zName
;

10909 *
pAux
;

10910 (*
xDe¡roy
)(*);

10917 
	sCÞumn
 {

10918 *
zName
;

10919 
Ex´
 *
pDæt
;

10920 *
zDæt
;

10921 *
zTy³
;

10922 *
zCÞl
;

10923 
u8
 
nÙNuÎ
;

10924 
affš™y
;

10925 
u8
 
szE¡
;

10926 
u8
 
cÞFÏgs
;

10931 
	#COLFLAG_PRIMKEY
 0x0001

	)

10932 
	#COLFLAG_HIDDEN
 0x0002

	)

10943 
	sCÞlSeq
 {

10944 *
zName
;

10945 
u8
 
’c
;

10946 *
pU£r
;

10947 (*
xCmp
)(*,, const *, , const *);

10948 (*
xD–
)(*);

10954 
	#SQLITE_SO_ASC
 0

	)

10955 
	#SQLITE_SO_DESC
 1

	)

10971 
	#SQLITE_AFF_NONE
 'A'

	)

10972 
	#SQLITE_AFF_TEXT
 'B'

	)

10973 
	#SQLITE_AFF_NUMERIC
 'C'

	)

10974 
	#SQLITE_AFF_INTEGER
 'D'

	)

10975 
	#SQLITE_AFF_REAL
 'E'

	)

10977 
	#sql™e3IsNum”icAffš™y
(
X
è((X)>=
SQLITE_AFF_NUMERIC
)

	)

10983 
	#SQLITE_AFF_MASK
 0x47

	)

10994 
	#SQLITE_JUMPIFNULL
 0x10

	)

10995 
	#SQLITE_STOREP2
 0x20

	)

10996 
	#SQLITE_NULLEQ
 0x80

	)

10997 
	#SQLITE_NOTNULL
 0x90

	)

11041 
	sVTabË
 {

11042 
sql™e3
 *
db
;

11043 
ModuË
 *
pMod
;

11044 
sql™e3_vb
 *
pVb
;

11045 
nRef
;

11046 
u8
 
bCÚ¡¿št
;

11047 
iSav•ošt
;

11048 
VTabË
 *
pNext
;

11081 
	sTabË
 {

11082 *
zName
;

11083 
CÞumn
 *
aCÞ
;

11084 
Index
 *
pIndex
;

11085 
S–eù
 *
pS–eù
;

11086 
FKey
 *
pFKey
;

11087 *
zCÞAff
;

11088 #iâdeà
SQLITE_OMIT_CHECK


11089 
Ex´Li¡
 *
pCheck
;

11091 
LogE¡
 
nRowLogE¡
;

11092 
Šum
;

11093 
i16
 
iPKey
;

11094 
i16
 
nCÞ
;

11095 
u16
 
nRef
;

11096 
LogE¡
 
szTabRow
;

11097 #ifdeà
SQLITE_ENABLE_COSTMULT


11098 
LogE¡
 
co¡MuÉ
;

11100 
u8
 
bFÏgs
;

11101 
u8
 
keyCÚf
;

11102 #iâdeà
SQLITE_OMIT_ALTERTABLE


11103 
addCÞOff£t
;

11105 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


11106 
nModuËArg
;

11107 **
azModuËArg
;

11108 
VTabË
 *
pVTabË
;

11110 
Trigg”
 *
pTrigg”
;

11111 
Schema
 *
pSchema
;

11112 
TabË
 *
pNextZomb›
;

11118 
	#TF_R—dÚly
 0x01

	)

11119 
	#TF_Ephem”®
 0x02

	)

11120 
	#TF_HasPrim¬yKey
 0x04

	)

11121 
	#TF_Autošüem’t
 0x08

	)

11122 
	#TF_Vœtu®
 0x10

	)

11123 
	#TF_W™houtRowid
 0x20

	)

11131 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


11132 
	#IsVœtu®
(
X
è(((X)->
bFÏgs
 & 
TF_Vœtu®
)!=0)

	)

11133 
	#IsHidd’CÞumn
(
X
è(((X)->
cÞFÏgs
 & 
COLFLAG_HIDDEN
)!=0)

	)

11135 
	#IsVœtu®
(
X
è0

	)

11136 
	#IsHidd’CÞumn
(
X
è0

	)

11140 
	#HasRowid
(
X
è(((X)->
bFÏgs
 & 
TF_W™houtRowid
)==0)

	)

11170 
	sFKey
 {

11171 
TabË
 *
pFrom
;

11172 
FKey
 *
pNextFrom
;

11173 *
zTo
;

11174 
FKey
 *
pNextTo
;

11175 
FKey
 *
pP»vTo
;

11176 
nCÞ
;

11178 
u8
 
isDeã¼ed
;

11179 
u8
 
aAùiÚ
[2];

11180 
Trigg”
 *
­Trigg”
[2];

11181 
	ssCÞM­
 {

11182 
iFrom
;

11183 *
zCÞ
;

11184 } 
aCÞ
[1];

11212 
	#OE_NÚe
 0

	)

11213 
	#OE_RÞlback
 1

	)

11214 
	#OE_AbÜt
 2

	)

11215 
	#OE_Faž
 3

	)

11216 
	#OE_IgnÜe
 4

	)

11217 
	#OE_R•Ïû
 5

	)

11219 
	#OE_Re¡riù
 6

	)

11220 
	#OE_S‘NuÎ
 7

	)

11221 
	#OE_S‘Dæt
 8

	)

11222 
	#OE_Casÿde
 9

	)

11224 
	#OE_DeçuÉ
 10

	)

11236 
	sKeyInfo
 {

11237 
u32
 
nRef
;

11238 
u8
 
’c
;

11239 
u16
 
nF›ld
;

11240 
u16
 
nXF›ld
;

11241 
sql™e3
 *
db
;

11242 
u8
 *
aSÜtOrd”
;

11243 
CÞlSeq
 *
aCÞl
[1];

11263 
	sUÅackedRecÜd
 {

11264 
KeyInfo
 *
pKeyInfo
;

11265 
u16
 
nF›ld
;

11266 
i8
 
deçuÉ_rc
;

11267 
u8
 
”rCode
;

11268 
Mem
 *
aMem
;

11269 
r1
;

11270 
r2
;

11300 
	sIndex
 {

11301 *
zName
;

11302 
i16
 *
aiCÞumn
;

11303 
LogE¡
 *
aiRowLogE¡
;

11304 
TabË
 *
pTabË
;

11305 *
zCÞAff
;

11306 
Index
 *
pNext
;

11307 
Schema
 *
pSchema
;

11308 
u8
 *
aSÜtOrd”
;

11309 **
azCÞl
;

11310 
Ex´
 *
pP¬tIdxWh”e
;

11311 
KeyInfo
 *
pKeyInfo
;

11312 
Šum
;

11313 
LogE¡
 
szIdxRow
;

11314 
u16
 
nKeyCÞ
;

11315 
u16
 
nCÞumn
;

11316 
u8
 
ÚE¼Ü
;

11317 
idxTy³
:2;

11318 
bUnÜd”ed
:1;

11319 
uniqNÙNuÎ
:1;

11320 
isResized
:1;

11321 
isCov”šg
:1;

11322 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


11323 
nSam¶e
;

11324 
nSam¶eCÞ
;

11325 
tRowút
 *
aAvgEq
;

11326 
IndexSam¶e
 *
aSam¶e
;

11327 
tRowút
 *
aiRowE¡
;

11334 
	#SQLITE_IDXTYPE_APPDEF
 0

	)

11335 
	#SQLITE_IDXTYPE_UNIQUE
 1

	)

11336 
	#SQLITE_IDXTYPE_PRIMARYKEY
 2

	)

11339 
	#IsPrim¬yKeyIndex
(
X
è((X)->
idxTy³
==
SQLITE_IDXTYPE_PRIMARYKEY
)

	)

11342 
	#IsUniqueIndex
(
X
è((X)->
ÚE¼Ü
!=
OE_NÚe
)

	)

11349 
	sIndexSam¶e
 {

11350 *
p
;

11351 
n
;

11352 
tRowút
 *
ªEq
;

11353 
tRowút
 *
ªLt
;

11354 
tRowút
 *
ªDLt
;

11365 
	sTok’
 {

11366 cÚ¡ *
z
;

11367 
n
;

11383 
	sAggInfo
 {

11384 
u8
 
dœeùMode
;

11386 
u8
 
u£SÜtšgIdx
;

11388 
sÜtšgIdx
;

11389 
sÜtšgIdxPTab
;

11390 
nSÜtšgCÞumn
;

11391 
mnReg
, 
mxReg
;

11392 
Ex´Li¡
 *
pGroupBy
;

11393 
	sAggInfo_cÞ
 {

11394 
TabË
 *
pTab
;

11395 
iTabË
;

11396 
iCÞumn
;

11397 
iSÜ‹rCÞumn
;

11398 
iMem
;

11399 
Ex´
 *
pEx´
;

11400 } *
aCÞ
;

11401 
nCÞumn
;

11402 
nAccumuÏtÜ
;

11405 
	sAggInfo_func
 {

11406 
Ex´
 *
pEx´
;

11407 
FuncDef
 *
pFunc
;

11408 
iMem
;

11409 
iDi¡šù
;

11410 } *
aFunc
;

11411 
nFunc
;

11424 #ià
SQLITE_MAX_VARIABLE_NUMBER
<=32767

11425 
i16
 
	tynV¬
;

11427 
	tynV¬
;

11493 
	sEx´
 {

11494 
u8
 
Ý
;

11495 
affš™y
;

11496 
u32
 
æags
;

11498 *
zTok’
;

11499 
iV®ue
;

11500 } 
u
;

11507 
Ex´
 *
pLeá
;

11508 
Ex´
 *
pRight
;

11510 
Ex´Li¡
 *
pLi¡
;

11511 
S–eù
 *
pS–eù
;

11512 } 
x
;

11519 #ià
SQLITE_MAX_EXPR_DEPTH
>0

11520 
nHeight
;

11522 
iTabË
;

11526 
ynV¬
 
iCÞumn
;

11528 
i16
 
iAgg
;

11529 
i16
 
iRightJošTabË
;

11530 
u8
 
Ý2
;

11533 
AggInfo
 *
pAggInfo
;

11534 
TabË
 *
pTab
;

11540 
	#EP_FromJoš
 0x000001

	)

11541 
	#EP_Agg
 0x000002

	)

11542 
	#EP_ResÞved
 0x000004

	)

11543 
	#EP_E¼Ü
 0x000008

	)

11544 
	#EP_Di¡šù
 0x000010

	)

11545 
	#EP_V¬S–eù
 0x000020

	)

11546 
	#EP_DblQuÙed
 0x000040

	)

11547 
	#EP_InfixFunc
 0x000080

	)

11548 
	#EP_CÞÏ‹
 0x000100

	)

11549 
	#EP_G’”ic
 0x000200

	)

11550 
	#EP_IÁV®ue
 0x000400

	)

11551 
	#EP_xIsS–eù
 0x000800

	)

11552 
	#EP_Sk
 0x001000

	)

11553 
	#EP_Reduûd
 0x002000

	)

11554 
	#EP_Tok’OÆy
 0x004000

	)

11555 
	#EP_Stic
 0x008000

	)

11556 
	#EP_MemTok’
 0x010000

	)

11557 
	#EP_NoReduû
 0x020000

	)

11558 
	#EP_UÆik–y
 0x040000

	)

11559 
	#EP_CÚ¡ªt
 0x080000

	)

11560 
	#EP_CªBeNuÎ
 0x100000

	)

11566 
	#Ex´HasPrÝ”ty
(
E
,
P
è(((E)->
æags
&(P))!=0)

	)

11567 
	#Ex´HasAÎPrÝ”ty
(
E
,
P
è(((E)->
æags
&(P))==(P))

	)

11568 
	#Ex´S‘PrÝ”ty
(
E
,
P
è(E)->
æags
|=(P)

	)

11569 
	#Ex´CË¬PrÝ”ty
(
E
,
P
è(E)->
æags
&=~(P)

	)

11575 #ifdeà
SQLITE_DEBUG


11576 
	#Ex´S‘VVAPrÝ”ty
(
E
,
P
è(E)->
æags
|=(P)

	)

11578 
	#Ex´S‘VVAPrÝ”ty
(
E
,
P
)

	)

11586 
	#EXPR_FULLSIZE
 (
Ex´
è

	)

11587 
	#EXPR_REDUCEDSIZE
 
	`off£tof
(
Ex´
,
iTabË
è

	)

11588 
	#EXPR_TOKENONLYSIZE
 
	`off£tof
(
Ex´
,
pLeá
è

	)

11594 
	#EXPRDUP_REDUCE
 0x0001

	)

11612 
	sEx´Li¡
 {

11613 
nEx´
;

11614 
	sEx´Li¡_™em
 {

11615 
Ex´
 *
pEx´
;

11616 *
zName
;

11617 *
zS·n
;

11618 
u8
 
sÜtOrd”
;

11619 
dÚe
 :1;

11620 
bS·nIsTab
 :1;

11621 
»u§bË
 :1;

11624 
u16
 
iOrd”ByCÞ
;

11625 
u16
 
iAlŸs
;

11626 } 
x
;

11627 
iCÚ¡Ex´Reg
;

11628 } 
u
;

11629 } *
a
;

11637 
	sEx´S·n
 {

11638 
Ex´
 *
pEx´
;

11639 cÚ¡ *
zS¹
;

11640 cÚ¡ *
zEnd
;

11658 
	sIdLi¡
 {

11659 
	sIdLi¡_™em
 {

11660 *
zName
;

11661 
idx
;

11662 } *
a
;

11663 
nId
;

11673 
u64
 
	tB™mask
;

11678 
	#BMS
 (()((
B™mask
)*8))

	)

11683 
	#MASKBIT
(
n
è(((
B™mask
)1)<<Ò))

	)

11684 
	#MASKBIT32
(
n
è((()1)<<Ò))

	)

11705 
	sSrcLi¡
 {

11706 
nSrc
;

11707 
u32
 
nAÎoc
;

11708 
	sSrcLi¡_™em
 {

11709 
Schema
 *
pSchema
;

11710 *
zD©aba£
;

11711 *
zName
;

11712 *
zAlŸs
;

11713 
TabË
 *
pTab
;

11714 
S–eù
 *
pS–eù
;

11715 
addrFžlSub
;

11716 
»gR‘uº
;

11717 
»gResuÉ
;

11718 
u8
 
jošty³
;

11719 
nÙIndexed
 :1;

11720 
isCÜ»Ï‹d
 :1;

11721 
vŸCÜoutše
 :1;

11722 
isRecursive
 :1;

11723 #iâdeà
SQLITE_OMIT_EXPLAIN


11724 
u8
 
iS–eùId
;

11726 
iCursÜ
;

11727 
Ex´
 *
pOn
;

11728 
IdLi¡
 *
pUsšg
;

11729 
B™mask
 
cÞU£d
;

11730 *
zIndex
;

11731 
Index
 *
pIndex
;

11732 } 
a
[1];

11738 
	#JT_INNER
 0x0001

	)

11739 
	#JT_CROSS
 0x0002

	)

11740 
	#JT_NATURAL
 0x0004

	)

11741 
	#JT_LEFT
 0x0008

	)

11742 
	#JT_RIGHT
 0x0010

	)

11743 
	#JT_OUTER
 0x0020

	)

11744 
	#JT_ERROR
 0x0040

	)

11751 
	#WHERE_ORDERBY_NORMAL
 0x0000

	)

11752 
	#WHERE_ORDERBY_MIN
 0x0001

	)

11753 
	#WHERE_ORDERBY_MAX
 0x0002

	)

11754 
	#WHERE_ONEPASS_DESIRED
 0x0004

	)

11755 
	#WHERE_DUPLICATES_OK
 0x0008

	)

11756 
	#WHERE_OMIT_OPEN_CLOSE
 0x0010

	)

11757 
	#WHERE_FORCE_TABLE
 0x0020

	)

11758 
	#WHERE_ONETABLE_ONLY
 0x0040

	)

11760 
	#WHERE_GROUPBY
 0x0100

	)

11761 
	#WHERE_DISTINCTBY
 0x0200

	)

11762 
	#WHERE_WANT_DISTINCT
 0x0400

	)

11763 
	#WHERE_SORTBYGROUP
 0x0800

	)

11764 
	#WHERE_REOPEN_IDX
 0x1000

	)

11768 
	#WHERE_DISTINCT_NOOP
 0

	)

11769 
	#WHERE_DISTINCT_UNIQUE
 1

	)

11770 
	#WHERE_DISTINCT_ORDERED
 2

	)

11771 
	#WHERE_DISTINCT_UNORDERED
 3

	)

11794 
	sNameCÚ‹xt
 {

11795 
P¬£
 *
pP¬£
;

11796 
SrcLi¡
 *
pSrcLi¡
;

11797 
Ex´Li¡
 *
pELi¡
;

11798 
AggInfo
 *
pAggInfo
;

11799 
NameCÚ‹xt
 *
pNext
;

11800 
nRef
;

11801 
nE¼
;

11802 
u16
 
ncFÏgs
;

11812 
	#NC_AÎowAgg
 0x0001

	)

11813 
	#NC_HasAgg
 0x0002

	)

11814 
	#NC_IsCheck
 0x0004

	)

11815 
	#NC_InAggFunc
 0x0008

	)

11816 
	#NC_P¬tIdx
 0x0010

	)

11817 
	#NC_MšMaxAgg
 0x1000

	)

11839 
	sS–eù
 {

11840 
Ex´Li¡
 *
pELi¡
;

11841 
u8
 
Ý
;

11842 
u16
 
£lFÏgs
;

11843 
iLim™
, 
iOff£t
;

11844 #ià
SELECTTRACE_ENABLED


11845 
zS–Name
[12];

11847 
addrO³nEphm
[2];

11848 
u64
 
nS–eùRow
;

11849 
SrcLi¡
 *
pSrc
;

11850 
Ex´
 *
pWh”e
;

11851 
Ex´Li¡
 *
pGroupBy
;

11852 
Ex´
 *
pHavšg
;

11853 
Ex´Li¡
 *
pOrd”By
;

11854 
S–eù
 *
pPriÜ
;

11855 
S–eù
 *
pNext
;

11856 
Ex´
 *
pLim™
;

11857 
Ex´
 *
pOff£t
;

11858 
W™h
 *
pW™h
;

11865 
	#SF_Di¡šù
 0x0001

	)

11866 
	#SF_ResÞved
 0x0002

	)

11867 
	#SF_Agg»g©e
 0x0004

	)

11868 
	#SF_U£sEphem”®
 0x0008

	)

11869 
	#SF_Ex·nded
 0x0010

	)

11870 
	#SF_HasTy³Info
 0x0020

	)

11871 
	#SF_Compound
 0x0040

	)

11872 
	#SF_V®ues
 0x0080

	)

11874 
	#SF_Ne¡edFrom
 0x0200

	)

11875 
	#SF_MaybeCÚv”t
 0x0400

	)

11876 
	#SF_Recursive
 0x0800

	)

11877 
	#SF_MšMaxAgg
 0x1000

	)

11944 
	#SRT_UniÚ
 1

	)

11945 
	#SRT_Exû±
 2

	)

11946 
	#SRT_Exi¡s
 3

	)

11947 
	#SRT_Disÿrd
 4

	)

11948 
	#SRT_Fifo
 5

	)

11949 
	#SRT_Di¡Fifo
 6

	)

11950 
	#SRT_Queue
 7

	)

11951 
	#SRT_Di¡Queue
 8

	)

11954 
	#IgnÜabËOrd”by
(
X
è((X->
eDe¡
)<=
SRT_Di¡Queue
)

	)

11956 
	#SRT_Ouut
 9

	)

11957 
	#SRT_Mem
 10

	)

11958 
	#SRT_S‘
 11

	)

11959 
	#SRT_EphemTab
 12

	)

11960 
	#SRT_CÜoutše
 13

	)

11961 
	#SRT_TabË
 14

	)

11967 
	sS–eùDe¡
 {

11968 
u8
 
eDe¡
;

11969 
affSd¡
;

11970 
iSDP¬m
;

11971 
iSd¡
;

11972 
nSd¡
;

11973 
Ex´Li¡
 *
pOrd”By
;

11985 
	sAutošcInfo
 {

11986 
AutošcInfo
 *
pNext
;

11987 
TabË
 *
pTab
;

11988 
iDb
;

11989 
»gCŒ
;

11995 #iâdeà
SQLITE_N_COLCACHE


11996 
	#SQLITE_N_COLCACHE
 10

	)

12017 
	sTrigg”Prg
 {

12018 
Trigg”
 *
pTrigg”
;

12019 
Trigg”Prg
 *
pNext
;

12020 
SubProg¿m
 *
pProg¿m
;

12021 
ÜcÚf
;

12022 
u32
 
aCÞmask
[2];

12028 #ià
SQLITE_MAX_ATTACHED
>30

12029 
	tyDbMask
[(
SQLITE_MAX_ATTACHED
+9)/8];

12030 
	#DbMaskTe¡
(
M
,
I
è(((M)[(I)/8]&(1<<((I)&7)))!=0)

	)

12031 
	#DbMaskZ”o
(
M
è
	`mem£t
((M),0,(M))

	)

12032 
	#DbMaskS‘
(
M
,
I
è(M)[(I)/8]|=(1<<((I)&7))

	)

12033 
	#DbMaskAÎZ”o
(
M
è
	`sql™e3DbMaskAÎZ”o
(M)

	)

12034 
	#DbMaskNÚZ”o
(
M
è(
	`sql™e3DbMaskAÎZ”o
(M)==0)

	)

12036 
	tyDbMask
;

12037 
	#DbMaskTe¡
(
M
,
I
è(((M)&(((
yDbMask
)1)<<(I)))!=0)

	)

12038 
	#DbMaskZ”o
(
M
è(M)=0

	)

12039 
	#DbMaskS‘
(
M
,
I
è(M)|=(((
yDbMask
)1)<<(I))

	)

12040 
	#DbMaskAÎZ”o
(
M
è(M)==0

	)

12041 
	#DbMaskNÚZ”o
(
M
è(M)!=0

	)

12060 
	sP¬£
 {

12061 
sql™e3
 *
db
;

12062 *
zE¼Msg
;

12063 
Vdbe
 *
pVdbe
;

12064 
rc
;

12065 
u8
 
cÞNamesS‘
;

12066 
u8
 
checkSchema
;

12067 
u8
 
Ã¡ed
;

12068 
u8
 
nTempReg
;

12069 
u8
 
isMuÉiWr™e
;

12070 
u8
 
mayAbÜt
;

12071 
u8
 
hasCompound
;

12072 
u8
 
okCÚ¡FaùÜ
;

12073 
aTempReg
[8];

12074 
nRªgeReg
;

12075 
iRªgeReg
;

12076 
nE¼
;

12077 
nTab
;

12078 
nMem
;

12079 
nS‘
;

12080 
nOnû
;

12081 
nOpAÎoc
;

12082 
iFixedOp
;

12083 
ckBa£
;

12084 
iP¬tIdxTab
;

12085 
iCacheLev–
;

12086 
iCacheCÁ
;

12087 
nLab–
;

12088 *
aLab–
;

12089 
	syCÞCache
 {

12090 
iTabË
;

12091 
i16
 
iCÞumn
;

12092 
u8
 
‹mpReg
;

12093 
iLev–
;

12094 
iReg
;

12095 
Ìu
;

12096 } 
aCÞCache
[
SQLITE_N_COLCACHE
];

12097 
Ex´Li¡
 *
pCÚ¡Ex´
;

12098 
Tok’
 
cÚ¡¿štName
;

12099 
yDbMask
 
wr™eMask
;

12100 
yDbMask
 
cook›Mask
;

12101 
cook›V®ue
[
SQLITE_MAX_ATTACHED
+2];

12102 
»gRowid
;

12103 
»gRoÙ
;

12104 
nMaxArg
;

12105 #ià
SELECTTRACE_ENABLED


12106 
nS–eù
;

12107 
nS–eùInd’t
;

12109 #iâdeà
SQLITE_OMIT_SHARED_CACHE


12110 
nTabËLock
;

12111 
TabËLock
 *
aTabËLock
;

12113 
AutošcInfo
 *
pAšc
;

12116 
P¬£
 *
pTÝËv–
;

12117 
TabË
 *
pTrigg”Tab
;

12118 
addrCrTab
;

12119 
addrSkPK
;

12120 
u32
 
nQu”yLoÝ
;

12121 
u32
 
Þdmask
;

12122 
u32
 
Ãwmask
;

12123 
u8
 
eTrigg”Op
;

12124 
u8
 
eOrcÚf
;

12125 
u8
 
di§bËTrigg”s
;

12134 
nV¬
;

12135 
nzV¬
;

12136 
u8
 
iPkSÜtOrd”
;

12137 
u8
 
bF»eW™h
;

12138 
u8
 
ex¶aš
;

12139 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


12140 
u8
 
deþ¬eVb
;

12141 
nVbLock
;

12143 
nAlŸs
;

12144 
nHeight
;

12145 #iâdeà
SQLITE_OMIT_EXPLAIN


12146 
iS–eùId
;

12147 
iNextS–eùId
;

12149 **
azV¬
;

12150 
Vdbe
 *
pR•»·»
;

12151 cÚ¡ *
zTaž
;

12152 
TabË
 *
pNewTabË
;

12153 
Trigg”
 *
pNewTrigg”
;

12154 cÚ¡ *
zAuthCÚ‹xt
;

12155 
Tok’
 
sNameTok’
;

12156 
Tok’
 
sLa¡Tok’
;

12157 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


12158 
Tok’
 
sArg
;

12159 
TabË
 **
­VbLock
;

12161 
TabË
 *
pZomb›Tab
;

12162 
Trigg”Prg
 *
pTrigg”Prg
;

12163 
W™h
 *
pW™h
;

12169 #ifdeà
SQLITE_OMIT_VIRTUALTABLE


12170 
	#IN_DECLARE_VTAB
 0

	)

12172 
	#IN_DECLARE_VTAB
 (
pP¬£
->
deþ¬eVb
)

	)

12179 
	sAuthCÚ‹xt
 {

12180 cÚ¡ *
zAuthCÚ‹xt
;

12181 
P¬£
 *
pP¬£
;

12187 
	#OPFLAG_NCHANGE
 0x01

	)

12188 
	#OPFLAG_EPHEM
 0x01

	)

12189 
	#OPFLAG_LASTROWID
 0x02

	)

12190 
	#OPFLAG_ISUPDATE
 0x04

	)

12191 
	#OPFLAG_APPEND
 0x08

	)

12192 
	#OPFLAG_USESEEKRESULT
 0x10

	)

12193 
	#OPFLAG_LENGTHARG
 0x40

	)

12194 
	#OPFLAG_TYPEOFARG
 0x80

	)

12195 
	#OPFLAG_BULKCSR
 0x01

	)

12196 
	#OPFLAG_P2ISREG
 0x02

	)

12197 
	#OPFLAG_PERMUTE
 0x01

	)

12214 
	sTrigg”
 {

12215 *
zName
;

12216 *
bË
;

12217 
u8
 
Ý
;

12218 
u8
 
Œ_tm
;

12219 
Ex´
 *
pWh’
;

12220 
IdLi¡
 *
pCÞumns
;

12222 
Schema
 *
pSchema
;

12223 
Schema
 *
pTabSchema
;

12224 
Trigg”S‹p
 *
¡•_li¡
;

12225 
Trigg”
 *
pNext
;

12235 
	#TRIGGER_BEFORE
 1

	)

12236 
	#TRIGGER_AFTER
 2

	)

12276 
	sTrigg”S‹p
 {

12277 
u8
 
Ý
;

12278 
u8
 
ÜcÚf
;

12279 
Trigg”
 *
pTrig
;

12280 
S–eù
 *
pS–eù
;

12281 
Tok’
 
rg‘
;

12282 
Ex´
 *
pWh”e
;

12283 
Ex´Li¡
 *
pEx´Li¡
;

12284 
IdLi¡
 *
pIdLi¡
;

12285 
Trigg”S‹p
 *
pNext
;

12286 
Trigg”S‹p
 *
pLa¡
;

12294 
DbFix”
 
	tDbFix”
;

12295 
	sDbFix”
 {

12296 
P¬£
 *
pP¬£
;

12297 
Schema
 *
pSchema
;

12298 
bV¬OÆy
;

12299 cÚ¡ *
zDb
;

12300 cÚ¡ *
zTy³
;

12301 cÚ¡ 
Tok’
 *
pName
;

12308 
	sSŒAccum
 {

12309 
sql™e3
 *
db
;

12310 *
zBa£
;

12311 *
zText
;

12312 
nCh¬
;

12313 
nAÎoc
;

12314 
mxAÎoc
;

12315 
u8
 
u£M®loc
;

12316 
u8
 
accE¼Ü
;

12318 
	#STRACCUM_NOMEM
 1

	)

12319 
	#STRACCUM_TOOBIG
 2

	)

12326 
sql™e3
 *
db
;

12327 **
pzE¼Msg
;

12328 
iDb
;

12329 
rc
;

12330 } 
	tIn™D©a
;

12337 
	sSql™e3CÚfig
 {

12338 
bMem¡©
;

12339 
bCÜeMu‹x
;

12340 
bFuÎMu‹x
;

12341 
bO³nUri
;

12342 
bU£Cis
;

12343 
mxSŒËn
;

12344 
Ãv”CÜru±
;

12345 
szLookaside
;

12346 
nLookaside
;

12347 
sql™e3_mem_m‘hods
 
m
;

12348 
sql™e3_mu‹x_m‘hods
 
mu‹x
;

12349 
sql™e3_pÿche_m‘hods2
 
pÿche2
;

12350 *
pH—p
;

12351 
nH—p
;

12352 
mnReq
, 
mxReq
;

12353 
sql™e3_št64
 
szMm­
;

12354 
sql™e3_št64
 
mxMm­
;

12355 *
pSü©ch
;

12356 
szSü©ch
;

12357 
nSü©ch
;

12358 *
pPage
;

12359 
szPage
;

12360 
nPage
;

12361 
mxP¬£rSck
;

12362 
sh¬edCacheEÇbËd
;

12365 
isIn™
;

12366 
šProg»ss
;

12367 
isMu‹xIn™
;

12368 
isM®locIn™
;

12369 
isPCacheIn™
;

12370 
nRefIn™Mu‹x
;

12371 
sql™e3_mu‹x
 *
pIn™Mu‹x
;

12372 (*
xLog
)(*,,const *);

12373 *
pLogArg
;

12374 #ifdeà
SQLITE_ENABLE_SQLLOG


12375 (*
xSqÎog
)(*,
sql™e3
*,const *, );

12376 *
pSqÎogArg
;

12378 #ifdeà
SQLITE_VDBE_COVERAGE


12382 (*
xVdbeB¿nch
)(*,
iSrcLše
,
u8
 
eThis
,u8 
eMx
);

12383 *
pVdbeB¿nchArg
;

12385 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


12386 (*
xTe¡C®lback
)();

12388 
bLoÿÉimeFauÉ
;

12407 
	#CORRUPT_DB
 (
sql™e3CÚfig
.
Ãv”CÜru±
==0)

	)

12412 
	sW®k”
 {

12413 (*
xEx´C®lback
)(
W®k”
*, 
Ex´
*);

12414 (*
xS–eùC®lback
)(
W®k”
*,
S–eù
*);

12415 (*
xS–eùC®lback2
)(
W®k”
*,
S–eù
*);

12416 
P¬£
 *
pP¬£
;

12417 
w®k”D•th
;

12419 
NameCÚ‹xt
 *
pNC
;

12420 
i
;

12421 
SrcLi¡
 *
pSrcLi¡
;

12422 
SrcCouÁ
 *
pSrcCouÁ
;

12423 } 
u
;

12427 
SQLITE_PRIVATE
 
sql™e3W®kEx´
(
W®k”
*, 
Ex´
*);

12428 
SQLITE_PRIVATE
 
sql™e3W®kEx´Li¡
(
W®k”
*, 
Ex´Li¡
*);

12429 
SQLITE_PRIVATE
 
sql™e3W®kS–eù
(
W®k”
*, 
S–eù
*);

12430 
SQLITE_PRIVATE
 
sql™e3W®kS–eùEx´
(
W®k”
*, 
S–eù
*);

12431 
SQLITE_PRIVATE
 
sql™e3W®kS–eùFrom
(
W®k”
*, 
S–eù
*);

12437 
	#WRC_CÚtšue
 0

	)

12438 
	#WRC_PruÃ
 1

	)

12439 
	#WRC_AbÜt
 2

	)

12445 
	sW™h
 {

12446 
nC‹
;

12447 
W™h
 *
pOu‹r
;

12448 
	sC‹
 {

12449 *
zName
;

12450 
Ex´Li¡
 *
pCÞs
;

12451 
S–eù
 *
pS–eù
;

12452 cÚ¡ *
zE¼
;

12453 } 
a
[1];

12456 #ifdeà
SQLITE_DEBUG


12461 
	sT»eV›w
 {

12462 
iLev–
;

12463 
u8
 
bLše
[100];

12471 
	#SQLITE_SKIP_UTF8
(
zIn
) { \

12472 ifÐ(*(
zIn
++))>=0xc0 ){ \

12473  (*
zIn
 & 0xc0)==0x80 ){ zIn++; } \

12475 }

	)

12484 
SQLITE_PRIVATE
 
sql™e3CÜru±E¼Ü
();

12485 
SQLITE_PRIVATE
 
sql™e3Misu£E¼Ü
();

12486 
SQLITE_PRIVATE
 
sql™e3CªtÝ’E¼Ü
();

12487 
	#SQLITE_CORRUPT_BKPT
 
	`sql™e3CÜru±E¼Ü
(
__LINE__
)

	)

12488 
	#SQLITE_MISUSE_BKPT
 
	`sql™e3Misu£E¼Ü
(
__LINE__
)

	)

12489 
	#SQLITE_CANTOPEN_BKPT
 
	`sql™e3CªtÝ’E¼Ü
(
__LINE__
)

	)

12497 #ià
defšed
(
SQLITE_ENABLE_FTS4
è&& !defšed(
SQLITE_ENABLE_FTS3
)

12498 
	#SQLITE_ENABLE_FTS3


	)

12505 #ià!
defšed
(
SQLITE_ASCII
) || \

12506 (
defšed
(
SQLITE_ENABLE_FTS3
è&& defšed(
SQLITE_AMALGAMATION
))

12507 
	~<ùy³.h
>

12515 #ifdeà
SQLITE_ASCII


12516 
	#sql™e3Touµ”
(
x
è((x)&~(
sql™e3Cty³M­
[()(x)]&0x20))

	)

12517 
	#sql™e3Is¥aû
(
x
è(
sql™e3Cty³M­
[()(x)]&0x01)

	)

12518 
	#sql™e3I§Êum
(
x
è(
sql™e3Cty³M­
[()(x)]&0x06)

	)

12519 
	#sql™e3I§Íha
(
x
è(
sql™e3Cty³M­
[()(x)]&0x02)

	)

12520 
	#sql™e3Isdig™
(
x
è(
sql™e3Cty³M­
[()(x)]&0x04)

	)

12521 
	#sql™e3Isxdig™
(
x
è(
sql™e3Cty³M­
[()(x)]&0x08)

	)

12522 
	#sql™e3TÞow”
(
x
è(
sql™e3Uµ”ToLow”
[()(x)])

	)

12524 
	#sql™e3Touµ”
(
x
è
	`touµ”
(()(x))

	)

12525 
	#sql™e3Is¥aû
(
x
è
	`is¥aû
(()(x))

	)

12526 
	#sql™e3I§Êum
(
x
è
	`i§Êum
(()(x))

	)

12527 
	#sql™e3I§Íha
(
x
è
	`i§Íha
(()(x))

	)

12528 
	#sql™e3Isdig™
(
x
è
	`isdig™
(()(x))

	)

12529 
	#sql™e3Isxdig™
(
x
è
	`isxdig™
(()(x))

	)

12530 
	#sql™e3TÞow”
(
x
è
	`tÞow”
(()(x))

	)

12532 
SQLITE_PRIVATE
 
sql™e3IsIdCh¬
(
u8
);

12537 
	#sql™e3SŒICmp
 
sql™e3_¡ricmp


	)

12538 
SQLITE_PRIVATE
 
sql™e3SŒËn30
(const *);

12539 
	#sql™e3SŒNICmp
 
sql™e3_¡ºicmp


	)

12541 
SQLITE_PRIVATE
 
sql™e3M®locIn™
();

12542 
SQLITE_PRIVATE
 
sql™e3M®locEnd
();

12543 
SQLITE_PRIVATE
 *
sql™e3M®loc
(
u64
);

12544 
SQLITE_PRIVATE
 *
sql™e3M®locZ”o
(
u64
);

12545 
SQLITE_PRIVATE
 *
sql™e3DbM®locZ”o
(
sql™e3
*, 
u64
);

12546 
SQLITE_PRIVATE
 *
sql™e3DbM®locRaw
(
sql™e3
*, 
u64
);

12547 
SQLITE_PRIVATE
 *
sql™e3DbSŒDup
(
sql™e3
*,const *);

12548 
SQLITE_PRIVATE
 *
sql™e3DbSŒNDup
(
sql™e3
*,cÚ¡ *, 
u64
);

12549 
SQLITE_PRIVATE
 *
sql™e3R—Îoc
(*, 
u64
);

12550 
SQLITE_PRIVATE
 *
sql™e3DbR—ÎocOrF»e
(
sql™e3
 *, *, 
u64
);

12551 
SQLITE_PRIVATE
 *
sql™e3DbR—Îoc
(
sql™e3
 *, *, 
u64
);

12552 
SQLITE_PRIVATE
 
sql™e3DbF»e
(
sql™e3
*, *);

12553 
SQLITE_PRIVATE
 
sql™e3M®locSize
(*);

12554 
SQLITE_PRIVATE
 
sql™e3DbM®locSize
(
sql™e3
*, *);

12555 
SQLITE_PRIVATE
 *
sql™e3Sü©chM®loc
();

12556 
SQLITE_PRIVATE
 
sql™e3Sü©chF»e
(*);

12557 
SQLITE_PRIVATE
 *
sql™e3PageM®loc
();

12558 
SQLITE_PRIVATE
 
sql™e3PageF»e
(*);

12559 
SQLITE_PRIVATE
 
sql™e3MemS‘DeçuÉ
();

12560 
SQLITE_PRIVATE
 
sql™e3B’ignM®locHooks
((*)(), (*)());

12561 
SQLITE_PRIVATE
 
sql™e3H—pN—¾yFuÎ
();

12571 #ifdeà
SQLITE_USE_ALLOCA


12572 
	#sql™e3SckAÎocRaw
(
D
,
N
è
	`®loÿ
(N)

	)

12573 
	#sql™e3SckAÎocZ”o
(
D
,
N
è
	`mem£t
(
	`®loÿ
(N), 0, N)

	)

12574 
	#sql™e3SckF»e
(
D
,
P
)

	)

12576 
	#sql™e3SckAÎocRaw
(
D
,
N
è
	`sql™e3DbM®locRaw
(D,N)

	)

12577 
	#sql™e3SckAÎocZ”o
(
D
,
N
è
	`sql™e3DbM®locZ”o
(D,N)

	)

12578 
	#sql™e3SckF»e
(
D
,
P
è
	`sql™e3DbF»e
(D,P)

	)

12581 #ifdeà
SQLITE_ENABLE_MEMSYS3


12582 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Memsys3
();

12584 #ifdeà
SQLITE_ENABLE_MEMSYS5


12585 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Memsys5
();

12589 #iâdeà
SQLITE_MUTEX_OMIT


12590 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3DeçuÉMu‹x
();

12591 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3NoÝMu‹x
();

12592 
SQLITE_PRIVATE
 
sql™e3_mu‹x
 *
sql™e3Mu‹xAÎoc
();

12593 
SQLITE_PRIVATE
 
sql™e3Mu‹xIn™
();

12594 
SQLITE_PRIVATE
 
sql™e3Mu‹xEnd
();

12597 
SQLITE_PRIVATE
 
sql™e3StusV®ue
();

12598 
SQLITE_PRIVATE
 
sql™e3StusAdd
(, );

12599 
SQLITE_PRIVATE
 
sql™e3StusS‘
(, );

12601 #iâdeà
SQLITE_OMIT_FLOATING_POINT


12602 
SQLITE_PRIVATE
 
sql™e3IsNaN
();

12604 
	#sql™e3IsNaN
(
X
è0

	)

12611 
	sPrštfArgum’ts
 {

12612 
nArg
;

12613 
nU£d
;

12614 
sql™e3_v®ue
 **
­Arg
;

12617 
	#SQLITE_PRINTF_INTERNAL
 0x01

	)

12618 
	#SQLITE_PRINTF_SQLFUNC
 0x02

	)

12619 
SQLITE_PRIVATE
 
sql™e3VXPrštf
(
SŒAccum
*, 
u32
, cÚ¡ *, 
va_li¡
);

12620 
SQLITE_PRIVATE
 
sql™e3XPrštf
(
SŒAccum
*, 
u32
, const *, ...);

12621 
SQLITE_PRIVATE
 *
sql™e3MPrštf
(
sql™e3
*,const *, ...);

12622 
SQLITE_PRIVATE
 *
sql™e3VMPrštf
(
sql™e3
*,cÚ¡ *, 
va_li¡
);

12623 
SQLITE_PRIVATE
 *
sql™e3MAµ’df
(
sql™e3
*,*,const *,...);

12624 #ià
defšed
(
SQLITE_TEST
è|| defšed(
SQLITE_DEBUG
)

12625 
SQLITE_PRIVATE
 
sql™e3DebugPrštf
(const *, ...);

12627 #ià
defšed
(
SQLITE_TEST
)

12628 
SQLITE_PRIVATE
 *
sql™e3Te¡TextToPŒ
(const *);

12631 #ià
defšed
(
SQLITE_DEBUG
)

12632 
SQLITE_PRIVATE
 
T»eV›w
 *
sql™e3T»eV›wPush
(T»eV›w*,
u8
);

12633 
SQLITE_PRIVATE
 
sql™e3T»eV›wPÝ
(
T»eV›w
*);

12634 
SQLITE_PRIVATE
 
sql™e3T»eV›wLše
(
T»eV›w
*, const *, ...);

12635 
SQLITE_PRIVATE
 
sql™e3T»eV›wI‹m
(
T»eV›w
*, cÚ¡ *, 
u8
);

12636 
SQLITE_PRIVATE
 
sql™e3T»eV›wEx´
(
T»eV›w
*, cÚ¡ 
Ex´
*, 
u8
);

12637 
SQLITE_PRIVATE
 
sql™e3T»eV›wEx´Li¡
(
T»eV›w
*, cÚ¡ 
Ex´Li¡
*, 
u8
, const *);

12638 
SQLITE_PRIVATE
 
sql™e3T»eV›wS–eù
(
T»eV›w
*, cÚ¡ 
S–eù
*, 
u8
);

12642 
SQLITE_PRIVATE
 
sql™e3S‘SŒšg
(**, 
sql™e3
*, const *, ...);

12643 
SQLITE_PRIVATE
 
sql™e3E¼ÜMsg
(
P¬£
*, const *, ...);

12644 
SQLITE_PRIVATE
 
sql™e3DequÙe
(*);

12645 
SQLITE_PRIVATE
 
sql™e3KeywÜdCode
(const *, );

12646 
SQLITE_PRIVATE
 
sql™e3RunP¬£r
(
P¬£
*, const *, **);

12647 
SQLITE_PRIVATE
 
sql™e3FšishCodšg
(
P¬£
*);

12648 
SQLITE_PRIVATE
 
sql™e3G‘TempReg
(
P¬£
*);

12649 
SQLITE_PRIVATE
 
sql™e3R–—£TempReg
(
P¬£
*,);

12650 
SQLITE_PRIVATE
 
sql™e3G‘TempRªge
(
P¬£
*,);

12651 
SQLITE_PRIVATE
 
sql™e3R–—£TempRªge
(
P¬£
*,,);

12652 
SQLITE_PRIVATE
 
sql™e3CË¬TempRegCache
(
P¬£
*);

12653 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AÎoc
(
sql™e3
*,,cÚ¡ 
Tok’
*,);

12654 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´
(
sql™e3
*,,const *);

12655 
SQLITE_PRIVATE
 
sql™e3Ex´A‰achSubŒ“s
(
sql™e3
*,
Ex´
*,Expr*,Expr*);

12656 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3PEx´
(
P¬£
*, , Ex´*, Ex´*, cÚ¡ 
Tok’
*);

12657 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´And
(
sql™e3
*,Expr*, Expr*);

12658 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´FunùiÚ
(
P¬£
*,
Ex´Li¡
*, 
Tok’
*);

12659 
SQLITE_PRIVATE
 
sql™e3Ex´AssignV¬Numb”
(
P¬£
*, 
Ex´
*);

12660 
SQLITE_PRIVATE
 
sql™e3Ex´D–‘e
(
sql™e3
*, 
Ex´
*);

12661 
SQLITE_PRIVATE
 
Ex´Li¡
 *
sql™e3Ex´Li¡Aµ’d
(
P¬£
*,Ex´Li¡*,
Ex´
*);

12662 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡S‘Name
(
P¬£
*,
Ex´Li¡
*,
Tok’
*,);

12663 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡S‘S·n
(
P¬£
*,
Ex´Li¡
*,
Ex´S·n
*);

12664 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡D–‘e
(
sql™e3
*, 
Ex´Li¡
*);

12665 
SQLITE_PRIVATE
 
sql™e3In™
(
sql™e3
*, **);

12666 
SQLITE_PRIVATE
 
sql™e3In™C®lback
(*, , **, **);

12667 
SQLITE_PRIVATE
 
sql™e3P¿gma
(
P¬£
*,
Tok’
*,Token*,Token*,);

12668 
SQLITE_PRIVATE
 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
sql™e3
*);

12669 
SQLITE_PRIVATE
 
sql™e3Re£tOÃSchema
(
sql™e3
*,);

12670 
SQLITE_PRIVATE
 
sql™e3CÞÏp£D©aba£A¼ay
(
sql™e3
*);

12671 
SQLITE_PRIVATE
 
sql™e3BegšP¬£
(
P¬£
*,);

12672 
SQLITE_PRIVATE
 
sql™e3Comm™IÁ”ÇlChªges
(
sql™e3
*);

12673 
SQLITE_PRIVATE
 
TabË
 *
sql™e3ResuÉS‘OfS–eù
(
P¬£
*,
S–eù
*);

12674 
SQLITE_PRIVATE
 
sql™e3O³nMa¡”TabË
(
P¬£
 *, );

12675 
SQLITE_PRIVATE
 
Index
 *
sql™e3Prim¬yKeyIndex
(
TabË
*);

12676 
SQLITE_PRIVATE
 
i16
 
sql™e3CÞumnOfIndex
(
Index
*, i16);

12677 
SQLITE_PRIVATE
 
sql™e3S¹TabË
(
P¬£
*,
Tok’
*,Token*,,,,);

12678 
SQLITE_PRIVATE
 
sql™e3AddCÞumn
(
P¬£
*,
Tok’
*);

12679 
SQLITE_PRIVATE
 
sql™e3AddNÙNuÎ
(
P¬£
*, );

12680 
SQLITE_PRIVATE
 
sql™e3AddPrim¬yKey
(
P¬£
*, 
Ex´Li¡
*, , , );

12681 
SQLITE_PRIVATE
 
sql™e3AddCheckCÚ¡¿št
(
P¬£
*, 
Ex´
*);

12682 
SQLITE_PRIVATE
 
sql™e3AddCÞumnTy³
(
P¬£
*,
Tok’
*);

12683 
SQLITE_PRIVATE
 
sql™e3AddDeçuÉV®ue
(
P¬£
*,
Ex´S·n
*);

12684 
SQLITE_PRIVATE
 
sql™e3AddCÞÏ‹Ty³
(
P¬£
*, 
Tok’
*);

12685 
SQLITE_PRIVATE
 
sql™e3EndTabË
(
P¬£
*,
Tok’
*,Tok’*,
u8
,
S–eù
*);

12686 
SQLITE_PRIVATE
 
sql™e3P¬£Uri
(const *,const *,*,

12687 
sql™e3_vfs
**,**,**);

12688 
SQLITE_PRIVATE
 
BŒ“
 *
sql™e3DbNameToBŒ“
(
sql™e3
*,const *);

12689 
SQLITE_PRIVATE
 
sql™e3CodeOnû
(
P¬£
 *);

12691 #ifdeà
SQLITE_OMIT_BUILTIN_TEST


12692 
	#sql™e3FauÉSim
(
X
è
SQLITE_OK


	)

12694 
SQLITE_PRIVATE
 
sql™e3FauÉSim
();

12697 
SQLITE_PRIVATE
 
B™vec
 *
sql™e3B™vecC»©e
(
u32
);

12698 
SQLITE_PRIVATE
 
sql™e3B™vecTe¡
(
B™vec
*, 
u32
);

12699 
SQLITE_PRIVATE
 
sql™e3B™vecS‘
(
B™vec
*, 
u32
);

12700 
SQLITE_PRIVATE
 
sql™e3B™vecCË¬
(
B™vec
*, 
u32
, *);

12701 
SQLITE_PRIVATE
 
sql™e3B™vecDe¡roy
(
B™vec
*);

12702 
SQLITE_PRIVATE
 
u32
 
sql™e3B™vecSize
(
B™vec
*);

12703 
SQLITE_PRIVATE
 
sql™e3B™vecBužtšTe¡
(,*);

12705 
SQLITE_PRIVATE
 
RowS‘
 *
sql™e3RowS‘In™
(
sql™e3
*, *, );

12706 
SQLITE_PRIVATE
 
sql™e3RowS‘CË¬
(
RowS‘
*);

12707 
SQLITE_PRIVATE
 
sql™e3RowS‘In£¹
(
RowS‘
*, 
i64
);

12708 
SQLITE_PRIVATE
 
sql™e3RowS‘Te¡
(
RowS‘
*, 
iB©ch
, 
i64
);

12709 
SQLITE_PRIVATE
 
sql™e3RowS‘Next
(
RowS‘
*, 
i64
*);

12711 
SQLITE_PRIVATE
 
sql™e3C»©eV›w
(
P¬£
*,
Tok’
*,Tok’*,Tok’*,
S–eù
*,,);

12713 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_VIRTUALTABLE
)

12714 
SQLITE_PRIVATE
 
sql™e3V›wG‘CÞumnNames
(
P¬£
*,
TabË
*);

12716 
	#sql™e3V›wG‘CÞumnNames
(
A
,
B
è0

	)

12719 #ià
SQLITE_MAX_ATTACHED
>30

12720 
SQLITE_PRIVATE
 
sql™e3DbMaskAÎZ”o
(
yDbMask
);

12722 
SQLITE_PRIVATE
 
sql™e3DrÝTabË
(
P¬£
*, 
SrcLi¡
*, , );

12723 
SQLITE_PRIVATE
 
sql™e3CodeDrÝTabË
(
P¬£
*, 
TabË
*, , );

12724 
SQLITE_PRIVATE
 
sql™e3D–‘eTabË
(
sql™e3
*, 
TabË
*);

12725 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


12726 
SQLITE_PRIVATE
 
sql™e3Autošüem’tBegš
(
P¬£
 *
pP¬£
);

12727 
SQLITE_PRIVATE
 
sql™e3Autošüem’tEnd
(
P¬£
 *
pP¬£
);

12729 
	#sql™e3Autošüem’tBegš
(
X
)

	)

12730 
	#sql™e3Autošüem’tEnd
(
X
)

	)

12732 
SQLITE_PRIVATE
 
sql™e3In£¹
(
P¬£
*, 
SrcLi¡
*, 
S–eù
*, 
IdLi¡
*, );

12733 
SQLITE_PRIVATE
 *
sql™e3A¼ayAÎoÿ‹
(
sql™e3
*,*,,*,*);

12734 
SQLITE_PRIVATE
 
IdLi¡
 *
sql™e3IdLi¡Aµ’d
(
sql™e3
*, IdLi¡*, 
Tok’
*);

12735 
SQLITE_PRIVATE
 
sql™e3IdLi¡Index
(
IdLi¡
*,const *);

12736 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡EÆ¬ge
(
sql™e3
*, SrcList*, , );

12737 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Aµ’d
(
sql™e3
*, SrcLi¡*, 
Tok’
*, Token*);

12738 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Aµ’dFromT”m
(
P¬£
*, SrcLi¡*, 
Tok’
*, Token*,

12739 
Tok’
*, 
S–eù
*, 
Ex´
*, 
IdLi¡
*);

12740 
SQLITE_PRIVATE
 
sql™e3SrcLi¡IndexedBy
(
P¬£
 *, 
SrcLi¡
 *, 
Tok’
 *);

12741 
SQLITE_PRIVATE
 
sql™e3IndexedByLookup
(
P¬£
 *, 
SrcLi¡_™em
 *);

12742 
SQLITE_PRIVATE
 
sql™e3SrcLi¡ShiáJošTy³
(
SrcLi¡
*);

12743 
SQLITE_PRIVATE
 
sql™e3SrcLi¡AssignCursÜs
(
P¬£
*, 
SrcLi¡
*);

12744 
SQLITE_PRIVATE
 
sql™e3IdLi¡D–‘e
(
sql™e3
*, 
IdLi¡
*);

12745 
SQLITE_PRIVATE
 
sql™e3SrcLi¡D–‘e
(
sql™e3
*, 
SrcLi¡
*);

12746 
SQLITE_PRIVATE
 
Index
 *
sql™e3AÎoÿ‹IndexObjeù
(
sql™e3
*,
i16
,,**);

12747 
SQLITE_PRIVATE
 
Index
 *
sql™e3C»©eIndex
(
P¬£
*,
Tok’
*,Tok’*,
SrcLi¡
*,
Ex´Li¡
*,,Token*,

12748 
Ex´
*, , );

12749 
SQLITE_PRIVATE
 
sql™e3DrÝIndex
(
P¬£
*, 
SrcLi¡
*, );

12750 
SQLITE_PRIVATE
 
sql™e3S–eù
(
P¬£
*, 
S–eù
*, 
S–eùDe¡
*);

12751 
SQLITE_PRIVATE
 
S–eù
 *
sql™e3S–eùNew
(
P¬£
*,
Ex´Li¡
*,
SrcLi¡
*,
Ex´
*,ExprList*,

12752 
Ex´
*,
Ex´Li¡
*,
u16
,Expr*,Expr*);

12753 
SQLITE_PRIVATE
 
sql™e3S–eùD–‘e
(
sql™e3
*, 
S–eù
*);

12754 
SQLITE_PRIVATE
 
TabË
 *
sql™e3SrcLi¡Lookup
(
P¬£
*, 
SrcLi¡
*);

12755 
SQLITE_PRIVATE
 
sql™e3IsR—dOÆy
(
P¬£
*, 
TabË
*, );

12756 
SQLITE_PRIVATE
 
sql™e3O³nTabË
(
P¬£
*, 
iCur
, 
iDb
, 
TabË
*, );

12757 #ià
defšed
(
SQLITE_ENABLE_UPDATE_DELETE_LIMIT
è&& !defšed(
SQLITE_OMIT_SUBQUERY
)

12758 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Lim™Wh”e
(
P¬£
*,
SrcLi¡
*,Ex´*,
Ex´Li¡
*,Expr*,Expr*,*);

12760 
SQLITE_PRIVATE
 
sql™e3D–‘eFrom
(
P¬£
*, 
SrcLi¡
*, 
Ex´
*);

12761 
SQLITE_PRIVATE
 
sql™e3Upd©e
(
P¬£
*, 
SrcLi¡
*, 
Ex´Li¡
*, 
Ex´
*, );

12762 
SQLITE_PRIVATE
 
Wh”eInfo
 *
sql™e3Wh”eBegš
(
P¬£
*,
SrcLi¡
*,
Ex´
*,
Ex´Li¡
*,Ex´Li¡*,
u16
,);

12763 
SQLITE_PRIVATE
 
sql™e3Wh”eEnd
(
Wh”eInfo
*);

12764 
SQLITE_PRIVATE
 
u64
 
sql™e3Wh”eOuutRowCouÁ
(
Wh”eInfo
*);

12765 
SQLITE_PRIVATE
 
sql™e3Wh”eIsDi¡šù
(
Wh”eInfo
*);

12766 
SQLITE_PRIVATE
 
sql™e3Wh”eIsOrd”ed
(
Wh”eInfo
*);

12767 
SQLITE_PRIVATE
 
sql™e3Wh”eIsSÜ‹d
(
Wh”eInfo
*);

12768 
SQLITE_PRIVATE
 
sql™e3Wh”eCÚtšueLab–
(
Wh”eInfo
*);

12769 
SQLITE_PRIVATE
 
sql™e3Wh”eB»akLab–
(
Wh”eInfo
*);

12770 
SQLITE_PRIVATE
 
sql™e3Wh”eOkOÃPass
(
Wh”eInfo
*, *);

12771 
SQLITE_PRIVATE
 
sql™e3Ex´CodeG‘CÞumn
(
P¬£
*, 
TabË
*, , , , 
u8
);

12772 
SQLITE_PRIVATE
 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
Vdbe
*, 
TabË
*, , , );

12773 
SQLITE_PRIVATE
 
sql™e3Ex´CodeMove
(
P¬£
*, , , );

12774 
SQLITE_PRIVATE
 
sql™e3Ex´CacheStÜe
(
P¬£
*, , , );

12775 
SQLITE_PRIVATE
 
sql™e3Ex´CachePush
(
P¬£
*);

12776 
SQLITE_PRIVATE
 
sql™e3Ex´CachePÝ
(
P¬£
*);

12777 
SQLITE_PRIVATE
 
sql™e3Ex´CacheRemove
(
P¬£
*, , );

12778 
SQLITE_PRIVATE
 
sql™e3Ex´CacheCË¬
(
P¬£
*);

12779 
SQLITE_PRIVATE
 
sql™e3Ex´CacheAffš™yChªge
(
P¬£
*, , );

12780 
SQLITE_PRIVATE
 
sql™e3Ex´Code
(
P¬£
*, 
Ex´
*, );

12781 
SQLITE_PRIVATE
 
sql™e3Ex´CodeFaùÜabË
(
P¬£
*, 
Ex´
*, );

12782 
SQLITE_PRIVATE
 
sql™e3Ex´CodeAtIn™
(
P¬£
*, 
Ex´
*, , 
u8
);

12783 
SQLITE_PRIVATE
 
sql™e3Ex´CodeTemp
(
P¬£
*, 
Ex´
*, *);

12784 
SQLITE_PRIVATE
 
sql™e3Ex´CodeT¬g‘
(
P¬£
*, 
Ex´
*, );

12785 
SQLITE_PRIVATE
 
sql™e3Ex´CodeAndCache
(
P¬£
*, 
Ex´
*, );

12786 
SQLITE_PRIVATE
 
sql™e3Ex´CodeEx´Li¡
(
P¬£
*, 
Ex´Li¡
*, , 
u8
);

12787 
	#SQLITE_ECEL_DUP
 0x01

	)

12788 
	#SQLITE_ECEL_FACTOR
 0x02

	)

12789 
SQLITE_PRIVATE
 
sql™e3Ex´IfTrue
(
P¬£
*, 
Ex´
*, , );

12790 
SQLITE_PRIVATE
 
sql™e3Ex´IfF®£
(
P¬£
*, 
Ex´
*, , );

12791 
SQLITE_PRIVATE
 
TabË
 *
sql™e3FšdTabË
(
sql™e3
*,const *, const *);

12792 
SQLITE_PRIVATE
 
TabË
 *
sql™e3Loÿ‹TabË
(
P¬£
*,
isV›w
,const *, const *);

12793 
SQLITE_PRIVATE
 
TabË
 *
sql™e3Loÿ‹TabËI‹m
(
P¬£
*,
isV›w
,
SrcLi¡_™em
 *);

12794 
SQLITE_PRIVATE
 
Index
 *
sql™e3FšdIndex
(
sql™e3
*,const *, const *);

12795 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eTabË
(
sql™e3
*,,const *);

12796 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eIndex
(
sql™e3
*,,const *);

12797 
SQLITE_PRIVATE
 
sql™e3Vacuum
(
P¬£
*);

12798 
SQLITE_PRIVATE
 
sql™e3RunVacuum
(**, 
sql™e3
*);

12799 
SQLITE_PRIVATE
 *
sql™e3NameFromTok’
(
sql™e3
*, 
Tok’
*);

12800 
SQLITE_PRIVATE
 
sql™e3Ex´Com·»
(
Ex´
*, Expr*, );

12801 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡Com·»
(
Ex´Li¡
*, ExprList*, );

12802 
SQLITE_PRIVATE
 
sql™e3Ex´Im¶›sEx´
(
Ex´
*, Expr*, );

12803 
SQLITE_PRIVATE
 
sql™e3Ex´AÇlyzeAgg»g©es
(
NameCÚ‹xt
*, 
Ex´
*);

12804 
SQLITE_PRIVATE
 
sql™e3Ex´AÇlyzeAggLi¡
(
NameCÚ‹xt
*,
Ex´Li¡
*);

12805 
SQLITE_PRIVATE
 
sql™e3FunùiÚU£sThisSrc
(
Ex´
*, 
SrcLi¡
*);

12806 
SQLITE_PRIVATE
 
Vdbe
 *
sql™e3G‘Vdbe
(
P¬£
*);

12807 
SQLITE_PRIVATE
 
sql™e3PºgSaveS‹
();

12808 
SQLITE_PRIVATE
 
sql™e3PºgRe¡ÜeS‹
();

12809 
SQLITE_PRIVATE
 
sql™e3RÞlbackAÎ
(
sql™e3
*,);

12810 
SQLITE_PRIVATE
 
sql™e3CodeV”ifySchema
(
P¬£
*, );

12811 
SQLITE_PRIVATE
 
sql™e3CodeV”ifyNamedSchema
(
P¬£
*, cÚ¡ *
zDb
);

12812 
SQLITE_PRIVATE
 
sql™e3BegšT¿n§ùiÚ
(
P¬£
*, );

12813 
SQLITE_PRIVATE
 
sql™e3Comm™T¿n§ùiÚ
(
P¬£
*);

12814 
SQLITE_PRIVATE
 
sql™e3RÞlbackT¿n§ùiÚ
(
P¬£
*);

12815 
SQLITE_PRIVATE
 
sql™e3Sav•ošt
(
P¬£
*, , 
Tok’
*);

12816 
SQLITE_PRIVATE
 
sql™e3Clo£Sav•ošts
(
sql™e3
 *);

12817 
SQLITE_PRIVATE
 
sql™e3L—veMu‹xAndClo£Zomb›
(
sql™e3
*);

12818 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªt
(
Ex´
*);

12819 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªtNÙJoš
(
Ex´
*);

12820 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªtOrFunùiÚ
(
Ex´
*, 
u8
);

12821 
SQLITE_PRIVATE
 
sql™e3Ex´IsIÁeg”
(
Ex´
*, *);

12822 
SQLITE_PRIVATE
 
sql™e3Ex´CªBeNuÎ
(cÚ¡ 
Ex´
*);

12823 
SQLITE_PRIVATE
 
sql™e3Ex´N“dsNoAffš™yChªge
(cÚ¡ 
Ex´
*, );

12824 
SQLITE_PRIVATE
 
sql™e3IsRowid
(const *);

12825 
SQLITE_PRIVATE
 
sql™e3G’”©eRowD–‘e
(
P¬£
*,
TabË
*,
Trigg”
*,,,,
i16
,
u8
,u8,u8);

12826 
SQLITE_PRIVATE
 
sql™e3G’”©eRowIndexD–‘e
(
P¬£
*, 
TabË
*, , , *);

12827 
SQLITE_PRIVATE
 
sql™e3G’”©eIndexKey
(
P¬£
*, 
Index
*, , , , *,Index*,);

12828 
SQLITE_PRIVATE
 
sql™e3ResÞveP¬tIdxLab–
(
P¬£
*,);

12829 
SQLITE_PRIVATE
 
sql™e3G’”©eCÚ¡¿štChecks
(
P¬£
*,
TabË
*,*,,,,,

12830 
u8
,u8,,*);

12831 
SQLITE_PRIVATE
 
sql™e3Com¶‘eIn£¹iÚ
(
P¬£
*,
TabË
*,,,,*,,,);

12832 
SQLITE_PRIVATE
 
sql™e3O³nTabËAndIndiûs
(
P¬£
*, 
TabË
*, , , 
u8
*, *, *);

12833 
SQLITE_PRIVATE
 
sql™e3BegšWr™eO³¿tiÚ
(
P¬£
*, , );

12834 
SQLITE_PRIVATE
 
sql™e3MuÉiWr™e
(
P¬£
*);

12835 
SQLITE_PRIVATE
 
sql™e3MayAbÜt
(
P¬£
*);

12836 
SQLITE_PRIVATE
 
sql™e3H®tCÚ¡¿št
(
P¬£
*, , , *, 
i8
, 
u8
);

12837 
SQLITE_PRIVATE
 
sql™e3UniqueCÚ¡¿št
(
P¬£
*, , 
Index
*);

12838 
SQLITE_PRIVATE
 
sql™e3RowidCÚ¡¿št
(
P¬£
*, , 
TabË
*);

12839 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´Dup
(
sql™e3
*,Expr*,);

12840 
SQLITE_PRIVATE
 
Ex´Li¡
 *
sql™e3Ex´Li¡Dup
(
sql™e3
*,ExprList*,);

12841 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Dup
(
sql™e3
*,SrcList*,);

12842 
SQLITE_PRIVATE
 
IdLi¡
 *
sql™e3IdLi¡Dup
(
sql™e3
*,IdList*);

12843 
SQLITE_PRIVATE
 
S–eù
 *
sql™e3S–eùDup
(
sql™e3
*,Select*,);

12844 #ià
SELECTTRACE_ENABLED


12845 
SQLITE_PRIVATE
 
sql™e3S–eùS‘Name
(
S–eù
*,const *);

12847 
	#sql™e3S–eùS‘Name
(
A
,
B
)

	)

12849 
SQLITE_PRIVATE
 
sql™e3FuncDefIn£¹
(
FuncDefHash
*, 
FuncDef
*);

12850 
SQLITE_PRIVATE
 
FuncDef
 *
sql™e3FšdFunùiÚ
(
sql™e3
*,cÚ¡ *,,,
u8
,u8);

12851 
SQLITE_PRIVATE
 
sql™e3Regi¡”BužtšFunùiÚs
(
sql™e3
*);

12852 
SQLITE_PRIVATE
 
sql™e3Regi¡”D©eTimeFunùiÚs
();

12853 
SQLITE_PRIVATE
 
sql™e3Regi¡”Glob®FunùiÚs
();

12854 
SQLITE_PRIVATE
 
sql™e3SaãtyCheckOk
(
sql™e3
*);

12855 
SQLITE_PRIVATE
 
sql™e3SaãtyCheckSickOrOk
(
sql™e3
*);

12856 
SQLITE_PRIVATE
 
sql™e3ChªgeCook›
(
P¬£
*, );

12858 #ià!
defšed
(
SQLITE_OMIT_VIEW
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

12859 
SQLITE_PRIVATE
 
sql™e3M©”ŸlizeV›w
(
P¬£
*, 
TabË
*, 
Ex´
*, );

12862 #iâdeà
SQLITE_OMIT_TRIGGER


12863 
SQLITE_PRIVATE
 
sql™e3BegšTrigg”
(
P¬£
*, 
Tok’
*,Tok’*,,,
IdLi¡
*,
SrcLi¡
*,

12864 
Ex´
*,, );

12865 
SQLITE_PRIVATE
 
sql™e3FšishTrigg”
(
P¬£
*, 
Trigg”S‹p
*, 
Tok’
*);

12866 
SQLITE_PRIVATE
 
sql™e3DrÝTrigg”
(
P¬£
*, 
SrcLi¡
*, );

12867 
SQLITE_PRIVATE
 
sql™e3DrÝTrigg”PŒ
(
P¬£
*, 
Trigg”
*);

12868 
SQLITE_PRIVATE
 
Trigg”
 *
sql™e3Trigg”sExi¡
(
P¬£
 *, 
TabË
*, , 
Ex´Li¡
*, *
pMask
);

12869 
SQLITE_PRIVATE
 
Trigg”
 *
sql™e3Trigg”Li¡
(
P¬£
 *, 
TabË
 *);

12870 
SQLITE_PRIVATE
 
sql™e3CodeRowTrigg”
(
P¬£
*, 
Trigg”
 *, , 
Ex´Li¡
*, , 
TabË
 *,

12872 
SQLITE_PRIVATE
 
sql™e3CodeRowTrigg”Dœeù
(
P¬£
 *, 
Trigg”
 *, 
TabË
 *, , , );

12873 
sql™eV›wTrigg”s
(
P¬£
*, 
TabË
*, 
Ex´
*, , 
Ex´Li¡
*);

12874 
SQLITE_PRIVATE
 
sql™e3D–‘eTrigg”S‹p
(
sql™e3
*, 
Trigg”S‹p
*);

12875 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”S–eùS‹p
(
sql™e3
*,
S–eù
*);

12876 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”In£¹S‹p
(
sql™e3
*,
Tok’
*, 
IdLi¡
*,

12877 
S–eù
*,
u8
);

12878 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”Upd©eS‹p
(
sql™e3
*,
Tok’
*,
Ex´Li¡
*, 
Ex´
*, 
u8
);

12879 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”D–‘eS‹p
(
sql™e3
*,
Tok’
*, 
Ex´
*);

12880 
SQLITE_PRIVATE
 
sql™e3D–‘eTrigg”
(
sql™e3
*, 
Trigg”
*);

12881 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eTrigg”
(
sql™e3
*,,const *);

12882 
SQLITE_PRIVATE
 
u32
 
sql™e3Trigg”CÞmask
(
P¬£
*,
Trigg”
*,
Ex´Li¡
*,,,
TabË
*,);

12883 
	#sql™e3P¬£TÝËv–
(
p
è(Õ)->
pTÝËv–
 ? (p)->pTÝËv– : (p))

	)

12885 
	#sql™e3Trigg”sExi¡
(
B
,
C
,
D
,
E
,
F
è0

	)

12886 
	#sql™e3D–‘eTrigg”
(
A
,
B
)

	)

12887 
	#sql™e3DrÝTrigg”PŒ
(
A
,
B
)

	)

12888 
	#sql™e3UÆškAndD–‘eTrigg”
(
A
,
B
,
C
)

	)

12889 
	#sql™e3CodeRowTrigg”
(
A
,
B
,
C
,
D
,
E
,
F
,
G
,
H
,
I
)

	)

12890 
	#sql™e3CodeRowTrigg”Dœeù
(
A
,
B
,
C
,
D
,
E
,
F
)

	)

12891 
	#sql™e3Trigg”Li¡
(
X
, 
Y
è0

	)

12892 
	#sql™e3P¬£TÝËv–
(
p
è
	)
p

12893 
	#sql™e3Trigg”CÞmask
(
A
,
B
,
C
,
D
,
E
,
F
,
G
è0

	)

12896 
SQLITE_PRIVATE
 
sql™e3JošTy³
(
P¬£
*, 
Tok’
*, Token*, Token*);

12897 
SQLITE_PRIVATE
 
sql™e3C»©eFÜeignKey
(
P¬£
*, 
Ex´Li¡
*, 
Tok’
*, ExprList*, );

12898 
SQLITE_PRIVATE
 
sql™e3DeãrFÜeignKey
(
P¬£
*, );

12899 #iâdeà
SQLITE_OMIT_AUTHORIZATION


12900 
SQLITE_PRIVATE
 
sql™e3AuthR—d
(
P¬£
*,
Ex´
*,
Schema
*,
SrcLi¡
*);

12901 
SQLITE_PRIVATE
 
sql™e3AuthCheck
(
P¬£
*,, const *, const *, const *);

12902 
SQLITE_PRIVATE
 
sql™e3AuthCÚ‹xtPush
(
P¬£
*, 
AuthCÚ‹xt
*, const *);

12903 
SQLITE_PRIVATE
 
sql™e3AuthCÚ‹xtPÝ
(
AuthCÚ‹xt
*);

12904 
SQLITE_PRIVATE
 
sql™e3AuthR—dCÞ
(
P¬£
*, const *, const *, );

12906 
	#sql™e3AuthR—d
(
a
,
b
,
c
,
d
)

	)

12907 
	#sql™e3AuthCheck
(
a
,
b
,
c
,
d
,
e
è
SQLITE_OK


	)

12908 
	#sql™e3AuthCÚ‹xtPush
(
a
,
b
,
c
)

	)

12909 
	#sql™e3AuthCÚ‹xtPÝ
(
a
è(()×))

	)

12911 
SQLITE_PRIVATE
 
sql™e3A‰ach
(
P¬£
*, 
Ex´
*, Expr*, Expr*);

12912 
SQLITE_PRIVATE
 
sql™e3D‘ach
(
P¬£
*, 
Ex´
*);

12913 
SQLITE_PRIVATE
 
sql™e3FixIn™
(
DbFix”
*, 
P¬£
*, , cÚ¡ *, cÚ¡ 
Tok’
*);

12914 
SQLITE_PRIVATE
 
sql™e3FixSrcLi¡
(
DbFix”
*, 
SrcLi¡
*);

12915 
SQLITE_PRIVATE
 
sql™e3FixS–eù
(
DbFix”
*, 
S–eù
*);

12916 
SQLITE_PRIVATE
 
sql™e3FixEx´
(
DbFix”
*, 
Ex´
*);

12917 
SQLITE_PRIVATE
 
sql™e3FixEx´Li¡
(
DbFix”
*, 
Ex´Li¡
*);

12918 
SQLITE_PRIVATE
 
sql™e3FixTrigg”S‹p
(
DbFix”
*, 
Trigg”S‹p
*);

12919 
SQLITE_PRIVATE
 
sql™e3AtoF
(cÚ¡ *
z
, *, , 
u8
);

12920 
SQLITE_PRIVATE
 
sql™e3G‘IÁ32
(const *, *);

12921 
SQLITE_PRIVATE
 
sql™e3Atoi
(const *);

12922 
SQLITE_PRIVATE
 
sql™e3Utf16By‹L’
(cÚ¡ *
pD©a
, 
nCh¬
);

12923 
SQLITE_PRIVATE
 
sql™e3Utf8Ch¬L’
(cÚ¡ *
pD©a
, 
nBy‹
);

12924 
SQLITE_PRIVATE
 
u32
 
sql™e3Utf8R—d
(cÚ¡ 
u8
**);

12925 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡
(
u64
);

12926 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡Add
(LogEst,LogEst);

12927 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


12928 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡FromDoubË
();

12930 
SQLITE_PRIVATE
 
u64
 
sql™e3LogE¡ToIÁ
(
LogE¡
);

12937 
SQLITE_PRIVATE
 
sql™e3PutV¬št
(*, 
u64
);

12938 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘V¬št
(cÚ¡ *, 
u64
 *);

12939 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘V¬št32
(cÚ¡ *, 
u32
 *);

12940 
SQLITE_PRIVATE
 
sql™e3V¬štL’
(
u64
 
v
);

12947 
	#g‘V¬št32
(
A
,
B
) \

12948 (
u8
)((*(
A
)<(u8)0x80)?((
B
)=(
u32
)*(A)),1:
	`sql™e3G‘V¬št32
((A),(u32 *)&(B)))

	)

12949 
	#putV¬št32
(
A
,
B
) \

12950 (
u8
)(((
u32
)(
B
)<(u32)0x80)?(*(
A
)=()(B)),1:\

12951 
	`sql™e3PutV¬št
((
A
),(
B
)))

	)

12952 
	#g‘V¬št
 
sql™e3G‘V¬št


	)

12953 
	#putV¬št
 
sql™e3PutV¬št


	)

12956 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3IndexAffš™ySŒ
(
Vdbe
 *, 
Index
 *);

12957 
SQLITE_PRIVATE
 
sql™e3TabËAffš™y
(
Vdbe
*, 
TabË
*, );

12958 
SQLITE_PRIVATE
 
sql™e3Com·»Affš™y
(
Ex´
 *
pEx´
, 
aff2
);

12959 
SQLITE_PRIVATE
 
sql™e3IndexAffš™yOk
(
Ex´
 *
pEx´
, 
idx_affš™y
);

12960 
SQLITE_PRIVATE
 
sql™e3Ex´Affš™y
(
Ex´
 *
pEx´
);

12961 
SQLITE_PRIVATE
 
sql™e3Atoi64
(cÚ¡ *, 
i64
*, , 
u8
);

12962 
SQLITE_PRIVATE
 
sql™e3DecOrHexToI64
(cÚ¡ *, 
i64
*);

12963 
SQLITE_PRIVATE
 
sql™e3E¼ÜW™hMsg
(
sql™e3
*, , const *,...);

12964 
SQLITE_PRIVATE
 
sql™e3E¼Ü
(
sql™e3
*,);

12965 
SQLITE_PRIVATE
 *
sql™e3HexToBlob
(
sql™e3
*, cÚ¡ *
z
, 
n
);

12966 
SQLITE_PRIVATE
 
u8
 
sql™e3HexToIÁ
(
h
);

12967 
SQLITE_PRIVATE
 
sql™e3TwoP¬tName
(
P¬£
 *, 
Tok’
 *, Token *, Token **);

12969 #ià
defšed
(
SQLITE_TEST
)

12970 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3E¼Name
();

12973 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3E¼SŒ
();

12974 
SQLITE_PRIVATE
 
sql™e3R—dSchema
(
P¬£
 *
pP¬£
);

12975 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3FšdCÞlSeq
(
sql™e3
*,
u8
 
’c
, const *,);

12976 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Loÿ‹CÞlSeq
(
P¬£
 *
pP¬£
, cÚ¡ *
zName
);

12977 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Ex´CÞlSeq
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
);

12978 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AddCÞÏ‹Tok’
(
P¬£
 *
pP¬£
, Ex´*, cÚ¡ 
Tok’
*);

12979 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AddCÞÏ‹SŒšg
(
P¬£
*,Expr*,const *);

12980 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´SkCÞÏ‹
(Expr*);

12981 
SQLITE_PRIVATE
 
sql™e3CheckCÞlSeq
(
P¬£
 *, 
CÞlSeq
 *);

12982 
SQLITE_PRIVATE
 
sql™e3CheckObjeùName
(
P¬£
 *, const *);

12983 
SQLITE_PRIVATE
 
sql™e3VdbeS‘Chªges
(
sql™e3
 *, );

12984 
SQLITE_PRIVATE
 
sql™e3AddIÁ64
(
i64
*,i64);

12985 
SQLITE_PRIVATE
 
sql™e3SubIÁ64
(
i64
*,i64);

12986 
SQLITE_PRIVATE
 
sql™e3MulIÁ64
(
i64
*,i64);

12987 
SQLITE_PRIVATE
 
sql™e3AbsIÁ32
();

12988 #ifdeà
SQLITE_ENABLE_8_3_NAMES


12989 
SQLITE_PRIVATE
 
sql™e3FžeSuffix3
(const *, *);

12991 
	#sql™e3FžeSuffix3
(
X
,
Y
)

	)

12993 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘BoÞ—n
(cÚ¡ *
z
,u8);

12995 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3V®ueText
(
sql™e3_v®ue
*, 
u8
);

12996 
SQLITE_PRIVATE
 
sql™e3V®ueBy‹s
(
sql™e3_v®ue
*, 
u8
);

12997 
SQLITE_PRIVATE
 
sql™e3V®ueS‘SŒ
(
sql™e3_v®ue
*, , cÚ¡ *,
u8
,

12999 
SQLITE_PRIVATE
 
sql™e3V®ueS‘NuÎ
(
sql™e3_v®ue
*);

13000 
SQLITE_PRIVATE
 
sql™e3V®ueF»e
(
sql™e3_v®ue
*);

13001 
SQLITE_PRIVATE
 
sql™e3_v®ue
 *
sql™e3V®ueNew
(
sql™e3
 *);

13002 
SQLITE_PRIVATE
 *
sql™e3Utf16to8
(
sql™e3
 *, cÚ¡ *, , 
u8
);

13003 
SQLITE_PRIVATE
 
sql™e3V®ueFromEx´
(
sql™e3
 *, 
Ex´
 *, 
u8
, u8, 
sql™e3_v®ue
 **);

13004 
SQLITE_PRIVATE
 
sql™e3V®ueAµlyAffš™y
(
sql™e3_v®ue
 *, 
u8
, u8);

13005 #iâdeà
SQLITE_AMALGAMATION


13006 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3OpcodePrÝ”ty
[];

13007 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Uµ”ToLow”
[];

13008 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Cty³M­
[];

13009 
SQLITE_PRIVATE
 cÚ¡ 
Tok’
 
sql™e3IÁTok’s
[];

13010 
SQLITE_PRIVATE
 
SQLITE_WSD
 
Sql™e3CÚfig
 
sql™e3CÚfig
;

13011 
SQLITE_PRIVATE
 
SQLITE_WSD
 
FuncDefHash
 
sql™e3Glob®FunùiÚs
;

13012 #iâdeà
SQLITE_OMIT_WSD


13013 
SQLITE_PRIVATE
 
sql™e3P’dšgBy‹
;

13016 
SQLITE_PRIVATE
 
sql™e3RoÙPageMoved
(
sql™e3
*, , , );

13017 
SQLITE_PRIVATE
 
sql™e3Rešdex
(
P¬£
*, 
Tok’
*, Token*);

13018 
SQLITE_PRIVATE
 
sql™e3AÉ”FunùiÚs
();

13019 
SQLITE_PRIVATE
 
sql™e3AÉ”R’ameTabË
(
P¬£
*, 
SrcLi¡
*, 
Tok’
*);

13020 
SQLITE_PRIVATE
 
sql™e3G‘Tok’
(const *, *);

13021 
SQLITE_PRIVATE
 
sql™e3Ne¡edP¬£
(
P¬£
*, const *, ...);

13022 
SQLITE_PRIVATE
 
sql™e3ExpœeP»·»dS‹m’ts
(
sql™e3
*);

13023 
SQLITE_PRIVATE
 
sql™e3CodeSub£Ëù
(
P¬£
 *, 
Ex´
 *, , );

13024 
SQLITE_PRIVATE
 
sql™e3S–eùP»p
(
P¬£
*, 
S–eù
*, 
NameCÚ‹xt
*);

13025 
SQLITE_PRIVATE
 
sql™e3M©chS·nName
(const *, const *, const *, const *);

13026 
SQLITE_PRIVATE
 
sql™e3ResÞveEx´Names
(
NameCÚ‹xt
*, 
Ex´
*);

13027 
SQLITE_PRIVATE
 
sql™e3ResÞveS–eùNames
(
P¬£
*, 
S–eù
*, 
NameCÚ‹xt
*);

13028 
SQLITE_PRIVATE
 
sql™e3ResÞveS–fReã»nû
(
P¬£
*,
TabË
*,,
Ex´
*,
Ex´Li¡
*);

13029 
SQLITE_PRIVATE
 
sql™e3ResÞveOrd”GroupBy
(
P¬£
*, 
S–eù
*, 
Ex´Li¡
*, const *);

13030 
SQLITE_PRIVATE
 
sql™e3CÞumnDeçuÉ
(
Vdbe
 *, 
TabË
 *, , );

13031 
SQLITE_PRIVATE
 
sql™e3AÉ”FšishAddCÞumn
(
P¬£
 *, 
Tok’
 *);

13032 
SQLITE_PRIVATE
 
sql™e3AÉ”BegšAddCÞumn
(
P¬£
 *, 
SrcLi¡
 *);

13033 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3G‘CÞlSeq
(
P¬£
*, 
u8
, CollSeq *, const *);

13034 
SQLITE_PRIVATE
 
sql™e3Affš™yTy³
(cÚ¡ *, 
u8
*);

13035 
SQLITE_PRIVATE
 
sql™e3AÇlyze
(
P¬£
*, 
Tok’
*, Token*);

13036 
SQLITE_PRIVATE
 
sql™e3InvokeBusyHªdËr
(
BusyHªdËr
*);

13037 
SQLITE_PRIVATE
 
sql™e3FšdDb
(
sql™e3
*, 
Tok’
*);

13038 
SQLITE_PRIVATE
 
sql™e3FšdDbName
(
sql™e3
 *, const *);

13039 
SQLITE_PRIVATE
 
sql™e3AÇlysisLßd
(
sql™e3
*,
iDB
);

13040 
SQLITE_PRIVATE
 
sql™e3D–‘eIndexSam¶es
(
sql™e3
*,
Index
*);

13041 
SQLITE_PRIVATE
 
sql™e3DeçuÉRowE¡
(
Index
*);

13042 
SQLITE_PRIVATE
 
sql™e3Regi¡”LikeFunùiÚs
(
sql™e3
*, );

13043 
SQLITE_PRIVATE
 
sql™e3IsLikeFunùiÚ
(
sql™e3
*,
Ex´
*,*,*);

13044 
SQLITE_PRIVATE
 
sql™e3MšimumFžeFÜm©
(
P¬£
*, , );

13045 
SQLITE_PRIVATE
 
sql™e3SchemaCË¬
(*);

13046 
SQLITE_PRIVATE
 
Schema
 *
sql™e3SchemaG‘
(
sql™e3
 *, 
BŒ“
 *);

13047 
SQLITE_PRIVATE
 
sql™e3SchemaToIndex
(
sql™e3
 *
db
, 
Schema
 *);

13048 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoAÎoc
(
sql™e3
*,,);

13049 
SQLITE_PRIVATE
 
sql™e3KeyInfoUÄef
(
KeyInfo
*);

13050 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoRef
(KeyInfo*);

13051 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoOfIndex
(
P¬£
*, 
Index
*);

13052 #ifdeà
SQLITE_DEBUG


13053 
SQLITE_PRIVATE
 
sql™e3KeyInfoIsWr™—bË
(
KeyInfo
*);

13055 
SQLITE_PRIVATE
 
sql™e3C»©eFunc
(
sql™e3
 *, const *, , , *,

13056 (*)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

13057 (*)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **), (*)(sqlite3_context*),

13058 
FuncDe¡ruùÜ
 *
pDe¡ruùÜ


13060 
SQLITE_PRIVATE
 
sql™e3ApiEx™
(
sql™e3
 *
db
, );

13061 
SQLITE_PRIVATE
 
sql™e3O³nTempD©aba£
(
P¬£
 *);

13063 
SQLITE_PRIVATE
 
sql™e3SŒAccumIn™
(
SŒAccum
*, *, , );

13064 
SQLITE_PRIVATE
 
sql™e3SŒAccumAµ’d
(
SŒAccum
*,const *,);

13065 
SQLITE_PRIVATE
 
sql™e3SŒAccumAµ’dAÎ
(
SŒAccum
*,const *);

13066 
SQLITE_PRIVATE
 
sql™e3Aµ’dCh¬
(
SŒAccum
*,,);

13067 
SQLITE_PRIVATE
 *
sql™e3SŒAccumFšish
(
SŒAccum
*);

13068 
SQLITE_PRIVATE
 
sql™e3SŒAccumRe£t
(
SŒAccum
*);

13069 
SQLITE_PRIVATE
 
sql™e3S–eùDe¡In™
(
S–eùDe¡
*,,);

13070 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3C»©eCÞumnEx´
(
sql™e3
 *, 
SrcLi¡
 *, , );

13072 
SQLITE_PRIVATE
 
sql™e3BackupRe¡¬t
(
sql™e3_backup
 *);

13073 
SQLITE_PRIVATE
 
sql™e3BackupUpd©e
(
sql™e3_backup
 *, 
Pgno
, cÚ¡ 
u8
 *);

13075 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


13076 
SQLITE_PRIVATE
 
sql™e3AÇlyzeFunùiÚs
();

13077 
SQLITE_PRIVATE
 
sql™e3St4ProbeS‘V®ue
(
P¬£
*,
Index
*,
UÅackedRecÜd
**,
Ex´
*,
u8
,,*);

13078 
SQLITE_PRIVATE
 
sql™e3St4V®ueFromEx´
(
P¬£
*, 
Ex´
*, 
u8
, 
sql™e3_v®ue
**);

13079 
SQLITE_PRIVATE
 
sql™e3St4ProbeF»e
(
UÅackedRecÜd
*);

13080 
SQLITE_PRIVATE
 
sql™e3St4CÞumn
(
sql™e3
*, cÚ¡ *, , , 
sql™e3_v®ue
**);

13086 
SQLITE_PRIVATE
 *
sql™e3P¬£rAÎoc
(*(*)(
u64
));

13087 
SQLITE_PRIVATE
 
sql™e3P¬£rF»e
(*, (*)(*));

13088 
SQLITE_PRIVATE
 
sql™e3P¬£r
(*, , 
Tok’
, 
P¬£
*);

13089 #ifdeà
YYTRACKMAXSTACKDEPTH


13090 
SQLITE_PRIVATE
 
sql™e3P¬£rSckP—k
(*);

13093 
SQLITE_PRIVATE
 
sql™e3AutoLßdEx‹nsiÚs
(
sql™e3
*);

13094 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


13095 
SQLITE_PRIVATE
 
sql™e3Clo£Ex‹nsiÚs
(
sql™e3
*);

13097 
	#sql™e3Clo£Ex‹nsiÚs
(
X
)

	)

13100 #iâdeà
SQLITE_OMIT_SHARED_CACHE


13101 
SQLITE_PRIVATE
 
sql™e3TabËLock
(
P¬£
 *, , , 
u8
, const *);

13103 
	#sql™e3TabËLock
(
v
,
w
,
x
,
y
,
z
)

	)

13106 #ifdeà
SQLITE_TEST


13107 
SQLITE_PRIVATE
 
sql™e3Utf8To8
(*);

13110 #ifdeà
SQLITE_OMIT_VIRTUALTABLE


13111 
	#sql™e3VbCË¬
(
Y
)

	)

13112 
	#sql™e3VbSync
(
X
,
Y
è
SQLITE_OK


	)

13113 
	#sql™e3VbRÞlback
(
X
)

	)

13114 
	#sql™e3VbComm™
(
X
)

	)

13115 
	#sql™e3VbInSync
(
db
è0

	)

13116 
	#sql™e3VbLock
(
X
)

	)

13117 
	#sql™e3VbUÆock
(
X
)

	)

13118 
	#sql™e3VbUÆockLi¡
(
X
)

	)

13119 
	#sql™e3VbSav•ošt
(
X
, 
Y
, 
Z
è
SQLITE_OK


	)

13120 
	#sql™e3G‘VTabË
(
X
,
Y
è((
VTabË
*)0)

	)

13122 
SQLITE_PRIVATE
 
sql™e3VbCË¬
(
sql™e3
 *
db
, 
TabË
*);

13123 
SQLITE_PRIVATE
 
sql™e3VbDiscÚÃù
(
sql™e3
 *
db
, 
TabË
 *
p
);

13124 
SQLITE_PRIVATE
 
sql™e3VbSync
(
sql™e3
 *
db
, 
Vdbe
*);

13125 
SQLITE_PRIVATE
 
sql™e3VbRÞlback
(
sql™e3
 *
db
);

13126 
SQLITE_PRIVATE
 
sql™e3VbComm™
(
sql™e3
 *
db
);

13127 
SQLITE_PRIVATE
 
sql™e3VbLock
(
VTabË
 *);

13128 
SQLITE_PRIVATE
 
sql™e3VbUÆock
(
VTabË
 *);

13129 
SQLITE_PRIVATE
 
sql™e3VbUÆockLi¡
(
sql™e3
*);

13130 
SQLITE_PRIVATE
 
sql™e3VbSav•ošt
(
sql™e3
 *, , );

13131 
SQLITE_PRIVATE
 
sql™e3VbImpÜtE¼msg
(
Vdbe
*, 
sql™e3_vb
*);

13132 
SQLITE_PRIVATE
 
VTabË
 *
sql™e3G‘VTabË
(
sql™e3
*, 
TabË
*);

13133 
	#sql™e3VbInSync
(
db
è((db)->
nVT¿ns
>0 && (db)->
aVT¿ns
==0)

	)

13135 
SQLITE_PRIVATE
 
sql™e3VbMakeWr™abË
(
P¬£
*,
TabË
*);

13136 
SQLITE_PRIVATE
 
sql™e3VbBegšP¬£
(
P¬£
*, 
Tok’
*, Token*, Token*, );

13137 
SQLITE_PRIVATE
 
sql™e3VbFšishP¬£
(
P¬£
*, 
Tok’
*);

13138 
SQLITE_PRIVATE
 
sql™e3VbArgIn™
(
P¬£
*);

13139 
SQLITE_PRIVATE
 
sql™e3VbArgEx‹nd
(
P¬£
*, 
Tok’
*);

13140 
SQLITE_PRIVATE
 
sql™e3VbC®lC»©e
(
sql™e3
*, , const *, **);

13141 
SQLITE_PRIVATE
 
sql™e3VbC®lCÚÃù
(
P¬£
*, 
TabË
*);

13142 
SQLITE_PRIVATE
 
sql™e3VbC®lDe¡roy
(
sql™e3
*, , const *);

13143 
SQLITE_PRIVATE
 
sql™e3VbBegš
(
sql™e3
 *, 
VTabË
 *);

13144 
SQLITE_PRIVATE
 
FuncDef
 *
sql™e3VbOv”lßdFunùiÚ
(
sql™e3
 *,FuncDef*, 
nArg
, 
Ex´
*);

13145 
SQLITE_PRIVATE
 
sql™e3Inv®idFunùiÚ
(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**);

13146 
SQLITE_PRIVATE
 
sql™e3_št64
 
sql™e3StmtCu¼’tTime
(
sql™e3_cÚ‹xt
*);

13147 
SQLITE_PRIVATE
 
sql™e3VdbeP¬am‘”Index
(
Vdbe
*, const *, );

13148 
SQLITE_PRIVATE
 
sql™e3T¿nsãrBšdšgs
(
sql™e3_¡mt
 *, sqlite3_stmt *);

13149 
SQLITE_PRIVATE
 
sql™e3P¬£rRe£t
(
P¬£
*);

13150 
SQLITE_PRIVATE
 
sql™e3R•»·»
(
Vdbe
*);

13151 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡CheckL’gth
(
P¬£
*, 
Ex´Li¡
*, const *);

13152 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Bš¬yCom·»CÞlSeq
(
P¬£
 *, 
Ex´
 *, Expr *);

13153 
SQLITE_PRIVATE
 
sql™e3TempInMemÜy
(cÚ¡ 
sql™e3
*);

13154 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Jouº®Mod’ame
();

13155 #iâdeà
SQLITE_OMIT_WAL


13156 
SQLITE_PRIVATE
 
sql™e3Checkpošt
(
sql™e3
*, , , *, *);

13157 
SQLITE_PRIVATE
 
sql™e3W®DeçuÉHook
(*,
sql™e3
*,const *,);

13159 #iâdeà
SQLITE_OMIT_CTE


13160 
SQLITE_PRIVATE
 
W™h
 *
sql™e3W™hAdd
(
P¬£
*,W™h*,
Tok’
*,
Ex´Li¡
*,
S–eù
*);

13161 
SQLITE_PRIVATE
 
sql™e3W™hD–‘e
(
sql™e3
*,
W™h
*);

13162 
SQLITE_PRIVATE
 
sql™e3W™hPush
(
P¬£
*, 
W™h
*, 
u8
);

13164 
	#sql™e3W™hPush
(
x
,
y
,
z
)

	)

13165 
	#sql™e3W™hD–‘e
(
x
,
y
)

	)

13175 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

13176 
SQLITE_PRIVATE
 
sql™e3FkCheck
(
P¬£
*, 
TabË
*, , , *, );

13177 
SQLITE_PRIVATE
 
sql™e3FkDrÝTabË
(
P¬£
*, 
SrcLi¡
 *, 
TabË
*);

13178 
SQLITE_PRIVATE
 
sql™e3FkAùiÚs
(
P¬£
*, 
TabË
*, 
Ex´Li¡
*, , *, );

13179 
SQLITE_PRIVATE
 
sql™e3FkRequœed
(
P¬£
*, 
TabË
*, *, );

13180 
SQLITE_PRIVATE
 
u32
 
sql™e3FkOldmask
(
P¬£
*, 
TabË
*);

13181 
SQLITE_PRIVATE
 
FKey
 *
sql™e3FkReã»nûs
(
TabË
 *);

13183 
	#sql™e3FkAùiÚs
(
a
,
b
,
c
,
d
,
e
,
f
)

	)

13184 
	#sql™e3FkCheck
(
a
,
b
,
c
,
d
,
e
,
f
)

	)

13185 
	#sql™e3FkDrÝTabË
(
a
,
b
,
c
)

	)

13186 
	#sql™e3FkOldmask
(
a
,
b
è0

	)

13187 
	#sql™e3FkRequœed
(
a
,
b
,
c
,
d
è0

	)

13189 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


13190 
SQLITE_PRIVATE
 
sql™e3FkD–‘e
(
sql™e3
 *, 
TabË
*);

13191 
SQLITE_PRIVATE
 
sql™e3FkLoÿ‹Index
(
P¬£
*,
TabË
*,
FKey
*,
Index
**,**);

13193 
	#sql™e3FkD–‘e
(
a
,
b
)

	)

13194 
	#sql™e3FkLoÿ‹Index
(
a
,
b
,
c
,
d
,
e
)

	)

13201 
	#SQLITE_FAULTINJECTOR_MALLOC
 0

	)

13202 
	#SQLITE_FAULTINJECTOR_COUNT
 1

	)

13209 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


13210 
SQLITE_PRIVATE
 
sql™e3BegšB’ignM®loc
();

13211 
SQLITE_PRIVATE
 
sql™e3EndB’ignM®loc
();

13213 
	#sql™e3BegšB’ignM®loc
()

	)

13214 
	#sql™e3EndB’ignM®loc
()

	)

13220 
	#IN_INDEX_ROWID
 1

	)

13221 
	#IN_INDEX_EPH
 2

	)

13222 
	#IN_INDEX_INDEX_ASC
 3

	)

13223 
	#IN_INDEX_INDEX_DESC
 4

	)

13224 
	#IN_INDEX_NOOP
 5

	)

13228 
	#IN_INDEX_NOOP_OK
 0x0001

	)

13229 
	#IN_INDEX_MEMBERSHIP
 0x0002

	)

13230 
	#IN_INDEX_LOOP
 0x0004

	)

13231 
SQLITE_PRIVATE
 
sql™e3FšdInIndex
(
P¬£
 *, 
Ex´
 *, 
u32
, *);

13233 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


13234 
SQLITE_PRIVATE
 
sql™e3Jouº®O³n
(
sql™e3_vfs
 *, cÚ¡ *, 
sql™e3_fže
 *, , );

13235 
SQLITE_PRIVATE
 
sql™e3Jouº®Size
(
sql™e3_vfs
 *);

13236 
SQLITE_PRIVATE
 
sql™e3Jouº®C»©e
(
sql™e3_fže
 *);

13237 
SQLITE_PRIVATE
 
sql™e3Jouº®Exi¡s
(
sql™e3_fže
 *
p
);

13239 
	#sql™e3Jouº®Size
(
pVfs
è(ÕVfs)->
szOsFže
)

	)

13240 
	#sql™e3Jouº®Exi¡s
(
p
è1

	)

13243 
SQLITE_PRIVATE
 
sql™e3MemJouº®O³n
(
sql™e3_fže
 *);

13244 
SQLITE_PRIVATE
 
sql™e3MemJouº®Size
();

13245 
SQLITE_PRIVATE
 
sql™e3IsMemJouº®
(
sql™e3_fže
 *);

13247 #ià
SQLITE_MAX_EXPR_DEPTH
>0

13248 
SQLITE_PRIVATE
 
sql™e3Ex´S‘Height
(
P¬£
 *
pP¬£
, 
Ex´
 *
p
);

13249 
SQLITE_PRIVATE
 
sql™e3S–eùEx´Height
(
S–eù
 *);

13250 
SQLITE_PRIVATE
 
sql™e3Ex´CheckHeight
(
P¬£
*, );

13252 
	#sql™e3Ex´S‘Height
(
x
,
y
)

	)

13253 
	#sql™e3S–eùEx´Height
(
x
è0

	)

13254 
	#sql™e3Ex´CheckHeight
(
x
,
y
)

	)

13257 
SQLITE_PRIVATE
 
u32
 
sql™e3G‘4by‹
(cÚ¡ 
u8
*);

13258 
SQLITE_PRIVATE
 
sql™e3Put4by‹
(
u8
*, 
u32
);

13260 #ifdeà
SQLITE_ENABLE_UNLOCK_NOTIFY


13261 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚBlocked
(
sql™e3
 *, sqlite3 *);

13262 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚUÆocked
(
sql™e3
 *
db
);

13263 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚClo£d
(
sql™e3
 *
db
);

13265 
	#sql™e3CÚÃùiÚBlocked
(
x
,
y
)

	)

13266 
	#sql™e3CÚÃùiÚUÆocked
(
x
)

	)

13267 
	#sql™e3CÚÃùiÚClo£d
(
x
)

	)

13270 #ifdeà
SQLITE_DEBUG


13271 
SQLITE_PRIVATE
 
sql™e3P¬£rT¿û
(
FILE
*, *);

13279 #ifdeà
SQLITE_ENABLE_IOTRACE


13280 
	#IOTRACE
(
A
èifÐ
sql™e3IoT¿û
 ){ sql™e3IoT¿û A; }

	)

13281 
SQLITE_PRIVATE
 
sql™e3VdbeIOT¿ûSql
(
Vdbe
*);

13282 
SQLITE_PRIVATE
 (*
sql™e3IoT¿û
)(const *,...);

13284 
	#IOTRACE
(
A
)

	)

13285 
	#sql™e3VdbeIOT¿ûSql
(
X
)

	)

13316 #ifdeà
SQLITE_MEMDEBUG


13317 
SQLITE_PRIVATE
 
sql™e3MemdebugS‘Ty³
(*,
u8
);

13318 
SQLITE_PRIVATE
 
sql™e3MemdebugHasTy³
(*,
u8
);

13319 
SQLITE_PRIVATE
 
sql™e3MemdebugNoTy³
(*,
u8
);

13321 
	#sql™e3MemdebugS‘Ty³
(
X
,
Y
è

	)

13322 
	#sql™e3MemdebugHasTy³
(
X
,
Y
è1

	)

13323 
	#sql™e3MemdebugNoTy³
(
X
,
Y
è1

	)

13325 
	#MEMTYPE_HEAP
 0x01

	)

13326 
	#MEMTYPE_LOOKASIDE
 0x02

	)

13327 
	#MEMTYPE_SCRATCH
 0x04

	)

13328 
	#MEMTYPE_PCACHE
 0x08

	)

13333 #ià
SQLITE_MAX_WORKER_THREADS
>0

13334 
SQLITE_PRIVATE
 
sql™e3Th»adC»©e
(
SQL™eTh»ad
**,*(*)(*),*);

13335 
SQLITE_PRIVATE
 
sql™e3Th»adJoš
(
SQL™eTh»ad
*, **);

13364 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Uµ”ToLow”
[] = {

13365 #ifdeà
SQLITE_ASCII


13382 #ifdeà
SQLITE_EBCDIC


13432 #ifdeà
SQLITE_ASCII


13433 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3Cty³M­
[256] = {

13479 #iâdeà
SQLITE_USE_URI


13480 
	#SQLITE_USE_URI
 0

	)

13483 #iâdeà
SQLITE_ALLOW_COVERING_INDEX_SCAN


13484 
	#SQLITE_ALLOW_COVERING_INDEX_SCAN
 1

	)

13491 
SQLITE_PRIVATE
 
SQLITE_WSD
 
Sql™e3CÚfig
 
sql™e3CÚfig
 = {

13492 
SQLITE_DEFAULT_MEMSTATUS
,

13494 
SQLITE_THREADSAFE
==1,

13495 
SQLITE_USE_URI
,

13496 
SQLITE_ALLOW_COVERING_INDEX_SCAN
,

13507 
SQLITE_DEFAULT_MMAP_SIZE
,

13508 
SQLITE_MAX_MMAP_SIZE
,

13527 #ifdeà
SQLITE_ENABLE_SQLLOG


13531 #ifdeà
SQLITE_VDBE_COVERAGE


13535 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


13546 
SQLITE_PRIVATE
 
SQLITE_WSD
 
FuncDefHash
 
sql™e3Glob®FunùiÚs
;

13551 
SQLITE_PRIVATE
 cÚ¡ 
Tok’
 
sql™e3IÁTok’s
[] = {

13575 #iâdeà
SQLITE_OMIT_WSD


13576 
SQLITE_PRIVATE
 
sql™e3P’dšgBy‹
 = 0x40000000;

13585 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3OpcodePrÝ”ty
[] = 
OPFLG_INITIALIZER
;

13605 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


13616 cÚ¡ * cÚ¡ 
azCompžeO±
[] = {

13620 
	#CTIMEOPT_VAL_
(
Ýt
è#Ýt

	)

13621 
	#CTIMEOPT_VAL
(
Ýt
è
	`CTIMEOPT_VAL_
(Ýt)

	)

13623 #ifdeà
SQLITE_32BIT_ROWID


13626 #ifdeà
SQLITE_4_BYTE_ALIGNED_MALLOC


13629 #ifdeà
SQLITE_CASE_SENSITIVE_LIKE


13632 #ifdeà
SQLITE_CHECK_PAGES


13635 #ifdeà
SQLITE_COVERAGE_TEST


13638 #ifdeà
SQLITE_DEBUG


13641 #ifdeà
SQLITE_DEFAULT_LOCKING_MODE


13642 "DEFAULT_LOCKING_MODE=" 
CTIMEOPT_VAL
(
SQLITE_DEFAULT_LOCKING_MODE
),

13644 #ià
defšed
(
SQLITE_DEFAULT_MMAP_SIZE
è&& !defšed(
SQLITE_DEFAULT_MMAP_SIZE_xc
)

13645 "DEFAULT_MMAP_SIZE=" 
CTIMEOPT_VAL
(
SQLITE_DEFAULT_MMAP_SIZE
),

13647 #ifdeà
SQLITE_DISABLE_DIRSYNC


13650 #ifdeà
SQLITE_DISABLE_LFS


13653 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


13656 #ifdeà
SQLITE_ENABLE_CEROD


13659 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


13662 #ifdeà
SQLITE_ENABLE_EXPENSIVE_ASSERT


13665 #ifdeà
SQLITE_ENABLE_FTS1


13668 #ifdeà
SQLITE_ENABLE_FTS2


13671 #ifdeà
SQLITE_ENABLE_FTS3


13674 #ifdeà
SQLITE_ENABLE_FTS3_PARENTHESIS


13677 #ifdeà
SQLITE_ENABLE_FTS4


13680 #ifdeà
SQLITE_ENABLE_ICU


13683 #ifdeà
SQLITE_ENABLE_IOTRACE


13686 #ifdeà
SQLITE_ENABLE_LOAD_EXTENSION


13689 #ifdeà
SQLITE_ENABLE_LOCKING_STYLE


13690 "ENABLE_LOCKING_STYLE=" 
CTIMEOPT_VAL
(
SQLITE_ENABLE_LOCKING_STYLE
),

13692 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


13695 #ifdeà
SQLITE_ENABLE_MEMSYS3


13698 #ifdeà
SQLITE_ENABLE_MEMSYS5


13701 #ifdeà
SQLITE_ENABLE_OVERSIZE_CELL_CHECK


13704 #ifdeà
SQLITE_ENABLE_RTREE


13707 #ià
defšed
(
SQLITE_ENABLE_STAT4
)

13709 #–ià
defšed
(
SQLITE_ENABLE_STAT3
)

13712 #ifdeà
SQLITE_ENABLE_UNLOCK_NOTIFY


13715 #ifdeà
SQLITE_ENABLE_UPDATE_DELETE_LIMIT


13718 #ifdeà
SQLITE_HAS_CODEC


13721 #ifdeà
SQLITE_HAVE_ISNAN


13724 #ifdeà
SQLITE_HOMEGROWN_RECURSIVE_MUTEX


13727 #ifdeà
SQLITE_IGNORE_AFP_LOCK_ERRORS


13730 #ifdeà
SQLITE_IGNORE_FLOCK_LOCK_ERRORS


13733 #ifdeà
SQLITE_INT64_TYPE


13736 #ifdeà
SQLITE_LOCK_TRACE


13739 #ià
defšed
(
SQLITE_MAX_MMAP_SIZE
è&& !defšed(
SQLITE_MAX_MMAP_SIZE_xc
)

13740 "MAX_MMAP_SIZE=" 
CTIMEOPT_VAL
(
SQLITE_MAX_MMAP_SIZE
),

13742 #ifdeà
SQLITE_MAX_SCHEMA_RETRY


13743 "MAX_SCHEMA_RETRY=" 
CTIMEOPT_VAL
(
SQLITE_MAX_SCHEMA_RETRY
),

13745 #ifdeà
SQLITE_MEMDEBUG


13748 #ifdeà
SQLITE_MIXED_ENDIAN_64BIT_FLOAT


13751 #ifdeà
SQLITE_NO_SYNC


13754 #ifdeà
SQLITE_OMIT_ALTERTABLE


13757 #ifdeà
SQLITE_OMIT_ANALYZE


13760 #ifdeà
SQLITE_OMIT_ATTACH


13763 #ifdeà
SQLITE_OMIT_AUTHORIZATION


13766 #ifdeà
SQLITE_OMIT_AUTOINCREMENT


13769 #ifdeà
SQLITE_OMIT_AUTOINIT


13772 #ifdeà
SQLITE_OMIT_AUTOMATIC_INDEX


13775 #ifdeà
SQLITE_OMIT_AUTORESET


13778 #ifdeà
SQLITE_OMIT_AUTOVACUUM


13781 #ifdeà
SQLITE_OMIT_BETWEEN_OPTIMIZATION


13784 #ifdeà
SQLITE_OMIT_BLOB_LITERAL


13787 #ifdeà
SQLITE_OMIT_BTREECOUNT


13790 #ifdeà
SQLITE_OMIT_BUILTIN_TEST


13793 #ifdeà
SQLITE_OMIT_CAST


13796 #ifdeà
SQLITE_OMIT_CHECK


13799 #ifdeà
SQLITE_OMIT_COMPLETE


13802 #ifdeà
SQLITE_OMIT_COMPOUND_SELECT


13805 #ifdeà
SQLITE_OMIT_CTE


13808 #ifdeà
SQLITE_OMIT_DATETIME_FUNCS


13811 #ifdeà
SQLITE_OMIT_DECLTYPE


13814 #ifdeà
SQLITE_OMIT_DEPRECATED


13817 #ifdeà
SQLITE_OMIT_DISKIO


13820 #ifdeà
SQLITE_OMIT_EXPLAIN


13823 #ifdeà
SQLITE_OMIT_FLAG_PRAGMAS


13826 #ifdeà
SQLITE_OMIT_FLOATING_POINT


13829 #ifdeà
SQLITE_OMIT_FOREIGN_KEY


13832 #ifdeà
SQLITE_OMIT_GET_TABLE


13835 #ifdeà
SQLITE_OMIT_INCRBLOB


13838 #ifdeà
SQLITE_OMIT_INTEGRITY_CHECK


13841 #ifdeà
SQLITE_OMIT_LIKE_OPTIMIZATION


13844 #ifdeà
SQLITE_OMIT_LOAD_EXTENSION


13847 #ifdeà
SQLITE_OMIT_LOCALTIME


13850 #ifdeà
SQLITE_OMIT_LOOKASIDE


13853 #ifdeà
SQLITE_OMIT_MEMORYDB


13856 #ifdeà
SQLITE_OMIT_OR_OPTIMIZATION


13859 #ifdeà
SQLITE_OMIT_PAGER_PRAGMAS


13862 #ifdeà
SQLITE_OMIT_PRAGMA


13865 #ifdeà
SQLITE_OMIT_PROGRESS_CALLBACK


13868 #ifdeà
SQLITE_OMIT_QUICKBALANCE


13871 #ifdeà
SQLITE_OMIT_REINDEX


13874 #ifdeà
SQLITE_OMIT_SCHEMA_PRAGMAS


13877 #ifdeà
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS


13880 #ifdeà
SQLITE_OMIT_SHARED_CACHE


13883 #ifdeà
SQLITE_OMIT_SUBQUERY


13886 #ifdeà
SQLITE_OMIT_TCL_VARIABLE


13889 #ifdeà
SQLITE_OMIT_TEMPDB


13892 #ifdeà
SQLITE_OMIT_TRACE


13895 #ifdeà
SQLITE_OMIT_TRIGGER


13898 #ifdeà
SQLITE_OMIT_TRUNCATE_OPTIMIZATION


13901 #ifdeà
SQLITE_OMIT_UTF16


13904 #ifdeà
SQLITE_OMIT_VACUUM


13907 #ifdeà
SQLITE_OMIT_VIEW


13910 #ifdeà
SQLITE_OMIT_VIRTUALTABLE


13913 #ifdeà
SQLITE_OMIT_WAL


13916 #ifdeà
SQLITE_OMIT_WSD


13919 #ifdeà
SQLITE_OMIT_XFER_OPT


13922 #ifdeà
SQLITE_PERFORMANCE_TRACE


13925 #ifdeà
SQLITE_PROXY_DEBUG


13928 #ifdeà
SQLITE_RTREE_INT_ONLY


13931 #ifdeà
SQLITE_SECURE_DELETE


13934 #ifdeà
SQLITE_SMALL_STACK


13937 #ifdeà
SQLITE_SOUNDEX


13940 #ifdeà
SQLITE_SYSTEM_MALLOC


13943 #ifdeà
SQLITE_TCL


13946 #ià
defšed
(
SQLITE_TEMP_STORE
è&& !defšed(
SQLITE_TEMP_STORE_xc
)

13947 "TEMP_STORE=" 
CTIMEOPT_VAL
(
SQLITE_TEMP_STORE
),

13949 #ifdeà
SQLITE_TEST


13952 #ià
defšed
(
SQLITE_THREADSAFE
)

13953 "THREADSAFE=" 
CTIMEOPT_VAL
(
SQLITE_THREADSAFE
),

13955 #ifdeà
SQLITE_USE_ALLOCA


13958 #ifdeà
SQLITE_USER_AUTHENTICATION


13961 #ifdeà
SQLITE_WIN32_MALLOC


13964 #ifdeà
SQLITE_ZERO_MALLOC


13976 
SQLITE_API
 
sql™e3_compžeÝtiÚ_u£d
(cÚ¡ *
zO±Name
){

13977 
i
, 
n
;

13978 ifÐ
sql™e3SŒNICmp
(
zO±Name
, "SQLITE_", 7)==0 ) zOptName += 7;

13979 
n
 = 
sql™e3SŒËn30
(
zO±Name
);

13983 
i
=0; i<
A¼aySize
(
azCompžeO±
); i++){

13984 ifÐ
sql™e3SŒNICmp
(
zO±Name
, 
azCompžeO±
[
i
], 
n
)==0

13985 && 
sql™e3IsIdCh¬
(()
azCompžeO±
[
i
][
n
])==0

13997 
SQLITE_API
 cÚ¡ *
sql™e3_compžeÝtiÚ_g‘
(
N
){

13998 ifÐ
N
>=0 && N<
A¼aySize
(
azCompžeO±
) ){

13999  
azCompžeO±
[
N
];

14042 #iâdeà
_VDBEINT_H_


14043 
	#_VDBEINT_H_


	)

14049 #iâdeà
SQLITE_MAX_SCHEMA_RETRY


14050 
	#SQLITE_MAX_SCHEMA_RETRY
 50

	)

14058 
VdbeOp
 
	tOp
;

14063 
	tBoÞ
;

14066 
VdbeSÜ‹r
 
	tVdbeSÜ‹r
;

14069 
Ex¶aš
 
	tEx¶aš
;

14072 
AuxD©a
 
	tAuxD©a
;

14087 
	sVdbeCursÜ
 {

14088 
BtCursÜ
 *
pCursÜ
;

14089 
BŒ“
 *
pBt
;

14090 
KeyInfo
 *
pKeyInfo
;

14091 
£ekResuÉ
;

14092 
p£udoTabËReg
;

14093 
i16
 
nF›ld
;

14094 
u16
 
nHdrP¬£d
;

14095 #ifdeà
SQLITE_DEBUG


14096 
u8
 
£ekOp
;

14098 
i8
 
iDb
;

14099 
u8
 
nuÎRow
;

14100 
u8
 
deã¼edMov‘o
;

14101 
BoÞ
 
isEphem”®
:1;

14102 
BoÞ
 
u£RªdomRowid
:1;

14103 
BoÞ
 
isTabË
:1;

14104 
BoÞ
 
isOrd”ed
:1;

14105 
Pgno
 
pgnoRoÙ
;

14106 
sql™e3_vb_cursÜ
 *
pVbCursÜ
;

14107 
i64
 
£qCouÁ
;

14108 
i64
 
mov‘oT¬g‘
;

14109 
VdbeSÜ‹r
 *
pSÜ‹r
;

14120 
u32
 
ÿcheStus
;

14121 
u32
 
·ylßdSize
;

14122 
u32
 
szRow
;

14123 
u32
 
iHdrOff£t
;

14124 cÚ¡ 
u8
 *
aRow
;

14125 
u32
 *
aOff£t
;

14126 
u32
 
aTy³
[1];

14131 
VdbeCursÜ
 
	tVdbeCursÜ
;

14154 
VdbeF¿me
 
	tVdbeF¿me
;

14155 
	sVdbeF¿me
 {

14156 
Vdbe
 *
v
;

14157 
VdbeF¿me
 *
pP¬’t
;

14158 
Op
 *
aOp
;

14159 
Mem
 *
aMem
;

14160 
u8
 *
aOnûFÏg
;

14161 
VdbeCursÜ
 **
­C¤
;

14162 *
tok’
;

14163 
i64
 
Ï¡Rowid
;

14164 
nCursÜ
;

14165 
pc
;

14166 
nOp
;

14167 
nMem
;

14168 
nOnûFÏg
;

14169 
nChždMem
;

14170 
nChždC¤
;

14171 
nChªge
;

14174 
	#VdbeF¿meMem
(
p
è((
Mem
 *)&((
u8
 *í)[
	`ROUND8
((
VdbeF¿me
))])

	)

14179 
	#CACHE_STALE
 0

	)

14186 
	sMem
 {

14187 
	uMemV®ue
 {

14188 
r
;

14189 
i64
 
i
;

14190 
nZ”o
;

14191 
FuncDef
 *
pDef
;

14192 
RowS‘
 *
pRowS‘
;

14193 
VdbeF¿me
 *
pF¿me
;

14194 } 
u
;

14195 
u16
 
æags
;

14196 
u8
 
’c
;

14197 
n
;

14198 *
z
;

14200 *
zM®loc
;

14201 
szM®loc
;

14202 
u32
 
uTemp
;

14203 
sql™e3
 *
db
;

14204 (*
xD–
)(*);

14205 #ifdeà
SQLITE_DEBUG


14206 
Mem
 *
pScÝyFrom
;

14207 *
pFžËr
;

14223 
	#MEM_NuÎ
 0x0001

	)

14224 
	#MEM_SŒ
 0x0002

	)

14225 
	#MEM_IÁ
 0x0004

	)

14226 
	#MEM_R—l
 0x0008

	)

14227 
	#MEM_Blob
 0x0010

	)

14228 
	#MEM_AffMask
 0x001à

	)

14229 
	#MEM_RowS‘
 0x0020

	)

14230 
	#MEM_F¿me
 0x0040

	)

14231 
	#MEM_Undefšed
 0x0080

	)

14232 
	#MEM_CË¬ed
 0x0100

	)

14233 
	#MEM_Ty³Mask
 0x01fà

	)

14241 
	#MEM_T”m
 0x0200

	)

14242 
	#MEM_Dyn
 0x0400

	)

14243 
	#MEM_Stic
 0x0800

	)

14244 
	#MEM_Ephem
 0x1000

	)

14245 
	#MEM_Agg
 0x2000

	)

14246 
	#MEM_Z”o
 0x4000

	)

14247 #ifdeà
SQLITE_OMIT_INCRBLOB


14248 #undeà
MEM_Z”o


14249 
	#MEM_Z”o
 0x0000

	)

14255 
	#MemS‘Ty³FÏg
(
p
, 
f
) \

14256 ((
p
)->
æags
 = (Õ)->æags&~(
MEM_Ty³Mask
|
MEM_Z”o
))|
f
)

	)

14262 #ifdeà
SQLITE_DEBUG


14263 
	#memIsV®id
(
M
è((M)->
æags
 & 
MEM_Undefšed
)==0

	)

14273 
	sAuxD©a
 {

14274 
iOp
;

14275 
iArg
;

14276 *
pAux
;

14277 (*
xD–‘e
)(*);

14278 
AuxD©a
 *
pNext
;

14294 
	ssql™e3_cÚ‹xt
 {

14295 
Mem
 *
pOut
;

14296 
FuncDef
 *
pFunc
;

14297 
Mem
 *
pMem
;

14298 
Vdbe
 *
pVdbe
;

14299 
iOp
;

14300 
isE¼Ü
;

14301 
u8
 
skFÏg
;

14302 
u8
 
fE¼ÜOrAux
;

14309 
	sEx¶aš
 {

14310 
Vdbe
 *
pVdbe
;

14311 
SŒAccum
 
¡r
;

14312 
nInd’t
;

14313 
u16
 
aInd’t
[100];

14314 
zBa£
[100];

14320 
	tbá
;

14337 
	sVdbe
 {

14338 
sql™e3
 *
db
;

14339 
Op
 *
aOp
;

14340 
Mem
 *
aMem
;

14341 
Mem
 **
­Arg
;

14342 
Mem
 *
aCÞName
;

14343 
Mem
 *
pResuÉS‘
;

14344 
P¬£
 *
pP¬£
;

14345 
nMem
;

14346 
nOp
;

14347 
nCursÜ
;

14348 
u32
 
magic
;

14349 *
zE¼Msg
;

14350 
Vdbe
 *
pP»v
,*
pNext
;

14351 
VdbeCursÜ
 **
­C¤
;

14352 
Mem
 *
aV¬
;

14353 **
azV¬
;

14354 
ynV¬
 
nV¬
;

14355 
ynV¬
 
nzV¬
;

14356 
u32
 
ÿcheCŒ
;

14357 
pc
;

14358 
rc
;

14359 
u16
 
nResCÞumn
;

14360 
u8
 
”rÜAùiÚ
;

14361 
u8
 
mšWr™eFžeFÜm©
;

14362 
bá
 
ex¶aš
:2;

14363 
bá
 
šVbM‘hod
:2;

14364 
bá
 
chªgeCÁOn
:1;

14365 
bá
 
expœed
:1;

14366 
bá
 
runOÆyOnû
:1;

14367 
bá
 
u£sStmtJouº®
:1;

14368 
bá
 
»adOÆy
:1;

14369 
bá
 
bIsR—d”
:1;

14370 
bá
 
isP»·»V2
:1;

14371 
bá
 
došgR”un
:1;

14372 
nChªge
;

14373 
yDbMask
 
bŒ“Mask
;

14374 
yDbMask
 
lockMask
;

14375 
iS‹m’t
;

14376 
u32
 
aCouÁ”
[5];

14377 #iâdeà
SQLITE_OMIT_TRACE


14378 
i64
 
¡¬tTime
;

14380 
i64
 
iCu¼’tTime
;

14381 
i64
 
nFkCÚ¡¿št
;

14382 
i64
 
nStmtDefCÚs
;

14383 
i64
 
nStmtDefImmCÚs
;

14384 *
zSql
;

14385 *
pF»e
;

14386 
VdbeF¿me
 *
pF¿me
;

14387 
VdbeF¿me
 *
pD–F¿me
;

14388 
nF¿me
;

14389 
u32
 
expmask
;

14390 
SubProg¿m
 *
pProg¿m
;

14391 
nOnûFÏg
;

14392 
u8
 *
aOnûFÏg
;

14393 
AuxD©a
 *
pAuxD©a
;

14399 
	#VDBE_MAGIC_INIT
 0x26bû¯5

	)

14400 
	#VDBE_MAGIC_RUN
 0xbdf20da3

	)

14401 
	#VDBE_MAGIC_HALT
 0x519c2973

	)

14402 
	#VDBE_MAGIC_DEAD
 0xb606c3c8

	)

14407 
SQLITE_PRIVATE
 
sql™e3VdbeF»eCursÜ
(
Vdbe
 *, 
VdbeCursÜ
*);

14408 
sql™eVdbePÝSck
(
Vdbe
*,);

14409 
SQLITE_PRIVATE
 
sql™e3VdbeCursÜMov‘o
(
VdbeCursÜ
*);

14410 
SQLITE_PRIVATE
 
sql™e3VdbeCursÜRe¡Üe
(
VdbeCursÜ
*);

14411 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
VDBE_PROFILE
)

14412 
SQLITE_PRIVATE
 
sql™e3VdbePrštOp
(
FILE
*, , 
Op
*);

14414 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlTy³L’
(u32);

14415 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlTy³
(
Mem
*, );

14416 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlPut
(*, 
Mem
*, u32);

14417 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlG‘
(cÚ¡ *, u32, 
Mem
*);

14418 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘eAuxD©a
(
Vdbe
*, , );

14420 
sql™e2BŒ“KeyCom·»
(
BtCursÜ
 *, const *, , , *);

14421 
SQLITE_PRIVATE
 
sql™e3VdbeIdxKeyCom·»
(
sql™e3
*,
VdbeCursÜ
*,
UÅackedRecÜd
*,*);

14422 
SQLITE_PRIVATE
 
sql™e3VdbeIdxRowid
(
sql™e3
*, 
BtCursÜ
*, 
i64
*);

14423 
SQLITE_PRIVATE
 
sql™e3VdbeExec
(
Vdbe
*);

14424 
SQLITE_PRIVATE
 
sql™e3VdbeLi¡
(
Vdbe
*);

14425 
SQLITE_PRIVATE
 
sql™e3VdbeH®t
(
Vdbe
*);

14426 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeEncodšg
(
Mem
 *, );

14427 
SQLITE_PRIVATE
 
sql™e3VdbeMemTooBig
(
Mem
*);

14428 
SQLITE_PRIVATE
 
sql™e3VdbeMemCÝy
(
Mem
*, const Mem*);

14429 
SQLITE_PRIVATE
 
sql™e3VdbeMemSh®lowCÝy
(
Mem
*, const Mem*, );

14430 
SQLITE_PRIVATE
 
sql™e3VdbeMemMove
(
Mem
*, Mem*);

14431 
SQLITE_PRIVATE
 
sql™e3VdbeMemNulT”mš©e
(
Mem
*);

14432 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘SŒ
(
Mem
*, cÚ¡ *, , 
u8
, (*)(*));

14433 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘IÁ64
(
Mem
*, 
i64
);

14434 #ifdeà
SQLITE_OMIT_FLOATING_POINT


14435 
	#sql™e3VdbeMemS‘DoubË
 
sql™e3VdbeMemS‘IÁ64


	)

14437 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘DoubË
(
Mem
*, );

14439 
SQLITE_PRIVATE
 
sql™e3VdbeMemIn™
(
Mem
*,
sql™e3
*,
u16
);

14440 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘NuÎ
(
Mem
*);

14441 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘Z”oBlob
(
Mem
*,);

14442 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘RowS‘
(
Mem
*);

14443 
SQLITE_PRIVATE
 
sql™e3VdbeMemMakeWr™—bË
(
Mem
*);

14444 
SQLITE_PRIVATE
 
sql™e3VdbeMemSŒšgify
(
Mem
*, 
u8
, u8);

14445 
SQLITE_PRIVATE
 
i64
 
sql™e3VdbeIÁV®ue
(
Mem
*);

14446 
SQLITE_PRIVATE
 
sql™e3VdbeMemIÁeg”ify
(
Mem
*);

14447 
SQLITE_PRIVATE
 
sql™e3VdbeR—lV®ue
(
Mem
*);

14448 
SQLITE_PRIVATE
 
sql™e3VdbeIÁeg”Affš™y
(
Mem
*);

14449 
SQLITE_PRIVATE
 
sql™e3VdbeMemR—lify
(
Mem
*);

14450 
SQLITE_PRIVATE
 
sql™e3VdbeMemNum”ify
(
Mem
*);

14451 
SQLITE_PRIVATE
 
sql™e3VdbeMemCa¡
(
Mem
*,
u8
,u8);

14452 
SQLITE_PRIVATE
 
sql™e3VdbeMemFromBŒ“
(
BtCursÜ
*,
u32
,u32,,
Mem
*);

14453 
SQLITE_PRIVATE
 
sql™e3VdbeMemR–—£
(
Mem
 *
p
);

14454 
	#VdbeMemDyÇmic
(
X
) \

14455 (((
X
)->
æags
&(
MEM_Agg
|
MEM_Dyn
|
MEM_RowS‘
|
MEM_F¿me
))!=0)

	)

14456 
SQLITE_PRIVATE
 
sql™e3VdbeMemFš®ize
(
Mem
*, 
FuncDef
*);

14457 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3OpcodeName
();

14458 
SQLITE_PRIVATE
 
sql™e3VdbeMemGrow
(
Mem
 *
pMem
, 
n
, 
´e£rve
);

14459 
SQLITE_PRIVATE
 
sql™e3VdbeMemCË¬AndResize
(
Mem
 *
pMem
, 
n
);

14460 
SQLITE_PRIVATE
 
sql™e3VdbeClo£S‹m’t
(
Vdbe
 *, );

14461 
SQLITE_PRIVATE
 
sql™e3VdbeF¿meD–‘e
(
VdbeF¿me
*);

14462 
SQLITE_PRIVATE
 
sql™e3VdbeF¿meRe¡Üe
(
VdbeF¿me
 *);

14463 
SQLITE_PRIVATE
 
sql™e3VdbeT¿nsãrE¼Ü
(
Vdbe
 *
p
);

14465 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rIn™
(
sql™e3
 *, , 
VdbeCursÜ
 *);

14466 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRe£t
(
sql™e3
 *, 
VdbeSÜ‹r
 *);

14467 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rClo£
(
sql™e3
 *, 
VdbeCursÜ
 *);

14468 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRowkey
(cÚ¡ 
VdbeCursÜ
 *, 
Mem
 *);

14469 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rNext
(
sql™e3
 *, cÚ¡ 
VdbeCursÜ
 *, *);

14470 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRewšd
(cÚ¡ 
VdbeCursÜ
 *, *);

14471 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rWr™e
(cÚ¡ 
VdbeCursÜ
 *, 
Mem
 *);

14472 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rCom·»
(cÚ¡ 
VdbeCursÜ
 *, 
Mem
 *, , *);

14474 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& 
SQLITE_THREADSAFE
>0

14475 
SQLITE_PRIVATE
 
sql™e3VdbeEÁ”
(
Vdbe
*);

14476 
SQLITE_PRIVATE
 
sql™e3VdbeL—ve
(
Vdbe
*);

14478 
	#sql™e3VdbeEÁ”
(
X
)

	)

14479 
	#sql™e3VdbeL—ve
(
X
)

	)

14482 #ifdeà
SQLITE_DEBUG


14483 
SQLITE_PRIVATE
 
sql™e3VdbeMemAboutToChªge
(
Vdbe
*,
Mem
*);

14484 
SQLITE_PRIVATE
 
sql™e3VdbeCheckMemInv¬ŸÁs
(
Mem
*);

14487 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


14488 
SQLITE_PRIVATE
 
sql™e3VdbeCheckFk
(
Vdbe
 *, );

14490 
	#sql™e3VdbeCheckFk
(
p
,
i
è0

	)

14493 
SQLITE_PRIVATE
 
sql™e3VdbeMemT¿n¦©e
(
Mem
*, 
u8
);

14494 #ifdeà
SQLITE_DEBUG


14495 
SQLITE_PRIVATE
 
sql™e3VdbePrštSql
(
Vdbe
*);

14496 
SQLITE_PRIVATE
 
sql™e3VdbeMemP»‰yPršt
(
Mem
 *
pMem
, *
zBuf
);

14498 
SQLITE_PRIVATE
 
sql™e3VdbeMemHªdËBom
(
Mem
 *
pMem
);

14500 #iâdeà
SQLITE_OMIT_INCRBLOB


14501 
SQLITE_PRIVATE
 
sql™e3VdbeMemEx·ndBlob
(
Mem
 *);

14502 
	#Ex·ndBlob
(
P
è(((P)->
æags
&
MEM_Z”o
)?
	`sql™e3VdbeMemEx·ndBlob
(P):0)

	)

14504 
	#sql™e3VdbeMemEx·ndBlob
(
x
è
SQLITE_OK


	)

14505 
	#Ex·ndBlob
(
P
è
SQLITE_OK


	)

14516 
sql™e3StTy³
 
	tsql™e3StTy³
;

14517 
SQLITE_WSD
 
	ssql™e3StTy³
 {

14518 
nowV®ue
[10];

14519 
mxV®ue
[10];

14520 } 
sql™e3St
 = { {0,}, {0,} };

14529 #ifdeà
SQLITE_OMIT_WSD


14530 
	#wsdStIn™
 
sql™e3StTy³
 *
x
 = &
	`GLOBAL
(sql™e3StTy³,
sql™e3St
)

	)

14531 
	#wsdSt
 
x
[0]

	)

14533 
	#wsdStIn™


	)

14534 
	#wsdSt
 
sql™e3St


	)

14540 
SQLITE_PRIVATE
 
sql™e3StusV®ue
(
Ý
){

14541 
wsdStIn™
;

14542 
as£¹
Ð
Ý
>=0 && op<
A¼aySize
(
wsdSt
.
nowV®ue
) );

14543  
wsdSt
.
nowV®ue
[
Ý
];

14550 
SQLITE_PRIVATE
 
sql™e3StusAdd
(
Ý
, 
N
){

14551 
wsdStIn™
;

14552 
as£¹
Ð
Ý
>=0 && op<
A¼aySize
(
wsdSt
.
nowV®ue
) );

14553 
wsdSt
.
nowV®ue
[
Ý
] +ð
N
;

14554 ifÐ
wsdSt
.
nowV®ue
[
Ý
]>wsdSt.
mxV®ue
[op] ){

14555 
wsdSt
.
mxV®ue
[
Ý
] = wsdSt.
nowV®ue
[op];

14562 
SQLITE_PRIVATE
 
sql™e3StusS‘
(
Ý
, 
X
){

14563 
wsdStIn™
;

14564 
as£¹
Ð
Ý
>=0 && op<
A¼aySize
(
wsdSt
.
nowV®ue
) );

14565 
wsdSt
.
nowV®ue
[
Ý
] = 
X
;

14566 ifÐ
wsdSt
.
nowV®ue
[
Ý
]>wsdSt.
mxV®ue
[op] ){

14567 
wsdSt
.
mxV®ue
[
Ý
] = wsdSt.
nowV®ue
[op];

14578 
SQLITE_API
 
sql™e3_¡©us
(
Ý
, *
pCu¼’t
, *
pHighw©”
, 
»£tFÏg
){

14579 
wsdStIn™
;

14580 ifÐ
Ý
<0 || op>=
A¼aySize
(
wsdSt
.
nowV®ue
) ){

14581  
SQLITE_MISUSE_BKPT
;

14583 *
pCu¼’t
 = 
wsdSt
.
nowV®ue
[
Ý
];

14584 *
pHighw©”
 = 
wsdSt
.
mxV®ue
[
Ý
];

14585 ifÐ
»£tFÏg
 ){

14586 
wsdSt
.
mxV®ue
[
Ý
] = wsdSt.
nowV®ue
[op];

14588  
SQLITE_OK
;

14594 
SQLITE_API
 
sql™e3_db_¡©us
(

14595 
sql™e3
 *
db
,

14596 
Ý
,

14597 *
pCu¼’t
,

14598 *
pHighw©”
,

14599 
»£tFÏg


14601 
rc
 = 
SQLITE_OK
;

14602 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

14603  
Ý
 ){

14604 
SQLITE_DBSTATUS_LOOKASIDE_USED
: {

14605 *
pCu¼’t
 = 
db
->
lookaside
.
nOut
;

14606 *
pHighw©”
 = 
db
->
lookaside
.
mxOut
;

14607 ifÐ
»£tFÏg
 ){

14608 
db
->
lookaside
.
mxOut
 = db->lookaside.
nOut
;

14613 
SQLITE_DBSTATUS_LOOKASIDE_HIT
:

14614 
SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE
:

14615 
SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL
: {

14616 
‹¡ÿ£
Ð
Ý
==
SQLITE_DBSTATUS_LOOKASIDE_HIT
 );

14617 
‹¡ÿ£
Ð
Ý
==
SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE
 );

14618 
‹¡ÿ£
Ð
Ý
==
SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL
 );

14619 
as£¹
Ð(
Ý
-
SQLITE_DBSTATUS_LOOKASIDE_HIT
)>=0 );

14620 
as£¹
Ð(
Ý
-
SQLITE_DBSTATUS_LOOKASIDE_HIT
)<3 );

14621 *
pCu¼’t
 = 0;

14622 *
pHighw©”
 = 
db
->
lookaside
.
ªSt
[
Ý
 - 
SQLITE_DBSTATUS_LOOKASIDE_HIT
];

14623 ifÐ
»£tFÏg
 ){

14624 
db
->
lookaside
.
ªSt
[
Ý
 - 
SQLITE_DBSTATUS_LOOKASIDE_HIT
] = 0;

14634 
SQLITE_DBSTATUS_CACHE_USED
: {

14635 
tÙ®U£d
 = 0;

14636 
i
;

14637 
sql™e3BŒ“EÁ”AÎ
(
db
);

14638 
i
=0; i<
db
->
nDb
; i++){

14639 
BŒ“
 *
pBt
 = 
db
->
aDb
[
i
].pBt;

14640 ifÐ
pBt
 ){

14641 
Pag”
 *
pPag”
 = 
sql™e3BŒ“Pag”
(
pBt
);

14642 
tÙ®U£d
 +ð
sql™e3Pag”MemU£d
(
pPag”
);

14645 
sql™e3BŒ“L—veAÎ
(
db
);

14646 *
pCu¼’t
 = 
tÙ®U£d
;

14647 *
pHighw©”
 = 0;

14656 
SQLITE_DBSTATUS_SCHEMA_USED
: {

14657 
i
;

14658 
nBy‹
 = 0;

14660 
sql™e3BŒ“EÁ”AÎ
(
db
);

14661 
db
->
²By‹sF»ed
 = &
nBy‹
;

14662 
i
=0; i<
db
->
nDb
; i++){

14663 
Schema
 *
pSchema
 = 
db
->
aDb
[
i
].pSchema;

14664 ifÐ
ALWAYS
(
pSchema
!=0) ){

14665 
HashEËm
 *
p
;

14667 
nBy‹
 +ð
sql™e3Glob®CÚfig
.
m
.
xRoundup
((
HashEËm
)) * (

14668 
pSchema
->
tblHash
.
couÁ


14669 + 
pSchema
->
ŒigHash
.
couÁ


14670 + 
pSchema
->
idxHash
.
couÁ


14671 + 
pSchema
->
fkeyHash
.
couÁ


14673 
nBy‹
 +ð
sql™e3M®locSize
(
pSchema
->
tblHash
.
ht
);

14674 
nBy‹
 +ð
sql™e3M®locSize
(
pSchema
->
ŒigHash
.
ht
);

14675 
nBy‹
 +ð
sql™e3M®locSize
(
pSchema
->
idxHash
.
ht
);

14676 
nBy‹
 +ð
sql™e3M®locSize
(
pSchema
->
fkeyHash
.
ht
);

14678 
p
=
sql™eHashFœ¡
(&
pSchema
->
ŒigHash
);…;…=
sql™eHashNext
(p)){

14679 
sql™e3D–‘eTrigg”
(
db
, (
Trigg”
*)
sql™eHashD©a
(
p
));

14681 
p
=
sql™eHashFœ¡
(&
pSchema
->
tblHash
);…;…=
sql™eHashNext
(p)){

14682 
sql™e3D–‘eTabË
(
db
, (
TabË
 *)
sql™eHashD©a
(
p
));

14686 
db
->
²By‹sF»ed
 = 0;

14687 
sql™e3BŒ“L—veAÎ
(
db
);

14689 *
pHighw©”
 = 0;

14690 *
pCu¼’t
 = 
nBy‹
;

14699 
SQLITE_DBSTATUS_STMT_USED
: {

14700 
Vdbe
 *
pVdbe
;

14701 
nBy‹
 = 0;

14703 
db
->
²By‹sF»ed
 = &
nBy‹
;

14704 
pVdbe
=
db
->pVdbe;…Vdbe;…VdbeõVdbe->
pNext
){

14705 
sql™e3VdbeCË¬Objeù
(
db
, 
pVdbe
);

14706 
sql™e3DbF»e
(
db
, 
pVdbe
);

14708 
db
->
²By‹sF»ed
 = 0;

14710 *
pHighw©”
 = 0;

14711 *
pCu¼’t
 = 
nBy‹
;

14721 
SQLITE_DBSTATUS_CACHE_HIT
:

14722 
SQLITE_DBSTATUS_CACHE_MISS
:

14723 
SQLITE_DBSTATUS_CACHE_WRITE
:{

14724 
i
;

14725 
nR‘
 = 0;

14726 
as£¹
Ð
SQLITE_DBSTATUS_CACHE_MISS
==
SQLITE_DBSTATUS_CACHE_HIT
+1 );

14727 
as£¹
Ð
SQLITE_DBSTATUS_CACHE_WRITE
==
SQLITE_DBSTATUS_CACHE_HIT
+2 );

14729 
i
=0; i<
db
->
nDb
; i++){

14730 ifÐ
db
->
aDb
[
i
].
pBt
 ){

14731 
Pag”
 *
pPag”
 = 
sql™e3BŒ“Pag”
(
db
->
aDb
[
i
].
pBt
);

14732 
sql™e3Pag”CacheSt
(
pPag”
, 
Ý
, 
»£tFÏg
, &
nR‘
);

14735 *
pHighw©”
 = 0;

14738 *
pCu¼’t
 = 
nR‘
;

14746 
SQLITE_DBSTATUS_DEFERRED_FKS
: {

14747 *
pHighw©”
 = 0;

14748 *
pCu¼’t
 = 
db
->
nDeã¼edImmCÚs
>0 || db->
nDeã¼edCÚs
>0;

14753 
rc
 = 
SQLITE_ERROR
;

14756 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

14757  
rc
;

14809 
	~<time.h
>

14811 #iâdeà
SQLITE_OMIT_DATETIME_FUNCS


14817 
D©eTime
 
	tD©eTime
;

14818 
	sD©eTime
 {

14819 
sql™e3_št64
 
iJD
;

14820 
Y
, 
M
, 
D
;

14821 
h
, 
m
;

14822 
tz
;

14823 
s
;

14824 
v®idYMD
;

14825 
v®idHMS
;

14826 
v®idJD
;

14827 
v®idTZ
;

14844 
g‘Dig™s
(cÚ¡ *
zD©e
, ...){

14845 
va_li¡
 
­
;

14846 
v®
;

14847 
N
;

14848 
mš
;

14849 
max
;

14850 
ÃxtC
;

14851 *
pV®
;

14852 
út
 = 0;

14853 
va_¡¬t
(
­
, 
zD©e
);

14855 
N
 = 
va_¬g
(
­
, );

14856 
mš
 = 
va_¬g
(
­
, );

14857 
max
 = 
va_¬g
(
­
, );

14858 
ÃxtC
 = 
va_¬g
(
­
, );

14859 
pV®
 = 
va_¬g
(
­
, *);

14860 
v®
 = 0;

14861  
N
-- ){

14862 ifÐ!
sql™e3Isdig™
(*
zD©e
) ){

14863 
’d_g‘Dig™s
;

14865 
v®
 = v®*10 + *
zD©e
 - '0';

14866 
zD©e
++;

14868 ifÐ
v®
<
mš
 || v®>
max
 || (
ÃxtC
!=0 &&‚extC!=*
zD©e
) ){

14869 
’d_g‘Dig™s
;

14871 *
pV®
 = 
v®
;

14872 
zD©e
++;

14873 
út
++;

14874 } 
ÃxtC
 );

14875 
’d_g‘Dig™s
:

14876 
va_’d
(
­
);

14877  
út
;

14896 
·r£TimezÚe
(cÚ¡ *
zD©e
, 
D©eTime
 *
p
){

14897 
sgn
 = 0;

14898 
nHr
, 
nMn
;

14899 
c
;

14900  
sql™e3Is¥aû
(*
zD©e
) ){ zDate++; }

14901 
p
->
tz
 = 0;

14902 
c
 = *
zD©e
;

14903 ifÐ
c
=='-' ){

14904 
sgn
 = -1;

14905 }ifÐ
c
=='+' ){

14906 
sgn
 = +1;

14907 }ifÐ
c
=='Z' || c=='z' ){

14908 
zD©e
++;

14909 
zulu_time
;

14911  
c
!=0;

14913 
zD©e
++;

14914 ifÐ
g‘Dig™s
(
zD©e
, 2, 0, 14, ':', &
nHr
, 2, 0, 59, 0, &
nMn
)!=2 ){

14917 
zD©e
 += 5;

14918 
p
->
tz
 = 
sgn
*(
nMn
 + 
nHr
*60);

14919 
zulu_time
:

14920  
sql™e3Is¥aû
(*
zD©e
) ){ zDate++; }

14921  *
zD©e
!=0;

14931 
·r£HhMmSs
(cÚ¡ *
zD©e
, 
D©eTime
 *
p
){

14932 
h
, 
m
, 
s
;

14933 
ms
 = 0.0;

14934 ifÐ
g‘Dig™s
(
zD©e
, 2, 0, 24, ':', &
h
, 2, 0, 59, 0, &
m
)!=2 ){

14937 
zD©e
 += 5;

14938 ifÐ*
zD©e
==':' ){

14939 
zD©e
++;

14940 ifÐ
g‘Dig™s
(
zD©e
, 2, 0, 59, 0, &
s
)!=1 ){

14943 
zD©e
 += 2;

14944 ifÐ*
zD©e
=='.' && 
sql™e3Isdig™
(zDate[1]) ){

14945 
rSÿË
 = 1.0;

14946 
zD©e
++;

14947  
sql™e3Isdig™
(*
zD©e
) ){

14948 
ms
 = ms*10.0 + *
zD©e
 - '0';

14949 
rSÿË
 *= 10.0;

14950 
zD©e
++;

14952 
ms
 /ð
rSÿË
;

14955 
s
 = 0;

14957 
p
->
v®idJD
 = 0;

14958 
p
->
v®idHMS
 = 1;

14959 
p
->
h
 = h;

14960 
p
->
m
 = m;

14961 
p
->
s
 = s + 
ms
;

14962 ifÐ
·r£TimezÚe
(
zD©e
, 
p
) )  1;

14963 
p
->
v®idTZ
 = (p->
tz
!=0)?1:0;

14973 
compu‹JD
(
D©eTime
 *
p
){

14974 
Y
, 
M
, 
D
, 
A
, 
B
, 
X1
, 
X2
;

14976 ifÐ
p
->
v®idJD
 ) ;

14977 ifÐ
p
->
v®idYMD
 ){

14978 
Y
 = 
p
->Y;

14979 
M
 = 
p
->M;

14980 
D
 = 
p
->D;

14982 
Y
 = 2000;

14983 
M
 = 1;

14984 
D
 = 1;

14986 ifÐ
M
<=2 ){

14987 
Y
--;

14988 
M
 += 12;

14990 
A
 = 
Y
/100;

14991 
B
 = 2 - 
A
 + (A/4);

14992 
X1
 = 36525*(
Y
+4716)/100;

14993 
X2
 = 306001*(
M
+1)/10000;

14994 
p
->
iJD
 = (
sql™e3_št64
)((
X1
 + 
X2
 + 
D
 + 
B
 - 1524.5 ) * 86400000);

14995 
p
->
v®idJD
 = 1;

14996 ifÐ
p
->
v®idHMS
 ){

14997 
p
->
iJD
 +ðp->
h
*3600000 +…->
m
*60000 + (
sql™e3_št64
)Õ->
s
*1000);

14998 ifÐ
p
->
v®idTZ
 ){

14999 
p
->
iJD
 -ðp->
tz
*60000;

15000 
p
->
v®idYMD
 = 0;

15001 
p
->
v®idHMS
 = 0;

15002 
p
->
v®idTZ
 = 0;

15019 
·r£YyyyMmDd
(cÚ¡ *
zD©e
, 
D©eTime
 *
p
){

15020 
Y
, 
M
, 
D
, 
Ãg
;

15022 ifÐ
zD©e
[0]=='-' ){

15023 
zD©e
++;

15024 
Ãg
 = 1;

15026 
Ãg
 = 0;

15028 ifÐ
g‘Dig™s
(
zD©e
,4,0,9999,'-',&
Y
,2,1,12,'-',&
M
,2,1,31,0,&
D
)!=3 ){

15031 
zD©e
 += 10;

15032  
sql™e3Is¥aû
(*
zD©e
è|| 'T'==*(
u8
*)zDate ){ zDate++; }

15033 ifÐ
·r£HhMmSs
(
zD©e
, 
p
)==0 ){

15035 }ifÐ*
zD©e
==0 ){

15036 
p
->
v®idHMS
 = 0;

15040 
p
->
v®idJD
 = 0;

15041 
p
->
v®idYMD
 = 1;

15042 
p
->
Y
 = 
Ãg
 ? -Y : Y;

15043 
p
->
M
 = M;

15044 
p
->
D
 = D;

15045 ifÐ
p
->
v®idTZ
 ){

15046 
compu‹JD
(
p
);

15056 
£tD©eTimeToCu¼’t
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
D©eTime
 *
p
){

15057 
p
->
iJD
 = 
sql™e3StmtCu¼’tTime
(
cÚ‹xt
);

15058 ifÐ
p
->
iJD
>0 ){

15059 
p
->
v®idJD
 = 1;

15082 
·r£D©eOrTime
(

15083 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15084 cÚ¡ *
zD©e
,

15085 
D©eTime
 *
p


15087 
r
;

15088 ifÐ
·r£YyyyMmDd
(
zD©e
,
p
)==0 ){

15090 }ifÐ
·r£HhMmSs
(
zD©e
, 
p
)==0 ){

15092 }ifÐ
sql™e3SŒICmp
(
zD©e
,"now")==0){

15093  
£tD©eTimeToCu¼’t
(
cÚ‹xt
, 
p
);

15094 }ifÐ
sql™e3AtoF
(
zD©e
, &
r
, 
sql™e3SŒËn30
(zD©e), 
SQLITE_UTF8
) ){

15095 
p
->
iJD
 = (
sql™e3_št64
)(
r
*86400000.0 + 0.5);

15096 
p
->
v®idJD
 = 1;

15105 
compu‹YMD
(
D©eTime
 *
p
){

15106 
Z
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X1
;

15107 ifÐ
p
->
v®idYMD
 ) ;

15108 ifÐ!
p
->
v®idJD
 ){

15109 
p
->
Y
 = 2000;

15110 
p
->
M
 = 1;

15111 
p
->
D
 = 1;

15113 
Z
 = ()((
p
->
iJD
 + 43200000)/86400000);

15114 
A
 = ()((
Z
 - 1867216.25)/36524.25);

15115 
A
 = 
Z
 + 1 + A - (A/4);

15116 
B
 = 
A
 + 1524;

15117 
C
 = ()((
B
 - 122.1)/365.25);

15118 
D
 = (36525*
C
)/100;

15119 
E
 = ()((
B
-
D
)/30.6001);

15120 
X1
 = ()(30.6001*
E
);

15121 
p
->
D
 = 
B
 - D - 
X1
;

15122 
p
->
M
 = 
E
<14 ? E-1 : E-13;

15123 
p
->
Y
 =…->
M
>2 ? 
C
 - 4716 : C - 4715;

15125 
p
->
v®idYMD
 = 1;

15131 
compu‹HMS
(
D©eTime
 *
p
){

15132 
s
;

15133 ifÐ
p
->
v®idHMS
 ) ;

15134 
compu‹JD
(
p
);

15135 
s
 = ()((
p
->
iJD
 + 43200000) % 86400000);

15136 
p
->
s
 = s/1000.0;

15137 
s
 = ()
p
->s;

15138 
p
->
s
 -= s;

15139 
p
->
h
 = 
s
/3600;

15140 
s
 -ð
p
->
h
*3600;

15141 
p
->
m
 = 
s
/60;

15142 
p
->
s
 +ð -…->
m
*60;

15143 
p
->
v®idHMS
 = 1;

15149 
compu‹YMD_HMS
(
D©eTime
 *
p
){

15150 
compu‹YMD
(
p
);

15151 
compu‹HMS
(
p
);

15157 
þ—rYMD_HMS_TZ
(
D©eTime
 *
p
){

15158 
p
->
v®idYMD
 = 0;

15159 
p
->
v®idHMS
 = 0;

15160 
p
->
v®idTZ
 = 0;

15175 #ià!
defšed
(
HAVE_LOCALTIME_R
è&& !defšed(
HAVE_LOCALTIME_S
) && \

15176 
defšed
(
_MSC_VER
è&& defšed(
_CRT_INSECURE_DEPRECATE
)

15177 
	#HAVE_LOCALTIME_S
 1

	)

15180 #iâdeà
SQLITE_OMIT_LOCALTIME


15194 
osLoÿÉime
(
time_t
 *
t
, 
tm
 *
pTm
){

15195 
rc
;

15196 #ià(!
defšed
(
HAVE_LOCALTIME_R
) || !HAVE_LOCALTIME_R) \

15197 && (!
defšed
(
HAVE_LOCALTIME_S
) || !HAVE_LOCALTIME_S)

15198 
tm
 *
pX
;

15199 #ià
SQLITE_THREADSAFE
>0

15200 
sql™e3_mu‹x
 *
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

15202 
sql™e3_mu‹x_’‹r
(
mu‹x
);

15203 
pX
 = 
loÿÉime
(
t
);

15204 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


15205 ifÐ
sql™e3Glob®CÚfig
.
bLoÿÉimeFauÉ
 ) 
pX
 = 0;

15207 ifÐ
pX
 ) *
pTm
 = *pX;

15208 
sql™e3_mu‹x_Ëave
(
mu‹x
);

15209 
rc
 = 
pX
==0;

15211 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


15212 ifÐ
sql™e3Glob®CÚfig
.
bLoÿÉimeFauÉ
 )  1;

15214 #ià
defšed
(
HAVE_LOCALTIME_R
) && HAVE_LOCALTIME_R

15215 
rc
 = 
loÿÉime_r
(
t
, 
pTm
)==0;

15217 
rc
 = 
loÿÉime_s
(
pTm
, 
t
);

15220  
rc
;

15225 #iâdeà
SQLITE_OMIT_LOCALTIME


15234 
sql™e3_št64
 
loÿÉimeOff£t
(

15235 
D©eTime
 *
p
,

15236 
sql™e3_cÚ‹xt
 *
pCtx
,

15237 *
pRc


15239 
D©eTime
 
x
, 
y
;

15240 
time_t
 
t
;

15241 
tm
 
sLoÿl
;

15244 
mem£t
(&
sLoÿl
, 0, (sLocal));

15246 
x
 = *
p
;

15247 
compu‹YMD_HMS
(&
x
);

15248 ifÐ
x
.
Y
<1971 || x.Y>=2038 ){

15254 
x
.
Y
 = 2000;

15255 
x
.
M
 = 1;

15256 
x
.
D
 = 1;

15257 
x
.
h
 = 0;

15258 
x
.
m
 = 0;

15259 
x
.
s
 = 0.0;

15261 
s
 = ()(
x
.s + 0.5);

15262 
x
.
s
 = s;

15264 
x
.
tz
 = 0;

15265 
x
.
v®idJD
 = 0;

15266 
compu‹JD
(&
x
);

15267 
t
 = (
time_t
)(
x
.
iJD
/1000 - 21086676*(
i64
)10000);

15268 ifÐ
osLoÿÉime
(&
t
, &
sLoÿl
) ){

15269 
sql™e3_»suÉ_”rÜ
(
pCtx
, "localime unavailable", -1);

15270 *
pRc
 = 
SQLITE_ERROR
;

15273 
y
.
Y
 = 
sLoÿl
.
tm_y—r
 + 1900;

15274 
y
.
M
 = 
sLoÿl
.
tm_mÚ
 + 1;

15275 
y
.
D
 = 
sLoÿl
.
tm_mday
;

15276 
y
.
h
 = 
sLoÿl
.
tm_hour
;

15277 
y
.
m
 = 
sLoÿl
.
tm_mš
;

15278 
y
.
s
 = 
sLoÿl
.
tm_£c
;

15279 
y
.
v®idYMD
 = 1;

15280 
y
.
v®idHMS
 = 1;

15281 
y
.
v®idJD
 = 0;

15282 
y
.
v®idTZ
 = 0;

15283 
compu‹JD
(&
y
);

15284 *
pRc
 = 
SQLITE_OK
;

15285  
y
.
iJD
 - 
x
.iJD;

15313 
·r£Modif›r
(
sql™e3_cÚ‹xt
 *
pCtx
, cÚ¡ *
zMod
, 
D©eTime
 *
p
){

15314 
rc
 = 1;

15315 
n
;

15316 
r
;

15317 *
z
, 
zBuf
[30];

15318 
z
 = 
zBuf
;

15319 
n
=0;‚<
A¼aySize
(
zBuf
)-1 && 
zMod
[n];‚++){

15320 
z
[
n
] = ()
sql™e3Uµ”ToLow”
[(
u8
)
zMod
[n]];

15322 
z
[
n
] = 0;

15323  
z
[0] ){

15324 #iâdeà
SQLITE_OMIT_LOCALTIME


15331 ifÐ
¡rcmp
(
z
, "localtime")==0 ){

15332 
compu‹JD
(
p
);

15333 
p
->
iJD
 +ð
loÿÉimeOff£t
Õ, 
pCtx
, &
rc
);

15334 
þ—rYMD_HMS_TZ
(
p
);

15346 ifÐ
¡rcmp
(
z
, "unix•och")==0 && 
p
->
v®idJD
 ){

15347 
p
->
iJD
 = (p->iJD + 43200)/86400 + 21086676*(
i64
)10000000;

15348 
þ—rYMD_HMS_TZ
(
p
);

15349 
rc
 = 0;

15351 #iâdeà
SQLITE_OMIT_LOCALTIME


15352 ifÐ
¡rcmp
(
z
, "utc")==0 ){

15353 
sql™e3_št64
 
c1
;

15354 
compu‹JD
(
p
);

15355 
c1
 = 
loÿÉimeOff£t
(
p
, 
pCtx
, &
rc
);

15356 ifÐ
rc
==
SQLITE_OK
 ){

15357 
p
->
iJD
 -ð
c1
;

15358 
þ—rYMD_HMS_TZ
(
p
);

15359 
p
->
iJD
 +ð
c1
 - 
loÿÉimeOff£t
Õ, 
pCtx
, &
rc
);

15373 ifÐ
¡ºcmp
(
z
, "weekday ", 8)==0

15374 && 
sql™e3AtoF
(&
z
[8], &
r
, 
sql™e3SŒËn30
(&z[8]), 
SQLITE_UTF8
)

15375 && (
n
=()
r
)==r &&‚>=0 &&„<7 ){

15376 
sql™e3_št64
 
Z
;

15377 
compu‹YMD_HMS
(
p
);

15378 
p
->
v®idTZ
 = 0;

15379 
p
->
v®idJD
 = 0;

15380 
compu‹JD
(
p
);

15381 
Z
 = ((
p
->
iJD
 + 129600000)/86400000) % 7;

15382 ifÐ
Z
>
n
 ) Z -= 7;

15383 
p
->
iJD
 +ð(
n
 - 
Z
)*86400000;

15384 
þ—rYMD_HMS_TZ
(
p
);

15385 
rc
 = 0;

15396 ifÐ
¡ºcmp
(
z
, "start of ", 9)!=0 ) ;

15397 
z
 += 9;

15398 
compu‹YMD
(
p
);

15399 
p
->
v®idHMS
 = 1;

15400 
p
->
h
 =…->
m
 = 0;

15401 
p
->
s
 = 0.0;

15402 
p
->
v®idTZ
 = 0;

15403 
p
->
v®idJD
 = 0;

15404 ifÐ
¡rcmp
(
z
,"month")==0 ){

15405 
p
->
D
 = 1;

15406 
rc
 = 0;

15407 }ifÐ
¡rcmp
(
z
,"year")==0 ){

15408 
compu‹YMD
(
p
);

15409 
p
->
M
 = 1;

15410 
p
->
D
 = 1;

15411 
rc
 = 0;

15412 }ifÐ
¡rcmp
(
z
,"day")==0 ){

15413 
rc
 = 0;

15429 
rRound”
;

15430 
n
=1; 
z
[n] && z[n]!=':' && !
sql™e3Is¥aû
(z[n]);‚++){}

15431 ifÐ!
sql™e3AtoF
(
z
, &
r
, 
n
, 
SQLITE_UTF8
) ){

15432 
rc
 = 1;

15435 ifÐ
z
[
n
]==':' ){

15441 cÚ¡ *
z2
 = 
z
;

15442 
D©eTime
 
tx
;

15443 
sql™e3_št64
 
day
;

15444 ifÐ!
sql™e3Isdig™
(*
z2
) ) z2++;

15445 
mem£t
(&
tx
, 0, (tx));

15446 ifÐ
·r£HhMmSs
(
z2
, &
tx
) ) ;

15447 
compu‹JD
(&
tx
);

15448 
tx
.
iJD
 -= 43200000;

15449 
day
 = 
tx
.
iJD
/86400000;

15450 
tx
.
iJD
 -ð
day
*86400000;

15451 ifÐ
z
[0]=='-' ) 
tx
.
iJD
 = -tx.iJD;

15452 
compu‹JD
(
p
);

15453 
þ—rYMD_HMS_TZ
(
p
);

15454 
p
->
iJD
 +ð
tx
.iJD;

15455 
rc
 = 0;

15458 
z
 +ð
n
;

15459  
sql™e3Is¥aû
(*
z
) ) z++;

15460 
n
 = 
sql™e3SŒËn30
(
z
);

15461 ifÐ
n
>10 ||‚<3 ) ;

15462 ifÐ
z
[
n
-1]=='s' ){ z[n-1] = 0;‚--; }

15463 
compu‹JD
(
p
);

15464 
rc
 = 0;

15465 
rRound”
 = 
r
<0 ? -0.5 : +0.5;

15466 ifÐ
n
==3 && 
¡rcmp
(
z
,"day")==0 ){

15467 
p
->
iJD
 +ð(
sql™e3_št64
)(
r
*86400000.0 + 
rRound”
);

15468 }ifÐ
n
==4 && 
¡rcmp
(
z
,"hour")==0 ){

15469 
p
->
iJD
 +ð(
sql™e3_št64
)(
r
*(86400000.0/24.0è+ 
rRound”
);

15470 }ifÐ
n
==6 && 
¡rcmp
(
z
,"minute")==0 ){

15471 
p
->
iJD
 +ð(
sql™e3_št64
)(
r
*(86400000.0/(24.0*60.0)è+ 
rRound”
);

15472 }ifÐ
n
==6 && 
¡rcmp
(
z
,"second")==0 ){

15473 
p
->
iJD
 +ð(
sql™e3_št64
)(
r
*(86400000.0/(24.0*60.0*60.0)è+ 
rRound”
);

15474 }ifÐ
n
==5 && 
¡rcmp
(
z
,"month")==0 ){

15475 
x
, 
y
;

15476 
compu‹YMD_HMS
(
p
);

15477 
p
->
M
 +ð()
r
;

15478 
x
 = 
p
->
M
>0 ? (p->M-1)/12 : (p->M-12)/12;

15479 
p
->
Y
 +ð
x
;

15480 
p
->
M
 -ð
x
*12;

15481 
p
->
v®idJD
 = 0;

15482 
compu‹JD
(
p
);

15483 
y
 = ()
r
;

15484 ifÐ
y
!=
r
 ){

15485 
p
->
iJD
 +ð(
sql™e3_št64
)((
r
 - 
y
)*30.0*86400000.0 + 
rRound”
);

15487 }ifÐ
n
==4 && 
¡rcmp
(
z
,"year")==0 ){

15488 
y
 = ()
r
;

15489 
compu‹YMD_HMS
(
p
);

15490 
p
->
Y
 +ð
y
;

15491 
p
->
v®idJD
 = 0;

15492 
compu‹JD
(
p
);

15493 ifÐ
y
!=
r
 ){

15494 
p
->
iJD
 +ð(
sql™e3_št64
)((
r
 - 
y
)*365.0*86400000.0 + 
rRound”
);

15497 
rc
 = 1;

15499 
þ—rYMD_HMS_TZ
(
p
);

15506  
rc
;

15518 
isD©e
(

15519 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15520 
¬gc
,

15521 
sql™e3_v®ue
 **
¬gv
,

15522 
D©eTime
 *
p


15524 
i
;

15525 cÚ¡ *
z
;

15526 
eTy³
;

15527 
mem£t
(
p
, 0, (*p));

15528 ifÐ
¬gc
==0 ){

15529  
£tD©eTimeToCu¼’t
(
cÚ‹xt
, 
p
);

15531 ifÐ(
eTy³
 = 
sql™e3_v®ue_ty³
(
¬gv
[0]))==
SQLITE_FLOAT


15532 || 
eTy³
==
SQLITE_INTEGER
 ){

15533 
p
->
iJD
 = (
sql™e3_št64
)(
sql™e3_v®ue_doubË
(
¬gv
[0])*86400000.0 + 0.5);

15534 
p
->
v®idJD
 = 1;

15536 
z
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

15537 ifÐ!
z
 || 
·r£D©eOrTime
(
cÚ‹xt
, (*)z, 
p
) ){

15541 
i
=1; i<
¬gc
; i++){

15542 
z
 = 
sql™e3_v®ue_‹xt
(
¬gv
[
i
]);

15543 ifÐ
z
==0 || 
·r£Modif›r
(
cÚ‹xt
, (*)z, 
p
) )  1;

15559 
julŸndayFunc
(

15560 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15561 
¬gc
,

15562 
sql™e3_v®ue
 **
¬gv


15564 
D©eTime
 
x
;

15565 ifÐ
isD©e
(
cÚ‹xt
, 
¬gc
, 
¬gv
, &
x
)==0 ){

15566 
compu‹JD
(&
x
);

15567 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
x
.
iJD
/86400000.0);

15576 
d©‘imeFunc
(

15577 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15578 
¬gc
,

15579 
sql™e3_v®ue
 **
¬gv


15581 
D©eTime
 
x
;

15582 ifÐ
isD©e
(
cÚ‹xt
, 
¬gc
, 
¬gv
, &
x
)==0 ){

15583 
zBuf
[100];

15584 
compu‹YMD_HMS
(&
x
);

15585 
sql™e3_¢´štf
((
zBuf
), zBuf, "%04d-%02d-%02d %02d:%02d:%02d",

15586 
x
.
Y
, x.
M
, x.
D
, x.
h
, x.
m
, ()(x.
s
));

15587 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

15596 
timeFunc
(

15597 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15598 
¬gc
,

15599 
sql™e3_v®ue
 **
¬gv


15601 
D©eTime
 
x
;

15602 ifÐ
isD©e
(
cÚ‹xt
, 
¬gc
, 
¬gv
, &
x
)==0 ){

15603 
zBuf
[100];

15604 
compu‹HMS
(&
x
);

15605 
sql™e3_¢´štf
((
zBuf
), zBuf, "%02d:%02d:%02d", 
x
.
h
, x.
m
, ()x.
s
);

15606 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

15615 
d©eFunc
(

15616 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15617 
¬gc
,

15618 
sql™e3_v®ue
 **
¬gv


15620 
D©eTime
 
x
;

15621 ifÐ
isD©e
(
cÚ‹xt
, 
¬gc
, 
¬gv
, &
x
)==0 ){

15622 
zBuf
[100];

15623 
compu‹YMD
(&
x
);

15624 
sql™e3_¢´štf
((
zBuf
), zBuf, "%04d-%02d-%02d", 
x
.
Y
, x.
M
, x.
D
);

15625 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

15648 
¡ráimeFunc
(

15649 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15650 
¬gc
,

15651 
sql™e3_v®ue
 **
¬gv


15653 
D©eTime
 
x
;

15654 
u64
 
n
;

15655 
size_t
 
i
,
j
;

15656 *
z
;

15657 
sql™e3
 *
db
;

15658 cÚ¡ *
zFmt
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

15659 
zBuf
[100];

15660 ifÐ
zFmt
==0 || 
isD©e
(
cÚ‹xt
, 
¬gc
-1, 
¬gv
+1, &
x
) ) ;

15661 
db
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

15662 
i
=0, 
n
=1; 
zFmt
[i]; i++,‚++){

15663 ifÐ
zFmt
[
i
]=='%' ){

15664  
zFmt
[
i
+1] ){

15671 
n
++;

15677 
n
 += 8;

15680 
n
 += 3;

15683 
n
 += 8;

15687 
n
 += 50;

15692 
i
++;

15695 
‹¡ÿ£
Ð
n
==(
zBuf
)-1 );

15696 
‹¡ÿ£
Ð
n
==(
zBuf
) );

15697 
‹¡ÿ£
Ð
n
==(
u64
)
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
]+1 );

15698 
‹¡ÿ£
Ð
n
==(
u64
)
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] );

15699 ifÐ
n
<(
zBuf
) ){

15700 
z
 = 
zBuf
;

15701 }ifÐ
n
>(
u64
)
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] ){

15702 
sql™e3_»suÉ_”rÜ_toobig
(
cÚ‹xt
);

15705 
z
 = 
sql™e3DbM®locRaw
(
db
, ()
n
);

15706 ifÐ
z
==0 ){

15707 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

15711 
compu‹JD
(&
x
);

15712 
compu‹YMD_HMS
(&
x
);

15713 
i
=
j
=0; 
zFmt
[i]; i++){

15714 ifÐ
zFmt
[
i
]!='%' ){

15715 
z
[
j
++] = 
zFmt
[
i
];

15717 
i
++;

15718  
zFmt
[
i
] ){

15719 'd': 
sql™e3_¢´štf
(3, &
z
[
j
],"%02d",
x
.
D
); j+=2; ;

15721 
s
 = 
x
.s;

15722 ifÐ
s
>59.999 ) s = 59.999;

15723 
sql™e3_¢´štf
(7, &
z
[
j
],"%06.3f", 
s
);

15724 
j
 +ð
sql™e3SŒËn30
(&
z
[j]);

15727 'H': 
sql™e3_¢´štf
(3, &
z
[
j
],"%02d",
x
.
h
); j+=2; ;

15730 
nDay
;

15731 
D©eTime
 
y
 = 
x
;

15732 
y
.
v®idJD
 = 0;

15733 
y
.
M
 = 1;

15734 
y
.
D
 = 1;

15735 
compu‹JD
(&
y
);

15736 
nDay
 = ()((
x
.
iJD
-
y
.iJD+43200000)/86400000);

15737 ifÐ
zFmt
[
i
]=='W' ){

15738 
wd
;

15739 
wd
 = ()(((
x
.
iJD
+43200000)/86400000)%7);

15740 
sql™e3_¢´štf
(3, &
z
[
j
],"%02d",(
nDay
+7-
wd
)/7);

15741 
j
 += 2;

15743 
sql™e3_¢´štf
(4, &
z
[
j
],"%03d",
nDay
+1);

15744 
j
 += 3;

15749 
sql™e3_¢´štf
(20, &
z
[
j
],"%.16g",
x
.
iJD
/86400000.0);

15750 
j
+=
sql™e3SŒËn30
(&
z
[j]);

15753 'm': 
sql™e3_¢´štf
(3, &
z
[
j
],"%02d",
x
.
M
); j+=2; ;

15754 'M': 
sql™e3_¢´štf
(3, &
z
[
j
],"%02d",
x
.
m
); j+=2; ;

15756 
sql™e3_¢´štf
(30,&
z
[
j
],"%lld",

15757 (
i64
)(
x
.
iJD
/1000 - 21086676*(i64)10000));

15758 
j
 +ð
sql™e3SŒËn30
(&
z
[j]);

15761 'S': 
sql™e3_¢´štf
(3,&
z
[
j
],"%02d",()
x
.
s
); j+=2; ;

15763 
z
[
j
++] = ()(((
x
.
iJD
+129600000)/86400000) % 7) + '0';

15767 
sql™e3_¢´štf
(5,&
z
[
j
],"%04d",
x
.
Y
); j+=
sql™e3SŒËn30
(&z[j]);

15770 : 
z
[
j
++] = '%'; ;

15774 
z
[
j
] = 0;

15775 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
z
, -1,

15776 
z
==
zBuf
 ? 
SQLITE_TRANSIENT
 : 
SQLITE_DYNAMIC
);

15784 
ùimeFunc
(

15785 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15786 
NÙU£d
,

15787 
sql™e3_v®ue
 **
NÙU£d2


15789 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

15790 
timeFunc
(
cÚ‹xt
, 0, 0);

15798 
cd©eFunc
(

15799 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15800 
NÙU£d
,

15801 
sql™e3_v®ue
 **
NÙU£d2


15803 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

15804 
d©eFunc
(
cÚ‹xt
, 0, 0);

15812 
ùime¡ampFunc
(

15813 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15814 
NÙU£d
,

15815 
sql™e3_v®ue
 **
NÙU£d2


15817 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

15818 
d©‘imeFunc
(
cÚ‹xt
, 0, 0);

15822 #ifdeà
SQLITE_OMIT_DATETIME_FUNCS


15834 
cu¼’tTimeFunc
(

15835 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

15836 
¬gc
,

15837 
sql™e3_v®ue
 **
¬gv


15839 
time_t
 
t
;

15840 *
zFÜm©
 = (*)
sql™e3_u£r_d©a
(
cÚ‹xt
);

15841 
sql™e3
 *
db
;

15842 
sql™e3_št64
 
iT
;

15843 
tm
 *
pTm
;

15844 
tm
 
sNow
;

15845 
zBuf
[20];

15847 
UNUSED_PARAMETER
(
¬gc
);

15848 
UNUSED_PARAMETER
(
¬gv
);

15850 
iT
 = 
sql™e3StmtCu¼’tTime
(
cÚ‹xt
);

15851 ifÐ
iT
<=0 ) ;

15852 
t
 = 
iT
/1000 - 10000*(
sql™e3_št64
)21086676;

15853 #ifdeà
HAVE_GMTIME_R


15854 
pTm
 = 
gmtime_r
(&
t
, &
sNow
);

15856 
sql™e3_mu‹x_’‹r
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

15857 
pTm
 = 
gmtime
(&
t
);

15858 ifÐ
pTm
 ) 
memýy
(&
sNow
,…Tm, (sNow));

15859 
sql™e3_mu‹x_Ëave
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

15861 ifÐ
pTm
 ){

15862 
¡ráime
(
zBuf
, 20, 
zFÜm©
, &
sNow
);

15863 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

15873 
SQLITE_PRIVATE
 
sql™e3Regi¡”D©eTimeFunùiÚs
(){

15874 
SQLITE_WSD
 
FuncDef
 
aD©eTimeFuncs
[] = {

15875 #iâdeà
SQLITE_OMIT_DATETIME_FUNCS


15876 
FUNCTION
(
julŸnday
, -1, 0, 0, 
julŸndayFunc
 ),

15877 
FUNCTION
(
d©e
, -1, 0, 0, 
d©eFunc
 ),

15878 
FUNCTION
(
time
, -1, 0, 0, 
timeFunc
 ),

15879 
FUNCTION
(
d©‘ime
, -1, 0, 0, 
d©‘imeFunc
 ),

15880 
FUNCTION
(
¡ráime
, -1, 0, 0, 
¡ráimeFunc
 ),

15881 
FUNCTION
(
cu¼’t_time
, 0, 0, 0, 
ùimeFunc
 ),

15882 
FUNCTION
(
cu¼’t_time¡amp
, 0, 0, 0, 
ùime¡ampFunc
),

15883 
FUNCTION
(
cu¼’t_d©e
, 0, 0, 0, 
cd©eFunc
 ),

15885 
STR_FUNCTION
(
cu¼’t_time
, 0, "%H:%M:%S", 0, 
cu¼’tTimeFunc
),

15886 
STR_FUNCTION
(
cu¼’t_d©e
, 0, "%Y-%m-%d", 0, 
cu¼’tTimeFunc
),

15887 
STR_FUNCTION
(
cu¼’t_time¡amp
, 0, "%Y-%m-%d %H:%M:%S", 0, 
cu¼’tTimeFunc
),

15890 
i
;

15891 
FuncDefHash
 *
pHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

15892 
FuncDef
 *
aFunc
 = (FuncDef*)&
GLOBAL
(FuncDef, 
aD©eTimeFuncs
);

15894 
i
=0; i<
A¼aySize
(
aD©eTimeFuncs
); i++){

15895 
sql™e3FuncDefIn£¹
(
pHash
, &
aFunc
[
i
]);

15916 
	#_SQLITE_OS_C_
 1

	)

15917 #undeà
_SQLITE_OS_C_


15943 #ià
defšed
(
SQLITE_TEST
)

15944 
SQLITE_API
 
sql™e3_memdebug_vfs_oom_‹¡
 = 1;

15945 
	#DO_OS_MALLOC_TEST
(
x
) \

15946 ià(
sql™e3_memdebug_vfs_oom_‹¡
 && (!
x
 || !
	`sql™e3IsMemJouº®
(x))) { \

15947 *
pT¡AÎoc
 = 
	`sql™e3M®loc
(10); \

15948 ià(!
pT¡AÎoc
è 
SQLITE_IOERR_NOMEM
; \

15949 
	`sql™e3_ä“
(
pT¡AÎoc
); \

15950 }

	)

15952 
	#DO_OS_MALLOC_TEST
(
x
)

	)

15961 
SQLITE_PRIVATE
 
sql™e3OsClo£
(
sql™e3_fže
 *
pId
){

15962 
rc
 = 
SQLITE_OK
;

15963 ifÐ
pId
->
pM‘hods
 ){

15964 
rc
 = 
pId
->
pM‘hods
->
xClo£
(pId);

15965 
pId
->
pM‘hods
 = 0;

15967  
rc
;

15969 
SQLITE_PRIVATE
 
sql™e3OsR—d
(
sql™e3_fže
 *
id
, *
pBuf
, 
amt
, 
i64
 
off£t
){

15970 
DO_OS_MALLOC_TEST
(
id
);

15971  
id
->
pM‘hods
->
xR—d
(id, 
pBuf
, 
amt
, 
off£t
);

15973 
SQLITE_PRIVATE
 
sql™e3OsWr™e
(
sql™e3_fže
 *
id
, cÚ¡ *
pBuf
, 
amt
, 
i64
 
off£t
){

15974 
DO_OS_MALLOC_TEST
(
id
);

15975  
id
->
pM‘hods
->
xWr™e
(id, 
pBuf
, 
amt
, 
off£t
);

15977 
SQLITE_PRIVATE
 
sql™e3OsTrunÿ‹
(
sql™e3_fže
 *
id
, 
i64
 
size
){

15978  
id
->
pM‘hods
->
xTrunÿ‹
(id, 
size
);

15980 
SQLITE_PRIVATE
 
sql™e3OsSync
(
sql™e3_fže
 *
id
, 
æags
){

15981 
DO_OS_MALLOC_TEST
(
id
);

15982  
id
->
pM‘hods
->
xSync
(id, 
æags
);

15984 
SQLITE_PRIVATE
 
sql™e3OsFžeSize
(
sql™e3_fže
 *
id
, 
i64
 *
pSize
){

15985 
DO_OS_MALLOC_TEST
(
id
);

15986  
id
->
pM‘hods
->
xFžeSize
(id, 
pSize
);

15988 
SQLITE_PRIVATE
 
sql™e3OsLock
(
sql™e3_fže
 *
id
, 
lockTy³
){

15989 
DO_OS_MALLOC_TEST
(
id
);

15990  
id
->
pM‘hods
->
xLock
(id, 
lockTy³
);

15992 
SQLITE_PRIVATE
 
sql™e3OsUÆock
(
sql™e3_fže
 *
id
, 
lockTy³
){

15993  
id
->
pM‘hods
->
xUÆock
(id, 
lockTy³
);

15995 
SQLITE_PRIVATE
 
sql™e3OsCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
){

15996 
DO_OS_MALLOC_TEST
(
id
);

15997  
id
->
pM‘hods
->
xCheckRe£rvedLock
(id, 
pResOut
);

16008 
SQLITE_PRIVATE
 
sql™e3OsFžeCÚŒÞ
(
sql™e3_fže
 *
id
, 
Ý
, *
pArg
){

16009 #ifdeà
SQLITE_TEST


16010 ifÐ
Ý
!=
SQLITE_FCNTL_COMMIT_PHASETWO
 ){

16021 
DO_OS_MALLOC_TEST
(
id
);

16024  
id
->
pM‘hods
->
xFžeCÚŒÞ
(id, 
Ý
, 
pArg
);

16026 
SQLITE_PRIVATE
 
sql™e3OsFžeCÚŒÞHšt
(
sql™e3_fže
 *
id
, 
Ý
, *
pArg
){

16027 ()
id
->
pM‘hods
->
xFžeCÚŒÞ
(id, 
Ý
, 
pArg
);

16030 
SQLITE_PRIVATE
 
sql™e3OsSeùÜSize
(
sql™e3_fže
 *
id
){

16031 (*
xSeùÜSize
)(
sql™e3_fže
*èð
id
->
pM‘hods
->xSectorSize;

16032  (
xSeùÜSize
 ? xSeùÜSize(
id
è: 
SQLITE_DEFAULT_SECTOR_SIZE
);

16034 
SQLITE_PRIVATE
 
sql™e3OsDeviûCh¬aù”i¡ics
(
sql™e3_fže
 *
id
){

16035  
id
->
pM‘hods
->
xDeviûCh¬aù”i¡ics
(id);

16037 
SQLITE_PRIVATE
 
sql™e3OsShmLock
(
sql™e3_fže
 *
id
, 
off£t
, 
n
, 
æags
){

16038  
id
->
pM‘hods
->
xShmLock
(id, 
off£t
, 
n
, 
æags
);

16040 
SQLITE_PRIVATE
 
sql™e3OsShmB¬r›r
(
sql™e3_fže
 *
id
){

16041 
id
->
pM‘hods
->
xShmB¬r›r
(id);

16043 
SQLITE_PRIVATE
 
sql™e3OsShmUnm­
(
sql™e3_fže
 *
id
, 
d–‘eFÏg
){

16044  
id
->
pM‘hods
->
xShmUnm­
(id, 
d–‘eFÏg
);

16046 
SQLITE_PRIVATE
 
sql™e3OsShmM­
(

16047 
sql™e3_fže
 *
id
,

16048 
iPage
,

16049 
pgsz
,

16050 
bEx‹nd
,

16051 vÞ©ž**
µ


16053 
DO_OS_MALLOC_TEST
(
id
);

16054  
id
->
pM‘hods
->
xShmM­
(id, 
iPage
, 
pgsz
, 
bEx‹nd
, 
µ
);

16057 #ià
SQLITE_MAX_MMAP_SIZE
>0

16059 
SQLITE_PRIVATE
 
sql™e3OsF‘ch
(
sql™e3_fže
 *
id
, 
i64
 
iOff
, 
iAmt
, **
µ
){

16060 
DO_OS_MALLOC_TEST
(
id
);

16061  
id
->
pM‘hods
->
xF‘ch
(id, 
iOff
, 
iAmt
, 
µ
);

16063 
SQLITE_PRIVATE
 
sql™e3OsUnãtch
(
sql™e3_fže
 *
id
, 
i64
 
iOff
, *
p
){

16064  
id
->
pM‘hods
->
xUnãtch
(id, 
iOff
, 
p
);

16068 
SQLITE_PRIVATE
 
sql™e3OsF‘ch
(
sql™e3_fže
 *
id
, 
i64
 
iOff
, 
iAmt
, **
µ
){

16069 *
µ
 = 0;

16070  
SQLITE_OK
;

16072 
SQLITE_PRIVATE
 
sql™e3OsUnãtch
(
sql™e3_fže
 *
id
, 
i64
 
iOff
, *
p
){

16073  
SQLITE_OK
;

16081 
SQLITE_PRIVATE
 
sql™e3OsO³n
(

16082 
sql™e3_vfs
 *
pVfs
,

16083 cÚ¡ *
zP©h
,

16084 
sql™e3_fže
 *
pFže
,

16085 
æags
,

16086 *
pFÏgsOut


16088 
rc
;

16089 
DO_OS_MALLOC_TEST
(0);

16094 
rc
 = 
pVfs
->
xO³n
ÕVfs, 
zP©h
, 
pFže
, 
æags
 & 0x87f7f, 
pFÏgsOut
);

16095 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pFže
->
pM‘hods
==0 );

16096  
rc
;

16098 
SQLITE_PRIVATE
 
sql™e3OsD–‘e
(
sql™e3_vfs
 *
pVfs
, cÚ¡ *
zP©h
, 
dœSync
){

16099 
DO_OS_MALLOC_TEST
(0);

16100 
as£¹
Ð
dœSync
==0 || dirSync==1 );

16101  
pVfs
->
xD–‘e
ÕVfs, 
zP©h
, 
dœSync
);

16103 
SQLITE_PRIVATE
 
sql™e3OsAcûss
(

16104 
sql™e3_vfs
 *
pVfs
,

16105 cÚ¡ *
zP©h
,

16106 
æags
,

16107 *
pResOut


16109 
DO_OS_MALLOC_TEST
(0);

16110  
pVfs
->
xAcûss
ÕVfs, 
zP©h
, 
æags
, 
pResOut
);

16112 
SQLITE_PRIVATE
 
sql™e3OsFuÎP©hÇme
(

16113 
sql™e3_vfs
 *
pVfs
,

16114 cÚ¡ *
zP©h
,

16115 
nP©hOut
,

16116 *
zP©hOut


16118 
DO_OS_MALLOC_TEST
(0);

16119 
zP©hOut
[0] = 0;

16120  
pVfs
->
xFuÎP©hÇme
ÕVfs, 
zP©h
, 
nP©hOut
, 
zP©hOut
);

16122 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


16123 
SQLITE_PRIVATE
 *
sql™e3OsDlO³n
(
sql™e3_vfs
 *
pVfs
, cÚ¡ *
zP©h
){

16124  
pVfs
->
xDlO³n
ÕVfs, 
zP©h
);

16126 
SQLITE_PRIVATE
 
sql™e3OsDlE¼Ü
(
sql™e3_vfs
 *
pVfs
, 
nBy‹
, *
zBufOut
){

16127 
pVfs
->
xDlE¼Ü
ÕVfs, 
nBy‹
, 
zBufOut
);

16129 
SQLITE_PRIVATE
 (*
sql™e3OsDlSym
(
sql™e3_vfs
 *
pVfs
, *
pHdË
, cÚ¡ *
zSym
))(){

16130  
pVfs
->
xDlSym
ÕVfs, 
pHdË
, 
zSym
);

16132 
SQLITE_PRIVATE
 
sql™e3OsDlClo£
(
sql™e3_vfs
 *
pVfs
, *
pHªdË
){

16133 
pVfs
->
xDlClo£
ÕVfs, 
pHªdË
);

16136 
SQLITE_PRIVATE
 
sql™e3OsRªdomÃss
(
sql™e3_vfs
 *
pVfs
, 
nBy‹
, *
zBufOut
){

16137  
pVfs
->
xRªdomÃss
ÕVfs, 
nBy‹
, 
zBufOut
);

16139 
SQLITE_PRIVATE
 
sql™e3OsSË•
(
sql™e3_vfs
 *
pVfs
, 
nMiüo
){

16140  
pVfs
->
xSË•
ÕVfs, 
nMiüo
);

16142 
SQLITE_PRIVATE
 
sql™e3OsCu¼’tTimeIÁ64
(
sql™e3_vfs
 *
pVfs
, 
sql™e3_št64
 *
pTimeOut
){

16143 
rc
;

16150 ifÐ
pVfs
->
iV”siÚ
>=2 &&…Vfs->
xCu¼’tTimeIÁ64
 ){

16151 
rc
 = 
pVfs
->
xCu¼’tTimeIÁ64
ÕVfs, 
pTimeOut
);

16153 
r
;

16154 
rc
 = 
pVfs
->
xCu¼’tTime
ÕVfs, &
r
);

16155 *
pTimeOut
 = (
sql™e3_št64
)(
r
*86400000.0);

16157  
rc
;

16160 
SQLITE_PRIVATE
 
sql™e3OsO³nM®loc
(

16161 
sql™e3_vfs
 *
pVfs
,

16162 cÚ¡ *
zFže
,

16163 
sql™e3_fže
 **
µFže
,

16164 
æags
,

16165 *
pOutFÏgs


16167 
rc
 = 
SQLITE_NOMEM
;

16168 
sql™e3_fže
 *
pFže
;

16169 
pFže
 = (
sql™e3_fže
 *)
sql™e3M®locZ”o
(
pVfs
->
szOsFže
);

16170 ifÐ
pFže
 ){

16171 
rc
 = 
sql™e3OsO³n
(
pVfs
, 
zFže
, 
pFže
, 
æags
, 
pOutFÏgs
);

16172 ifÐ
rc
!=
SQLITE_OK
 ){

16173 
sql™e3_ä“
(
pFže
);

16175 *
µFže
 = 
pFže
;

16178  
rc
;

16180 
SQLITE_PRIVATE
 
sql™e3OsClo£F»e
(
sql™e3_fže
 *
pFže
){

16181 
rc
 = 
SQLITE_OK
;

16182 
as£¹
Ð
pFže
 );

16183 
rc
 = 
sql™e3OsClo£
(
pFže
);

16184 
sql™e3_ä“
(
pFže
);

16185  
rc
;

16194 
SQLITE_PRIVATE
 
sql™e3OsIn™
(){

16195 *
p
 = 
sql™e3_m®loc
(10);

16196 ifÐ
p
==0 )  
SQLITE_NOMEM
;

16197 
sql™e3_ä“
(
p
);

16198  
sql™e3_os_š™
();

16204 
sql™e3_vfs
 * 
SQLITE_WSD
 
vfsLi¡
 = 0;

16205 
	#vfsLi¡
 
	`GLOBAL
(
sql™e3_vfs
 *, 
vfsLi¡
)

	)

16211 
SQLITE_API
 
sql™e3_vfs
 *
sql™e3_vfs_fšd
(cÚ¡ *
zVfs
){

16212 
sql™e3_vfs
 *
pVfs
 = 0;

16213 #ià
SQLITE_THREADSAFE


16214 
sql™e3_mu‹x
 *
mu‹x
;

16216 #iâdeà
SQLITE_OMIT_AUTOINIT


16217 
rc
 = 
sql™e3_š™Ÿlize
();

16218 ifÐ
rc
 )  0;

16220 #ià
SQLITE_THREADSAFE


16221 
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

16223 
sql™e3_mu‹x_’‹r
(
mu‹x
);

16224 
pVfs
 = 
vfsLi¡
;…Vfs;…VfsõVfs->
pNext
){

16225 ifÐ
zVfs
==0 ) ;

16226 ifÐ
¡rcmp
(
zVfs
, 
pVfs
->
zName
)==0 ) ;

16228 
sql™e3_mu‹x_Ëave
(
mu‹x
);

16229  
pVfs
;

16235 
vfsUÆšk
(
sql™e3_vfs
 *
pVfs
){

16236 
as£¹
Ð
sql™e3_mu‹x_h–d
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
)) );

16237 ifÐ
pVfs
==0 ){

16239 }ifÐ
vfsLi¡
==
pVfs
 ){

16240 
vfsLi¡
 = 
pVfs
->
pNext
;

16241 }ifÐ
vfsLi¡
 ){

16242 
sql™e3_vfs
 *
p
 = 
vfsLi¡
;

16243  
p
->
pNext
 &&…->pNext!=
pVfs
 ){

16244 
p
 =…->
pNext
;

16246 ifÐ
p
->
pNext
==
pVfs
 ){

16247 
p
->
pNext
 = 
pVfs
->pNext;

16257 
SQLITE_API
 
sql™e3_vfs_»gi¡”
(
sql™e3_vfs
 *
pVfs
, 
makeDæt
){

16258 
MUTEX_LOGIC
(
sql™e3_mu‹x
 *
mu‹x
;)

16259 #iâdeà
SQLITE_OMIT_AUTOINIT


16260 
rc
 = 
sql™e3_š™Ÿlize
();

16261 ifÐ
rc
 ) „c;

16263 
MUTEX_LOGIC
Ð
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
); )

16264 
sql™e3_mu‹x_’‹r
(
mu‹x
);

16265 
vfsUÆšk
(
pVfs
);

16266 ifÐ
makeDæt
 || 
vfsLi¡
==0 ){

16267 
pVfs
->
pNext
 = 
vfsLi¡
;

16268 
vfsLi¡
 = 
pVfs
;

16270 
pVfs
->
pNext
 = 
vfsLi¡
->pNext;

16271 
vfsLi¡
->
pNext
 = 
pVfs
;

16273 
as£¹
(
vfsLi¡
);

16274 
sql™e3_mu‹x_Ëave
(
mu‹x
);

16275  
SQLITE_OK
;

16281 
SQLITE_API
 
sql™e3_vfs_uÄegi¡”
(
sql™e3_vfs
 *
pVfs
){

16282 #ià
SQLITE_THREADSAFE


16283 
sql™e3_mu‹x
 *
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

16285 
sql™e3_mu‹x_’‹r
(
mu‹x
);

16286 
vfsUÆšk
(
pVfs
);

16287 
sql™e3_mu‹x_Ëave
(
mu‹x
);

16288  
SQLITE_OK
;

16320 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


16325 
B’ignM®locHooks
 
	tB’ignM®locHooks
;

16326 
SQLITE_WSD
 
	sB’ignM®locHooks
 {

16327 (*
xB’ignBegš
)();

16328 (*
xB’ignEnd
)();

16329 } 
sql™e3Hooks
 = { 0, 0 };

16337 #ifdeà
SQLITE_OMIT_WSD


16338 
	#wsdHooksIn™
 \

16339 
B’ignM®locHooks
 *
x
 = &
	`GLOBAL
(B’ignM®locHooks,
sql™e3Hooks
)

	)

16340 
	#wsdHooks
 
x
[0]

	)

16342 
	#wsdHooksIn™


	)

16343 
	#wsdHooks
 
sql™e3Hooks


	)

16351 
SQLITE_PRIVATE
 
sql™e3B’ignM®locHooks
(

16352 (*
xB’ignBegš
)(),

16353 (*
xB’ignEnd
)()

16355 
wsdHooksIn™
;

16356 
wsdHooks
.
xB’ignBegš
 = xBenignBegin;

16357 
wsdHooks
.
xB’ignEnd
 = xBenignEnd;

16365 
SQLITE_PRIVATE
 
sql™e3BegšB’ignM®loc
(){

16366 
wsdHooksIn™
;

16367 ifÐ
wsdHooks
.
xB’ignBegš
 ){

16368 
wsdHooks
.
xB’ignBegš
();

16371 
SQLITE_PRIVATE
 
sql™e3EndB’ignM®loc
(){

16372 
wsdHooksIn™
;

16373 ifÐ
wsdHooks
.
xB’ignEnd
 ){

16374 
wsdHooks
.
xB’ignEnd
();

16406 #ifdeà
SQLITE_ZERO_MALLOC


16411 *
sql™e3MemM®loc
(
nBy‹
){  0; }

16412 
sql™e3MemF»e
(*
pPriÜ
){ ; }

16413 *
sql™e3MemR—Îoc
(*
pPriÜ
, 
nBy‹
){  0; }

16414 
sql™e3MemSize
(*
pPriÜ
){  0; }

16415 
sql™e3MemRoundup
(
n
){ ‚; }

16416 
sql™e3MemIn™
(*
NÙU£d
){  
SQLITE_OK
; }

16417 
sql™e3MemShutdown
(*
NÙU£d
){ ; }

16425 
SQLITE_PRIVATE
 
sql™e3MemS‘DeçuÉ
(){

16426 cÚ¡ 
sql™e3_mem_m‘hods
 
deçuÉM‘hods
 = {

16427 
sql™e3MemM®loc
,

16428 
sql™e3MemF»e
,

16429 
sql™e3MemR—Îoc
,

16430 
sql™e3MemSize
,

16431 
sql™e3MemRoundup
,

16432 
sql™e3MemIn™
,

16433 
sql™e3MemShutdown
,

16436 
sql™e3_cÚfig
(
SQLITE_CONFIG_MALLOC
, &
deçuÉM‘hods
);

16492 #ifdeà
SQLITE_SYSTEM_MALLOC


16493 #ià
defšed
(
__APPLE__
è&& !defšed(
SQLITE_WITHOUT_ZONEMALLOC
)

16499 
	~<sys/sysùl.h
>

16500 
	~<m®loc/m®loc.h
>

16501 
	~<libk”n/OSAtomic.h
>

16502 
m®loc_zÚe_t
* 
_sql™eZÚe_
;

16503 
	#SQLITE_MALLOC
(
x
è
	`m®loc_zÚe_m®loc
(
_sql™eZÚe_
, (x))

	)

16504 
	#SQLITE_FREE
(
x
è
	`m®loc_zÚe_ä“
(
_sql™eZÚe_
, (x));

	)

16505 
	#SQLITE_REALLOC
(
x
,
y
è
	`m®loc_zÚe_»®loc
(
_sql™eZÚe_
, (x), (y))

	)

16506 
	#SQLITE_MALLOCSIZE
(
x
) \

16507 (
_sql™eZÚe_
 ? _sql™eZÚe_->
	`size
(_sql™eZÚe_,
x
è: 
	`m®loc_size
(x))

	)

16515 
	#SQLITE_MALLOC
(
x
è
	`m®loc
(x)

	)

16516 
	#SQLITE_FREE
(
x
è
	`ä“
(x)

	)

16517 
	#SQLITE_REALLOC
(
x
,
y
è
	`»®loc
((x),(y))

	)

16523 #ià
defšed
(
HAVE_MALLOC_H
è&& defšed(
HAVE_MALLOC_USABLE_SIZE
)

16524 
	#SQLITE_USE_MALLOC_H


	)

16525 
	#SQLITE_USE_MALLOC_USABLE_SIZE


	)

16532 #–ià
defšed
(
_MSC_VER
è&& !defšed(
SQLITE_WITHOUT_MSIZE
)

16533 
	#SQLITE_USE_MALLOC_H


	)

16534 
	#SQLITE_USE_MSIZE


	)

16544 #ià
defšed
(
SQLITE_USE_MALLOC_H
)

16545 
	~<m®loc.h
>

16546 #ià
defšed
(
SQLITE_USE_MALLOC_USABLE_SIZE
)

16547 #ià!
defšed
(
SQLITE_MALLOCSIZE
)

16548 
	#SQLITE_MALLOCSIZE
(
x
è
	`m®loc_u§bË_size
(x)

	)

16550 #–ià
defšed
(
SQLITE_USE_MSIZE
)

16551 #ià!
defšed
(
SQLITE_MALLOCSIZE
)

16552 
	#SQLITE_MALLOCSIZE
 
_msize


	)

16567 *
sql™e3MemM®loc
(
nBy‹
){

16568 #ifdeà
SQLITE_MALLOCSIZE


16569 *
p
 = 
SQLITE_MALLOC
Ð
nBy‹
 );

16570 ifÐ
p
==0 ){

16571 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

16572 
sql™e3_log
(
SQLITE_NOMEM
, "çžedØ®loÿ‹ %u by‹ oàmemÜy", 
nBy‹
);

16574  
p
;

16576 
sql™e3_št64
 *
p
;

16577 
as£¹
Ð
nBy‹
>0 );

16578 
nBy‹
 = 
ROUND8
(nByte);

16579 
p
 = 
SQLITE_MALLOC
Ð
nBy‹
+8 );

16580 ifÐ
p
 ){

16581 
p
[0] = 
nBy‹
;

16582 
p
++;

16584 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

16585 
sql™e3_log
(
SQLITE_NOMEM
, "çžedØ®loÿ‹ %u by‹ oàmemÜy", 
nBy‹
);

16587  (*)
p
;

16599 
sql™e3MemF»e
(*
pPriÜ
){

16600 #ifdeà
SQLITE_MALLOCSIZE


16601 
SQLITE_FREE
(
pPriÜ
);

16603 
sql™e3_št64
 *
p
 = (sql™e3_št64*)
pPriÜ
;

16604 
as£¹
Ð
pPriÜ
!=0 );

16605 
p
--;

16606 
SQLITE_FREE
(
p
);

16614 
sql™e3MemSize
(*
pPriÜ
){

16615 #ifdeà
SQLITE_MALLOCSIZE


16616  
pPriÜ
 ? ()
SQLITE_MALLOCSIZE
(pPrior) : 0;

16618 
sql™e3_št64
 *
p
;

16619 ifÐ
pPriÜ
==0 )  0;

16620 
p
 = (
sql™e3_št64
*)
pPriÜ
;

16621 
p
--;

16622  ()
p
[0];

16636 *
sql™e3MemR—Îoc
(*
pPriÜ
, 
nBy‹
){

16637 #ifdeà
SQLITE_MALLOCSIZE


16638 *
p
 = 
SQLITE_REALLOC
(
pPriÜ
, 
nBy‹
);

16639 ifÐ
p
==0 ){

16640 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

16641 
sql™e3_log
(
SQLITE_NOMEM
,

16643 
SQLITE_MALLOCSIZE
(
pPriÜ
), 
nBy‹
);

16645  
p
;

16647 
sql™e3_št64
 *
p
 = (sql™e3_št64*)
pPriÜ
;

16648 
as£¹
Ð
pPriÜ
!=0 && 
nBy‹
>0 );

16649 
as£¹
Ð
nBy‹
==
ROUND8
(nByte) );

16650 
p
--;

16651 
p
 = 
SQLITE_REALLOC
Õ, 
nBy‹
+8 );

16652 ifÐ
p
 ){

16653 
p
[0] = 
nBy‹
;

16654 
p
++;

16656 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

16657 
sql™e3_log
(
SQLITE_NOMEM
,

16659 
sql™e3MemSize
(
pPriÜ
), 
nBy‹
);

16661  (*)
p
;

16668 
sql™e3MemRoundup
(
n
){

16669  
ROUND8
(
n
);

16675 
sql™e3MemIn™
(*
NÙU£d
){

16676 #ià
defšed
(
__APPLE__
è&& !defšed(
SQLITE_WITHOUT_ZONEMALLOC
)

16677 
ýuCouÁ
;

16678 
size_t
 
Ën
;

16679 ifÐ
_sql™eZÚe_
 ){

16680  
SQLITE_OK
;

16682 
Ën
 = (
ýuCouÁ
);

16684 
sysùlbyÇme
("hw.nýu", &
ýuCouÁ
, &
Ën
, 
NULL
, 0);

16685 ifÐ
ýuCouÁ
>1 ){

16687 
_sql™eZÚe_
 = 
m®loc_deçuÉ_zÚe
();

16691 
boÞ
 
sucûss
;

16692 
m®loc_zÚe_t
* 
ÃwzÚe
 = 
m®loc_ü—‹_zÚe
(4096, 0);

16693 
m®loc_£t_zÚe_Çme
(
ÃwzÚe
, "Sqlite_Heap");

16695 
sucûss
 = 
OSAtomicCom·»AndSw­PŒB¬r›r
(
NULL
, 
ÃwzÚe
,

16696 (* vÞ©ž*)&
_sql™eZÚe_
);

16697 }!
_sql™eZÚe_
);

16698 ifÐ!
sucûss
 ){

16700 
m®loc_de¡roy_zÚe
(
ÃwzÚe
);

16704 
UNUSED_PARAMETER
(
NÙU£d
);

16705  
SQLITE_OK
;

16711 
sql™e3MemShutdown
(*
NÙU£d
){

16712 
UNUSED_PARAMETER
(
NÙU£d
);

16722 
SQLITE_PRIVATE
 
sql™e3MemS‘DeçuÉ
(){

16723 cÚ¡ 
sql™e3_mem_m‘hods
 
deçuÉM‘hods
 = {

16724 
sql™e3MemM®loc
,

16725 
sql™e3MemF»e
,

16726 
sql™e3MemR—Îoc
,

16727 
sql™e3MemSize
,

16728 
sql™e3MemRoundup
,

16729 
sql™e3MemIn™
,

16730 
sql™e3MemShutdown
,

16733 
sql™e3_cÚfig
(
SQLITE_CONFIG_MALLOC
, &
deçuÉM‘hods
);

16766 #ifdeà
SQLITE_MEMDEBUG


16771 #ifdeà
__GLIBC__


16772 
backŒaû
(**,);

16773 
backŒaû_symbÞs_fd
(*const*,,);

16775 
	#backŒaû
(
A
,
B
è1

	)

16776 
	#backŒaû_symbÞs_fd
(
A
,
B
,
C
)

	)

16793 
	sMemBlockHdr
 {

16794 
i64
 
	giSize
;

16795 
MemBlockHdr
 *
	gpNext
, *
	gpP»v
;

16796 
	gnBackŒaû
;

16797 
	gnBackŒaûSlÙs
;

16798 
u8
 
	gnT™Ë
;

16799 
u8
 
	geTy³
;

16800 
	giFÜeGu¬d
;

16806 
	#FOREGUARD
 0x80F5E153

	)

16807 
	#REARGUARD
 0xE4676B53

	)

16812 
	#NCSIZE
 1000

	)

16825 
sql™e3_mu‹x
 *
	gmu‹x
;

16830 
MemBlockHdr
 *
	gpFœ¡
;

16831 
MemBlockHdr
 *
	gpLa¡
;

16836 
	gnBackŒaû
;

16837 (*
	gxBackŒaû
)(, , **);

16842 
	gnT™Ë
;

16843 
	gzT™Ë
[100];

16849 
	gdi§Îow
;

16857 
	gnAÎoc
[
NCSIZE
];

16858 
	gnCu¼’t
[
NCSIZE
];

16859 
	gmxCu¼’t
[
NCSIZE
];

16861 } 
	gmem
;

16867 
adju¡Sts
(
iSize
, 
šüem’t
){

16868 
	gi
 = 
ROUND8
(
iSize
)/8;

16869 ifÐ
	gi
>
	gNCSIZE
-1 ){

16870 
	gi
 = 
NCSIZE
 - 1;

16872 ifÐ
	gšüem’t
>0 ){

16873 
	gmem
.
	gnAÎoc
[
i
]++;

16874 
	gmem
.
	gnCu¼’t
[
i
]++;

16875 ifÐ
	gmem
.
	gnCu¼’t
[
i
]>mem.
	gmxCu¼’t
[i] ){

16876 
	gmem
.
	gmxCu¼’t
[
i
] = 
mem
.
nCu¼’t
[i];

16879 
	gmem
.
	gnCu¼’t
[
i
]--;

16880 
as£¹
Ð
mem
.
nCu¼’t
[
i
]>=0 );

16890 
MemBlockHdr
 *
sql™e3MemsysG‘H—d”
(*
pAÎoÿtiÚ
){

16891 
MemBlockHdr
 *
	gp
;

16892 *
	gpIÁ
;

16893 
u8
 *
	gpU8
;

16894 
	gnRe£rve
;

16896 
	gp
 = (
MemBlockHdr
*)
pAÎoÿtiÚ
;

16897 
	gp
--;

16898 
as£¹
Ð
p
->
iFÜeGu¬d
==()
FOREGUARD
 );

16899 
	gnRe£rve
 = 
ROUND8
(
p
->
iSize
);

16900 
	gpIÁ
 = (*)
pAÎoÿtiÚ
;

16901 
	gpU8
 = (
u8
*)
pAÎoÿtiÚ
;

16902 
as£¹
Ð
pIÁ
[
nRe£rve
/()]==()
REARGUARD
 );

16907  
	gnRe£rve
-- > 
	gp
->
	giSize
 ) 
as£¹
Ð
pU8
[
nRe£rve
]==0x65 );

16908  
	gp
;

16914 
sql™e3MemSize
(*
p
){

16915 
MemBlockHdr
 *
	gpHdr
;

16916 ifÐ!
	gp
 ){

16919 
	gpHdr
 = 
sql™e3MemsysG‘H—d”
(
p
);

16920  ()
	gpHdr
->
	giSize
;

16926 
sql™e3MemIn™
(*
NÙU£d
){

16927 
UNUSED_PARAMETER
(
NÙU£d
);

16928 
as£¹
Ð((
MemBlockHdr
)&7) == 0 );

16929 ifÐ!
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 ){

16932 
	gmem
.
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MEM
);

16934  
	gSQLITE_OK
;

16940 
sql™e3MemShutdown
(*
NÙU£d
){

16941 
UNUSED_PARAMETER
(
NÙU£d
);

16942 
	gmem
.
	gmu‹x
 = 0;

16948 
sql™e3MemRoundup
(
n
){

16949  
ROUND8
(
n
);

16957 
¿ndomFžl
(*
pBuf
, 
nBy‹
){

16958 
	gx
, 
	gy
, 
	gr
;

16959 
	gx
 = 
SQLITE_PTR_TO_INT
(
pBuf
);

16960 
	gy
 = 
nBy‹
 | 1;

16961  
	gnBy‹
 >= 4 ){

16962 
x
 = (x>>1) ^ (-()(x&1) & 0xd0000001);

16963 
	gy
 = 
y
*1103515245 + 12345;

16964 
	gr
 = 
x
 ^ 
y
;

16965 *(*)
	gpBuf
 = 
r
;

16966 
	gpBuf
 += 4;

16967 
	gnBy‹
 -= 4;

16969  
	gnBy‹
-- > 0 ){

16970 
	gx
 = (
x
>>1) ^ (-()(x&1) & 0xd0000001);

16971 
	gy
 = 
y
*1103515245 + 12345;

16972 
	gr
 = 
x
 ^ 
y
;

16973 *(
	gpBuf
++èð
r
 & 0xff;

16980 *
sql™e3MemM®loc
(
nBy‹
){

16981 
MemBlockHdr
 *
	gpHdr
;

16982 **
	gpBt
;

16983 *
	gz
;

16984 *
	gpIÁ
;

16985 *
	gp
 = 0;

16986 
	gtÙ®Size
;

16987 
	gnRe£rve
;

16988 
sql™e3_mu‹x_’‹r
(
mem
.
mu‹x
);

16989 
as£¹
Ð
mem
.
di§Îow
==0 );

16990 
	gnRe£rve
 = 
ROUND8
(
nBy‹
);

16991 
	gtÙ®Size
 = 
nRe£rve
 + (*
pHdr
) + () +

16992 
mem
.
nBackŒaû
*(*è+ mem.
nT™Ë
;

16993 
	gp
 = 
m®loc
(
tÙ®Size
);

16994 ifÐ
	gp
 ){

16995 
	gz
 = 
p
;

16996 
	gpBt
 = (**)&
z
[
mem
.
nT™Ë
];

16997 
	gpHdr
 = (
MemBlockHdr
*)&
pBt
[
mem
.
nBackŒaû
];

16998 
	gpHdr
->
	gpNext
 = 0;

16999 
	gpHdr
->
	gpP»v
 = 
mem
.
pLa¡
;

17000 ifÐ
	gmem
.
	gpLa¡
 ){

17001 
	gmem
.
	gpLa¡
->
	gpNext
 = 
pHdr
;

17003 
	gmem
.
	gpFœ¡
 = 
pHdr
;

17005 
	gmem
.
	gpLa¡
 = 
pHdr
;

17006 
	gpHdr
->
	giFÜeGu¬d
 = 
FOREGUARD
;

17007 
	gpHdr
->
	geTy³
 = 
MEMTYPE_HEAP
;

17008 
	gpHdr
->
	gnBackŒaûSlÙs
 = 
mem
.
nBackŒaû
;

17009 
	gpHdr
->
	gnT™Ë
 = 
mem
.
nT™Ë
;

17010 ifÐ
	gmem
.
	gnBackŒaû
 ){

17011 *
	gaAddr
[40];

17012 
	gpHdr
->
	gnBackŒaû
 = 
backŒaû
(
aAddr
, 
mem
.
nBackŒaû
+1)-1;

17013 
memýy
(
pBt
, &
aAddr
[1], 
pHdr
->
nBackŒaû
*(*));

17014 
as£¹
(
pBt
[0]);

17015 ifÐ
	gmem
.
	gxBackŒaû
 ){

17016 
	gmem
.
xBackŒaû
(
nBy‹
, 
pHdr
->
nBackŒaû
-1, &
aAddr
[1]);

17019 
	gpHdr
->
	gnBackŒaû
 = 0;

17021 ifÐ
	gmem
.
	gnT™Ë
 ){

17022 
memýy
(
z
, 
mem
.
zT™Ë
, mem.
nT™Ë
);

17024 
	gpHdr
->
	giSize
 = 
nBy‹
;

17025 
adju¡Sts
(
nBy‹
, +1);

17026 
	gpIÁ
 = (*)&
pHdr
[1];

17027 
	gpIÁ
[
nRe£rve
/()] = 
REARGUARD
;

17028 
¿ndomFžl
((*)
pIÁ
, 
nBy‹
);

17029 
mem£t
(((*)
pIÁ
)+
nBy‹
, 0x65, 
nRe£rve
-nByte);

17030 
	gp
 = (*)
pIÁ
;

17032 
sql™e3_mu‹x_Ëave
(
mem
.
mu‹x
);

17033  
	gp
;

17039 
sql™e3MemF»e
(*
pPriÜ
){

17040 
MemBlockHdr
 *
	gpHdr
;

17041 **
	gpBt
;

17042 *
	gz
;

17043 
as£¹
Ð
sql™e3Glob®CÚfig
.
bMem¡©
 || sql™e3Glob®CÚfig.
bCÜeMu‹x
==0

17044 || 
mem
.
mu‹x
!=0 );

17045 
	gpHdr
 = 
sql™e3MemsysG‘H—d”
(
pPriÜ
);

17046 
	gpBt
 = (**)
pHdr
;

17047 
	gpBt
 -ð
pHdr
->
nBackŒaûSlÙs
;

17048 
sql™e3_mu‹x_’‹r
(
mem
.
mu‹x
);

17049 ifÐ
	gpHdr
->
	gpP»v
 ){

17050 
as£¹
Ð
pHdr
->
pP»v
->
pNext
==pHdr );

17051 
	gpHdr
->
	gpP»v
->
	gpNext
 = 
pHdr
->
pNext
;

17053 
as£¹
Ð
mem
.
pFœ¡
==
pHdr
 );

17054 
	gmem
.
	gpFœ¡
 = 
pHdr
->
pNext
;

17056 ifÐ
	gpHdr
->
	gpNext
 ){

17057 
as£¹
Ð
pHdr
->
pNext
->
pP»v
==pHdr );

17058 
	gpHdr
->
	gpNext
->
	gpP»v
 = 
pHdr
->
pP»v
;

17060 
as£¹
Ð
mem
.
pLa¡
==
pHdr
 );

17061 
	gmem
.
	gpLa¡
 = 
pHdr
->
pP»v
;

17063 
	gz
 = (*)
pBt
;

17064 
	gz
 -ð
pHdr
->
nT™Ë
;

17065 
adju¡Sts
(()
pHdr
->
iSize
, -1);

17066 
¿ndomFžl
(
z
, (*)*
pHdr
->
nBackŒaûSlÙs
 + (*pHdr) +

17067 ()
pHdr
->
iSize
 + (è+…Hdr->
nT™Ë
);

17068 
ä“
(
z
);

17069 
sql™e3_mu‹x_Ëave
(
mem
.
mu‹x
);

17081 *
sql™e3MemR—Îoc
(*
pPriÜ
, 
nBy‹
){

17082 
MemBlockHdr
 *
	gpOldHdr
;

17083 *
	gpNew
;

17084 
as£¹
Ð
mem
.
di§Îow
==0 );

17085 
as£¹
Ð(
nBy‹
 & 7)==0 );

17086 
	gpOldHdr
 = 
sql™e3MemsysG‘H—d”
(
pPriÜ
);

17087 
	gpNew
 = 
sql™e3MemM®loc
(
nBy‹
);

17088 ifÐ
	gpNew
 ){

17089 
memýy
(
pNew
, 
pPriÜ
, ()(
nBy‹
<
pOldHdr
->
iSize
 ?‚Byte :…OldHdr->iSize));

17090 ifÐ
	gnBy‹
>
	gpOldHdr
->
	giSize
 ){

17091 
¿ndomFžl
(&((*)
pNew
)[
pOldHdr
->
iSize
], 
nBy‹
 - ()pOldHdr->iSize);

17093 
sql™e3MemF»e
(
pPriÜ
);

17095  
	gpNew
;

17102 
SQLITE_PRIVATE
 
sql™e3MemS‘DeçuÉ
(){

17103 cÚ¡ 
sql™e3_mem_m‘hods
 
	gdeçuÉM‘hods
 = {

17104 
sql™e3MemM®loc
,

17105 
sql™e3MemF»e
,

17106 
sql™e3MemR—Îoc
,

17107 
sql™e3MemSize
,

17108 
sql™e3MemRoundup
,

17109 
sql™e3MemIn™
,

17110 
sql™e3MemShutdown
,

17113 
sql™e3_cÚfig
(
SQLITE_CONFIG_MALLOC
, &
deçuÉM‘hods
);

17119 
SQLITE_PRIVATE
 
sql™e3MemdebugS‘Ty³
(*
p
, 
u8
 
eTy³
){

17120 ifÐ
	gp
 && 
	gsql™e3Glob®CÚfig
.
	gm
.
	gxM®loc
==
sql™e3MemM®loc
 ){

17121 
MemBlockHdr
 *
pHdr
;

17122 
	gpHdr
 = 
sql™e3MemsysG‘H—d”
(
p
);

17123 
as£¹
Ð
pHdr
->
iFÜeGu¬d
==
FOREGUARD
 );

17124 
	gpHdr
->
	geTy³
 = 
eTy³
;

17137 
SQLITE_PRIVATE
 
sql™e3MemdebugHasTy³
(*
p
, 
u8
 
eTy³
){

17138 
	grc
 = 1;

17139 ifÐ
	gp
 && 
	gsql™e3Glob®CÚfig
.
	gm
.
	gxM®loc
==
sql™e3MemM®loc
 ){

17140 
MemBlockHdr
 *
pHdr
;

17141 
	gpHdr
 = 
sql™e3MemsysG‘H—d”
(
p
);

17142 
as£¹
Ð
pHdr
->
iFÜeGu¬d
==
FOREGUARD
 );

17143 ifÐ(
	gpHdr
->
	geTy³
&eType)==0 ){

17144 
rc
 = 0;

17147  
	grc
;

17159 
SQLITE_PRIVATE
 
sql™e3MemdebugNoTy³
(*
p
, 
u8
 
eTy³
){

17160 
	grc
 = 1;

17161 ifÐ
	gp
 && 
	gsql™e3Glob®CÚfig
.
	gm
.
	gxM®loc
==
sql™e3MemM®loc
 ){

17162 
MemBlockHdr
 *
pHdr
;

17163 
	gpHdr
 = 
sql™e3MemsysG‘H—d”
(
p
);

17164 
as£¹
Ð
pHdr
->
iFÜeGu¬d
==
FOREGUARD
 );

17165 ifÐ(
	gpHdr
->
	geTy³
&eType)!=0 ){

17166 
rc
 = 0;

17169  
	grc
;

17177 
SQLITE_PRIVATE
 
sql™e3MemdebugBackŒaû
(
d•th
){

17178 ifÐ
	gd•th
<0 ){ depth = 0; }

17179 ifÐ
	gd•th
>20 ){ depth = 20; }

17180 
	gd•th
 = (
d•th
+1)&0xfe;

17181 
	gmem
.
	gnBackŒaû
 = 
d•th
;

17184 
SQLITE_PRIVATE
 
sql™e3MemdebugBackŒaûC®lback
((*
xBackŒaû
)(, , **)){

17185 
	gmem
.
	gxBackŒaû
 = 
xBackŒaû
;

17191 
SQLITE_PRIVATE
 
sql™e3MemdebugS‘t™Ë
(cÚ¡ *
zT™Ë
){

17192 
	gn
 = 
sql™e3SŒËn30
(
zT™Ë
) + 1;

17193 
sql™e3_mu‹x_’‹r
(
mem
.
mu‹x
);

17194 ifÐ
	gn
>=(
mem
.
zT™Ë
èè
n
 = (mem.zTitle)-1;

17195 
memýy
(
mem
.
zT™Ë
, zT™Ë, 
n
);

17196 
	gmem
.
	gzT™Ë
[
n
] = 0;

17197 
	gmem
.
	gnT™Ë
 = 
ROUND8
(
n
);

17198 
sql™e3_mu‹x_Ëave
(
mem
.
mu‹x
);

17201 
SQLITE_PRIVATE
 
sql™e3MemdebugSync
(){

17202 
MemBlockHdr
 *
	gpHdr
;

17203 
	gpHdr
=
mem
.
pFœ¡
;…Hdr;…Hdr=
pHdr
->
pNext
){

17204 **
pBt
 = (**)
pHdr
;

17205 
	gpBt
 -ð
pHdr
->
nBackŒaûSlÙs
;

17206 
	gmem
.
xBackŒaû
(()
pHdr
->
iSize
,…Hdr->
nBackŒaû
-1, &
pBt
[1]);

17214 
SQLITE_PRIVATE
 
sql™e3MemdebugDump
(cÚ¡ *
zFž’ame
){

17215 
FILE
 *
	gout
;

17216 
MemBlockHdr
 *
	gpHdr
;

17217 **
	gpBt
;

17218 
	gi
;

17219 
	gout
 = 
fÝ’
(
zFž’ame
, "w");

17220 ifÐ
	gout
==0 ){

17221 
årštf
(
¡d”r
, "** Unableo output memory debug output†og: %s **\n",

17222 
zFž’ame
);

17225 
	gpHdr
=
mem
.
pFœ¡
;…Hdr;…Hdr=
pHdr
->
pNext
){

17226 *
z
 = (*)
pHdr
;

17227 
	gz
 -ð
pHdr
->
nBackŒaûSlÙs
*(*è+…Hdr->
nT™Ë
;

17228 
årštf
(
out
, "**** %lld bytes‡t %p from %s ****\n",

17229 
pHdr
->
iSize
, &pHdr[1],…Hdr->
nT™Ë
 ? 
z
 : "???");

17230 ifÐ
	gpHdr
->
	gnBackŒaû
 ){

17231 
fæush
(
out
);

17232 
	gpBt
 = (**)
pHdr
;

17233 
	gpBt
 -ð
pHdr
->
nBackŒaûSlÙs
;

17234 
backŒaû_symbÞs_fd
(
pBt
, 
pHdr
->
nBackŒaû
, 
fž’o
(
out
));

17235 
årštf
(
out
, "\n");

17238 
årštf
(
out
, "COUNTS:\n");

17239 
	gi
=0; i<
	gNCSIZE
-1; i++){

17240 ifÐ
	gmem
.
	gnAÎoc
[
i
] ){

17241 
årštf
(
out
, " %5d: %10d %10d %10d\n",

17242 
i
*8, 
mem
.
nAÎoc
[i], mem.
nCu¼’t
[i], mem.
mxCu¼’t
[i]);

17245 ifÐ
	gmem
.
	gnAÎoc
[
NCSIZE
-1] ){

17246 
årštf
(
out
, " %5d: %10d %10d %10d\n",

17247 
NCSIZE
*8-8, 
mem
.
nAÎoc
[NCSIZE-1],

17248 
mem
.
nCu¼’t
[
NCSIZE
-1], mem.
mxCu¼’t
[NCSIZE-1]);

17250 
fþo£
(
out
);

17256 
SQLITE_PRIVATE
 
sql™e3MemdebugM®locCouÁ
(){

17257 
	gi
;

17258 
	gnTÙ®
 = 0;

17259 
	gi
=0; i<
	gNCSIZE
; i++){

17260 
	gnTÙ®
 +ð
mem
.
nAÎoc
[
i
];

17262  
	gnTÙ®
;

17303 #ifdeà
SQLITE_ENABLE_MEMSYS3


17308 
	#MX_SMALL
 10

	)

17314 
	#N_HASH
 61

	)

17348 
Mem3Block
 
	tMem3Block
;

17349 
	sMem3Block
 {

17352 
u32
 
	g´evSize
;

17353 
u32
 
	gsize4x
;

17354 } 
	ghdr
;

17356 
u32
 
	gÃxt
;

17357 
u32
 
	g´ev
;

17358 } 
	gli¡
;

17359 } 
	gu
;

17368 
SQLITE_WSD
 
	sMem3Glob®
 {

17373 
u32
 
	gnPoÞ
;

17374 
Mem3Block
 *
	gaPoÞ
;

17379 
	g®¬mBusy
;

17384 
sql™e3_mu‹x
 *
	gmu‹x
;

17389 
u32
 
	gmnMa¡”
;

17397 
u32
 
	giMa¡”
;

17398 
u32
 
	gszMa¡”
;

17405 
u32
 
	gaiSm®l
[
MX_SMALL
-1];

17406 
u32
 
	gaiHash
[
N_HASH
];

17407 } 
	gmem3
 = { 97535575 };

17409 
	#mem3
 
	`GLOBAL
(
Mem3Glob®
, 
mem3
)

	)

17415 
memsys3UÆškFromLi¡
(
u32
 
i
, u32 *
pRoÙ
){

17416 
u32
 
	gÃxt
 = 
mem3
.
aPoÞ
[
i
].
u
.
li¡
.
Ãxt
;

17417 
u32
 
	g´ev
 = 
mem3
.
aPoÞ
[
i
].
u
.
li¡
.
´ev
;

17418 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17419 ifÐ
	g´ev
==0 ){

17420 *
pRoÙ
 = 
Ãxt
;

17422 
	gmem3
.
	gaPoÞ
[
´ev
].
	gu
.
	gli¡
.
	gÃxt
 = 
Ãxt
;

17424 ifÐ
	gÃxt
 ){

17425 
	gmem3
.
	gaPoÞ
[
Ãxt
].
	gu
.
	gli¡
.
	g´ev
 = 
´ev
;

17427 
	gmem3
.
	gaPoÞ
[
i
].
	gu
.
	gli¡
.
	gÃxt
 = 0;

17428 
	gmem3
.
	gaPoÞ
[
i
].
	gu
.
	gli¡
.
	g´ev
 = 0;

17435 
memsys3UÆšk
(
u32
 
i
){

17436 
u32
 
	gsize
, 
	ghash
;

17437 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17438 
as£¹
Ð(
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
 & 1)==0 );

17439 
as£¹
Ð
i
>=1 );

17440 
	gsize
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
/4;

17441 
as£¹
Ð
size
==
mem3
.
aPoÞ
[
i
+size-1].
u
.
hdr
.
´evSize
 );

17442 
as£¹
Ð
size
>=2 );

17443 ifÐ
	gsize
 <ð
MX_SMALL
 ){

17444 
memsys3UÆškFromLi¡
(
i
, &
mem3
.
aiSm®l
[
size
-2]);

17446 
	ghash
 = 
size
 % 
N_HASH
;

17447 
memsys3UÆškFromLi¡
(
i
, &
mem3
.
aiHash
[
hash
]);

17455 
memsys3LškIÁoLi¡
(
u32
 
i
, u32 *
pRoÙ
){

17456 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17457 
	gmem3
.
	gaPoÞ
[
i
].
	gu
.
	gli¡
.
	gÃxt
 = *
pRoÙ
;

17458 
	gmem3
.
	gaPoÞ
[
i
].
	gu
.
	gli¡
.
	g´ev
 = 0;

17459 ifÐ*
	gpRoÙ
 ){

17460 
	gmem3
.
	gaPoÞ
[*
pRoÙ
].
	gu
.
	gli¡
.
	g´ev
 = 
i
;

17462 *
	gpRoÙ
 = 
i
;

17469 
memsys3Lšk
(
u32
 
i
){

17470 
u32
 
	gsize
, 
	ghash
;

17471 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17472 
as£¹
Ð
i
>=1 );

17473 
as£¹
Ð(
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
 & 1)==0 );

17474 
	gsize
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
/4;

17475 
as£¹
Ð
size
==
mem3
.
aPoÞ
[
i
+size-1].
u
.
hdr
.
´evSize
 );

17476 
as£¹
Ð
size
>=2 );

17477 ifÐ
	gsize
 <ð
MX_SMALL
 ){

17478 
memsys3LškIÁoLi¡
(
i
, &
mem3
.
aiSm®l
[
size
-2]);

17480 
	ghash
 = 
size
 % 
N_HASH
;

17481 
memsys3LškIÁoLi¡
(
i
, &
mem3
.
aiHash
[
hash
]);

17490 
memsys3EÁ”
(){

17491 ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
==0 && 
mem3
.
mu‹x
==0 ){

17492 
mem3
.
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MEM
);

17494 
sql™e3_mu‹x_’‹r
(
mem3
.
mu‹x
);

17496 
memsys3L—ve
(){

17497 
sql™e3_mu‹x_Ëave
(
mem3
.
mu‹x
);

17503 
memsys3OutOfMemÜy
(
nBy‹
){

17504 ifÐ!
	gmem3
.
	g®¬mBusy
 ){

17505 
	gmem3
.
	g®¬mBusy
 = 1;

17506 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17507 
sql™e3_mu‹x_Ëave
(
mem3
.
mu‹x
);

17508 
sql™e3_»Ëa£_memÜy
(
nBy‹
);

17509 
sql™e3_mu‹x_’‹r
(
mem3
.
mu‹x
);

17510 
	gmem3
.
	g®¬mBusy
 = 0;

17520 *
memsys3Checkout
(
u32
 
i
, u32 
nBlock
){

17521 
u32
 
	gx
;

17522 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17523 
as£¹
Ð
i
>=1 );

17524 
as£¹
Ð
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
/4==
nBlock
 );

17525 
as£¹
Ð
mem3
.
aPoÞ
[
i
+
nBlock
-1].
u
.
hdr
.
´evSize
==nBlock );

17526 
	gx
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
;

17527 
	gmem3
.
	gaPoÞ
[
i
-1].
	gu
.
	ghdr
.
	gsize4x
 = 
nBlock
*4 | 1 | (
x
&2);

17528 
	gmem3
.
	gaPoÞ
[
i
+
nBlock
-1].
	gu
.
	ghdr
.
	g´evSize
 =‚Block;

17529 
	gmem3
.
	gaPoÞ
[
i
+
nBlock
-1].
	gu
.
	ghdr
.
	gsize4x
 |= 2;

17530  &
	gmem3
.
	gaPoÞ
[
i
];

17538 *
memsys3FromMa¡”
(
u32
 
nBlock
){

17539 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17540 
as£¹
Ð
mem3
.
szMa¡”
>=
nBlock
 );

17541 ifÐ
	gnBlock
>=
mem3
.
szMa¡”
-1 ){

17543 *
p
 = 
memsys3Checkout
(
mem3
.
iMa¡”
, mem3.
szMa¡”
);

17544 
	gmem3
.
	giMa¡”
 = 0;

17545 
	gmem3
.
	gszMa¡”
 = 0;

17546 
	gmem3
.
	gmnMa¡”
 = 0;

17547  
	gp
;

17550 
u32
 
	gÃwi
, 
	gx
;

17551 
	gÃwi
 = 
mem3
.
iMa¡”
 + mem3.
szMa¡”
 - 
nBlock
;

17552 
as£¹
Ð
Ãwi
 > 
mem3
.
iMa¡”
+1 );

17553 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
+mem3.
szMa¡”
-1].
	gu
.
	ghdr
.
	g´evSize
 = 
nBlock
;

17554 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
+mem3.
szMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
 |= 2;

17555 
	gmem3
.
	gaPoÞ
[
Ãwi
-1].
	gu
.
	ghdr
.
	gsize4x
 = 
nBlock
*4 + 1;

17556 
	gmem3
.
	gszMa¡”
 -ð
nBlock
;

17557 
	gmem3
.
	gaPoÞ
[
Ãwi
-1].
	gu
.
	ghdr
.
	g´evSize
 = 
mem3
.
szMa¡”
;

17558 
	gx
 = 
mem3
.
aPoÞ
[mem3.
iMa¡”
-1].
u
.
hdr
.
size4x
 & 2;

17559 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
 = mem3.
szMa¡”
*4 | 
x
;

17560 ifÐ
	gmem3
.
	gszMa¡”
 < mem3.
	gmnMa¡”
 ){

17561 
	gmem3
.
	gmnMa¡”
 = 
mem3
.
szMa¡”
;

17563  (*)&
	gmem3
.
	gaPoÞ
[
Ãwi
];

17583 
memsys3M”ge
(
u32
 *
pRoÙ
){

17584 
u32
 
	giNext
, 
	g´ev
, 
	gsize
, 
	gi
, 
	gx
;

17586 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17587 
	gi
=*
pRoÙ
; i>0; i=
iNext
){

17588 
iNext
 = 
mem3
.
aPoÞ
[
i
].
u
.
li¡
.
Ãxt
;

17589 
	gsize
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
;

17590 
as£¹
Ð(
size
&1)==0 );

17591 ifÐ(
	gsize
&2)==0 ){

17592 
memsys3UÆškFromLi¡
(
i
, 
pRoÙ
);

17593 
as£¹
Ð
i
 > 
mem3
.
aPoÞ
[i-1].
u
.
hdr
.
´evSize
 );

17594 
	g´ev
 = 
i
 - 
mem3
.
aPoÞ
[i-1].
u
.
hdr
.
´evSize
;

17595 ifÐ
	g´ev
==
iNext
 ){

17596 
iNext
 = 
mem3
.
aPoÞ
[
´ev
].
u
.
li¡
.
Ãxt
;

17598 
memsys3UÆšk
(
´ev
);

17599 
	gsize
 = 
i
 + 
size
/4 - 
´ev
;

17600 
	gx
 = 
mem3
.
aPoÞ
[
´ev
-1].
u
.
hdr
.
size4x
 & 2;

17601 
	gmem3
.
	gaPoÞ
[
´ev
-1].
	gu
.
	ghdr
.
	gsize4x
 = 
size
*4 | 
x
;

17602 
	gmem3
.
	gaPoÞ
[
´ev
+
size
-1].
	gu
.
	ghdr
.
	g´evSize
 = size;

17603 
memsys3Lšk
(
´ev
);

17604 
	gi
 = 
´ev
;

17606 
	gsize
 /= 4;

17608 ifÐ
	gsize
>
	gmem3
.
	gszMa¡”
 ){

17609 
	gmem3
.
	giMa¡”
 = 
i
;

17610 
	gmem3
.
	gszMa¡”
 = 
size
;

17622 *
memsys3M®locUn§ã
(
nBy‹
){

17623 
u32
 
	gi
;

17624 
u32
 
	gnBlock
;

17625 
u32
 
	gtoF»e
;

17627 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17628 
as£¹
Ð(
Mem3Block
)==8 );

17629 ifÐ
	gnBy‹
<=12 ){

17630 
nBlock
 = 2;

17632 
	gnBlock
 = (
nBy‹
 + 11)/8;

17634 
as£¹
Ð
nBlock
>=2 );

17641 ifÐ
	gnBlock
 <ð
MX_SMALL
 ){

17642 
i
 = 
mem3
.
aiSm®l
[
nBlock
-2];

17643 ifÐ
	gi
>0 ){

17644 
memsys3UÆškFromLi¡
(
i
, &
mem3
.
aiSm®l
[
nBlock
-2]);

17645  
memsys3Checkout
(
i
, 
nBlock
);

17648 
	ghash
 = 
nBlock
 % 
N_HASH
;

17649 
	gi
=
mem3
.
aiHash
[
hash
]; i>0; i=mem3.
aPoÞ
[
i
].
u
.
li¡
.
Ãxt
){

17650 ifÐ
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
/4==
nBlock
 ){

17651 
memsys3UÆškFromLi¡
(
i
, &
mem3
.
aiHash
[
hash
]);

17652  
memsys3Checkout
(
i
, 
nBlock
);

17661 ifÐ
	gmem3
.
	gszMa¡”
>=
nBlock
 ){

17662  
memsys3FromMa¡”
(
nBlock
);

17673 
	gtoF»e
=
nBlock
*16;oF»e<(
	gmem3
.
	gnPoÞ
*16);oFree *= 2){

17674 
memsys3OutOfMemÜy
(
toF»e
);

17675 ifÐ
	gmem3
.
	giMa¡”
 ){

17676 
memsys3Lšk
(
mem3
.
iMa¡”
);

17677 
	gmem3
.
	giMa¡”
 = 0;

17678 
	gmem3
.
	gszMa¡”
 = 0;

17680 
	gi
=0; i<
	gN_HASH
; i++){

17681 
memsys3M”ge
(&
mem3
.
aiHash
[
i
]);

17683 
	gi
=0; i<
	gMX_SMALL
-1; i++){

17684 
memsys3M”ge
(&
mem3
.
aiSm®l
[
i
]);

17686 ifÐ
	gmem3
.
	gszMa¡”
 ){

17687 
memsys3UÆšk
(
mem3
.
iMa¡”
);

17688 ifÐ
	gmem3
.
	gszMa¡”
>=
nBlock
 ){

17689  
memsys3FromMa¡”
(
nBlock
);

17704 
memsys3F»eUn§ã
(*
pOld
){

17705 
Mem3Block
 *
	gp
 = (Mem3Block*)
pOld
;

17706 
	gi
;

17707 
u32
 
	gsize
, 
	gx
;

17708 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem3
.
mu‹x
) );

17709 
as£¹
Ð
p
>
mem3
.
aPoÞ
 &&…<&mem3.aPoÞ[mem3.
nPoÞ
] );

17710 
	gi
 = 
p
 - 
mem3
.
aPoÞ
;

17711 
as£¹
Ð(
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
&1)==1 );

17712 
	gsize
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
/4;

17713 
as£¹
Ð
i
+
size
<=
mem3
.
nPoÞ
+1 );

17714 
	gmem3
.
	gaPoÞ
[
i
-1].
	gu
.
	ghdr
.
	gsize4x
 &= ~1;

17715 
	gmem3
.
	gaPoÞ
[
i
+
size
-1].
	gu
.
	ghdr
.
	g´evSize
 = size;

17716 
	gmem3
.
	gaPoÞ
[
i
+
size
-1].
	gu
.
	ghdr
.
	gsize4x
 &= ~2;

17717 
memsys3Lšk
(
i
);

17720 ifÐ
	gmem3
.
	giMa¡”
 ){

17721  (
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
&2)==0 ){

17722 
size
 = 
mem3
.
aPoÞ
[mem3.
iMa¡”
-1].
u
.
hdr
.
´evSize
;

17723 
	gmem3
.
	giMa¡”
 -ð
size
;

17724 
	gmem3
.
	gszMa¡”
 +ð
size
;

17725 
memsys3UÆšk
(
mem3
.
iMa¡”
);

17726 
	gx
 = 
mem3
.
aPoÞ
[mem3.
iMa¡”
-1].
u
.
hdr
.
size4x
 & 2;

17727 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
 = mem3.
szMa¡”
*4 | 
x
;

17728 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
+mem3.
szMa¡”
-1].
	gu
.
	ghdr
.
	g´evSize
 = mem3.szMaster;

17730 
	gx
 = 
mem3
.
aPoÞ
[mem3.
iMa¡”
-1].
u
.
hdr
.
size4x
 & 2;

17731  (
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
+mem3.
szMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
&1)==0 ){

17732 
memsys3UÆšk
(
mem3
.
iMa¡”
+mem3.
szMa¡”
);

17733 
	gmem3
.
	gszMa¡”
 +ð
mem3
.
aPoÞ
[mem3.
iMa¡”
+mem3.
szMa¡”
-1].
u
.
hdr
.
size4x
/4;

17734 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
-1].
	gu
.
	ghdr
.
	gsize4x
 = mem3.
szMa¡”
*4 | 
x
;

17735 
	gmem3
.
	gaPoÞ
[
mem3
.
iMa¡”
+mem3.
szMa¡”
-1].
	gu
.
	ghdr
.
	g´evSize
 = mem3.szMaster;

17745 
memsys3Size
(*
p
){

17746 
Mem3Block
 *
	gpBlock
;

17747 ifÐ
	gp
==0 )  0;

17748 
	gpBlock
 = (
Mem3Block
*)
p
;

17749 
as£¹
Ð(
pBlock
[-1].
u
.
hdr
.
size4x
&1)!=0 );

17750  (
	gpBlock
[-1].
	gu
.
	ghdr
.
	gsize4x
&~3)*2 - 4;

17756 
memsys3Roundup
(
n
){

17757 ifÐ
	gn
<=12 ){

17760  ((
	gn
+11)&~7) - 4;

17767 *
memsys3M®loc
(
nBy‹s
){

17768 
sql™e3_št64
 *
	gp
;

17769 
as£¹
Ð
nBy‹s
>0 );

17770 
memsys3EÁ”
();

17771 
	gp
 = 
memsys3M®locUn§ã
(
nBy‹s
);

17772 
memsys3L—ve
();

17773  (*)
	gp
;

17779 
memsys3F»e
(*
pPriÜ
){

17780 
as£¹
Ð
pPriÜ
 );

17781 
memsys3EÁ”
();

17782 
memsys3F»eUn§ã
(
pPriÜ
);

17783 
memsys3L—ve
();

17789 *
memsys3R—Îoc
(*
pPriÜ
, 
nBy‹s
){

17790 
	gnOld
;

17791 *
	gp
;

17792 ifÐ
	gpPriÜ
==0 ){

17793  
sql™e3_m®loc
(
nBy‹s
);

17795 ifÐ
	gnBy‹s
<=0 ){

17796 
sql™e3_ä“
(
pPriÜ
);

17799 
	gnOld
 = 
memsys3Size
(
pPriÜ
);

17800 ifÐ
	gnBy‹s
<=
nOld
 && 
nBy‹s
>=nOld-128 ){

17801  
pPriÜ
;

17803 
memsys3EÁ”
();

17804 
	gp
 = 
memsys3M®locUn§ã
(
nBy‹s
);

17805 ifÐ
	gp
 ){

17806 ifÐ
	gnOld
<
	gnBy‹s
 ){

17807 
memýy
(
p
, 
pPriÜ
, 
nOld
);

17809 
memýy
(
p
, 
pPriÜ
, 
nBy‹s
);

17811 
memsys3F»eUn§ã
(
pPriÜ
);

17813 
memsys3L—ve
();

17814  
	gp
;

17820 
memsys3In™
(*
NÙU£d
){

17821 
UNUSED_PARAMETER
(
NÙU£d
);

17822 ifÐ!
	gsql™e3Glob®CÚfig
.
	gpH—p
 ){

17823  
	gSQLITE_ERROR
;

17827 
as£¹
Ð(
Mem3Block
)==8 );

17828 
	gmem3
.
	gaPoÞ
 = (
Mem3Block
 *)
sql™e3Glob®CÚfig
.
pH—p
;

17829 
	gmem3
.
	gnPoÞ
 = (
sql™e3Glob®CÚfig
.
nH—p
 / (
Mem3Block
)) - 2;

17832 
	gmem3
.
	gszMa¡”
 = 
mem3
.
nPoÞ
;

17833 
	gmem3
.
	gmnMa¡”
 = 
mem3
.
szMa¡”
;

17834 
	gmem3
.
	giMa¡”
 = 1;

17835 
	gmem3
.
	gaPoÞ
[0].
	gu
.
	ghdr
.
	gsize4x
 = (
mem3
.
szMa¡”
<<2) + 2;

17836 
	gmem3
.
	gaPoÞ
[
mem3
.
nPoÞ
].
	gu
.
	ghdr
.
	g´evSize
 = mem3.nPool;

17837 
	gmem3
.
	gaPoÞ
[
mem3
.
nPoÞ
].
	gu
.
	ghdr
.
	gsize4x
 = 1;

17839  
	gSQLITE_OK
;

17845 
memsys3Shutdown
(*
NÙU£d
){

17846 
UNUSED_PARAMETER
(
NÙU£d
);

17847 
	gmem3
.
	gmu‹x
 = 0;

17857 
SQLITE_PRIVATE
 
sql™e3Memsys3Dump
(cÚ¡ *
zFž’ame
){

17858 #ifdeà
SQLITE_DEBUG


17859 
FILE
 *
	gout
;

17860 
u32
 
	gi
, 
	gj
;

17861 
u32
 
	gsize
;

17862 ifÐ
	gzFž’ame
==0 || 
zFž’ame
[0]==0 ){

17863 
out
 = 
¡dout
;

17865 
	gout
 = 
fÝ’
(
zFž’ame
, "w");

17866 ifÐ
	gout
==0 ){

17867 
årštf
(
¡d”r
, "** Unableo output memory debug output†og: %s **\n",

17868 
zFž’ame
);

17872 
memsys3EÁ”
();

17873 
årštf
(
out
, "CHUNKS:\n");

17874 
	gi
=1; i<=
mem3
.
nPoÞ
; i+=
size
/4){

17875 
size
 = 
mem3
.
aPoÞ
[
i
-1].
u
.
hdr
.
size4x
;

17876 ifÐ
	gsize
/4<=1 ){

17877 
årštf
(
out
, "%°siz”rÜ\n", &
mem3
.
aPoÞ
[
i
]);

17878 
as£¹
( 0 );

17881 ifÐ(
	gsize
&1)==0 && 
mem3
.
aPoÞ
[
i
+
size
/4-1].
u
.
hdr
.
´evSize
!=size/4 ){

17882 
årštf
(
out
, "%°ž sizdÛ nÙ m©ch\n", &
mem3
.
aPoÞ
[
i
]);

17883 
as£¹
( 0 );

17886 ifÐ((
	gmem3
.
	gaPoÞ
[
i
+
size
/4-1].
	gu
.
	ghdr
.
	gsize4x
&2)>>1)!=(size&1) ){

17887 
årštf
(
out
, "%°ž checkouˆb™ i šcÜ»ù\n", &
mem3
.
aPoÞ
[
i
]);

17888 
as£¹
( 0 );

17891 ifÐ
	gsize
&1 ){

17892 
årštf
(
out
, "%°%6d by‹ checked out\n", &
mem3
.
aPoÞ
[
i
], (
size
/4)*8-8);

17894 
årštf
(
out
, "%°%6d by‹ ä“%s\n", &
mem3
.
aPoÞ
[
i
], (
size
/4)*8-8,

17895 
i
==
mem3
.
iMa¡”
 ? " **master**" : "");

17898 
	gi
=0; i<
	gMX_SMALL
-1; i++){

17899 ifÐ
	gmem3
.
	gaiSm®l
[
i
]==0 ) ;

17900 
årštf
(
out
, "sm®l(%2d):", 
i
);

17901 
	gj
 = 
mem3
.
aiSm®l
[
i
]; j>0; j=mem3.
aPoÞ
[
j
].
u
.
li¡
.
Ãxt
){

17902 
årštf
(
out
, " %p(%d)", &
mem3
.
aPoÞ
[
j
],

17903 (
mem3
.
aPoÞ
[
j
-1].
u
.
hdr
.
size4x
/4)*8-8);

17905 
årštf
(
out
, "\n");

17907 
	gi
=0; i<
	gN_HASH
; i++){

17908 ifÐ
	gmem3
.
	gaiHash
[
i
]==0 ) ;

17909 
årštf
(
out
, "hash(%2d):", 
i
);

17910 
	gj
 = 
mem3
.
aiHash
[
i
]; j>0; j=mem3.
aPoÞ
[
j
].
u
.
li¡
.
Ãxt
){

17911 
årštf
(
out
, " %p(%d)", &
mem3
.
aPoÞ
[
j
],

17912 (
mem3
.
aPoÞ
[
j
-1].
u
.
hdr
.
size4x
/4)*8-8);

17914 
årštf
(
out
, "\n");

17916 
årštf
(
out
, "ma¡”=%d\n", 
mem3
.
iMa¡”
);

17917 
årštf
(
out
, "nowU£d=%d\n", 
mem3
.
nPoÞ
*8 - mem3.
szMa¡”
*8);

17918 
årštf
(
out
, "mxU£d=%d\n", 
mem3
.
nPoÞ
*8 - mem3.
mnMa¡”
*8);

17919 
sql™e3_mu‹x_Ëave
(
mem3
.
mu‹x
);

17920 ifÐ
	gout
==
¡dout
 ){

17921 
fæush
(
¡dout
);

17923 
fþo£
(
out
);

17926 
UNUSED_PARAMETER
(
zFž’ame
);

17941 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Memsys3
(){

17942 cÚ¡ 
sql™e3_mem_m‘hods
 
	gmempoÞM‘hods
 = {

17943 
memsys3M®loc
,

17944 
memsys3F»e
,

17945 
memsys3R—Îoc
,

17946 
memsys3Size
,

17947 
memsys3Roundup
,

17948 
memsys3In™
,

17949 
memsys3Shutdown
,

17952  &
	gmempoÞM‘hods
;

18014 #ifdeà
SQLITE_ENABLE_MEMSYS5


18024 
Mem5Lšk
 
	tMem5Lšk
;

18025 
	sMem5Lšk
 {

18026 
	gÃxt
;

18027 
	g´ev
;

18035 
	#LOGMAX
 30

	)

18040 
	#CTRL_LOGSIZE
 0x1à

	)

18041 
	#CTRL_FREE
 0x20

	)

18049 
SQLITE_WSD
 
	sMem5Glob®
 {

18053 
	gszAtom
;

18054 
	gnBlock
;

18055 
u8
 *
	gzPoÞ
;

18060 
sql™e3_mu‹x
 *
	gmu‹x
;

18065 
u64
 
	gnAÎoc
;

18066 
u64
 
	gtÙ®AÎoc
;

18067 
u64
 
	gtÙ®Exûss
;

18068 
u32
 
	gcu¼’tOut
;

18069 
u32
 
	gcu¼’tCouÁ
;

18070 
u32
 
	gmaxOut
;

18071 
u32
 
	gmaxCouÁ
;

18072 
u32
 
	gmaxReque¡
;

18079 
	gaiF»–i¡
[
LOGMAX
+1];

18085 
u8
 *
	gaCŒl
;

18087 } 
	gmem5
;

18092 
	#mem5
 
	`GLOBAL
(
Mem5Glob®
, 
mem5
)

	)

18098 
	#MEM5LINK
(
idx
è((
Mem5Lšk
 *)(&
mem5
.
zPoÞ
[(idx)*mem5.
szAtom
]))

	)

18104 
memsys5UÆšk
(
i
, 
iLogsize
){

18105 
	gÃxt
, 
	g´ev
;

18106 
as£¹
Ð
i
>=0 && i<
mem5
.
nBlock
 );

18107 
as£¹
Ð
iLogsize
>=0 && iLogsize<=
LOGMAX
 );

18108 
as£¹
Ð(
mem5
.
aCŒl
[
i
] & 
CTRL_LOGSIZE
)==
iLogsize
 );

18110 
	gÃxt
 = 
MEM5LINK
(
i
)->
Ãxt
;

18111 
	g´ev
 = 
MEM5LINK
(
i
)->
´ev
;

18112 ifÐ
	g´ev
<0 ){

18113 
	gmem5
.
	gaiF»–i¡
[
iLogsize
] = 
Ãxt
;

18115 
MEM5LINK
(
´ev
)->
	gÃxt
 = 
Ãxt
;

18117 ifÐ
	gÃxt
>=0 ){

18118 
MEM5LINK
(
Ãxt
)->
´ev
 =…rev;

18126 
memsys5Lšk
(
i
, 
iLogsize
){

18127 
	gx
;

18128 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem5
.
mu‹x
) );

18129 
as£¹
Ð
i
>=0 && i<
mem5
.
nBlock
 );

18130 
as£¹
Ð
iLogsize
>=0 && iLogsize<=
LOGMAX
 );

18131 
as£¹
Ð(
mem5
.
aCŒl
[
i
] & 
CTRL_LOGSIZE
)==
iLogsize
 );

18133 
	gx
 = 
MEM5LINK
(
i
)->
Ãxt
 = 
mem5
.
aiF»–i¡
[
iLogsize
];

18134 
MEM5LINK
(
i
)->
	g´ev
 = -1;

18135 ifÐ
	gx
>=0 ){

18136 
as£¹
Ð
x
<
mem5
.
nBlock
 );

18137 
MEM5LINK
(
x
)->
	g´ev
 = 
i
;

18139 
	gmem5
.
	gaiF»–i¡
[
iLogsize
] = 
i
;

18147 
memsys5EÁ”
(){

18148 
sql™e3_mu‹x_’‹r
(
mem5
.
mu‹x
);

18150 
memsys5L—ve
(){

18151 
sql™e3_mu‹x_Ëave
(
mem5
.
mu‹x
);

18159 
memsys5Size
(*
p
){

18160 
	giSize
 = 0;

18161 ifÐ
	gp
 ){

18162 
	gi
 = ()(((
u8
 *)
p
-
mem5
.
zPoÞ
)/mem5.
szAtom
);

18163 
as£¹
Ð
i
>=0 && i<
mem5
.
nBlock
 );

18164 
	giSize
 = 
mem5
.
szAtom
 * (1 << (mem5.
aCŒl
[
i
]&
CTRL_LOGSIZE
));

18166  
	giSize
;

18179 *
memsys5M®locUn§ã
(
nBy‹
){

18180 
	gi
;

18181 
	giBš
;

18182 
	giFuÎSz
;

18183 
	giLogsize
;

18186 
as£¹
Ð
nBy‹
>0 );

18190 ifÐ(
	gu32
)
	gnBy‹
>
	gmem5
.
	gmaxReque¡
 ){

18191 
	gmem5
.
	gmaxReque¡
 = 
nBy‹
;

18197 ifÐ
	gnBy‹
 > 0x40000000 ){

18202 
	giFuÎSz
=
mem5
.
szAtom
, 
	giLogsize
=0; iFuÎSz<
	gnBy‹
; iFullSz *= 2, iLogsize++){}

18208 
	giBš
=
iLogsize
; iBš<=
LOGMAX
 && 
mem5
.
aiF»–i¡
[
iBš
]<0; iBin++){}

18209 ifÐ
	giBš
>
	gLOGMAX
 ){

18210 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

18211 
sql™e3_log
(
SQLITE_NOMEM
, "çžedØ®loÿ‹ %u by‹s", 
nBy‹
);

18214 
	gi
 = 
mem5
.
aiF»–i¡
[
iBš
];

18215 
memsys5UÆšk
(
i
, 
iBš
);

18216  
	giBš
>
	giLogsize
 ){

18217 
	gÃwSize
;

18219 
	giBš
--;

18220 
	gÃwSize
 = 1 << 
iBš
;

18221 
	gmem5
.
	gaCŒl
[
i
+
ÃwSize
] = 
CTRL_FREE
 | 
iBš
;

18222 
memsys5Lšk
(
i
+
ÃwSize
, 
iBš
);

18224 
	gmem5
.
	gaCŒl
[
i
] = 
iLogsize
;

18227 
	gmem5
.
	gnAÎoc
++;

18228 
	gmem5
.
	gtÙ®AÎoc
 +ð
iFuÎSz
;

18229 
	gmem5
.
	gtÙ®Exûss
 +ð
iFuÎSz
 - 
nBy‹
;

18230 
	gmem5
.
	gcu¼’tCouÁ
++;

18231 
	gmem5
.
	gcu¼’tOut
 +ð
iFuÎSz
;

18232 ifÐ
	gmem5
.
	gmaxCouÁ
<mem5.
	gcu¼’tCouÁ
 ) mem5.maxCouÁ = 
mem5
.
cu¼’tCouÁ
;

18233 ifÐ
	gmem5
.
	gmaxOut
<mem5.
	gcu¼’tOut
 ) mem5.maxOuˆð
mem5
.
cu¼’tOut
;

18235 #ifdeà
SQLITE_DEBUG


18238 
mem£t
(&
mem5
.
zPoÞ
[
i
*mem5.
szAtom
], 0xAA, 
iFuÎSz
);

18242  (*)&
	gmem5
.
	gzPoÞ
[
i
*
mem5
.
szAtom
];

18248 
memsys5F»eUn§ã
(*
pOld
){

18249 
u32
 
	gsize
, 
	giLogsize
;

18250 
	giBlock
;

18255 
	giBlock
 = ()(((
u8
 *)
pOld
-
mem5
.
zPoÞ
)/mem5.
szAtom
);

18258 
as£¹
Ð
iBlock
>=0 && iBlock<
mem5
.
nBlock
 );

18259 
as£¹
Ð((
u8
 *)
pOld
-
mem5
.
zPoÞ
)%mem5.
szAtom
==0 );

18260 
as£¹
Ð(
mem5
.
aCŒl
[
iBlock
] & 
CTRL_FREE
)==0 );

18262 
	giLogsize
 = 
mem5
.
aCŒl
[
iBlock
] & 
CTRL_LOGSIZE
;

18263 
	gsize
 = 1<<
iLogsize
;

18264 
as£¹
Ð
iBlock
+
size
-1<(
u32
)
mem5
.
nBlock
 );

18266 
	gmem5
.
	gaCŒl
[
iBlock
] |ð
CTRL_FREE
;

18267 
	gmem5
.
	gaCŒl
[
iBlock
+
size
-1] |ð
CTRL_FREE
;

18268 
as£¹
Ð
mem5
.
cu¼’tCouÁ
>0 );

18269 
as£¹
Ð
mem5
.
cu¼’tOut
>=(
size
*mem5.
szAtom
) );

18270 
	gmem5
.
	gcu¼’tCouÁ
--;

18271 
	gmem5
.
	gcu¼’tOut
 -ð
size
*
mem5
.
szAtom
;

18272 
as£¹
Ð
mem5
.
cu¼’tOut
>0 || mem5.
cu¼’tCouÁ
==0 );

18273 
as£¹
Ð
mem5
.
cu¼’tCouÁ
>0 || mem5.
cu¼’tOut
==0 );

18275 
	gmem5
.
	gaCŒl
[
iBlock
] = 
CTRL_FREE
 | 
iLogsize
;

18276  
ALWAYS
(
iLogsize
<
LOGMAX
) ){

18277 
	giBuddy
;

18278 ifÐ(
	giBlock
>>
	giLogsize
) & 1 ){

18279 
	giBuddy
 = 
iBlock
 - 
size
;

18281 
	giBuddy
 = 
iBlock
 + 
size
;

18283 
as£¹
Ð
iBuddy
>=0 );

18284 ifÐ(
	giBuddy
+(1<<
	giLogsize
))>
	gmem5
.
	gnBlock
 ) ;

18285 ifÐ
	gmem5
.
	gaCŒl
[
iBuddy
]!=(
CTRL_FREE
 | 
iLogsize
) ) ;

18286 
memsys5UÆšk
(
iBuddy
, 
iLogsize
);

18287 
	giLogsize
++;

18288 ifÐ
	giBuddy
<
	giBlock
 ){

18289 
	gmem5
.
	gaCŒl
[
iBuddy
] = 
CTRL_FREE
 | 
iLogsize
;

18290 
	gmem5
.
	gaCŒl
[
iBlock
] = 0;

18291 
	giBlock
 = 
iBuddy
;

18293 
	gmem5
.
	gaCŒl
[
iBlock
] = 
CTRL_FREE
 | 
iLogsize
;

18294 
	gmem5
.
	gaCŒl
[
iBuddy
] = 0;

18296 
	gsize
 *= 2;

18299 #ifdeà
SQLITE_DEBUG


18302 
mem£t
(&
mem5
.
zPoÞ
[
iBlock
*mem5.
szAtom
], 0x55, 
size
);

18305 
memsys5Lšk
(
iBlock
, 
iLogsize
);

18311 *
memsys5M®loc
(
nBy‹s
){

18312 
sql™e3_št64
 *
	gp
 = 0;

18313 ifÐ
	gnBy‹s
>0 ){

18314 
memsys5EÁ”
();

18315 
	gp
 = 
memsys5M®locUn§ã
(
nBy‹s
);

18316 
memsys5L—ve
();

18318  (*)
	gp
;

18327 
memsys5F»e
(*
pPriÜ
){

18328 
as£¹
Ð
pPriÜ
!=0 );

18329 
memsys5EÁ”
();

18330 
memsys5F»eUn§ã
(
pPriÜ
);

18331 
memsys5L—ve
();

18346 *
memsys5R—Îoc
(*
pPriÜ
, 
nBy‹s
){

18347 
	gnOld
;

18348 *
	gp
;

18349 
as£¹
Ð
pPriÜ
!=0 );

18350 
as£¹
Ð(
nBy‹s
&(nBytes-1))==0 );

18351 
as£¹
Ð
nBy‹s
>=0 );

18352 ifÐ
	gnBy‹s
==0 ){

18355 
	gnOld
 = 
memsys5Size
(
pPriÜ
);

18356 ifÐ
	gnBy‹s
<=
nOld
 ){

18357  
pPriÜ
;

18359 
memsys5EÁ”
();

18360 
	gp
 = 
memsys5M®locUn§ã
(
nBy‹s
);

18361 ifÐ
	gp
 ){

18362 
memýy
(
p
, 
pPriÜ
, 
nOld
);

18363 
memsys5F»eUn§ã
(
pPriÜ
);

18365 
memsys5L—ve
();

18366  
	gp
;

18378 
memsys5Roundup
(
n
){

18379 
	giFuÎSz
;

18380 ifÐ
	gn
 > 0x40000000 )  0;

18381 
	giFuÎSz
=
mem5
.
szAtom
; iFuÎSz<
	gn
; iFullSz *= 2);

18382  
	giFuÎSz
;

18395 
memsys5Log
(
iV®ue
){

18396 
	giLog
;

18397 
	giLog
=0; (iLog<()((()*8)-1)è&& (1<<iLog)<
	giV®ue
; iLog++);

18398  
	giLog
;

18407 
memsys5In™
(*
NÙU£d
){

18408 
	gii
;

18409 
	gnBy‹
;

18410 
u8
 *
	gzBy‹
;

18411 
	gnMšLog
;

18412 
	giOff£t
;

18414 
UNUSED_PARAMETER
(
NÙU£d
);

18417 
	gmem5
.
	gmu‹x
 = 0;

18422 
as£¹
Ð((
Mem5Lšk
)&((Mem5Link)-1))==0 );

18424 
	gnBy‹
 = 
sql™e3Glob®CÚfig
.
nH—p
;

18425 
	gzBy‹
 = (
u8
*)
sql™e3Glob®CÚfig
.
pH—p
;

18426 
as£¹
Ð
zBy‹
!=0 );

18429 
	gnMšLog
 = 
memsys5Log
(
sql™e3Glob®CÚfig
.
mnReq
);

18430 
	gmem5
.
	gszAtom
 = (1<<
nMšLog
);

18431  ()(
	gMem5Lšk
)>
	gmem5
.
	gszAtom
 ){

18432 
	gmem5
.
	gszAtom
 = 
mem5
.
szAtom
 << 1;

18435 
	gmem5
.
	gnBlock
 = (
nBy‹
 / (
mem5
.
szAtom
+(
u8
)));

18436 
	gmem5
.
	gzPoÞ
 = 
zBy‹
;

18437 
	gmem5
.
	gaCŒl
 = (
u8
 *)&
mem5
.
zPoÞ
[mem5.
nBlock
*mem5.
szAtom
];

18439 
	gii
=0; ii<=
LOGMAX
; ii++){

18440 
	gmem5
.
	gaiF»–i¡
[
ii
] = -1;

18443 
	giOff£t
 = 0;

18444 
	gii
=
LOGMAX
; ii>=0; ii--){

18445 
	gnAÎoc
 = (1<<
ii
);

18446 ifÐ(
	giOff£t
+
	gnAÎoc
)<=
mem5
.
nBlock
 ){

18447 
mem5
.
aCŒl
[
iOff£t
] = 
ii
 | 
CTRL_FREE
;

18448 
memsys5Lšk
(
iOff£t
, 
ii
);

18449 
	giOff£t
 +ð
nAÎoc
;

18451 
as£¹
((
iOff£t
+
nAÎoc
)>
mem5
.
nBlock
);

18455 ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
==0 ){

18456 
mem5
.
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MEM
);

18459  
	gSQLITE_OK
;

18465 
memsys5Shutdown
(*
NÙU£d
){

18466 
UNUSED_PARAMETER
(
NÙU£d
);

18467 
	gmem5
.
	gmu‹x
 = 0;

18471 #ifdeà
SQLITE_TEST


18476 
SQLITE_PRIVATE
 
sql™e3Memsys5Dump
(cÚ¡ *
zFž’ame
){

18477 
FILE
 *
	gout
;

18478 
	gi
, 
	gj
, 
	gn
;

18479 
	gnMšLog
;

18481 ifÐ
	gzFž’ame
==0 || 
zFž’ame
[0]==0 ){

18482 
out
 = 
¡dout
;

18484 
	gout
 = 
fÝ’
(
zFž’ame
, "w");

18485 ifÐ
	gout
==0 ){

18486 
årštf
(
¡d”r
, "** Unableo output memory debug output†og: %s **\n",

18487 
zFž’ame
);

18491 
memsys5EÁ”
();

18492 
	gnMšLog
 = 
memsys5Log
(
mem5
.
szAtom
);

18493 
	gi
=0; i<=
LOGMAX
 && 
i
+
nMšLog
<32; i++){

18494 
	gn
=0, 
	gj
=
mem5
.
aiF»–i¡
[
i
]; j>=0; j = 
MEM5LINK
(
j
)->
Ãxt
,‚++){}

18495 
årštf
(
out
, "ä“li¡ i‹m oàsiz%d: %d\n", 
mem5
.
szAtom
 << 
i
, 
n
);

18497 
årštf
(
out
, "mem5.nAÎoø = %Îu\n", 
mem5
.
nAÎoc
);

18498 
årštf
(
out
, "mem5.tÙ®AÎoø = %Îu\n", 
mem5
.
tÙ®AÎoc
);

18499 
årštf
(
out
, "mem5.tÙ®Exûs  = %Îu\n", 
mem5
.
tÙ®Exûss
);

18500 
årštf
(
out
, "mem5.cu¼’tOuˆ = %u\n", 
mem5
.
cu¼’tOut
);

18501 
årštf
(
out
, "mem5.cu¼’tCouÁ = %u\n", 
mem5
.
cu¼’tCouÁ
);

18502 
årštf
(
out
, "mem5.maxOuˆ = %u\n", 
mem5
.
maxOut
);

18503 
årštf
(
out
, "mem5.maxCouÁ = %u\n", 
mem5
.
maxCouÁ
);

18504 
årštf
(
out
, "mem5.maxReque¡ = %u\n", 
mem5
.
maxReque¡
);

18505 
memsys5L—ve
();

18506 ifÐ
	gout
==
¡dout
 ){

18507 
fæush
(
¡dout
);

18509 
fþo£
(
out
);

18519 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Memsys5
(){

18520 cÚ¡ 
sql™e3_mem_m‘hods
 
	gmemsys5M‘hods
 = {

18521 
memsys5M®loc
,

18522 
memsys5F»e
,

18523 
memsys5R—Îoc
,

18524 
memsys5Size
,

18525 
memsys5Roundup
,

18526 
memsys5In™
,

18527 
memsys5Shutdown
,

18530  &
	gmemsys5M‘hods
;

18553 #ià
defšed
(
SQLITE_DEBUG
è&& !defšed(
SQLITE_MUTEX_OMIT
)

18559 
SQLITE_WSD
 
	gmu‹xIsIn™
 = 0;

18563 #iâdeà
SQLITE_MUTEX_OMIT


18567 
SQLITE_PRIVATE
 
sql™e3Mu‹xIn™
(){

18568 
	grc
 = 
SQLITE_OK
;

18569 ifÐ!
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
	gxMu‹xAÎoc
 ){

18575 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
	gpFrom
;

18576 
sql™e3_mu‹x_m‘hods
 *
	gpTo
 = &
sql™e3Glob®CÚfig
.
mu‹x
;

18578 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 ){

18579 
	gpFrom
 = 
sql™e3DeçuÉMu‹x
();

18581 
	gpFrom
 = 
sql™e3NoÝMu‹x
();

18583 
memýy
(
pTo
, 
pFrom
, 
off£tof
(
sql™e3_mu‹x_m‘hods
, 
xMu‹xAÎoc
));

18584 
memýy
(&
pTo
->
xMu‹xF»e
, &
pFrom
->xMutexFree,

18585 (*
pTo
è- 
off£tof
(
sql™e3_mu‹x_m‘hods
, 
xMu‹xF»e
));

18586 
	gpTo
->
	gxMu‹xAÎoc
 = 
pFrom
->
xMu‹xAÎoc
;

18588 
	grc
 = 
sql™e3Glob®CÚfig
.
mu‹x
.
xMu‹xIn™
();

18590 #ifdeà
SQLITE_DEBUG


18591 
GLOBAL
(, 
mu‹xIsIn™
) = 1;

18594  
	grc
;

18601 
SQLITE_PRIVATE
 
sql™e3Mu‹xEnd
(){

18602 
	grc
 = 
SQLITE_OK
;

18603 ifÐ
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
	gxMu‹xEnd
 ){

18604 
	grc
 = 
sql™e3Glob®CÚfig
.
mu‹x
.
xMu‹xEnd
();

18607 #ifdeà
SQLITE_DEBUG


18608 
GLOBAL
(, 
mu‹xIsIn™
) = 0;

18611  
	grc
;

18617 
SQLITE_API
 
sql™e3_mu‹x
 *
sql™e3_mu‹x_®loc
(
id
){

18618 #iâdeà
SQLITE_OMIT_AUTOINIT


18619 ifÐ
	gid
<=
SQLITE_MUTEX_RECURSIVE
 && 
sql™e3_š™Ÿlize
() )  0;

18621  
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xAÎoc
(
id
);

18624 
SQLITE_PRIVATE
 
sql™e3_mu‹x
 *
sql™e3Mu‹xAÎoc
(
id
){

18625 ifÐ!
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 ){

18628 
as£¹
Ð
GLOBAL
(, 
mu‹xIsIn™
) );

18629  
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xAÎoc
(
id
);

18635 
SQLITE_API
 
sql™e3_mu‹x_ä“
(
sql™e3_mu‹x
 *
p
){

18636 ifÐ
	gp
 ){

18637 
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xF»e
(
p
);

18645 
SQLITE_API
 
sql™e3_mu‹x_’‹r
(
sql™e3_mu‹x
 *
p
){

18646 ifÐ
	gp
 ){

18647 
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xEÁ”
(
p
);

18655 
SQLITE_API
 
sql™e3_mu‹x_Œy
(
sql™e3_mu‹x
 *
p
){

18656 
	grc
 = 
SQLITE_OK
;

18657 ifÐ
	gp
 ){

18658  
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xTry
(
p
);

18660  
	grc
;

18669 
SQLITE_API
 
sql™e3_mu‹x_Ëave
(
sql™e3_mu‹x
 *
p
){

18670 ifÐ
	gp
 ){

18671 
	gsql™e3Glob®CÚfig
.
	gmu‹x
.
xMu‹xL—ve
(
p
);

18675 #iâdeà
NDEBUG


18680 
SQLITE_API
 
sql™e3_mu‹x_h–d
(
sql™e3_mu‹x
 *
p
){

18681  
	gp
==0 || 
sql™e3Glob®CÚfig
.
mu‹x
.
xMu‹xH–d
(
p
);

18683 
SQLITE_API
 
sql™e3_mu‹x_nÙh–d
(
sql™e3_mu‹x
 *
p
){

18684  
	gp
==0 || 
sql™e3Glob®CÚfig
.
mu‹x
.
xMu‹xNÙh–d
(
p
);

18720 #iâdeà
SQLITE_MUTEX_OMIT


18722 #iâdeà
SQLITE_DEBUG


18728 
noÝMu‹xIn™
(){  
	gSQLITE_OK
; }

18729 
noÝMu‹xEnd
(){  
	gSQLITE_OK
; }

18730 
sql™e3_mu‹x
 *
noÝMu‹xAÎoc
(
id
){

18731 
UNUSED_PARAMETER
(
id
);

18732  (
	gsql™e3_mu‹x
*)8;

18734 
noÝMu‹xF»e
(
sql™e3_mu‹x
 *
p
){ 
UNUSED_PARAMETER
(p); ; }

18735 
noÝMu‹xEÁ”
(
sql™e3_mu‹x
 *
p
){ 
UNUSED_PARAMETER
(p); ; }

18736 
noÝMu‹xTry
(
sql™e3_mu‹x
 *
p
){

18737 
UNUSED_PARAMETER
(
p
);

18738  
	gSQLITE_OK
;

18740 
noÝMu‹xL—ve
(
sql™e3_mu‹x
 *
p
){ 
UNUSED_PARAMETER
(p); ; }

18742 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3NoÝMu‹x
(){

18743 cÚ¡ 
sql™e3_mu‹x_m‘hods
 
	gsMu‹x
 = {

18744 
noÝMu‹xIn™
,

18745 
noÝMu‹xEnd
,

18746 
noÝMu‹xAÎoc
,

18747 
noÝMu‹xF»e
,

18748 
noÝMu‹xEÁ”
,

18749 
noÝMu‹xTry
,

18750 
noÝMu‹xL—ve
,

18756  &
	gsMu‹x
;

18760 #ifdeà
SQLITE_DEBUG


18770 
	ssql™e3_debug_mu‹x
 {

18771 
	gid
;

18772 
	gút
;

18773 } 
	tsql™e3_debug_mu‹x
;

18779 
debugMu‹xH–d
(
sql™e3_mu‹x
 *
pX
){

18780 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18781  
	gp
==0 || 
p
->
út
>0;

18783 
debugMu‹xNÙh–d
(
sql™e3_mu‹x
 *
pX
){

18784 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18785  
	gp
==0 || 
p
->
út
==0;

18791 
debugMu‹xIn™
(){  
	gSQLITE_OK
; }

18792 
debugMu‹xEnd
(){  
	gSQLITE_OK
; }

18799 
sql™e3_mu‹x
 *
debugMu‹xAÎoc
(
id
){

18800 
sql™e3_debug_mu‹x
 
	gaStic
[
SQLITE_MUTEX_STATIC_APP3
 - 1];

18801 
sql™e3_debug_mu‹x
 *
	gpNew
 = 0;

18802  
	gid
 ){

18803 
	gSQLITE_MUTEX_FAST
:

18804 
SQLITE_MUTEX_RECURSIVE
: {

18805 
pNew
 = 
sql™e3M®loc
((*pNew));

18806 ifÐ
	gpNew
 ){

18807 
	gpNew
->
	gid
 = 
id
;

18808 
	gpNew
->
	gút
 = 0;

18813 
as£¹
Ð
id
-2 >= 0 );

18814 
as£¹
Ð
id
-2 < ()((
aStic
)/(aStatic[0])) );

18815 
	gpNew
 = &
aStic
[
id
-2];

18816 
	gpNew
->
	gid
 = 
id
;

18820  (
	gsql™e3_mu‹x
*)
	gpNew
;

18826 
debugMu‹xF»e
(
sql™e3_mu‹x
 *
pX
){

18827 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18828 
as£¹
Ð
p
->
út
==0 );

18829 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_FAST
 ||…->id==
SQLITE_MUTEX_RECURSIVE
 );

18830 
sql™e3_ä“
(
p
);

18844 
debugMu‹xEÁ”
(
sql™e3_mu‹x
 *
pX
){

18845 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18846 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
debugMu‹xNÙh–d
(
pX
) );

18847 
	gp
->
	gút
++;

18849 
debugMu‹xTry
(
sql™e3_mu‹x
 *
pX
){

18850 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18851 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
debugMu‹xNÙh–d
(
pX
) );

18852 
	gp
->
	gút
++;

18853  
	gSQLITE_OK
;

18862 
debugMu‹xL—ve
(
sql™e3_mu‹x
 *
pX
){

18863 
sql™e3_debug_mu‹x
 *
	gp
 = (sql™e3_debug_mu‹x*)
pX
;

18864 
as£¹
Ð
debugMu‹xH–d
(
pX
) );

18865 
	gp
->
	gút
--;

18866 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
debugMu‹xNÙh–d
(
pX
) );

18869 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3NoÝMu‹x
(){

18870 cÚ¡ 
sql™e3_mu‹x_m‘hods
 
	gsMu‹x
 = {

18871 
debugMu‹xIn™
,

18872 
debugMu‹xEnd
,

18873 
debugMu‹xAÎoc
,

18874 
debugMu‹xF»e
,

18875 
debugMu‹xEÁ”
,

18876 
debugMu‹xTry
,

18877 
debugMu‹xL—ve
,

18879 
debugMu‹xH–d
,

18880 
debugMu‹xNÙh–d


18883  &
	gsMu‹x
;

18891 #ifdeà
SQLITE_MUTEX_NOOP


18892 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3DeçuÉMu‹x
(){

18893  
sql™e3NoÝMu‹x
();

18921 #ifdeà
SQLITE_MUTEX_PTHREADS


18923 
	~<±h»ad.h
>

18930 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_HOMEGROWN_RECURSIVE_MUTEX
)

18931 
	#SQLITE_MUTEX_NREF
 1

	)

18933 
	#SQLITE_MUTEX_NREF
 0

	)

18939 
	ssql™e3_mu‹x
 {

18940 
±h»ad_mu‹x_t
 
	gmu‹x
;

18941 #ià
SQLITE_MUTEX_NREF


18942 
	gid
;

18943 vÞ©ž
	gnRef
;

18944 vÞ©ž
±h»ad_t
 
	gowÃr
;

18945 
	gŒaû
;

18948 #ià
SQLITE_MUTEX_NREF


18949 
	#SQLITE3_MUTEX_INITIALIZER
 { 
PTHREAD_MUTEX_INITIALIZER
, 0, 0, (
±h»ad_t
)0, 0 }

	)

18951 
	#SQLITE3_MUTEX_INITIALIZER
 { 
PTHREAD_MUTEX_INITIALIZER
 }

	)

18970 #ià!
defšed
(
NDEBUG
è|| defšed(
SQLITE_DEBUG
)

18971 
±h»adMu‹xH–d
(
sql™e3_mu‹x
 *
p
){

18972  (
	gp
->
	gnRef
!=0 && 
±h»ad_equ®
(
p
->
owÃr
, 
±h»ad_£lf
()));

18974 
±h»adMu‹xNÙh–d
(
sql™e3_mu‹x
 *
p
){

18975  
	gp
->
	gnRef
==0 || 
±h»ad_equ®
(
p
->
owÃr
, 
±h»ad_£lf
())==0;

18982 
±h»adMu‹xIn™
(){  
	gSQLITE_OK
; }

18983 
±h»adMu‹xEnd
(){  
	gSQLITE_OK
; }

19030 
sql™e3_mu‹x
 *
±h»adMu‹xAÎoc
(
iTy³
){

19031 
sql™e3_mu‹x
 
	g¡©icMu‹xes
[] = {

19032 
SQLITE3_MUTEX_INITIALIZER
,

19033 
SQLITE3_MUTEX_INITIALIZER
,

19034 
SQLITE3_MUTEX_INITIALIZER
,

19035 
SQLITE3_MUTEX_INITIALIZER
,

19036 
SQLITE3_MUTEX_INITIALIZER
,

19037 
SQLITE3_MUTEX_INITIALIZER
,

19038 
SQLITE3_MUTEX_INITIALIZER
,

19039 
SQLITE3_MUTEX_INITIALIZER
,

19040 
SQLITE3_MUTEX_INITIALIZER


19042 
sql™e3_mu‹x
 *
	gp
;

19043  
	giTy³
 ){

19044 
	gSQLITE_MUTEX_RECURSIVE
: {

19045 
p
 = 
sql™e3M®locZ”o
( (*p) );

19046 ifÐ
	gp
 ){

19047 #ifdeà
SQLITE_HOMEGROWN_RECURSIVE_MUTEX


19050 
±h»ad_mu‹x_š™
(&
p
->
mu‹x
, 0);

19053 
±h»ad_mu‹x©Œ_t
 
	g»cursiveA‰r
;

19054 
±h»ad_mu‹x©Œ_š™
(&
»cursiveA‰r
);

19055 
±h»ad_mu‹x©Œ_£‰y³
(&
»cursiveA‰r
, 
PTHREAD_MUTEX_RECURSIVE
);

19056 
±h»ad_mu‹x_š™
(&
p
->
mu‹x
, &
»cursiveA‰r
);

19057 
±h»ad_mu‹x©Œ_de¡roy
(&
»cursiveA‰r
);

19059 #ià
SQLITE_MUTEX_NREF


19060 
	gp
->
	gid
 = 
iTy³
;

19065 
	gSQLITE_MUTEX_FAST
: {

19066 
p
 = 
sql™e3M®locZ”o
( (*p) );

19067 ifÐ
	gp
 ){

19068 #ià
SQLITE_MUTEX_NREF


19069 
	gp
->
	gid
 = 
iTy³
;

19071 
±h»ad_mu‹x_š™
(&
p
->
mu‹x
, 0);

19076 
as£¹
Ð
iTy³
-2 >= 0 );

19077 
as£¹
Ð
iTy³
-2 < 
A¼aySize
(
¡©icMu‹xes
) );

19078 
	gp
 = &
¡©icMu‹xes
[
iTy³
-2];

19079 #ià
SQLITE_MUTEX_NREF


19080 
	gp
->
	gid
 = 
iTy³
;

19085  
	gp
;

19094 
±h»adMu‹xF»e
(
sql™e3_mu‹x
 *
p
){

19095 
as£¹
Ð
p
->
nRef
==0 );

19096 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_FAST
 ||…->id==
SQLITE_MUTEX_RECURSIVE
 );

19097 
±h»ad_mu‹x_de¡roy
(&
p
->
mu‹x
);

19098 
sql™e3_ä“
(
p
);

19112 
±h»adMu‹xEÁ”
(
sql™e3_mu‹x
 *
p
){

19113 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
±h»adMu‹xNÙh–d
(p) );

19115 #ifdeà
SQLITE_HOMEGROWN_RECURSIVE_MUTEX


19127 
±h»ad_t
 
	g£lf
 = 
±h»ad_£lf
();

19128 ifÐ
	gp
->
	gnRef
>0 && 
±h»ad_equ®
(
p
->
owÃr
, 
£lf
) ){

19129 
	gp
->
	gnRef
++;

19131 
±h»ad_mu‹x_lock
(&
p
->
mu‹x
);

19132 
as£¹
Ð
p
->
nRef
==0 );

19133 
	gp
->
	gowÃr
 = 
£lf
;

19134 
	gp
->
	gnRef
 = 1;

19140 
±h»ad_mu‹x_lock
(&
p
->
mu‹x
);

19141 #ià
SQLITE_MUTEX_NREF


19142 
as£¹
Ð
p
->
nRef
>0 ||…->
owÃr
==0 );

19143 
	gp
->
	gowÃr
 = 
±h»ad_£lf
();

19144 
	gp
->
	gnRef
++;

19148 #ifdeà
SQLITE_DEBUG


19149 ifÐ
	gp
->
	gŒaû
 ){

19150 
´štf
("’‹¸mu‹x %°(%dèw™h‚Ref=%d\n", 
p
,…->
Œaû
,…->
nRef
);

19154 
±h»adMu‹xTry
(
sql™e3_mu‹x
 *
p
){

19155 
	grc
;

19156 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
±h»adMu‹xNÙh–d
(p) );

19158 #ifdeà
SQLITE_HOMEGROWN_RECURSIVE_MUTEX


19170 
±h»ad_t
 
	g£lf
 = 
±h»ad_£lf
();

19171 ifÐ
	gp
->
	gnRef
>0 && 
±h»ad_equ®
(
p
->
owÃr
, 
£lf
) ){

19172 
	gp
->
	gnRef
++;

19173 
	grc
 = 
SQLITE_OK
;

19174 }ifÐ
±h»ad_mu‹x_Œylock
(&
p
->
mu‹x
)==0 ){

19175 
as£¹
Ð
p
->
nRef
==0 );

19176 
	gp
->
	gowÃr
 = 
£lf
;

19177 
	gp
->
	gnRef
 = 1;

19178 
	grc
 = 
SQLITE_OK
;

19180 
	grc
 = 
SQLITE_BUSY
;

19186 ifÐ
±h»ad_mu‹x_Œylock
(&
p
->
mu‹x
)==0 ){

19187 #ià
SQLITE_MUTEX_NREF


19188 
p
->
owÃr
 = 
±h»ad_£lf
();

19189 
	gp
->
	gnRef
++;

19191 
	grc
 = 
SQLITE_OK
;

19193 
	grc
 = 
SQLITE_BUSY
;

19197 #ifdeà
SQLITE_DEBUG


19198 ifÐ
	grc
==
SQLITE_OK
 && 
p
->
Œaû
 ){

19199 
´štf
("’‹¸mu‹x %°(%dèw™h‚Ref=%d\n", 
p
,…->
Œaû
,…->
nRef
);

19202  
	grc
;

19211 
±h»adMu‹xL—ve
(
sql™e3_mu‹x
 *
p
){

19212 
as£¹
Ð
±h»adMu‹xH–d
(
p
) );

19213 #ià
SQLITE_MUTEX_NREF


19214 
	gp
->
	gnRef
--;

19215 ifÐ
	gp
->
	gnRef
==0 ) 
p
->
owÃr
 = 0;

19217 
as£¹
Ð
p
->
nRef
==0 ||…->
id
==
SQLITE_MUTEX_RECURSIVE
 );

19219 #ifdeà
SQLITE_HOMEGROWN_RECURSIVE_MUTEX


19220 ifÐ
	gp
->
	gnRef
==0 ){

19221 
±h»ad_mu‹x_uÆock
(&
p
->
mu‹x
);

19224 
±h»ad_mu‹x_uÆock
(&
p
->
mu‹x
);

19227 #ifdeà
SQLITE_DEBUG


19228 ifÐ
	gp
->
	gŒaû
 ){

19229 
´štf
("Ëavmu‹x %°(%dèw™h‚Ref=%d\n", 
p
,…->
Œaû
,…->
nRef
);

19234 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3DeçuÉMu‹x
(){

19235 cÚ¡ 
sql™e3_mu‹x_m‘hods
 
	gsMu‹x
 = {

19236 
±h»adMu‹xIn™
,

19237 
±h»adMu‹xEnd
,

19238 
±h»adMu‹xAÎoc
,

19239 
±h»adMu‹xF»e
,

19240 
±h»adMu‹xEÁ”
,

19241 
±h»adMu‹xTry
,

19242 
±h»adMu‹xL—ve
,

19243 #ifdeà
SQLITE_DEBUG


19244 
±h»adMu‹xH–d
,

19245 
±h»adMu‹xNÙh–d


19252  &
	gsMu‹x
;

19273 #ià
SQLITE_OS_WIN


19298 #iâdeà
_OS_COMMON_H_


19299 
	#_OS_COMMON_H_


	)

19306 #ifdeà
MEMORY_DEBUG


19310 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

19311 #iâdeà
SQLITE_DEBUG_OS_TRACE


19312 
	#SQLITE_DEBUG_OS_TRACE
 0

	)

19314 
	gsql™e3OST¿û
 = 
SQLITE_DEBUG_OS_TRACE
;

19315 
	#OSTRACE
(
X
èifÐ
sql™e3OST¿û
 ) 
sql™e3DebugPrštf
 
	)
X

19317 
	#OSTRACE
(
X
)

	)

19324 #ifdeà
SQLITE_PERFORMANCE_TRACE


19347 #iâdeà
_HWTIME_H_


19348 
	#_HWTIME_H_


	)

19356 #ià(
defšed
(
__GNUC__
è|| defšed(
_MSC_VER
)) && \

19357 (
defšed
(
i386
è|| defšed(
__i386__
è|| defšed(
_M_IX86
))

19359 #ià
defšed
(
__GNUC__
)

19361 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

19362 
	glo
, 
	ghi
;

19363 
__asm__
 
__vÞ©že__
 ("rdtsc" : "÷" (
lo
), "=d" (
hi
));

19364  (
	gsql™e_ušt64
)
	ghi
 << 32 | 
	glo
;

19367 #–ià
defšed
(
_MSC_VER
)

19369 
__deþ¥ec
(
Çked
è
__šlše
 
sql™e_ušt64
 
__cdeþ
 
sql™e3Hwtime
(){

19370 
	g__asm
 {

19371 
rdtsc


19372 
	g»t
 ;  
v®ue
 
©
 
	gEDX
:
EAX


19378 #–ià(
defšed
(
__GNUC__
è&& defšed(
__x86_64__
))

19380 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

19381 
v®
;

19382 
__asm__
 
__vÞ©že__
 ("rdtsc" : "=A" (
v®
));

19383  
	gv®
;

19386 #–ià(
defšed
(
__GNUC__
è&& defšed(
__µc__
))

19388 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

19389 
	g»tv®
;

19390 
	gjunk
;

19391 
__asm__
 
__vÞ©že__
 ("\n\
1: mftbu %1\n\
 %L0\n\
 %0\n\
 %0,%1\n\
 1b"

19397 : "ô" (
»tv®
), "ô" (
junk
));

19398  
	g»tv®
;

19403 #”rÜ 
N“d
 
im¶em’tiÚ
 
of
 
sql™e3Hwtime
(è
your
 
¶©fÜm
.

19412 
SQLITE_PRIVATE
 
sql™e_ušt64
 
sql™e3Hwtime
(){  ((
	gsql™e_ušt64
)0); }

19421 
sql™e_ušt64
 
	gg_¡¬t
;

19422 
sql™e_ušt64
 
	gg_–­£d
;

19423 
	#TIMER_START
 
g_¡¬t
=
	`sql™e3Hwtime
()

	)

19424 
	#TIMER_END
 
g_–­£d
=
	`sql™e3Hwtime
()-
g_¡¬t


	)

19425 
	#TIMER_ELAPSED
 
g_–­£d


	)

19427 
	#TIMER_START


	)

19428 
	#TIMER_END


	)

19429 
	#TIMER_ELAPSED
 ((
sql™e_ušt64
)0)

	)

19437 #ifdeà
SQLITE_TEST


19438 
SQLITE_API
 
	gsql™e3_io_”rÜ_h™
 = 0;

19439 
SQLITE_API
 
	gsql™e3_io_”rÜ_h¬dh™
 = 0;

19440 
SQLITE_API
 
	gsql™e3_io_”rÜ_³ndšg
 = 0;

19441 
SQLITE_API
 
	gsql™e3_io_”rÜ_³rsi¡
 = 0;

19442 
SQLITE_API
 
	gsql™e3_io_”rÜ_b’ign
 = 0;

19443 
SQLITE_API
 
	gsql™e3_diskfuÎ_³ndšg
 = 0;

19444 
SQLITE_API
 
	gsql™e3_diskfuÎ
 = 0;

19445 
	#SimuÏ‹IOE¼ÜB’ign
(
X
è
sql™e3_io_”rÜ_b’ign
=(X)

	)

19446 
	#SimuÏ‹IOE¼Ü
(
CODE
) \

19447 ifÐ(
sql™e3_io_”rÜ_³rsi¡
 && 
sql™e3_io_”rÜ_h™
) \

19448 || 
sql™e3_io_”rÜ_³ndšg
-- == 1 ) \

19449 { 
	`loÿl_iÛ¼
(); 
CODE
; }

	)

19450 
loÿl_iÛ¼
(){

19451 
IOTRACE
(("IOERR\n"));

19452 
	gsql™e3_io_”rÜ_h™
++;

19453 ifÐ!
	gsql™e3_io_”rÜ_b’ign
 ) 
	gsql™e3_io_”rÜ_h¬dh™
++;

19455 
	#SimuÏ‹DiskfuÎE¼Ü
(
CODE
) \

19456 ifÐ
sql™e3_diskfuÎ_³ndšg
 ){ \

19457 ifÐ
sql™e3_diskfuÎ_³ndšg
 == 1 ){ \

19458 
	`loÿl_iÛ¼
(); \

19459 
sql™e3_diskfuÎ
 = 1; \

19460 
sql™e3_io_”rÜ_h™
 = 1; \

19461 
CODE
; \

19463 
sql™e3_diskfuÎ_³ndšg
--; \

19465 }

	)

19467 
	#SimuÏ‹IOE¼ÜB’ign
(
X
)

	)

19468 
	#SimuÏ‹IOE¼Ü
(
A
)

	)

19469 
	#SimuÏ‹DiskfuÎE¼Ü
(
A
)

	)

19475 #ifdeà
SQLITE_TEST


19476 
SQLITE_API
 
	gsql™e3_Ý’_fže_couÁ
 = 0;

19477 
	#O³nCouÁ”
(
X
è
sql™e3_Ý’_fže_couÁ
+=(X)

	)

19479 
	#O³nCouÁ”
(
X
)

	)

19506 #iâdeà
_OS_WIN_H_


19507 
	#_OS_WIN_H_


	)

19512 
	~"wšdows.h
"

19514 #ifdeà
__CYGWIN__


19515 
	~<sys/cygwš.h
>

19516 
	~<”ºo.h
>

19536 #ià
SQLITE_OS_WIN
 && !
defšed
(
SQLITE_OS_WINNT
)

19537 
	#SQLITE_OS_WINNT
 1

	)

19544 #ià
defšed
(
_WIN32_WCE
)

19545 
	#SQLITE_OS_WINCE
 1

	)

19547 
	#SQLITE_OS_WINCE
 0

	)

19554 #ià!
defšed
(
SQLITE_OS_WINRT
)

19555 
	#SQLITE_OS_WINRT
 0

	)

19562 #ià
SQLITE_OS_WINCE


19563 
	#SQLITE_WIN32_VOLATILE


	)

19565 
	#SQLITE_WIN32_VOLATILE
 vÞ©že

	)

19578 #ifdeà
SQLITE_MUTEX_W32


19583 
	ssql™e3_mu‹x
 {

19584 
CRITICAL_SECTION
 
	gmu‹x
;

19585 
	gid
;

19586 #ifdeà
SQLITE_DEBUG


19587 vÞ©ž
	gnRef
;

19588 vÞ©ž
DWORD
 
	gowÃr
;

19589 vÞ©ž
	gŒaû
;

19598 
	#SQLITE_W32_MUTEX_INITIALIZER
 { 0 }

	)

19600 #ifdeà
SQLITE_DEBUG


19601 
	#SQLITE3_MUTEX_INITIALIZER
 { 
SQLITE_W32_MUTEX_INITIALIZER
, 0, \

19602 0L, (
DWORD
)0, 0 }

	)

19604 
	#SQLITE3_MUTEX_INITIALIZER
 { 
SQLITE_W32_MUTEX_INITIALIZER
, 0 }

	)

19607 #ifdeà
SQLITE_DEBUG


19612 
wšMu‹xH–d
(
sql™e3_mu‹x
 *
p
){

19613  
	gp
->
	gnRef
!=0 && 
p
->
owÃr
==
G‘Cu¼’tTh»adId
();

19616 
wšMu‹xNÙh–d2
(
sql™e3_mu‹x
 *
p
, 
DWORD
 
tid
){

19617  
	gp
->
	gnRef
==0 || 
p
->
owÃr
!=
tid
;

19620 
wšMu‹xNÙh–d
(
sql™e3_mu‹x
 *
p
){

19621 
DWORD
 
	gtid
 = 
G‘Cu¼’tTh»adId
();

19622  
wšMu‹xNÙh–d2
(
p
, 
tid
);

19629 
sql™e3_mu‹x
 
	gwšMu‹x_¡©icMu‹xes
[] = {

19630 
SQLITE3_MUTEX_INITIALIZER
,

19631 
SQLITE3_MUTEX_INITIALIZER
,

19632 
SQLITE3_MUTEX_INITIALIZER
,

19633 
SQLITE3_MUTEX_INITIALIZER
,

19634 
SQLITE3_MUTEX_INITIALIZER
,

19635 
SQLITE3_MUTEX_INITIALIZER
,

19636 
SQLITE3_MUTEX_INITIALIZER
,

19637 
SQLITE3_MUTEX_INITIALIZER
,

19638 
SQLITE3_MUTEX_INITIALIZER


19641 
	gwšMu‹x_isIn™
 = 0;

19642 
	gwšMu‹x_isNt
 = -1;

19648 
LONG
 
SQLITE_WIN32_VOLATILE
 
	gwšMu‹x_lock
 = 0;

19650 
SQLITE_API
 
sql™e3_wš32_is_Á
();

19651 
SQLITE_API
 
sql™e3_wš32_¦“p
(
DWORD
 
mžli£cÚds
);

19653 
wšMu‹xIn™
(){

19655 ifÐ
IÁ”lockedCom·»Exchªge
(&
wšMu‹x_lock
, 1, 0)==0 ){

19656 
i
;

19657 
	gi
=0; i<
A¼aySize
(
wšMu‹x_¡©icMu‹xes
); i++){

19658 #ià
SQLITE_OS_WINRT


19659 
In™ŸlizeCr™iÿlSeùiÚEx
(&
wšMu‹x_¡©icMu‹xes
[
i
].
mu‹x
, 0, 0);

19661 
In™ŸlizeCr™iÿlSeùiÚ
(&
wšMu‹x_¡©icMu‹xes
[
i
].
mu‹x
);

19664 
	gwšMu‹x_isIn™
 = 1;

19668  !
	gwšMu‹x_isIn™
 ){

19669 
sql™e3_wš32_¦“p
(1);

19672  
	gSQLITE_OK
;

19675 
wšMu‹xEnd
(){

19678 ifÐ
IÁ”lockedCom·»Exchªge
(&
wšMu‹x_lock
, 0, 1)==1 ){

19679 ifÐ
wšMu‹x_isIn™
==1 ){

19680 
i
;

19681 
	gi
=0; i<
A¼aySize
(
wšMu‹x_¡©icMu‹xes
); i++){

19682 
D–‘eCr™iÿlSeùiÚ
(&
wšMu‹x_¡©icMu‹xes
[
i
].
mu‹x
);

19684 
	gwšMu‹x_isIn™
 = 0;

19687  
	gSQLITE_OK
;

19735 
sql™e3_mu‹x
 *
wšMu‹xAÎoc
(
iTy³
){

19736 
sql™e3_mu‹x
 *
	gp
;

19738  
	giTy³
 ){

19739 
	gSQLITE_MUTEX_FAST
:

19740 
SQLITE_MUTEX_RECURSIVE
: {

19741 
p
 = 
sql™e3M®locZ”o
( (*p) );

19742 ifÐ
	gp
 ){

19743 #ifdeà
SQLITE_DEBUG


19744 
	gp
->
	gid
 = 
iTy³
;

19745 #ifdeà
SQLITE_WIN32_MUTEX_TRACE_DYNAMIC


19746 
	gp
->
	gŒaû
 = 1;

19749 #ià
SQLITE_OS_WINRT


19750 
In™ŸlizeCr™iÿlSeùiÚEx
(&
p
->
mu‹x
, 0, 0);

19752 
In™ŸlizeCr™iÿlSeùiÚ
(&
p
->
mu‹x
);

19758 
as£¹
Ð
iTy³
-2 >= 0 );

19759 
as£¹
Ð
iTy³
-2 < 
A¼aySize
(
wšMu‹x_¡©icMu‹xes
) );

19760 
as£¹
Ð
wšMu‹x_isIn™
==1 );

19761 
	gp
 = &
wšMu‹x_¡©icMu‹xes
[
iTy³
-2];

19762 #ifdeà
SQLITE_DEBUG


19763 
	gp
->
	gid
 = 
iTy³
;

19764 #ifdeà
SQLITE_WIN32_MUTEX_TRACE_STATIC


19765 
	gp
->
	gŒaû
 = 1;

19771  
	gp
;

19780 
wšMu‹xF»e
(
sql™e3_mu‹x
 *
p
){

19781 
as£¹
Ð
p
 );

19782 #ifdeà
SQLITE_DEBUG


19783 
as£¹
Ð
p
->
nRef
==0 &&…->
owÃr
==0 );

19784 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_FAST
 ||…->id==
SQLITE_MUTEX_RECURSIVE
 );

19786 
as£¹
Ð
wšMu‹x_isIn™
==1 );

19787 
D–‘eCr™iÿlSeùiÚ
(&
p
->
mu‹x
);

19788 
sql™e3_ä“
(
p
);

19802 
wšMu‹xEÁ”
(
sql™e3_mu‹x
 *
p
){

19803 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_TEST
)

19804 
DWORD
 
	gtid
 = 
G‘Cu¼’tTh»adId
();

19806 #ifdeà
SQLITE_DEBUG


19807 
as£¹
Ð
p
 );

19808 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
wšMu‹xNÙh–d2
Õ, 
tid
) );

19810 
as£¹
Ð
p
 );

19812 
as£¹
Ð
wšMu‹x_isIn™
==1 );

19813 
EÁ”Cr™iÿlSeùiÚ
(&
p
->
mu‹x
);

19814 #ifdeà
SQLITE_DEBUG


19815 
as£¹
Ð
p
->
nRef
>0 ||…->
owÃr
==0 );

19816 
	gp
->
	gowÃr
 = 
tid
;

19817 
	gp
->
	gnRef
++;

19818 ifÐ
	gp
->
	gŒaû
 ){

19819 
OSTRACE
(("ENTER-MUTEXid=%lu, mutex=%p (%d),‚Ref=%d\n",

19820 
tid
, 
p
,…->
Œaû
,…->
nRef
));

19825 
wšMu‹xTry
(
sql™e3_mu‹x
 *
p
){

19826 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_TEST
)

19827 
DWORD
 
	gtid
 = 
G‘Cu¼’tTh»adId
();

19829 
	grc
 = 
SQLITE_BUSY
;

19830 
as£¹
Ð
p
 );

19831 
as£¹
Ð
p
->
id
==
SQLITE_MUTEX_RECURSIVE
 || 
wšMu‹xNÙh–d2
Õ, 
tid
) );

19843 #ià
defšed
(
_WIN32_WINNT
) && _WIN32_WINNT >= 0x0400

19844 
as£¹
Ð
wšMu‹x_isIn™
==1 );

19845 
as£¹
Ð
wšMu‹x_isNt
>=-1 && winMutex_isNt<=1 );

19846 ifÐ
	gwšMu‹x_isNt
<0 ){

19847 
	gwšMu‹x_isNt
 = 
sql™e3_wš32_is_Á
();

19849 
as£¹
Ð
wšMu‹x_isNt
==0 || winMutex_isNt==1 );

19850 ifÐ
	gwšMu‹x_isNt
 && 
TryEÁ”Cr™iÿlSeùiÚ
(&
p
->
mu‹x
) ){

19851 #ifdeà
SQLITE_DEBUG


19852 
	gp
->
	gowÃr
 = 
tid
;

19853 
	gp
->
	gnRef
++;

19855 
	grc
 = 
SQLITE_OK
;

19858 
UNUSED_PARAMETER
(
p
);

19860 #ifdeà
SQLITE_DEBUG


19861 ifÐ
	gp
->
	gŒaû
 ){

19862 
OSTRACE
(("TRY-MUTEXid=%lu, mutex=%p (%d), owner=%lu,‚Ref=%d,„c=%s\n",

19863 
tid
, 
p
,…->
Œaû
,…->
owÃr
,…->
nRef
, 
sql™e3E¼Name
(
rc
)));

19866  
	grc
;

19875 
wšMu‹xL—ve
(
sql™e3_mu‹x
 *
p
){

19876 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_TEST
)

19877 
DWORD
 
	gtid
 = 
G‘Cu¼’tTh»adId
();

19879 
as£¹
Ð
p
 );

19880 #ifdeà
SQLITE_DEBUG


19881 
as£¹
Ð
p
->
nRef
>0 );

19882 
as£¹
Ð
p
->
owÃr
==
tid
 );

19883 
	gp
->
	gnRef
--;

19884 ifÐ
	gp
->
	gnRef
==0 ) 
p
->
owÃr
 = 0;

19885 
as£¹
Ð
p
->
nRef
==0 ||…->
id
==
SQLITE_MUTEX_RECURSIVE
 );

19887 
as£¹
Ð
wšMu‹x_isIn™
==1 );

19888 
L—veCr™iÿlSeùiÚ
(&
p
->
mu‹x
);

19889 #ifdeà
SQLITE_DEBUG


19890 ifÐ
	gp
->
	gŒaû
 ){

19891 
OSTRACE
(("LEAVE-MUTEXid=%lu, mutex=%p (%d),‚Ref=%d\n",

19892 
tid
, 
p
,…->
Œaû
,…->
nRef
));

19897 
SQLITE_PRIVATE
 
sql™e3_mu‹x_m‘hods
 cÚ¡ *
sql™e3DeçuÉMu‹x
(){

19898 cÚ¡ 
sql™e3_mu‹x_m‘hods
 
	gsMu‹x
 = {

19899 
wšMu‹xIn™
,

19900 
wšMu‹xEnd
,

19901 
wšMu‹xAÎoc
,

19902 
wšMu‹xF»e
,

19903 
wšMu‹xEÁ”
,

19904 
wšMu‹xTry
,

19905 
wšMu‹xL—ve
,

19906 #ifdeà
SQLITE_DEBUG


19907 
wšMu‹xH–d
,

19908 
wšMu‹xNÙh–d


19914  &
	gsMu‹x
;

19942 
SQLITE_API
 
sql™e3_»Ëa£_memÜy
(
n
){

19943 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


19944  
sql™e3PÿcheR–—£MemÜy
(
n
);

19949 
UNUSED_PARAMETER
(
n
);

19958 
	sSü©chF»e¦Ù
 {

19959 
Sü©chF»e¦Ù
 *
	gpNext
;

19960 } 
	tSü©chF»e¦Ù
;

19965 
SQLITE_WSD
 
	sMem0Glob®
 {

19966 
sql™e3_mu‹x
 *
	gmu‹x
;

19974 
sql™e3_št64
 
	g®¬mTh»shÞd
;

19975 (*
	g®¬mC®lback
)(*, 
	gsql™e3_št64
,);

19976 *
	g®¬mArg
;

19984 *
	gpSü©chEnd
;

19985 
Sü©chF»e¦Ù
 *
	gpSü©chF»e
;

19986 
u32
 
	gnSü©chF»e
;

19992 
	gÃ¬lyFuÎ
;

19993 } 
	gmem0
 = { 0, 0, 0, 0, 0, 0, 0, 0 };

19995 
	#mem0
 
	`GLOBAL
(
Mem0Glob®
, 
mem0
)

	)

20002 
soáH—pLim™EnfÜûr
(

20003 *
NÙU£d
,

20004 
sql™e3_št64
 
NÙU£d2
,

20005 
®locSize


20007 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

20008 
sql™e3_»Ëa£_memÜy
(
®locSize
);

20014 
sql™e3MemÜyAÏrm
(

20015 (*
xC®lback
)(*
pArg
, 
sql™e3_št64
 
u£d
,
N
),

20016 *
pArg
,

20017 
sql™e3_št64
 
iTh»shÞd


20019 
	gnU£d
;

20020 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20021 
	gmem0
.
	g®¬mC®lback
 = 
xC®lback
;

20022 
	gmem0
.
	g®¬mArg
 = 
pArg
;

20023 
	gmem0
.
	g®¬mTh»shÞd
 = 
iTh»shÞd
;

20024 
	gnU£d
 = 
sql™e3StusV®ue
(
SQLITE_STATUS_MEMORY_USED
);

20025 
	gmem0
.
	gÃ¬lyFuÎ
 = (
iTh»shÞd
>0 && iTh»shÞd<=
nU£d
);

20026 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20027  
	gSQLITE_OK
;

20030 #iâdeà
SQLITE_OMIT_DEPRECATED


20035 
SQLITE_API
 
sql™e3_memÜy_®¬m
(

20036 (*
xC®lback
)(*
pArg
, 
sql™e3_št64
 
u£d
,
N
),

20037 *
pArg
,

20038 
sql™e3_št64
 
iTh»shÞd


20040  
sql™e3MemÜyAÏrm
(
xC®lback
, 
pArg
, 
iTh»shÞd
);

20048 
SQLITE_API
 
sql™e3_št64
 
sql™e3_soá_h—p_lim™64
(sql™e3_št64 
n
){

20049 
sql™e3_št64
 
	g´iÜLim™
;

20050 
sql™e3_št64
 
	gexûss
;

20051 #iâdeà
SQLITE_OMIT_AUTOINIT


20052 
	grc
 = 
sql™e3_š™Ÿlize
();

20053 ifÐ
	grc
 )  -1;

20055 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20056 
	g´iÜLim™
 = 
mem0
.
®¬mTh»shÞd
;

20057 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20058 ifÐ
	gn
<0 )  
	g´iÜLim™
;

20059 ifÐ
	gn
>0 ){

20060 
sql™e3MemÜyAÏrm
(
soáH—pLim™EnfÜûr
, 0, 
n
);

20062 
sql™e3MemÜyAÏrm
(0, 0, 0);

20064 
	gexûss
 = 
sql™e3_memÜy_u£d
(è- 
n
;

20065 ifÐ
	gexûss
>0 ) 
sql™e3_»Ëa£_memÜy
(()(
exûss
 & 0x7fffffff));

20066  
	g´iÜLim™
;

20068 
SQLITE_API
 
sql™e3_soá_h—p_lim™
(
n
){

20069 ifÐ
	gn
<0 )‚ = 0;

20070 
sql™e3_soá_h—p_lim™64
(
n
);

20076 
SQLITE_PRIVATE
 
sql™e3M®locIn™
(){

20077 ifÐ
	gsql™e3Glob®CÚfig
.
	gm
.
	gxM®loc
==0 ){

20078 
sql™e3MemS‘DeçuÉ
();

20080 
mem£t
(&
mem0
, 0, (mem0));

20081 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 ){

20082 
	gmem0
.
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MEM
);

20084 ifÐ
	gsql™e3Glob®CÚfig
.
	gpSü©ch
 && sql™e3Glob®CÚfig.
	gszSü©ch
>=100

20085 && 
sql™e3Glob®CÚfig
.
nSü©ch
>0 ){

20086 
i
, 
n
, 
sz
;

20087 
Sü©chF»e¦Ù
 *
	gpSlÙ
;

20088 
	gsz
 = 
ROUNDDOWN8
(
sql™e3Glob®CÚfig
.
szSü©ch
);

20089 
	gsql™e3Glob®CÚfig
.
	gszSü©ch
 = 
sz
;

20090 
	gpSlÙ
 = (
Sü©chF»e¦Ù
*)
sql™e3Glob®CÚfig
.
pSü©ch
;

20091 
	gn
 = 
sql™e3Glob®CÚfig
.
nSü©ch
;

20092 
	gmem0
.
	gpSü©chF»e
 = 
pSlÙ
;

20093 
	gmem0
.
	gnSü©chF»e
 = 
n
;

20094 
	gi
=0; i<
	gn
-1; i++){

20095 
	gpSlÙ
->
	gpNext
 = (
Sü©chF»e¦Ù
*)(
sz
+(*)
pSlÙ
);

20096 
	gpSlÙ
 = 
pSlÙ
->
pNext
;

20098 
	gpSlÙ
->
	gpNext
 = 0;

20099 
	gmem0
.
	gpSü©chEnd
 = (*)&
pSlÙ
[1];

20101 
	gmem0
.
	gpSü©chEnd
 = 0;

20102 
	gsql™e3Glob®CÚfig
.
	gpSü©ch
 = 0;

20103 
	gsql™e3Glob®CÚfig
.
	gszSü©ch
 = 0;

20104 
	gsql™e3Glob®CÚfig
.
	gnSü©ch
 = 0;

20106 ifÐ
	gsql™e3Glob®CÚfig
.
	gpPage
==0 || 
sql™e3Glob®CÚfig
.
szPage
<512

20107 || 
sql™e3Glob®CÚfig
.
nPage
<1 ){

20108 
sql™e3Glob®CÚfig
.
pPage
 = 0;

20109 
	gsql™e3Glob®CÚfig
.
	gszPage
 = 0;

20110 
	gsql™e3Glob®CÚfig
.
	gnPage
 = 0;

20112  
	gsql™e3Glob®CÚfig
.
	gm
.
xIn™
(
sql™e3Glob®CÚfig
.
m
.
pAµD©a
);

20120 
SQLITE_PRIVATE
 
sql™e3H—pN—¾yFuÎ
(){

20121  
	gmem0
.
	gÃ¬lyFuÎ
;

20127 
SQLITE_PRIVATE
 
sql™e3M®locEnd
(){

20128 ifÐ
	gsql™e3Glob®CÚfig
.
	gm
.
	gxShutdown
 ){

20129 
	gsql™e3Glob®CÚfig
.
	gm
.
xShutdown
(
sql™e3Glob®CÚfig
.
m
.
pAµD©a
);

20131 
mem£t
(&
mem0
, 0, (mem0));

20137 
SQLITE_API
 
sql™e3_št64
 
sql™e3_memÜy_u£d
(){

20138 
	gn
, 
	gmx
;

20139 
sql™e3_št64
 
	g»s
;

20140 
sql™e3_¡©us
(
SQLITE_STATUS_MEMORY_USED
, &
n
, &
mx
, 0);

20141 
	g»s
 = (
sql™e3_št64
)
n
;

20142  
	g»s
;

20150 
SQLITE_API
 
sql™e3_št64
 
sql™e3_memÜy_highw©”
(
»£tFÏg
){

20151 
	gn
, 
	gmx
;

20152 
sql™e3_št64
 
	g»s
;

20153 
sql™e3_¡©us
(
SQLITE_STATUS_MEMORY_USED
, &
n
, &
mx
, 
»£tFÏg
);

20154 
	g»s
 = (
sql™e3_št64
)
mx
;

20155  
	g»s
;

20161 
sql™e3M®locAÏrm
(
nBy‹
){

20162 (*
	gxC®lback
)(*,
	gsql™e3_št64
,);

20163 
sql™e3_št64
 
	gnowU£d
;

20164 *
	gpArg
;

20165 ifÐ
	gmem0
.
	g®¬mC®lback
==0 ) ;

20166 
	gxC®lback
 = 
mem0
.
®¬mC®lback
;

20167 
	gnowU£d
 = 
sql™e3StusV®ue
(
SQLITE_STATUS_MEMORY_USED
);

20168 
	gpArg
 = 
mem0
.
®¬mArg
;

20169 
	gmem0
.
	g®¬mC®lback
 = 0;

20170 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20171 
xC®lback
(
pArg
, 
nowU£d
, 
nBy‹
);

20172 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20173 
	gmem0
.
	g®¬mC®lback
 = 
xC®lback
;

20174 
	gmem0
.
	g®¬mArg
 = 
pArg
;

20181 
m®locW™hAÏrm
(
n
, **
µ
){

20182 
	gnFuÎ
;

20183 *
	gp
;

20184 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mem0
.
mu‹x
) );

20185 
	gnFuÎ
 = 
sql™e3Glob®CÚfig
.
m
.
xRoundup
(
n
);

20186 
sql™e3StusS‘
(
SQLITE_STATUS_MALLOC_SIZE
, 
n
);

20187 ifÐ
	gmem0
.
	g®¬mC®lback
!=0 ){

20188 
nU£d
 = 
sql™e3StusV®ue
(
SQLITE_STATUS_MEMORY_USED
);

20189 ifÐ
	gnU£d
 >ð
mem0
.
®¬mTh»shÞd
 - 
nFuÎ
 ){

20190 
mem0
.
Ã¬lyFuÎ
 = 1;

20191 
sql™e3M®locAÏrm
(
nFuÎ
);

20193 
	gmem0
.
	gÃ¬lyFuÎ
 = 0;

20196 
	gp
 = 
sql™e3Glob®CÚfig
.
m
.
xM®loc
(
nFuÎ
);

20197 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


20198 ifÐ
	gp
==0 && 
mem0
.
®¬mC®lback
 ){

20199 
sql™e3M®locAÏrm
(
nFuÎ
);

20200 
	gp
 = 
sql™e3Glob®CÚfig
.
m
.
xM®loc
(
nFuÎ
);

20203 ifÐ
	gp
 ){

20204 
	gnFuÎ
 = 
sql™e3M®locSize
(
p
);

20205 
sql™e3StusAdd
(
SQLITE_STATUS_MEMORY_USED
, 
nFuÎ
);

20206 
sql™e3StusAdd
(
SQLITE_STATUS_MALLOC_COUNT
, 1);

20208 *
	gµ
 = 
p
;

20209  
	gnFuÎ
;

20216 
SQLITE_PRIVATE
 *
sql™e3M®loc
(
u64
 
n
){

20217 *
	gp
;

20218 ifÐ
	gn
==0 || 
n
>=0x7fffff00 ){

20224 
p
 = 0;

20225 }ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 ){

20226 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20227 
m®locW™hAÏrm
(()
n
, &
p
);

20228 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20230 
	gp
 = 
sql™e3Glob®CÚfig
.
m
.
xM®loc
(()
n
);

20232 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
p
) );

20233  
	gp
;

20241 
SQLITE_API
 *
sql™e3_m®loc
(
n
){

20242 #iâdeà
SQLITE_OMIT_AUTOINIT


20243 ifÐ
sql™e3_š™Ÿlize
() )  0;

20245  
	gn
<=0 ? 0 : 
sql™e3M®loc
(
n
);

20247 
SQLITE_API
 *
sql™e3_m®loc64
(
sql™e3_ušt64
 
n
){

20248 #iâdeà
SQLITE_OMIT_AUTOINIT


20249 ifÐ
sql™e3_š™Ÿlize
() )  0;

20251  
sql™e3M®loc
(
n
);

20260 #ià
SQLITE_THREADSAFE
==0 && !
defšed
(
NDEBUG
)

20261 
	gsü©chAÎocOut
 = 0;

20273 
SQLITE_PRIVATE
 *
sql™e3Sü©chM®loc
(
n
){

20274 *
	gp
;

20275 
as£¹
Ð
n
>0 );

20277 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20278 
sql™e3StusS‘
(
SQLITE_STATUS_SCRATCH_SIZE
, 
n
);

20279 ifÐ
	gmem0
.
	gnSü©chF»e
 && 
	gsql™e3Glob®CÚfig
.
	gszSü©ch
>=
n
 ){

20280 
p
 = 
mem0
.
pSü©chF»e
;

20281 
	gmem0
.
	gpSü©chF»e
 = 
mem0
.
pSü©chF»e
->
pNext
;

20282 
	gmem0
.
	gnSü©chF»e
--;

20283 
sql™e3StusAdd
(
SQLITE_STATUS_SCRATCH_USED
, 1);

20284 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20286 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20287 
	gp
 = 
sql™e3M®loc
(
n
);

20288 ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 && 
	gp
 ){

20289 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20290 
sql™e3StusAdd
(
SQLITE_STATUS_SCRATCH_OVERFLOW
, 
sql™e3M®locSize
(
p
));

20291 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20293 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_SCRATCH
);

20295 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
mem0
.
mu‹x
) );

20298 #ià
SQLITE_THREADSAFE
==0 && !
defšed
(
NDEBUG
)

20303 
as£¹
Ð
sü©chAÎocOut
<=1 );

20304 ifÐ
	gp
 ) 
	gsü©chAÎocOut
++;

20307  
	gp
;

20309 
SQLITE_PRIVATE
 
sql™e3Sü©chF»e
(*
p
){

20310 ifÐ
	gp
 ){

20312 #ià
SQLITE_THREADSAFE
==0 && !
defšed
(
NDEBUG
)

20317 
as£¹
Ð
sü©chAÎocOut
>=1 && scratchAllocOut<=2 );

20318 
	gsü©chAÎocOut
--;

20321 ifÐ
	gp
>=
sql™e3Glob®CÚfig
.
pSü©ch
 && 
p
<
mem0
.
pSü©chEnd
 ){

20323 
Sü©chF»e¦Ù
 *
pSlÙ
;

20324 
	gpSlÙ
 = (
Sü©chF»e¦Ù
*)
p
;

20325 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20326 
	gpSlÙ
->
	gpNext
 = 
mem0
.
pSü©chF»e
;

20327 
	gmem0
.
	gpSü©chF»e
 = 
pSlÙ
;

20328 
	gmem0
.
	gnSü©chF»e
++;

20329 
as£¹
Ð
mem0
.
nSü©chF»e
 <ð(
u32
)
sql™e3Glob®CÚfig
.
nSü©ch
 );

20330 
sql™e3StusAdd
(
SQLITE_STATUS_SCRATCH_USED
, -1);

20331 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20334 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_SCRATCH
) );

20335 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~
MEMTYPE_SCRATCH
) );

20336 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_HEAP
);

20337 ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 ){

20338 
	giSize
 = 
sql™e3M®locSize
(
p
);

20339 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20340 
sql™e3StusAdd
(
SQLITE_STATUS_SCRATCH_OVERFLOW
, -
iSize
);

20341 
sql™e3StusAdd
(
SQLITE_STATUS_MEMORY_USED
, -
iSize
);

20342 
sql™e3StusAdd
(
SQLITE_STATUS_MALLOC_COUNT
, -1);

20343 
	gsql™e3Glob®CÚfig
.
	gm
.
xF»e
(
p
);

20344 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20346 
	gsql™e3Glob®CÚfig
.
	gm
.
xF»e
(
p
);

20355 #iâdeà
SQLITE_OMIT_LOOKASIDE


20356 
isLookaside
(
sql™e3
 *
db
, *
p
){

20357  
	gp
>=
db
->
lookaside
.
pS¹
 && 
p
<db->lookaside.
pEnd
;

20360 
	#isLookaside
(
A
,
B
è0

	)

20367 
SQLITE_PRIVATE
 
sql™e3M®locSize
(*
p
){

20368 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_HEAP
) );

20369  
	gsql™e3Glob®CÚfig
.
	gm
.
xSize
(
p
);

20371 
SQLITE_PRIVATE
 
sql™e3DbM®locSize
(
sql™e3
 *
db
, *
p
){

20372 ifÐ
	gdb
==0 ){

20373 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~
MEMTYPE_HEAP
) );

20374 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_HEAP
) );

20375  
sql™e3M®locSize
(
p
);

20377 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

20378 ifÐ
isLookaside
(
db
, 
p
) ){

20379  
	gdb
->
	glookaside
.
	gsz
;

20381 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, (
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20382 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~(
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20383  
	gsql™e3Glob®CÚfig
.
	gm
.
xSize
(
p
);

20387 
SQLITE_API
 
sql™e3_ušt64
 
sql™e3_msize
(*
p
){

20388 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~
MEMTYPE_HEAP
) );

20389 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_HEAP
) );

20390  (
	gsql™e3_ušt64
)
	gsql™e3Glob®CÚfig
.
	gm
.
xSize
(
p
);

20396 
SQLITE_API
 
sql™e3_ä“
(*
p
){

20397 ifÐ
	gp
==0 ) ;

20398 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_HEAP
) );

20399 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~
MEMTYPE_HEAP
) );

20400 ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 ){

20401 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20402 
sql™e3StusAdd
(
SQLITE_STATUS_MEMORY_USED
, -
sql™e3M®locSize
(
p
));

20403 
sql™e3StusAdd
(
SQLITE_STATUS_MALLOC_COUNT
, -1);

20404 
	gsql™e3Glob®CÚfig
.
	gm
.
xF»e
(
p
);

20405 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20407 
	gsql™e3Glob®CÚfig
.
	gm
.
xF»e
(
p
);

20415 
SQLITE_NOINLINE
 
m—su»AÎoÿtiÚSize
(
sql™e3
 *
db
, *
p
){

20416 *
	gdb
->
	g²By‹sF»ed
 +ð
sql™e3DbM®locSize
(
db
,
p
);

20423 
SQLITE_PRIVATE
 
sql™e3DbF»e
(
sql™e3
 *
db
, *
p
){

20424 
as£¹
Ð
db
==0 || 
sql™e3_mu‹x_h–d
(db->
mu‹x
) );

20425 ifÐ
	gp
==0 ) ;

20426 ifÐ
	gdb
 ){

20427 ifÐ
	gdb
->
	g²By‹sF»ed
 ){

20428 
m—su»AÎoÿtiÚSize
(
db
, 
p
);

20431 ifÐ
isLookaside
(
db
, 
p
) ){

20432 
LookasideSlÙ
 *
	gpBuf
 = (LookasideSlÙ*)
p
;

20433 #ià
SQLITE_DEBUG


20435 
mem£t
(
p
, 0x¯, 
db
->
lookaside
.
sz
);

20437 
	gpBuf
->
	gpNext
 = 
db
->
lookaside
.
pF»e
;

20438 
	gdb
->
	glookaside
.
	gpF»e
 = 
pBuf
;

20439 
	gdb
->
	glookaside
.
	gnOut
--;

20443 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, (
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20444 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~(
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20445 
as£¹
Ð
db
!=0 || 
sql™e3MemdebugNoTy³
(
p
, 
MEMTYPE_LOOKASIDE
) );

20446 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_HEAP
);

20447 
sql™e3_ä“
(
p
);

20453 
SQLITE_PRIVATE
 *
sql™e3R—Îoc
(*
pOld
, 
u64
 
nBy‹s
){

20454 
	gnOld
, 
	gnNew
, 
	gnDiff
;

20455 *
	gpNew
;

20456 
as£¹
Ð
sql™e3MemdebugHasTy³
(
pOld
, 
MEMTYPE_HEAP
) );

20457 
as£¹
Ð
sql™e3MemdebugNoTy³
(
pOld
, ~
MEMTYPE_HEAP
) );

20458 ifÐ
	gpOld
==0 ){

20459  
sql™e3M®loc
(
nBy‹s
);

20461 ifÐ
	gnBy‹s
==0 ){

20462 
sql™e3_ä“
(
pOld
);

20465 ifÐ
	gnBy‹s
>=0x7fffff00 ){

20469 
	gnOld
 = 
sql™e3M®locSize
(
pOld
);

20473 
	gnNew
 = 
sql™e3Glob®CÚfig
.
m
.
xRoundup
(()
nBy‹s
);

20474 ifÐ
	gnOld
==
nNew
 ){

20475 
pNew
 = 
pOld
;

20476 }ifÐ
	gsql™e3Glob®CÚfig
.
	gbMem¡©
 ){

20477 
sql™e3_mu‹x_’‹r
(
mem0
.
mu‹x
);

20478 
sql™e3StusS‘
(
SQLITE_STATUS_MALLOC_SIZE
, ()
nBy‹s
);

20479 
	gnDiff
 = 
nNew
 - 
nOld
;

20480 ifÐ
sql™e3StusV®ue
(
SQLITE_STATUS_MEMORY_USED
) >=

20481 
mem0
.
®¬mTh»shÞd
-
nDiff
 ){

20482 
sql™e3M®locAÏrm
(
nDiff
);

20484 
	gpNew
 = 
sql™e3Glob®CÚfig
.
m
.
xR—Îoc
(
pOld
, 
nNew
);

20485 ifÐ
	gpNew
==0 && 
mem0
.
®¬mC®lback
 ){

20486 
sql™e3M®locAÏrm
(()
nBy‹s
);

20487 
	gpNew
 = 
sql™e3Glob®CÚfig
.
m
.
xR—Îoc
(
pOld
, 
nNew
);

20489 ifÐ
	gpNew
 ){

20490 
	gnNew
 = 
sql™e3M®locSize
(
pNew
);

20491 
sql™e3StusAdd
(
SQLITE_STATUS_MEMORY_USED
, 
nNew
-
nOld
);

20493 
sql™e3_mu‹x_Ëave
(
mem0
.
mu‹x
);

20495 
	gpNew
 = 
sql™e3Glob®CÚfig
.
m
.
xR—Îoc
(
pOld
, 
nNew
);

20497 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pNew
) );

20498  
	gpNew
;

20505 
SQLITE_API
 *
sql™e3_»®loc
(*
pOld
, 
n
){

20506 #iâdeà
SQLITE_OMIT_AUTOINIT


20507 ifÐ
sql™e3_š™Ÿlize
() )  0;

20509 ifÐ
	gn
<0 )‚ = 0;

20510  
sql™e3R—Îoc
(
pOld
, 
n
);

20512 
SQLITE_API
 *
sql™e3_»®loc64
(*
pOld
, 
sql™e3_ušt64
 
n
){

20513 #iâdeà
SQLITE_OMIT_AUTOINIT


20514 ifÐ
sql™e3_š™Ÿlize
() )  0;

20516  
sql™e3R—Îoc
(
pOld
, 
n
);

20523 
SQLITE_PRIVATE
 *
sql™e3M®locZ”o
(
u64
 
n
){

20524 *
	gp
 = 
sql™e3M®loc
(
n
);

20525 ifÐ
	gp
 ){

20526 
mem£t
(
p
, 0, (
size_t
)
n
);

20528  
	gp
;

20535 
SQLITE_PRIVATE
 *
sql™e3DbM®locZ”o
(
sql™e3
 *
db
, 
u64
 
n
){

20536 *
	gp
 = 
sql™e3DbM®locRaw
(
db
, 
n
);

20537 ifÐ
	gp
 ){

20538 
mem£t
(
p
, 0, (
size_t
)
n
);

20540  
	gp
;

20561 
SQLITE_PRIVATE
 *
sql™e3DbM®locRaw
(
sql™e3
 *
db
, 
u64
 
n
){

20562 *
	gp
;

20563 
as£¹
Ð
db
==0 || 
sql™e3_mu‹x_h–d
(db->
mu‹x
) );

20564 
as£¹
Ð
db
==0 || db->
²By‹sF»ed
==0 );

20565 #iâdeà
SQLITE_OMIT_LOOKASIDE


20566 ifÐ
	gdb
 ){

20567 
LookasideSlÙ
 *
	gpBuf
;

20568 ifÐ
	gdb
->
	gm®locFažed
 ){

20571 ifÐ
	gdb
->
	glookaside
.
	gbEÇbËd
 ){

20572 ifÐ
	gn
>
	gdb
->
	glookaside
.
	gsz
 ){

20573 
	gdb
->
	glookaside
.
	gªSt
[1]++;

20574 }ifÐ(
	gpBuf
 = 
db
->
lookaside
.
pF»e
)==0 ){

20575 
db
->
lookaside
.
ªSt
[2]++;

20577 
	gdb
->
	glookaside
.
	gpF»e
 = 
pBuf
->
pNext
;

20578 
	gdb
->
	glookaside
.
	gnOut
++;

20579 
	gdb
->
	glookaside
.
	gªSt
[0]++;

20580 ifÐ
	gdb
->
	glookaside
.
	gnOut
>db->lookaside.
	gmxOut
 ){

20581 
	gdb
->
	glookaside
.
	gmxOut
 = 
db
->
lookaside
.
nOut
;

20583  (*)
	gpBuf
;

20588 ifÐ
	gdb
 && db->
	gm®locFažed
 ){

20592 
	gp
 = 
sql™e3M®loc
(
n
);

20593 ifÐ!
	gp
 && 
	gdb
 ){

20594 
	gdb
->
	gm®locFažed
 = 1;

20596 
sql™e3MemdebugS‘Ty³
(
p
,

20597 (
db
 && db->
lookaside
.
bEÇbËd
è? 
MEMTYPE_LOOKASIDE
 : 
MEMTYPE_HEAP
);

20598  
	gp
;

20605 
SQLITE_PRIVATE
 *
sql™e3DbR—Îoc
(
sql™e3
 *
db
, *
p
, 
u64
 
n
){

20606 *
	gpNew
 = 0;

20607 
as£¹
Ð
db
!=0 );

20608 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

20609 ifÐ
	gdb
->
	gm®locFažed
==0 ){

20610 ifÐ
p
==0 ){

20611  
sql™e3DbM®locRaw
(
db
, 
n
);

20613 ifÐ
isLookaside
(
db
, 
p
) ){

20614 ifÐ
	gn
<=
db
->
lookaside
.
sz
 ){

20615  
p
;

20617 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, 
n
);

20618 ifÐ
	gpNew
 ){

20619 
memýy
(
pNew
, 
p
, 
db
->
lookaside
.
sz
);

20620 
sql™e3DbF»e
(
db
, 
p
);

20623 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, (
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20624 
as£¹
Ð
sql™e3MemdebugNoTy³
(
p
, ~(
MEMTYPE_LOOKASIDE
|
MEMTYPE_HEAP
)) );

20625 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_HEAP
);

20626 
	gpNew
 = 
sql™e3_»®loc64
(
p
, 
n
);

20627 ifÐ!
	gpNew
 ){

20628 
	gdb
->
	gm®locFažed
 = 1;

20630 
sql™e3MemdebugS‘Ty³
(
pNew
,

20631 (
db
->
lookaside
.
bEÇbËd
 ? 
MEMTYPE_LOOKASIDE
 : 
MEMTYPE_HEAP
));

20634  
	gpNew
;

20641 
SQLITE_PRIVATE
 *
sql™e3DbR—ÎocOrF»e
(
sql™e3
 *
db
, *
p
, 
u64
 
n
){

20642 *
	gpNew
;

20643 
	gpNew
 = 
sql™e3DbR—Îoc
(
db
, 
p
, 
n
);

20644 ifÐ!
	gpNew
 ){

20645 
sql™e3DbF»e
(
db
, 
p
);

20647  
	gpNew
;

20657 
SQLITE_PRIVATE
 *
sql™e3DbSŒDup
(
sql™e3
 *
db
, cÚ¡ *
z
){

20658 *
	gzNew
;

20659 
size_t
 
	gn
;

20660 ifÐ
	gz
==0 ){

20663 
	gn
 = 
sql™e3SŒËn30
(
z
) + 1;

20664 
as£¹
Ð(
n
&0x7fffffff)==n );

20665 
	gzNew
 = 
sql™e3DbM®locRaw
(
db
, ()
n
);

20666 ifÐ
	gzNew
 ){

20667 
memýy
(
zNew
, 
z
, 
n
);

20669  
	gzNew
;

20671 
SQLITE_PRIVATE
 *
sql™e3DbSŒNDup
(
sql™e3
 *
db
, cÚ¡ *
z
, 
u64
 
n
){

20672 *
	gzNew
;

20673 ifÐ
	gz
==0 ){

20676 
as£¹
Ð(
n
&0x7fffffff)==n );

20677 
	gzNew
 = 
sql™e3DbM®locRaw
(
db
, 
n
+1);

20678 ifÐ
	gzNew
 ){

20679 
memýy
(
zNew
, 
z
, (
size_t
)
n
);

20680 
	gzNew
[
n
] = 0;

20682  
	gzNew
;

20690 
SQLITE_PRIVATE
 
sql™e3S‘SŒšg
(**
pz
, 
sql™e3
 *
db
, cÚ¡ *
zFÜm©
, ...){

20691 
va_li¡
 
	g­
;

20692 *
	gz
;

20694 
va_¡¬t
(
­
, 
zFÜm©
);

20695 
	gz
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

20696 
va_’d
(
­
);

20697 
sql™e3DbF»e
(
db
, *
pz
);

20698 *
	gpz
 = 
z
;

20704 
SQLITE_NOINLINE
 
­iOomE¼Ü
(
sql™e3
 *
db
){

20705 
	gdb
->
	gm®locFažed
 = 0;

20706 
sql™e3E¼Ü
(
db
, 
SQLITE_NOMEM
);

20707  
	gSQLITE_NOMEM
;

20723 
SQLITE_PRIVATE
 
sql™e3ApiEx™
(
sql™e3
* 
db
, 
rc
){

20728 
as£¹
Ð!
db
 || 
sql™e3_mu‹x_h–d
(db->
mu‹x
) );

20729 ifÐ
	gdb
==0 )  
rc
 & 0xff;

20730 ifÐ
	gdb
->
	gm®locFažed
 || 
	grc
==
SQLITE_IOERR_NOMEM
 ){

20731  
­iOomE¼Ü
(
db
);

20733  
	grc
 & 
	gdb
->
	g”rMask
;

20759 #ià!
defšed
(
HAVE_STRCHRNUL
)

20760 
	#HAVE_STRCHRNUL
 0

	)

20768 
	#‘RADIX
 1

	)

20769 
	#‘FLOAT
 2

	)

20770 
	#‘EXP
 3

	)

20771 
	#‘GENERIC
 4

	)

20772 
	#‘SIZE
 5

	)

20773 
	#‘STRING
 6

	)

20774 
	#‘DYNSTRING
 7

	)

20775 
	#‘PERCENT
 8

	)

20776 
	#‘CHARX
 9

	)

20778 
	#‘SQLESCAPE
 10

	)

20779 
	#‘SQLESCAPE2
 11

	)

20781 
	#‘TOKEN
 12

	)

20782 
	#‘SRCLIST
 13

	)

20783 
	#‘POINTER
 14

	)

20784 
	#‘SQLESCAPE3
 15

	)

20785 
	#‘ORDINAL
 16

	)

20787 
	#‘INVALID
 0

	)

20793 
	t‘By‹
;

20799 
	s‘_šfo
 {

20800 
	gfm‰y³
;

20801 
‘By‹
 
	gba£
;

20802 
‘By‹
 
	gæags
;

20803 
‘By‹
 
	gty³
;

20804 
‘By‹
 
	gch¬£t
;

20805 
‘By‹
 
	g´efix
;

20806 } 
	t‘_šfo
;

20811 
	#FLAG_SIGNED
 1

	)

20812 
	#FLAG_INTERN
 2

	)

20813 
	#FLAG_STRING
 4

	)

20820 cÚ¡ 
	gaDig™s
[] = "0123456789ABCDEF0123456789abcdef";

20821 cÚ¡ 
	gaP»fix
[] = "-x0\000X0";

20822 cÚ¡ 
‘_šfo
 
	gfmtšfo
[] = {

20823 { 'd', 10, 1, 
‘RADIX
, 0, 0 },

20824 { 's', 0, 4, 
‘STRING
, 0, 0 },

20825 { 'g', 0, 1, 
‘GENERIC
, 30, 0 },

20826 { 'z', 0, 4, 
‘DYNSTRING
, 0, 0 },

20827 { 'q', 0, 4, 
‘SQLESCAPE
, 0, 0 },

20828 { 'Q', 0, 4, 
‘SQLESCAPE2
, 0, 0 },

20829 { 'w', 0, 4, 
‘SQLESCAPE3
, 0, 0 },

20830 { 'c', 0, 0, 
‘CHARX
, 0, 0 },

20831 { 'o', 8, 0, 
‘RADIX
, 0, 2 },

20832 { 'u', 10, 0, 
‘RADIX
, 0, 0 },

20833 { 'x', 16, 0, 
‘RADIX
, 16, 1 },

20834 { 'X', 16, 0, 
‘RADIX
, 0, 4 },

20835 #iâdeà
SQLITE_OMIT_FLOATING_POINT


20836 { 'f', 0, 1, 
‘FLOAT
, 0, 0 },

20837 { 'e', 0, 1, 
‘EXP
, 30, 0 },

20838 { 'E', 0, 1, 
‘EXP
, 14, 0 },

20839 { 'G', 0, 1, 
‘GENERIC
, 14, 0 },

20841 { 'i', 10, 1, 
‘RADIX
, 0, 0 },

20842 { 'n', 0, 0, 
‘SIZE
, 0, 0 },

20843 { '%', 0, 0, 
‘PERCENT
, 0, 0 },

20844 { 'p', 16, 0, 
‘POINTER
, 0, 1 },

20848 { 'T', 0, 2, 
‘TOKEN
, 0, 0 },

20849 { 'S', 0, 2, 
‘SRCLIST
, 0, 0 },

20850 { 'r', 10, 3, 
‘ORDINAL
, 0, 0 },

20857 #iâdeà
SQLITE_OMIT_FLOATING_POINT


20871 
‘_g‘dig™
(
LONGDOUBLE_TYPE
 *
v®
, *
út
){

20872 
	gdig™
;

20873 
LONGDOUBLE_TYPE
 
	gd
;

20874 ifÐ(*
	gút
)<=0 )  '0';

20875 (*
	gút
)--;

20876 
	gdig™
 = ()*
v®
;

20877 
	gd
 = 
dig™
;

20878 
	gdig™
 += '0';

20879 *
	gv®
 = (*
v®
 - 
d
)*10.0;

20880  ()
	gdig™
;

20887 
£tSŒAccumE¼Ü
(
SŒAccum
 *
p
, 
u8
 
eE¼Ü
){

20888 
	gp
->
	gaccE¼Ü
 = 
eE¼Ü
;

20889 
	gp
->
	gnAÎoc
 = 0;

20895 
sql™e3_št64
 
g‘IÁArg
(
PrštfArgum’ts
 *
p
){

20896 ifÐ
	gp
->
	gnArg
<=
p
->
nU£d
 )  0;

20897  
sql™e3_v®ue_št64
(
p
->
­Arg
[p->
nU£d
++]);

20899 
g‘DoubËArg
(
PrštfArgum’ts
 *
p
){

20900 ifÐ
	gp
->
	gnArg
<=
p
->
nU£d
 )  0.0;

20901  
sql™e3_v®ue_doubË
(
p
->
­Arg
[p->
nU£d
++]);

20903 *
g‘TextArg
(
PrštfArgum’ts
 *
p
){

20904 ifÐ
	gp
->
	gnArg
<=
p
->
nU£d
 )  0;

20905  (*)
sql™e3_v®ue_‹xt
(
p
->
­Arg
[p->
nU£d
++]);

20913 #iâdeà
SQLITE_PRINT_BUF_SIZE


20914 
	#SQLITE_PRINT_BUF_SIZE
 70

	)

20916 
	#‘BUFSIZE
 
SQLITE_PRINT_BUF_SIZE


	)

20921 
SQLITE_PRIVATE
 
sql™e3VXPrštf
(

20922 
SŒAccum
 *
pAccum
,

20923 
u32
 
bFÏgs
,

20924 cÚ¡ *
fmt
,

20925 
va_li¡
 
­


20927 
	gc
;

20928 *
	gbuåt
;

20929 
	g´ecisiÚ
;

20930 
	gËngth
;

20931 
	gidx
;

20932 
	gwidth
;

20933 
‘By‹
 
	gæag_Ëáju¡ify
;

20934 
‘By‹
 
	gæag_¶ussign
;

20935 
‘By‹
 
	gæag_bÏnksign
;

20936 
‘By‹
 
	gæag_®‹º©efÜm
;

20937 
‘By‹
 
	gæag_®tfÜm2
;

20938 
‘By‹
 
	gæag_z”Ýad
;

20939 
‘By‹
 
	gæag_lÚg
;

20940 
‘By‹
 
	gæag_lÚglÚg
;

20941 
‘By‹
 
	gdÚe
;

20942 
‘By‹
 
	gxty³
 = 0;

20943 
u8
 
	gbArgLi¡
;

20944 
u8
 
	gu£IÁ”n
;

20945 
	g´efix
;

20946 
sql™e_ušt64
 
	glÚgv®ue
;

20947 
LONGDOUBLE_TYPE
 
	g»®v®ue
;

20948 cÚ¡ 
‘_šfo
 *
	gšfÝ
;

20949 *
	gzOut
;

20950 
	gnOut
;

20951 *
	gzExŒa
 = 0;

20952 #iâdeà
SQLITE_OMIT_FLOATING_POINT


20953 
	gexp
, 
	ge2
;

20954 
	gnsd
;

20955 
	ground”
;

20956 
‘By‹
 
	gæag_dp
;

20957 
‘By‹
 
	gæag_¹z
;

20959 
PrštfArgum’ts
 *
	gpArgLi¡
 = 0;

20960 
	gbuf
[
‘BUFSIZE
];

20962 
	gbuåt
 = 0;

20963 ifÐ
	gbFÏgs
 ){

20964 ifÐ(
	gbArgLi¡
 = (
bFÏgs
 & 
SQLITE_PRINTF_SQLFUNC
))!=0 ){

20965 
pArgLi¡
 = 
va_¬g
(
­
, 
PrštfArgum’ts
*);

20967 
	gu£IÁ”n
 = 
bFÏgs
 & 
SQLITE_PRINTF_INTERNAL
;

20969 
	gbArgLi¡
 = 
u£IÁ”n
 = 0;

20971 ; (
	gc
=(*
fmt
))!=0; ++
	gfmt
){

20972 ifÐ
	gc
!='%' ){

20973 
buåt
 = (*)
fmt
;

20974 #ià
HAVE_STRCHRNUL


20975 
	gfmt
 = 
¡rchºul
(
fmt
, '%');

20977 do{ 
	gfmt
++; } *fmt && *fmt != '%' );

20979 
sql™e3SŒAccumAµ’d
(
pAccum
, 
buåt
, ()(
fmt
 - bufpt));

20980 ifÐ*
	gfmt
==0 ) ;

20982 ifÐ(
	gc
=(*++
fmt
))==0 ){

20983 
sql™e3SŒAccumAµ’d
(
pAccum
, "%", 1);

20987 
	gæag_Ëáju¡ify
 = 
æag_¶ussign
 = 
æag_bÏnksign
 =

20988 
æag_®‹º©efÜm
 = 
æag_®tfÜm2
 = 
æag_z”Ýad
 = 0;

20989 
	gdÚe
 = 0;

20991  
	gc
 ){

20992 '-': 
æag_Ëáju¡ify
 = 1; ;

20993 '+': 
æag_¶ussign
 = 1; ;

20994 ' ': 
æag_bÏnksign
 = 1; ;

20995 '#': 
æag_®‹º©efÜm
 = 1; ;

20996 '!': 
æag_®tfÜm2
 = 1; ;

20997 '0': 
æag_z”Ýad
 = 1; ;

20998 : 
dÚe
 = 1; ;

21000 } !
	gdÚe
 && (
	gc
=(*++
fmt
))!=0 );

21002 
	gwidth
 = 0;

21003 ifÐ
	gc
=='*' ){

21004 ifÐ
bArgLi¡
 ){

21005 
width
 = ()
g‘IÁArg
(
pArgLi¡
);

21007 
	gwidth
 = 
va_¬g
(
­
,);

21009 ifÐ
	gwidth
<0 ){

21010 
	gæag_Ëáju¡ify
 = 1;

21011 
	gwidth
 = -
width
;

21013 
	gc
 = *++
fmt
;

21015  
	gc
>='0' && 
c
<='9' ){

21016 
width
 = width*10 + 
c
 - '0';

21017 
	gc
 = *++
fmt
;

21021 ifÐ
	gc
=='.' ){

21022 
´ecisiÚ
 = 0;

21023 
	gc
 = *++
fmt
;

21024 ifÐ
	gc
=='*' ){

21025 ifÐ
bArgLi¡
 ){

21026 
´ecisiÚ
 = ()
g‘IÁArg
(
pArgLi¡
);

21028 
	g´ecisiÚ
 = 
va_¬g
(
­
,);

21030 ifÐ
	g´ecisiÚ
<0 )…»cisiÚ = -
´ecisiÚ
;

21031 
	gc
 = *++
fmt
;

21033  
	gc
>='0' && 
c
<='9' ){

21034 
´ecisiÚ
 =…»cisiÚ*10 + 
c
 - '0';

21035 
	gc
 = *++
fmt
;

21039 
	g´ecisiÚ
 = -1;

21042 ifÐ
	gc
=='l' ){

21043 
æag_lÚg
 = 1;

21044 
	gc
 = *++
fmt
;

21045 ifÐ
	gc
=='l' ){

21046 
æag_lÚglÚg
 = 1;

21047 
	gc
 = *++
fmt
;

21049 
	gæag_lÚglÚg
 = 0;

21052 
	gæag_lÚg
 = 
æag_lÚglÚg
 = 0;

21055 
	gšfÝ
 = &
fmtšfo
[0];

21056 
	gxty³
 = 
‘INVALID
;

21057 
	gidx
=0; idx<
A¼aySize
(
fmtšfo
); idx++){

21058 ifÐ
	gc
==
fmtšfo
[
idx
].
fm‰y³
 ){

21059 
šfÝ
 = &
fmtšfo
[
idx
];

21060 ifÐ
	gu£IÁ”n
 || (
	gšfÝ
->
	gæags
 & 
	gFLAG_INTERN
)==0 ){

21061 
xty³
 = 
šfÝ
->
ty³
;

21090  
	gxty³
 ){

21091 
	g‘POINTER
:

21092 
æag_lÚglÚg
 = (*)==(
i64
);

21093 
	gæag_lÚg
 = (*)==();

21095 
	g‘ORDINAL
:

21096 
‘RADIX
:

21097 ifÐ
šfÝ
->
æags
 & 
FLAG_SIGNED
 ){

21098 
i64
 
v
;

21099 ifÐ
	gbArgLi¡
 ){

21100 
	gv
 = 
g‘IÁArg
(
pArgLi¡
);

21101 }ifÐ
	gæag_lÚglÚg
 ){

21102 
	gv
 = 
va_¬g
(
­
,
i64
);

21103 }ifÐ
	gæag_lÚg
 ){

21104 
	gv
 = 
va_¬g
(
­
,);

21106 
	gv
 = 
va_¬g
(
­
,);

21108 ifÐ
	gv
<0 ){

21109 ifÐ
	gv
==
SMALLEST_INT64
 ){

21110 
lÚgv®ue
 = ((
u64
)1)<<63;

21112 
	glÚgv®ue
 = -
v
;

21114 
	g´efix
 = '-';

21116 
	glÚgv®ue
 = 
v
;

21117 ifÐ
	gæag_¶ussign
 ) 
	g´efix
 = '+';

21118 ifÐ
	gæag_bÏnksign
 ) 
	g´efix
 = ' ';

21119 
	g´efix
 = 0;

21122 ifÐ
	gbArgLi¡
 ){

21123 
	glÚgv®ue
 = (
u64
)
g‘IÁArg
(
pArgLi¡
);

21124 }ifÐ
	gæag_lÚglÚg
 ){

21125 
	glÚgv®ue
 = 
va_¬g
(
­
,
u64
);

21126 }ifÐ
	gæag_lÚg
 ){

21127 
	glÚgv®ue
 = 
va_¬g
(
­
,);

21129 
	glÚgv®ue
 = 
va_¬g
(
­
,);

21131 
	g´efix
 = 0;

21133 ifÐ
	glÚgv®ue
==0 ) 
æag_®‹º©efÜm
 = 0;

21134 ifÐ
	gæag_z”Ýad
 && 
	g´ecisiÚ
<
	gwidth
-(
	g´efix
!=0) ){

21135 
´ecisiÚ
 = 
width
-(
´efix
!=0);

21137 ifÐ
	g´ecisiÚ
<
	g‘BUFSIZE
-10 ){

21138 
	gnOut
 = 
‘BUFSIZE
;

21139 
	gzOut
 = 
buf
;

21141 
	gnOut
 = 
´ecisiÚ
 + 10;

21142 
	gzOut
 = 
zExŒa
 = 
sql™e3M®loc
Ð
nOut
 );

21143 ifÐ
	gzOut
==0 ){

21144 
£tSŒAccumE¼Ü
(
pAccum
, 
STRACCUM_NOMEM
);

21148 
	gbuåt
 = &
zOut
[
nOut
-1];

21149 ifÐ
	gxty³
==
‘ORDINAL
 ){

21150 cÚ¡ 
zOrd
[] = "thstndrd";

21151 
	gx
 = ()(
lÚgv®ue
 % 10);

21152 ifÐ
	gx
>=4 || (
lÚgv®ue
/10)%10==1 ){

21153 
x
 = 0;

21155 *(--
	gbuåt
èð
zOrd
[
x
*2+1];

21156 *(--
	gbuåt
èð
zOrd
[
x
*2];

21159 cÚ¡ *
	gc£t
 = &
aDig™s
[
šfÝ
->
ch¬£t
];

21160 
u8
 
	gba£
 = 
šfÝ
->
ba£
;

21162 *(--
	gbuåt
èð
c£t
[
lÚgv®ue
%
ba£
];

21163 
	glÚgv®ue
 = 
lÚgv®ue
/
ba£
;

21164 } 
	glÚgv®ue
>0 );

21166 
	gËngth
 = ()(&
zOut
[
nOut
-1]-
buåt
);

21167 
	gidx
=
´ecisiÚ
-
Ëngth
; idx>0; idx--){

21168 *(--
	gbuåt
) = '0';

21170 ifÐ
	g´efix
 ) *(--
	gbuåt
èð
´efix
;

21171 ifÐ
	gæag_®‹º©efÜm
 && 
	gšfÝ
->
	g´efix
 ){

21172 cÚ¡ *
	g´e
;

21173 
	gx
;

21174 
	g´e
 = &
aP»fix
[
šfÝ
->
´efix
];

21175 ; (
	gx
=(*
´e
))!=0; 
	g´e
++è*(--
	gbuåt
èð
x
;

21177 
	gËngth
 = ()(&
zOut
[
nOut
-1]-
buåt
);

21179 
	g‘FLOAT
:

21180 
‘EXP
:

21181 
‘GENERIC
:

21182 ifÐ
bArgLi¡
 ){

21183 
»®v®ue
 = 
g‘DoubËArg
(
pArgLi¡
);

21185 
	g»®v®ue
 = 
va_¬g
(
­
,);

21187 #ifdeà
SQLITE_OMIT_FLOATING_POINT


21188 
	gËngth
 = 0;

21190 ifÐ
	g´ecisiÚ
<0 )…recision = 6;

21191 ifÐ
	g»®v®ue
<0.0 ){

21192 
	g»®v®ue
 = -
»®v®ue
;

21193 
	g´efix
 = '-';

21195 ifÐ
	gæag_¶ussign
 ) 
	g´efix
 = '+';

21196 ifÐ
	gæag_bÏnksign
 ) 
	g´efix
 = ' ';

21197 
	g´efix
 = 0;

21199 ifÐ
	gxty³
==
‘GENERIC
 && 
´ecisiÚ
>0 )…recision--;

21200 
	gidx
=
´ecisiÚ
, 
	ground”
=0.5; idx>0; idx--,„ounder*=0.1){}

21201 ifÐ
xty³
==
‘FLOAT
 ) 
»®v®ue
 +ð
round”
;

21203 
	gexp
 = 0;

21204 ifÐ
sql™e3IsNaN
(()
»®v®ue
) ){

21205 
	gbuåt
 = "NaN";

21206 
	gËngth
 = 3;

21209 ifÐ
	g»®v®ue
>0.0 ){

21210 
LONGDOUBLE_TYPE
 
	gsÿË
 = 1.0;

21211  
	g»®v®ue
>=1e100*
sÿË
 && 
exp
<=350 ){ sÿË *ð1e100;
	gexp
+=100;}

21212  
	g»®v®ue
>=1e64*
sÿË
 && 
exp
<=350 ){ sÿË *ð1e64; 
	gexp
+=64; }

21213  
	g»®v®ue
>=1e8*
sÿË
 && 
exp
<=350 ){ sÿË *ð1e8; 
	gexp
+=8; }

21214  
	g»®v®ue
>=10.0*
sÿË
 && 
exp
<=350 ){ sÿË *ð10.0; 
	gexp
++; }

21215 
	g»®v®ue
 /ð
sÿË
;

21216  
	g»®v®ue
<1e-8 ){„—lv®u*ð1e8; 
	gexp
-=8; }

21217  
	g»®v®ue
<1.0 ){„—lv®u*ð10.0; 
	gexp
--; }

21218 ifÐ
	gexp
>350 ){

21219 ifÐ
	g´efix
=='-' ){

21220 
buåt
 = "-Inf";

21221 }ifÐ
	g´efix
=='+' ){

21222 
buåt
 = "+Inf";

21224 
	gbuåt
 = "Inf";

21226 
	gËngth
 = 
sql™e3SŒËn30
(
buåt
);

21230 
	gbuåt
 = 
buf
;

21235 ifÐ
	gxty³
!=
‘FLOAT
 ){

21236 
»®v®ue
 +ð
round”
;

21237 ifÐ
	g»®v®ue
>=10.0 ){ 
»®v®ue
 *ð0.1; 
	gexp
++; }

21239 ifÐ
	gxty³
==
‘GENERIC
 ){

21240 
æag_¹z
 = !
æag_®‹º©efÜm
;

21241 ifÐ
	gexp
<-4 ||ƒxp>
	g´ecisiÚ
 ){

21242 
	gxty³
 = 
‘EXP
;

21244 
	g´ecisiÚ
 = 
´ecisiÚ
 - 
exp
;

21245 
	gxty³
 = 
‘FLOAT
;

21248 
	gæag_¹z
 = 
æag_®tfÜm2
;

21250 ifÐ
	gxty³
==
‘EXP
 ){

21251 
e2
 = 0;

21253 
	ge2
 = 
exp
;

21255 ifÐ
MAX
(
e2
,0)+
	g´ecisiÚ
+
	gwidth
 > 
	g‘BUFSIZE
 - 15 ){

21256 
	gbuåt
 = 
zExŒa
 = 
sql™e3M®loc
Ð
MAX
(
e2
,0)+
´ecisiÚ
+
width
+15 );

21257 ifÐ
	gbuåt
==0 ){

21258 
£tSŒAccumE¼Ü
(
pAccum
, 
STRACCUM_NOMEM
);

21262 
	gzOut
 = 
buåt
;

21263 
	gnsd
 = 16 + 
æag_®tfÜm2
*10;

21264 
	gæag_dp
 = (
´ecisiÚ
>0 ?1:0è| 
æag_®‹º©efÜm
 | 
æag_®tfÜm2
;

21266 ifÐ
	g´efix
 ){

21267 *(
	gbuåt
++èð
´efix
;

21270 ifÐ
	ge2
<0 ){

21271 *(
	gbuåt
++) = '0';

21273 ; 
	ge2
>=0;ƒ2--){

21274 *(
	gbuåt
++èð
‘_g‘dig™
(&
»®v®ue
,&
nsd
);

21278 ifÐ
	gæag_dp
 ){

21279 *(
	gbuåt
++) = '.';

21283 
	ge2
++;ƒ2<0; 
	g´ecisiÚ
--,ƒ2++){

21284 
as£¹
Ð
´ecisiÚ
>0 );

21285 *(
	gbuåt
++) = '0';

21288  (
	g´ecisiÚ
--)>0 ){

21289 *(
	gbuåt
++èð
‘_g‘dig™
(&
»®v®ue
,&
nsd
);

21292 ifÐ
	gæag_¹z
 && 
	gæag_dp
 ){

21293  
	gbuåt
[-1]=='0' ) *(--
buåt
) = 0;

21294 
as£¹
Ð
buåt
>
zOut
 );

21295 ifÐ
	gbuåt
[-1]=='.' ){

21296 ifÐ
æag_®tfÜm2
 ){

21297 *(
buåt
++) = '0';

21299 *(--
	gbuåt
) = 0;

21304 ifÐ
	gxty³
==
‘EXP
 ){

21305 *(
buåt
++èð
aDig™s
[
šfÝ
->
ch¬£t
];

21306 ifÐ
	gexp
<0 ){

21307 *(
	gbuåt
++èð'-'; 
	gexp
 = -
exp
;

21309 *(
	gbuåt
++) = '+';

21311 ifÐ
	gexp
>=100 ){

21312 *(
buåt
++èð()((
exp
/100)+'0');

21313 
	gexp
 %= 100;

21315 *(
	gbuåt
++èð()(
exp
/10+'0');

21316 *(
	gbuåt
++èð()(
exp
%10+'0');

21318 *
	gbuåt
 = 0;

21323 
	gËngth
 = ()(
buåt
-
zOut
);

21324 
	gbuåt
 = 
zOut
;

21328 ifÐ
	gæag_z”Ýad
 && !
	gæag_Ëáju¡ify
 && 
	gËngth
 < 
	gwidth
){

21329 
	gi
;

21330 
	gnPad
 = 
width
 - 
Ëngth
;

21331 
	gi
=
width
; i>=
nPad
; i--){

21332 
	gbuåt
[
i
] = 
buåt
[i-
nPad
];

21334 
	gi
 = 
´efix
!=0;

21335  
	gnPad
-- ) 
	gbuåt
[
i
++] = '0';

21336 
	gËngth
 = 
width
;

21340 
	g‘SIZE
:

21341 ifÐ!
bArgLi¡
 ){

21342 *(
va_¬g
(
­
,*)èð
pAccum
->
nCh¬
;

21344 
	gËngth
 = 
width
 = 0;

21346 
	g‘PERCENT
:

21347 
buf
[0] = '%';

21348 
	gbuåt
 = 
buf
;

21349 
	gËngth
 = 1;

21351 
	g‘CHARX
:

21352 ifÐ
bArgLi¡
 ){

21353 
buåt
 = 
g‘TextArg
(
pArgLi¡
);

21354 
	gc
 = 
buåt
 ? bufpt[0] : 0;

21356 
	gc
 = 
va_¬g
(
­
,);

21358 ifÐ
	g´ecisiÚ
>1 ){

21359 
	gwidth
 -ð
´ecisiÚ
-1;

21360 ifÐ
	gwidth
>1 && !
	gæag_Ëáju¡ify
 ){

21361 
sql™e3Aµ’dCh¬
(
pAccum
, 
width
-1, ' ');

21362 
	gwidth
 = 0;

21364 
sql™e3Aµ’dCh¬
(
pAccum
, 
´ecisiÚ
-1, 
c
);

21366 
	gËngth
 = 1;

21367 
	gbuf
[0] = 
c
;

21368 
	gbuåt
 = 
buf
;

21370 
	g‘STRING
:

21371 
‘DYNSTRING
:

21372 ifÐ
bArgLi¡
 ){

21373 
buåt
 = 
g‘TextArg
(
pArgLi¡
);

21375 
	gbuåt
 = 
va_¬g
(
­
,*);

21377 ifÐ
	gbuåt
==0 ){

21378 
buåt
 = "";

21379 }ifÐ
	gxty³
==
‘DYNSTRING
 && !
bArgLi¡
 ){

21380 
zExŒa
 = 
buåt
;

21382 ifÐ
	g´ecisiÚ
>=0 ){

21383 
Ëngth
=0; 
	gËngth
<
	g´ecisiÚ
 && 
	gbuåt
[length];†ength++){}

21385 
	gËngth
 = 
sql™e3SŒËn30
(
buåt
);

21388 
	g‘SQLESCAPE
:

21389 
‘SQLESCAPE2
:

21390 
‘SQLESCAPE3
: {

21391 
i
, 
	gj
, 
	gk
, 
	gn
, 
	gi¢uÎ
;

21392 
	gÃedQuÙe
;

21393 
	gch
;

21394 
	gq
 = ((
xty³
==
‘SQLESCAPE3
)?'"':'\'');

21395 *
	gesÿrg
;

21397 ifÐ
	gbArgLi¡
 ){

21398 
	gesÿrg
 = 
g‘TextArg
(
pArgLi¡
);

21400 
	gesÿrg
 = 
va_¬g
(
­
,*);

21402 
	gi¢uÎ
 = 
esÿrg
==0;

21403 ifÐ
	gi¢uÎ
 ) 
	gesÿrg
 = (
xty³
==
‘SQLESCAPE2
 ? "NULL" : "(NULL)");

21404 
	gk
 = 
´ecisiÚ
;

21405 
	gi
=
n
=0; 
	gk
!=0 && (
ch
=
esÿrg
[
i
])!=0; i++, k--){

21406 ifÐ
	gch
==
q
 ) 
n
++;

21408 
	gÃedQuÙe
 = !
i¢uÎ
 && 
xty³
==
‘SQLESCAPE2
;

21409 
	gn
 +ð
i
 + 1 + 
ÃedQuÙe
*2;

21410 ifÐ
	gn
>
	g‘BUFSIZE
 ){

21411 
	gbuåt
 = 
zExŒa
 = 
sql™e3M®loc
Ð
n
 );

21412 ifÐ
	gbuåt
==0 ){

21413 
£tSŒAccumE¼Ü
(
pAccum
, 
STRACCUM_NOMEM
);

21417 
	gbuåt
 = 
buf
;

21419 
	gj
 = 0;

21420 ifÐ
	gÃedQuÙe
 ) 
	gbuåt
[
j
++] = 
q
;

21421 
	gk
 = 
i
;

21422 
	gi
=0; i<
	gk
; i++){

21423 
	gbuåt
[
j
++] = 
ch
 = 
esÿrg
[
i
];

21424 ifÐ
	gch
==
q
 ) 
buåt
[
j
++] = 
ch
;

21426 ifÐ
	gÃedQuÙe
 ) 
	gbuåt
[
j
++] = 
q
;

21427 
	gbuåt
[
j
] = 0;

21428 
	gËngth
 = 
j
;

21434 
	g‘TOKEN
: {

21435 
Tok’
 *
pTok’
 = 
va_¬g
(
­
, Token*);

21436 
as£¹
Ð
bArgLi¡
==0 );

21437 ifÐ
	gpTok’
 &&…Tok’->
	gn
 ){

21438 
sql™e3SŒAccumAµ’d
(
pAccum
, (cÚ¡ *)
pTok’
->
z
,…Tok’->
n
);

21440 
	gËngth
 = 
width
 = 0;

21443 
	g‘SRCLIST
: {

21444 
SrcLi¡
 *
pSrc
 = 
va_¬g
(
­
, SrcList*);

21445 
	gk
 = 
va_¬g
(
­
, );

21446 
SrcLi¡_™em
 *
	gpI‹m
 = &
pSrc
->
a
[
k
];

21447 
as£¹
Ð
bArgLi¡
==0 );

21448 
as£¹
Ð
k
>=0 && k<
pSrc
->
nSrc
 );

21449 ifÐ
	gpI‹m
->
	gzD©aba£
 ){

21450 
sql™e3SŒAccumAµ’dAÎ
(
pAccum
, 
pI‹m
->
zD©aba£
);

21451 
sql™e3SŒAccumAµ’d
(
pAccum
, ".", 1);

21453 
sql™e3SŒAccumAµ’dAÎ
(
pAccum
, 
pI‹m
->
zName
);

21454 
	gËngth
 = 
width
 = 0;

21458 
as£¹
Ð
xty³
==
‘INVALID
 );

21467 
	gwidth
 -ð
Ëngth
;

21468 ifÐ
	gwidth
>0 && !
	gæag_Ëáju¡ify
 ) 
sql™e3Aµ’dCh¬
(
pAccum
, 
width
, ' ');

21469 
sql™e3SŒAccumAµ’d
(
pAccum
, 
buåt
, 
Ëngth
);

21470 ifÐ
	gwidth
>0 && 
	gæag_Ëáju¡ify
 ) 
sql™e3Aµ’dCh¬
(
pAccum
, 
width
, ' ');

21472 ifÐ
	gzExŒa
 ){

21473 
sql™e3_ä“
(
zExŒa
);

21474 
	gzExŒa
 = 0;

21486 
sql™e3SŒAccumEÆ¬ge
(
SŒAccum
 *
p
, 
N
){

21487 *
	gzNew
;

21488 
as£¹
Ð
p
->
nCh¬
+
N
 >ðp->
nAÎoc
 );

21489 ifÐ
	gp
->
	gaccE¼Ü
 ){

21490 
‹¡ÿ£
(
p
->
accE¼Ü
==
STRACCUM_TOOBIG
);

21491 
‹¡ÿ£
(
p
->
accE¼Ü
==
STRACCUM_NOMEM
);

21494 ifÐ!
	gp
->
	gu£M®loc
 ){

21495 
	gN
 = 
p
->
nAÎoc
 -…->
nCh¬
 - 1;

21496 
£tSŒAccumE¼Ü
(
p
, 
STRACCUM_TOOBIG
);

21497  
	gN
;

21499 *
	gzOld
 = (
p
->
zText
=õ->
zBa£
 ? 0 :…->zText);

21500 
i64
 
	gszNew
 = 
p
->
nCh¬
;

21501 
	gszNew
 +ð
N
 + 1;

21502 ifÐ
	gszNew
 > 
	gp
->
	gmxAÎoc
 ){

21503 
sql™e3SŒAccumRe£t
(
p
);

21504 
£tSŒAccumE¼Ü
(
p
, 
STRACCUM_TOOBIG
);

21507 
	gp
->
	gnAÎoc
 = ()
szNew
;

21509 ifÐ
	gp
->
	gu£M®loc
==1 ){

21510 
zNew
 = 
sql™e3DbR—Îoc
(
p
->
db
, 
zOld
,…->
nAÎoc
);

21512 
	gzNew
 = 
sql™e3_»®loc
(
zOld
, 
p
->
nAÎoc
);

21514 ifÐ
	gzNew
 ){

21515 
as£¹
Ð
p
->
zText
!=0 ||…->
nCh¬
==0 );

21516 ifÐ
	gzOld
==0 && 
p
->
nCh¬
>0 ) 
memýy
(
zNew
,…->
zText
,…->nChar);

21517 
	gp
->
	gzText
 = 
zNew
;

21519 
sql™e3SŒAccumRe£t
(
p
);

21520 
£tSŒAccumE¼Ü
(
p
, 
STRACCUM_NOMEM
);

21524  
	gN
;

21530 
SQLITE_PRIVATE
 
sql™e3Aµ’dCh¬
(
SŒAccum
 *
p
, 
N
, 
c
){

21531 ifÐ
	gp
->
	gnCh¬
+
	gN
 >ð
p
->
nAÎoc
 && (
N
 = 
sql™e3SŒAccumEÆ¬ge
(p, N))<=0 ) ;

21532  (
	gN
--)>0 ) 
	gp
->
	gzText
[
p
->
nCh¬
++] = 
c
;

21543 
SQLITE_NOINLINE
 
’ÏrgeAndAµ’d
(
SŒAccum
 *
p
, cÚ¡ *
z
, 
N
){

21544 
	gN
 = 
sql™e3SŒAccumEÆ¬ge
(
p
, 
N
);

21545 ifÐ
	gN
>0 ){

21546 
memýy
(&
p
->
zText
[p->
nCh¬
], 
z
, 
N
);

21547 
	gp
->
	gnCh¬
 +ð
N
;

21555 
SQLITE_PRIVATE
 
sql™e3SŒAccumAµ’d
(
SŒAccum
 *
p
, cÚ¡ *
z
, 
N
){

21556 
as£¹
Ð
z
!=0 );

21557 
as£¹
Ð
p
->
zText
!=0 ||…->
nCh¬
==0 ||…->
accE¼Ü
 );

21558 
as£¹
Ð
N
>=0 );

21559 
as£¹
Ð
p
->
accE¼Ü
==0 ||…->
nAÎoc
==0 );

21560 ifÐ
	gp
->
	gnCh¬
+
	gN
 >ð
p
->
nAÎoc
 ){

21561 
’ÏrgeAndAµ’d
(
p
,
z
,
N
);

21563 
as£¹
Ð
p
->
zText
 );

21564 
	gp
->
	gnCh¬
 +ð
N
;

21565 
memýy
(&
p
->
zText
[p->
nCh¬
-
N
], 
z
, N);

21572 
SQLITE_PRIVATE
 
sql™e3SŒAccumAµ’dAÎ
(
SŒAccum
 *
p
, cÚ¡ *
z
){

21573 
sql™e3SŒAccumAµ’d
(
p
, 
z
, 
sql™e3SŒËn30
(z));

21582 
SQLITE_PRIVATE
 *
sql™e3SŒAccumFšish
(
SŒAccum
 *
p
){

21583 ifÐ
	gp
->
	gzText
 ){

21584 
	gp
->
	gzText
[
p
->
nCh¬
] = 0;

21585 ifÐ
	gp
->
	gu£M®loc
 &&…->
	gzText
==
p
->
zBa£
 ){

21586 ifÐ
p
->
u£M®loc
==1 ){

21587 
p
->
zText
 = 
sql™e3DbM®locRaw
Õ->
db
,…->
nCh¬
+1 );

21589 
	gp
->
	gzText
 = 
sql™e3_m®loc
(
p
->
nCh¬
+1);

21591 ifÐ
	gp
->
	gzText
 ){

21592 
memýy
(
p
->
zText
,…->
zBa£
,…->
nCh¬
+1);

21594 
£tSŒAccumE¼Ü
(
p
, 
STRACCUM_NOMEM
);

21598  
	gp
->
	gzText
;

21604 
SQLITE_PRIVATE
 
sql™e3SŒAccumRe£t
(
SŒAccum
 *
p
){

21605 ifÐ
	gp
->
	gzText
!=
p
->
zBa£
 ){

21606 ifÐ
p
->
u£M®loc
==1 ){

21607 
sql™e3DbF»e
(
p
->
db
,…->
zText
);

21609 
sql™e3_ä“
(
p
->
zText
);

21612 
	gp
->
	gzText
 = 0;

21618 
SQLITE_PRIVATE
 
sql™e3SŒAccumIn™
(
SŒAccum
 *
p
, *
zBa£
, 
n
, 
mx
){

21619 
	gp
->
	gzText
 = 
p
->
zBa£
 = zBase;

21620 
	gp
->
	gdb
 = 0;

21621 
	gp
->
	gnCh¬
 = 0;

21622 
	gp
->
	gnAÎoc
 = 
n
;

21623 
	gp
->
	gmxAÎoc
 = 
mx
;

21624 
	gp
->
	gu£M®loc
 = 1;

21625 
	gp
->
	gaccE¼Ü
 = 0;

21632 
SQLITE_PRIVATE
 *
sql™e3VMPrštf
(
sql™e3
 *
db
, cÚ¡ *
zFÜm©
, 
va_li¡
 
­
){

21633 *
	gz
;

21634 
	gzBa£
[
SQLITE_PRINT_BUF_SIZE
];

21635 
SŒAccum
 
	gacc
;

21636 
as£¹
Ð
db
!=0 );

21637 
sql™e3SŒAccumIn™
(&
acc
, 
zBa£
, (zBase),

21638 
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
]);

21639 
	gacc
.
	gdb
 = 
db
;

21640 
sql™e3VXPrštf
(&
acc
, 
SQLITE_PRINTF_INTERNAL
, 
zFÜm©
, 
­
);

21641 
	gz
 = 
sql™e3SŒAccumFšish
(&
acc
);

21642 ifÐ
	gacc
.
	gaccE¼Ü
==
STRACCUM_NOMEM
 ){

21643 
db
->
m®locFažed
 = 1;

21645  
	gz
;

21652 
SQLITE_PRIVATE
 *
sql™e3MPrštf
(
sql™e3
 *
db
, cÚ¡ *
zFÜm©
, ...){

21653 
va_li¡
 
	g­
;

21654 *
	gz
;

21655 
va_¡¬t
(
­
, 
zFÜm©
);

21656 
	gz
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

21657 
va_’d
(
­
);

21658  
	gz
;

21669 
SQLITE_PRIVATE
 *
sql™e3MAµ’df
(
sql™e3
 *
db
, *
zSŒ
, cÚ¡ *
zFÜm©
, ...){

21670 
va_li¡
 
	g­
;

21671 *
	gz
;

21672 
va_¡¬t
(
­
, 
zFÜm©
);

21673 
	gz
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

21674 
va_’d
(
­
);

21675 
sql™e3DbF»e
(
db
, 
zSŒ
);

21676  
	gz
;

21683 
SQLITE_API
 *
sql™e3_vm´štf
(cÚ¡ *
zFÜm©
, 
va_li¡
 
­
){

21684 *
	gz
;

21685 
	gzBa£
[
SQLITE_PRINT_BUF_SIZE
];

21686 
SŒAccum
 
	gacc
;

21687 #iâdeà
SQLITE_OMIT_AUTOINIT


21688 ifÐ
sql™e3_š™Ÿlize
() )  0;

21690 
sql™e3SŒAccumIn™
(&
acc
, 
zBa£
, (zBa£), 
SQLITE_MAX_LENGTH
);

21691 
	gacc
.
	gu£M®loc
 = 2;

21692 
sql™e3VXPrštf
(&
acc
, 0, 
zFÜm©
, 
­
);

21693 
	gz
 = 
sql™e3SŒAccumFšish
(&
acc
);

21694  
	gz
;

21701 
SQLITE_API
 *
sql™e3_m´štf
(cÚ¡ *
zFÜm©
, ...){

21702 
va_li¡
 
	g­
;

21703 *
	gz
;

21704 #iâdeà
SQLITE_OMIT_AUTOINIT


21705 ifÐ
sql™e3_š™Ÿlize
() )  0;

21707 
va_¡¬t
(
­
, 
zFÜm©
);

21708 
	gz
 = 
sql™e3_vm´štf
(
zFÜm©
, 
­
);

21709 
va_’d
(
­
);

21710  
	gz
;

21726 
SQLITE_API
 *
sql™e3_v¢´štf
(
n
, *
zBuf
, cÚ¡ *
zFÜm©
, 
va_li¡
 
­
){

21727 
SŒAccum
 
	gacc
;

21728 ifÐ
	gn
<=0 )  
zBuf
;

21729 
sql™e3SŒAccumIn™
(&
acc
, 
zBuf
, 
n
, 0);

21730 
	gacc
.
	gu£M®loc
 = 0;

21731 
sql™e3VXPrštf
(&
acc
, 0, 
zFÜm©
, 
­
);

21732  
sql™e3SŒAccumFšish
(&
acc
);

21734 
SQLITE_API
 *
sql™e3_¢´štf
(
n
, *
zBuf
, cÚ¡ *
zFÜm©
, ...){

21735 *
	gz
;

21736 
va_li¡
 
	g­
;

21737 
va_¡¬t
(
­
,
zFÜm©
);

21738 
	gz
 = 
sql™e3_v¢´štf
(
n
, 
zBuf
, 
zFÜm©
, 
­
);

21739 
va_’d
(
­
);

21740  
	gz
;

21752 
»nd”LogMsg
(
iE¼Code
, cÚ¡ *
zFÜm©
, 
va_li¡
 
­
){

21753 
SŒAccum
 
	gacc
;

21754 
	gzMsg
[
SQLITE_PRINT_BUF_SIZE
*3];

21756 
sql™e3SŒAccumIn™
(&
acc
, 
zMsg
, (zMsg), 0);

21757 
	gacc
.
	gu£M®loc
 = 0;

21758 
sql™e3VXPrštf
(&
acc
, 0, 
zFÜm©
, 
­
);

21759 
	gsql™e3Glob®CÚfig
.
xLog
(
sql™e3Glob®CÚfig
.
pLogArg
, 
iE¼Code
,

21760 
sql™e3SŒAccumFšish
(&
acc
));

21766 
SQLITE_API
 
sql™e3_log
(
iE¼Code
, cÚ¡ *
zFÜm©
, ...){

21767 
va_li¡
 
	g­
;

21768 ifÐ
	gsql™e3Glob®CÚfig
.
	gxLog
 ){

21769 
va_¡¬t
(
­
, 
zFÜm©
);

21770 
»nd”LogMsg
(
iE¼Code
, 
zFÜm©
, 
­
);

21771 
va_’d
(
­
);

21775 #ià
defšed
(
SQLITE_DEBUG
)

21781 
SQLITE_PRIVATE
 
sql™e3DebugPrštf
(cÚ¡ *
zFÜm©
, ...){

21782 
va_li¡
 
	g­
;

21783 
SŒAccum
 
	gacc
;

21784 
	gzBuf
[500];

21785 
sql™e3SŒAccumIn™
(&
acc
, 
zBuf
, (zBuf), 0);

21786 
	gacc
.
	gu£M®loc
 = 0;

21787 
va_¡¬t
(
­
,
zFÜm©
);

21788 
sql™e3VXPrštf
(&
acc
, 0, 
zFÜm©
, 
­
);

21789 
va_’d
(
­
);

21790 
sql™e3SŒAccumFšish
(&
acc
);

21791 
årštf
(
¡dout
,"%s", 
zBuf
);

21792 
fæush
(
¡dout
);

21796 #ifdeà
SQLITE_DEBUG


21811 
SQLITE_PRIVATE
 
T»eV›w
 *
sql™e3T»eV›wPush
(T»eV›w *
p
, 
u8
 
mÜeToFÞlow
){

21812 ifÐ
	gp
==0 ){

21813 
p
 = 
sql™e3_m®loc
( (*p) );

21814 ifÐ
	gp
==0 )  0;

21815 
mem£t
(
p
, 0, (*p));

21817 
	gp
->
	giLev–
++;

21819 
as£¹
Ð
mÜeToFÞlow
==0 || moreToFollow==1 );

21820 ifÐ
	gp
->
	giLev–
<Õ->
	gbLše
èèp->bLše[
p
->
iLev–
] = 
mÜeToFÞlow
;

21821  
	gp
;

21824 
SQLITE_PRIVATE
 
sql™e3T»eV›wPÝ
(
T»eV›w
 *
p
){

21825 ifÐ
	gp
==0 ) ;

21826 
	gp
->
	giLev–
--;

21827 ifÐ
	gp
->
	giLev–
<0 ) 
sql™e3_ä“
(
p
);

21831 
SQLITE_PRIVATE
 
sql™e3T»eV›wLše
(
T»eV›w
 *
p
, cÚ¡ *
zFÜm©
, ...){

21832 
va_li¡
 
	g­
;

21833 
	gi
;

21834 
SŒAccum
 
	gacc
;

21835 
	gzBuf
[500];

21836 
sql™e3SŒAccumIn™
(&
acc
, 
zBuf
, (zBuf), 0);

21837 
	gacc
.
	gu£M®loc
 = 0;

21838 ifÐ
	gp
 ){

21839 
	gi
=0; i<
	gp
->
	giLev–
 && i<Õ->
	gbLše
)-1; i++){

21840 
sql™e3SŒAccumAµ’d
(&
acc
, 
p
->
bLše
[
i
] ? "| " : " ", 4);

21842 
sql™e3SŒAccumAµ’d
(&
acc
, 
p
->
bLše
[
i
] ? "|-- " : "'-- ", 4);

21844 
va_¡¬t
(
­
, 
zFÜm©
);

21845 
sql™e3VXPrštf
(&
acc
, 0, 
zFÜm©
, 
­
);

21846 
va_’d
(
­
);

21847 ifÐ
	gzBuf
[
acc
.
nCh¬
-1]!='\n' ) 
sql™e3SŒAccumAµ’d
(&acc, "\n", 1);

21848 
sql™e3SŒAccumFšish
(&
acc
);

21849 
årštf
(
¡dout
,"%s", 
zBuf
);

21850 
fæush
(
¡dout
);

21853 
SQLITE_PRIVATE
 
sql™e3T»eV›wI‹m
(
T»eV›w
 *
p
, cÚ¡ *
zLab–
, 
u8
 
mÜeToFÞlow
){

21854 
	gp
 = 
sql™e3T»eV›wPush
(
p
, 
mÜeToFÞlow
);

21855 
sql™e3T»eV›wLše
(
p
, "%s", 
zLab–
);

21862 
SQLITE_PRIVATE
 
sql™e3XPrštf
(
SŒAccum
 *
p
, 
u32
 
bFÏgs
, cÚ¡ *
zFÜm©
, ...){

21863 
va_li¡
 
	g­
;

21864 
va_¡¬t
(
­
,
zFÜm©
);

21865 
sql™e3VXPrštf
(
p
, 
bFÏgs
, 
zFÜm©
, 
­
);

21866 
va_’d
(
­
);

21893 
SQLITE_WSD
 
	ssql™e3PºgTy³
 {

21894 
	gisIn™
;

21895 
	gi
, 
	gj
;

21896 
	gs
[256];

21897 } 
	gsql™e3Pºg
;

21902 
SQLITE_API
 
sql™e3_¿ndomÃss
(
N
, *
pBuf
){

21903 
	gt
;

21904 *
	gzBuf
 = 
pBuf
;

21912 #ifdeà
SQLITE_OMIT_WSD


21913 
sql™e3PºgTy³
 *
	gp
 = &
GLOBAL
(sql™e3PºgTy³, 
sql™e3Pºg
);

21914 
	#wsdPºg
 
p
[0]

	)

21916 
	#wsdPºg
 
sql™e3Pºg


	)

21919 #ià
SQLITE_THREADSAFE


21920 
sql™e3_mu‹x
 *
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_PRNG
);

21921 
sql™e3_mu‹x_’‹r
(
mu‹x
);

21924 ifÐ
	gN
<=0 ){

21925 
wsdPºg
.
isIn™
 = 0;

21926 
sql™e3_mu‹x_Ëave
(
mu‹x
);

21939 ifÐ!
	gwsdPºg
.
	gisIn™
 ){

21940 
	gi
;

21941 
	gk
[256];

21942 
	gwsdPºg
.
	gj
 = 0;

21943 
	gwsdPºg
.
	gi
 = 0;

21944 
sql™e3OsRªdomÃss
(
sql™e3_vfs_fšd
(0), 256, 
k
);

21945 
	gi
=0; i<256; i++){

21946 
	gwsdPºg
.
	gs
[
i
] = (
u8
)i;

21948 
	gi
=0; i<256; i++){

21949 
	gwsdPºg
.
	gj
 +ð
wsdPºg
.
s
[
i
] + 
k
[i];

21950 
	gt
 = 
wsdPºg
.
s
[wsdPºg.
j
];

21951 
	gwsdPºg
.
	gs
[
wsdPºg
.
j
] = wsdPºg.
s
[
i
];

21952 
	gwsdPºg
.
	gs
[
i
] = 
t
;

21954 
	gwsdPºg
.
	gisIn™
 = 1;

21957 
as£¹
Ð
N
>0 );

21959 
	gwsdPºg
.
	gi
++;

21960 
	gt
 = 
wsdPºg
.
s
[wsdPºg.
i
];

21961 
	gwsdPºg
.
	gj
 +ð
t
;

21962 
	gwsdPºg
.
	gs
[
wsdPºg
.
i
] = wsdPºg.
s
[wsdPºg.
j
];

21963 
	gwsdPºg
.
	gs
[
wsdPºg
.
j
] = 
t
;

21964 
	gt
 +ð
wsdPºg
.
s
[wsdPºg.
i
];

21965 *(
	gzBuf
++èð
wsdPºg
.
s
[
t
];

21966 } --
	gN
 );

21967 
sql™e3_mu‹x_Ëave
(
mu‹x
);

21970 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


21980 
SQLITE_WSD
 
sql™e3PºgTy³
 
	gsql™e3SavedPºg
;

21981 
SQLITE_PRIVATE
 
sql™e3PºgSaveS‹
(){

21982 
memýy
(

21983 &
GLOBAL
(
sql™e3PºgTy³
, 
sql™e3SavedPºg
),

21984 &
GLOBAL
(
sql™e3PºgTy³
, 
sql™e3Pºg
),

21985 (
sql™e3Pºg
)

21988 
SQLITE_PRIVATE
 
sql™e3PºgRe¡ÜeS‹
(){

21989 
memýy
(

21990 &
GLOBAL
(
sql™e3PºgTy³
, 
sql™e3Pºg
),

21991 &
GLOBAL
(
sql™e3PºgTy³
, 
sql™e3SavedPºg
),

21992 (
sql™e3Pºg
)

22027 #ià
SQLITE_MAX_WORKER_THREADS
>0

22030 #ià
SQLITE_OS_UNIX
 && 
defšed
(
SQLITE_MUTEX_PTHREADS
è&& 
SQLITE_THREADSAFE
>0

22032 
	#SQLITE_THREADS_IMPLEMENTED
 1

	)

22036 
	sSQL™eTh»ad
 {

22037 
±h»ad_t
 
	gtid
;

22038 
	gdÚe
;

22039 *
	gpOut
;

22040 *(*
	gxTask
)(*);

22041 *
	gpIn
;

22045 
SQLITE_PRIVATE
 
sql™e3Th»adC»©e
(

22046 
SQL™eTh»ad
 **
µTh»ad
,

22047 *(*
xTask
)(*),

22048 *
pIn


22050 
SQL™eTh»ad
 *
	gp
;

22051 
	grc
;

22053 
as£¹
Ð
µTh»ad
!=0 );

22054 
as£¹
Ð
xTask
!=0 );

22056 
as£¹
Ð
sql™e3Glob®CÚfig
.
bCÜeMu‹x
!=0 );

22058 *
	gµTh»ad
 = 0;

22059 
	gp
 = 
sql™e3M®loc
((*
p
));

22060 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

22061 
mem£t
(
p
, 0, (*p));

22062 
	gp
->
	gxTask
 = 
xTask
;

22063 
	gp
->
	gpIn
 = 
pIn
;

22064 ifÐ
sql™e3FauÉSim
(200) ){

22065 
	grc
 = 1;

22067 
	grc
 = 
±h»ad_ü—‹
(&
p
->
tid
, 0, 
xTask
, 
pIn
);

22069 ifÐ
	grc
 ){

22070 
	gp
->
	gdÚe
 = 1;

22071 
	gp
->
	gpOut
 = 
xTask
(
pIn
);

22073 *
	gµTh»ad
 = 
p
;

22074  
	gSQLITE_OK
;

22078 
SQLITE_PRIVATE
 
sql™e3Th»adJoš
(
SQL™eTh»ad
 *
p
, **
µOut
){

22079 
	grc
;

22081 
as£¹
Ð
µOut
!=0 );

22082 ifÐ
NEVER
(
p
==0èè 
SQLITE_NOMEM
;

22083 ifÐ
	gp
->
	gdÚe
 ){

22084 *
	gµOut
 = 
p
->
pOut
;

22085 
	grc
 = 
SQLITE_OK
;

22087 
	grc
 = 
±h»ad_još
(
p
->
tid
, 
µOut
è? 
	gSQLITE_ERROR
 : 
SQLITE_OK
;

22089 
sql™e3_ä“
(
p
);

22090  
	grc
;

22098 #ià
SQLITE_OS_WIN
 && !
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && 
SQLITE_THREADSAFE
>0

22100 
	#SQLITE_THREADS_IMPLEMENTED
 1

	)

22101 
	~<´oûss.h
>

22104 
	sSQL™eTh»ad
 {

22105 *
	gtid
;

22106 
	gid
;

22107 *(*
	gxTask
)(*);

22108 *
	gpIn
;

22109 *
	gpResuÉ
;

22113 
__¡dÿÎ
 
sql™e3Th»adProc
(

22114 *
pArg


22116 
SQL™eTh»ad
 *
	gp
 = (SQL™eTh»ad *)
pArg
;

22118 
as£¹
Ð
p
!=0 );

22126 
as£¹
Ð
p
->
id
==
G‘Cu¼’tTh»adId
() );

22128 
as£¹
Ð
p
->
xTask
!=0 );

22129 
	gp
->
	gpResuÉ
 = 
p
->
xTask
Õ->
pIn
);

22131 
_’dth»adex
(0);

22136 
SQLITE_PRIVATE
 
sql™e3Th»adC»©e
(

22137 
SQL™eTh»ad
 **
µTh»ad
,

22138 *(*
xTask
)(*),

22139 *
pIn


22141 
SQL™eTh»ad
 *
	gp
;

22143 
as£¹
Ð
µTh»ad
!=0 );

22144 
as£¹
Ð
xTask
!=0 );

22145 *
	gµTh»ad
 = 0;

22146 
	gp
 = 
sql™e3M®loc
((*
p
));

22147 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

22148 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
==0 ){

22149 
mem£t
(
p
, 0, (*p));

22151 
	gp
->
	gxTask
 = 
xTask
;

22152 
	gp
->
	gpIn
 = 
pIn
;

22153 
	gp
->
	gtid
 = (*)
_begšth»adex
(0, 0, 
sql™e3Th»adProc
, 
p
, 0, &p->
id
);

22154 ifÐ
	gp
->
	gtid
==0 ){

22155 
mem£t
(
p
, 0, (*p));

22158 ifÐ
	gp
->
	gxTask
==0 ){

22159 
p
->
id
 = 
G‘Cu¼’tTh»adId
();

22160 
	gp
->
	gpResuÉ
 = 
xTask
(
pIn
);

22162 *
	gµTh»ad
 = 
p
;

22163  
	gSQLITE_OK
;

22166 
SQLITE_PRIVATE
 
DWORD
 
sql™e3Wš32Wa™
(
HANDLE
 
hObjeù
);

22169 
SQLITE_PRIVATE
 
sql™e3Th»adJoš
(
SQL™eTh»ad
 *
p
, **
µOut
){

22170 
DWORD
 
	grc
;

22171 
BOOL
 
	gbRc
;

22173 
as£¹
Ð
µOut
!=0 );

22174 ifÐ
NEVER
(
p
==0èè 
SQLITE_NOMEM
;

22175 ifÐ
	gp
->
	gxTask
==0 ){

22176 
as£¹
Ð
p
->
id
==
G‘Cu¼’tTh»adId
() );

22177 
	grc
 = 
WAIT_OBJECT_0
;

22178 
as£¹
Ð
p
->
tid
==0 );

22180 
as£¹
Ð
p
->
id
!=0 &&…->id!=
G‘Cu¼’tTh»adId
() );

22181 
	grc
 = 
sql™e3Wš32Wa™
((
HANDLE
)
p
->
tid
);

22182 
as£¹
Ð
rc
!=
WAIT_IO_COMPLETION
 );

22183 
	gbRc
 = 
Clo£HªdË
((
HANDLE
)
p
->
tid
);

22184 
as£¹
Ð
bRc
 );

22186 ifÐ
	grc
==
WAIT_OBJECT_0
 ) *
µOut
 = 
p
->
pResuÉ
;

22187 
sql™e3_ä“
(
p
);

22188  (
	grc
==
WAIT_OBJECT_0
è? 
SQLITE_OK
 : 
SQLITE_ERROR
;

22196 #iâdeà
SQLITE_THREADS_IMPLEMENTED


22204 
	sSQL™eTh»ad
 {

22205 *(*
	gxTask
)(*);

22206 *
	gpIn
;

22207 *
	gpResuÉ
;

22211 
SQLITE_PRIVATE
 
sql™e3Th»adC»©e
(

22212 
SQL™eTh»ad
 **
µTh»ad
,

22213 *(*
xTask
)(*),

22214 *
pIn


22216 
SQL™eTh»ad
 *
	gp
;

22218 
as£¹
Ð
µTh»ad
!=0 );

22219 
as£¹
Ð
xTask
!=0 );

22220 *
	gµTh»ad
 = 0;

22221 
	gp
 = 
sql™e3M®loc
((*
p
));

22222 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

22223 ifÐ(
SQLITE_PTR_TO_INT
(
p
)/17)&1 ){

22224 
	gp
->
	gxTask
 = 
xTask
;

22225 
	gp
->
	gpIn
 = 
pIn
;

22227 
	gp
->
	gxTask
 = 0;

22228 
	gp
->
	gpResuÉ
 = 
xTask
(
pIn
);

22230 *
	gµTh»ad
 = 
p
;

22231  
	gSQLITE_OK
;

22235 
SQLITE_PRIVATE
 
sql™e3Th»adJoš
(
SQL™eTh»ad
 *
p
, **
µOut
){

22237 
as£¹
Ð
µOut
!=0 );

22238 ifÐ
NEVER
(
p
==0èè 
SQLITE_NOMEM
;

22239 ifÐ
	gp
->
	gxTask
 ){

22240 *
	gµOut
 = 
p
->
xTask
Õ->
pIn
);

22242 *
	gµOut
 = 
p
->
pResuÉ
;

22244 
sql™e3_ä“
(
p
);

22246 #ià
defšed
(
SQLITE_TEST
)

22248 *
	gpT¡AÎoc
 = 
sql™e3M®loc
(10);

22249 ià(!
	gpT¡AÎoc
è 
	gSQLITE_NOMEM
;

22250 
sql™e3_ä“
(
pT¡AÎoc
);

22254  
	gSQLITE_OK
;

22300 #iâdeà
SQLITE_AMALGAMATION


22305 
SQLITE_PRIVATE
 cÚ¡ 
	gsql™e3Úe
 = 1;

22312 cÚ¡ 
	gsql™e3Utf8T¿ns1
[] = {

22324 
	#WRITE_UTF8
(
zOut
, 
c
) { \

22325 ifÐ
c
<0x00080 ){ \

22326 *
zOut
++ = (
u8
)(
c
&0xFF); \

22328 ifÐ
c
<0x00800 ){ \

22329 *
zOut
++ = 0xC0 + (
u8
)((
c
>>6)&0x1F); \

22330 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

22332 ifÐ
c
<0x10000 ){ \

22333 *
zOut
++ = 0xE0 + (
u8
)((
c
>>12)&0x0F); \

22334 *
zOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F); \

22335 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

22337 *
zOut
++ = 0xF0 + (
u8
)((
c
>>18) & 0x07); \

22338 *
zOut
++ = 0x80 + (
u8
)((
c
>>12) & 0x3F); \

22339 *
zOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F); \

22340 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

22342 }

	)

22344 
	#WRITE_UTF16LE
(
zOut
, 
c
) { \

22345 ifÐ
c
<=0xFFFF ){ \

22346 *
zOut
++ = (
u8
)(
c
&0x00FF); \

22347 *
zOut
++ = (
u8
)((
c
>>8)&0x00FF); \

22349 *
zOut
++ = (
u8
)(((
c
>>10)&0x003F) + (((c-0x10000)>>10)&0x00C0)); \

22350 *
zOut
++ = (
u8
)(0x00D8 + (((
c
-0x10000)>>18)&0x03)); \

22351 *
zOut
++ = (
u8
)(
c
&0x00FF); \

22352 *
zOut
++ = (
u8
)(0x00DC + ((
c
>>8)&0x03)); \

22354 }

	)

22356 
	#WRITE_UTF16BE
(
zOut
, 
c
) { \

22357 ifÐ
c
<=0xFFFF ){ \

22358 *
zOut
++ = (
u8
)((
c
>>8)&0x00FF); \

22359 *
zOut
++ = (
u8
)(
c
&0x00FF); \

22361 *
zOut
++ = (
u8
)(0x00D8 + (((
c
-0x10000)>>18)&0x03)); \

22362 *
zOut
++ = (
u8
)(((
c
>>10)&0x003F) + (((c-0x10000)>>10)&0x00C0)); \

22363 *
zOut
++ = (
u8
)(0x00DC + ((
c
>>8)&0x03)); \

22364 *
zOut
++ = (
u8
)(
c
&0x00FF); \

22366 }

	)

22368 
	#READ_UTF16LE
(
zIn
, 
TERM
, 
c
){ \

22369 
c
 = (*
zIn
++); \

22370 
c
 +ð((*
zIn
++)<<8); \

22371 ifÐ
c
>=0xD800 && c<0xE000 && 
TERM
 ){ \

22372 
c2
 = (*
zIn
++); \

22373 
c2
 +ð((*
zIn
++)<<8); \

22374 
c
 = (
c2
&0x03FF) + ((c&0x003F)<<10) + (((c&0x03C0)+0x0040)<<10); \

22376 }

	)

22378 
	#READ_UTF16BE
(
zIn
, 
TERM
, 
c
){ \

22379 
c
 = ((*
zIn
++)<<8); \

22380 
c
 +ð(*
zIn
++); \

22381 ifÐ
c
>=0xD800 && c<0xE000 && 
TERM
 ){ \

22382 
c2
 = ((*
zIn
++)<<8); \

22383 
c2
 +ð(*
zIn
++); \

22384 
c
 = (
c2
&0x03FF) + ((c&0x003F)<<10) + (((c&0x03C0)+0x0040)<<10); \

22386 }

	)

22415 
	#READ_UTF8
(
zIn
, 
zT”m
, 
c
) \

22416 
c
 = *(
zIn
++); \

22417 ifÐ
c
>=0xc0 ){ \

22418 
c
 = 
sql™e3Utf8T¿ns1
[c-0xc0]; \

22419  
zIn
!=
zT”m
 && (*zIn & 0xc0)==0x80 ){ \

22420 
c
 = (c<<6è+ (0x3à& *(
zIn
++)); \

22422 ifÐ
c
<0x80 \

22423 || (
c
&0xFFFFF800)==0xD800 \

22424 || (
c
&0xFFFFFFFE)==0xFFFE ){ c = 0xFFFD; } \

22425 }

	)

22426 
SQLITE_PRIVATE
 
u32
 
sql™e3Utf8R—d
(

22427 cÚ¡ **
pz


22429 
	gc
;

22434 
	gc
 = *((*
pz
)++);

22435 ifÐ
	gc
>=0xc0 ){

22436 
c
 = 
sql™e3Utf8T¿ns1
[c-0xc0];

22437  (*(*
	gpz
) & 0xc0)==0x80 ){

22438 
c
 = (c<<6è+ (0x3à& *((*
pz
)++));

22440 ifÐ
	gc
<0x80

22441 || (
	gc
&0xFFFFF800)==0xD800

22442 || (
c
&0xFFFFFFFE)==0xFFFE ){ c = 0xFFFD; }

22444  
	gc
;

22456 #iâdeà
SQLITE_OMIT_UTF16


22462 
SQLITE_PRIVATE
 
SQLITE_NOINLINE
 
sql™e3VdbeMemT¿n¦©e
(
Mem
 *
pMem
, 
u8
 
desœedEnc
){

22463 
	gËn
;

22464 *
	gzOut
;

22465 *
	gzIn
;

22466 *
	gzT”m
;

22467 *
	gz
;

22468 
	gc
;

22470 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

22471 
as£¹
Ð
pMem
->
æags
&
MEM_SŒ
 );

22472 
as£¹
Ð
pMem
->
’c
!=
desœedEnc
 );

22473 
as£¹
Ð
pMem
->
’c
!=0 );

22474 
as£¹
Ð
pMem
->
n
>=0 );

22476 #ià
defšed
(
TRANSLATE_TRACE
è&& defšed(
SQLITE_DEBUG
)

22478 
	gzBuf
[100];

22479 
sql™e3VdbeMemP»‰yPršt
(
pMem
, 
zBuf
);

22480 
årštf
(
¡d”r
, "INPUT: %s\n", 
zBuf
);

22488 ifÐ
	gpMem
->
	g’c
!=
SQLITE_UTF8
 && 
desœedEnc
!=SQLITE_UTF8 ){

22489 
u8
 
‹mp
;

22490 
	grc
;

22491 
	grc
 = 
sql™e3VdbeMemMakeWr™—bË
(
pMem
);

22492 ifÐ
	grc
!=
SQLITE_OK
 ){

22493 
as£¹
Ð
rc
==
SQLITE_NOMEM
 );

22494  
	gSQLITE_NOMEM
;

22496 
	gzIn
 = (
u8
*)
pMem
->
z
;

22497 
	gzT”m
 = &
zIn
[
pMem
->
n
&~1];

22498  
	gzIn
<
	gzT”m
 ){

22499 
	g‹mp
 = *
zIn
;

22500 *
	gzIn
 = *(
zIn
+1);

22501 
	gzIn
++;

22502 *
	gzIn
++ = 
‹mp
;

22504 
	gpMem
->
	g’c
 = 
desœedEnc
;

22505 
	gŒª¦©e_out
;

22509 ifÐ
	gdesœedEnc
==
SQLITE_UTF8
 ){

22515 
pMem
->
n
 &= ~1;

22516 
	gËn
 = 
pMem
->
n
 * 2 + 1;

22523 
	gËn
 = 
pMem
->
n
 * 2 + 2;

22532 
	gzIn
 = (
u8
*)
pMem
->
z
;

22533 
	gzT”m
 = &
zIn
[
pMem
->
n
];

22534 
	gzOut
 = 
sql™e3DbM®locRaw
(
pMem
->
db
, 
Ën
);

22535 ifÐ!
	gzOut
 ){

22536  
	gSQLITE_NOMEM
;

22538 
	gz
 = 
zOut
;

22540 ifÐ
	gpMem
->
	g’c
==
SQLITE_UTF8
 ){

22541 ifÐ
desœedEnc
==
SQLITE_UTF16LE
 ){

22543  
zIn
<
zT”m
 ){

22544 
READ_UTF8
(
zIn
, 
zT”m
, 
c
);

22545 
WRITE_UTF16LE
(
z
, 
c
);

22548 
as£¹
Ð
desœedEnc
==
SQLITE_UTF16BE
 );

22550  
	gzIn
<
	gzT”m
 ){

22551 
READ_UTF8
(
zIn
, 
zT”m
, 
c
);

22552 
WRITE_UTF16BE
(
z
, 
c
);

22555 
	gpMem
->
	gn
 = ()(
z
 - 
zOut
);

22556 *
	gz
++ = 0;

22558 
as£¹
Ð
desœedEnc
==
SQLITE_UTF8
 );

22559 ifÐ
	gpMem
->
	g’c
==
SQLITE_UTF16LE
 ){

22561  
zIn
<
zT”m
 ){

22562 
READ_UTF16LE
(
zIn
, zIn<
zT”m
, 
c
);

22563 
WRITE_UTF8
(
z
, 
c
);

22567  
	gzIn
<
	gzT”m
 ){

22568 
READ_UTF16BE
(
zIn
, zIn<
zT”m
, 
c
);

22569 
WRITE_UTF8
(
z
, 
c
);

22572 
	gpMem
->
	gn
 = ()(
z
 - 
zOut
);

22574 *
	gz
 = 0;

22575 
as£¹
Ð(
pMem
->
n
+(
desœedEnc
==
SQLITE_UTF8
?1:2))<=
Ën
 );

22577 
	gc
 = 
pMem
->
æags
;

22578 
sql™e3VdbeMemR–—£
(
pMem
);

22579 
	gpMem
->
	gæags
 = 
MEM_SŒ
|
MEM_T”m
|(
c
&
MEM_AffMask
);

22580 
	gpMem
->
	g’c
 = 
desœedEnc
;

22581 
	gpMem
->
	gz
 = (*)
zOut
;

22582 
	gpMem
->
	gzM®loc
 = 
pMem
->
z
;

22583 
	gpMem
->
	gszM®loc
 = 
sql™e3DbM®locSize
(
pMem
->
db
,…Mem->
z
);

22585 
	gŒª¦©e_out
:

22586 #ià
defšed
(
TRANSLATE_TRACE
è&& defšed(
SQLITE_DEBUG
)

22588 
zBuf
[100];

22589 
sql™e3VdbeMemP»‰yPršt
(
pMem
, 
zBuf
);

22590 
årštf
(
¡d”r
, "OUTPUT: %s\n", 
zBuf
);

22593  
	gSQLITE_OK
;

22605 
SQLITE_PRIVATE
 
sql™e3VdbeMemHªdËBom
(
Mem
 *
pMem
){

22606 
	grc
 = 
SQLITE_OK
;

22607 
u8
 
	gbom
 = 0;

22609 
as£¹
Ð
pMem
->
n
>=0 );

22610 ifÐ
	gpMem
->
	gn
>1 ){

22611 
u8
 
	gb1
 = *(u8 *)
pMem
->
z
;

22612 
u8
 
	gb2
 = *(((u8 *)
pMem
->
z
) + 1);

22613 ifÐ
	gb1
==0xFE && 
b2
==0xFF ){

22614 
bom
 = 
SQLITE_UTF16BE
;

22616 ifÐ
	gb1
==0xFF && 
b2
==0xFE ){

22617 
bom
 = 
SQLITE_UTF16LE
;

22621 ifÐ
	gbom
 ){

22622 
	grc
 = 
sql™e3VdbeMemMakeWr™—bË
(
pMem
);

22623 ifÐ
	grc
==
SQLITE_OK
 ){

22624 
pMem
->
n
 -= 2;

22625 
memmove
(
pMem
->
z
, &pMem->z[2],…Mem->
n
);

22626 
	gpMem
->
	gz
[
pMem
->
n
] = '\0';

22627 
	gpMem
->
	gz
[
pMem
->
n
+1] = '\0';

22628 
	gpMem
->
	gæags
 |ð
MEM_T”m
;

22629 
	gpMem
->
	g’c
 = 
bom
;

22632  
	grc
;

22643 
SQLITE_PRIVATE
 
sql™e3Utf8Ch¬L’
(cÚ¡ *
zIn
, 
nBy‹
){

22644 
	gr
 = 0;

22645 cÚ¡ 
u8
 *
	gz
 = (cÚ¡ u8*)
zIn
;

22646 cÚ¡ 
u8
 *
	gzT”m
;

22647 ifÐ
	gnBy‹
>=0 ){

22648 
zT”m
 = &
z
[
nBy‹
];

22650 
	gzT”m
 = (cÚ¡ 
u8
*)(-1);

22652 
as£¹
Ð
z
<=
zT”m
 );

22653  *
	gz
!=0 && 
z
<
zT”m
 ){

22654 
SQLITE_SKIP_UTF8
(
z
);

22655 
	gr
++;

22657  
	gr
;

22663 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

22673 
SQLITE_PRIVATE
 
sql™e3Utf8To8
(*
zIn
){

22674 *
	gzOut
 = 
zIn
;

22675 *
	gzS¹
 = 
zIn
;

22676 
u32
 
	gc
;

22678  
	gzIn
[0] && 
	gzOut
<=
zIn
 ){

22679 
c
 = 
sql™e3Utf8R—d
((cÚ¡ 
u8
**)&
zIn
);

22680 ifÐ
	gc
!=0xfffd ){

22681 
WRITE_UTF8
(
zOut
, 
c
);

22684 *
	gzOut
 = 0;

22685  ()(
	gzOut
 - 
	gzS¹
);

22689 #iâdeà
SQLITE_OMIT_UTF16


22697 
SQLITE_PRIVATE
 *
sql™e3Utf16to8
(
sql™e3
 *
db
, cÚ¡ *
z
, 
nBy‹
, 
u8
 
’c
){

22698 
Mem
 
	gm
;

22699 
mem£t
(&
m
, 0, (m));

22700 
	gm
.
	gdb
 = 
db
;

22701 
sql™e3VdbeMemS‘SŒ
(&
m
, 
z
, 
nBy‹
, 
’c
, 
SQLITE_STATIC
);

22702 
sql™e3VdbeChªgeEncodšg
(&
m
, 
SQLITE_UTF8
);

22703 ifÐ
	gdb
->
	gm®locFažed
 ){

22704 
sql™e3VdbeMemR–—£
(&
m
);

22705 
	gm
.
	gz
 = 0;

22707 
as£¹
Ð(
m
.
æags
 & 
MEM_T”m
)!=0 || 
db
->
m®locFažed
 );

22708 
as£¹
Ð(
m
.
æags
 & 
MEM_SŒ
)!=0 || 
db
->
m®locFažed
 );

22709 
as£¹
Ð
m
.
z
 || 
db
->
m®locFažed
 );

22710  
	gm
.
	gz
;

22718 
SQLITE_PRIVATE
 
sql™e3Utf16By‹L’
(cÚ¡ *
zIn
, 
nCh¬
){

22719 
	gc
;

22720 cÚ¡ *
	gz
 = 
zIn
;

22721 
	gn
 = 0;

22723 ifÐ
	gSQLITE_UTF16NATIVE
==
SQLITE_UTF16BE
 ){

22724  
n
<
nCh¬
 ){

22725 
READ_UTF16BE
(
z
, 1, 
c
);

22726 
	gn
++;

22729  
	gn
<
	gnCh¬
 ){

22730 
READ_UTF16LE
(
z
, 1, 
c
);

22731 
	gn
++;

22734  ()(
	gz
-(cÚ¡ *)
	gzIn
);

22737 #ià
defšed
(
SQLITE_TEST
)

22743 
SQLITE_PRIVATE
 
sql™e3UtfS–fTe¡
(){

22744 
	gi
, 
	gt
;

22745 
	gzBuf
[20];

22746 *
	gz
;

22747 
	gn
;

22748 
	gc
;

22750 
	gi
=0; i<0x00110000; i++){

22751 
	gz
 = 
zBuf
;

22752 
WRITE_UTF8
(
z
, 
i
);

22753 
	gn
 = ()(
z
-
zBuf
);

22754 
as£¹
Ð
n
>0 &&‚<=4 );

22755 
	gz
[0] = 0;

22756 
	gz
 = 
zBuf
;

22757 
	gc
 = 
sql™e3Utf8R—d
((cÚ¡ 
u8
**)&
z
);

22758 
	gt
 = 
i
;

22759 ifÐ
	gi
>=0xD800 && 
i
<=0xDFFF ) 
t
 = 0xFFFD;

22760 ifÐ(
	gi
&0xFFFFFFFE)==0xFFFE ) 
t
 = 0xFFFD;

22761 
as£¹
Ð
c
==
t
 );

22762 
as£¹
Ð(
z
-
zBuf
)==
n
 );

22764 
	gi
=0; i<0x00110000; i++){

22765 ifÐ
	gi
>=0xD800 && 
i
<0xE000 ) ;

22766 
	gz
 = 
zBuf
;

22767 
WRITE_UTF16LE
(
z
, 
i
);

22768 
	gn
 = ()(
z
-
zBuf
);

22769 
as£¹
Ð
n
>0 &&‚<=4 );

22770 
	gz
[0] = 0;

22771 
	gz
 = 
zBuf
;

22772 
READ_UTF16LE
(
z
, 1, 
c
);

22773 
as£¹
Ð
c
==
i
 );

22774 
as£¹
Ð(
z
-
zBuf
)==
n
 );

22776 
	gi
=0; i<0x00110000; i++){

22777 ifÐ
	gi
>=0xD800 && 
i
<0xE000 ) ;

22778 
	gz
 = 
zBuf
;

22779 
WRITE_UTF16BE
(
z
, 
i
);

22780 
	gn
 = ()(
z
-
zBuf
);

22781 
as£¹
Ð
n
>0 &&‚<=4 );

22782 
	gz
[0] = 0;

22783 
	gz
 = 
zBuf
;

22784 
READ_UTF16BE
(
z
, 1, 
c
);

22785 
as£¹
Ð
c
==
i
 );

22786 
as£¹
Ð(
z
-
zBuf
)==
n
 );

22812 #ifdeà
SQLITE_HAVE_ISNAN


22813 
	~<m©h.h
>

22819 #ifdeà
SQLITE_COVERAGE_TEST


22820 
SQLITE_PRIVATE
 
sql™e3Cov”age
(
x
){

22821 
	gdummy
 = 0;

22822 
	gdummy
 +ð()
x
;

22837 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


22838 
SQLITE_PRIVATE
 
sql™e3FauÉSim
(
iTe¡
){

22839 (*
	gxC®lback
)(èð
sql™e3Glob®CÚfig
.
xTe¡C®lback
;

22840  
	gxC®lback
 ? 
xC®lback
(
iTe¡
è: 
SQLITE_OK
;

22844 #iâdeà
SQLITE_OMIT_FLOATING_POINT


22851 
SQLITE_PRIVATE
 
sql™e3IsNaN
(
x
){

22852 
	grc
;

22853 #ià!
defšed
(
SQLITE_HAVE_ISNAN
)

22877 #ifdeà
__FAST_MATH__


22878 #”rÜ 
SQL™e
 
wžl
 
nÙ
 
wÜk
 
cÜ»ùly
 
w™h
 
the
 -
fç¡
-
m©h
 
ÝtiÚ
 
of
 
GCC
.

22880 vÞ©ž
	gy
 = 
x
;

22881 vÞ©ž
	gz
 = 
y
;

22882 
	grc
 = (
y
!=
z
);

22884 
	grc
 = 
i¢ª
(
x
);

22886 
‹¡ÿ£
Ð
rc
 );

22887  
	grc
;

22899 
SQLITE_PRIVATE
 
sql™e3SŒËn30
(cÚ¡ *
z
){

22900 cÚ¡ *
	gz2
 = 
z
;

22901 ifÐ
	gz
==0 )  0;

22902  *
	gz2
 ){ z2++; }

22903  0x3ffffffà& ()(
	gz2
 - 
	gz
);

22909 
SQLITE_PRIVATE
 
sql™e3E¼Ü
(
sql™e3
 *
db
, 
”r_code
){

22910 
as£¹
Ð
db
!=0 );

22911 
	gdb
->
	g”rCode
 = 
”r_code
;

22912 ifÐ
	gdb
->
	gpE¼
 ) 
sql™e3V®ueS‘NuÎ
(
db
->
pE¼
);

22936 
SQLITE_PRIVATE
 
sql™e3E¼ÜW™hMsg
(
sql™e3
 *
db
, 
”r_code
, cÚ¡ *
zFÜm©
, ...){

22937 
as£¹
Ð
db
!=0 );

22938 
	gdb
->
	g”rCode
 = 
”r_code
;

22939 ifÐ
	gzFÜm©
==0 ){

22940 
sql™e3E¼Ü
(
db
, 
”r_code
);

22941 }ifÐ
	gdb
->
	gpE¼
 || (db->pE¼ = 
sql™e3V®ueNew
(
db
))!=0 ){

22942 *
z
;

22943 
va_li¡
 
	g­
;

22944 
va_¡¬t
(
­
, 
zFÜm©
);

22945 
	gz
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

22946 
va_’d
(
­
);

22947 
sql™e3V®ueS‘SŒ
(
db
->
pE¼
, -1, 
z
, 
SQLITE_UTF8
, 
SQLITE_DYNAMIC
);

22968 
SQLITE_PRIVATE
 
sql™e3E¼ÜMsg
(
P¬£
 *
pP¬£
, cÚ¡ *
zFÜm©
, ...){

22969 *
	gzMsg
;

22970 
va_li¡
 
	g­
;

22971 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

22972 
va_¡¬t
(
­
, 
zFÜm©
);

22973 
	gzMsg
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

22974 
va_’d
(
­
);

22975 ifÐ
	gdb
->
	gsuµ»ssE¼
 ){

22976 
sql™e3DbF»e
(
db
, 
zMsg
);

22978 
	gpP¬£
->
	gnE¼
++;

22979 
sql™e3DbF»e
(
db
, 
pP¬£
->
zE¼Msg
);

22980 
	gpP¬£
->
	gzE¼Msg
 = 
zMsg
;

22981 
	gpP¬£
->
	grc
 = 
SQLITE_ERROR
;

23002 
SQLITE_PRIVATE
 
sql™e3DequÙe
(*
z
){

23003 
	gquÙe
;

23004 
	gi
, 
	gj
;

23005 ifÐ
	gz
==0 )  -1;

23006 
	gquÙe
 = 
z
[0];

23007  
	gquÙe
 ){

23011 '[': 
quÙe
 = ']'; ;

23014 
	gi
=1, 
	gj
=0;; i++){

23015 
as£¹
Ð
z
[
i
] );

23016 ifÐ
	gz
[
i
]==
quÙe
 ){

23017 ifÐ
z
[
i
+1]==
quÙe
 ){

23018 
z
[
j
++] = 
quÙe
;

23019 
	gi
++;

23024 
	gz
[
j
++] = 
z
[
i
];

23027 
	gz
[
j
] = 0;

23028  
	gj
;

23032 
	#Uµ”ToLow”
 
sql™e3Uµ”ToLow”


	)

23044 
SQLITE_API
 
sql™e3_¡ricmp
(cÚ¡ *
zLeá
, cÚ¡ *
zRight
){

23045 *
	ga
, *
	gb
;

23046 
	ga
 = (*)
zLeá
;

23047 
	gb
 = (*)
zRight
;

23048  *
	ga
!=0 && 
Uµ”ToLow”
[*
a
]==Uµ”ToLow”[*
b
]){‡++; 
	gb
++; }

23049  
	gUµ”ToLow”
[*
a
] - Uµ”ToLow”[*
b
];

23051 
SQLITE_API
 
sql™e3_¡ºicmp
(cÚ¡ *
zLeá
, cÚ¡ *
zRight
, 
N
){

23052 *
	ga
, *
	gb
;

23053 
	ga
 = (*)
zLeá
;

23054 
	gb
 = (*)
zRight
;

23055  
	gN
-- > 0 && *
	ga
!=0 && 
Uµ”ToLow”
[*
a
]==Uµ”ToLow”[*
b
]){‡++; 
	gb
++; }

23056  
	gN
<0 ? 0 : 
Uµ”ToLow”
[*
a
] - Uµ”ToLow”[*
b
];

23081 
SQLITE_PRIVATE
 
sql™e3AtoF
(cÚ¡ *
z
, *
pResuÉ
, 
Ëngth
, 
u8
 
’c
){

23082 #iâdeà
SQLITE_OMIT_FLOATING_POINT


23083 
	gšü
;

23084 cÚ¡ *
	gzEnd
 = 
z
 + 
Ëngth
;

23086 
	gsign
 = 1;

23087 
i64
 
	gs
 = 0;

23088 
	gd
 = 0;

23089 
	gesign
 = 1;

23090 
	ge
 = 0;

23091 
	geV®id
 = 1;

23092 
	g»suÉ
;

23093 
	gnDig™s
 = 0;

23094 
	gnÚNum
 = 0;

23096 
as£¹
Ð
’c
==
SQLITE_UTF8
 ||ƒnc==
SQLITE_UTF16LE
 ||ƒnc==
SQLITE_UTF16BE
 );

23097 *
	gpResuÉ
 = 0.0;

23099 ifÐ
	g’c
==
SQLITE_UTF8
 ){

23100 
šü
 = 1;

23102 
	gi
;

23103 
	gšü
 = 2;

23104 
as£¹
Ð
SQLITE_UTF16LE
==2 && 
SQLITE_UTF16BE
==3 );

23105 
	gi
=3-
’c
; i<
	gËngth
 && 
	gz
[
i
]==0; i+=2){}

23106 
nÚNum
 = 
i
<
Ëngth
;

23107 
	gzEnd
 = 
z
+
i
+
’c
-3;

23108 
	gz
 +ð(
’c
&1);

23112  
	gz
<
	gzEnd
 && 
sql™e3Is¥aû
(*
z
èèz+=
šü
;

23113 ifÐ
	gz
>=
zEnd
 )  0;

23116 ifÐ*
	gz
=='-' ){

23117 
sign
 = -1;

23118 
	gz
+=
šü
;

23119 }ifÐ*
	gz
=='+' ){

23120 
z
+=
šü
;

23124  
	gz
<
	gzEnd
 && z[0]=='0' ) 
z
+=
šü
, 
	gnDig™s
++;

23127  
	gz
<
	gzEnd
 && 
sql™e3Isdig™
(*
z
è&& 
	gs
<((
	gLARGEST_INT64
-9)/10) ){

23128 
	gs
 = 
s
*10 + (*
z
 - '0');

23129 
	gz
+=
šü
, 
	gnDig™s
++;

23134  
	gz
<
	gzEnd
 && 
sql™e3Isdig™
(*
z
èèz+=
šü
, 
	gnDig™s
++, 
	gd
++;

23135 ifÐ
	gz
>=
zEnd
 ) 
do_©of_ÿlc
;

23138 ifÐ*
	gz
=='.' ){

23139 
z
+=
šü
;

23142  
	gz
<
	gzEnd
 && 
sql™e3Isdig™
(*
z
è&& 
	gs
<((
	gLARGEST_INT64
-9)/10) ){

23143 
	gs
 = 
s
*10 + (*
z
 - '0');

23144 
	gz
+=
šü
, 
	gnDig™s
++, 
	gd
--;

23147  
	gz
<
	gzEnd
 && 
sql™e3Isdig™
(*
z
èèz+=
šü
, 
	gnDig™s
++;

23149 ifÐ
	gz
>=
zEnd
 ) 
do_©of_ÿlc
;

23152 ifÐ*
	gz
=='e' || *
z
=='E' ){

23153 
z
+=
šü
;

23154 
	geV®id
 = 0;

23155 ifÐ
	gz
>=
zEnd
 ) 
do_©of_ÿlc
;

23157 ifÐ*
	gz
=='-' ){

23158 
esign
 = -1;

23159 
	gz
+=
šü
;

23160 }ifÐ*
	gz
=='+' ){

23161 
z
+=
šü
;

23164  
	gz
<
	gzEnd
 && 
sql™e3Isdig™
(*
z
) ){

23165 
	ge
 = 
e
<10000 ? (e*10 + (*
z
 - '0')) : 10000;

23166 
	gz
+=
šü
;

23167 
	geV®id
 = 1;

23172 ifÐ
	gnDig™s
 && 
	geV®id
 ){

23173  
	gz
<
	gzEnd
 && 
sql™e3Is¥aû
(*
z
èèz+=
šü
;

23176 
	gdo_©of_ÿlc
:

23178 
e
 = (e*
esign
è+ 
d
;

23179 ifÐ
	ge
<0 ) {

23180 
	gesign
 = -1;

23181 
	ge
 *= -1;

23183 
	gesign
 = 1;

23187 ifÐ!
	gs
 ) {

23190 
	g»suÉ
 = (
sign
<0 && 
nDig™s
) ? -()0 : ()0;

23193 ifÐ
	gesign
>0 ){

23194  
	gs
<(
	gLARGEST_INT64
/10è&& 
	ge
>0 )ƒ--,s*=10;

23196  !(
	gs
%10è&& 
	ge
>0 )ƒ--,s/=10;

23200 
	gs
 = 
sign
<0 ? -
s
 : s;

23204 ifÐ
	ge
 ){

23205 
LONGDOUBLE_TYPE
 
	gsÿË
 = 1.0;

23207 ifÐ
	ge
>307 &&ƒ<342 ){

23208  
	ge
%308 ) { 
	gsÿË
 *= 1.0e+1;ƒ -= 1; }

23209 ifÐ
	gesign
<0 ){

23210 
	g»suÉ
 = 
s
 / 
sÿË
;

23211 
	g»suÉ
 /= 1.0e+308;

23213 
	g»suÉ
 = 
s
 * 
sÿË
;

23214 
	g»suÉ
 *= 1.0e+308;

23216 }ifÐ
	ge
>=342 ){

23217 ifÐ
esign
<0 ){

23218 
»suÉ
 = 0.0*
s
;

23220 
	g»suÉ
 = 1e308*1e308*
s
;

23225  
	ge
%22 ) { 
	gsÿË
 *= 1.0e+1;ƒ -= 1; }

23226  
	ge
>0 ) { 
	gsÿË
 *= 1.0e+22;ƒ -= 22; }

23227 ifÐ
	gesign
<0 ){

23228 
	g»suÉ
 = 
s
 / 
sÿË
;

23230 
	g»suÉ
 = 
s
 * 
sÿË
;

23234 
	g»suÉ
 = ()
s
;

23239 *
	gpResuÉ
 = 
»suÉ
;

23242  
	gz
>=
zEnd
 && 
nDig™s
>0 && 
eV®id
 && 
nÚNum
==0;

23244  !
sql™e3Atoi64
(
z
, 
pResuÉ
, 
Ëngth
, 
’c
);

23262 
com·»2pow63
(cÚ¡ *
zNum
, 
šü
){

23263 
	gc
 = 0;

23264 
	gi
;

23266 cÚ¡ *
	gpow63
 = "922337203685477580";

23267 
	gi
=0; 
	gc
==0 && 
i
<18; i++){

23268 
	gc
 = (
zNum
[
i
*
šü
]-
pow63
[i])*10;

23270 ifÐ
	gc
==0 ){

23271 
c
 = 
zNum
[18*
šü
] - '8';

23272 
‹¡ÿ£
Ð
c
==(-1) );

23273 
‹¡ÿ£
Ð
c
==0 );

23274 
‹¡ÿ£
Ð
c
==(+1) );

23276  
	gc
;

23298 
SQLITE_PRIVATE
 
sql™e3Atoi64
(cÚ¡ *
zNum
, 
i64
 *
pNum
, 
Ëngth
, 
u8
 
’c
){

23299 
	gšü
;

23300 
u64
 
	gu
 = 0;

23301 
	gÃg
 = 0;

23302 
	gi
;

23303 
	gc
 = 0;

23304 
	gnÚNum
 = 0;

23305 cÚ¡ *
	gzS¹
;

23306 cÚ¡ *
	gzEnd
 = 
zNum
 + 
Ëngth
;

23307 
as£¹
Ð
’c
==
SQLITE_UTF8
 ||ƒnc==
SQLITE_UTF16LE
 ||ƒnc==
SQLITE_UTF16BE
 );

23308 ifÐ
	g’c
==
SQLITE_UTF8
 ){

23309 
šü
 = 1;

23311 
	gšü
 = 2;

23312 
as£¹
Ð
SQLITE_UTF16LE
==2 && 
SQLITE_UTF16BE
==3 );

23313 
	gi
=3-
’c
; i<
	gËngth
 && 
	gzNum
[
i
]==0; i+=2){}

23314 
nÚNum
 = 
i
<
Ëngth
;

23315 
	gzEnd
 = 
zNum
+
i
+
’c
-3;

23316 
	gzNum
 +ð(
’c
&1);

23318  
	gzNum
<
	gzEnd
 && 
sql™e3Is¥aû
(*
zNum
èèzNum+=
šü
;

23319 ifÐ
	gzNum
<
	gzEnd
 ){

23320 ifÐ*
	gzNum
=='-' ){

23321 
Ãg
 = 1;

23322 
	gzNum
+=
šü
;

23323 }ifÐ*
	gzNum
=='+' ){

23324 
zNum
+=
šü
;

23327 
	gzS¹
 = 
zNum
;

23328  
	gzNum
<
	gzEnd
 && zNum[0]=='0' ){ 
zNum
+=
šü
; }

23329 
	gi
=0; &
	gzNum
[
i
]<
	gzEnd
 && (
	gc
=
zNum
[i])>='0' && 
c
<='9'; i+=
šü
){

23330 
u
 = u*10 + 
c
 - '0';

23332 ifÐ
	gu
>
	gLARGEST_INT64
 ){

23333 *
	gpNum
 = 
Ãg
 ? 
SMALLEST_INT64
 : 
LARGEST_INT64
;

23334 }ifÐ
	gÃg
 ){

23335 *
	gpNum
 = -(
i64
)
u
;

23337 *
	gpNum
 = (
i64
)
u
;

23339 
‹¡ÿ£
Ð
i
==18 );

23340 
‹¡ÿ£
Ð
i
==19 );

23341 
‹¡ÿ£
Ð
i
==20 );

23342 ifÐ(
	gc
!=0 && &
zNum
[
i
]<
zEnd
è|| (i==0 && 
zS¹
==zNumè|| i>19*
šü
 || 
nÚNum
 ){

23346 }ifÐ
	gi
<19*
	gšü
 ){

23348 
as£¹
Ð
u
<=
LARGEST_INT64
 );

23352 
	gc
 = 
com·»2pow63
(
zNum
, 
šü
);

23353 ifÐ
	gc
<0 ){

23355 
as£¹
Ð
u
<=
LARGEST_INT64
 );

23357 }ifÐ
	gc
>0 ){

23363 
as£¹
Ð
u
-1==
LARGEST_INT64
 );

23364  
	gÃg
 ? 0 : 2;

23380 
SQLITE_PRIVATE
 
sql™e3DecOrHexToI64
(cÚ¡ *
z
, 
i64
 *
pOut
){

23381 #iâdeà
SQLITE_OMIT_HEX_INTEGER


23382 ifÐ
	gz
[0]=='0'

23383 && (
z
[1]=='x' || z[1]=='X')

23384 && 
sql™e3Isxdig™
(
z
[2])

23386 
u64
 
u
 = 0;

23387 
	gi
, 
	gk
;

23388 
	gi
=2; 
	gz
[
i
]=='0'; i++){}

23389 
	gk
=
i
; 
sql™e3Isxdig™
(
z
[
k
]); k++){

23390 
	gu
 = 
u
*16 + 
sql™e3HexToIÁ
(
z
[
k
]);

23392 
memýy
(
pOut
, &
u
, 8);

23393  (
	gz
[
k
]==0 && k-
i
<=16) ? 0 : 1;

23397  
sql™e3Atoi64
(
z
, 
pOut
, 
sql™e3SŒËn30
(z), 
SQLITE_UTF8
);

23411 
SQLITE_PRIVATE
 
sql™e3G‘IÁ32
(cÚ¡ *
zNum
, *
pV®ue
){

23412 
sql™e_št64
 
	gv
 = 0;

23413 
	gi
, 
	gc
;

23414 
	gÃg
 = 0;

23415 ifÐ
	gzNum
[0]=='-' ){

23416 
Ãg
 = 1;

23417 
	gzNum
++;

23418 }ifÐ
	gzNum
[0]=='+' ){

23419 
zNum
++;

23421 #iâdeà
SQLITE_OMIT_HEX_INTEGER


23422 ifÐ
	gzNum
[0]=='0'

23423 && (
zNum
[1]=='x' || zNum[1]=='X')

23424 && 
sql™e3Isxdig™
(
zNum
[2])

23426 
u32
 
u
 = 0;

23427 
	gzNum
 += 2;

23428  
	gzNum
[0]=='0' ) 
zNum
++;

23429 
	gi
=0; 
sql™e3Isxdig™
(
zNum
[
i
]) && i<8; i++){

23430 
	gu
 = 
u
*16 + 
sql™e3HexToIÁ
(
zNum
[
i
]);

23432 ifÐ(
	gu
&0x80000000)==0 && 
sql™e3Isxdig™
(
zNum
[
i
])==0 ){

23433 
memýy
(
pV®ue
, &
u
, 4);

23440 
	gi
=0; i<11 && (
	gc
 = 
zNum
[
i
] - '0')>=0 && 
c
<=9; i++){

23441 
	gv
 = 
v
*10 + 
c
;

23449 
‹¡ÿ£
Ð
i
==10 );

23450 ifÐ
	gi
>10 ){

23453 
‹¡ÿ£
Ð
v
-
Ãg
==2147483647 );

23454 ifÐ
	gv
-
	gÃg
>2147483647 ){

23457 ifÐ
	gÃg
 ){

23458 
	gv
 = -
v
;

23460 *
	gpV®ue
 = ()
v
;

23468 
SQLITE_PRIVATE
 
sql™e3Atoi
(cÚ¡ *
z
){

23469 
	gx
 = 0;

23470 ifÐ
	gz
 ) 
sql™e3G‘IÁ32
(
z
, &
x
);

23471  
	gx
;

23503 
SQLITE_NOINLINE
 
putV¬št64
(*
p
, 
u64
 
v
){

23504 
	gi
, 
	gj
, 
	gn
;

23505 
u8
 
	gbuf
[10];

23506 ifÐ
	gv
 & (((
	gu64
)0xff000000)<<32) ){

23507 
	gp
[8] = (
u8
)
v
;

23508 
	gv
 >>= 8;

23509 
	gi
=7; i>=0; i--){

23510 
	gp
[
i
] = (
u8
)((
v
 & 0x7f) | 0x80);

23511 
	gv
 >>= 7;

23515 
	gn
 = 0;

23517 
	gbuf
[
n
++] = (
u8
)((
v
 & 0x7f) | 0x80);

23518 
	gv
 >>= 7;

23519 } 
	gv
!=0 );

23520 
	gbuf
[0] &= 0x7f;

23521 
as£¹
Ð
n
<=9 );

23522 
	gi
=0, 
	gj
=
n
-1; j>=0; j--, i++){

23523 
	gp
[
i
] = 
buf
[
j
];

23525  
	gn
;

23527 
SQLITE_PRIVATE
 
sql™e3PutV¬št
(*
p
, 
u64
 
v
){

23528 ifÐ
	gv
<=0x7f ){

23529 
p
[0] = 
v
&0x7f;

23532 ifÐ
	gv
<=0x3fff ){

23533 
p
[0] = ((
v
>>7)&0x7f)|0x80;

23534 
	gp
[1] = 
v
&0x7f;

23537  
putV¬št64
(
p
,
v
);

23549 
	#SLOT_2_0
 0x001fc07f

	)

23550 
	#SLOT_4_2_0
 0xf01fc07f

	)

23557 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘V¬št
(cÚ¡ *
p
, 
u64
 *
v
){

23558 
u32
 
	ga
,
	gb
,
	gs
;

23560 
	ga
 = *
p
;

23562 ià(!(
	ga
&0x80))

23564 *
	gv
 = 
a
;

23568 
	gp
++;

23569 
	gb
 = *
p
;

23571 ià(!(
	gb
&0x80))

23573 
	ga
 &= 0x7f;

23574 
	ga
 = 
a
<<7;

23575 
	ga
 |ð
b
;

23576 *
	gv
 = 
a
;

23581 
as£¹
Ð
SLOT_2_0
 == ((0x7f<<14) | (0x7f)) );

23582 
as£¹
Ð
SLOT_4_2_0
 == ((0xfU<<28) | (0x7f<<14) | (0x7f)) );

23584 
	gp
++;

23585 
	ga
 = 
a
<<14;

23586 
	ga
 |ð*
p
;

23588 ià(!(
	ga
&0x80))

23590 
	ga
 &ð
SLOT_2_0
;

23591 
	gb
 &= 0x7f;

23592 
	gb
 = 
b
<<7;

23593 
	ga
 |ð
b
;

23594 *
	gv
 = 
a
;

23599 
	ga
 &ð
SLOT_2_0
;

23600 
	gp
++;

23601 
	gb
 = 
b
<<14;

23602 
	gb
 |ð*
p
;

23604 ià(!(
	gb
&0x80))

23606 
	gb
 &ð
SLOT_2_0
;

23609 
	ga
 = 
a
<<7;

23610 
	ga
 |ð
b
;

23611 *
	gv
 = 
a
;

23620 
	gb
 &ð
SLOT_2_0
;

23621 
	gs
 = 
a
;

23624 
	gp
++;

23625 
	ga
 = 
a
<<14;

23626 
	ga
 |ð*
p
;

23628 ià(!(
	ga
&0x80))

23633 
	gb
 = 
b
<<7;

23634 
	ga
 |ð
b
;

23635 
	gs
 = 
s
>>18;

23636 *
	gv
 = ((
u64
)
s
)<<32 | 
a
;

23641 
	gs
 = 
s
<<7;

23642 
	gs
 |ð
b
;

23645 
	gp
++;

23646 
	gb
 = 
b
<<14;

23647 
	gb
 |ð*
p
;

23649 ià(!(
	gb
&0x80))

23653 
	ga
 &ð
SLOT_2_0
;

23654 
	ga
 = 
a
<<7;

23655 
	ga
 |ð
b
;

23656 
	gs
 = 
s
>>18;

23657 *
	gv
 = ((
u64
)
s
)<<32 | 
a
;

23661 
	gp
++;

23662 
	ga
 = 
a
<<14;

23663 
	ga
 |ð*
p
;

23665 ià(!(
	ga
&0x80))

23667 
	ga
 &ð
SLOT_4_2_0
;

23668 
	gb
 &ð
SLOT_2_0
;

23669 
	gb
 = 
b
<<7;

23670 
	ga
 |ð
b
;

23671 
	gs
 = 
s
>>11;

23672 *
	gv
 = ((
u64
)
s
)<<32 | 
a
;

23677 
	ga
 &ð
SLOT_2_0
;

23678 
	gp
++;

23679 
	gb
 = 
b
<<14;

23680 
	gb
 |ð*
p
;

23682 ià(!(
	gb
&0x80))

23684 
	gb
 &ð
SLOT_4_2_0
;

23687 
	ga
 = 
a
<<7;

23688 
	ga
 |ð
b
;

23689 
	gs
 = 
s
>>4;

23690 *
	gv
 = ((
u64
)
s
)<<32 | 
a
;

23694 
	gp
++;

23695 
	ga
 = 
a
<<15;

23696 
	ga
 |ð*
p
;

23701 
	gb
 &ð
SLOT_2_0
;

23702 
	gb
 = 
b
<<8;

23703 
	ga
 |ð
b
;

23705 
	gs
 = 
s
<<4;

23706 
	gb
 = 
p
[-4];

23707 
	gb
 &= 0x7f;

23708 
	gb
 = 
b
>>3;

23709 
	gs
 |ð
b
;

23711 *
	gv
 = ((
u64
)
s
)<<32 | 
a
;

23727 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘V¬št32
(cÚ¡ *
p
, 
u32
 *
v
){

23728 
u32
 
	ga
,
	gb
;

23732 
	ga
 = *
p
;

23734 #iâdeà
g‘V¬št32


23735 ià(!(
	ga
&0x80))

23738 *
	gv
 = 
a
;

23744 
	gp
++;

23745 
	gb
 = *
p
;

23747 ià(!(
	gb
&0x80))

23750 
	ga
 &= 0x7f;

23751 
	ga
 = 
a
<<7;

23752 *
	gv
 = 
a
 | 
b
;

23757 
	gp
++;

23758 
	ga
 = 
a
<<14;

23759 
	ga
 |ð*
p
;

23761 ià(!(
	ga
&0x80))

23764 
	ga
 &= (0x7f<<14)|(0x7f);

23765 
	gb
 &= 0x7f;

23766 
	gb
 = 
b
<<7;

23767 *
	gv
 = 
a
 | 
b
;

23782 
u64
 
	gv64
;

23783 
u8
 
	gn
;

23785 
	gp
 -= 2;

23786 
	gn
 = 
sql™e3G‘V¬št
(
p
, &
v64
);

23787 
as£¹
Ð
n
>3 &&‚<=9 );

23788 ifÐ(
	gv64
 & 
	gSQLITE_MAX_U32
)!=
v64
 ){

23789 *
v
 = 0xffffffff;

23791 *
	gv
 = (
u32
)
v64
;

23793  
	gn
;

23801 
	gp
++;

23802 
	gb
 = 
b
<<14;

23803 
	gb
 |ð*
p
;

23805 ià(!(
	gb
&0x80))

23808 
	gb
 &= (0x7f<<14)|(0x7f);

23809 
	ga
 &= (0x7f<<14)|(0x7f);

23810 
	ga
 = 
a
<<7;

23811 *
	gv
 = 
a
 | 
b
;

23815 
	gp
++;

23816 
	ga
 = 
a
<<14;

23817 
	ga
 |ð*
p
;

23819 ià(!(
	ga
&0x80))

23822 
	ga
 &ð
SLOT_4_2_0
;

23823 
	gb
 &ð
SLOT_4_2_0
;

23824 
	gb
 = 
b
<<7;

23825 *
	gv
 = 
a
 | 
b
;

23834 
u64
 
	gv64
;

23835 
u8
 
	gn
;

23837 
	gp
 -= 4;

23838 
	gn
 = 
sql™e3G‘V¬št
(
p
, &
v64
);

23839 
as£¹
Ð
n
>5 &&‚<=9 );

23840 *
	gv
 = (
u32
)
v64
;

23841  
	gn
;

23850 
SQLITE_PRIVATE
 
sql™e3V¬štL’
(
u64
 
v
){

23851 
	gi
 = 0;

23853 
	gi
++;

23854 
	gv
 >>= 7;

23855 } 
	gv
!=0 && 
ALWAYS
(
i
<9) );

23856  
	gi
;

23863 
SQLITE_PRIVATE
 
u32
 
sql™e3G‘4by‹
(cÚ¡ 
u8
 *
p
){

23864 
‹¡ÿ£
Ð
p
[0]&0x80 );

23865  (()
	gp
[0]<<24) | (p[1]<<16) | (p[2]<<8) |…[3];

23867 
SQLITE_PRIVATE
 
sql™e3Put4by‹
(*
p
, 
u32
 
v
){

23868 
	gp
[0] = (
u8
)(
v
>>24);

23869 
	gp
[1] = (
u8
)(
v
>>16);

23870 
	gp
[2] = (
u8
)(
v
>>8);

23871 
	gp
[3] = (
u8
)
v
;

23881 
SQLITE_PRIVATE
 
u8
 
sql™e3HexToIÁ
(
h
){

23882 
as£¹
Ð(
h
>='0' && h<='9') || (h>='a' && h<='f') || (h>='A' && h<='F') );

23883 #ifdeà
SQLITE_ASCII


23884 
	gh
 +ð9*(1&(
h
>>6));

23886 #ifdeà
SQLITE_EBCDIC


23887 
	gh
 +ð9*(1&~(
h
>>4));

23889  (
	gu8
)(
	gh
 & 0xf);

23892 #ià!
defšed
(
SQLITE_OMIT_BLOB_LITERAL
è|| defšed(
SQLITE_HAS_CODEC
)

23899 
SQLITE_PRIVATE
 *
sql™e3HexToBlob
(
sql™e3
 *
db
, cÚ¡ *
z
, 
n
){

23900 *
	gzBlob
;

23901 
	gi
;

23903 
	gzBlob
 = (*)
sql™e3DbM®locRaw
(
db
, 
n
/2 + 1);

23904 
	gn
--;

23905 ifÐ
	gzBlob
 ){

23906 
	gi
=0; i<
	gn
; i+=2){

23907 
zBlob
[
i
/2] = (
sql™e3HexToIÁ
(
z
[i])<<4) | sqlite3HexToInt(z[i+1]);

23909 
	gzBlob
[
i
/2] = 0;

23911  
	gzBlob
;

23920 
logBadCÚÃùiÚ
(cÚ¡ *
zTy³
){

23921 
sql™e3_log
(
SQLITE_MISUSE
,

23923 
zTy³


23941 
SQLITE_PRIVATE
 
sql™e3SaãtyCheckOk
(
sql™e3
 *
db
){

23942 
u32
 
	gmagic
;

23943 ifÐ
	gdb
==0 ){

23944 
logBadCÚÃùiÚ
("NULL");

23947 
	gmagic
 = 
db
->
magic
;

23948 ifÐ
	gmagic
!=
SQLITE_MAGIC_OPEN
 ){

23949 ifÐ
sql™e3SaãtyCheckSickOrOk
(
db
) ){

23950 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

23951 
logBadCÚÃùiÚ
("unopened");

23958 
SQLITE_PRIVATE
 
sql™e3SaãtyCheckSickOrOk
(
sql™e3
 *
db
){

23959 
u32
 
	gmagic
;

23960 
	gmagic
 = 
db
->
magic
;

23961 ifÐ
	gmagic
!=
SQLITE_MAGIC_SICK
 &&

23962 
magic
!=
SQLITE_MAGIC_OPEN
 &&

23963 
magic
!=
SQLITE_MAGIC_BUSY
 ){

23964 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

23965 
logBadCÚÃùiÚ
("invalid");

23978 
SQLITE_PRIVATE
 
sql™e3AddIÁ64
(
i64
 *
pA
, i64 
iB
){

23979 
i64
 
	giA
 = *
pA
;

23980 
‹¡ÿ£
Ð
iA
==0 );estcase( iA==1 );

23981 
‹¡ÿ£
Ð
iB
==-1 );estcase( iB==0 );

23982 ifÐ
	giB
>=0 ){

23983 
‹¡ÿ£
Ð
iA
>0 && 
LARGEST_INT64
 - iA =ð
iB
 );

23984 
‹¡ÿ£
Ð
iA
>0 && 
LARGEST_INT64
 - iA =ð
iB
 - 1 );

23985 ifÐ
	giA
>0 && 
	gLARGEST_INT64
 - iA < 
	giB
 )  1;

23987 
‹¡ÿ£
Ð
iA
<0 && -(iA + 
LARGEST_INT64
è=ð
iB
 + 1 );

23988 
‹¡ÿ£
Ð
iA
<0 && -(iA + 
LARGEST_INT64
è=ð
iB
 + 2 );

23989 ifÐ
	giA
<0 && -(iA + 
	gLARGEST_INT64
è> 
	giB
 + 1 )  1;

23991 *
	gpA
 +ð
iB
;

23994 
SQLITE_PRIVATE
 
sql™e3SubIÁ64
(
i64
 *
pA
, i64 
iB
){

23995 
‹¡ÿ£
Ð
iB
==
SMALLEST_INT64
+1 );

23996 ifÐ
	giB
==
SMALLEST_INT64
 ){

23997 
‹¡ÿ£
Ð(*
pA
)==(-1) );estcase( (*pA)==0 );

23998 ifÐ(*
	gpA
)>=0 )  1;

23999 *
	gpA
 -ð
iB
;

24002  
sql™e3AddIÁ64
(
pA
, -
iB
);

24005 
	#TWOPOWER32
 (((
i64
)1)<<32)

	)

24006 
	#TWOPOWER31
 (((
i64
)1)<<31)

	)

24007 
SQLITE_PRIVATE
 
sql™e3MulIÁ64
(
i64
 *
pA
, i64 
iB
){

24008 
i64
 
	giA
 = *
pA
;

24009 
i64
 
	giA1
, 
	giA0
, 
	giB1
, 
	giB0
, 
	gr
;

24011 
	giA1
 = 
iA
/
TWOPOWER32
;

24012 
	giA0
 = 
iA
 % 
TWOPOWER32
;

24013 
	giB1
 = 
iB
/
TWOPOWER32
;

24014 
	giB0
 = 
iB
 % 
TWOPOWER32
;

24015 ifÐ
	giA1
==0 ){

24016 ifÐ
iB1
==0 ){

24017 *
pA
 *ð
iB
;

24020 
	gr
 = 
iA0
*
iB1
;

24021 }ifÐ
	giB1
==0 ){

24022 
r
 = 
iA1
*
iB0
;

24027 
‹¡ÿ£
Ð
r
==(-
TWOPOWER31
)-1 );

24028 
‹¡ÿ£
Ð
r
==(-
TWOPOWER31
) );

24029 
‹¡ÿ£
Ð
r
==
TWOPOWER31
 );

24030 
‹¡ÿ£
Ð
r
==
TWOPOWER31
-1 );

24031 ifÐ
	gr
<(-
	gTWOPOWER31
è||„>=
TWOPOWER31
 )  1;

24032 
	gr
 *ð
TWOPOWER32
;

24033 ifÐ
sql™e3AddIÁ64
(&
r
, 
iA0
*
iB0
) )  1;

24034 *
	gpA
 = 
r
;

24042 
SQLITE_PRIVATE
 
sql™e3AbsIÁ32
(
x
){

24043 ifÐ
	gx
>=0 )  
x
;

24044 ifÐ
	gx
==()0x80000000 )  0x7fffffff;

24045  -
	gx
;

24048 #ifdeà
SQLITE_ENABLE_8_3_NAMES


24066 
SQLITE_PRIVATE
 
sql™e3FžeSuffix3
(cÚ¡ *
zBa£Fž’ame
, *
z
){

24067 #ià
SQLITE_ENABLE_8_3_NAMES
<2

24068 ifÐ
sql™e3_uri_boÞ—n
(
zBa£Fž’ame
, "8_3_names", 0) )

24071 
	gi
, 
	gsz
;

24072 
	gsz
 = 
sql™e3SŒËn30
(
z
);

24073 
	gi
=
sz
-1; i>0 && 
	gz
[
i
]!='/' && 
z
[i]!='.'; i--){}

24074 ifÐ
	gz
[
i
]=='.' && 
ALWAYS
(
sz
>i+4èè
memmove
(&
z
[i+1], &z[sz-3], 4);

24085 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡Add
(LogE¡ 
a
, LogE¡ 
b
){

24086 cÚ¡ 
	gx
[] = {

24097 ifÐ
	ga
>=
b
 ){

24098 ifÐ
a
>
b
+49 ) ‡;

24099 ifÐ
	ga
>
	gb
+31 ) ‡+1;

24100  
	ga
+
	gx
[
a
-
b
];

24102 ifÐ
	gb
>
	ga
+49 )  b;

24103 ifÐ
	gb
>
	ga
+31 )  b+1;

24104  
	gb
+
	gx
[
b
-
a
];

24112 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡
(
u64
 
x
){

24113 
LogE¡
 
	ga
[] = { 0, 2, 3, 5, 6, 7, 8, 9 };

24114 
LogE¡
 
	gy
 = 40;

24115 ifÐ
	gx
<8 ){

24116 ifÐ
	gx
<2 )  0;

24117  
	gx
<8 ){ 
	gy
 -= 10; x <<= 1; }

24119  
	gx
>255 ){ 
	gy
 += 40; x >>= 4; }

24120  
	gx
>15 ){ 
	gy
 += 10; x >>= 1; }

24122  
	ga
[
x
&7] + 
	gy
 - 10;

24125 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


24130 
SQLITE_PRIVATE
 
LogE¡
 
sql™e3LogE¡FromDoubË
(
x
){

24131 
u64
 
	ga
;

24132 
LogE¡
 
	ge
;

24133 
as£¹
Ð(
x
)==8 && (
a
)==8 );

24134 ifÐ
	gx
<=1 )  0;

24135 ifÐ
	gx
<=2000000000 )  
sql™e3LogE¡
((
u64
)
x
);

24136 
memýy
(&
a
, &
x
, 8);

24137 
	ge
 = (
a
>>52) - 1022;

24138  
	ge
*10;

24145 
SQLITE_PRIVATE
 
u64
 
sql™e3LogE¡ToIÁ
(
LogE¡
 
x
){

24146 
u64
 
	gn
;

24147 ifÐ
	gx
<10 )  1;

24148 
	gn
 = 
x
%10;

24149 
	gx
 /= 10;

24150 ifÐ
	gn
>=5 ) 
n
 -= 2;

24151 ifÐ
	gn
>=1 ) 
n
 -= 1;

24152 ifÐ
	gx
>=3 ){

24153  
x
>60 ? (
u64
)
LARGEST_INT64
 : (
n
+8)<<(x-3);

24155  (
	gn
+8)>>(3-
	gx
);

24181 
SQLITE_PRIVATE
 
sql™e3HashIn™
(
Hash
 *
pNew
){

24182 
as£¹
Ð
pNew
!=0 );

24183 
	gpNew
->
	gfœ¡
 = 0;

24184 
	gpNew
->
	gcouÁ
 = 0;

24185 
	gpNew
->
	ghtsize
 = 0;

24186 
	gpNew
->
	ght
 = 0;

24193 
SQLITE_PRIVATE
 
sql™e3HashCË¬
(
Hash
 *
pH
){

24194 
HashEËm
 *
	g–em
;

24196 
as£¹
Ð
pH
!=0 );

24197 
	g–em
 = 
pH
->
fœ¡
;

24198 
	gpH
->
	gfœ¡
 = 0;

24199 
sql™e3_ä“
(
pH
->
ht
);

24200 
	gpH
->
	ght
 = 0;

24201 
	gpH
->
	ghtsize
 = 0;

24202  
	g–em
 ){

24203 
HashEËm
 *
	gÃxt_–em
 = 
–em
->
Ãxt
;

24204 
sql™e3_ä“
(
–em
);

24205 
	g–em
 = 
Ãxt_–em
;

24207 
	gpH
->
	gcouÁ
 = 0;

24213 
¡rHash
(cÚ¡ *
z
){

24214 
	gh
 = 0;

24215 
	gc
;

24216  (
	gc
 = ()*
z
++)!=0 ){

24217 
h
 = (h<<3è^ h ^ 
sql™e3Uµ”ToLow”
[
c
];

24219  
	gh
;

24226 
š£¹EËm’t
(

24227 
Hash
 *
pH
,

24228 
_ht
 *
pEÁry
,

24229 
HashEËm
 *
pNew


24231 
HashEËm
 *
	gpH—d
;

24232 ifÐ
	gpEÁry
 ){

24233 
	gpH—d
 = 
pEÁry
->
couÁ
 ?…EÁry->
chaš
 : 0;

24234 
	gpEÁry
->
	gcouÁ
++;

24235 
	gpEÁry
->
	gchaš
 = 
pNew
;

24237 
	gpH—d
 = 0;

24239 ifÐ
	gpH—d
 ){

24240 
	gpNew
->
	gÃxt
 = 
pH—d
;

24241 
	gpNew
->
	g´ev
 = 
pH—d
->
´ev
;

24242 ifÐ
	gpH—d
->
	g´ev
 ){…H—d->´ev->
	gÃxt
 = 
pNew
; }

24243 { 
	gpH
->
	gfœ¡
 = 
pNew
; }

24244 
	gpH—d
->
	g´ev
 = 
pNew
;

24246 
	gpNew
->
	gÃxt
 = 
pH
->
fœ¡
;

24247 ifÐ
	gpH
->
	gfœ¡
 ){…H->fœ¡->
	g´ev
 = 
pNew
; }

24248 
	gpNew
->
	g´ev
 = 0;

24249 
	gpH
->
	gfœ¡
 = 
pNew
;

24260 
»hash
(
Hash
 *
pH
, 
Ãw_size
){

24261 
_ht
 *
	gÃw_ht
;

24262 
HashEËm
 *
	g–em
, *
	gÃxt_–em
;

24264 #ià
SQLITE_MALLOC_SOFT_LIMIT
>0

24265 ifÐ
Ãw_size
*(
	g_ht
)>
	gSQLITE_MALLOC_SOFT_LIMIT
 ){

24266 
	gÃw_size
 = 
SQLITE_MALLOC_SOFT_LIMIT
/(
_ht
);

24268 ifÐ
	gÃw_size
==
pH
->
htsize
 )  0;

24279 
sql™e3BegšB’ignM®loc
();

24280 
	gÃw_ht
 = (
_ht
 *)
sql™e3M®loc
Ð
Ãw_size
*(_ht) );

24281 
sql™e3EndB’ignM®loc
();

24283 ifÐ
	gÃw_ht
==0 )  0;

24284 
sql™e3_ä“
(
pH
->
ht
);

24285 
	gpH
->
	ght
 = 
Ãw_ht
;

24286 
	gpH
->
	ghtsize
 = 
Ãw_size
 = 
sql™e3M®locSize
(
Ãw_ht
)/(
_ht
);

24287 
mem£t
(
Ãw_ht
, 0, 
Ãw_size
*(
_ht
));

24288 
	g–em
=
pH
->
fœ¡
, 
	gpH
->
	gfœ¡
=0;ƒËm;ƒËm = 
Ãxt_–em
){

24289 
h
 = 
¡rHash
(
–em
->
pKey
è% 
Ãw_size
;

24290 
	gÃxt_–em
 = 
–em
->
Ãxt
;

24291 
š£¹EËm’t
(
pH
, &
Ãw_ht
[
h
], 
–em
);

24300 
HashEËm
 *
fšdEËm’tW™hHash
(

24301 cÚ¡ 
Hash
 *
pH
,

24302 cÚ¡ *
pKey
,

24303 *
pHash


24305 
HashEËm
 *
	g–em
;

24306 
	gcouÁ
;

24307 
	gh
;

24309 ifÐ
	gpH
->
	ght
 ){

24310 
_ht
 *
	gpEÁry
;

24311 
	gh
 = 
¡rHash
(
pKey
è% 
pH
->
htsize
;

24312 
	gpEÁry
 = &
pH
->
ht
[
h
];

24313 
	g–em
 = 
pEÁry
->
chaš
;

24314 
	gcouÁ
 = 
pEÁry
->
couÁ
;

24316 
	gh
 = 0;

24317 
	g–em
 = 
pH
->
fœ¡
;

24318 
	gcouÁ
 = 
pH
->
couÁ
;

24320 *
	gpHash
 = 
h
;

24321  
	gcouÁ
-- ){

24322 
as£¹
Ð
–em
!=0 );

24323 ifÐ
sql™e3SŒICmp
(
–em
->
pKey
,pKey)==0 ){

24324  
–em
;

24326 
	g–em
 = 
–em
->
Ãxt
;

24334 
»moveEËm’tGiv’Hash
(

24335 
Hash
 *
pH
,

24336 
HashEËm
* 
–em
,

24337 
h


24339 
_ht
 *
	gpEÁry
;

24340 ifÐ
	g–em
->
	g´ev
 ){

24341 
	g–em
->
	g´ev
->
	gÃxt
 = 
–em
->
Ãxt
;

24343 
	gpH
->
	gfœ¡
 = 
–em
->
Ãxt
;

24345 ifÐ
	g–em
->
	gÃxt
 ){

24346 
	g–em
->
	gÃxt
->
	g´ev
 = 
–em
->
´ev
;

24348 ifÐ
	gpH
->
	ght
 ){

24349 
	gpEÁry
 = &
pH
->
ht
[
h
];

24350 ifÐ
	gpEÁry
->
	gchaš
==
–em
 ){

24351 
pEÁry
->
chaš
 = 
–em
->
Ãxt
;

24353 
	gpEÁry
->
	gcouÁ
--;

24354 
as£¹
Ð
pEÁry
->
couÁ
>=0 );

24356 
sql™e3_ä“
Ð
–em
 );

24357 
	gpH
->
	gcouÁ
--;

24358 ifÐ
	gpH
->
	gcouÁ
==0 ){

24359 
as£¹
Ð
pH
->
fœ¡
==0 );

24360 
as£¹
Ð
pH
->
couÁ
==0 );

24361 
sql™e3HashCË¬
(
pH
);

24369 
SQLITE_PRIVATE
 *
sql™e3HashFšd
(cÚ¡ 
Hash
 *
pH
, cÚ¡ *
pKey
){

24370 
HashEËm
 *
	g–em
;

24371 
	gh
;

24373 
as£¹
Ð
pH
!=0 );

24374 
as£¹
Ð
pKey
!=0 );

24375 
	g–em
 = 
fšdEËm’tW™hHash
(
pH
, 
pKey
, &
h
);

24376  
	g–em
 ?ƒËm->
	gd©a
 : 0;

24393 
SQLITE_PRIVATE
 *
sql™e3HashIn£¹
(
Hash
 *
pH
, cÚ¡ *
pKey
, *
d©a
){

24394 
	gh
;

24395 
HashEËm
 *
	g–em
;

24396 
HashEËm
 *
	gÃw_–em
;

24398 
as£¹
Ð
pH
!=0 );

24399 
as£¹
Ð
pKey
!=0 );

24400 
	g–em
 = 
fšdEËm’tW™hHash
(
pH
,
pKey
,&
h
);

24401 ifÐ
	g–em
 ){

24402 *
	gÞd_d©a
 = 
–em
->
d©a
;

24403 ifÐ
	gd©a
==0 ){

24404 
»moveEËm’tGiv’Hash
(
pH
,
–em
,
h
);

24406 
	g–em
->
	gd©a
 = 
d©a
;

24407 
	g–em
->
	gpKey
 = 
pKey
;

24409  
	gÞd_d©a
;

24411 ifÐ
	gd©a
==0 )  0;

24412 
	gÃw_–em
 = (
HashEËm
*)
sql™e3M®loc
( (HashElem) );

24413 ifÐ
	gÃw_–em
==0 )  
d©a
;

24414 
	gÃw_–em
->
	gpKey
 = 
pKey
;

24415 
	gÃw_–em
->
	gd©a
 = 
d©a
;

24416 
	gpH
->
	gcouÁ
++;

24417 ifÐ
	gpH
->
	gcouÁ
>=10 && 
pH
->
couÁ
 > 2*pH->
htsize
 ){

24418 ifÐ
»hash
(
pH
,…H->
couÁ
*2) ){

24419 
as£¹
Ð
pH
->
htsize
>0 );

24420 
	gh
 = 
¡rHash
(
pKey
è% 
pH
->
htsize
;

24423 
š£¹EËm’t
(
pH
,…H->
ht
 ? &pH->ht[
h
] : 0, 
Ãw_–em
);

24431 #ià!
defšed
(
SQLITE_OMIT_EXPLAIN
è|| defšed(
VDBE_PROFILE
è|| defšed(
SQLITE_DEBUG
)

24432 #ià
defšed
(
SQLITE_ENABLE_EXPLAIN_COMMENTS
è|| defšed(
SQLITE_DEBUG
)

24433 
	#OpH–p
(
X
è"\0" 
	)
X

24435 
	#OpH–p
(
X
)

	)

24437 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3OpcodeName
(
i
){

24438 cÚ¡ *cÚ¡ 
	gazName
[] = { "?",

24439  "FunùiÚ" 
OpH–p
("r[P3]=func(r[P2@P5])"),

24440  "Sav•ošt" 
OpH–p
(""),

24441  "AutoComm™" 
OpH–p
(""),

24442  "T¿n§ùiÚ" 
OpH–p
(""),

24443  "SÜ‹rNext" 
OpH–p
(""),

24444  "P»vIfO³n" 
OpH–p
(""),

24445  "NextIfO³n" 
OpH–p
(""),

24446  "P»v" 
OpH–p
(""),

24447  "Next" 
OpH–p
(""),

24448  "AggS‹p" 
OpH–p
("accum=r[P3] step(r[P2@P5])"),

24449  "Checkpošt" 
OpH–p
(""),

24450  "Jouº®Mode" 
OpH–p
(""),

24451  "Vacuum" 
OpH–p
(""),

24452  "VFž‹r" 
OpH–p
("iplan=r[P3] zplan='P4'"),

24453  "VUpd©e" 
OpH–p
("data=r[P3@P2]"),

24454  "GÙo" 
OpH–p
(""),

24455  "Gosub" 
OpH–p
(""),

24456  "R‘uº" 
OpH–p
(""),

24457  "NÙ" 
OpH–p
("r[P2]= !r[P1]"),

24458  "In™CÜoutše" 
OpH–p
(""),

24459  "EndCÜoutše" 
OpH–p
(""),

24460  "Y›ld" 
OpH–p
(""),

24461  "H®tIfNuÎ" 
OpH–p
("if„[P3]=null halt"),

24462  "H®t" 
OpH–p
(""),

24463  "IÁeg”" 
OpH–p
("r[P2]=P1"),

24464  "IÁ64" 
OpH–p
("r[P2]=P4"),

24465  "SŒšg" 
OpH–p
("r[P2]='P4' (len=P1)"),

24466  "NuÎ" 
OpH–p
("r[P2..P3]=NULL"),

24467  "SoáNuÎ" 
OpH–p
("r[P1]=NULL"),

24468  "Blob" 
OpH–p
("r[P2]=P4 (len=P1)"),

24469  "V¬ŸbË" 
OpH–p
("r[P2]=parameter(P1,P4)"),

24470  "Move" 
OpH–p
("r[P2@P3]=r[P1@P3]"),

24471  "CÝy" 
OpH–p
("r[P2@P3+1]=r[P1@P3+1]"),

24472  "SCÝy" 
OpH–p
("r[P2]=r[P1]"),

24473  "ResuÉRow" 
OpH–p
("output=r[P1@P2]"),

24474  "CÞlSeq" 
OpH–p
(""),

24475  "AddImm" 
OpH–p
("r[P1]=r[P1]+P2"),

24476  "Mu¡BeIÁ" 
OpH–p
(""),

24477  "R—lAffš™y" 
OpH–p
(""),

24478  "Ca¡" 
OpH–p
("affinity(r[P1])"),

24479  "P”mutiÚ" 
OpH–p
(""),

24480  "Com·»" 
OpH–p
("r[P1@P3] <->„[P2@P3]"),

24481  "Jump" 
OpH–p
(""),

24482  "Onû" 
OpH–p
(""),

24483  "If" 
OpH–p
(""),

24484  "IfNÙ" 
OpH–p
(""),

24485  "CÞumn" 
OpH–p
("r[P3]=PX"),

24486  "Affš™y" 
OpH–p
("affinity(r[P1@P2])"),

24487  "MakeRecÜd" 
OpH–p
("r[P3]=mkrec(r[P1@P2])"),

24488  "CouÁ" 
OpH–p
("r[P2]=count()"),

24489  "R—dCook›" 
OpH–p
(""),

24490  "S‘Cook›" 
OpH–p
(""),

24491  "ReÝ’Idx" 
OpH–p
("root=P2 iDb=P3"),

24492  "O³nR—d" 
OpH–p
("root=P2 iDb=P3"),

24493  "O³nWr™e" 
OpH–p
("root=P2 iDb=P3"),

24494  "O³nAutošdex" 
OpH–p
("nColumn=P2"),

24495  "O³nEphem”®" 
OpH–p
("nColumn=P2"),

24496  "SÜ‹rO³n" 
OpH–p
(""),

24497  "Sequ’ûTe¡" 
OpH–p
("if( cursor[P1].ctr++ )…c = P2"),

24498  "O³nP£udo" 
OpH–p
("P3 columns in„[P2]"),

24499  "Clo£" 
OpH–p
(""),

24500  "S“kLT" 
OpH–p
("key=r[P3@P4]"),

24501  "S“kLE" 
OpH–p
("key=r[P3@P4]"),

24502  "S“kGE" 
OpH–p
("key=r[P3@P4]"),

24503  "S“kGT" 
OpH–p
("key=r[P3@P4]"),

24504  "S“k" 
OpH–p
("intkey=r[P2]"),

24505  "NoCÚæiù" 
OpH–p
("key=r[P3@P4]"),

24506  "NÙFound" 
OpH–p
("key=r[P3@P4]"),

24507  "Found" 
OpH–p
("key=r[P3@P4]"),

24508  "NÙExi¡s" 
OpH–p
("intkey=r[P3]"),

24509  "Or" 
OpH–p
("r[P3]=(r[P1] ||„[P2])"),

24510  "And" 
OpH–p
("r[P3]=(r[P1] &&„[P2])"),

24511  "Sequ’û" 
OpH–p
("r[P2]=cursor[P1].ctr++"),

24512  "NewRowid" 
OpH–p
("r[P2]=rowid"),

24513  "In£¹" 
OpH–p
("intkey=r[P3] data=r[P2]"),

24514  "IsNuÎ" 
OpH–p
("if„[P1]==NULL goto P2"),

24515  "NÙNuÎ" 
OpH–p
("if„[P1]!=NULL goto P2"),

24516  "Ne" 
OpH–p
("if„[P1]!=r[P3] goto P2"),

24517  "Eq" 
OpH–p
("if„[P1]==r[P3] goto P2"),

24518  "Gt" 
OpH–p
("if„[P1]>r[P3] goto P2"),

24519  "Le" 
OpH–p
("if„[P1]<=r[P3] goto P2"),

24520  "Lt" 
OpH–p
("if„[P1]<r[P3] goto P2"),

24521  "Ge" 
OpH–p
("if„[P1]>=r[P3] goto P2"),

24522  "In£¹IÁ" 
OpH–p
("intkey=P3 data=r[P2]"),

24523  "B™And" 
OpH–p
("r[P3]=r[P1]&r[P2]"),

24524  "B™Or" 
OpH–p
("r[P3]=r[P1]|r[P2]"),

24525  "ShiáLeá" 
OpH–p
("r[P3]=r[P2]<<r[P1]"),

24526  "ShiáRight" 
OpH–p
("r[P3]=r[P2]>>r[P1]"),

24527  "Add" 
OpH–p
("r[P3]=r[P1]+r[P2]"),

24528  "SubŒaù" 
OpH–p
("r[P3]=r[P2]-r[P1]"),

24529  "MuÉly" 
OpH–p
("r[P3]=r[P1]*r[P2]"),

24530  "Divide" 
OpH–p
("r[P3]=r[P2]/r[P1]"),

24531  "Remašd”" 
OpH–p
("r[P3]=r[P2]%r[P1]"),

24532  "CÚÿt" 
OpH–p
("r[P3]=r[P2]+r[P1]"),

24533  "D–‘e" 
OpH–p
(""),

24534  "B™NÙ" 
OpH–p
("r[P1]= ~r[P1]"),

24535  "SŒšg8" 
OpH–p
("r[P2]='P4'"),

24536  "Re£tCouÁ" 
OpH–p
(""),

24537  "SÜ‹rCom·»" 
OpH–p
("if key(P1)!=trim(r[P3],P4) goto P2"),

24538  "SÜ‹rD©a" 
OpH–p
("r[P2]=data"),

24539  "RowKey" 
OpH–p
("r[P2]=key"),

24540  "RowD©a" 
OpH–p
("r[P2]=data"),

24541  "Rowid" 
OpH–p
("r[P2]=rowid"),

24542  "NuÎRow" 
OpH–p
(""),

24543  "La¡" 
OpH–p
(""),

24544  "SÜ‹rSÜt" 
OpH–p
(""),

24545  "SÜt" 
OpH–p
(""),

24546  "Rewšd" 
OpH–p
(""),

24547  "SÜ‹rIn£¹" 
OpH–p
(""),

24548  "IdxIn£¹" 
OpH–p
("key=r[P2]"),

24549  "IdxD–‘e" 
OpH–p
("key=r[P2@P3]"),

24550  "IdxRowid" 
OpH–p
("r[P2]=rowid"),

24551  "IdxLE" 
OpH–p
("key=r[P3@P4]"),

24552  "IdxGT" 
OpH–p
("key=r[P3@P4]"),

24553  "IdxLT" 
OpH–p
("key=r[P3@P4]"),

24554  "IdxGE" 
OpH–p
("key=r[P3@P4]"),

24555  "De¡roy" 
OpH–p
(""),

24556  "CË¬" 
OpH–p
(""),

24557  "Re£tSÜ‹r" 
OpH–p
(""),

24558  "C»©eIndex" 
OpH–p
("r[P2]=root iDb=P1"),

24559  "C»©eTabË" 
OpH–p
("r[P2]=root iDb=P1"),

24560  "P¬£Schema" 
OpH–p
(""),

24561  "LßdAÇlysis" 
OpH–p
(""),

24562  "DrÝTabË" 
OpH–p
(""),

24563  "DrÝIndex" 
OpH–p
(""),

24564  "DrÝTrigg”" 
OpH–p
(""),

24565  "IÁegr™yCk" 
OpH–p
(""),

24566  "RowS‘Add" 
OpH–p
("rowset(P1)=r[P2]"),

24567  "RowS‘R—d" 
OpH–p
("r[P3]=rowset(P1)"),

24568  "RowS‘Te¡" 
OpH–p
("if„[P3] in„owset(P1) goto P2"),

24569  "Prog¿m" 
OpH–p
(""),

24570  "P¬am" 
OpH–p
(""),

24571  "R—l" 
OpH–p
("r[P2]=P4"),

24572  "FkCouÁ”" 
OpH–p
("fkctr[P1]+=P2"),

24573  "FkIfZ”o" 
OpH–p
("if fkctr[P1]==0 goto P2"),

24574  "MemMax" 
OpH–p
("r[P1]=max(r[P1],r[P2])"),

24575  "IfPos" 
OpH–p
("if„[P1]>0 goto P2"),

24576  "IfNeg" 
OpH–p
("r[P1]+=P3, if„[P1]<0 goto P2"),

24577  "IfZ”o" 
OpH–p
("r[P1]+=P3, if„[P1]==0 goto P2"),

24578  "AggFš®" 
OpH–p
("accum=r[P1] N=P2"),

24579  "InüVacuum" 
OpH–p
(""),

24580  "Expœe" 
OpH–p
(""),

24581  "TabËLock" 
OpH–p
("iDb=P1„oot=P2 write=P3"),

24582  "VBegš" 
OpH–p
(""),

24583  "VC»©e" 
OpH–p
(""),

24584  "VDe¡roy" 
OpH–p
(""),

24585  "VO³n" 
OpH–p
(""),

24586  "VCÞumn" 
OpH–p
("r[P3]=vcolumn(P2)"),

24587  "VNext" 
OpH–p
(""),

24588  "VR’ame" 
OpH–p
(""),

24589  "PagecouÁ" 
OpH–p
(""),

24590  "MaxPgút" 
OpH–p
(""),

24591  "In™" 
OpH–p
("Start‡t P2"),

24592  "NoÝ" 
OpH–p
(""),

24593  "Ex¶aš" 
OpH–p
(""),

24595  
	gazName
[
i
];

24646 #ià
SQLITE_OS_UNIX


24665 #ià!
defšed
(
SQLITE_ENABLE_LOCKING_STYLE
)

24666 #ià
defšed
(
__APPLE__
)

24667 
	#SQLITE_ENABLE_LOCKING_STYLE
 1

	)

24669 
	#SQLITE_ENABLE_LOCKING_STYLE
 0

	)

24677 #iâdeà
OS_VXWORKS


24678 #ià
defšed
(
__RTP__
è|| defšed(
_WRS_KERNEL
)

24679 
	#OS_VXWORKS
 1

	)

24681 
	#OS_VXWORKS
 0

	)

24688 
	~<sys/ty³s.h
>

24689 
	~<sys/¡©.h
>

24690 
	~<fúŽ.h
>

24691 
	~<uni¡d.h
>

24693 
	~<sys/time.h
>

24694 
	~<”ºo.h
>

24695 #ià!
defšed
(
SQLITE_OMIT_WAL
è|| 
SQLITE_MAX_MMAP_SIZE
>0

24696 
	~<sys/mmª.h
>

24699 #ià
SQLITE_ENABLE_LOCKING_STYLE
 || 
OS_VXWORKS


24700 
	~<sys/ioùl.h
>

24701 #ià
OS_VXWORKS


24702 
	~<£m­hÜe.h
>

24703 
	~<lim™s.h
>

24705 
	~<sys/fže.h
>

24706 
	~<sys/·¿m.h
>

24710 #ià
defšed
(
__APPLE__
è|| (
SQLITE_ENABLE_LOCKING_STYLE
 && !
OS_VXWORKS
)

24711 
	~<sys/mouÁ.h
>

24714 #ifdeà
HAVE_UTIME


24715 
	~<utime.h
>

24721 
	#SQLITE_FSFLAGS_IS_MSDOS
 0x1

	)

24727 #ià
SQLITE_THREADSAFE


24729 
	#SQLITE_UNIX_THREADS
 1

	)

24735 #iâdeà
SQLITE_DEFAULT_FILE_PERMISSIONS


24736 
	#SQLITE_DEFAULT_FILE_PERMISSIONS
 0644

	)

24742 #iâdeà
SQLITE_DEFAULT_PROXYDIR_PERMISSIONS


24743 
	#SQLITE_DEFAULT_PROXYDIR_PERMISSIONS
 0755

	)

24749 
	#MAX_PATHNAME
 512

	)

24755 
	#IS_LOCK_ERROR
(
x
è((x !ð
SQLITE_OK
è&& (x !ð
SQLITE_BUSY
))

	)

24758 
unixShm
 
	tunixShm
;

24759 
unixShmNode
 
	tunixShmNode
;

24760 
unixInodeInfo
 
	tunixInodeInfo
;

24761 
UnixUnu£dFd
 
	tUnixUnu£dFd
;

24769 
	sUnixUnu£dFd
 {

24770 
	gfd
;

24771 
	gæags
;

24772 
UnixUnu£dFd
 *
	gpNext
;

24779 
unixFže
 
	tunixFže
;

24780 
	sunixFže
 {

24781 
sql™e3_io_m‘hods
 cÚ¡ *
	gpM‘hod
;

24782 
sql™e3_vfs
 *
	gpVfs
;

24783 
unixInodeInfo
 *
	gpInode
;

24784 
	gh
;

24785 
	geFžeLock
;

24786 
	gù¾FÏgs
;

24787 
	gÏ¡E¼no
;

24788 *
	glockšgCÚ‹xt
;

24789 
UnixUnu£dFd
 *
	gpUnu£d
;

24790 cÚ¡ *
	gzP©h
;

24791 
unixShm
 *
	gpShm
;

24792 
	gszChunk
;

24793 #ià
SQLITE_MAX_MMAP_SIZE
>0

24794 
	gnF‘chOut
;

24795 
sql™e3_št64
 
	gmm­Size
;

24796 
sql™e3_št64
 
	gmm­SizeAùu®
;

24797 
sql™e3_št64
 
	gmm­SizeMax
;

24798 *
	gpM­RegiÚ
;

24800 #ifdeà
__QNXNTO__


24801 
	g£ùÜSize
;

24802 
	gdeviûCh¬aù”i¡ics
;

24804 #ià
SQLITE_ENABLE_LOCKING_STYLE


24805 
	gÝ’FÏgs
;

24807 #ià
SQLITE_ENABLE_LOCKING_STYLE
 || 
defšed
(
__APPLE__
)

24808 
	gfsFÏgs
;

24810 #ià
OS_VXWORKS


24811 
vxwÜksFžeId
 *
	gpId
;

24813 #ifdeà
SQLITE_DEBUG


24821 
	gŒªsCÁrChng
;

24822 
	gdbUpd©e
;

24823 
	gšNÜm®Wr™e
;

24827 #ifdeà
SQLITE_TEST


24831 
	gaPaddšg
[32];

24839 
	g¿ndomÃssPid
 = 0;

24844 
	#UNIXFILE_EXCL
 0x01

	)

24845 
	#UNIXFILE_RDONLY
 0x02

	)

24846 
	#UNIXFILE_PERSIST_WAL
 0x04

	)

24847 #iâdeà
SQLITE_DISABLE_DIRSYNC


24848 
	#UNIXFILE_DIRSYNC
 0x08

	)

24850 
	#UNIXFILE_DIRSYNC
 0x00

	)

24852 
	#UNIXFILE_PSOW
 0x10

	)

24853 
	#UNIXFILE_DELETE
 0x20

	)

24854 
	#UNIXFILE_URI
 0x40

	)

24855 
	#UNIXFILE_NOLOCK
 0x80

	)

24856 
	#UNIXFILE_WARNED
 0x0100

	)

24882 #iâdeà
_OS_COMMON_H_


24883 
	#_OS_COMMON_H_


	)

24890 #ifdeà
MEMORY_DEBUG


24894 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

24895 #iâdeà
SQLITE_DEBUG_OS_TRACE


24896 
	#SQLITE_DEBUG_OS_TRACE
 0

	)

24898 
	gsql™e3OST¿û
 = 
SQLITE_DEBUG_OS_TRACE
;

24899 
	#OSTRACE
(
X
èifÐ
sql™e3OST¿û
 ) 
sql™e3DebugPrštf
 
	)
X

24901 
	#OSTRACE
(
X
)

	)

24908 #ifdeà
SQLITE_PERFORMANCE_TRACE


24931 #iâdeà
_HWTIME_H_


24932 
	#_HWTIME_H_


	)

24940 #ià(
defšed
(
__GNUC__
è|| defšed(
_MSC_VER
)) && \

24941 (
defšed
(
i386
è|| defšed(
__i386__
è|| defšed(
_M_IX86
))

24943 #ià
defšed
(
__GNUC__
)

24945 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

24946 
	glo
, 
	ghi
;

24947 
__asm__
 
__vÞ©že__
 ("rdtsc" : "÷" (
lo
), "=d" (
hi
));

24948  (
	gsql™e_ušt64
)
	ghi
 << 32 | 
	glo
;

24951 #–ià
defšed
(
_MSC_VER
)

24953 
__deþ¥ec
(
Çked
è
__šlše
 
sql™e_ušt64
 
__cdeþ
 
sql™e3Hwtime
(){

24954 
	g__asm
 {

24955 
rdtsc


24956 
	g»t
 ;  
v®ue
 
©
 
	gEDX
:
EAX


24962 #–ià(
defšed
(
__GNUC__
è&& defšed(
__x86_64__
))

24964 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

24965 
v®
;

24966 
__asm__
 
__vÞ©že__
 ("rdtsc" : "=A" (
v®
));

24967  
	gv®
;

24970 #–ià(
defšed
(
__GNUC__
è&& defšed(
__µc__
))

24972 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

24973 
	g»tv®
;

24974 
	gjunk
;

24975 
__asm__
 
__vÞ©že__
 ("\n\
1: mftbu %1\n\
 %L0\n\
 %0\n\
 %0,%1\n\
 1b"

24981 : "ô" (
»tv®
), "ô" (
junk
));

24982  
	g»tv®
;

24987 #”rÜ 
N“d
 
im¶em’tiÚ
 
of
 
sql™e3Hwtime
(è
your
 
¶©fÜm
.

24996 
SQLITE_PRIVATE
 
sql™e_ušt64
 
sql™e3Hwtime
(){  ((
	gsql™e_ušt64
)0); }

25005 
sql™e_ušt64
 
	gg_¡¬t
;

25006 
sql™e_ušt64
 
	gg_–­£d
;

25007 
	#TIMER_START
 
g_¡¬t
=
	`sql™e3Hwtime
()

	)

25008 
	#TIMER_END
 
g_–­£d
=
	`sql™e3Hwtime
()-
g_¡¬t


	)

25009 
	#TIMER_ELAPSED
 
g_–­£d


	)

25011 
	#TIMER_START


	)

25012 
	#TIMER_END


	)

25013 
	#TIMER_ELAPSED
 ((
sql™e_ušt64
)0)

	)

25021 #ifdeà
SQLITE_TEST


25022 
SQLITE_API
 
	gsql™e3_io_”rÜ_h™
 = 0;

25023 
SQLITE_API
 
	gsql™e3_io_”rÜ_h¬dh™
 = 0;

25024 
SQLITE_API
 
	gsql™e3_io_”rÜ_³ndšg
 = 0;

25025 
SQLITE_API
 
	gsql™e3_io_”rÜ_³rsi¡
 = 0;

25026 
SQLITE_API
 
	gsql™e3_io_”rÜ_b’ign
 = 0;

25027 
SQLITE_API
 
	gsql™e3_diskfuÎ_³ndšg
 = 0;

25028 
SQLITE_API
 
	gsql™e3_diskfuÎ
 = 0;

25029 
	#SimuÏ‹IOE¼ÜB’ign
(
X
è
sql™e3_io_”rÜ_b’ign
=(X)

	)

25030 
	#SimuÏ‹IOE¼Ü
(
CODE
) \

25031 ifÐ(
sql™e3_io_”rÜ_³rsi¡
 && 
sql™e3_io_”rÜ_h™
) \

25032 || 
sql™e3_io_”rÜ_³ndšg
-- == 1 ) \

25033 { 
	`loÿl_iÛ¼
(); 
CODE
; }

	)

25034 
loÿl_iÛ¼
(){

25035 
IOTRACE
(("IOERR\n"));

25036 
	gsql™e3_io_”rÜ_h™
++;

25037 ifÐ!
	gsql™e3_io_”rÜ_b’ign
 ) 
	gsql™e3_io_”rÜ_h¬dh™
++;

25039 
	#SimuÏ‹DiskfuÎE¼Ü
(
CODE
) \

25040 ifÐ
sql™e3_diskfuÎ_³ndšg
 ){ \

25041 ifÐ
sql™e3_diskfuÎ_³ndšg
 == 1 ){ \

25042 
	`loÿl_iÛ¼
(); \

25043 
sql™e3_diskfuÎ
 = 1; \

25044 
sql™e3_io_”rÜ_h™
 = 1; \

25045 
CODE
; \

25047 
sql™e3_diskfuÎ_³ndšg
--; \

25049 }

	)

25051 
	#SimuÏ‹IOE¼ÜB’ign
(
X
)

	)

25052 
	#SimuÏ‹IOE¼Ü
(
A
)

	)

25053 
	#SimuÏ‹DiskfuÎE¼Ü
(
A
)

	)

25059 #ifdeà
SQLITE_TEST


25060 
SQLITE_API
 
	gsql™e3_Ý’_fže_couÁ
 = 0;

25061 
	#O³nCouÁ”
(
X
è
sql™e3_Ý’_fže_couÁ
+=(X)

	)

25063 
	#O³nCouÁ”
(
X
)

	)

25074 #iâdeà
O_LARGEFILE


25075 
	#O_LARGEFILE
 0

	)

25077 #ifdeà
SQLITE_DISABLE_LFS


25078 #undeà
O_LARGEFILE


25079 
	#O_LARGEFILE
 0

	)

25081 #iâdeà
O_NOFOLLOW


25082 
	#O_NOFOLLOW
 0

	)

25084 #iâdeà
O_BINARY


25085 
	#O_BINARY
 0

	)

25092 #ià
SQLITE_THREADSAFE


25093 
	#th»adid
 
	`±h»ad_£lf
()

	)

25095 
	#th»adid
 0

	)

25101 #ià!
defšed
(
HAVE_MREMAP
)

25102 #ià
defšed
(
__lšux__
è&& defšed(
_GNU_SOURCE
)

25103 
	#HAVE_MREMAP
 1

	)

25105 
	#HAVE_MREMAP
 0

	)

25113 #ifdeà
__ANDROID__


25114 
	#l£ek
 
l£ek64


	)

25125 
posixO³n
(cÚ¡ *
zFže
, 
æags
, 
mode
){

25126  
Ý’
(
zFže
, 
æags
, 
mode
);

25134 
posixFchown
(
fd
, 
uid_t
 
uid
, 
gid_t
 
gid
){

25135 #ià
OS_VXWORKS


25138  
g‘euid
(è? 0 : 
fchown
(
fd
,
uid
,
gid
);

25143 
Ý’DœeùÜy
(const *, *);

25144 
unixG‘·gesize
();

25152 
	sunix_sysÿÎ
 {

25153 cÚ¡ *
	gzName
;

25154 
sql™e3_sysÿÎ_±r
 
	gpCu¼’t
;

25155 
sql™e3_sysÿÎ_±r
 
	gpDeçuÉ
;

25156 } 
	gaSysÿÎ
[] = {

25157 { "Ý’", (
sql™e3_sysÿÎ_±r
)
posixO³n
, 0 },

25158 
	#osO³n
 (((*)(cÚ¡ *,,))
aSysÿÎ
[0].
pCu¼’t
)

	)

25160 { "þo£", (
sql™e3_sysÿÎ_±r
)
þo£
, 0 },

25161 
	#osClo£
 (((*)())
aSysÿÎ
[1].
pCu¼’t
)

	)

25163 { "acûss", (
sql™e3_sysÿÎ_±r
)
acûss
, 0 },

25164 
	#osAcûss
 (((*)(cÚ¡ *,))
aSysÿÎ
[2].
pCu¼’t
)

	)

25166 { "g‘cwd", (
sql™e3_sysÿÎ_±r
)
g‘cwd
, 0 },

25167 
	#osG‘cwd
 ((*(*)(*,
size_t
))
aSysÿÎ
[3].
pCu¼’t
)

	)

25169 { "¡©", (
sql™e3_sysÿÎ_±r
)
¡©
, 0 },

25170 
	#osSt
 (((*)(cÚ¡ *,
¡©
*))
aSysÿÎ
[4].
pCu¼’t
)

	)

25178 #ifdeà
__DJGPP__


25180 
	#osF¡©
(
a
,
b
,
c
è0

	)

25182 { "f¡©", (
sql™e3_sysÿÎ_±r
)
f¡©
, 0 },

25183 
	#osF¡©
 (((*)(,
¡©
*))
aSysÿÎ
[5].
pCu¼’t
)

	)

25186 { "árunÿ‹", (
sql™e3_sysÿÎ_±r
)
árunÿ‹
, 0 },

25187 
	#osFŒunÿ‹
 (((*)(,
off_t
))
aSysÿÎ
[6].
pCu¼’t
)

	)

25189 { "fúŽ", (
sql™e3_sysÿÎ_±r
)
fúŽ
, 0 },

25190 
	#osFúŽ
 (((*)(,,...))
aSysÿÎ
[7].
pCu¼’t
)

	)

25192 { "»ad", (
sql™e3_sysÿÎ_±r
)
»ad
, 0 },

25193 
	#osR—d
 ((
	`ssize_t
(*)(,*,
size_t
))
aSysÿÎ
[8].
pCu¼’t
)

	)

25195 #ià
defšed
(
USE_PREAD
è|| (
SQLITE_ENABLE_LOCKING_STYLE
 && !
OS_VXWORKS
)

25196 { "´—d", (
sql™e3_sysÿÎ_±r
)
´—d
, 0 },

25198 { "´—d", (
sql™e3_sysÿÎ_±r
)0, 0 },

25200 
	#osP»ad
 ((
	`ssize_t
(*)(,*,
size_t
,
off_t
))
aSysÿÎ
[9].
pCu¼’t
)

	)

25202 #ià
defšed
(
USE_PREAD64
)

25203 { "´—d64", (
sql™e3_sysÿÎ_±r
)
´—d64
, 0 },

25205 { "´—d64", (
sql™e3_sysÿÎ_±r
)0, 0 },

25207 
	#osP»ad64
 ((
	`ssize_t
(*)(,*,
size_t
,
off_t
))
aSysÿÎ
[10].
pCu¼’t
)

	)

25209 { "wr™e", (
sql™e3_sysÿÎ_±r
)
wr™e
, 0 },

25210 
	#osWr™e
 ((
	`ssize_t
(*)(,cÚ¡ *,
size_t
))
aSysÿÎ
[11].
pCu¼’t
)

	)

25212 #ià
defšed
(
USE_PREAD
è|| (
SQLITE_ENABLE_LOCKING_STYLE
 && !
OS_VXWORKS
)

25213 { "pwr™e", (
sql™e3_sysÿÎ_±r
)
pwr™e
, 0 },

25215 { "pwr™e", (
sql™e3_sysÿÎ_±r
)0, 0 },

25217 
	#osPwr™e
 ((
	`ssize_t
(*)(,cÚ¡ *,
size_t
,
off_t
))\

25218 
aSysÿÎ
[12].
pCu¼’t
)

	)

25220 #ià
defšed
(
USE_PREAD64
)

25221 { "pwr™e64", (
sql™e3_sysÿÎ_±r
)
pwr™e64
, 0 },

25223 { "pwr™e64", (
sql™e3_sysÿÎ_±r
)0, 0 },

25225 
	#osPwr™e64
 ((
	`ssize_t
(*)(,cÚ¡ *,
size_t
,
off_t
))\

25226 
aSysÿÎ
[13].
pCu¼’t
)

	)

25228 { "fchmod", (
sql™e3_sysÿÎ_±r
)
fchmod
, 0 },

25229 
	#osFchmod
 (((*)(,
mode_t
))
aSysÿÎ
[14].
pCu¼’t
)

	)

25231 #ià
defšed
(
HAVE_POSIX_FALLOCATE
) && HAVE_POSIX_FALLOCATE

25232 { "çÎoÿ‹", (
sql™e3_sysÿÎ_±r
)
posix_çÎoÿ‹
, 0 },

25234 { "çÎoÿ‹", (
sql™e3_sysÿÎ_±r
)0, 0 },

25236 
	#osF®loÿ‹
 (((*)(,
off_t
,off_t))
aSysÿÎ
[15].
pCu¼’t
)

	)

25238 { "uÆšk", (
sql™e3_sysÿÎ_±r
)
uÆšk
, 0 },

25239 
	#osUÆšk
 (((*)(cÚ¡ *))
aSysÿÎ
[16].
pCu¼’t
)

	)

25241 { "Ý’DœeùÜy", (
sql™e3_sysÿÎ_±r
)
Ý’DœeùÜy
, 0 },

25242 
	#osO³nDœeùÜy
 (((*)(cÚ¡ *,*))
aSysÿÎ
[17].
pCu¼’t
)

	)

25244 { "mkdœ", (
sql™e3_sysÿÎ_±r
)
mkdœ
, 0 },

25245 
	#osMkdœ
 (((*)(cÚ¡ *,
mode_t
))
aSysÿÎ
[18].
pCu¼’t
)

	)

25247 { "rmdœ", (
sql™e3_sysÿÎ_±r
)
rmdœ
, 0 },

25248 
	#osRmdœ
 (((*)(cÚ¡ *))
aSysÿÎ
[19].
pCu¼’t
)

	)

25250 { "fchown", (
sql™e3_sysÿÎ_±r
)
posixFchown
, 0 },

25251 
	#osFchown
 (((*)(,
uid_t
,
gid_t
))
aSysÿÎ
[20].
pCu¼’t
)

	)

25253 #ià!
defšed
(
SQLITE_OMIT_WAL
è|| 
SQLITE_MAX_MMAP_SIZE
>0

25254 { "mm­", (
sql™e3_sysÿÎ_±r
)
mm­
, 0 },

25255 
	#osMm­
 ((*(*)(*,
size_t
,,,,
off_t
))
aSysÿÎ
[21].
pCu¼’t
)

	)

25257 { "munm­", (
sql™e3_sysÿÎ_±r
)
munm­
, 0 },

25258 
	#osMunm­
 ((*(*)(*,
size_t
))
aSysÿÎ
[22].
pCu¼’t
)

	)

25260 #ià
HAVE_MREMAP


25261 { "m»m­", (
sql™e3_sysÿÎ_±r
)
m»m­
, 0 },

25263 { "m»m­", (
sql™e3_sysÿÎ_±r
)0, 0 },

25265 
	#osM»m­
 ((*(*)(*,
size_t
,size_t,,...))
aSysÿÎ
[23].
pCu¼’t
)

	)

25266 { "g‘·gesize", (
sql™e3_sysÿÎ_±r
)
unixG‘·gesize
, 0 },

25267 
	#osG‘·gesize
 (((*)())
aSysÿÎ
[24].
pCu¼’t
)

	)

25279 
unixS‘Sy¡emC®l
(

25280 
sql™e3_vfs
 *
pNÙU£d
,

25281 cÚ¡ *
zName
,

25282 
sql™e3_sysÿÎ_±r
 
pNewFunc


25284 
	gi
;

25285 
	grc
 = 
SQLITE_NOTFOUND
;

25287 
UNUSED_PARAMETER
(
pNÙU£d
);

25288 ifÐ
	gzName
==0 ){

25292 
rc
 = 
SQLITE_OK
;

25293 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

25294 ifÐ
	gaSysÿÎ
[
i
].
	gpDeçuÉ
 ){

25295 
	gaSysÿÎ
[
i
].
	gpCu¼’t
 = 
aSysÿÎ
[i].
pDeçuÉ
;

25302 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

25303 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ){

25304 ifÐ
aSysÿÎ
[
i
].
pDeçuÉ
==0 ){

25305 
aSysÿÎ
[
i
].
pDeçuÉ
 =‡SysÿÎ[i].
pCu¼’t
;

25307 
	grc
 = 
SQLITE_OK
;

25308 ifÐ
	gpNewFunc
==0 ) 
pNewFunc
 = 
aSysÿÎ
[
i
].
pDeçuÉ
;

25309 
	gaSysÿÎ
[
i
].
	gpCu¼’t
 = 
pNewFunc
;

25314  
	grc
;

25322 
sql™e3_sysÿÎ_±r
 
unixG‘Sy¡emC®l
(

25323 
sql™e3_vfs
 *
pNÙU£d
,

25324 cÚ¡ *
zName


25326 
	gi
;

25328 
UNUSED_PARAMETER
(
pNÙU£d
);

25329 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

25330 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ) ‡SysÿÎ[i].
pCu¼’t
;

25341 cÚ¡ *
unixNextSy¡emC®l
(
sql™e3_vfs
 *
p
, cÚ¡ *
zName
){

25342 
	gi
 = -1;

25344 
UNUSED_PARAMETER
(
p
);

25345 ifÐ
	gzName
 ){

25346 
	gi
=0; i<
A¼aySize
(
aSysÿÎ
)-1; i++){

25347 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ) ;

25350 
	gi
++; i<
A¼aySize
(
aSysÿÎ
); i++){

25351 ifÐ
	gaSysÿÎ
[
i
].
	gpCu¼’t
!=0 )  
aSysÿÎ
[i].
zName
;

25361 #iâdeà
SQLITE_MINIMUM_FILE_DESCRIPTOR


25362 
	#SQLITE_MINIMUM_FILE_DESCRIPTOR
 3

	)

25382 
robu¡_Ý’
(cÚ¡ *
z
, 
f
, 
mode_t
 
m
){

25383 
	gfd
;

25384 
mode_t
 
	gm2
 = 
m
 ? m : 
SQLITE_DEFAULT_FILE_PERMISSIONS
;

25386 #ià
defšed
(
O_CLOEXEC
)

25387 
	gfd
 = 
osO³n
(
z
,
f
|
O_CLOEXEC
,
m2
);

25389 
	gfd
 = 
osO³n
(
z
,
f
,
m2
);

25391 ifÐ
	gfd
<0 ){

25392 ifÐ
	g”ºo
==
EINTR
 ) ;

25395 ifÐ
	gfd
>=
SQLITE_MINIMUM_FILE_DESCRIPTOR
 ) ;

25396 
osClo£
(
fd
);

25397 
sql™e3_log
(
SQLITE_WARNING
,

25398 "©‹m±ØÝ’ \"%s\"‡ fždesütÜ %d", 
z
, 
fd
);

25399 
	gfd
 = -1;

25400 ifÐ
osO³n
("/dev/nuÎ", 
f
, 
m
)<0 ) ;

25402 ifÐ
	gfd
>=0 ){

25403 ifÐ
m
!=0 ){

25404 
¡©
 
¡©buf
;

25405 ifÐ
osF¡©
(
fd
, &
¡©buf
)==0

25406 && 
¡©buf
.
¡_size
==0

25407 && (
¡©buf
.
¡_mode
&0777)!=
m


25409 
osFchmod
(
fd
, 
m
);

25412 #ià
defšed
(
FD_CLOEXEC
è&& (!defšed(
O_CLOEXEC
) || O_CLOEXEC==0)

25413 
osFúŽ
(
fd
, 
F_SETFD
, osFúŽ(fd, 
F_GETFD
, 0è| 
FD_CLOEXEC
);

25416  
	gfd
;

25433 
unixEÁ”Mu‹x
(){

25434 
sql™e3_mu‹x_’‹r
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

25436 
unixL—veMu‹x
(){

25437 
sql™e3_mu‹x_Ëave
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

25439 #ifdeà
SQLITE_DEBUG


25440 
unixMu‹xH–d
() {

25441  
sql™e3_mu‹x_h–d
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

25446 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

25452 cÚ¡ *
azFžeLock
(
eFžeLock
){

25453  
	geFžeLock
 ){

25454 
	gNO_LOCK
:  "NONE";

25455 
	gSHARED_LOCK
:  "SHARED";

25456 
	gRESERVED_LOCK
:  "RESERVED";

25457 
	gPENDING_LOCK
:  "PENDING";

25458 
	gEXCLUSIVE_LOCK
:  "EXCLUSIVE";

25464 #ifdeà
SQLITE_LOCK_TRACE


25473 
lockT¿û
(
fd
, 
Ý
, 
æock
 *
p
){

25474 *
	gzOpName
, *
	gzTy³
;

25475 
	gs
;

25476 
	g§vedE¼no
;

25477 ifÐ
	gÝ
==
F_GETLK
 ){

25478 
zOpName
 = "GETLK";

25479 }ifÐ
	gÝ
==
F_SETLK
 ){

25480 
zOpName
 = "SETLK";

25482 
	gs
 = 
osFúŽ
(
fd
, 
Ý
, 
p
);

25483 
sql™e3DebugPrštf
("fúŽ unknowÀ%d %d %d\n", 
fd
, 
Ý
, 
s
);

25484  
	gs
;

25486 ifÐ
	gp
->
	gl_ty³
==
F_RDLCK
 ){

25487 
zTy³
 = "RDLCK";

25488 }ifÐ
	gp
->
	gl_ty³
==
F_WRLCK
 ){

25489 
zTy³
 = "WRLCK";

25490 }ifÐ
	gp
->
	gl_ty³
==
F_UNLCK
 ){

25491 
zTy³
 = "UNLCK";

25493 
as£¹
( 0 );

25495 
as£¹
Ð
p
->
l_wh’û
==
SEEK_SET
 );

25496 
	gs
 = 
osFúŽ
(
fd
, 
Ý
, 
p
);

25497 
	g§vedE¼no
 = 
”ºo
;

25498 
sql™e3DebugPrštf
("fcntl %d %d %s %s %d %d %d %d\n",

25499 
th»adid
, 
fd
, 
zOpName
, 
zTy³
, ()
p
->
l_¡¬t
, (í->
l_Ën
,

25500 ()
p
->
l_pid
, 
s
);

25501 ifÐ
	gs
==(-1è&& 
Ý
==
F_SETLK
 && (
p
->
l_ty³
==
F_RDLCK
 ||…->l_ty³==
F_WRLCK
) ){

25502 
æock
 
l2
;

25503 
	gl2
 = *
p
;

25504 
osFúŽ
(
fd
, 
F_GETLK
, &
l2
);

25505 ifÐ
	gl2
.
	gl_ty³
==
F_RDLCK
 ){

25506 
zTy³
 = "RDLCK";

25507 }ifÐ
	gl2
.
	gl_ty³
==
F_WRLCK
 ){

25508 
zTy³
 = "WRLCK";

25509 }ifÐ
	gl2
.
	gl_ty³
==
F_UNLCK
 ){

25510 
zTy³
 = "UNLCK";

25512 
as£¹
( 0 );

25514 
sql™e3DebugPrštf
("fcntl-failure-reason: %s %d %d %d\n",

25515 
zTy³
, ()
l2
.
l_¡¬t
, (î2.
l_Ën
, (î2.
l_pid
);

25517 
	g”ºo
 = 
§vedE¼no
;

25518  
	gs
;

25520 #undeà
osFúŽ


25521 
	#osFúŽ
 
lockT¿û


	)

25531 
robu¡_árunÿ‹
(
h
, 
sql™e3_št64
 
sz
){

25532 
	grc
;

25533 #ifdeà
__ANDROID__


25538 ifÐ
	gsz
>(
	gsql™e3_št64
)0x7FFFFFFF ){

25539 
	grc
 = 
SQLITE_OK
;

25542 do{ 
	grc
 = 
osFŒunÿ‹
(
h
,
sz
); }„c<0 && 
	g”ºo
==
EINTR
 );

25543  
	grc
;

25556 
sql™eE¼ÜFromPosixE¼Ü
(
posixE¼Ü
, 
sql™eIOE¼
) {

25557 
	gposixE¼Ü
) {

25571  
SQLITE_OK
;

25574 
	gEAGAIN
:

25575 
ETIMEDOUT
:

25576 
EBUSY
:

25577 
EINTR
:

25578 
ENOLCK
:

25581  
SQLITE_BUSY
;

25583 
	gEACCES
:

25585 ifÐ(
sql™eIOE¼
 =ð
SQLITE_IOERR_LOCK
) ||

25586 (
sql™eIOE¼
 =ð
SQLITE_IOERR_UNLOCK
) ||

25587 (
sql™eIOE¼
 =ð
SQLITE_IOERR_RDLOCK
) ||

25588 (
sql™eIOE¼
 =ð
SQLITE_IOERR_CHECKRESERVEDLOCK
) ){

25589  
SQLITE_BUSY
;

25592 
	gEPERM
:

25593  
SQLITE_PERM
;

25595 #ià
EOPNOTSUPP
!=
ENOTSUP


25596 
	gEOPNOTSUPP
:

25600 #ifdeà
ENOTSUP


25601 
ENOTSUP
:

25605 
EIO
:

25606 
EBADF
:

25607 
EINVAL
:

25608 
ENOTCONN
:

25609 
ENODEV
:

25610 
ENXIO
:

25611 
ENOENT
:

25612 #ifdeà
ESTALE


25613 
ESTALE
:

25615 
ENOSYS
:

25619  
sql™eIOE¼
;

25641 
	svxwÜksFžeId
 {

25642 
vxwÜksFžeId
 *
	gpNext
;

25643 
	gnRef
;

25644 
	gnName
;

25645 *
	gzCªÚiÿlName
;

25648 #ià
OS_VXWORKS


25653 
vxwÜksFžeId
 *
	gvxwÜksFžeLi¡
 = 0;

25668 
vxwÜksSim¶ifyName
(*
z
, 
n
){

25669 
	gi
, 
	gj
;

25670  
	gn
>1 && 
	gz
[
n
-1]=='/' ){‚--; }

25671 
	gi
=
j
=0; i<
	gn
; i++){

25672 ifÐ
	gz
[
i
]=='/' ){

25673 ifÐ
z
[
i
+1]=='/' ) ;

25674 ifÐ
	gz
[
i
+1]=='.' && i+2<
n
 && 
z
[i+2]=='/' ){

25675 
i
 += 1;

25678 ifÐ
	gz
[
i
+1]=='.' && i+3<
n
 && 
z
[i+2]=='.' && z[i+3]=='/' ){

25679  
j
>0 && 
z
[j-1]!='/' ){ j--; }

25680 ifÐ
	gj
>0 ){ j--; }

25681 
	gi
 += 2;

25685 
	gz
[
j
++] = 
z
[
i
];

25687 
	gz
[
j
] = 0;

25688  
	gj
;

25702 
vxwÜksFžeId
 *
vxwÜksFšdFžeId
(cÚ¡ *
zAbsÞu‹Name
){

25703 
vxwÜksFžeId
 *
	gpNew
;

25704 
vxwÜksFžeId
 *
	gpCªdid©e
;

25705 
	gn
;

25707 
as£¹
Ð
zAbsÞu‹Name
[0]=='/' );

25708 
	gn
 = ()
¡¾’
(
zAbsÞu‹Name
);

25709 
	gpNew
 = 
sql™e3_m®loc
Ð(*
pNew
è+ (
n
+1) );

25710 ifÐ
	gpNew
==0 )  0;

25711 
	gpNew
->
	gzCªÚiÿlName
 = (*)&
pNew
[1];

25712 
memýy
(
pNew
->
zCªÚiÿlName
, 
zAbsÞu‹Name
, 
n
+1);

25713 
	gn
 = 
vxwÜksSim¶ifyName
(
pNew
->
zCªÚiÿlName
, 
n
);

25719 
unixEÁ”Mu‹x
();

25720 
	gpCªdid©e
=
vxwÜksFžeLi¡
;…Cªdid©e;…Cªdid©e=
pCªdid©e
->
pNext
){

25721 ifÐ
pCªdid©e
->
nName
==
n


25722 && 
memcmp
(
pCªdid©e
->
zCªÚiÿlName
, 
pNew
->zCªÚiÿlName, 
n
)==0

25724 
sql™e3_ä“
(
pNew
);

25725 
	gpCªdid©e
->
	gnRef
++;

25726 
unixL—veMu‹x
();

25727  
	gpCªdid©e
;

25732 
	gpNew
->
	gnRef
 = 1;

25733 
	gpNew
->
	gnName
 = 
n
;

25734 
	gpNew
->
	gpNext
 = 
vxwÜksFžeLi¡
;

25735 
	gvxwÜksFžeLi¡
 = 
pNew
;

25736 
unixL—veMu‹x
();

25737  
	gpNew
;

25744 
vxwÜksR–—£FžeId
(
vxwÜksFžeId
 *
pId
){

25745 
unixEÁ”Mu‹x
();

25746 
as£¹
Ð
pId
->
nRef
>0 );

25747 
	gpId
->
	gnRef
--;

25748 ifÐ
	gpId
->
	gnRef
==0 ){

25749 
vxwÜksFžeId
 **
µ
;

25750 
	gµ
=&
vxwÜksFžeLi¡
; *µ && *µ!=
pId
;…°ð&((*
µ
)->
pNext
)){}

25751 
as£¹
Ð*
µ
==
pId
 );

25752 *
	gµ
 = 
pId
->
pNext
;

25753 
sql™e3_ä“
(
pId
);

25755 
unixL—veMu‹x
();

25856 
	sunixFžeId
 {

25857 
dev_t
 
	gdev
;

25858 #ià
OS_VXWORKS


25859 
vxwÜksFžeId
 *
	gpId
;

25861 
šo_t
 
	gšo
;

25874 
	sunixInodeInfo
 {

25875 
unixFžeId
 
	gfžeId
;

25876 
	gnSh¬ed
;

25877 
	geFžeLock
;

25878 
	gbProûssLock
;

25879 
	gnRef
;

25880 
unixShmNode
 *
	gpShmNode
;

25881 
	gnLock
;

25882 
UnixUnu£dFd
 *
	gpUnu£d
;

25883 
unixInodeInfo
 *
	gpNext
;

25884 
unixInodeInfo
 *
	gpP»v
;

25885 #ià
SQLITE_ENABLE_LOCKING_STYLE


25886 
	gsh¬edBy‹
;

25888 #ià
OS_VXWORKS


25889 
£m_t
 *
	gpSem
;

25890 
	gaSemName
[
MAX_PATHNAME
+2];

25897 
unixInodeInfo
 *
	gšodeLi¡
 = 0;

25915 
	#unixLogE¼Ü
(
a
,
b
,
c
è
	`unixLogE¼ÜAtLše
×,b,c,
__LINE__
)

	)

25916 
unixLogE¼ÜAtLše
(

25917 
”rcode
,

25918 cÚ¡ *
zFunc
,

25919 cÚ¡ *
zP©h
,

25920 
iLše


25922 *
	gzE¼
;

25923 
	giE¼no
 = 
”ºo
;

25929 #ià
SQLITE_THREADSAFE
 && 
defšed
(
HAVE_STRERROR_R
)

25930 
	gaE¼
[80];

25931 
mem£t
(
aE¼
, 0, (aErr));

25932 
	gzE¼
 = 
aE¼
;

25946 #ià
defšed
(
STRERROR_R_CHAR_P
è|| defšed(
__USE_GNU
)

25947 
	gzE¼
 =

25949 
¡»¼Ü_r
(
iE¼no
, 
aE¼
, (aErr)-1);

25951 #–ià
SQLITE_THREADSAFE


25953 
	gzE¼
 = "";

25956 
	gzE¼
 = 
¡»¼Ü
(
iE¼no
);

25959 ifÐ
	gzP©h
==0 ) 
zP©h
 = "";

25960 
sql™e3_log
(
”rcode
,

25962 
iLše
, 
iE¼no
, 
zFunc
, 
zP©h
, 
zE¼


25965  
	g”rcode
;

25981 
robu¡_þo£
(
unixFže
 *
pFže
, 
h
, 
lš’o
){

25982 ifÐ
osClo£
(
h
) ){

25983 
unixLogE¼ÜAtLše
(
SQLITE_IOERR_CLOSE
, "close",

25984 
pFže
 ?…Fže->
zP©h
 : 0, 
lš’o
);

25991 
þo£P’dšgFds
(
unixFže
 *
pFže
){

25992 
unixInodeInfo
 *
	gpInode
 = 
pFže
->
pInode
;

25993 
UnixUnu£dFd
 *
	gp
;

25994 
UnixUnu£dFd
 *
	gpNext
;

25995 
	gp
=
pInode
->
pUnu£d
;…;…=
pNext
){

25996 
pNext
 = 
p
->pNext;

25997 
robu¡_þo£
(
pFže
, 
p
->
fd
, 
__LINE__
);

25998 
sql™e3_ä“
(
p
);

26000 
	gpInode
->
	gpUnu£d
 = 0;

26009 
»Ëa£InodeInfo
(
unixFže
 *
pFže
){

26010 
unixInodeInfo
 *
	gpInode
 = 
pFže
->
pInode
;

26011 
as£¹
Ð
unixMu‹xH–d
() );

26012 ifÐ
ALWAYS
(
pInode
) ){

26013 
	gpInode
->
	gnRef
--;

26014 ifÐ
	gpInode
->
	gnRef
==0 ){

26015 
as£¹
Ð
pInode
->
pShmNode
==0 );

26016 
þo£P’dšgFds
(
pFže
);

26017 ifÐ
	gpInode
->
	gpP»v
 ){

26018 
as£¹
Ð
pInode
->
pP»v
->
pNext
==pInode );

26019 
	gpInode
->
	gpP»v
->
	gpNext
 = 
pInode
->
pNext
;

26021 
as£¹
Ð
šodeLi¡
==
pInode
 );

26022 
	gšodeLi¡
 = 
pInode
->
pNext
;

26024 ifÐ
	gpInode
->
	gpNext
 ){

26025 
as£¹
Ð
pInode
->
pNext
->
pP»v
==pInode );

26026 
	gpInode
->
	gpNext
->
	gpP»v
 = 
pInode
->
pP»v
;

26028 
sql™e3_ä“
(
pInode
);

26043 
fšdInodeInfo
(

26044 
unixFže
 *
pFže
,

26045 
unixInodeInfo
 **
µInode


26047 
	grc
;

26048 
	gfd
;

26049 
unixFžeId
 
	gfžeId
;

26050 
¡©
 
	g¡©buf
;

26051 
unixInodeInfo
 *
	gpInode
 = 0;

26053 
as£¹
Ð
unixMu‹xH–d
() );

26058 
	gfd
 = 
pFže
->
h
;

26059 
	grc
 = 
osF¡©
(
fd
, &
¡©buf
);

26060 ifÐ
	grc
!=0 ){

26061 
pFže
->
Ï¡E¼no
 = 
”ºo
;

26062 #ifdeà
EOVERFLOW


26063 ifÐ
	gpFže
->
	gÏ¡E¼no
==
EOVERFLOW
 )  
SQLITE_NOLFS
;

26065  
	gSQLITE_IOERR
;

26068 #ifdeà
__APPLE__


26079 ifÐ
	g¡©buf
.
	g¡_size
==0 && (
pFže
->
fsFÏgs
 & 
SQLITE_FSFLAGS_IS_MSDOS
)!=0 ){

26080 do{ 
rc
 = 
osWr™e
(
fd
, "S", 1); } 
	grc
<0 && 
	g”ºo
==
EINTR
 );

26081 ifÐ
	grc
!=1 ){

26082 
pFže
->
Ï¡E¼no
 = 
”ºo
;

26083  
	gSQLITE_IOERR
;

26085 
	grc
 = 
osF¡©
(
fd
, &
¡©buf
);

26086 ifÐ
	grc
!=0 ){

26087 
pFže
->
Ï¡E¼no
 = 
”ºo
;

26088  
	gSQLITE_IOERR
;

26093 
mem£t
(&
fžeId
, 0, (fileId));

26094 
	gfžeId
.
	gdev
 = 
¡©buf
.
¡_dev
;

26095 #ià
OS_VXWORKS


26096 
	gfžeId
.
	gpId
 = 
pFže
->
pId
;

26098 
	gfžeId
.
	gšo
 = 
¡©buf
.
¡_šo
;

26100 
	gpInode
 = 
šodeLi¡
;

26101  
	gpInode
 && 
memcmp
(&
fžeId
, &
pInode
->fileId, (fileId)) ){

26102 
	gpInode
 = 
pInode
->
pNext
;

26104 ifÐ
	gpInode
==0 ){

26105 
pInode
 = 
sql™e3_m®loc
( (*pInode) );

26106 ifÐ
	gpInode
==0 ){

26107  
SQLITE_NOMEM
;

26109 
mem£t
(
pInode
, 0, (*pInode));

26110 
memýy
(&
pInode
->
fžeId
, &fileId, (fileId));

26111 
	gpInode
->
	gnRef
 = 1;

26112 
	gpInode
->
	gpNext
 = 
šodeLi¡
;

26113 
	gpInode
->
	gpP»v
 = 0;

26114 ifÐ
	gšodeLi¡
 ) inodeLi¡->
	gpP»v
 = 
pInode
;

26115 
	gšodeLi¡
 = 
pInode
;

26117 
	gpInode
->
	gnRef
++;

26119 *
	gµInode
 = 
pInode
;

26120  
	gSQLITE_OK
;

26126 
fžeHasMoved
(
unixFže
 *
pFže
){

26127 #ià
OS_VXWORKS


26128  
	gpFže
->
	gpInode
!=0 && 
pFže
->
pId
!õFže->
pInode
->
fžeId
.pId;

26130 
¡©
 
	gbuf
;

26131  
	gpFže
->
	gpInode
!=0 &&

26132 (
osSt
(
pFže
->
zP©h
, &
buf
)!=0 || buf.
¡_šo
!õFže->
pInode
->
fžeId
.
šo
);

26146 
v”ifyDbFže
(
unixFže
 *
pFže
){

26147 
¡©
 
	gbuf
;

26148 
	grc
;

26149 ifÐ
	gpFže
->
	gù¾FÏgs
 & 
	gUNIXFILE_WARNED
 ){

26154 
	grc
 = 
osF¡©
(
pFže
->
h
, &
buf
);

26155 ifÐ
	grc
!=0 ){

26156 
sql™e3_log
(
SQLITE_WARNING
, "ÿÂÙ f¡© db fž%s", 
pFže
->
zP©h
);

26157 
	gpFže
->
	gù¾FÏgs
 |ð
UNIXFILE_WARNED
;

26160 ifÐ
	gbuf
.
	g¡_Æšk
==0 && (
pFže
->
ù¾FÏgs
 & 
UNIXFILE_DELETE
)==0 ){

26161 
sql™e3_log
(
SQLITE_WARNING
, "fžuÆšked whžÝ’: %s", 
pFže
->
zP©h
);

26162 
	gpFže
->
	gù¾FÏgs
 |ð
UNIXFILE_WARNED
;

26165 ifÐ
	gbuf
.
	g¡_Æšk
>1 ){

26166 
sql™e3_log
(
SQLITE_WARNING
, "muÉË†šk tØfže: %s", 
pFže
->
zP©h
);

26167 
	gpFže
->
	gù¾FÏgs
 |ð
UNIXFILE_WARNED
;

26170 ifÐ
fžeHasMoved
(
pFže
) ){

26171 
sql™e3_log
(
SQLITE_WARNING
, "fž»Çmed whžÝ’: %s", 
pFže
->
zP©h
);

26172 
	gpFže
->
	gù¾FÏgs
 |ð
UNIXFILE_WARNED
;

26184 
unixCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
){

26185 
	grc
 = 
SQLITE_OK
;

26186 
	g»£rved
 = 0;

26187 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26189 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

26191 
as£¹
Ð
pFže
 );

26192 
unixEÁ”Mu‹x
();

26195 ifÐ
	gpFže
->
	gpInode
->
	geFžeLock
>
	gSHARED_LOCK
 ){

26196 
	g»£rved
 = 1;

26201 #iâdeà
__DJGPP__


26202 ifÐ!
	g»£rved
 && !
	gpFže
->
	gpInode
->
	gbProûssLock
 ){

26203 
æock
 
	glock
;

26204 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26205 
	glock
.
	gl_¡¬t
 = 
RESERVED_BYTE
;

26206 
	glock
.
	gl_Ën
 = 1;

26207 
	glock
.
	gl_ty³
 = 
F_WRLCK
;

26208 ifÐ
osFúŽ
(
pFže
->
h
, 
F_GETLK
, &
lock
) ){

26209 
	grc
 = 
SQLITE_IOERR_CHECKRESERVEDLOCK
;

26210 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

26211 } ifÐ
	glock
.
	gl_ty³
!=
F_UNLCK
 ){

26212 
»£rved
 = 1;

26217 
unixL—veMu‹x
();

26218 
OSTRACE
(("TEST WR-LOCK %d %d %d (unix)\n", 
pFže
->
h
, 
rc
, 
»£rved
));

26220 *
	gpResOut
 = 
»£rved
;

26221  
	grc
;

26243 
unixFžeLock
(
unixFže
 *
pFže
, 
æock
 *
pLock
){

26244 
	grc
;

26245 
unixInodeInfo
 *
	gpInode
 = 
pFže
->
pInode
;

26246 
as£¹
Ð
unixMu‹xH–d
() );

26247 
as£¹
Ð
pInode
!=0 );

26248 ifÐ((
	gpFže
->
	gù¾FÏgs
 & 
	gUNIXFILE_EXCL
)!=0 || 
pInode
->
bProûssLock
)

26249 && ((
pFže
->
ù¾FÏgs
 & 
UNIXFILE_RDONLY
)==0)

26251 ifÐ
pInode
->
bProûssLock
==0 ){

26252 
æock
 
lock
;

26253 
as£¹
Ð
pInode
->
nLock
==0 );

26254 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26255 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26256 
	glock
.
	gl_Ën
 = 
SHARED_SIZE
;

26257 
	glock
.
	gl_ty³
 = 
F_WRLCK
;

26258 
	grc
 = 
osFúŽ
(
pFže
->
h
, 
F_SETLK
, &
lock
);

26259 ifÐ
	grc
<0 ) „c;

26260 
	gpInode
->
	gbProûssLock
 = 1;

26261 
	gpInode
->
	gnLock
++;

26263 
	grc
 = 0;

26266 
	grc
 = 
osFúŽ
(
pFže
->
h
, 
F_SETLK
, 
pLock
);

26268  
	grc
;

26295 
unixLock
(
sql™e3_fže
 *
id
, 
eFžeLock
){

26334 
	grc
 = 
SQLITE_OK
;

26335 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26336 
unixInodeInfo
 *
	gpInode
;

26337 
æock
 
	glock
;

26338 
	gtE¼no
 = 0;

26340 
as£¹
Ð
pFže
 );

26341 
OSTRACE
(("LOCK %d % wa %s(%s,%dèpid=%d (unix)\n", 
pFže
->
h
,

26342 
azFžeLock
(
eFžeLock
),‡zFžeLock(
pFže
->eFileLock),

26343 
azFžeLock
(
pFže
->
pInode
->
eFžeLock
),…Fže->pInode->
nSh¬ed
 , 
g‘pid
()));

26349 ifÐ
	gpFže
->
	geFžeLock
>=
eFžeLock
 ){

26350 
OSTRACE
(("LOCK %d % ok (®»ady h–dè(unix)\n", 
pFže
->
h
,

26351 
azFžeLock
(
eFžeLock
)));

26352  
	gSQLITE_OK
;

26360 
as£¹
Ð
pFže
->
eFžeLock
!=
NO_LOCK
 ||ƒFžeLock==
SHARED_LOCK
 );

26361 
as£¹
Ð
eFžeLock
!=
PENDING_LOCK
 );

26362 
as£¹
Ð
eFžeLock
!=
RESERVED_LOCK
 || 
pFže
->eFžeLock==
SHARED_LOCK
 );

26366 
unixEÁ”Mu‹x
();

26367 
	gpInode
 = 
pFže
->
pInode
;

26372 ifÐ(
	gpFže
->
	geFžeLock
!=
pInode
->
eFžeLock
 &&

26373 (
pInode
->
eFžeLock
>=
PENDING_LOCK
 ||ƒFžeLock>
SHARED_LOCK
))

26375 
rc
 = 
SQLITE_BUSY
;

26376 
	g’d_lock
;

26383 ifÐ
	geFžeLock
==
SHARED_LOCK
 &&

26384 (
pInode
->
eFžeLock
==
SHARED_LOCK
 ||…Inode->eFžeLock==
RESERVED_LOCK
) ){

26385 
as£¹
Ð
eFžeLock
==
SHARED_LOCK
 );

26386 
as£¹
Ð
pFže
->
eFžeLock
==0 );

26387 
as£¹
Ð
pInode
->
nSh¬ed
>0 );

26388 
	gpFže
->
	geFžeLock
 = 
SHARED_LOCK
;

26389 
	gpInode
->
	gnSh¬ed
++;

26390 
	gpInode
->
	gnLock
++;

26391 
	g’d_lock
;

26399 
	glock
.
	gl_Ën
 = 1L;

26400 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26401 ifÐ
	geFžeLock
==
SHARED_LOCK


26402 || (
eFžeLock
==
EXCLUSIVE_LOCK
 && 
pFže
->eFžeLock<
PENDING_LOCK
)

26404 
lock
.
l_ty³
 = (
eFžeLock
==
SHARED_LOCK
?
F_RDLCK
:
F_WRLCK
);

26405 
	glock
.
	gl_¡¬t
 = 
PENDING_BYTE
;

26406 ifÐ
unixFžeLock
(
pFže
, &
lock
) ){

26407 
	gtE¼no
 = 
”ºo
;

26408 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

26409 ifÐ
	grc
!=
SQLITE_BUSY
 ){

26410 
pFže
->
Ï¡E¼no
 = 
tE¼no
;

26412 
	g’d_lock
;

26420 ifÐ
	geFžeLock
==
SHARED_LOCK
 ){

26421 
as£¹
Ð
pInode
->
nSh¬ed
==0 );

26422 
as£¹
Ð
pInode
->
eFžeLock
==0 );

26423 
as£¹
Ð
rc
==
SQLITE_OK
 );

26426 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26427 
	glock
.
	gl_Ën
 = 
SHARED_SIZE
;

26428 ifÐ
unixFžeLock
(
pFže
, &
lock
) ){

26429 
	gtE¼no
 = 
”ºo
;

26430 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

26434 
	glock
.
	gl_¡¬t
 = 
PENDING_BYTE
;

26435 
	glock
.
	gl_Ën
 = 1L;

26436 
	glock
.
	gl_ty³
 = 
F_UNLCK
;

26437 ifÐ
unixFžeLock
(
pFže
, &
lock
è&& 
	grc
==
SQLITE_OK
 ){

26439 
tE¼no
 = 
”ºo
;

26440 
	grc
 = 
SQLITE_IOERR_UNLOCK
;

26443 ifÐ
	grc
 ){

26444 ifÐ
	grc
!=
SQLITE_BUSY
 ){

26445 
pFže
->
Ï¡E¼no
 = 
tE¼no
;

26447 
	g’d_lock
;

26449 
	gpFže
->
	geFžeLock
 = 
SHARED_LOCK
;

26450 
	gpInode
->
	gnLock
++;

26451 
	gpInode
->
	gnSh¬ed
 = 1;

26453 }ifÐ
	geFžeLock
==
EXCLUSIVE_LOCK
 && 
pInode
->
nSh¬ed
>1 ){

26456 
rc
 = 
SQLITE_BUSY
;

26462 
as£¹
Ð0!=
pFže
->
eFžeLock
 );

26463 
	glock
.
	gl_ty³
 = 
F_WRLCK
;

26465 
as£¹
Ð
eFžeLock
==
RESERVED_LOCK
 ||ƒFžeLock==
EXCLUSIVE_LOCK
 );

26466 ifÐ
	geFžeLock
==
RESERVED_LOCK
 ){

26467 
lock
.
l_¡¬t
 = 
RESERVED_BYTE
;

26468 
	glock
.
	gl_Ën
 = 1L;

26470 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26471 
	glock
.
	gl_Ën
 = 
SHARED_SIZE
;

26474 ifÐ
unixFžeLock
(
pFže
, &
lock
) ){

26475 
	gtE¼no
 = 
”ºo
;

26476 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

26477 ifÐ
	grc
!=
SQLITE_BUSY
 ){

26478 
pFže
->
Ï¡E¼no
 = 
tE¼no
;

26484 #ifdeà
SQLITE_DEBUG


26490 ifÐ
	grc
==
SQLITE_OK


26491 && 
pFže
->
eFžeLock
<=
SHARED_LOCK


26492 && 
eFžeLock
==
RESERVED_LOCK


26494 
pFže
->
ŒªsCÁrChng
 = 0;

26495 
	gpFže
->
	gdbUpd©e
 = 0;

26496 
	gpFže
->
	gšNÜm®Wr™e
 = 1;

26501 ifÐ
	grc
==
SQLITE_OK
 ){

26502 
pFže
->
eFžeLock
 =ƒFileLock;

26503 
	gpInode
->
	geFžeLock
 = 
eFžeLock
;

26504 }ifÐ
	geFžeLock
==
EXCLUSIVE_LOCK
 ){

26505 
pFže
->
eFžeLock
 = 
PENDING_LOCK
;

26506 
	gpInode
->
	geFžeLock
 = 
PENDING_LOCK
;

26509 
	g’d_lock
:

26510 
unixL—veMu‹x
();

26511 
OSTRACE
(("LOCK %d % % (unix)\n", 
pFže
->
h
, 
azFžeLock
(
eFžeLock
),

26512 
rc
==
SQLITE_OK
 ? "ok" : "failed"));

26513  
	grc
;

26520 
£tP’dšgFd
(
unixFže
 *
pFže
){

26521 
unixInodeInfo
 *
	gpInode
 = 
pFže
->
pInode
;

26522 
UnixUnu£dFd
 *
	gp
 = 
pFže
->
pUnu£d
;

26523 
	gp
->
	gpNext
 = 
pInode
->
pUnu£d
;

26524 
	gpInode
->
	gpUnu£d
 = 
p
;

26525 
	gpFže
->
	gh
 = -1;

26526 
	gpFže
->
	gpUnu£d
 = 0;

26542 
posixUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
, 
hªdËNFSUÆock
){

26543 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26544 
unixInodeInfo
 *
	gpInode
;

26545 
æock
 
	glock
;

26546 
	grc
 = 
SQLITE_OK
;

26548 
as£¹
Ð
pFže
 );

26549 
OSTRACE
(("UNLOCK %d %d wa %d(%d,%dèpid=%d (unix)\n", 
pFže
->
h
, 
eFžeLock
,

26550 
pFže
->
eFžeLock
,…Fže->
pInode
->eFžeLock,…Fže->pInode->
nSh¬ed
,

26551 
g‘pid
()));

26553 
as£¹
Ð
eFžeLock
<=
SHARED_LOCK
 );

26554 ifÐ
	gpFže
->
	geFžeLock
<=
eFžeLock
 ){

26555  
SQLITE_OK
;

26557 
unixEÁ”Mu‹x
();

26558 
	gpInode
 = 
pFže
->
pInode
;

26559 
as£¹
Ð
pInode
->
nSh¬ed
!=0 );

26560 ifÐ
	gpFže
->
	geFžeLock
>
	gSHARED_LOCK
 ){

26561 
as£¹
Ð
pInode
->
eFžeLock
==
pFže
->eFileLock );

26563 #ifdeà
SQLITE_DEBUG


26572 
	gpFže
->
	gšNÜm®Wr™e
 = 0;

26584 ifÐ
	geFžeLock
==
SHARED_LOCK
 ){

26586 #ià!
defšed
(
__APPLE__
è|| !
SQLITE_ENABLE_LOCKING_STYLE


26587 ()
hªdËNFSUÆock
;

26588 
as£¹
Ð
hªdËNFSUÆock
==0 );

26590 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


26591 ifÐ
	ghªdËNFSUÆock
 ){

26592 
	gtE¼no
;

26593 
off_t
 
	gdivSize
 = 
SHARED_SIZE
 - 1;

26595 
	glock
.
	gl_ty³
 = 
F_UNLCK
;

26596 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26597 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26598 
	glock
.
	gl_Ën
 = 
divSize
;

26599 ifÐ
unixFžeLock
(
pFže
, &
lock
)==(-1) ){

26600 
tE¼no
 = 
”ºo
;

26601 
	grc
 = 
SQLITE_IOERR_UNLOCK
;

26602 ifÐ
IS_LOCK_ERROR
(
rc
) ){

26603 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

26605 
	g’d_uÆock
;

26607 
	glock
.
	gl_ty³
 = 
F_RDLCK
;

26608 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26609 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26610 
	glock
.
	gl_Ën
 = 
divSize
;

26611 ifÐ
unixFžeLock
(
pFže
, &
lock
)==(-1) ){

26612 
tE¼no
 = 
”ºo
;

26613 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_RDLOCK
);

26614 ifÐ
IS_LOCK_ERROR
(
rc
) ){

26615 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

26617 
	g’d_uÆock
;

26619 
	glock
.
	gl_ty³
 = 
F_UNLCK
;

26620 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26621 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
+
divSize
;

26622 
	glock
.
	gl_Ën
 = 
SHARED_SIZE
-
divSize
;

26623 ifÐ
unixFžeLock
(
pFže
, &
lock
)==(-1) ){

26624 
tE¼no
 = 
”ºo
;

26625 
	grc
 = 
SQLITE_IOERR_UNLOCK
;

26626 ifÐ
IS_LOCK_ERROR
(
rc
) ){

26627 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

26629 
	g’d_uÆock
;

26634 
	glock
.
	gl_ty³
 = 
F_RDLCK
;

26635 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26636 
	glock
.
	gl_¡¬t
 = 
SHARED_FIRST
;

26637 
	glock
.
	gl_Ën
 = 
SHARED_SIZE
;

26638 ifÐ
unixFžeLock
(
pFže
, &
lock
) ){

26645 
	grc
 = 
SQLITE_IOERR_RDLOCK
;

26646 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

26647 
	g’d_uÆock
;

26651 
	glock
.
	gl_ty³
 = 
F_UNLCK
;

26652 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26653 
	glock
.
	gl_¡¬t
 = 
PENDING_BYTE
;

26654 
	glock
.
	gl_Ën
 = 2L; 
as£¹
Ð
PENDING_BYTE
+1==
RESERVED_BYTE
 );

26655 ifÐ
unixFžeLock
(
pFže
, &
lock
)==0 ){

26656 
pInode
->
eFžeLock
 = 
SHARED_LOCK
;

26658 
	grc
 = 
SQLITE_IOERR_UNLOCK
;

26659 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

26660 
	g’d_uÆock
;

26663 ifÐ
	geFžeLock
==
NO_LOCK
 ){

26668 
pInode
->
nSh¬ed
--;

26669 ifÐ
	gpInode
->
	gnSh¬ed
==0 ){

26670 
lock
.
l_ty³
 = 
F_UNLCK
;

26671 
	glock
.
	gl_wh’û
 = 
SEEK_SET
;

26672 
	glock
.
	gl_¡¬t
 = 
lock
.
l_Ën
 = 0L;

26673 ifÐ
unixFžeLock
(
pFže
, &
lock
)==0 ){

26674 
pInode
->
eFžeLock
 = 
NO_LOCK
;

26676 
	grc
 = 
SQLITE_IOERR_UNLOCK
;

26677 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

26678 
	gpInode
->
	geFžeLock
 = 
NO_LOCK
;

26679 
	gpFže
->
	geFžeLock
 = 
NO_LOCK
;

26687 
	gpInode
->
	gnLock
--;

26688 
as£¹
Ð
pInode
->
nLock
>=0 );

26689 ifÐ
	gpInode
->
	gnLock
==0 ){

26690 
þo£P’dšgFds
(
pFže
);

26694 
	g’d_uÆock
:

26695 
unixL—veMu‹x
();

26696 ifÐ
	grc
==
SQLITE_OK
 ) 
pFže
->
eFžeLock
 =ƒFileLock;

26697  
	grc
;

26707 
unixUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
){

26708 #ià
SQLITE_MAX_MMAP_SIZE
>0

26709 
as£¹
Ð
eFžeLock
==
SHARED_LOCK
 || ((
unixFže
 *)
id
)->
nF‘chOut
==0 );

26711  
posixUÆock
(
id
, 
eFžeLock
, 0);

26714 #ià
SQLITE_MAX_MMAP_SIZE
>0

26715 
unixM­fže
(
unixFže
 *
pFd
, 
i64
 
nBy‹
);

26716 
unixUnm­fže
(
unixFže
 *
pFd
);

26729 
þo£UnixFže
(
sql™e3_fže
 *
id
){

26730 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26731 #ià
SQLITE_MAX_MMAP_SIZE
>0

26732 
unixUnm­fže
(
pFže
);

26734 ifÐ
	gpFže
->
	gh
>=0 ){

26735 
robu¡_þo£
(
pFže
,…Fže->
h
, 
__LINE__
);

26736 
	gpFže
->
	gh
 = -1;

26738 #ià
OS_VXWORKS


26739 ifÐ
	gpFže
->
	gpId
 ){

26740 ifÐ
	gpFže
->
	gù¾FÏgs
 & 
	gUNIXFILE_DELETE
 ){

26741 
osUÆšk
(
pFže
->
pId
->
zCªÚiÿlName
);

26743 
vxwÜksR–—£FžeId
(
pFže
->
pId
);

26744 
	gpFže
->
	gpId
 = 0;

26747 #ifdeà
SQLITE_UNLINK_AFTER_CLOSE


26748 ifÐ
	gpFže
->
	gù¾FÏgs
 & 
	gUNIXFILE_DELETE
 ){

26749 
osUÆšk
(
pFže
->
zP©h
);

26750 
sql™e3_ä“
(*(**)&
pFže
->
zP©h
);

26751 
	gpFže
->
	gzP©h
 = 0;

26754 
OSTRACE
(("CLOSE %-3d\n", 
pFže
->
h
));

26755 
O³nCouÁ”
(-1);

26756 
sql™e3_ä“
(
pFže
->
pUnu£d
);

26757 
mem£t
(
pFže
, 0, (
unixFže
));

26758  
	gSQLITE_OK
;

26764 
unixClo£
(
sql™e3_fže
 *
id
){

26765 
	grc
 = 
SQLITE_OK
;

26766 
unixFže
 *
	gpFže
 = (unixFž*)
id
;

26767 
v”ifyDbFže
(
pFže
);

26768 
unixUÆock
(
id
, 
NO_LOCK
);

26769 
unixEÁ”Mu‹x
();

26774 
as£¹
Ð
pFže
->
pInode
->
nLock
>0 ||…Fže->pInode->
bProûssLock
==0 );

26775 ifÐ
ALWAYS
(
pFže
->
pInode
è&& 
	gpFže
->
	gpInode
->
	gnLock
 ){

26781 
£tP’dšgFd
(
pFže
);

26783 
»Ëa£InodeInfo
(
pFže
);

26784 
	grc
 = 
þo£UnixFže
(
id
);

26785 
unixL—veMu‹x
();

26786  
	grc
;

26809 
nÞockCheckRe£rvedLock
(
sql™e3_fže
 *
NÙU£d
, *
pResOut
){

26810 
UNUSED_PARAMETER
(
NÙU£d
);

26811 *
	gpResOut
 = 0;

26812  
	gSQLITE_OK
;

26814 
nÞockLock
(
sql™e3_fže
 *
NÙU£d
, 
NÙU£d2
){

26815 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

26816  
	gSQLITE_OK
;

26818 
nÞockUÆock
(
sql™e3_fže
 *
NÙU£d
, 
NÙU£d2
){

26819 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

26820  
	gSQLITE_OK
;

26826 
nÞockClo£
(
sql™e3_fže
 *
id
) {

26827  
þo£UnixFže
(
id
);

26859 
	#DOTLOCK_SUFFIX
 ".lock"

	)

26871 
dÙlockCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
) {

26872 
	grc
 = 
SQLITE_OK
;

26873 
	g»£rved
 = 0;

26874 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26876 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

26878 
as£¹
Ð
pFže
 );

26881 ifÐ
	gpFže
->
	geFžeLock
>
	gSHARED_LOCK
 ){

26884 
	g»£rved
 = 1;

26887 cÚ¡ *
	gzLockFže
 = (cÚ¡ *)
pFže
->
lockšgCÚ‹xt
;

26888 
	g»£rved
 = 
osAcûss
(
zLockFže
, 0)==0;

26890 
OSTRACE
(("TEST WR-LOCK %d %d %d (dÙlock)\n", 
pFže
->
h
, 
rc
, 
»£rved
));

26891 *
	gpResOut
 = 
»£rved
;

26892  
	grc
;

26922 
dÙlockLock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

26923 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26924 *
	gzLockFže
 = (*)
pFže
->
lockšgCÚ‹xt
;

26925 
	grc
 = 
SQLITE_OK
;

26931 ifÐ
	gpFže
->
	geFžeLock
 > 
	gNO_LOCK
 ){

26932 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

26934 #ifdeà
HAVE_UTIME


26935 
utime
(
zLockFže
, 
NULL
);

26937 
utimes
(
zLockFže
, 
NULL
);

26939  
	gSQLITE_OK
;

26943 
	grc
 = 
osMkdœ
(
zLockFže
, 0777);

26944 ifÐ
	grc
<0 ){

26946 
	gtE¼no
 = 
”ºo
;

26947 ifÐ
	gEEXIST
 =ð
tE¼no
 ){

26948 
rc
 = 
SQLITE_BUSY
;

26950 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

26951 ifÐ
IS_LOCK_ERROR
(
rc
) ){

26952 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

26955  
	grc
;

26959 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

26960  
	grc
;

26972 
dÙlockUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

26973 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

26974 *
	gzLockFže
 = (*)
pFže
->
lockšgCÚ‹xt
;

26975 
	grc
;

26977 
as£¹
Ð
pFže
 );

26978 
OSTRACE
(("UNLOCK %d %d wa %d…id=%d (dÙlock)\n", 
pFže
->
h
, 
eFžeLock
,

26979 
pFže
->
eFžeLock
, 
g‘pid
()));

26980 
as£¹
Ð
eFžeLock
<=
SHARED_LOCK
 );

26983 ifÐ
	gpFže
->
	geFžeLock
==
eFžeLock
 ){

26984  
SQLITE_OK
;

26990 ifÐ
	geFžeLock
==
SHARED_LOCK
 ){

26991 
pFže
->
eFžeLock
 = 
SHARED_LOCK
;

26992  
	gSQLITE_OK
;

26996 
as£¹
Ð
eFžeLock
==
NO_LOCK
 );

26997 
	grc
 = 
osRmdœ
(
zLockFže
);

26998 ifÐ
	grc
<0 && 
	g”ºo
==
ENOTDIR
 ) 
rc
 = 
osUÆšk
(
zLockFže
);

26999 ifÐ
	grc
<0 ){

27000 
	gtE¼no
 = 
”ºo
;

27001 
	grc
 = 0;

27002 ifÐ
	gENOENT
 !ð
tE¼no
 ){

27003 
rc
 = 
SQLITE_IOERR_UNLOCK
;

27005 ifÐ
IS_LOCK_ERROR
(
rc
) ){

27006 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27008  
	grc
;

27010 
	gpFže
->
	geFžeLock
 = 
NO_LOCK
;

27011  
	gSQLITE_OK
;

27017 
dÙlockClo£
(
sql™e3_fže
 *
id
) {

27018 
	grc
 = 
SQLITE_OK
;

27019 ifÐ
	gid
 ){

27020 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27021 
dÙlockUÆock
(
id
, 
NO_LOCK
);

27022 
sql™e3_ä“
(
pFže
->
lockšgCÚ‹xt
);

27023 
	grc
 = 
þo£UnixFže
(
id
);

27025  
	grc
;

27045 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && !
OS_VXWORKS


27050 #ifdeà
EINTR


27051 
robu¡_æock
(
fd
, 
Ý
){

27052 
	grc
;

27053 do{ 
	grc
 = 
æock
(
fd
,
Ý
); }„c<0 && 
	g”ºo
==
EINTR
 );

27054  
	grc
;

27057 
	#robu¡_æock
(
a
,
b
è
	`æock
×,b)

	)

27067 
æockCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
){

27068 
	grc
 = 
SQLITE_OK
;

27069 
	g»£rved
 = 0;

27070 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27072 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

27074 
as£¹
Ð
pFže
 );

27077 ifÐ
	gpFže
->
	geFžeLock
>
	gSHARED_LOCK
 ){

27078 
	g»£rved
 = 1;

27082 ifÐ!
	g»£rved
 ){

27084 
	gÌc
 = 
robu¡_æock
(
pFže
->
h
, 
LOCK_EX
 | 
LOCK_NB
);

27085 ifÐ!
	gÌc
 ){

27087 
	gÌc
 = 
robu¡_æock
(
pFže
->
h
, 
LOCK_UN
);

27088 iàÐ
	gÌc
 ) {

27089 
	gtE¼no
 = 
”ºo
;

27091 
	gÌc
 = 
SQLITE_IOERR_UNLOCK
;

27092 ifÐ
IS_LOCK_ERROR
(
Ìc
) ){

27093 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27094 
	grc
 = 
Ìc
;

27098 
	gtE¼no
 = 
”ºo
;

27099 
	g»£rved
 = 1;

27101 
	gÌc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

27102 ifÐ
IS_LOCK_ERROR
(
Ìc
) ){

27103 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27104 
	grc
 = 
Ìc
;

27108 
OSTRACE
(("TEST WR-LOCK %d %d %d (æock)\n", 
pFže
->
h
, 
rc
, 
»£rved
));

27110 #ifdeà
SQLITE_IGNORE_FLOCK_LOCK_ERRORS


27111 ifÐ(
	grc
 & 
	gSQLITE_IOERR
è=ð
SQLITE_IOERR
 ){

27112 
rc
 = 
SQLITE_OK
;

27113 
	g»£rved
=1;

27116 *
	gpResOut
 = 
»£rved
;

27117  
	grc
;

27149 
æockLock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

27150 
	grc
 = 
SQLITE_OK
;

27151 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27153 
as£¹
Ð
pFže
 );

27157 ià(
	gpFže
->
	geFžeLock
 > 
	gNO_LOCK
) {

27158 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

27159  
	gSQLITE_OK
;

27164 ià(
robu¡_æock
(
pFže
->
h
, 
LOCK_EX
 | 
LOCK_NB
)) {

27165 
	gtE¼no
 = 
”ºo
;

27167 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_LOCK
);

27168 ifÐ
IS_LOCK_ERROR
(
rc
) ){

27169 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27173 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

27175 
OSTRACE
(("LOCK %d % % (æock)\n", 
pFže
->
h
, 
azFžeLock
(
eFžeLock
),

27176 
rc
==
SQLITE_OK
 ? "ok" : "failed"));

27177 #ifdeà
SQLITE_IGNORE_FLOCK_LOCK_ERRORS


27178 ifÐ(
	grc
 & 
	gSQLITE_IOERR
è=ð
SQLITE_IOERR
 ){

27179 
rc
 = 
SQLITE_BUSY
;

27182  
	grc
;

27193 
æockUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

27194 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27196 
as£¹
Ð
pFže
 );

27197 
OSTRACE
(("UNLOCK %d %d wa %d…id=%d (æock)\n", 
pFže
->
h
, 
eFžeLock
,

27198 
pFže
->
eFžeLock
, 
g‘pid
()));

27199 
as£¹
Ð
eFžeLock
<=
SHARED_LOCK
 );

27202 ifÐ
	gpFže
->
	geFžeLock
==
eFžeLock
 ){

27203  
SQLITE_OK
;

27207 ià(
	geFžeLock
==
SHARED_LOCK
) {

27208 
pFže
->
eFžeLock
 =ƒFileLock;

27209  
	gSQLITE_OK
;

27213 ifÐ
robu¡_æock
(
pFže
->
h
, 
LOCK_UN
) ){

27214 #ifdeà
SQLITE_IGNORE_FLOCK_LOCK_ERRORS


27215  
	gSQLITE_OK
;

27217  
	gSQLITE_IOERR_UNLOCK
;

27219 
	gpFže
->
	geFžeLock
 = 
NO_LOCK
;

27220  
	gSQLITE_OK
;

27227 
æockClo£
(
sql™e3_fže
 *
id
) {

27228 
	grc
 = 
SQLITE_OK
;

27229 ifÐ
	gid
 ){

27230 
æockUÆock
(
id
, 
NO_LOCK
);

27231 
	grc
 = 
þo£UnixFže
(
id
);

27233  
	grc
;

27251 #ià
OS_VXWORKS


27259 
£mCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
) {

27260 
	grc
 = 
SQLITE_OK
;

27261 
	g»£rved
 = 0;

27262 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27264 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

27266 
as£¹
Ð
pFže
 );

27269 ifÐ
	gpFže
->
	geFžeLock
>
	gSHARED_LOCK
 ){

27270 
	g»£rved
 = 1;

27274 ifÐ!
	g»£rved
 ){

27275 
£m_t
 *
	gpSem
 = 
pFže
->
pInode
->
pSem
;

27277 ifÐ
£m_Œywa™
(
pSem
)==-1 ){

27278 
tE¼no
 = 
”ºo
;

27279 ifÐ
	gEAGAIN
 !ð
tE¼no
 ){

27280 
rc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_CHECKRESERVEDLOCK
);

27281 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27284 
	g»£rved
 = (
pFže
->
eFžeLock
 < 
SHARED_LOCK
);

27288 
£m_po¡
(
pSem
);

27291 
OSTRACE
(("TEST WR-LOCK %d %d %d (£m)\n", 
pFže
->
h
, 
rc
, 
»£rved
));

27293 *
	gpResOut
 = 
»£rved
;

27294  
	grc
;

27326 
£mLock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

27327 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27328 
£m_t
 *
	gpSem
 = 
pFže
->
pInode
->
pSem
;

27329 
	grc
 = 
SQLITE_OK
;

27333 ià(
	gpFže
->
	geFžeLock
 > 
	gNO_LOCK
) {

27334 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

27335 
	grc
 = 
SQLITE_OK
;

27336 
	g£m_’d_lock
;

27340 ifÐ
£m_Œywa™
(
pSem
)==-1 ){

27341 
rc
 = 
SQLITE_BUSY
;

27342 
	g£m_’d_lock
;

27346 
	gpFže
->
	geFžeLock
 = 
eFžeLock
;

27348 
	g£m_’d_lock
:

27349  
rc
;

27359 
£mUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

27360 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27361 
£m_t
 *
	gpSem
 = 
pFže
->
pInode
->
pSem
;

27363 
as£¹
Ð
pFže
 );

27364 
as£¹
Ð
pSem
 );

27365 
OSTRACE
(("UNLOCK %d %d wa %d…id=%d (£m)\n", 
pFže
->
h
, 
eFžeLock
,

27366 
pFže
->
eFžeLock
, 
g‘pid
()));

27367 
as£¹
Ð
eFžeLock
<=
SHARED_LOCK
 );

27370 ifÐ
	gpFže
->
	geFžeLock
==
eFžeLock
 ){

27371  
SQLITE_OK
;

27375 ià(
	geFžeLock
==
SHARED_LOCK
) {

27376 
pFže
->
eFžeLock
 =ƒFileLock;

27377  
	gSQLITE_OK
;

27381 iàÐ
£m_po¡
(
pSem
)==-1 ) {

27382 
rc
, 
tE¼no
 = 
”ºo
;

27383 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
, 
SQLITE_IOERR_UNLOCK
);

27384 ifÐ
IS_LOCK_ERROR
(
rc
) ){

27385 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27387  
	grc
;

27389 
	gpFže
->
	geFžeLock
 = 
NO_LOCK
;

27390  
	gSQLITE_OK
;

27396 
£mClo£
(
sql™e3_fže
 *
id
) {

27397 ifÐ
	gid
 ){

27398 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27399 
£mUÆock
(
id
, 
NO_LOCK
);

27400 
as£¹
Ð
pFže
 );

27401 
unixEÁ”Mu‹x
();

27402 
»Ëa£InodeInfo
(
pFže
);

27403 
unixL—veMu‹x
();

27404 
þo£UnixFže
(
id
);

27406  
	gSQLITE_OK
;

27427 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


27431 
aåLockšgCÚ‹xt
 
	taåLockšgCÚ‹xt
;

27432 
	saåLockšgCÚ‹xt
 {

27433 
	g»£rved
;

27434 cÚ¡ *
	gdbP©h
;

27437 
	sBy‹RªgeLockPB2


27439 
	goff£t
;

27440 
	gËngth
;

27441 
	g»tRªgeS¹
;

27442 
	gunLockFÏg
;

27443 
	g¡¬tEndFÏg
;

27444 
	gfd
;

27447 
	#aåfsBy‹RªgeLock2FSCTL
 
	`_IOWR
('z', 23, 
By‹RªgeLockPB2
)

	)

27455 
aåS‘Lock
(

27456 cÚ¡ *
·th
,

27457 
unixFže
 *
pFže
,

27458 
off£t
,

27459 
Ëngth
,

27460 
£tLockFÏg


27462 
By‹RªgeLockPB2
 
	gpb
;

27463 
	g”r
;

27465 
	gpb
.
	gunLockFÏg
 = 
£tLockFÏg
 ? 0 : 1;

27466 
	gpb
.
	g¡¬tEndFÏg
 = 0;

27467 
	gpb
.
	goff£t
 = 
off£t
;

27468 
	gpb
.
	gËngth
 = 
Ëngth
;

27469 
	gpb
.
	gfd
 = 
pFže
->
h
;

27471 
OSTRACE
(("AFPSETLOCK [%s] for %d%s in„ange %llx:%llx\n",

27472 (
£tLockFÏg
?"ON":"OFF"), 
pFže
->
h
, (
pb
.
fd
==-1?"[testval-1]":""),

27473 
off£t
, 
Ëngth
));

27474 
	g”r
 = 
fsùl
(
·th
, 
aåfsBy‹RªgeLock2FSCTL
, &
pb
, 0);

27475 iàÐ
	g”r
==-1 ) {

27476 
rc
;

27477 
	gtE¼no
 = 
”ºo
;

27478 
OSTRACE
(("AFPSETLOCK failedo fsctl() '%s' %d %s\n",

27479 
·th
, 
tE¼no
, 
¡»¼Ü
(tErrno)));

27480 #ifdeà
SQLITE_IGNORE_AFP_LOCK_ERRORS


27481 
	grc
 = 
SQLITE_BUSY
;

27483 
	grc
 = 
sql™eE¼ÜFromPosixE¼Ü
(
tE¼no
,

27484 
£tLockFÏg
 ? 
SQLITE_IOERR_LOCK
 : 
SQLITE_IOERR_UNLOCK
);

27486 ifÐ
IS_LOCK_ERROR
(
rc
) ){

27487 
	gpFže
->
	gÏ¡E¼no
 = 
tE¼no
;

27489  
	grc
;

27491  
	gSQLITE_OK
;

27501 
aåCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
){

27502 
	grc
 = 
SQLITE_OK
;

27503 
	g»£rved
 = 0;

27504 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27505 
aåLockšgCÚ‹xt
 *
	gcÚ‹xt
;

27507 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

27509 
as£¹
Ð
pFže
 );

27510 
	gcÚ‹xt
 = (
aåLockšgCÚ‹xt
 *è
pFže
->
lockšgCÚ‹xt
;

27511 ifÐ
	gcÚ‹xt
->
	g»£rved
 ){

27512 *
	gpResOut
 = 1;

27513  
	gSQLITE_OK
;

27515 
unixEÁ”Mu‹x
();

27518 ifÐ
	gpFže
->
	gpInode
->
	geFžeLock
>
	gSHARED_LOCK
 ){

27519 
	g»£rved
 = 1;

27524 ifÐ!
	g»£rved
 ){

27526 
	gÌc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
RESERVED_BYTE
, 1,1);

27527 ifÐ
	gSQLITE_OK
==
Ìc
 ){

27530 
Ìc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
RESERVED_BYTE
, 1, 0);

27533 
	g»£rved
 = 1;

27535 ifÐ
IS_LOCK_ERROR
(
Ìc
) ){

27536 
	grc
=
Ìc
;

27540 
unixL—veMu‹x
();

27541 
OSTRACE
(("TEST WR-LOCK %d %d %d (aå)\n", 
pFže
->
h
, 
rc
, 
»£rved
));

27543 *
	gpResOut
 = 
»£rved
;

27544  
	grc
;

27571 
aåLock
(
sql™e3_fže
 *
id
, 
eFžeLock
){

27572 
	grc
 = 
SQLITE_OK
;

27573 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27574 
unixInodeInfo
 *
	gpInode
 = 
pFže
->
pInode
;

27575 
aåLockšgCÚ‹xt
 *
	gcÚ‹xt
 = (aåLockšgCÚ‹xˆ*è
pFže
->
lockšgCÚ‹xt
;

27577 
as£¹
Ð
pFže
 );

27578 
OSTRACE
(("LOCK %d % wa %s(%s,%dèpid=%d (aå)\n", 
pFže
->
h
,

27579 
azFžeLock
(
eFžeLock
),‡zFžeLock(
pFže
->eFileLock),

27580 
azFžeLock
(
pInode
->
eFžeLock
),…Inode->
nSh¬ed
 , 
g‘pid
()));

27586 ifÐ
	gpFže
->
	geFžeLock
>=
eFžeLock
 ){

27587 
OSTRACE
(("LOCK %d % ok (®»ady h–dè×å)\n", 
pFže
->
h
,

27588 
azFžeLock
(
eFžeLock
)));

27589  
	gSQLITE_OK
;

27597 
as£¹
Ð
pFže
->
eFžeLock
!=
NO_LOCK
 ||ƒFžeLock==
SHARED_LOCK
 );

27598 
as£¹
Ð
eFžeLock
!=
PENDING_LOCK
 );

27599 
as£¹
Ð
eFžeLock
!=
RESERVED_LOCK
 || 
pFže
->eFžeLock==
SHARED_LOCK
 );

27603 
unixEÁ”Mu‹x
();

27604 
	gpInode
 = 
pFže
->
pInode
;

27609 ifÐ(
	gpFže
->
	geFžeLock
!=
pInode
->
eFžeLock
 &&

27610 (
pInode
->
eFžeLock
>=
PENDING_LOCK
 ||ƒFžeLock>
SHARED_LOCK
))

27612 
rc
 = 
SQLITE_BUSY
;

27613 
	gaå_’d_lock
;

27620 ifÐ
	geFžeLock
==
SHARED_LOCK
 &&

27621 (
pInode
->
eFžeLock
==
SHARED_LOCK
 ||…Inode->eFžeLock==
RESERVED_LOCK
) ){

27622 
as£¹
Ð
eFžeLock
==
SHARED_LOCK
 );

27623 
as£¹
Ð
pFže
->
eFžeLock
==0 );

27624 
as£¹
Ð
pInode
->
nSh¬ed
>0 );

27625 
	gpFže
->
	geFžeLock
 = 
SHARED_LOCK
;

27626 
	gpInode
->
	gnSh¬ed
++;

27627 
	gpInode
->
	gnLock
++;

27628 
	gaå_’d_lock
;

27635 ifÐ
	geFžeLock
==
SHARED_LOCK


27636 || (
eFžeLock
==
EXCLUSIVE_LOCK
 && 
pFže
->eFžeLock<
PENDING_LOCK
)

27638 
çžed
;

27639 
	gçžed
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
PENDING_BYTE
, 1, 1);

27640 ià(
	gçžed
) {

27641 
	grc
 = 
çžed
;

27642 
	gaå_’d_lock
;

27649 ifÐ
	geFžeLock
==
SHARED_LOCK
 ){

27650 
Ìc1
, 
Ìc2
, 
Ìc1E¼no
 = 0;

27651 
	glk
, 
	gmask
;

27653 
as£¹
Ð
pInode
->
nSh¬ed
==0 );

27654 
as£¹
Ð
pInode
->
eFžeLock
==0 );

27656 
	gmask
 = (()==8è? 
LARGEST_INT64
 : 0x7fffffff;

27659 
	glk
 = 
¿ndom
();

27660 
	gpInode
->
	gsh¬edBy‹
 = (
lk
 & 
mask
)%(
SHARED_SIZE
 - 1);

27661 
	gÌc1
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
,

27662 
SHARED_FIRST
+
pInode
->
sh¬edBy‹
, 1, 1);

27663 ifÐ
IS_LOCK_ERROR
(
Ìc1
) ){

27664 
	gÌc1E¼no
 = 
pFže
->
Ï¡E¼no
;

27667 
	gÌc2
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
PENDING_BYTE
, 1, 0);

27669 ifÐ
IS_LOCK_ERROR
(
Ìc1
) ) {

27670 
	gpFže
->
	gÏ¡E¼no
 = 
Ìc1E¼no
;

27671 
	grc
 = 
Ìc1
;

27672 
	gaå_’d_lock
;

27673 } ifÐ
IS_LOCK_ERROR
(
Ìc2
) ){

27674 
	grc
 = 
Ìc2
;

27675 
	gaå_’d_lock
;

27676 } ifÐ
	gÌc1
 !ð
SQLITE_OK
 ) {

27677 
rc
 = 
Ìc1
;

27679 
	gpFže
->
	geFžeLock
 = 
SHARED_LOCK
;

27680 
	gpInode
->
	gnLock
++;

27681 
	gpInode
->
	gnSh¬ed
 = 1;

27683 }ifÐ
	geFžeLock
==
EXCLUSIVE_LOCK
 && 
pInode
->
nSh¬ed
>1 ){

27686 
rc
 = 
SQLITE_BUSY
;

27692 
	gçžed
 = 0;

27693 
as£¹
Ð0!=
pFže
->
eFžeLock
 );

27694 ià(
	geFžeLock
 >ð
RESERVED_LOCK
 && 
pFže
->
eFžeLock
 < RESERVED_LOCK) {

27696 
çžed
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
RESERVED_BYTE
, 1,1);

27697 ifÐ!
	gçžed
 ){

27698 
	gcÚ‹xt
->
	g»£rved
 = 1;

27701 ià(!
	gçžed
 && 
	geFžeLock
 =ð
EXCLUSIVE_LOCK
) {

27707 ifÐ!(
çžed
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
SHARED_FIRST
 +

27708 
pInode
->
sh¬edBy‹
, 1, 0)) ){

27709 
	gçžed2
 = 
SQLITE_OK
;

27711 
	gçžed
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
SHARED_FIRST
,

27712 
SHARED_SIZE
, 1);

27713 ifÐ
	gçžed
 && (
	gçžed2
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
,

27714 
SHARED_FIRST
 + 
pInode
->
sh¬edBy‹
, 1, 1)) ){

27718 
	grc
 = ((
çžed
 & 
SQLITE_IOERR
è=ðSQLITE_IOERRè? 
çžed2
 :

27719 
SQLITE_IOERR_LOCK
;

27720 
	gaå_’d_lock
;

27723 
	grc
 = 
çžed
;

27726 ifÐ
	gçžed
 ){

27727 
	grc
 = 
çžed
;

27731 ifÐ
	grc
==
SQLITE_OK
 ){

27732 
pFže
->
eFžeLock
 =ƒFileLock;

27733 
	gpInode
->
	geFžeLock
 = 
eFžeLock
;

27734 }ifÐ
	geFžeLock
==
EXCLUSIVE_LOCK
 ){

27735 
pFže
->
eFžeLock
 = 
PENDING_LOCK
;

27736 
	gpInode
->
	geFžeLock
 = 
PENDING_LOCK
;

27739 
	gaå_’d_lock
:

27740 
unixL—veMu‹x
();

27741 
OSTRACE
(("LOCK %d % % ×å)\n", 
pFže
->
h
, 
azFžeLock
(
eFžeLock
),

27742 
rc
==
SQLITE_OK
 ? "ok" : "failed"));

27743  
	grc
;

27753 
aåUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

27754 
	grc
 = 
SQLITE_OK
;

27755 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27756 
unixInodeInfo
 *
	gpInode
;

27757 
aåLockšgCÚ‹xt
 *
	gcÚ‹xt
 = (aåLockšgCÚ‹xˆ*è
pFže
->
lockšgCÚ‹xt
;

27758 
	gskSh¬ed
 = 0;

27759 #ifdeà
SQLITE_TEST


27760 
	gh
 = 
pFže
->
h
;

27763 
as£¹
Ð
pFže
 );

27764 
OSTRACE
(("UNLOCK %d %d wa %d(%d,%dèpid=%d (aå)\n", 
pFže
->
h
, 
eFžeLock
,

27765 
pFže
->
eFžeLock
,…Fže->
pInode
->eFžeLock,…Fže->pInode->
nSh¬ed
,

27766 
g‘pid
()));

27768 
as£¹
Ð
eFžeLock
<=
SHARED_LOCK
 );

27769 ifÐ
	gpFže
->
	geFžeLock
<=
eFžeLock
 ){

27770  
SQLITE_OK
;

27772 
unixEÁ”Mu‹x
();

27773 
	gpInode
 = 
pFže
->
pInode
;

27774 
as£¹
Ð
pInode
->
nSh¬ed
!=0 );

27775 ifÐ
	gpFže
->
	geFžeLock
>
	gSHARED_LOCK
 ){

27776 
as£¹
Ð
pInode
->
eFžeLock
==
pFže
->eFileLock );

27777 
SimuÏ‹IOE¼ÜB’ign
(1);

27778 
SimuÏ‹IOE¼Ü
Ð
h
=(-1) )

27779 
SimuÏ‹IOE¼ÜB’ign
(0);

27781 #ifdeà
SQLITE_DEBUG


27790 
as£¹
Ð
pFže
->
šNÜm®Wr™e
==0

27791 || 
pFže
->
dbUpd©e
==0

27792 || 
pFže
->
ŒªsCÁrChng
==1 );

27793 
	gpFže
->
	gšNÜm®Wr™e
 = 0;

27796 ifÐ
	gpFže
->
	geFžeLock
==
EXCLUSIVE_LOCK
 ){

27797 
rc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
SHARED_FIRST
, 
SHARED_SIZE
, 0);

27798 ifÐ
	grc
==
SQLITE_OK
 && (
eFžeLock
==
SHARED_LOCK
 || 
pInode
->
nSh¬ed
>1) ){

27800 
sh¬edLockBy‹
 = 
SHARED_FIRST
+
pInode
->
sh¬edBy‹
;

27801 
	grc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
sh¬edLockBy‹
, 1, 1);

27803 
	gskSh¬ed
 = 1;

27806 ifÐ
	grc
==
SQLITE_OK
 && 
pFže
->
eFžeLock
>=
PENDING_LOCK
 ){

27807 
rc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
PENDING_BYTE
, 1, 0);

27809 ifÐ
	grc
==
SQLITE_OK
 && 
pFže
->
eFžeLock
>=
RESERVED_LOCK
 && 
cÚ‹xt
->
»£rved
 ){

27810 
rc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
RESERVED_BYTE
, 1, 0);

27811 ifÐ!
	grc
 ){

27812 
	gcÚ‹xt
->
	g»£rved
 = 0;

27815 ifÐ
	grc
==
SQLITE_OK
 && (
eFžeLock
==
SHARED_LOCK
 || 
pInode
->
nSh¬ed
>1)){

27816 
pInode
->
eFžeLock
 = 
SHARED_LOCK
;

27819 ifÐ
	grc
==
SQLITE_OK
 && 
eFžeLock
==
NO_LOCK
 ){

27825 
sh¬edLockBy‹
 = 
SHARED_FIRST
+
pInode
->
sh¬edBy‹
;

27826 
	gpInode
->
	gnSh¬ed
--;

27827 ifÐ
	gpInode
->
	gnSh¬ed
==0 ){

27828 
SimuÏ‹IOE¼ÜB’ign
(1);

27829 
SimuÏ‹IOE¼Ü
Ð
h
=(-1) )

27830 
SimuÏ‹IOE¼ÜB’ign
(0);

27831 ifÐ!
	gskSh¬ed
 ){

27832 
	grc
 = 
aåS‘Lock
(
cÚ‹xt
->
dbP©h
, 
pFže
, 
sh¬edLockBy‹
, 1, 0);

27834 ifÐ!
	grc
 ){

27835 
	gpInode
->
	geFžeLock
 = 
NO_LOCK
;

27836 
	gpFže
->
	geFžeLock
 = 
NO_LOCK
;

27839 ifÐ
	grc
==
SQLITE_OK
 ){

27840 
pInode
->
nLock
--;

27841 
as£¹
Ð
pInode
->
nLock
>=0 );

27842 ifÐ
	gpInode
->
	gnLock
==0 ){

27843 
þo£P’dšgFds
(
pFže
);

27848 
unixL—veMu‹x
();

27849 ifÐ
	grc
==
SQLITE_OK
 ) 
pFže
->
eFžeLock
 =ƒFileLock;

27850  
	grc
;

27856 
aåClo£
(
sql™e3_fže
 *
id
) {

27857 
	grc
 = 
SQLITE_OK
;

27858 ifÐ
	gid
 ){

27859 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

27860 
aåUÆock
(
id
, 
NO_LOCK
);

27861 
unixEÁ”Mu‹x
();

27862 ifÐ
	gpFže
->
	gpInode
 &&…Fže->pInode->
	gnLock
 ){

27868 
£tP’dšgFd
(
pFže
);

27870 
»Ëa£InodeInfo
(
pFže
);

27871 
sql™e3_ä“
(
pFže
->
lockšgCÚ‹xt
);

27872 
	grc
 = 
þo£UnixFže
(
id
);

27873 
unixL—veMu‹x
();

27875  
	grc
;

27891 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


27899 
nfsUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
){

27900  
posixUÆock
(
id
, 
eFžeLock
, 1);

27935 
£ekAndR—d
(
unixFže
 *
id
, 
sql™e3_št64
 
off£t
, *
pBuf
, 
út
){

27936 
	ggÙ
;

27937 
	g´iÜ
 = 0;

27938 #ià(!
defšed
(
USE_PREAD
è&& !defšed(
USE_PREAD64
))

27939 
i64
 
	gÃwOff£t
;

27941 
	gTIMER_START
;

27942 
as£¹
Ð
út
==(cnt&0x1ffff) );

27943 
as£¹
Ð
id
->
h
>2 );

27944 
	gút
 &= 0x1ffff;

27946 #ià
defšed
(
USE_PREAD
)

27947 
	ggÙ
 = 
osP»ad
(
id
->
h
, 
pBuf
, 
út
, 
off£t
);

27948 
SimuÏ‹IOE¼Ü
Ð
gÙ
 = -1 );

27949 #–ià
defšed
(
USE_PREAD64
)

27950 
	ggÙ
 = 
osP»ad64
(
id
->
h
, 
pBuf
, 
út
, 
off£t
);

27951 
SimuÏ‹IOE¼Ü
Ð
gÙ
 = -1 );

27953 
	gÃwOff£t
 = 
l£ek
(
id
->
h
, 
off£t
, 
SEEK_SET
);

27954 
SimuÏ‹IOE¼Ü
Ð
ÃwOff£t
-- );

27955 ifÐ
	gÃwOff£t
!=
off£t
 ){

27956 ifÐ
ÃwOff£t
 == -1 ){

27957 ((
unixFže
*)
id
)->
Ï¡E¼no
 = 
”ºo
;

27959 ((
	gunixFže
*)
	gid
)->
	gÏ¡E¼no
 = 0;

27963 
	ggÙ
 = 
osR—d
(
id
->
h
, 
pBuf
, 
út
);

27965 ifÐ
	ggÙ
==
út
 ) ;

27966 ifÐ
	ggÙ
<0 ){

27967 ifÐ
	g”ºo
==
EINTR
 ){ 
gÙ
 = 1; ; }

27968 
	g´iÜ
 = 0;

27969 ((
	gunixFže
*)
	gid
)->
	gÏ¡E¼no
 = 
”ºo
;

27971 }ifÐ
	ggÙ
>0 ){

27972 
	gút
 -ð
gÙ
;

27973 
	goff£t
 +ð
gÙ
;

27974 
	g´iÜ
 +ð
gÙ
;

27975 
	gpBuf
 = (*)(
gÙ
 + (*)
pBuf
);

27977 } 
	ggÙ
>0 );

27978 
	gTIMER_END
;

27979 
OSTRACE
(("READ %-3d %5d %7lld %llu\n",

27980 
id
->
h
, 
gÙ
+
´iÜ
, 
off£t
-´iÜ, 
TIMER_ELAPSED
));

27981  
	ggÙ
+
	g´iÜ
;

27989 
unixR—d
(

27990 
sql™e3_fže
 *
id
,

27991 *
pBuf
,

27992 
amt
,

27993 
sql™e3_št64
 
off£t


27995 
unixFže
 *
	gpFže
 = (unixFž*)
id
;

27996 
	ggÙ
;

27997 
as£¹
Ð
id
 );

27998 
as£¹
Ð
off£t
>=0 );

27999 
as£¹
Ð
amt
>0 );

28004 
as£¹
Ð
pFže
->
pUnu£d
==0

28005 || 
off£t
>=
PENDING_BYTE
+512

28006 || 
off£t
+
amt
<=
PENDING_BYTE


28010 #ià
SQLITE_MAX_MMAP_SIZE
>0

28013 ifÐ
	goff£t
<
	gpFže
->
	gmm­Size
 ){

28014 ifÐ
	goff£t
+
	gamt
 <ð
pFže
->
mm­Size
 ){

28015 
memýy
(
pBuf
, &((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
amt
);

28016  
	gSQLITE_OK
;

28018 
	gnCÝy
 = 
pFže
->
mm­Size
 - 
off£t
;

28019 
memýy
(
pBuf
, &((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
nCÝy
);

28020 
	gpBuf
 = &((
u8
 *)
pBuf
)[
nCÝy
];

28021 
	gamt
 -ð
nCÝy
;

28022 
	goff£t
 +ð
nCÝy
;

28027 
	ggÙ
 = 
£ekAndR—d
(
pFže
, 
off£t
, 
pBuf
, 
amt
);

28028 ifÐ
	ggÙ
==
amt
 ){

28029  
SQLITE_OK
;

28030 }ifÐ
	ggÙ
<0 ){

28032  
	gSQLITE_IOERR_READ
;

28034 
	gpFže
->
	gÏ¡E¼no
 = 0;

28036 
mem£t
(&((*)
pBuf
)[
gÙ
], 0, 
amt
-got);

28037  
	gSQLITE_IOERR_SHORT_READ
;

28048 
£ekAndWr™eFd
(

28049 
fd
,

28050 
i64
 
iOff
,

28051 cÚ¡ *
pBuf
,

28052 
nBuf
,

28053 *
piE¼no


28055 
	grc
 = 0;

28057 
as£¹
Ð
nBuf
==(nBuf&0x1ffff) );

28058 
as£¹
Ð
fd
>2 );

28059 
	gnBuf
 &= 0x1ffff;

28060 
	gTIMER_START
;

28062 #ià
defšed
(
USE_PREAD
)

28063 do{ 
	grc
 = 
osPwr™e
(
fd
, 
pBuf
, 
nBuf
, 
iOff
); }„c<0 && 
	g”ºo
==
EINTR
 );

28064 #–ià
defšed
(
USE_PREAD64
)

28065 do{ 
	grc
 = 
osPwr™e64
(
fd
, 
pBuf
, 
nBuf
, 
iOff
);}„c<0 && 
	g”ºo
==
EINTR
);

28068 
i64
 
	giS“k
 = 
l£ek
(
fd
, 
iOff
, 
SEEK_SET
);

28069 
SimuÏ‹IOE¼Ü
Ð
iS“k
-- );

28071 ifÐ
	giS“k
!=
iOff
 ){

28072 ifÐ
piE¼no
 ) *piE¼nØð(
iS“k
==-1 ? 
”ºo
 : 0);

28075 
	grc
 = 
osWr™e
(
fd
, 
pBuf
, 
nBuf
);

28076 } 
	grc
<0 && 
	g”ºo
==
EINTR
 );

28079 
	gTIMER_END
;

28080 
OSTRACE
(("WRITE %-3d %5d %7Îd %Îu\n", 
fd
, 
rc
, 
iOff
, 
TIMER_ELAPSED
));

28082 ifÐ
	grc
<0 && 
	gpiE¼no
 ) *piE¼nØð
”ºo
;

28083  
	grc
;

28094 
£ekAndWr™e
(
unixFže
 *
id
, 
i64
 
off£t
, cÚ¡ *
pBuf
, 
út
){

28095  
£ekAndWr™eFd
(
id
->
h
, 
off£t
, 
pBuf
, 
út
, &id->
Ï¡E¼no
);

28103 
unixWr™e
(

28104 
sql™e3_fže
 *
id
,

28105 cÚ¡ *
pBuf
,

28106 
amt
,

28107 
sql™e3_št64
 
off£t


28109 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

28110 
	gwrÙe
 = 0;

28111 
as£¹
Ð
id
 );

28112 
as£¹
Ð
amt
>0 );

28117 
as£¹
Ð
pFže
->
pUnu£d
==0

28118 || 
off£t
>=
PENDING_BYTE
+512

28119 || 
off£t
+
amt
<=
PENDING_BYTE


28123 #ifdeà
SQLITE_DEBUG


28130 ifÐ
	gpFže
->
	gšNÜm®Wr™e
 ){

28131 
	gpFže
->
	gdbUpd©e
 = 1;

28132 ifÐ
	goff£t
<=24 && 
off£t
+
amt
>=27 ){

28133 
rc
;

28134 
	gÞdCÁr
[4];

28135 
SimuÏ‹IOE¼ÜB’ign
(1);

28136 
	grc
 = 
£ekAndR—d
(
pFže
, 24, 
ÞdCÁr
, 4);

28137 
SimuÏ‹IOE¼ÜB’ign
(0);

28138 ifÐ
	grc
!=4 || 
memcmp
(
ÞdCÁr
, &((*)
pBuf
)[24-
off£t
], 4)!=0 ){

28139 
pFže
->
ŒªsCÁrChng
 = 1;

28145 #ià
SQLITE_MAX_MMAP_SIZE
>0

28148 ifÐ
	goff£t
<
	gpFže
->
	gmm­Size
 ){

28149 ifÐ
	goff£t
+
	gamt
 <ð
pFže
->
mm­Size
 ){

28150 
memýy
(&((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
pBuf
, 
amt
);

28151  
	gSQLITE_OK
;

28153 
	gnCÝy
 = 
pFže
->
mm­Size
 - 
off£t
;

28154 
memýy
(&((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
pBuf
, 
nCÝy
);

28155 
	gpBuf
 = &((
u8
 *)
pBuf
)[
nCÝy
];

28156 
	gamt
 -ð
nCÝy
;

28157 
	goff£t
 +ð
nCÝy
;

28162  
	gamt
>0 && (
	gwrÙe
 = 
£ekAndWr™e
(
pFže
, 
off£t
, 
pBuf
, 
amt
))>0 ){

28163 
	gamt
 -ð
wrÙe
;

28164 
	goff£t
 +ð
wrÙe
;

28165 
	gpBuf
 = &((*)
pBuf
)[
wrÙe
];

28167 
SimuÏ‹IOE¼Ü
(Ð
wrÙe
=(-1), 
amt
=1 ));

28168 
SimuÏ‹DiskfuÎE¼Ü
(Ð
wrÙe
=0, 
amt
=1 ));

28170 ifÐ
	gamt
>0 ){

28171 ifÐ
	gwrÙe
<0 && 
	gpFže
->
	gÏ¡E¼no
!=
ENOSPC
 ){

28173  
SQLITE_IOERR_WRITE
;

28175 
	gpFže
->
	gÏ¡E¼no
 = 0;

28176  
	gSQLITE_FULL
;

28180  
	gSQLITE_OK
;

28183 #ifdeà
SQLITE_TEST


28188 
SQLITE_API
 
	gsql™e3_sync_couÁ
 = 0;

28189 
SQLITE_API
 
	gsql™e3_fuÎsync_couÁ
 = 0;

28198 #ià!
defšed
(
fd©async
)

28199 
	#fd©async
 
fsync


	)

28207 #ifdeà
F_FULLFSYNC


28208 
	#HAVE_FULLFSYNC
 1

	)

28210 
	#HAVE_FULLFSYNC
 0

	)

28238 
fuÎ_fsync
(
fd
, 
fuÎSync
, 
d©aOÆy
){

28239 
	grc
;

28245 #ifdeà
SQLITE_NO_SYNC


28246 
UNUSED_PARAMETER
(
fd
);

28247 
UNUSED_PARAMETER
(
fuÎSync
);

28248 
UNUSED_PARAMETER
(
d©aOÆy
);

28249 #–ià
HAVE_FULLFSYNC


28250 
UNUSED_PARAMETER
(
d©aOÆy
);

28252 
UNUSED_PARAMETER
(
fuÎSync
);

28253 
UNUSED_PARAMETER
(
d©aOÆy
);

28260 #ifdeà
SQLITE_TEST


28261 ifÐ
	gfuÎSync
 ) 
	gsql™e3_fuÎsync_couÁ
++;

28262 
	gsql™e3_sync_couÁ
++;

28268 #ifdeà
SQLITE_NO_SYNC


28269 
	grc
 = 
SQLITE_OK
;

28270 #–ià
HAVE_FULLFSYNC


28271 ifÐ
	gfuÎSync
 ){

28272 
	grc
 = 
osFúŽ
(
fd
, 
F_FULLFSYNC
, 0);

28274 
	grc
 = 1;

28284 ifÐ
	grc
 )„øð
fsync
(
fd
);

28286 #–ià
defšed
(
__APPLE__
)

28290 
	grc
 = 
fsync
(
fd
);

28292 
	grc
 = 
fd©async
(
fd
);

28293 #ià
OS_VXWORKS


28294 ifÐ
	grc
==-1 && 
”ºo
==
ENOTSUP
 ){

28295 
rc
 = 
fsync
(
fd
);

28300 ifÐ
	gOS_VXWORKS
 && 
	grc
!= -1 ){

28301 
rc
 = 0;

28303  
	grc
;

28329 
Ý’DœeùÜy
(cÚ¡ *
zFž’ame
, *
pFd
){

28330 
	gii
;

28331 
	gfd
 = -1;

28332 
	gzDœÇme
[
MAX_PATHNAME
+1];

28334 
sql™e3_¢´štf
(
MAX_PATHNAME
, 
zDœÇme
, "%s", 
zFž’ame
);

28335 
	gii
=()
¡¾’
(
zDœÇme
); ii>1 && 
	gzDœÇme
[
ii
]!='/'; ii--);

28336 ifÐ
	gii
>0 ){

28337 
	gzDœÇme
[
ii
] = '\0';

28338 
	gfd
 = 
robu¡_Ý’
(
zDœÇme
, 
O_RDONLY
|
O_BINARY
, 0);

28339 ifÐ
	gfd
>=0 ){

28340 
OSTRACE
(("OPENDIR %-3d %s\n", 
fd
, 
zDœÇme
));

28343 *
	gpFd
 = 
fd
;

28344  (
	gfd
>=0?
SQLITE_OK
:
unixLogE¼Ü
(
SQLITE_CANTOPEN_BKPT
, "Ý’", 
zDœÇme
));

28362 
unixSync
(
sql™e3_fže
 *
id
, 
æags
){

28363 
	grc
;

28364 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

28366 
	gisD©aOÆy
 = (
æags
&
SQLITE_SYNC_DATAONLY
);

28367 
	gisFuÎsync
 = (
æags
&0x0F)==
SQLITE_SYNC_FULL
;

28370 
as£¹
((
æags
&0x0F)==
SQLITE_SYNC_NORMAL


28371 || (
æags
&0x0F)==
SQLITE_SYNC_FULL


28377 
SimuÏ‹DiskfuÎE¼Ü
Ð 
SQLITE_FULL
 );

28379 
as£¹
Ð
pFže
 );

28380 
OSTRACE
(("SYNC %-3d\n", 
pFže
->
h
));

28381 
	grc
 = 
fuÎ_fsync
(
pFže
->
h
, 
isFuÎsync
, 
isD©aOÆy
);

28382 
SimuÏ‹IOE¼Ü
Ð
rc
=1 );

28383 ifÐ
	grc
 ){

28384 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

28385  
unixLogE¼Ü
(
SQLITE_IOERR_FSYNC
, "fuÎ_fsync", 
pFže
->
zP©h
);

28392 ifÐ
	gpFže
->
	gù¾FÏgs
 & 
	gUNIXFILE_DIRSYNC
 ){

28393 
	gdœfd
;

28394 
OSTRACE
(("DIRSYNC % (have_fuÎfsync=%d fuÎsync=%d)\n", 
pFže
->
zP©h
,

28395 
HAVE_FULLFSYNC
, 
isFuÎsync
));

28396 
	grc
 = 
osO³nDœeùÜy
(
pFže
->
zP©h
, &
dœfd
);

28397 ifÐ
	grc
==
SQLITE_OK
 && 
dœfd
>=0 ){

28398 
fuÎ_fsync
(
dœfd
, 0, 0);

28399 
robu¡_þo£
(
pFže
, 
dœfd
, 
__LINE__
);

28400 }ifÐ
	grc
==
SQLITE_CANTOPEN
 ){

28401 
rc
 = 
SQLITE_OK
;

28403 
	gpFže
->
	gù¾FÏgs
 &ð~
UNIXFILE_DIRSYNC
;

28405  
	grc
;

28411 
unixTrunÿ‹
(
sql™e3_fže
 *
id
, 
i64
 
nBy‹
){

28412 
unixFže
 *
	gpFže
 = (unixFž*)
id
;

28413 
	grc
;

28414 
as£¹
Ð
pFže
 );

28415 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_TRUNCATE
 );

28422 ifÐ
	gpFže
->
	gszChunk
>0 ){

28423 
	gnBy‹
 = ((
nBy‹
 + 
pFže
->
szChunk
 - 1)/pFile->szChunk) *…File->szChunk;

28426 
	grc
 = 
robu¡_árunÿ‹
(
pFže
->
h
, 
nBy‹
);

28427 ifÐ
	grc
 ){

28428 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

28429  
unixLogE¼Ü
(
SQLITE_IOERR_TRUNCATE
, "árunÿ‹", 
pFže
->
zP©h
);

28431 #ifdeà
SQLITE_DEBUG


28439 ifÐ
	gpFže
->
	gšNÜm®Wr™e
 && 
	gnBy‹
==0 ){

28440 
pFže
->
ŒªsCÁrChng
 = 1;

28444 #ià
SQLITE_MAX_MMAP_SIZE
>0

28449 ifÐ
	gnBy‹
<
	gpFže
->
	gmm­Size
 ){

28450 
	gpFže
->
	gmm­Size
 = 
nBy‹
;

28454  
	gSQLITE_OK
;

28461 
unixFžeSize
(
sql™e3_fže
 *
id
, 
i64
 *
pSize
){

28462 
	grc
;

28463 
¡©
 
	gbuf
;

28464 
as£¹
Ð
id
 );

28465 
	grc
 = 
osF¡©
(((
unixFže
*)
id
)->
h
, &
buf
);

28466 
SimuÏ‹IOE¼Ü
Ð
rc
=1 );

28467 ifÐ
	grc
!=0 ){

28468 ((
unixFže
*)
id
)->
Ï¡E¼no
 = 
”ºo
;

28469  
	gSQLITE_IOERR_FSTAT
;

28471 *
	gpSize
 = 
buf
.
¡_size
;

28479 ifÐ*
	gpSize
==1 ) *
pSize
 = 0;

28482  
	gSQLITE_OK
;

28485 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && 
defšed
(
__APPLE__
)

28490 
´oxyFžeCÚŒÞ
(
sql™e3_fže
*,,*);

28499 
fúŽSizeHšt
(
unixFže
 *
pFže
, 
i64
 
nBy‹
){

28500 ifÐ
	gpFže
->
	gszChunk
>0 ){

28501 
i64
 
	gnSize
;

28502 
¡©
 
	gbuf
;

28504 ifÐ
osF¡©
(
pFže
->
h
, &
buf
èè 
	gSQLITE_IOERR_FSTAT
;

28506 
	gnSize
 = ((
nBy‹
+
pFže
->
szChunk
-1) /…File->szChunk) *…File->szChunk;

28507 ifÐ
	gnSize
>(
	gi64
)
	gbuf
.
	g¡_size
 ){

28509 #ià
defšed
(
HAVE_POSIX_FALLOCATE
) && HAVE_POSIX_FALLOCATE

28513 
	g”r
;

28515 
	g”r
 = 
osF®loÿ‹
(
pFže
->
h
, 
buf
.
¡_size
, 
nSize
-buf.st_size);

28516 } 
	g”r
==
EINTR
 );

28517 ifÐ
	g”r
 )  
	gSQLITE_IOERR_WRITE
;

28525 
	gnBlk
 = 
buf
.
¡_blksize
;

28526 
i64
 
	giWr™e
;

28528 ifÐ
robu¡_árunÿ‹
(
pFže
->
h
, 
nSize
) ){

28529 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

28530  
unixLogE¼Ü
(
SQLITE_IOERR_TRUNCATE
, "árunÿ‹", 
pFže
->
zP©h
);

28532 
	giWr™e
 = ((
buf
.
¡_size
 + 2*
nBlk
 - 1)/nBlk)*nBlk-1;

28533  
	giWr™e
<
	gnSize
 ){

28534 
	gnWr™e
 = 
£ekAndWr™e
(
pFže
, 
iWr™e
, "", 1);

28535 ifÐ
	gnWr™e
!=1 )  
SQLITE_IOERR_WRITE
;

28536 
	giWr™e
 +ð
nBlk
;

28542 #ià
SQLITE_MAX_MMAP_SIZE
>0

28543 ifÐ
	gpFže
->
	gmm­SizeMax
>0 && 
	gnBy‹
>pFže->
	gmm­Size
 ){

28544 
	grc
;

28545 ifÐ
	gpFže
->
	gszChunk
<=0 ){

28546 ifÐ
robu¡_árunÿ‹
(
pFže
->
h
, 
nBy‹
) ){

28547 
pFže
->
Ï¡E¼no
 = 
”ºo
;

28548  
unixLogE¼Ü
(
SQLITE_IOERR_TRUNCATE
, "árunÿ‹", 
pFže
->
zP©h
);

28552 
	grc
 = 
unixM­fže
(
pFže
, 
nBy‹
);

28553  
	grc
;

28557  
	gSQLITE_OK
;

28566 
unixModeB™
(
unixFže
 *
pFže
, 
mask
, *
pArg
){

28567 ifÐ*
	gpArg
<0 ){

28568 *
	gpArg
 = (
pFže
->
ù¾FÏgs
 & 
mask
)!=0;

28569 }ifÐ(*
	gpArg
)==0 ){

28570 
pFže
->
ù¾FÏgs
 &ð~
mask
;

28572 
	gpFže
->
	gù¾FÏgs
 |ð
mask
;

28577 
unixG‘Tem²ame
(
nBuf
, *
zBuf
);

28582 
unixFžeCÚŒÞ
(
sql™e3_fže
 *
id
, 
Ý
, *
pArg
){

28583 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

28584  
	gÝ
 ){

28585 
	gSQLITE_FCNTL_LOCKSTATE
: {

28586 *(*)
pArg
 = 
pFže
->
eFžeLock
;

28587  
	gSQLITE_OK
;

28589 
	gSQLITE_LAST_ERRNO
: {

28590 *(*)
pArg
 = 
pFže
->
Ï¡E¼no
;

28591  
	gSQLITE_OK
;

28593 
	gSQLITE_FCNTL_CHUNK_SIZE
: {

28594 
pFže
->
szChunk
 = *(*)
pArg
;

28595  
	gSQLITE_OK
;

28597 
	gSQLITE_FCNTL_SIZE_HINT
: {

28598 
rc
;

28599 
SimuÏ‹IOE¼ÜB’ign
(1);

28600 
	grc
 = 
fúŽSizeHšt
(
pFže
, *(
i64
 *)
pArg
);

28601 
SimuÏ‹IOE¼ÜB’ign
(0);

28602  
	grc
;

28604 
	gSQLITE_FCNTL_PERSIST_WAL
: {

28605 
unixModeB™
(
pFže
, 
UNIXFILE_PERSIST_WAL
, (*)
pArg
);

28606  
	gSQLITE_OK
;

28608 
	gSQLITE_FCNTL_POWERSAFE_OVERWRITE
: {

28609 
unixModeB™
(
pFže
, 
UNIXFILE_PSOW
, (*)
pArg
);

28610  
	gSQLITE_OK
;

28612 
	gSQLITE_FCNTL_VFSNAME
: {

28613 *(**)
pArg
 = 
sql™e3_m´štf
("%s", 
pFže
->
pVfs
->
zName
);

28614  
	gSQLITE_OK
;

28616 
	gSQLITE_FCNTL_TEMPFILENAME
: {

28617 *
zTFže
 = 
sql™e3_m®loc
Ð
pFže
->
pVfs
->
mxP©hÇme
 );

28618 ifÐ
	gzTFže
 ){

28619 
unixG‘Tem²ame
(
pFže
->
pVfs
->
mxP©hÇme
, 
zTFže
);

28620 *(**)
	gpArg
 = 
zTFže
;

28622  
	gSQLITE_OK
;

28624 
	gSQLITE_FCNTL_HAS_MOVED
: {

28625 *(*)
pArg
 = 
fžeHasMoved
(
pFže
);

28626  
	gSQLITE_OK
;

28628 #ià
SQLITE_MAX_MMAP_SIZE
>0

28629 
	gSQLITE_FCNTL_MMAP_SIZE
: {

28630 
i64
 
ÃwLim™
 = *(i64*)
pArg
;

28631 
	grc
 = 
SQLITE_OK
;

28632 ifÐ
	gÃwLim™
>
	gsql™e3Glob®CÚfig
.
	gmxMm­
 ){

28633 
	gÃwLim™
 = 
sql™e3Glob®CÚfig
.
mxMm­
;

28635 *(
	gi64
*)
	gpArg
 = 
pFže
->
mm­SizeMax
;

28636 ifÐ
	gÃwLim™
>=0 && 
ÃwLim™
!=
pFže
->
mm­SizeMax
 &&…Fže->
nF‘chOut
==0 ){

28637 
pFže
->
mm­SizeMax
 = 
ÃwLim™
;

28638 ifÐ
	gpFže
->
	gmm­Size
>0 ){

28639 
unixUnm­fže
(
pFže
);

28640 
	grc
 = 
unixM­fže
(
pFže
, -1);

28643  
	grc
;

28646 #ifdeà
SQLITE_DEBUG


28652 
	gSQLITE_FCNTL_DB_UNCHANGED
: {

28653 ((
unixFže
*)
id
)->
dbUpd©e
 = 0;

28654  
	gSQLITE_OK
;

28657 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && 
defšed
(
__APPLE__
)

28658 
	gSQLITE_SET_LOCKPROXYFILE
:

28659 
SQLITE_GET_LOCKPROXYFILE
: {

28660  
´oxyFžeCÚŒÞ
(
id
,
Ý
,
pArg
);

28664  
	gSQLITE_NOTFOUND
;

28677 #iâdeà
__QNXNTO__


28678 
unixSeùÜSize
(
sql™e3_fže
 *
NÙU£d
){

28679 
UNUSED_PARAMETER
(
NÙU£d
);

28680  
	gSQLITE_DEFAULT_SECTOR_SIZE
;

28687 #ifdeà
__QNXNTO__


28688 
	~<sys/dcmd_blk.h
>

28689 
	~<sys/¡©vfs.h
>

28690 
unixSeùÜSize
(
sql™e3_fže
 *
id
){

28691 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

28692 ifÐ
	gpFže
->
	g£ùÜSize
 == 0 ){

28693 
¡©vfs
 
fsInfo
;

28696 
	gpFže
->
	g£ùÜSize
 = 
SQLITE_DEFAULT_SECTOR_SIZE
;

28697 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 = 0;

28698 ifÐ
f¡©vfs
(
pFže
->
h
, &
fsInfo
) == -1 ) {

28699  
pFže
->
£ùÜSize
;

28702 ifÐ!
¡rcmp
(
fsInfo
.
f_ba£ty³
, "tmp") ) {

28703 
	gpFže
->
	g£ùÜSize
 = 
fsInfo
.
f_bsize
;

28704 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28705 
SQLITE_IOCAP_ATOMIC4K
 |

28706 
SQLITE_IOCAP_SAFE_APPEND
 |

28708 
SQLITE_IOCAP_SEQUENTIAL
 |

28711 }ifÐ
¡r¡r
(
fsInfo
.
f_ba£ty³
, "etfs") ){

28712 
	gpFže
->
	g£ùÜSize
 = 
fsInfo
.
f_bsize
;

28713 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28715 (
pFže
->
£ùÜSize
 / 512 * 
SQLITE_IOCAP_ATOMIC512
) |

28716 
SQLITE_IOCAP_SAFE_APPEND
 |

28718 
SQLITE_IOCAP_SEQUENTIAL
 |

28721 }ifÐ!
¡rcmp
(
fsInfo
.
f_ba£ty³
, "qnx6") ){

28722 
	gpFže
->
	g£ùÜSize
 = 
fsInfo
.
f_bsize
;

28723 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28724 
SQLITE_IOCAP_ATOMIC
 |

28725 
SQLITE_IOCAP_SAFE_APPEND
 |

28727 
SQLITE_IOCAP_SEQUENTIAL
 |

28730 }ifÐ!
¡rcmp
(
fsInfo
.
f_ba£ty³
, "qnx4") ){

28731 
	gpFže
->
	g£ùÜSize
 = 
fsInfo
.
f_bsize
;

28732 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28734 ((
pFže
->
£ùÜSize
 / 512 * 
SQLITE_IOCAP_ATOMIC512
) << 1) - 2 |

28735 
SQLITE_IOCAP_SEQUENTIAL
 |

28738 }ifÐ
¡r¡r
(
fsInfo
.
f_ba£ty³
, "dos") ){

28739 
	gpFže
->
	g£ùÜSize
 = 
fsInfo
.
f_bsize
;

28740 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28742 ((
pFže
->
£ùÜSize
 / 512 * 
SQLITE_IOCAP_ATOMIC512
) << 1) - 2 |

28743 
SQLITE_IOCAP_SEQUENTIAL
 |

28747 
	gpFže
->
	gdeviûCh¬aù”i¡ics
 =

28748 
SQLITE_IOCAP_ATOMIC512
 |

28749 
SQLITE_IOCAP_SAFE_APPEND
 |

28756 ifÐ
	gpFže
->
	g£ùÜSize
 % 512 != 0 ){

28757 
pFže
->
deviûCh¬aù”i¡ics
 = 0;

28758 
	gpFže
->
	g£ùÜSize
 = 
SQLITE_DEFAULT_SECTOR_SIZE
;

28760  
	gpFže
->
	g£ùÜSize
;

28777 
unixDeviûCh¬aù”i¡ics
(
sql™e3_fže
 *
id
){

28778 
unixFže
 *
	gp
 = (unixFže*)
id
;

28779 
	grc
 = 0;

28780 #ifdeà
__QNXNTO__


28781 ifÐ
	gp
->
	g£ùÜSize
==0 ) 
unixSeùÜSize
(
id
);

28782 
	grc
 = 
p
->
deviûCh¬aù”i¡ics
;

28784 ifÐ
	gp
->
	gù¾FÏgs
 & 
	gUNIXFILE_PSOW
 ){

28785 
	grc
 |ð
SQLITE_IOCAP_POWERSAFE_OVERWRITE
;

28787  
	grc
;

28790 #ià!
defšed
(
SQLITE_OMIT_WAL
è|| 
SQLITE_MAX_MMAP_SIZE
>0

28798 
unixG‘·gesize
(){

28799 #ià
defšed
(
_BSD_SOURCE
)

28800  
g‘·gesize
();

28802  ()
syscÚf
(
_SC_PAGESIZE
);

28808 #iâdeà
SQLITE_OMIT_WAL


28839 
	sunixShmNode
 {

28840 
unixInodeInfo
 *
	gpInode
;

28841 
sql™e3_mu‹x
 *
	gmu‹x
;

28842 *
	gzFž’ame
;

28843 
	gh
;

28844 
	gszRegiÚ
;

28845 
u16
 
	gnRegiÚ
;

28846 
u8
 
	gisR—dÚly
;

28847 **
	g­RegiÚ
;

28848 
	gnRef
;

28849 
unixShm
 *
	gpFœ¡
;

28850 #ifdeà
SQLITE_DEBUG


28851 
u8
 
	gexþMask
;

28852 
u8
 
	gsh¬edMask
;

28853 
u8
 
	gÃxtShmId
;

28870 
	sunixShm
 {

28871 
unixShmNode
 *
	gpShmNode
;

28872 
unixShm
 *
	gpNext
;

28873 
u8
 
	ghasMu‹x
;

28874 
u8
 
	gid
;

28875 
u16
 
	gsh¬edMask
;

28876 
u16
 
	gexþMask
;

28882 
	#UNIX_SHM_BASE
 ((22+
SQLITE_SHM_NLOCK
)*4è

	)

28883 
	#UNIX_SHM_DMS
 (
UNIX_SHM_BASE
+
SQLITE_SHM_NLOCK
è

	)

28891 
unixShmSy¡emLock
(

28892 
unixShmNode
 *
pShmNode
,

28893 
lockTy³
,

28894 
of¡
,

28895 
n


28897 
æock
 
	gf
;

28898 
	grc
 = 
SQLITE_OK
;

28901 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pShmNode
->
mu‹x
è||…ShmNode->
nRef
==0 );

28904 
as£¹
Ð
n
==1 || 
lockTy³
!=
F_RDLCK
 );

28907 
as£¹
Ð
n
>=1 &&‚<
SQLITE_SHM_NLOCK
 );

28909 ifÐ
	gpShmNode
->
	gh
>=0 ){

28911 
mem£t
(&
f
, 0, (f));

28912 
	gf
.
	gl_ty³
 = 
lockTy³
;

28913 
	gf
.
	gl_wh’û
 = 
SEEK_SET
;

28914 
	gf
.
	gl_¡¬t
 = 
of¡
;

28915 
	gf
.
	gl_Ën
 = 
n
;

28917 
	grc
 = 
osFúŽ
(
pShmNode
->
h
, 
F_SETLK
, &
f
);

28918 
	grc
 = (
rc
!=(-1)è? 
SQLITE_OK
 : 
SQLITE_BUSY
;

28922 #ifdeà
SQLITE_DEBUG


28923 { 
u16
 
	gmask
;

28924 
OSTRACE
(("SHM-LOCK "));

28925 
	gmask
 = 
of¡
>31 ? 0xfffà: (1<<(of¡+
n
)) - (1<<ofst);

28926 ifÐ
	grc
==
SQLITE_OK
 ){

28927 ifÐ
lockTy³
==
F_UNLCK
 ){

28928 
OSTRACE
(("uÆock %d ok", 
of¡
));

28929 
	gpShmNode
->
	gexþMask
 &ð~
mask
;

28930 
	gpShmNode
->
	gsh¬edMask
 &ð~
mask
;

28931 }ifÐ
	glockTy³
==
F_RDLCK
 ){

28932 
OSTRACE
(("»ad-lock %d ok", 
of¡
));

28933 
	gpShmNode
->
	gexþMask
 &ð~
mask
;

28934 
	gpShmNode
->
	gsh¬edMask
 |ð
mask
;

28936 
as£¹
Ð
lockTy³
==
F_WRLCK
 );

28937 
OSTRACE
(("wr™e-lock %d ok", 
of¡
));

28938 
	gpShmNode
->
	gexþMask
 |ð
mask
;

28939 
	gpShmNode
->
	gsh¬edMask
 &ð~
mask
;

28942 ifÐ
	glockTy³
==
F_UNLCK
 ){

28943 
OSTRACE
(("uÆock %d fažed", 
of¡
));

28944 }ifÐ
	glockTy³
==
F_RDLCK
 ){

28945 
OSTRACE
(("read-lock failed"));

28947 
as£¹
Ð
lockTy³
==
F_WRLCK
 );

28948 
OSTRACE
(("wr™e-lock %d fažed", 
of¡
));

28951 
OSTRACE
((" -‡fterwards %03x,%03x\n",

28952 
pShmNode
->
sh¬edMask
,…ShmNode->
exþMask
));

28956  
	grc
;

28968 
unixShmRegiÚP”M­
(){

28969 
	gshmsz
 = 32*1024;

28970 
	gpgsz
 = 
osG‘·gesize
();

28971 
as£¹
Ð((
pgsz
-1)&pgsz)==0 );

28972 ifÐ
	gpgsz
<
	gshmsz
 )  1;

28973  
	gpgsz
/
	gshmsz
;

28982 
unixShmPurge
(
unixFže
 *
pFd
){

28983 
unixShmNode
 *
	gp
 = 
pFd
->
pInode
->
pShmNode
;

28984 
as£¹
Ð
unixMu‹xH–d
() );

28985 ifÐ
	gp
 &&…->
	gnRef
==0 ){

28986 
nShmP”M­
 = 
unixShmRegiÚP”M­
();

28987 
	gi
;

28988 
as£¹
Ð
p
->
pInode
==
pFd
->pInode );

28989 
sql™e3_mu‹x_ä“
(
p
->
mu‹x
);

28990 
	gi
=0; i<
	gp
->
	gnRegiÚ
; i+=
nShmP”M­
){

28991 ifÐ
p
->
h
>=0 ){

28992 
osMunm­
(
p
->
­RegiÚ
[
i
],…->
szRegiÚ
);

28994 
sql™e3_ä“
(
p
->
­RegiÚ
[
i
]);

28997 
sql™e3_ä“
(
p
->
­RegiÚ
);

28998 ifÐ
	gp
->
	gh
>=0 ){

28999 
robu¡_þo£
(
pFd
, 
p
->
h
, 
__LINE__
);

29000 
	gp
->
	gh
 = -1;

29002 
	gp
->
	gpInode
->
	gpShmNode
 = 0;

29003 
sql™e3_ä“
(
p
);

29042 
unixO³nSh¬edMemÜy
(
unixFže
 *
pDbFd
){

29043 
unixShm
 *
	gp
 = 0;

29044 
unixShmNode
 *
	gpShmNode
;

29045 
	grc
;

29046 
unixInodeInfo
 *
	gpInode
;

29047 *
	gzShmFž’ame
;

29048 
	gnShmFž’ame
;

29051 
	gp
 = 
sql™e3_m®loc
Ð(*
p
) );

29052 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

29053 
mem£t
(
p
, 0, (*p));

29054 
as£¹
Ð
pDbFd
->
pShm
==0 );

29059 
unixEÁ”Mu‹x
();

29060 
	gpInode
 = 
pDbFd
->
pInode
;

29061 
	gpShmNode
 = 
pInode
->
pShmNode
;

29062 ifÐ
	gpShmNode
==0 ){

29063 
¡©
 
sSt
;

29069 ifÐ
osF¡©
(
pDbFd
->
h
, &
sSt
è&& 
	gpInode
->
	gbProûssLock
==0 ){

29070 
rc
 = 
SQLITE_IOERR_FSTAT
;

29071 
	gshm_Ý’_”r
;

29074 #ifdeà
SQLITE_SHM_DIRECTORY


29075 
	gnShmFž’ame
 = (
SQLITE_SHM_DIRECTORY
) + 31;

29077 
	gnShmFž’ame
 = 6 + ()
¡¾’
(
pDbFd
->
zP©h
);

29079 
	gpShmNode
 = 
sql™e3_m®loc
Ð(*
pShmNode
è+ 
nShmFž’ame
 );

29080 ifÐ
	gpShmNode
==0 ){

29081 
rc
 = 
SQLITE_NOMEM
;

29082 
	gshm_Ý’_”r
;

29084 
mem£t
(
pShmNode
, 0, (*pShmNode)+
nShmFž’ame
);

29085 
	gzShmFž’ame
 = 
pShmNode
->
zFž’ame
 = (*)&pShmNode[1];

29086 #ifdeà
SQLITE_SHM_DIRECTORY


29087 
sql™e3_¢´štf
(
nShmFž’ame
, 
zShmFž’ame
,

29088 
SQLITE_SHM_DIRECTORY
 "/sqlite-shm-%x-%x",

29089 (
u32
)
sSt
.
¡_šo
, (u32)sSt.
¡_dev
);

29091 
sql™e3_¢´štf
(
nShmFž’ame
, 
zShmFž’ame
, "%s-shm", 
pDbFd
->
zP©h
);

29092 
sql™e3FžeSuffix3
(
pDbFd
->
zP©h
, 
zShmFž’ame
);

29094 
	gpShmNode
->
	gh
 = -1;

29095 
	gpDbFd
->
	gpInode
->
	gpShmNode
 = 
pShmNode
;

29096 
	gpShmNode
->
	gpInode
 = 
pDbFd
->
pInode
;

29097 
	gpShmNode
->
	gmu‹x
 = 
sql™e3_mu‹x_®loc
(
SQLITE_MUTEX_FAST
);

29098 ifÐ
	gpShmNode
->
	gmu‹x
==0 ){

29099 
rc
 = 
SQLITE_NOMEM
;

29100 
	gshm_Ý’_”r
;

29103 ifÐ
	gpInode
->
	gbProûssLock
==0 ){

29104 
Ý’FÏgs
 = 
O_RDWR
 | 
O_CREAT
;

29105 ifÐ
sql™e3_uri_boÞ—n
(
pDbFd
->
zP©h
, "readonly_shm", 0) ){

29106 
	gÝ’FÏgs
 = 
O_RDONLY
;

29107 
	gpShmNode
->
	gisR—dÚly
 = 1;

29109 
	gpShmNode
->
	gh
 = 
robu¡_Ý’
(
zShmFž’ame
, 
Ý’FÏgs
, (
sSt
.
¡_mode
&0777));

29110 ifÐ
	gpShmNode
->
	gh
<0 ){

29111 
	grc
 = 
unixLogE¼Ü
(
SQLITE_CANTOPEN_BKPT
, "Ý’", 
zShmFž’ame
);

29112 
	gshm_Ý’_”r
;

29119 
osFchown
(
pShmNode
->
h
, 
sSt
.
¡_uid
, sSt.
¡_gid
);

29124 
	grc
 = 
SQLITE_OK
;

29125 ifÐ
unixShmSy¡emLock
(
pShmNode
, 
F_WRLCK
, 
UNIX_SHM_DMS
, 1)==
SQLITE_OK
 ){

29126 ifÐ
robu¡_árunÿ‹
(
pShmNode
->
h
, 0) ){

29127 
rc
 = 
unixLogE¼Ü
(
SQLITE_IOERR_SHMOPEN
, "árunÿ‹", 
zShmFž’ame
);

29130 ifÐ
	grc
==
SQLITE_OK
 ){

29131 
rc
 = 
unixShmSy¡emLock
(
pShmNode
, 
F_RDLCK
, 
UNIX_SHM_DMS
, 1);

29133 ifÐ
	grc
 ) 
	gshm_Ý’_”r
;

29138 
	gp
->
	gpShmNode
 = 
pShmNode
;

29139 #ifdeà
SQLITE_DEBUG


29140 
	gp
->
	gid
 = 
pShmNode
->
ÃxtShmId
++;

29142 
	gpShmNode
->
	gnRef
++;

29143 
	gpDbFd
->
	gpShm
 = 
p
;

29144 
unixL—veMu‹x
();

29153 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

29154 
	gp
->
	gpNext
 = 
pShmNode
->
pFœ¡
;

29155 
	gpShmNode
->
	gpFœ¡
 = 
p
;

29156 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

29157  
	gSQLITE_OK
;

29160 
	gshm_Ý’_”r
:

29161 
unixShmPurge
(
pDbFd
);

29162 
sql™e3_ä“
(
p
);

29163 
unixL—veMu‹x
();

29164  
	grc
;

29186 
unixShmM­
(

29187 
sql™e3_fže
 *
fd
,

29188 
iRegiÚ
,

29189 
szRegiÚ
,

29190 
bEx‹nd
,

29191 vÞ©ž**
µ


29193 
unixFže
 *
	gpDbFd
 = (unixFže*)
fd
;

29194 
unixShm
 *
	gp
;

29195 
unixShmNode
 *
	gpShmNode
;

29196 
	grc
 = 
SQLITE_OK
;

29197 
	gnShmP”M­
 = 
unixShmRegiÚP”M­
();

29198 
	gnReqRegiÚ
;

29201 ifÐ
	gpDbFd
->
	gpShm
==0 ){

29202 
rc
 = 
unixO³nSh¬edMemÜy
(
pDbFd
);

29203 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

29206 
	gp
 = 
pDbFd
->
pShm
;

29207 
	gpShmNode
 = 
p
->
pShmNode
;

29208 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

29209 
as£¹
Ð
szRegiÚ
==
pShmNode
->szRegiÚ ||…ShmNode->
nRegiÚ
==0 );

29210 
as£¹
Ð
pShmNode
->
pInode
==
pDbFd
->pInode );

29211 
as£¹
Ð
pShmNode
->
h
>=0 || 
pDbFd
->
pInode
->
bProûssLock
==1 );

29212 
as£¹
Ð
pShmNode
->
h
<0 || 
pDbFd
->
pInode
->
bProûssLock
==0 );

29215 
	gnReqRegiÚ
 = ((
iRegiÚ
+
nShmP”M­
) /‚ShmPerMap) *‚ShmPerMap;

29217 ifÐ
	gpShmNode
->
	gnRegiÚ
<
	gnReqRegiÚ
 ){

29218 **
	g­New
;

29219 
	gnBy‹
 = 
nReqRegiÚ
*
szRegiÚ
;

29220 
¡©
 
	gsSt
;

29222 
	gpShmNode
->
	gszRegiÚ
 = 
szRegiÚ
;

29224 ifÐ
	gpShmNode
->
	gh
>=0 ){

29229 ifÐ
osF¡©
(
pShmNode
->
h
, &
sSt
) ){

29230 
rc
 = 
SQLITE_IOERR_SHMSIZE
;

29231 
	gshm·ge_out
;

29234 ifÐ
	gsSt
.
	g¡_size
<
	gnBy‹
 ){

29238 ifÐ!
	gbEx‹nd
 ){

29239 
	gshm·ge_out
;

29250 cÚ¡ 
	gpgsz
 = 4096;

29251 
	giPg
;

29254 
as£¹
Ð(
nBy‹
 % 
pgsz
)==0 );

29255 
	giPg
=(
sSt
.
¡_size
/
pgsz
); iPg<(
	gnBy‹
/
	gpgsz
); iPg++){

29256 ifÐ
£ekAndWr™eFd
(
pShmNode
->
h
, 
iPg
*
pgsz
 +…gsz-1, "", 1, 0)!=1 ){

29257 cÚ¡ *
zFže
 = 
pShmNode
->
zFž’ame
;

29258 
	grc
 = 
unixLogE¼Ü
(
SQLITE_IOERR_SHMSIZE
, "wr™e", 
zFže
);

29259 
	gshm·ge_out
;

29267 
	g­New
 = (**)
sql™e3_»®loc
(

29268 
pShmNode
->
­RegiÚ
, 
nReqRegiÚ
*(*)

29270 ifÐ!
	g­New
 ){

29271 
	grc
 = 
SQLITE_IOERR_NOMEM
;

29272 
	gshm·ge_out
;

29274 
	gpShmNode
->
	g­RegiÚ
 = 
­New
;

29275  
	gpShmNode
->
	gnRegiÚ
<
	gnReqRegiÚ
 ){

29276 
	gnM­
 = 
szRegiÚ
*
nShmP”M­
;

29277 
	gi
;

29278 *
	gpMem
;

29279 ifÐ
	gpShmNode
->
	gh
>=0 ){

29280 
pMem
 = 
osMm­
(0, 
nM­
,

29281 
pShmNode
->
isR—dÚly
 ? 
PROT_READ
 : PROT_READ|
PROT_WRITE
,

29282 
MAP_SHARED
, 
pShmNode
->
h
, 
szRegiÚ
*(
i64
íShmNode->
nRegiÚ


29284 ifÐ
	gpMem
==
MAP_FAILED
 ){

29285 
rc
 = 
unixLogE¼Ü
(
SQLITE_IOERR_SHMMAP
, "mm­", 
pShmNode
->
zFž’ame
);

29286 
	gshm·ge_out
;

29289 
	gpMem
 = 
sql™e3_m®loc
(
szRegiÚ
);

29290 ifÐ
	gpMem
==0 ){

29291 
rc
 = 
SQLITE_NOMEM
;

29292 
	gshm·ge_out
;

29294 
mem£t
(
pMem
, 0, 
szRegiÚ
);

29297 
	gi
=0; i<
	gnShmP”M­
; i++){

29298 
	gpShmNode
->
	g­RegiÚ
[
pShmNode
->
nRegiÚ
+
i
] = &((*)
pMem
)[
szRegiÚ
*i];

29300 
	gpShmNode
->
	gnRegiÚ
 +ð
nShmP”M­
;

29304 
	gshm·ge_out
:

29305 ifÐ
pShmNode
->
nRegiÚ
>
iRegiÚ
 ){

29306 *
µ
 = 
pShmNode
->
­RegiÚ
[
iRegiÚ
];

29308 *
	gµ
 = 0;

29310 ifÐ
	gpShmNode
->
	gisR—dÚly
 && 
	grc
==
SQLITE_OK
 ) 
rc
 = 
SQLITE_READONLY
;

29311 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

29312  
	grc
;

29323 
unixShmLock
(

29324 
sql™e3_fže
 *
fd
,

29325 
of¡
,

29326 
n
,

29327 
æags


29329 
unixFže
 *
	gpDbFd
 = (unixFže*)
fd
;

29330 
unixShm
 *
	gp
 = 
pDbFd
->
pShm
;

29331 
unixShm
 *
	gpX
;

29332 
unixShmNode
 *
	gpShmNode
 = 
p
->
pShmNode
;

29333 
	grc
 = 
SQLITE_OK
;

29334 
u16
 
	gmask
;

29336 
as£¹
Ð
pShmNode
==
pDbFd
->
pInode
->pShmNode );

29337 
as£¹
Ð
pShmNode
->
pInode
==
pDbFd
->pInode );

29338 
as£¹
Ð
of¡
>=0 && of¡+
n
<=
SQLITE_SHM_NLOCK
 );

29339 
as£¹
Ð
n
>=1 );

29340 
as£¹
Ð
æags
==(
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_SHARED
)

29341 || 
æags
==(
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_EXCLUSIVE
)

29342 || 
æags
==(
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_SHARED
)

29343 || 
æags
==(
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_EXCLUSIVE
) );

29344 
as£¹
Ð
n
==1 || (
æags
 & 
SQLITE_SHM_EXCLUSIVE
)!=0 );

29345 
as£¹
Ð
pShmNode
->
h
>=0 || 
pDbFd
->
pInode
->
bProûssLock
==1 );

29346 
as£¹
Ð
pShmNode
->
h
<0 || 
pDbFd
->
pInode
->
bProûssLock
==0 );

29348 
	gmask
 = (1<<(
of¡
+
n
)) - (1<<ofst);

29349 
as£¹
Ð
n
>1 || 
mask
==(1<<
of¡
) );

29350 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

29351 ifÐ
	gæags
 & 
	gSQLITE_SHM_UNLOCK
 ){

29352 
u16
 
	g®lMask
 = 0;

29355 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

29356 ifÐ
pX
==
p
 ) ;

29357 
as£¹
Ð(
pX
->
exþMask
 & (
p
->exþMask|p->
sh¬edMask
))==0 );

29358 
	g®lMask
 |ð
pX
->
sh¬edMask
;

29362 ifÐ(
	gmask
 & 
	g®lMask
)==0 ){

29363 
rc
 = 
unixShmSy¡emLock
(
pShmNode
, 
F_UNLCK
, 
of¡
+
UNIX_SHM_BASE
, 
n
);

29365 
	grc
 = 
SQLITE_OK
;

29369 ifÐ
	grc
==
SQLITE_OK
 ){

29370 
p
->
exþMask
 &ð~
mask
;

29371 
	gp
->
	gsh¬edMask
 &ð~
mask
;

29373 }ifÐ
	gæags
 & 
	gSQLITE_SHM_SHARED
 ){

29374 
u16
 
	g®lSh¬ed
 = 0;

29380 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

29381 ifÐ(
pX
->
exþMask
 & 
mask
)!=0 ){

29382 
rc
 = 
SQLITE_BUSY
;

29385 
	g®lSh¬ed
 |ð
pX
->
sh¬edMask
;

29389 ifÐ
	grc
==
SQLITE_OK
 ){

29390 ifÐ(
®lSh¬ed
 & 
mask
)==0 ){

29391 
rc
 = 
unixShmSy¡emLock
(
pShmNode
, 
F_RDLCK
, 
of¡
+
UNIX_SHM_BASE
, 
n
);

29393 
	grc
 = 
SQLITE_OK
;

29398 ifÐ
	grc
==
SQLITE_OK
 ){

29399 
p
->
sh¬edMask
 |ð
mask
;

29405 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

29406 ifÐ(
pX
->
exþMask
 & 
mask
)!=0 || (pX->
sh¬edMask
 & mask)!=0 ){

29407 
rc
 = 
SQLITE_BUSY
;

29415 ifÐ
	grc
==
SQLITE_OK
 ){

29416 
rc
 = 
unixShmSy¡emLock
(
pShmNode
, 
F_WRLCK
, 
of¡
+
UNIX_SHM_BASE
, 
n
);

29417 ifÐ
	grc
==
SQLITE_OK
 ){

29418 
as£¹
Ð(
p
->
sh¬edMask
 & 
mask
)==0 );

29419 
	gp
->
	gexþMask
 |ð
mask
;

29423 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

29424 
OSTRACE
(("SHM-LOCK shmid-%d,…id-%d got %03x,%03x\n",

29425 
p
->
id
, 
g‘pid
(),…->
sh¬edMask
,…->
exþMask
));

29426  
	grc
;

29435 
unixShmB¬r›r
(

29436 
sql™e3_fže
 *
fd


29438 
UNUSED_PARAMETER
(
fd
);

29439 
unixEÁ”Mu‹x
();

29440 
unixL—veMu‹x
();

29450 
unixShmUnm­
(

29451 
sql™e3_fže
 *
fd
,

29452 
d–‘eFÏg


29454 
unixShm
 *
	gp
;

29455 
unixShmNode
 *
	gpShmNode
;

29456 
unixShm
 **
	gµ
;

29457 
unixFže
 *
	gpDbFd
;

29459 
	gpDbFd
 = (
unixFže
*)
fd
;

29460 
	gp
 = 
pDbFd
->
pShm
;

29461 ifÐ
	gp
==0 )  
SQLITE_OK
;

29462 
	gpShmNode
 = 
p
->
pShmNode
;

29464 
as£¹
Ð
pShmNode
==
pDbFd
->
pInode
->pShmNode );

29465 
as£¹
Ð
pShmNode
->
pInode
==
pDbFd
->pInode );

29469 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

29470 
	gµ
=&
pShmNode
->
pFœ¡
; (*µ)!=
p
;…°ð&(*
µ
)->
pNext
){}

29471 *
µ
 = 
p
->
pNext
;

29474 
sql™e3_ä“
(
p
);

29475 
	gpDbFd
->
	gpShm
 = 0;

29476 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

29480 
unixEÁ”Mu‹x
();

29481 
as£¹
Ð
pShmNode
->
nRef
>0 );

29482 
	gpShmNode
->
	gnRef
--;

29483 ifÐ
	gpShmNode
->
	gnRef
==0 ){

29484 ifÐ
d–‘eFÏg
 && 
pShmNode
->
h
>=0 ) 
osUÆšk
ÕShmNode->
zFž’ame
);

29485 
unixShmPurge
(
pDbFd
);

29487 
unixL—veMu‹x
();

29489  
	gSQLITE_OK
;

29494 
	#unixShmM­
 0

	)

29495 
	#unixShmLock
 0

	)

29496 
	#unixShmB¬r›r
 0

	)

29497 
	#unixShmUnm­
 0

	)

29500 #ià
SQLITE_MAX_MMAP_SIZE
>0

29504 
unixUnm­fže
(
unixFže
 *
pFd
){

29505 
as£¹
Ð
pFd
->
nF‘chOut
==0 );

29506 ifÐ
	gpFd
->
	gpM­RegiÚ
 ){

29507 
osMunm­
(
pFd
->
pM­RegiÚ
,…Fd->
mm­SizeAùu®
);

29508 
	gpFd
->
	gpM­RegiÚ
 = 0;

29509 
	gpFd
->
	gmm­Size
 = 0;

29510 
	gpFd
->
	gmm­SizeAùu®
 = 0;

29529 
unixRem­fže
(

29530 
unixFže
 *
pFd
,

29531 
i64
 
nNew


29533 cÚ¡ *
	gzE¼
 = "mmap";

29534 
	gh
 = 
pFd
->
h
;

29535 
u8
 *
	gpOrig
 = (u8 *)
pFd
->
pM­RegiÚ
;

29536 
i64
 
	gnOrig
 = 
pFd
->
mm­SizeAùu®
;

29537 
u8
 *
	gpNew
 = 0;

29538 
	gæags
 = 
PROT_READ
;

29540 
as£¹
Ð
pFd
->
nF‘chOut
==0 );

29541 
as£¹
Ð
nNew
>
pFd
->
mm­Size
 );

29542 
as£¹
Ð
nNew
<=
pFd
->
mm­SizeMax
 );

29543 
as£¹
Ð
nNew
>0 );

29544 
as£¹
Ð
pFd
->
mm­SizeAùu®
>õFd->
mm­Size
 );

29545 
as£¹
Ð
MAP_FAILED
!=0 );

29547 ifÐ(
	gpFd
->
	gù¾FÏgs
 & 
	gUNIXFILE_RDONLY
)==0 ) 
æags
 |ð
PROT_WRITE
;

29549 ifÐ
	gpOrig
 ){

29550 #ià
HAVE_MREMAP


29551 
i64
 
	gnReu£
 = 
pFd
->
mm­Size
;

29553 cÚ¡ 
	gszSy¥age
 = 
osG‘·gesize
();

29554 
i64
 
	gnReu£
 = (
pFd
->
mm­Size
 & ~(
szSy¥age
-1));

29556 
u8
 *
	gpReq
 = &
pOrig
[
nReu£
];

29559 ifÐ
	gnReu£
!=
nOrig
 ){

29560 
osMunm­
(
pReq
, 
nOrig
-
nReu£
);

29563 #ià
HAVE_MREMAP


29564 
	gpNew
 = 
osM»m­
(
pOrig
, 
nReu£
, 
nNew
, 
MREMAP_MAYMOVE
);

29565 
	gzE¼
 = "mremap";

29567 
	gpNew
 = 
osMm­
(
pReq
, 
nNew
-
nReu£
, 
æags
, 
MAP_SHARED
, 
h
,‚Reuse);

29568 ifÐ
	gpNew
!=
MAP_FAILED
 ){

29569 ifÐ
pNew
!=
pReq
 ){

29570 
osMunm­
(
pNew
, 
nNew
 - 
nReu£
);

29571 
	gpNew
 = 0;

29573 
	gpNew
 = 
pOrig
;

29579 ifÐ
	gpNew
==
MAP_FAILED
 || 
pNew
==0 ){

29580 
osMunm­
(
pOrig
, 
nReu£
);

29585 ifÐ
	gpNew
==0 ){

29586 
pNew
 = 
osMm­
(0, 
nNew
, 
æags
, 
MAP_SHARED
, 
h
, 0);

29589 ifÐ
	gpNew
==
MAP_FAILED
 ){

29590 
pNew
 = 0;

29591 
	gnNew
 = 0;

29592 
unixLogE¼Ü
(
SQLITE_OK
, 
zE¼
, 
pFd
->
zP©h
);

29597 
	gpFd
->
	gmm­SizeMax
 = 0;

29599 
	gpFd
->
	gpM­RegiÚ
 = (*)
pNew
;

29600 
	gpFd
->
	gmm­Size
 = 
pFd
->
mm­SizeAùu®
 = 
nNew
;

29619 
unixM­fže
(
unixFže
 *
pFd
, 
i64
 
nBy‹
){

29620 
i64
 
	gnM­
 = 
nBy‹
;

29621 
	grc
;

29623 
as£¹
Ð
nM­
>=0 || 
pFd
->
nF‘chOut
==0 );

29624 ifÐ
	gpFd
->
	gnF‘chOut
>0 )  
	gSQLITE_OK
;

29626 ifÐ
	gnM­
<0 ){

29627 
¡©
 
	g¡©buf
;

29628 
	grc
 = 
osF¡©
(
pFd
->
h
, &
¡©buf
);

29629 ifÐ
	grc
!=
SQLITE_OK
 ){

29630  
SQLITE_IOERR_FSTAT
;

29632 
	gnM­
 = 
¡©buf
.
¡_size
;

29634 ifÐ
	gnM­
>
	gpFd
->
	gmm­SizeMax
 ){

29635 
	gnM­
 = 
pFd
->
mm­SizeMax
;

29638 ifÐ
	gnM­
!=
pFd
->
mm­Size
 ){

29639 ifÐ
nM­
>0 ){

29640 
unixRem­fže
(
pFd
, 
nM­
);

29642 
unixUnm­fže
(
pFd
);

29646  
	gSQLITE_OK
;

29662 
unixF‘ch
(
sql™e3_fže
 *
fd
, 
i64
 
iOff
, 
nAmt
, **
µ
){

29663 #ià
SQLITE_MAX_MMAP_SIZE
>0

29664 
unixFže
 *
	gpFd
 = (unixFž*)
fd
;

29666 *
	gµ
 = 0;

29668 #ià
SQLITE_MAX_MMAP_SIZE
>0

29669 ifÐ
	gpFd
->
	gmm­SizeMax
>0 ){

29670 ifÐ
	gpFd
->
	gpM­RegiÚ
==0 ){

29671 
rc
 = 
unixM­fže
(
pFd
, -1);

29672 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

29674 ifÐ
	gpFd
->
	gmm­Size
 >ð
iOff
+
nAmt
 ){

29675 *
µ
 = &((
u8
 *)
pFd
->
pM­RegiÚ
)[
iOff
];

29676 
	gpFd
->
	gnF‘chOut
++;

29680  
	gSQLITE_OK
;

29693 
unixUnãtch
(
sql™e3_fže
 *
fd
, 
i64
 
iOff
, *
p
){

29694 #ià
SQLITE_MAX_MMAP_SIZE
>0

29695 
unixFže
 *
	gpFd
 = (unixFž*)
fd
;

29696 
UNUSED_PARAMETER
(
iOff
);

29701 
as£¹
Ð(
p
==0)==(
pFd
->
nF‘chOut
==0) );

29704 
as£¹
Ð
p
==0 ||…==&((
u8
 *)
pFd
->
pM­RegiÚ
)[
iOff
] );

29706 ifÐ
	gp
 ){

29707 
	gpFd
->
	gnF‘chOut
--;

29709 
unixUnm­fže
(
pFd
);

29712 
as£¹
Ð
pFd
->
nF‘chOut
>=0 );

29714 
UNUSED_PARAMETER
(
fd
);

29715 
UNUSED_PARAMETER
(
p
);

29716 
UNUSED_PARAMETER
(
iOff
);

29718  
	gSQLITE_OK
;

29761 
	#IOMETHODS
(
FINDER
, 
METHOD
, 
VERSION
, 
CLOSE
, 
LOCK
, 
UNLOCK
, 
CKLOCK
, 
SHMMAP
) \

29762 cÚ¡ 
sql™e3_io_m‘hods
 
METHOD
 = { \

29763 
VERSION
, \

29764 
CLOSE
, \

29765 
unixR—d
, \

29766 
unixWr™e
, \

29767 
unixTrunÿ‹
, \

29768 
unixSync
, \

29769 
unixFžeSize
, \

29770 
LOCK
, \

29771 
UNLOCK
, \

29772 
CKLOCK
, \

29773 
unixFžeCÚŒÞ
, \

29774 
unixSeùÜSize
, \

29775 
unixDeviûCh¬aù”i¡ics
, \

29776 
SHMMAP
, \

29777 
unixShmLock
, \

29778 
unixShmB¬r›r
, \

29779 
unixShmUnm­
, \

29780 
unixF‘ch
, \

29781 
unixUnãtch
, \

29783 cÚ¡ 
sql™e3_io_m‘hods
 *
FINDER
##
	`Im¶
(cÚ¡ *
z
, 
unixFže
 *
p
){ \

29784 
	`UNUSED_PARAMETER
(
z
); UNUSED_PARAMETER(
p
); \

29785  &
METHOD
; \

29787 cÚ¡ 
sql™e3_io_m‘hods
 *(*cÚ¡ 
FINDER
)(cÚ¡ *,
unixFže
 *
p
) \

29788 ð
FINDER
##
Im¶
;

	)

29795 
IOMETHODS
(

29796 
posixIoFšd”
,

29797 
posixIoM‘hods
,

29799 
unixClo£
,

29800 
unixLock
,

29801 
unixUÆock
,

29802 
unixCheckRe£rvedLock
,

29803 
unixShmM­


29805 
IOMETHODS
(

29806 
nÞockIoFšd”
,

29807 
nÞockIoM‘hods
,

29809 
nÞockClo£
,

29810 
nÞockLock
,

29811 
nÞockUÆock
,

29812 
nÞockCheckRe£rvedLock
,

29815 
IOMETHODS
(

29816 
dÙlockIoFšd”
,

29817 
dÙlockIoM‘hods
,

29819 
dÙlockClo£
,

29820 
dÙlockLock
,

29821 
dÙlockUÆock
,

29822 
dÙlockCheckRe£rvedLock
,

29826 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && !
OS_VXWORKS


29827 
IOMETHODS
(

29828 
æockIoFšd”
,

29829 
æockIoM‘hods
,

29831 
æockClo£
,

29832 
æockLock
,

29833 
æockUÆock
,

29834 
æockCheckRe£rvedLock
,

29839 #ià
OS_VXWORKS


29840 
IOMETHODS
(

29841 
£mIoFšd”
,

29842 
£mIoM‘hods
,

29844 
£mClo£
,

29845 
£mLock
,

29846 
£mUÆock
,

29847 
£mCheckRe£rvedLock
,

29852 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


29853 
IOMETHODS
(

29854 
aåIoFšd”
,

29855 
aåIoM‘hods
,

29857 
aåClo£
,

29858 
aåLock
,

29859 
aåUÆock
,

29860 
aåCheckRe£rvedLock
,

29874 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


29875 
´oxyClo£
(
sql™e3_fže
*);

29876 
´oxyLock
(
sql™e3_fže
*, );

29877 
´oxyUÆock
(
sql™e3_fže
*, );

29878 
´oxyCheckRe£rvedLock
(
sql™e3_fže
*, *);

29879 
IOMETHODS
(

29880 
´oxyIoFšd”
,

29881 
´oxyIoM‘hods
,

29883 
´oxyClo£
,

29884 
´oxyLock
,

29885 
´oxyUÆock
,

29886 
´oxyCheckRe£rvedLock
,

29892 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


29893 
IOMETHODS
(

29894 
nfsIoFšd”
,

29895 
nfsIoM‘hods
,

29897 
unixClo£
,

29898 
unixLock
,

29899 
nfsUÆock
,

29900 
unixCheckRe£rvedLock
,

29905 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


29913 cÚ¡ 
sql™e3_io_m‘hods
 *
autÞockIoFšd”Im¶
(

29914 cÚ¡ *
fžeP©h
,

29915 
unixFže
 *
pNew


29917 cÚ¡ 
	sM­pšg
 {

29918 cÚ¡ *
	gzFžesy¡em
;

29919 cÚ¡ 
sql™e3_io_m‘hods
 *
	gpM‘hods
;

29920 } 
	gaM­
[] = {

29921 { "hfs", &
posixIoM‘hods
 },

29922 { "ufs", &
posixIoM‘hods
 },

29923 { "aåfs", &
aåIoM‘hods
 },

29924 { "smbfs", &
aåIoM‘hods
 },

29925 { "webdav", &
nÞockIoM‘hods
 },

29928 
	gi
;

29929 
¡©fs
 
	gfsInfo
;

29930 
æock
 
	glockInfo
;

29932 ifÐ!
	gfžeP©h
 ){

29935  &
	gnÞockIoM‘hods
;

29937 ifÐ
¡©fs
(
fžeP©h
, &
fsInfo
) != -1 ){

29938 ifÐ
fsInfo
.
f_æags
 & 
MNT_RDONLY
 ){

29939  &
nÞockIoM‘hods
;

29941 
	gi
=0; 
	gaM­
[
i
].
	gzFžesy¡em
; i++){

29942 ifÐ
¡rcmp
(
fsInfo
.
f_f¡y³Çme
, 
aM­
[
i
].
zFžesy¡em
)==0 ){

29943  
aM­
[
i
].
pM‘hods
;

29952 
	glockInfo
.
	gl_Ën
 = 1;

29953 
	glockInfo
.
	gl_¡¬t
 = 0;

29954 
	glockInfo
.
	gl_wh’û
 = 
SEEK_SET
;

29955 
	glockInfo
.
	gl_ty³
 = 
F_RDLCK
;

29956 ifÐ
osFúŽ
(
pNew
->
h
, 
F_GETLK
, &
lockInfo
)!=-1 ) {

29957 ifÐ
¡rcmp
(
fsInfo
.
f_f¡y³Çme
, "nfs")==0 ){

29958  &
nfsIoM‘hods
;

29960  &
	gposixIoM‘hods
;

29963  &
	gdÙlockIoM‘hods
;

29966 cÚ¡ 
	gsql™e3_io_m‘hods


29967 *(*cÚ¡ 
	gautÞockIoFšd”
)(cÚ¡ *,
	gunixFže
*èð
autÞockIoFšd”Im¶
;

29971 #ià
OS_VXWORKS
 && 
SQLITE_ENABLE_LOCKING_STYLE


29979 cÚ¡ 
sql™e3_io_m‘hods
 *
autÞockIoFšd”Im¶
(

29980 cÚ¡ *
fžeP©h
,

29981 
unixFže
 *
pNew


29983 
æock
 
	glockInfo
;

29985 ifÐ!
	gfžeP©h
 ){

29988  &
	gnÞockIoM‘hods
;

29994 
	glockInfo
.
	gl_Ën
 = 1;

29995 
	glockInfo
.
	gl_¡¬t
 = 0;

29996 
	glockInfo
.
	gl_wh’û
 = 
SEEK_SET
;

29997 
	glockInfo
.
	gl_ty³
 = 
F_RDLCK
;

29998 ifÐ
osFúŽ
(
pNew
->
h
, 
F_GETLK
, &
lockInfo
)!=-1 ) {

29999  &
posixIoM‘hods
;

30001  &
	g£mIoM‘hods
;

30004 cÚ¡ 
	gsql™e3_io_m‘hods


30005 *(*cÚ¡ 
	gautÞockIoFšd”
)(cÚ¡ *,
	gunixFže
*èð
autÞockIoFšd”Im¶
;

30012 cÚ¡ 
	tsql™e3_io_m‘hods
 *(*
	tfšd”_ty³
)(cÚ¡ *,
	tunixFže
*);

30025 
fžlInUnixFže
(

30026 
sql™e3_vfs
 *
pVfs
,

30027 
h
,

30028 
sql™e3_fže
 *
pId
,

30029 cÚ¡ *
zFž’ame
,

30030 
ù¾FÏgs


30032 cÚ¡ 
sql™e3_io_m‘hods
 *
	gpLockšgStyË
;

30033 
unixFže
 *
	gpNew
 = (unixFž*)
pId
;

30034 
	grc
 = 
SQLITE_OK
;

30036 
as£¹
Ð
pNew
->
pInode
==
NULL
 );

30042 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


30043 
as£¹
Ð
zFž’ame
==0 || zFilename[0]=='/'

30044 || 
pVfs
->
pAµD©a
==(*)&
autÞockIoFšd”
 );

30046 
as£¹
Ð
zFž’ame
==0 || zFilename[0]=='/' );

30050 
as£¹
Ð
zFž’ame
!=0 || (
ù¾FÏgs
 & 
UNIXFILE_NOLOCK
)!=0 );

30052 
OSTRACE
(("OPEN %-3d %s\n", 
h
, 
zFž’ame
));

30053 
	gpNew
->
	gh
 = 
h
;

30054 
	gpNew
->
	gpVfs
 = 
pVfs
;

30055 
	gpNew
->
	gzP©h
 = 
zFž’ame
;

30056 
	gpNew
->
	gù¾FÏgs
 = (
u8
)
ù¾FÏgs
;

30057 #ià
SQLITE_MAX_MMAP_SIZE
>0

30058 
	gpNew
->
	gmm­SizeMax
 = 
sql™e3Glob®CÚfig
.
szMm­
;

30060 ifÐ
sql™e3_uri_boÞ—n
(((
ù¾FÏgs
 & 
UNIXFILE_URI
è? 
zFž’ame
 : 0),

30061 "psow", 
SQLITE_POWERSAFE_OVERWRITE
) ){

30062 
	gpNew
->
	gù¾FÏgs
 |ð
UNIXFILE_PSOW
;

30064 ifÐ
¡rcmp
(
pVfs
->
zName
,"unix-excl")==0 ){

30065 
pNew
->
ù¾FÏgs
 |ð
UNIXFILE_EXCL
;

30068 #ià
OS_VXWORKS


30069 
	gpNew
->
	gpId
 = 
vxwÜksFšdFžeId
(
zFž’ame
);

30070 ifÐ
	gpNew
->
	gpId
==0 ){

30071 
ù¾FÏgs
 |ð
UNIXFILE_NOLOCK
;

30072 
	grc
 = 
SQLITE_NOMEM
;

30076 ifÐ
	gù¾FÏgs
 & 
	gUNIXFILE_NOLOCK
 ){

30077 
	gpLockšgStyË
 = &
nÞockIoM‘hods
;

30079 
	gpLockšgStyË
 = (**(
fšd”_ty³
*)
pVfs
->
pAµD©a
)(
zFž’ame
, 
	gpNew
);

30080 #ià
SQLITE_ENABLE_LOCKING_STYLE


30084 
	gpNew
->
	glockšgCÚ‹xt
 = (*)
zFž’ame
;

30088 ifÐ
	gpLockšgStyË
 =ð&
posixIoM‘hods


30089 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


30090 || 
pLockšgStyË
 =ð&
nfsIoM‘hods


30093 
unixEÁ”Mu‹x
();

30094 
	grc
 = 
fšdInodeInfo
(
pNew
, &pNew->
pInode
);

30095 ifÐ
	grc
!=
SQLITE_OK
 ){

30114 
robu¡_þo£
(
pNew
, 
h
, 
__LINE__
);

30115 
	gh
 = -1;

30117 
unixL—veMu‹x
();

30120 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && 
defšed
(
__APPLE__
)

30121 ifÐ
	gpLockšgStyË
 =ð&
aåIoM‘hods
 ){

30125 
aåLockšgCÚ‹xt
 *
pCtx
;

30126 
	gpNew
->
	glockšgCÚ‹xt
 = 
pCtx
 = 
sql™e3_m®loc
( (*pCtx) );

30127 ifÐ
	gpCtx
==0 ){

30128 
rc
 = 
SQLITE_NOMEM
;

30133 
	gpCtx
->
	gdbP©h
 = 
zFž’ame
;

30134 
	gpCtx
->
	g»£rved
 = 0;

30135 
¤ªdomdev
();

30136 
unixEÁ”Mu‹x
();

30137 
	grc
 = 
fšdInodeInfo
(
pNew
, &pNew->
pInode
);

30138 ifÐ
	grc
!=
SQLITE_OK
 ){

30139 
sql™e3_ä“
(
pNew
->
lockšgCÚ‹xt
);

30140 
robu¡_þo£
(
pNew
, 
h
, 
__LINE__
);

30141 
	gh
 = -1;

30143 
unixL—veMu‹x
();

30148 ifÐ
	gpLockšgStyË
 =ð&
dÙlockIoM‘hods
 ){

30152 *
zLockFže
;

30153 
	gnFž’ame
;

30154 
as£¹
Ð
zFž’ame
!=0 );

30155 
	gnFž’ame
 = ()
¡¾’
(
zFž’ame
) + 6;

30156 
	gzLockFže
 = (*)
sql™e3_m®loc
(
nFž’ame
);

30157 ifÐ
	gzLockFže
==0 ){

30158 
rc
 = 
SQLITE_NOMEM
;

30160 
sql™e3_¢´štf
(
nFž’ame
, 
zLockFže
, "%s" 
DOTLOCK_SUFFIX
, 
zFž’ame
);

30162 
	gpNew
->
	glockšgCÚ‹xt
 = 
zLockFže
;

30165 #ià
OS_VXWORKS


30166 ifÐ
	gpLockšgStyË
 =ð&
£mIoM‘hods
 ){

30170 
unixEÁ”Mu‹x
();

30171 
	grc
 = 
fšdInodeInfo
(
pNew
, &pNew->
pInode
);

30172 ifÐ(
	grc
==
SQLITE_OK
è&& (
pNew
->
pInode
->
pSem
==
NULL
) ){

30173 *
zSemName
 = 
pNew
->
pInode
->
aSemName
;

30174 
	gn
;

30175 
sql™e3_¢´štf
(
MAX_PATHNAME
, 
zSemName
, "/%s.sem",

30176 
pNew
->
pId
->
zCªÚiÿlName
);

30177  
	gn
=1; 
	gzSemName
[
n
];‚++ )

30178 ifÐ
	gzSemName
[
n
]=='/' ) 
zSemName
[n] = '_';

30179 
	gpNew
->
	gpInode
->
	gpSem
 = 
£m_Ý’
(
zSemName
, 
O_CREAT
, 0666, 1);

30180 ifÐ
	gpNew
->
	gpInode
->
	gpSem
 =ð
SEM_FAILED
 ){

30181 
rc
 = 
SQLITE_NOMEM
;

30182 
	gpNew
->
	gpInode
->
	gaSemName
[0] = '\0';

30185 
unixL—veMu‹x
();

30189 
	gpNew
->
	gÏ¡E¼no
 = 0;

30190 #ià
OS_VXWORKS


30191 ifÐ
	grc
!=
SQLITE_OK
 ){

30192 ifÐ
h
>=0 ) 
robu¡_þo£
(
pNew
, h, 
__LINE__
);

30193 
	gh
 = -1;

30194 
osUÆšk
(
zFž’ame
);

30195 
	gpNew
->
	gù¾FÏgs
 |ð
UNIXFILE_DELETE
;

30198 ifÐ
	grc
!=
SQLITE_OK
 ){

30199 ifÐ
h
>=0 ) 
robu¡_þo£
(
pNew
, h, 
__LINE__
);

30201 
	gpNew
->
	gpM‘hod
 = 
pLockšgStyË
;

30202 
O³nCouÁ”
(+1);

30203 
v”ifyDbFže
(
pNew
);

30205  
	grc
;

30212 cÚ¡ *
unixTempFžeDœ
(){

30213 cÚ¡ *
	gazDœs
[] = {

30222 
	gi
;

30223 
¡©
 
	gbuf
;

30224 cÚ¡ *
	gzDœ
 = 0;

30226 
	gazDœs
[0] = 
sql™e3_‹mp_dœeùÜy
;

30227 ifÐ!
	gazDœs
[1] )‡zDœs[1] = 
g‘’v
("SQLITE_TMPDIR");

30228 ifÐ!
	gazDœs
[2] )‡zDœs[2] = 
g‘’v
("TMPDIR");

30229 
	gi
=0; i<(
	gazDœs
)/×zDœs[0]); 
	gzDœ
=
azDœs
[
i
++]){

30230 ifÐ
zDœ
==0 ) ;

30231 ifÐ
osSt
(
zDœ
, &
buf
) ) ;

30232 ifÐ!
S_ISDIR
(
buf
.
¡_mode
) ) ;

30233 ifÐ
osAcûss
(
zDœ
, 07) ) ;

30236  
	gzDœ
;

30244 
unixG‘Tem²ame
(
nBuf
, *
zBuf
){

30245 cÚ¡ 
	gzCh¬s
[] =

30249 
	gi
, 
	gj
;

30250 cÚ¡ *
	gzDœ
;

30256 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR
 );

30258 
	gzDœ
 = 
unixTempFžeDœ
();

30259 ifÐ
	gzDœ
==0 ) 
zDœ
 = ".";

30264 ifÐ(
¡¾’
(
zDœ
è+ sŒËn(
SQLITE_TEMP_FILE_PREFIX
è+ 18è>ð(
size_t
)
nBuf
 ){

30265  
SQLITE_ERROR
;

30269 
sql™e3_¢´štf
(
nBuf
-18, 
zBuf
, "%s/"
SQLITE_TEMP_FILE_PREFIX
, 
zDœ
);

30270 
	gj
 = ()
¡¾’
(
zBuf
);

30271 
sql™e3_¿ndomÃss
(15, &
zBuf
[
j
]);

30272 
	gi
=0; i<15; i++, 
	gj
++){

30273 
	gzBuf
[
j
] = ()
zCh¬s
[ (()
zBuf
[j])%((zChars)-1) ];

30275 
	gzBuf
[
j
] = 0;

30276 
	gzBuf
[
j
+1] = 0;

30277 } 
osAcûss
(
zBuf
,0)==0 );

30278  
	gSQLITE_OK
;

30281 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && 
defšed
(
__APPLE__
)

30287 
´oxyT¿nsfÜmUnixFže
(
unixFže
*, const *);

30306 
UnixUnu£dFd
 *
fšdReu§bËFd
(cÚ¡ *
zP©h
, 
æags
){

30307 
UnixUnu£dFd
 *
	gpUnu£d
 = 0;

30314 #ià!
OS_VXWORKS


30315 
¡©
 
	gsSt
;

30325 ifÐ0==
osSt
(
zP©h
, &
sSt
) ){

30326 
unixInodeInfo
 *
	gpInode
;

30328 
unixEÁ”Mu‹x
();

30329 
	gpInode
 = 
šodeLi¡
;

30330  
	gpInode
 && (pInode->
	gfžeId
.
	gdev
!=
sSt
.
¡_dev


30331 || 
pInode
->
fžeId
.
šo
!=
sSt
.
¡_šo
) ){

30332 
pInode
 =…Inode->
pNext
;

30334 ifÐ
	gpInode
 ){

30335 
UnixUnu£dFd
 **
	gµ
;

30336 
	gµ
=&
pInode
->
pUnu£d
; *µ && (*µ)->
	gæags
!=
æags
;…p=&((*
µ
)->
pNext
));

30337 
	gpUnu£d
 = *
µ
;

30338 ifÐ
	gpUnu£d
 ){

30339 *
	gµ
 = 
pUnu£d
->
pNext
;

30342 
unixL—veMu‹x
();

30345  
	gpUnu£d
;

30369 
fšdC»©eFžeMode
(

30370 cÚ¡ *
zP©h
,

30371 
æags
,

30372 
mode_t
 *
pMode
,

30373 
uid_t
 *
pUid
,

30374 
gid_t
 *
pGid


30376 
	grc
 = 
SQLITE_OK
;

30377 *
	gpMode
 = 0;

30378 *
	gpUid
 = 0;

30379 *
	gpGid
 = 0;

30380 ifÐ
	gæags
 & (
	gSQLITE_OPEN_WAL
|
	gSQLITE_OPEN_MAIN_JOURNAL
) ){

30381 
	gzDb
[
MAX_PATHNAME
+1];

30382 
	gnDb
;

30383 
¡©
 
	gsSt
;

30397 
	gnDb
 = 
sql™e3SŒËn30
(
zP©h
) - 1;

30398 #ifdeà
SQLITE_ENABLE_8_3_NAMES


30399  
	gnDb
>0 && 
sql™e3I§Êum
(
zP©h
[
nDb
]) )‚Db--;

30400 ifÐ
	gnDb
==0 || 
zP©h
[
nDb
]!='-' )  
SQLITE_OK
;

30402  
	gzP©h
[
nDb
]!='-' ){

30403 
as£¹
Ð
nDb
>0 );

30404 
as£¹
Ð
zP©h
[
nDb
]!='\n' );

30405 
	gnDb
--;

30408 
memýy
(
zDb
, 
zP©h
, 
nDb
);

30409 
	gzDb
[
nDb
] = '\0';

30411 ifÐ0==
osSt
(
zDb
, &
sSt
) ){

30412 *
	gpMode
 = 
sSt
.
¡_mode
 & 0777;

30413 *
	gpUid
 = 
sSt
.
¡_uid
;

30414 *
	gpGid
 = 
sSt
.
¡_gid
;

30416 
	grc
 = 
SQLITE_IOERR_FSTAT
;

30418 }ifÐ
	gæags
 & 
	gSQLITE_OPEN_DELETEONCLOSE
 ){

30419 *
	gpMode
 = 0600;

30421  
	grc
;

30446 
unixO³n
(

30447 
sql™e3_vfs
 *
pVfs
,

30448 cÚ¡ *
zP©h
,

30449 
sql™e3_fže
 *
pFže
,

30450 
æags
,

30451 *
pOutFÏgs


30453 
unixFže
 *
	gp
 = (unixFž*)
pFže
;

30454 
	gfd
 = -1;

30455 
	gÝ’FÏgs
 = 0;

30456 
	geTy³
 = 
æags
&0xFFFFFF00;

30457 
	gnoLock
;

30458 
	grc
 = 
SQLITE_OK
;

30459 
	gù¾FÏgs
 = 0;

30461 
	gisExþusive
 = (
æags
 & 
SQLITE_OPEN_EXCLUSIVE
);

30462 
	gisD–‘e
 = (
æags
 & 
SQLITE_OPEN_DELETEONCLOSE
);

30463 
	gisC»©e
 = (
æags
 & 
SQLITE_OPEN_CREATE
);

30464 
	gisR—dÚly
 = (
æags
 & 
SQLITE_OPEN_READONLY
);

30465 
	gisR—dWr™e
 = (
æags
 & 
SQLITE_OPEN_READWRITE
);

30466 #ià
SQLITE_ENABLE_LOCKING_STYLE


30467 
	gisAutoProxy
 = (
æags
 & 
SQLITE_OPEN_AUTOPROXY
);

30469 #ià
defšed
(
__APPLE__
è|| 
SQLITE_ENABLE_LOCKING_STYLE


30470 
¡©fs
 
	gfsInfo
;

30477 
	gsyncDœ
 = (
isC»©e
 && (

30478 
eTy³
==
SQLITE_OPEN_MASTER_JOURNAL


30479 || 
eTy³
==
SQLITE_OPEN_MAIN_JOURNAL


30480 || 
eTy³
==
SQLITE_OPEN_WAL


30486 
	gzTm²ame
[
MAX_PATHNAME
+2];

30487 cÚ¡ *
	gzName
 = 
zP©h
;

30496 
as£¹
((
isR—dÚly
==0 || 
isR—dWr™e
==0) && (isReadWrite || isReadonly));

30497 
as£¹
(
isC»©e
==0 || 
isR—dWr™e
);

30498 
as£¹
(
isExþusive
==0 || 
isC»©e
);

30499 
as£¹
(
isD–‘e
==0 || 
isC»©e
);

30503 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MAIN_DB
 );

30504 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MAIN_JOURNAL
 );

30505 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MASTER_JOURNAL
 );

30506 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_WAL
 );

30509 
as£¹
Ð
eTy³
==
SQLITE_OPEN_MAIN_DB
 ||ƒTy³==
SQLITE_OPEN_TEMP_DB


30510 || 
eTy³
==
SQLITE_OPEN_MAIN_JOURNAL
 ||ƒTy³==
SQLITE_OPEN_TEMP_JOURNAL


30511 || 
eTy³
==
SQLITE_OPEN_SUBJOURNAL
 ||ƒTy³==
SQLITE_OPEN_MASTER_JOURNAL


30512 || 
eTy³
==
SQLITE_OPEN_TRANSIENT_DB
 ||ƒTy³==
SQLITE_OPEN_WAL


30520 ifÐ
	g¿ndomÃssPid
!=
g‘pid
() ){

30521 
¿ndomÃssPid
 = 
g‘pid
();

30522 
sql™e3_¿ndomÃss
(0,0);

30525 
mem£t
(
p
, 0, (
unixFže
));

30527 ifÐ
	geTy³
==
SQLITE_OPEN_MAIN_DB
 ){

30528 
UnixUnu£dFd
 *
pUnu£d
;

30529 
	gpUnu£d
 = 
fšdReu§bËFd
(
zName
, 
æags
);

30530 ifÐ
	gpUnu£d
 ){

30531 
	gfd
 = 
pUnu£d
->
fd
;

30533 
	gpUnu£d
 = 
sql™e3_m®loc
((*
pUnu£d
));

30534 ifÐ!
	gpUnu£d
 ){

30535  
	gSQLITE_NOMEM
;

30538 
	gp
->
	gpUnu£d
 = 
pUnu£d
;

30543 
as£¹
Ð(
æags
 & 
SQLITE_OPEN_URI
è|| 
zName
[
¡¾’
(zName)+1]==0 );

30545 }ifÐ!
	gzName
 ){

30547 
as£¹
(
isD–‘e
 && !
syncDœ
);

30548 
	grc
 = 
unixG‘Tem²ame
(
MAX_PATHNAME
+2, 
zTm²ame
);

30549 ifÐ
	grc
!=
SQLITE_OK
 ){

30550  
rc
;

30552 
	gzName
 = 
zTm²ame
;

30556 
as£¹
Ð
zName
[
¡¾’
(zName)+1]==0 );

30563 ifÐ
	gisR—dÚly
 ) 
	gÝ’FÏgs
 |ð
O_RDONLY
;

30564 ifÐ
	gisR—dWr™e
 ) 
	gÝ’FÏgs
 |ð
O_RDWR
;

30565 ifÐ
	gisC»©e
 ) 
	gÝ’FÏgs
 |ð
O_CREAT
;

30566 ifÐ
	gisExþusive
 ) 
	gÝ’FÏgs
 |ð(
O_EXCL
|
O_NOFOLLOW
);

30567 
	gÝ’FÏgs
 |ð(
O_LARGEFILE
|
O_BINARY
);

30569 ifÐ
	gfd
<0 ){

30570 
mode_t
 
	gÝ’Mode
;

30571 
uid_t
 
	guid
;

30572 
gid_t
 
	ggid
;

30573 
	grc
 = 
fšdC»©eFžeMode
(
zName
, 
æags
, &
Ý’Mode
, &
uid
, &
gid
);

30574 ifÐ
	grc
!=
SQLITE_OK
 ){

30575 
as£¹
Ð!
p
->
pUnu£d
 );

30576 
as£¹
Ð
eTy³
==
SQLITE_OPEN_WAL
 ||ƒTy³==
SQLITE_OPEN_MAIN_JOURNAL
 );

30577  
	grc
;

30579 
	gfd
 = 
robu¡_Ý’
(
zName
, 
Ý’FÏgs
, 
Ý’Mode
);

30580 
OSTRACE
(("OPENX %-3d % 0%o\n", 
fd
, 
zName
, 
Ý’FÏgs
));

30581 ifÐ
	gfd
<0 && 
	g”ºo
!=
EISDIR
 && 
isR—dWr™e
 && !
isExþusive
 ){

30583 
æags
 &ð~(
SQLITE_OPEN_READWRITE
|
SQLITE_OPEN_CREATE
);

30584 
	gÝ’FÏgs
 &ð~(
O_RDWR
|
O_CREAT
);

30585 
	gæags
 |ð
SQLITE_OPEN_READONLY
;

30586 
	gÝ’FÏgs
 |ð
O_RDONLY
;

30587 
	gisR—dÚly
 = 1;

30588 
	gfd
 = 
robu¡_Ý’
(
zName
, 
Ý’FÏgs
, 
Ý’Mode
);

30590 ifÐ
	gfd
<0 ){

30591 
	grc
 = 
unixLogE¼Ü
(
SQLITE_CANTOPEN_BKPT
, "Ý’", 
zName
);

30592 
	gÝ’_fšished
;

30599 ifÐ
	gæags
 & (
	gSQLITE_OPEN_WAL
|
	gSQLITE_OPEN_MAIN_JOURNAL
) ){

30600 
osFchown
(
fd
, 
uid
, 
gid
);

30603 
as£¹
Ð
fd
>=0 );

30604 ifÐ
	gpOutFÏgs
 ){

30605 *
	gpOutFÏgs
 = 
æags
;

30608 ifÐ
	gp
->
	gpUnu£d
 ){

30609 
	gp
->
	gpUnu£d
->
	gfd
 = 
fd
;

30610 
	gp
->
	gpUnu£d
->
	gæags
 = 
æags
;

30613 ifÐ
	gisD–‘e
 ){

30614 #ià
OS_VXWORKS


30615 
	gzP©h
 = 
zName
;

30616 #–ià
defšed
(
SQLITE_UNLINK_AFTER_CLOSE
)

30617 
	gzP©h
 = 
sql™e3_m´štf
("%s", 
zName
);

30618 ifÐ
	gzP©h
==0 ){

30619 
robu¡_þo£
(
p
, 
fd
, 
__LINE__
);

30620  
	gSQLITE_NOMEM
;

30623 
osUÆšk
(
zName
);

30626 #ià
SQLITE_ENABLE_LOCKING_STYLE


30628 
	gp
->
	gÝ’FÏgs
 = 
Ý’FÏgs
;

30632 
	gnoLock
 = 
eTy³
!=
SQLITE_OPEN_MAIN_DB
;

30635 #ià
defšed
(
__APPLE__
è|| 
SQLITE_ENABLE_LOCKING_STYLE


30636 ifÐ
f¡©fs
(
fd
, &
fsInfo
) == -1 ){

30637 ((
unixFže
*)
pFže
)->
Ï¡E¼no
 = 
”ºo
;

30638 
robu¡_þo£
(
p
, 
fd
, 
__LINE__
);

30639  
	gSQLITE_IOERR_ACCESS
;

30641 ià(0 =ð
¡ºcmp
("msdos", 
fsInfo
.
f_f¡y³Çme
, 5)) {

30642 ((
	gunixFže
*)
	gpFže
)->
	gfsFÏgs
 |ð
SQLITE_FSFLAGS_IS_MSDOS
;

30647 ifÐ
	gisD–‘e
 ) 
	gù¾FÏgs
 |ð
UNIXFILE_DELETE
;

30648 ifÐ
	gisR—dÚly
 ) 
	gù¾FÏgs
 |ð
UNIXFILE_RDONLY
;

30649 ifÐ
	gnoLock
 ) 
	gù¾FÏgs
 |ð
UNIXFILE_NOLOCK
;

30650 ifÐ
	gsyncDœ
 ) 
	gù¾FÏgs
 |ð
UNIXFILE_DIRSYNC
;

30651 ifÐ
	gæags
 & 
	gSQLITE_OPEN_URI
 ) 
	gù¾FÏgs
 |ð
UNIXFILE_URI
;

30653 #ià
SQLITE_ENABLE_LOCKING_STYLE


30654 #ià
SQLITE_PREFER_PROXY_LOCKING


30655 
	gisAutoProxy
 = 1;

30657 ifÐ
	gisAutoProxy
 && (
	gzP©h
!=
NULL
è&& (!
noLock
è&& 
pVfs
->
xO³n
 ){

30658 *
’vfÜû
 = 
g‘’v
("SQLITE_FORCE_PROXY_LOCKING");

30659 
	gu£Proxy
 = 0;

30663 ifÐ
	g’vfÜû
!=
NULL
 ){

30664 
u£Proxy
 = 
©oi
(
’vfÜû
)>0;

30666 ifÐ
¡©fs
(
zP©h
, &
fsInfo
) == -1 ){

30674 
p
->
Ï¡E¼no
 = 
”ºo
;

30675 
robu¡_þo£
(
p
, 
fd
, 
__LINE__
);

30676 
	grc
 = 
SQLITE_IOERR_ACCESS
;

30677 
	gÝ’_fšished
;

30679 
	gu£Proxy
 = !(
fsInfo
.
f_æags
&
MNT_LOCAL
);

30681 ifÐ
	gu£Proxy
 ){

30682 
	grc
 = 
fžlInUnixFže
(
pVfs
, 
fd
, 
pFže
, 
zP©h
, 
ù¾FÏgs
);

30683 ifÐ
	grc
==
SQLITE_OK
 ){

30684 
rc
 = 
´oxyT¿nsfÜmUnixFže
((
unixFže
*)
pFže
, ":auto:");

30685 ifÐ
	grc
!=
SQLITE_OK
 ){

30690 
unixClo£
(
pFže
);

30691  
	grc
;

30694 
	gÝ’_fšished
;

30699 
	grc
 = 
fžlInUnixFže
(
pVfs
, 
fd
, 
pFže
, 
zP©h
, 
ù¾FÏgs
);

30701 
	gÝ’_fšished
:

30702 ifÐ
rc
!=
SQLITE_OK
 ){

30703 
sql™e3_ä“
(
p
->
pUnu£d
);

30705  
	grc
;

30713 
unixD–‘e
(

30714 
sql™e3_vfs
 *
NÙU£d
,

30715 cÚ¡ *
zP©h
,

30716 
dœSync


30718 
	grc
 = 
SQLITE_OK
;

30719 
UNUSED_PARAMETER
(
NÙU£d
);

30720 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_DELETE
);

30721 ifÐ
osUÆšk
(
zP©h
)==(-1) ){

30722 ifÐ
”ºo
==
ENOENT


30723 #ià
OS_VXWORKS


30724 || 
osAcûss
(
zP©h
,0)!=0

30727 
rc
 = 
SQLITE_IOERR_DELETE_NOENT
;

30729 
	grc
 = 
unixLogE¼Ü
(
SQLITE_IOERR_DELETE
, "uÆšk", 
zP©h
);

30731  
	grc
;

30733 #iâdeà
SQLITE_DISABLE_DIRSYNC


30734 ifÐ(
	gdœSync
 & 1)!=0 ){

30735 
fd
;

30736 
	grc
 = 
osO³nDœeùÜy
(
zP©h
, &
fd
);

30737 ifÐ
	grc
==
SQLITE_OK
 ){

30738 #ià
OS_VXWORKS


30739 ifÐ
fsync
(
fd
)==-1 )

30741 ifÐ
fsync
(
fd
) )

30744 
rc
 = 
unixLogE¼Ü
(
SQLITE_IOERR_DIR_FSYNC
, "fsync", 
zP©h
);

30746 
robu¡_þo£
(0, 
fd
, 
__LINE__
);

30747 }ifÐ
	grc
==
SQLITE_CANTOPEN
 ){

30748 
rc
 = 
SQLITE_OK
;

30752  
	grc
;

30765 
unixAcûss
(

30766 
sql™e3_vfs
 *
NÙU£d
,

30767 cÚ¡ *
zP©h
,

30768 
æags
,

30769 *
pResOut


30771 
	gamode
 = 0;

30772 
UNUSED_PARAMETER
(
NÙU£d
);

30773 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_ACCESS
; );

30774  
	gæags
 ){

30775 
	gSQLITE_ACCESS_EXISTS
:

30776 
amode
 = 
F_OK
;

30778 
	gSQLITE_ACCESS_READWRITE
:

30779 
amode
 = 
W_OK
|
R_OK
;

30781 
	gSQLITE_ACCESS_READ
:

30782 
amode
 = 
R_OK
;

30786 
as£¹
(!"Invalid flags‡rgument");

30788 *
	gpResOut
 = (
osAcûss
(
zP©h
, 
amode
)==0);

30789 ifÐ
	gæags
==
SQLITE_ACCESS_EXISTS
 && *
pResOut
 ){

30790 
¡©
 
buf
;

30791 ifÐ0==
osSt
(
zP©h
, &
buf
è&& 
	gbuf
.
	g¡_size
==0 ){

30792 *
pResOut
 = 0;

30795  
	gSQLITE_OK
;

30808 
unixFuÎP©hÇme
(

30809 
sql™e3_vfs
 *
pVfs
,

30810 cÚ¡ *
zP©h
,

30811 
nOut
,

30812 *
zOut


30820 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_ERROR
 );

30822 
as£¹
Ð
pVfs
->
mxP©hÇme
==
MAX_PATHNAME
 );

30823 
UNUSED_PARAMETER
(
pVfs
);

30825 
	gzOut
[
nOut
-1] = '\0';

30826 ifÐ
	gzP©h
[0]=='/' ){

30827 
sql™e3_¢´štf
(
nOut
, 
zOut
, "%s", 
zP©h
);

30829 
	gnCwd
;

30830 ifÐ
osG‘cwd
(
zOut
, 
nOut
-1)==0 ){

30831  
unixLogE¼Ü
(
SQLITE_CANTOPEN_BKPT
, "g‘cwd", 
zP©h
);

30833 
	gnCwd
 = ()
¡¾’
(
zOut
);

30834 
sql™e3_¢´štf
(
nOut
-
nCwd
, &
zOut
[nCwd], "/%s", 
zP©h
);

30836  
	gSQLITE_OK
;

30840 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


30845 
	~<dlfú.h
>

30846 *
unixDlO³n
(
sql™e3_vfs
 *
NÙU£d
, cÚ¡ *
zFž’ame
){

30847 
UNUSED_PARAMETER
(
NÙU£d
);

30848  
dlÝ’
(
zFž’ame
, 
RTLD_NOW
 | 
RTLD_GLOBAL
);

30858 
unixDlE¼Ü
(
sql™e3_vfs
 *
NÙU£d
, 
nBuf
, *
zBufOut
){

30859 cÚ¡ *
	gzE¼
;

30860 
UNUSED_PARAMETER
(
NÙU£d
);

30861 
unixEÁ”Mu‹x
();

30862 
	gzE¼
 = 
dË¼Ü
();

30863 ifÐ
	gzE¼
 ){

30864 
sql™e3_¢´štf
(
nBuf
, 
zBufOut
, "%s", 
zE¼
);

30866 
unixL—veMu‹x
();

30868 (*
unixDlSym
(
sql™e3_vfs
 *
NÙU£d
, *
p
, cÚ¡ *
zSym
))(){

30886 (*(*
	gx
)(*,const *))();

30887 
UNUSED_PARAMETER
(
NÙU£d
);

30888 
	gx
 = ((*(*)(*,cÚ¡ *))())
	gdlsym
;

30889  (*
	gx
)(
	gp
, 
	gzSym
);

30891 
unixDlClo£
(
sql™e3_vfs
 *
NÙU£d
, *
pHªdË
){

30892 
UNUSED_PARAMETER
(
NÙU£d
);

30893 
dlþo£
(
pHªdË
);

30896 
	#unixDlO³n
 0

	)

30897 
	#unixDlE¼Ü
 0

	)

30898 
	#unixDlSym
 0

	)

30899 
	#unixDlClo£
 0

	)

30905 
unixRªdomÃss
(
sql™e3_vfs
 *
NÙU£d
, 
nBuf
, *
zBuf
){

30906 
UNUSED_PARAMETER
(
NÙU£d
);

30907 
as£¹
((
size_t
)
nBuf
>=((
time_t
)+()));

30921 
mem£t
(
zBuf
, 0, 
nBuf
);

30922 
	g¿ndomÃssPid
 = 
g‘pid
();

30923 #ià!
defšed
(
SQLITE_TEST
)

30925 
	gfd
, 
	ggÙ
;

30926 
	gfd
 = 
robu¡_Ý’
("/dev/u¿ndom", 
O_RDONLY
, 0);

30927 ifÐ
	gfd
<0 ){

30928 
time_t
 
	gt
;

30929 
time
(&
t
);

30930 
memýy
(
zBuf
, &
t
, (t));

30931 
memýy
(&
zBuf
[(
t
)], &
¿ndomÃssPid
, (randomnessPid));

30932 
as£¹
Ð(
t
)+(
¿ndomÃssPid
)<=(
size_t
)
nBuf
 );

30933 
	gnBuf
 = (
t
è+ (
¿ndomÃssPid
);

30935 do{ 
	ggÙ
 = 
osR—d
(
fd
, 
zBuf
, 
nBuf
); } gÙ<0 && 
	g”ºo
==
EINTR
 );

30936 
robu¡_þo£
(0, 
fd
, 
__LINE__
);

30940  
	gnBuf
;

30952 
unixSË•
(
sql™e3_vfs
 *
NÙU£d
, 
miüo£cÚds
){

30953 #ià
OS_VXWORKS


30954 
time¥ec
 
	g¥
;

30956 
	g¥
.
	gtv_£c
 = 
miüo£cÚds
 / 1000000;

30957 
	g¥
.
	gtv_n£c
 = (
miüo£cÚds
 % 1000000) * 1000;

30958 
Çno¦“p
(&
¥
, 
NULL
);

30959 
UNUSED_PARAMETER
(
NÙU£d
);

30960  
	gmiüo£cÚds
;

30961 #–ià
defšed
(
HAVE_USLEEP
) && HAVE_USLEEP

30962 
u¦“p
(
miüo£cÚds
);

30963 
UNUSED_PARAMETER
(
NÙU£d
);

30964  
	gmiüo£cÚds
;

30966 
	g£cÚds
 = (
miüo£cÚds
+999999)/1000000;

30967 
¦“p
(
£cÚds
);

30968 
UNUSED_PARAMETER
(
NÙU£d
);

30969  
	g£cÚds
*1000000;

30978 #ifdeà
SQLITE_TEST


30979 
SQLITE_API
 
	gsql™e3_cu¼’t_time
 = 0;

30992 
unixCu¼’tTimeIÁ64
(
sql™e3_vfs
 *
NÙU£d
, 
sql™e3_št64
 *
piNow
){

30993 cÚ¡ 
sql™e3_št64
 
	gunixEpoch
 = 24405875*(sqlite3_int64)8640000;

30994 
	grc
 = 
SQLITE_OK
;

30995 #ià
defšed
(
NO_GETTOD
)

30996 
time_t
 
	gt
;

30997 
time
(&
t
);

30998 *
	gpiNow
 = ((
sql™e3_št64
)
t
)*1000 + 
unixEpoch
;

30999 #–ià
OS_VXWORKS


31000 
time¥ec
 
	gsNow
;

31001 
þock_g‘time
(
CLOCK_REALTIME
, &
sNow
);

31002 *
	gpiNow
 = 
unixEpoch
 + 1000*(
sql™e3_št64
)
sNow
.
tv_£c
 + sNow.
tv_n£c
/1000000;

31004 
timev®
 
	gsNow
;

31005 ifÐ
g‘timeofday
(&
sNow
, 0)==0 ){

31006 *
piNow
 = 
unixEpoch
 + 1000*(
sql™e3_št64
)
sNow
.
tv_£c
 + sNow.
tv_u£c
/1000;

31008 
	grc
 = 
SQLITE_ERROR
;

31012 #ifdeà
SQLITE_TEST


31013 ifÐ
	gsql™e3_cu¼’t_time
 ){

31014 *
	gpiNow
 = 1000*(
sql™e3_št64
)
sql™e3_cu¼’t_time
 + 
unixEpoch
;

31017 
UNUSED_PARAMETER
(
NÙU£d
);

31018  
	grc
;

31026 
unixCu¼’tTime
(
sql™e3_vfs
 *
NÙU£d
, *
´Now
){

31027 
sql™e3_št64
 
	gi
 = 0;

31028 
	grc
;

31029 
UNUSED_PARAMETER
(
NÙU£d
);

31030 
	grc
 = 
unixCu¼’tTimeIÁ64
(0, &
i
);

31031 *
	g´Now
 = 
i
/86400000.0;

31032  
	grc
;

31042 
unixG‘La¡E¼Ü
(
sql™e3_vfs
 *
NÙU£d
, 
NÙU£d2
, *
NÙU£d3
){

31043 
UNUSED_PARAMETER
(
NÙU£d
);

31044 
UNUSED_PARAMETER
(
NÙU£d2
);

31045 
UNUSED_PARAMETER
(
NÙU£d3
);

31206 #ià
defšed
(
__APPLE__
è&& 
SQLITE_ENABLE_LOCKING_STYLE


31212 
´oxyLockšgCÚ‹xt
 
	t´oxyLockšgCÚ‹xt
;

31213 
	s´oxyLockšgCÚ‹xt
 {

31214 
unixFže
 *
	gcÚchFže
;

31215 *
	gcÚchFžeP©h
;

31216 
unixFže
 *
	glockProxy
;

31217 *
	glockProxyP©h
;

31218 *
	gdbP©h
;

31219 
	gcÚchH–d
;

31220 *
	gÞdLockšgCÚ‹xt
;

31221 
sql™e3_io_m‘hods
 cÚ¡ *
	gpOldM‘hod
;

31229 
´oxyG‘LockP©h
(cÚ¡ *
dbP©h
, *
lP©h
, 
size_t
 
maxL’
){

31230 
	gËn
;

31231 
	gdbL’
;

31232 
	gi
;

31234 #ifdeà
LOCKPROXYDIR


31235 
	gËn
 = 
¡¾ýy
(
lP©h
, 
LOCKPROXYDIR
, 
maxL’
);

31237 #ifdeà
_CS_DARWIN_USER_TEMP_DIR


31239 ifÐ!
cÚf¡r
(
_CS_DARWIN_USER_TEMP_DIR
, 
lP©h
, 
maxL’
) ){

31240 
OSTRACE
(("GETLOCKPATH failed %sƒrrno=%d…id=%d\n",

31241 
lP©h
, 
”ºo
, 
g‘pid
()));

31242  
	gSQLITE_IOERR_LOCK
;

31244 
	gËn
 = 
¡¾ÿt
(
lP©h
, "sql™•locks", 
maxL’
);

31247 
	gËn
 = 
¡¾ýy
(
lP©h
, "/tmp/", 
maxL’
);

31251 ifÐ
	glP©h
[
Ën
-1]!='/' ){

31252 
Ën
 = 
¡¾ÿt
(
lP©h
, "/", 
maxL’
);

31256 
	gdbL’
 = ()
¡¾’
(
dbP©h
);

31257  
	gi
=0; i<
	gdbL’
 && (i+
	gËn
+7)<()
	gmaxL’
; i++){

31258 
	gc
 = 
dbP©h
[
i
];

31259 
	glP©h
[
i
+
Ën
] = (
c
=='/')?'_':c;

31261 
	glP©h
[
i
+
Ën
]='\0';

31262 
¡¾ÿt
(
lP©h
, ":auto:", 
maxL’
);

31263 
OSTRACE
(("GETLOCKPATH…roxy†ock…©h=% pid=%d\n", 
lP©h
, 
g‘pid
()));

31264  
	gSQLITE_OK
;

31270 
´oxyC»©eLockP©h
(cÚ¡ *
lockP©h
){

31271 
	gi
, 
	gËn
;

31272 
	gbuf
[
MAXPATHLEN
];

31273 
	g¡¬t
 = 0;

31275 
as£¹
(
lockP©h
!=
NULL
);

31277 
	gËn
 = ()
¡¾’
(
lockP©h
);

31278 
	gbuf
[0] = 
lockP©h
[0];

31279  
	gi
=1; i<
	gËn
; i++ ){

31280 ifÐ
	glockP©h
[
i
] =ð'/' && (˜- 
¡¬t
 > 0) ){

31282 ifÐ
i
-
¡¬t
>2 || (i-¡¬t==1 && 
buf
[start] != '.' && buf[start] != '/')

31283 || (
i
-
¡¬t
==2 && 
buf
[start] != '.' && buf[start+1] != '.') ){

31284 
buf
[
i
]='\0';

31285 ifÐ
osMkdœ
(
buf
, 
SQLITE_DEFAULT_PROXYDIR_PERMISSIONS
) ){

31286 
	g”r
=
”ºo
;

31287 ifÐ
	g”r
!=
EEXIST
 ) {

31288 
OSTRACE
(("CREATELOCKPATH FAILED creating %s, "

31290 
buf
, 
¡»¼Ü
(
”r
), 
lockP©h
, 
g‘pid
()));

31291  
	g”r
;

31295 
	g¡¬t
=
i
+1;

31297 
	gbuf
[
i
] = 
lockP©h
[i];

31299 
OSTRACE
(("CREATELOCKPATH…roxy†ock…©h=% pid=%d\n", 
lockP©h
, 
g‘pid
()));

31310 
´oxyC»©eUnixFže
(

31311 cÚ¡ *
·th
,

31312 
unixFže
 **
µFže
,

31313 
i¦ockfže


31315 
	gfd
 = -1;

31316 
unixFže
 *
	gpNew
;

31317 
	grc
 = 
SQLITE_OK
;

31318 
	gÝ’FÏgs
 = 
O_RDWR
 | 
O_CREAT
;

31319 
sql™e3_vfs
 
	gdummyVfs
;

31320 
	g‹¼no
 = 0;

31321 
UnixUnu£dFd
 *
	gpUnu£d
 = 
NULL
;

31329 
	gpUnu£d
 = 
fšdReu§bËFd
(
·th
, 
Ý’FÏgs
);

31330 ifÐ
	gpUnu£d
 ){

31331 
	gfd
 = 
pUnu£d
->
fd
;

31333 
	gpUnu£d
 = 
sql™e3_m®loc
((*
pUnu£d
));

31334 ifÐ!
	gpUnu£d
 ){

31335  
	gSQLITE_NOMEM
;

31338 ifÐ
	gfd
<0 ){

31339 
	gfd
 = 
robu¡_Ý’
(
·th
, 
Ý’FÏgs
, 0);

31340 
	g‹¼no
 = 
”ºo
;

31341 ifÐ
	gfd
<0 && 
	g”ºo
==
ENOENT
 && 
i¦ockfže
 ){

31342 ifÐ
´oxyC»©eLockP©h
(
·th
è=ð
SQLITE_OK
 ){

31343 
fd
 = 
robu¡_Ý’
(
·th
, 
Ý’FÏgs
, 0);

31347 ifÐ
	gfd
<0 ){

31348 
	gÝ’FÏgs
 = 
O_RDONLY
;

31349 
	gfd
 = 
robu¡_Ý’
(
·th
, 
Ý’FÏgs
, 0);

31350 
	g‹¼no
 = 
”ºo
;

31352 ifÐ
	gfd
<0 ){

31353 ifÐ
	gi¦ockfže
 ){

31354  
	gSQLITE_BUSY
;

31356 
	g‹¼no
) {

31357 
	gEACCES
:

31358  
SQLITE_PERM
;

31359 
	gEIO
:

31360  
SQLITE_IOERR_LOCK
;

31362  
SQLITE_CANTOPEN_BKPT
;

31366 
	gpNew
 = (
unixFže
 *)
sql™e3_m®loc
((*
pNew
));

31367 ifÐ
	gpNew
==
NULL
 ){

31368 
rc
 = 
SQLITE_NOMEM
;

31369 
	g’d_ü—‹_´oxy
;

31371 
mem£t
(
pNew
, 0, (
unixFže
));

31372 
	gpNew
->
	gÝ’FÏgs
 = 
Ý’FÏgs
;

31373 
mem£t
(&
dummyVfs
, 0, (dummyVfs));

31374 
	gdummyVfs
.
	gpAµD©a
 = (*)&
autÞockIoFšd”
;

31375 
	gdummyVfs
.
	gzName
 = "dummy";

31376 
	gpUnu£d
->
	gfd
 = 
fd
;

31377 
	gpUnu£d
->
	gæags
 = 
Ý’FÏgs
;

31378 
	gpNew
->
	gpUnu£d
 = 
pUnu£d
;

31380 
	grc
 = 
fžlInUnixFže
(&
dummyVfs
, 
fd
, (
sql™e3_fže
*)
pNew
, 
·th
, 0);

31381 ifÐ
	grc
==
SQLITE_OK
 ){

31382 *
µFže
 = 
pNew
;

31383  
	gSQLITE_OK
;

31385 
	g’d_ü—‹_´oxy
:

31386 
robu¡_þo£
(
pNew
, 
fd
, 
__LINE__
);

31387 
sql™e3_ä“
(
pNew
);

31388 
sql™e3_ä“
(
pUnu£d
);

31389  
	grc
;

31392 #ifdeà
SQLITE_TEST


31394 
SQLITE_API
 
	gsql™e3_ho¡id_num
 = 0;

31397 
	#PROXY_HOSTIDLEN
 16

	)

31400 
g‘ho¡uuid
(
uuid_t
 
id
, cÚ¡ 
time¥ec
 *
wa™
);

31405 
´oxyG‘Ho¡ID
(*
pHo¡ID
, *
pE¼Ü
){

31406 
as£¹
(
PROXY_HOSTIDLEN
 =ð(
uuid_t
));

31407 
mem£t
(
pHo¡ID
, 0, 
PROXY_HOSTIDLEN
);

31408 #ià
defšed
(
__MAX_OS_X_VERSION_MIN_REQUIRED
)\

31409 && 
	g__MAC_OS_X_VERSION_MIN_REQUIRED
<1050

31411 cÚ¡ 
time¥ec
 
	gtimeout
 = {1, 0};

31412 ifÐ
g‘ho¡uuid
(
pHo¡ID
, &
timeout
) ){

31413 
	g”r
 = 
”ºo
;

31414 ifÐ
	gpE¼Ü
 ){

31415 *
	gpE¼Ü
 = 
”r
;

31417  
	gSQLITE_IOERR
;

31421 
UNUSED_PARAMETER
(
pE¼Ü
);

31423 #ifdeà
SQLITE_TEST


31425 ifÐ
	gsql™e3_ho¡id_num
 != 0){

31426 
pHo¡ID
[0] = ()ÕHo¡ID[0] + ()(
sql™e3_ho¡id_num
 & 0xFF));

31430  
	gSQLITE_OK
;

31435 
	#PROXY_CONCHVERSION
 2

	)

31436 
	#PROXY_HEADERLEN
 1

	)

31437 
	#PROXY_PATHINDEX
 (
PROXY_HEADERLEN
+
PROXY_HOSTIDLEN
)

	)

31438 
	#PROXY_MAXCONCHLEN
 (
PROXY_HEADERLEN
+
PROXY_HOSTIDLEN
+
MAXPATHLEN
)

	)

31446 
´oxyB»akCÚchLock
(
unixFže
 *
pFže
, 
uuid_t
 
myHo¡ID
){

31447 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

31448 
unixFže
 *
	gcÚchFže
 = 
pCtx
->
cÚchFže
;

31449 
	gtP©h
[
MAXPATHLEN
];

31450 
	gbuf
[
PROXY_MAXCONCHLEN
];

31451 *
	gcP©h
 = 
pCtx
->
cÚchFžeP©h
;

31452 
size_t
 
	g»adL’
 = 0;

31453 
size_t
 
	g·thL’
 = 0;

31454 
	g”rmsg
[64] = "";

31455 
	gfd
 = -1;

31456 
	grc
 = -1;

31457 
UNUSED_PARAMETER
(
myHo¡ID
);

31460 
	g·thL’
 = 
¡¾ýy
(
tP©h
, 
cP©h
, 
MAXPATHLEN
);

31461 ifÐ
	g·thL’
>
	gMAXPATHLEN
 ||…athLen<6 ||

31462 (
¡¾ýy
(&
tP©h
[
·thL’
-5], "break", 6) != 5) ){

31463 
sql™e3_¢´štf
((
”rmsg
),”rmsg,"·thƒ¼Ü (ËÀ%d)",()
·thL’
);

31464 
	g’d_b»aklock
;

31467 
	g»adL’
 = 
osP»ad
(
cÚchFže
->
h
, 
buf
, 
PROXY_MAXCONCHLEN
, 0);

31468 ifÐ
	g»adL’
<
	gPROXY_PATHINDEX
 ){

31469 
sql™e3_¢´štf
((
”rmsg
),”rmsg,"»adƒ¼Ü (ËÀ%d)",()
»adL’
);

31470 
	g’d_b»aklock
;

31473 
	gfd
 = 
robu¡_Ý’
(
tP©h
, (
O_RDWR
|
O_CREAT
|
O_EXCL
), 0);

31474 ifÐ
	gfd
<0 ){

31475 
sql™e3_¢´štf
((
”rmsg
),ƒ¼msg, "ü—‹ fažed (%d)", 
”ºo
);

31476 
	g’d_b»aklock
;

31478 ifÐ
osPwr™e
(
fd
, 
buf
, 
»adL’
, 0è!ð(
ssize_t
)readLen ){

31479 
sql™e3_¢´štf
((
”rmsg
),ƒ¼msg, "wr™çžed (%d)", 
”ºo
);

31480 
	g’d_b»aklock
;

31482 ifÐ
»Çme
(
tP©h
, 
cP©h
) ){

31483 
sql™e3_¢´štf
((
”rmsg
),ƒ¼msg, "»Çmçžed (%d)", 
”ºo
);

31484 
	g’d_b»aklock
;

31486 
	grc
 = 0;

31487 
årštf
(
¡d”r
, "brok¡®lock oÀ%s\n", 
cP©h
);

31488 
robu¡_þo£
(
pFže
, 
cÚchFže
->
h
, 
__LINE__
);

31489 
	gcÚchFže
->
	gh
 = 
fd
;

31490 
	gcÚchFže
->
	gÝ’FÏgs
 = 
O_RDWR
 | 
O_CREAT
;

31492 
	g’d_b»aklock
:

31493 ifÐ
rc
 ){

31494 ifÐ
fd
>=0 ){

31495 
osUÆšk
(
tP©h
);

31496 
robu¡_þo£
(
pFže
, 
fd
, 
__LINE__
);

31498 
årštf
(
¡d”r
, "çžedØb»ak sË†ock oÀ%s, %s\n", 
cP©h
, 
”rmsg
);

31500  
	grc
;

31506 
´oxyCÚchLock
(
unixFže
 *
pFže
, 
uuid_t
 
myHo¡ID
, 
lockTy³
){

31507 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

31508 
unixFže
 *
	gcÚchFže
 = 
pCtx
->
cÚchFže
;

31509 
	grc
 = 
SQLITE_OK
;

31510 
	gnTr›s
 = 0;

31511 
time¥ec
 
	gcÚchModTime
;

31513 
mem£t
(&
cÚchModTime
, 0, (conchModTime));

31515 
	grc
 = 
cÚchFže
->
pM‘hod
->
xLock
((
sql™e3_fže
*)cÚchFže, 
lockTy³
);

31516 
	gnTr›s
 ++;

31517 ifÐ
	grc
==
SQLITE_BUSY
 ){

31524 
¡©
 
buf
;

31525 ifÐ
osF¡©
(
cÚchFže
->
h
, &
buf
) ){

31526 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

31527  
	gSQLITE_IOERR_LOCK
;

31530 ifÐ
	gnTr›s
==1 ){

31531 
cÚchModTime
 = 
buf
.
¡_mtime¥ec
;

31532 
u¦“p
(500000);

31536 
as£¹
Ð
nTr›s
>1 );

31537 ifÐ
	gcÚchModTime
.
	gtv_£c
 !ð
buf
.
¡_mtime¥ec
.
tv_£c
 ||

31538 
cÚchModTime
.
tv_n£c
 !ð
buf
.
¡_mtime¥ec
.tv_nsec ){

31539  
SQLITE_BUSY
;

31542 ifÐ
	gnTr›s
==2 ){

31543 
tBuf
[
PROXY_MAXCONCHLEN
];

31544 
	gËn
 = 
osP»ad
(
cÚchFže
->
h
, 
tBuf
, 
PROXY_MAXCONCHLEN
, 0);

31545 ifÐ
	gËn
<0 ){

31546 
	gpFže
->
	gÏ¡E¼no
 = 
”ºo
;

31547  
	gSQLITE_IOERR_LOCK
;

31549 ifÐ
	gËn
>
	gPROXY_PATHINDEX
 && 
	gtBuf
[0]==()
PROXY_CONCHVERSION
){

31551 ifÐ0!=
memcmp
(&
tBuf
[
PROXY_HEADERLEN
], 
myHo¡ID
, 
PROXY_HOSTIDLEN
) ){

31552  
	gSQLITE_BUSY
;

31556  
	gSQLITE_BUSY
;

31558 
u¦“p
(10000000);

31562 
as£¹
Ð
nTr›s
==3 );

31563 ifÐ0==
´oxyB»akCÚchLock
(
pFže
, 
myHo¡ID
) ){

31564 
	grc
 = 
SQLITE_OK
;

31565 ifÐ
	glockTy³
==
EXCLUSIVE_LOCK
 ){

31566 
rc
 = 
cÚchFže
->
pM‘hod
->
xLock
((
sql™e3_fže
*)cÚchFže, 
SHARED_LOCK
);

31568 ifÐ!
	grc
 ){

31569 
	grc
 = 
cÚchFže
->
pM‘hod
->
xLock
((
sql™e3_fže
*)cÚchFže, 
lockTy³
);

31573 }  
	grc
==
SQLITE_BUSY
 && 
nTr›s
<3 );

31575  
	grc
;

31584 
´oxyTakeCÚch
(
unixFže
 *
pFže
){

31585 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

31587 ifÐ
	gpCtx
->
	gcÚchH–d
!=0 ){

31588  
SQLITE_OK
;

31590 
unixFže
 *
	gcÚchFže
 = 
pCtx
->
cÚchFže
;

31591 
uuid_t
 
	gmyHo¡ID
;

31592 
	gpE¼Ü
 = 0;

31593 
	g»adBuf
[
PROXY_MAXCONCHLEN
];

31594 
	glockP©h
[
MAXPATHLEN
];

31595 *
	g‹mpLockP©h
 = 
NULL
;

31596 
	grc
 = 
SQLITE_OK
;

31597 
	gü—‹CÚch
 = 0;

31598 
	gho¡IdM©ch
 = 0;

31599 
	g»adL’
 = 0;

31600 
	gŒyOldLockP©h
 = 0;

31601 
	gfÜûNewLockP©h
 = 0;

31603 
OSTRACE
(("TAKECONCH %d fÜ % pid=%d\n", 
cÚchFže
->
h
,

31604 (
pCtx
->
lockProxyP©h
 ?…Ctx->lockProxyP©h : ":auto:"), 
g‘pid
()));

31606 
	grc
 = 
´oxyG‘Ho¡ID
(
myHo¡ID
, &
pE¼Ü
);

31607 ifÐ(
	grc
&0xff)==
SQLITE_IOERR
 ){

31608 
pFže
->
Ï¡E¼no
 = 
pE¼Ü
;

31609 
	g’d_kecÚch
;

31611 
	grc
 = 
´oxyCÚchLock
(
pFže
, 
myHo¡ID
, 
SHARED_LOCK
);

31612 ifÐ
	grc
!=
SQLITE_OK
 ){

31613 
’d_kecÚch
;

31616 
	g»adL’
 = 
£ekAndR—d
((
unixFže
*)
cÚchFže
, 0, 
»adBuf
, 
PROXY_MAXCONCHLEN
);

31617 ifÐ
	g»adL’
<0 ){

31619 
	gpFže
->
	gÏ¡E¼no
 = 
cÚchFže
->
Ï¡E¼no
;

31620 
	grc
 = 
SQLITE_IOERR_READ
;

31621 
	g’d_kecÚch
;

31622 }ifÐ
	g»adL’
<=(
PROXY_HEADERLEN
+
PROXY_HOSTIDLEN
) ||

31623 
»adBuf
[0]!=()
PROXY_CONCHVERSION
 ){

31627 
ü—‹CÚch
 = 1;

31635 ifÐ!
	gü—‹CÚch
 && !
	gfÜûNewLockP©h
 ){

31636 
	gho¡IdM©ch
 = !
memcmp
(&
»adBuf
[
PROXY_HEADERLEN
], 
myHo¡ID
,

31637 
PROXY_HOSTIDLEN
);

31639 ifÐ!
	gpCtx
->
	glockProxyP©h
 ){

31643 ifÐ
	gho¡IdM©ch
 ){

31644 
size_t
 
	g·thL’
 = (
»adL’
 - 
PROXY_PATHINDEX
);

31646 ifÐ
	g·thL’
>=
MAXPATHLEN
 ){

31647 
·thL’
=
MAXPATHLEN
-1;

31649 
memýy
(
lockP©h
, &
»adBuf
[
PROXY_PATHINDEX
], 
·thL’
);

31650 
	glockP©h
[
·thL’
] = 0;

31651 
	g‹mpLockP©h
 = 
lockP©h
;

31652 
	gŒyOldLockP©h
 = 1;

31654 
	g’d_kecÚch
;

31656 }ifÐ
	gho¡IdM©ch


31657 && !
¡ºcmp
(
pCtx
->
lockProxyP©h
, &
»adBuf
[
PROXY_PATHINDEX
],

31658 
»adL’
-
PROXY_PATHINDEX
)

31661 
	g’d_kecÚch
;

31666 ifÐ(
	gcÚchFže
->
	gÝ’FÏgs
&
	gO_RDWR
) == 0 ){

31667 
rc
 = 
SQLITE_BUSY
;

31668 
	g’d_kecÚch
;

31672 ifÐ!
	gpCtx
->
	glockProxyP©h
 ){

31673 
´oxyG‘LockP©h
(
pCtx
->
dbP©h
, 
lockP©h
, 
MAXPATHLEN
);

31674 
	g‹mpLockP©h
 = 
lockP©h
;

31682 
futimes
(
cÚchFže
->
h
, 
NULL
);

31683 ifÐ
	gho¡IdM©ch
 && !
	gü—‹CÚch
 ){

31684 ifÐ
	gcÚchFže
->
	gpInode
 && cÚchFže->pInode->
	gnSh¬ed
>1 ){

31687 
	grc
 = 
SQLITE_BUSY
;

31689 
	grc
 = 
´oxyCÚchLock
(
pFže
, 
myHo¡ID
, 
EXCLUSIVE_LOCK
);

31692 
	grc
 = 
cÚchFže
->
pM‘hod
->
xLock
((
sql™e3_fže
*)cÚchFže, 
EXCLUSIVE_LOCK
);

31694 ifÐ
	grc
==
SQLITE_OK
 ){

31695 
wr™eBufãr
[
PROXY_MAXCONCHLEN
];

31696 
	gwr™eSize
 = 0;

31698 
	gwr™eBufãr
[0] = ()
PROXY_CONCHVERSION
;

31699 
memýy
(&
wr™eBufãr
[
PROXY_HEADERLEN
], 
myHo¡ID
, 
PROXY_HOSTIDLEN
);

31700 ifÐ
	gpCtx
->
	glockProxyP©h
!=
NULL
 ){

31701 
¡¾ýy
(&
wr™eBufãr
[
PROXY_PATHINDEX
], 
pCtx
->
lockProxyP©h
, 
MAXPATHLEN
);

31703 
¡¾ýy
(&
wr™eBufãr
[
PROXY_PATHINDEX
], 
‹mpLockP©h
, 
MAXPATHLEN
);

31705 
	gwr™eSize
 = 
PROXY_PATHINDEX
 + 
¡¾’
(&
wr™eBufãr
[PROXY_PATHINDEX]);

31706 
robu¡_árunÿ‹
(
cÚchFže
->
h
, 
wr™eSize
);

31707 
	grc
 = 
unixWr™e
((
sql™e3_fže
 *)
cÚchFže
, 
wr™eBufãr
, 
wr™eSize
, 0);

31708 
fsync
(
cÚchFže
->
h
);

31712 ifÐ
	grc
==
SQLITE_OK
 && 
ü—‹CÚch
 ){

31713 
¡©
 
buf
;

31714 
	g”r
 = 
osF¡©
(
pFže
->
h
, &
buf
);

31715 ifÐ
	g”r
==0 ){

31716 
mode_t
 
cmode
 = 
buf
.
¡_mode
&(
S_IRUSR
|
S_IWUSR
 | 
S_IRGRP
|
S_IWGRP
 |

31717 
S_IROTH
|
S_IWOTH
);

31719 #iâdeà
SQLITE_PROXY_DEBUG


31720 
osFchmod
(
cÚchFže
->
h
, 
cmode
);

31723 
	grc
 = 
osFchmod
(
cÚchFže
->
h
, 
cmode
);

31724 } 
	grc
==(-1è&& 
”ºo
==
EINTR
 );

31725 ifÐ
	grc
!=0 ){

31726 
code
 = 
”ºo
;

31727 
årštf
(
¡d”r
, "fchmod %o FAILED with %d %s\n",

31728 
cmode
, 
code
, 
¡»¼Ü
(code));

31730 
årštf
(
¡d”r
, "fchmod %ØSUCCEDED\n",
cmode
);

31733 
	gcode
 = 
”ºo
;

31734 
årštf
(
¡d”r
, "STAT FAILED[%d] with %d %s\n",

31735 
”r
, 
code
, 
¡»¼Ü
(code));

31740 
	gcÚchFže
->
	gpM‘hod
->
xUÆock
((
sql™e3_fže
*)
cÚchFže
, 
SHARED_LOCK
);

31742 
	g’d_kecÚch
:

31743 
OSTRACE
(("TRANSPROXY: CLOSE %d\n", 
pFže
->
h
));

31744 ifÐ
	grc
==
SQLITE_OK
 && 
pFže
->
Ý’FÏgs
 ){

31745 
fd
;

31746 ifÐ
	gpFže
->
	gh
>=0 ){

31747 
robu¡_þo£
(
pFže
,…Fže->
h
, 
__LINE__
);

31749 
	gpFže
->
	gh
 = -1;

31750 
	gfd
 = 
robu¡_Ý’
(
pCtx
->
dbP©h
, 
pFže
->
Ý’FÏgs
, 0);

31751 
OSTRACE
(("TRANSPROXY: OPEN %d\n", 
fd
));

31752 ifÐ
	gfd
>=0 ){

31753 
pFže
->
h
 = 
fd
;

31755 
	grc
=
SQLITE_CANTOPEN_BKPT
;

31759 ifÐ
	grc
==
SQLITE_OK
 && !
pCtx
->
lockProxy
 ){

31760 *
·th
 = 
‹mpLockP©h
 ?empLockP©h : 
pCtx
->
lockProxyP©h
;

31761 
	grc
 = 
´oxyC»©eUnixFže
(
·th
, &
pCtx
->
lockProxy
, 1);

31762 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_NOMEM
 && 
ŒyOldLockP©h
 ){

31766 
fÜûNewLockP©h
 = 1;

31767 
	gŒyOldLockP©h
 = 0;

31771 ifÐ
	grc
==
SQLITE_OK
 ){

31775 ifÐ
‹mpLockP©h
 ){

31776 
pCtx
->
lockProxyP©h
 = 
sql™e3DbSŒDup
(0, 
‹mpLockP©h
);

31777 ifÐ!
	gpCtx
->
	glockProxyP©h
 ){

31778 
	grc
 = 
SQLITE_NOMEM
;

31782 ifÐ
	grc
==
SQLITE_OK
 ){

31783 
pCtx
->
cÚchH–d
 = 1;

31785 ifÐ
	gpCtx
->
	glockProxy
->
	gpM‘hod
 =ð&
aåIoM‘hods
 ){

31786 
aåLockšgCÚ‹xt
 *
aåCtx
;

31787 
	gaåCtx
 = (
aåLockšgCÚ‹xt
 *)
pCtx
->
lockProxy
->
lockšgCÚ‹xt
;

31788 
	gaåCtx
->
	gdbP©h
 = 
pCtx
->
lockProxyP©h
;

31791 
	gcÚchFže
->
	gpM‘hod
->
xUÆock
((
sql™e3_fže
*)
cÚchFže
, 
NO_LOCK
);

31793 
OSTRACE
(("TAKECONCH %d %s\n", 
cÚchFže
->
h
,

31794 
rc
==
SQLITE_OK
?"ok":"failed"));

31795  
	grc
;

31804 
´oxyR–—£CÚch
(
unixFže
 *
pFže
){

31805 
	grc
 = 
SQLITE_OK
;

31806 
´oxyLockšgCÚ‹xt
 *
	gpCtx
;

31807 
unixFže
 *
	gcÚchFže
;

31809 
	gpCtx
 = (
´oxyLockšgCÚ‹xt
 *)
pFže
->
lockšgCÚ‹xt
;

31810 
	gcÚchFže
 = 
pCtx
->
cÚchFže
;

31811 
OSTRACE
(("RELEASECONCH %d fÜ % pid=%d\n", 
cÚchFže
->
h
,

31812 (
pCtx
->
lockProxyP©h
 ?…Ctx->lockProxyPath : ":auto:"),

31813 
g‘pid
()));

31814 ifÐ
	gpCtx
->
	gcÚchH–d
>0 ){

31815 
	grc
 = 
cÚchFže
->
pM‘hod
->
xUÆock
((
sql™e3_fže
*)cÚchFže, 
NO_LOCK
);

31817 
	gpCtx
->
	gcÚchH–d
 = 0;

31818 
OSTRACE
(("RELEASECONCH %d %s\n", 
cÚchFže
->
h
,

31819 (
rc
==
SQLITE_OK
 ? "ok" : "failed")));

31820  
	grc
;

31834 
´oxyC»©eCÚchP©hÇme
(*
dbP©h
, **
pCÚchP©h
){

31835 
	gi
;

31836 
	gËn
 = ()
¡¾’
(
dbP©h
);

31837 *
	gcÚchP©h
;

31841 *
	gpCÚchP©h
 = 
cÚchP©h
 = (*)
sql™e3_m®loc
(
Ën
 + 8);

31842 ifÐ
	gcÚchP©h
==0 ){

31843  
SQLITE_NOMEM
;

31845 
memýy
(
cÚchP©h
, 
dbP©h
, 
Ën
+1);

31848  
	gi
=(
Ën
-1); i>=0; i-- ){

31849 ifÐ
	gcÚchP©h
[
i
]=='/' ){

31850 
i
++;

31854 
	gcÚchP©h
[
i
]='.';

31855  
	gi
<
	gËn
 ){

31856 
	gcÚchP©h
[
i
+1]=
dbP©h
[i];

31857 
	gi
++;

31861 
memýy
(&
cÚchP©h
[
i
+1], "-conch", 7);

31862 
as£¹
Ð()
¡¾’
(
cÚchP©h
è=ð
Ën
+7 );

31864  
	gSQLITE_OK
;

31871 
sw™chLockProxyP©h
(
unixFže
 *
pFže
, cÚ¡ *
·th
) {

31872 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 = (´oxyLockšgCÚ‹xt*)
pFže
->
lockšgCÚ‹xt
;

31873 *
	gÞdP©h
 = 
pCtx
->
lockProxyP©h
;

31874 
	grc
 = 
SQLITE_OK
;

31876 ifÐ
	gpFže
->
	geFžeLock
!=
NO_LOCK
 ){

31877  
SQLITE_BUSY
;

31881 ifÐ!
	g·th
 ||…©h[0]=='\0' || !
¡rcmp
(
·th
, ":auto:") ||

31882 (
	gÞdP©h
 && !
¡ºcmp
(
ÞdP©h
, 
·th
, 
MAXPATHLEN
)) ){

31883  
	gSQLITE_OK
;

31885 
unixFže
 *
	glockProxy
 = 
pCtx
->
lockProxy
;

31886 
	gpCtx
->
	glockProxy
=
NULL
;

31887 
	gpCtx
->
	gcÚchH–d
 = 0;

31888 ifÐ
	glockProxy
!=
NULL
 ){

31889 
rc
=
lockProxy
->
pM‘hod
->
xClo£
((
sql™e3_fže
 *)lockProxy);

31890 ifÐ
	grc
 ) „c;

31891 
sql™e3_ä“
(
lockProxy
);

31893 
sql™e3_ä“
(
ÞdP©h
);

31894 
	gpCtx
->
	glockProxyP©h
 = 
sql™e3DbSŒDup
(0, 
·th
);

31897  
	grc
;

31907 
´oxyG‘DbP©hFÜUnixFže
(
unixFže
 *
pFže
, *
dbP©h
){

31908 #ià
defšed
(
__APPLE__
)

31909 ifÐ
	gpFže
->
	gpM‘hod
 =ð&
aåIoM‘hods
 ){

31912 
as£¹
Ð()
¡¾’
((*)
pFže
->
lockšgCÚ‹xt
)<=
MAXPATHLEN
 );

31913 
¡¾ýy
(
dbP©h
, ((
aåLockšgCÚ‹xt
 *)
pFže
->
lockšgCÚ‹xt
)->dbP©h, 
MAXPATHLEN
);

31916 ifÐ
	gpFže
->
	gpM‘hod
 =ð&
dÙlockIoM‘hods
 ){

31919 
Ën
 = 
¡¾’
((*)
pFže
->
lockšgCÚ‹xt
è- sŒËn(
DOTLOCK_SUFFIX
);

31920 
memýy
(
dbP©h
, (*)
pFže
->
lockšgCÚ‹xt
, 
Ën
 + 1);

31923 
as£¹
Ð
¡¾’
((*)
pFže
->
lockšgCÚ‹xt
)<=
MAXPATHLEN
 );

31924 
¡¾ýy
(
dbP©h
, (*)
pFže
->
lockšgCÚ‹xt
, 
MAXPATHLEN
);

31926  
	gSQLITE_OK
;

31937 
´oxyT¿nsfÜmUnixFže
(
unixFže
 *
pFže
, cÚ¡ *
·th
) {

31938 
´oxyLockšgCÚ‹xt
 *
	gpCtx
;

31939 
	gdbP©h
[
MAXPATHLEN
+1];

31940 *
	glockP©h
=
NULL
;

31941 
	grc
 = 
SQLITE_OK
;

31943 ifÐ
	gpFže
->
	geFžeLock
!=
NO_LOCK
 ){

31944  
SQLITE_BUSY
;

31946 
´oxyG‘DbP©hFÜUnixFže
(
pFže
, 
dbP©h
);

31947 ifÐ!
	g·th
 ||…©h[0]=='\0' || !
¡rcmp
(
·th
, ":auto:") ){

31948 
	glockP©h
=
NULL
;

31950 
	glockP©h
=(*)
·th
;

31953 
OSTRACE
(("TRANSPROXY %d fÜ % pid=%d\n", 
pFže
->
h
,

31954 (
lockP©h
 ?†ockP©h : ":auto:"), 
g‘pid
()));

31956 
	gpCtx
 = 
sql™e3_m®loc
Ð(*
pCtx
) );

31957 ifÐ
	gpCtx
==0 ){

31958  
SQLITE_NOMEM
;

31960 
mem£t
(
pCtx
, 0, (*pCtx));

31962 
	grc
 = 
´oxyC»©eCÚchP©hÇme
(
dbP©h
, &
pCtx
->
cÚchFžeP©h
);

31963 ifÐ
	grc
==
SQLITE_OK
 ){

31964 
rc
 = 
´oxyC»©eUnixFže
(
pCtx
->
cÚchFžeP©h
, &pCtx->
cÚchFže
, 0);

31965 ifÐ
	grc
==
SQLITE_CANTOPEN
 && ((
pFže
->
Ý’FÏgs
&
O_RDWR
) == 0) ){

31971 
¡©fs
 
fsInfo
;

31972 
¡©
 
	gcÚchInfo
;

31973 
	ggoLockËss
 = 0;

31975 ifÐ
osSt
(
pCtx
->
cÚchFžeP©h
, &
cÚchInfo
) == -1 ) {

31976 
”r
 = 
”ºo
;

31977 ifÐ(
	g”r
==
ENOENT
è&& (
¡©fs
(
dbP©h
, &
fsInfo
) != -1) ){

31978 
goLockËss
 = (
fsInfo
.
f_æags
&
MNT_RDONLY
) == MNT_RDONLY;

31981 ifÐ
	ggoLockËss
 ){

31982 
	gpCtx
->
	gcÚchH–d
 = -1;

31983 
	grc
 = 
SQLITE_OK
;

31987 ifÐ
	grc
==
SQLITE_OK
 && 
lockP©h
 ){

31988 
pCtx
->
lockProxyP©h
 = 
sql™e3DbSŒDup
(0, 
lockP©h
);

31991 ifÐ
	grc
==
SQLITE_OK
 ){

31992 
pCtx
->
dbP©h
 = 
sql™e3DbSŒDup
(0, dbPath);

31993 ifÐ
	gpCtx
->
	gdbP©h
==
NULL
 ){

31994 
rc
 = 
SQLITE_NOMEM
;

31997 ifÐ
	grc
==
SQLITE_OK
 ){

32001 
pCtx
->
ÞdLockšgCÚ‹xt
 = 
pFže
->
lockšgCÚ‹xt
;

32002 
	gpFže
->
	glockšgCÚ‹xt
 = 
pCtx
;

32003 
	gpCtx
->
	gpOldM‘hod
 = 
pFže
->
pM‘hod
;

32004 
	gpFže
->
	gpM‘hod
 = &
´oxyIoM‘hods
;

32006 ifÐ
	gpCtx
->
	gcÚchFže
 ){

32007 
	gpCtx
->
	gcÚchFže
->
	gpM‘hod
->
xClo£
((
sql™e3_fže
 *)
pCtx
->
cÚchFže
);

32008 
sql™e3_ä“
(
pCtx
->
cÚchFže
);

32010 
sql™e3DbF»e
(0, 
pCtx
->
lockProxyP©h
);

32011 
sql™e3_ä“
(
pCtx
->
cÚchFžeP©h
);

32012 
sql™e3_ä“
(
pCtx
);

32014 
OSTRACE
(("TRANSPROXY %d %s\n", 
pFže
->
h
,

32015 (
rc
==
SQLITE_OK
 ? "ok" : "failed")));

32016  
	grc
;

32024 
´oxyFžeCÚŒÞ
(
sql™e3_fže
 *
id
, 
Ý
, *
pArg
){

32025  
	gÝ
 ){

32026 
	gSQLITE_GET_LOCKPROXYFILE
: {

32027 
unixFže
 *
pFže
 = (unixFže*)
id
;

32028 ifÐ
	gpFže
->
	gpM‘hod
 =ð&
´oxyIoM‘hods
 ){

32029 
´oxyLockšgCÚ‹xt
 *
pCtx
 = (´oxyLockšgCÚ‹xt*)
pFže
->
lockšgCÚ‹xt
;

32030 
´oxyTakeCÚch
(
pFže
);

32031 ifÐ
	gpCtx
->
	glockProxyP©h
 ){

32032 *(cÚ¡ **)
	gpArg
 = 
pCtx
->
lockProxyP©h
;

32034 *(cÚ¡ **)
	gpArg
 = ":auto: (not held)";

32037 *(cÚ¡ **)
	gpArg
 = 
NULL
;

32039  
	gSQLITE_OK
;

32041 
	gSQLITE_SET_LOCKPROXYFILE
: {

32042 
unixFže
 *
pFže
 = (unixFže*)
id
;

32043 
	grc
 = 
SQLITE_OK
;

32044 
	gisProxyStyË
 = (
pFže
->
pM‘hod
 =ð&
´oxyIoM‘hods
);

32045 ifÐ
	gpArg
==
NULL
 || (cÚ¡ *)
pArg
==0 ){

32046 ifÐ
isProxyStyË
 ){

32048 
rc
 = 
SQLITE_ERROR
 ;

32051 
	grc
 = 
SQLITE_OK
;

32054 cÚ¡ *
	g´oxyP©h
 = (cÚ¡ *)
pArg
;

32055 ifÐ
	gisProxyStyË
 ){

32056 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 =

32057 (
´oxyLockšgCÚ‹xt
*)
pFže
->
lockšgCÚ‹xt
;

32058 ifÐ!
¡rcmp
(
pArg
, ":auto:")

32059 || (
	gpCtx
->
	glockProxyP©h
 &&

32060 !
¡ºcmp
(
pCtx
->
lockProxyP©h
, 
´oxyP©h
, 
MAXPATHLEN
))

32062 
	grc
 = 
SQLITE_OK
;

32064 
	grc
 = 
sw™chLockProxyP©h
(
pFže
, 
´oxyP©h
);

32068 
	grc
 = 
´oxyT¿nsfÜmUnixFže
(
pFže
, 
´oxyP©h
);

32071  
	grc
;

32074 
as£¹
( 0 );

32078  
	gSQLITE_ERROR
;

32094 
´oxyCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
) {

32095 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

32096 
	grc
 = 
´oxyTakeCÚch
(
pFže
);

32097 ifÐ
	grc
==
SQLITE_OK
 ){

32098 
´oxyLockšgCÚ‹xt
 *
pCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

32099 ifÐ
	gpCtx
->
	gcÚchH–d
>0 ){

32100 
unixFže
 *
	g´oxy
 = 
pCtx
->
lockProxy
;

32101  
	g´oxy
->
	gpM‘hod
->
xCheckRe£rvedLock
((
sql™e3_fže
*)
´oxy
, 
pResOut
);

32103 
	gpResOut
=0;

32106  
	grc
;

32133 
´oxyLock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

32134 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

32135 
	grc
 = 
´oxyTakeCÚch
(
pFže
);

32136 ifÐ
	grc
==
SQLITE_OK
 ){

32137 
´oxyLockšgCÚ‹xt
 *
pCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

32138 ifÐ
	gpCtx
->
	gcÚchH–d
>0 ){

32139 
unixFže
 *
	g´oxy
 = 
pCtx
->
lockProxy
;

32140 
	grc
 = 
´oxy
->
pM‘hod
->
xLock
((
sql™e3_fže
*íroxy, 
eFžeLock
);

32141 
	gpFže
->
	geFžeLock
 = 
´oxy
->
eFžeLock
;

32146  
	grc
;

32157 
´oxyUÆock
(
sql™e3_fže
 *
id
, 
eFžeLock
) {

32158 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

32159 
	grc
 = 
´oxyTakeCÚch
(
pFže
);

32160 ifÐ
	grc
==
SQLITE_OK
 ){

32161 
´oxyLockšgCÚ‹xt
 *
pCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

32162 ifÐ
	gpCtx
->
	gcÚchH–d
>0 ){

32163 
unixFže
 *
	g´oxy
 = 
pCtx
->
lockProxy
;

32164 
	grc
 = 
´oxy
->
pM‘hod
->
xUÆock
((
sql™e3_fže
*íroxy, 
eFžeLock
);

32165 
	gpFže
->
	geFžeLock
 = 
´oxy
->
eFžeLock
;

32170  
	grc
;

32176 
´oxyClo£
(
sql™e3_fže
 *
id
) {

32177 ifÐ
	gid
 ){

32178 
unixFže
 *
	gpFže
 = (unixFže*)
id
;

32179 
´oxyLockšgCÚ‹xt
 *
	gpCtx
 = (´oxyLockšgCÚ‹xˆ*)
pFže
->
lockšgCÚ‹xt
;

32180 
unixFže
 *
	glockProxy
 = 
pCtx
->
lockProxy
;

32181 
unixFže
 *
	gcÚchFže
 = 
pCtx
->
cÚchFže
;

32182 
	grc
 = 
SQLITE_OK
;

32184 ifÐ
	glockProxy
 ){

32185 
	grc
 = 
lockProxy
->
pM‘hod
->
xUÆock
((
sql™e3_fže
*îockProxy, 
NO_LOCK
);

32186 ifÐ
	grc
 ) „c;

32187 
	grc
 = 
lockProxy
->
pM‘hod
->
xClo£
((
sql™e3_fže
*)lockProxy);

32188 ifÐ
	grc
 ) „c;

32189 
sql™e3_ä“
(
lockProxy
);

32190 
	gpCtx
->
	glockProxy
 = 0;

32192 ifÐ
	gcÚchFže
 ){

32193 ifÐ
	gpCtx
->
	gcÚchH–d
 ){

32194 
	grc
 = 
´oxyR–—£CÚch
(
pFže
);

32195 ifÐ
	grc
 ) „c;

32197 
	grc
 = 
cÚchFže
->
pM‘hod
->
xClo£
((
sql™e3_fže
*)conchFile);

32198 ifÐ
	grc
 ) „c;

32199 
sql™e3_ä“
(
cÚchFže
);

32201 
sql™e3DbF»e
(0, 
pCtx
->
lockProxyP©h
);

32202 
sql™e3_ä“
(
pCtx
->
cÚchFžeP©h
);

32203 
sql™e3DbF»e
(0, 
pCtx
->
dbP©h
);

32205 
	gpFže
->
	glockšgCÚ‹xt
 = 
pCtx
->
ÞdLockšgCÚ‹xt
;

32206 
	gpFže
->
	gpM‘hod
 = 
pCtx
->
pOldM‘hod
;

32207 
sql™e3_ä“
(
pCtx
);

32208  
	gpFže
->
	gpM‘hod
->
xClo£
(
id
);

32210  
	gSQLITE_OK
;

32238 
SQLITE_API
 
sql™e3_os_š™
(){

32259 
	#UNIXVFS
(
VFSNAME
, 
FINDER
) { \

32261 (
unixFže
), \

32262 
MAX_PATHNAME
, \

32264 
VFSNAME
, \

32265 (*)&
FINDER
, \

32266 
unixO³n
, \

32267 
unixD–‘e
, \

32268 
unixAcûss
, \

32269 
unixFuÎP©hÇme
, \

32270 
unixDlO³n
, \

32271 
unixDlE¼Ü
, \

32272 
unixDlSym
, \

32273 
unixDlClo£
, \

32274 
unixRªdomÃss
, \

32275 
unixSË•
, \

32276 
unixCu¼’tTime
, \

32277 
unixG‘La¡E¼Ü
, \

32278 
unixCu¼’tTimeIÁ64
, \

32279 
unixS‘Sy¡emC®l
, \

32280 
unixG‘Sy¡emC®l
, \

32281 
unixNextSy¡emC®l
, \

32282 }

	)

32291 
sql™e3_vfs
 
	gaVfs
[] = {

32292 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && (
OS_VXWORKS
 || 
defšed
(
__APPLE__
))

32293 
UNIXVFS
("unix", 
autÞockIoFšd”
 ),

32295 
UNIXVFS
("unix", 
posixIoFšd”
 ),

32297 
UNIXVFS
("unix-nÚe", 
nÞockIoFšd”
 ),

32298 
UNIXVFS
("unix-dÙfže", 
dÙlockIoFšd”
 ),

32299 
UNIXVFS
("unix-exþ", 
posixIoFšd”
 ),

32300 #ià
OS_VXWORKS


32301 
UNIXVFS
("unix-Çmed£m", 
£mIoFšd”
 ),

32303 #ià
SQLITE_ENABLE_LOCKING_STYLE


32304 
UNIXVFS
("unix-posix", 
posixIoFšd”
 ),

32305 #ià!
OS_VXWORKS


32306 
UNIXVFS
("unix-æock", 
æockIoFšd”
 ),

32309 #ià
SQLITE_ENABLE_LOCKING_STYLE
 && 
defšed
(
__APPLE__
)

32310 
UNIXVFS
("unix-aå", 
aåIoFšd”
 ),

32311 
UNIXVFS
("unix-nfs", 
nfsIoFšd”
 ),

32312 
UNIXVFS
("unix-´oxy", 
´oxyIoFšd”
 ),

32315 
	gi
;

32319 
as£¹
Ð
A¼aySize
(
aSysÿÎ
)==25 );

32322 
	gi
=0; i<((
	gaVfs
)/(
	gsql™e3_vfs
)); i++){

32323 
sql™e3_vfs_»gi¡”
(&
aVfs
[
i
], i==0);

32325  
	gSQLITE_OK
;

32335 
SQLITE_API
 
sql™e3_os_’d
(){

32336  
	gSQLITE_OK
;

32357 #ià
SQLITE_OS_WIN


32383 #iâdeà
_OS_COMMON_H_


32384 
	#_OS_COMMON_H_


	)

32391 #ifdeà
MEMORY_DEBUG


32395 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

32396 #iâdeà
SQLITE_DEBUG_OS_TRACE


32397 
	#SQLITE_DEBUG_OS_TRACE
 0

	)

32399 
	gsql™e3OST¿û
 = 
SQLITE_DEBUG_OS_TRACE
;

32400 
	#OSTRACE
(
X
èifÐ
sql™e3OST¿û
 ) 
sql™e3DebugPrštf
 
	)
X

32402 
	#OSTRACE
(
X
)

	)

32409 #ifdeà
SQLITE_PERFORMANCE_TRACE


32432 #iâdeà
_HWTIME_H_


32433 
	#_HWTIME_H_


	)

32441 #ià(
defšed
(
__GNUC__
è|| defšed(
_MSC_VER
)) && \

32442 (
defšed
(
i386
è|| defšed(
__i386__
è|| defšed(
_M_IX86
))

32444 #ià
defšed
(
__GNUC__
)

32446 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

32447 
	glo
, 
	ghi
;

32448 
__asm__
 
__vÞ©že__
 ("rdtsc" : "÷" (
lo
), "=d" (
hi
));

32449  (
	gsql™e_ušt64
)
	ghi
 << 32 | 
	glo
;

32452 #–ià
defšed
(
_MSC_VER
)

32454 
__deþ¥ec
(
Çked
è
__šlše
 
sql™e_ušt64
 
__cdeþ
 
sql™e3Hwtime
(){

32455 
	g__asm
 {

32456 
rdtsc


32457 
	g»t
 ;  
v®ue
 
©
 
	gEDX
:
EAX


32463 #–ià(
defšed
(
__GNUC__
è&& defšed(
__x86_64__
))

32465 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

32466 
v®
;

32467 
__asm__
 
__vÞ©že__
 ("rdtsc" : "=A" (
v®
));

32468  
	gv®
;

32471 #–ià(
defšed
(
__GNUC__
è&& defšed(
__µc__
))

32473 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

32474 
	g»tv®
;

32475 
	gjunk
;

32476 
__asm__
 
__vÞ©že__
 ("\n\
1: mftbu %1\n\
 %L0\n\
 %0\n\
 %0,%1\n\
 1b"

32482 : "ô" (
»tv®
), "ô" (
junk
));

32483  
	g»tv®
;

32488 #”rÜ 
N“d
 
im¶em’tiÚ
 
of
 
sql™e3Hwtime
(è
your
 
¶©fÜm
.

32497 
SQLITE_PRIVATE
 
sql™e_ušt64
 
sql™e3Hwtime
(){  ((
	gsql™e_ušt64
)0); }

32506 
sql™e_ušt64
 
	gg_¡¬t
;

32507 
sql™e_ušt64
 
	gg_–­£d
;

32508 
	#TIMER_START
 
g_¡¬t
=
	`sql™e3Hwtime
()

	)

32509 
	#TIMER_END
 
g_–­£d
=
	`sql™e3Hwtime
()-
g_¡¬t


	)

32510 
	#TIMER_ELAPSED
 
g_–­£d


	)

32512 
	#TIMER_START


	)

32513 
	#TIMER_END


	)

32514 
	#TIMER_ELAPSED
 ((
sql™e_ušt64
)0)

	)

32522 #ifdeà
SQLITE_TEST


32523 
SQLITE_API
 
	gsql™e3_io_”rÜ_h™
 = 0;

32524 
SQLITE_API
 
	gsql™e3_io_”rÜ_h¬dh™
 = 0;

32525 
SQLITE_API
 
	gsql™e3_io_”rÜ_³ndšg
 = 0;

32526 
SQLITE_API
 
	gsql™e3_io_”rÜ_³rsi¡
 = 0;

32527 
SQLITE_API
 
	gsql™e3_io_”rÜ_b’ign
 = 0;

32528 
SQLITE_API
 
	gsql™e3_diskfuÎ_³ndšg
 = 0;

32529 
SQLITE_API
 
	gsql™e3_diskfuÎ
 = 0;

32530 
	#SimuÏ‹IOE¼ÜB’ign
(
X
è
sql™e3_io_”rÜ_b’ign
=(X)

	)

32531 
	#SimuÏ‹IOE¼Ü
(
CODE
) \

32532 ifÐ(
sql™e3_io_”rÜ_³rsi¡
 && 
sql™e3_io_”rÜ_h™
) \

32533 || 
sql™e3_io_”rÜ_³ndšg
-- == 1 ) \

32534 { 
	`loÿl_iÛ¼
(); 
CODE
; }

	)

32535 
loÿl_iÛ¼
(){

32536 
IOTRACE
(("IOERR\n"));

32537 
	gsql™e3_io_”rÜ_h™
++;

32538 ifÐ!
	gsql™e3_io_”rÜ_b’ign
 ) 
	gsql™e3_io_”rÜ_h¬dh™
++;

32540 
	#SimuÏ‹DiskfuÎE¼Ü
(
CODE
) \

32541 ifÐ
sql™e3_diskfuÎ_³ndšg
 ){ \

32542 ifÐ
sql™e3_diskfuÎ_³ndšg
 == 1 ){ \

32543 
	`loÿl_iÛ¼
(); \

32544 
sql™e3_diskfuÎ
 = 1; \

32545 
sql™e3_io_”rÜ_h™
 = 1; \

32546 
CODE
; \

32548 
sql™e3_diskfuÎ_³ndšg
--; \

32550 }

	)

32552 
	#SimuÏ‹IOE¼ÜB’ign
(
X
)

	)

32553 
	#SimuÏ‹IOE¼Ü
(
A
)

	)

32554 
	#SimuÏ‹DiskfuÎE¼Ü
(
A
)

	)

32560 #ifdeà
SQLITE_TEST


32561 
SQLITE_API
 
	gsql™e3_Ý’_fže_couÁ
 = 0;

32562 
	#O³nCouÁ”
(
X
è
sql™e3_Ý’_fže_couÁ
+=(X)

	)

32564 
	#O³nCouÁ”
(
X
)

	)

32580 #ià!
SQLITE_OS_WINNT
 && !
defšed
(
SQLITE_OMIT_WAL
)

32589 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && !
defšed
(
SQLITE_WIN32_NO_ANSI
)

32590 
	#SQLITE_WIN32_HAS_ANSI


	)

32597 #ià(
SQLITE_OS_WINCE
 || 
SQLITE_OS_WINNT
 || 
SQLITE_OS_WINRT
) && \

32598 !
defšed
(
SQLITE_WIN32_NO_WIDE
)

32599 
	#SQLITE_WIN32_HAS_WIDE


	)

32605 #ià!
defšed
(
SQLITE_WIN32_HAS_ANSI
è&& !defšed(
SQLITE_WIN32_HAS_WIDE
)

32614 #iâdeà
NTDDI_WIN8


32615 
	#NTDDI_WIN8
 0x06020000

	)

32618 #iâdeà
NTDDI_WINBLUE


32619 
	#NTDDI_WINBLUE
 0x06030000

	)

32626 #iâdeà
SQLITE_WIN32_GETVERSIONEX


32627 #ià
defšed
(
NTDDI_VERSION
è&& NTDDI_VERSION >ð
NTDDI_WINBLUE


32628 
	#SQLITE_WIN32_GETVERSIONEX
 0

	)

32630 
	#SQLITE_WIN32_GETVERSIONEX
 1

	)

32637 #iâdeà
MAX_PATH


32638 
	#MAX_PATH
 (260)

	)

32645 #iâdeà
SQLITE_WIN32_MAX_PATH_CHARS


32646 
	#SQLITE_WIN32_MAX_PATH_CHARS
 (
MAX_PATH
)

	)

32652 #iâdeà
UNICODE_STRING_MAX_CHARS


32653 
	#UNICODE_STRING_MAX_CHARS
 (32767)

	)

32660 #iâdeà
SQLITE_WINNT_MAX_PATH_CHARS


32661 
	#SQLITE_WINNT_MAX_PATH_CHARS
 (
UNICODE_STRING_MAX_CHARS
)

	)

32669 #iâdeà
SQLITE_WIN32_MAX_PATH_BYTES


32670 
	#SQLITE_WIN32_MAX_PATH_BYTES
 (
SQLITE_WIN32_MAX_PATH_CHARS
*4)

	)

32677 #iâdeà
SQLITE_WINNT_MAX_PATH_BYTES


32678 
	#SQLITE_WINNT_MAX_PATH_BYTES
 \

32679 ((
WCHAR
è* 
SQLITE_WINNT_MAX_PATH_CHARS
)

	)

32685 #iâdeà
SQLITE_WIN32_MAX_ERRMSG_CHARS


32686 
	#SQLITE_WIN32_MAX_ERRMSG_CHARS
 (1024)

	)

32693 #iâdeà
wšIsDœS•


32694 
	#wšIsDœS•
(
a
è((×è=ð'/'è|| (×è=ð'\\'))

	)

32701 #iâdeà
UNUSED_VARIABLE_VALUE


32702 
	#UNUSED_VARIABLE_VALUE
(
x
è()(x)

	)

32708 #iâdeà
wšG‘DœS•


32709 
	#wšG‘DœS•
(è'\\'

	)

32717 #ià
SQLITE_WIN32_FILEMAPPING_API
 && !
defšed
(
SQLITE_OMIT_WAL
)

32722 #ià
SQLITE_OS_WINRT


32723 
WINBASEAPI
 
HANDLE
 
WINAPI
 
C»©eFžeM­pšgFromAµ
(HANDLE, \

32724 
LPSECURITY_ATTRIBUTES
, 
ULONG
, 
ULONG64
, 
LPCWSTR
);

32726 
WINBASEAPI
 
LPVOID
 
WINAPI
 
M­V›wOfFžeFromAµ
(
HANDLE
, 
ULONG
, 
ULONG64
, 
SIZE_T
);

32728 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

32729 
WINBASEAPI
 
HANDLE
 
WINAPI
 
C»©eFžeM­pšgA
(HANDLE, 
LPSECURITY_ATTRIBUTES
, \

32730 
DWORD
, DWORD, DWORD, 
LPCSTR
);

32733 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

32734 
WINBASEAPI
 
HANDLE
 
WINAPI
 
C»©eFžeM­pšgW
(HANDLE, 
LPSECURITY_ATTRIBUTES
, \

32735 
DWORD
, DWORD, DWORD, 
LPCWSTR
);

32738 
WINBASEAPI
 
LPVOID
 
WINAPI
 
M­V›wOfFže
(
HANDLE
, 
DWORD
, DWORD, DWORD, 
SIZE_T
);

32744 
WINBASEAPI
 
BOOL
 
WINAPI
 
Unm­V›wOfFže
(
LPCVOID
);

32750 #iâdeà
INVALID_FILE_ATTRIBUTES


32751 
	#INVALID_FILE_ATTRIBUTES
 ((
DWORD
)-1)

	)

32754 #iâdeà
FILE_FLAG_MASK


32755 
	#FILE_FLAG_MASK
 (0xFF3C0000)

	)

32758 #iâdeà
FILE_ATTRIBUTE_MASK


32759 
	#FILE_ATTRIBUTE_MASK
 (0x0003FFF7)

	)

32762 #iâdeà
SQLITE_OMIT_WAL


32764 
wšShm
 
	twšShm
;

32765 
wšShmNode
 
	twšShmNode
;

32772 #ià
SQLITE_OS_WINCE


32773 
	swšûLock
 {

32774 
	gnR—d”s
;

32775 
BOOL
 
	gbP’dšg
;

32776 
BOOL
 
	gbRe£rved
;

32777 
BOOL
 
	gbExþusive
;

32778 } 
	twšûLock
;

32785 
wšFže
 
	twšFže
;

32786 
	swšFže
 {

32787 cÚ¡ 
sql™e3_io_m‘hods
 *
	gpM‘hod
;

32788 
sql™e3_vfs
 *
	gpVfs
;

32789 
HANDLE
 
	gh
;

32790 
u8
 
	glockty³
;

32791 
	gsh¬edLockBy‹
;

32792 
u8
 
	gù¾FÏgs
;

32793 
DWORD
 
	gÏ¡E¼no
;

32794 #iâdeà
SQLITE_OMIT_WAL


32795 
wšShm
 *
	gpShm
;

32797 cÚ¡ *
	gzP©h
;

32798 
	gszChunk
;

32799 #ià
SQLITE_OS_WINCE


32800 
LPWSTR
 
	gzD–‘eOnClo£
;

32801 
HANDLE
 
	ghMu‹x
;

32802 
HANDLE
 
	ghSh¬ed
;

32803 
wšûLock
 
	gloÿl
;

32804 
wšûLock
 *
	gsh¬ed
;

32806 #ià
SQLITE_MAX_MMAP_SIZE
>0

32807 
	gnF‘chOut
;

32808 
HANDLE
 
	ghM­
;

32809 *
	gpM­RegiÚ
;

32810 
sql™e3_št64
 
	gmm­Size
;

32811 
sql™e3_št64
 
	gmm­SizeAùu®
;

32812 
sql™e3_št64
 
	gmm­SizeMax
;

32819 
	#WINFILE_RDONLY
 0x02

	)

32820 
	#WINFILE_PERSIST_WAL
 0x04

	)

32821 
	#WINFILE_PSOW
 0x10

	)

32826 #iâdeà
SQLITE_WIN32_DBG_BUF_SIZE


32827 
	#SQLITE_WIN32_DBG_BUF_SIZE
 (()(4096-(
DWORD
)))

	)

32834 #iâdeà
SQLITE_WIN32_DATA_DIRECTORY_TYPE


32835 
	#SQLITE_WIN32_DATA_DIRECTORY_TYPE
 (1)

	)

32842 #iâdeà
SQLITE_WIN32_TEMP_DIRECTORY_TYPE


32843 
	#SQLITE_WIN32_TEMP_DIRECTORY_TYPE
 (2)

	)

32850 #ifdeà
SQLITE_WIN32_MALLOC


32866 #iâdeà
SQLITE_WIN32_HEAP_CREATE


32867 
	#SQLITE_WIN32_HEAP_CREATE
 (
TRUE
)

	)

32873 #iâdeà
SQLITE_WIN32_HEAP_INIT_SIZE


32874 
	#SQLITE_WIN32_HEAP_INIT_SIZE
 ((
SQLITE_DEFAULT_CACHE_SIZE
) * \

32875 (
SQLITE_DEFAULT_PAGE_SIZE
è+ 4194304)

	)

32881 #iâdeà
SQLITE_WIN32_HEAP_MAX_SIZE


32882 
	#SQLITE_WIN32_HEAP_MAX_SIZE
 (0)

	)

32889 #iâdeà
SQLITE_WIN32_HEAP_FLAGS


32890 
	#SQLITE_WIN32_HEAP_FLAGS
 (0)

	)

32898 
wšMemD©a
 
	twšMemD©a
;

32899 
	swšMemD©a
 {

32900 #iâdeà
NDEBUG


32901 
u32
 
	gmagic1
;

32903 
HANDLE
 
	ghH—p
;

32904 
BOOL
 
	gbOwÃd
;

32905 #iâdeà
NDEBUG


32906 
u32
 
	gmagic2
;

32910 #iâdeà
NDEBUG


32911 
	#WINMEM_MAGIC1
 0x42b2830b

	)

32912 
	#WINMEM_MAGIC2
 0xbd4d7cf4

	)

32915 
wšMemD©a
 
	gwš_mem_d©a
 = {

32916 #iâdeà
NDEBUG


32917 
WINMEM_MAGIC1
,

32919 
NULL
, 
FALSE


32920 #iâdeà
NDEBUG


32921 ,
WINMEM_MAGIC2


32925 #iâdeà
NDEBUG


32926 
	#wšMemAs£¹Magic1
(è
	`as£¹
Ð
wš_mem_d©a
.
magic1
==
WINMEM_MAGIC1
 )

	)

32927 
	#wšMemAs£¹Magic2
(è
	`as£¹
Ð
wš_mem_d©a
.
magic2
==
WINMEM_MAGIC2
 )

	)

32928 
	#wšMemAs£¹Magic
(è
	`wšMemAs£¹Magic1
(); 
	`wšMemAs£¹Magic2
();

	)

32930 
	#wšMemAs£¹Magic
()

	)

32933 
	#wšMemG‘D©aPŒ
(è&
wš_mem_d©a


	)

32934 
	#wšMemG‘H—p
(è
wš_mem_d©a
.
hH—p


	)

32935 
	#wšMemG‘OwÃd
(è
wš_mem_d©a
.
bOwÃd


	)

32937 *
wšMemM®loc
(
nBy‹s
);

32938 
wšMemF»e
(*
pPriÜ
);

32939 *
wšMemR—Îoc
(*
pPriÜ
, 
nBy‹s
);

32940 
wšMemSize
(*
p
);

32941 
wšMemRoundup
(
n
);

32942 
wšMemIn™
(*
pAµD©a
);

32943 
wšMemShutdown
(*
pAµD©a
);

32945 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Wš32
();

32960 #ifdeà
SQLITE_TEST


32961 
SQLITE_API
 
LONG
 
SQLITE_WIN32_VOLATILE
 
	gsql™e3_os_ty³
 = 0;

32963 
LONG
 
SQLITE_WIN32_VOLATILE
 
	gsql™e3_os_ty³
 = 0;

32966 #iâdeà
SYSCALL


32967 
	#SYSCALL
 
sql™e3_sysÿÎ_±r


	)

32974 #ià
SQLITE_OS_WINCE
 || 
SQLITE_OS_WINRT


32975 
	#osA»FžeApisANSI
(è1

	)

32984 
	swš_sysÿÎ
 {

32985 cÚ¡ *
	gzName
;

32986 
sql™e3_sysÿÎ_±r
 
	gpCu¼’t
;

32987 
sql™e3_sysÿÎ_±r
 
	gpDeçuÉ
;

32988 } 
	gaSysÿÎ
[] = {

32989 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT


32990 { "A»FžeApisANSI", (
SYSCALL
)
A»FžeApisANSI
, 0 },

32992 { "A»FžeApisANSI", (
SYSCALL
)0, 0 },

32995 #iâdeà
osA»FžeApisANSI


32996 
	#osA»FžeApisANSI
 ((
	`BOOL
(
WINAPI
*)(
VOID
))
aSysÿÎ
[0].
pCu¼’t
)

	)

32999 #ià
SQLITE_OS_WINCE
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33000 { "Ch¬Low”W", (
SYSCALL
)
Ch¬Low”W
, 0 },

33002 { "Ch¬Low”W", (
SYSCALL
)0, 0 },

33005 
	#osCh¬Low”W
 ((
	`LPWSTR
(
WINAPI
*)(
LPWSTR
))
aSysÿÎ
[1].
pCu¼’t
)

	)

33007 #ià
SQLITE_OS_WINCE
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33008 { "Ch¬Uµ”W", (
SYSCALL
)
Ch¬Uµ”W
, 0 },

33010 { "Ch¬Uµ”W", (
SYSCALL
)0, 0 },

33013 
	#osCh¬Uµ”W
 ((
	`LPWSTR
(
WINAPI
*)(
LPWSTR
))
aSysÿÎ
[2].
pCu¼’t
)

	)

33015 { "Clo£HªdË", (
SYSCALL
)
Clo£HªdË
, 0 },

33017 
	#osClo£HªdË
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
))
aSysÿÎ
[3].
pCu¼’t
)

	)

33019 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33020 { "C»©eFžeA", (
SYSCALL
)
C»©eFžeA
, 0 },

33022 { "C»©eFžeA", (
SYSCALL
)0, 0 },

33025 
	#osC»©eFžeA
 ((
	`HANDLE
(
WINAPI
*)(
LPCSTR
,
DWORD
,DWORD, \

33026 
LPSECURITY_ATTRIBUTES
,
DWORD
,DWORD,
HANDLE
))
aSysÿÎ
[4].
pCu¼’t
)

	)

33028 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33029 { "C»©eFžeW", (
SYSCALL
)
C»©eFžeW
, 0 },

33031 { "C»©eFžeW", (
SYSCALL
)0, 0 },

33034 
	#osC»©eFžeW
 ((
	`HANDLE
(
WINAPI
*)(
LPCWSTR
,
DWORD
,DWORD, \

33035 
LPSECURITY_ATTRIBUTES
,
DWORD
,DWORD,
HANDLE
))
aSysÿÎ
[5].
pCu¼’t
)

	)

33037 #ià(!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_ANSI
) && \

33038 !
defšed
(
SQLITE_OMIT_WAL
))

33039 { "C»©eFžeM­pšgA", (
SYSCALL
)
C»©eFžeM­pšgA
, 0 },

33041 { "C»©eFžeM­pšgA", (
SYSCALL
)0, 0 },

33044 
	#osC»©eFžeM­pšgA
 ((
	`HANDLE
(
WINAPI
*)(
HANDLE
,
LPSECURITY_ATTRIBUTES
, \

33045 
DWORD
,DWORD,DWORD,
LPCSTR
))
aSysÿÎ
[6].
pCu¼’t
)

	)

33047 #ià
SQLITE_OS_WINCE
 || (!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
) && \

33048 !
defšed
(
SQLITE_OMIT_WAL
))

33049 { "C»©eFžeM­pšgW", (
SYSCALL
)
C»©eFžeM­pšgW
, 0 },

33051 { "C»©eFžeM­pšgW", (
SYSCALL
)0, 0 },

33054 
	#osC»©eFžeM­pšgW
 ((
	`HANDLE
(
WINAPI
*)(
HANDLE
,
LPSECURITY_ATTRIBUTES
, \

33055 
DWORD
,DWORD,DWORD,
LPCWSTR
))
aSysÿÎ
[7].
pCu¼’t
)

	)

33057 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33058 { "C»©eMu‹xW", (
SYSCALL
)
C»©eMu‹xW
, 0 },

33060 { "C»©eMu‹xW", (
SYSCALL
)0, 0 },

33063 
	#osC»©eMu‹xW
 ((
	`HANDLE
(
WINAPI
*)(
LPSECURITY_ATTRIBUTES
,
BOOL
, \

33064 
LPCWSTR
))
aSysÿÎ
[8].
pCu¼’t
)

	)

33066 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33067 { "D–‘eFžeA", (
SYSCALL
)
D–‘eFžeA
, 0 },

33069 { "D–‘eFžeA", (
SYSCALL
)0, 0 },

33072 
	#osD–‘eFžeA
 ((
	`BOOL
(
WINAPI
*)(
LPCSTR
))
aSysÿÎ
[9].
pCu¼’t
)

	)

33074 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33075 { "D–‘eFžeW", (
SYSCALL
)
D–‘eFžeW
, 0 },

33077 { "D–‘eFžeW", (
SYSCALL
)0, 0 },

33080 
	#osD–‘eFžeW
 ((
	`BOOL
(
WINAPI
*)(
LPCWSTR
))
aSysÿÎ
[10].
pCu¼’t
)

	)

33082 #ià
SQLITE_OS_WINCE


33083 { "FžeTimeToLoÿlFžeTime", (
SYSCALL
)
FžeTimeToLoÿlFžeTime
, 0 },

33085 { "FžeTimeToLoÿlFžeTime", (
SYSCALL
)0, 0 },

33088 
	#osFžeTimeToLoÿlFžeTime
 ((
	`BOOL
(
WINAPI
*)(
CONST
 
FILETIME
*, \

33089 
LPFILETIME
))
aSysÿÎ
[11].
pCu¼’t
)

	)

33091 #ià
SQLITE_OS_WINCE


33092 { "FžeTimeToSy¡emTime", (
SYSCALL
)
FžeTimeToSy¡emTime
, 0 },

33094 { "FžeTimeToSy¡emTime", (
SYSCALL
)0, 0 },

33097 
	#osFžeTimeToSy¡emTime
 ((
	`BOOL
(
WINAPI
*)(
CONST
 
FILETIME
*, \

33098 
LPSYSTEMTIME
))
aSysÿÎ
[12].
pCu¼’t
)

	)

33100 { "FlushFžeBufãrs", (
SYSCALL
)
FlushFžeBufãrs
, 0 },

33102 
	#osFlushFžeBufãrs
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
))
aSysÿÎ
[13].
pCu¼’t
)

	)

33104 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33105 { "FÜm©Mes§geA", (
SYSCALL
)
FÜm©Mes§geA
, 0 },

33107 { "FÜm©Mes§geA", (
SYSCALL
)0, 0 },

33110 
	#osFÜm©Mes§geA
 ((
	`DWORD
(
WINAPI
*)(
DWORD
,
LPCVOID
,DWORD,DWORD,
LPSTR
, \

33111 
DWORD
,
va_li¡
*))
aSysÿÎ
[14].
pCu¼’t
)

	)

33113 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33114 { "FÜm©Mes§geW", (
SYSCALL
)
FÜm©Mes§geW
, 0 },

33116 { "FÜm©Mes§geW", (
SYSCALL
)0, 0 },

33119 
	#osFÜm©Mes§geW
 ((
	`DWORD
(
WINAPI
*)(
DWORD
,
LPCVOID
,DWORD,DWORD,
LPWSTR
, \

33120 
DWORD
,
va_li¡
*))
aSysÿÎ
[15].
pCu¼’t
)

	)

33122 #ià!
defšed
(
SQLITE_OMIT_LOAD_EXTENSION
)

33123 { "F»eLib¿ry", (
SYSCALL
)
F»eLib¿ry
, 0 },

33125 { "F»eLib¿ry", (
SYSCALL
)0, 0 },

33128 
	#osF»eLib¿ry
 ((
	`BOOL
(
WINAPI
*)(
HMODULE
))
aSysÿÎ
[16].
pCu¼’t
)

	)

33130 { "G‘Cu¼’tProûssId", (
SYSCALL
)
G‘Cu¼’tProûssId
, 0 },

33132 
	#osG‘Cu¼’tProûssId
 ((
	`DWORD
(
WINAPI
*)(
VOID
))
aSysÿÎ
[17].
pCu¼’t
)

	)

33134 #ià!
SQLITE_OS_WINCE
 && 
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33135 { "G‘DiskF»eS·ûA", (
SYSCALL
)
G‘DiskF»eS·ûA
, 0 },

33137 { "G‘DiskF»eS·ûA", (
SYSCALL
)0, 0 },

33140 
	#osG‘DiskF»eS·ûA
 ((
	`BOOL
(
WINAPI
*)(
LPCSTR
,
LPDWORD
,LPDWORD,LPDWORD, \

33141 
LPDWORD
))
aSysÿÎ
[18].
pCu¼’t
)

	)

33143 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33144 { "G‘DiskF»eS·ûW", (
SYSCALL
)
G‘DiskF»eS·ûW
, 0 },

33146 { "G‘DiskF»eS·ûW", (
SYSCALL
)0, 0 },

33149 
	#osG‘DiskF»eS·ûW
 ((
	`BOOL
(
WINAPI
*)(
LPCWSTR
,
LPDWORD
,LPDWORD,LPDWORD, \

33150 
LPDWORD
))
aSysÿÎ
[19].
pCu¼’t
)

	)

33152 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33153 { "G‘FžeA‰ribu‹sA", (
SYSCALL
)
G‘FžeA‰ribu‹sA
, 0 },

33155 { "G‘FžeA‰ribu‹sA", (
SYSCALL
)0, 0 },

33158 
	#osG‘FžeA‰ribu‹sA
 ((
	`DWORD
(
WINAPI
*)(
LPCSTR
))
aSysÿÎ
[20].
pCu¼’t
)

	)

33160 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33161 { "G‘FžeA‰ribu‹sW", (
SYSCALL
)
G‘FžeA‰ribu‹sW
, 0 },

33163 { "G‘FžeA‰ribu‹sW", (
SYSCALL
)0, 0 },

33166 
	#osG‘FžeA‰ribu‹sW
 ((
	`DWORD
(
WINAPI
*)(
LPCWSTR
))
aSysÿÎ
[21].
pCu¼’t
)

	)

33168 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33169 { "G‘FžeA‰ribu‹sExW", (
SYSCALL
)
G‘FžeA‰ribu‹sExW
, 0 },

33171 { "G‘FžeA‰ribu‹sExW", (
SYSCALL
)0, 0 },

33174 
	#osG‘FžeA‰ribu‹sExW
 ((
	`BOOL
(
WINAPI
*)(
LPCWSTR
,
GET_FILEEX_INFO_LEVELS
, \

33175 
LPVOID
))
aSysÿÎ
[22].
pCu¼’t
)

	)

33177 #ià!
SQLITE_OS_WINRT


33178 { "G‘FžeSize", (
SYSCALL
)
G‘FžeSize
, 0 },

33180 { "G‘FžeSize", (
SYSCALL
)0, 0 },

33183 
	#osG‘FžeSize
 ((
	`DWORD
(
WINAPI
*)(
HANDLE
,
LPDWORD
))
aSysÿÎ
[23].
pCu¼’t
)

	)

33185 #ià!
SQLITE_OS_WINCE
 && 
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33186 { "G‘FuÎP©hNameA", (
SYSCALL
)
G‘FuÎP©hNameA
, 0 },

33188 { "G‘FuÎP©hNameA", (
SYSCALL
)0, 0 },

33191 
	#osG‘FuÎP©hNameA
 ((
	`DWORD
(
WINAPI
*)(
LPCSTR
,
DWORD
,
LPSTR
, \

33192 
LPSTR
*))
aSysÿÎ
[24].
pCu¼’t
)

	)

33194 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33195 { "G‘FuÎP©hNameW", (
SYSCALL
)
G‘FuÎP©hNameW
, 0 },

33197 { "G‘FuÎP©hNameW", (
SYSCALL
)0, 0 },

33200 
	#osG‘FuÎP©hNameW
 ((
	`DWORD
(
WINAPI
*)(
LPCWSTR
,
DWORD
,
LPWSTR
, \

33201 
LPWSTR
*))
aSysÿÎ
[25].
pCu¼’t
)

	)

33203 { "G‘La¡E¼Ü", (
SYSCALL
)
G‘La¡E¼Ü
, 0 },

33205 
	#osG‘La¡E¼Ü
 ((
	`DWORD
(
WINAPI
*)(
VOID
))
aSysÿÎ
[26].
pCu¼’t
)

	)

33207 #ià!
defšed
(
SQLITE_OMIT_LOAD_EXTENSION
)

33208 #ià
SQLITE_OS_WINCE


33210 { "G‘ProcAdd»ssA", (
SYSCALL
)
G‘ProcAdd»ssA
, 0 },

33214 { "G‘ProcAdd»ssA", (
SYSCALL
)
G‘ProcAdd»ss
, 0 },

33217 { "G‘ProcAdd»ssA", (
SYSCALL
)0, 0 },

33220 
	#osG‘ProcAdd»ssA
 ((
	`FARPROC
(
WINAPI
*)(
HMODULE
, \

33221 
LPCSTR
))
aSysÿÎ
[27].
pCu¼’t
)

	)

33223 #ià!
SQLITE_OS_WINRT


33224 { "G‘Sy¡emInfo", (
SYSCALL
)
G‘Sy¡emInfo
, 0 },

33226 { "G‘Sy¡emInfo", (
SYSCALL
)0, 0 },

33229 
	#osG‘Sy¡emInfo
 ((
	`VOID
(
WINAPI
*)(
LPSYSTEM_INFO
))
aSysÿÎ
[28].
pCu¼’t
)

	)

33231 { "G‘Sy¡emTime", (
SYSCALL
)
G‘Sy¡emTime
, 0 },

33233 
	#osG‘Sy¡emTime
 ((
	`VOID
(
WINAPI
*)(
LPSYSTEMTIME
))
aSysÿÎ
[29].
pCu¼’t
)

	)

33235 #ià!
SQLITE_OS_WINCE


33236 { "G‘Sy¡emTimeAsFžeTime", (
SYSCALL
)
G‘Sy¡emTimeAsFžeTime
, 0 },

33238 { "G‘Sy¡emTimeAsFžeTime", (
SYSCALL
)0, 0 },

33241 
	#osG‘Sy¡emTimeAsFžeTime
 ((
	`VOID
(
WINAPI
*)( \

33242 
LPFILETIME
))
aSysÿÎ
[30].
pCu¼’t
)

	)

33244 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33245 { "G‘TempP©hA", (
SYSCALL
)
G‘TempP©hA
, 0 },

33247 { "G‘TempP©hA", (
SYSCALL
)0, 0 },

33250 
	#osG‘TempP©hA
 ((
	`DWORD
(
WINAPI
*)(
DWORD
,
LPSTR
))
aSysÿÎ
[31].
pCu¼’t
)

	)

33252 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33253 { "G‘TempP©hW", (
SYSCALL
)
G‘TempP©hW
, 0 },

33255 { "G‘TempP©hW", (
SYSCALL
)0, 0 },

33258 
	#osG‘TempP©hW
 ((
	`DWORD
(
WINAPI
*)(
DWORD
,
LPWSTR
))
aSysÿÎ
[32].
pCu¼’t
)

	)

33260 #ià!
SQLITE_OS_WINRT


33261 { "G‘TickCouÁ", (
SYSCALL
)
G‘TickCouÁ
, 0 },

33263 { "G‘TickCouÁ", (
SYSCALL
)0, 0 },

33266 
	#osG‘TickCouÁ
 ((
	`DWORD
(
WINAPI
*)(
VOID
))
aSysÿÎ
[33].
pCu¼’t
)

	)

33268 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
è&& defšed(
SQLITE_WIN32_GETVERSIONEX
) && \

33269 
SQLITE_WIN32_GETVERSIONEX


33270 { "G‘V”siÚExA", (
SYSCALL
)
G‘V”siÚExA
, 0 },

33272 { "G‘V”siÚExA", (
SYSCALL
)0, 0 },

33275 
	#osG‘V”siÚExA
 ((
	`BOOL
(
WINAPI
*)( \

33276 
LPOSVERSIONINFOA
))
aSysÿÎ
[34].
pCu¼’t
)

	)

33278 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
) && \

33279 
defšed
(
SQLITE_WIN32_GETVERSIONEX
) && SQLITE_WIN32_GETVERSIONEX

33280 { "G‘V”siÚExW", (
SYSCALL
)
G‘V”siÚExW
, 0 },

33282 { "G‘V”siÚExW", (
SYSCALL
)0, 0 },

33285 
	#osG‘V”siÚExW
 ((
	`BOOL
(
WINAPI
*)( \

33286 
LPOSVERSIONINFOW
))
aSysÿÎ
[35].
pCu¼’t
)

	)

33288 { "H—pAÎoc", (
SYSCALL
)
H—pAÎoc
, 0 },

33290 
	#osH—pAÎoc
 ((
	`LPVOID
(
WINAPI
*)(
HANDLE
,
DWORD
, \

33291 
SIZE_T
))
aSysÿÎ
[36].
pCu¼’t
)

	)

33293 #ià!
SQLITE_OS_WINRT


33294 { "H—pC»©e", (
SYSCALL
)
H—pC»©e
, 0 },

33296 { "H—pC»©e", (
SYSCALL
)0, 0 },

33299 
	#osH—pC»©e
 ((
	`HANDLE
(
WINAPI
*)(
DWORD
,
SIZE_T
, \

33300 
SIZE_T
))
aSysÿÎ
[37].
pCu¼’t
)

	)

33302 #ià!
SQLITE_OS_WINRT


33303 { "H—pDe¡roy", (
SYSCALL
)
H—pDe¡roy
, 0 },

33305 { "H—pDe¡roy", (
SYSCALL
)0, 0 },

33308 
	#osH—pDe¡roy
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
))
aSysÿÎ
[38].
pCu¼’t
)

	)

33310 { "H—pF»e", (
SYSCALL
)
H—pF»e
, 0 },

33312 
	#osH—pF»e
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
,
LPVOID
))
aSysÿÎ
[39].
pCu¼’t
)

	)

33314 { "H—pReAÎoc", (
SYSCALL
)
H—pReAÎoc
, 0 },

33316 
	#osH—pReAÎoc
 ((
	`LPVOID
(
WINAPI
*)(
HANDLE
,
DWORD
,
LPVOID
, \

33317 
SIZE_T
))
aSysÿÎ
[40].
pCu¼’t
)

	)

33319 { "H—pSize", (
SYSCALL
)
H—pSize
, 0 },

33321 
	#osH—pSize
 ((
	`SIZE_T
(
WINAPI
*)(
HANDLE
,
DWORD
, \

33322 
LPCVOID
))
aSysÿÎ
[41].
pCu¼’t
)

	)

33324 #ià!
SQLITE_OS_WINRT


33325 { "H—pV®id©e", (
SYSCALL
)
H—pV®id©e
, 0 },

33327 { "H—pV®id©e", (
SYSCALL
)0, 0 },

33330 
	#osH—pV®id©e
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
, \

33331 
LPCVOID
))
aSysÿÎ
[42].
pCu¼’t
)

	)

33333 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT


33334 { "H—pCom·ù", (
SYSCALL
)
H—pCom·ù
, 0 },

33336 { "H—pCom·ù", (
SYSCALL
)0, 0 },

33339 
	#osH—pCom·ù
 ((
	`UINT
(
WINAPI
*)(
HANDLE
,
DWORD
))
aSysÿÎ
[43].
pCu¼’t
)

	)

33341 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
è&& !defšed(
SQLITE_OMIT_LOAD_EXTENSION
)

33342 { "LßdLib¿ryA", (
SYSCALL
)
LßdLib¿ryA
, 0 },

33344 { "LßdLib¿ryA", (
SYSCALL
)0, 0 },

33347 
	#osLßdLib¿ryA
 ((
	`HMODULE
(
WINAPI
*)(
LPCSTR
))
aSysÿÎ
[44].
pCu¼’t
)

	)

33349 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_HAS_WIDE
) && \

33350 !
defšed
(
SQLITE_OMIT_LOAD_EXTENSION
)

33351 { "LßdLib¿ryW", (
SYSCALL
)
LßdLib¿ryW
, 0 },

33353 { "LßdLib¿ryW", (
SYSCALL
)0, 0 },

33356 
	#osLßdLib¿ryW
 ((
	`HMODULE
(
WINAPI
*)(
LPCWSTR
))
aSysÿÎ
[45].
pCu¼’t
)

	)

33358 #ià!
SQLITE_OS_WINRT


33359 { "LoÿlF»e", (
SYSCALL
)
LoÿlF»e
, 0 },

33361 { "LoÿlF»e", (
SYSCALL
)0, 0 },

33364 
	#osLoÿlF»e
 ((
	`HLOCAL
(
WINAPI
*)(
HLOCAL
))
aSysÿÎ
[46].
pCu¼’t
)

	)

33366 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT


33367 { "LockFže", (
SYSCALL
)
LockFže
, 0 },

33369 { "LockFže", (
SYSCALL
)0, 0 },

33372 #iâdeà
osLockFže


33373 
	#osLockFže
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
,DWORD,DWORD, \

33374 
DWORD
))
aSysÿÎ
[47].
pCu¼’t
)

	)

33377 #ià!
SQLITE_OS_WINCE


33378 { "LockFžeEx", (
SYSCALL
)
LockFžeEx
, 0 },

33380 { "LockFžeEx", (
SYSCALL
)0, 0 },

33383 #iâdeà
osLockFžeEx


33384 
	#osLockFžeEx
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
,DWORD,DWORD,DWORD, \

33385 
LPOVERLAPPED
))
aSysÿÎ
[48].
pCu¼’t
)

	)

33388 #ià
SQLITE_OS_WINCE
 || (!
SQLITE_OS_WINRT
 && !
defšed
(
SQLITE_OMIT_WAL
))

33389 { "M­V›wOfFže", (
SYSCALL
)
M­V›wOfFže
, 0 },

33391 { "M­V›wOfFže", (
SYSCALL
)0, 0 },

33394 
	#osM­V›wOfFže
 ((
	`LPVOID
(
WINAPI
*)(
HANDLE
,
DWORD
,DWORD,DWORD, \

33395 
SIZE_T
))
aSysÿÎ
[49].
pCu¼’t
)

	)

33397 { "MuÉiBy‹ToWideCh¬", (
SYSCALL
)
MuÉiBy‹ToWideCh¬
, 0 },

33399 
	#osMuÉiBy‹ToWideCh¬
 (((
WINAPI
*)(
UINT
,
DWORD
,
LPCSTR
,,
LPWSTR
, \

33400 ))
aSysÿÎ
[50].
pCu¼’t
)

	)

33402 { "Qu”yP”fÜmªûCouÁ”", (
SYSCALL
)
Qu”yP”fÜmªûCouÁ”
, 0 },

33404 
	#osQu”yP”fÜmªûCouÁ”
 ((
	`BOOL
(
WINAPI
*)( \

33405 
LARGE_INTEGER
*))
aSysÿÎ
[51].
pCu¼’t
)

	)

33407 { "R—dFže", (
SYSCALL
)
R—dFže
, 0 },

33409 
	#osR—dFže
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
LPVOID
,
DWORD
,
LPDWORD
, \

33410 
LPOVERLAPPED
))
aSysÿÎ
[52].
pCu¼’t
)

	)

33412 { "S‘EndOfFže", (
SYSCALL
)
S‘EndOfFže
, 0 },

33414 
	#osS‘EndOfFže
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
))
aSysÿÎ
[53].
pCu¼’t
)

	)

33416 #ià!
SQLITE_OS_WINRT


33417 { "S‘FžePoš‹r", (
SYSCALL
)
S‘FžePoš‹r
, 0 },

33419 { "S‘FžePoš‹r", (
SYSCALL
)0, 0 },

33422 
	#osS‘FžePoš‹r
 ((
	`DWORD
(
WINAPI
*)(
HANDLE
,
LONG
,
PLONG
, \

33423 
DWORD
))
aSysÿÎ
[54].
pCu¼’t
)

	)

33425 #ià!
SQLITE_OS_WINRT


33426 { "SË•", (
SYSCALL
)
SË•
, 0 },

33428 { "SË•", (
SYSCALL
)0, 0 },

33431 
	#osSË•
 ((
	`VOID
(
WINAPI
*)(
DWORD
))
aSysÿÎ
[55].
pCu¼’t
)

	)

33433 { "Sy¡emTimeToFžeTime", (
SYSCALL
)
Sy¡emTimeToFžeTime
, 0 },

33435 
	#osSy¡emTimeToFžeTime
 ((
	`BOOL
(
WINAPI
*)(
CONST
 
SYSTEMTIME
*, \

33436 
LPFILETIME
))
aSysÿÎ
[56].
pCu¼’t
)

	)

33438 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT


33439 { "UÆockFže", (
SYSCALL
)
UÆockFže
, 0 },

33441 { "UÆockFže", (
SYSCALL
)0, 0 },

33444 #iâdeà
osUÆockFže


33445 
	#osUÆockFže
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
,DWORD,DWORD, \

33446 
DWORD
))
aSysÿÎ
[57].
pCu¼’t
)

	)

33449 #ià!
SQLITE_OS_WINCE


33450 { "UÆockFžeEx", (
SYSCALL
)
UÆockFžeEx
, 0 },

33452 { "UÆockFžeEx", (
SYSCALL
)0, 0 },

33455 
	#osUÆockFžeEx
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
DWORD
,DWORD,DWORD, \

33456 
LPOVERLAPPED
))
aSysÿÎ
[58].
pCu¼’t
)

	)

33458 #ià
SQLITE_OS_WINCE
 || !
defšed
(
SQLITE_OMIT_WAL
)

33459 { "Unm­V›wOfFže", (
SYSCALL
)
Unm­V›wOfFže
, 0 },

33461 { "Unm­V›wOfFže", (
SYSCALL
)0, 0 },

33464 
	#osUnm­V›wOfFže
 ((
	`BOOL
(
WINAPI
*)(
LPCVOID
))
aSysÿÎ
[59].
pCu¼’t
)

	)

33466 { "WideCh¬ToMuÉiBy‹", (
SYSCALL
)
WideCh¬ToMuÉiBy‹
, 0 },

33468 
	#osWideCh¬ToMuÉiBy‹
 (((
WINAPI
*)(
UINT
,
DWORD
,
LPCWSTR
,,
LPSTR
,, \

33469 
LPCSTR
,
LPBOOL
))
aSysÿÎ
[60].
pCu¼’t
)

	)

33471 { "Wr™eFže", (
SYSCALL
)
Wr™eFže
, 0 },

33473 
	#osWr™eFže
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
LPCVOID
,
DWORD
,
LPDWORD
, \

33474 
LPOVERLAPPED
))
aSysÿÎ
[61].
pCu¼’t
)

	)

33476 #ià
SQLITE_OS_WINRT


33477 { "C»©eEv’tExW", (
SYSCALL
)
C»©eEv’tExW
, 0 },

33479 { "C»©eEv’tExW", (
SYSCALL
)0, 0 },

33482 
	#osC»©eEv’tExW
 ((
	`HANDLE
(
WINAPI
*)(
LPSECURITY_ATTRIBUTES
,
LPCWSTR
, \

33483 
DWORD
,DWORD))
aSysÿÎ
[62].
pCu¼’t
)

	)

33485 #ià!
SQLITE_OS_WINRT


33486 { "Wa™FÜSšgËObjeù", (
SYSCALL
)
Wa™FÜSšgËObjeù
, 0 },

33488 { "Wa™FÜSšgËObjeù", (
SYSCALL
)0, 0 },

33491 
	#osWa™FÜSšgËObjeù
 ((
	`DWORD
(
WINAPI
*)(
HANDLE
, \

33492 
DWORD
))
aSysÿÎ
[63].
pCu¼’t
)

	)

33494 #ià!
SQLITE_OS_WINCE


33495 { "Wa™FÜSšgËObjeùEx", (
SYSCALL
)
Wa™FÜSšgËObjeùEx
, 0 },

33497 { "Wa™FÜSšgËObjeùEx", (
SYSCALL
)0, 0 },

33500 
	#osWa™FÜSšgËObjeùEx
 ((
	`DWORD
(
WINAPI
*)(
HANDLE
,
DWORD
, \

33501 
BOOL
))
aSysÿÎ
[64].
pCu¼’t
)

	)

33503 #ià
SQLITE_OS_WINRT


33504 { "S‘FžePoš‹rEx", (
SYSCALL
)
S‘FžePoš‹rEx
, 0 },

33506 { "S‘FžePoš‹rEx", (
SYSCALL
)0, 0 },

33509 
	#osS‘FžePoš‹rEx
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
,
LARGE_INTEGER
, \

33510 
PLARGE_INTEGER
,
DWORD
))
aSysÿÎ
[65].
pCu¼’t
)

	)

33512 #ià
SQLITE_OS_WINRT


33513 { "G‘FžeInfÜm©iÚByHªdËEx", (
SYSCALL
)
G‘FžeInfÜm©iÚByHªdËEx
, 0 },

33515 { "G‘FžeInfÜm©iÚByHªdËEx", (
SYSCALL
)0, 0 },

33518 
	#osG‘FžeInfÜm©iÚByHªdËEx
 ((
	`BOOL
(
WINAPI
*)(
HANDLE
, \

33519 
FILE_INFO_BY_HANDLE_CLASS
,
LPVOID
,
DWORD
))
aSysÿÎ
[66].
pCu¼’t
)

	)

33521 #ià
SQLITE_OS_WINRT
 && !
defšed
(
SQLITE_OMIT_WAL
)

33522 { "M­V›wOfFžeFromAµ", (
SYSCALL
)
M­V›wOfFžeFromAµ
, 0 },

33524 { "M­V›wOfFžeFromAµ", (
SYSCALL
)0, 0 },

33527 
	#osM­V›wOfFžeFromAµ
 ((
	`LPVOID
(
WINAPI
*)(
HANDLE
,
ULONG
,
ULONG64
, \

33528 
SIZE_T
))
aSysÿÎ
[67].
pCu¼’t
)

	)

33530 #ià
SQLITE_OS_WINRT


33531 { "C»©eFže2", (
SYSCALL
)
C»©eFže2
, 0 },

33533 { "C»©eFže2", (
SYSCALL
)0, 0 },

33536 
	#osC»©eFže2
 ((
	`HANDLE
(
WINAPI
*)(
LPCWSTR
,
DWORD
,DWORD,DWORD, \

33537 
LPCREATEFILE2_EXTENDED_PARAMETERS
))
aSysÿÎ
[68].
pCu¼’t
)

	)

33539 #ià
SQLITE_OS_WINRT
 && !
defšed
(
SQLITE_OMIT_LOAD_EXTENSION
)

33540 { "LßdPackagedLib¿ry", (
SYSCALL
)
LßdPackagedLib¿ry
, 0 },

33542 { "LßdPackagedLib¿ry", (
SYSCALL
)0, 0 },

33545 
	#osLßdPackagedLib¿ry
 ((
	`HMODULE
(
WINAPI
*)(
LPCWSTR
, \

33546 
DWORD
))
aSysÿÎ
[69].
pCu¼’t
)

	)

33548 #ià
SQLITE_OS_WINRT


33549 { "G‘TickCouÁ64", (
SYSCALL
)
G‘TickCouÁ64
, 0 },

33551 { "G‘TickCouÁ64", (
SYSCALL
)0, 0 },

33554 
	#osG‘TickCouÁ64
 ((
	`ULONGLONG
(
WINAPI
*)(
VOID
))
aSysÿÎ
[70].
pCu¼’t
)

	)

33556 #ià
SQLITE_OS_WINRT


33557 { "G‘N©iveSy¡emInfo", (
SYSCALL
)
G‘N©iveSy¡emInfo
, 0 },

33559 { "G‘N©iveSy¡emInfo", (
SYSCALL
)0, 0 },

33562 
	#osG‘N©iveSy¡emInfo
 ((
	`VOID
(
WINAPI
*)( \

33563 
LPSYSTEM_INFO
))
aSysÿÎ
[71].
pCu¼’t
)

	)

33565 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33566 { "OuutDebugSŒšgA", (
SYSCALL
)
OuutDebugSŒšgA
, 0 },

33568 { "OuutDebugSŒšgA", (
SYSCALL
)0, 0 },

33571 
	#osOuutDebugSŒšgA
 ((
	`VOID
(
WINAPI
*)(
LPCSTR
))
aSysÿÎ
[72].
pCu¼’t
)

	)

33573 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33574 { "OuutDebugSŒšgW", (
SYSCALL
)
OuutDebugSŒšgW
, 0 },

33576 { "OuutDebugSŒšgW", (
SYSCALL
)0, 0 },

33579 
	#osOuutDebugSŒšgW
 ((
	`VOID
(
WINAPI
*)(
LPCWSTR
))
aSysÿÎ
[73].
pCu¼’t
)

	)

33581 { "G‘ProûssH—p", (
SYSCALL
)
G‘ProûssH—p
, 0 },

33583 
	#osG‘ProûssH—p
 ((
	`HANDLE
(
WINAPI
*)(
VOID
))
aSysÿÎ
[74].
pCu¼’t
)

	)

33585 #ià
SQLITE_OS_WINRT
 && !
defšed
(
SQLITE_OMIT_WAL
)

33586 { "C»©eFžeM­pšgFromAµ", (
SYSCALL
)
C»©eFžeM­pšgFromAµ
, 0 },

33588 { "C»©eFžeM­pšgFromAµ", (
SYSCALL
)0, 0 },

33591 
	#osC»©eFžeM­pšgFromAµ
 ((
	`HANDLE
(
WINAPI
*)(
HANDLE
, \

33592 
LPSECURITY_ATTRIBUTES
,
ULONG
,
ULONG64
,
LPCWSTR
))
aSysÿÎ
[75].
pCu¼’t
)

	)

33599 #ià
defšed
(
IÁ”lockedCom·»Exchªge
)

33600 { "IÁ”lockedCom·»Exchªge", (
SYSCALL
)0, 0 },

33602 
	#osIÁ”lockedCom·»Exchªge
 
IÁ”lockedCom·»Exchªge


	)

33604 { "IÁ”lockedCom·»Exchªge", (
SYSCALL
)
IÁ”lockedCom·»Exchªge
, 0 },

33606 
	#osIÁ”lockedCom·»Exchªge
 ((
	`LONG
(
WINAPI
*)(
LONG
 \

33607 
SQLITE_WIN32_VOLATILE
*, 
LONG
,LONG))
aSysÿÎ
[76].
pCu¼’t
)

	)

33618 
wšS‘Sy¡emC®l
(

33619 
sql™e3_vfs
 *
pNÙU£d
,

33620 cÚ¡ *
zName
,

33621 
sql™e3_sysÿÎ_±r
 
pNewFunc


33623 
	gi
;

33624 
	grc
 = 
SQLITE_NOTFOUND
;

33626 
UNUSED_PARAMETER
(
pNÙU£d
);

33627 ifÐ
	gzName
==0 ){

33631 
rc
 = 
SQLITE_OK
;

33632 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

33633 ifÐ
	gaSysÿÎ
[
i
].
	gpDeçuÉ
 ){

33634 
	gaSysÿÎ
[
i
].
	gpCu¼’t
 = 
aSysÿÎ
[i].
pDeçuÉ
;

33641 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

33642 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ){

33643 ifÐ
aSysÿÎ
[
i
].
pDeçuÉ
==0 ){

33644 
aSysÿÎ
[
i
].
pDeçuÉ
 =‡SysÿÎ[i].
pCu¼’t
;

33646 
	grc
 = 
SQLITE_OK
;

33647 ifÐ
	gpNewFunc
==0 ) 
pNewFunc
 = 
aSysÿÎ
[
i
].
pDeçuÉ
;

33648 
	gaSysÿÎ
[
i
].
	gpCu¼’t
 = 
pNewFunc
;

33653  
	grc
;

33661 
sql™e3_sysÿÎ_±r
 
wšG‘Sy¡emC®l
(

33662 
sql™e3_vfs
 *
pNÙU£d
,

33663 cÚ¡ *
zName


33665 
	gi
;

33667 
UNUSED_PARAMETER
(
pNÙU£d
);

33668 
	gi
=0; i<(
	gaSysÿÎ
)/(aSyscall[0]); i++){

33669 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ) ‡SysÿÎ[i].
pCu¼’t
;

33680 cÚ¡ *
wšNextSy¡emC®l
(
sql™e3_vfs
 *
p
, cÚ¡ *
zName
){

33681 
	gi
 = -1;

33683 
UNUSED_PARAMETER
(
p
);

33684 ifÐ
	gzName
 ){

33685 
	gi
=0; i<
A¼aySize
(
aSysÿÎ
)-1; i++){

33686 ifÐ
¡rcmp
(
zName
, 
aSysÿÎ
[
i
].zName)==0 ) ;

33689 
	gi
++; i<
A¼aySize
(
aSysÿÎ
); i++){

33690 ifÐ
	gaSysÿÎ
[
i
].
	gpCu¼’t
!=0 )  
aSysÿÎ
[i].
zName
;

33695 #ifdeà
SQLITE_WIN32_MALLOC


33703 
SQLITE_API
 
sql™e3_wš32_com·ù_h—p
(
LPUINT
 
²L¬ge¡
){

33704 
	grc
 = 
SQLITE_OK
;

33705 
UINT
 
	gnL¬ge¡
 = 0;

33706 
HANDLE
 
	ghH—p
;

33708 
wšMemAs£¹Magic
();

33709 
	ghH—p
 = 
wšMemG‘H—p
();

33710 
as£¹
Ð
hH—p
!=0 );

33711 
as£¹
Ð
hH—p
!=
INVALID_HANDLE_VALUE
 );

33712 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

33713 
as£¹
Ð
osH—pV®id©e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
NULL
) );

33715 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT


33716 ifÐ(
	gnL¬ge¡
=
osH—pCom·ù
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
))==0 ){

33717 
DWORD
 
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

33718 ifÐ
	gÏ¡E¼no
==
NO_ERROR
 ){

33719 
sql™e3_log
(
SQLITE_NOMEM
, "failedo HeapCompact (no space), heap=%p",

33720 (*)
hH—p
);

33721 
	grc
 = 
SQLITE_NOMEM
;

33723 
sql™e3_log
(
SQLITE_ERROR
, "failedo HeapCompact (%lu), heap=%p",

33724 
osG‘La¡E¼Ü
(), (*)
hH—p
);

33725 
	grc
 = 
SQLITE_ERROR
;

33729 
sql™e3_log
(
SQLITE_NOTFOUND
, "failedo HeapCompact, heap=%p",

33730 (*)
hH—p
);

33731 
	grc
 = 
SQLITE_NOTFOUND
;

33733 ifÐ
	g²L¬ge¡
 ) *²L¬ge¡ = 
nL¬ge¡
;

33734  
	grc
;

33743 
SQLITE_API
 
sql™e3_wš32_»£t_h—p
(){

33744 
	grc
;

33745 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
pMa¡”
; )

33746 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
pMem
; )

33747 
MUTEX_LOGIC
Ð
pMa¡”
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
); )

33748 
MUTEX_LOGIC
Ð
pMem
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MEM
); )

33749 
sql™e3_mu‹x_’‹r
(
pMa¡”
);

33750 
sql™e3_mu‹x_’‹r
(
pMem
);

33751 
wšMemAs£¹Magic
();

33752 ifÐ
wšMemG‘H—p
()!=
NULL
 && 
wšMemG‘OwÃd
(è&& 
sql™e3_memÜy_u£d
()==0 ){

33760 
as£¹
Ð
wšMemG‘H—p
()!=
NULL
 );

33761 
as£¹
Ð
wšMemG‘OwÃd
() );

33762 
as£¹
Ð
sql™e3_memÜy_u£d
()==0 );

33763 
wšMemShutdown
(
wšMemG‘D©aPŒ
());

33764 
as£¹
Ð
wšMemG‘H—p
()==
NULL
 );

33765 
as£¹
Ð!
wšMemG‘OwÃd
() );

33766 
as£¹
Ð
sql™e3_memÜy_u£d
()==0 );

33767 
	grc
 = 
wšMemIn™
(
wšMemG‘D©aPŒ
());

33768 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
wšMemG‘H—p
()!=
NULL
 );

33769 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
wšMemG‘OwÃd
() );

33770 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
sql™e3_memÜy_u£d
()==0 );

33775 
	grc
 = 
SQLITE_BUSY
;

33777 
sql™e3_mu‹x_Ëave
(
pMem
);

33778 
sql™e3_mu‹x_Ëave
(
pMa¡”
);

33779  
	grc
;

33788 
SQLITE_API
 
sql™e3_wš32_wr™e_debug
(cÚ¡ *
zBuf
, 
nBuf
){

33789 
	gzDbgBuf
[
SQLITE_WIN32_DBG_BUF_SIZE
];

33790 
	gnMš
 = 
MIN
(
nBuf
, (
SQLITE_WIN32_DBG_BUF_SIZE
 - 1));

33791 ifÐ
	gnMš
<-1 )‚Min = -1;

33792 
as£¹
Ð
nMš
==-1 ||‚Mš==0 ||‚Mš<
SQLITE_WIN32_DBG_BUF_SIZE
 );

33793 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33794 ifÐ
	gnMš
>0 ){

33795 
mem£t
(
zDbgBuf
, 0, 
SQLITE_WIN32_DBG_BUF_SIZE
);

33796 
memýy
(
zDbgBuf
, 
zBuf
, 
nMš
);

33797 
osOuutDebugSŒšgA
(
zDbgBuf
);

33799 
osOuutDebugSŒšgA
(
zBuf
);

33801 #–ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33802 
mem£t
(
zDbgBuf
, 0, 
SQLITE_WIN32_DBG_BUF_SIZE
);

33803 iàÐ
osMuÉiBy‹ToWideCh¬
(

33804 
osA»FžeApisANSI
(è? 
CP_ACP
 : 
CP_OEMCP
, 0, 
zBuf
,

33805 
nMš
, (
LPWSTR
)
zDbgBuf
, 
SQLITE_WIN32_DBG_BUF_SIZE
/(
WCHAR
))<=0 ){

33808 
osOuutDebugSŒšgW
((
LPCWSTR
)
zDbgBuf
);

33810 ifÐ
	gnMš
>0 ){

33811 
mem£t
(
zDbgBuf
, 0, 
SQLITE_WIN32_DBG_BUF_SIZE
);

33812 
memýy
(
zDbgBuf
, 
zBuf
, 
nMš
);

33813 
årštf
(
¡d”r
, "%s", 
zDbgBuf
);

33815 
årštf
(
¡d”r
, "%s", 
zBuf
);

33824 #ià
SQLITE_OS_WINRT


33825 
HANDLE
 
	g¦“pObj
 = 
NULL
;

33828 
SQLITE_API
 
sql™e3_wš32_¦“p
(
DWORD
 
mžli£cÚds
){

33829 #ià
SQLITE_OS_WINRT


33830 iàÐ
	g¦“pObj
==
NULL
 ){

33831 
¦“pObj
 = 
osC»©eEv’tExW
(
NULL
, NULL, 
CREATE_EVENT_MANUAL_RESET
,

33832 
SYNCHRONIZE
);

33834 
as£¹
Ð
¦“pObj
!=
NULL
 );

33835 
osWa™FÜSšgËObjeùEx
(
¦“pObj
, 
mžli£cÚds
, 
FALSE
);

33837 
osSË•
(
mžli£cÚds
);

33841 #ià
SQLITE_MAX_WORKER_THREADS
>0 && !
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && \

33842 
	gSQLITE_THREADSAFE
>0

33843 
SQLITE_PRIVATE
 
DWORD
 
sql™e3Wš32Wa™
(
HANDLE
 
hObjeù
){

33844 
DWORD
 
	grc
;

33845  (
	grc
 = 
osWa™FÜSšgËObjeùEx
(
hObjeù
, 
INFINITE
,

33846 
TRUE
))==
WAIT_IO_COMPLETION
 ){}

33847  
rc
;

33863 #ià!
defšed
(
SQLITE_WIN32_GETVERSIONEX
) || !SQLITE_WIN32_GETVERSIONEX

33864 
	#osIsNT
(è(1)

	)

33865 #–ià
SQLITE_OS_WINCE
 || 
SQLITE_OS_WINRT
 || !
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33866 
	#osIsNT
(è(1)

	)

33867 #–ià!
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33868 
	#osIsNT
(è(0)

	)

33870 
	#osIsNT
(è((
sql™e3_os_ty³
==2è|| 
	`sql™e3_wš32_is_Á
())

	)

33877 
SQLITE_API
 
sql™e3_wš32_is_Á
(){

33878 #ià
SQLITE_OS_WINRT


33884 #–ià
defšed
(
SQLITE_WIN32_GETVERSIONEX
) && SQLITE_WIN32_GETVERSIONEX

33885 ifÐ
osIÁ”lockedCom·»Exchªge
(&
sql™e3_os_ty³
, 0, 0)==0 ){

33886 #ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

33887 
OSVERSIONINFOA
 
sInfo
;

33888 
	gsInfo
.
	gdwOSV”siÚInfoSize
 = (
sInfo
);

33889 
osG‘V”siÚExA
(&
sInfo
);

33890 
osIÁ”lockedCom·»Exchªge
(&
sql™e3_os_ty³
,

33891 (
sInfo
.
dwPÏtfÜmId
 =ð
VER_PLATFORM_WIN32_NT
) ? 2 : 1, 0);

33892 #–ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

33893 
OSVERSIONINFOW
 
	gsInfo
;

33894 
	gsInfo
.
	gdwOSV”siÚInfoSize
 = (
sInfo
);

33895 
osG‘V”siÚExW
(&
sInfo
);

33896 
osIÁ”lockedCom·»Exchªge
(&
sql™e3_os_ty³
,

33897 (
sInfo
.
dwPÏtfÜmId
 =ð
VER_PLATFORM_WIN32_NT
) ? 2 : 1, 0);

33900  
osIÁ”lockedCom·»Exchªge
(&
sql™e3_os_ty³
, 2, 2)==2;

33901 #–ià
SQLITE_TEST


33902  
osIÁ”lockedCom·»Exchªge
(&
sql™e3_os_ty³
, 2, 2)==2;

33912 #ifdeà
SQLITE_WIN32_MALLOC


33916 *
wšMemM®loc
(
nBy‹s
){

33917 
HANDLE
 
	ghH—p
;

33918 *
	gp
;

33920 
wšMemAs£¹Magic
();

33921 
	ghH—p
 = 
wšMemG‘H—p
();

33922 
as£¹
Ð
hH—p
!=0 );

33923 
as£¹
Ð
hH—p
!=
INVALID_HANDLE_VALUE
 );

33924 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

33925 
as£¹
Ð
osH—pV®id©e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
NULL
) );

33927 
as£¹
Ð
nBy‹s
>=0 );

33928 
	gp
 = 
osH—pAÎoc
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, (
SIZE_T
)
nBy‹s
);

33929 ifÐ!
	gp
 ){

33930 
sql™e3_log
(
SQLITE_NOMEM
, "failedo HeapAlloc %u bytes (%lu), heap=%p",

33931 
nBy‹s
, 
osG‘La¡E¼Ü
(), (*)
hH—p
);

33933  
	gp
;

33939 
wšMemF»e
(*
pPriÜ
){

33940 
HANDLE
 
	ghH—p
;

33942 
wšMemAs£¹Magic
();

33943 
	ghH—p
 = 
wšMemG‘H—p
();

33944 
as£¹
Ð
hH—p
!=0 );

33945 
as£¹
Ð
hH—p
!=
INVALID_HANDLE_VALUE
 );

33946 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

33947 
as£¹
Ð
osH—pV®id©e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
pPriÜ
) );

33949 ifÐ!
	gpPriÜ
 ) ;

33950 ifÐ!
osH—pF»e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
pPriÜ
) ){

33951 
sql™e3_log
(
SQLITE_NOMEM
, "failedo HeapFree block %p (%lu), heap=%p",

33952 
pPriÜ
, 
osG‘La¡E¼Ü
(), (*)
hH—p
);

33959 *
wšMemR—Îoc
(*
pPriÜ
, 
nBy‹s
){

33960 
HANDLE
 
	ghH—p
;

33961 *
	gp
;

33963 
wšMemAs£¹Magic
();

33964 
	ghH—p
 = 
wšMemG‘H—p
();

33965 
as£¹
Ð
hH—p
!=0 );

33966 
as£¹
Ð
hH—p
!=
INVALID_HANDLE_VALUE
 );

33967 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

33968 
as£¹
Ð
osH—pV®id©e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
pPriÜ
) );

33970 
as£¹
Ð
nBy‹s
>=0 );

33971 ifÐ!
	gpPriÜ
 ){

33972 
	gp
 = 
osH—pAÎoc
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, (
SIZE_T
)
nBy‹s
);

33974 
	gp
 = 
osH—pReAÎoc
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
pPriÜ
, (
SIZE_T
)
nBy‹s
);

33976 ifÐ!
	gp
 ){

33977 
sql™e3_log
(
SQLITE_NOMEM
, "failedo %s %u bytes (%lu), heap=%p",

33978 
pPriÜ
 ? "H—pReAÎoc" : "H—pAÎoc", 
nBy‹s
, 
osG‘La¡E¼Ü
(),

33979 (*)
hH—p
);

33981  
	gp
;

33987 
wšMemSize
(*
p
){

33988 
HANDLE
 
	ghH—p
;

33989 
SIZE_T
 
	gn
;

33991 
wšMemAs£¹Magic
();

33992 
	ghH—p
 = 
wšMemG‘H—p
();

33993 
as£¹
Ð
hH—p
!=0 );

33994 
as£¹
Ð
hH—p
!=
INVALID_HANDLE_VALUE
 );

33995 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

33996 
as£¹
Ð
osH—pV®id©e
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
p
) );

33998 ifÐ!
	gp
 )  0;

33999 
	gn
 = 
osH—pSize
(
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
p
);

34000 ifÐ
	gn
==(
SIZE_T
)-1 ){

34001 
sql™e3_log
(
SQLITE_NOMEM
, "failedo HeapSize block %p (%lu), heap=%p",

34002 
p
, 
osG‘La¡E¼Ü
(), (*)
hH—p
);

34005  ()
	gn
;

34011 
wšMemRoundup
(
n
){

34012  
	gn
;

34018 
wšMemIn™
(*
pAµD©a
){

34019 
wšMemD©a
 *
	gpWšMemD©a
 = (wšMemD©¨*)
pAµD©a
;

34021 ifÐ!
	gpWšMemD©a
 )  
	gSQLITE_ERROR
;

34022 
as£¹
Ð
pWšMemD©a
->
magic1
==
WINMEM_MAGIC1
 );

34023 
as£¹
Ð
pWšMemD©a
->
magic2
==
WINMEM_MAGIC2
 );

34025 #ià!
SQLITE_OS_WINRT
 && 
SQLITE_WIN32_HEAP_CREATE


34026 ifÐ!
	gpWšMemD©a
->
	ghH—p
 ){

34027 
DWORD
 
	gdwIn™ŸlSize
 = 
SQLITE_WIN32_HEAP_INIT_SIZE
;

34028 
DWORD
 
	gdwMaximumSize
 = (DWORD)
sql™e3Glob®CÚfig
.
nH—p
;

34029 ifÐ
	gdwMaximumSize
==0 ){

34030 
dwMaximumSize
 = 
SQLITE_WIN32_HEAP_MAX_SIZE
;

34031 }ifÐ
	gdwIn™ŸlSize
>
	gdwMaximumSize
 ){

34032 
	gdwIn™ŸlSize
 = 
dwMaximumSize
;

34034 
	gpWšMemD©a
->
	ghH—p
 = 
osH—pC»©e
(
SQLITE_WIN32_HEAP_FLAGS
,

34035 
dwIn™ŸlSize
, 
dwMaximumSize
);

34036 ifÐ!
	gpWšMemD©a
->
	ghH—p
 ){

34037 
sql™e3_log
(
SQLITE_NOMEM
,

34039 
osG‘La¡E¼Ü
(), 
SQLITE_WIN32_HEAP_FLAGS
, 
dwIn™ŸlSize
,

34040 
dwMaximumSize
);

34041  
	gSQLITE_NOMEM
;

34043 
	gpWšMemD©a
->
	gbOwÃd
 = 
TRUE
;

34044 
as£¹
Ð
pWšMemD©a
->
bOwÃd
 );

34047 
	gpWšMemD©a
->
	ghH—p
 = 
osG‘ProûssH—p
();

34048 ifÐ!
	gpWšMemD©a
->
	ghH—p
 ){

34049 
sql™e3_log
(
SQLITE_NOMEM
,

34050 "çžedØG‘ProûssH—°(%lu)", 
osG‘La¡E¼Ü
());

34051  
	gSQLITE_NOMEM
;

34053 
	gpWšMemD©a
->
	gbOwÃd
 = 
FALSE
;

34054 
as£¹
Ð!
pWšMemD©a
->
bOwÃd
 );

34056 
as£¹
Ð
pWšMemD©a
->
hH—p
!=0 );

34057 
as£¹
Ð
pWšMemD©a
->
hH—p
!=
INVALID_HANDLE_VALUE
 );

34058 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

34059 
as£¹
Ð
osH—pV®id©e
(
pWšMemD©a
->
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
NULL
) );

34061  
	gSQLITE_OK
;

34067 
wšMemShutdown
(*
pAµD©a
){

34068 
wšMemD©a
 *
	gpWšMemD©a
 = (wšMemD©¨*)
pAµD©a
;

34070 ifÐ!
	gpWšMemD©a
 ) ;

34071 
as£¹
Ð
pWšMemD©a
->
magic1
==
WINMEM_MAGIC1
 );

34072 
as£¹
Ð
pWšMemD©a
->
magic2
==
WINMEM_MAGIC2
 );

34074 ifÐ
	gpWšMemD©a
->
	ghH—p
 ){

34075 
as£¹
Ð
pWšMemD©a
->
hH—p
!=
INVALID_HANDLE_VALUE
 );

34076 #ià!
SQLITE_OS_WINRT
 && 
defšed
(
SQLITE_WIN32_MALLOC_VALIDATE
)

34077 
as£¹
Ð
osH—pV®id©e
(
pWšMemD©a
->
hH—p
, 
SQLITE_WIN32_HEAP_FLAGS
, 
NULL
) );

34079 ifÐ
	gpWšMemD©a
->
	gbOwÃd
 ){

34080 ifÐ!
osH—pDe¡roy
(
pWšMemD©a
->
hH—p
) ){

34081 
sql™e3_log
(
SQLITE_NOMEM
, "failedo HeapDestroy (%lu), heap=%p",

34082 
osG‘La¡E¼Ü
(), (*)
pWšMemD©a
->
hH—p
);

34084 
	gpWšMemD©a
->
	gbOwÃd
 = 
FALSE
;

34086 
	gpWšMemD©a
->
	ghH—p
 = 
NULL
;

34098 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_mem_m‘hods
 *
sql™e3MemG‘Wš32
(){

34099 cÚ¡ 
sql™e3_mem_m‘hods
 
	gwšMemM‘hods
 = {

34100 
wšMemM®loc
,

34101 
wšMemF»e
,

34102 
wšMemR—Îoc
,

34103 
wšMemSize
,

34104 
wšMemRoundup
,

34105 
wšMemIn™
,

34106 
wšMemShutdown
,

34107 &
wš_mem_d©a


34109  &
	gwšMemM‘hods
;

34112 
SQLITE_PRIVATE
 
sql™e3MemS‘DeçuÉ
(){

34113 
sql™e3_cÚfig
(
SQLITE_CONFIG_MALLOC
, 
sql™e3MemG‘Wš32
());

34122 
LPWSTR
 
wšUtf8ToUnicode
(cÚ¡ *
zFž’ame
){

34123 
	gnCh¬
;

34124 
LPWSTR
 
	gzWideFž’ame
;

34126 
	gnCh¬
 = 
osMuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
zFž’ame
, -1, 
NULL
, 0);

34127 ifÐ
	gnCh¬
==0 ){

34130 
	gzWideFž’ame
 = 
sql™e3M®locZ”o
Ð
nCh¬
*(
zWideFž’ame
[0]) );

34131 ifÐ
	gzWideFž’ame
==0 ){

34134 
	gnCh¬
 = 
osMuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
zFž’ame
, -1, 
zWideFž’ame
,

34135 
nCh¬
);

34136 ifÐ
	gnCh¬
==0 ){

34137 
sql™e3_ä“
(
zWideFž’ame
);

34138 
	gzWideFž’ame
 = 0;

34140  
	gzWideFž’ame
;

34147 *
wšUnicodeToUtf8
(
LPCWSTR
 
zWideFž’ame
){

34148 
	gnBy‹
;

34149 *
	gzFž’ame
;

34151 
	gnBy‹
 = 
osWideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
zWideFž’ame
, -1, 0, 0, 0, 0);

34152 ifÐ
	gnBy‹
 == 0 ){

34155 
	gzFž’ame
 = 
sql™e3M®locZ”o
Ð
nBy‹
 );

34156 ifÐ
	gzFž’ame
==0 ){

34159 
	gnBy‹
 = 
osWideCh¬ToMuÉiBy‹
(
CP_UTF8
, 0, 
zWideFž’ame
, -1, 
zFž’ame
, 
nBy‹
,

34161 ifÐ
	gnBy‹
 == 0 ){

34162 
sql™e3_ä“
(
zFž’ame
);

34163 
	gzFž’ame
 = 0;

34165  
	gzFž’ame
;

34175 
LPWSTR
 
wšMbcsToUnicode
(cÚ¡ *
zFž’ame
){

34176 
	gnBy‹
;

34177 
LPWSTR
 
	gzMbcsFž’ame
;

34178 
	gcod•age
 = 
osA»FžeApisANSI
(è? 
CP_ACP
 : 
CP_OEMCP
;

34180 
	gnBy‹
 = 
osMuÉiBy‹ToWideCh¬
(
cod•age
, 0, 
zFž’ame
, -1, 
NULL
,

34181 0)*(
	gWCHAR
);

34182 ifÐ
	gnBy‹
==0 ){

34185 
	gzMbcsFž’ame
 = 
sql™e3M®locZ”o
Ð
nBy‹
*(
zMbcsFž’ame
[0]) );

34186 ifÐ
	gzMbcsFž’ame
==0 ){

34189 
	gnBy‹
 = 
osMuÉiBy‹ToWideCh¬
(
cod•age
, 0, 
zFž’ame
, -1, 
zMbcsFž’ame
,

34190 
nBy‹
);

34191 ifÐ
	gnBy‹
==0 ){

34192 
sql™e3_ä“
(
zMbcsFž’ame
);

34193 
	gzMbcsFž’ame
 = 0;

34195  
	gzMbcsFž’ame
;

34205 *
wšUnicodeToMbcs
(
LPCWSTR
 
zWideFž’ame
){

34206 
	gnBy‹
;

34207 *
	gzFž’ame
;

34208 
	gcod•age
 = 
osA»FžeApisANSI
(è? 
CP_ACP
 : 
CP_OEMCP
;

34210 
	gnBy‹
 = 
osWideCh¬ToMuÉiBy‹
(
cod•age
, 0, 
zWideFž’ame
, -1, 0, 0, 0, 0);

34211 ifÐ
	gnBy‹
 == 0 ){

34214 
	gzFž’ame
 = 
sql™e3M®locZ”o
Ð
nBy‹
 );

34215 ifÐ
	gzFž’ame
==0 ){

34218 
	gnBy‹
 = 
osWideCh¬ToMuÉiBy‹
(
cod•age
, 0, 
zWideFž’ame
, -1, 
zFž’ame
,

34219 
nBy‹
, 0, 0);

34220 ifÐ
	gnBy‹
 == 0 ){

34221 
sql™e3_ä“
(
zFž’ame
);

34222 
	gzFž’ame
 = 0;

34224  
	gzFž’ame
;

34231 
SQLITE_API
 *
sql™e3_wš32_mbcs_to_utf8
(cÚ¡ *
zFž’ame
){

34232 *
	gzFž’ameUtf8
;

34233 
LPWSTR
 
	gzTmpWide
;

34235 
	gzTmpWide
 = 
wšMbcsToUnicode
(
zFž’ame
);

34236 ifÐ
	gzTmpWide
==0 ){

34239 
	gzFž’ameUtf8
 = 
wšUnicodeToUtf8
(
zTmpWide
);

34240 
sql™e3_ä“
(
zTmpWide
);

34241  
	gzFž’ameUtf8
;

34248 
SQLITE_API
 *
sql™e3_wš32_utf8_to_mbcs
(cÚ¡ *
zFž’ame
){

34249 *
	gzFž’ameMbcs
;

34250 
LPWSTR
 
	gzTmpWide
;

34252 
	gzTmpWide
 = 
wšUtf8ToUnicode
(
zFž’ame
);

34253 ifÐ
	gzTmpWide
==0 ){

34256 
	gzFž’ameMbcs
 = 
wšUnicodeToMbcs
(
zTmpWide
);

34257 
sql™e3_ä“
(
zTmpWide
);

34258  
	gzFž’ameMbcs
;

34268 
SQLITE_API
 
sql™e3_wš32_£t_dœeùÜy
(
DWORD
 
ty³
, 
LPCWSTR
 
zV®ue
){

34269 **
	gµDœeùÜy
 = 0;

34270 #iâdeà
SQLITE_OMIT_AUTOINIT


34271 
	grc
 = 
sql™e3_š™Ÿlize
();

34272 ifÐ
	grc
 ) „c;

34274 ifÐ
	gty³
==
SQLITE_WIN32_DATA_DIRECTORY_TYPE
 ){

34275 
µDœeùÜy
 = &
sql™e3_d©a_dœeùÜy
;

34276 }ifÐ
	gty³
==
SQLITE_WIN32_TEMP_DIRECTORY_TYPE
 ){

34277 
µDœeùÜy
 = &
sql™e3_‹mp_dœeùÜy
;

34279 
as£¹
Ð!
µDœeùÜy
 || 
ty³
==
SQLITE_WIN32_DATA_DIRECTORY_TYPE


34280 || 
ty³
==
SQLITE_WIN32_TEMP_DIRECTORY_TYPE


34282 
as£¹
Ð!
µDœeùÜy
 || 
sql™e3MemdebugHasTy³
(*µDœeùÜy, 
MEMTYPE_HEAP
) );

34283 ifÐ
	gµDœeùÜy
 ){

34284 *
	gzV®ueUtf8
 = 0;

34285 ifÐ
	gzV®ue
 && zValue[0] ){

34286 
	gzV®ueUtf8
 = 
wšUnicodeToUtf8
(
zV®ue
);

34287 iàÐ
	gzV®ueUtf8
==0 ){

34288  
SQLITE_NOMEM
;

34291 
sql™e3_ä“
(*
µDœeùÜy
);

34292 *
	gµDœeùÜy
 = 
zV®ueUtf8
;

34293  
	gSQLITE_OK
;

34295  
	gSQLITE_ERROR
;

34303 
wšG‘La¡E¼ÜMsg
(
DWORD
 
Ï¡E¼no
, 
nBuf
, *
zBuf
){

34308 
DWORD
 
	gdwL’
 = 0;

34309 *
	gzOut
 = 0;

34311 ifÐ
osIsNT
() ){

34312 #ià
SQLITE_OS_WINRT


34313 
WCHAR
 
	gzTempWide
[
SQLITE_WIN32_MAX_ERRMSG_CHARS
+1];

34314 
	gdwL’
 = 
osFÜm©Mes§geW
(
FORMAT_MESSAGE_FROM_SYSTEM
 |

34315 
FORMAT_MESSAGE_IGNORE_INSERTS
,

34316 
NULL
,

34317 
Ï¡E¼no
,

34319 
zTempWide
,

34320 
SQLITE_WIN32_MAX_ERRMSG_CHARS
,

34323 
LPWSTR
 
	gzTempWide
 = 
NULL
;

34324 
	gdwL’
 = 
osFÜm©Mes§geW
(
FORMAT_MESSAGE_ALLOCATE_BUFFER
 |

34325 
FORMAT_MESSAGE_FROM_SYSTEM
 |

34326 
FORMAT_MESSAGE_IGNORE_INSERTS
,

34327 
NULL
,

34328 
Ï¡E¼no
,

34330 (
LPWSTR
è&
zTempWide
,

34334 ifÐ
	gdwL’
 > 0 ){

34336 
sql™e3BegšB’ignM®loc
();

34337 
	gzOut
 = 
wšUnicodeToUtf8
(
zTempWide
);

34338 
sql™e3EndB’ignM®loc
();

34339 #ià!
SQLITE_OS_WINRT


34341 
osLoÿlF»e
(
zTempWide
);

34345 #ifdeà
SQLITE_WIN32_HAS_ANSI


34347 *
	gzTemp
 = 
NULL
;

34348 
	gdwL’
 = 
osFÜm©Mes§geA
(
FORMAT_MESSAGE_ALLOCATE_BUFFER
 |

34349 
FORMAT_MESSAGE_FROM_SYSTEM
 |

34350 
FORMAT_MESSAGE_IGNORE_INSERTS
,

34351 
NULL
,

34352 
Ï¡E¼no
,

34354 (
LPSTR
è&
zTemp
,

34357 ifÐ
	gdwL’
 > 0 ){

34359 
sql™e3BegšB’ignM®loc
();

34360 
	gzOut
 = 
sql™e3_wš32_mbcs_to_utf8
(
zTemp
);

34361 
sql™e3EndB’ignM®loc
();

34363 
osLoÿlF»e
(
zTemp
);

34367 ifÐ0 =ð
dwL’
 ){

34368 
sql™e3_¢´štf
(
nBuf
, 
zBuf
, "OsE¼Ü 0x%lx (%lu)", 
Ï¡E¼no
,†astErrno);

34371 
sql™e3_¢´štf
(
nBuf
, 
zBuf
, "%s", 
zOut
);

34373 
sql™e3_ä“
(
zOut
);

34393 
	#wšLogE¼Ü
(
a
,
b
,
c
,
d
è
	`wšLogE¼ÜAtLše
×,b,c,d,
__LINE__
)

	)

34394 
wšLogE¼ÜAtLše
(

34395 
”rcode
,

34396 
DWORD
 
Ï¡E¼no
,

34397 cÚ¡ *
zFunc
,

34398 cÚ¡ *
zP©h
,

34399 
iLše


34401 
	gzMsg
[500];

34402 
	gi
;

34404 
	gzMsg
[0] = 0;

34405 
wšG‘La¡E¼ÜMsg
(
Ï¡E¼no
, (
zMsg
), zMsg);

34406 
as£¹
Ð
”rcode
!=
SQLITE_OK
 );

34407 ifÐ
	gzP©h
==0 ) 
zP©h
 = "";

34408 
	gi
=0; 
	gzMsg
[
i
] && zMsg[i]!='\r' && 
zMsg
[i]!='\n'; i++){}

34409 
	gzMsg
[
i
] = 0;

34410 
sql™e3_log
(
”rcode
,

34412 
iLše
, 
Ï¡E¼no
, 
zFunc
, 
zP©h
, 
zMsg


34415  
	g”rcode
;

34424 #iâdeà
SQLITE_WIN32_IOERR_RETRY


34425 
	#SQLITE_WIN32_IOERR_RETRY
 10

	)

34427 #iâdeà
SQLITE_WIN32_IOERR_RETRY_DELAY


34428 
	#SQLITE_WIN32_IOERR_RETRY_DELAY
 25

	)

34430 
	gwšIÛ¼R‘ry
 = 
SQLITE_WIN32_IOERR_RETRY
;

34431 
	gwšIÛ¼R‘ryD–ay
 = 
SQLITE_WIN32_IOERR_RETRY_DELAY
;

34449 #ià!
defšed
(
wšIÛ¼CªR‘ry1
)

34450 
	#wšIÛ¼CªR‘ry1
(
a
è((×)==
ERROR_ACCESS_DENIED
) || \

34451 ((
a
)==
ERROR_SHARING_VIOLATION
) || \

34452 ((
a
)==
ERROR_LOCK_VIOLATION
) || \

34453 ((
a
)==
ERROR_DEV_NOT_EXIST
) || \

34454 ((
a
)==
ERROR_NETNAME_DELETED
) || \

34455 ((
a
)==
ERROR_SEM_TIMEOUT
) || \

34456 ((
a
)==
ERROR_NETWORK_UNREACHABLE
))

	)

34464 
wšR‘ryIÛ¼
(*
²R‘ry
, 
DWORD
 *
pE¼Ü
){

34465 
DWORD
 
	ge
 = 
osG‘La¡E¼Ü
();

34466 ifÐ*
	g²R‘ry
>=
wšIÛ¼R‘ry
 ){

34467 ifÐ
pE¼Ü
 ){

34468 *
pE¼Ü
 = 
e
;

34472 ifÐ
wšIÛ¼CªR‘ry1
(
e
) ){

34473 
sql™e3_wš32_¦“p
(
wšIÛ¼R‘ryD–ay
*(1+*
²R‘ry
));

34474 ++*
	g²R‘ry
;

34477 #ià
defšed
(
wšIÛ¼CªR‘ry2
)

34478 ifÐ
wšIÛ¼CªR‘ry2
(
e
) ){

34479 
sql™e3_wš32_¦“p
(
wšIÛ¼R‘ryD–ay
*(1+*
²R‘ry
));

34480 ++*
	g²R‘ry
;

34484 ifÐ
	gpE¼Ü
 ){

34485 *
	gpE¼Ü
 = 
e
;

34493 
wšLogIÛ¼
(
nR‘ry
){

34494 ifÐ
	gnR‘ry
 ){

34495 
sql™e3_log
(
SQLITE_IOERR
,

34497 
wšIÛ¼R‘ryD–ay
*
nR‘ry
*(nRetry+1)/2

34502 #ià
SQLITE_OS_WINCE


34506 #ià!
defšed
(
SQLITE_MSVC_LOCALTIME_API
) || !SQLITE_MSVC_LOCALTIME_API

34512 
tm
 *
__cdeþ
 
loÿÉime
(cÚ¡ 
time_t
 *
t
)

34514 
tm
 
	gy
;

34515 
FILETIME
 
	guTm
, 
	glTm
;

34516 
SYSTEMTIME
 
	gpTm
;

34517 
sql™e3_št64
 
	gt64
;

34518 
	gt64
 = *
t
;

34519 
	gt64
 = (
t64
 + 11644473600)*10000000;

34520 
	guTm
.
	gdwLowD©eTime
 = (
DWORD
)(
t64
 & 0xFFFFFFFF);

34521 
	guTm
.
	gdwHighD©eTime
ð(
DWORD
)(
t64
 >> 32);

34522 
osFžeTimeToLoÿlFžeTime
(&
uTm
,&
lTm
);

34523 
osFžeTimeToSy¡emTime
(&
lTm
,&
pTm
);

34524 
	gy
.
	gtm_y—r
 = 
pTm
.
wY—r
 - 1900;

34525 
	gy
.
	gtm_mÚ
 = 
pTm
.
wMÚth
 - 1;

34526 
	gy
.
	gtm_wday
 = 
pTm
.
wDayOfW“k
;

34527 
	gy
.
	gtm_mday
 = 
pTm
.
wDay
;

34528 
	gy
.
	gtm_hour
 = 
pTm
.
wHour
;

34529 
	gy
.
	gtm_mš
 = 
pTm
.
wMšu‹
;

34530 
	gy
.
	gtm_£c
 = 
pTm
.
wSecÚd
;

34531  &
	gy
;

34535 
	#HANDLE_TO_WINFILE
(
a
è(
wšFže
*)&((*ï)[-()
	`off£tof
(wšFže,
h
)]

	)

34540 
wšûMu‹xAcquœe
(
HANDLE
 
h
){

34541 
DWORD
 
	gdwE¼
;

34543 
	gdwE¼
 = 
osWa™FÜSšgËObjeù
(
h
, 
INFINITE
);

34544 } 
	gdwE¼
 !ð
WAIT_OBJECT_0
 && 
dwE¼
 !ð
WAIT_ABANDONED
);

34549 
	#wšûMu‹xR–—£
(
h
è
	`R–—£Mu‹x
(h)

	)

34555 
wšûC»©eLock
(cÚ¡ *
zFž’ame
, 
wšFže
 *
pFže
){

34556 
LPWSTR
 
	gzTok
;

34557 
LPWSTR
 
	gzName
;

34558 
DWORD
 
	gÏ¡E¼no
;

34559 
BOOL
 
	gbLogged
 = 
FALSE
;

34560 
BOOL
 
	gbIn™
 = 
TRUE
;

34562 
	gzName
 = 
wšUtf8ToUnicode
(
zFž’ame
);

34563 ifÐ
	gzName
==0 ){

34565  
SQLITE_IOERR_NOMEM
;

34569 
mem£t
(&
pFže
->
loÿl
, 0, (pFile->local));

34573 
	gzTok
 = 
osCh¬Low”W
(
zName
);

34574 ;*
	gzTok
;zTok++){

34575 ià(*
	gzTok
 =ð'\\'è*
zTok
 = '_';

34579 
	gpFže
->
	ghMu‹x
 = 
osC»©eMu‹xW
(
NULL
, 
FALSE
, 
zName
);

34580 ià(!
	gpFže
->
	ghMu‹x
){

34581 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

34582 
sql™e3_ä“
(
zName
);

34583  
wšLogE¼Ü
(
SQLITE_IOERR
, 
pFže
->
Ï¡E¼no
,

34584 "wšûC»©eLock1", 
zFž’ame
);

34588 
wšûMu‹xAcquœe
(
pFže
->
hMu‹x
);

34594 
osCh¬Uµ”W
(
zName
);

34595 
	gpFže
->
	ghSh¬ed
 = 
osC»©eFžeM­pšgW
(
INVALID_HANDLE_VALUE
, 
NULL
,

34596 
PAGE_READWRITE
, 0, (
wšûLock
),

34597 
zName
);

34601 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

34602 ià(
	gÏ¡E¼no
 =ð
ERROR_ALREADY_EXISTS
){

34603 
bIn™
 = 
FALSE
;

34606 
sql™e3_ä“
(
zName
);

34609 ifÐ
	gpFže
->
	ghSh¬ed
 ){

34610 
	gpFže
->
	gsh¬ed
 = (
wšûLock
*)
osM­V›wOfFže
(
pFže
->
hSh¬ed
,

34611 
FILE_MAP_READ
|
FILE_MAP_WRITE
, 0, 0, (
wšûLock
));

34613 ifÐ!
	gpFže
->
	gsh¬ed
 ){

34614 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

34615 
wšLogE¼Ü
(
SQLITE_IOERR
, 
pFže
->
Ï¡E¼no
,

34616 "wšûC»©eLock2", 
zFž’ame
);

34617 
	gbLogged
 = 
TRUE
;

34618 
osClo£HªdË
(
pFže
->
hSh¬ed
);

34619 
	gpFže
->
	ghSh¬ed
 = 
NULL
;

34624 ifÐ
	gpFže
->
	ghSh¬ed
==
NULL
 ){

34625 ifÐ!
bLogged
 ){

34626 
pFže
->
Ï¡E¼no
 =†astErrno;

34627 
wšLogE¼Ü
(
SQLITE_IOERR
, 
pFže
->
Ï¡E¼no
,

34628 "wšûC»©eLock3", 
zFž’ame
);

34629 
	gbLogged
 = 
TRUE
;

34631 
wšûMu‹xR–—£
(
pFže
->
hMu‹x
);

34632 
osClo£HªdË
(
pFže
->
hMu‹x
);

34633 
	gpFže
->
	ghMu‹x
 = 
NULL
;

34634  
	gSQLITE_IOERR
;

34638 ifÐ
	gbIn™
 ){

34639 
mem£t
(
pFže
->
sh¬ed
, 0, (
wšûLock
));

34642 
wšûMu‹xR–—£
(
pFže
->
hMu‹x
);

34643  
	gSQLITE_OK
;

34649 
wšûDe¡royLock
(
wšFže
 *
pFže
){

34650 ià(
	gpFže
->
	ghMu‹x
){

34652 
wšûMu‹xAcquœe
(
pFže
->
hMu‹x
);

34656 ià(
	gpFže
->
	gloÿl
.
	gnR—d”s
){

34657 
	gpFže
->
	gsh¬ed
->
	gnR—d”s
 --;

34659 ià(
	gpFže
->
	gloÿl
.
	gbRe£rved
){

34660 
	gpFže
->
	gsh¬ed
->
	gbRe£rved
 = 
FALSE
;

34662 ià(
	gpFže
->
	gloÿl
.
	gbP’dšg
){

34663 
	gpFže
->
	gsh¬ed
->
	gbP’dšg
 = 
FALSE
;

34665 ià(
	gpFže
->
	gloÿl
.
	gbExþusive
){

34666 
	gpFže
->
	gsh¬ed
->
	gbExþusive
 = 
FALSE
;

34670 
osUnm­V›wOfFže
(
pFže
->
sh¬ed
);

34671 
osClo£HªdË
(
pFže
->
hSh¬ed
);

34674 
wšûMu‹xR–—£
(
pFže
->
hMu‹x
);

34675 
osClo£HªdË
(
pFže
->
hMu‹x
);

34676 
	gpFže
->
	ghMu‹x
 = 
NULL
;

34683 
BOOL
 
wšûLockFže
(

34684 
LPHANDLE
 
phFže
,

34685 
DWORD
 
dwFžeOff£tLow
,

34686 
DWORD
 
dwFžeOff£tHigh
,

34687 
DWORD
 
nNumb”OfBy‹sToLockLow
,

34688 
DWORD
 
nNumb”OfBy‹sToLockHigh


34690 
wšFže
 *
	gpFže
 = 
HANDLE_TO_WINFILE
(
phFže
);

34691 
BOOL
 
	gbR‘uº
 = 
FALSE
;

34693 
UNUSED_PARAMETER
(
dwFžeOff£tHigh
);

34694 
UNUSED_PARAMETER
(
nNumb”OfBy‹sToLockHigh
);

34696 ià(!
	gpFže
->
	ghMu‹x
è 
	gTRUE
;

34697 
wšûMu‹xAcquœe
(
pFže
->
hMu‹x
);

34700 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
SHARED_FIRST


34701 && 
nNumb”OfBy‹sToLockLow
 =ð(
DWORD
)
SHARED_SIZE
){

34702 ià(
pFže
->
sh¬ed
->
nR—d”s
 =ð0 &&…Fže->sh¬ed->
bExþusive
 == 0){

34703 
pFže
->
sh¬ed
->
bExþusive
 = 
TRUE
;

34704 
	gpFže
->
	gloÿl
.
	gbExþusive
 = 
TRUE
;

34705 
	gbR‘uº
 = 
TRUE
;

34710 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
SHARED_FIRST
 &&

34711 
nNumb”OfBy‹sToLockLow
 == 1){

34712 ià(
pFže
->
sh¬ed
->
bExþusive
 == 0){

34713 
pFže
->
loÿl
.
nR—d”s
 ++;

34714 ià(
	gpFže
->
	gloÿl
.
	gnR—d”s
 == 1){

34715 
pFže
->
sh¬ed
->
nR—d”s
 ++;

34717 
	gbR‘uº
 = 
TRUE
;

34722 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
PENDING_BYTE


34723 && 
nNumb”OfBy‹sToLockLow
 == 1){

34725 ià(
pFže
->
sh¬ed
->
bP’dšg
 == 0) {

34726 
pFže
->
sh¬ed
->
bP’dšg
 = 
TRUE
;

34727 
	gpFže
->
	gloÿl
.
	gbP’dšg
 = 
TRUE
;

34728 
	gbR‘uº
 = 
TRUE
;

34733 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
RESERVED_BYTE


34734 && 
nNumb”OfBy‹sToLockLow
 == 1){

34735 ià(
pFže
->
sh¬ed
->
bRe£rved
 == 0) {

34736 
pFže
->
sh¬ed
->
bRe£rved
 = 
TRUE
;

34737 
	gpFže
->
	gloÿl
.
	gbRe£rved
 = 
TRUE
;

34738 
	gbR‘uº
 = 
TRUE
;

34742 
wšûMu‹xR–—£
(
pFže
->
hMu‹x
);

34743  
	gbR‘uº
;

34749 
BOOL
 
wšûUÆockFže
(

34750 
LPHANDLE
 
phFže
,

34751 
DWORD
 
dwFžeOff£tLow
,

34752 
DWORD
 
dwFžeOff£tHigh
,

34753 
DWORD
 
nNumb”OfBy‹sToUÆockLow
,

34754 
DWORD
 
nNumb”OfBy‹sToUÆockHigh


34756 
wšFže
 *
	gpFže
 = 
HANDLE_TO_WINFILE
(
phFže
);

34757 
BOOL
 
	gbR‘uº
 = 
FALSE
;

34759 
UNUSED_PARAMETER
(
dwFžeOff£tHigh
);

34760 
UNUSED_PARAMETER
(
nNumb”OfBy‹sToUÆockHigh
);

34762 ià(!
	gpFže
->
	ghMu‹x
è 
	gTRUE
;

34763 
wšûMu‹xAcquœe
(
pFže
->
hMu‹x
);

34766 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
SHARED_FIRST
){

34768 ià(
pFže
->
loÿl
.
bExþusive
){

34769 
as£¹
(
nNumb”OfBy‹sToUÆockLow
 =ð(
DWORD
)
SHARED_SIZE
);

34770 
	gpFže
->
	gloÿl
.
	gbExþusive
 = 
FALSE
;

34771 
	gpFže
->
	gsh¬ed
->
	gbExþusive
 = 
FALSE
;

34772 
	gbR‘uº
 = 
TRUE
;

34776 ià(
	gpFže
->
	gloÿl
.
	gnR—d”s
){

34777 
as£¹
(
nNumb”OfBy‹sToUÆockLow
 =ð(
DWORD
)
SHARED_SIZE


34778 || 
nNumb”OfBy‹sToUÆockLow
 == 1);

34779 
	gpFže
->
	gloÿl
.
	gnR—d”s
 --;

34780 ià(
	gpFže
->
	gloÿl
.
	gnR—d”s
 == 0)

34782 
pFže
->
sh¬ed
->
nR—d”s
 --;

34784 
	gbR‘uº
 = 
TRUE
;

34789 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
PENDING_BYTE


34790 && 
nNumb”OfBy‹sToUÆockLow
 == 1){

34791 ià(
pFže
->
loÿl
.
bP’dšg
){

34792 
pFže
->
loÿl
.
bP’dšg
 = 
FALSE
;

34793 
	gpFže
->
	gsh¬ed
->
	gbP’dšg
 = 
FALSE
;

34794 
	gbR‘uº
 = 
TRUE
;

34798 ià(
	gdwFžeOff£tLow
 =ð(
DWORD
)
RESERVED_BYTE


34799 && 
nNumb”OfBy‹sToUÆockLow
 == 1){

34800 ià(
pFže
->
loÿl
.
bRe£rved
) {

34801 
pFže
->
loÿl
.
bRe£rved
 = 
FALSE
;

34802 
	gpFže
->
	gsh¬ed
->
	gbRe£rved
 = 
FALSE
;

34803 
	gbR‘uº
 = 
TRUE
;

34807 
wšûMu‹xR–—£
(
pFže
->
hMu‹x
);

34808  
	gbR‘uº
;

34818 
BOOL
 
wšLockFže
(

34819 
LPHANDLE
 
phFže
,

34820 
DWORD
 
æags
,

34821 
DWORD
 
off£tLow
,

34822 
DWORD
 
off£tHigh
,

34823 
DWORD
 
numBy‹sLow
,

34824 
DWORD
 
numBy‹sHigh


34826 #ià
SQLITE_OS_WINCE


34831  
wšûLockFže
(
phFže
, 
off£tLow
, 
off£tHigh
,

34832 
numBy‹sLow
, 
numBy‹sHigh
);

34834 ifÐ
osIsNT
() ){

34835 
OVERLAPPED
 
	govÍ
;

34836 
mem£t
(&
ovÍ
, 0, (
OVERLAPPED
));

34837 
	govÍ
.
	gOff£t
 = 
off£tLow
;

34838 
	govÍ
.
	gOff£tHigh
 = 
off£tHigh
;

34839  
osLockFžeEx
(*
phFže
, 
æags
, 0, 
numBy‹sLow
, 
numBy‹sHigh
, &
ovÍ
);

34841  
osLockFže
(*
phFže
, 
off£tLow
, 
off£tHigh
, 
numBy‹sLow
,

34842 
numBy‹sHigh
);

34850 
BOOL
 
wšUÆockFže
(

34851 
LPHANDLE
 
phFže
,

34852 
DWORD
 
off£tLow
,

34853 
DWORD
 
off£tHigh
,

34854 
DWORD
 
numBy‹sLow
,

34855 
DWORD
 
numBy‹sHigh


34857 #ià
SQLITE_OS_WINCE


34862  
wšûUÆockFže
(
phFže
, 
off£tLow
, 
off£tHigh
,

34863 
numBy‹sLow
, 
numBy‹sHigh
);

34865 ifÐ
osIsNT
() ){

34866 
OVERLAPPED
 
	govÍ
;

34867 
mem£t
(&
ovÍ
, 0, (
OVERLAPPED
));

34868 
	govÍ
.
	gOff£t
 = 
off£tLow
;

34869 
	govÍ
.
	gOff£tHigh
 = 
off£tHigh
;

34870  
osUÆockFžeEx
(*
phFže
, 0, 
numBy‹sLow
, 
numBy‹sHigh
, &
ovÍ
);

34872  
osUÆockFže
(*
phFže
, 
off£tLow
, 
off£tHigh
, 
numBy‹sLow
,

34873 
numBy‹sHigh
);

34886 #iâdeà
INVALID_SET_FILE_POINTER


34887 
	#INVALID_SET_FILE_POINTER
 ((
DWORD
)-1)

	)

34895 
wšS“kFže
(
wšFže
 *
pFže
, 
sql™e3_št64
 
iOff£t
){

34896 #ià!
SQLITE_OS_WINRT


34897 
LONG
 
	guµ”B™s
;

34898 
LONG
 
	glow”B™s
;

34899 
DWORD
 
	gdwR‘
;

34900 
DWORD
 
	gÏ¡E¼no
;

34902 
OSTRACE
(("SEEK fže=%p, off£t=%Îd\n", 
pFže
->
h
, 
iOff£t
));

34904 
	guµ”B™s
 = (
LONG
)((
iOff£t
>>32) & 0x7fffffff);

34905 
	glow”B™s
 = (
LONG
)(
iOff£t
 & 0xffffffff);

34914 
	gdwR‘
 = 
osS‘FžePoš‹r
(
pFže
->
h
, 
low”B™s
, &
uµ”B™s
, 
FILE_BEGIN
);

34916 ifÐ(
	gdwR‘
==
INVALID_SET_FILE_POINTER


34917 && ((
Ï¡E¼no
 = 
osG‘La¡E¼Ü
())!=
NO_ERROR
)) ){

34918 
pFže
->
Ï¡E¼no
 =†astErrno;

34919 
wšLogE¼Ü
(
SQLITE_IOERR_SEEK
, 
pFže
->
Ï¡E¼no
,

34920 "wšS“kFže", 
pFže
->
zP©h
);

34921 
OSTRACE
(("SEEK fže=%p,„c=SQLITE_IOERR_SEEK\n", 
pFže
->
h
));

34925 
OSTRACE
(("SEEK fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

34932 
LARGE_INTEGER
 
	gx
;

34933 
BOOL
 
	gbR‘
;

34935 
	gx
.
	gQuadP¬t
 = 
iOff£t
;

34936 
	gbR‘
 = 
osS‘FžePoš‹rEx
(
pFže
->
h
, 
x
, 0, 
FILE_BEGIN
);

34938 if(!
	gbR‘
){

34939 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

34940 
wšLogE¼Ü
(
SQLITE_IOERR_SEEK
, 
pFže
->
Ï¡E¼no
,

34941 "wšS“kFže", 
pFže
->
zP©h
);

34942 
OSTRACE
(("SEEK fže=%p,„c=SQLITE_IOERR_SEEK\n", 
pFže
->
h
));

34946 
OSTRACE
(("SEEK fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

34951 #ià
SQLITE_MAX_MMAP_SIZE
>0

34953 
wšM­fže
(
wšFže
*, 
sql™e3_št64
);

34954 
wšUnm­fže
(
wšFže
*);

34967 
	#MX_CLOSE_ATTEMPT
 3

	)

34968 
wšClo£
(
sql™e3_fže
 *
id
){

34969 
	grc
, 
	gút
 = 0;

34970 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

34972 
as£¹
Ð
id
!=0 );

34973 #iâdeà
SQLITE_OMIT_WAL


34974 
as£¹
Ð
pFže
->
pShm
==0 );

34976 
as£¹
Ð
pFže
->
h
!=
NULL
 &&…Fže->h!=
INVALID_HANDLE_VALUE
 );

34977 
OSTRACE
(("CLOSE fže=%p\n", 
pFže
->
h
));

34979 #ià
SQLITE_MAX_MMAP_SIZE
>0

34980 
wšUnm­fže
(
pFže
);

34984 
	grc
 = 
osClo£HªdË
(
pFže
->
h
);

34986 } 
	grc
==0 && ++
út
 < 
MX_CLOSE_ATTEMPT
 && (
sql™e3_wš32_¦“p
(100), 1) );

34987 #ià
SQLITE_OS_WINCE


34988 
	#WINCE_DELETION_ATTEMPTS
 3

	)

34989 
wšûDe¡royLock
(
pFže
);

34990 ifÐ
	gpFže
->
	gzD–‘eOnClo£
 ){

34991 
	gút
 = 0;

34993 
osD–‘eFžeW
(
pFže
->
zD–‘eOnClo£
)==0

34994 && 
osG‘FžeA‰ribu‹sW
(
pFže
->
zD–‘eOnClo£
)!=0xffffffff

34995 && 
út
++ < 
WINCE_DELETION_ATTEMPTS


34997 
sql™e3_wš32_¦“p
(100);

34999 
sql™e3_ä“
(
pFže
->
zD–‘eOnClo£
);

35002 ifÐ
	grc
 ){

35003 
	gpFže
->
	gh
 = 
NULL
;

35005 
O³nCouÁ”
(-1);

35006 
OSTRACE
(("CLOSE fže=%p,„c=%s\n", 
pFže
->
h
, 
rc
 ? "ok" : "failed"));

35007  
	grc
 ? 
	gSQLITE_OK


35008 : 
wšLogE¼Ü
(
SQLITE_IOERR_CLOSE
, 
osG‘La¡E¼Ü
(),

35009 "wšClo£", 
pFže
->
zP©h
);

35017 
wšR—d
(

35018 
sql™e3_fže
 *
id
,

35019 *
pBuf
,

35020 
amt
,

35021 
sql™e3_št64
 
off£t


35023 #ià!
SQLITE_OS_WINCE


35024 
OVERLAPPED
 
	gov”Ïµed
;

35026 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35027 
DWORD
 
	gnR—d
;

35028 
	gnR‘ry
 = 0;

35030 
as£¹
Ð
id
!=0 );

35031 
as£¹
Ð
amt
>0 );

35032 
as£¹
Ð
off£t
>=0 );

35033 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_READ
);

35034 
OSTRACE
(("READ file=%p, buffer=%p,‡mount=%d, offset=%lld,†ock=%d\n",

35035 
pFže
->
h
, 
pBuf
, 
amt
, 
off£t
,…Fže->
lockty³
));

35037 #ià
SQLITE_MAX_MMAP_SIZE
>0

35040 ifÐ
	goff£t
<
	gpFže
->
	gmm­Size
 ){

35041 ifÐ
	goff£t
+
	gamt
 <ð
pFže
->
mm­Size
 ){

35042 
memýy
(
pBuf
, &((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
amt
);

35043 
OSTRACE
(("READ-MMAP fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35044  
	gSQLITE_OK
;

35046 
	gnCÝy
 = ()(
pFže
->
mm­Size
 - 
off£t
);

35047 
memýy
(
pBuf
, &((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
nCÝy
);

35048 
	gpBuf
 = &((
u8
 *)
pBuf
)[
nCÝy
];

35049 
	gamt
 -ð
nCÝy
;

35050 
	goff£t
 +ð
nCÝy
;

35055 #ià
SQLITE_OS_WINCE


35056 ifÐ
wšS“kFže
(
pFže
, 
off£t
) ){

35057 
OSTRACE
(("READ fže=%p,„c=SQLITE_FULL\n", 
pFže
->
h
));

35058  
	gSQLITE_FULL
;

35060  !
osR—dFže
(
pFže
->
h
, 
pBuf
, 
amt
, &
nR—d
, 0) ){

35062 
mem£t
(&
ov”Ïµed
, 0, (
OVERLAPPED
));

35063 
	gov”Ïµed
.
	gOff£t
 = (
LONG
)(
off£t
 & 0xffffffff);

35064 
	gov”Ïµed
.
	gOff£tHigh
 = (
LONG
)((
off£t
>>32) & 0x7fffffff);

35065  !
osR—dFže
(
pFže
->
h
, 
pBuf
, 
amt
, &
nR—d
, &
ov”Ïµed
) &&

35066 
osG‘La¡E¼Ü
()!=
ERROR_HANDLE_EOF
 ){

35068 
DWORD
 
Ï¡E¼no
;

35069 ifÐ
wšR‘ryIÛ¼
(&
nR‘ry
, &
Ï¡E¼no
) ) ;

35070 
	gpFže
->
	gÏ¡E¼no
 = 
Ï¡E¼no
;

35071 
OSTRACE
(("READ fže=%p,„c=SQLITE_IOERR_READ\n", 
pFže
->
h
));

35072  
wšLogE¼Ü
(
SQLITE_IOERR_READ
, 
pFže
->
Ï¡E¼no
,

35073 "wšR—d", 
pFže
->
zP©h
);

35075 
wšLogIÛ¼
(
nR‘ry
);

35076 ifÐ
	gnR—d
<(
	gDWORD
)
	gamt
 ){

35078 
mem£t
(&((*)
pBuf
)[
nR—d
], 0, 
amt
-nRead);

35079 
OSTRACE
(("READ fže=%p,„c=SQLITE_IOERR_SHORT_READ\n", 
pFže
->
h
));

35080  
	gSQLITE_IOERR_SHORT_READ
;

35083 
OSTRACE
(("READ fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35084  
	gSQLITE_OK
;

35091 
wšWr™e
(

35092 
sql™e3_fže
 *
id
,

35093 cÚ¡ *
pBuf
,

35094 
amt
,

35095 
sql™e3_št64
 
off£t


35097 
	grc
 = 0;

35098 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35099 
	gnR‘ry
 = 0;

35101 
as£¹
Ð
amt
>0 );

35102 
as£¹
Ð
pFže
 );

35103 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_WRITE
);

35104 
SimuÏ‹DiskfuÎE¼Ü
( 
SQLITE_FULL
);

35106 
OSTRACE
(("WRITE file=%p, buffer=%p,‡mount=%d, offset=%lld,†ock=%d\n",

35107 
pFže
->
h
, 
pBuf
, 
amt
, 
off£t
,…Fže->
lockty³
));

35109 #ià
SQLITE_MAX_MMAP_SIZE
>0

35112 ifÐ
	goff£t
<
	gpFže
->
	gmm­Size
 ){

35113 ifÐ
	goff£t
+
	gamt
 <ð
pFže
->
mm­Size
 ){

35114 
memýy
(&((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
pBuf
, 
amt
);

35115 
OSTRACE
(("WRITE-MMAP fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35116  
	gSQLITE_OK
;

35118 
	gnCÝy
 = ()(
pFže
->
mm­Size
 - 
off£t
);

35119 
memýy
(&((
u8
 *)(
pFže
->
pM­RegiÚ
))[
off£t
], 
pBuf
, 
nCÝy
);

35120 
	gpBuf
 = &((
u8
 *)
pBuf
)[
nCÝy
];

35121 
	gamt
 -ð
nCÝy
;

35122 
	goff£t
 +ð
nCÝy
;

35127 #ià
SQLITE_OS_WINCE


35128 
	grc
 = 
wšS“kFže
(
pFže
, 
off£t
);

35129 ifÐ
	grc
==0 ){

35133 #ià!
SQLITE_OS_WINCE


35134 
OVERLAPPED
 
ov”Ïµed
;

35136 
u8
 *
	gaRem
 = (u8 *)
pBuf
;

35137 
	gnRem
 = 
amt
;

35138 
DWORD
 
	gnWr™e
;

35139 
DWORD
 
	gÏ¡E¼no
 = 
NO_ERROR
;

35141 #ià!
SQLITE_OS_WINCE


35142 
mem£t
(&
ov”Ïµed
, 0, (
OVERLAPPED
));

35143 
	gov”Ïµed
.
	gOff£t
 = (
LONG
)(
off£t
 & 0xffffffff);

35144 
	gov”Ïµed
.
	gOff£tHigh
 = (
LONG
)((
off£t
>>32) & 0x7fffffff);

35147  
	gnRem
>0 ){

35148 #ià
SQLITE_OS_WINCE


35149 ifÐ!
osWr™eFže
(
pFže
->
h
, 
aRem
, 
nRem
, &
nWr™e
, 0) ){

35151 ifÐ!
osWr™eFže
(
pFže
->
h
, 
aRem
, 
nRem
, &
nWr™e
, &
ov”Ïµed
) ){

35153 ifÐ
wšR‘ryIÛ¼
(&
nR‘ry
, &
Ï¡E¼no
) ) ;

35156 
as£¹
Ð
nWr™e
==0 ||‚Wr™e<=(
DWORD
)
nRem
 );

35157 ifÐ
	gnWr™e
==0 || 
nWr™e
>(
DWORD
)
nRem
 ){

35158 
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

35161 #ià!
SQLITE_OS_WINCE


35162 
	goff£t
 +ð
nWr™e
;

35163 
	gov”Ïµed
.
	gOff£t
 = (
LONG
)(
off£t
 & 0xffffffff);

35164 
	gov”Ïµed
.
	gOff£tHigh
 = (
LONG
)((
off£t
>>32) & 0x7fffffff);

35166 
	gaRem
 +ð
nWr™e
;

35167 
	gnRem
 -ð
nWr™e
;

35169 ifÐ
	gnRem
>0 ){

35170 
	gpFže
->
	gÏ¡E¼no
 = 
Ï¡E¼no
;

35171 
	grc
 = 1;

35175 ifÐ
	grc
 ){

35176 ifÐÐ
	gpFže
->
	gÏ¡E¼no
==
ERROR_HANDLE_DISK_FULL
 )

35177 || ( 
pFže
->
Ï¡E¼no
==
ERROR_DISK_FULL
 )){

35178 
OSTRACE
(("WRITE fže=%p,„c=SQLITE_FULL\n", 
pFže
->
h
));

35179  
wšLogE¼Ü
(
SQLITE_FULL
, 
pFže
->
Ï¡E¼no
,

35180 "wšWr™e1", 
pFže
->
zP©h
);

35182 
OSTRACE
(("WRITE fže=%p,„c=SQLITE_IOERR_WRITE\n", 
pFže
->
h
));

35183  
wšLogE¼Ü
(
SQLITE_IOERR_WRITE
, 
pFže
->
Ï¡E¼no
,

35184 "wšWr™e2", 
pFže
->
zP©h
);

35186 
wšLogIÛ¼
(
nR‘ry
);

35188 
OSTRACE
(("WRITE fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35189  
	gSQLITE_OK
;

35195 
wšTrunÿ‹
(
sql™e3_fže
 *
id
, 
sql™e3_št64
 
nBy‹
){

35196 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35197 
	grc
 = 
SQLITE_OK
;

35198 
DWORD
 
	gÏ¡E¼no
;

35200 
as£¹
Ð
pFže
 );

35201 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_TRUNCATE
);

35202 
OSTRACE
(("TRUNCATE file=%p, size=%lld,†ock=%d\n",

35203 
pFže
->
h
, 
nBy‹
,…Fže->
lockty³
));

35210 ifÐ
	gpFže
->
	gszChunk
>0 ){

35211 
	gnBy‹
 = ((
nBy‹
 + 
pFže
->
szChunk
 - 1)/pFile->szChunk) *…File->szChunk;

35215 ifÐ
wšS“kFže
(
pFže
, 
nBy‹
) ){

35216 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_TRUNCATE
, 
pFže
->
Ï¡E¼no
,

35217 "wšTrunÿ‹1", 
pFže
->
zP©h
);

35218 }ifÐ0==
osS‘EndOfFže
(
pFže
->
h
) &&

35219 ((
Ï¡E¼no
 = 
osG‘La¡E¼Ü
())!=
ERROR_USER_MAPPED_FILE
) ){

35220 
pFže
->
Ï¡E¼no
 =†astErrno;

35221 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_TRUNCATE
, 
pFže
->
Ï¡E¼no
,

35222 "wšTrunÿ‹2", 
pFže
->
zP©h
);

35225 #ià
SQLITE_MAX_MMAP_SIZE
>0

35230 ifÐ
	gpFže
->
	gpM­RegiÚ
 && 
	gnBy‹
<pFže->
	gmm­Size
 ){

35231 
	gpFže
->
	gmm­Size
 = 
nBy‹
;

35235 
OSTRACE
(("TRUNCATE fže=%p,„c=%s\n", 
pFže
->
h
, 
sql™e3E¼Name
(
rc
)));

35236  
	grc
;

35239 #ifdeà
SQLITE_TEST


35244 
SQLITE_API
 
	gsql™e3_sync_couÁ
 = 0;

35245 
SQLITE_API
 
	gsql™e3_fuÎsync_couÁ
 = 0;

35251 
wšSync
(
sql™e3_fže
 *
id
, 
æags
){

35252 #iâdeà
SQLITE_NO_SYNC


35256 
BOOL
 
	grc
;

35258 #ià!
defšed
(
NDEBUG
è|| !defšed(
SQLITE_NO_SYNC
) || \

35259 (
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
))

35264 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35266 
UNUSED_PARAMETER
(
id
);

35269 
as£¹
Ð
pFže
 );

35271 
as£¹
((
æags
&0x0F)==
SQLITE_SYNC_NORMAL


35272 || (
æags
&0x0F)==
SQLITE_SYNC_FULL


35278 
SimuÏ‹DiskfuÎE¼Ü
Ð 
SQLITE_FULL
 );

35280 
OSTRACE
(("SYNC file=%p, flags=%x,†ock=%d\n",

35281 
pFže
->
h
, 
æags
,…Fže->
lockty³
));

35283 #iâdeà
SQLITE_TEST


35284 
UNUSED_PARAMETER
(
æags
);

35286 ifÐ(
	gæags
&0x0F)==
SQLITE_SYNC_FULL
 ){

35287 
sql™e3_fuÎsync_couÁ
++;

35289 
	gsql™e3_sync_couÁ
++;

35295 #ifdeà
SQLITE_NO_SYNC


35296 
OSTRACE
(("SYNC-NOP fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35297  
	gSQLITE_OK
;

35299 
	grc
 = 
osFlushFžeBufãrs
(
pFže
->
h
);

35300 
SimuÏ‹IOE¼Ü
Ð
rc
=
FALSE
 );

35301 ifÐ
	grc
 ){

35302 
OSTRACE
(("SYNC fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35303  
	gSQLITE_OK
;

35305 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35306 
OSTRACE
(("SYNC fže=%p,„c=SQLITE_IOERR_FSYNC\n", 
pFže
->
h
));

35307  
wšLogE¼Ü
(
SQLITE_IOERR_FSYNC
, 
pFže
->
Ï¡E¼no
,

35308 "wšSync", 
pFže
->
zP©h
);

35316 
wšFžeSize
(
sql™e3_fže
 *
id
, 
sql™e3_št64
 *
pSize
){

35317 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35318 
	grc
 = 
SQLITE_OK
;

35320 
as£¹
Ð
id
!=0 );

35321 
as£¹
Ð
pSize
!=0 );

35322 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_FSTAT
);

35323 
OSTRACE
(("SIZE fže=%p,…Size=%p\n", 
pFže
->
h
, 
pSize
));

35325 #ià
SQLITE_OS_WINRT


35327 
FILE_STANDARD_INFO
 
	gšfo
;

35328 ifÐ
osG‘FžeInfÜm©iÚByHªdËEx
(
pFže
->
h
, 
FžeSnd¬dInfo
,

35329 &
šfo
, (info)) ){

35330 *
	gpSize
 = 
šfo
.
EndOfFže
.
QuadP¬t
;

35332 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35333 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_FSTAT
, 
pFže
->
Ï¡E¼no
,

35334 "wšFžeSize", 
pFže
->
zP©h
);

35339 
DWORD
 
	guµ”B™s
;

35340 
DWORD
 
	glow”B™s
;

35341 
DWORD
 
	gÏ¡E¼no
;

35343 
	glow”B™s
 = 
osG‘FžeSize
(
pFže
->
h
, &
uµ”B™s
);

35344 *
	gpSize
 = (((
sql™e3_št64
)
uµ”B™s
)<<32è+ 
low”B™s
;

35345 ifÐ(
	glow”B™s
 =ð
INVALID_FILE_SIZE
)

35346 && ((
Ï¡E¼no
 = 
osG‘La¡E¼Ü
())!=
NO_ERROR
) ){

35347 
pFže
->
Ï¡E¼no
 =†astErrno;

35348 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_FSTAT
, 
pFže
->
Ï¡E¼no
,

35349 "wšFžeSize", 
pFže
->
zP©h
);

35353 
OSTRACE
(("SIZE file=%p,…Size=%p, *pSize=%lld,„c=%s\n",

35354 
pFže
->
h
, 
pSize
, *pSize, 
sql™e3E¼Name
(
rc
)));

35355  
	grc
;

35361 #iâdeà
LOCKFILE_FAIL_IMMEDIATELY


35362 
	#LOCKFILE_FAIL_IMMEDIATELY
 1

	)

35365 #iâdeà
LOCKFILE_EXCLUSIVE_LOCK


35366 
	#LOCKFILE_EXCLUSIVE_LOCK
 2

	)

35376 #iâdeà
SQLITE_LOCKFILE_FLAGS


35377 
	#SQLITE_LOCKFILE_FLAGS
 (
LOCKFILE_FAIL_IMMEDIATELY
 | \

35378 
LOCKFILE_EXCLUSIVE_LOCK
)

	)

35385 #iâdeà
SQLITE_LOCKFILEEX_FLAGS


35386 
	#SQLITE_LOCKFILEEX_FLAGS
 (
LOCKFILE_FAIL_IMMEDIATELY
)

	)

35394 
wšG‘R—dLock
(
wšFže
 *
pFže
){

35395 
	g»s
;

35396 
OSTRACE
(("READ-LOCK fže=%p,†ock=%d\n", 
pFže
->
h
,…Fže->
lockty³
));

35397 ifÐ
osIsNT
() ){

35398 #ià
SQLITE_OS_WINCE


35403 
	g»s
 = 
wšûLockFže
(&
pFže
->
h
, 
SHARED_FIRST
, 0, 1, 0);

35405 
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILEEX_FLAGS
, 
SHARED_FIRST
, 0,

35406 
SHARED_SIZE
, 0);

35409 #ifdeà
SQLITE_WIN32_HAS_ANSI


35411 
	glk
;

35412 
sql™e3_¿ndomÃss
((
lk
), &lk);

35413 
	gpFže
->
	gsh¬edLockBy‹
 = ()((
lk
 & 0x7fffffff)%(
SHARED_SIZE
 - 1));

35414 
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILE_FLAGS
,

35415 
SHARED_FIRST
+
pFže
->
sh¬edLockBy‹
, 0, 1, 0);

35418 ifÐ
	g»s
 == 0 ){

35419 
pFže
->
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

35422 
OSTRACE
(("READ-LOCK fže=%p,„esuÉ=%d\n", 
pFže
->
h
, 
»s
));

35423  
	g»s
;

35429 
wšUÆockR—dLock
(
wšFže
 *
pFže
){

35430 
	g»s
;

35431 
DWORD
 
	gÏ¡E¼no
;

35432 
OSTRACE
(("READ-UNLOCK fže=%p,†ock=%d\n", 
pFže
->
h
,…Fže->
lockty³
));

35433 ifÐ
osIsNT
() ){

35434 
	g»s
 = 
wšUÆockFže
(&
pFže
->
h
, 
SHARED_FIRST
, 0, 
SHARED_SIZE
, 0);

35436 #ifdeà
SQLITE_WIN32_HAS_ANSI


35438 
	g»s
 = 
wšUÆockFže
(&
pFže
->
h
, 
SHARED_FIRST
+pFže->
sh¬edLockBy‹
, 0, 1, 0);

35441 ifÐ
	g»s
==0 && ((
Ï¡E¼no
 = 
osG‘La¡E¼Ü
())!=
ERROR_NOT_LOCKED
) ){

35442 
pFže
->
Ï¡E¼no
 =†astErrno;

35443 
wšLogE¼Ü
(
SQLITE_IOERR_UNLOCK
, 
pFže
->
Ï¡E¼no
,

35444 "wšUÆockR—dLock", 
pFže
->
zP©h
);

35446 
OSTRACE
(("READ-UNLOCK fže=%p,„esuÉ=%d\n", 
pFže
->
h
, 
»s
));

35447  
	g»s
;

35476 
wšLock
(
sql™e3_fže
 *
id
, 
lockty³
){

35477 
	grc
 = 
SQLITE_OK
;

35478 
	g»s
 = 1;

35479 
	gÃwLockty³
;

35480 
	ggÙP’dšgLock
 = 0;

35481 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35482 
DWORD
 
	gÏ¡E¼no
 = 
NO_ERROR
;

35484 
as£¹
Ð
id
!=0 );

35485 
OSTRACE
(("LOCK file=%p, oldLock=%d(%d),‚ewLock=%d\n",

35486 
pFže
->
h
,…Fže->
lockty³
,…Fže->
sh¬edLockBy‹
,†ocktype));

35492 ifÐ
	gpFže
->
	glockty³
>=
lockty³
 ){

35493 
OSTRACE
(("LOCK-HELD fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35494  
	gSQLITE_OK
;

35499 
as£¹
Ð
pFže
->
lockty³
!=
NO_LOCK
 ||†ockty³==
SHARED_LOCK
 );

35500 
as£¹
Ð
lockty³
!=
PENDING_LOCK
 );

35501 
as£¹
Ð
lockty³
!=
RESERVED_LOCK
 || 
pFže
->lockty³==
SHARED_LOCK
 );

35507 
	gÃwLockty³
 = 
pFže
->
lockty³
;

35508 ifÐ(
	gpFže
->
	glockty³
==
NO_LOCK
)

35509 || ( (
lockty³
==
EXCLUSIVE_LOCK
)

35510 && (
pFže
->
lockty³
==
RESERVED_LOCK
))

35512 
út
 = 3;

35513  
	gút
-->0 && (
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILE_FLAGS
,

35514 
PENDING_BYTE
, 0, 1, 0))==0 ){

35521 
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

35522 
OSTRACE
(("LOCK-PENDING-FAIL file=%p, count=%d,„esult=%d\n",

35523 
pFže
->
h
, 
út
, 
»s
));

35524 ifÐ
	gÏ¡E¼no
==
ERROR_INVALID_HANDLE
 ){

35525 
pFže
->
Ï¡E¼no
 =†astErrno;

35526 
	grc
 = 
SQLITE_IOERR_LOCK
;

35527 
OSTRACE
(("LOCK-FAIL file=%p, count=%d,„c=%s\n",

35528 
pFže
->
h
, 
út
, 
sql™e3E¼Name
(
rc
)));

35529  
	grc
;

35531 ifÐ
	gút
 ) 
sql™e3_wš32_¦“p
(1);

35533 
	ggÙP’dšgLock
 = 
»s
;

35534 ifÐ!
	g»s
 ){

35535 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35541 ifÐ
	glockty³
==
SHARED_LOCK
 && 
»s
 ){

35542 
as£¹
Ð
pFže
->
lockty³
==
NO_LOCK
 );

35543 
	g»s
 = 
wšG‘R—dLock
(
pFže
);

35544 ifÐ
	g»s
 ){

35545 
	gÃwLockty³
 = 
SHARED_LOCK
;

35547 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35553 ifÐ
	glockty³
==
RESERVED_LOCK
 && 
»s
 ){

35554 
as£¹
Ð
pFže
->
lockty³
==
SHARED_LOCK
 );

35555 
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILE_FLAGS
, 
RESERVED_BYTE
, 0, 1, 0);

35556 ifÐ
	g»s
 ){

35557 
	gÃwLockty³
 = 
RESERVED_LOCK
;

35559 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35565 ifÐ
	glockty³
==
EXCLUSIVE_LOCK
 && 
»s
 ){

35566 
ÃwLockty³
 = 
PENDING_LOCK
;

35567 
	ggÙP’dšgLock
 = 0;

35572 ifÐ
	glockty³
==
EXCLUSIVE_LOCK
 && 
»s
 ){

35573 
as£¹
Ð
pFže
->
lockty³
>=
SHARED_LOCK
 );

35574 
	g»s
 = 
wšUÆockR—dLock
(
pFže
);

35575 
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILE_FLAGS
, 
SHARED_FIRST
, 0,

35576 
SHARED_SIZE
, 0);

35577 ifÐ
	g»s
 ){

35578 
	gÃwLockty³
 = 
EXCLUSIVE_LOCK
;

35580 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35581 
wšG‘R—dLock
(
pFže
);

35588 ifÐ
	ggÙP’dšgLock
 && 
	glockty³
==
SHARED_LOCK
 ){

35589 
wšUÆockFže
(&
pFže
->
h
, 
PENDING_BYTE
, 0, 1, 0);

35595 ifÐ
	g»s
 ){

35596 
	grc
 = 
SQLITE_OK
;

35598 
	gpFže
->
	gÏ¡E¼no
 = 
Ï¡E¼no
;

35599 
	grc
 = 
SQLITE_BUSY
;

35600 
OSTRACE
(("LOCK-FAIL file=%p, wanted=%d, got=%d\n",

35601 
pFže
->
h
, 
lockty³
, 
ÃwLockty³
));

35603 
	gpFže
->
	glockty³
 = (
u8
)
ÃwLockty³
;

35604 
OSTRACE
(("LOCK file=%p,†ock=%d,„c=%s\n",

35605 
pFže
->
h
,…Fže->
lockty³
, 
sql™e3E¼Name
(
rc
)));

35606  
	grc
;

35614 
wšCheckRe£rvedLock
(
sql™e3_fže
 *
id
, *
pResOut
){

35615 
	g»s
;

35616 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35618 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_CHECKRESERVEDLOCK
; );

35619 
OSTRACE
(("TEST-WR-LOCK fže=%p,…ResOut=%p\n", 
pFže
->
h
, 
pResOut
));

35621 
as£¹
Ð
id
!=0 );

35622 ifÐ
	gpFže
->
	glockty³
>=
RESERVED_LOCK
 ){

35623 
»s
 = 1;

35624 
OSTRACE
(("TEST-WR-LOCK fže=%p,„esuÉ=%d (loÿl)\n", 
pFže
->
h
, 
»s
));

35626 
	g»s
 = 
wšLockFže
(&
pFže
->
h
, 
SQLITE_LOCKFILEEX_FLAGS
,
RESERVED_BYTE
, 0, 1, 0);

35627 ifÐ
	g»s
 ){

35628 
wšUÆockFže
(&
pFže
->
h
, 
RESERVED_BYTE
, 0, 1, 0);

35630 
	g»s
 = !
»s
;

35631 
OSTRACE
(("TEST-WR-LOCK fže=%p,„esuÉ=%d (»mÙe)\n", 
pFže
->
h
, 
»s
));

35633 *
	gpResOut
 = 
»s
;

35634 
OSTRACE
(("TEST-WR-LOCK file=%p,…ResOut=%p, *pResOut=%d,„c=SQLITE_OK\n",

35635 
pFže
->
h
, 
pResOut
, *pResOut));

35636  
	gSQLITE_OK
;

35650 
wšUÆock
(
sql™e3_fže
 *
id
, 
lockty³
){

35651 
	gty³
;

35652 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35653 
	grc
 = 
SQLITE_OK
;

35654 
as£¹
Ð
pFže
!=0 );

35655 
as£¹
Ð
lockty³
<=
SHARED_LOCK
 );

35656 
OSTRACE
(("UNLOCK file=%p, oldLock=%d(%d),‚ewLock=%d\n",

35657 
pFže
->
h
,…Fže->
lockty³
,…Fže->
sh¬edLockBy‹
,†ocktype));

35658 
	gty³
 = 
pFže
->
lockty³
;

35659 ifÐ
	gty³
>=
EXCLUSIVE_LOCK
 ){

35660 
wšUÆockFže
(&
pFže
->
h
, 
SHARED_FIRST
, 0, 
SHARED_SIZE
, 0);

35661 ifÐ
	glockty³
==
SHARED_LOCK
 && !
wšG‘R—dLock
(
pFže
) ){

35664 
rc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_UNLOCK
, 
osG‘La¡E¼Ü
(),

35665 "wšUÆock", 
pFže
->
zP©h
);

35668 ifÐ
	gty³
>=
RESERVED_LOCK
 ){

35669 
wšUÆockFže
(&
pFže
->
h
, 
RESERVED_BYTE
, 0, 1, 0);

35671 ifÐ
	glockty³
==
NO_LOCK
 && 
ty³
>=
SHARED_LOCK
 ){

35672 
wšUÆockR—dLock
(
pFže
);

35674 ifÐ
	gty³
>=
PENDING_LOCK
 ){

35675 
wšUÆockFže
(&
pFže
->
h
, 
PENDING_BYTE
, 0, 1, 0);

35677 
	gpFže
->
	glockty³
 = (
u8
)
lockty³
;

35678 
OSTRACE
(("UNLOCK file=%p,†ock=%d,„c=%s\n",

35679 
pFže
->
h
,…Fže->
lockty³
, 
sql™e3E¼Name
(
rc
)));

35680  
	grc
;

35689 
wšModeB™
(
wšFže
 *
pFže
, 
mask
, *
pArg
){

35690 ifÐ*
	gpArg
<0 ){

35691 *
	gpArg
 = (
pFže
->
ù¾FÏgs
 & 
mask
)!=0;

35692 }ifÐ(*
	gpArg
)==0 ){

35693 
pFže
->
ù¾FÏgs
 &ð~
mask
;

35695 
	gpFže
->
	gù¾FÏgs
 |ð
mask
;

35700 
wšG‘Tem²ame
(
sql™e3_vfs
 *, **);

35701 
wšIsDœ
(const *);

35702 
BOOL
 
wšIsDriveL‘‹rAndCÞÚ
(const *);

35707 
wšFžeCÚŒÞ
(
sql™e3_fže
 *
id
, 
Ý
, *
pArg
){

35708 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

35709 
OSTRACE
(("FCNTL fže=%p, op=%d,…Arg=%p\n", 
pFže
->
h
, 
Ý
, 
pArg
));

35710  
	gÝ
 ){

35711 
	gSQLITE_FCNTL_LOCKSTATE
: {

35712 *(*)
pArg
 = 
pFže
->
lockty³
;

35713 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35714  
	gSQLITE_OK
;

35716 
	gSQLITE_LAST_ERRNO
: {

35717 *(*)
pArg
 = ()
pFže
->
Ï¡E¼no
;

35718 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35719  
	gSQLITE_OK
;

35721 
	gSQLITE_FCNTL_CHUNK_SIZE
: {

35722 
pFže
->
szChunk
 = *(*)
pArg
;

35723 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35724  
	gSQLITE_OK
;

35726 
	gSQLITE_FCNTL_SIZE_HINT
: {

35727 ifÐ
pFže
->
szChunk
>0 ){

35728 
sql™e3_št64
 
ÞdSz
;

35729 
	grc
 = 
wšFžeSize
(
id
, &
ÞdSz
);

35730 ifÐ
	grc
==
SQLITE_OK
 ){

35731 
sql™e3_št64
 
ÃwSz
 = *(sql™e3_št64*)
pArg
;

35732 ifÐ
	gÃwSz
>
	gÞdSz
 ){

35733 
SimuÏ‹IOE¼ÜB’ign
(1);

35734 
	grc
 = 
wšTrunÿ‹
(
id
, 
ÃwSz
);

35735 
SimuÏ‹IOE¼ÜB’ign
(0);

35738 
OSTRACE
(("FCNTL fže=%p,„c=%s\n", 
pFže
->
h
, 
sql™e3E¼Name
(
rc
)));

35739  
	grc
;

35741 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35742  
	gSQLITE_OK
;

35744 
	gSQLITE_FCNTL_PERSIST_WAL
: {

35745 
wšModeB™
(
pFže
, 
WINFILE_PERSIST_WAL
, (*)
pArg
);

35746 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35747  
	gSQLITE_OK
;

35749 
	gSQLITE_FCNTL_POWERSAFE_OVERWRITE
: {

35750 
wšModeB™
(
pFže
, 
WINFILE_PSOW
, (*)
pArg
);

35751 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35752  
	gSQLITE_OK
;

35754 
	gSQLITE_FCNTL_VFSNAME
: {

35755 *(**)
pArg
 = 
sql™e3_m´štf
("%s", 
pFže
->
pVfs
->
zName
);

35756 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35757  
	gSQLITE_OK
;

35759 
	gSQLITE_FCNTL_WIN32_AV_RETRY
: {

35760 *
a
 = (*)
pArg
;

35761 ifÐ
	ga
[0]>0 ){

35762 
	gwšIÛ¼R‘ry
 = 
a
[0];

35764 
	ga
[0] = 
wšIÛ¼R‘ry
;

35766 ifÐ
	ga
[1]>0 ){

35767 
	gwšIÛ¼R‘ryD–ay
 = 
a
[1];

35769 
	ga
[1] = 
wšIÛ¼R‘ryD–ay
;

35771 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_OK\n", 
pFže
->
h
));

35772  
	gSQLITE_OK
;

35774 #ifdeà
SQLITE_TEST


35775 
	gSQLITE_FCNTL_WIN32_SET_HANDLE
: {

35776 
LPHANDLE
 
phFže
 = (LPHANDLE)
pArg
;

35777 
HANDLE
 
	ghOldFže
 = 
pFže
->
h
;

35778 
	gpFže
->
	gh
 = *
phFže
;

35779 *
	gphFže
 = 
hOldFže
;

35780 
OSTRACE
(("FCNTL oldFile=%p,‚ewFile=%p,„c=SQLITE_OK\n",

35781 
hOldFže
, 
pFže
->
h
));

35782  
	gSQLITE_OK
;

35785 
	gSQLITE_FCNTL_TEMPFILENAME
: {

35786 *
zTFže
 = 0;

35787 
	grc
 = 
wšG‘Tem²ame
(
pFže
->
pVfs
, &
zTFže
);

35788 ifÐ
	grc
==
SQLITE_OK
 ){

35789 *(**)
pArg
 = 
zTFže
;

35791 
OSTRACE
(("FCNTL fže=%p,„c=%s\n", 
pFže
->
h
, 
sql™e3E¼Name
(
rc
)));

35792  
	grc
;

35794 #ià
SQLITE_MAX_MMAP_SIZE
>0

35795 
	gSQLITE_FCNTL_MMAP_SIZE
: {

35796 
i64
 
ÃwLim™
 = *(i64*)
pArg
;

35797 
	grc
 = 
SQLITE_OK
;

35798 ifÐ
	gÃwLim™
>
	gsql™e3Glob®CÚfig
.
	gmxMm­
 ){

35799 
	gÃwLim™
 = 
sql™e3Glob®CÚfig
.
mxMm­
;

35801 *(
	gi64
*)
	gpArg
 = 
pFže
->
mm­SizeMax
;

35802 ifÐ
	gÃwLim™
>=0 && 
ÃwLim™
!=
pFže
->
mm­SizeMax
 &&…Fže->
nF‘chOut
==0 ){

35803 
pFže
->
mm­SizeMax
 = 
ÃwLim™
;

35804 ifÐ
	gpFže
->
	gmm­Size
>0 ){

35805 
wšUnm­fže
(
pFže
);

35806 
	grc
 = 
wšM­fže
(
pFže
, -1);

35809 
OSTRACE
(("FCNTL fže=%p,„c=%s\n", 
pFže
->
h
, 
sql™e3E¼Name
(
rc
)));

35810  
	grc
;

35814 
OSTRACE
(("FCNTL fže=%p,„c=SQLITE_NOTFOUND\n", 
pFže
->
h
));

35815  
	gSQLITE_NOTFOUND
;

35828 
wšSeùÜSize
(
sql™e3_fže
 *
id
){

35829 ()
	gid
;

35830  
	gSQLITE_DEFAULT_SECTOR_SIZE
;

35836 
wšDeviûCh¬aù”i¡ics
(
sql™e3_fže
 *
id
){

35837 
wšFže
 *
	gp
 = (wšFže*)
id
;

35838  
	gSQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
 |

35839 ((
	gp
->
	gù¾FÏgs
 & 
	gWINFILE_PSOW
)?
	gSQLITE_IOCAP_POWERSAFE_OVERWRITE
:0);

35848 
SYSTEM_INFO
 
	gwšSysInfo
;

35850 #iâdeà
SQLITE_OMIT_WAL


35865 
wšShmEÁ”Mu‹x
(){

35866 
sql™e3_mu‹x_’‹r
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

35868 
wšShmL—veMu‹x
(){

35869 
sql™e3_mu‹x_Ëave
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

35871 #iâdeà
NDEBUG


35872 
wšShmMu‹xH–d
() {

35873  
sql™e3_mu‹x_h–d
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

35900 
	swšShmNode
 {

35901 
sql™e3_mu‹x
 *
	gmu‹x
;

35902 *
	gzFž’ame
;

35903 
wšFže
 
	ghFže
;

35905 
	gszRegiÚ
;

35906 
	gnRegiÚ
;

35907 
	sShmRegiÚ
 {

35908 
HANDLE
 
	ghM­
;

35909 *
	gpM­
;

35910 } *
	gaRegiÚ
;

35911 
DWORD
 
	gÏ¡E¼no
;

35913 
	gnRef
;

35914 
wšShm
 *
	gpFœ¡
;

35915 
wšShmNode
 *
	gpNext
;

35916 #ifdeà
SQLITE_DEBUG


35917 
u8
 
	gÃxtShmId
;

35926 
wšShmNode
 *
	gwšShmNodeLi¡
 = 0;

35941 
	swšShm
 {

35942 
wšShmNode
 *
	gpShmNode
;

35943 
wšShm
 *
	gpNext
;

35944 
u8
 
	ghasMu‹x
;

35945 
u16
 
	gsh¬edMask
;

35946 
u16
 
	gexþMask
;

35947 #ifdeà
SQLITE_DEBUG


35948 
u8
 
	gid
;

35955 
	#WIN_SHM_BASE
 ((22+
SQLITE_SHM_NLOCK
)*4è

	)

35956 
	#WIN_SHM_DMS
 (
WIN_SHM_BASE
+
SQLITE_SHM_NLOCK
è

	)

35961 
	#_SHM_UNLCK
 1

	)

35962 
	#_SHM_RDLCK
 2

	)

35963 
	#_SHM_WRLCK
 3

	)

35964 
wšShmSy¡emLock
(

35965 
wšShmNode
 *
pFže
,

35966 
lockTy³
,

35967 
of¡
,

35968 
nBy‹


35970 
	grc
 = 0;

35973 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pFže
->
mu‹x
è||…Fže->
nRef
==0 );

35975 
OSTRACE
(("SHM-LOCK file=%p,†ock=%d, offset=%d, size=%d\n",

35976 
pFže
->
hFže
.
h
, 
lockTy³
, 
of¡
, 
nBy‹
));

35979 ifÐ
	glockTy³
==
_SHM_UNLCK
 ){

35980 
rc
 = 
wšUÆockFže
(&
pFže
->
hFže
.
h
, 
of¡
, 0, 
nBy‹
, 0);

35983 
DWORD
 
	gdwFÏgs
 = 
LOCKFILE_FAIL_IMMEDIATELY
;

35984 ifÐ
	glockTy³
 =ð
_SHM_WRLCK
 ) 
dwFÏgs
 |ð
LOCKFILE_EXCLUSIVE_LOCK
;

35985 
	grc
 = 
wšLockFže
(&
pFže
->
hFže
.
h
, 
dwFÏgs
, 
of¡
, 0, 
nBy‹
, 0);

35988 ifÐ
	grc
!= 0 ){

35989 
rc
 = 
SQLITE_OK
;

35991 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

35992 
	grc
 = 
SQLITE_BUSY
;

35995 
OSTRACE
(("SHM-LOCK file=%p, func=%s,ƒrrno=%lu,„c=%s\n",

35996 
pFže
->
hFže
.
h
, (
lockTy³
 =ð
_SHM_UNLCK
) ? "winUnlockFile" :

35997 "wšLockFže", 
pFže
->
Ï¡E¼no
, 
sql™e3E¼Name
(
rc
)));

35999  
	grc
;

36003 
wšO³n
(
sql™e3_vfs
*,cÚ¡ *,
sql™e3_fže
*,,*);

36004 
wšD–‘e
(
sql™e3_vfs
 *,const *,);

36012 
wšShmPurge
(
sql™e3_vfs
 *
pVfs
, 
d–‘eFÏg
){

36013 
wšShmNode
 **
	gµ
;

36014 
wšShmNode
 *
	gp
;

36015 
as£¹
Ð
wšShmMu‹xH–d
() );

36016 
OSTRACE
(("SHM-PURGE…id=%lu, deleteFlag=%d\n",

36017 
osG‘Cu¼’tProûssId
(), 
d–‘eFÏg
));

36018 
	gµ
 = &
wšShmNodeLi¡
;

36019  (
	gp
 = *
µ
)!=0 ){

36020 ifÐ
p
->
nRef
==0 ){

36021 
i
;

36022 ifÐ
	gp
->
	gmu‹x
 ){ 
sql™e3_mu‹x_ä“
(
p
->
mu‹x
); }

36023 
	gi
=0; i<
	gp
->
	gnRegiÚ
; i++){

36024 
BOOL
 
	gbRc
 = 
osUnm­V›wOfFže
(
p
->
aRegiÚ
[
i
].
pM­
);

36025 
OSTRACE
(("SHM-PURGE-UNMAP…id=%lu,„egion=%d,„c=%s\n",

36026 
osG‘Cu¼’tProûssId
(), 
i
, 
bRc
 ? "ok" : "failed"));

36027 
UNUSED_VARIABLE_VALUE
(
bRc
);

36028 
	gbRc
 = 
osClo£HªdË
(
p
->
aRegiÚ
[
i
].
hM­
);

36029 
OSTRACE
(("SHM-PURGE-CLOSE…id=%lu,„egion=%d,„c=%s\n",

36030 
osG‘Cu¼’tProûssId
(), 
i
, 
bRc
 ? "ok" : "failed"));

36031 
UNUSED_VARIABLE_VALUE
(
bRc
);

36033 ifÐ
	gp
->
	ghFže
.
	gh
!=
NULL
 && 
p
->
hFže
.
h
!=
INVALID_HANDLE_VALUE
 ){

36034 
SimuÏ‹IOE¼ÜB’ign
(1);

36035 
wšClo£
((
sql™e3_fže
 *)&
p
->
hFže
);

36036 
SimuÏ‹IOE¼ÜB’ign
(0);

36038 ifÐ
	gd–‘eFÏg
 ){

36039 
SimuÏ‹IOE¼ÜB’ign
(1);

36040 
sql™e3BegšB’ignM®loc
();

36041 
wšD–‘e
(
pVfs
, 
p
->
zFž’ame
, 0);

36042 
sql™e3EndB’ignM®loc
();

36043 
SimuÏ‹IOE¼ÜB’ign
(0);

36045 *
	gµ
 = 
p
->
pNext
;

36046 
sql™e3_ä“
(
p
->
aRegiÚ
);

36047 
sql™e3_ä“
(
p
);

36049 
	gµ
 = &
p
->
pNext
;

36061 
wšO³nSh¬edMemÜy
(
wšFže
 *
pDbFd
){

36062 
wšShm
 *
	gp
;

36063 
wšShmNode
 *
	gpShmNode
 = 0;

36064 
	grc
;

36065 
wšShmNode
 *
	gpNew
;

36066 
	gnName
;

36068 
as£¹
Ð
pDbFd
->
pShm
==0 );

36073 
	gp
 = 
sql™e3M®locZ”o
Ð(*
p
) );

36074 ifÐ
	gp
==0 )  
SQLITE_IOERR_NOMEM
;

36075 
	gnName
 = 
sql™e3SŒËn30
(
pDbFd
->
zP©h
);

36076 
	gpNew
 = 
sql™e3M®locZ”o
Ð(*
pShmNode
è+ 
nName
 + 17 );

36077 ifÐ
	gpNew
==0 ){

36078 
sql™e3_ä“
(
p
);

36079  
	gSQLITE_IOERR_NOMEM
;

36081 
	gpNew
->
	gzFž’ame
 = (*)&
pNew
[1];

36082 
sql™e3_¢´štf
(
nName
+15, 
pNew
->
zFž’ame
, "%s-shm", 
pDbFd
->
zP©h
);

36083 
sql™e3FžeSuffix3
(
pDbFd
->
zP©h
, 
pNew
->
zFž’ame
);

36088 
wšShmEÁ”Mu‹x
();

36089 
	gpShmNode
 = 
wšShmNodeLi¡
;…ShmNode;…ShmNode=
pShmNode
->
pNext
){

36093 ifÐ
sql™e3SŒICmp
(
pShmNode
->
zFž’ame
, 
pNew
->zFilename)==0 ) ;

36095 ifÐ
	gpShmNode
 ){

36096 
sql™e3_ä“
(
pNew
);

36098 
	gpShmNode
 = 
pNew
;

36099 
	gpNew
 = 0;

36100 ((
	gwšFže
*)(&
	gpShmNode
->
	ghFže
))->
	gh
 = 
INVALID_HANDLE_VALUE
;

36101 
	gpShmNode
->
	gpNext
 = 
wšShmNodeLi¡
;

36102 
	gwšShmNodeLi¡
 = 
pShmNode
;

36104 
	gpShmNode
->
	gmu‹x
 = 
sql™e3_mu‹x_®loc
(
SQLITE_MUTEX_FAST
);

36105 ifÐ
	gpShmNode
->
	gmu‹x
==0 ){

36106 
rc
 = 
SQLITE_IOERR_NOMEM
;

36107 
	gshm_Ý’_”r
;

36110 
	grc
 = 
wšO³n
(
pDbFd
->
pVfs
,

36111 
pShmNode
->
zFž’ame
,

36112 (
sql™e3_fže
*)&
pShmNode
->
hFže
,

36113 
SQLITE_OPEN_WAL
 | 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
,

36115 ifÐ
	gSQLITE_OK
!=
rc
 ){

36116 
shm_Ý’_”r
;

36122 ifÐ
wšShmSy¡emLock
(
pShmNode
, 
_SHM_WRLCK
, 
WIN_SHM_DMS
, 1)==
SQLITE_OK
 ){

36123 
rc
 = 
wšTrunÿ‹
((
sql™e3_fže
 *)&
pShmNode
->
hFže
, 0);

36124 ifÐ
	grc
!=
SQLITE_OK
 ){

36125 
rc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_SHMOPEN
, 
osG‘La¡E¼Ü
(),

36126 "wšO³nShm", 
pDbFd
->
zP©h
);

36129 ifÐ
	grc
==
SQLITE_OK
 ){

36130 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_UNLCK
, 
WIN_SHM_DMS
, 1);

36131 
	grc
 = 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_RDLCK
, 
WIN_SHM_DMS
, 1);

36133 ifÐ
	grc
 ) 
	gshm_Ý’_”r
;

36137 
	gp
->
	gpShmNode
 = 
pShmNode
;

36138 #ifdeà
SQLITE_DEBUG


36139 
	gp
->
	gid
 = 
pShmNode
->
ÃxtShmId
++;

36141 
	gpShmNode
->
	gnRef
++;

36142 
	gpDbFd
->
	gpShm
 = 
p
;

36143 
wšShmL—veMu‹x
();

36152 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

36153 
	gp
->
	gpNext
 = 
pShmNode
->
pFœ¡
;

36154 
	gpShmNode
->
	gpFœ¡
 = 
p
;

36155 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

36156  
	gSQLITE_OK
;

36159 
	gshm_Ý’_”r
:

36160 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_UNLCK
, 
WIN_SHM_DMS
, 1);

36161 
wšShmPurge
(
pDbFd
->
pVfs
, 0);

36162 
sql™e3_ä“
(
p
);

36163 
sql™e3_ä“
(
pNew
);

36164 
wšShmL—veMu‹x
();

36165  
	grc
;

36172 
wšShmUnm­
(

36173 
sql™e3_fže
 *
fd
,

36174 
d–‘eFÏg


36176 
wšFže
 *
	gpDbFd
;

36177 
wšShm
 *
	gp
;

36178 
wšShmNode
 *
	gpShmNode
;

36179 
wšShm
 **
	gµ
;

36181 
	gpDbFd
 = (
wšFže
*)
fd
;

36182 
	gp
 = 
pDbFd
->
pShm
;

36183 ifÐ
	gp
==0 )  
SQLITE_OK
;

36184 
	gpShmNode
 = 
p
->
pShmNode
;

36188 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

36189 
	gµ
=&
pShmNode
->
pFœ¡
; (*µ)!=
p
;…°ð&(*
µ
)->
pNext
){}

36190 *
µ
 = 
p
->
pNext
;

36193 
sql™e3_ä“
(
p
);

36194 
	gpDbFd
->
	gpShm
 = 0;

36195 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

36199 
wšShmEÁ”Mu‹x
();

36200 
as£¹
Ð
pShmNode
->
nRef
>0 );

36201 
	gpShmNode
->
	gnRef
--;

36202 ifÐ
	gpShmNode
->
	gnRef
==0 ){

36203 
wšShmPurge
(
pDbFd
->
pVfs
, 
d–‘eFÏg
);

36205 
wšShmL—veMu‹x
();

36207  
	gSQLITE_OK
;

36213 
wšShmLock
(

36214 
sql™e3_fže
 *
fd
,

36215 
of¡
,

36216 
n
,

36217 
æags


36219 
wšFže
 *
	gpDbFd
 = (wšFže*)
fd
;

36220 
wšShm
 *
	gp
 = 
pDbFd
->
pShm
;

36221 
wšShm
 *
	gpX
;

36222 
wšShmNode
 *
	gpShmNode
 = 
p
->
pShmNode
;

36223 
	grc
 = 
SQLITE_OK
;

36224 
u16
 
	gmask
;

36226 
as£¹
Ð
of¡
>=0 && of¡+
n
<=
SQLITE_SHM_NLOCK
 );

36227 
as£¹
Ð
n
>=1 );

36228 
as£¹
Ð
æags
==(
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_SHARED
)

36229 || 
æags
==(
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_EXCLUSIVE
)

36230 || 
æags
==(
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_SHARED
)

36231 || 
æags
==(
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_EXCLUSIVE
) );

36232 
as£¹
Ð
n
==1 || (
æags
 & 
SQLITE_SHM_EXCLUSIVE
)!=0 );

36234 
	gmask
 = (
u16
)((1U<<(
of¡
+
n
)) - (1U<<ofst));

36235 
as£¹
Ð
n
>1 || 
mask
==(1<<
of¡
) );

36236 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

36237 ifÐ
	gæags
 & 
	gSQLITE_SHM_UNLOCK
 ){

36238 
u16
 
	g®lMask
 = 0;

36241 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

36242 ifÐ
pX
==
p
 ) ;

36243 
as£¹
Ð(
pX
->
exþMask
 & (
p
->exþMask|p->
sh¬edMask
))==0 );

36244 
	g®lMask
 |ð
pX
->
sh¬edMask
;

36248 ifÐ(
	gmask
 & 
	g®lMask
)==0 ){

36249 
rc
 = 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_UNLCK
, 
of¡
+
WIN_SHM_BASE
, 
n
);

36251 
	grc
 = 
SQLITE_OK
;

36255 ifÐ
	grc
==
SQLITE_OK
 ){

36256 
p
->
exþMask
 &ð~
mask
;

36257 
	gp
->
	gsh¬edMask
 &ð~
mask
;

36259 }ifÐ
	gæags
 & 
	gSQLITE_SHM_SHARED
 ){

36260 
u16
 
	g®lSh¬ed
 = 0;

36266 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

36267 ifÐ(
pX
->
exþMask
 & 
mask
)!=0 ){

36268 
rc
 = 
SQLITE_BUSY
;

36271 
	g®lSh¬ed
 |ð
pX
->
sh¬edMask
;

36275 ifÐ
	grc
==
SQLITE_OK
 ){

36276 ifÐ(
®lSh¬ed
 & 
mask
)==0 ){

36277 
rc
 = 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_RDLCK
, 
of¡
+
WIN_SHM_BASE
, 
n
);

36279 
	grc
 = 
SQLITE_OK
;

36284 ifÐ
	grc
==
SQLITE_OK
 ){

36285 
p
->
sh¬edMask
 |ð
mask
;

36291 
	gpX
=
pShmNode
->
pFœ¡
;…X;…X=
pX
->
pNext
){

36292 ifÐ(
pX
->
exþMask
 & 
mask
)!=0 || (pX->
sh¬edMask
 & mask)!=0 ){

36293 
rc
 = 
SQLITE_BUSY
;

36301 ifÐ
	grc
==
SQLITE_OK
 ){

36302 
rc
 = 
wšShmSy¡emLock
(
pShmNode
, 
_SHM_WRLCK
, 
of¡
+
WIN_SHM_BASE
, 
n
);

36303 ifÐ
	grc
==
SQLITE_OK
 ){

36304 
as£¹
Ð(
p
->
sh¬edMask
 & 
mask
)==0 );

36305 
	gp
->
	gexþMask
 |ð
mask
;

36309 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

36310 
OSTRACE
(("SHM-LOCK…id=%lu, id=%d, sharedMask=%03x,ƒxclMask=%03x,„c=%s\n",

36311 
osG‘Cu¼’tProûssId
(), 
p
->
id
,…->
sh¬edMask
,…->
exþMask
,

36312 
sql™e3E¼Name
(
rc
)));

36313  
	grc
;

36322 
wšShmB¬r›r
(

36323 
sql™e3_fže
 *
fd


36325 
UNUSED_PARAMETER
(
fd
);

36327 
wšShmEÁ”Mu‹x
();

36328 
wšShmL—veMu‹x
();

36350 
wšShmM­
(

36351 
sql™e3_fže
 *
fd
,

36352 
iRegiÚ
,

36353 
szRegiÚ
,

36354 
isWr™e
,

36355 vÞ©ž**
µ


36357 
wšFže
 *
	gpDbFd
 = (wšFže*)
fd
;

36358 
wšShm
 *
	gp
 = 
pDbFd
->
pShm
;

36359 
wšShmNode
 *
	gpShmNode
;

36360 
	grc
 = 
SQLITE_OK
;

36362 ifÐ!
	gp
 ){

36363 
	grc
 = 
wšO³nSh¬edMemÜy
(
pDbFd
);

36364 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

36365 
	gp
 = 
pDbFd
->
pShm
;

36367 
	gpShmNode
 = 
p
->
pShmNode
;

36369 
sql™e3_mu‹x_’‹r
(
pShmNode
->
mu‹x
);

36370 
as£¹
Ð
szRegiÚ
==
pShmNode
->szRegiÚ ||…ShmNode->
nRegiÚ
==0 );

36372 ifÐ
	gpShmNode
->
	gnRegiÚ
<=
iRegiÚ
 ){

36373 
ShmRegiÚ
 *
­New
;

36374 
	gnBy‹
 = (
iRegiÚ
+1)*
szRegiÚ
;

36375 
sql™e3_št64
 
	gsz
;

36377 
	gpShmNode
->
	gszRegiÚ
 = 
szRegiÚ
;

36383 
	grc
 = 
wšFžeSize
((
sql™e3_fže
 *)&
pShmNode
->
hFže
, &
sz
);

36384 ifÐ
	grc
!=
SQLITE_OK
 ){

36385 
rc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_SHMSIZE
, 
osG‘La¡E¼Ü
(),

36386 "wšShmM­1", 
pDbFd
->
zP©h
);

36387 
	gshm·ge_out
;

36390 ifÐ
	gsz
<
	gnBy‹
 ){

36397 ifÐ!
	gisWr™e
 ) 
	gshm·ge_out
;

36398 
	grc
 = 
wšTrunÿ‹
((
sql™e3_fže
 *)&
pShmNode
->
hFže
, 
nBy‹
);

36399 ifÐ
	grc
!=
SQLITE_OK
 ){

36400 
rc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_SHMSIZE
, 
osG‘La¡E¼Ü
(),

36401 "wšShmM­2", 
pDbFd
->
zP©h
);

36402 
	gshm·ge_out
;

36407 
	g­New
 = (
ShmRegiÚ
 *)
sql™e3_»®loc
(

36408 
pShmNode
->
aRegiÚ
, (
iRegiÚ
+1)*(
­New
[0])

36410 ifÐ!
	g­New
 ){

36411 
	grc
 = 
SQLITE_IOERR_NOMEM
;

36412 
	gshm·ge_out
;

36414 
	gpShmNode
->
	gaRegiÚ
 = 
­New
;

36416  
	gpShmNode
->
	gnRegiÚ
<=
iRegiÚ
 ){

36417 
HANDLE
 
hM­
 = 
NULL
;

36418 *
	gpM­
 = 0;

36420 #ià
SQLITE_OS_WINRT


36421 
	ghM­
 = 
osC»©eFžeM­pšgFromAµ
(
pShmNode
->
hFže
.
h
,

36422 
NULL
, 
PAGE_READWRITE
, 
nBy‹
, NULL

36424 #–ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

36425 
	ghM­
 = 
osC»©eFžeM­pšgW
(
pShmNode
->
hFže
.
h
,

36426 
NULL
, 
PAGE_READWRITE
, 0, 
nBy‹
, NULL

36428 #–ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

36429 
	ghM­
 = 
osC»©eFžeM­pšgA
(
pShmNode
->
hFže
.
h
,

36430 
NULL
, 
PAGE_READWRITE
, 0, 
nBy‹
, NULL

36433 
OSTRACE
(("SHM-MAP-CREATE…id=%lu,„egion=%d, size=%d,„c=%s\n",

36434 
osG‘Cu¼’tProûssId
(), 
pShmNode
->
nRegiÚ
, 
nBy‹
,

36435 
hM­
 ? "ok" : "failed"));

36436 ifÐ
	ghM­
 ){

36437 
	giOff£t
 = 
pShmNode
->
nRegiÚ
*
szRegiÚ
;

36438 
	giOff£tShiá
 = 
iOff£t
 % 
wšSysInfo
.
dwAÎoÿtiÚG¿nuÏr™y
;

36439 #ià
SQLITE_OS_WINRT


36440 
	gpM­
 = 
osM­V›wOfFžeFromAµ
(
hM­
, 
FILE_MAP_WRITE
 | 
FILE_MAP_READ
,

36441 
iOff£t
 - 
iOff£tShiá
, 
szRegiÚ
 + iOffsetShift

36444 
	gpM­
 = 
osM­V›wOfFže
(
hM­
, 
FILE_MAP_WRITE
 | 
FILE_MAP_READ
,

36445 0, 
iOff£t
 - 
iOff£tShiá
, 
szRegiÚ
 + iOffsetShift

36448 
OSTRACE
(("SHM-MAP-MAP…id=%lu,„egion=%d, offset=%d, size=%d,„c=%s\n",

36449 
osG‘Cu¼’tProûssId
(), 
pShmNode
->
nRegiÚ
, 
iOff£t
,

36450 
szRegiÚ
, 
pM­
 ? "ok" : "failed"));

36452 ifÐ!
	gpM­
 ){

36453 
	gpShmNode
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

36454 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_SHMMAP
, 
pShmNode
->
Ï¡E¼no
,

36455 "wšShmM­3", 
pDbFd
->
zP©h
);

36456 ifÐ
	ghM­
 ) 
osClo£HªdË
(
hM­
);

36457 
	gshm·ge_out
;

36460 
	gpShmNode
->
	gaRegiÚ
[
pShmNode
->
nRegiÚ
].
	gpM­
 = 
pM­
;

36461 
	gpShmNode
->
	gaRegiÚ
[
pShmNode
->
nRegiÚ
].
	ghM­
 = 
hM­
;

36462 
	gpShmNode
->
	gnRegiÚ
++;

36466 
	gshm·ge_out
:

36467 ifÐ
pShmNode
->
nRegiÚ
>
iRegiÚ
 ){

36468 
iOff£t
 = 
iRegiÚ
*
szRegiÚ
;

36469 
	giOff£tShiá
 = 
iOff£t
 % 
wšSysInfo
.
dwAÎoÿtiÚG¿nuÏr™y
;

36470 *
	gp
 = (*)
pShmNode
->
aRegiÚ
[
iRegiÚ
].
pM­
;

36471 *
	gµ
 = (*)&
p
[
iOff£tShiá
];

36473 *
	gµ
 = 0;

36475 
sql™e3_mu‹x_Ëave
(
pShmNode
->
mu‹x
);

36476  
	grc
;

36480 
	#wšShmM­
 0

	)

36481 
	#wšShmLock
 0

	)

36482 
	#wšShmB¬r›r
 0

	)

36483 
	#wšShmUnm­
 0

	)

36489 #ià
SQLITE_MAX_MMAP_SIZE
>0

36490 
wšUnm­fže
(
wšFže
 *
pFže
){

36491 
as£¹
Ð
pFže
!=0 );

36492 
OSTRACE
(("UNMAP-FILE…id=%lu,…File=%p, hMap=%p,…MapRegion=%p, "

36494 
osG‘Cu¼’tProûssId
(), 
pFže
,…Fže->
hM­
,…Fže->
pM­RegiÚ
,

36495 
pFže
->
mm­Size
,…Fže->
mm­SizeAùu®
,…Fže->
mm­SizeMax
));

36496 ifÐ
	gpFže
->
	gpM­RegiÚ
 ){

36497 ifÐ!
osUnm­V›wOfFže
(
pFže
->
pM­RegiÚ
) ){

36498 
	gpFže
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

36499 
OSTRACE
(("UNMAP-FILE…id=%lu,…File=%p,…MapRegion=%p, "

36500 "rc=SQLITE_IOERR_MMAP\n", 
osG‘Cu¼’tProûssId
(), 
pFže
,

36501 
pFže
->
pM­RegiÚ
));

36502  
wšLogE¼Ü
(
SQLITE_IOERR_MMAP
, 
pFže
->
Ï¡E¼no
,

36503 "wšUnm­fže1", 
pFže
->
zP©h
);

36505 
	gpFže
->
	gpM­RegiÚ
 = 0;

36506 
	gpFže
->
	gmm­Size
 = 0;

36507 
	gpFže
->
	gmm­SizeAùu®
 = 0;

36509 ifÐ
	gpFže
->
	ghM­
!=
NULL
 ){

36510 ifÐ!
osClo£HªdË
(
pFže
->
hM­
) ){

36511 
pFže
->
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

36512 
OSTRACE
(("UNMAP-FILE…id=%lu,…File=%p, hMap=%p,„c=SQLITE_IOERR_MMAP\n",

36513 
osG‘Cu¼’tProûssId
(), 
pFže
,…Fže->
hM­
));

36514  
wšLogE¼Ü
(
SQLITE_IOERR_MMAP
, 
pFže
->
Ï¡E¼no
,

36515 "wšUnm­fže2", 
pFže
->
zP©h
);

36517 
	gpFže
->
	ghM­
 = 
NULL
;

36519 
OSTRACE
(("UNMAP-FILE…id=%lu,…File=%p,„c=SQLITE_OK\n",

36520 
osG‘Cu¼’tProûssId
(), 
pFže
));

36521  
	gSQLITE_OK
;

36540 
wšM­fže
(
wšFže
 *
pFd
, 
sql™e3_št64
 
nBy‹
){

36541 
sql™e3_št64
 
	gnM­
 = 
nBy‹
;

36542 
	grc
;

36544 
as£¹
Ð
nM­
>=0 || 
pFd
->
nF‘chOut
==0 );

36545 
OSTRACE
(("MAP-FILE…id=%lu,…File=%p, size=%lld\n",

36546 
osG‘Cu¼’tProûssId
(), 
pFd
, 
nBy‹
));

36548 ifÐ
	gpFd
->
	gnF‘chOut
>0 )  
	gSQLITE_OK
;

36550 ifÐ
	gnM­
<0 ){

36551 
	grc
 = 
wšFžeSize
((
sql™e3_fže
*)
pFd
, &
nM­
);

36552 ifÐ
	grc
 ){

36553 
OSTRACE
(("MAP-FILE…id=%lu,…File=%p,„c=SQLITE_IOERR_FSTAT\n",

36554 
osG‘Cu¼’tProûssId
(), 
pFd
));

36555  
	gSQLITE_IOERR_FSTAT
;

36558 ifÐ
	gnM­
>
	gpFd
->
	gmm­SizeMax
 ){

36559 
	gnM­
 = 
pFd
->
mm­SizeMax
;

36561 
	gnM­
 &ð~(
sql™e3_št64
)(
wšSysInfo
.
dwPageSize
 - 1);

36563 ifÐ
	gnM­
==0 && 
pFd
->
mm­Size
>0 ){

36564 
wšUnm­fže
(
pFd
);

36566 ifÐ
	gnM­
!=
pFd
->
mm­Size
 ){

36567 *
pNew
 = 0;

36568 
DWORD
 
	g´Ùeù
 = 
PAGE_READONLY
;

36569 
DWORD
 
	gæags
 = 
FILE_MAP_READ
;

36571 
wšUnm­fže
(
pFd
);

36572 ifÐ(
	gpFd
->
	gù¾FÏgs
 & 
	gWINFILE_RDONLY
)==0 ){

36573 
´Ùeù
 = 
PAGE_READWRITE
;

36574 
	gæags
 |ð
FILE_MAP_WRITE
;

36576 #ià
SQLITE_OS_WINRT


36577 
	gpFd
->
	ghM­
 = 
osC»©eFžeM­pšgFromAµ
(
pFd
->
h
, 
NULL
, 
´Ùeù
, 
nM­
, NULL);

36578 #–ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

36579 
	gpFd
->
	ghM­
 = 
osC»©eFžeM­pšgW
(
pFd
->
h
, 
NULL
, 
´Ùeù
,

36580 (
DWORD
)((
nM­
>>32) & 0xffffffff),

36581 (
DWORD
)(
nM­
 & 0xffffffff), 
NULL
);

36582 #–ià
defšed
(
SQLITE_WIN32_HAS_ANSI
)

36583 
	gpFd
->
	ghM­
 = 
osC»©eFžeM­pšgA
(
pFd
->
h
, 
NULL
, 
´Ùeù
,

36584 (
DWORD
)((
nM­
>>32) & 0xffffffff),

36585 (
DWORD
)(
nM­
 & 0xffffffff), 
NULL
);

36587 ifÐ
	gpFd
->
	ghM­
==
NULL
 ){

36588 
pFd
->
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

36589 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_MMAP
, 
pFd
->
Ï¡E¼no
,

36590 "wšM­fže1", 
pFd
->
zP©h
);

36592 
OSTRACE
(("MAP-FILE-CREATE…id=%lu,…File=%p,„c=%s\n",

36593 
osG‘Cu¼’tProûssId
(), 
pFd
, 
sql™e3E¼Name
(
rc
)));

36594  
	gSQLITE_OK
;

36596 
as£¹
Ð(
nM­
 % 
wšSysInfo
.
dwPageSize
)==0 );

36597 
as£¹
Ð(
SIZE_T
)==(
sql™e3_št64
è|| 
nM­
<=0xffffffff );

36598 #ià
SQLITE_OS_WINRT


36599 
	gpNew
 = 
osM­V›wOfFžeFromAµ
(
pFd
->
hM­
, 
æags
, 0, (
SIZE_T
)
nM­
);

36601 
	gpNew
 = 
osM­V›wOfFže
(
pFd
->
hM­
, 
æags
, 0, 0, (
SIZE_T
)
nM­
);

36603 ifÐ
	gpNew
==
NULL
 ){

36604 
osClo£HªdË
(
pFd
->
hM­
);

36605 
	gpFd
->
	ghM­
 = 
NULL
;

36606 
	gpFd
->
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

36607 
	grc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_MMAP
, 
pFd
->
Ï¡E¼no
,

36608 "wšM­fže2", 
pFd
->
zP©h
);

36610 
OSTRACE
(("MAP-FILE-MAP…id=%lu,…File=%p,„c=%s\n",

36611 
osG‘Cu¼’tProûssId
(), 
pFd
, 
sql™e3E¼Name
(
rc
)));

36612  
	gSQLITE_OK
;

36614 
	gpFd
->
	gpM­RegiÚ
 = 
pNew
;

36615 
	gpFd
->
	gmm­Size
 = 
nM­
;

36616 
	gpFd
->
	gmm­SizeAùu®
 = 
nM­
;

36619 
OSTRACE
(("MAP-FILE…id=%lu,…File=%p,„c=SQLITE_OK\n",

36620 
osG‘Cu¼’tProûssId
(), 
pFd
));

36621  
	gSQLITE_OK
;

36637 
wšF‘ch
(
sql™e3_fže
 *
fd
, 
i64
 
iOff
, 
nAmt
, **
µ
){

36638 #ià
SQLITE_MAX_MMAP_SIZE
>0

36639 
wšFže
 *
	gpFd
 = (wšFže*)
fd
;

36641 *
	gµ
 = 0;

36643 
OSTRACE
(("FETCH…id=%lu,…File=%p, offset=%lld,‡mount=%d,…p=%p\n",

36644 
osG‘Cu¼’tProûssId
(), 
fd
, 
iOff
, 
nAmt
, 
µ
));

36646 #ià
SQLITE_MAX_MMAP_SIZE
>0

36647 ifÐ
	gpFd
->
	gmm­SizeMax
>0 ){

36648 ifÐ
	gpFd
->
	gpM­RegiÚ
==0 ){

36649 
rc
 = 
wšM­fže
(
pFd
, -1);

36650 ifÐ
	grc
!=
SQLITE_OK
 ){

36651 
OSTRACE
(("FETCH…id=%lu,…File=%p,„c=%s\n",

36652 
osG‘Cu¼’tProûssId
(), 
pFd
, 
sql™e3E¼Name
(
rc
)));

36653  
	grc
;

36656 ifÐ
	gpFd
->
	gmm­Size
 >ð
iOff
+
nAmt
 ){

36657 *
µ
 = &((
u8
 *)
pFd
->
pM­RegiÚ
)[
iOff
];

36658 
	gpFd
->
	gnF‘chOut
++;

36663 
OSTRACE
(("FETCH…id=%lu,…File=%p,…p=%p, *pp=%p,„c=SQLITE_OK\n",

36664 
osG‘Cu¼’tProûssId
(), 
fd
, 
µ
, *pp));

36665  
	gSQLITE_OK
;

36678 
wšUnãtch
(
sql™e3_fže
 *
fd
, 
i64
 
iOff
, *
p
){

36679 #ià
SQLITE_MAX_MMAP_SIZE
>0

36680 
wšFže
 *
	gpFd
 = (wšFže*)
fd
;

36685 
as£¹
Ð(
p
==0)==(
pFd
->
nF‘chOut
==0) );

36688 
as£¹
Ð
p
==0 ||…==&((
u8
 *)
pFd
->
pM­RegiÚ
)[
iOff
] );

36690 
OSTRACE
(("UNFETCH…id=%lu,…File=%p, offset=%lld,…=%p\n",

36691 
osG‘Cu¼’tProûssId
(), 
pFd
, 
iOff
, 
p
));

36693 ifÐ
	gp
 ){

36694 
	gpFd
->
	gnF‘chOut
--;

36700 
wšUnm­fže
(
pFd
);

36703 
as£¹
Ð
pFd
->
nF‘chOut
>=0 );

36706 
OSTRACE
(("UNFETCH…id=%lu,…File=%p,„c=SQLITE_OK\n",

36707 
osG‘Cu¼’tProûssId
(), 
fd
));

36708  
	gSQLITE_OK
;

36721 cÚ¡ 
sql™e3_io_m‘hods
 
	gwšIoM‘hod
 = {

36723 
wšClo£
,

36724 
wšR—d
,

36725 
wšWr™e
,

36726 
wšTrunÿ‹
,

36727 
wšSync
,

36728 
wšFžeSize
,

36729 
wšLock
,

36730 
wšUÆock
,

36731 
wšCheckRe£rvedLock
,

36732 
wšFžeCÚŒÞ
,

36733 
wšSeùÜSize
,

36734 
wšDeviûCh¬aù”i¡ics
,

36735 
wšShmM­
,

36736 
wšShmLock
,

36737 
wšShmB¬r›r
,

36738 
wšShmUnm­
,

36739 
wšF‘ch
,

36740 
wšUnãtch


36750 #ià
defšed
(
__CYGWIN__
)

36756 *
wšCÚv”tToUtf8Fž’ame
(cÚ¡ *
zFž’ame
){

36757 *
	gzCÚv”‹d
 = 0;

36758 ifÐ
osIsNT
() ){

36759 
	gzCÚv”‹d
 = 
wšUnicodeToUtf8
(
zFž’ame
);

36761 #ifdeà
SQLITE_WIN32_HAS_ANSI


36763 
	gzCÚv”‹d
 = 
sql™e3_wš32_mbcs_to_utf8
(
zFž’ame
);

36767  
	gzCÚv”‹d
;

36777 *
wšCÚv”tFromUtf8Fž’ame
(cÚ¡ *
zFž’ame
){

36778 *
	gzCÚv”‹d
 = 0;

36779 ifÐ
osIsNT
() ){

36780 
	gzCÚv”‹d
 = 
wšUtf8ToUnicode
(
zFž’ame
);

36782 #ifdeà
SQLITE_WIN32_HAS_ANSI


36784 
	gzCÚv”‹d
 = 
sql™e3_wš32_utf8_to_mbcs
(
zFž’ame
);

36788  
	gzCÚv”‹d
;

36796 
wšMakeEndInDœS•
(
nBuf
, *
zBuf
){

36797 ifÐ
	gzBuf
 ){

36798 
	gnL’
 = 
sql™e3SŒËn30
(
zBuf
);

36799 ifÐ
	gnL’
>0 ){

36800 ifÐ
wšIsDœS•
(
zBuf
[
nL’
-1]) ){

36802 }ifÐ
	gnL’
+1<
	gnBuf
 ){

36803 
	gzBuf
[
nL’
] = 
wšG‘DœS•
();

36804 
	gzBuf
[
nL’
+1] = '\0';

36816 
wšG‘Tem²ame
(
sql™e3_vfs
 *
pVfs
, **
pzBuf
){

36817 
	gzCh¬s
[] =

36821 
size_t
 
	gi
, 
	gj
;

36822 
	gnP»
 = 
sql™e3SŒËn30
(
SQLITE_TEMP_FILE_PREFIX
);

36823 
	gnMax
, 
	gnBuf
, 
	gnDœ
, 
	gnL’
;

36824 *
	gzBuf
;

36830 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR
 );

36835 
	gnMax
 = 
pVfs
->
mxP©hÇme
; 
	gnBuf
 = 
nMax
 + 2;

36836 
	gzBuf
 = 
sql™e3M®locZ”o
Ð
nBuf
 );

36837 ifÐ!
	gzBuf
 ){

36838 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36839  
	gSQLITE_IOERR_NOMEM
;

36846 
	gnDœ
 = 
nMax
 - (
nP»
 + 15);

36847 
as£¹
Ð
nDœ
>0 );

36848 ifÐ
	gsql™e3_‹mp_dœeùÜy
 ){

36849 
	gnDœL’
 = 
sql™e3SŒËn30
(
sql™e3_‹mp_dœeùÜy
);

36850 ifÐ
	gnDœL’
>0 ){

36851 ifÐ!
wšIsDœS•
(
sql™e3_‹mp_dœeùÜy
[
nDœL’
-1]) ){

36852 
	gnDœL’
++;

36854 ifÐ
	gnDœL’
>
	gnDœ
 ){

36855 
sql™e3_ä“
(
zBuf
);

36856 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_ERROR\n"));

36857  
wšLogE¼Ü
(
SQLITE_ERROR
, 0, "winGetTempname1", 0);

36859 
sql™e3_¢´štf
(
nMax
, 
zBuf
, "%s", 
sql™e3_‹mp_dœeùÜy
);

36862 #ià
defšed
(
__CYGWIN__
)

36864 cÚ¡ *
	gazDœs
[] = {

36876 
	gi
;

36877 cÚ¡ *
	gzDœ
 = 0;

36879 ifÐ!
	gazDœs
[0] )‡zDœs[0] = 
g‘’v
("SQLITE_TMPDIR");

36880 ifÐ!
	gazDœs
[1] )‡zDœs[1] = 
g‘’v
("TMPDIR");

36881 ifÐ!
	gazDœs
[2] )‡zDœs[2] = 
g‘’v
("TMP");

36882 ifÐ!
	gazDœs
[3] )‡zDœs[3] = 
g‘’v
("TEMP");

36883 ifÐ!
	gazDœs
[4] )‡zDœs[4] = 
g‘’v
("USERPROFILE");

36884 
	gi
=0; i<(
	gazDœs
)/×zDœs[0]); 
	gzDœ
=
azDœs
[
i
++]){

36885 *
zCÚv”‹d
;

36886 ifÐ
	gzDœ
==0 ) ;

36892 ifÐ
wšIsDriveL‘‹rAndCÞÚ
(
zDœ
) ){

36893 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zDœ
);

36894 ifÐ!
	gzCÚv”‹d
 ){

36895 
sql™e3_ä“
(
zBuf
);

36896 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36897  
	gSQLITE_IOERR_NOMEM
;

36899 ifÐ
wšIsDœ
(
zCÚv”‹d
) ){

36900 
sql™e3_¢´štf
(
nMax
, 
zBuf
, "%s", 
zDœ
);

36901 
sql™e3_ä“
(
zCÚv”‹d
);

36904 
sql™e3_ä“
(
zCÚv”‹d
);

36906 
	gzCÚv”‹d
 = 
sql™e3M®locZ”o
Ð
nMax
+1 );

36907 ifÐ!
	gzCÚv”‹d
 ){

36908 
sql™e3_ä“
(
zBuf
);

36909 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36910  
	gSQLITE_IOERR_NOMEM
;

36912 ifÐ
cygwš_cÚv_·th
(

36913 
osIsNT
(è? 
CCP_POSIX_TO_WIN_W
 : 
CCP_POSIX_TO_WIN_A
, 
zDœ
,

36914 
zCÚv”‹d
, 
nMax
+1)<0 ){

36915 
sql™e3_ä“
(
zCÚv”‹d
);

36916 
sql™e3_ä“
(
zBuf
);

36917 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_CONVPATH\n"));

36918  
wšLogE¼Ü
(
SQLITE_IOERR_CONVPATH
, (
DWORD
)
”ºo
,

36919 "wšG‘Tem²ame2", 
zDœ
);

36921 ifÐ
wšIsDœ
(
zCÚv”‹d
) ){

36926 *
	gzUtf8
 = 
wšCÚv”tToUtf8Fž’ame
(
zCÚv”‹d
);

36927 ifÐ!
	gzUtf8
 ){

36928 
sql™e3_ä“
(
zCÚv”‹d
);

36929 
sql™e3_ä“
(
zBuf
);

36930 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36931  
	gSQLITE_IOERR_NOMEM
;

36933 
sql™e3_¢´štf
(
nMax
, 
zBuf
, "%s", 
zUtf8
);

36934 
sql™e3_ä“
(
zUtf8
);

36935 
sql™e3_ä“
(
zCÚv”‹d
);

36938 
sql™e3_ä“
(
zCÚv”‹d
);

36942 #–ià!
SQLITE_OS_WINRT
 && !
defšed
(
__CYGWIN__
)

36943 ifÐ
osIsNT
() ){

36944 *
	gzMuÉi
;

36945 
LPWSTR
 
	gzWideP©h
 = 
sql™e3M®locZ”o
Ð
nMax
*(
WCHAR
) );

36946 ifÐ!
	gzWideP©h
 ){

36947 
sql™e3_ä“
(
zBuf
);

36948 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36949  
	gSQLITE_IOERR_NOMEM
;

36951 ifÐ
osG‘TempP©hW
(
nMax
, 
zWideP©h
)==0 ){

36952 
sql™e3_ä“
(
zWideP©h
);

36953 
sql™e3_ä“
(
zBuf
);

36954 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_GETTEMPPATH\n"));

36955  
wšLogE¼Ü
(
SQLITE_IOERR_GETTEMPPATH
, 
osG‘La¡E¼Ü
(),

36958 
	gzMuÉi
 = 
wšUnicodeToUtf8
(
zWideP©h
);

36959 ifÐ
	gzMuÉi
 ){

36960 
sql™e3_¢´štf
(
nMax
, 
zBuf
, "%s", 
zMuÉi
);

36961 
sql™e3_ä“
(
zMuÉi
);

36962 
sql™e3_ä“
(
zWideP©h
);

36964 
sql™e3_ä“
(
zWideP©h
);

36965 
sql™e3_ä“
(
zBuf
);

36966 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36967  
	gSQLITE_IOERR_NOMEM
;

36970 #ifdeà
SQLITE_WIN32_HAS_ANSI


36972 *
	gzUtf8
;

36973 *
	gzMbcsP©h
 = 
sql™e3M®locZ”o
Ð
nMax
 );

36974 ifÐ!
	gzMbcsP©h
 ){

36975 
sql™e3_ä“
(
zBuf
);

36976 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36977  
	gSQLITE_IOERR_NOMEM
;

36979 ifÐ
osG‘TempP©hA
(
nMax
, 
zMbcsP©h
)==0 ){

36980 
sql™e3_ä“
(
zBuf
);

36981 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_GETTEMPPATH\n"));

36982  
wšLogE¼Ü
(
SQLITE_IOERR_GETTEMPPATH
, 
osG‘La¡E¼Ü
(),

36985 
	gzUtf8
 = 
sql™e3_wš32_mbcs_to_utf8
(
zMbcsP©h
);

36986 ifÐ
	gzUtf8
 ){

36987 
sql™e3_¢´štf
(
nMax
, 
zBuf
, "%s", 
zUtf8
);

36988 
sql™e3_ä“
(
zUtf8
);

36990 
sql™e3_ä“
(
zBuf
);

36991 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_IOERR_NOMEM\n"));

36992  
	gSQLITE_IOERR_NOMEM
;

37003 ifÐ!
wšMakeEndInDœS•
(
nDœ
+1, 
zBuf
) ){

37004 
sql™e3_ä“
(
zBuf
);

37005 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_ERROR\n"));

37006  
wšLogE¼Ü
(
SQLITE_ERROR
, 0, "winGetTempname4", 0);

37020 
	gnL’
 = 
sql™e3SŒËn30
(
zBuf
);

37021 ifÐ(
	gnL’
 + 
	gnP»
 + 17è> 
	gnBuf
 ){

37022 
sql™e3_ä“
(
zBuf
);

37023 
OSTRACE
(("TEMP-FILENAME„c=SQLITE_ERROR\n"));

37024  
wšLogE¼Ü
(
SQLITE_ERROR
, 0, "winGetTempname5", 0);

37027 
sql™e3_¢´štf
(
nBuf
-16-
nL’
, 
zBuf
+nL’, 
SQLITE_TEMP_FILE_PREFIX
);

37029 
	gj
 = 
sql™e3SŒËn30
(
zBuf
);

37030 
sql™e3_¿ndomÃss
(15, &
zBuf
[
j
]);

37031 
	gi
=0; i<15; i++, 
	gj
++){

37032 
	gzBuf
[
j
] = ()
zCh¬s
[ (()
zBuf
[j])%((zChars)-1) ];

37034 
	gzBuf
[
j
] = 0;

37035 
	gzBuf
[
j
+1] = 0;

37036 *
	gpzBuf
 = 
zBuf
;

37038 
OSTRACE
(("TEMP-FILENAME‚ame=%s,„c=SQLITE_OK\n", 
zBuf
));

37039  
	gSQLITE_OK
;

37047 
wšIsDœ
(cÚ¡ *
zCÚv”‹d
){

37048 
DWORD
 
	g©Œ
;

37049 
	grc
 = 0;

37050 
DWORD
 
	gÏ¡E¼no
;

37052 ifÐ
osIsNT
() ){

37053 
	gút
 = 0;

37054 
WIN32_FILE_ATTRIBUTE_DATA
 
	gsA‰rD©a
;

37055 
mem£t
(&
sA‰rD©a
, 0, (sAttrData));

37056  !(
	grc
 = 
osG‘FžeA‰ribu‹sExW
((
LPCWSTR
)
zCÚv”‹d
,

37057 
G‘FžeExInfoSnd¬d
,

37058 &
sA‰rD©a
)è&& 
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){}

37059 ifÐ!
	grc
 ){

37062 
	g©Œ
 = 
sA‰rD©a
.
dwFžeA‰ribu‹s
;

37063 #ià
SQLITE_OS_WINCE
==0

37065 
	g©Œ
 = 
osG‘FžeA‰ribu‹sA
((*)
zCÚv”‹d
);

37068  (
	g©Œ
!=
INVALID_FILE_ATTRIBUTES
è&& (
©Œ
&
FILE_ATTRIBUTE_DIRECTORY
);

37074 
wšO³n
(

37075 
sql™e3_vfs
 *
pVfs
,

37076 cÚ¡ *
zName
,

37077 
sql™e3_fže
 *
id
,

37078 
æags
,

37079 *
pOutFÏgs


37081 
HANDLE
 
	gh
;

37082 
DWORD
 
	gÏ¡E¼no
 = 0;

37083 
DWORD
 
	gdwDesœedAcûss
;

37084 
DWORD
 
	gdwSh¬eMode
;

37085 
DWORD
 
	gdwC»©iÚDi¥os™iÚ
;

37086 
DWORD
 
	gdwFÏgsAndA‰ribu‹s
 = 0;

37087 #ià
SQLITE_OS_WINCE


37088 
	gisTemp
 = 0;

37090 
wšFže
 *
	gpFže
 = (wšFže*)
id
;

37091 *
	gzCÚv”‹d
;

37092 cÚ¡ *
	gzUtf8Name
 = 
zName
;

37093 
	gút
 = 0;

37098 *
	gzTm²ame
 = 0;

37100 
	grc
 = 
SQLITE_OK
;

37101 #ià!
defšed
(
NDEBUG
è|| 
SQLITE_OS_WINCE


37102 
	geTy³
 = 
æags
&0xFFFFFF00;

37105 
	gisExþusive
 = (
æags
 & 
SQLITE_OPEN_EXCLUSIVE
);

37106 
	gisD–‘e
 = (
æags
 & 
SQLITE_OPEN_DELETEONCLOSE
);

37107 
	gisC»©e
 = (
æags
 & 
SQLITE_OPEN_CREATE
);

37108 
	gisR—dÚly
 = (
æags
 & 
SQLITE_OPEN_READONLY
);

37109 
	gisR—dWr™e
 = (
æags
 & 
SQLITE_OPEN_READWRITE
);

37111 #iâdeà
NDEBUG


37112 
	gisO³nJouº®
 = (
isC»©e
 && (

37113 
eTy³
==
SQLITE_OPEN_MASTER_JOURNAL


37114 || 
eTy³
==
SQLITE_OPEN_MAIN_JOURNAL


37115 || 
eTy³
==
SQLITE_OPEN_WAL


37119 
OSTRACE
(("OPEN‚ame=%s,…File=%p, flags=%x,…OutFlags=%p\n",

37120 
zUtf8Name
, 
id
, 
æags
, 
pOutFÏgs
));

37129 
as£¹
((
isR—dÚly
==0 || 
isR—dWr™e
==0) && (isReadWrite || isReadonly));

37130 
as£¹
(
isC»©e
==0 || 
isR—dWr™e
);

37131 
as£¹
(
isExþusive
==0 || 
isC»©e
);

37132 
as£¹
(
isD–‘e
==0 || 
isC»©e
);

37136 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MAIN_DB
 );

37137 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MAIN_JOURNAL
 );

37138 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_MASTER_JOURNAL
 );

37139 
as£¹
Ð(!
isD–‘e
 && 
zName
è|| 
eTy³
!=
SQLITE_OPEN_WAL
 );

37142 
as£¹
Ð
eTy³
==
SQLITE_OPEN_MAIN_DB
 ||ƒTy³==
SQLITE_OPEN_TEMP_DB


37143 || 
eTy³
==
SQLITE_OPEN_MAIN_JOURNAL
 ||ƒTy³==
SQLITE_OPEN_TEMP_JOURNAL


37144 || 
eTy³
==
SQLITE_OPEN_SUBJOURNAL
 ||ƒTy³==
SQLITE_OPEN_MASTER_JOURNAL


37145 || 
eTy³
==
SQLITE_OPEN_TRANSIENT_DB
 ||ƒTy³==
SQLITE_OPEN_WAL


37148 
as£¹
Ð
pFže
!=0 );

37149 
mem£t
(
pFže
, 0, (
wšFže
));

37150 
	gpFže
->
	gh
 = 
INVALID_HANDLE_VALUE
;

37152 #ià
SQLITE_OS_WINRT


37153 ifÐ!
	gzUtf8Name
 && !
	gsql™e3_‹mp_dœeùÜy
 ){

37154 
sql™e3_log
(
SQLITE_ERROR
,

37162 ifÐ!
	gzUtf8Name
 ){

37163 
as£¹
Ð
isD–‘e
 && !
isO³nJouº®
 );

37164 
	grc
 = 
wšG‘Tem²ame
(
pVfs
, &
zTm²ame
);

37165 ifÐ
	grc
!=
SQLITE_OK
 ){

37166 
OSTRACE
(("OPEN‚ame=%s,„c=%s", 
zUtf8Name
, 
sql™e3E¼Name
(
rc
)));

37167  
	grc
;

37169 
	gzUtf8Name
 = 
zTm²ame
;

37176 
as£¹
Ð(
eTy³
!=
SQLITE_OPEN_MAIN_DB
è|| (
æags
 & 
SQLITE_OPEN_URI
) ||

37177 
zUtf8Name
[
sql™e3SŒËn30
(zUtf8Name)+1]==0 );

37180 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zUtf8Name
);

37181 ifÐ
	gzCÚv”‹d
==0 ){

37182 
sql™e3_ä“
(
zTm²ame
);

37183 
OSTRACE
(("OPEN‚ame=%s,„c=SQLITE_IOERR_NOMEM", 
zUtf8Name
));

37184  
	gSQLITE_IOERR_NOMEM
;

37187 ifÐ
wšIsDœ
(
zCÚv”‹d
) ){

37188 
sql™e3_ä“
(
zCÚv”‹d
);

37189 
sql™e3_ä“
(
zTm²ame
);

37190 
OSTRACE
(("OPEN‚ame=%s,„c=SQLITE_CANTOPEN_ISDIR", 
zUtf8Name
));

37191  
	gSQLITE_CANTOPEN_ISDIR
;

37194 ifÐ
	gisR—dWr™e
 ){

37195 
	gdwDesœedAcûss
 = 
GENERIC_READ
 | 
GENERIC_WRITE
;

37197 
	gdwDesœedAcûss
 = 
GENERIC_READ
;

37204 ifÐ
	gisExþusive
 ){

37207 
	gdwC»©iÚDi¥os™iÚ
 = 
CREATE_NEW
;

37208 }ifÐ
	gisC»©e
 ){

37210 
	gdwC»©iÚDi¥os™iÚ
 = 
OPEN_ALWAYS
;

37213 
	gdwC»©iÚDi¥os™iÚ
 = 
OPEN_EXISTING
;

37216 
	gdwSh¬eMode
 = 
FILE_SHARE_READ
 | 
FILE_SHARE_WRITE
;

37218 ifÐ
	gisD–‘e
 ){

37219 #ià
SQLITE_OS_WINCE


37220 
	gdwFÏgsAndA‰ribu‹s
 = 
FILE_ATTRIBUTE_HIDDEN
;

37221 
	gisTemp
 = 1;

37223 
	gdwFÏgsAndA‰ribu‹s
 = 
FILE_ATTRIBUTE_TEMPORARY


37224 | 
FILE_ATTRIBUTE_HIDDEN


37225 | 
FILE_FLAG_DELETE_ON_CLOSE
;

37228 
	gdwFÏgsAndA‰ribu‹s
 = 
FILE_ATTRIBUTE_NORMAL
;

37232 #ià
SQLITE_OS_WINCE


37233 
	gdwFÏgsAndA‰ribu‹s
 |ð
FILE_FLAG_RANDOM_ACCESS
;

37236 ifÐ
osIsNT
() ){

37237 #ià
SQLITE_OS_WINRT


37238 
CREATEFILE2_EXTENDED_PARAMETERS
 
	gex‹ndedP¬am‘”s
;

37239 
	gex‹ndedP¬am‘”s
.
	gdwSize
 = (
CREATEFILE2_EXTENDED_PARAMETERS
);

37240 
	gex‹ndedP¬am‘”s
.
	gdwFžeA‰ribu‹s
 =

37241 
dwFÏgsAndA‰ribu‹s
 & 
FILE_ATTRIBUTE_MASK
;

37242 
	gex‹ndedP¬am‘”s
.
	gdwFžeFÏgs
 = 
dwFÏgsAndA‰ribu‹s
 & 
FILE_FLAG_MASK
;

37243 
	gex‹ndedP¬am‘”s
.
	gdwSecur™yQosFÏgs
 = 
SECURITY_ANONYMOUS
;

37244 
	gex‹ndedP¬am‘”s
.
	gÍSecur™yA‰ribu‹s
 = 
NULL
;

37245 
	gex‹ndedP¬am‘”s
.
	ghTem¶©eFže
 = 
NULL
;

37246  (
	gh
 = 
osC»©eFže2
((
LPCWSTR
)
zCÚv”‹d
,

37247 
dwDesœedAcûss
,

37248 
dwSh¬eMode
,

37249 
dwC»©iÚDi¥os™iÚ
,

37250 &
ex‹ndedP¬am‘”s
))==
INVALID_HANDLE_VALUE
 &&

37251 
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){

37255  (
	gh
 = 
osC»©eFžeW
((
LPCWSTR
)
zCÚv”‹d
,

37256 
dwDesœedAcûss
,

37257 
dwSh¬eMode
, 
NULL
,

37258 
dwC»©iÚDi¥os™iÚ
,

37259 
dwFÏgsAndA‰ribu‹s
,

37260 
NULL
))==
INVALID_HANDLE_VALUE
 &&

37261 
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){

37266 #ifdeà
SQLITE_WIN32_HAS_ANSI


37268  (
	gh
 = 
osC»©eFžeA
((
LPCSTR
)
zCÚv”‹d
,

37269 
dwDesœedAcûss
,

37270 
dwSh¬eMode
, 
NULL
,

37271 
dwC»©iÚDi¥os™iÚ
,

37272 
dwFÏgsAndA‰ribu‹s
,

37273 
NULL
))==
INVALID_HANDLE_VALUE
 &&

37274 
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){

37279 
wšLogIÛ¼
(
út
);

37281 
OSTRACE
(("OPEN fže=%p,‚ame=%s,‡cûss=%lx,„c=%s\n", 
h
, 
zUtf8Name
,

37282 
dwDesœedAcûss
, (
h
==
INVALID_HANDLE_VALUE
) ? "failed" : "ok"));

37284 ifÐ
	gh
==
INVALID_HANDLE_VALUE
 ){

37285 
pFže
->
Ï¡E¼no
 =†astErrno;

37286 
wšLogE¼Ü
(
SQLITE_CANTOPEN
, 
pFže
->
Ï¡E¼no
, "wšO³n", 
zUtf8Name
);

37287 
sql™e3_ä“
(
zCÚv”‹d
);

37288 
sql™e3_ä“
(
zTm²ame
);

37289 ifÐ
	gisR—dWr™e
 && !
	gisExþusive
 ){

37290  
wšO³n
(
pVfs
, 
zName
, 
id
,

37291 ((
æags
|
SQLITE_OPEN_READONLY
) &

37292 ~(
SQLITE_OPEN_CREATE
|
SQLITE_OPEN_READWRITE
)),

37293 
pOutFÏgs
);

37295  
	gSQLITE_CANTOPEN_BKPT
;

37299 ifÐ
	gpOutFÏgs
 ){

37300 ifÐ
	gisR—dWr™e
 ){

37301 *
	gpOutFÏgs
 = 
SQLITE_OPEN_READWRITE
;

37303 *
	gpOutFÏgs
 = 
SQLITE_OPEN_READONLY
;

37307 
OSTRACE
(("OPEN file=%p,‚ame=%s,‡ccess=%lx,…OutFlags=%p, *pOutFlags=%d, "

37308 "rc=%s\n", 
h
, 
zUtf8Name
, 
dwDesœedAcûss
, 
pOutFÏgs
,…OutFlags ?

37309 *
pOutFÏgs
 : 0, (
h
==
INVALID_HANDLE_VALUE
) ? "failed" : "ok"));

37311 #ià
SQLITE_OS_WINCE


37312 ifÐ
	gisR—dWr™e
 && 
	geTy³
==
SQLITE_OPEN_MAIN_DB


37313 && (
rc
 = 
wšûC»©eLock
(
zName
, 
pFže
))!=
SQLITE_OK


37315 
osClo£HªdË
(
h
);

37316 
sql™e3_ä“
(
zCÚv”‹d
);

37317 
sql™e3_ä“
(
zTm²ame
);

37318 
OSTRACE
(("OPEN-CE-LOCK‚ame=%s,„c=%s\n", 
zName
, 
sql™e3E¼Name
(
rc
)));

37319  
	grc
;

37321 ifÐ
	gisTemp
 ){

37322 
	gpFže
->
	gzD–‘eOnClo£
 = 
zCÚv”‹d
;

37326 
sql™e3_ä“
(
zCÚv”‹d
);

37329 
sql™e3_ä“
(
zTm²ame
);

37330 
	gpFže
->
	gpM‘hod
 = &
wšIoM‘hod
;

37331 
	gpFže
->
	gpVfs
 = 
pVfs
;

37332 
	gpFže
->
	gh
 = 
h
;

37333 ifÐ
	gisR—dÚly
 ){

37334 
	gpFže
->
	gù¾FÏgs
 |ð
WINFILE_RDONLY
;

37336 ifÐ
sql™e3_uri_boÞ—n
(
zName
, "psow", 
SQLITE_POWERSAFE_OVERWRITE
) ){

37337 
	gpFže
->
	gù¾FÏgs
 |ð
WINFILE_PSOW
;

37339 
	gpFže
->
	gÏ¡E¼no
 = 
NO_ERROR
;

37340 
	gpFže
->
	gzP©h
 = 
zName
;

37341 #ià
SQLITE_MAX_MMAP_SIZE
>0

37342 
	gpFže
->
	ghM­
 = 
NULL
;

37343 
	gpFže
->
	gpM­RegiÚ
 = 0;

37344 
	gpFže
->
	gmm­Size
 = 0;

37345 
	gpFže
->
	gmm­SizeAùu®
 = 0;

37346 
	gpFže
->
	gmm­SizeMax
 = 
sql™e3Glob®CÚfig
.
szMm­
;

37349 
O³nCouÁ”
(+1);

37350  
	grc
;

37365 
wšD–‘e
(

37366 
sql™e3_vfs
 *
pVfs
,

37367 cÚ¡ *
zFž’ame
,

37368 
syncDœ


37370 
	gút
 = 0;

37371 
	grc
;

37372 
DWORD
 
	g©Œ
;

37373 
DWORD
 
	gÏ¡E¼no
 = 0;

37374 *
	gzCÚv”‹d
;

37375 
UNUSED_PARAMETER
(
pVfs
);

37376 
UNUSED_PARAMETER
(
syncDœ
);

37378 
SimuÏ‹IOE¼Ü
( 
SQLITE_IOERR_DELETE
);

37379 
OSTRACE
(("DELETE‚ame=%s, syncDœ=%d\n", 
zFž’ame
, 
syncDœ
));

37381 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zFž’ame
);

37382 ifÐ
	gzCÚv”‹d
==0 ){

37383 
OSTRACE
(("DELETE‚ame=%s,„c=SQLITE_IOERR_NOMEM\n", 
zFž’ame
));

37384  
	gSQLITE_IOERR_NOMEM
;

37386 ifÐ
osIsNT
() ){

37388 #ià
SQLITE_OS_WINRT


37389 
WIN32_FILE_ATTRIBUTE_DATA
 
	gsA‰rD©a
;

37390 
mem£t
(&
sA‰rD©a
, 0, (sAttrData));

37391 iàÐ
osG‘FžeA‰ribu‹sExW
(
zCÚv”‹d
, 
G‘FžeExInfoSnd¬d
,

37392 &
sA‰rD©a
) ){

37393 
	g©Œ
 = 
sA‰rD©a
.
dwFžeA‰ribu‹s
;

37395 
	gÏ¡E¼no
 = 
osG‘La¡E¼Ü
();

37396 ifÐ
	gÏ¡E¼no
==
ERROR_FILE_NOT_FOUND


37397 || 
Ï¡E¼no
==
ERROR_PATH_NOT_FOUND
 ){

37398 
rc
 = 
SQLITE_IOERR_DELETE_NOENT
;

37400 
	grc
 = 
SQLITE_ERROR
;

37405 
	g©Œ
 = 
osG‘FžeA‰ribu‹sW
(
zCÚv”‹d
);

37407 iàÐ
	g©Œ
==
INVALID_FILE_ATTRIBUTES
 ){

37408 
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

37409 ifÐ
	gÏ¡E¼no
==
ERROR_FILE_NOT_FOUND


37410 || 
Ï¡E¼no
==
ERROR_PATH_NOT_FOUND
 ){

37411 
rc
 = 
SQLITE_IOERR_DELETE_NOENT
;

37413 
	grc
 = 
SQLITE_ERROR
;

37417 iàÐ
	g©Œ
&
	gFILE_ATTRIBUTE_DIRECTORY
 ){

37418 
	grc
 = 
SQLITE_ERROR
;

37421 iàÐ
osD–‘eFžeW
(
zCÚv”‹d
) ){

37422 
	grc
 = 
SQLITE_OK
;

37425 iàÐ!
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){

37426 
	grc
 = 
SQLITE_ERROR
;

37431 #ifdeà
SQLITE_WIN32_HAS_ANSI


37434 
	g©Œ
 = 
osG‘FžeA‰ribu‹sA
(
zCÚv”‹d
);

37435 iàÐ
	g©Œ
==
INVALID_FILE_ATTRIBUTES
 ){

37436 
Ï¡E¼no
 = 
osG‘La¡E¼Ü
();

37437 ifÐ
	gÏ¡E¼no
==
ERROR_FILE_NOT_FOUND


37438 || 
Ï¡E¼no
==
ERROR_PATH_NOT_FOUND
 ){

37439 
rc
 = 
SQLITE_IOERR_DELETE_NOENT
;

37441 
	grc
 = 
SQLITE_ERROR
;

37445 iàÐ
	g©Œ
&
	gFILE_ATTRIBUTE_DIRECTORY
 ){

37446 
	grc
 = 
SQLITE_ERROR
;

37449 iàÐ
osD–‘eFžeA
(
zCÚv”‹d
) ){

37450 
	grc
 = 
SQLITE_OK
;

37453 iàÐ!
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){

37454 
	grc
 = 
SQLITE_ERROR
;

37460 ifÐ
	grc
 &&„c!=
SQLITE_IOERR_DELETE_NOENT
 ){

37461 
rc
 = 
wšLogE¼Ü
(
SQLITE_IOERR_DELETE
, 
Ï¡E¼no
, "wšD–‘e", 
zFž’ame
);

37463 
wšLogIÛ¼
(
út
);

37465 
sql™e3_ä“
(
zCÚv”‹d
);

37466 
OSTRACE
(("DELETE‚ame=%s,„c=%s\n", 
zFž’ame
, 
sql™e3E¼Name
(
rc
)));

37467  
	grc
;

37473 
wšAcûss
(

37474 
sql™e3_vfs
 *
pVfs
,

37475 cÚ¡ *
zFž’ame
,

37476 
æags
,

37477 *
pResOut


37479 
DWORD
 
	g©Œ
;

37480 
	grc
 = 0;

37481 
DWORD
 
	gÏ¡E¼no
 = 0;

37482 *
	gzCÚv”‹d
;

37483 
UNUSED_PARAMETER
(
pVfs
);

37485 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_IOERR_ACCESS
; );

37486 
OSTRACE
(("ACCESS‚ame=%s, flags=%x,…ResOut=%p\n",

37487 
zFž’ame
, 
æags
, 
pResOut
));

37489 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zFž’ame
);

37490 ifÐ
	gzCÚv”‹d
==0 ){

37491 
OSTRACE
(("ACCESS‚ame=%s,„c=SQLITE_IOERR_NOMEM\n", 
zFž’ame
));

37492  
	gSQLITE_IOERR_NOMEM
;

37494 ifÐ
osIsNT
() ){

37495 
	gút
 = 0;

37496 
WIN32_FILE_ATTRIBUTE_DATA
 
	gsA‰rD©a
;

37497 
mem£t
(&
sA‰rD©a
, 0, (sAttrData));

37498  !(
	grc
 = 
osG‘FžeA‰ribu‹sExW
((
LPCWSTR
)
zCÚv”‹d
,

37499 
G‘FžeExInfoSnd¬d
,

37500 &
sA‰rD©a
)è&& 
wšR‘ryIÛ¼
(&
út
, &
Ï¡E¼no
) ){}

37501 ifÐ
	grc
 ){

37505 ifÐ
	gæags
==
SQLITE_ACCESS_EXISTS


37506 && 
sA‰rD©a
.
nFžeSizeHigh
==0

37507 && 
sA‰rD©a
.
nFžeSizeLow
==0 ){

37508 
©Œ
 = 
INVALID_FILE_ATTRIBUTES
;

37510 
	g©Œ
 = 
sA‰rD©a
.
dwFžeA‰ribu‹s
;

37513 
wšLogIÛ¼
(
út
);

37514 ifÐ
	gÏ¡E¼no
!=
ERROR_FILE_NOT_FOUND
 && 
Ï¡E¼no
!=
ERROR_PATH_NOT_FOUND
 ){

37515 
sql™e3_ä“
(
zCÚv”‹d
);

37516  
wšLogE¼Ü
(
SQLITE_IOERR_ACCESS
, 
Ï¡E¼no
, "winAccess",

37517 
zFž’ame
);

37519 
	g©Œ
 = 
INVALID_FILE_ATTRIBUTES
;

37523 #ifdeà
SQLITE_WIN32_HAS_ANSI


37525 
	g©Œ
 = 
osG‘FžeA‰ribu‹sA
((*)
zCÚv”‹d
);

37528 
sql™e3_ä“
(
zCÚv”‹d
);

37529  
	gæags
 ){

37530 
	gSQLITE_ACCESS_READ
:

37531 
SQLITE_ACCESS_EXISTS
:

37532 
rc
 = 
©Œ
!=
INVALID_FILE_ATTRIBUTES
;

37534 
	gSQLITE_ACCESS_READWRITE
:

37535 
rc
 = 
©Œ
!=
INVALID_FILE_ATTRIBUTES
 &&

37536 (
©Œ
 & 
FILE_ATTRIBUTE_READONLY
)==0;

37539 
as£¹
(!"Invalid flags‡rgument");

37541 *
	gpResOut
 = 
rc
;

37542 
OSTRACE
(("ACCESS‚ame=%s,…ResOut=%p, *pResOut=%d,„c=SQLITE_OK\n",

37543 
zFž’ame
, 
pResOut
, *pResOut));

37544  
	gSQLITE_OK
;

37551 
BOOL
 
wšIsDriveL‘‹rAndCÞÚ
(

37552 cÚ¡ *
zP©hÇme


37554  ( 
sql™e3I§Íha
(
zP©hÇme
[0]è&& 
	gzP©hÇme
[1]==':' );

37563 
BOOL
 
wšIsV”b©imP©hÇme
(

37564 cÚ¡ *
zP©hÇme


37573 iàÐ
wšIsDœS•
(
zP©hÇme
[0]) ){

37574  
	gTRUE
;

37583 iàÐ
wšIsDriveL‘‹rAndCÞÚ
(
zP©hÇme
) ){

37584  
	gTRUE
;

37591  
	gFALSE
;

37599 
wšFuÎP©hÇme
(

37600 
sql™e3_vfs
 *
pVfs
,

37601 cÚ¡ *
zR–©ive
,

37602 
nFuÎ
,

37603 *
zFuÎ


37606 #ià
defšed
(
__CYGWIN__
)

37607 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_ERROR
 );

37608 
UNUSED_PARAMETER
(
nFuÎ
);

37609 
as£¹
Ð
nFuÎ
>=
pVfs
->
mxP©hÇme
 );

37610 iàÐ
	gsql™e3_d©a_dœeùÜy
 && !
wšIsV”b©imP©hÇme
(
zR–©ive
) ){

37617 *
	gzOut
 = 
sql™e3M®locZ”o
Ð
pVfs
->
mxP©hÇme
+1 );

37618 ifÐ!
	gzOut
 ){

37619  
	gSQLITE_IOERR_NOMEM
;

37621 ifÐ
cygwš_cÚv_·th
(

37622 (
osIsNT
(è? 
CCP_POSIX_TO_WIN_W
 : 
CCP_POSIX_TO_WIN_A
) |

37623 
CCP_RELATIVE
, 
zR–©ive
, 
zOut
, 
pVfs
->
mxP©hÇme
+1)<0 ){

37624 
sql™e3_ä“
(
zOut
);

37625  
wšLogE¼Ü
(
SQLITE_CANTOPEN_CONVPATH
, (
DWORD
)
”ºo
,

37626 "wšFuÎP©hÇme1", 
zR–©ive
);

37628 *
	gzUtf8
 = 
wšCÚv”tToUtf8Fž’ame
(
zOut
);

37629 ifÐ!
	gzUtf8
 ){

37630 
sql™e3_ä“
(
zOut
);

37631  
	gSQLITE_IOERR_NOMEM
;

37633 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s%c%s",

37634 
sql™e3_d©a_dœeùÜy
, 
wšG‘DœS•
(), 
zUtf8
);

37635 
sql™e3_ä“
(
zUtf8
);

37636 
sql™e3_ä“
(
zOut
);

37639 *
	gzOut
 = 
sql™e3M®locZ”o
Ð
pVfs
->
mxP©hÇme
+1 );

37640 ifÐ!
	gzOut
 ){

37641  
	gSQLITE_IOERR_NOMEM
;

37643 ifÐ
cygwš_cÚv_·th
(

37644 (
osIsNT
(è? 
CCP_POSIX_TO_WIN_W
 : 
CCP_POSIX_TO_WIN_A
),

37645 
zR–©ive
, 
zOut
, 
pVfs
->
mxP©hÇme
+1)<0 ){

37646 
sql™e3_ä“
(
zOut
);

37647  
wšLogE¼Ü
(
SQLITE_CANTOPEN_CONVPATH
, (
DWORD
)
”ºo
,

37648 "wšFuÎP©hÇme2", 
zR–©ive
);

37650 *
	gzUtf8
 = 
wšCÚv”tToUtf8Fž’ame
(
zOut
);

37651 ifÐ!
	gzUtf8
 ){

37652 
sql™e3_ä“
(
zOut
);

37653  
	gSQLITE_IOERR_NOMEM
;

37655 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s", 
zUtf8
);

37656 
sql™e3_ä“
(
zUtf8
);

37657 
sql™e3_ä“
(
zOut
);

37660  
	gSQLITE_OK
;

37663 #ià(
SQLITE_OS_WINCE
 || 
SQLITE_OS_WINRT
è&& !
defšed
(
__CYGWIN__
)

37664 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_ERROR
 );

37667 iàÐ
	gsql™e3_d©a_dœeùÜy
 && !
wšIsV”b©imP©hÇme
(
zR–©ive
) ){

37674 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s%c%s",

37675 
sql™e3_d©a_dœeùÜy
, 
wšG‘DœS•
(), 
zR–©ive
);

37677 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s", 
zR–©ive
);

37679  
	gSQLITE_OK
;

37682 #ià!
SQLITE_OS_WINCE
 && !
SQLITE_OS_WINRT
 && !
defšed
(
__CYGWIN__
)

37683 
DWORD
 
	gnBy‹
;

37684 *
	gzCÚv”‹d
;

37685 *
	gzOut
;

37690 ifÐ
	gzR–©ive
[0]=='/' && 
wšIsDriveL‘‹rAndCÞÚ
(
zR–©ive
+1) ){

37691 
zR–©ive
++;

37699 
SimuÏ‹IOE¼Ü
Ð 
SQLITE_ERROR
 );

37700 iàÐ
	gsql™e3_d©a_dœeùÜy
 && !
wšIsV”b©imP©hÇme
(
zR–©ive
) ){

37707 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s%c%s",

37708 
sql™e3_d©a_dœeùÜy
, 
wšG‘DœS•
(), 
zR–©ive
);

37709  
	gSQLITE_OK
;

37711 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zR–©ive
);

37712 ifÐ
	gzCÚv”‹d
==0 ){

37713  
SQLITE_IOERR_NOMEM
;

37715 ifÐ
osIsNT
() ){

37716 
LPWSTR
 
	gzTemp
;

37717 
	gnBy‹
 = 
osG‘FuÎP©hNameW
((
LPCWSTR
)
zCÚv”‹d
, 0, 0, 0);

37718 ifÐ
	gnBy‹
==0 ){

37719 
sql™e3_ä“
(
zCÚv”‹d
);

37720  
wšLogE¼Ü
(
SQLITE_CANTOPEN_FULLPATH
, 
osG‘La¡E¼Ü
(),

37721 "wšFuÎP©hÇme1", 
zR–©ive
);

37723 
	gnBy‹
 += 3;

37724 
	gzTemp
 = 
sql™e3M®locZ”o
Ð
nBy‹
*(
zTemp
[0]) );

37725 ifÐ
	gzTemp
==0 ){

37726 
sql™e3_ä“
(
zCÚv”‹d
);

37727  
	gSQLITE_IOERR_NOMEM
;

37729 
	gnBy‹
 = 
osG‘FuÎP©hNameW
((
LPCWSTR
)
zCÚv”‹d
, 
nBy‹
, 
zTemp
, 0);

37730 ifÐ
	gnBy‹
==0 ){

37731 
sql™e3_ä“
(
zCÚv”‹d
);

37732 
sql™e3_ä“
(
zTemp
);

37733  
wšLogE¼Ü
(
SQLITE_CANTOPEN_FULLPATH
, 
osG‘La¡E¼Ü
(),

37734 "wšFuÎP©hÇme2", 
zR–©ive
);

37736 
sql™e3_ä“
(
zCÚv”‹d
);

37737 
	gzOut
 = 
wšUnicodeToUtf8
(
zTemp
);

37738 
sql™e3_ä“
(
zTemp
);

37740 #ifdeà
SQLITE_WIN32_HAS_ANSI


37742 *
	gzTemp
;

37743 
	gnBy‹
 = 
osG‘FuÎP©hNameA
((*)
zCÚv”‹d
, 0, 0, 0);

37744 ifÐ
	gnBy‹
==0 ){

37745 
sql™e3_ä“
(
zCÚv”‹d
);

37746  
wšLogE¼Ü
(
SQLITE_CANTOPEN_FULLPATH
, 
osG‘La¡E¼Ü
(),

37747 "wšFuÎP©hÇme3", 
zR–©ive
);

37749 
	gnBy‹
 += 3;

37750 
	gzTemp
 = 
sql™e3M®locZ”o
Ð
nBy‹
*(
zTemp
[0]) );

37751 ifÐ
	gzTemp
==0 ){

37752 
sql™e3_ä“
(
zCÚv”‹d
);

37753  
	gSQLITE_IOERR_NOMEM
;

37755 
	gnBy‹
 = 
osG‘FuÎP©hNameA
((*)
zCÚv”‹d
, 
nBy‹
, 
zTemp
, 0);

37756 ifÐ
	gnBy‹
==0 ){

37757 
sql™e3_ä“
(
zCÚv”‹d
);

37758 
sql™e3_ä“
(
zTemp
);

37759  
wšLogE¼Ü
(
SQLITE_CANTOPEN_FULLPATH
, 
osG‘La¡E¼Ü
(),

37760 "wšFuÎP©hÇme4", 
zR–©ive
);

37762 
sql™e3_ä“
(
zCÚv”‹d
);

37763 
	gzOut
 = 
sql™e3_wš32_mbcs_to_utf8
(
zTemp
);

37764 
sql™e3_ä“
(
zTemp
);

37767 ifÐ
	gzOut
 ){

37768 
sql™e3_¢´štf
(
MIN
(
nFuÎ
, 
pVfs
->
mxP©hÇme
), 
zFuÎ
, "%s", 
zOut
);

37769 
sql™e3_ä“
(
zOut
);

37770  
	gSQLITE_OK
;

37772  
	gSQLITE_IOERR_NOMEM
;

37777 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


37782 *
wšDlO³n
(
sql™e3_vfs
 *
pVfs
, cÚ¡ *
zFž’ame
){

37783 
HANDLE
 
	gh
;

37784 #ià
defšed
(
__CYGWIN__
)

37785 
	gnFuÎ
 = 
pVfs
->
mxP©hÇme
+1;

37786 *
	gzFuÎ
 = 
sql™e3M®locZ”o
Ð
nFuÎ
 );

37787 *
	gzCÚv”‹d
 = 0;

37788 ifÐ
	gzFuÎ
==0 ){

37789 
OSTRACE
(("DLOPEN‚ame=%s, hªdË=%p\n", 
zFž’ame
, (*)0));

37792 ifÐ
wšFuÎP©hÇme
(
pVfs
, 
zFž’ame
, 
nFuÎ
, 
zFuÎ
)!=
SQLITE_OK
 ){

37793 
sql™e3_ä“
(
zFuÎ
);

37794 
OSTRACE
(("DLOPEN‚ame=%s, hªdË=%p\n", 
zFž’ame
, (*)0));

37797 
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zFuÎ
);

37798 
sql™e3_ä“
(
zFuÎ
);

37800 *
	gzCÚv”‹d
 = 
wšCÚv”tFromUtf8Fž’ame
(
zFž’ame
);

37801 
UNUSED_PARAMETER
(
pVfs
);

37803 ifÐ
	gzCÚv”‹d
==0 ){

37804 
OSTRACE
(("DLOPEN‚ame=%s, hªdË=%p\n", 
zFž’ame
, (*)0));

37807 ifÐ
osIsNT
() ){

37808 #ià
SQLITE_OS_WINRT


37809 
	gh
 = 
osLßdPackagedLib¿ry
((
LPCWSTR
)
zCÚv”‹d
, 0);

37811 
	gh
 = 
osLßdLib¿ryW
((
LPCWSTR
)
zCÚv”‹d
);

37814 #ifdeà
SQLITE_WIN32_HAS_ANSI


37816 
	gh
 = 
osLßdLib¿ryA
((*)
zCÚv”‹d
);

37819 
OSTRACE
(("DLOPEN‚ame=%s, hªdË=%p\n", 
zFž’ame
, (*)
h
));

37820 
sql™e3_ä“
(
zCÚv”‹d
);

37821  (*)
	gh
;

37823 
wšDlE¼Ü
(
sql™e3_vfs
 *
pVfs
, 
nBuf
, *
zBufOut
){

37824 
UNUSED_PARAMETER
(
pVfs
);

37825 
wšG‘La¡E¼ÜMsg
(
osG‘La¡E¼Ü
(), 
nBuf
, 
zBufOut
);

37827 (*
wšDlSym
(
sql™e3_vfs
 *
pVfs
,*
pH
,cÚ¡ *
zSym
))(){

37828 
FARPROC
 
	g´oc
;

37829 
UNUSED_PARAMETER
(
pVfs
);

37830 
	g´oc
 = 
osG‘ProcAdd»ssA
((
HANDLE
)
pH
, 
zSym
);

37831 
OSTRACE
(("DLSYM handle=%p, symbol=%s,‡ddress=%p\n",

37832 (*)
pH
, 
zSym
, (*)
´oc
));

37833  ((*)())
	g´oc
;

37835 
wšDlClo£
(
sql™e3_vfs
 *
pVfs
, *
pHªdË
){

37836 
UNUSED_PARAMETER
(
pVfs
);

37837 
osF»eLib¿ry
((
HANDLE
)
pHªdË
);

37838 
OSTRACE
(("DLCLOSE hªdË=%p\n", (*)
pHªdË
));

37841 
	#wšDlO³n
 0

	)

37842 
	#wšDlE¼Ü
 0

	)

37843 
	#wšDlSym
 0

	)

37844 
	#wšDlClo£
 0

	)

37851 
wšRªdomÃss
(
sql™e3_vfs
 *
pVfs
, 
nBuf
, *
zBuf
){

37852 
	gn
 = 0;

37853 
UNUSED_PARAMETER
(
pVfs
);

37854 #ià
defšed
(
SQLITE_TEST
)

37855 
	gn
 = 
nBuf
;

37856 
mem£t
(
zBuf
, 0, 
nBuf
);

37858 ifÐ(
	gSYSTEMTIME
)<=
nBuf
-
n
 ){

37859 
SYSTEMTIME
 
x
;

37860 
osG‘Sy¡emTime
(&
x
);

37861 
memýy
(&
zBuf
[
n
], &
x
, (x));

37862 
	gn
 +ð(
x
);

37864 ifÐ(
	gDWORD
)<=
nBuf
-
n
 ){

37865 
DWORD
 
pid
 = 
osG‘Cu¼’tProûssId
();

37866 
memýy
(&
zBuf
[
n
], &
pid
, (pid));

37867 
	gn
 +ð(
pid
);

37869 #ià
SQLITE_OS_WINRT


37870 ifÐ(
	gULONGLONG
)<=
nBuf
-
n
 ){

37871 
ULONGLONG
 
út
 = 
osG‘TickCouÁ64
();

37872 
memýy
(&
zBuf
[
n
], &
út
, (cnt));

37873 
	gn
 +ð(
út
);

37876 ifÐ(
	gDWORD
)<=
nBuf
-
n
 ){

37877 
DWORD
 
út
 = 
osG‘TickCouÁ
();

37878 
memýy
(&
zBuf
[
n
], &
út
, (cnt));

37879 
	gn
 +ð(
út
);

37882 ifÐ(
	gLARGE_INTEGER
)<=
nBuf
-
n
 ){

37883 
LARGE_INTEGER
 
i
;

37884 
osQu”yP”fÜmªûCouÁ”
(&
i
);

37885 
memýy
(&
zBuf
[
n
], &
i
, (i));

37886 
	gn
 +ð(
i
);

37889  
	gn
;

37896 
wšSË•
(
sql™e3_vfs
 *
pVfs
, 
miüo£c
){

37897 
sql™e3_wš32_¦“p
((
miüo£c
+999)/1000);

37898 
UNUSED_PARAMETER
(
pVfs
);

37899  ((
	gmiüo£c
+999)/1000)*1000;

37907 #ifdeà
SQLITE_TEST


37908 
SQLITE_API
 
	gsql™e3_cu¼’t_time
 = 0;

37921 
wšCu¼’tTimeIÁ64
(
sql™e3_vfs
 *
pVfs
, 
sql™e3_št64
 *
piNow
){

37925 
FILETIME
 
	gá
;

37926 cÚ¡ 
sql™e3_št64
 
	gwšFž‘imeEpoch
 = 23058135*(sqlite3_int64)8640000;

37927 #ifdeà
SQLITE_TEST


37928 cÚ¡ 
sql™e3_št64
 
	gunixEpoch
 = 24405875*(sqlite3_int64)8640000;

37931 cÚ¡ 
sql™e3_št64
 
	gmax32B™V®ue
 =

37932 (
sql™e3_št64
)2000000000 + (sqlite3_int64)2000000000 +

37933 (
sql™e3_št64
)294967296;

37935 #ià
SQLITE_OS_WINCE


37936 
SYSTEMTIME
 
	gtime
;

37937 
osG‘Sy¡emTime
(&
time
);

37939 ià(!
osSy¡emTimeToFžeTime
(&
time
,&
á
)){

37940  
	gSQLITE_ERROR
;

37943 
osG‘Sy¡emTimeAsFžeTime
Ð&
á
 );

37946 *
	gpiNow
 = 
wšFž‘imeEpoch
 +

37947 ((((
sql™e3_št64
)
á
.
dwHighD©eTime
)*
max32B™V®ue
) +

37948 (
sql™e3_št64
)
á
.
dwLowD©eTime
)/(sqlite3_int64)10000;

37950 #ifdeà
SQLITE_TEST


37951 ifÐ
	gsql™e3_cu¼’t_time
 ){

37952 *
	gpiNow
 = 1000*(
sql™e3_št64
)
sql™e3_cu¼’t_time
 + 
unixEpoch
;

37955 
UNUSED_PARAMETER
(
pVfs
);

37956  
	gSQLITE_OK
;

37964 
wšCu¼’tTime
(
sql™e3_vfs
 *
pVfs
, *
´Now
){

37965 
	grc
;

37966 
sql™e3_št64
 
	gi
;

37967 
	grc
 = 
wšCu¼’tTimeIÁ64
(
pVfs
, &
i
);

37968 ifÐ!
	grc
 ){

37969 *
	g´Now
 = 
i
/86400000.0;

37971  
	grc
;

38004 
wšG‘La¡E¼Ü
(
sql™e3_vfs
 *
pVfs
, 
nBuf
, *
zBuf
){

38005 
UNUSED_PARAMETER
(
pVfs
);

38006  
wšG‘La¡E¼ÜMsg
(
osG‘La¡E¼Ü
(), 
nBuf
, 
zBuf
);

38012 
SQLITE_API
 
sql™e3_os_š™
(){

38013 
sql™e3_vfs
 
	gwšVfs
 = {

38015 (
wšFže
),

38016 
SQLITE_WIN32_MAX_PATH_BYTES
,

38020 
wšO³n
,

38021 
wšD–‘e
,

38022 
wšAcûss
,

38023 
wšFuÎP©hÇme
,

38024 
wšDlO³n
,

38025 
wšDlE¼Ü
,

38026 
wšDlSym
,

38027 
wšDlClo£
,

38028 
wšRªdomÃss
,

38029 
wšSË•
,

38030 
wšCu¼’tTime
,

38031 
wšG‘La¡E¼Ü
,

38032 
wšCu¼’tTimeIÁ64
,

38033 
wšS‘Sy¡emC®l
,

38034 
wšG‘Sy¡emC®l
,

38035 
wšNextSy¡emC®l
,

38037 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

38038 
sql™e3_vfs
 
	gwšLÚgP©hVfs
 = {

38040 (
wšFže
),

38041 
SQLITE_WINNT_MAX_PATH_BYTES
,

38045 
wšO³n
,

38046 
wšD–‘e
,

38047 
wšAcûss
,

38048 
wšFuÎP©hÇme
,

38049 
wšDlO³n
,

38050 
wšDlE¼Ü
,

38051 
wšDlSym
,

38052 
wšDlClo£
,

38053 
wšRªdomÃss
,

38054 
wšSË•
,

38055 
wšCu¼’tTime
,

38056 
wšG‘La¡E¼Ü
,

38057 
wšCu¼’tTimeIÁ64
,

38058 
wšS‘Sy¡emC®l
,

38059 
wšG‘Sy¡emC®l
,

38060 
wšNextSy¡emC®l
,

38066 
as£¹
Ð
A¼aySize
(
aSysÿÎ
)==77 );

38069 
mem£t
(&
wšSysInfo
, 0, (
SYSTEM_INFO
));

38070 #ià
SQLITE_OS_WINRT


38071 
osG‘N©iveSy¡emInfo
(&
wšSysInfo
);

38073 
osG‘Sy¡emInfo
(&
wšSysInfo
);

38075 
as£¹
Ð
wšSysInfo
.
dwAÎoÿtiÚG¿nuÏr™y
>0 );

38076 
as£¹
Ð
wšSysInfo
.
dwPageSize
>0 );

38078 
sql™e3_vfs_»gi¡”
(&
wšVfs
, 1);

38080 #ià
defšed
(
SQLITE_WIN32_HAS_WIDE
)

38081 
sql™e3_vfs_»gi¡”
(&
wšLÚgP©hVfs
, 0);

38084  
	gSQLITE_OK
;

38087 
SQLITE_API
 
sql™e3_os_’d
(){

38088 #ià
SQLITE_OS_WINRT


38089 ifÐ
	g¦“pObj
!=
NULL
 ){

38090 
osClo£HªdË
(
¦“pObj
);

38091 
	g¦“pObj
 = 
NULL
;

38094  
	gSQLITE_OK
;

38139 
	#BITVEC_SZ
 512

	)

38143 
	#BITVEC_USIZE
 (((
BITVEC_SZ
-(3*(
u32
)))/(
B™vec
*))*(B™vec*))

	)

38149 
	#BITVEC_TELEM
 
u8


	)

38151 
	#BITVEC_SZELEM
 8

	)

38153 
	#BITVEC_NELEM
 (
BITVEC_USIZE
/(
BITVEC_TELEM
))

	)

38155 
	#BITVEC_NBIT
 (
BITVEC_NELEM
*
BITVEC_SZELEM
)

	)

38158 
	#BITVEC_NINT
 (
BITVEC_USIZE
/(
u32
))

	)

38161 
	#BITVEC_MXHASH
 (
BITVEC_NINT
/2)

	)

38166 
	#BITVEC_HASH
(
X
è(((X)*1)%
BITVEC_NINT
)

	)

38168 
	#BITVEC_NPTR
 (
BITVEC_USIZE
/(
B™vec
 *))

	)

38192 
	sB™vec
 {

38193 
u32
 
	giSize
;

38194 
u32
 
	gnS‘
;

38197 
u32
 
	giDivisÜ
;

38202 
BITVEC_TELEM
 
	gaB™m­
[
BITVEC_NELEM
];

38203 
u32
 
	gaHash
[
BITVEC_NINT
];

38204 
B™vec
 *
	g­Sub
[
BITVEC_NPTR
];

38205 } 
	gu
;

38213 
SQLITE_PRIVATE
 
B™vec
 *
sql™e3B™vecC»©e
(
u32
 
iSize
){

38214 
B™vec
 *
	gp
;

38215 
as£¹
Ð(*
p
)==
BITVEC_SZ
 );

38216 
	gp
 = 
sql™e3M®locZ”o
Ð(*
p
) );

38217 ifÐ
	gp
 ){

38218 
	gp
->
	giSize
 = 
iSize
;

38220  
	gp
;

38228 
SQLITE_PRIVATE
 
sql™e3B™vecTe¡
(
B™vec
 *
p
, 
u32
 
i
){

38229 ifÐ
	gp
==0 )  0;

38230 ifÐ
	gi
>
	gp
->
	giSize
 || i==0 )  0;

38231 
	gi
--;

38232  
	gp
->
	giDivisÜ
 ){

38233 
u32
 
	gbš
 = 
i
/
p
->
iDivisÜ
;

38234 
	gi
 = 
i
%
p
->
iDivisÜ
;

38235 
	gp
 = 
p
->
u
.
­Sub
[
bš
];

38236 ià(!
	gp
) {

38240 ifÐ
	gp
->
	giSize
<=
BITVEC_NBIT
 ){

38241  (
p
->
u
.
aB™m­
[
i
/
BITVEC_SZELEM
] & (1<<(i&(BITVEC_SZELEM-1))))!=0;

38243 
u32
 
	gh
 = 
BITVEC_HASH
(
i
++);

38244  
	gp
->
	gu
.
	gaHash
[
h
] ){

38245 ifÐ
	gp
->
	gu
.
	gaHash
[
h
]==
i
 )  1;

38246 
	gh
 = (
h
+1è% 
BITVEC_NINT
;

38264 
SQLITE_PRIVATE
 
sql™e3B™vecS‘
(
B™vec
 *
p
, 
u32
 
i
){

38265 
u32
 
	gh
;

38266 ifÐ
	gp
==0 )  
SQLITE_OK
;

38267 
as£¹
Ð
i
>0 );

38268 
as£¹
Ð
i
<=
p
->
iSize
 );

38269 
	gi
--;

38270 (
	gp
->
	giSize
 > 
	gBITVEC_NBIT
è&&…->
	giDivisÜ
) {

38271 
u32
 
	gbš
 = 
i
/
p
->
iDivisÜ
;

38272 
	gi
 = 
i
%
p
->
iDivisÜ
;

38273 ifÐ
	gp
->
	gu
.
	g­Sub
[
bš
]==0 ){

38274 
p
->
u
.
­Sub
[
bš
] = 
sql™e3B™vecC»©e
Ðp->
iDivisÜ
 );

38275 ifÐ
	gp
->
	gu
.
	g­Sub
[
bš
]==0 )  
SQLITE_NOMEM
;

38277 
	gp
 = 
p
->
u
.
­Sub
[
bš
];

38279 ifÐ
	gp
->
	giSize
<=
BITVEC_NBIT
 ){

38280 
p
->
u
.
aB™m­
[
i
/
BITVEC_SZELEM
] |= 1 << (i&(BITVEC_SZELEM-1));

38281  
	gSQLITE_OK
;

38283 
	gh
 = 
BITVEC_HASH
(
i
++);

38287 ifÐ!
	gp
->
	gu
.
	gaHash
[
h
] ){

38288 ià(
	gp
->
	gnS‘
<(
	gBITVEC_NINT
-1)) {

38289 
	gb™vec_£t_’d
;

38291 
	gb™vec_£t_»hash
;

38297 ifÐ
	gp
->
	gu
.
	gaHash
[
h
]==
i
 )  
SQLITE_OK
;

38298 
	gh
++;

38299 ifÐ
	gh
>=
BITVEC_NINT
 ) 
h
 = 0;

38300 }  
	gp
->
	gu
.
	gaHash
[
h
] );

38304 
	gb™vec_£t_»hash
:

38305 ifÐ
p
->
nS‘
>=
BITVEC_MXHASH
 ){

38306 
j
;

38307 
	grc
;

38308 
u32
 *
	gaiV®ues
 = 
sql™e3SckAÎocRaw
(0, (
p
->
u
.
aHash
));

38309 ifÐ
	gaiV®ues
==0 ){

38310  
SQLITE_NOMEM
;

38312 
memýy
(
aiV®ues
, 
p
->
u
.
aHash
, (p->u.aHash));

38313 
mem£t
(
p
->
u
.
­Sub
, 0, (p->u.apSub));

38314 
	gp
->
	giDivisÜ
 = (
p
->
iSize
 + 
BITVEC_NPTR
 - 1)/BITVEC_NPTR;

38315 
	grc
 = 
sql™e3B™vecS‘
(
p
, 
i
);

38316 
	gj
=0; j<
	gBITVEC_NINT
; j++){

38317 ifÐ
	gaiV®ues
[
j
] ) 
	grc
 |ð
sql™e3B™vecS‘
(
p
, 
aiV®ues
[j]);

38319 
sql™e3SckF»e
(0, 
aiV®ues
);

38320  
	grc
;

38323 
	gb™vec_£t_’d
:

38324 
p
->
nS‘
++;

38325 
	gp
->
	gu
.
	gaHash
[
h
] = 
i
;

38326  
	gSQLITE_OK
;

38335 
SQLITE_PRIVATE
 
sql™e3B™vecCË¬
(
B™vec
 *
p
, 
u32
 
i
, *
pBuf
){

38336 ifÐ
	gp
==0 ) ;

38337 
as£¹
Ð
i
>0 );

38338 
	gi
--;

38339  
	gp
->
	giDivisÜ
 ){

38340 
u32
 
	gbš
 = 
i
/
p
->
iDivisÜ
;

38341 
	gi
 = 
i
%
p
->
iDivisÜ
;

38342 
	gp
 = 
p
->
u
.
­Sub
[
bš
];

38343 ià(!
	gp
) {

38347 ifÐ
	gp
->
	giSize
<=
BITVEC_NBIT
 ){

38348 
p
->
u
.
aB™m­
[
i
/
BITVEC_SZELEM
] &= ~(1 << (i&(BITVEC_SZELEM-1)));

38350 
	gj
;

38351 
u32
 *
	gaiV®ues
 = 
pBuf
;

38352 
memýy
(
aiV®ues
, 
p
->
u
.
aHash
, (p->u.aHash));

38353 
mem£t
(
p
->
u
.
aHash
, 0, (p->u.aHash));

38354 
	gp
->
	gnS‘
 = 0;

38355 
	gj
=0; j<
	gBITVEC_NINT
; j++){

38356 ifÐ
	gaiV®ues
[
j
] &&‡iV®ues[j]!=(
i
+1) ){

38357 
u32
 
h
 = 
BITVEC_HASH
(
aiV®ues
[
j
]-1);

38358 
	gp
->
	gnS‘
++;

38359  
	gp
->
	gu
.
	gaHash
[
h
] ){

38360 
	gh
++;

38361 ifÐ
	gh
>=
BITVEC_NINT
 ) 
h
 = 0;

38363 
	gp
->
	gu
.
	gaHash
[
h
] = 
aiV®ues
[
j
];

38372 
SQLITE_PRIVATE
 
sql™e3B™vecDe¡roy
(
B™vec
 *
p
){

38373 ifÐ
	gp
==0 ) ;

38374 ifÐ
	gp
->
	giDivisÜ
 ){

38375 
	gi
;

38376 
	gi
=0; i<
	gBITVEC_NPTR
; i++){

38377 
sql™e3B™vecDe¡roy
(
p
->
u
.
­Sub
[
i
]);

38380 
sql™e3_ä“
(
p
);

38387 
SQLITE_PRIVATE
 
u32
 
sql™e3B™vecSize
(
B™vec
 *
p
){

38388  
	gp
->
	giSize
;

38391 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


38398 
	#SETBIT
(
V
,
I
èV[I>>3] |ð(1<<(I&7))

	)

38399 
	#CLEARBIT
(
V
,
I
èV[I>>3] &ð~(1<<(I&7))

	)

38400 
	#TESTBIT
(
V
,
I
è(V[I>>3]&(1<<(I&7)))!=0

	)

38432 
SQLITE_PRIVATE
 
sql™e3B™vecBužtšTe¡
(
sz
, *
aOp
){

38433 
B™vec
 *
	gpB™vec
 = 0;

38434 *
	gpV
 = 0;

38435 
	grc
 = -1;

38436 
	gi
, 
	gnx
, 
	gpc
, 
	gÝ
;

38437 *
	gpTmpS·û
;

38441 
	gpB™vec
 = 
sql™e3B™vecC»©e
Ð
sz
 );

38442 
	gpV
 = 
sql™e3M®locZ”o
Ð(
sz
+7)/8 + 1 );

38443 
	gpTmpS·û
 = 
sql™e3_m®loc
(
BITVEC_SZ
);

38444 ifÐ
	gpB™vec
==0 || 
pV
==0 || 
pTmpS·û
==0 ) 
b™vec_’d
;

38447 
sql™e3B™vecS‘
(0, 1);

38448 
sql™e3B™vecCË¬
(0, 1, 
pTmpS·û
);

38451 
	gpc
 = 0;

38452  (
	gÝ
 = 
aOp
[
pc
])!=0 ){

38453  
Ý
 ){

38457 
nx
 = 4;

38458 
	gi
 = 
aOp
[
pc
+2] - 1;

38459 
	gaOp
[
pc
+2] +ð
aOp
[pc+3];

38465 
nx
 = 2;

38466 
sql™e3_¿ndomÃss
((
i
), &i);

38470 ifÐ(--
	gaOp
[
pc
+1]è> 0 ) 
	gnx
 = 0;

38471 
	gpc
 +ð
nx
;

38472 
	gi
 = (
i
 & 0x7fffffff)%
sz
;

38473 ifÐ(
	gÝ
 & 1)!=0 ){

38474 
SETBIT
(
pV
, (
i
+1));

38475 ifÐ
	gÝ
!=5 ){

38476 ifÐ
sql™e3B™vecS‘
(
pB™vec
, 
i
+1èè
b™vec_’d
;

38479 
CLEARBIT
(
pV
, (
i
+1));

38480 
sql™e3B™vecCË¬
(
pB™vec
, 
i
+1, 
pTmpS·û
);

38489 
	grc
 = 
sql™e3B™vecTe¡
(0,0è+ sql™e3B™vecTe¡(
pB™vec
, 
sz
+1)

38490 + 
sql™e3B™vecTe¡
(
pB™vec
, 0)

38491 + (
sql™e3B™vecSize
(
pB™vec
è- 
	gsz
);

38492 
	gi
=1; i<=
sz
; i++){

38493 ifÐ(
TESTBIT
(
pV
,
i
))!=
sql™e3B™vecTe¡
(
pB™vec
,i) ){

38494 
	grc
 = 
i
;

38500 
	gb™vec_’d
:

38501 
sql™e3_ä“
(
pTmpS·û
);

38502 
sql™e3_ä“
(
pV
);

38503 
sql™e3B™vecDe¡roy
(
pB™vec
);

38504  
	grc
;

38527 
	sPCache
 {

38528 
PgHdr
 *
	gpDœty
, *
	gpDœtyTaž
;

38529 
PgHdr
 *
	gpSynûd
;

38530 
	gnRef
;

38531 
	gszCache
;

38532 
	gszPage
;

38533 
	gszExŒa
;

38534 
u8
 
	gbPurg—bË
;

38535 
u8
 
	geC»©e
;

38536 (*
	gxSŒess
)(*,
	gPgHdr
*);

38537 *
	gpSŒess
;

38538 
sql™e3_pÿche
 *
	gpCache
;

38539 
PgHdr
 *
	gpPage1
;

38548 #ifdeà
SQLITE_ENABLE_EXPENSIVE_ASSERT


38549 
	#ex³nsive_as£¹
(
X
è
	`as£¹
(X)

	)

38551 
	#ex³nsive_as£¹
(
X
)

	)

38557 
	#PCACHE_DIRTYLIST_REMOVE
 1

	)

38558 
	#PCACHE_DIRTYLIST_ADD
 2

	)

38559 
	#PCACHE_DIRTYLIST_FRONT
 3

	)

38567 
pÿcheMªageDœtyLi¡
(
PgHdr
 *
pPage
, 
u8
 
addRemove
){

38568 
PCache
 *
	gp
 = 
pPage
->
pCache
;

38570 ifÐ
	gaddRemove
 & 
	gPCACHE_DIRTYLIST_REMOVE
 ){

38571 
as£¹
Ð
pPage
->
pDœtyNext
 ||…Page==
p
->
pDœtyTaž
 );

38572 
as£¹
Ð
pPage
->
pDœtyP»v
 ||…Page==
p
->
pDœty
 );

38575 ifÐ
	gp
->
	gpSynûd
==
pPage
 ){

38576 
PgHdr
 *
pSynûd
 = 
pPage
->
pDœtyP»v
;

38577  
	gpSynûd
 && (pSynûd->
	gæags
&
	gPGHDR_NEED_SYNC
) ){

38578 
	gpSynûd
 = 
pSynûd
->
pDœtyP»v
;

38580 
	gp
->
	gpSynûd
 = 
pSynûd
;

38583 ifÐ
	gpPage
->
	gpDœtyNext
 ){

38584 
	gpPage
->
	gpDœtyNext
->
	gpDœtyP»v
 = 
pPage
->
pDœtyP»v
;

38586 
as£¹
Ð
pPage
==
p
->
pDœtyTaž
 );

38587 
	gp
->
	gpDœtyTaž
 = 
pPage
->
pDœtyP»v
;

38589 ifÐ
	gpPage
->
	gpDœtyP»v
 ){

38590 
	gpPage
->
	gpDœtyP»v
->
	gpDœtyNext
 = 
pPage
->
pDœtyNext
;

38592 
as£¹
Ð
pPage
==
p
->
pDœty
 );

38593 
	gp
->
	gpDœty
 = 
pPage
->
pDœtyNext
;

38594 ifÐ
	gp
->
	gpDœty
==0 && 
p
->
bPurg—bË
 ){

38595 
as£¹
Ð
p
->
eC»©e
==1 );

38596 
	gp
->
	geC»©e
 = 2;

38599 
	gpPage
->
	gpDœtyNext
 = 0;

38600 
	gpPage
->
	gpDœtyP»v
 = 0;

38602 ifÐ
	gaddRemove
 & 
	gPCACHE_DIRTYLIST_ADD
 ){

38603 
as£¹
Ð
pPage
->
pDœtyNext
==0 &&…Page->
pDœtyP»v
==0 && 
p
->
pDœty
!=pPage );

38605 
	gpPage
->
	gpDœtyNext
 = 
p
->
pDœty
;

38606 ifÐ
	gpPage
->
	gpDœtyNext
 ){

38607 
as£¹
Ð
pPage
->
pDœtyNext
->
pDœtyP»v
==0 );

38608 
	gpPage
->
	gpDœtyNext
->
	gpDœtyP»v
 = 
pPage
;

38610 
	gp
->
	gpDœtyTaž
 = 
pPage
;

38611 ifÐ
	gp
->
	gbPurg—bË
 ){

38612 
as£¹
Ð
p
->
eC»©e
==2 );

38613 
	gp
->
	geC»©e
 = 1;

38616 
	gp
->
	gpDœty
 = 
pPage
;

38617 ifÐ!
	gp
->
	gpSynûd
 && 0==(
pPage
->
æags
&
PGHDR_NEED_SYNC
) ){

38618 
p
->
pSynûd
 = 
pPage
;

38627 
pÿcheUÅš
(
PgHdr
 *
p
){

38628 ifÐ
	gp
->
	gpCache
->
	gbPurg—bË
 ){

38629 ifÐ
	gp
->
	gpgno
==1 ){

38630 
p
->
pCache
->
pPage1
 = 0;

38632 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xUÅš
(
p
->
pCache
->pCache,…->
pPage
, 0);

38639 
numb”OfCachePages
(
PCache
 *
p
){

38640 ifÐ
	gp
->
	gszCache
>=0 ){

38641  
p
->
szCache
;

38643  ()((-1024*(
	gi64
)
	gp
->
	gszCache
)/Õ->
	gszPage
+p->
	gszExŒa
));

38652 
SQLITE_PRIVATE
 
sql™e3PÿcheIn™Ÿlize
(){

38653 ifÐ
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
	gxIn™
==0 ){

38657 
sql™e3PCacheS‘DeçuÉ
();

38659  
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xIn™
(
sql™e3Glob®CÚfig
.
pÿche2
.
pArg
);

38661 
SQLITE_PRIVATE
 
sql™e3PÿcheShutdown
(){

38662 ifÐ
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
	gxShutdown
 ){

38664 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xShutdown
(
sql™e3Glob®CÚfig
.
pÿche2
.
pArg
);

38671 
SQLITE_PRIVATE
 
sql™e3PÿcheSize
(){  (
	gPCache
); }

38679 
SQLITE_PRIVATE
 
sql™e3PÿcheO³n
(

38680 
szPage
,

38681 
szExŒa
,

38682 
bPurg—bË
,

38683 (*
xSŒess
)(*,
PgHdr
*),

38684 *
pSŒess
,

38685 
PCache
 *
p


38687 
mem£t
(
p
, 0, (
PCache
));

38688 
	gp
->
	gszPage
 = 1;

38689 
	gp
->
	gszExŒa
 = 
szExŒa
;

38690 
	gp
->
	gbPurg—bË
 = 
bPurg—bË
;

38691 
	gp
->
	geC»©e
 = 2;

38692 
	gp
->
	gxSŒess
 = 
xSŒess
;

38693 
	gp
->
	gpSŒess
 = 
pSŒess
;

38694 
	gp
->
	gszCache
 = 100;

38695  
sql™e3PÿcheS‘PageSize
(
p
, 
szPage
);

38702 
SQLITE_PRIVATE
 
sql™e3PÿcheS‘PageSize
(
PCache
 *
pCache
, 
szPage
){

38703 
as£¹
Ð
pCache
->
nRef
==0 &&…Cache->
pDœty
==0 );

38704 ifÐ
	gpCache
->
	gszPage
 ){

38705 
sql™e3_pÿche
 *
	gpNew
;

38706 
	gpNew
 = 
sql™e3Glob®CÚfig
.
pÿche2
.
xC»©e
(

38707 
szPage
, 
pCache
->
szExŒa
 + (
PgHdr
),…Cache->
bPurg—bË


38709 ifÐ
	gpNew
==0 )  
SQLITE_NOMEM
;

38710 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xCachesize
(
pNew
, 
numb”OfCachePages
(
pCache
));

38711 ifÐ
	gpCache
->pCache ){

38712 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xDe¡roy
(
pCache
->pCache);

38714 
	gpCache
->pCachð
pNew
;

38715 
	gpCache
->
	gpPage1
 = 0;

38716 
	gpCache
->
	gszPage
 = 
szPage
;

38718  
	gSQLITE_OK
;

38745 
SQLITE_PRIVATE
 
sql™e3_pÿche_·ge
 *
sql™e3PÿcheF‘ch
(

38746 
PCache
 *
pCache
,

38747 
Pgno
 
pgno
,

38748 
ü—‹FÏg


38750 
	geC»©e
;

38752 
as£¹
Ð
pCache
!=0 );

38753 
as£¹
Ð
pCache
->pCache!=0 );

38754 
as£¹
Ð
ü—‹FÏg
==3 || createFlag==0 );

38755 
as£¹
Ð
pgno
>0 );

38764 
	geC»©e
 = 
ü—‹FÏg
 & 
pCache
->
eC»©e
;

38765 
as£¹
Ð
eC»©e
==0 ||ƒCreate==1 ||ƒCreate==2 );

38766 
as£¹
Ð
ü—‹FÏg
==0 || 
pCache
->
eC»©e
==eCreate );

38767 
as£¹
Ð
ü—‹FÏg
==0 || 
eC»©e
==1+(!
pCache
->
bPurg—bË
||!pCache->
pDœty
) );

38768  
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xF‘ch
(
pCache
->pCache, 
pgno
, 
eC»©e
);

38782 
SQLITE_PRIVATE
 
sql™e3PÿcheF‘chSŒess
(

38783 
PCache
 *
pCache
,

38784 
Pgno
 
pgno
,

38785 
sql™e3_pÿche_·ge
 **
µPage


38787 
PgHdr
 *
	gpPg
;

38788 ifÐ
	gpCache
->
	geC»©e
==2 )  0;

38796 
	gpPg
=
pCache
->
pSynûd
;

38797 
	gpPg
 && (pPg->
	gnRef
 || (pPg->
	gæags
&
	gPGHDR_NEED_SYNC
));

38798 
	gpPg
=
pPg
->
pDœtyP»v


38800 
	gpCache
->
	gpSynûd
 = 
pPg
;

38801 ifÐ!
	gpPg
 ){

38802 
	gpPg
=
pCache
->
pDœtyTaž
;…Pg &&…Pg->
	gnRef
;…Pg=
pPg
->
pDœtyP»v
);

38804 ifÐ
	gpPg
 ){

38805 
	grc
;

38806 #ifdeà
SQLITE_LOG_CACHE_SPILL


38807 
sql™e3_log
(
SQLITE_FULL
,

38809 
pPg
->
pgno
,…gno,

38810 
sql™e3Glob®CÚfig
.
pÿche
.
xPagecouÁ
(
pCache
->pCache),

38811 
numb”OfCachePages
(
pCache
));

38813 
	grc
 = 
pCache
->
xSŒess
ÕCache->
pSŒess
, 
pPg
);

38814 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_BUSY
 ){

38815  
rc
;

38818 *
	gµPage
 = 
sql™e3Glob®CÚfig
.
pÿche2
.
xF‘ch
(
pCache
->pCache, 
pgno
, 2);

38819  *
	gµPage
==0 ? 
SQLITE_NOMEM
 : 
SQLITE_OK
;

38831 
SQLITE_NOINLINE
 
PgHdr
 *
pÿcheF‘chFšishW™hIn™
(

38832 
PCache
 *
pCache
,

38833 
Pgno
 
pgno
,

38834 
sql™e3_pÿche_·ge
 *
pPage


38836 
PgHdr
 *
	gpPgHdr
;

38837 
as£¹
Ð
pPage
!=0 );

38838 
	gpPgHdr
 = (
PgHdr
*)
pPage
->
pExŒa
;

38839 
as£¹
Ð
pPgHdr
->
pPage
==0 );

38840 
mem£t
(
pPgHdr
, 0, (
PgHdr
));

38841 
	gpPgHdr
->
	gpPage
 = 
pPage
;

38842 
	gpPgHdr
->
	gpD©a
 = 
pPage
->
pBuf
;

38843 
	gpPgHdr
->
	gpExŒa
 = (*)&
pPgHdr
[1];

38844 
mem£t
(
pPgHdr
->
pExŒa
, 0, 
pCache
->
szExŒa
);

38845 
	gpPgHdr
->
	gpCache
 = 
pCache
;

38846 
	gpPgHdr
->
	gpgno
 = 
pgno
;

38847  
sql™e3PÿcheF‘chFšish
(
pCache
,
pgno
,
pPage
);

38856 
SQLITE_PRIVATE
 
PgHdr
 *
sql™e3PÿcheF‘chFšish
(

38857 
PCache
 *
pCache
,

38858 
Pgno
 
pgno
,

38859 
sql™e3_pÿche_·ge
 *
pPage


38861 
PgHdr
 *
	gpPgHdr
;

38863 ifÐ
	gpPage
==0 )  0;

38864 
	gpPgHdr
 = (
PgHdr
 *)
pPage
->
pExŒa
;

38866 ifÐ!
	gpPgHdr
->
	gpPage
 ){

38867  
pÿcheF‘chFšishW™hIn™
(
pCache
, 
pgno
, 
pPage
);

38869 ifÐ0==
pPgHdr
->
nRef
 ){

38870 
pCache
->
nRef
++;

38872 
	gpPgHdr
->
	gnRef
++;

38873 ifÐ
	gpgno
==1 ){

38874 
pCache
->
pPage1
 = 
pPgHdr
;

38876  
	gpPgHdr
;

38883 
SQLITE_PRIVATE
 
SQLITE_NOINLINE
 
sql™e3PÿcheR–—£
(
PgHdr
 *
p
){

38884 
as£¹
Ð
p
->
nRef
>0 );

38885 
	gp
->
	gnRef
--;

38886 ifÐ
	gp
->
	gnRef
==0 ){

38887 
p
->
pCache
->
nRef
--;

38888 ifÐ(
	gp
->
	gæags
&
	gPGHDR_DIRTY
)==0 ){

38889 
pÿcheUÅš
(
p
);

38890 }ifÐ
	gp
->
	gpDœtyP»v
!=0 ){

38892 
pÿcheMªageDœtyLi¡
(
p
, 
PCACHE_DIRTYLIST_FRONT
);

38900 
SQLITE_PRIVATE
 
sql™e3PÿcheRef
(
PgHdr
 *
p
){

38901 
as£¹
(
p
->
nRef
>0);

38902 
	gp
->
	gnRef
++;

38910 
SQLITE_PRIVATE
 
sql™e3PÿcheDrÝ
(
PgHdr
 *
p
){

38911 
as£¹
Ð
p
->
nRef
==1 );

38912 ifÐ
	gp
->
	gæags
&
	gPGHDR_DIRTY
 ){

38913 
pÿcheMªageDœtyLi¡
(
p
, 
PCACHE_DIRTYLIST_REMOVE
);

38915 
	gp
->
	gpCache
->
	gnRef
--;

38916 ifÐ
	gp
->
	gpgno
==1 ){

38917 
p
->
pCache
->
pPage1
 = 0;

38919 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xUÅš
(
p
->
pCache
->pCache,…->
pPage
, 1);

38926 
SQLITE_PRIVATE
 
sql™e3PÿcheMakeDœty
(
PgHdr
 *
p
){

38927 
	gp
->
	gæags
 &ð~
PGHDR_DONT_WRITE
;

38928 
as£¹
Ð
p
->
nRef
>0 );

38929 ifÐ0==(
p
->
æags
 & 
PGHDR_DIRTY
) ){

38930 
p
->
æags
 |ð
PGHDR_DIRTY
;

38931 
pÿcheMªageDœtyLi¡
(
p
, 
PCACHE_DIRTYLIST_ADD
);

38939 
SQLITE_PRIVATE
 
sql™e3PÿcheMakeCËª
(
PgHdr
 *
p
){

38940 ifÐ(
	gp
->
	gæags
 & 
	gPGHDR_DIRTY
) ){

38941 
pÿcheMªageDœtyLi¡
(
p
, 
PCACHE_DIRTYLIST_REMOVE
);

38942 
	gp
->
	gæags
 &ð~(
PGHDR_DIRTY
|
PGHDR_NEED_SYNC
);

38943 ifÐ
	gp
->
	gnRef
==0 ){

38944 
pÿcheUÅš
(
p
);

38952 
SQLITE_PRIVATE
 
sql™e3PÿcheCËªAÎ
(
PCache
 *
pCache
){

38953 
PgHdr
 *
	gp
;

38954  (
	gp
 = 
pCache
->
pDœty
)!=0 ){

38955 
sql™e3PÿcheMakeCËª
(
p
);

38962 
SQLITE_PRIVATE
 
sql™e3PÿcheCË¬SyncFÏgs
(
PCache
 *
pCache
){

38963 
PgHdr
 *
	gp
;

38964 
	gp
=
pCache
->
pDœty
;…;…=
p
->
pDœtyNext
){

38965 
p
->
æags
 &ð~
PGHDR_NEED_SYNC
;

38967 
	gpCache
->
	gpSynûd
 = 
pCache
->
pDœtyTaž
;

38973 
SQLITE_PRIVATE
 
sql™e3PÿcheMove
(
PgHdr
 *
p
, 
Pgno
 
ÃwPgno
){

38974 
PCache
 *
	gpCache
 = 
p
->
pCache
;

38975 
as£¹
Ð
p
->
nRef
>0 );

38976 
as£¹
Ð
ÃwPgno
>0 );

38977 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xRekey
(
pCache
->pCache, 
p
->
pPage
,…->
pgno
,
ÃwPgno
);

38978 
	gp
->
	gpgno
 = 
ÃwPgno
;

38979 ifÐ(
	gp
->
	gæags
&
	gPGHDR_DIRTY
è&& (p->æags&
	gPGHDR_NEED_SYNC
) ){

38980 
pÿcheMªageDœtyLi¡
(
p
, 
PCACHE_DIRTYLIST_FRONT
);

38993 
SQLITE_PRIVATE
 
sql™e3PÿcheTrunÿ‹
(
PCache
 *
pCache
, 
Pgno
 
pgno
){

38994 ifÐ
	gpCache
->pCache ){

38995 
PgHdr
 *
	gp
;

38996 
PgHdr
 *
	gpNext
;

38997 
	gp
=
pCache
->
pDœty
;…;…=
pNext
){

38998 
pNext
 = 
p
->
pDœtyNext
;

39003 
as£¹
Ð
p
->
pgno
>0 );

39004 ifÐ
ALWAYS
(
p
->
pgno
>pgno) ){

39005 
as£¹
Ð
p
->
æags
&
PGHDR_DIRTY
 );

39006 
sql™e3PÿcheMakeCËª
(
p
);

39009 ifÐ
	gpgno
==0 && 
pCache
->
pPage1
 ){

39010 
mem£t
(
pCache
->
pPage1
->
pD©a
, 0,…Cache->
szPage
);

39011 
	gpgno
 = 1;

39013 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xTrunÿ‹
(
pCache
->pCache, 
pgno
+1);

39020 
SQLITE_PRIVATE
 
sql™e3PÿcheClo£
(
PCache
 *
pCache
){

39021 
as£¹
Ð
pCache
->pCache!=0 );

39022 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xDe¡roy
(
pCache
->pCache);

39028 
SQLITE_PRIVATE
 
sql™e3PÿcheCË¬
(
PCache
 *
pCache
){

39029 
sql™e3PÿcheTrunÿ‹
(
pCache
, 0);

39036 
PgHdr
 *
pÿcheM”geDœtyLi¡
(PgHd¸*
pA
, PgHd¸*
pB
){

39037 
PgHdr
 
	g»suÉ
, *
	gpTaž
;

39038 
	gpTaž
 = &
»suÉ
;

39039  
	gpA
 && 
	gpB
 ){

39040 ifÐ
	gpA
->
	gpgno
<
	gpB
->pgno ){

39041 
	gpTaž
->
	gpDœty
 = 
pA
;

39042 
	gpTaž
 = 
pA
;

39043 
	gpA
 = 
pA
->
pDœty
;

39045 
	gpTaž
->
	gpDœty
 = 
pB
;

39046 
	gpTaž
 = 
pB
;

39047 
	gpB
 = 
pB
->
pDœty
;

39050 ifÐ
	gpA
 ){

39051 
	gpTaž
->
	gpDœty
 = 
pA
;

39052 }ifÐ
	gpB
 ){

39053 
	gpTaž
->
	gpDœty
 = 
pB
;

39055 
	gpTaž
->
	gpDœty
 = 0;

39057  
	g»suÉ
.
	gpDœty
;

39070 
	#N_SORT_BUCKET
 32

	)

39071 
PgHdr
 *
pÿcheSÜtDœtyLi¡
(PgHd¸*
pIn
){

39072 
PgHdr
 *
	ga
[
N_SORT_BUCKET
], *
	gp
;

39073 
	gi
;

39074 
mem£t
(
a
, 0, (a));

39075  
	gpIn
 ){

39076 
	gp
 = 
pIn
;

39077 
	gpIn
 = 
p
->
pDœty
;

39078 
	gp
->
	gpDœty
 = 0;

39079 
	gi
=0; 
ALWAYS
(
i
<
N_SORT_BUCKET
-1); i++){

39080 ifÐ
	ga
[
i
]==0 ){

39081 
a
[
i
] = 
p
;

39084 
	gp
 = 
pÿcheM”geDœtyLi¡
(
a
[
i
], 
p
);

39085 
	ga
[
i
] = 0;

39088 ifÐ
NEVER
(
i
==
N_SORT_BUCKET
-1) ){

39092 
a
[
i
] = 
pÿcheM”geDœtyLi¡
×[i], 
p
);

39095 
	gp
 = 
a
[0];

39096 
	gi
=1; i<
	gN_SORT_BUCKET
; i++){

39097 
	gp
 = 
pÿcheM”geDœtyLi¡
(
p
, 
a
[
i
]);

39099  
	gp
;

39105 
SQLITE_PRIVATE
 
PgHdr
 *
sql™e3PÿcheDœtyLi¡
(
PCache
 *
pCache
){

39106 
PgHdr
 *
	gp
;

39107 
	gp
=
pCache
->
pDœty
;…;…=
p
->
pDœtyNext
){

39108 
p
->
pDœty
 =…->
pDœtyNext
;

39110  
pÿcheSÜtDœtyLi¡
(
pCache
->
pDœty
);

39116 
SQLITE_PRIVATE
 
sql™e3PÿcheRefCouÁ
(
PCache
 *
pCache
){

39117  
	gpCache
->
	gnRef
;

39123 
SQLITE_PRIVATE
 
sql™e3PÿchePageRefcouÁ
(
PgHdr
 *
p
){

39124  
	gp
->
	gnRef
;

39130 
SQLITE_PRIVATE
 
sql™e3PÿchePagecouÁ
(
PCache
 *
pCache
){

39131 
as£¹
Ð
pCache
->pCache!=0 );

39132  
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xPagecouÁ
(
pCache
->pCache);

39135 #ifdeà
SQLITE_TEST


39139 
SQLITE_PRIVATE
 
sql™e3PÿcheG‘Cachesize
(
PCache
 *
pCache
){

39140  
numb”OfCachePages
(
pCache
);

39147 
SQLITE_PRIVATE
 
sql™e3PÿcheS‘Cachesize
(
PCache
 *
pCache
, 
mxPage
){

39148 
as£¹
Ð
pCache
->pCache!=0 );

39149 
	gpCache
->
	gszCache
 = 
mxPage
;

39150 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xCachesize
(
pCache
->pCache,

39151 
numb”OfCachePages
(
pCache
));

39157 
SQLITE_PRIVATE
 
sql™e3PÿcheShršk
(
PCache
 *
pCache
){

39158 
as£¹
Ð
pCache
->pCache!=0 );

39159 
	gsql™e3Glob®CÚfig
.
	gpÿche2
.
xShršk
(
pCache
->pCache);

39162 #ià
defšed
(
SQLITE_CHECK_PAGES
è|| defšed(
SQLITE_DEBUG
)

39168 
SQLITE_PRIVATE
 
sql™e3PÿcheI‹¿‹Dœty
(
PCache
 *
pCache
, (*
xI‹r
)(
PgHdr
 *)){

39169 
PgHdr
 *
	gpDœty
;

39170 
	gpDœty
=
pCache
->
pDœty
;…Dœty;…DœtyõDœty->
pDœtyNext
){

39171 
xI‹r
(
pDœty
);

39198 
PCache1
 
	tPCache1
;

39199 
PgHdr1
 
	tPgHdr1
;

39200 
PgF»e¦Ù
 
	tPgF»e¦Ù
;

39201 
PGroup
 
	tPGroup
;

39225 
	sPGroup
 {

39226 
sql™e3_mu‹x
 *
	gmu‹x
;

39227 
	gnMaxPage
;

39228 
	gnMšPage
;

39229 
	gmxPšÃd
;

39230 
	gnCu¼’tPage
;

39231 
PgHdr1
 *
	gpLruH—d
, *
	gpLruTaž
;

39242 
	sPCache1
 {

39248 
PGroup
 *
	gpGroup
;

39249 
	gszPage
;

39250 
	gszExŒa
;

39251 
	gbPurg—bË
;

39252 
	gnMš
;

39253 
	gnMax
;

39254 
	gn90pù
;

39255 
	giMaxKey
;

39260 
	gnRecyþabË
;

39261 
	gnPage
;

39262 
	gnHash
;

39263 
PgHdr1
 **
	g­Hash
;

39272 
	sPgHdr1
 {

39273 
sql™e3_pÿche_·ge
 
	g·ge
;

39274 
	giKey
;

39275 
u8
 
	gisPšÃd
;

39276 
PgHdr1
 *
	gpNext
;

39277 
PCache1
 *
	gpCache
;

39278 
PgHdr1
 *
	gpLruNext
;

39279 
PgHdr1
 *
	gpLruP»v
;

39286 
	sPgF»e¦Ù
 {

39287 
PgF»e¦Ù
 *
	gpNext
;

39293 
SQLITE_WSD
 
	sPCacheGlob®
 {

39294 
PGroup
 
	gg½
;

39301 
	gisIn™
;

39302 
	gszSlÙ
;

39303 
	gnSlÙ
;

39304 
	gnRe£rve
;

39305 *
	gpS¹
, *
	gpEnd
;

39307 
sql™e3_mu‹x
 *
	gmu‹x
;

39308 
PgF»e¦Ù
 *
	gpF»e
;

39309 
	gnF»eSlÙ
;

39314 
	gbUnd”P»ssu»
;

39315 } 
	gpÿche1_g
;

39322 
	#pÿche1
 (
	`GLOBAL
(
PCacheGlob®
, 
pÿche1_g
))

	)

39327 
	#pÿche1EÁ”Mu‹x
(
X
è
	`sql™e3_mu‹x_’‹r
((X)->
mu‹x
)

	)

39328 
	#pÿche1L—veMu‹x
(
X
è
	`sql™e3_mu‹x_Ëave
((X)->
mu‹x
)

	)

39342 
SQLITE_PRIVATE
 
sql™e3PCacheBufãrS‘up
(*
pBuf
, 
sz
, 
n
){

39343 ifÐ
	gpÿche1
.
	gisIn™
 ){

39344 
PgF»e¦Ù
 *
	gp
;

39345 
	gsz
 = 
ROUNDDOWN8
(
sz
);

39346 
	gpÿche1
.
	gszSlÙ
 = 
sz
;

39347 
	gpÿche1
.
	gnSlÙ
 = 
pÿche1
.
nF»eSlÙ
 = 
n
;

39348 
	gpÿche1
.
	gnRe£rve
 = 
n
>90 ? 10 : (n/10 + 1);

39349 
	gpÿche1
.
	gpS¹
 = 
pBuf
;

39350 
	gpÿche1
.
	gpF»e
 = 0;

39351 
	gpÿche1
.
	gbUnd”P»ssu»
 = 0;

39352  
	gn
-- ){

39353 
	gp
 = (
PgF»e¦Ù
*)
pBuf
;

39354 
	gp
->
	gpNext
 = 
pÿche1
.
pF»e
;

39355 
	gpÿche1
.
	gpF»e
 = 
p
;

39356 
	gpBuf
 = (*)&((*)
pBuf
)[
sz
];

39358 
	gpÿche1
.
	gpEnd
 = 
pBuf
;

39371 *
pÿche1AÎoc
(
nBy‹
){

39372 *
	gp
 = 0;

39373 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
pÿche1
.
g½
.
mu‹x
) );

39374 
sql™e3StusS‘
(
SQLITE_STATUS_PAGECACHE_SIZE
, 
nBy‹
);

39375 ifÐ
	gnBy‹
<=
pÿche1
.
szSlÙ
 ){

39376 
sql™e3_mu‹x_’‹r
(
pÿche1
.
mu‹x
);

39377 
	gp
 = (
PgHdr1
 *)
pÿche1
.
pF»e
;

39378 ifÐ
	gp
 ){

39379 
	gpÿche1
.
	gpF»e
 = 
pÿche1
.
pF»e
->
pNext
;

39380 
	gpÿche1
.
	gnF»eSlÙ
--;

39381 
	gpÿche1
.
	gbUnd”P»ssu»
 = 
pÿche1
.
nF»eSlÙ
<pÿche1.
nRe£rve
;

39382 
as£¹
Ð
pÿche1
.
nF»eSlÙ
>=0 );

39383 
sql™e3StusAdd
(
SQLITE_STATUS_PAGECACHE_USED
, 1);

39385 
sql™e3_mu‹x_Ëave
(
pÿche1
.
mu‹x
);

39387 ifÐ
	gp
==0 ){

39391 
p
 = 
sql™e3M®loc
(
nBy‹
);

39392 #iâdeà
SQLITE_DISABLE_PAGECACHE_OVERFLOW_STATS


39393 ifÐ
	gp
 ){

39394 
	gsz
 = 
sql™e3M®locSize
(
p
);

39395 
sql™e3_mu‹x_’‹r
(
pÿche1
.
mu‹x
);

39396 
sql™e3StusAdd
(
SQLITE_STATUS_PAGECACHE_OVERFLOW
, 
sz
);

39397 
sql™e3_mu‹x_Ëave
(
pÿche1
.
mu‹x
);

39400 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_PCACHE
);

39402  
	gp
;

39408 
pÿche1F»e
(*
p
){

39409 
	gnF»ed
 = 0;

39410 ifÐ
	gp
==0 )  0;

39411 ifÐ
	gp
>=
pÿche1
.
pS¹
 && 
p
<pÿche1.
pEnd
 ){

39412 
PgF»e¦Ù
 *
pSlÙ
;

39413 
sql™e3_mu‹x_’‹r
(
pÿche1
.
mu‹x
);

39414 
sql™e3StusAdd
(
SQLITE_STATUS_PAGECACHE_USED
, -1);

39415 
	gpSlÙ
 = (
PgF»e¦Ù
*)
p
;

39416 
	gpSlÙ
->
	gpNext
 = 
pÿche1
.
pF»e
;

39417 
	gpÿche1
.
	gpF»e
 = 
pSlÙ
;

39418 
	gpÿche1
.
	gnF»eSlÙ
++;

39419 
	gpÿche1
.
	gbUnd”P»ssu»
 = 
pÿche1
.
nF»eSlÙ
<pÿche1.
nRe£rve
;

39420 
as£¹
Ð
pÿche1
.
nF»eSlÙ
<õÿche1.
nSlÙ
 );

39421 
sql™e3_mu‹x_Ëave
(
pÿche1
.
mu‹x
);

39423 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_PCACHE
) );

39424 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_HEAP
);

39425 
	gnF»ed
 = 
sql™e3M®locSize
(
p
);

39426 #iâdeà
SQLITE_DISABLE_PAGECACHE_OVERFLOW_STATS


39427 
sql™e3_mu‹x_’‹r
(
pÿche1
.
mu‹x
);

39428 
sql™e3StusAdd
(
SQLITE_STATUS_PAGECACHE_OVERFLOW
, -
nF»ed
);

39429 
sql™e3_mu‹x_Ëave
(
pÿche1
.
mu‹x
);

39431 
sql™e3_ä“
(
p
);

39433  
	gnF»ed
;

39436 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


39440 
pÿche1MemSize
(*
p
){

39441 ifÐ
	gp
>=
pÿche1
.
pS¹
 && 
p
<pÿche1.
pEnd
 ){

39442  
pÿche1
.
szSlÙ
;

39444 
	giSize
;

39445 
as£¹
Ð
sql™e3MemdebugHasTy³
(
p
, 
MEMTYPE_PCACHE
) );

39446 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_HEAP
);

39447 
	giSize
 = 
sql™e3M®locSize
(
p
);

39448 
sql™e3MemdebugS‘Ty³
(
p
, 
MEMTYPE_PCACHE
);

39449  
	giSize
;

39457 
PgHdr1
 *
pÿche1AÎocPage
(
PCache1
 *
pCache
){

39458 
PgHdr1
 *
	gp
 = 0;

39459 *
	gpPg
;

39464 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCache
->
pGroup
->
mu‹x
) );

39465 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

39466 #ifdeà
SQLITE_PCACHE_SEPARATE_HEADER


39467 
	gpPg
 = 
pÿche1AÎoc
(
pCache
->
szPage
);

39468 
	gp
 = 
sql™e3M®loc
((
PgHdr1
è+ 
pCache
->
szExŒa
);

39469 ifÐ!
	gpPg
 || !
	gp
 ){

39470 
pÿche1F»e
(
pPg
);

39471 
sql™e3_ä“
(
p
);

39472 
	gpPg
 = 0;

39475 
	gpPg
 = 
pÿche1AÎoc
((
PgHdr1
è+ 
pCache
->
szPage
 +…Cache->
szExŒa
);

39476 
	gp
 = (
PgHdr1
 *)&((
u8
 *)
pPg
)[
pCache
->
szPage
];

39478 
pÿche1EÁ”Mu‹x
(
pCache
->
pGroup
);

39480 ifÐ
	gpPg
 ){

39481 
	gp
->
	g·ge
.
	gpBuf
 = 
pPg
;

39482 
	gp
->
	g·ge
.
	gpExŒa
 = &
p
[1];

39483 ifÐ
	gpCache
->
	gbPurg—bË
 ){

39484 
	gpCache
->
	gpGroup
->
	gnCu¼’tPage
++;

39486  
	gp
;

39498 
pÿche1F»ePage
(
PgHdr1
 *
p
){

39499 ifÐ
ALWAYS
(
p
) ){

39500 
PCache1
 *
	gpCache
 = 
p
->
pCache
;

39501 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pCache
->
pGroup
->
mu‹x
) );

39502 
pÿche1F»e
(
p
->
·ge
.
pBuf
);

39503 #ifdeà
SQLITE_PCACHE_SEPARATE_HEADER


39504 
sql™e3_ä“
(
p
);

39506 ifÐ
	gpCache
->
	gbPurg—bË
 ){

39507 
	gpCache
->
	gpGroup
->
	gnCu¼’tPage
--;

39517 
SQLITE_PRIVATE
 *
sql™e3PageM®loc
(
sz
){

39518  
pÿche1AÎoc
(
sz
);

39524 
SQLITE_PRIVATE
 
sql™e3PageF»e
(*
p
){

39525 
pÿche1F»e
(
p
);

39545 
pÿche1Und”MemÜyP»ssu»
(
PCache1
 *
pCache
){

39546 ifÐ
	gpÿche1
.
	gnSlÙ
 && (
	gpCache
->
	gszPage
+pCache->
	gszExŒa
)<=
pÿche1
.
szSlÙ
 ){

39547  
pÿche1
.
bUnd”P»ssu»
;

39549  
sql™e3H—pN—¾yFuÎ
();

39562 
pÿche1ResizeHash
(
PCache1
 *
p
){

39563 
PgHdr1
 **
	g­New
;

39564 
	gnNew
;

39565 
	gi
;

39567 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pGroup
->
mu‹x
) );

39569 
	gnNew
 = 
p
->
nHash
*2;

39570 ifÐ
	gnNew
<256 ){

39571 
	gnNew
 = 256;

39574 
pÿche1L—veMu‹x
(
p
->
pGroup
);

39575 ifÐ
	gp
->
	gnHash
 ){ 
sql™e3BegšB’ignM®loc
(); }

39576 
	g­New
 = (
PgHdr1
 **)
sql™e3M®locZ”o
((PgHdr1 *)*
nNew
);

39577 ifÐ
	gp
->
	gnHash
 ){ 
sql™e3EndB’ignM®loc
(); }

39578 
pÿche1EÁ”Mu‹x
(
p
->
pGroup
);

39579 ifÐ
	g­New
 ){

39580 
	gi
=0; i<
	gp
->
	gnHash
; i++){

39581 
PgHdr1
 *
	gpPage
;

39582 
PgHdr1
 *
	gpNext
 = 
p
->
­Hash
[
i
];

39583  (
	gpPage
 = 
pNext
)!=0 ){

39584 
h
 = 
pPage
->
iKey
 % 
nNew
;

39585 
	gpNext
 = 
pPage
->
pNext
;

39586 
	gpPage
->
	gpNext
 = 
­New
[
h
];

39587 
	g­New
[
h
] = 
pPage
;

39590 
sql™e3_ä“
(
p
->
­Hash
);

39591 
	gp
->
	g­Hash
 = 
­New
;

39592 
	gp
->
	gnHash
 = 
nNew
;

39603 
pÿche1PšPage
(
PgHdr1
 *
pPage
){

39604 
PCache1
 *
	gpCache
;

39605 
PGroup
 *
	gpGroup
;

39607 
as£¹
Ð
pPage
!=0 );

39608 
as£¹
Ð
pPage
->
isPšÃd
==0 );

39609 
	gpCache
 = 
pPage
->
pCache
;

39610 
	gpGroup
 = 
pCache
->
pGroup
;

39611 
as£¹
Ð
pPage
->
pLruNext
 ||…Page==
pGroup
->
pLruTaž
 );

39612 
as£¹
Ð
pPage
->
pLruP»v
 ||…Page==
pGroup
->
pLruH—d
 );

39613 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pGroup
->
mu‹x
) );

39614 ifÐ
	gpPage
->
	gpLruP»v
 ){

39615 
	gpPage
->
	gpLruP»v
->
	gpLruNext
 = 
pPage
->
pLruNext
;

39617 
	gpGroup
->
	gpLruH—d
 = 
pPage
->
pLruNext
;

39619 ifÐ
	gpPage
->
	gpLruNext
 ){

39620 
	gpPage
->
	gpLruNext
->
	gpLruP»v
 = 
pPage
->
pLruP»v
;

39622 
	gpGroup
->
	gpLruTaž
 = 
pPage
->
pLruP»v
;

39624 
	gpPage
->
	gpLruNext
 = 0;

39625 
	gpPage
->
	gpLruP»v
 = 0;

39626 
	gpPage
->
	gisPšÃd
 = 1;

39627 
	gpCache
->
	gnRecyþabË
--;

39637 
pÿche1RemoveFromHash
(
PgHdr1
 *
pPage
){

39638 
	gh
;

39639 
PCache1
 *
	gpCache
 = 
pPage
->
pCache
;

39640 
PgHdr1
 **
	gµ
;

39642 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCache
->
pGroup
->
mu‹x
) );

39643 
	gh
 = 
pPage
->
iKey
 % 
pCache
->
nHash
;

39644 
	gµ
=&
pCache
->
­Hash
[
h
]; (*µ)!=
pPage
;…p=&(*
µ
)->
pNext
);

39645 *
	gµ
 = (*
µ
)->
pNext
;

39647 
	gpCache
->
	gnPage
--;

39654 
pÿche1EnfÜûMaxPage
(
PGroup
 *
pGroup
){

39655 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pGroup
->
mu‹x
) );

39656  
	gpGroup
->
	gnCu¼’tPage
>pGroup->
	gnMaxPage
 &&…Group->
	gpLruTaž
 ){

39657 
PgHdr1
 *
	gp
 = 
pGroup
->
pLruTaž
;

39658 
as£¹
Ð
p
->
pCache
->
pGroup
==pGroup );

39659 
as£¹
Ð
p
->
isPšÃd
==0 );

39660 
pÿche1PšPage
(
p
);

39661 
pÿche1RemoveFromHash
(
p
);

39662 
pÿche1F»ePage
(
p
);

39673 
pÿche1Trunÿ‹Un§ã
(

39674 
PCache1
 *
pCache
,

39675 
iLim™


39677 
TESTONLY
Ð
nPage
 = 0; )

39678 
	gh
;

39679 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCache
->
pGroup
->
mu‹x
) );

39680 
	gh
=0; h<
	gpCache
->
	gnHash
; h++){

39681 
PgHdr1
 **
	gµ
 = &
pCache
->
­Hash
[
h
];

39682 
PgHdr1
 *
	gpPage
;

39683  (
	gpPage
 = *
µ
)!=0 ){

39684 ifÐ
pPage
->
iKey
>=
iLim™
 ){

39685 
pCache
->
nPage
--;

39686 *
	gµ
 = 
pPage
->
pNext
;

39687 ifÐ!
	gpPage
->
	gisPšÃd
 ) 
pÿche1PšPage
(
pPage
);

39688 
pÿche1F»ePage
(
pPage
);

39690 
	gµ
 = &
pPage
->
pNext
;

39691 
TESTONLY
Ð
nPage
++; )

39695 
as£¹
Ð
pCache
->
nPage
==nPage );

39704 
pÿche1In™
(*
NÙU£d
){

39705 
UNUSED_PARAMETER
(
NÙU£d
);

39706 
as£¹
Ð
pÿche1
.
isIn™
==0 );

39707 
mem£t
(&
pÿche1
, 0, (pcache1));

39708 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 ){

39709 
	gpÿche1
.
	gg½
.
	gmu‹x
 = 
sql™e3_mu‹x_®loc
(
SQLITE_MUTEX_STATIC_LRU
);

39710 
	gpÿche1
.
	gmu‹x
 = 
sql™e3_mu‹x_®loc
(
SQLITE_MUTEX_STATIC_PMEM
);

39712 
	gpÿche1
.
	gg½
.
	gmxPšÃd
 = 10;

39713 
	gpÿche1
.
	gisIn™
 = 1;

39714  
	gSQLITE_OK
;

39722 
pÿche1Shutdown
(*
NÙU£d
){

39723 
UNUSED_PARAMETER
(
NÙU£d
);

39724 
as£¹
Ð
pÿche1
.
isIn™
!=0 );

39725 
mem£t
(&
pÿche1
, 0, (pcache1));

39729 
pÿche1De¡roy
(
sql™e3_pÿche
 *
p
);

39736 
sql™e3_pÿche
 *
pÿche1C»©e
(
szPage
, 
szExŒa
, 
bPurg—bË
){

39737 
PCache1
 *
	gpCache
;

39738 
PGroup
 *
	gpGroup
;

39739 
	gsz
;

39753 #ià
defšed
(
SQLITE_ENABLE_MEMORY_MANAGEMENT
è|| 
SQLITE_THREADSAFE
==0

39754 cÚ¡ 
	g£·¿‹Cache
 = 0;

39756 
	g£·¿‹Cache
 = 
sql™e3Glob®CÚfig
.
bCÜeMu‹x
>0;

39759 
as£¹
Ð(
szPage
 & (szPage-1))==0 && szPage>=512 && szPage<=65536 );

39760 
as£¹
Ð
szExŒa
 < 300 );

39762 
	gsz
 = (
PCache1
è+ (
PGroup
)*
£·¿‹Cache
;

39763 
	gpCache
 = (
PCache1
 *)
sql™e3M®locZ”o
(
sz
);

39764 ifÐ
	gpCache
 ){

39765 ifÐ
	g£·¿‹Cache
 ){

39766 
	gpGroup
 = (
PGroup
*)&
pCache
[1];

39767 
	gpGroup
->
	gmxPšÃd
 = 10;

39769 
	gpGroup
 = &
pÿche1
.
g½
;

39771 
	gpCache
->
	gpGroup
 = 
pGroup
;

39772 
	gpCache
->
	gszPage
 = 
szPage
;

39773 
	gpCache
->
	gszExŒa
 = 
szExŒa
;

39774 
	gpCache
->
	gbPurg—bË
 = (
bPurg—bË
 ? 1 : 0);

39775 
pÿche1EÁ”Mu‹x
(
pGroup
);

39776 
pÿche1ResizeHash
(
pCache
);

39777 ifÐ
	gbPurg—bË
 ){

39778 
	gpCache
->
	gnMš
 = 10;

39779 
	gpGroup
->
	gnMšPage
 +ð
pCache
->
nMš
;

39780 
	gpGroup
->
	gmxPšÃd
 = 
pGroup
->
nMaxPage
 + 10 -…Group->
nMšPage
;

39782 
pÿche1L—veMu‹x
(
pGroup
);

39783 ifÐ
	gpCache
->
	gnHash
==0 ){

39784 
pÿche1De¡roy
((
sql™e3_pÿche
*)
pCache
);

39785 
	gpCache
 = 0;

39788  (
	gsql™e3_pÿche
 *)
	gpCache
;

39796 
pÿche1Cachesize
(
sql™e3_pÿche
 *
p
, 
nMax
){

39797 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

39798 ifÐ
	gpCache
->
	gbPurg—bË
 ){

39799 
PGroup
 *
	gpGroup
 = 
pCache
->
pGroup
;

39800 
pÿche1EÁ”Mu‹x
(
pGroup
);

39801 
	gpGroup
->
	gnMaxPage
 +ð(
nMax
 - 
pCache
->nMax);

39802 
	gpGroup
->
	gmxPšÃd
 = 
pGroup
->
nMaxPage
 + 10 -…Group->
nMšPage
;

39803 
	gpCache
->
	gnMax
 = 
nMax
;

39804 
	gpCache
->
	gn90pù
 = 
pCache
->
nMax
*9/10;

39805 
pÿche1EnfÜûMaxPage
(
pGroup
);

39806 
pÿche1L—veMu‹x
(
pGroup
);

39815 
pÿche1Shršk
(
sql™e3_pÿche
 *
p
){

39816 
PCache1
 *
	gpCache
 = (PCache1*)
p
;

39817 ifÐ
	gpCache
->
	gbPurg—bË
 ){

39818 
PGroup
 *
	gpGroup
 = 
pCache
->
pGroup
;

39819 
	g§vedMaxPage
;

39820 
pÿche1EÁ”Mu‹x
(
pGroup
);

39821 
	g§vedMaxPage
 = 
pGroup
->
nMaxPage
;

39822 
	gpGroup
->
	gnMaxPage
 = 0;

39823 
pÿche1EnfÜûMaxPage
(
pGroup
);

39824 
	gpGroup
->
	gnMaxPage
 = 
§vedMaxPage
;

39825 
pÿche1L—veMu‹x
(
pGroup
);

39832 
pÿche1PagecouÁ
(
sql™e3_pÿche
 *
p
){

39833 
	gn
;

39834 
PCache1
 *
	gpCache
 = (PCache1*)
p
;

39835 
pÿche1EÁ”Mu‹x
(
pCache
->
pGroup
);

39836 
	gn
 = 
pCache
->
nPage
;

39837 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

39838  
	gn
;

39850 
SQLITE_NOINLINE
 
PgHdr1
 *
pÿche1F‘chSge2
(

39851 
PCache1
 *
pCache
,

39852 
iKey
,

39853 
ü—‹FÏg


39855 
	gnPšÃd
;

39856 
PGroup
 *
	gpGroup
 = 
pCache
->
pGroup
;

39857 
PgHdr1
 *
	gpPage
 = 0;

39860 
as£¹
Ð
pCache
->
nPage
 >ðpCache->
nRecyþabË
 );

39861 
	gnPšÃd
 = 
pCache
->
nPage
 -…Cache->
nRecyþabË
;

39862 
as£¹
Ð
pGroup
->
mxPšÃd
 =ðpGroup->
nMaxPage
 + 10 -…Group->
nMšPage
 );

39863 
as£¹
Ð
pCache
->
n90pù
 =ðpCache->
nMax
*9/10 );

39864 ifÐ
	gü—‹FÏg
==1 && (

39865 
nPšÃd
>=
pGroup
->
mxPšÃd


39866 || 
nPšÃd
>=
pCache
->
n90pù


39867 || (
pÿche1Und”MemÜyP»ssu»
(
pCache
è&&…Cache->
nRecyþabË
<
nPšÃd
)

39872 ifÐ
	gpCache
->
	gnPage
>=
pCache
->
nHash
 ) 
pÿche1ResizeHash
(pCache);

39873 
as£¹
Ð
pCache
->
nHash
>0 &&…Cache->
­Hash
 );

39876 ifÐ
	gpCache
->
	gbPurg—bË
 && 
	gpGroup
->
	gpLruTaž
 && (

39877 (
	gpCache
->
	gnPage
+1>=
pCache
->
nMax
)

39878 || 
pGroup
->
nCu¼’tPage
>õGroup->
nMaxPage


39879 || 
pÿche1Und”MemÜyP»ssu»
(
pCache
)

39881 
PCache1
 *
pOth”
;

39882 
	gpPage
 = 
pGroup
->
pLruTaž
;

39883 
as£¹
Ð
pPage
->
isPšÃd
==0 );

39884 
pÿche1RemoveFromHash
(
pPage
);

39885 
pÿche1PšPage
(
pPage
);

39886 
	gpOth”
 = 
pPage
->
pCache
;

39890 
as£¹
Ð(
pCache
->
szPage
 & (pCache->szPage-1))==0 &&…Cache->szPage>=512 );

39891 
as£¹
Ð
pCache
->
szExŒa
<512 );

39892 
as£¹
Ð(
pOth”
->
szPage
 & (pOther->szPage-1))==0 &&…Other->szPage>=512 );

39893 
as£¹
Ð
pOth”
->
szExŒa
<512 );

39895 ifÐ
	gpOth”
->
	gszPage
+pOth”->
	gszExŒa
 !ð
pCache
->
szPage
+pCache->
szExŒa
 ){

39896 
pÿche1F»ePage
(
pPage
);

39897 
	gpPage
 = 0;

39899 
	gpGroup
->
	gnCu¼’tPage
 -ð(
pOth”
->
bPurg—bË
 - 
pCache
->bPurgeable);

39906 ifÐ!
	gpPage
 ){

39907 ifÐ
	gü—‹FÏg
==1 ) 
sql™e3BegšB’ignM®loc
();

39908 
	gpPage
 = 
pÿche1AÎocPage
(
pCache
);

39909 ifÐ
	gü—‹FÏg
==1 ) 
sql™e3EndB’ignM®loc
();

39912 ifÐ
	gpPage
 ){

39913 
	gh
 = 
iKey
 % 
pCache
->
nHash
;

39914 
	gpCache
->
	gnPage
++;

39915 
	gpPage
->
	giKey
 = 
iKey
;

39916 
	gpPage
->
	gpNext
 = 
pCache
->
­Hash
[
h
];

39917 
	gpPage
->
	gpCache
 = 
pCache
;

39918 
	gpPage
->
	gpLruP»v
 = 0;

39919 
	gpPage
->
	gpLruNext
 = 0;

39920 
	gpPage
->
	gisPšÃd
 = 1;

39921 *(**)
	gpPage
->
	g·ge
.
	gpExŒa
 = 0;

39922 
	gpCache
->
	g­Hash
[
h
] = 
pPage
;

39923 ifÐ
	giKey
>
	gpCache
->
	giMaxKey
 ){

39924 
	gpCache
->
	giMaxKey
 = 
iKey
;

39927  
	gpPage
;

39984 
sql™e3_pÿche_·ge
 *
pÿche1F‘ch
(

39985 
sql™e3_pÿche
 *
p
,

39986 
iKey
,

39987 
ü—‹FÏg


39989 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

39990 
PgHdr1
 *
	gpPage
 = 0;

39992 
as£¹
Ð
off£tof
(
PgHdr1
,
·ge
)==0 );

39993 
as£¹
Ð
pCache
->
bPurg—bË
 || 
ü—‹FÏg
!=1 );

39994 
as£¹
Ð
pCache
->
bPurg—bË
 ||…Cache->
nMš
==0 );

39995 
as£¹
Ð
pCache
->
bPurg—bË
==0 ||…Cache->
nMš
==10 );

39996 
as£¹
Ð
pCache
->
nMš
==0 ||…Cache->
bPurg—bË
 );

39997 
as£¹
Ð
pCache
->
nHash
>0 );

39998 
pÿche1EÁ”Mu‹x
(
pCache
->
pGroup
);

40001 
	gpPage
 = 
pCache
->
­Hash
[
iKey
 %…Cache->
nHash
];

40002  
	gpPage
 &&…Page->
	giKey
!=
iKey
 ){ 
pPage
 =…Page->
pNext
; }

40005 ifÐ
	gpPage
 ){

40006 ifÐ!
	gpPage
->
	gisPšÃd
 ) 
pÿche1PšPage
(
pPage
);

40007 }ifÐ
	gü—‹FÏg
 ){

40009 
	gpPage
 = 
pÿche1F‘chSge2
(
pCache
, 
iKey
, 
ü—‹FÏg
);

40011 
as£¹
Ð
pPage
==0 || 
pCache
->
iMaxKey
>=
iKey
 );

40012 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

40013  (
	gsql™e3_pÿche_·ge
*)
	gpPage
;

40022 
pÿche1UÅš
(

40023 
sql™e3_pÿche
 *
p
,

40024 
sql™e3_pÿche_·ge
 *
pPg
,

40025 
»u£UÆik–y


40027 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

40028 
PgHdr1
 *
	gpPage
 = (PgHdr1 *)
pPg
;

40029 
PGroup
 *
	gpGroup
 = 
pCache
->
pGroup
;

40031 
as£¹
Ð
pPage
->
pCache
==pCache );

40032 
pÿche1EÁ”Mu‹x
(
pGroup
);

40037 
as£¹
Ð
pPage
->
pLruP»v
==0 &&…Page->
pLruNext
==0 );

40038 
as£¹
Ð
pGroup
->
pLruH—d
!=
pPage
 &&…Group->
pLruTaž
!=pPage );

40039 
as£¹
Ð
pPage
->
isPšÃd
==1 );

40041 ifÐ
	g»u£UÆik–y
 || 
	gpGroup
->
	gnCu¼’tPage
>pGroup->
	gnMaxPage
 ){

40042 
pÿche1RemoveFromHash
(
pPage
);

40043 
pÿche1F»ePage
(
pPage
);

40046 ifÐ
	gpGroup
->
	gpLruH—d
 ){

40047 
	gpGroup
->
	gpLruH—d
->
	gpLruP»v
 = 
pPage
;

40048 
	gpPage
->
	gpLruNext
 = 
pGroup
->
pLruH—d
;

40049 
	gpGroup
->
	gpLruH—d
 = 
pPage
;

40051 
	gpGroup
->
	gpLruTaž
 = 
pPage
;

40052 
	gpGroup
->
	gpLruH—d
 = 
pPage
;

40054 
	gpCache
->
	gnRecyþabË
++;

40055 
	gpPage
->
	gisPšÃd
 = 0;

40058 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

40064 
pÿche1Rekey
(

40065 
sql™e3_pÿche
 *
p
,

40066 
sql™e3_pÿche_·ge
 *
pPg
,

40067 
iOld
,

40068 
iNew


40070 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

40071 
PgHdr1
 *
	gpPage
 = (PgHdr1 *)
pPg
;

40072 
PgHdr1
 **
	gµ
;

40073 
	gh
;

40074 
as£¹
Ð
pPage
->
iKey
==
iOld
 );

40075 
as£¹
Ð
pPage
->
pCache
==pCache );

40077 
pÿche1EÁ”Mu‹x
(
pCache
->
pGroup
);

40079 
	gh
 = 
iOld
%
pCache
->
nHash
;

40080 
	gµ
 = &
pCache
->
­Hash
[
h
];

40081  (*
	gµ
)!=
pPage
 ){

40082 
µ
 = &(*µ)->
pNext
;

40084 *
	gµ
 = 
pPage
->
pNext
;

40086 
	gh
 = 
iNew
%
pCache
->
nHash
;

40087 
	gpPage
->
	giKey
 = 
iNew
;

40088 
	gpPage
->
	gpNext
 = 
pCache
->
­Hash
[
h
];

40089 
	gpCache
->
	g­Hash
[
h
] = 
pPage
;

40090 ifÐ
	giNew
>
	gpCache
->
	giMaxKey
 ){

40091 
	gpCache
->
	giMaxKey
 = 
iNew
;

40094 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

40104 
pÿche1Trunÿ‹
(
sql™e3_pÿche
 *
p
, 
iLim™
){

40105 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

40106 
pÿche1EÁ”Mu‹x
(
pCache
->
pGroup
);

40107 ifÐ
	giLim™
<=
pCache
->
iMaxKey
 ){

40108 
pÿche1Trunÿ‹Un§ã
(
pCache
, 
iLim™
);

40109 
	gpCache
->
	giMaxKey
 = 
iLim™
-1;

40111 
pÿche1L—veMu‹x
(
pCache
->
pGroup
);

40119 
pÿche1De¡roy
(
sql™e3_pÿche
 *
p
){

40120 
PCache1
 *
	gpCache
 = (PCache1 *)
p
;

40121 
PGroup
 *
	gpGroup
 = 
pCache
->
pGroup
;

40122 
as£¹
Ð
pCache
->
bPurg—bË
 || (pCache->
nMax
==0 &&…Cache->
nMš
==0) );

40123 
pÿche1EÁ”Mu‹x
(
pGroup
);

40124 
pÿche1Trunÿ‹Un§ã
(
pCache
, 0);

40125 
as£¹
Ð
pGroup
->
nMaxPage
 >ð
pCache
->
nMax
 );

40126 
	gpGroup
->
	gnMaxPage
 -ð
pCache
->
nMax
;

40127 
as£¹
Ð
pGroup
->
nMšPage
 >ð
pCache
->
nMš
 );

40128 
	gpGroup
->
	gnMšPage
 -ð
pCache
->
nMš
;

40129 
	gpGroup
->
	gmxPšÃd
 = 
pGroup
->
nMaxPage
 + 10 -…Group->
nMšPage
;

40130 
pÿche1EnfÜûMaxPage
(
pGroup
);

40131 
pÿche1L—veMu‹x
(
pGroup
);

40132 
sql™e3_ä“
(
pCache
->
­Hash
);

40133 
sql™e3_ä“
(
pCache
);

40141 
SQLITE_PRIVATE
 
sql™e3PCacheS‘DeçuÉ
(){

40142 cÚ¡ 
sql™e3_pÿche_m‘hods2
 
	gdeçuÉM‘hods
 = {

40145 
pÿche1In™
,

40146 
pÿche1Shutdown
,

40147 
pÿche1C»©e
,

40148 
pÿche1Cachesize
,

40149 
pÿche1PagecouÁ
,

40150 
pÿche1F‘ch
,

40151 
pÿche1UÅš
,

40152 
pÿche1Rekey
,

40153 
pÿche1Trunÿ‹
,

40154 
pÿche1De¡roy
,

40155 
pÿche1Shršk


40157 
sql™e3_cÚfig
(
SQLITE_CONFIG_PCACHE2
, &
deçuÉM‘hods
);

40160 #ifdeà
SQLITE_ENABLE_MEMORY_MANAGEMENT


40170 
SQLITE_PRIVATE
 
sql™e3PÿcheR–—£MemÜy
(
nReq
){

40171 
	gnF»e
 = 0;

40172 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
pÿche1
.
g½
.
mu‹x
) );

40173 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
pÿche1
.
mu‹x
) );

40174 ifÐ
	gpÿche1
.
	gpS¹
==0 ){

40175 
PgHdr1
 *
p
;

40176 
pÿche1EÁ”Mu‹x
(&
pÿche1
.
g½
);

40177  (
	gnReq
<0 || 
	gnF»e
<nReqè&& ((
	gp
=
pÿche1
.
g½
.
pLruTaž
)!=0) ){

40178 
nF»e
 +ð
pÿche1MemSize
(
p
->
·ge
.
pBuf
);

40179 #ifdeà
SQLITE_PCACHE_SEPARATE_HEADER


40180 
	gnF»e
 +ð
sql™e3MemSize
(
p
);

40182 
as£¹
Ð
p
->
isPšÃd
==0 );

40183 
pÿche1PšPage
(
p
);

40184 
pÿche1RemoveFromHash
(
p
);

40185 
pÿche1F»ePage
(
p
);

40187 
pÿche1L—veMu‹x
(&
pÿche1
.
g½
);

40189  
	gnF»e
;

40193 #ifdeà
SQLITE_TEST


40198 
SQLITE_PRIVATE
 
sql™e3PÿcheSts
(

40199 *
²Cu¼’t
,

40200 *
²Max
,

40201 *
²Mš
,

40202 *
²RecyþabË


40204 
PgHdr1
 *
	gp
;

40205 
	gnRecyþabË
 = 0;

40206 
	gp
=
pÿche1
.
g½
.
pLruH—d
;…;…=
p
->
pLruNext
){

40207 
as£¹
Ð
p
->
isPšÃd
==0 );

40208 
	gnRecyþabË
++;

40210 *
	g²Cu¼’t
 = 
pÿche1
.
g½
.
nCu¼’tPage
;

40211 *
	g²Max
 = ()
pÿche1
.
g½
.
nMaxPage
;

40212 *
	g²Mš
 = ()
pÿche1
.
g½
.
nMšPage
;

40213 *
	g²RecyþabË
 = 
nRecyþabË
;

40286 
	#ROWSET_ALLOCATION_SIZE
 1024

	)

40291 
	#ROWSET_ENTRY_PER_CHUNK
 \

40292 ((
ROWSET_ALLOCATION_SIZE
-8)/(
RowS‘EÁry
))

	)

40302 
	sRowS‘EÁry
 {

40303 
i64
 
	gv
;

40304 
RowS‘EÁry
 *
	gpRight
;

40305 
RowS‘EÁry
 *
	gpLeá
;

40314 
	sRowS‘Chunk
 {

40315 
RowS‘Chunk
 *
	gpNextChunk
;

40316 
RowS‘EÁry
 
	gaEÁry
[
ROWSET_ENTRY_PER_CHUNK
];

40324 
	sRowS‘
 {

40325 
RowS‘Chunk
 *
	gpChunk
;

40326 
sql™e3
 *
	gdb
;

40327 
RowS‘EÁry
 *
	gpEÁry
;

40328 
RowS‘EÁry
 *
	gpLa¡
;

40329 
RowS‘EÁry
 *
	gpF»sh
;

40330 
RowS‘EÁry
 *
	gpFÜe¡
;

40331 
u16
 
	gnF»sh
;

40332 
u16
 
	grsFÏgs
;

40333 
	giB©ch
;

40339 
	#ROWSET_SORTED
 0x01

	)

40340 
	#ROWSET_NEXT
 0x02

	)

40354 
SQLITE_PRIVATE
 
RowS‘
 *
sql™e3RowS‘In™
(
sql™e3
 *
db
, *
pS·û
, 
N
){

40355 
RowS‘
 *
	gp
;

40356 
as£¹
Ð
N
 >ð
ROUND8
((*
p
)) );

40357 
	gp
 = 
pS·û
;

40358 
	gp
->
	gpChunk
 = 0;

40359 
	gp
->
	gdb
 = 
db
;

40360 
	gp
->
	gpEÁry
 = 0;

40361 
	gp
->
	gpLa¡
 = 0;

40362 
	gp
->
	gpFÜe¡
 = 0;

40363 
	gp
->
	gpF»sh
 = (
RowS‘EÁry
*)(
ROUND8
((*
p
)) + (*)p);

40364 
	gp
->
	gnF»sh
 = (
u16
)((
N
 - 
ROUND8
((*
p
)))/(
RowS‘EÁry
));

40365 
	gp
->
	grsFÏgs
 = 
ROWSET_SORTED
;

40366 
	gp
->
	giB©ch
 = 0;

40367  
	gp
;

40375 
SQLITE_PRIVATE
 
sql™e3RowS‘CË¬
(
RowS‘
 *
p
){

40376 
RowS‘Chunk
 *
	gpChunk
, *
	gpNextChunk
;

40377 
	gpChunk
=
p
->
pChunk
;…Chunk;…Chunk = 
pNextChunk
){

40378 
pNextChunk
 = 
pChunk
->pNextChunk;

40379 
sql™e3DbF»e
(
p
->
db
, 
pChunk
);

40381 
	gp
->
	gpChunk
 = 0;

40382 
	gp
->
	gnF»sh
 = 0;

40383 
	gp
->
	gpEÁry
 = 0;

40384 
	gp
->
	gpLa¡
 = 0;

40385 
	gp
->
	gpFÜe¡
 = 0;

40386 
	gp
->
	grsFÏgs
 = 
ROWSET_SORTED
;

40397 
RowS‘EÁry
 *
rowS‘EÁryAÎoc
(
RowS‘
 *
p
){

40398 
as£¹
Ð
p
!=0 );

40399 ifÐ
	gp
->
	gnF»sh
==0 ){

40400 
RowS‘Chunk
 *
pNew
;

40401 
	gpNew
 = 
sql™e3DbM®locRaw
(
p
->
db
, (*
pNew
));

40402 ifÐ
	gpNew
==0 ){

40405 
	gpNew
->
	gpNextChunk
 = 
p
->
pChunk
;

40406 
	gp
->
	gpChunk
 = 
pNew
;

40407 
	gp
->
	gpF»sh
 = 
pNew
->
aEÁry
;

40408 
	gp
->
	gnF»sh
 = 
ROWSET_ENTRY_PER_CHUNK
;

40410 
	gp
->
	gnF»sh
--;

40411  
	gp
->
	gpF»sh
++;

40420 
SQLITE_PRIVATE
 
sql™e3RowS‘In£¹
(
RowS‘
 *
p
, 
i64
 
rowid
){

40421 
RowS‘EÁry
 *
	gpEÁry
;

40422 
RowS‘EÁry
 *
	gpLa¡
;

40425 
as£¹
Ð
p
!=0 && (p->
rsFÏgs
 & 
ROWSET_NEXT
)==0 );

40427 
	gpEÁry
 = 
rowS‘EÁryAÎoc
(
p
);

40428 ifÐ
	gpEÁry
==0 ) ;

40429 
	gpEÁry
->
	gv
 = 
rowid
;

40430 
	gpEÁry
->
	gpRight
 = 0;

40431 
	gpLa¡
 = 
p
->
pLa¡
;

40432 ifÐ
	gpLa¡
 ){

40433 ifÐ(
	gp
->
	grsFÏgs
 & 
	gROWSET_SORTED
)!=0 && 
rowid
<=
pLa¡
->
v
 ){

40434 
p
->
rsFÏgs
 &ð~
ROWSET_SORTED
;

40436 
	gpLa¡
->
	gpRight
 = 
pEÁry
;

40438 
	gp
->
	gpEÁry
 = 
pEÁry
;

40440 
	gp
->
	gpLa¡
 = 
pEÁry
;

40449 
RowS‘EÁry
 *
rowS‘EÁryM”ge
(

40450 
RowS‘EÁry
 *
pA
,

40451 
RowS‘EÁry
 *
pB


40453 
RowS‘EÁry
 
	gh—d
;

40454 
RowS‘EÁry
 *
	gpTaž
;

40456 
	gpTaž
 = &
h—d
;

40457  
	gpA
 && 
	gpB
 ){

40458 
as£¹
Ð
pA
->
pRight
==0 ||…A->
v
<=pA->pRight->v );

40459 
as£¹
Ð
pB
->
pRight
==0 ||…B->
v
<=pB->pRight->v );

40460 ifÐ
	gpA
->
	gv
<
	gpB
->v ){

40461 
	gpTaž
->
	gpRight
 = 
pA
;

40462 
	gpA
 = 
pA
->
pRight
;

40463 
	gpTaž
 = 
pTaž
->
pRight
;

40464 }ifÐ
	gpB
->
	gv
<
	gpA
->v ){

40465 
	gpTaž
->
	gpRight
 = 
pB
;

40466 
	gpB
 = 
pB
->
pRight
;

40467 
	gpTaž
 = 
pTaž
->
pRight
;

40469 
	gpA
 = 
pA
->
pRight
;

40472 ifÐ
	gpA
 ){

40473 
as£¹
Ð
pA
->
pRight
==0 ||…A->
v
<=pA->pRight->v );

40474 
	gpTaž
->
	gpRight
 = 
pA
;

40476 
as£¹
Ð
pB
==0 ||…B->
pRight
==0 ||…B->
v
<=pB->pRight->v );

40477 
	gpTaž
->
	gpRight
 = 
pB
;

40479  
	gh—d
.
	gpRight
;

40486 
RowS‘EÁry
 *
rowS‘EÁrySÜt
(RowS‘EÁry *
pIn
){

40487 
	gi
;

40488 
RowS‘EÁry
 *
	gpNext
, *
	gaBuck‘
[40];

40490 
mem£t
(
aBuck‘
, 0, (aBucket));

40491  
	gpIn
 ){

40492 
	gpNext
 = 
pIn
->
pRight
;

40493 
	gpIn
->
	gpRight
 = 0;

40494 
	gi
=0; 
	gaBuck‘
[
i
]; i++){

40495 
	gpIn
 = 
rowS‘EÁryM”ge
(
aBuck‘
[
i
], 
pIn
);

40496 
	gaBuck‘
[
i
] = 0;

40498 
	gaBuck‘
[
i
] = 
pIn
;

40499 
	gpIn
 = 
pNext
;

40501 
	gpIn
 = 0;

40502 
	gi
=0; i<(
	gaBuck‘
)/(aBucket[0]); i++){

40503 
	gpIn
 = 
rowS‘EÁryM”ge
(
pIn
, 
aBuck‘
[
i
]);

40505  
	gpIn
;

40514 
rowS‘T»eToLi¡
(

40515 
RowS‘EÁry
 *
pIn
,

40516 
RowS‘EÁry
 **
µFœ¡
,

40517 
RowS‘EÁry
 **
µLa¡


40519 
as£¹
Ð
pIn
!=0 );

40520 ifÐ
	gpIn
->
	gpLeá
 ){

40521 
RowS‘EÁry
 *
	gp
;

40522 
rowS‘T»eToLi¡
(
pIn
->
pLeá
, 
µFœ¡
, &
p
);

40523 
	gp
->
	gpRight
 = 
pIn
;

40525 *
	gµFœ¡
 = 
pIn
;

40527 ifÐ
	gpIn
->
	gpRight
 ){

40528 
rowS‘T»eToLi¡
(
pIn
->
pRight
, &pIn->pRight, 
µLa¡
);

40530 *
	gµLa¡
 = 
pIn
;

40532 
as£¹
Ð(*
µLa¡
)->
pRight
==0 );

40549 
RowS‘EÁry
 *
rowS‘ND“pT»e
(

40550 
RowS‘EÁry
 **
µLi¡
,

40551 
iD•th


40553 
RowS‘EÁry
 *
	gp
;

40554 
RowS‘EÁry
 *
	gpLeá
;

40555 ifÐ*
	gµLi¡
==0 ){

40558 ifÐ
	giD•th
==1 ){

40559 
p
 = *
µLi¡
;

40560 *
	gµLi¡
 = 
p
->
pRight
;

40561 
	gp
->
	gpLeá
 = 
p
->
pRight
 = 0;

40562  
	gp
;

40564 
	gpLeá
 = 
rowS‘ND“pT»e
(
µLi¡
, 
iD•th
-1);

40565 
	gp
 = *
µLi¡
;

40566 ifÐ
	gp
==0 ){

40567  
pLeá
;

40569 
	gp
->
	gpLeá
 = 
pLeá
;

40570 *
	gµLi¡
 = 
p
->
pRight
;

40571 
	gp
->
	gpRight
 = 
rowS‘ND“pT»e
(
µLi¡
, 
iD•th
-1);

40572  
	gp
;

40579 
RowS‘EÁry
 *
rowS‘Li¡ToT»e
(RowS‘EÁry *
pLi¡
){

40580 
	giD•th
;

40581 
RowS‘EÁry
 *
	gp
;

40582 
RowS‘EÁry
 *
	gpLeá
;

40584 
as£¹
Ð
pLi¡
!=0 );

40585 
	gp
 = 
pLi¡
;

40586 
	gpLi¡
 = 
p
->
pRight
;

40587 
	gp
->
	gpLeá
 = 
p
->
pRight
 = 0;

40588 
	giD•th
=1; 
	gpLi¡
; iDepth++){

40589 
	gpLeá
 = 
p
;

40590 
	gp
 = 
pLi¡
;

40591 
	gpLi¡
 = 
p
->
pRight
;

40592 
	gp
->
	gpLeá
 = 
pLeá
;

40593 
	gp
->
	gpRight
 = 
rowS‘ND“pT»e
(&
pLi¡
, 
iD•th
);

40595  
	gp
;

40604 
rowS‘ToLi¡
(
RowS‘
 *
p
){

40607 
as£¹
Ð
p
!=0 && (p->
rsFÏgs
 & 
ROWSET_NEXT
)==0 );

40609 ifÐ(
	gp
->
	grsFÏgs
 & 
	gROWSET_SORTED
)==0 ){

40610 
p
->
pEÁry
 = 
rowS‘EÁrySÜt
(p->pEntry);

40617 
as£¹
Ð
p
->
pFÜe¡
==0 );

40619  
	gp
->
	gpFÜe¡
 ){

40620 
RowS‘EÁry
 *
	gpT»e
 = 
p
->
pFÜe¡
->
pLeá
;

40621 ifÐ
	gpT»e
 ){

40622 
RowS‘EÁry
 *
	gpH—d
, *
	gpTaž
;

40623 
rowS‘T»eToLi¡
(
pT»e
, &
pH—d
, &
pTaž
);

40624 
	gp
->
	gpEÁry
 = 
rowS‘EÁryM”ge
(
p
->
pEÁry
, 
pH—d
);

40626 
	gp
->
	gpFÜe¡
 = 
p
->
pFÜe¡
->
pRight
;

40629 
	gp
->
	grsFÏgs
 |ð
ROWSET_NEXT
;

40640 
SQLITE_PRIVATE
 
sql™e3RowS‘Next
(
RowS‘
 *
p
, 
i64
 *
pRowid
){

40641 
as£¹
Ð
p
!=0 );

40644 ifÐ(
	gp
->
	grsFÏgs
 & 
	gROWSET_NEXT
)==0 ) 
rowS‘ToLi¡
(
p
);

40647 ifÐ
	gp
->
	gpEÁry
 ){

40648 *
	gpRowid
 = 
p
->
pEÁry
->
v
;

40649 
	gp
->
	gpEÁry
 = 
p
->
pEÁry
->
pRight
;

40650 ifÐ
	gp
->
	gpEÁry
==0 ){

40651 
sql™e3RowS‘CË¬
(
p
);

40667 
SQLITE_PRIVATE
 
sql™e3RowS‘Te¡
(
RowS‘
 *
pRowS‘
, 
iB©ch
, 
sql™e3_št64
 
iRowid
){

40668 
RowS‘EÁry
 *
	gp
, *
	gpT»e
;

40671 
as£¹
Ð
pRowS‘
!=0 && (pRowS‘->
rsFÏgs
 & 
ROWSET_NEXT
)==0 );

40675 ifÐ
	giB©ch
!=
pRowS‘
->
iB©ch
 ){

40676 
p
 = 
pRowS‘
->
pEÁry
;

40677 ifÐ
	gp
 ){

40678 
RowS‘EÁry
 **
	gµP»vT»e
 = &
pRowS‘
->
pFÜe¡
;

40679 ifÐ(
	gpRowS‘
->
	grsFÏgs
 & 
	gROWSET_SORTED
)==0 ){

40680 
p
 = 
rowS‘EÁrySÜt
(p);

40682 
	gpT»e
 = 
pRowS‘
->
pFÜe¡
;…T»e;…T»e=
pT»e
->
pRight
){

40683 
µP»vT»e
 = &
pT»e
->
pRight
;

40684 ifÐ
	gpT»e
->
	gpLeá
==0 ){

40685 
pT»e
->
pLeá
 = 
rowS‘Li¡ToT»e
(
p
);

40688 
RowS‘EÁry
 *
	gpAux
, *
	gpTaž
;

40689 
rowS‘T»eToLi¡
(
pT»e
->
pLeá
, &
pAux
, &
pTaž
);

40690 
	gpT»e
->
	gpLeá
 = 0;

40691 
	gp
 = 
rowS‘EÁryM”ge
(
pAux
, 
p
);

40694 ifÐ
	gpT»e
==0 ){

40695 *
µP»vT»e
 = 
pT»e
 = 
rowS‘EÁryAÎoc
(
pRowS‘
);

40696 ifÐ
	gpT»e
 ){

40697 
	gpT»e
->
	gv
 = 0;

40698 
	gpT»e
->
	gpRight
 = 0;

40699 
	gpT»e
->
	gpLeá
 = 
rowS‘Li¡ToT»e
(
p
);

40702 
	gpRowS‘
->
	gpEÁry
 = 0;

40703 
	gpRowS‘
->
	gpLa¡
 = 0;

40704 
	gpRowS‘
->
	grsFÏgs
 |ð
ROWSET_SORTED
;

40706 
	gpRowS‘
->
	giB©ch
 = 
iB©ch
;

40712 
	gpT»e
 = 
pRowS‘
->
pFÜe¡
;…T»e;…T»e=
pT»e
->
pRight
){

40713 
p
 = 
pT»e
->
pLeá
;

40714  
	gp
 ){

40715 ifÐ
	gp
->
	gv
<
	giRowid
 ){

40716 
	gp
 = 
p
->
pRight
;

40717 }ifÐ
	gp
->
	gv
>
	giRowid
 ){

40718 
	gp
 = 
p
->
pLeá
;

40749 #iâdeà
SQLITE_OMIT_DISKIO


40768 #iâdeà
_WAL_H_


40769 
	#_WAL_H_


	)

40775 
	#WAL_SYNC_TRANSACTIONS
 0x20

	)

40776 
	#SQLITE_SYNC_MASK
 0x13

	)

40778 #ifdeà
SQLITE_OMIT_WAL


40779 
	#sql™e3W®O³n
(
x
,
y
,
z
è0

	)

40780 
	#sql™e3W®Lim™
(
x
,
y
)

	)

40781 
	#sql™e3W®Clo£
(
w
,
x
,
y
,
z
è0

	)

40782 
	#sql™e3W®BegšR—dT¿n§ùiÚ
(
y
,
z
è0

	)

40783 
	#sql™e3W®EndR—dT¿n§ùiÚ
(
z
)

	)

40784 
	#sql™e3W®Dbsize
(
y
è0

	)

40785 
	#sql™e3W®BegšWr™eT¿n§ùiÚ
(
y
è0

	)

40786 
	#sql™e3W®EndWr™eT¿n§ùiÚ
(
x
è0

	)

40787 
	#sql™e3W®Undo
(
x
,
y
,
z
è0

	)

40788 
	#sql™e3W®Sav•ošt
(
y
,
z
)

	)

40789 
	#sql™e3W®Sav•oštUndo
(
y
,
z
è0

	)

40790 
	#sql™e3W®F¿mes
(
u
,
v
,
w
,
x
,
y
,
z
è0

	)

40791 
	#sql™e3W®Checkpošt
(
r
,
s
,
t
,
u
,
v
,
w
,
x
,
y
,
z
è0

	)

40792 
	#sql™e3W®C®lback
(
z
è0

	)

40793 
	#sql™e3W®ExþusiveMode
(
y
,
z
è0

	)

40794 
	#sql™e3W®H—pMemÜy
(
z
è0

	)

40795 
	#sql™e3W®F¿mesize
(
z
è0

	)

40796 
	#sql™e3W®FšdF¿me
(
x
,
y
,
z
è0

	)

40799 
	#WAL_SAVEPOINT_NDATA
 4

	)

40804 
W®
 
	tW®
;

40807 
SQLITE_PRIVATE
 
sql™e3W®O³n
(
sql™e3_vfs
*, 
sql™e3_fže
*, cÚ¡ *, , 
i64
, 
W®
**);

40808 
SQLITE_PRIVATE
 
sql™e3W®Clo£
(
W®
 *
pW®
, 
sync_æags
, , 
u8
 *);

40811 
SQLITE_PRIVATE
 
sql™e3W®Lim™
(
W®
*, 
i64
);

40820 
SQLITE_PRIVATE
 
sql™e3W®BegšR—dT¿n§ùiÚ
(
W®
 *
pW®
, *);

40821 
SQLITE_PRIVATE
 
sql™e3W®EndR—dT¿n§ùiÚ
(
W®
 *
pW®
);

40824 
SQLITE_PRIVATE
 
sql™e3W®FšdF¿me
(
W®
 *, 
Pgno
, 
u32
 *);

40825 
SQLITE_PRIVATE
 
sql™e3W®R—dF¿me
(
W®
 *, 
u32
, , 
u8
 *);

40828 
SQLITE_PRIVATE
 
Pgno
 
sql™e3W®Dbsize
(
W®
 *
pW®
);

40831 
SQLITE_PRIVATE
 
sql™e3W®BegšWr™eT¿n§ùiÚ
(
W®
 *
pW®
);

40832 
SQLITE_PRIVATE
 
sql™e3W®EndWr™eT¿n§ùiÚ
(
W®
 *
pW®
);

40835 
SQLITE_PRIVATE
 
sql™e3W®Undo
(
W®
 *
pW®
, (*
xUndo
)(*, 
Pgno
), *
pUndoCtx
);

40839 
SQLITE_PRIVATE
 
sql™e3W®Sav•ošt
(
W®
 *
pW®
, 
u32
 *
aW®D©a
);

40843 
SQLITE_PRIVATE
 
sql™e3W®Sav•oštUndo
(
W®
 *
pW®
, 
u32
 *
aW®D©a
);

40846 
SQLITE_PRIVATE
 
sql™e3W®F¿mes
(
W®
 *
pW®
, , 
PgHdr
 *, 
Pgno
, , );

40849 
SQLITE_PRIVATE
 
sql™e3W®Checkpošt
(

40850 
W®
 *
pW®
,

40851 
eMode
,

40852 (*
xBusy
)(*),

40853 *
pBusyArg
,

40854 
sync_æags
,

40855 
nBuf
,

40856 
u8
 *
zBuf
,

40857 *
²Log
,

40858 *
²Ck±


40866 
SQLITE_PRIVATE
 
sql™e3W®C®lback
(
W®
 *
pW®
);

40871 
SQLITE_PRIVATE
 
sql™e3W®ExþusiveMode
(
W®
 *
pW®
, 
Ý
);

40877 
SQLITE_PRIVATE
 
sql™e3W®H—pMemÜy
(
W®
 *
pW®
);

40879 #ifdeà
SQLITE_ENABLE_ZIPVFS


40883 
SQLITE_PRIVATE
 
sql™e3W®F¿mesize
(
W®
 *
pW®
);

40983 
	gsql™e3Pag”T¿û
=1;

40984 
	#sql™e3DebugPrštf
 
´štf


	)

40985 
	#PAGERTRACE
(
X
èifÐ
sql™e3Pag”T¿û
 ){ 
sql™e3DebugPrštf
 X; }

	)

40987 
	#PAGERTRACE
(
X
)

	)

40998 
	#PAGERID
(
p
è(()Õ->
fd
))

	)

40999 
	#FILEHANDLEID
(
fd
è(()fd)

	)

41218 
	#PAGER_OPEN
 0

	)

41219 
	#PAGER_READER
 1

	)

41220 
	#PAGER_WRITER_LOCKED
 2

	)

41221 
	#PAGER_WRITER_CACHEMOD
 3

	)

41222 
	#PAGER_WRITER_DBMOD
 4

	)

41223 
	#PAGER_WRITER_FINISHED
 5

	)

41224 
	#PAGER_ERROR
 6

	)

41274 
	#UNKNOWN_LOCK
 (
EXCLUSIVE_LOCK
+1)

	)

41279 #ifdeà
SQLITE_HAS_CODEC


41280 
	#CODEC1
(
P
,
D
,
N
,
X
,
E
) \

41281 ifÐ
P
->
xCodec
 && P->
	`xCodec
(P->
pCodec
,
D
,
N
,
X
)==0 ){ 
E
; }

	)

41282 
	#CODEC2
(
P
,
D
,
N
,
X
,
E
,
O
) \

41283 ifÐ
P
->
xCodec
==0 ){ 
O
=(*)
D
; }\

41284 ifÐ(
O
=(*)(
P
->
	`xCodec
(P->
pCodec
,
D
,
N
,
X
)))==0 ){ 
E
; }

	)

41286 
	#CODEC1
(
P
,
D
,
N
,
X
,
E
è

	)

41287 
	#CODEC2
(
P
,
D
,
N
,
X
,
E
,
O
èO=(*)
	)
D

41296 
	#MAX_SECTOR_SIZE
 0x10000

	)

41311 
Pag”Sav•ošt
 
	tPag”Sav•ošt
;

41312 
	sPag”Sav•ošt
 {

41313 
i64
 
	giOff£t
;

41314 
i64
 
	giHdrOff£t
;

41315 
B™vec
 *
	gpInSav•ošt
;

41316 
Pgno
 
	gnOrig
;

41317 
Pgno
 
	giSubRec
;

41318 #iâdeà
SQLITE_OMIT_WAL


41319 
u32
 
	gaW®D©a
[
WAL_SAVEPOINT_NDATA
];

41326 
	#SPILLFLAG_OFF
 0x01

	)

41327 
	#SPILLFLAG_ROLLBACK
 0x02

	)

41328 
	#SPILLFLAG_NOSYNC
 0x04

	)

41486 
	sPag”
 {

41487 
sql™e3_vfs
 *
	gpVfs
;

41488 
u8
 
	gexþusiveMode
;

41489 
u8
 
	gjouº®Mode
;

41490 
u8
 
	gu£Jouº®
;

41491 
u8
 
	gnoSync
;

41492 
u8
 
	gfuÎSync
;

41493 
u8
 
	gck±SyncFÏgs
;

41494 
u8
 
	gw®SyncFÏgs
;

41495 
u8
 
	gsyncFÏgs
;

41496 
u8
 
	g‹mpFže
;

41497 
u8
 
	gnoLock
;

41498 
u8
 
	g»adOÆy
;

41499 
u8
 
	gmemDb
;

41510 
u8
 
	geS‹
;

41511 
u8
 
	geLock
;

41512 
u8
 
	gchªgeCouÁDÚe
;

41513 
u8
 
	g£tMa¡”
;

41514 
u8
 
	gdoNÙSpžl
;

41515 
u8
 
	gsubjInMemÜy
;

41516 
Pgno
 
	gdbSize
;

41517 
Pgno
 
	gdbOrigSize
;

41518 
Pgno
 
	gdbFžeSize
;

41519 
Pgno
 
	gdbHštSize
;

41520 
	g”rCode
;

41521 
	gnRec
;

41522 
u32
 
	gcksumIn™
;

41523 
u32
 
	gnSubRec
;

41524 
B™vec
 *
	gpInJouº®
;

41525 
sql™e3_fže
 *
	gfd
;

41526 
sql™e3_fže
 *
	gjfd
;

41527 
sql™e3_fže
 *
	gsjfd
;

41528 
i64
 
	gjouº®Off
;

41529 
i64
 
	gjouº®Hdr
;

41530 
sql™e3_backup
 *
	gpBackup
;

41531 
Pag”Sav•ošt
 *
	gaSav•ošt
;

41532 
	gnSav•ošt
;

41533 
	gdbFžeV”s
[16];

41535 
u8
 
	gbU£F‘ch
;

41536 
	gnMm­Out
;

41537 
sql™e3_št64
 
	gszMm­
;

41538 
PgHdr
 *
	gpMm­F»–i¡
;

41543 
u16
 
	gnExŒa
;

41544 
i16
 
	gnRe£rve
;

41545 
u32
 
	gvfsFÏgs
;

41546 
u32
 
	g£ùÜSize
;

41547 
	g·geSize
;

41548 
Pgno
 
	gmxPgno
;

41549 
i64
 
	gjouº®SizeLim™
;

41550 *
	gzFž’ame
;

41551 *
	gzJouº®
;

41552 (*
	gxBusyHªdËr
)(*);

41553 *
	gpBusyHªdËrArg
;

41554 
	gaSt
[3];

41555 #ifdeà
SQLITE_TEST


41556 
	gnR—d
;

41558 (*
	gxReš™”
)(
	gDbPage
*);

41559 #ifdeà
SQLITE_HAS_CODEC


41560 *(*
	gxCodec
)(*,*,
	gPgno
,);

41561 (*
	gxCodecSizeChng
)(*,,);

41562 (*
	gxCodecF»e
)(*);

41563 *
	gpCodec
;

41565 *
	gpTmpS·û
;

41566 
PCache
 *
	gpPCache
;

41567 #iâdeà
SQLITE_OMIT_WAL


41568 
W®
 *
	gpW®
;

41569 *
	gzW®
;

41578 
	#PAGER_STAT_HIT
 0

	)

41579 
	#PAGER_STAT_MISS
 1

	)

41580 
	#PAGER_STAT_WRITE
 2

	)

41587 #ifdeà
SQLITE_TEST


41588 
SQLITE_API
 
	gsql™e3_·g”_»addb_couÁ
 = 0;

41589 
SQLITE_API
 
	gsql™e3_·g”_wr™edb_couÁ
 = 0;

41590 
SQLITE_API
 
	gsql™e3_·g”_wr™ej_couÁ
 = 0;

41591 
	#PAGER_INCR
(
v
èv++

	)

41593 
	#PAGER_INCR
(
v
)

	)

41621 cÚ¡ 
	gaJouº®Magic
[] = {

41629 
	#JOURNAL_PG_SZ
(
pPag”
è(ÕPag”->
·geSize
è+ 8)

	)

41635 
	#JOURNAL_HDR_SZ
(
pPag”
èÕPag”->
£ùÜSize
)

	)

41643 #ifdeà
SQLITE_OMIT_MEMORYDB


41644 
	#MEMDB
 0

	)

41646 
	#MEMDB
 
pPag”
->
memDb


	)

41653 #ià
SQLITE_MAX_MMAP_SIZE
>0

41654 
	#USEFETCH
(
x
è((x)->
bU£F‘ch
)

	)

41656 
	#USEFETCH
(
x
è0

	)

41662 
	#PAGER_MAX_PGNO
 2147483647

	)

41676 
	#isO³n
(
pFd
è(ÕFd)->
pM‘hods
)

	)

41682 #iâdeà
SQLITE_OMIT_WAL


41683 
·g”U£W®
(
Pag”
 *
pPag”
){

41684  (
	gpPag”
->
	gpW®
!=0);

41687 
	#·g”U£W®
(
x
è0

	)

41688 
	#·g”RÞlbackW®
(
x
è0

	)

41689 
	#·g”W®F¿mes
(
v
,
w
,
x
,
y
è0

	)

41690 
	#·g”O³nW®IfP»£Á
(
z
è
SQLITE_OK


	)

41691 
	#·g”BegšR—dT¿n§ùiÚ
(
z
è
SQLITE_OK


	)

41694 #iâdeà
NDEBUG


41703 
as£¹_·g”_¡©e
(
Pag”
 *
p
){

41704 
Pag”
 *
	gpPag”
 = 
p
;

41707 
as£¹
Ð
p
->
eS‹
==
PAGER_OPEN


41708 || 
p
->
eS‹
==
PAGER_READER


41709 || 
p
->
eS‹
==
PAGER_WRITER_LOCKED


41710 || 
p
->
eS‹
==
PAGER_WRITER_CACHEMOD


41711 || 
p
->
eS‹
==
PAGER_WRITER_DBMOD


41712 || 
p
->
eS‹
==
PAGER_WRITER_FINISHED


41713 || 
p
->
eS‹
==
PAGER_ERROR


41720 
as£¹
Ð
p
->
‹mpFže
==0 ||…->
eLock
==
EXCLUSIVE_LOCK
 );

41721 
as£¹
Ð
p
->
‹mpFže
==0 || 
pPag”
->
chªgeCouÁDÚe
 );

41726 
as£¹
Ð
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF
 ||…->
u£Jouº®
 );

41727 
as£¹
Ð
p
->
jouº®Mode
!=
PAGER_JOURNALMODE_OFF
 || !
isO³n
Õ->
jfd
) );

41737 ifÐ
	gMEMDB
 ){

41738 
as£¹
Ð
p
->
noSync
 );

41739 
as£¹
Ð
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF


41740 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_MEMORY


41742 
as£¹
Ð
p
->
eS‹
!=
PAGER_ERROR
 &&…->eS‹!=
PAGER_OPEN
 );

41743 
as£¹
Ð
·g”U£W®
(
p
)==0 );

41749 
as£¹
Ð
pPag”
->
chªgeCouÁDÚe
==0 ||…Pag”->
eLock
>=
RESERVED_LOCK
 );

41750 
as£¹
Ð
p
->
eLock
!=
PENDING_LOCK
 );

41752  
	gp
->
	geS‹
 ){

41753 
	gPAGER_OPEN
:

41754 
as£¹
Ð!
MEMDB
 );

41755 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41756 
as£¹
Ð
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)==0 ||…Pag”->
‹mpFže
 );

41759 
	gPAGER_READER
:

41760 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41761 
as£¹
Ð
p
->
eLock
!=
UNKNOWN_LOCK
 );

41762 
as£¹
Ð
p
->
eLock
>=
SHARED_LOCK
 );

41765 
	gPAGER_WRITER_LOCKED
:

41766 
as£¹
Ð
p
->
eLock
!=
UNKNOWN_LOCK
 );

41767 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41768 ifÐ!
·g”U£W®
(
pPag”
) ){

41769 
as£¹
Ð
p
->
eLock
>=
RESERVED_LOCK
 );

41771 
as£¹
Ð
pPag”
->
dbSize
=õPag”->
dbOrigSize
 );

41772 
as£¹
Ð
pPag”
->
dbOrigSize
=õPag”->
dbFžeSize
 );

41773 
as£¹
Ð
pPag”
->
dbOrigSize
=õPag”->
dbHštSize
 );

41774 
as£¹
Ð
pPag”
->
£tMa¡”
==0 );

41777 
	gPAGER_WRITER_CACHEMOD
:

41778 
as£¹
Ð
p
->
eLock
!=
UNKNOWN_LOCK
 );

41779 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41780 ifÐ!
·g”U£W®
(
pPag”
) ){

41786 
as£¹
Ð
p
->
eLock
>=
RESERVED_LOCK
 );

41787 
as£¹
Ð
isO³n
(
p
->
jfd
)

41788 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF


41789 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL


41792 
as£¹
Ð
pPag”
->
dbOrigSize
=õPag”->
dbFžeSize
 );

41793 
as£¹
Ð
pPag”
->
dbOrigSize
=õPag”->
dbHštSize
 );

41796 
	gPAGER_WRITER_DBMOD
:

41797 
as£¹
Ð
p
->
eLock
==
EXCLUSIVE_LOCK
 );

41798 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41799 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

41800 
as£¹
Ð
p
->
eLock
>=
EXCLUSIVE_LOCK
 );

41801 
as£¹
Ð
isO³n
(
p
->
jfd
)

41802 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF


41803 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL


41805 
as£¹
Ð
pPag”
->
dbOrigSize
<õPag”->
dbHštSize
 );

41808 
	gPAGER_WRITER_FINISHED
:

41809 
as£¹
Ð
p
->
eLock
==
EXCLUSIVE_LOCK
 );

41810 
as£¹
Ð
pPag”
->
”rCode
==
SQLITE_OK
 );

41811 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

41812 
as£¹
Ð
isO³n
(
p
->
jfd
)

41813 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF


41814 || 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL


41818 
	gPAGER_ERROR
:

41823 
as£¹
Ð
pPag”
->
”rCode
!=
SQLITE_OK
 );

41824 
as£¹
Ð
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)>0 );

41832 #ifdeà
SQLITE_DEBUG


41841 *
´št_·g”_¡©e
(
Pag”
 *
p
){

41842 
	gzR‘
[1024];

41844 
sql™e3_¢´štf
(1024, 
zR‘
,

41853 , 
p
->
zFž’ame


41854 , 
p
->
eS‹
==
PAGER_OPEN
 ? "OPEN" :

41855 
p
->
eS‹
==
PAGER_READER
 ? "READER" :

41856 
p
->
eS‹
==
PAGER_WRITER_LOCKED
 ? "WRITER_LOCKED" :

41857 
p
->
eS‹
==
PAGER_WRITER_CACHEMOD
 ? "WRITER_CACHEMOD" :

41858 
p
->
eS‹
==
PAGER_WRITER_DBMOD
 ? "WRITER_DBMOD" :

41859 
p
->
eS‹
==
PAGER_WRITER_FINISHED
 ? "WRITER_FINISHED" :

41860 
p
->
eS‹
==
PAGER_ERROR
 ? "ERROR" : "?error?"

41861 , ()
p
->
”rCode


41862 , 
p
->
eLock
==
NO_LOCK
 ? "NO_LOCK" :

41863 
p
->
eLock
==
RESERVED_LOCK
 ? "RESERVED" :

41864 
p
->
eLock
==
EXCLUSIVE_LOCK
 ? "EXCLUSIVE" :

41865 
p
->
eLock
==
SHARED_LOCK
 ? "SHARED" :

41866 
p
->
eLock
==
UNKNOWN_LOCK
 ? "UNKNOWN" : "?error?"

41867 , 
p
->
exþusiveMode
 ? "exclusive" : "normal"

41868 , 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_MEMORY
 ? "memory" :

41869 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF
 ? "off" :

41870 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_DELETE
 ? "delete" :

41871 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_PERSIST
 ? "persist" :

41872 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_TRUNCATE
 ? "truncate" :

41873 
p
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL
 ? "wal" : "?error?"

41874 , ()
p
->
‹mpFže
, (í->
memDb
, (í->
u£Jouº®


41875 , 
p
->
jouº®Off
,…->
jouº®Hdr


41876 , ()
p
->
dbSize
, (í->
dbOrigSize
, (í->
dbFžeSize


41879  
	gzR‘
;

41892 
subjRequœesPage
(
PgHdr
 *
pPg
){

41893 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

41894 
Pag”Sav•ošt
 *
	gp
;

41895 
Pgno
 
	gpgno
 = 
pPg
->
pgno
;

41896 
	gi
;

41897 
	gi
=0; i<
	gpPag”
->
	gnSav•ošt
; i++){

41898 
	gp
 = &
pPag”
->
aSav•ošt
[
i
];

41899 ifÐ
	gp
->
	gnOrig
>=
pgno
 && 0==
sql™e3B™vecTe¡
(
p
->
pInSav•ošt
,…gno) ){

41909 
·geInJouº®
(
Pag”
 *
pPag”
, 
PgHdr
 *
pPg
){

41910  
sql™e3B™vecTe¡
(
pPag”
->
pInJouº®
, 
pPg
->
pgno
);

41920 
»ad32b™s
(
sql™e3_fže
 *
fd
, 
i64
 
off£t
, 
u32
 *
pRes
){

41921 
	gac
[4];

41922 
	grc
 = 
sql™e3OsR—d
(
fd
, 
ac
, ×c), 
off£t
);

41923 ifÐ
	grc
==
SQLITE_OK
 ){

41924 *
pRes
 = 
sql™e3G‘4by‹
(
ac
);

41926  
	grc
;

41932 
	#put32b™s
(
A
,
B
è
	`sql™e3Put4by‹
((
u8
*)A,B)

	)

41939 
wr™e32b™s
(
sql™e3_fže
 *
fd
, 
i64
 
off£t
, 
u32
 
v®
){

41940 
	gac
[4];

41941 
put32b™s
(
ac
, 
v®
);

41942  
sql™e3OsWr™e
(
fd
, 
ac
, 4, 
off£t
);

41954 
·g”UÆockDb
(
Pag”
 *
pPag”
, 
eLock
){

41955 
	grc
 = 
SQLITE_OK
;

41957 
as£¹
Ð!
pPag”
->
exþusiveMode
 ||…Pag”->
eLock
==eLock );

41958 
as£¹
Ð
eLock
==
NO_LOCK
 ||ƒLock==
SHARED_LOCK
 );

41959 
as£¹
Ð
eLock
!=
NO_LOCK
 || 
·g”U£W®
(
pPag”
)==0 );

41960 ifÐ
isO³n
(
pPag”
->
fd
) ){

41961 
as£¹
Ð
pPag”
->
eLock
>=eLock );

41962 
	grc
 = 
pPag”
->
noLock
 ? 
SQLITE_OK
 : 
sql™e3OsUÆock
ÕPag”->
fd
, 
eLock
);

41963 ifÐ
	gpPag”
->
	geLock
!=
UNKNOWN_LOCK
 ){

41964 
pPag”
->
eLock
 = (
u8
)eLock;

41966 
IOTRACE
(("UNLOCK %°%d\n", 
pPag”
, 
eLock
))

41968  
	grc
;

41981 
·g”LockDb
(
Pag”
 *
pPag”
, 
eLock
){

41982 
	grc
 = 
SQLITE_OK
;

41984 
as£¹
Ð
eLock
==
SHARED_LOCK
 ||ƒLock==
RESERVED_LOCK
 ||ƒLock==
EXCLUSIVE_LOCK
 );

41985 ifÐ
	gpPag”
->
	geLock
<eLock ||…Pag”->eLock==
UNKNOWN_LOCK
 ){

41986 
rc
 = 
pPag”
->
noLock
 ? 
SQLITE_OK
 : 
sql™e3OsLock
ÕPag”->
fd
, 
eLock
);

41987 ifÐ
	grc
==
SQLITE_OK
 && (
pPag”
->
eLock
!=
UNKNOWN_LOCK
||eLock==
EXCLUSIVE_LOCK
) ){

41988 
pPag”
->
eLock
 = (
u8
)eLock;

41989 
IOTRACE
(("LOCK %°%d\n", 
pPag”
, 
eLock
))

41992  
	grc
;

42012 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


42013 
jºlBufãrSize
(
Pag”
 *
pPag”
){

42014 
as£¹
Ð!
MEMDB
 );

42015 ifÐ!
	gpPag”
->
	g‹mpFže
 ){

42016 
	gdc
;

42017 
	gnSeùÜ
;

42018 
	gszPage
;

42020 
as£¹
Ð
isO³n
(
pPag”
->
fd
) );

42021 
	gdc
 = 
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
fd
);

42022 
	gnSeùÜ
 = 
pPag”
->
£ùÜSize
;

42023 
	gszPage
 = 
pPag”
->
·geSize
;

42025 
as£¹
(
SQLITE_IOCAP_ATOMIC512
==(512>>8));

42026 
as£¹
(
SQLITE_IOCAP_ATOMIC64K
==(65536>>8));

42027 ifÐ0==(
dc
&(
SQLITE_IOCAP_ATOMIC
|(
szPage
>>8)è|| 
nSeùÜ
>szPage) ){

42032  
JOURNAL_HDR_SZ
(
pPag”
è+ 
JOURNAL_PG_SZ
(pPager);

42041 #ifdeà
SQLITE_CHECK_PAGES


42045 
u32
 
·g”_d©ahash
(
nBy‹
, *
pD©a
){

42046 
u32
 
	ghash
 = 0;

42047 
	gi
;

42048 
	gi
=0; i<
	gnBy‹
; i++){

42049 
	ghash
 = (
hash
*1039è+ 
pD©a
[
i
];

42051  
	ghash
;

42053 
u32
 
·g”_·gehash
(
PgHdr
 *
pPage
){

42054  
·g”_d©ahash
(
pPage
->
pPag”
->
·geSize
, (*íPage->
pD©a
);

42056 
·g”_£t_·gehash
(
PgHdr
 *
pPage
){

42057 
	gpPage
->
	g·geHash
 = 
·g”_·gehash
(
pPage
);

42065 
	#CHECK_PAGE
(
x
è
	`checkPage
(x)

	)

42066 
checkPage
(
PgHdr
 *
pPg
){

42067 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

42068 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_ERROR
 );

42069 
as£¹
Ð(
pPg
->
æags
&
PGHDR_DIRTY
è||…Pg->
·geHash
==
·g”_·gehash
(pPg) );

42073 
	#·g”_d©ahash
(
X
,
Y
è0

	)

42074 
	#·g”_·gehash
(
X
è0

	)

42075 
	#·g”_£t_·gehash
(
X
)

	)

42076 
	#CHECK_PAGE
(
x
)

	)

42104 
»adMa¡”Jouº®
(
sql™e3_fže
 *
pJºl
, *
zMa¡”
, 
u32
 
nMa¡”
){

42105 
	grc
;

42106 
u32
 
	gËn
;

42107 
i64
 
	gszJ
;

42108 
u32
 
	gcksum
;

42109 
u32
 
	gu
;

42110 
	gaMagic
[8];

42111 
	gzMa¡”
[0] = '\0';

42113 ifÐ
	gSQLITE_OK
!=(
rc
 = 
sql™e3OsFžeSize
(
pJºl
, &
szJ
))

42114 || 
	gszJ
<16

42115 || 
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pJºl
, 
szJ
-16, &
Ën
))

42116 || 
	gËn
>=
nMa¡”


42117 || 
Ën
==0

42118 || 
SQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pJºl
, 
szJ
-12, &
cksum
))

42119 || 
	gSQLITE_OK
!=(
rc
 = 
sql™e3OsR—d
(
pJºl
, 
aMagic
, 8, 
szJ
-8))

42120 || 
memcmp
(
aMagic
, 
aJouº®Magic
, 8)

42121 || 
	gSQLITE_OK
!=(
rc
 = 
sql™e3OsR—d
(
pJºl
, 
zMa¡”
, 
Ën
, 
szJ
-16-len))

42123  
	grc
;

42127 
	gu
=0; u<
	gËn
; u++){

42128 
	gcksum
 -ð
zMa¡”
[
u
];

42130 ifÐ
	gcksum
 ){

42136 
	gËn
 = 0;

42138 
	gzMa¡”
[
Ën
] = '\0';

42140  
	gSQLITE_OK
;

42158 
i64
 
jouº®HdrOff£t
(
Pag”
 *
pPag”
){

42159 
i64
 
	goff£t
 = 0;

42160 
i64
 
	gc
 = 
pPag”
->
jouº®Off
;

42161 ifÐ
	gc
 ){

42162 
	goff£t
 = ((
c
-1)/
JOURNAL_HDR_SZ
(
pPag”
) + 1) * JOURNAL_HDR_SZ(pPager);

42164 
as£¹
Ð
off£t
%
JOURNAL_HDR_SZ
(
pPag”
)==0 );

42165 
as£¹
Ð
off£t
>=
c
 );

42166 
as£¹
Ð(
off£t
-
c
)<
JOURNAL_HDR_SZ
(
pPag”
) );

42167  
	goff£t
;

42191 
z”oJouº®Hdr
(
Pag”
 *
pPag”
, 
doTrunÿ‹
){

42192 
	grc
 = 
SQLITE_OK
;

42193 
as£¹
Ð
isO³n
(
pPag”
->
jfd
) );

42194 ifÐ
	gpPag”
->
	gjouº®Off
 ){

42195 cÚ¡ 
i64
 
	giLim™
 = 
pPag”
->
jouº®SizeLim™
;

42197 
IOTRACE
(("JZEROHDR %p\n", 
pPag”
))

42198 ifÐ
	gdoTrunÿ‹
 || 
	giLim™
==0 ){

42199 
rc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
jfd
, 0);

42201 cÚ¡ 
	gz”oHdr
[28] = {0};

42202 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, 
z”oHdr
, (zeroHdr), 0);

42204 ifÐ
	grc
==
SQLITE_OK
 && !
pPag”
->
noSync
 ){

42205 
rc
 = 
sql™e3OsSync
(
pPag”
->
jfd
, 
SQLITE_SYNC_DATAONLY
|pPag”->
syncFÏgs
);

42214 ifÐ
	grc
==
SQLITE_OK
 && 
iLim™
>0 ){

42215 
i64
 
sz
;

42216 
	grc
 = 
sql™e3OsFžeSize
(
pPag”
->
jfd
, &
sz
);

42217 ifÐ
	grc
==
SQLITE_OK
 && 
sz
>
iLim™
 ){

42218 
rc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
jfd
, 
iLim™
);

42222  
	grc
;

42240 
wr™eJouº®Hdr
(
Pag”
 *
pPag”
){

42241 
	grc
 = 
SQLITE_OK
;

42242 *
	gzH—d”
 = 
pPag”
->
pTmpS·û
;

42243 
u32
 
	gnH—d”
 = (u32)
pPag”
->
·geSize
;

42244 
u32
 
	gnWr™e
;

42245 
	gii
;

42247 
as£¹
Ð
isO³n
(
pPag”
->
jfd
) );

42249 ifÐ
	gnH—d”
>
JOURNAL_HDR_SZ
(
pPag”
) ){

42250 
	gnH—d”
 = 
JOURNAL_HDR_SZ
(
pPag”
);

42257 
	gii
=0; ii<
	gpPag”
->
	gnSav•ošt
; ii++){

42258 ifÐ
	gpPag”
->
	gaSav•ošt
[
ii
].
	giHdrOff£t
==0 ){

42259 
pPag”
->
aSav•ošt
[
ii
].
iHdrOff£t
 =…Pag”->
jouº®Off
;

42263 
	gpPag”
->
	gjouº®Hdr
 = 
pPag”
->
jouº®Off
 = 
jouº®HdrOff£t
(pPager);

42285 
as£¹
Ð
isO³n
(
pPag”
->
fd
è||…Pag”->
noSync
 );

42286 ifÐ
	gpPag”
->
	gnoSync
 || (pPag”->
	gjouº®Mode
==
PAGER_JOURNALMODE_MEMORY
)

42287 || (
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
fd
)&
SQLITE_IOCAP_SAFE_APPEND
)

42289 
memýy
(
zH—d”
, 
aJouº®Magic
, (aJournalMagic));

42290 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)], 0xffffffff);

42292 
mem£t
(
zH—d”
, 0, (
aJouº®Magic
)+4);

42296 
sql™e3_¿ndomÃss
((
pPag”
->
cksumIn™
), &pPager->cksumInit);

42297 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)+4], 
pPag”
->
cksumIn™
);

42299 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)+8], 
pPag”
->
dbOrigSize
);

42301 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)+12], 
pPag”
->
£ùÜSize
);

42304 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)+16], 
pPag”
->
·geSize
);

42311 
mem£t
(&
zH—d”
[(
aJouº®Magic
)+20], 0,

42312 
nH—d”
-((
aJouº®Magic
)+20));

42331 
	gnWr™e
=0; 
	grc
==
SQLITE_OK
&&
nWr™e
<
JOURNAL_HDR_SZ
(
pPag”
);‚Wr™e+=
nH—d”
){

42332 
IOTRACE
(("JHDR %°%Îd %d\n", 
pPag”
,…Pag”->
jouº®Hdr
, 
nH—d”
))

42333 
rc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, 
zH—d”
, 
nH—d”
,…Pag”->
jouº®Off
);

42334 
as£¹
Ð
pPag”
->
jouº®Hdr
 <ðpPag”->
jouº®Off
 );

42335 
	gpPag”
->
	gjouº®Off
 +ð
nH—d”
;

42338  
	grc
;

42358 
»adJouº®Hdr
(

42359 
Pag”
 *
pPag”
,

42360 
isHÙ
,

42361 
i64
 
jouº®Size
,

42362 
u32
 *
pNRec
,

42363 
u32
 *
pDbSize


42365 
	grc
;

42366 
	gaMagic
[8];

42367 
i64
 
	giHdrOff
;

42369 
as£¹
Ð
isO³n
(
pPag”
->
jfd
) );

42375 
	gpPag”
->
	gjouº®Off
 = 
jouº®HdrOff£t
(
pPag”
);

42376 ifÐ
	gpPag”
->
	gjouº®Off
+
JOURNAL_HDR_SZ
(
pPag”
è> 
	gjouº®Size
 ){

42377  
	gSQLITE_DONE
;

42379 
	giHdrOff
 = 
pPag”
->
jouº®Off
;

42386 ifÐ
	gisHÙ
 || 
	giHdrOff
!=
pPag”
->
jouº®Hdr
 ){

42387 
rc
 = 
sql™e3OsR—d
(
pPag”
->
jfd
, 
aMagic
, ×Magic), 
iHdrOff
);

42388 ifÐ
	grc
 ){

42389  
	grc
;

42391 ifÐ
memcmp
(
aMagic
, 
aJouº®Magic
, (aMagic))!=0 ){

42392  
SQLITE_DONE
;

42400 ifÐ
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pPag”
->
jfd
, 
iHdrOff
+8, 
pNRec
))

42401 || 
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pPag”
->
jfd
, 
iHdrOff
+12, &pPag”->
cksumIn™
))

42402 || 
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pPag”
->
jfd
, 
iHdrOff
+16, 
pDbSize
))

42404  
	grc
;

42407 ifÐ
	gpPag”
->
	gjouº®Off
==0 ){

42408 
u32
 
iPageSize
;

42409 
u32
 
	giSeùÜSize
;

42412 ifÐ
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pPag”
->
jfd
, 
iHdrOff
+20, &
iSeùÜSize
))

42413 || 
	gSQLITE_OK
!=(
rc
 = 
»ad32b™s
(
pPag”
->
jfd
, 
iHdrOff
+24, &
iPageSize
))

42415  
	grc
;

42422 ifÐ
	giPageSize
==0 ){

42423 
iPageSize
 = 
pPag”
->
·geSize
;

42431 ifÐ
	giPageSize
<512 || 
	giSeùÜSize
<32

42432 || 
	giPageSize
>
	gSQLITE_MAX_PAGE_SIZE
 || 
	giSeùÜSize
>
	gMAX_SECTOR_SIZE


42433 || ((
	giPageSize
-1)&iPageSize)!=0 || ((
iSeùÜSize
-1)&iSectorSize)!=0

42440  
SQLITE_DONE
;

42447 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pPag”
, &
iPageSize
, -1);

42448 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

42456 
	gpPag”
->
	g£ùÜSize
 = 
iSeùÜSize
;

42459 
	gpPag”
->
	gjouº®Off
 +ð
JOURNAL_HDR_SZ
(
pPag”
);

42460  
	grc
;

42483 
wr™eMa¡”Jouº®
(
Pag”
 *
pPag”
, cÚ¡ *
zMa¡”
){

42484 
	grc
;

42485 
	gnMa¡”
;

42486 
i64
 
	giHdrOff
;

42487 
i64
 
	gjºlSize
;

42488 
u32
 
	gcksum
 = 0;

42490 
as£¹
Ð
pPag”
->
£tMa¡”
==0 );

42491 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

42493 ifÐ!
	gzMa¡”


42494 || 
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_MEMORY


42495 || !
isO³n
(
pPag”
->
jfd
)

42497  
SQLITE_OK
;

42499 
	gpPag”
->
	g£tMa¡”
 = 1;

42500 
as£¹
Ð
pPag”
->
jouº®Hdr
 <ðpPag”->
jouº®Off
 );

42503 
	gnMa¡”
=0; 
	gzMa¡”
[
nMa¡”
];‚Master++){

42504 
	gcksum
 +ð
zMa¡”
[
nMa¡”
];

42511 ifÐ
	gpPag”
->
	gfuÎSync
 ){

42512 
	gpPag”
->
	gjouº®Off
 = 
jouº®HdrOff£t
(
pPag”
);

42514 
	giHdrOff
 = 
pPag”
->
jouº®Off
;

42519 ifÐ(0 !ð(
rc
 = 
wr™e32b™s
(
pPag”
->
jfd
, 
iHdrOff
, 
PAGER_MJ_PGNO
(pPager))))

42520 || (0 !ð(
rc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, 
zMa¡”
, 
nMa¡”
, 
iHdrOff
+4)))

42521 || (0 !ð(
rc
 = 
wr™e32b™s
(
pPag”
->
jfd
, 
iHdrOff
+4+
nMa¡”
,‚Master)))

42522 || (0 !ð(
rc
 = 
wr™e32b™s
(
pPag”
->
jfd
, 
iHdrOff
+4+
nMa¡”
+4, 
cksum
)))

42523 || (0 !ð(
rc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, 
aJouº®Magic
, 8, 
iHdrOff
+4+
nMa¡”
+8)))

42525  
	grc
;

42527 
	gpPag”
->
	gjouº®Off
 +ð(
nMa¡”
+20);

42539 ifÐ
	gSQLITE_OK
==(
rc
 = 
sql™e3OsFžeSize
(
pPag”
->
jfd
, &
jºlSize
))

42540 && 
	gjºlSize
>
	gpPag”
->
	gjouº®Off


42542 
	grc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
jfd
,…Pag”->
jouº®Off
);

42544  
	grc
;

42550 
·g”_»£t
(
Pag”
 *
pPag”
){

42551 
sql™e3BackupRe¡¬t
(
pPag”
->
pBackup
);

42552 
sql™e3PÿcheCË¬
(
pPag”
->
pPCache
);

42560 
»Ëa£AÎSav•ošts
(
Pag”
 *
pPag”
){

42561 
	gii
;

42562 
	gii
=0; ii<
	gpPag”
->
	gnSav•ošt
; ii++){

42563 
sql™e3B™vecDe¡roy
(
pPag”
->
aSav•ošt
[
ii
].
pInSav•ošt
);

42565 ifÐ!
	gpPag”
->
	gexþusiveMode
 || 
sql™e3IsMemJouº®
(
pPag”
->
sjfd
) ){

42566 
sql™e3OsClo£
(
pPag”
->
sjfd
);

42568 
sql™e3_ä“
(
pPag”
->
aSav•ošt
);

42569 
	gpPag”
->
	gaSav•ošt
 = 0;

42570 
	gpPag”
->
	gnSav•ošt
 = 0;

42571 
	gpPag”
->
	gnSubRec
 = 0;

42579 
addToSav•oštB™vecs
(
Pag”
 *
pPag”
, 
Pgno
 
pgno
){

42580 
	gii
;

42581 
	grc
 = 
SQLITE_OK
;

42583 
	gii
=0; ii<
	gpPag”
->
	gnSav•ošt
; ii++){

42584 
Pag”Sav•ošt
 *
	gp
 = &
pPag”
->
aSav•ošt
[
ii
];

42585 ifÐ
	gpgno
<=
p
->
nOrig
 ){

42586 
rc
 |ð
sql™e3B™vecS‘
(
p
->
pInSav•ošt
, 
pgno
);

42587 
‹¡ÿ£
Ð
rc
==
SQLITE_NOMEM
 );

42588 
as£¹
Ð
rc
==
SQLITE_OK
 ||„c==
SQLITE_NOMEM
 );

42591  
	grc
;

42611 
·g”_uÆock
(
Pag”
 *
pPag”
){

42613 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_READER


42614 || 
pPag”
->
eS‹
==
PAGER_OPEN


42615 || 
pPag”
->
eS‹
==
PAGER_ERROR


42618 
sql™e3B™vecDe¡roy
(
pPag”
->
pInJouº®
);

42619 
	gpPag”
->
	gpInJouº®
 = 0;

42620 
»Ëa£AÎSav•ošts
(
pPag”
);

42622 ifÐ
·g”U£W®
(
pPag”
) ){

42623 
as£¹
Ð!
isO³n
(
pPag”
->
jfd
) );

42624 
sql™e3W®EndR—dT¿n§ùiÚ
(
pPag”
->
pW®
);

42625 
	gpPag”
->
	geS‹
 = 
PAGER_OPEN
;

42626 }ifÐ!
	gpPag”
->
	gexþusiveMode
 ){

42627 
	grc
;

42628 
	giDc
 = 
isO³n
(
pPag”
->
fd
)?
sql™e3OsDeviûCh¬aù”i¡ics
(pPager->fd):0;

42635 
as£¹
Ð(
PAGER_JOURNALMODE_MEMORY
 & 5)!=1 );

42636 
as£¹
Ð(
PAGER_JOURNALMODE_OFF
 & 5)!=1 );

42637 
as£¹
Ð(
PAGER_JOURNALMODE_WAL
 & 5)!=1 );

42638 
as£¹
Ð(
PAGER_JOURNALMODE_DELETE
 & 5)!=1 );

42639 
as£¹
Ð(
PAGER_JOURNALMODE_TRUNCATE
 & 5)==1 );

42640 
as£¹
Ð(
PAGER_JOURNALMODE_PERSIST
 & 5)==1 );

42641 ifÐ0==(
iDc
 & 
SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
)

42642 || 1!=(
pPag”
->
jouº®Mode
 & 5)

42644 
sql™e3OsClo£
(
pPag”
->
jfd
);

42652 
	grc
 = 
·g”UÆockDb
(
pPag”
, 
NO_LOCK
);

42653 ifÐ
	grc
!=
SQLITE_OK
 && 
pPag”
->
eS‹
==
PAGER_ERROR
 ){

42654 
pPag”
->
eLock
 = 
UNKNOWN_LOCK
;

42661 
as£¹
Ð
pPag”
->
”rCode
 ||…Pag”->
eS‹
!=
PAGER_ERROR
 );

42662 
	gpPag”
->
	gchªgeCouÁDÚe
 = 0;

42663 
	gpPag”
->
	geS‹
 = 
PAGER_OPEN
;

42671 ifÐ
	gpPag”
->
	g”rCode
 ){

42672 
as£¹
Ð!
MEMDB
 );

42673 
·g”_»£t
(
pPag”
);

42674 
	gpPag”
->
	gchªgeCouÁDÚe
 = 
pPag”
->
‹mpFže
;

42675 
	gpPag”
->
	geS‹
 = 
PAGER_OPEN
;

42676 
	gpPag”
->
	g”rCode
 = 
SQLITE_OK
;

42677 ifÐ
USEFETCH
(
pPag”
èè
sql™e3OsUnãtch
ÕPag”->
fd
, 0, 0);

42680 
	gpPag”
->
	gjouº®Off
 = 0;

42681 
	gpPag”
->
	gjouº®Hdr
 = 0;

42682 
	gpPag”
->
	g£tMa¡”
 = 0;

42704 
·g”_”rÜ
(
Pag”
 *
pPag”
, 
rc
){

42705 
	grc2
 = 
rc
 & 0xff;

42706 
as£¹
Ð
rc
==
SQLITE_OK
 || !
MEMDB
 );

42707 
as£¹
(

42708 
pPag”
->
”rCode
==
SQLITE_FULL
 ||

42709 
pPag”
->
”rCode
==
SQLITE_OK
 ||

42710 (
pPag”
->
”rCode
 & 0xff)==
SQLITE_IOERR


42712 ifÐ
	grc2
==
SQLITE_FULL
 || 
rc2
==
SQLITE_IOERR
 ){

42713 
pPag”
->
”rCode
 = 
rc
;

42714 
	gpPag”
->
	geS‹
 = 
PAGER_ERROR
;

42716  
	grc
;

42719 
·g”_Œunÿ‹
(
Pag”
 *
pPag”
, 
Pgno
 
nPage
);

42774 
·g”_’d_Œª§ùiÚ
(
Pag”
 *
pPag”
, 
hasMa¡”
, 
bComm™
){

42775 
	grc
 = 
SQLITE_OK
;

42776 
	grc2
 = 
SQLITE_OK
;

42791 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

42792 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_ERROR
 );

42793 ifÐ
	gpPag”
->
	geS‹
<
	gPAGER_WRITER_LOCKED
 &&…Pag”->
	geLock
<
	gRESERVED_LOCK
 ){

42794  
	gSQLITE_OK
;

42797 
»Ëa£AÎSav•ošts
(
pPag”
);

42798 
as£¹
Ð
isO³n
(
pPag”
->
jfd
è||…Pag”->
pInJouº®
==0 );

42799 ifÐ
isO³n
(
pPag”
->
jfd
) ){

42800 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

42803 ifÐ
sql™e3IsMemJouº®
(
pPag”
->
jfd
) ){

42804 
as£¹
Ð
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_MEMORY
 );

42805 
sql™e3OsClo£
(
pPag”
->
jfd
);

42806 }ifÐ
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_TRUNCATE
 ){

42807 ifÐ
pPag”
->
jouº®Off
==0 ){

42808 
rc
 = 
SQLITE_OK
;

42810 
	grc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
jfd
, 0);

42811 ifÐ
	grc
==
SQLITE_OK
 && 
pPag”
->
fuÎSync
 ){

42817 
rc
 = 
sql™e3OsSync
(
pPag”
->
jfd
,…Pag”->
syncFÏgs
);

42820 
	gpPag”
->
	gjouº®Off
 = 0;

42821 }ifÐ
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_PERSIST


42822 || (
pPag”
->
exþusiveMode
 &&…Pag”->
jouº®Mode
!=
PAGER_JOURNALMODE_WAL
)

42824 
rc
 = 
z”oJouº®Hdr
(
pPag”
, 
hasMa¡”
);

42825 
	gpPag”
->
	gjouº®Off
 = 0;

42832 
	gbD–‘e
 = (!
pPag”
->
‹mpFže
 && 
sql™e3Jouº®Exi¡s
ÕPag”->
jfd
));

42833 
as£¹
Ð
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_DELETE


42834 || 
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_MEMORY


42835 || 
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL


42837 
sql™e3OsClo£
(
pPag”
->
jfd
);

42838 ifÐ
	gbD–‘e
 ){

42839 
	grc
 = 
sql™e3OsD–‘e
(
pPag”
->
pVfs
,…Pag”->
zJouº®
, 0);

42844 #ifdeà
SQLITE_CHECK_PAGES


42845 
sql™e3PÿcheI‹¿‹Dœty
(
pPag”
->
pPCache
, 
·g”_£t_·gehash
);

42846 ifÐ
	gpPag”
->
	gdbSize
==0 && 
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)>0 ){

42847 
PgHdr
 *
p
 = 
sql™e3Pag”Lookup
(
pPag”
, 1);

42848 ifÐ
	gp
 ){

42849 
	gp
->
	g·geHash
 = 0;

42850 
sql™e3Pag”UÄefNÙNuÎ
(
p
);

42855 
sql™e3B™vecDe¡roy
(
pPag”
->
pInJouº®
);

42856 
	gpPag”
->
	gpInJouº®
 = 0;

42857 
	gpPag”
->
	gnRec
 = 0;

42858 
sql™e3PÿcheCËªAÎ
(
pPag”
->
pPCache
);

42859 
sql™e3PÿcheTrunÿ‹
(
pPag”
->
pPCache
,…Pag”->
dbSize
);

42861 ifÐ
·g”U£W®
(
pPag”
) ){

42866 
	grc2
 = 
sql™e3W®EndWr™eT¿n§ùiÚ
(
pPag”
->
pW®
);

42867 
as£¹
Ð
rc2
==
SQLITE_OK
 );

42868 }ifÐ
	grc
==
SQLITE_OK
 && 
bComm™
 && 
pPag”
->
dbFžeSize
>pPag”->
dbSize
 ){

42875 
as£¹
Ð
pPag”
->
eLock
==
EXCLUSIVE_LOCK
 );

42876 
	grc
 = 
·g”_Œunÿ‹
(
pPag”
,…Pag”->
dbSize
);

42879 ifÐ
	grc
==
SQLITE_OK
 && 
bComm™
 && 
isO³n
(
pPag”
->
fd
) ){

42880 
rc
 = 
sql™e3OsFžeCÚŒÞ
(
pPag”
->
fd
, 
SQLITE_FCNTL_COMMIT_PHASETWO
, 0);

42881 ifÐ
	grc
==
SQLITE_NOTFOUND
 ) 
rc
 = 
SQLITE_OK
;

42884 ifÐ!
	gpPag”
->
	gexþusiveMode


42885 && (!
·g”U£W®
(
pPag”
è|| 
sql™e3W®ExþusiveMode
ÕPag”->
pW®
, 0))

42887 
	grc2
 = 
·g”UÆockDb
(
pPag”
, 
SHARED_LOCK
);

42888 
	gpPag”
->
	gchªgeCouÁDÚe
 = 0;

42890 
	gpPag”
->
	geS‹
 = 
PAGER_READER
;

42891 
	gpPag”
->
	g£tMa¡”
 = 0;

42893  (
	grc
==
SQLITE_OK
?
rc2
:
rc
);

42913 
·g”UÆockAndRÞlback
(
Pag”
 *
pPag”
){

42914 ifÐ
	gpPag”
->
	geS‹
!=
PAGER_ERROR
 && 
pPag”
->
eS‹
!=
PAGER_OPEN
 ){

42915 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

42916 ifÐ
	gpPag”
->
	geS‹
>=
PAGER_WRITER_LOCKED
 ){

42917 
sql™e3BegšB’ignM®loc
();

42918 
sql™e3Pag”RÞlback
(
pPag”
);

42919 
sql™e3EndB’ignM®loc
();

42920 }ifÐ!
	gpPag”
->
	gexþusiveMode
 ){

42921 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_READER
 );

42922 
·g”_’d_Œª§ùiÚ
(
pPag”
, 0, 0);

42925 
·g”_uÆock
(
pPag”
);

42947 
u32
 
·g”_cksum
(
Pag”
 *
pPag”
, cÚ¡ 
u8
 *
aD©a
){

42948 
u32
 
	gcksum
 = 
pPag”
->
cksumIn™
;

42949 
	gi
 = 
pPag”
->
·geSize
-200;

42950  
	gi
>0 ){

42951 
	gcksum
 +ð
aD©a
[
i
];

42952 
	gi
 -= 200;

42954  
	gcksum
;

42961 #ifdeà
SQLITE_HAS_CODEC


42962 
·g”R•ÜtSize
(
Pag”
 *
pPag”
){

42963 ifÐ
	gpPag”
->
	gxCodecSizeChng
 ){

42964 
	gpPag”
->
xCodecSizeChng
(
pPag”
->
pCodec
,…Pag”->
·geSize
,

42965 ()
pPag”
->
nRe£rve
);

42969 
	#·g”R•ÜtSize
(
X
è

	)

43009 
·g”_¶ayback_Úe_·ge
(

43010 
Pag”
 *
pPag”
,

43011 
i64
 *
pOff£t
,

43012 
B™vec
 *
pDÚe
,

43013 
isMašJºl
,

43014 
isSav•Á


43016 
	grc
;

43017 
PgHdr
 *
	gpPg
;

43018 
Pgno
 
	gpgno
;

43019 
u32
 
	gcksum
;

43020 *
	gaD©a
;

43021 
sql™e3_fže
 *
	gjfd
;

43022 
	gisSynûd
;

43024 
as£¹
Ð(
isMašJºl
&~1)==0 );

43025 
as£¹
Ð(
isSav•Á
&~1)==0 );

43026 
as£¹
Ð
isMašJºl
 || 
pDÚe
 );

43027 
as£¹
Ð
isSav•Á
 || 
pDÚe
==0 );

43029 
	gaD©a
 = 
pPag”
->
pTmpS·û
;

43030 
as£¹
Ð
aD©a
 );

43031 
as£¹
Ð
·g”U£W®
(
pPag”
)==0 || (!
isMašJºl
 && 
isSav•Á
) );

43039 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_CACHEMOD


43040 || (
pPag”
->
eS‹
==
PAGER_OPEN
 &&…Pag”->
eLock
==
EXCLUSIVE_LOCK
)

43042 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_CACHEMOD
 || 
isMašJºl
 );

43047 
	gjfd
 = 
isMašJºl
 ? 
pPag”
->
jfd
 :…Pag”->
sjfd
;

43048 
	grc
 = 
»ad32b™s
(
jfd
, *
pOff£t
, &
pgno
);

43049 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

43050 
	grc
 = 
sql™e3OsR—d
(
jfd
, (
u8
*)
aD©a
, 
pPag”
->
·geSize
, (*
pOff£t
)+4);

43051 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

43052 *
	gpOff£t
 +ð
pPag”
->
·geSize
 + 4 + 
isMašJºl
*4;

43059 ifÐ
	gpgno
==0 || 
pgno
==
PAGER_MJ_PGNO
(
pPag”
) ){

43060 
as£¹
Ð!
isSav•Á
 );

43061  
	gSQLITE_DONE
;

43063 ifÐ
	gpgno
>(
	gPgno
)
	gpPag”
->
	gdbSize
 || 
sql™e3B™vecTe¡
(
pDÚe
, 
pgno
) ){

43064  
	gSQLITE_OK
;

43066 ifÐ
	gisMašJºl
 ){

43067 
	grc
 = 
»ad32b™s
(
jfd
, (*
pOff£t
)-4, &
cksum
);

43068 ifÐ
	grc
 ) „c;

43069 ifÐ!
	gisSav•Á
 && 
·g”_cksum
(
pPag”
, (
u8
*)
aD©a
)!=
cksum
 ){

43070  
SQLITE_DONE
;

43077 ifÐ
	gpDÚe
 && (
	grc
 = 
sql™e3B™vecS‘
(
pDÚe
, 
pgno
))!=
SQLITE_OK
 ){

43078  
rc
;

43083 ifÐ
	gpgno
==1 && 
pPag”
->
nRe£rve
!=((
u8
*)
aD©a
)[20] ){

43084 
pPag”
->
nRe£rve
 = ((
u8
*)
aD©a
)[20];

43085 
·g”R•ÜtSize
(
pPag”
);

43123 ifÐ
·g”U£W®
(
pPag”
) ){

43124 
	gpPg
 = 0;

43126 
	gpPg
 = 
sql™e3Pag”Lookup
(
pPag”
, 
pgno
);

43128 
as£¹
Ð
pPg
 || !
MEMDB
 );

43129 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_OPEN
 || 
pPg
==0 );

43130 
PAGERTRACE
(("PLAYBACK %d…age %d hash(%08x) %s\n",

43131 
PAGERID
(
pPag”
), 
pgno
, 
·g”_d©ahash
ÕPag”->
·geSize
, (
u8
*)
aD©a
),

43132 (
isMašJºl
?"main-journal":"sub-journal")

43134 ifÐ
	gisMašJºl
 ){

43135 
	gisSynûd
 = 
pPag”
->
noSync
 || (*
pOff£t
 <ðpPag”->
jouº®Hdr
);

43137 
	gisSynûd
 = (
pPg
==0 || 0==ÕPg->
æags
 & 
PGHDR_NEED_SYNC
));

43139 ifÐ
isO³n
(
pPag”
->
fd
)

43140 && (
	gpPag”
->
	geS‹
>=
PAGER_WRITER_DBMOD
 || 
pPag”
->
eS‹
==
PAGER_OPEN
)

43141 && 
isSynûd


43143 
i64
 
of¡
 = (
pgno
-1)*(i64)
pPag”
->
·geSize
;

43144 
‹¡ÿ£
Ð!
isSav•Á
 && 
pPg
!=0 && (pPg->
æags
&
PGHDR_NEED_SYNC
)!=0 );

43145 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

43146 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
fd
, (
u8
 *)
aD©a
,…Pag”->
·geSize
, 
of¡
);

43147 ifÐ
	gpgno
>
	gpPag”
->
	gdbFžeSize
 ){

43148 
	gpPag”
->
	gdbFžeSize
 = 
pgno
;

43150 ifÐ
	gpPag”
->
	gpBackup
 ){

43151 
CODEC1
(
pPag”
, 
aD©a
, 
pgno
, 3, 
rc
=
SQLITE_NOMEM
);

43152 
sql™e3BackupUpd©e
(
pPag”
->
pBackup
, 
pgno
, (
u8
*)
aD©a
);

43153 
CODEC2
(
pPag”
, 
aD©a
, 
pgno
, 7, 
rc
=
SQLITE_NOMEM
,‡Data);

43155 }ifÐ!
	gisMašJºl
 && 
	gpPg
==0 ){

43172 
as£¹
Ð
isSav•Á
 );

43173 
as£¹
Ð(
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_ROLLBACK
)==0 );

43174 
	gpPag”
->
	gdoNÙSpžl
 |ð
SPILLFLAG_ROLLBACK
;

43175 
	grc
 = 
sql™e3Pag”Acquœe
(
pPag”
, 
pgno
, &
pPg
, 1);

43176 
as£¹
Ð(
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_ROLLBACK
)!=0 );

43177 
	gpPag”
->
	gdoNÙSpžl
 &ð~
SPILLFLAG_ROLLBACK
;

43178 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

43179 
	gpPg
->
	gæags
 &ð~
PGHDR_NEED_READ
;

43180 
sql™e3PÿcheMakeDœty
(
pPg
);

43182 ifÐ
	gpPg
 ){

43189 *
	gpD©a
;

43190 
	gpD©a
 = 
pPg
->
pD©a
;

43191 
memýy
(
pD©a
, (
u8
*)
aD©a
, 
pPag”
->
·geSize
);

43192 
	gpPag”
->
xReš™”
(
pPg
);

43193 ifÐ
	gisMašJºl
 && (!
	gisSav•Á
 || *
	gpOff£t
<=
pPag”
->
jouº®Hdr
) ){

43213 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

43214 
sql™e3PÿcheMakeCËª
(
pPg
);

43216 
·g”_£t_·gehash
(
pPg
);

43220 ifÐ
	gpgno
==1 ){

43221 
memýy
(&
pPag”
->
dbFžeV”s
, &((
u8
*)
pD©a
)[24],(pPager->dbFileVers));

43225 
CODEC1
(
pPag”
, 
pD©a
, 
pPg
->
pgno
, 3, 
rc
=
SQLITE_NOMEM
);

43226 
sql™e3PÿcheR–—£
(
pPg
);

43228  
	grc
;

43274 
·g”_d–ma¡”
(
Pag”
 *
pPag”
, cÚ¡ *
zMa¡”
){

43275 
sql™e3_vfs
 *
	gpVfs
 = 
pPag”
->
pVfs
;

43276 
	grc
;

43277 
sql™e3_fže
 *
	gpMa¡”
;

43278 
sql™e3_fže
 *
	gpJouº®
;

43279 *
	gzMa¡”Jouº®
 = 0;

43280 
i64
 
	gnMa¡”Jouº®
;

43281 *
	gzJouº®
;

43282 *
	gzMa¡”PŒ
;

43283 
	gnMa¡”PŒ
;

43288 
	gpMa¡”
 = (
sql™e3_fže
 *)
sql™e3M®locZ”o
(
pVfs
->
szOsFže
 * 2);

43289 
	gpJouº®
 = (
sql™e3_fže
 *)(((
u8
 *)
pMa¡”
è+ 
pVfs
->
szOsFže
);

43290 ifÐ!
	gpMa¡”
 ){

43291 
	grc
 = 
SQLITE_NOMEM
;

43293 cÚ¡ 
	gæags
 = (
SQLITE_OPEN_READONLY
|
SQLITE_OPEN_MASTER_JOURNAL
);

43294 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
zMa¡”
, 
pMa¡”
, 
æags
, 0);

43296 ifÐ
	grc
!=
SQLITE_OK
 ) 
d–ma¡”_out
;

43303 
	grc
 = 
sql™e3OsFžeSize
(
pMa¡”
, &
nMa¡”Jouº®
);

43304 ifÐ
	grc
!=
SQLITE_OK
 ) 
d–ma¡”_out
;

43305 
	gnMa¡”PŒ
 = 
pVfs
->
mxP©hÇme
+1;

43306 
	gzMa¡”Jouº®
 = 
sql™e3M®loc
(
nMa¡”Jouº®
 + 
nMa¡”PŒ
 + 1);

43307 ifÐ!
	gzMa¡”Jouº®
 ){

43308 
	grc
 = 
SQLITE_NOMEM
;

43309 
	gd–ma¡”_out
;

43311 
	gzMa¡”PŒ
 = &
zMa¡”Jouº®
[
nMa¡”Jouº®
+1];

43312 
	grc
 = 
sql™e3OsR—d
(
pMa¡”
, 
zMa¡”Jouº®
, ()
nMa¡”Jouº®
, 0);

43313 ifÐ
	grc
!=
SQLITE_OK
 ) 
d–ma¡”_out
;

43314 
	gzMa¡”Jouº®
[
nMa¡”Jouº®
] = 0;

43316 
	gzJouº®
 = 
zMa¡”Jouº®
;

43317  (
	gzJouº®
-
	gzMa¡”Jouº®
)<
	gnMa¡”Jouº®
 ){

43318 
	gexi¡s
;

43319 
	grc
 = 
sql™e3OsAcûss
(
pVfs
, 
zJouº®
, 
SQLITE_ACCESS_EXISTS
, &
exi¡s
);

43320 ifÐ
	grc
!=
SQLITE_OK
 ){

43321 
d–ma¡”_out
;

43323 ifÐ
	gexi¡s
 ){

43328 
	gc
;

43329 
	gæags
 = (
SQLITE_OPEN_READONLY
|
SQLITE_OPEN_MAIN_JOURNAL
);

43330 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
zJouº®
, 
pJouº®
, 
æags
, 0);

43331 ifÐ
	grc
!=
SQLITE_OK
 ){

43332 
d–ma¡”_out
;

43335 
	grc
 = 
»adMa¡”Jouº®
(
pJouº®
, 
zMa¡”PŒ
, 
nMa¡”PŒ
);

43336 
sql™e3OsClo£
(
pJouº®
);

43337 ifÐ
	grc
!=
SQLITE_OK
 ){

43338 
d–ma¡”_out
;

43341 
	gc
 = 
zMa¡”PŒ
[0]!=0 && 
¡rcmp
(zMa¡”PŒ, 
zMa¡”
)==0;

43342 ifÐ
	gc
 ){

43344 
	gd–ma¡”_out
;

43347 
	gzJouº®
 +ð(
sql™e3SŒËn30
(
zJouº®
)+1);

43350 
sql™e3OsClo£
(
pMa¡”
);

43351 
	grc
 = 
sql™e3OsD–‘e
(
pVfs
, 
zMa¡”
, 0);

43353 
	gd–ma¡”_out
:

43354 
sql™e3_ä“
(
zMa¡”Jouº®
);

43355 ifÐ
	gpMa¡”
 ){

43356 
sql™e3OsClo£
(
pMa¡”
);

43357 
as£¹
Ð!
isO³n
(
pJouº®
) );

43358 
sql™e3_ä“
(
pMa¡”
);

43360  
	grc
;

43384 
·g”_Œunÿ‹
(
Pag”
 *
pPag”
, 
Pgno
 
nPage
){

43385 
	grc
 = 
SQLITE_OK
;

43386 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_ERROR
 );

43387 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_READER
 );

43389 ifÐ
isO³n
(
pPag”
->
fd
)

43390 && (
	gpPag”
->
	geS‹
>=
PAGER_WRITER_DBMOD
 || 
pPag”
->
eS‹
==
PAGER_OPEN
)

43392 
i64
 
cu¼’tSize
, 
ÃwSize
;

43393 
	gszPage
 = 
pPag”
->
·geSize
;

43394 
as£¹
Ð
pPag”
->
eLock
==
EXCLUSIVE_LOCK
 );

43396 
	grc
 = 
sql™e3OsFžeSize
(
pPag”
->
fd
, &
cu¼’tSize
);

43397 
	gÃwSize
 = 
szPage
*(
i64
)
nPage
;

43398 ifÐ
	grc
==
SQLITE_OK
 && 
cu¼’tSize
!=
ÃwSize
 ){

43399 ifÐ
cu¼’tSize
>
ÃwSize
 ){

43400 
rc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
fd
, 
ÃwSize
);

43401 }ifÐ(
	gcu¼’tSize
+
	gszPage
)<=
ÃwSize
 ){

43402 *
pTmp
 = 
pPag”
->
pTmpS·û
;

43403 
mem£t
(
pTmp
, 0, 
szPage
);

43404 
‹¡ÿ£
Ð(
ÃwSize
-
szPage
è=ð
cu¼’tSize
 );

43405 
‹¡ÿ£
Ð(
ÃwSize
-
szPage
è> 
cu¼’tSize
 );

43406 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
fd
, 
pTmp
, 
szPage
, 
ÃwSize
-szPage);

43408 ifÐ
	grc
==
SQLITE_OK
 ){

43409 
pPag”
->
dbFžeSize
 = 
nPage
;

43413  
	grc
;

43420 
SQLITE_PRIVATE
 
sql™e3SeùÜSize
(
sql™e3_fže
 *
pFže
){

43421 
	giR‘
 = 
sql™e3OsSeùÜSize
(
pFže
);

43422 ifÐ
	giR‘
<32 ){

43423 
	giR‘
 = 512;

43424 }ifÐ
	giR‘
>
	gMAX_SECTOR_SIZE
 ){

43425 
as£¹
Ð
MAX_SECTOR_SIZE
>=512 );

43426 
	giR‘
 = 
MAX_SECTOR_SIZE
;

43428  
	giR‘
;

43454 
£tSeùÜSize
(
Pag”
 *
pPag”
){

43455 
as£¹
Ð
isO³n
(
pPag”
->
fd
è||…Pag”->
‹mpFže
 );

43457 ifÐ
	gpPag”
->
	g‹mpFže


43458 || (
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
fd
) &

43459 
	gSQLITE_IOCAP_POWERSAFE_OVERWRITE
)!=0

43464 
pPag”
->
£ùÜSize
 = 512;

43466 
	gpPag”
->
	g£ùÜSize
 = 
sql™e3SeùÜSize
(
pPag”
->
fd
);

43527 
·g”_¶ayback
(
Pag”
 *
pPag”
, 
isHÙ
){

43528 
sql™e3_vfs
 *
	gpVfs
 = 
pPag”
->
pVfs
;

43529 
i64
 
	gszJ
;

43530 
u32
 
	gnRec
;

43531 
u32
 
	gu
;

43532 
Pgno
 
	gmxPg
 = 0;

43533 
	grc
;

43534 
	g»s
 = 1;

43535 *
	gzMa¡”
 = 0;

43536 
	gÃedPag”Re£t
;

43537 
	gnPÏyback
 = 0;

43542 
as£¹
Ð
isO³n
(
pPag”
->
jfd
) );

43543 
	grc
 = 
sql™e3OsFžeSize
(
pPag”
->
jfd
, &
szJ
);

43544 ifÐ
	grc
!=
SQLITE_OK
 ){

43545 
’d_¶ayback
;

43559 
	gzMa¡”
 = 
pPag”
->
pTmpS·û
;

43560 
	grc
 = 
»adMa¡”Jouº®
(
pPag”
->
jfd
, 
zMa¡”
,…Pag”->
pVfs
->
mxP©hÇme
+1);

43561 ifÐ
	grc
==
SQLITE_OK
 && 
zMa¡”
[0] ){

43562 
rc
 = 
sql™e3OsAcûss
(
pVfs
, 
zMa¡”
, 
SQLITE_ACCESS_EXISTS
, &
»s
);

43564 
	gzMa¡”
 = 0;

43565 ifÐ
	grc
!=
SQLITE_OK
 || !
»s
 ){

43566 
’d_¶ayback
;

43568 
	gpPag”
->
	gjouº®Off
 = 0;

43569 
	gÃedPag”Re£t
 = 
isHÙ
;

43581 
	grc
 = 
»adJouº®Hdr
(
pPag”
, 
isHÙ
, 
szJ
, &
nRec
, &
mxPg
);

43582 ifÐ
	grc
!=
SQLITE_OK
 ){

43583 ifÐ
rc
==
SQLITE_DONE
 ){

43584 
rc
 = 
SQLITE_OK
;

43586 
	g’d_¶ayback
;

43594 ifÐ
	gnRec
==0xffffffff ){

43595 
as£¹
Ð
pPag”
->
jouº®Off
==
JOURNAL_HDR_SZ
(pPager) );

43596 
	gnRec
 = ()((
szJ
 - 
JOURNAL_HDR_SZ
(
pPag”
))/
JOURNAL_PG_SZ
(pPager));

43613 ifÐ
	gnRec
==0 && !
isHÙ
 &&

43614 
pPag”
->
jouº®Hdr
+
JOURNAL_HDR_SZ
ÕPag”)=õPag”->
jouº®Off
 ){

43615 
nRec
 = ()((
szJ
 - 
pPag”
->
jouº®Off
è/ 
JOURNAL_PG_SZ
(pPager));

43621 ifÐ
	gpPag”
->
	gjouº®Off
==
JOURNAL_HDR_SZ
(
pPag”
) ){

43622 
rc
 = 
·g”_Œunÿ‹
(
pPag”
, 
mxPg
);

43623 ifÐ
	grc
!=
SQLITE_OK
 ){

43624 
’d_¶ayback
;

43626 
	gpPag”
->
	gdbSize
 = 
mxPg
;

43632 
	gu
=0; u<
	gnRec
; u++){

43633 ifÐ
	gÃedPag”Re£t
 ){

43634 
·g”_»£t
(
pPag”
);

43635 
	gÃedPag”Re£t
 = 0;

43637 
	grc
 = 
·g”_¶ayback_Úe_·ge
(
pPag”
,&pPag”->
jouº®Off
,0,1,0);

43638 ifÐ
	grc
==
SQLITE_OK
 ){

43639 
nPÏyback
++;

43641 ifÐ
	grc
==
SQLITE_DONE
 ){

43642 
pPag”
->
jouº®Off
 = 
szJ
;

43644 }ifÐ
	grc
==
SQLITE_IOERR_SHORT_READ
 ){

43650 
rc
 = 
SQLITE_OK
;

43651 
	g’d_¶ayback
;

43658 
	g’d_¶ayback
;

43664 
as£¹
( 0 );

43666 
	g’d_¶ayback
:

43672 #ifdeà
SQLITE_DEBUG


43673 ifÐ
pPag”
->
fd
->
pM‘hods
 ){

43674 
sql™e3OsFžeCÚŒÞHšt
(
pPag”
->
fd
,
SQLITE_FCNTL_DB_UNCHANGED
,0);

43687 
	gpPag”
->
	gchªgeCouÁDÚe
 = 
pPag”
->
‹mpFže
;

43689 ifÐ
	grc
==
SQLITE_OK
 ){

43690 
zMa¡”
 = 
pPag”
->
pTmpS·û
;

43691 
	grc
 = 
»adMa¡”Jouº®
(
pPag”
->
jfd
, 
zMa¡”
,…Pag”->
pVfs
->
mxP©hÇme
+1);

43692 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

43694 ifÐ
	grc
==
SQLITE_OK


43695 && (
pPag”
->
eS‹
>=
PAGER_WRITER_DBMOD
 ||…Pag”->eS‹==
PAGER_OPEN
)

43697 
rc
 = 
sql™e3Pag”Sync
(
pPag”
, 0);

43699 ifÐ
	grc
==
SQLITE_OK
 ){

43700 
rc
 = 
·g”_’d_Œª§ùiÚ
(
pPag”
, 
zMa¡”
[0]!='\0', 0);

43701 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

43703 ifÐ
	grc
==
SQLITE_OK
 && 
zMa¡”
[0] && 
»s
 ){

43707 
rc
 = 
·g”_d–ma¡”
(
pPag”
, 
zMa¡”
);

43708 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

43710 ifÐ
	gisHÙ
 && 
	gnPÏyback
 ){

43711 
sql™e3_log
(
SQLITE_NOTICE_RECOVER_ROLLBACK
, "recovered %d…ages from %s",

43712 
nPÏyback
, 
pPag”
->
zJouº®
);

43719 
£tSeùÜSize
(
pPag”
);

43720  
	grc
;

43735 
»adDbPage
(
PgHdr
 *
pPg
, 
u32
 
iF¿me
){

43736 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

43737 
Pgno
 
	gpgno
 = 
pPg
->
pgno
;

43738 
	grc
 = 
SQLITE_OK
;

43739 
	gpgsz
 = 
pPag”
->
·geSize
;

43741 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_READER
 && !
MEMDB
 );

43742 
as£¹
Ð
isO³n
(
pPag”
->
fd
) );

43744 #iâdeà
SQLITE_OMIT_WAL


43745 ifÐ
	giF¿me
 ){

43747 
	grc
 = 
sql™e3W®R—dF¿me
(
pPag”
->
pW®
, 
iF¿me
, 
pgsz
, 
pPg
->
pD©a
);

43751 
i64
 
	giOff£t
 = (
pgno
-1)*(i64)
pPag”
->
·geSize
;

43752 
	grc
 = 
sql™e3OsR—d
(
pPag”
->
fd
, 
pPg
->
pD©a
, 
pgsz
, 
iOff£t
);

43753 ifÐ
	grc
==
SQLITE_IOERR_SHORT_READ
 ){

43754 
rc
 = 
SQLITE_OK
;

43758 ifÐ
	gpgno
==1 ){

43759 ifÐ
rc
 ){

43772 
mem£t
(
pPag”
->
dbFžeV”s
, 0xff, (pPager->dbFileVers));

43774 
u8
 *
	gdbFžeV”s
 = &((u8*)
pPg
->
pD©a
)[24];

43775 
memýy
(&
pPag”
->
dbFžeV”s
, dbFileVers, (pPager->dbFileVers));

43778 
CODEC1
(
pPag”
, 
pPg
->
pD©a
, 
pgno
, 3, 
rc
 = 
SQLITE_NOMEM
);

43780 
PAGER_INCR
(
sql™e3_·g”_»addb_couÁ
);

43781 
PAGER_INCR
(
pPag”
->
nR—d
);

43782 
IOTRACE
(("PGIN %°%d\n", 
pPag”
, 
pgno
));

43783 
PAGERTRACE
(("FETCH %d…age %d hash(%08x)\n",

43784 
PAGERID
(
pPag”
), 
pgno
, 
·g”_·gehash
(
pPg
)));

43786  
	grc
;

43797 
·g”_wr™e_chªgecouÁ”
(
PgHdr
 *
pPg
){

43798 
u32
 
	gchªge_couÁ”
;

43801 
	gchªge_couÁ”
 = 
sql™e3G‘4by‹
((
u8
*)
pPg
->
pPag”
->
dbFžeV”s
)+1;

43802 
put32b™s
(((*)
pPg
->
pD©a
)+24, 
chªge_couÁ”
);

43807 
put32b™s
(((*)
pPg
->
pD©a
)+92, 
chªge_couÁ”
);

43808 
put32b™s
(((*)
pPg
->
pD©a
)+96, 
SQLITE_VERSION_NUMBER
);

43811 #iâdeà
SQLITE_OMIT_WAL


43824 
·g”UndoC®lback
(*
pCtx
, 
Pgno
 
iPg
){

43825 
	grc
 = 
SQLITE_OK
;

43826 
Pag”
 *
	gpPag”
 = (Pag” *)
pCtx
;

43827 
PgHdr
 *
	gpPg
;

43829 
as£¹
Ð
·g”U£W®
(
pPag”
) );

43830 
	gpPg
 = 
sql™e3Pag”Lookup
(
pPag”
, 
iPg
);

43831 ifÐ
	gpPg
 ){

43832 ifÐ
sql™e3PÿchePageRefcouÁ
(
pPg
)==1 ){

43833 
sql™e3PÿcheDrÝ
(
pPg
);

43835 
u32
 
	giF¿me
 = 0;

43836 
	grc
 = 
sql™e3W®FšdF¿me
(
pPag”
->
pW®
, 
pPg
->
pgno
, &
iF¿me
);

43837 ifÐ
	grc
==
SQLITE_OK
 ){

43838 
rc
 = 
»adDbPage
(
pPg
, 
iF¿me
);

43840 ifÐ
	grc
==
SQLITE_OK
 ){

43841 
pPag”
->
xReš™”
(
pPg
);

43843 
sql™e3Pag”UÄefNÙNuÎ
(
pPg
);

43855 
sql™e3BackupRe¡¬t
(
pPag”
->
pBackup
);

43857  
	grc
;

43863 
·g”RÞlbackW®
(
Pag”
 *
pPag”
){

43864 
	grc
;

43865 
PgHdr
 *
	gpLi¡
;

43874 
	gpPag”
->
	gdbSize
 = 
pPag”
->
dbOrigSize
;

43875 
	grc
 = 
sql™e3W®Undo
(
pPag”
->
pW®
, 
·g”UndoC®lback
, (*)pPager);

43876 
	gpLi¡
 = 
sql™e3PÿcheDœtyLi¡
(
pPag”
->
pPCache
);

43877  
	gpLi¡
 && 
	grc
==
SQLITE_OK
 ){

43878 
PgHdr
 *
pNext
 = 
pLi¡
->
pDœty
;

43879 
	grc
 = 
·g”UndoC®lback
((*)
pPag”
, 
pLi¡
->
pgno
);

43880 
	gpLi¡
 = 
pNext
;

43883  
	grc
;

43895 
·g”W®F¿mes
(

43896 
Pag”
 *
pPag”
,

43897 
PgHdr
 *
pLi¡
,

43898 
Pgno
 
nTrunÿ‹
,

43899 
isComm™


43901 
	grc
;

43902 
	gnLi¡
;

43903 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_CHECK_PAGES
)

43904 
PgHdr
 *
	gp
;

43907 
as£¹
Ð
pPag”
->
pW®
 );

43908 
as£¹
Ð
pLi¡
 );

43909 #ifdeà
SQLITE_DEBUG


43911 
	gp
=
pLi¡
;… &&…->
	gpDœty
;…=
p
->
pDœty
){

43912 
as£¹
Ð
p
->
pgno
 <…->
pDœty
->pgno );

43916 
as£¹
Ð
pLi¡
->
pDœty
==0 || 
isComm™
 );

43917 ifÐ
	gisComm™
 ){

43922 
PgHdr
 *
	gp
;

43923 
PgHdr
 **
	gµNext
 = &
pLi¡
;

43924 
	gnLi¡
 = 0;

43925 
	gp
=
pLi¡
; (*
	gµNext
 = 
p
)!=0;…õ->
pDœty
){

43926 ifÐ
p
->
pgno
<=
nTrunÿ‹
 ){

43927 
µNext
 = &
p
->
pDœty
;

43928 
	gnLi¡
++;

43931 
as£¹
Ð
pLi¡
 );

43933 
	gnLi¡
 = 1;

43935 
	gpPag”
->
	gaSt
[
PAGER_STAT_WRITE
] +ð
nLi¡
;

43937 ifÐ
	gpLi¡
->
	gpgno
==1 ) 
·g”_wr™e_chªgecouÁ”
(
pLi¡
);

43938 
	grc
 = 
sql™e3W®F¿mes
(
pPag”
->
pW®
,

43939 
pPag”
->
·geSize
, 
pLi¡
, 
nTrunÿ‹
, 
isComm™
,…Pag”->
w®SyncFÏgs


43941 ifÐ
	grc
==
SQLITE_OK
 && 
pPag”
->
pBackup
 ){

43942 
PgHdr
 *
p
;

43943 
	gp
=
pLi¡
;…;…=
p
->
pDœty
){

43944 
sql™e3BackupUpd©e
(
pPag”
->
pBackup
, 
p
->
pgno
, (
u8
 *í->
pD©a
);

43948 #ifdeà
SQLITE_CHECK_PAGES


43949 
	gpLi¡
 = 
sql™e3PÿcheDœtyLi¡
(
pPag”
->
pPCache
);

43950 
	gp
=
pLi¡
;…;…=
p
->
pDœty
){

43951 
·g”_£t_·gehash
(
p
);

43955  
	grc
;

43966 
·g”BegšR—dT¿n§ùiÚ
(
Pag”
 *
pPag”
){

43967 
	grc
;

43968 
	gchªged
 = 0;

43970 
as£¹
Ð
·g”U£W®
(
pPag”
) );

43971 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 ||…Pag”->eS‹==
PAGER_READER
 );

43978 
sql™e3W®EndR—dT¿n§ùiÚ
(
pPag”
->
pW®
);

43980 
	grc
 = 
sql™e3W®BegšR—dT¿n§ùiÚ
(
pPag”
->
pW®
, &
chªged
);

43981 ifÐ
	grc
!=
SQLITE_OK
 || 
chªged
 ){

43982 
·g”_»£t
(
pPag”
);

43983 ifÐ
USEFETCH
(
pPag”
èè
sql™e3OsUnãtch
ÕPag”->
fd
, 0, 0);

43986  
	grc
;

43999 
·g”PagecouÁ
(
Pag”
 *
pPag”
, 
Pgno
 *
²Page
){

44000 
Pgno
 
	gnPage
;

44008 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 );

44009 
as£¹
Ð
pPag”
->
eLock
>=
SHARED_LOCK
 );

44010 
	gnPage
 = 
sql™e3W®Dbsize
(
pPag”
->
pW®
);

44018 ifÐ
	gnPage
==0 ){

44019 
i64
 
n
 = 0;

44020 
as£¹
Ð
isO³n
(
pPag”
->
fd
è||…Pag”->
‹mpFže
 );

44021 ifÐ
isO³n
(
pPag”
->
fd
) ){

44022 
	grc
 = 
sql™e3OsFžeSize
(
pPag”
->
fd
, &
n
);

44023 ifÐ
	grc
!=
SQLITE_OK
 ){

44024  
rc
;

44027 
	gnPage
 = (
Pgno
)((
n
+
pPag”
->
·geSize
-1) /…Pager->pageSize);

44034 ifÐ
	gnPage
>
	gpPag”
->
	gmxPgno
 ){

44035 
	gpPag”
->
	gmxPgno
 = (
Pgno
)
nPage
;

44038 *
	g²Page
 = 
nPage
;

44039  
	gSQLITE_OK
;

44042 #iâdeà
SQLITE_OMIT_WAL


44061 
·g”O³nW®IfP»£Á
(
Pag”
 *
pPag”
){

44062 
	grc
 = 
SQLITE_OK
;

44063 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 );

44064 
as£¹
Ð
pPag”
->
eLock
>=
SHARED_LOCK
 );

44066 ifÐ!
	gpPag”
->
	g‹mpFže
 ){

44067 
	gisW®
;

44068 
Pgno
 
	gnPage
;

44070 
	grc
 = 
·g”PagecouÁ
(
pPag”
, &
nPage
);

44071 ifÐ
	grc
 ) „c;

44072 ifÐ
	gnPage
==0 ){

44073 
rc
 = 
sql™e3OsD–‘e
(
pPag”
->
pVfs
,…Pag”->
zW®
, 0);

44074 ifÐ
	grc
==
SQLITE_IOERR_DELETE_NOENT
 ) 
rc
 = 
SQLITE_OK
;

44075 
	gisW®
 = 0;

44077 
	grc
 = 
sql™e3OsAcûss
(

44078 
pPag”
->
pVfs
,…Pag”->
zW®
, 
SQLITE_ACCESS_EXISTS
, &
isW®


44081 ifÐ
	grc
==
SQLITE_OK
 ){

44082 ifÐ
isW®
 ){

44083 
‹¡ÿ£
Ð
sql™e3PÿchePagecouÁ
(
pPag”
->
pPCache
)==0 );

44084 
	grc
 = 
sql™e3Pag”O³nW®
(
pPag”
, 0);

44085 }ifÐ
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_WAL
 ){

44086 
pPag”
->
jouº®Mode
 = 
PAGER_JOURNALMODE_DELETE
;

44090  
	grc
;

44130 
·g”PÏybackSav•ošt
(
Pag”
 *
pPag”
, 
Pag”Sav•ošt
 *
pSav•ošt
){

44131 
i64
 
	gszJ
;

44132 
i64
 
	giHdrOff
;

44133 
	grc
 = 
SQLITE_OK
;

44134 
B™vec
 *
	gpDÚe
 = 0;

44136 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_ERROR
 );

44137 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_LOCKED
 );

44140 ifÐ
	gpSav•ošt
 ){

44141 
	gpDÚe
 = 
sql™e3B™vecC»©e
(
pSav•ošt
->
nOrig
);

44142 ifÐ!
	gpDÚe
 ){

44143  
	gSQLITE_NOMEM
;

44150 
	gpPag”
->
	gdbSize
 = 
pSav•ošt
 ?…Sav•ošt->
nOrig
 : 
pPag”
->
dbOrigSize
;

44151 
	gpPag”
->
	gchªgeCouÁDÚe
 = 
pPag”
->
‹mpFže
;

44153 ifÐ!
	gpSav•ošt
 && 
·g”U£W®
(
pPag”
) ){

44154  
·g”RÞlbackW®
(
pPag”
);

44162 
	gszJ
 = 
pPag”
->
jouº®Off
;

44163 
as£¹
Ð
·g”U£W®
(
pPag”
)==0 || 
szJ
==0 );

44172 ifÐ
	gpSav•ošt
 && !
·g”U£W®
(
pPag”
) ){

44173 
	giHdrOff
 = 
pSav•ošt
->
iHdrOff£t
 ?…Sav•ošt->iHdrOff£ˆ: 
szJ
;

44174 
	gpPag”
->
	gjouº®Off
 = 
pSav•ošt
->
iOff£t
;

44175  
	grc
==
SQLITE_OK
 && 
pPag”
->
jouº®Off
<
iHdrOff
 ){

44176 
rc
 = 
·g”_¶ayback_Úe_·ge
(
pPag”
, &pPag”->
jouº®Off
, 
pDÚe
, 1, 1);

44178 
as£¹
Ð
rc
!=
SQLITE_DONE
 );

44180 
	gpPag”
->
	gjouº®Off
 = 0;

44188  
	grc
==
SQLITE_OK
 && 
pPag”
->
jouº®Off
<
szJ
 ){

44189 
u32
 
ii
;

44190 
u32
 
	gnJRec
 = 0;

44191 
u32
 
	gdummy
;

44192 
	grc
 = 
»adJouº®Hdr
(
pPag”
, 0, 
szJ
, &
nJRec
, &
dummy
);

44193 
as£¹
Ð
rc
!=
SQLITE_DONE
 );

44200 ifÐ
	gnJRec
==0

44201 && 
pPag”
->
jouº®Hdr
+
JOURNAL_HDR_SZ
ÕPag”)=õPag”->
jouº®Off


44203 
nJRec
 = (
u32
)((
szJ
 - 
pPag”
->
jouº®Off
)/
JOURNAL_PG_SZ
(pPager));

44205 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<
nJRec
 && 
pPag”
->
jouº®Off
<
szJ
; ii++){

44206 
	grc
 = 
·g”_¶ayback_Úe_·ge
(
pPag”
, &pPag”->
jouº®Off
, 
pDÚe
, 1, 1);

44208 
as£¹
Ð
rc
!=
SQLITE_DONE
 );

44210 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pPag”
->
jouº®Off
>=
szJ
 );

44216 ifÐ
	gpSav•ošt
 ){

44217 
u32
 
	gii
;

44218 
i64
 
	goff£t
 = (i64)
pSav•ošt
->
iSubRec
*(4+
pPag”
->
·geSize
);

44220 ifÐ
·g”U£W®
(
pPag”
) ){

44221 
	grc
 = 
sql™e3W®Sav•oštUndo
(
pPag”
->
pW®
, 
pSav•ošt
->
aW®D©a
);

44223 
	gii
=
pSav•ošt
->
iSubRec
; 
	grc
==
SQLITE_OK
 && 
ii
<
pPag”
->
nSubRec
; ii++){

44224 
as£¹
Ð
off£t
==(
i64
)
ii
*(4+
pPag”
->
·geSize
) );

44225 
	grc
 = 
·g”_¶ayback_Úe_·ge
(
pPag”
, &
off£t
, 
pDÚe
, 0, 1);

44227 
as£¹
Ð
rc
!=
SQLITE_DONE
 );

44230 
sql™e3B™vecDe¡roy
(
pDÚe
);

44231 ifÐ
	grc
==
SQLITE_OK
 ){

44232 
pPag”
->
jouº®Off
 = 
szJ
;

44235  
	grc
;

44241 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Cachesize
(
Pag”
 *
pPag”
, 
mxPage
){

44242 
sql™e3PÿcheS‘Cachesize
(
pPag”
->
pPCache
, 
mxPage
);

44248 
·g”FixM­lim™
(
Pag”
 *
pPag”
){

44249 #ià
SQLITE_MAX_MMAP_SIZE
>0

44250 
sql™e3_fže
 *
	gfd
 = 
pPag”
->
fd
;

44251 ifÐ
isO³n
(
fd
è&& 
	gfd
->
	gpM‘hods
->
	giV”siÚ
>=3 ){

44252 
sql™e3_št64
 
sz
;

44253 
	gsz
 = 
pPag”
->
szMm­
;

44254 
	gpPag”
->
	gbU£F‘ch
 = (
sz
>0);

44255 
sql™e3OsFžeCÚŒÞHšt
(
pPag”
->
fd
, 
SQLITE_FCNTL_MMAP_SIZE
, &
sz
);

44263 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Mm­Lim™
(
Pag”
 *
pPag”
, 
sql™e3_št64
 
szMm­
){

44264 
	gpPag”
->
	gszMm­
 = 
szMm­
;

44265 
·g”FixM­lim™
(
pPag”
);

44271 
SQLITE_PRIVATE
 
sql™e3Pag”Shršk
(
Pag”
 *
pPag”
){

44272 
sql™e3PÿcheShršk
(
pPag”
->
pPCache
);

44321 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


44322 
SQLITE_PRIVATE
 
sql™e3Pag”S‘FÏgs
(

44323 
Pag”
 *
pPag”
,

44324 
pgFÏgs


44326 
	gËv–
 = 
pgFÏgs
 & 
PAGER_SYNCHRONOUS_MASK
;

44327 
as£¹
Ð
Ëv–
>=1 &&†evel<=3 );

44328 
	gpPag”
->
	gnoSync
 = (
Ëv–
==1 || 
pPag”
->
‹mpFže
) ?1:0;

44329 
	gpPag”
->
	gfuÎSync
 = (
Ëv–
==3 && !
pPag”
->
‹mpFže
) ?1:0;

44330 ifÐ
	gpPag”
->
	gnoSync
 ){

44331 
	gpPag”
->
	gsyncFÏgs
 = 0;

44332 
	gpPag”
->
	gck±SyncFÏgs
 = 0;

44333 }ifÐ
	gpgFÏgs
 & 
	gPAGER_FULLFSYNC
 ){

44334 
	gpPag”
->
	gsyncFÏgs
 = 
SQLITE_SYNC_FULL
;

44335 
	gpPag”
->
	gck±SyncFÏgs
 = 
SQLITE_SYNC_FULL
;

44336 }ifÐ
	gpgFÏgs
 & 
	gPAGER_CKPT_FULLFSYNC
 ){

44337 
	gpPag”
->
	gsyncFÏgs
 = 
SQLITE_SYNC_NORMAL
;

44338 
	gpPag”
->
	gck±SyncFÏgs
 = 
SQLITE_SYNC_FULL
;

44340 
	gpPag”
->
	gsyncFÏgs
 = 
SQLITE_SYNC_NORMAL
;

44341 
	gpPag”
->
	gck±SyncFÏgs
 = 
SQLITE_SYNC_NORMAL
;

44343 
	gpPag”
->
	gw®SyncFÏgs
 = 
pPag”
->
syncFÏgs
;

44344 ifÐ
	gpPag”
->
	gfuÎSync
 ){

44345 
	gpPag”
->
	gw®SyncFÏgs
 |ð
WAL_SYNC_TRANSACTIONS
;

44347 ifÐ
	gpgFÏgs
 & 
	gPAGER_CACHESPILL
 ){

44348 
	gpPag”
->
	gdoNÙSpžl
 &ð~
SPILLFLAG_OFF
;

44350 
	gpPag”
->
	gdoNÙSpžl
 |ð
SPILLFLAG_OFF
;

44360 #ifdeà
SQLITE_TEST


44361 
SQLITE_API
 
	gsql™e3_Ý’‹mp_couÁ
 = 0;

44379 
·g”O³Áemp
(

44380 
Pag”
 *
pPag”
,

44381 
sql™e3_fže
 *
pFže
,

44382 
vfsFÏgs


44384 
	grc
;

44386 #ifdeà
SQLITE_TEST


44387 
	gsql™e3_Ý’‹mp_couÁ
++;

44390 
	gvfsFÏgs
 |ð
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
 |

44391 
SQLITE_OPEN_EXCLUSIVE
 | 
SQLITE_OPEN_DELETEONCLOSE
;

44392 
	grc
 = 
sql™e3OsO³n
(
pPag”
->
pVfs
, 0, 
pFže
, 
vfsFÏgs
, 0);

44393 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
isO³n
(
pFže
) );

44394  
	grc
;

44418 
SQLITE_PRIVATE
 
sql™e3Pag”S‘BusyhªdËr
(

44419 
Pag”
 *
pPag”
,

44420 (*
xBusyHªdËr
)(*),

44421 *
pBusyHªdËrArg


44423 
	gpPag”
->
	gxBusyHªdËr
 = 
xBusyHªdËr
;

44424 
	gpPag”
->
	gpBusyHªdËrArg
 = 
pBusyHªdËrArg
;

44426 ifÐ
isO³n
(
pPag”
->
fd
) ){

44427 **
	g­
 = (**)&
pPag”
->
xBusyHªdËr
;

44428 
as£¹
Ð(((*)(*))(
­
[0]))==
xBusyHªdËr
 );

44429 
as£¹
Ð
­
[1]==
pBusyHªdËrArg
 );

44430 
sql™e3OsFžeCÚŒÞHšt
(
pPag”
->
fd
, 
SQLITE_FCNTL_BUSYHANDLER
, (*)
­
);

44464 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Pagesize
(
Pag”
 *
pPag”
, 
u32
 *
pPageSize
, 
nRe£rve
){

44465 
	grc
 = 
SQLITE_OK
;

44477 
u32
 
	g·geSize
 = *
pPageSize
;

44478 
as£¹
Ð
·geSize
==0 || (·geSize>=512 &&…ageSize<=
SQLITE_MAX_PAGE_SIZE
) );

44479 ifÐ(
	gpPag”
->
	gmemDb
==0 || 
pPag”
->
dbSize
==0)

44480 && 
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)==0

44481 && 
·geSize
 &&…ageSize!=(
u32
)
pPag”
->pageSize

44483 *
pNew
 = 
NULL
;

44484 
i64
 
	gnBy‹
 = 0;

44486 ifÐ
	gpPag”
->
	geS‹
>
	gPAGER_OPEN
 && 
isO³n
(
pPag”
->
fd
) ){

44487 
	grc
 = 
sql™e3OsFžeSize
(
pPag”
->
fd
, &
nBy‹
);

44489 ifÐ
	grc
==
SQLITE_OK
 ){

44490 
pNew
 = (*)
sql™e3PageM®loc
(
·geSize
);

44491 ifÐ!
	gpNew
 ) 
	grc
 = 
SQLITE_NOMEM
;

44494 ifÐ
	grc
==
SQLITE_OK
 ){

44495 
·g”_»£t
(
pPag”
);

44496 
	grc
 = 
sql™e3PÿcheS‘PageSize
(
pPag”
->
pPCache
, 
·geSize
);

44498 ifÐ
	grc
==
SQLITE_OK
 ){

44499 
sql™e3PageF»e
(
pPag”
->
pTmpS·û
);

44500 
	gpPag”
->
	gpTmpS·û
 = 
pNew
;

44501 
	gpPag”
->
	gdbSize
 = (
Pgno
)((
nBy‹
+
·geSize
-1)/pageSize);

44502 
	gpPag”
->
	g·geSize
 = 
·geSize
;

44504 
sql™e3PageF»e
(
pNew
);

44508 *
	gpPageSize
 = 
pPag”
->
·geSize
;

44509 ifÐ
	grc
==
SQLITE_OK
 ){

44510 ifÐ
nRe£rve
<0 )‚Re£rvð
pPag”
->nReserve;

44511 
as£¹
Ð
nRe£rve
>=0 &&‚Reserve<1000 );

44512 
	gpPag”
->
	gnRe£rve
 = (
i16
)
nRe£rve
;

44513 
·g”R•ÜtSize
(
pPag”
);

44514 
·g”FixM­lim™
(
pPag”
);

44516  
	grc
;

44527 
SQLITE_PRIVATE
 *
sql™e3Pag”TempS·û
(
Pag”
 *
pPag”
){

44528  
	gpPag”
->
	gpTmpS·û
;

44538 
SQLITE_PRIVATE
 
sql™e3Pag”MaxPageCouÁ
(
Pag”
 *
pPag”
, 
mxPage
){

44539 ifÐ
	gmxPage
>0 ){

44540 
	gpPag”
->
	gmxPgno
 = 
mxPage
;

44542 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_OPEN
 );

44543 
as£¹
Ð
pPag”
->
mxPgno
>õPag”->
dbSize
 );

44544  
	gpPag”
->
	gmxPgno
;

44555 #ifdeà
SQLITE_TEST


44556 
SQLITE_API
 
sql™e3_io_”rÜ_³ndšg
;

44557 
SQLITE_API
 
sql™e3_io_”rÜ_h™
;

44558 
	g§ved_út
;

44559 
di§bË_simuÏ‹d_io_”rÜs
(){

44560 
	g§ved_út
 = 
sql™e3_io_”rÜ_³ndšg
;

44561 
	gsql™e3_io_”rÜ_³ndšg
 = -1;

44563 
’abË_simuÏ‹d_io_”rÜs
(){

44564 
	gsql™e3_io_”rÜ_³ndšg
 = 
§ved_út
;

44567 
	#di§bË_simuÏ‹d_io_”rÜs
()

	)

44568 
	#’abË_simuÏ‹d_io_”rÜs
()

	)

44585 
SQLITE_PRIVATE
 
sql™e3Pag”R—dFžeh—d”
(
Pag”
 *
pPag”
, 
N
, *
pDe¡
){

44586 
	grc
 = 
SQLITE_OK
;

44587 
mem£t
(
pDe¡
, 0, 
N
);

44588 
as£¹
Ð
isO³n
(
pPag”
->
fd
è||…Pag”->
‹mpFže
 );

44594 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

44596 ifÐ
isO³n
(
pPag”
->
fd
) ){

44597 
IOTRACE
(("DBHDR %°0 %d\n", 
pPag”
, 
N
))

44598 
	grc
 = 
sql™e3OsR—d
(
pPag”
->
fd
, 
pDe¡
, 
N
, 0);

44599 ifÐ
	grc
==
SQLITE_IOERR_SHORT_READ
 ){

44600 
rc
 = 
SQLITE_OK
;

44603  
	grc
;

44613 
SQLITE_PRIVATE
 
sql™e3Pag”PagecouÁ
(
Pag”
 *
pPag”
, *
²Page
){

44614 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_READER
 );

44615 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_WRITER_FINISHED
 );

44616 *
	g²Page
 = ()
pPag”
->
dbSize
;

44634 
·g”_wa™_Ú_lock
(
Pag”
 *
pPag”
, 
lockty³
){

44635 
	grc
;

44642 
as£¹
Ð(
pPag”
->
eLock
>=
lockty³
)

44643 || (
pPag”
->
eLock
==
NO_LOCK
 && 
lockty³
==
SHARED_LOCK
)

44644 || (
pPag”
->
eLock
==
RESERVED_LOCK
 && 
lockty³
==
EXCLUSIVE_LOCK
)

44648 
	grc
 = 
·g”LockDb
(
pPag”
, 
lockty³
);

44649 } 
	grc
==
SQLITE_BUSY
 && 
pPag”
->
xBusyHªdËr
ÕPag”->
pBusyHªdËrArg
) );

44650  
	grc
;

44675 #ià
defšed
(
SQLITE_DEBUG
)

44676 
as£¹Trunÿ‹CÚ¡¿štCb
(
PgHdr
 *
pPg
){

44677 
as£¹
Ð
pPg
->
æags
&
PGHDR_DIRTY
 );

44678 
as£¹
Ð!
subjRequœesPage
(
pPg
è||…Pg->
pgno
<õPg->
pPag”
->
dbSize
 );

44680 
as£¹Trunÿ‹CÚ¡¿št
(
Pag”
 *
pPag”
){

44681 
sql™e3PÿcheI‹¿‹Dœty
(
pPag”
->
pPCache
, 
as£¹Trunÿ‹CÚ¡¿štCb
);

44684 
	#as£¹Trunÿ‹CÚ¡¿št
(
pPag”
)

	)

44698 
SQLITE_PRIVATE
 
sql™e3Pag”Trunÿ‹Image
(
Pag”
 *
pPag”
, 
Pgno
 
nPage
){

44699 
as£¹
Ð
pPag”
->
dbSize
>=
nPage
 );

44700 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_CACHEMOD
 );

44701 
	gpPag”
->
	gdbSize
 = 
nPage
;

44729 
·g”SyncHÙJouº®
(
Pag”
 *
pPag”
){

44730 
	grc
 = 
SQLITE_OK
;

44731 ifÐ!
	gpPag”
->
	gnoSync
 ){

44732 
	grc
 = 
sql™e3OsSync
(
pPag”
->
jfd
, 
SQLITE_SYNC_NORMAL
);

44734 ifÐ
	grc
==
SQLITE_OK
 ){

44735 
rc
 = 
sql™e3OsFžeSize
(
pPag”
->
jfd
, &pPag”->
jouº®Hdr
);

44737  
	grc
;

44750 
·g”AcquœeM­Page
(

44751 
Pag”
 *
pPag”
,

44752 
Pgno
 
pgno
,

44753 *
pD©a
,

44754 
PgHdr
 **
µPage


44756 
PgHdr
 *
	gp
;

44758 ifÐ
	gpPag”
->
	gpMm­F»–i¡
 ){

44759 *
	gµPage
 = 
p
 = 
pPag”
->
pMm­F»–i¡
;

44760 
	gpPag”
->
	gpMm­F»–i¡
 = 
p
->
pDœty
;

44761 
	gp
->
	gpDœty
 = 0;

44762 
mem£t
(
p
->
pExŒa
, 0, 
pPag”
->
nExŒa
);

44764 *
	gµPage
 = 
p
 = (
PgHdr
 *)
sql™e3M®locZ”o
((PgHdrè+ 
pPag”
->
nExŒa
);

44765 ifÐ
	gp
==0 ){

44766 
sql™e3OsUnãtch
(
pPag”
->
fd
, (
i64
)(
pgno
-1è*…Pag”->
·geSize
, 
pD©a
);

44767  
	gSQLITE_NOMEM
;

44769 
	gp
->
	gpExŒa
 = (*)&
p
[1];

44770 
	gp
->
	gæags
 = 
PGHDR_MMAP
;

44771 
	gp
->
	gnRef
 = 1;

44772 
	gp
->
	gpPag”
 = 
pPag”
;

44775 
as£¹
Ð
p
->
pExŒa
==(*)&p[1] );

44776 
as£¹
Ð
p
->
pPage
==0 );

44777 
as£¹
Ð
p
->
æags
==
PGHDR_MMAP
 );

44778 
as£¹
Ð
p
->
pPag”
==pPager );

44779 
as£¹
Ð
p
->
nRef
==1 );

44781 
	gp
->
	gpgno
 = 
pgno
;

44782 
	gp
->
	gpD©a
 = 
pD©a
;

44783 
	gpPag”
->
	gnMm­Out
++;

44785  
	gSQLITE_OK
;

44792 
·g”R–—£M­Page
(
PgHdr
 *
pPg
){

44793 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

44794 
	gpPag”
->
	gnMm­Out
--;

44795 
	gpPg
->
	gpDœty
 = 
pPag”
->
pMm­F»–i¡
;

44796 
	gpPag”
->
	gpMm­F»–i¡
 = 
pPg
;

44798 
as£¹
Ð
pPag”
->
fd
->
pM‘hods
->
iV”siÚ
>=3 );

44799 
sql™e3OsUnãtch
(
pPag”
->
fd
, (
i64
)(
pPg
->
pgno
-1)*pPag”->
·geSize
,…Pg->
pD©a
);

44805 
·g”F»eM­Hdrs
(
Pag”
 *
pPag”
){

44806 
PgHdr
 *
	gp
;

44807 
PgHdr
 *
	gpNext
;

44808 
	gp
=
pPag”
->
pMm­F»–i¡
;…;…=
pNext
){

44809 
pNext
 = 
p
->
pDœty
;

44810 
sql™e3_ä“
(
p
);

44829 
SQLITE_PRIVATE
 
sql™e3Pag”Clo£
(
Pag”
 *
pPag”
){

44830 
u8
 *
	gpTmp
 = (u8 *)
pPag”
->
pTmpS·û
;

44832 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

44833 
di§bË_simuÏ‹d_io_”rÜs
();

44834 
sql™e3BegšB’ignM®loc
();

44835 
·g”F»eM­Hdrs
(
pPag”
);

44837 
	gpPag”
->
	gexþusiveMode
 = 0;

44838 #iâdeà
SQLITE_OMIT_WAL


44839 
sql™e3W®Clo£
(
pPag”
->
pW®
,…Pag”->
ck±SyncFÏgs
,…Pag”->
·geSize
, 
pTmp
);

44840 
	gpPag”
->
	gpW®
 = 0;

44842 
·g”_»£t
(
pPag”
);

44843 ifÐ
	gMEMDB
 ){

44844 
·g”_uÆock
(
pPag”
);

44857 ifÐ
isO³n
(
pPag”
->
jfd
) ){

44858 
·g”_”rÜ
(
pPag”
, 
·g”SyncHÙJouº®
(pPager));

44860 
·g”UÆockAndRÞlback
(
pPag”
);

44862 
sql™e3EndB’ignM®loc
();

44863 
’abË_simuÏ‹d_io_”rÜs
();

44864 
PAGERTRACE
(("CLOSE %d\n", 
PAGERID
(
pPag”
)));

44865 
IOTRACE
(("CLOSE %p\n", 
pPag”
))

44866 
sql™e3OsClo£
(
pPag”
->
jfd
);

44867 
sql™e3OsClo£
(
pPag”
->
fd
);

44868 
sql™e3PageF»e
(
pTmp
);

44869 
sql™e3PÿcheClo£
(
pPag”
->
pPCache
);

44871 #ifdeà
SQLITE_HAS_CODEC


44872 ifÐ
	gpPag”
->
	gxCodecF»e
 )…Pag”->
xCodecF»e
(
pPag”
->
pCodec
);

44875 
as£¹
Ð!
pPag”
->
aSav•ošt
 && !pPag”->
pInJouº®
 );

44876 
as£¹
Ð!
isO³n
(
pPag”
->
jfd
è&& !isO³nÕPag”->
sjfd
) );

44878 
sql™e3_ä“
(
pPag”
);

44879  
	gSQLITE_OK
;

44882 #ià!
defšed
(
NDEBUG
è|| defšed(
SQLITE_TEST
)

44886 
SQLITE_PRIVATE
 
Pgno
 
sql™e3Pag”Pag’umb”
(
DbPage
 *
pPg
){

44887  
	gpPg
->
	gpgno
;

44894 
SQLITE_PRIVATE
 
sql™e3Pag”Ref
(
DbPage
 *
pPg
){

44895 
sql™e3PÿcheRef
(
pPg
);

44933 
syncJouº®
(
Pag”
 *
pPag”
, 
ÃwHdr
){

44934 
	grc
;

44936 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


44937 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


44939 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

44940 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

44942 
	grc
 = 
sql™e3Pag”ExþusiveLock
(
pPag”
);

44943 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

44945 ifÐ!
	gpPag”
->
	gnoSync
 ){

44946 
as£¹
Ð!
pPag”
->
‹mpFže
 );

44947 ifÐ
isO³n
(
pPag”
->
jfd
è&& 
	gpPag”
->
	gjouº®Mode
!=
PAGER_JOURNALMODE_MEMORY
 ){

44948 cÚ¡ 
iDc
 = 
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
fd
);

44949 
as£¹
Ð
isO³n
(
pPag”
->
jfd
) );

44951 ifÐ0==(
iDc
&
SQLITE_IOCAP_SAFE_APPEND
) ){

44974 
i64
 
iNextHdrOff£t
;

44975 
u8
 
	gaMagic
[8];

44976 
u8
 
	gzH—d”
[(
aJouº®Magic
)+4];

44978 
memýy
(
zH—d”
, 
aJouº®Magic
, (aJournalMagic));

44979 
put32b™s
(&
zH—d”
[(
aJouº®Magic
)], 
pPag”
->
nRec
);

44981 
	giNextHdrOff£t
 = 
jouº®HdrOff£t
(
pPag”
);

44982 
	grc
 = 
sql™e3OsR—d
(
pPag”
->
jfd
, 
aMagic
, 8, 
iNextHdrOff£t
);

44983 ifÐ
	grc
==
SQLITE_OK
 && 0==
memcmp
(
aMagic
, 
aJouº®Magic
, 8) ){

44984 cÚ¡ 
u8
 
	gz”oby‹
 = 0;

44985 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, &
z”oby‹
, 1, 
iNextHdrOff£t
);

44987 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_IOERR_SHORT_READ
 ){

44988  
rc
;

45002 ifÐ
	gpPag”
->
	gfuÎSync
 && 0==(
iDc
&
SQLITE_IOCAP_SEQUENTIAL
) ){

45003 
PAGERTRACE
(("SYNC jouº® oà%d\n", 
PAGERID
(
pPag”
)));

45004 
IOTRACE
(("JSYNC %p\n", 
pPag”
))

45005 
	grc
 = 
sql™e3OsSync
(
pPag”
->
jfd
,…Pag”->
syncFÏgs
);

45006 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

45008 
IOTRACE
(("JHDR %°%Îd\n", 
pPag”
,…Pag”->
jouº®Hdr
));

45009 
	grc
 = 
sql™e3OsWr™e
(

45010 
pPag”
->
jfd
, 
zH—d”
, (zH—d”),…Pag”->
jouº®Hdr


45012 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

45014 ifÐ0==(
iDc
&
SQLITE_IOCAP_SEQUENTIAL
) ){

45015 
PAGERTRACE
(("SYNC jouº® oà%d\n", 
PAGERID
(
pPag”
)));

45016 
IOTRACE
(("JSYNC %p\n", 
pPag”
))

45017 
	grc
 = 
sql™e3OsSync
(
pPag”
->
jfd
,…Pag”->
syncFÏgs
|

45018 (
pPag”
->
syncFÏgs
==
SQLITE_SYNC_FULL
?
SQLITE_SYNC_DATAONLY
:0)

45020 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

45023 
	gpPag”
->
	gjouº®Hdr
 = 
pPag”
->
jouº®Off
;

45024 ifÐ
	gÃwHdr
 && 0==(
iDc
&
SQLITE_IOCAP_SAFE_APPEND
) ){

45025 
pPag”
->
nRec
 = 0;

45026 
	grc
 = 
wr™eJouº®Hdr
(
pPag”
);

45027 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

45030 
	gpPag”
->
	gjouº®Hdr
 = 
pPag”
->
jouº®Off
;

45038 
sql™e3PÿcheCË¬SyncFÏgs
(
pPag”
->
pPCache
);

45039 
	gpPag”
->
	geS‹
 = 
PAGER_WRITER_DBMOD
;

45040 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

45041  
	gSQLITE_OK
;

45076 
·g”_wr™e_·g–i¡
(
Pag”
 *
pPag”
, 
PgHdr
 *
pLi¡
){

45077 
	grc
 = 
SQLITE_OK
;

45080 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

45081 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD
 );

45082 
as£¹
Ð
pPag”
->
eLock
==
EXCLUSIVE_LOCK
 );

45088 ifÐ!
isO³n
(
pPag”
->
fd
) ){

45089 
as£¹
Ð
pPag”
->
‹mpFže
 && 
rc
==
SQLITE_OK
 );

45090 
	grc
 = 
·g”O³Áemp
(
pPag”
,…Pag”->
fd
,…Pag”->
vfsFÏgs
);

45096 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
isO³n
(
pPag”
->
fd
) );

45097 ifÐ
	grc
==
SQLITE_OK


45098 && 
pPag”
->
dbHštSize
<pPag”->
dbSize


45099 && (
pLi¡
->
pDœty
 ||…Li¡->
pgno
>
pPag”
->
dbHštSize
)

45101 
sql™e3_št64
 
szFže
 = 
pPag”
->
·geSize
 * (sql™e3_št64íPag”->
dbSize
;

45102 
sql™e3OsFžeCÚŒÞHšt
(
pPag”
->
fd
, 
SQLITE_FCNTL_SIZE_HINT
, &
szFže
);

45103 
	gpPag”
->
	gdbHštSize
 = 
pPag”
->
dbSize
;

45106  
	grc
==
SQLITE_OK
 && 
pLi¡
 ){

45107 
Pgno
 
pgno
 = 
pLi¡
->pgno;

45117 ifÐ
	gpgno
<=
pPag”
->
dbSize
 && 0==(
pLi¡
->
æags
&
PGHDR_DONT_WRITE
) ){

45118 
i64
 
off£t
 = (
pgno
-1)*(i64)
pPag”
->
·geSize
;

45119 *
	gpD©a
;

45121 
as£¹
Ð(
pLi¡
->
æags
&
PGHDR_NEED_SYNC
)==0 );

45122 ifÐ
	gpLi¡
->
	gpgno
==1 ) 
·g”_wr™e_chªgecouÁ”
(
pLi¡
);

45125 
CODEC2
(
pPag”
, 
pLi¡
->
pD©a
, 
pgno
, 6,  
SQLITE_NOMEM
,…Data);

45128 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
fd
, 
pD©a
,…Pag”->
·geSize
, 
off£t
);

45134 ifÐ
	gpgno
==1 ){

45135 
memýy
(&
pPag”
->
dbFžeV”s
, &
pD©a
[24], (pPager->dbFileVers));

45137 ifÐ
	gpgno
>
	gpPag”
->
	gdbFžeSize
 ){

45138 
	gpPag”
->
	gdbFžeSize
 = 
pgno
;

45140 
	gpPag”
->
	gaSt
[
PAGER_STAT_WRITE
]++;

45143 
sql™e3BackupUpd©e
(
pPag”
->
pBackup
, 
pgno
, (
u8
*)
pLi¡
->
pD©a
);

45145 
PAGERTRACE
(("STORE %d…age %d hash(%08x)\n",

45146 
PAGERID
(
pPag”
), 
pgno
, 
·g”_·gehash
(
pLi¡
)));

45147 
IOTRACE
(("PGOUT %°%d\n", 
pPag”
, 
pgno
));

45148 
PAGER_INCR
(
sql™e3_·g”_wr™edb_couÁ
);

45150 
PAGERTRACE
(("NOSTORE %d…ag%d\n", 
PAGERID
(
pPag”
), 
pgno
));

45152 
·g”_£t_·gehash
(
pLi¡
);

45153 
	gpLi¡
 = 
pLi¡
->
pDœty
;

45156  
	grc
;

45167 
Ý’SubJouº®
(
Pag”
 *
pPag”
){

45168 
	grc
 = 
SQLITE_OK
;

45169 ifÐ!
isO³n
(
pPag”
->
sjfd
) ){

45170 ifÐ
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_MEMORY
 || 
pPag”
->
subjInMemÜy
 ){

45171 
sql™e3MemJouº®O³n
(
pPag”
->
sjfd
);

45173 
	grc
 = 
·g”O³Áemp
(
pPag”
,…Pag”->
sjfd
, 
SQLITE_OPEN_SUBJOURNAL
);

45176  
	grc
;

45192 
subjouº®Page
(
PgHdr
 *
pPg
){

45193 
	grc
 = 
SQLITE_OK
;

45194 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

45195 ifÐ
	gpPag”
->
	gjouº®Mode
!=
PAGER_JOURNALMODE_OFF
 ){

45198 
as£¹
Ð
pPag”
->
u£Jouº®
 );

45199 
as£¹
Ð
isO³n
(
pPag”
->
jfd
è|| 
·g”U£W®
(pPager) );

45200 
as£¹
Ð
isO³n
(
pPag”
->
sjfd
è||…Pag”->
nSubRec
==0 );

45201 
as£¹
Ð
·g”U£W®
(
pPag”
)

45202 || 
·geInJouº®
(
pPag”
, 
pPg
)

45203 || 
pPg
->
pgno
>
pPag”
->
dbOrigSize


45205 
	grc
 = 
Ý’SubJouº®
(
pPag”
);

45209 ifÐ
	grc
==
SQLITE_OK
 ){

45210 *
pD©a
 = 
pPg
->pData;

45211 
i64
 
	goff£t
 = (i64)
pPag”
->
nSubRec
*(4+pPag”->
·geSize
);

45212 *
	gpD©a2
;

45214 
CODEC2
(
pPag”
, 
pD©a
, 
pPg
->
pgno
, 7,  
SQLITE_NOMEM
, 
pD©a2
);

45215 
PAGERTRACE
(("STMT-JOURNAL %d…ag%d\n", 
PAGERID
(
pPag”
), 
pPg
->
pgno
));

45216 
	grc
 = 
wr™e32b™s
(
pPag”
->
sjfd
, 
off£t
, 
pPg
->
pgno
);

45217 ifÐ
	grc
==
SQLITE_OK
 ){

45218 
rc
 = 
sql™e3OsWr™e
(
pPag”
->
sjfd
, 
pD©a2
,…Pag”->
·geSize
, 
off£t
+4);

45222 ifÐ
	grc
==
SQLITE_OK
 ){

45223 
pPag”
->
nSubRec
++;

45224 
as£¹
Ð
pPag”
->
nSav•ošt
>0 );

45225 
	grc
 = 
addToSav•oštB™vecs
(
pPag”
, 
pPg
->
pgno
);

45227  
	grc
;

45249 
·g”SŒess
(*
p
, 
PgHdr
 *
pPg
){

45250 
Pag”
 *
	gpPag”
 = (Pag” *)
p
;

45251 
	grc
 = 
SQLITE_OK
;

45253 
as£¹
Ð
pPg
->
pPag”
==pPager );

45254 
as£¹
Ð
pPg
->
æags
&
PGHDR_DIRTY
 );

45272 ifÐ
NEVER
(
pPag”
->
”rCode
èè 
	gSQLITE_OK
;

45273 
‹¡ÿ£
Ð
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_ROLLBACK
 );

45274 
‹¡ÿ£
Ð
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_OFF
 );

45275 
‹¡ÿ£
Ð
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_NOSYNC
 );

45276 ifÐ
	gpPag”
->
	gdoNÙSpžl


45277 && ((
	gpPag”
->
	gdoNÙSpžl
 & (
	gSPILLFLAG_ROLLBACK
|
	gSPILLFLAG_OFF
))!=0

45278 || (
pPg
->
æags
 & 
PGHDR_NEED_SYNC
)!=0)

45280  
SQLITE_OK
;

45283 
	gpPg
->
	gpDœty
 = 0;

45284 ifÐ
·g”U£W®
(
pPag”
) ){

45286 ifÐ
subjRequœesPage
(
pPg
) ){

45287 
	grc
 = 
subjouº®Page
(
pPg
);

45289 ifÐ
	grc
==
SQLITE_OK
 ){

45290 
rc
 = 
·g”W®F¿mes
(
pPag”
, 
pPg
, 0, 0);

45295 ifÐ
	gpPg
->
	gæags
&
	gPGHDR_NEED_SYNC


45296 || 
	gpPag”
->
	geS‹
==
PAGER_WRITER_CACHEMOD


45298 
rc
 = 
syncJouº®
(
pPag”
, 1);

45328 ifÐ
NEVER
(

45329 
rc
==
SQLITE_OK
 && 
pPg
->
pgno
>
pPag”
->
dbSize
 && 
subjRequœesPage
(pPg)

45331 
rc
 = 
subjouº®Page
(
pPg
);

45335 ifÐ
	grc
==
SQLITE_OK
 ){

45336 
as£¹
Ð(
pPg
->
æags
&
PGHDR_NEED_SYNC
)==0 );

45337 
	grc
 = 
·g”_wr™e_·g–i¡
(
pPag”
, 
pPg
);

45342 ifÐ
	grc
==
SQLITE_OK
 ){

45343 
PAGERTRACE
(("STRESS %d…ag%d\n", 
PAGERID
(
pPag”
), 
pPg
->
pgno
));

45344 
sql™e3PÿcheMakeCËª
(
pPg
);

45347  
·g”_”rÜ
(
pPag”
, 
rc
);

45381 
SQLITE_PRIVATE
 
sql™e3Pag”O³n
(

45382 
sql™e3_vfs
 *
pVfs
,

45383 
Pag”
 **
µPag”
,

45384 cÚ¡ *
zFž’ame
,

45385 
nExŒa
,

45386 
æags
,

45387 
vfsFÏgs
,

45388 (*
xReš™
)(
DbPage
*)

45390 
u8
 *
	gpPŒ
;

45391 
Pag”
 *
	gpPag”
 = 0;

45392 
	grc
 = 
SQLITE_OK
;

45393 
	g‹mpFže
 = 0;

45394 
	gmemDb
 = 0;

45395 
	g»adOÆy
 = 0;

45396 
	gjouº®FžeSize
;

45397 *
	gzP©hÇme
 = 0;

45398 
	gnP©hÇme
 = 0;

45399 
	gu£Jouº®
 = (
æags
 & 
PAGER_OMIT_JOURNAL
)==0;

45400 
	gpÿcheSize
 = 
sql™e3PÿcheSize
();

45401 
u32
 
	gszPageDæt
 = 
SQLITE_DEFAULT_PAGE_SIZE
;

45402 cÚ¡ *
	gzUri
 = 0;

45403 
	gnUri
 = 0;

45413 ifÐ
sql™e3Jouº®Size
(
pVfs
)>
sql™e3MemJouº®Size
() ){

45414 
	gjouº®FžeSize
 = 
ROUND8
(
sql™e3Jouº®Size
(
pVfs
));

45416 
	gjouº®FžeSize
 = 
ROUND8
(
sql™e3MemJouº®Size
());

45420 *
	gµPag”
 = 0;

45422 #iâdeà
SQLITE_OMIT_MEMORYDB


45423 ifÐ
	gæags
 & 
	gPAGER_MEMORY
 ){

45424 
	gmemDb
 = 1;

45425 ifÐ
	gzFž’ame
 && zFilename[0] ){

45426 
	gzP©hÇme
 = 
sql™e3DbSŒDup
(0, 
zFž’ame
);

45427 ifÐ
	gzP©hÇme
==0 )  
SQLITE_NOMEM
;

45428 
	gnP©hÇme
 = 
sql™e3SŒËn30
(
zP©hÇme
);

45429 
	gzFž’ame
 = 0;

45438 ifÐ
	gzFž’ame
 && zFilename[0] ){

45439 cÚ¡ *
	gz
;

45440 
	gnP©hÇme
 = 
pVfs
->
mxP©hÇme
+1;

45441 
	gzP©hÇme
 = 
sql™e3DbM®locRaw
(0, 
nP©hÇme
*2);

45442 ifÐ
	gzP©hÇme
==0 ){

45443  
SQLITE_NOMEM
;

45445 
	gzP©hÇme
[0] = 0;

45446 
	grc
 = 
sql™e3OsFuÎP©hÇme
(
pVfs
, 
zFž’ame
, 
nP©hÇme
, 
zP©hÇme
);

45447 
	gnP©hÇme
 = 
sql™e3SŒËn30
(
zP©hÇme
);

45448 
	gz
 = 
zUri
 = &
zFž’ame
[
sql™e3SŒËn30
(zFilename)+1];

45449  *
	gz
 ){

45450 
	gz
 +ð
sql™e3SŒËn30
(
z
)+1;

45451 
	gz
 +ð
sql™e3SŒËn30
(
z
)+1;

45453 
	gnUri
 = ()(&
z
[1] - 
zUri
);

45454 
as£¹
Ð
nUri
>=0 );

45455 ifÐ
	grc
==
SQLITE_OK
 && 
nP©hÇme
+8>
pVfs
->
mxP©hÇme
 ){

45462 
rc
 = 
SQLITE_CANTOPEN_BKPT
;

45464 ifÐ
	grc
!=
SQLITE_OK
 ){

45465 
sql™e3DbF»e
(0, 
zP©hÇme
);

45466  
	grc
;

45482 
	gpPŒ
 = (
u8
 *)
sql™e3M®locZ”o
(

45483 
ROUND8
((*
pPag”
)) +

45484 
ROUND8
(
pÿcheSize
) +

45485 
ROUND8
(
pVfs
->
szOsFže
) +

45486 
jouº®FžeSize
 * 2 +

45487 
nP©hÇme
 + 1 + 
nUri
 +

45488 
nP©hÇme
 + 8 + 2

45489 #iâdeà
SQLITE_OMIT_WAL


45490 + 
nP©hÇme
 + 4 + 2

45493 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
SQLITE_INT_TO_PTR
(
jouº®FžeSize
)) );

45494 ifÐ!
	gpPŒ
 ){

45495 
sql™e3DbF»e
(0, 
zP©hÇme
);

45496  
	gSQLITE_NOMEM
;

45498 
	gpPag”
 = (
Pag”
*)(
pPŒ
);

45499 
	gpPag”
->
	gpPCache
 = (
PCache
*)(
pPŒ
 +ð
ROUND8
((*
pPag”
)));

45500 
	gpPag”
->
	gfd
 = (
sql™e3_fže
*)(
pPŒ
 +ð
ROUND8
(
pÿcheSize
));

45501 
	gpPag”
->
	gsjfd
 = (
sql™e3_fže
*)(
pPŒ
 +ð
ROUND8
(
pVfs
->
szOsFže
));

45502 
	gpPag”
->
	gjfd
 = (
sql™e3_fže
*)(
pPŒ
 +ð
jouº®FžeSize
);

45503 
	gpPag”
->
	gzFž’ame
 = (*)(
pPŒ
 +ð
jouº®FžeSize
);

45504 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pPag”
->
jfd
) );

45507 ifÐ
	gzP©hÇme
 ){

45508 
as£¹
Ð
nP©hÇme
>0 );

45509 
	gpPag”
->
	gzJouº®
 = (*)(
pPŒ
 +ð
nP©hÇme
 + 1 + 
nUri
);

45510 
memýy
(
pPag”
->
zFž’ame
, 
zP©hÇme
, 
nP©hÇme
);

45511 ifÐ
	gnUri
 ) 
memýy
(&
pPag”
->
zFž’ame
[
nP©hÇme
+1], 
zUri
, 
nUri
);

45512 
memýy
(
pPag”
->
zJouº®
, 
zP©hÇme
, 
nP©hÇme
);

45513 
memýy
(&
pPag”
->
zJouº®
[
nP©hÇme
], "-journal\000", 8+2);

45514 
sql™e3FžeSuffix3
(
pPag”
->
zFž’ame
,…Pag”->
zJouº®
);

45515 #iâdeà
SQLITE_OMIT_WAL


45516 
	gpPag”
->
	gzW®
 = &
pPag”
->
zJouº®
[
nP©hÇme
+8+1];

45517 
memýy
(
pPag”
->
zW®
, 
zP©hÇme
, 
nP©hÇme
);

45518 
memýy
(&
pPag”
->
zW®
[
nP©hÇme
], "-wal\000", 4+1);

45519 
sql™e3FžeSuffix3
(
pPag”
->
zFž’ame
,…Pag”->
zW®
);

45521 
sql™e3DbF»e
(0, 
zP©hÇme
);

45523 
	gpPag”
->
	gpVfs
 = 
pVfs
;

45524 
	gpPag”
->
	gvfsFÏgs
 = 
vfsFÏgs
;

45528 ifÐ
	gzFž’ame
 && zFilename[0] ){

45529 
	gfout
 = 0;

45530 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
pPag”
->
zFž’ame
,…Pag”->
fd
, 
vfsFÏgs
, &
fout
);

45531 
as£¹
Ð!
memDb
 );

45532 
	g»adOÆy
 = (
fout
&
SQLITE_OPEN_READONLY
);

45542 ifÐ
	grc
==
SQLITE_OK
 ){

45543 
iDc
 = 
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
fd
);

45544 ifÐ!
	g»adOÆy
 ){

45545 
£tSeùÜSize
(
pPag”
);

45546 
as£¹
(
SQLITE_DEFAULT_PAGE_SIZE
<=
SQLITE_MAX_DEFAULT_PAGE_SIZE
);

45547 ifÐ
	gszPageDæt
<
	gpPag”
->
	g£ùÜSize
 ){

45548 ifÐ
	gpPag”
->
	g£ùÜSize
>
	gSQLITE_MAX_DEFAULT_PAGE_SIZE
 ){

45549 
	gszPageDæt
 = 
SQLITE_MAX_DEFAULT_PAGE_SIZE
;

45551 
	gszPageDæt
 = (
u32
)
pPag”
->
£ùÜSize
;

45554 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


45556 
	gii
;

45557 
as£¹
(
SQLITE_IOCAP_ATOMIC512
==(512>>8));

45558 
as£¹
(
SQLITE_IOCAP_ATOMIC64K
==(65536>>8));

45559 
as£¹
(
SQLITE_MAX_DEFAULT_PAGE_SIZE
<=65536);

45560 
	gii
=
szPageDæt
; ii<=
SQLITE_MAX_DEFAULT_PAGE_SIZE
; ii=
ii
*2){

45561 ifÐ
iDc
&(
SQLITE_IOCAP_ATOMIC
|(
ii
>>8)) ){

45562 
szPageDæt
 = 
ii
;

45568 
	gpPag”
->
	gnoLock
 = 
sql™e3_uri_boÞ—n
(
zFž’ame
, "nolock", 0);

45569 ifÐ(
	giDc
 & 
	gSQLITE_IOCAP_IMMUTABLE
)!=0

45570 || 
sql™e3_uri_boÞ—n
(
zFž’ame
, "immutable", 0) ){

45571 
	gvfsFÏgs
 |ð
SQLITE_OPEN_READONLY
;

45572 
	gaù_like_‹mp_fže
;

45586 
	gaù_like_‹mp_fže
:

45587 
‹mpFže
 = 1;

45588 
	gpPag”
->
	geS‹
 = 
PAGER_READER
;

45589 
	gpPag”
->
	geLock
 = 
EXCLUSIVE_LOCK
;

45590 
	gpPag”
->
	gnoLock
 = 1;

45591 
	g»adOÆy
 = (
vfsFÏgs
&
SQLITE_OPEN_READONLY
);

45597 ifÐ
	grc
==
SQLITE_OK
 ){

45598 
as£¹
Ð
pPag”
->
memDb
==0 );

45599 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pPag”
, &
szPageDæt
, -1);

45600 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

45604 ifÐ
	grc
==
SQLITE_OK
 ){

45605 
as£¹
Ð
nExŒa
<1000 );

45606 
	gnExŒa
 = 
ROUND8
(
nExŒa
);

45607 
	grc
 = 
sql™e3PÿcheO³n
(
szPageDæt
, 
nExŒa
, !
memDb
,

45608 !
memDb
?
·g”SŒess
:0, (*)
pPag”
,…Pag”->
pPCache
);

45613 ifÐ
	grc
!=
SQLITE_OK
 ){

45614 
sql™e3OsClo£
(
pPag”
->
fd
);

45615 
sql™e3PageF»e
(
pPag”
->
pTmpS·û
);

45616 
sql™e3_ä“
(
pPag”
);

45617  
	grc
;

45620 
PAGERTRACE
(("OPEN %d %s\n", 
FILEHANDLEID
(
pPag”
->
fd
),…Pag”->
zFž’ame
));

45621 
IOTRACE
(("OPEN %°%s\n", 
pPag”
,…Pag”->
zFž’ame
))

45623 
	gpPag”
->
	gu£Jouº®
 = (
u8
)
u£Jouº®
;

45630 
	gpPag”
->
	gmxPgno
 = 
SQLITE_MAX_PAGE_COUNT
;

45633 
	gpPag”
->
	g‹mpFže
 = (
u8
)
‹mpFže
;

45634 
as£¹
Ð
‹mpFže
==
PAGER_LOCKINGMODE_NORMAL


45635 || 
‹mpFže
==
PAGER_LOCKINGMODE_EXCLUSIVE
 );

45636 
as£¹
Ð
PAGER_LOCKINGMODE_EXCLUSIVE
==1 );

45637 
	gpPag”
->
	gexþusiveMode
 = (
u8
)
‹mpFže
;

45638 
	gpPag”
->
	gchªgeCouÁDÚe
 = 
pPag”
->
‹mpFže
;

45639 
	gpPag”
->
	gmemDb
 = (
u8
)
memDb
;

45640 
	gpPag”
->
	g»adOÆy
 = (
u8
)
»adOÆy
;

45641 
as£¹
Ð
u£Jouº®
 || 
pPag”
->
‹mpFže
 );

45642 
	gpPag”
->
	gnoSync
 = 
pPag”
->
‹mpFže
;

45643 ifÐ
	gpPag”
->
	gnoSync
 ){

45644 
as£¹
Ð
pPag”
->
fuÎSync
==0 );

45645 
as£¹
Ð
pPag”
->
syncFÏgs
==0 );

45646 
as£¹
Ð
pPag”
->
w®SyncFÏgs
==0 );

45647 
as£¹
Ð
pPag”
->
ck±SyncFÏgs
==0 );

45649 
	gpPag”
->
	gfuÎSync
 = 1;

45650 
	gpPag”
->
	gsyncFÏgs
 = 
SQLITE_SYNC_NORMAL
;

45651 
	gpPag”
->
	gw®SyncFÏgs
 = 
SQLITE_SYNC_NORMAL
 | 
WAL_SYNC_TRANSACTIONS
;

45652 
	gpPag”
->
	gck±SyncFÏgs
 = 
SQLITE_SYNC_NORMAL
;

45657 
	gpPag”
->
	gnExŒa
 = (
u16
)
nExŒa
;

45658 
	gpPag”
->
	gjouº®SizeLim™
 = 
SQLITE_DEFAULT_JOURNAL_SIZE_LIMIT
;

45659 
as£¹
Ð
isO³n
(
pPag”
->
fd
è|| 
‹mpFže
 );

45660 
£tSeùÜSize
(
pPag”
);

45661 ifÐ!
	gu£Jouº®
 ){

45662 
	gpPag”
->
	gjouº®Mode
 = 
PAGER_JOURNALMODE_OFF
;

45663 }ifÐ
	gmemDb
 ){

45664 
	gpPag”
->
	gjouº®Mode
 = 
PAGER_JOURNALMODE_MEMORY
;

45668 
	gpPag”
->
	gxReš™”
 = 
xReš™
;

45672 *
	gµPag”
 = 
pPag”
;

45673  
	gSQLITE_OK
;

45682 
d©aba£IsUnmoved
(
Pag”
 *
pPag”
){

45683 
	gbHasMoved
 = 0;

45684 
	grc
;

45686 ifÐ
	gpPag”
->
	g‹mpFže
 )  
	gSQLITE_OK
;

45687 ifÐ
	gpPag”
->
	gdbSize
==0 )  
SQLITE_OK
;

45688 
as£¹
Ð
pPag”
->
zFž’ame
 &&…Pager->zFilename[0] );

45689 
	grc
 = 
sql™e3OsFžeCÚŒÞ
(
pPag”
->
fd
, 
SQLITE_FCNTL_HAS_MOVED
, &
bHasMoved
);

45690 ifÐ
	grc
==
SQLITE_NOTFOUND
 ){

45694 
rc
 = 
SQLITE_OK
;

45695 }ifÐ
	grc
==
SQLITE_OK
 && 
bHasMoved
 ){

45696 
rc
 = 
SQLITE_READONLY_DBMOVED
;

45698  
	grc
;

45733 
hasHÙJouº®
(
Pag”
 *
pPag”
, *
pExi¡s
){

45734 
sql™e3_vfs
 * cÚ¡ 
	gpVfs
 = 
pPag”
->
pVfs
;

45735 
	grc
 = 
SQLITE_OK
;

45736 
	gexi¡s
 = 1;

45737 
	gjºlO³n
 = !!
isO³n
(
pPag”
->
jfd
);

45739 
as£¹
Ð
pPag”
->
u£Jouº®
 );

45740 
as£¹
Ð
isO³n
(
pPag”
->
fd
) );

45741 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 );

45743 
as£¹
Ð
jºlO³n
==0 || ( 
sql™e3OsDeviûCh¬aù”i¡ics
(
pPag”
->
jfd
) &

45744 
SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN


45747 *
	gpExi¡s
 = 0;

45748 ifÐ!
	gjºlO³n
 ){

45749 
	grc
 = 
sql™e3OsAcûss
(
pVfs
, 
pPag”
->
zJouº®
, 
SQLITE_ACCESS_EXISTS
, &
exi¡s
);

45751 ifÐ
	grc
==
SQLITE_OK
 && 
exi¡s
 ){

45752 
locked
 = 0;

45762 
	grc
 = 
sql™e3OsCheckRe£rvedLock
(
pPag”
->
fd
, &
locked
);

45763 ifÐ
	grc
==
SQLITE_OK
 && !
locked
 ){

45764 
Pgno
 
nPage
;

45766 
	grc
 = 
·g”PagecouÁ
(
pPag”
, &
nPage
);

45767 ifÐ
	grc
==
SQLITE_OK
 ){

45776 ifÐ
nPage
==0 && !
jºlO³n
 ){

45777 
sql™e3BegšB’ignM®loc
();

45778 ifÐ
·g”LockDb
(
pPag”
, 
RESERVED_LOCK
)==
SQLITE_OK
 ){

45779 
sql™e3OsD–‘e
(
pVfs
, 
pPag”
->
zJouº®
, 0);

45780 ifÐ!
	gpPag”
->
	gexþusiveMode
 ) 
·g”UÆockDb
(
pPag”
, 
SHARED_LOCK
);

45782 
sql™e3EndB’ignM®loc
();

45790 ifÐ!
	gjºlO³n
 ){

45791 
	gf
 = 
SQLITE_OPEN_READONLY
|
SQLITE_OPEN_MAIN_JOURNAL
;

45792 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
pPag”
->
zJouº®
,…Pag”->
jfd
, 
f
, &f);

45794 ifÐ
	grc
==
SQLITE_OK
 ){

45795 
u8
 
fœ¡
 = 0;

45796 
	grc
 = 
sql™e3OsR—d
(
pPag”
->
jfd
, (*)&
fœ¡
, 1, 0);

45797 ifÐ
	grc
==
SQLITE_IOERR_SHORT_READ
 ){

45798 
rc
 = 
SQLITE_OK
;

45800 ifÐ!
	gjºlO³n
 ){

45801 
sql™e3OsClo£
(
pPag”
->
jfd
);

45803 *
	gpExi¡s
 = (
fœ¡
!=0);

45804 }ifÐ
	grc
==
SQLITE_CANTOPEN
 ){

45814 *
pExi¡s
 = 1;

45815 
	grc
 = 
SQLITE_OK
;

45822  
	grc
;

45852 
SQLITE_PRIVATE
 
sql™e3Pag”Sh¬edLock
(
Pag”
 *
pPag”
){

45853 
	grc
 = 
SQLITE_OK
;

45860 
as£¹
Ð
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)==0 );

45861 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

45862 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 ||…Pag”->eS‹==
PAGER_READER
 );

45863 ifÐ
NEVER
(
MEMDB
 && 
pPag”
->
”rCode
è){  
	gpPag”
->
	g”rCode
; }

45865 ifÐ!
·g”U£W®
(
pPag”
è&& 
	gpPag”
->
	geS‹
==
PAGER_OPEN
 ){

45866 
bHÙJouº®
 = 1;

45868 
as£¹
Ð!
MEMDB
 );

45870 
	grc
 = 
·g”_wa™_Ú_lock
(
pPag”
, 
SHARED_LOCK
);

45871 ifÐ
	grc
!=
SQLITE_OK
 ){

45872 
as£¹
Ð
pPag”
->
eLock
==
NO_LOCK
 ||…Pag”->eLock==
UNKNOWN_LOCK
 );

45873 
	gçžed
;

45879 ifÐ
	gpPag”
->
	geLock
<=
SHARED_LOCK
 ){

45880 
rc
 = 
hasHÙJouº®
(
pPag”
, &
bHÙJouº®
);

45882 ifÐ
	grc
!=
SQLITE_OK
 ){

45883 
çžed
;

45885 ifÐ
	gbHÙJouº®
 ){

45886 ifÐ
	gpPag”
->
	g»adOÆy
 ){

45887 
	grc
 = 
SQLITE_READONLY_ROLLBACK
;

45888 
	gçžed
;

45906 
	grc
 = 
·g”LockDb
(
pPag”
, 
EXCLUSIVE_LOCK
);

45907 ifÐ
	grc
!=
SQLITE_OK
 ){

45908 
çžed
;

45924 ifÐ!
isO³n
(
pPag”
->
jfd
) ){

45925 
sql™e3_vfs
 * cÚ¡ 
	gpVfs
 = 
pPag”
->
pVfs
;

45926 
	gbExi¡s
;

45927 
	grc
 = 
sql™e3OsAcûss
(

45928 
pVfs
, 
pPag”
->
zJouº®
, 
SQLITE_ACCESS_EXISTS
, &
bExi¡s
);

45929 ifÐ
	grc
==
SQLITE_OK
 && 
bExi¡s
 ){

45930 
fout
 = 0;

45931 
	gf
 = 
SQLITE_OPEN_READWRITE
|
SQLITE_OPEN_MAIN_JOURNAL
;

45932 
as£¹
Ð!
pPag”
->
‹mpFže
 );

45933 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
pPag”
->
zJouº®
,…Pag”->
jfd
, 
f
, &
fout
);

45934 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
isO³n
(
pPag”
->
jfd
) );

45935 ifÐ
	grc
==
SQLITE_OK
 && 
fout
&
SQLITE_OPEN_READONLY
 ){

45936 
rc
 = 
SQLITE_CANTOPEN_BKPT
;

45937 
sql™e3OsClo£
(
pPag”
->
jfd
);

45950 ifÐ
isO³n
(
pPag”
->
jfd
) ){

45951 
as£¹
Ð
rc
==
SQLITE_OK
 );

45952 
	grc
 = 
·g”SyncHÙJouº®
(
pPag”
);

45953 ifÐ
	grc
==
SQLITE_OK
 ){

45954 
rc
 = 
·g”_¶ayback
(
pPag”
, 1);

45955 
	gpPag”
->
	geS‹
 = 
PAGER_OPEN
;

45957 }ifÐ!
	gpPag”
->
	gexþusiveMode
 ){

45958 
·g”UÆockDb
(
pPag”
, 
SHARED_LOCK
);

45961 ifÐ
	grc
!=
SQLITE_OK
 ){

45978 
·g”_”rÜ
(
pPag”
, 
rc
);

45979 
	gçžed
;

45982 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 );

45983 
as£¹
Ð(
pPag”
->
eLock
==
SHARED_LOCK
)

45984 || (
pPag”
->
exþusiveMode
 &&…Pag”->
eLock
>
SHARED_LOCK
)

45988 ifÐ!
	gpPag”
->
	g‹mpFže
 && (

45989 
	gpPag”
->
	gpBackup


45990 || 
sql™e3PÿchePagecouÁ
(
pPag”
->
pPCache
)>0

45991 || 
USEFETCH
(
pPag”
)

46009 
Pgno
 
	gnPage
 = 0;

46010 
	gdbFžeV”s
[(
pPag”
->
dbFžeV”s
)];

46012 
	grc
 = 
·g”PagecouÁ
(
pPag”
, &
nPage
);

46013 ifÐ
	grc
 ) 
	gçžed
;

46015 ifÐ
	gnPage
>0 ){

46016 
IOTRACE
(("CKVERS %°%d\n", 
pPag”
, (
dbFžeV”s
)));

46017 
	grc
 = 
sql™e3OsR—d
(
pPag”
->
fd
, &
dbFžeV”s
, (dbFileVers), 24);

46018 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_IOERR_SHORT_READ
 ){

46019 
çžed
;

46022 
mem£t
(
dbFžeV”s
, 0, (dbFileVers));

46025 ifÐ
memcmp
(
pPag”
->
dbFžeV”s
, dbFileVers, (dbFileVers))!=0 ){

46026 
·g”_»£t
(
pPag”
);

46034 ifÐ
USEFETCH
(
pPag”
) ){

46035 
sql™e3OsUnãtch
(
pPag”
->
fd
, 0, 0);

46043 
	grc
 = 
·g”O³nW®IfP»£Á
(
pPag”
);

46044 #iâdeà
SQLITE_OMIT_WAL


46045 
as£¹
Ð
pPag”
->
pW®
==0 || 
rc
==
SQLITE_OK
 );

46049 ifÐ
·g”U£W®
(
pPag”
) ){

46050 
as£¹
Ð
rc
==
SQLITE_OK
 );

46051 
	grc
 = 
·g”BegšR—dT¿n§ùiÚ
(
pPag”
);

46054 ifÐ
	gpPag”
->
	geS‹
==
PAGER_OPEN
 && 
rc
==
SQLITE_OK
 ){

46055 
rc
 = 
·g”PagecouÁ
(
pPag”
, &pPag”->
dbSize
);

46058 
	gçžed
:

46059 ifÐ
rc
!=
SQLITE_OK
 ){

46060 
as£¹
Ð!
MEMDB
 );

46061 
·g”_uÆock
(
pPag”
);

46062 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 );

46064 
	gpPag”
->
	geS‹
 = 
PAGER_READER
;

46066  
	grc
;

46077 
·g”UÆockIfUnu£d
(
Pag”
 *
pPag”
){

46078 ifÐ
	gpPag”
->
	gnMm­Out
==0 && (
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
)==0) ){

46079 
·g”UÆockAndRÞlback
(
pPag”
);

46133 
SQLITE_PRIVATE
 
sql™e3Pag”Acquœe
(

46134 
Pag”
 *
pPag”
,

46135 
Pgno
 
pgno
,

46136 
DbPage
 **
µPage
,

46137 
æags


46139 
	grc
 = 
SQLITE_OK
;

46140 
PgHdr
 *
	gpPg
 = 0;

46141 
u32
 
	giF¿me
 = 0;

46142 cÚ¡ 
	gnoCÚ‹Á
 = (
æags
 & 
PAGER_GET_NOCONTENT
);

46148 cÚ¡ 
	gbMm­Ok
 = (
pgno
!=1 && 
USEFETCH
(
pPag”
)

46149 && (
pPag”
->
eS‹
==
PAGER_READER
 || (
æags
 & 
PAGER_GET_READONLY
))

46150 #ifdeà
SQLITE_HAS_CODEC


46151 && 
pPag”
->
xCodec
==0

46155 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_READER
 );

46156 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46157 
as£¹
Ð
noCÚ‹Á
==0 || 
bMm­Ok
==0 );

46159 ifÐ
	gpgno
==0 ){

46160  
SQLITE_CORRUPT_BKPT
;

46165 ifÐ
	gpPag”
->
	g”rCode
!=
SQLITE_OK
 ){

46166 
rc
 = 
pPag”
->
”rCode
;

46168 ifÐ
	gbMm­Ok
 && 
·g”U£W®
(
pPag”
) ){

46169 
	grc
 = 
sql™e3W®FšdF¿me
(
pPag”
->
pW®
, 
pgno
, &
iF¿me
);

46170 ifÐ
	grc
!=
SQLITE_OK
 ) 
·g”_acquœe_”r
;

46173 ifÐ
	gbMm­Ok
 && 
	giF¿me
==0 ){

46174 *
pD©a
 = 0;

46176 
	grc
 = 
sql™e3OsF‘ch
(
pPag”
->
fd
,

46177 (
i64
)(
pgno
-1è* 
pPag”
->
·geSize
,…Pag”->·geSize, &
pD©a


46180 ifÐ
	grc
==
SQLITE_OK
 && 
pD©a
 ){

46181 ifÐ
pPag”
->
eS‹
>
PAGER_READER
 ){

46182 
pPg
 = 
sql™e3Pag”Lookup
(
pPag”
, 
pgno
);

46184 ifÐ
	gpPg
==0 ){

46185 
rc
 = 
·g”AcquœeM­Page
(
pPag”
, 
pgno
, 
pD©a
, &
pPg
);

46187 
sql™e3OsUnãtch
(
pPag”
->
fd
, (
i64
)(
pgno
-1)*pPag”->
·geSize
, 
pD©a
);

46189 ifÐ
	gpPg
 ){

46190 
as£¹
Ð
rc
==
SQLITE_OK
 );

46191 *
	gµPage
 = 
pPg
;

46192  
	gSQLITE_OK
;

46195 ifÐ
	grc
!=
SQLITE_OK
 ){

46196 
·g”_acquœe_”r
;

46201 
sql™e3_pÿche_·ge
 *
	gpBa£
;

46202 
	gpBa£
 = 
sql™e3PÿcheF‘ch
(
pPag”
->
pPCache
, 
pgno
, 3);

46203 ifÐ
	gpBa£
==0 ){

46204 
rc
 = 
sql™e3PÿcheF‘chSŒess
(
pPag”
->
pPCache
, 
pgno
, &
pBa£
);

46205 ifÐ
	grc
!=
SQLITE_OK
 ) 
·g”_acquœe_”r
;

46207 
	gpPg
 = *
µPage
 = 
sql™e3PÿcheF‘chFšish
(
pPag”
->
pPCache
, 
pgno
, 
pBa£
);

46208 ifÐ
	gpPg
==0 ) 
rc
 = 
SQLITE_NOMEM
;

46212 ifÐ
	grc
!=
SQLITE_OK
 ){

46216 
pPg
 = 0;

46217 
	g·g”_acquœe_”r
;

46219 
as£¹
Ð(*
µPage
)->
pgno
==pgno );

46220 
as£¹
Ð(*
µPage
)->
pPag”
==pPager || (*ppPage)->pPager==0 );

46222 ifÐ(*
	gµPage
)->
	gpPag”
 && !
	gnoCÚ‹Á
 ){

46225 
as£¹
Ð
pgno
<=
PAGER_MAX_PGNO
 &&…gno!=
PAGER_MJ_PGNO
(
pPag”
) );

46226 
	gpPag”
->
	gaSt
[
PAGER_STAT_HIT
]++;

46227  
	gSQLITE_OK
;

46233 
	gpPg
 = *
µPage
;

46234 
	gpPg
->
	gpPag”
 = 
pPag”
;

46238 ifÐ
	gpgno
>
	gPAGER_MAX_PGNO
 ||…gno==
PAGER_MJ_PGNO
(
pPag”
) ){

46239 
rc
 = 
SQLITE_CORRUPT_BKPT
;

46240 
	g·g”_acquœe_”r
;

46243 ifÐ
	gMEMDB
 || 
	gpPag”
->
	gdbSize
<
	gpgno
 || 
	gnoCÚ‹Á
 || !
isO³n
(
pPag”
->
fd
) ){

46244 ifÐ
	gpgno
>
	gpPag”
->
	gmxPgno
 ){

46245 
	grc
 = 
SQLITE_FULL
;

46246 
	g·g”_acquœe_”r
;

46248 ifÐ
	gnoCÚ‹Á
 ){

46255 
sql™e3BegšB’ignM®loc
();

46256 ifÐ
	gpgno
<=
pPag”
->
dbOrigSize
 ){

46257 
TESTONLY
Ð
rc
 = ) 
sql™e3B™vecS‘
(
pPag”
->
pInJouº®
, 
pgno
);

46258 
‹¡ÿ£
Ð
rc
==
SQLITE_NOMEM
 );

46260 
TESTONLY
Ð
rc
 = ) 
addToSav•oštB™vecs
(
pPag”
, 
pgno
);

46261 
‹¡ÿ£
Ð
rc
==
SQLITE_NOMEM
 );

46262 
sql™e3EndB’ignM®loc
();

46264 
mem£t
(
pPg
->
pD©a
, 0, 
pPag”
->
·geSize
);

46265 
IOTRACE
(("ZERO %°%d\n", 
pPag”
, 
pgno
));

46267 ifÐ
·g”U£W®
(
pPag”
è&& 
	gbMm­Ok
==0 ){

46268 
rc
 = 
sql™e3W®FšdF¿me
(
pPag”
->
pW®
, 
pgno
, &
iF¿me
);

46269 ifÐ
	grc
!=
SQLITE_OK
 ) 
·g”_acquœe_”r
;

46271 
as£¹
Ð
pPg
->
pPag”
==pPager );

46272 
	gpPag”
->
	gaSt
[
PAGER_STAT_MISS
]++;

46273 
	grc
 = 
»adDbPage
(
pPg
, 
iF¿me
);

46274 ifÐ
	grc
!=
SQLITE_OK
 ){

46275 
·g”_acquœe_”r
;

46278 
·g”_£t_·gehash
(
pPg
);

46281  
	gSQLITE_OK
;

46283 
	g·g”_acquœe_”r
:

46284 
as£¹
Ð
rc
!=
SQLITE_OK
 );

46285 ifÐ
	gpPg
 ){

46286 
sql™e3PÿcheDrÝ
(
pPg
);

46288 
·g”UÆockIfUnu£d
(
pPag”
);

46290 *
	gµPage
 = 0;

46291  
	grc
;

46305 
SQLITE_PRIVATE
 
DbPage
 *
sql™e3Pag”Lookup
(
Pag”
 *
pPag”
, 
Pgno
 
pgno
){

46306 
sql™e3_pÿche_·ge
 *
	gpPage
;

46307 
as£¹
Ð
pPag”
!=0 );

46308 
as£¹
Ð
pgno
!=0 );

46309 
as£¹
Ð
pPag”
->
pPCache
!=0 );

46310 
	gpPage
 = 
sql™e3PÿcheF‘ch
(
pPag”
->
pPCache
, 
pgno
, 0);

46311  
sql™e3PÿcheF‘chFšish
(
pPag”
->
pPCache
, 
pgno
, 
pPage
);

46322 
SQLITE_PRIVATE
 
sql™e3Pag”UÄefNÙNuÎ
(
DbPage
 *
pPg
){

46323 
Pag”
 *
	gpPag”
;

46324 
as£¹
Ð
pPg
!=0 );

46325 
	gpPag”
 = 
pPg
->
pPag”
;

46326 ifÐ
	gpPg
->
	gæags
 & 
	gPGHDR_MMAP
 ){

46327 
·g”R–—£M­Page
(
pPg
);

46329 
sql™e3PÿcheR–—£
(
pPg
);

46331 
·g”UÆockIfUnu£d
(
pPag”
);

46333 
SQLITE_PRIVATE
 
sql™e3Pag”UÄef
(
DbPage
 *
pPg
){

46334 ifÐ
	gpPg
 ) 
sql™e3Pag”UÄefNÙNuÎ
(
pPg
);

46359 
·g”_Ý’_jouº®
(
Pag”
 *
pPag”
){

46360 
	grc
 = 
SQLITE_OK
;

46361 
sql™e3_vfs
 * cÚ¡ 
	gpVfs
 = 
pPag”
->
pVfs
;

46363 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED
 );

46364 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46365 
as£¹
Ð
pPag”
->
pInJouº®
==0 );

46370 ifÐ
NEVER
(
pPag”
->
”rCode
èè 
	gpPag”
->
	g”rCode
;

46372 ifÐ!
·g”U£W®
(
pPag”
è&& 
	gpPag”
->
	gjouº®Mode
!=
PAGER_JOURNALMODE_OFF
 ){

46373 
pPag”
->
pInJouº®
 = 
sql™e3B™vecC»©e
ÕPag”->
dbSize
);

46374 ifÐ
	gpPag”
->
	gpInJouº®
==0 ){

46375  
SQLITE_NOMEM
;

46379 ifÐ!
isO³n
(
pPag”
->
jfd
) ){

46380 ifÐ
	gpPag”
->
	gjouº®Mode
==
PAGER_JOURNALMODE_MEMORY
 ){

46381 
sql™e3MemJouº®O³n
(
pPag”
->
jfd
);

46383 cÚ¡ 
	gæags
 =

46384 
SQLITE_OPEN_READWRITE
|
SQLITE_OPEN_CREATE
|

46385 (
pPag”
->
‹mpFže
 ?

46386 (
SQLITE_OPEN_DELETEONCLOSE
|
SQLITE_OPEN_TEMP_JOURNAL
):

46387 (
SQLITE_OPEN_MAIN_JOURNAL
)

46392 
	grc
 = 
d©aba£IsUnmoved
(
pPag”
);

46393 ifÐ
	grc
==
SQLITE_OK
 ){

46394 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


46395 
rc
 = 
sql™e3Jouº®O³n
(

46396 
pVfs
, 
pPag”
->
zJouº®
,…Pag”->
jfd
, 
æags
, 
jºlBufãrSize
(pPager)

46399 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
pPag”
->
zJouº®
,…Pag”->
jfd
, 
æags
, 0);

46403 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
isO³n
(
pPag”
->
jfd
) );

46410 ifÐ
	grc
==
SQLITE_OK
 ){

46412 
pPag”
->
nRec
 = 0;

46413 
	gpPag”
->
	gjouº®Off
 = 0;

46414 
	gpPag”
->
	g£tMa¡”
 = 0;

46415 
	gpPag”
->
	gjouº®Hdr
 = 0;

46416 
	grc
 = 
wr™eJouº®Hdr
(
pPag”
);

46420 ifÐ
	grc
!=
SQLITE_OK
 ){

46421 
sql™e3B™vecDe¡roy
(
pPag”
->
pInJouº®
);

46422 
	gpPag”
->
	gpInJouº®
 = 0;

46424 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED
 );

46425 
	gpPag”
->
	geS‹
 = 
PAGER_WRITER_CACHEMOD
;

46428  
	grc
;

46448 
SQLITE_PRIVATE
 
sql™e3Pag”Begš
(
Pag”
 *
pPag”
, 
exFÏg
, 
subjInMemÜy
){

46449 
	grc
 = 
SQLITE_OK
;

46451 ifÐ
	gpPag”
->
	g”rCode
 ) …Pager->errCode;

46452 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_READER
 &&…Pag”->eS‹<
PAGER_ERROR
 );

46453 
	gpPag”
->
	gsubjInMemÜy
 = (
u8
)
subjInMemÜy
;

46455 ifÐ
ALWAYS
(
pPag”
->
eS‹
==
PAGER_READER
) ){

46456 
as£¹
Ð
pPag”
->
pInJouº®
==0 );

46458 ifÐ
·g”U£W®
(
pPag”
) ){

46462 ifÐ
	gpPag”
->
	gexþusiveMode
 && 
sql™e3W®ExþusiveMode
(
pPag”
->
pW®
, -1) ){

46463 
	grc
 = 
·g”LockDb
(
pPag”
, 
EXCLUSIVE_LOCK
);

46464 ifÐ
	grc
!=
SQLITE_OK
 ){

46465  
rc
;

46467 
sql™e3W®ExþusiveMode
(
pPag”
->
pW®
, 1);

46475 
	grc
 = 
sql™e3W®BegšWr™eT¿n§ùiÚ
(
pPag”
->
pW®
);

46482 
	grc
 = 
·g”LockDb
(
pPag”
, 
RESERVED_LOCK
);

46483 ifÐ
	grc
==
SQLITE_OK
 && 
exFÏg
 ){

46484 
rc
 = 
·g”_wa™_Ú_lock
(
pPag”
, 
EXCLUSIVE_LOCK
);

46488 ifÐ
	grc
==
SQLITE_OK
 ){

46498 
pPag”
->
eS‹
 = 
PAGER_WRITER_LOCKED
;

46499 
	gpPag”
->
	gdbHštSize
 = 
pPag”
->
dbSize
;

46500 
	gpPag”
->
	gdbFžeSize
 = 
pPag”
->
dbSize
;

46501 
	gpPag”
->
	gdbOrigSize
 = 
pPag”
->
dbSize
;

46502 
	gpPag”
->
	gjouº®Off
 = 0;

46505 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pPag”
->
eS‹
==
PAGER_READER
 );

46506 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED
 );

46507 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46510 
PAGERTRACE
(("TRANSACTION %d\n", 
PAGERID
(
pPag”
)));

46511  
	grc
;

46521 
·g”_wr™e
(
PgHdr
 *
pPg
){

46522 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

46523 
	grc
 = 
SQLITE_OK
;

46524 
	gšJouº®
;

46530 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED


46531 || 
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


46532 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


46534 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46535 
as£¹
Ð
pPag”
->
”rCode
==0 );

46536 
as£¹
Ð
pPag”
->
»adOÆy
==0 );

46538 
CHECK_PAGE
(
pPg
);

46549 ifÐ
	gpPag”
->
	geS‹
==
PAGER_WRITER_LOCKED
 ){

46550 
rc
 = 
·g”_Ý’_jouº®
(
pPag”
);

46551 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

46553 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_CACHEMOD
 );

46554 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46559 
sql™e3PÿcheMakeDœty
(
pPg
);

46560 
	gšJouº®
 = 
·geInJouº®
(
pPag”
, 
pPg
);

46561 ifÐ
	gšJouº®
 && (
	gpPag”
->
	gnSav•ošt
==0 || !
subjRequœesPage
(
pPg
)) ){

46562 
as£¹
Ð!
·g”U£W®
(
pPag”
) );

46569 ifÐ!
	gšJouº®
 && !
·g”U£W®
(
pPag”
) ){

46570 
as£¹
Ð
·g”U£W®
(
pPag”
)==0 );

46571 ifÐ
	gpPg
->
	gpgno
<=
pPag”
->
dbOrigSize
 && 
isO³n
ÕPag”->
jfd
) ){

46572 
u32
 
cksum
;

46573 *
	gpD©a2
;

46574 
i64
 
	giOff
 = 
pPag”
->
jouº®Off
;

46579 
as£¹
Ð
pPg
->
pgno
!=
PAGER_MJ_PGNO
(
pPag”
) );

46581 
as£¹
Ð
pPag”
->
jouº®Hdr
<õPag”->
jouº®Off
 );

46582 
CODEC2
(
pPag”
, 
pPg
->
pD©a
,…Pg->
pgno
, 7,  
SQLITE_NOMEM
, 
pD©a2
);

46583 
	gcksum
 = 
·g”_cksum
(
pPag”
, (
u8
*)
pD©a2
);

46592 
	gpPg
->
	gæags
 |ð
PGHDR_NEED_SYNC
;

46594 
	grc
 = 
wr™e32b™s
(
pPag”
->
jfd
, 
iOff
, 
pPg
->
pgno
);

46595 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

46596 
	grc
 = 
sql™e3OsWr™e
(
pPag”
->
jfd
, 
pD©a2
,…Pag”->
·geSize
, 
iOff
+4);

46597 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

46598 
	grc
 = 
wr™e32b™s
(
pPag”
->
jfd
, 
iOff
+pPag”->
·geSize
+4, 
cksum
);

46599 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

46601 
IOTRACE
(("JOUT %°%d %Îd %d\n", 
pPag”
, 
pPg
->
pgno
,

46602 
pPag”
->
jouº®Off
,…Pag”->
·geSize
));

46603 
PAGER_INCR
(
sql™e3_·g”_wr™ej_couÁ
);

46604 
PAGERTRACE
(("JOURNAL %d…age %d‚eedSync=%d hash(%08x)\n",

46605 
PAGERID
(
pPag”
), 
pPg
->
pgno
,

46606 ((
pPg
->
æags
&
PGHDR_NEED_SYNC
)?1:0), 
·g”_·gehash
(pPg)));

46608 
	gpPag”
->
	gjouº®Off
 +ð8 + 
pPag”
->
·geSize
;

46609 
	gpPag”
->
	gnRec
++;

46610 
as£¹
Ð
pPag”
->
pInJouº®
!=0 );

46611 
	grc
 = 
sql™e3B™vecS‘
(
pPag”
->
pInJouº®
, 
pPg
->
pgno
);

46612 
‹¡ÿ£
Ð
rc
==
SQLITE_NOMEM
 );

46613 
as£¹
Ð
rc
==
SQLITE_OK
 ||„c==
SQLITE_NOMEM
 );

46614 
	grc
 |ð
addToSav•oštB™vecs
(
pPag”
, 
pPg
->
pgno
);

46615 ifÐ
	grc
!=
SQLITE_OK
 ){

46616 
as£¹
Ð
rc
==
SQLITE_NOMEM
 );

46617  
	grc
;

46620 ifÐ
	gpPag”
->
	geS‹
!=
PAGER_WRITER_DBMOD
 ){

46621 
pPg
->
æags
 |ð
PGHDR_NEED_SYNC
;

46623 
PAGERTRACE
(("APPEND %d…age %d‚eedSync=%d\n",

46624 
PAGERID
(
pPag”
), 
pPg
->
pgno
,

46625 ((
pPg
->
æags
&
PGHDR_NEED_SYNC
)?1:0)));

46634 ifÐ
	gpPag”
->
	gnSav•ošt
>0 && 
subjRequœesPage
(
pPg
) ){

46635 
	grc
 = 
subjouº®Page
(
pPg
);

46641 ifÐ
	gpPag”
->
	gdbSize
<
	gpPg
->
	gpgno
 ){

46642 
	gpPag”
->
	gdbSize
 = 
pPg
->
pgno
;

46644  
	grc
;

46658 
SQLITE_NOINLINE
 
·g”Wr™eL¬geSeùÜ
(
PgHdr
 *
pPg
){

46659 
	grc
 = 
SQLITE_OK
;

46660 
Pgno
 
	gnPageCouÁ
;

46661 
Pgno
 
	gpg1
;

46662 
	gnPage
 = 0;

46663 
	gii
;

46664 
	gÃedSync
 = 0;

46665 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

46666 
Pgno
 
	gnPageP”SeùÜ
 = (
pPag”
->
£ùÜSize
/pPag”->
·geSize
);

46672 
as£¹
Ð!
MEMDB
 );

46673 
as£¹
Ð(
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_NOSYNC
)==0 );

46674 
	gpPag”
->
	gdoNÙSpžl
 |ð
SPILLFLAG_NOSYNC
;

46680 
	gpg1
 = ((
pPg
->
pgno
-1è& ~(
nPageP”SeùÜ
-1)) + 1;

46682 
	gnPageCouÁ
 = 
pPag”
->
dbSize
;

46683 ifÐ
	gpPg
->
	gpgno
>
	gnPageCouÁ
 ){

46684 
	gnPage
 = (
pPg
->
pgno
 - 
pg1
)+1;

46685 }ifÐ(
	gpg1
+
	gnPageP”SeùÜ
-1)>
	gnPageCouÁ
 ){

46686 
	gnPage
 = 
nPageCouÁ
+1-
pg1
;

46688 
	gnPage
 = 
nPageP”SeùÜ
;

46690 
as£¹
(
nPage
>0);

46691 
as£¹
(
pg1
<=
pPg
->
pgno
);

46692 
as£¹
((
pg1
+
nPage
)>
pPg
->
pgno
);

46694 
	gii
=0; ii<
	gnPage
 && 
	grc
==
SQLITE_OK
; ii++){

46695 
Pgno
 
	gpg
 = 
pg1
+
ii
;

46696 
PgHdr
 *
	gpPage
;

46697 ifÐ
	gpg
==
pPg
->
pgno
 || !
sql™e3B™vecTe¡
(
pPag”
->
pInJouº®
, 
pg
) ){

46698 ifÐ
	gpg
!=
PAGER_MJ_PGNO
(
pPag”
) ){

46699 
rc
 = 
sql™e3Pag”G‘
(
pPag”
, 
pg
, &
pPage
);

46700 ifÐ
	grc
==
SQLITE_OK
 ){

46701 
rc
 = 
·g”_wr™e
(
pPage
);

46702 ifÐ
	gpPage
->
	gæags
&
	gPGHDR_NEED_SYNC
 ){

46703 
	gÃedSync
 = 1;

46705 
sql™e3Pag”UÄefNÙNuÎ
(
pPage
);

46708 }ifÐ(
	gpPage
 = 
sql™e3Pag”Lookup
(
pPag”
, 
pg
))!=0 ){

46709 ifÐ
pPage
->
æags
&
PGHDR_NEED_SYNC
 ){

46710 
ÃedSync
 = 1;

46712 
sql™e3Pag”UÄefNÙNuÎ
(
pPage
);

46722 ifÐ
	grc
==
SQLITE_OK
 && 
ÃedSync
 ){

46723 
as£¹
Ð!
MEMDB
 );

46724 
	gii
=0; ii<
	gnPage
; ii++){

46725 
PgHdr
 *
	gpPage
 = 
sql™e3Pag”Lookup
(
pPag”
, 
pg1
+
ii
);

46726 ifÐ
	gpPage
 ){

46727 
	gpPage
->
	gæags
 |ð
PGHDR_NEED_SYNC
;

46728 
sql™e3Pag”UÄefNÙNuÎ
(
pPage
);

46733 
as£¹
Ð(
pPag”
->
doNÙSpžl
 & 
SPILLFLAG_NOSYNC
)!=0 );

46734 
	gpPag”
->
	gdoNÙSpžl
 &ð~
SPILLFLAG_NOSYNC
;

46735  
	grc
;

46752 
SQLITE_PRIVATE
 
sql™e3Pag”Wr™e
(
PgHdr
 *
pPg
){

46753 
as£¹
Ð(
pPg
->
æags
 & 
PGHDR_MMAP
)==0 );

46754 
as£¹
Ð
pPg
->
pPag”
->
eS‹
>=
PAGER_WRITER_LOCKED
 );

46755 
as£¹
Ð
pPg
->
pPag”
->
eS‹
!=
PAGER_ERROR
 );

46756 
as£¹
Ð
as£¹_·g”_¡©e
(
pPg
->
pPag”
) );

46757 ifÐ
	gpPg
->
	gpPag”
->
	g£ùÜSize
 > (
	gu32
íPg->pPag”->
	g·geSize
 ){

46758  
·g”Wr™eL¬geSeùÜ
(
pPg
);

46760  
·g”_wr™e
(
pPg
);

46769 #iâdeà
NDEBUG


46770 
SQLITE_PRIVATE
 
sql™e3Pag”Iswr™—bË
(
DbPage
 *
pPg
){

46771  
	gpPg
->
	gæags
&
	gPGHDR_DIRTY
;

46789 
SQLITE_PRIVATE
 
sql™e3Pag”DÚtWr™e
(
PgHdr
 *
pPg
){

46790 
Pag”
 *
	gpPag”
 = 
pPg
->
pPag”
;

46791 ifÐ(
	gpPg
->
	gæags
&
	gPGHDR_DIRTY
è&& 
	gpPag”
->
	gnSav•ošt
==0 ){

46792 
PAGERTRACE
(("DONT_WRITE…ag%d oà%d\n", 
pPg
->
pgno
, 
PAGERID
(
pPag”
)));

46793 
IOTRACE
(("CLEAN %°%d\n", 
pPag”
, 
pPg
->
pgno
))

46794 
	gpPg
->
	gæags
 |ð
PGHDR_DONT_WRITE
;

46795 
·g”_£t_·gehash
(
pPg
);

46821 
·g”_šü_chªgecouÁ”
(
Pag”
 *
pPag”
, 
isDœeùMode
){

46822 
	grc
 = 
SQLITE_OK
;

46824 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


46825 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


46827 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46839 #iâdeà
SQLITE_ENABLE_ATOMIC_WRITE


46840 
	#DIRECT_MODE
 0

	)

46841 
as£¹
Ð
isDœeùMode
==0 );

46842 
UNUSED_PARAMETER
(
isDœeùMode
);

46844 
	#DIRECT_MODE
 
isDœeùMode


	)

46847 ifÐ!
	gpPag”
->
	gchªgeCouÁDÚe
 && 
ALWAYS
(
pPag”
->
dbSize
>0) ){

46848 
PgHdr
 *
	gpPgHdr
;

46850 
as£¹
Ð!
pPag”
->
‹mpFže
 && 
isO³n
ÕPag”->
fd
) );

46853 
	grc
 = 
sql™e3Pag”G‘
(
pPag”
, 1, &
pPgHdr
);

46854 
as£¹
Ð
pPgHdr
==0 || 
rc
==
SQLITE_OK
 );

46861 ifÐ!
	gDIRECT_MODE
 && 
ALWAYS
(
rc
==
SQLITE_OK
) ){

46862 
rc
 = 
sql™e3Pag”Wr™e
(
pPgHdr
);

46865 ifÐ
	grc
==
SQLITE_OK
 ){

46867 
·g”_wr™e_chªgecouÁ”
(
pPgHdr
);

46870 ifÐ
	gDIRECT_MODE
 ){

46871 cÚ¡ *
	gzBuf
;

46872 
as£¹
Ð
pPag”
->
dbFžeSize
>0 );

46873 
CODEC2
(
pPag”
, 
pPgHdr
->
pD©a
, 1, 6, 
rc
=
SQLITE_NOMEM
, 
zBuf
);

46874 ifÐ
	grc
==
SQLITE_OK
 ){

46875 
rc
 = 
sql™e3OsWr™e
(
pPag”
->
fd
, 
zBuf
,…Pag”->
·geSize
, 0);

46876 
	gpPag”
->
	gaSt
[
PAGER_STAT_WRITE
]++;

46878 ifÐ
	grc
==
SQLITE_OK
 ){

46882 cÚ¡ *
pCÝy
 = (cÚ¡ *)&((cÚ¡ *)
zBuf
)[24];

46883 
memýy
(&
pPag”
->
dbFžeV”s
, 
pCÝy
, (pPager->dbFileVers));

46884 
	gpPag”
->
	gchªgeCouÁDÚe
 = 1;

46887 
	gpPag”
->
	gchªgeCouÁDÚe
 = 1;

46892 
sql™e3Pag”UÄef
(
pPgHdr
);

46894  
	grc
;

46904 
SQLITE_PRIVATE
 
sql™e3Pag”Sync
(
Pag”
 *
pPag”
, cÚ¡ *
zMa¡”
){

46905 
	grc
 = 
SQLITE_OK
;

46907 ifÐ
isO³n
(
pPag”
->
fd
) ){

46908 *
	gpArg
 = (*)
zMa¡”
;

46909 
	grc
 = 
sql™e3OsFžeCÚŒÞ
(
pPag”
->
fd
, 
SQLITE_FCNTL_SYNC
, 
pArg
);

46910 ifÐ
	grc
==
SQLITE_NOTFOUND
 ) 
rc
 = 
SQLITE_OK
;

46912 ifÐ
	grc
==
SQLITE_OK
 && !
pPag”
->
noSync
 ){

46913 
as£¹
Ð!
MEMDB
 );

46914 
	grc
 = 
sql™e3OsSync
(
pPag”
->
fd
,…Pag”->
syncFÏgs
);

46916  
	grc
;

46930 
SQLITE_PRIVATE
 
sql™e3Pag”ExþusiveLock
(
Pag”
 *
pPag”
){

46931 
	grc
 = 
SQLITE_OK
;

46932 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


46933 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


46934 || 
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED


46936 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46937 ifÐ0==
·g”U£W®
(
pPag”
) ){

46938 
rc
 = 
·g”_wa™_Ú_lock
(
pPag”
, 
EXCLUSIVE_LOCK
);

46940  
	grc
;

46969 
SQLITE_PRIVATE
 
sql™e3Pag”Comm™Pha£OÃ
(

46970 
Pag”
 *
pPag”
,

46971 cÚ¡ *
zMa¡”
,

46972 
noSync


46974 
	grc
 = 
SQLITE_OK
;

46976 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED


46977 || 
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


46978 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


46979 || 
pPag”
->
eS‹
==
PAGER_ERROR


46981 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

46984 ifÐ
NEVER
(
pPag”
->
”rCode
èè 
	gpPag”
->
	g”rCode
;

46986 
PAGERTRACE
(("DATABASE SYNC: File=%s zMaster=%s‚Size=%d\n",

46987 
pPag”
->
zFž’ame
, 
zMa¡”
,…Pag”->
dbSize
));

46990 ifÐ
	gpPag”
->
	geS‹
<
	gPAGER_WRITER_CACHEMOD
 )  
	gSQLITE_OK
;

46992 ifÐ
	gMEMDB
 ){

46997 
sql™e3BackupRe¡¬t
(
pPag”
->
pBackup
);

46999 ifÐ
·g”U£W®
(
pPag”
) ){

47000 
PgHdr
 *
	gpLi¡
 = 
sql™e3PÿcheDœtyLi¡
(
pPag”
->
pPCache
);

47001 
PgHdr
 *
	gpPageOÃ
 = 0;

47002 ifÐ
	gpLi¡
==0 ){

47005 
rc
 = 
sql™e3Pag”G‘
(
pPag”
, 1, &
pPageOÃ
);

47006 
	gpLi¡
 = 
pPageOÃ
;

47007 
	gpLi¡
->
	gpDœty
 = 0;

47009 
as£¹
Ð
rc
==
SQLITE_OK
 );

47010 ifÐ
ALWAYS
(
pLi¡
) ){

47011 
	grc
 = 
·g”W®F¿mes
(
pPag”
, 
pLi¡
,…Pag”->
dbSize
, 1);

47013 
sql™e3Pag”UÄef
(
pPageOÃ
);

47014 ifÐ
	grc
==
SQLITE_OK
 ){

47015 
sql™e3PÿcheCËªAÎ
(
pPag”
->
pPCache
);

47041 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


47042 
PgHdr
 *
	gpPg
;

47043 
as£¹
Ð
isO³n
(
pPag”
->
jfd
)

47044 || 
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF


47045 || 
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL


47047 ifÐ!
	gzMa¡”
 && 
isO³n
(
pPag”
->
jfd
)

47048 && 
	gpPag”
->
	gjouº®Off
==
jºlBufãrSize
(
pPag”
)

47049 && 
pPag”
->
dbSize
>õPag”->
dbOrigSize


47050 && (0==(
pPg
 = 
sql™e3PÿcheDœtyLi¡
(
pPag”
->
pPCache
)è|| 0=õPg->
pDœty
)

47058 
rc
 = 
·g”_šü_chªgecouÁ”
(
pPag”
, 1);

47060 
	grc
 = 
sql™e3Jouº®C»©e
(
pPag”
->
jfd
);

47061 ifÐ
	grc
==
SQLITE_OK
 ){

47062 
rc
 = 
·g”_šü_chªgecouÁ”
(
pPag”
, 0);

47066 
	grc
 = 
·g”_šü_chªgecouÁ”
(
pPag”
, 0);

47068 ifÐ
	grc
!=
SQLITE_OK
 ) 
comm™_pha£_Úe_ex™
;

47074 
	grc
 = 
wr™eMa¡”Jouº®
(
pPag”
, 
zMa¡”
);

47075 ifÐ
	grc
!=
SQLITE_OK
 ) 
comm™_pha£_Úe_ex™
;

47088 
	grc
 = 
syncJouº®
(
pPag”
, 0);

47089 ifÐ
	grc
!=
SQLITE_OK
 ) 
comm™_pha£_Úe_ex™
;

47091 
	grc
 = 
·g”_wr™e_·g–i¡
(
pPag”
,
sql™e3PÿcheDœtyLi¡
ÕPag”->
pPCache
));

47092 ifÐ
	grc
!=
SQLITE_OK
 ){

47093 
as£¹
Ð
rc
!=
SQLITE_IOERR_BLOCKED
 );

47094 
	gcomm™_pha£_Úe_ex™
;

47096 
sql™e3PÿcheCËªAÎ
(
pPag”
->
pPCache
);

47104 ifÐ
	gpPag”
->
	gdbSize
>pPag”->
	gdbFžeSize
 ){

47105 
Pgno
 
	gnNew
 = 
pPag”
->
dbSize
 - (pPag”->dbSize==
PAGER_MJ_PGNO
(pPager));

47106 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD
 );

47107 
	grc
 = 
·g”_Œunÿ‹
(
pPag”
, 
nNew
);

47108 ifÐ
	grc
!=
SQLITE_OK
 ) 
comm™_pha£_Úe_ex™
;

47112 ifÐ!
	gnoSync
 ){

47113 
	grc
 = 
sql™e3Pag”Sync
(
pPag”
, 
zMa¡”
);

47115 
IOTRACE
(("DBSYNC %p\n", 
pPag”
))

47119 
	gcomm™_pha£_Úe_ex™
:

47120 ifÐ
rc
==
SQLITE_OK
 && !
·g”U£W®
(
pPag”
) ){

47121 
pPag”
->
eS‹
 = 
PAGER_WRITER_FINISHED
;

47123  
	grc
;

47142 
SQLITE_PRIVATE
 
sql™e3Pag”Comm™Pha£Two
(
Pag”
 *
pPag”
){

47143 
	grc
 = 
SQLITE_OK
;

47148 ifÐ
NEVER
(
pPag”
->
”rCode
èè 
	gpPag”
->
	g”rCode
;

47150 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_LOCKED


47151 || 
pPag”
->
eS‹
==
PAGER_WRITER_FINISHED


47152 || (
·g”U£W®
(
pPag”
è&&…Pag”->
eS‹
==
PAGER_WRITER_CACHEMOD
)

47154 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

47167 ifÐ
	gpPag”
->
	geS‹
==
PAGER_WRITER_LOCKED


47168 && 
pPag”
->
exþusiveMode


47169 && 
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_PERSIST


47171 
as£¹
Ð
pPag”
->
jouº®Off
==
JOURNAL_HDR_SZ
(pPager) || !pPager->journalOff );

47172 
	gpPag”
->
	geS‹
 = 
PAGER_READER
;

47173  
	gSQLITE_OK
;

47176 
PAGERTRACE
(("COMMIT %d\n", 
PAGERID
(
pPag”
)));

47177 
	grc
 = 
·g”_’d_Œª§ùiÚ
(
pPag”
,…Pag”->
£tMa¡”
, 1);

47178  
·g”_”rÜ
(
pPag”
, 
rc
);

47207 
SQLITE_PRIVATE
 
sql™e3Pag”RÞlback
(
Pag”
 *
pPag”
){

47208 
	grc
 = 
SQLITE_OK
;

47209 
PAGERTRACE
(("ROLLBACK %d\n", 
PAGERID
(
pPag”
)));

47215 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

47216 ifÐ
	gpPag”
->
	geS‹
==
PAGER_ERROR
 )  
pPag”
->
”rCode
;

47217 ifÐ
	gpPag”
->
	geS‹
<=
PAGER_READER
 )  
SQLITE_OK
;

47219 ifÐ
·g”U£W®
(
pPag”
) ){

47220 
	grc2
;

47221 
	grc
 = 
sql™e3Pag”Sav•ošt
(
pPag”
, 
SAVEPOINT_ROLLBACK
, -1);

47222 
	grc2
 = 
·g”_’d_Œª§ùiÚ
(
pPag”
,…Pag”->
£tMa¡”
, 0);

47223 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

47224 }ifÐ!
isO³n
(
pPag”
->
jfd
è|| 
	gpPag”
->
	geS‹
==
PAGER_WRITER_LOCKED
 ){

47225 
eS‹
 = 
pPag”
->eState;

47226 
	grc
 = 
·g”_’d_Œª§ùiÚ
(
pPag”
, 0, 0);

47227 ifÐ!
	gMEMDB
 && 
	geS‹
>
	gPAGER_WRITER_LOCKED
 ){

47232 
	gpPag”
->
	g”rCode
 = 
SQLITE_ABORT
;

47233 
	gpPag”
->
	geS‹
 = 
PAGER_ERROR
;

47234  
	grc
;

47237 
	grc
 = 
·g”_¶ayback
(
pPag”
, 0);

47240 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_READER
 || 
rc
!=
SQLITE_OK
 );

47241 
as£¹
Ð
rc
==
SQLITE_OK
 ||„c==
SQLITE_FULL
 ||„c==
SQLITE_CORRUPT


47242 || 
rc
==
SQLITE_NOMEM
 || (rc&0xFF)==
SQLITE_IOERR


47243 || 
rc
==
SQLITE_CANTOPEN


47249  
·g”_”rÜ
(
pPag”
, 
rc
);

47256 
SQLITE_PRIVATE
 
u8
 
sql™e3Pag”I¤—dÚly
(
Pag”
 *
pPag”
){

47257  
	gpPag”
->
	g»adOÆy
;

47263 
SQLITE_PRIVATE
 
sql™e3Pag”RefcouÁ
(
Pag”
 *
pPag”
){

47264  
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
);

47271 
SQLITE_PRIVATE
 
sql™e3Pag”MemU£d
(
Pag”
 *
pPag”
){

47272 
	g³rPageSize
 = 
pPag”
->
·geSize
 +…Pag”->
nExŒa
 + (
PgHdr
)

47274  
³rPageSize
*
sql™e3PÿchePagecouÁ
(
pPag”
->
pPCache
)

47275 + 
sql™e3M®locSize
(
pPag”
)

47276 + 
	gpPag”
->
	g·geSize
;

47282 
SQLITE_PRIVATE
 
sql™e3Pag”PageRefcouÁ
(
DbPage
 *
pPage
){

47283  
sql™e3PÿchePageRefcouÁ
(
pPage
);

47286 #ifdeà
SQLITE_TEST


47290 
SQLITE_PRIVATE
 *
sql™e3Pag”Sts
(
Pag”
 *
pPag”
){

47291 
	ga
[11];

47292 
	ga
[0] = 
sql™e3PÿcheRefCouÁ
(
pPag”
->
pPCache
);

47293 
	ga
[1] = 
sql™e3PÿchePagecouÁ
(
pPag”
->
pPCache
);

47294 
	ga
[2] = 
sql™e3PÿcheG‘Cachesize
(
pPag”
->
pPCache
);

47295 
	ga
[3] = 
pPag”
->
eS‹
==
PAGER_OPEN
 ? -1 : (èpPag”->
dbSize
;

47296 
	ga
[4] = 
pPag”
->
eS‹
;

47297 
	ga
[5] = 
pPag”
->
”rCode
;

47298 
	ga
[6] = 
pPag”
->
aSt
[
PAGER_STAT_HIT
];

47299 
	ga
[7] = 
pPag”
->
aSt
[
PAGER_STAT_MISS
];

47300 
	ga
[8] = 0;

47301 
	ga
[9] = 
pPag”
->
nR—d
;

47302 
	ga
[10] = 
pPag”
->
aSt
[
PAGER_STAT_WRITE
];

47303  
	ga
;

47314 
SQLITE_PRIVATE
 
sql™e3Pag”CacheSt
(
Pag”
 *
pPag”
, 
eSt
, 
»£t
, *
²V®
){

47316 
as£¹
Ð
eSt
==
SQLITE_DBSTATUS_CACHE_HIT


47317 || 
eSt
==
SQLITE_DBSTATUS_CACHE_MISS


47318 || 
eSt
==
SQLITE_DBSTATUS_CACHE_WRITE


47321 
as£¹
Ð
SQLITE_DBSTATUS_CACHE_HIT
+1==
SQLITE_DBSTATUS_CACHE_MISS
 );

47322 
as£¹
Ð
SQLITE_DBSTATUS_CACHE_HIT
+2==
SQLITE_DBSTATUS_CACHE_WRITE
 );

47323 
as£¹
Ð
PAGER_STAT_HIT
==0 && 
PAGER_STAT_MISS
==1 && 
PAGER_STAT_WRITE
==2 );

47325 *
	g²V®
 +ð
pPag”
->
aSt
[
eSt
 - 
SQLITE_DBSTATUS_CACHE_HIT
];

47326 ifÐ
	g»£t
 ){

47327 
	gpPag”
->
	gaSt
[
eSt
 - 
SQLITE_DBSTATUS_CACHE_HIT
] = 0;

47334 
SQLITE_PRIVATE
 
sql™e3Pag”IsMemdb
(
Pag”
 *
pPag”
){

47335  
	gMEMDB
;

47348 
SQLITE_PRIVATE
 
sql™e3Pag”O³nSav•ošt
(
Pag”
 *
pPag”
, 
nSav•ošt
){

47349 
	grc
 = 
SQLITE_OK
;

47350 
	gnCu¼’t
 = 
pPag”
->
nSav•ošt
;

47352 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_WRITER_LOCKED
 );

47353 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

47355 ifÐ
	gnSav•ošt
>
	gnCu¼’t
 && 
	gpPag”
->
	gu£Jouº®
 ){

47356 
	gii
;

47357 
Pag”Sav•ošt
 *
	gaNew
;

47363 
	gaNew
 = (
Pag”Sav•ošt
 *)
sql™e3R—Îoc
(

47364 
pPag”
->
aSav•ošt
, (
Pag”Sav•ošt
)*
nSav•ošt


47366 ifÐ!
	gaNew
 ){

47367  
	gSQLITE_NOMEM
;

47369 
mem£t
(&
aNew
[
nCu¼’t
], 0, (
nSav•ošt
-nCu¼’tè* (
Pag”Sav•ošt
));

47370 
	gpPag”
->
	gaSav•ošt
 = 
aNew
;

47373 
	gii
=
nCu¼’t
; ii<
	gnSav•ošt
; ii++){

47374 
	gaNew
[
ii
].
	gnOrig
 = 
pPag”
->
dbSize
;

47375 ifÐ
isO³n
(
pPag”
->
jfd
è&& 
	gpPag”
->
	gjouº®Off
>0 ){

47376 
	gaNew
[
ii
].
	giOff£t
 = 
pPag”
->
jouº®Off
;

47378 
	gaNew
[
ii
].
	giOff£t
 = 
JOURNAL_HDR_SZ
(
pPag”
);

47380 
	gaNew
[
ii
].
	giSubRec
 = 
pPag”
->
nSubRec
;

47381 
	gaNew
[
ii
].
	gpInSav•ošt
 = 
sql™e3B™vecC»©e
(
pPag”
->
dbSize
);

47382 ifÐ!
	gaNew
[
ii
].
	gpInSav•ošt
 ){

47383  
	gSQLITE_NOMEM
;

47385 ifÐ
·g”U£W®
(
pPag”
) ){

47386 
sql™e3W®Sav•ošt
(
pPag”
->
pW®
, 
aNew
[
ii
].
aW®D©a
);

47388 
	gpPag”
->
	gnSav•ošt
 = 
ii
+1;

47390 
as£¹
Ð
pPag”
->
nSav•ošt
==nSavepoint );

47391 
as£¹Trunÿ‹CÚ¡¿št
(
pPag”
);

47394  
	grc
;

47427 
SQLITE_PRIVATE
 
sql™e3Pag”Sav•ošt
(
Pag”
 *
pPag”
, 
Ý
, 
iSav•ošt
){

47428 
	grc
 = 
pPag”
->
”rCode
;

47430 
as£¹
Ð
Ý
==
SAVEPOINT_RELEASE
 || op==
SAVEPOINT_ROLLBACK
 );

47431 
as£¹
Ð
iSav•ošt
>=0 || 
Ý
==
SAVEPOINT_ROLLBACK
 );

47433 ifÐ
	grc
==
SQLITE_OK
 && 
iSav•ošt
<
pPag”
->
nSav•ošt
 ){

47434 
ii
;

47435 
	gnNew
;

47441 
	gnNew
 = 
iSav•ošt
 + (Ð
Ý
==
SAVEPOINT_RELEASE
 ) ? 0 : 1);

47442 
	gii
=
nNew
; ii<
	gpPag”
->
	gnSav•ošt
; ii++){

47443 
sql™e3B™vecDe¡roy
(
pPag”
->
aSav•ošt
[
ii
].
pInSav•ošt
);

47445 
	gpPag”
->
	gnSav•ošt
 = 
nNew
;

47449 ifÐ
	gÝ
==
SAVEPOINT_RELEASE
 ){

47450 ifÐ
nNew
==0 && 
isO³n
(
pPag”
->
sjfd
) ){

47452 ifÐ
sql™e3IsMemJouº®
(
pPag”
->
sjfd
) ){

47453 
rc
 = 
sql™e3OsTrunÿ‹
(
pPag”
->
sjfd
, 0);

47454 
as£¹
Ð
rc
==
SQLITE_OK
 );

47456 
	gpPag”
->
	gnSubRec
 = 0;

47464 ifÐ
·g”U£W®
(
pPag”
è|| 
isO³n
ÕPag”->
jfd
) ){

47465 
Pag”Sav•ošt
 *
	gpSav•ošt
 = (
nNew
==0)?0:&
pPag”
->
aSav•ošt
[nNew-1];

47466 
	grc
 = 
·g”PÏybackSav•ošt
(
pPag”
, 
pSav•ošt
);

47467 
as£¹
(
rc
!=
SQLITE_DONE
);

47471  
	grc
;

47484 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Pag”Fž’ame
(
Pag”
 *
pPag”
, 
nuÎIfMemDb
){

47485  (
	gnuÎIfMemDb
 && 
	gpPag”
->
	gmemDb
è? "" : 
pPag”
->
zFž’ame
;

47491 
SQLITE_PRIVATE
 cÚ¡ 
sql™e3_vfs
 *
sql™e3Pag”Vfs
(
Pag”
 *
pPag”
){

47492  
	gpPag”
->
	gpVfs
;

47500 
SQLITE_PRIVATE
 
sql™e3_fže
 *
sql™e3Pag”Fže
(
Pag”
 *
pPag”
){

47501  
	gpPag”
->
	gfd
;

47507 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Pag”Jouº®Çme
(
Pag”
 *
pPag”
){

47508  
	gpPag”
->
	gzJouº®
;

47515 
SQLITE_PRIVATE
 
sql™e3Pag”Nosync
(
Pag”
 *
pPag”
){

47516  
	gpPag”
->
	gnoSync
;

47519 #ifdeà
SQLITE_HAS_CODEC


47523 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Codec
(

47524 
Pag”
 *
pPag”
,

47525 *(*
xCodec
)(*,*,
Pgno
,),

47526 (*
xCodecSizeChng
)(*,,),

47527 (*
xCodecF»e
)(*),

47528 *
pCodec


47530 ifÐ
	gpPag”
->
	gxCodecF»e
 )…Pag”->
xCodecF»e
(
pPag”
->
pCodec
);

47531 
	gpPag”
->
	gxCodec
 = 
pPag”
->
memDb
 ? 0 : 
xCodec
;

47532 
	gpPag”
->
	gxCodecSizeChng
 = 
xCodecSizeChng
;

47533 
	gpPag”
->
	gxCodecF»e
 = 
xCodecF»e
;

47534 
	gpPag”
->
	gpCodec
 = 
pCodec
;

47535 
·g”R•ÜtSize
(
pPag”
);

47537 
SQLITE_PRIVATE
 *
sql™e3Pag”G‘Codec
(
Pag”
 *
pPag”
){

47538  
	gpPag”
->
	gpCodec
;

47548 
SQLITE_PRIVATE
 *
sql™e3Pag”Codec
(
PgHdr
 *
pPg
){

47549 *
	gaD©a
 = 0;

47550 
CODEC2
(
pPg
->
pPag”
,…Pg->
pD©a
,…Pg->
pgno
, 6,  0, 
aD©a
);

47551  
	gaD©a
;

47557 
SQLITE_PRIVATE
 
sql™e3Pag”S‹
(
Pag”
 *
pPag”
){

47558  
	gpPag”
->
	geS‹
;

47562 #iâdeà
SQLITE_OMIT_AUTOVACUUM


47588 
SQLITE_PRIVATE
 
sql™e3Pag”Mov•age
(
Pag”
 *
pPag”
, 
DbPage
 *
pPg
, 
Pgno
 
pgno
, 
isComm™
){

47589 
PgHdr
 *
	gpPgOld
;

47590 
Pgno
 
	gÃedSyncPgno
 = 0;

47591 
	grc
;

47592 
Pgno
 
	gÜigPgno
;

47594 
as£¹
Ð
pPg
->
nRef
>0 );

47595 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_WRITER_CACHEMOD


47596 || 
pPag”
->
eS‹
==
PAGER_WRITER_DBMOD


47598 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

47603 ifÐ
	gMEMDB
 ){

47604 
	grc
 = 
sql™e3Pag”Wr™e
(
pPg
);

47605 ifÐ
	grc
 ) „c;

47626 ifÐ
	gpPg
->
	gæags
&
	gPGHDR_DIRTY


47627 && 
subjRequœesPage
(
pPg
)

47628 && 
	gSQLITE_OK
!=(
rc
 = 
subjouº®Page
(
pPg
))

47630  
rc
;

47633 
PAGERTRACE
(("MOVE %d…age %d (needSync=%d) moveso %d\n",

47634 
PAGERID
(
pPag”
), 
pPg
->
pgno
, (pPg->
æags
&
PGHDR_NEED_SYNC
)?1:0,…gno));

47635 
IOTRACE
(("MOVE %°%d %d\n", 
pPag”
, 
pPg
->
pgno
,…gno))

47644 ifÐ(
	gpPg
->
	gæags
&
	gPGHDR_NEED_SYNC
è&& !
	gisComm™
 ){

47645 
	gÃedSyncPgno
 = 
pPg
->
pgno
;

47646 
as£¹
Ð
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_OFF
 ||

47647 
·geInJouº®
(
pPag”
, 
pPg
è||…Pg->
pgno
>pPag”->
dbOrigSize
 );

47648 
as£¹
Ð
pPg
->
æags
&
PGHDR_DIRTY
 );

47656 
	gpPg
->
	gæags
 &ð~
PGHDR_NEED_SYNC
;

47657 
	gpPgOld
 = 
sql™e3Pag”Lookup
(
pPag”
, 
pgno
);

47658 
as£¹
Ð!
pPgOld
 ||…PgOld->
nRef
==1 );

47659 ifÐ
	gpPgOld
 ){

47660 
	gpPg
->
	gæags
 |ð(
pPgOld
->
æags
&
PGHDR_NEED_SYNC
);

47661 ifÐ
	gMEMDB
 ){

47664 
sql™e3PÿcheMove
(
pPgOld
, 
pPag”
->
dbSize
+1);

47666 
sql™e3PÿcheDrÝ
(
pPgOld
);

47670 
	gÜigPgno
 = 
pPg
->
pgno
;

47671 
sql™e3PÿcheMove
(
pPg
, 
pgno
);

47672 
sql™e3PÿcheMakeDœty
(
pPg
);

47678 ifÐ
	gMEMDB
 ){

47679 
as£¹
Ð
pPgOld
 );

47680 
sql™e3PÿcheMove
(
pPgOld
, 
ÜigPgno
);

47681 
sql™e3Pag”UÄefNÙNuÎ
(
pPgOld
);

47684 ifÐ
	gÃedSyncPgno
 ){

47699 
PgHdr
 *
	gpPgHdr
;

47700 
	grc
 = 
sql™e3Pag”G‘
(
pPag”
, 
ÃedSyncPgno
, &
pPgHdr
);

47701 ifÐ
	grc
!=
SQLITE_OK
 ){

47702 ifÐ
ÃedSyncPgno
<=
pPag”
->
dbOrigSize
 ){

47703 
as£¹
Ð
pPag”
->
pTmpS·û
!=0 );

47704 
sql™e3B™vecCË¬
(
pPag”
->
pInJouº®
, 
ÃedSyncPgno
,…Pag”->
pTmpS·û
);

47706  
	grc
;

47708 
	gpPgHdr
->
	gæags
 |ð
PGHDR_NEED_SYNC
;

47709 
sql™e3PÿcheMakeDœty
(
pPgHdr
);

47710 
sql™e3Pag”UÄefNÙNuÎ
(
pPgHdr
);

47713  
	gSQLITE_OK
;

47720 
SQLITE_PRIVATE
 *
sql™e3Pag”G‘D©a
(
DbPage
 *
pPg
){

47721 
as£¹
Ð
pPg
->
nRef
>0 ||…Pg->
pPag”
->
memDb
 );

47722  
	gpPg
->
	gpD©a
;

47729 
SQLITE_PRIVATE
 *
sql™e3Pag”G‘ExŒa
(
DbPage
 *
pPg
){

47730  
	gpPg
->
	gpExŒa
;

47743 
SQLITE_PRIVATE
 
sql™e3Pag”LockšgMode
(
Pag”
 *
pPag”
, 
eMode
){

47744 
as£¹
Ð
eMode
==
PAGER_LOCKINGMODE_QUERY


47745 || 
eMode
==
PAGER_LOCKINGMODE_NORMAL


47746 || 
eMode
==
PAGER_LOCKINGMODE_EXCLUSIVE
 );

47747 
as£¹
Ð
PAGER_LOCKINGMODE_QUERY
<0 );

47748 
as£¹
Ð
PAGER_LOCKINGMODE_NORMAL
>=0 && 
PAGER_LOCKINGMODE_EXCLUSIVE
>=0 );

47749 
as£¹
Ð
pPag”
->
exþusiveMode
 || 0==
sql™e3W®H—pMemÜy
ÕPag”->
pW®
) );

47750 ifÐ
	geMode
>=0 && !
pPag”
->
‹mpFže
 && !
sql™e3W®H—pMemÜy
ÕPag”->
pW®
) ){

47751 
pPag”
->
exþusiveMode
 = (
u8
)
eMode
;

47753  ()
	gpPag”
->
	gexþusiveMode
;

47776 
SQLITE_PRIVATE
 
sql™e3Pag”S‘Jouº®Mode
(
Pag”
 *
pPag”
, 
eMode
){

47777 
u8
 
	geOld
 = 
pPag”
->
jouº®Mode
;

47779 #ifdeà
SQLITE_DEBUG


47782 
´št_·g”_¡©e
(
pPag”
);

47787 
as£¹
Ð
eMode
==
PAGER_JOURNALMODE_DELETE


47788 || 
eMode
==
PAGER_JOURNALMODE_TRUNCATE


47789 || 
eMode
==
PAGER_JOURNALMODE_PERSIST


47790 || 
eMode
==
PAGER_JOURNALMODE_OFF


47791 || 
eMode
==
PAGER_JOURNALMODE_WAL


47792 || 
eMode
==
PAGER_JOURNALMODE_MEMORY
 );

47798 
as£¹
Ð
pPag”
->
‹mpFže
==0 || 
eMode
!=
PAGER_JOURNALMODE_WAL
 );

47803 ifÐ
	gMEMDB
 ){

47804 
as£¹
Ð
eOld
==
PAGER_JOURNALMODE_MEMORY
 ||ƒOld==
PAGER_JOURNALMODE_OFF
 );

47805 ifÐ
	geMode
!=
PAGER_JOURNALMODE_MEMORY
 && 
eMode
!=
PAGER_JOURNALMODE_OFF
 ){

47806 
eMode
 = 
eOld
;

47810 ifÐ
	geMode
!=
eOld
 ){

47813 
as£¹
Ð
pPag”
->
eS‹
!=
PAGER_ERROR
 );

47814 
	gpPag”
->
	gjouº®Mode
 = (
u8
)
eMode
;

47820 
as£¹
Ð(
PAGER_JOURNALMODE_TRUNCATE
 & 5)==1 );

47821 
as£¹
Ð(
PAGER_JOURNALMODE_PERSIST
 & 5)==1 );

47822 
as£¹
Ð(
PAGER_JOURNALMODE_DELETE
 & 5)==0 );

47823 
as£¹
Ð(
PAGER_JOURNALMODE_MEMORY
 & 5)==4 );

47824 
as£¹
Ð(
PAGER_JOURNALMODE_OFF
 & 5)==0 );

47825 
as£¹
Ð(
PAGER_JOURNALMODE_WAL
 & 5)==5 );

47827 
as£¹
Ð
isO³n
(
pPag”
->
fd
è||…Pag”->
exþusiveMode
 );

47828 ifÐ!
	gpPag”
->
	gexþusiveMode
 && (
	geOld
 & 5)==1 && (
eMode
 & 1)==0 ){

47838 
sql™e3OsClo£
(
pPag”
->
jfd
);

47839 ifÐ
	gpPag”
->
	geLock
>=
RESERVED_LOCK
 ){

47840 
sql™e3OsD–‘e
(
pPag”
->
pVfs
,…Pag”->
zJouº®
, 0);

47842 
	grc
 = 
SQLITE_OK
;

47843 
	g¡©e
 = 
pPag”
->
eS‹
;

47844 
as£¹
Ð
¡©e
==
PAGER_OPEN
 || s‹==
PAGER_READER
 );

47845 ifÐ
	g¡©e
==
PAGER_OPEN
 ){

47846 
rc
 = 
sql™e3Pag”Sh¬edLock
(
pPag”
);

47848 ifÐ
	gpPag”
->
	geS‹
==
PAGER_READER
 ){

47849 
as£¹
Ð
rc
==
SQLITE_OK
 );

47850 
	grc
 = 
·g”LockDb
(
pPag”
, 
RESERVED_LOCK
);

47852 ifÐ
	grc
==
SQLITE_OK
 ){

47853 
sql™e3OsD–‘e
(
pPag”
->
pVfs
,…Pag”->
zJouº®
, 0);

47855 ifÐ
	grc
==
SQLITE_OK
 && 
¡©e
==
PAGER_READER
 ){

47856 
·g”UÆockDb
(
pPag”
, 
SHARED_LOCK
);

47857 }ifÐ
	g¡©e
==
PAGER_OPEN
 ){

47858 
·g”_uÆock
(
pPag”
);

47860 
as£¹
Ð
¡©e
==
pPag”
->
eS‹
 );

47866  ()
	gpPag”
->
	gjouº®Mode
;

47872 
SQLITE_PRIVATE
 
sql™e3Pag”G‘Jouº®Mode
(
Pag”
 *
pPag”
){

47873  ()
	gpPag”
->
	gjouº®Mode
;

47881 
SQLITE_PRIVATE
 
sql™e3Pag”OkToChªgeJouº®Mode
(
Pag”
 *
pPag”
){

47882 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

47883 ifÐ
	gpPag”
->
	geS‹
>=
PAGER_WRITER_CACHEMOD
 )  0;

47884 ifÐ
NEVER
(
isO³n
(
pPag”
->
jfd
è&&…Pag”->
jouº®Off
>0) )  0;

47894 
SQLITE_PRIVATE
 
i64
 
sql™e3Pag”Jouº®SizeLim™
(
Pag”
 *
pPag”
, i64 
iLim™
){

47895 ifÐ
	giLim™
>=-1 ){

47896 
pPag”
->
jouº®SizeLim™
 = 
iLim™
;

47897 
sql™e3W®Lim™
(
pPag”
->
pW®
, 
iLim™
);

47899  
	gpPag”
->
	gjouº®SizeLim™
;

47908 
SQLITE_PRIVATE
 
sql™e3_backup
 **
sql™e3Pag”BackupPŒ
(
Pag”
 *
pPag”
){

47909  &
	gpPag”
->
	gpBackup
;

47912 #iâdeà
SQLITE_OMIT_VACUUM


47916 
SQLITE_PRIVATE
 
sql™e3Pag”CË¬Cache
(
Pag”
 *
pPag”
){

47917 ifÐ!
	gMEMDB
 && 
	gpPag”
->
	g‹mpFže
==0 ) 
·g”_»£t
(
pPag”
);

47921 #iâdeà
SQLITE_OMIT_WAL


47929 
SQLITE_PRIVATE
 
sql™e3Pag”Checkpošt
(
Pag”
 *
pPag”
, 
eMode
, *
²Log
, *
²Ck±
){

47930 
	grc
 = 
SQLITE_OK
;

47931 ifÐ
	gpPag”
->
	gpW®
 ){

47932 
	grc
 = 
sql™e3W®Checkpošt
(
pPag”
->
pW®
, 
eMode
,

47933 
pPag”
->
xBusyHªdËr
,…Pag”->
pBusyHªdËrArg
,

47934 
pPag”
->
ck±SyncFÏgs
,…Pag”->
·geSize
, (
u8
 *íPag”->
pTmpS·û
,

47935 
²Log
, 
²Ck±


47938  
	grc
;

47941 
SQLITE_PRIVATE
 
sql™e3Pag”W®C®lback
(
Pag”
 *
pPag”
){

47942  
sql™e3W®C®lback
(
pPag”
->
pW®
);

47949 
SQLITE_PRIVATE
 
sql™e3Pag”W®SuµÜ‹d
(
Pag”
 *
pPag”
){

47950 cÚ¡ 
sql™e3_io_m‘hods
 *
	gpM‘hods
 = 
pPag”
->
fd
->
pM‘hods
;

47951  
	gpPag”
->
	gexþusiveMode
 || (
	gpM‘hods
->
	giV”siÚ
>=2 && 
pM‘hods
->
xShmM­
);

47958 
·g”ExþusiveLock
(
Pag”
 *
pPag”
){

47959 
	grc
;

47961 
as£¹
Ð
pPag”
->
eLock
==
SHARED_LOCK
 ||…Pag”->eLock==
EXCLUSIVE_LOCK
 );

47962 
	grc
 = 
·g”LockDb
(
pPag”
, 
EXCLUSIVE_LOCK
);

47963 ifÐ
	grc
!=
SQLITE_OK
 ){

47966 
·g”UÆockDb
(
pPag”
, 
SHARED_LOCK
);

47969  
	grc
;

47978 
·g”O³nW®
(
Pag”
 *
pPag”
){

47979 
	grc
 = 
SQLITE_OK
;

47981 
as£¹
Ð
pPag”
->
pW®
==0 &&…Pag”->
‹mpFže
==0 );

47982 
as£¹
Ð
pPag”
->
eLock
==
SHARED_LOCK
 ||…Pag”->eLock==
EXCLUSIVE_LOCK
 );

47989 ifÐ
	gpPag”
->
	gexþusiveMode
 ){

47990 
	grc
 = 
·g”ExþusiveLock
(
pPag”
);

47996 ifÐ
	grc
==
SQLITE_OK
 ){

47997 
rc
 = 
sql™e3W®O³n
(
pPag”
->
pVfs
,

47998 
pPag”
->
fd
,…Pag”->
zW®
,…Pag”->
exþusiveMode
,

47999 
pPag”
->
jouº®SizeLim™
, &pPag”->
pW®


48002 
·g”FixM­lim™
(
pPag”
);

48004  
	grc
;

48023 
SQLITE_PRIVATE
 
sql™e3Pag”O³nW®
(

48024 
Pag”
 *
pPag”
,

48025 *
pbO³n


48027 
	grc
 = 
SQLITE_OK
;

48029 
as£¹
Ð
as£¹_·g”_¡©e
(
pPag”
) );

48030 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_OPEN
 || 
pbO³n
 );

48031 
as£¹
Ð
pPag”
->
eS‹
==
PAGER_READER
 || !
pbO³n
 );

48032 
as£¹
Ð
pbO³n
==0 || *pbOpen==0 );

48033 
as£¹
Ð
pbO³n
!=0 || (!
pPag”
->
‹mpFže
 && !pPag”->
pW®
) );

48035 ifÐ!
	gpPag”
->
	g‹mpFže
 && !pPag”->
	gpW®
 ){

48036 ifÐ!
sql™e3Pag”W®SuµÜ‹d
(
pPag”
èè 
	gSQLITE_CANTOPEN
;

48039 
sql™e3OsClo£
(
pPag”
->
jfd
);

48041 
	grc
 = 
·g”O³nW®
(
pPag”
);

48042 ifÐ
	grc
==
SQLITE_OK
 ){

48043 
pPag”
->
jouº®Mode
 = 
PAGER_JOURNALMODE_WAL
;

48044 
	gpPag”
->
	geS‹
 = 
PAGER_OPEN
;

48047 *
	gpbO³n
 = 1;

48050  
	grc
;

48062 
SQLITE_PRIVATE
 
sql™e3Pag”Clo£W®
(
Pag”
 *
pPag”
){

48063 
	grc
 = 
SQLITE_OK
;

48065 
as£¹
Ð
pPag”
->
jouº®Mode
==
PAGER_JOURNALMODE_WAL
 );

48071 ifÐ!
	gpPag”
->
	gpW®
 ){

48072 
	glogexi¡s
 = 0;

48073 
	grc
 = 
·g”LockDb
(
pPag”
, 
SHARED_LOCK
);

48074 ifÐ
	grc
==
SQLITE_OK
 ){

48075 
rc
 = 
sql™e3OsAcûss
(

48076 
pPag”
->
pVfs
,…Pag”->
zW®
, 
SQLITE_ACCESS_EXISTS
, &
logexi¡s


48079 ifÐ
	grc
==
SQLITE_OK
 && 
logexi¡s
 ){

48080 
rc
 = 
·g”O³nW®
(
pPag”
);

48087 ifÐ
	grc
==
SQLITE_OK
 && 
pPag”
->
pW®
 ){

48088 
rc
 = 
·g”ExþusiveLock
(
pPag”
);

48089 ifÐ
	grc
==
SQLITE_OK
 ){

48090 
rc
 = 
sql™e3W®Clo£
(
pPag”
->
pW®
,…Pag”->
ck±SyncFÏgs
,

48091 
pPag”
->
·geSize
, (
u8
*íPag”->
pTmpS·û
);

48092 
	gpPag”
->
	gpW®
 = 0;

48093 
·g”FixM­lim™
(
pPag”
);

48096  
	grc
;

48101 #ifdeà
SQLITE_ENABLE_ZIPVFS


48109 
SQLITE_PRIVATE
 
sql™e3Pag”W®F¿mesize
(
Pag”
 *
pPag”
){

48110 
as£¹
Ð
pPag”
->
eS‹
>=
PAGER_READER
 );

48111  
sql™e3W®F¿mesize
(
pPag”
->
pW®
);

48361 #iâdeà
SQLITE_OMIT_WAL


48367 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

48368 
SQLITE_PRIVATE
 
	gsql™e3W®T¿û
 = 0;

48369 
	#WALTRACE
(
X
èif(
sql™e3W®T¿û
è
sql™e3DebugPrštf
 
	)
X

48371 
	#WALTRACE
(
X
)

	)

48387 
	#WAL_MAX_VERSION
 3007000

	)

48388 
	#WALINDEX_MAX_VERSION
 3007000

	)

48394 
	#WAL_WRITE_LOCK
 0

	)

48395 
	#WAL_ALL_BUT_WRITE
 1

	)

48396 
	#WAL_CKPT_LOCK
 1

	)

48397 
	#WAL_RECOVER_LOCK
 2

	)

48398 
	#WAL_READ_LOCK
(
I
è(3+(I))

	)

48399 
	#WAL_NREADER
 (
SQLITE_SHM_NLOCK
-3)

	)

48403 
W®IndexHdr
 
	tW®IndexHdr
;

48404 
W®I‹¿tÜ
 
	tW®I‹¿tÜ
;

48405 
W®Ck±Info
 
	tW®Ck±Info
;

48418 
	sW®IndexHdr
 {

48419 
u32
 
	giV”siÚ
;

48420 
u32
 
	gunu£d
;

48421 
u32
 
	giChªge
;

48422 
u8
 
	gisIn™
;

48423 
u8
 
	gbigEndCksum
;

48424 
u16
 
	gszPage
;

48425 
u32
 
	gmxF¿me
;

48426 
u32
 
	gnPage
;

48427 
u32
 
	gaF¿meCksum
[2];

48428 
u32
 
	gaS®t
[2];

48429 
u32
 
	gaCksum
[2];

48481 
	sW®Ck±Info
 {

48482 
u32
 
	gnBackfžl
;

48483 
u32
 
	gaR—dM¬k
[
WAL_NREADER
];

48485 
	#READMARK_NOT_USED
 0xffffffff

	)

48493 
	#WALINDEX_LOCK_OFFSET
 ((
W®IndexHdr
)*2 + (
W®Ck±Info
))

	)

48494 
	#WALINDEX_LOCK_RESERVED
 16

	)

48495 
	#WALINDEX_HDR_SIZE
 (
WALINDEX_LOCK_OFFSET
+
WALINDEX_LOCK_RESERVED
)

	)

48498 
	#WAL_FRAME_HDRSIZE
 24

	)

48502 
	#WAL_HDRSIZE
 32

	)

48513 
	#WAL_MAGIC
 0x377f0682

	)

48520 
	#w®F¿meOff£t
(
iF¿me
, 
szPage
) ( \

48521 
WAL_HDRSIZE
 + ((
iF¿me
)-1)*(
i64
)((
szPage
)+
WAL_FRAME_HDRSIZE
) \

48522 )

	)

48528 
	sW®
 {

48529 
sql™e3_vfs
 *
	gpVfs
;

48530 
sql™e3_fže
 *
	gpDbFd
;

48531 
sql™e3_fže
 *
	gpW®Fd
;

48532 
u32
 
	giC®lback
;

48533 
i64
 
	gmxW®Size
;

48534 
	gnWiD©a
;

48535 
	gszFœ¡Block
;

48536 vÞ©ž
u32
 **
	g­WiD©a
;

48537 
u32
 
	gszPage
;

48538 
i16
 
	g»adLock
;

48539 
u8
 
	gsyncFÏgs
;

48540 
u8
 
	gexþusiveMode
;

48541 
u8
 
	gwr™eLock
;

48542 
u8
 
	gck±Lock
;

48543 
u8
 
	g»adOÆy
;

48544 
u8
 
	gŒunÿ‹OnComm™
;

48545 
u8
 
	gsyncH—d”
;

48546 
u8
 
	g·dToSeùÜBound¬y
;

48547 
W®IndexHdr
 
	ghdr
;

48548 cÚ¡ *
	gzW®Name
;

48549 
u32
 
	gnCk±
;

48550 #ifdeà
SQLITE_DEBUG


48551 
u8
 
	glockE¼Ü
;

48558 
	#WAL_NORMAL_MODE
 0

	)

48559 
	#WAL_EXCLUSIVE_MODE
 1

	)

48560 
	#WAL_HEAPMEMORY_MODE
 2

	)

48565 
	#WAL_RDWR
 0

	)

48566 
	#WAL_RDONLY
 1

	)

48567 
	#WAL_SHM_RDONLY
 2

	)

48573 
u16
 
	tht_¦Ù
;

48590 
	sW®I‹¿tÜ
 {

48591 
	giPriÜ
;

48592 
	gnSegm’t
;

48593 
	sW®Segm’t
 {

48594 
	giNext
;

48595 
ht_¦Ù
 *
	gaIndex
;

48596 
u32
 *
	gaPgno
;

48597 
	gnEÁry
;

48598 
	giZ”o
;

48599 } 
	gaSegm’t
[1];

48610 
	#HASHTABLE_NPAGE
 4096

	)

48611 
	#HASHTABLE_HASH_1
 383

	)

48612 
	#HASHTABLE_NSLOT
 (
HASHTABLE_NPAGE
*2è

	)

48619 
	#HASHTABLE_NPAGE_ONE
 (
HASHTABLE_NPAGE
 - (
WALINDEX_HDR_SIZE
/(
u32
)))

	)

48622 
	#WALINDEX_PGSZ
 ( \

48623 (
ht_¦Ù
)*
HASHTABLE_NSLOT
 + 
HASHTABLE_NPAGE
*(
u32
) \

48624 )

	)

48635 
w®IndexPage
(
W®
 *
pW®
, 
iPage
, vÞ©ž
u32
 **
µPage
){

48636 
	grc
 = 
SQLITE_OK
;

48639 ifÐ
	gpW®
->
	gnWiD©a
<=
iPage
 ){

48640 
nBy‹
 = (
u32
*)*(
iPage
+1);

48641 vÞ©ž
u32
 **
	g­New
;

48642 
	g­New
 = (vÞ©ž
u32
 **)
sql™e3_»®loc
((*)
pW®
->
­WiD©a
, 
nBy‹
);

48643 ifÐ!
	g­New
 ){

48644 *
	gµPage
 = 0;

48645  
	gSQLITE_NOMEM
;

48647 
mem£t
((*)&
­New
[
pW®
->
nWiD©a
], 0,

48648 (
u32
*)*(
iPage
+1-
pW®
->
nWiD©a
));

48649 
	gpW®
->
	g­WiD©a
 = 
­New
;

48650 
	gpW®
->
	gnWiD©a
 = 
iPage
+1;

48654 ifÐ
	gpW®
->
	g­WiD©a
[
iPage
]==0 ){

48655 ifÐ
pW®
->
exþusiveMode
==
WAL_HEAPMEMORY_MODE
 ){

48656 
pW®
->
­WiD©a
[
iPage
] = (
u32
 vÞ©ž*)
sql™e3M®locZ”o
(
WALINDEX_PGSZ
);

48657 ifÐ!
	gpW®
->
	g­WiD©a
[
iPage
] ) 
	grc
 = 
SQLITE_NOMEM
;

48659 
	grc
 = 
sql™e3OsShmM­
(
pW®
->
pDbFd
, 
iPage
, 
WALINDEX_PGSZ
,

48660 
pW®
->
wr™eLock
, (vÞ©ž**)&pW®->
­WiD©a
[
iPage
]

48662 ifÐ
	grc
==
SQLITE_READONLY
 ){

48663 
pW®
->
»adOÆy
 |ð
WAL_SHM_RDONLY
;

48664 
	grc
 = 
SQLITE_OK
;

48669 *
	gµPage
 = 
pW®
->
­WiD©a
[
iPage
];

48670 
as£¹
Ð
iPage
==0 || *
µPage
 || 
rc
!=
SQLITE_OK
 );

48671  
	grc
;

48677 vÞ©ž
W®Ck±Info
 *
w®Ck±Info
(
W®
 *
pW®
){

48678 
as£¹
Ð
pW®
->
nWiD©a
>0 &&…W®->
­WiD©a
[0] );

48679  (vÞ©ž
	gW®Ck±Info
*)&(
	gpW®
->
	g­WiD©a
[0][(
W®IndexHdr
)/2]);

48685 vÞ©ž
W®IndexHdr
 *
w®IndexHdr
(
W®
 *
pW®
){

48686 
as£¹
Ð
pW®
->
nWiD©a
>0 &&…W®->
­WiD©a
[0] );

48687  (vÞ©ž
	gW®IndexHdr
*)
	gpW®
->
	g­WiD©a
[0];

48697 
	#BYTESWAP32
(
x
) ( \

48698 (((
x
)&0x000000FF)<<24) + (((x)&0x0000FF00)<<8) \

48699 + (((
x
)&0x00FF0000)>>8) + (((x)&0xFF000000)>>24) \

48700 )

	)

48711 
w®ChecksumBy‹s
(

48712 
ÇtiveCksum
,

48713 
u8
 *
a
,

48714 
nBy‹
,

48715 cÚ¡ 
u32
 *
aIn
,

48716 
u32
 *
aOut


48718 
u32
 
	gs1
, 
	gs2
;

48719 
u32
 *
	gaD©a
 = (u32 *)
a
;

48720 
u32
 *
	gaEnd
 = (u32 *)&
a
[
nBy‹
];

48722 ifÐ
	gaIn
 ){

48723 
	gs1
 = 
aIn
[0];

48724 
	gs2
 = 
aIn
[1];

48726 
	gs1
 = 
s2
 = 0;

48729 
as£¹
Ð
nBy‹
>=8 );

48730 
as£¹
Ð(
nBy‹
&0x00000007)==0 );

48732 ifÐ
	gÇtiveCksum
 ){

48734 
	gs1
 +ð*
aD©a
++ + 
s2
;

48735 
	gs2
 +ð*
aD©a
++ + 
s1
;

48736 } 
	gaD©a
<
	gaEnd
 );

48739 
	gs1
 +ð
BYTESWAP32
(
aD©a
[0]è+ 
s2
;

48740 
	gs2
 +ð
BYTESWAP32
(
aD©a
[1]è+ 
s1
;

48741 
	gaD©a
 += 2;

48742 } 
	gaD©a
<
	gaEnd
 );

48745 
	gaOut
[0] = 
s1
;

48746 
	gaOut
[1] = 
s2
;

48749 
w®ShmB¬r›r
(
W®
 *
pW®
){

48750 ifÐ
	gpW®
->
	gexþusiveMode
!=
WAL_HEAPMEMORY_MODE
 ){

48751 
sql™e3OsShmB¬r›r
(
pW®
->
pDbFd
);

48760 
w®IndexWr™eHdr
(
W®
 *
pW®
){

48761 vÞ©ž
W®IndexHdr
 *
	gaHdr
 = 
w®IndexHdr
(
pW®
);

48762 cÚ¡ 
	gnCksum
 = 
off£tof
(
W®IndexHdr
, 
aCksum
);

48764 
as£¹
Ð
pW®
->
wr™eLock
 );

48765 
	gpW®
->
	ghdr
.
	gisIn™
 = 1;

48766 
	gpW®
->
	ghdr
.
	giV”siÚ
 = 
WALINDEX_MAX_VERSION
;

48767 
w®ChecksumBy‹s
(1, (
u8
*)&
pW®
->
hdr
, 
nCksum
, 0,…W®->hdr.
aCksum
);

48768 
memýy
((*)&
aHdr
[1], (*)&
pW®
->
hdr
, (
W®IndexHdr
));

48769 
w®ShmB¬r›r
(
pW®
);

48770 
memýy
((*)&
aHdr
[0], (*)&
pW®
->
hdr
, (
W®IndexHdr
));

48786 
w®EncodeF¿me
(

48787 
W®
 *
pW®
,

48788 
u32
 
iPage
,

48789 
u32
 
nTrunÿ‹
,

48790 
u8
 *
aD©a
,

48791 
u8
 *
aF¿me


48793 
	gÇtiveCksum
;

48794 
u32
 *
	gaCksum
 = 
pW®
->
hdr
.
aF¿meCksum
;

48795 
as£¹
Ð
WAL_FRAME_HDRSIZE
==24 );

48796 
sql™e3Put4by‹
(&
aF¿me
[0], 
iPage
);

48797 
sql™e3Put4by‹
(&
aF¿me
[4], 
nTrunÿ‹
);

48798 
memýy
(&
aF¿me
[8], 
pW®
->
hdr
.
aS®t
, 8);

48800 
	gÇtiveCksum
 = (
pW®
->
hdr
.
bigEndCksum
==
SQLITE_BIGENDIAN
);

48801 
w®ChecksumBy‹s
(
ÇtiveCksum
, 
aF¿me
, 8, 
aCksum
,‡Cksum);

48802 
w®ChecksumBy‹s
(
ÇtiveCksum
, 
aD©a
, 
pW®
->
szPage
, 
aCksum
,‡Cksum);

48804 
sql™e3Put4by‹
(&
aF¿me
[16], 
aCksum
[0]);

48805 
sql™e3Put4by‹
(&
aF¿me
[20], 
aCksum
[1]);

48813 
w®DecodeF¿me
(

48814 
W®
 *
pW®
,

48815 
u32
 *
piPage
,

48816 
u32
 *
²Trunÿ‹
,

48817 
u8
 *
aD©a
,

48818 
u8
 *
aF¿me


48820 
	gÇtiveCksum
;

48821 
u32
 *
	gaCksum
 = 
pW®
->
hdr
.
aF¿meCksum
;

48822 
u32
 
	gpgno
;

48823 
as£¹
Ð
WAL_FRAME_HDRSIZE
==24 );

48828 ifÐ
memcmp
(&
pW®
->
hdr
.
aS®t
, &
aF¿me
[8], 8)!=0 ){

48834 
	gpgno
 = 
sql™e3G‘4by‹
(&
aF¿me
[0]);

48835 ifÐ
	gpgno
==0 ){

48844 
	gÇtiveCksum
 = (
pW®
->
hdr
.
bigEndCksum
==
SQLITE_BIGENDIAN
);

48845 
w®ChecksumBy‹s
(
ÇtiveCksum
, 
aF¿me
, 8, 
aCksum
,‡Cksum);

48846 
w®ChecksumBy‹s
(
ÇtiveCksum
, 
aD©a
, 
pW®
->
szPage
, 
aCksum
,‡Cksum);

48847 ifÐ
	gaCksum
[0]!=
sql™e3G‘4by‹
(&
aF¿me
[16])

48848 || 
aCksum
[1]!=
sql™e3G‘4by‹
(&
aF¿me
[20])

48857 *
	gpiPage
 = 
pgno
;

48858 *
	g²Trunÿ‹
 = 
sql™e3G‘4by‹
(&
aF¿me
[4]);

48863 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

48868 cÚ¡ *
w®LockName
(
lockIdx
){

48869 ifÐ
	glockIdx
==
WAL_WRITE_LOCK
 ){

48871 }ifÐ
	glockIdx
==
WAL_CKPT_LOCK
 ){

48873 }ifÐ
	glockIdx
==
WAL_RECOVER_LOCK
 ){

48876 
	gzName
[15];

48877 
sql™e3_¢´štf
((
zName
), zName, "READ-LOCK[%d]",

48878 
lockIdx
-
WAL_READ_LOCK
(0));

48879  
	gzName
;

48892 
w®LockSh¬ed
(
W®
 *
pW®
, 
lockIdx
){

48893 
	grc
;

48894 ifÐ
	gpW®
->
	gexþusiveMode
 )  
	gSQLITE_OK
;

48895 
	grc
 = 
sql™e3OsShmLock
(
pW®
->
pDbFd
, 
lockIdx
, 1,

48896 
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_SHARED
);

48897 
WALTRACE
(("WAL%p:‡cquœSHARED-% %s\n", 
pW®
,

48898 
w®LockName
(
lockIdx
), 
rc
 ? "failed" : "ok"));

48899 
VVA_ONLY
Ð
pW®
->
lockE¼Ü
 = (
u8
)(
rc
!=
SQLITE_OK
 &&„c!=
SQLITE_BUSY
); )

48900  
	grc
;

48902 
w®UÆockSh¬ed
(
W®
 *
pW®
, 
lockIdx
){

48903 ifÐ
	gpW®
->
	gexþusiveMode
 ) ;

48904 ()
sql™e3OsShmLock
(
pW®
->
pDbFd
, 
lockIdx
, 1,

48905 
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_SHARED
);

48906 
WALTRACE
(("WAL%p:„–—£ SHARED-%s\n", 
pW®
, 
w®LockName
(
lockIdx
)));

48908 
w®LockExþusive
(
W®
 *
pW®
, 
lockIdx
, 
n
){

48909 
	grc
;

48910 ifÐ
	gpW®
->
	gexþusiveMode
 )  
	gSQLITE_OK
;

48911 
	grc
 = 
sql™e3OsShmLock
(
pW®
->
pDbFd
, 
lockIdx
, 
n
,

48912 
SQLITE_SHM_LOCK
 | 
SQLITE_SHM_EXCLUSIVE
);

48913 
WALTRACE
(("WAL%p:‡cquœEXCLUSIVE-% út=%d %s\n", 
pW®
,

48914 
w®LockName
(
lockIdx
), 
n
, 
rc
 ? "failed" : "ok"));

48915 
VVA_ONLY
Ð
pW®
->
lockE¼Ü
 = (
u8
)(
rc
!=
SQLITE_OK
 &&„c!=
SQLITE_BUSY
); )

48916  
	grc
;

48918 
w®UÆockExþusive
(
W®
 *
pW®
, 
lockIdx
, 
n
){

48919 ifÐ
	gpW®
->
	gexþusiveMode
 ) ;

48920 ()
sql™e3OsShmLock
(
pW®
->
pDbFd
, 
lockIdx
, 
n
,

48921 
SQLITE_SHM_UNLOCK
 | 
SQLITE_SHM_EXCLUSIVE
);

48922 
WALTRACE
(("WAL%p:„–—£ EXCLUSIVE-% út=%d\n", 
pW®
,

48923 
w®LockName
(
lockIdx
), 
n
));

48931 
w®Hash
(
u32
 
iPage
){

48932 
as£¹
Ð
iPage
>0 );

48933 
as£¹
Ð(
HASHTABLE_NSLOT
 & (HASHTABLE_NSLOT-1))==0 );

48934  (
iPage
*
	gHASHTABLE_HASH_1
è& (
	gHASHTABLE_NSLOT
-1);

48936 
w®NextHash
(
iPriÜHash
){

48937  (
	giPriÜHash
+1)&(
	gHASHTABLE_NSLOT
-1);

48954 
w®HashG‘
(

48955 
W®
 *
pW®
,

48956 
iHash
,

48957 vÞ©ž
ht_¦Ù
 **
·Hash
,

48958 vÞ©ž
u32
 **
·Pgno
,

48959 
u32
 *
piZ”o


48961 
	grc
;

48962 vÞ©ž
u32
 *
	gaPgno
;

48964 
	grc
 = 
w®IndexPage
(
pW®
, 
iHash
, &
aPgno
);

48965 
as£¹
Ð
rc
==
SQLITE_OK
 || 
iHash
>0 );

48967 ifÐ
	grc
==
SQLITE_OK
 ){

48968 
u32
 
iZ”o
;

48969 vÞ©ž
ht_¦Ù
 *
	gaHash
;

48971 
	gaHash
 = (vÞ©ž
ht_¦Ù
 *)&
aPgno
[
HASHTABLE_NPAGE
];

48972 ifÐ
	giHash
==0 ){

48973 
aPgno
 = &aPgno[
WALINDEX_HDR_SIZE
/(
u32
)];

48974 
	giZ”o
 = 0;

48976 
	giZ”o
 = 
HASHTABLE_NPAGE_ONE
 + (
iHash
-1)*
HASHTABLE_NPAGE
;

48979 *
	g·Pgno
 = &
aPgno
[-1];

48980 *
	g·Hash
 = 
aHash
;

48981 *
	gpiZ”o
 = 
iZ”o
;

48983  
	grc
;

48992 
w®F¿mePage
(
u32
 
iF¿me
){

48993 
	giHash
 = (
iF¿me
+
HASHTABLE_NPAGE
-
HASHTABLE_NPAGE_ONE
-1) / HASHTABLE_NPAGE;

48994 
as£¹
Ð(
iHash
==0 || 
iF¿me
>
HASHTABLE_NPAGE_ONE
)

48995 && (
iHash
>=1 || 
iF¿me
<=
HASHTABLE_NPAGE_ONE
)

48996 && (
iHash
<=1 || 
iF¿me
>(
HASHTABLE_NPAGE_ONE
+
HASHTABLE_NPAGE
))

48997 && (
iHash
>=2 || 
iF¿me
<=
HASHTABLE_NPAGE_ONE
+
HASHTABLE_NPAGE
)

48998 && (
iHash
<=2 || 
iF¿me
>(
HASHTABLE_NPAGE_ONE
+2*
HASHTABLE_NPAGE
))

49000  
	giHash
;

49006 
u32
 
w®F¿mePgno
(
W®
 *
pW®
, u32 
iF¿me
){

49007 
	giHash
 = 
w®F¿mePage
(
iF¿me
);

49008 ifÐ
	giHash
==0 ){

49009  
pW®
->
­WiD©a
[0][
WALINDEX_HDR_SIZE
/(
u32
è+ 
iF¿me
 - 1];

49011  
	gpW®
->
	g­WiD©a
[
iHash
][(
iF¿me
-1-
HASHTABLE_NPAGE_ONE
)%
HASHTABLE_NPAGE
];

49026 
w®CËªupHash
(
W®
 *
pW®
){

49027 vÞ©ž
ht_¦Ù
 *
	gaHash
 = 0;

49028 vÞ©ž
u32
 *
	gaPgno
 = 0;

49029 
u32
 
	giZ”o
 = 0;

49030 
	giLim™
 = 0;

49031 
	gnBy‹
;

49032 
	gi
;

49034 
as£¹
Ð
pW®
->
wr™eLock
 );

49035 
‹¡ÿ£
Ð
pW®
->
hdr
.
mxF¿me
==
HASHTABLE_NPAGE_ONE
-1 );

49036 
‹¡ÿ£
Ð
pW®
->
hdr
.
mxF¿me
==
HASHTABLE_NPAGE_ONE
 );

49037 
‹¡ÿ£
Ð
pW®
->
hdr
.
mxF¿me
==
HASHTABLE_NPAGE_ONE
+1 );

49039 ifÐ
	gpW®
->
	ghdr
.
	gmxF¿me
==0 ) ;

49045 
as£¹
Ð
pW®
->
nWiD©a
>
w®F¿mePage
ÕW®->
hdr
.
mxF¿me
) );

49046 
as£¹
Ð
pW®
->
­WiD©a
[
w®F¿mePage
ÕW®->
hdr
.
mxF¿me
)] );

49047 
w®HashG‘
(
pW®
, 
w®F¿mePage
ÕW®->
hdr
.
mxF¿me
), &
aHash
, &
aPgno
, &
iZ”o
);

49052 
	giLim™
 = 
pW®
->
hdr
.
mxF¿me
 - 
iZ”o
;

49053 
as£¹
Ð
iLim™
>0 );

49054 
	gi
=0; i<
	gHASHTABLE_NSLOT
; i++){

49055 ifÐ
	gaHash
[
i
]>
	giLim™
 ){

49056 
	gaHash
[
i
] = 0;

49063 
	gnBy‹
 = ()((*)
aHash
 - (*)&
aPgno
[
iLim™
+1]);

49064 
mem£t
((*)&
aPgno
[
iLim™
+1], 0, 
nBy‹
);

49066 #ifdeà
SQLITE_ENABLE_EXPENSIVE_ASSERT


49070 ifÐ
	giLim™
 ){

49071 
	gi
;

49072 
	giKey
;

49073 
	gi
=1; i<=
iLim™
; i++){

49074 
	giKey
=
w®Hash
(
aPgno
[
i
]); 
	gaHash
[
iKey
]; iKey=
w®NextHash
(iKey)){

49075 ifÐ
aHash
[
iKey
]==
i
 ) ;

49077 
as£¹
Ð
aHash
[
iKey
]==
i
 );

49088 
w®IndexAµ’d
(
W®
 *
pW®
, 
u32
 
iF¿me
, u32 
iPage
){

49089 
	grc
;

49090 
u32
 
	giZ”o
 = 0;

49091 vÞ©ž
u32
 *
	gaPgno
 = 0;

49092 vÞ©ž
ht_¦Ù
 *
	gaHash
 = 0;

49094 
	grc
 = 
w®HashG‘
(
pW®
, 
w®F¿mePage
(
iF¿me
), &
aHash
, &
aPgno
, &
iZ”o
);

49099 ifÐ
	grc
==
SQLITE_OK
 ){

49100 
iKey
;

49101 
	gidx
;

49102 
	gnCÞlide
;

49104 
	gidx
 = 
iF¿me
 - 
iZ”o
;

49105 
as£¹
Ð
idx
 <ð
HASHTABLE_NSLOT
/2 + 1 );

49110 ifÐ
	gidx
==1 ){

49111 
nBy‹
 = ()((
u8
 *)&
aHash
[
HASHTABLE_NSLOT
] - (u8 *)&
aPgno
[1]);

49112 
mem£t
((*)&
aPgno
[1], 0, 
nBy‹
);

49121 ifÐ
	gaPgno
[
idx
] ){

49122 
w®CËªupHash
(
pW®
);

49123 
as£¹
Ð!
aPgno
[
idx
] );

49127 
	gnCÞlide
 = 
idx
;

49128 
	giKey
=
w®Hash
(
iPage
); 
	gaHash
[
iKey
]; iKey=
w®NextHash
(iKey)){

49129 ifÐ(
nCÞlide
--)==0 )  
SQLITE_CORRUPT_BKPT
;

49131 
	gaPgno
[
idx
] = 
iPage
;

49132 
	gaHash
[
iKey
] = (
ht_¦Ù
)
idx
;

49134 #ifdeà
SQLITE_ENABLE_EXPENSIVE_ASSERT


49139 
	gi
;

49140 
	gnEÁry
 = 0;

49141 
	gi
=0; i<
	gHASHTABLE_NSLOT
; i++){ ifÐ
	gaHash
[
i
] ) 
	gnEÁry
++; }

49142 
as£¹
Ð
nEÁry
==
idx
 );

49150 ifÐ(
	gidx
&0x3ff)==0 ){

49151 
i
;

49152 
	gi
=1; i<=
idx
; i++){

49153 
	giKey
=
w®Hash
(
aPgno
[
i
]); 
	gaHash
[
iKey
]; iKey=
w®NextHash
(iKey)){

49154 ifÐ
aHash
[
iKey
]==
i
 ) ;

49156 
as£¹
Ð
aHash
[
iKey
]==
i
 );

49163  
	grc
;

49177 
w®IndexRecov”
(
W®
 *
pW®
){

49178 
	grc
;

49179 
i64
 
	gnSize
;

49180 
u32
 
	gaF¿meCksum
[2] = {0, 0};

49181 
	giLock
;

49182 
	gnLock
;

49190 
as£¹
Ð
pW®
->
ck±Lock
==1 ||…Wal->ckptLock==0 );

49191 
as£¹
Ð
WAL_ALL_BUT_WRITE
==
WAL_WRITE_LOCK
+1 );

49192 
as£¹
Ð
WAL_CKPT_LOCK
==
WAL_ALL_BUT_WRITE
 );

49193 
as£¹
Ð
pW®
->
wr™eLock
 );

49194 
	giLock
 = 
WAL_ALL_BUT_WRITE
 + 
pW®
->
ck±Lock
;

49195 
	gnLock
 = 
SQLITE_SHM_NLOCK
 - 
iLock
;

49196 
	grc
 = 
w®LockExþusive
(
pW®
, 
iLock
, 
nLock
);

49197 ifÐ
	grc
 ){

49198  
	grc
;

49200 
WALTRACE
(("WAL%p:„ecov”y begš...\n", 
pW®
));

49202 
mem£t
(&
pW®
->
hdr
, 0, (
W®IndexHdr
));

49204 
	grc
 = 
sql™e3OsFžeSize
(
pW®
->
pW®Fd
, &
nSize
);

49205 ifÐ
	grc
!=
SQLITE_OK
 ){

49206 
»cov”y_”rÜ
;

49209 ifÐ
	gnSize
>
	gWAL_HDRSIZE
 ){

49210 
u8
 
	gaBuf
[
WAL_HDRSIZE
];

49211 
u8
 *
	gaF¿me
 = 0;

49212 
	gszF¿me
;

49213 
u8
 *
	gaD©a
;

49214 
	giF¿me
;

49215 
i64
 
	giOff£t
;

49216 
	gszPage
;

49217 
u32
 
	gmagic
;

49218 
u32
 
	gv”siÚ
;

49219 
	gisV®id
;

49222 
	grc
 = 
sql™e3OsR—d
(
pW®
->
pW®Fd
, 
aBuf
, 
WAL_HDRSIZE
, 0);

49223 ifÐ
	grc
!=
SQLITE_OK
 ){

49224 
»cov”y_”rÜ
;

49232 
	gmagic
 = 
sql™e3G‘4by‹
(&
aBuf
[0]);

49233 
	gszPage
 = 
sql™e3G‘4by‹
(&
aBuf
[8]);

49234 ifÐ(
	gmagic
&0xFFFFFFFE)!=
WAL_MAGIC


49235 || 
szPage
&(szPage-1)

49236 || 
szPage
>
SQLITE_MAX_PAGE_SIZE


49237 || 
szPage
<512

49239 
fšished
;

49241 
	gpW®
->
	ghdr
.
	gbigEndCksum
 = (
u8
)(
magic
&0x00000001);

49242 
	gpW®
->
	gszPage
 = 
szPage
;

49243 
	gpW®
->
	gnCk±
 = 
sql™e3G‘4by‹
(&
aBuf
[12]);

49244 
memýy
(&
pW®
->
hdr
.
aS®t
, &
aBuf
[16], 8);

49247 
w®ChecksumBy‹s
(
pW®
->
hdr
.
bigEndCksum
==
SQLITE_BIGENDIAN
,

49248 
aBuf
, 
WAL_HDRSIZE
-2*4, 0, 
pW®
->
hdr
.
aF¿meCksum


49250 ifÐ
	gpW®
->
	ghdr
.
	gaF¿meCksum
[0]!=
sql™e3G‘4by‹
(&
aBuf
[24])

49251 || 
pW®
->
hdr
.
aF¿meCksum
[1]!=
sql™e3G‘4by‹
(&
aBuf
[28])

49253 
fšished
;

49258 
	gv”siÚ
 = 
sql™e3G‘4by‹
(&
aBuf
[4]);

49259 ifÐ
	gv”siÚ
!=
WAL_MAX_VERSION
 ){

49260 
rc
 = 
SQLITE_CANTOPEN_BKPT
;

49261 
	gfšished
;

49265 
	gszF¿me
 = 
szPage
 + 
WAL_FRAME_HDRSIZE
;

49266 
	gaF¿me
 = (
u8
 *)
sql™e3_m®loc
(
szF¿me
);

49267 ifÐ!
	gaF¿me
 ){

49268 
	grc
 = 
SQLITE_NOMEM
;

49269 
	g»cov”y_”rÜ
;

49271 
	gaD©a
 = &
aF¿me
[
WAL_FRAME_HDRSIZE
];

49274 
	giF¿me
 = 0;

49275 
	giOff£t
=
WAL_HDRSIZE
; (iOff£t+
	gszF¿me
)<=
nSize
; iOff£t+=
szF¿me
){

49276 
u32
 
pgno
;

49277 
u32
 
	gnTrunÿ‹
;

49280 
	giF¿me
++;

49281 
	grc
 = 
sql™e3OsR—d
(
pW®
->
pW®Fd
, 
aF¿me
, 
szF¿me
, 
iOff£t
);

49282 ifÐ
	grc
!=
SQLITE_OK
 ) ;

49283 
	gisV®id
 = 
w®DecodeF¿me
(
pW®
, &
pgno
, &
nTrunÿ‹
, 
aD©a
, 
aF¿me
);

49284 ifÐ!
	gisV®id
 ) ;

49285 
	grc
 = 
w®IndexAµ’d
(
pW®
, 
iF¿me
, 
pgno
);

49286 ifÐ
	grc
!=
SQLITE_OK
 ) ;

49289 ifÐ
	gnTrunÿ‹
 ){

49290 
	gpW®
->
	ghdr
.
	gmxF¿me
 = 
iF¿me
;

49291 
	gpW®
->
	ghdr
.
	gnPage
 = 
nTrunÿ‹
;

49292 
	gpW®
->
	ghdr
.
	gszPage
 = (
u16
)((
szPage
&0xff00) | (szPage>>16));

49293 
‹¡ÿ£
Ð
szPage
<=32768 );

49294 
‹¡ÿ£
Ð
szPage
>=65536 );

49295 
	gaF¿meCksum
[0] = 
pW®
->
hdr
.
aF¿meCksum
[0];

49296 
	gaF¿meCksum
[1] = 
pW®
->
hdr
.
aF¿meCksum
[1];

49300 
sql™e3_ä“
(
aF¿me
);

49303 
	gfšished
:

49304 ifÐ
rc
==
SQLITE_OK
 ){

49305 vÞ©ž
W®Ck±Info
 *
pInfo
;

49306 
	gi
;

49307 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[0] = 
aF¿meCksum
[0];

49308 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[1] = 
aF¿meCksum
[1];

49309 
w®IndexWr™eHdr
(
pW®
);

49315 
	gpInfo
 = 
w®Ck±Info
(
pW®
);

49316 
	gpInfo
->
	gnBackfžl
 = 0;

49317 
	gpInfo
->
	gaR—dM¬k
[0] = 0;

49318 
	gi
=1; i<
	gWAL_NREADER
; i++è
	gpInfo
->
	gaR—dM¬k
[
i
] = 
READMARK_NOT_USED
;

49319 ifÐ
	gpW®
->
	ghdr
.
	gmxF¿me
 ) 
	gpInfo
->
	gaR—dM¬k
[1] = 
pW®
->
hdr
.
mxF¿me
;

49326 ifÐ
	gpW®
->
	ghdr
.
	gnPage
 ){

49327 
sql™e3_log
(
SQLITE_NOTICE_RECOVER_WAL
,

49329 
pW®
->
hdr
.
mxF¿me
,…W®->
zW®Name


49334 
	g»cov”y_”rÜ
:

49335 
WALTRACE
(("WAL%p:„ecov”y %s\n", 
pW®
, 
rc
 ? "failed" : "ok"));

49336 
w®UÆockExþusive
(
pW®
, 
iLock
, 
nLock
);

49337  
	grc
;

49343 
w®IndexClo£
(
W®
 *
pW®
, 
isD–‘e
){

49344 ifÐ
	gpW®
->
	gexþusiveMode
==
WAL_HEAPMEMORY_MODE
 ){

49345 
i
;

49346 
	gi
=0; i<
	gpW®
->
	gnWiD©a
; i++){

49347 
sql™e3_ä“
((*)
pW®
->
­WiD©a
[
i
]);

49348 
	gpW®
->
	g­WiD©a
[
i
] = 0;

49351 
sql™e3OsShmUnm­
(
pW®
->
pDbFd
, 
isD–‘e
);

49370 
SQLITE_PRIVATE
 
sql™e3W®O³n
(

49371 
sql™e3_vfs
 *
pVfs
,

49372 
sql™e3_fže
 *
pDbFd
,

49373 cÚ¡ *
zW®Name
,

49374 
bNoShm
,

49375 
i64
 
mxW®Size
,

49376 
W®
 **
µW®


49378 
	grc
;

49379 
W®
 *
	gpR‘
;

49380 
	gæags
;

49382 
as£¹
Ð
zW®Name
 && zWalName[0] );

49383 
as£¹
Ð
pDbFd
 );

49389 #ifdeà
WIN_SHM_BASE


49390 
as£¹
Ð
WIN_SHM_BASE
==
WALINDEX_LOCK_OFFSET
 );

49392 #ifdeà
UNIX_SHM_BASE


49393 
as£¹
Ð
UNIX_SHM_BASE
==
WALINDEX_LOCK_OFFSET
 );

49398 *
	gµW®
 = 0;

49399 
	gpR‘
 = (
W®
*)
sql™e3M®locZ”o
((W®è+ 
pVfs
->
szOsFže
);

49400 ifÐ!
	gpR‘
 ){

49401  
	gSQLITE_NOMEM
;

49404 
	gpR‘
->
	gpVfs
 = 
pVfs
;

49405 
	gpR‘
->
	gpW®Fd
 = (
sql™e3_fže
 *)&
pR‘
[1];

49406 
	gpR‘
->
	gpDbFd
 = 
pDbFd
;

49407 
	gpR‘
->
	g»adLock
 = -1;

49408 
	gpR‘
->
	gmxW®Size
 = 
mxW®Size
;

49409 
	gpR‘
->
	gzW®Name
 = 
zW®Name
;

49410 
	gpR‘
->
	gsyncH—d”
 = 1;

49411 
	gpR‘
->
	g·dToSeùÜBound¬y
 = 1;

49412 
	gpR‘
->
	gexþusiveMode
 = (
bNoShm
 ? 
WAL_HEAPMEMORY_MODE
: 
WAL_NORMAL_MODE
);

49415 
	gæags
 = (
SQLITE_OPEN_READWRITE
|
SQLITE_OPEN_CREATE
|
SQLITE_OPEN_WAL
);

49416 
	grc
 = 
sql™e3OsO³n
(
pVfs
, 
zW®Name
, 
pR‘
->
pW®Fd
, 
æags
, &flags);

49417 ifÐ
	grc
==
SQLITE_OK
 && 
æags
&
SQLITE_OPEN_READONLY
 ){

49418 
pR‘
->
»adOÆy
 = 
WAL_RDONLY
;

49421 ifÐ
	grc
!=
SQLITE_OK
 ){

49422 
w®IndexClo£
(
pR‘
, 0);

49423 
sql™e3OsClo£
(
pR‘
->
pW®Fd
);

49424 
sql™e3_ä“
(
pR‘
);

49426 
	giDC
 = 
sql™e3OsDeviûCh¬aù”i¡ics
(
pDbFd
);

49427 ifÐ
	giDC
 & 
	gSQLITE_IOCAP_SEQUENTIAL
 ){ 
	gpR‘
->
	gsyncH—d”
 = 0; }

49428 ifÐ
	giDC
 & 
	gSQLITE_IOCAP_POWERSAFE_OVERWRITE
 ){

49429 
	gpR‘
->
	g·dToSeùÜBound¬y
 = 0;

49431 *
	gµW®
 = 
pR‘
;

49432 
WALTRACE
(("WAL%d: o³Ãd\n", 
pR‘
));

49434  
	grc
;

49440 
SQLITE_PRIVATE
 
sql™e3W®Lim™
(
W®
 *
pW®
, 
i64
 
iLim™
){

49441 ifÐ
	gpW®
 )…W®->
	gmxW®Size
 = 
iLim™
;

49454 
w®I‹¿tÜNext
(

49455 
W®I‹¿tÜ
 *
p
,

49456 
u32
 *
piPage
,

49457 
u32
 *
piF¿me


49459 
u32
 
	giMš
;

49460 
u32
 
	giR‘
 = 0xFFFFFFFF;

49461 
	gi
;

49463 
	giMš
 = 
p
->
iPriÜ
;

49464 
as£¹
Ð
iMš
<0xffffffff );

49465 
	gi
=
p
->
nSegm’t
-1; i>=0; i--){

49466 
W®Segm’t
 *
	gpSegm’t
 = &
p
->
aSegm’t
[
i
];

49467  
	gpSegm’t
->
	giNext
<pSegm’t->
	gnEÁry
 ){

49468 
u32
 
	giPg
 = 
pSegm’t
->
aPgno
[pSegm’t->
aIndex
[pSegm’t->
iNext
]];

49469 ifÐ
	giPg
>
	giMš
 ){

49470 ifÐ
	giPg
<
	giR‘
 ){

49471 
	giR‘
 = 
iPg
;

49472 *
	gpiF¿me
 = 
pSegm’t
->
iZ”o
 +…Segm’t->
aIndex
[pSegm’t->
iNext
];

49476 
	gpSegm’t
->
	giNext
++;

49480 *
	gpiPage
 = 
p
->
iPriÜ
 = 
iR‘
;

49481  (
	giR‘
==0xFFFFFFFF);

49507 
w®M”ge
(

49508 cÚ¡ 
u32
 *
aCÚ‹Á
,

49509 
ht_¦Ù
 *
aLeá
,

49510 
nLeá
,

49511 
ht_¦Ù
 **
·Right
,

49512 *
²Right
,

49513 
ht_¦Ù
 *
aTmp


49515 
	giLeá
 = 0;

49516 
	giRight
 = 0;

49517 
	giOut
 = 0;

49518 
	gnRight
 = *
²Right
;

49519 
ht_¦Ù
 *
	gaRight
 = *
·Right
;

49521 
as£¹
Ð
nLeá
>0 && 
nRight
>0 );

49522  
	giRight
<
	gnRight
 || 
	giLeá
<
	gnLeá
 ){

49523 
ht_¦Ù
 
	glog·ge
;

49524 
Pgno
 
	gdb·ge
;

49526 ifÐ(
	giLeá
<
	gnLeá
)

49527 && (
	giRight
>=
nRight
 || 
aCÚ‹Á
[
aLeá
[
iLeá
]]<aCÚ‹Á[
aRight
[
iRight
]])

49529 
log·ge
 = 
aLeá
[
iLeá
++];

49531 
	glog·ge
 = 
aRight
[
iRight
++];

49533 
	gdb·ge
 = 
aCÚ‹Á
[
log·ge
];

49535 
	gaTmp
[
iOut
++] = 
log·ge
;

49536 ifÐ
	giLeá
<
	gnLeá
 && 
	gaCÚ‹Á
[
aLeá
[
iLeá
]]==
db·ge
 ) iLeft++;

49538 
as£¹
Ð
iLeá
>=
nLeá
 || 
aCÚ‹Á
[
aLeá
[iLeá]]>
db·ge
 );

49539 
as£¹
Ð
iRight
>=
nRight
 || 
aCÚ‹Á
[
aRight
[iRight]]>
db·ge
 );

49542 *
	g·Right
 = 
aLeá
;

49543 *
	g²Right
 = 
iOut
;

49544 
memýy
(
aLeá
, 
aTmp
, ×Tmp[0])*
iOut
);

49564 
w®M”gesÜt
(

49565 cÚ¡ 
u32
 *
aCÚ‹Á
,

49566 
ht_¦Ù
 *
aBufãr
,

49567 
ht_¦Ù
 *
aLi¡
,

49568 *
²Li¡


49570 
	sSubli¡
 {

49571 
	gnLi¡
;

49572 
ht_¦Ù
 *
	gaLi¡
;

49575 cÚ¡ 
	gnLi¡
 = *
²Li¡
;

49576 
	gnM”ge
 = 0;

49577 
ht_¦Ù
 *
	gaM”ge
 = 0;

49578 
	giLi¡
;

49579 
	giSub
 = 0;

49580 
Subli¡
 
	gaSub
[13];

49582 
mem£t
(
aSub
, 0, (aSub));

49583 
as£¹
Ð
nLi¡
<=
HASHTABLE_NPAGE
 &&‚List>0 );

49584 
as£¹
Ð
HASHTABLE_NPAGE
==(1<<(
A¼aySize
(
aSub
)-1)) );

49586 
	giLi¡
=0; iLi¡<
	gnLi¡
; iList++){

49587 
	gnM”ge
 = 1;

49588 
	gaM”ge
 = &
aLi¡
[
iLi¡
];

49589 
	giSub
=0; 
	giLi¡
 & (1<<iSub); iSub++){

49590 
Subli¡
 *
	gp
 = &
aSub
[
iSub
];

49591 
as£¹
Ð
p
->
aLi¡
 &&…->
nLi¡
<=(1<<
iSub
) );

49592 
as£¹
Ð
p
->
aLi¡
==&aLi¡[
iLi¡
&~((2<<
iSub
)-1)] );

49593 
w®M”ge
(
aCÚ‹Á
, 
p
->
aLi¡
,…->
nLi¡
, &
aM”ge
, &
nM”ge
, 
aBufãr
);

49595 
	gaSub
[
iSub
].
	gaLi¡
 = 
aM”ge
;

49596 
	gaSub
[
iSub
].
	gnLi¡
 = 
nM”ge
;

49599 
	giSub
++; iSub<
A¼aySize
(
aSub
); iSub++){

49600 ifÐ
	gnLi¡
 & (1<<
	giSub
) ){

49601 
Subli¡
 *
	gp
 = &
aSub
[
iSub
];

49602 
as£¹
Ð
p
->
nLi¡
<=(1<<
iSub
) );

49603 
as£¹
Ð
p
->
aLi¡
==&aLi¡[
nLi¡
&~((2<<
iSub
)-1)] );

49604 
w®M”ge
(
aCÚ‹Á
, 
p
->
aLi¡
,…->
nLi¡
, &
aM”ge
, &
nM”ge
, 
aBufãr
);

49607 
as£¹
Ð
aM”ge
==
aLi¡
 );

49608 *
	g²Li¡
 = 
nM”ge
;

49610 #ifdeà
SQLITE_DEBUG


49612 
	gi
;

49613 
	gi
=1; i<*
	g²Li¡
; i++){

49614 
as£¹
Ð
aCÚ‹Á
[
aLi¡
[
i
]] >‡Content[aList[i-1]] );

49623 
w®I‹¿tÜF»e
(
W®I‹¿tÜ
 *
p
){

49624 
sql™e3Sü©chF»e
(
p
);

49639 
w®I‹¿tÜIn™
(
W®
 *
pW®
, 
W®I‹¿tÜ
 **
µ
){

49640 
W®I‹¿tÜ
 *
	gp
;

49641 
	gnSegm’t
;

49642 
u32
 
	giLa¡
;

49643 
	gnBy‹
;

49644 
	gi
;

49645 
ht_¦Ù
 *
	gaTmp
;

49646 
	grc
 = 
SQLITE_OK
;

49651 
as£¹
Ð
pW®
->
ck±Lock
 &&…W®->
hdr
.
mxF¿me
>0 );

49652 
	giLa¡
 = 
pW®
->
hdr
.
mxF¿me
;

49655 
	gnSegm’t
 = 
w®F¿mePage
(
iLa¡
) + 1;

49656 
	gnBy‹
 = (
W®I‹¿tÜ
)

49657 + (
nSegm’t
-1)*(
W®Segm’t
)

49658 + 
iLa¡
*(
ht_¦Ù
);

49659 
	gp
 = (
W®I‹¿tÜ
 *)
sql™e3Sü©chM®loc
(
nBy‹
);

49660 ifÐ!
	gp
 ){

49661  
	gSQLITE_NOMEM
;

49663 
mem£t
(
p
, 0, 
nBy‹
);

49664 
	gp
->
	gnSegm’t
 = 
nSegm’t
;

49669 
	gaTmp
 = (
ht_¦Ù
 *)
sql™e3Sü©chM®loc
(

49670 (
ht_¦Ù
è* (
iLa¡
>
HASHTABLE_NPAGE
?HASHTABLE_NPAGE:iLast)

49672 ifÐ!
	gaTmp
 ){

49673 
	grc
 = 
SQLITE_NOMEM
;

49676 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
nSegm’t
; i++){

49677 vÞ©ž
ht_¦Ù
 *
	gaHash
;

49678 
u32
 
	giZ”o
;

49679 vÞ©ž
u32
 *
	gaPgno
;

49681 
	grc
 = 
w®HashG‘
(
pW®
, 
i
, &
aHash
, &
aPgno
, &
iZ”o
);

49682 ifÐ
	grc
==
SQLITE_OK
 ){

49683 
j
;

49684 
	gnEÁry
;

49685 
ht_¦Ù
 *
	gaIndex
;

49687 
	gaPgno
++;

49688 ifÐ(
	gi
+1)==
nSegm’t
 ){

49689 
nEÁry
 = ()(
iLa¡
 - 
iZ”o
);

49691 
	gnEÁry
 = ()((
u32
*)
aHash
 - (u32*)
aPgno
);

49693 
	gaIndex
 = &((
ht_¦Ù
 *)&
p
->
aSegm’t
[p->
nSegm’t
])[
iZ”o
];

49694 
	giZ”o
++;

49696 
	gj
=0; j<
	gnEÁry
; j++){

49697 
	gaIndex
[
j
] = (
ht_¦Ù
)j;

49699 
w®M”gesÜt
((
u32
 *)
aPgno
, 
aTmp
, 
aIndex
, &
nEÁry
);

49700 
	gp
->
	gaSegm’t
[
i
].
	giZ”o
 = 
iZ”o
;

49701 
	gp
->
	gaSegm’t
[
i
].
	gnEÁry
 = 
nEÁry
;

49702 
	gp
->
	gaSegm’t
[
i
].
	gaIndex
 = 
aIndex
;

49703 
	gp
->
	gaSegm’t
[
i
].
	gaPgno
 = (
u32
 *)
aPgno
;

49706 
sql™e3Sü©chF»e
(
aTmp
);

49708 ifÐ
	grc
!=
SQLITE_OK
 ){

49709 
w®I‹¿tÜF»e
(
p
);

49711 *
	gµ
 = 
p
;

49712  
	grc
;

49721 
w®BusyLock
(

49722 
W®
 *
pW®
,

49723 (*
xBusy
)(*),

49724 *
pBusyArg
,

49725 
lockIdx
,

49726 
n


49728 
	grc
;

49730 
	grc
 = 
w®LockExþusive
(
pW®
, 
lockIdx
, 
n
);

49731 } 
	gxBusy
 && 
	grc
==
SQLITE_BUSY
 && 
xBusy
(
pBusyArg
) );

49732  
	grc
;

49739 
w®Pagesize
(
W®
 *
pW®
){

49740  (
	gpW®
->
	ghdr
.
	gszPage
&0xfe00) + ((pWal->hdr.szPage&0x0001)<<16);

49774 
w®Checkpošt
(

49775 
W®
 *
pW®
,

49776 
eMode
,

49777 (*
xBusyC®l
)(*),

49778 *
pBusyArg
,

49779 
sync_æags
,

49780 
u8
 *
zBuf


49782 
	grc
;

49783 
	gszPage
;

49784 
W®I‹¿tÜ
 *
	gpI‹r
 = 0;

49785 
u32
 
	giDb·ge
 = 0;

49786 
u32
 
	giF¿me
 = 0;

49787 
u32
 
	gmxSaãF¿me
;

49788 
u32
 
	gmxPage
;

49789 
	gi
;

49790 vÞ©ž
W®Ck±Info
 *
	gpInfo
;

49791 (*
	gxBusy
)(*) = 0;

49793 
	gszPage
 = 
w®Pagesize
(
pW®
);

49794 
‹¡ÿ£
Ð
szPage
<=32768 );

49795 
‹¡ÿ£
Ð
szPage
>=65536 );

49796 
	gpInfo
 = 
w®Ck±Info
(
pW®
);

49797 ifÐ
	gpInfo
->
	gnBackfžl
>=
pW®
->
hdr
.
mxF¿me
 )  
SQLITE_OK
;

49800 
	grc
 = 
w®I‹¿tÜIn™
(
pW®
, &
pI‹r
);

49801 ifÐ
	grc
!=
SQLITE_OK
 ){

49802  
rc
;

49804 
as£¹
Ð
pI‹r
 );

49806 ifÐ
	geMode
!=
SQLITE_CHECKPOINT_PASSIVE
 ) 
xBusy
 = 
xBusyC®l
;

49813 
	gmxSaãF¿me
 = 
pW®
->
hdr
.
mxF¿me
;

49814 
	gmxPage
 = 
pW®
->
hdr
.
nPage
;

49815 
	gi
=1; i<
	gWAL_NREADER
; i++){

49816 
u32
 
	gy
 = 
pInfo
->
aR—dM¬k
[
i
];

49817 ifÐ
	gmxSaãF¿me
>
	gy
 ){

49818 
as£¹
Ð
y
<=
pW®
->
hdr
.
mxF¿me
 );

49819 
	grc
 = 
w®BusyLock
(
pW®
, 
xBusy
, 
pBusyArg
, 
WAL_READ_LOCK
(
i
), 1);

49820 ifÐ
	grc
==
SQLITE_OK
 ){

49821 
pInfo
->
aR—dM¬k
[
i
] = (i==1 ? 
mxSaãF¿me
 : 
READMARK_NOT_USED
);

49822 
w®UÆockExþusive
(
pW®
, 
WAL_READ_LOCK
(
i
), 1);

49823 }ifÐ
	grc
==
SQLITE_BUSY
 ){

49824 
mxSaãF¿me
 = 
y
;

49825 
	gxBusy
 = 0;

49827 
	gw®checkpošt_out
;

49832 ifÐ
	gpInfo
->
	gnBackfžl
<
	gmxSaãF¿me


49833 && (
	grc
 = 
w®BusyLock
(
pW®
, 
xBusy
, 
pBusyArg
, 
WAL_READ_LOCK
(0), 1))==
SQLITE_OK


49835 
i64
 
nSize
;

49836 
u32
 
	gnBackfžl
 = 
pInfo
->
nBackfžl
;

49839 ifÐ
	gsync_æags
 ){

49840 
	grc
 = 
sql™e3OsSync
(
pW®
->
pW®Fd
, 
sync_æags
);

49846 ifÐ
	grc
==
SQLITE_OK
 ){

49847 
i64
 
nReq
 = ((i64)
mxPage
 * 
szPage
);

49848 
	grc
 = 
sql™e3OsFžeSize
(
pW®
->
pDbFd
, &
nSize
);

49849 ifÐ
	grc
==
SQLITE_OK
 && 
nSize
<
nReq
 ){

49850 
sql™e3OsFžeCÚŒÞHšt
(
pW®
->
pDbFd
, 
SQLITE_FCNTL_SIZE_HINT
, &
nReq
);

49856  
	grc
==
SQLITE_OK
 && 0==
w®I‹¿tÜNext
(
pI‹r
, &
iDb·ge
, &
iF¿me
) ){

49857 
i64
 
	giOff£t
;

49858 
as£¹
Ð
w®F¿mePgno
(
pW®
, 
iF¿me
)==
iDb·ge
 );

49859 ifÐ
	giF¿me
<=
nBackfžl
 || 
iF¿me
>
mxSaãF¿me
 || 
iDb·ge
>
mxPage
 ) ;

49860 
	giOff£t
 = 
w®F¿meOff£t
(
iF¿me
, 
szPage
è+ 
	gWAL_FRAME_HDRSIZE
;

49862 
	grc
 = 
sql™e3OsR—d
(
pW®
->
pW®Fd
, 
zBuf
, 
szPage
, 
iOff£t
);

49863 ifÐ
	grc
!=
SQLITE_OK
 ) ;

49864 
	giOff£t
 = (
iDb·ge
-1)*(
i64
)
szPage
;

49865 
‹¡ÿ£
Ð
IS_BIG_INT
(
iOff£t
) );

49866 
	grc
 = 
sql™e3OsWr™e
(
pW®
->
pDbFd
, 
zBuf
, 
szPage
, 
iOff£t
);

49867 ifÐ
	grc
!=
SQLITE_OK
 ) ;

49871 ifÐ
	grc
==
SQLITE_OK
 ){

49872 ifÐ
mxSaãF¿me
==
w®IndexHdr
(
pW®
)->
mxF¿me
 ){

49873 
i64
 
szDb
 = 
pW®
->
hdr
.
nPage
*(i64)
szPage
;

49874 
‹¡ÿ£
Ð
IS_BIG_INT
(
szDb
) );

49875 
	grc
 = 
sql™e3OsTrunÿ‹
(
pW®
->
pDbFd
, 
szDb
);

49876 ifÐ
	grc
==
SQLITE_OK
 && 
sync_æags
 ){

49877 
rc
 = 
sql™e3OsSync
(
pW®
->
pDbFd
, 
sync_æags
);

49880 ifÐ
	grc
==
SQLITE_OK
 ){

49881 
pInfo
->
nBackfžl
 = 
mxSaãF¿me
;

49886 
w®UÆockExþusive
(
pW®
, 
WAL_READ_LOCK
(0), 1);

49889 ifÐ
	grc
==
SQLITE_BUSY
 ){

49892 
rc
 = 
SQLITE_OK
;

49900 ifÐ
	grc
==
SQLITE_OK
 && 
eMode
!=
SQLITE_CHECKPOINT_PASSIVE
 ){

49901 
as£¹
Ð
pW®
->
wr™eLock
 );

49902 ifÐ
	gpInfo
->
	gnBackfžl
<
	gpW®
->
	ghdr
.
	gmxF¿me
 ){

49903 
	grc
 = 
SQLITE_BUSY
;

49904 }ifÐ
	geMode
==
SQLITE_CHECKPOINT_RESTART
 ){

49905 
as£¹
Ð
mxSaãF¿me
==
pW®
->
hdr
.
mxF¿me
 );

49906 
	grc
 = 
w®BusyLock
(
pW®
, 
xBusy
, 
pBusyArg
, 
WAL_READ_LOCK
(1), 
WAL_NREADER
-1);

49907 ifÐ
	grc
==
SQLITE_OK
 ){

49908 
w®UÆockExþusive
(
pW®
, 
WAL_READ_LOCK
(1), 
WAL_NREADER
-1);

49913 
	gw®checkpošt_out
:

49914 
w®I‹¿tÜF»e
(
pI‹r
);

49915  
	grc
;

49922 
w®Lim™Size
(
W®
 *
pW®
, 
i64
 
nMax
){

49923 
i64
 
	gsz
;

49924 
	grx
;

49925 
sql™e3BegšB’ignM®loc
();

49926 
	grx
 = 
sql™e3OsFžeSize
(
pW®
->
pW®Fd
, &
sz
);

49927 ifÐ
	grx
==
SQLITE_OK
 && (
sz
 > 
nMax
 ) ){

49928 
rx
 = 
sql™e3OsTrunÿ‹
(
pW®
->
pW®Fd
, 
nMax
);

49930 
sql™e3EndB’ignM®loc
();

49931 ifÐ
	grx
 ){

49932 
sql™e3_log
(
rx
, "ÿÂÙ†im™ WAL size: %s", 
pW®
->
zW®Name
);

49939 
SQLITE_PRIVATE
 
sql™e3W®Clo£
(

49940 
W®
 *
pW®
,

49941 
sync_æags
,

49942 
nBuf
,

49943 
u8
 *
zBuf


49945 
	grc
 = 
SQLITE_OK
;

49946 ifÐ
	gpW®
 ){

49947 
	gisD–‘e
 = 0;

49957 
	grc
 = 
sql™e3OsLock
(
pW®
->
pDbFd
, 
SQLITE_LOCK_EXCLUSIVE
);

49958 ifÐ
	grc
==
SQLITE_OK
 ){

49959 ifÐ
pW®
->
exþusiveMode
==
WAL_NORMAL_MODE
 ){

49960 
pW®
->
exþusiveMode
 = 
WAL_EXCLUSIVE_MODE
;

49962 
	grc
 = 
sql™e3W®Checkpošt
(

49963 
pW®
, 
SQLITE_CHECKPOINT_PASSIVE
, 0, 0, 
sync_æags
, 
nBuf
, 
zBuf
, 0, 0

49965 ifÐ
	grc
==
SQLITE_OK
 ){

49966 
bP”si¡
 = -1;

49967 
sql™e3OsFžeCÚŒÞHšt
(

49968 
pW®
->
pDbFd
, 
SQLITE_FCNTL_PERSIST_WAL
, &
bP”si¡


49970 ifÐ
	gbP”si¡
!=1 ){

49974 
isD–‘e
 = 1;

49975 }ifÐ
	gpW®
->
	gmxW®Size
>=0 ){

49982 
w®Lim™Size
(
pW®
, 0);

49987 
w®IndexClo£
(
pW®
, 
isD–‘e
);

49988 
sql™e3OsClo£
(
pW®
->
pW®Fd
);

49989 ifÐ
	gisD–‘e
 ){

49990 
sql™e3BegšB’ignM®loc
();

49991 
sql™e3OsD–‘e
(
pW®
->
pVfs
,…W®->
zW®Name
, 0);

49992 
sql™e3EndB’ignM®loc
();

49994 
WALTRACE
(("WAL%p: clo£d\n", 
pW®
));

49995 
sql™e3_ä“
((*)
pW®
->
­WiD©a
);

49996 
sql™e3_ä“
(
pW®
);

49998  
	grc
;

50018 
w®IndexTryHdr
(
W®
 *
pW®
, *
pChªged
){

50019 
u32
 
	gaCksum
[2];

50020 
W®IndexHdr
 
	gh1
, 
	gh2
;

50021 
W®IndexHdr
 vÞ©ž*
	gaHdr
;

50024 
as£¹
Ð
pW®
->
nWiD©a
>0 &&…W®->
­WiD©a
[0] );

50036 
	gaHdr
 = 
w®IndexHdr
(
pW®
);

50037 
memýy
(&
h1
, (*)&
aHdr
[0], (h1));

50038 
w®ShmB¬r›r
(
pW®
);

50039 
memýy
(&
h2
, (*)&
aHdr
[1], (h2));

50041 ifÐ
memcmp
(&
h1
, &
h2
, (h1))!=0 ){

50044 ifÐ
	gh1
.
	gisIn™
==0 ){

50047 
w®ChecksumBy‹s
(1, (
u8
*)&
h1
, (h1)-(h1.
aCksum
), 0,‡Cksum);

50048 ifÐ
	gaCksum
[0]!=
h1
.
aCksum
[0] ||‡Cksum[1]!=h1.aCksum[1] ){

50052 ifÐ
memcmp
(&
pW®
->
hdr
, &
h1
, (
W®IndexHdr
)) ){

50053 *
	gpChªged
 = 1;

50054 
memýy
(&
pW®
->
hdr
, &
h1
, (
W®IndexHdr
));

50055 
	gpW®
->
	gszPage
 = (
pW®
->
hdr
.
szPage
&0xfe00) + ((pWal->hdr.szPage&0x0001)<<16);

50056 
‹¡ÿ£
Ð
pW®
->
szPage
<=32768 );

50057 
‹¡ÿ£
Ð
pW®
->
szPage
>=65536 );

50076 
w®IndexR—dHdr
(
W®
 *
pW®
, *
pChªged
){

50077 
	grc
;

50078 
	gbadHdr
;

50079 vÞ©ž
u32
 *
	g·ge0
;

50084 
as£¹
Ð
pChªged
 );

50085 
	grc
 = 
w®IndexPage
(
pW®
, 0, &
·ge0
);

50086 ifÐ
	grc
!=
SQLITE_OK
 ){

50087  
rc
;

50089 
as£¹
Ð
·ge0
 || 
pW®
->
wr™eLock
==0 );

50096 
	gbadHdr
 = (
·ge0
 ? 
w®IndexTryHdr
(
pW®
, 
pChªged
) : 1);

50101 
as£¹
Ð
badHdr
==0 || 
pW®
->
wr™eLock
==0 );

50102 ifÐ
	gbadHdr
 ){

50103 ifÐ
	gpW®
->
	g»adOÆy
 & 
	gWAL_SHM_RDONLY
 ){

50104 ifÐ
	gSQLITE_OK
==(
rc
 = 
w®LockSh¬ed
(
pW®
, 
WAL_WRITE_LOCK
)) ){

50105 
w®UÆockSh¬ed
(
pW®
, 
WAL_WRITE_LOCK
);

50106 
	grc
 = 
SQLITE_READONLY_RECOVERY
;

50108 }ifÐ
	gSQLITE_OK
==(
rc
 = 
w®LockExþusive
(
pW®
, 
WAL_WRITE_LOCK
, 1)) ){

50109 
	gpW®
->
	gwr™eLock
 = 1;

50110 ifÐ
	gSQLITE_OK
==(
rc
 = 
w®IndexPage
(
pW®
, 0, &
·ge0
)) ){

50111 
	gbadHdr
 = 
w®IndexTryHdr
(
pW®
, 
pChªged
);

50112 ifÐ
	gbadHdr
 ){

50117 
	grc
 = 
w®IndexRecov”
(
pW®
);

50118 *
	gpChªged
 = 1;

50121 
	gpW®
->
	gwr™eLock
 = 0;

50122 
w®UÆockExþusive
(
pW®
, 
WAL_WRITE_LOCK
, 1);

50130 ifÐ
	gbadHdr
==0 && 
pW®
->
hdr
.
iV”siÚ
!=
WALINDEX_MAX_VERSION
 ){

50131 
rc
 = 
SQLITE_CANTOPEN_BKPT
;

50134  
	grc
;

50141 
	#WAL_RETRY
 (-1)

	)

50193 
w®TryBegšR—d
(
W®
 *
pW®
, *
pChªged
, 
u£W®
, 
út
){

50194 vÞ©ž
W®Ck±Info
 *
	gpInfo
;

50195 
u32
 
	gmxR—dM¬k
;

50196 
	gmxI
;

50197 
	gi
;

50198 
	grc
 = 
SQLITE_OK
;

50200 
as£¹
Ð
pW®
->
»adLock
<0 );

50219 ifÐ
	gút
>5 ){

50220 
	gnD–ay
 = 1;

50221 ifÐ
	gút
>100 ){

50222 
VVA_ONLY
Ð
pW®
->
lockE¼Ü
 = 1; )

50223  
	gSQLITE_PROTOCOL
;

50225 ifÐ
	gút
>=10 ) 
nD–ay
 = (
út
-9)*(cnt-9)*39;

50226 
sql™e3OsSË•
(
pW®
->
pVfs
, 
nD–ay
);

50229 ifÐ!
	gu£W®
 ){

50230 
	grc
 = 
w®IndexR—dHdr
(
pW®
, 
pChªged
);

50231 ifÐ
	grc
==
SQLITE_BUSY
 ){

50240 ifÐ
pW®
->
­WiD©a
[0]==0 ){

50248 
rc
 = 
WAL_RETRY
;

50249 }ifÐ
	gSQLITE_OK
==(
rc
 = 
w®LockSh¬ed
(
pW®
, 
WAL_RECOVER_LOCK
)) ){

50250 
w®UÆockSh¬ed
(
pW®
, 
WAL_RECOVER_LOCK
);

50251 
	grc
 = 
WAL_RETRY
;

50252 }ifÐ
	grc
==
SQLITE_BUSY
 ){

50253 
rc
 = 
SQLITE_BUSY_RECOVERY
;

50256 ifÐ
	grc
!=
SQLITE_OK
 ){

50257  
rc
;

50261 
	gpInfo
 = 
w®Ck±Info
(
pW®
);

50262 ifÐ!
	gu£W®
 && 
	gpInfo
->
	gnBackfžl
==
pW®
->
hdr
.
mxF¿me
 ){

50266 
rc
 = 
w®LockSh¬ed
(
pW®
, 
WAL_READ_LOCK
(0));

50267 
w®ShmB¬r›r
(
pW®
);

50268 ifÐ
	grc
==
SQLITE_OK
 ){

50269 ifÐ
memcmp
((*)
w®IndexHdr
(
pW®
), &pW®->
hdr
, (
W®IndexHdr
)) ){

50283 
w®UÆockSh¬ed
(
pW®
, 
WAL_READ_LOCK
(0));

50284  
	gWAL_RETRY
;

50286 
	gpW®
->
	g»adLock
 = 0;

50287  
	gSQLITE_OK
;

50288 }ifÐ
	grc
!=
SQLITE_BUSY
 ){

50289  
rc
;

50298 
	gmxR—dM¬k
 = 0;

50299 
	gmxI
 = 0;

50300 
	gi
=1; i<
	gWAL_NREADER
; i++){

50301 
u32
 
	gthisM¬k
 = 
pInfo
->
aR—dM¬k
[
i
];

50302 ifÐ
	gmxR—dM¬k
<=
thisM¬k
 &&hisM¬k<=
pW®
->
hdr
.
mxF¿me
 ){

50303 
as£¹
Ð
thisM¬k
!=
READMARK_NOT_USED
 );

50304 
	gmxR—dM¬k
 = 
thisM¬k
;

50305 
	gmxI
 = 
i
;

50310 ifÐ(
	gpW®
->
	g»adOÆy
 & 
	gWAL_SHM_RDONLY
)==0

50311 && (
mxR—dM¬k
<
pW®
->
hdr
.
mxF¿me
 || 
mxI
==0)

50313 
i
=1; 
	gi
<
	gWAL_NREADER
; i++){

50314 
	grc
 = 
w®LockExþusive
(
pW®
, 
WAL_READ_LOCK
(
i
), 1);

50315 ifÐ
	grc
==
SQLITE_OK
 ){

50316 
mxR—dM¬k
 = 
pInfo
->
aR—dM¬k
[
i
] = 
pW®
->
hdr
.
mxF¿me
;

50317 
	gmxI
 = 
i
;

50318 
w®UÆockExþusive
(
pW®
, 
WAL_READ_LOCK
(
i
), 1);

50320 }ifÐ
	grc
!=
SQLITE_BUSY
 ){

50321  
rc
;

50325 ifÐ
	gmxI
==0 ){

50326 
as£¹
Ð
rc
==
SQLITE_BUSY
 || (
pW®
->
»adOÆy
 & 
WAL_SHM_RDONLY
)!=0 );

50327  
	grc
==
SQLITE_BUSY
 ? 
WAL_RETRY
 : 
SQLITE_READONLY_CANTLOCK
;

50330 
	grc
 = 
w®LockSh¬ed
(
pW®
, 
WAL_READ_LOCK
(
mxI
));

50331 ifÐ
	grc
 ){

50332  
	grc
==
SQLITE_BUSY
 ? 
WAL_RETRY
 : 
rc
;

50354 
w®ShmB¬r›r
(
pW®
);

50355 ifÐ
	gpInfo
->
	gaR—dM¬k
[
mxI
]!=
mxR—dM¬k


50356 || 
memcmp
((*)
w®IndexHdr
(
pW®
), &pW®->
hdr
, (
W®IndexHdr
))

50358 
w®UÆockSh¬ed
(
pW®
, 
WAL_READ_LOCK
(
mxI
));

50359  
	gWAL_RETRY
;

50361 
as£¹
Ð
mxR—dM¬k
<=
pW®
->
hdr
.
mxF¿me
 );

50362 
	gpW®
->
	g»adLock
 = (
i16
)
mxI
;

50365  
	grc
;

50382 
SQLITE_PRIVATE
 
sql™e3W®BegšR—dT¿n§ùiÚ
(
W®
 *
pW®
, *
pChªged
){

50383 
	grc
;

50384 
	gút
 = 0;

50387 
	grc
 = 
w®TryBegšR—d
(
pW®
, 
pChªged
, 0, ++
út
);

50388 } 
	grc
==
WAL_RETRY
 );

50389 
‹¡ÿ£
Ð(
rc
&0xff)==
SQLITE_BUSY
 );

50390 
‹¡ÿ£
Ð(
rc
&0xff)==
SQLITE_IOERR
 );

50391 
‹¡ÿ£
Ð
rc
==
SQLITE_PROTOCOL
 );

50392 
‹¡ÿ£
Ð
rc
==
SQLITE_OK
 );

50393  
	grc
;

50400 
SQLITE_PRIVATE
 
sql™e3W®EndR—dT¿n§ùiÚ
(
W®
 *
pW®
){

50401 
sql™e3W®EndWr™eT¿n§ùiÚ
(
pW®
);

50402 ifÐ
	gpW®
->
	g»adLock
>=0 ){

50403 
w®UÆockSh¬ed
(
pW®
, 
WAL_READ_LOCK
ÕW®->
»adLock
));

50404 
	gpW®
->
	g»adLock
 = -1;

50416 
SQLITE_PRIVATE
 
sql™e3W®FšdF¿me
(

50417 
W®
 *
pW®
,

50418 
Pgno
 
pgno
,

50419 
u32
 *
piR—d


50421 
u32
 
	giR—d
 = 0;

50422 
u32
 
	giLa¡
 = 
pW®
->
hdr
.
mxF¿me
;

50423 
	giHash
;

50426 
as£¹
Ð
pW®
->
»adLock
>=0 ||…W®->
lockE¼Ü
 );

50434 ifÐ
	giLa¡
==0 || 
pW®
->
»adLock
==0 ){

50435 *
piR—d
 = 0;

50436  
	gSQLITE_OK
;

50464 
	giHash
=
w®F¿mePage
(
iLa¡
); iHash>=0 && 
iR—d
==0; iHash--){

50465 vÞ©ž
ht_¦Ù
 *
	gaHash
;

50466 vÞ©ž
u32
 *
	gaPgno
;

50467 
u32
 
	giZ”o
;

50468 
	giKey
;

50469 
	gnCÞlide
;

50470 
	grc
;

50472 
	grc
 = 
w®HashG‘
(
pW®
, 
iHash
, &
aHash
, &
aPgno
, &
iZ”o
);

50473 ifÐ
	grc
!=
SQLITE_OK
 ){

50474  
rc
;

50476 
	gnCÞlide
 = 
HASHTABLE_NSLOT
;

50477 
	giKey
=
w®Hash
(
pgno
); 
	gaHash
[
iKey
]; iKey=
w®NextHash
(iKey)){

50478 
u32
 
iF¿me
 = 
aHash
[
iKey
] + 
iZ”o
;

50479 ifÐ
	giF¿me
<=
iLa¡
 && 
aPgno
[
aHash
[
iKey
]]==
pgno
 ){

50481 
iR—d
 = 
iF¿me
;

50483 ifÐ(
	gnCÞlide
--)==0 ){

50484  
SQLITE_CORRUPT_BKPT
;

50489 #ifdeà
SQLITE_ENABLE_EXPENSIVE_ASSERT


50494 
u32
 
	giR—d2
 = 0;

50495 
u32
 
	giTe¡
;

50496 
	giTe¡
=
iLa¡
; iTest>0; iTest--){

50497 ifÐ
w®F¿mePgno
(
pW®
, 
iTe¡
)==
pgno
 ){

50498 
iR—d2
 = 
iTe¡
;

50502 
as£¹
Ð
iR—d
==
iR—d2
 );

50506 *
	gpiR—d
 = 
iR—d
;

50507  
	gSQLITE_OK
;

50515 
SQLITE_PRIVATE
 
sql™e3W®R—dF¿me
(

50516 
W®
 *
pW®
,

50517 
u32
 
iR—d
,

50518 
nOut
,

50519 
u8
 *
pOut


50521 
	gsz
;

50522 
i64
 
	giOff£t
;

50523 
	gsz
 = 
pW®
->
hdr
.
szPage
;

50524 
	gsz
 = (
sz
&0xfe00) + ((sz&0x0001)<<16);

50525 
‹¡ÿ£
Ð
sz
<=32768 );

50526 
‹¡ÿ£
Ð
sz
>=65536 );

50527 
	giOff£t
 = 
w®F¿meOff£t
(
iR—d
, 
sz
è+ 
	gWAL_FRAME_HDRSIZE
;

50529  
sql™e3OsR—d
(
pW®
->
pW®Fd
, 
pOut
, (
nOut
>
sz
 ? sz :‚Out), 
iOff£t
);

50535 
SQLITE_PRIVATE
 
Pgno
 
sql™e3W®Dbsize
(
W®
 *
pW®
){

50536 ifÐ
	gpW®
 && 
ALWAYS
(
pW®
->
»adLock
>=0) ){

50537  
pW®
->
hdr
.
nPage
;

50556 
SQLITE_PRIVATE
 
sql™e3W®BegšWr™eT¿n§ùiÚ
(
W®
 *
pW®
){

50557 
	grc
;

50561 
as£¹
Ð
pW®
->
»adLock
>=0 );

50563 ifÐ
	gpW®
->
	g»adOÆy
 ){

50564  
	gSQLITE_READONLY
;

50570 
	grc
 = 
w®LockExþusive
(
pW®
, 
WAL_WRITE_LOCK
, 1);

50571 ifÐ
	grc
 ){

50572  
	grc
;

50574 
	gpW®
->
	gwr™eLock
 = 1;

50580 ifÐ
memcmp
(&
pW®
->
hdr
, (*)
w®IndexHdr
ÕW®), (
W®IndexHdr
))!=0 ){

50581 
w®UÆockExþusive
(
pW®
, 
WAL_WRITE_LOCK
, 1);

50582 
	gpW®
->
	gwr™eLock
 = 0;

50583 
	grc
 = 
SQLITE_BUSY_SNAPSHOT
;

50586  
	grc
;

50593 
SQLITE_PRIVATE
 
sql™e3W®EndWr™eT¿n§ùiÚ
(
W®
 *
pW®
){

50594 ifÐ
	gpW®
->
	gwr™eLock
 ){

50595 
w®UÆockExþusive
(
pW®
, 
WAL_WRITE_LOCK
, 1);

50596 
	gpW®
->
	gwr™eLock
 = 0;

50597 
	gpW®
->
	gŒunÿ‹OnComm™
 = 0;

50599  
	gSQLITE_OK
;

50614 
SQLITE_PRIVATE
 
sql™e3W®Undo
(
W®
 *
pW®
, (*
xUndo
)(*, 
Pgno
), *
pUndoCtx
){

50615 
	grc
 = 
SQLITE_OK
;

50616 ifÐ
ALWAYS
(
pW®
->
wr™eLock
) ){

50617 
Pgno
 
	giMax
 = 
pW®
->
hdr
.
mxF¿me
;

50618 
Pgno
 
	giF¿me
;

50623 
memýy
(&
pW®
->
hdr
, (*)
w®IndexHdr
ÕW®), (
W®IndexHdr
));

50625 
	giF¿me
=
pW®
->
hdr
.
mxF¿me
+1;

50626 
ALWAYS
(
rc
==
SQLITE_OK
è&& 
iF¿me
<=
iMax
;

50627 
	giF¿me
++

50640 
as£¹
Ð
w®F¿mePgno
(
pW®
, 
iF¿me
)!=1 );

50641 
	grc
 = 
xUndo
(
pUndoCtx
, 
w®F¿mePgno
(
pW®
, 
iF¿me
));

50643 ifÐ
	giMax
!=
pW®
->
hdr
.
mxF¿me
 ) 
w®CËªupHash
(pWal);

50645  
	grc
;

50654 
SQLITE_PRIVATE
 
sql™e3W®Sav•ošt
(
W®
 *
pW®
, 
u32
 *
aW®D©a
){

50655 
as£¹
Ð
pW®
->
wr™eLock
 );

50656 
	gaW®D©a
[0] = 
pW®
->
hdr
.
mxF¿me
;

50657 
	gaW®D©a
[1] = 
pW®
->
hdr
.
aF¿meCksum
[0];

50658 
	gaW®D©a
[2] = 
pW®
->
hdr
.
aF¿meCksum
[1];

50659 
	gaW®D©a
[3] = 
pW®
->
nCk±
;

50668 
SQLITE_PRIVATE
 
sql™e3W®Sav•oštUndo
(
W®
 *
pW®
, 
u32
 *
aW®D©a
){

50669 
	grc
 = 
SQLITE_OK
;

50671 
as£¹
Ð
pW®
->
wr™eLock
 );

50672 
as£¹
Ð
aW®D©a
[3]!=
pW®
->
nCk±
 ||‡W®D©a[0]<õW®->
hdr
.
mxF¿me
 );

50674 ifÐ
	gaW®D©a
[3]!=
pW®
->
nCk±
 ){

50679 
aW®D©a
[0] = 0;

50680 
	gaW®D©a
[3] = 
pW®
->
nCk±
;

50683 ifÐ
	gaW®D©a
[0]<
	gpW®
->
	ghdr
.
	gmxF¿me
 ){

50684 
	gpW®
->
	ghdr
.
	gmxF¿me
 = 
aW®D©a
[0];

50685 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[0] = 
aW®D©a
[1];

50686 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[1] = 
aW®D©a
[2];

50687 
w®CËªupHash
(
pW®
);

50690  
	grc
;

50706 
w®Re¡¬tLog
(
W®
 *
pW®
){

50707 
	grc
 = 
SQLITE_OK
;

50708 
	gút
;

50710 ifÐ
	gpW®
->
	g»adLock
==0 ){

50711 vÞ©ž
W®Ck±Info
 *
pInfo
 = 
w®Ck±Info
(
pW®
);

50712 
as£¹
Ð
pInfo
->
nBackfžl
==
pW®
->
hdr
.
mxF¿me
 );

50713 ifÐ
	gpInfo
->
	gnBackfžl
>0 ){

50714 
u32
 
	g§É1
;

50715 
sql™e3_¿ndomÃss
(4, &
§É1
);

50716 
	grc
 = 
w®LockExþusive
(
pW®
, 
WAL_READ_LOCK
(1), 
WAL_NREADER
-1);

50717 ifÐ
	grc
==
SQLITE_OK
 ){

50728 
i
;

50729 
u32
 *
	gaS®t
 = 
pW®
->
hdr
.
aS®t
;

50731 
	gpW®
->
	gnCk±
++;

50732 
	gpW®
->
	ghdr
.
	gmxF¿me
 = 0;

50733 
sql™e3Put4by‹
((
u8
*)&
aS®t
[0], 1 + 
sql™e3G‘4by‹
((u8*)&aSalt[0]));

50734 
	gaS®t
[1] = 
§É1
;

50735 
w®IndexWr™eHdr
(
pW®
);

50736 
	gpInfo
->
	gnBackfžl
 = 0;

50737 
	gpInfo
->
	gaR—dM¬k
[1] = 0;

50738 
	gi
=2; i<
	gWAL_NREADER
; i++è
	gpInfo
->
	gaR—dM¬k
[
i
] = 
READMARK_NOT_USED
;

50739 
as£¹
Ð
pInfo
->
aR—dM¬k
[0]==0 );

50740 
w®UÆockExþusive
(
pW®
, 
WAL_READ_LOCK
(1), 
WAL_NREADER
-1);

50741 }ifÐ
	grc
!=
SQLITE_BUSY
 ){

50742  
rc
;

50745 
w®UÆockSh¬ed
(
pW®
, 
WAL_READ_LOCK
(0));

50746 
	gpW®
->
	g»adLock
 = -1;

50747 
	gút
 = 0;

50749 
	gnÙU£d
;

50750 
	grc
 = 
w®TryBegšR—d
(
pW®
, &
nÙU£d
, 1, ++
út
);

50751 } 
	grc
==
WAL_RETRY
 );

50752 
as£¹
Ð(
rc
&0xff)!=
SQLITE_BUSY
 );

50753 
‹¡ÿ£
Ð(
rc
&0xff)==
SQLITE_IOERR
 );

50754 
‹¡ÿ£
Ð
rc
==
SQLITE_PROTOCOL
 );

50755 
‹¡ÿ£
Ð
rc
==
SQLITE_OK
 );

50757  
	grc
;

50765 
	sW®Wr™”
 {

50766 
W®
 *
	gpW®
;

50767 
sql™e3_fže
 *
	gpFd
;

50768 
sql™e3_št64
 
	giSyncPošt
;

50769 
	gsyncFÏgs
;

50770 
	gszPage
;

50771 } 
	tW®Wr™”
;

50781 
w®Wr™eToLog
(

50782 
W®Wr™”
 *
p
,

50783 *
pCÚ‹Á
,

50784 
iAmt
,

50785 
sql™e3_št64
 
iOff£t


50787 
	grc
;

50788 ifÐ
	giOff£t
<
	gp
->
	giSyncPošt
 && iOff£t+
	giAmt
>=
p
->
iSyncPošt
 ){

50789 
iFœ¡Amt
 = ()(
p
->
iSyncPošt
 - 
iOff£t
);

50790 
	grc
 = 
sql™e3OsWr™e
(
p
->
pFd
, 
pCÚ‹Á
, 
iFœ¡Amt
, 
iOff£t
);

50791 ifÐ
	grc
 ) „c;

50792 
	giOff£t
 +ð
iFœ¡Amt
;

50793 
	giAmt
 -ð
iFœ¡Amt
;

50794 
	gpCÚ‹Á
 = (*)(
iFœ¡Amt
 + (*)
pCÚ‹Á
);

50795 
as£¹
Ð
p
->
syncFÏgs
 & (
SQLITE_SYNC_NORMAL
|
SQLITE_SYNC_FULL
) );

50796 
	grc
 = 
sql™e3OsSync
(
p
->
pFd
,…->
syncFÏgs
 & 
SQLITE_SYNC_MASK
);

50797 ifÐ
	giAmt
==0 || 
rc
 ) „c;

50799 
	grc
 = 
sql™e3OsWr™e
(
p
->
pFd
, 
pCÚ‹Á
, 
iAmt
, 
iOff£t
);

50800  
	grc
;

50806 
w®Wr™eOÃF¿me
(

50807 
W®Wr™”
 *
p
,

50808 
PgHdr
 *
pPage
,

50809 
nTrunÿ‹
,

50810 
sql™e3_št64
 
iOff£t


50812 
	grc
;

50813 *
	gpD©a
;

50814 
u8
 
	gaF¿me
[
WAL_FRAME_HDRSIZE
];

50815 #ià
defšed
(
SQLITE_HAS_CODEC
)

50816 ifÐ(
	gpD©a
 = 
sql™e3Pag”Codec
(
pPage
))==0 )  
SQLITE_NOMEM
;

50818 
	gpD©a
 = 
pPage
->
pD©a
;

50820 
w®EncodeF¿me
(
p
->
pW®
, 
pPage
->
pgno
, 
nTrunÿ‹
, 
pD©a
, 
aF¿me
);

50821 
	grc
 = 
w®Wr™eToLog
(
p
, 
aF¿me
, ×F¿me), 
iOff£t
);

50822 ifÐ
	grc
 ) „c;

50824 
	grc
 = 
w®Wr™eToLog
(
p
, 
pD©a
,…->
szPage
, 
iOff£t
+(
aF¿me
));

50825  
	grc
;

50832 
SQLITE_PRIVATE
 
sql™e3W®F¿mes
(

50833 
W®
 *
pW®
,

50834 
szPage
,

50835 
PgHdr
 *
pLi¡
,

50836 
Pgno
 
nTrunÿ‹
,

50837 
isComm™
,

50838 
sync_æags


50840 
	grc
;

50841 
u32
 
	giF¿me
;

50842 
PgHdr
 *
	gp
;

50843 
PgHdr
 *
	gpLa¡
 = 0;

50844 
	gnExŒa
 = 0;

50845 
	gszF¿me
;

50846 
i64
 
	giOff£t
;

50847 
W®Wr™”
 
	gw
;

50849 
as£¹
Ð
pLi¡
 );

50850 
as£¹
Ð
pW®
->
wr™eLock
 );

50854 
as£¹
Ð(
isComm™
!=0)==(
nTrunÿ‹
!=0) );

50856 #ià
defšed
(
SQLITE_TEST
è&& defšed(
SQLITE_DEBUG
)

50857 { 
	gút
; út=0, 
	gp
=
pLi¡
;…;…=
p
->
pDœty
, cnt++){}

50858 
WALTRACE
(("WAL%p: frame write begin. %d frames. mxFrame=%d. %s\n",

50859 
pW®
, 
út
,…W®->
hdr
.
mxF¿me
, 
isComm™
 ? "Commit" : "Spill"));

50866 ifÐ
	gSQLITE_OK
!=(
rc
 = 
w®Re¡¬tLog
(
pW®
)) ){

50867  
rc
;

50874 
	giF¿me
 = 
pW®
->
hdr
.
mxF¿me
;

50875 ifÐ
	giF¿me
==0 ){

50876 
u8
 
aW®Hdr
[
WAL_HDRSIZE
];

50877 
u32
 
	gaCksum
[2];

50879 
sql™e3Put4by‹
(&
aW®Hdr
[0], (
WAL_MAGIC
 | 
SQLITE_BIGENDIAN
));

50880 
sql™e3Put4by‹
(&
aW®Hdr
[4], 
WAL_MAX_VERSION
);

50881 
sql™e3Put4by‹
(&
aW®Hdr
[8], 
szPage
);

50882 
sql™e3Put4by‹
(&
aW®Hdr
[12], 
pW®
->
nCk±
);

50883 ifÐ
	gpW®
->
	gnCk±
==0 ) 
sql™e3_¿ndomÃss
(8, 
pW®
->
hdr
.
aS®t
);

50884 
memýy
(&
aW®Hdr
[16], 
pW®
->
hdr
.
aS®t
, 8);

50885 
w®ChecksumBy‹s
(1, 
aW®Hdr
, 
WAL_HDRSIZE
-2*4, 0, 
aCksum
);

50886 
sql™e3Put4by‹
(&
aW®Hdr
[24], 
aCksum
[0]);

50887 
sql™e3Put4by‹
(&
aW®Hdr
[28], 
aCksum
[1]);

50889 
	gpW®
->
	gszPage
 = 
szPage
;

50890 
	gpW®
->
	ghdr
.
	gbigEndCksum
 = 
SQLITE_BIGENDIAN
;

50891 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[0] = 
aCksum
[0];

50892 
	gpW®
->
	ghdr
.
	gaF¿meCksum
[1] = 
aCksum
[1];

50893 
	gpW®
->
	gŒunÿ‹OnComm™
 = 1;

50895 
	grc
 = 
sql™e3OsWr™e
(
pW®
->
pW®Fd
, 
aW®Hdr
, (aWalHdr), 0);

50896 
WALTRACE
(("WAL%p: w®-h—d” wr™%s\n", 
pW®
, 
rc
 ? "failed" : "ok"));

50897 ifÐ
	grc
!=
SQLITE_OK
 ){

50898  
rc
;

50908 ifÐ
	gpW®
->
	gsyncH—d”
 && 
	gsync_æags
 ){

50909 
	grc
 = 
sql™e3OsSync
(
pW®
->
pW®Fd
, 
sync_æags
 & 
SQLITE_SYNC_MASK
);

50910 ifÐ
	grc
 ) „c;

50913 
as£¹
Ð()
pW®
->
szPage
==szPage );

50916 
	gw
.
	gpW®
 = 
pW®
;

50917 
	gw
.
	gpFd
 = 
pW®
->
pW®Fd
;

50918 
	gw
.
	giSyncPošt
 = 0;

50919 
	gw
.
	gsyncFÏgs
 = 
sync_æags
;

50920 
	gw
.
	gszPage
 = 
szPage
;

50921 
	giOff£t
 = 
w®F¿meOff£t
(
iF¿me
+1, 
szPage
);

50922 
	gszF¿me
 = 
szPage
 + 
WAL_FRAME_HDRSIZE
;

50925 
	gp
=
pLi¡
;…;…=
p
->
pDœty
){

50926 
nDbSize
;

50927 
	giF¿me
++;

50928 
as£¹
Ð
iOff£t
==
w®F¿meOff£t
(
iF¿me
, 
szPage
) );

50929 
	gnDbSize
 = (
isComm™
 && 
p
->
pDœty
==0è? 
nTrunÿ‹
 : 0;

50930 
	grc
 = 
w®Wr™eOÃF¿me
(&
w
, 
p
, 
nDbSize
, 
iOff£t
);

50931 ifÐ
	grc
 ) „c;

50932 
	gpLa¡
 = 
p
;

50933 
	giOff£t
 +ð
szF¿me
;

50950 ifÐ
	gisComm™
 && (
	gsync_æags
 & 
	gWAL_SYNC_TRANSACTIONS
)!=0 ){

50951 ifÐ
pW®
->
·dToSeùÜBound¬y
 ){

50952 
£ùÜSize
 = 
sql™e3SeùÜSize
(
pW®
->
pW®Fd
);

50953 
	gw
.
	giSyncPošt
 = ((
iOff£t
+
£ùÜSize
-1)/sectorSize)*sectorSize;

50954  
	giOff£t
<
	gw
.
	giSyncPošt
 ){

50955 
	grc
 = 
w®Wr™eOÃF¿me
(&
w
, 
pLa¡
, 
nTrunÿ‹
, 
iOff£t
);

50956 ifÐ
	grc
 ) „c;

50957 
	giOff£t
 +ð
szF¿me
;

50958 
	gnExŒa
++;

50961 
	grc
 = 
sql™e3OsSync
(
w
.
pFd
, 
sync_æags
 & 
SQLITE_SYNC_MASK
);

50969 ifÐ
	gisComm™
 && 
	gpW®
->
	gŒunÿ‹OnComm™
 &&…W®->
	gmxW®Size
>=0 ){

50970 
i64
 
sz
 = 
pW®
->
mxW®Size
;

50971 ifÐ
w®F¿meOff£t
(
iF¿me
+
nExŒa
+1, 
szPage
)>
	gpW®
->
	gmxW®Size
 ){

50972 
	gsz
 = 
w®F¿meOff£t
(
iF¿me
+
nExŒa
+1, 
szPage
);

50974 
w®Lim™Size
(
pW®
, 
sz
);

50975 
	gpW®
->
	gŒunÿ‹OnComm™
 = 0;

50983 
	giF¿me
 = 
pW®
->
hdr
.
mxF¿me
;

50984 
	gp
=
pLi¡
;… && 
	grc
==
SQLITE_OK
;…=
p
->
pDœty
){

50985 
iF¿me
++;

50986 
	grc
 = 
w®IndexAµ’d
(
pW®
, 
iF¿me
, 
p
->
pgno
);

50988  
	grc
==
SQLITE_OK
 && 
nExŒa
>0 ){

50989 
iF¿me
++;

50990 
	gnExŒa
--;

50991 
	grc
 = 
w®IndexAµ’d
(
pW®
, 
iF¿me
, 
pLa¡
->
pgno
);

50994 ifÐ
	grc
==
SQLITE_OK
 ){

50996 
pW®
->
hdr
.
szPage
 = (
u16
)((szPage&0xff00) | (szPage>>16));

50997 
‹¡ÿ£
Ð
szPage
<=32768 );

50998 
‹¡ÿ£
Ð
szPage
>=65536 );

50999 
	gpW®
->
	ghdr
.
	gmxF¿me
 = 
iF¿me
;

51000 ifÐ
	gisComm™
 ){

51001 
	gpW®
->
	ghdr
.
	giChªge
++;

51002 
	gpW®
->
	ghdr
.
	gnPage
 = 
nTrunÿ‹
;

51005 ifÐ
	gisComm™
 ){

51006 
w®IndexWr™eHdr
(
pW®
);

51007 
	gpW®
->
	giC®lback
 = 
iF¿me
;

51011 
WALTRACE
(("WAL%p: f¿mwr™%s\n", 
pW®
, 
rc
 ? "failed" : "ok"));

51012  
	grc
;

51025 
SQLITE_PRIVATE
 
sql™e3W®Checkpošt
(

51026 
W®
 *
pW®
,

51027 
eMode
,

51028 (*
xBusy
)(*),

51029 *
pBusyArg
,

51030 
sync_æags
,

51031 
nBuf
,

51032 
u8
 *
zBuf
,

51033 *
²Log
,

51034 *
²Ck±


51036 
	grc
;

51037 
	gisChªged
 = 0;

51038 
	geMode2
 = 
eMode
;

51040 
as£¹
Ð
pW®
->
ck±Lock
==0 );

51041 
as£¹
Ð
pW®
->
wr™eLock
==0 );

51043 ifÐ
	gpW®
->
	g»adOÆy
 )  
	gSQLITE_READONLY
;

51044 
WALTRACE
(("WAL%p: checkpošˆbegšs\n", 
pW®
));

51045 
	grc
 = 
w®LockExþusive
(
pW®
, 
WAL_CKPT_LOCK
, 1);

51046 ifÐ
	grc
 ){

51050  
	grc
;

51052 
	gpW®
->
	gck±Lock
 = 1;

51063 ifÐ
	geMode
!=
SQLITE_CHECKPOINT_PASSIVE
 ){

51064 
rc
 = 
w®BusyLock
(
pW®
, 
xBusy
, 
pBusyArg
, 
WAL_WRITE_LOCK
, 1);

51065 ifÐ
	grc
==
SQLITE_OK
 ){

51066 
pW®
->
wr™eLock
 = 1;

51067 }ifÐ
	grc
==
SQLITE_BUSY
 ){

51068 
eMode2
 = 
SQLITE_CHECKPOINT_PASSIVE
;

51069 
	grc
 = 
SQLITE_OK
;

51074 ifÐ
	grc
==
SQLITE_OK
 ){

51075 
rc
 = 
w®IndexR—dHdr
(
pW®
, &
isChªged
);

51076 ifÐ
	gisChªged
 && 
	gpW®
->
	gpDbFd
->
	gpM‘hods
->
	giV”siÚ
>=3 ){

51077 
sql™e3OsUnãtch
(
pW®
->
pDbFd
, 0, 0);

51082 ifÐ
	grc
==
SQLITE_OK
 ){

51083 ifÐ
pW®
->
hdr
.
mxF¿me
 && 
w®Pagesize
ÕW®)!=
nBuf
 ){

51084 
rc
 = 
SQLITE_CORRUPT_BKPT
;

51086 
	grc
 = 
w®Checkpošt
(
pW®
, 
eMode2
, 
xBusy
, 
pBusyArg
, 
sync_æags
, 
zBuf
);

51090 ifÐ
	grc
==
SQLITE_OK
 || 
rc
==
SQLITE_BUSY
 ){

51091 ifÐ
²Log
 ) *²Log = ()
pW®
->
hdr
.
mxF¿me
;

51092 ifÐ
	g²Ck±
 ) *²Ck± = ()(
w®Ck±Info
(
pW®
)->
nBackfžl
);

51096 ifÐ
	gisChªged
 ){

51103 
mem£t
(&
pW®
->
hdr
, 0, (
W®IndexHdr
));

51107 
sql™e3W®EndWr™eT¿n§ùiÚ
(
pW®
);

51108 
w®UÆockExþusive
(
pW®
, 
WAL_CKPT_LOCK
, 1);

51109 
	gpW®
->
	gck±Lock
 = 0;

51110 
WALTRACE
(("WAL%p: checkpošˆ%s\n", 
pW®
, 
rc
 ? "failed" : "ok"));

51111  (
	grc
==
SQLITE_OK
 && 
eMode
!=
eMode2
 ? 
SQLITE_BUSY
 : 
rc
);

51119 
SQLITE_PRIVATE
 
sql™e3W®C®lback
(
W®
 *
pW®
){

51120 
u32
 
	g»t
 = 0;

51121 ifÐ
	gpW®
 ){

51122 
	g»t
 = 
pW®
->
iC®lback
;

51123 
	gpW®
->
	giC®lback
 = 0;

51125  ()
	g»t
;

51152 
SQLITE_PRIVATE
 
sql™e3W®ExþusiveMode
(
W®
 *
pW®
, 
Ý
){

51153 
	grc
;

51154 
as£¹
Ð
pW®
->
wr™eLock
==0 );

51155 
as£¹
Ð
pW®
->
exþusiveMode
!=
WAL_HEAPMEMORY_MODE
 || 
Ý
==-1 );

51163 
as£¹
Ð
pW®
->
»adLock
>=0 ||…W®->
lockE¼Ü
 );

51164 
as£¹
Ð
pW®
->
»adLock
>=0 || (
Ý
<=0 &&…W®->
exþusiveMode
==0) );

51166 ifÐ
	gÝ
==0 ){

51167 ifÐ
pW®
->
exþusiveMode
 ){

51168 
pW®
->
exþusiveMode
 = 0;

51169 ifÐ
w®LockSh¬ed
(
pW®
, 
WAL_READ_LOCK
ÕW®->
»adLock
))!=
SQLITE_OK
 ){

51170 
pW®
->
exþusiveMode
 = 1;

51172 
	grc
 = 
pW®
->
exþusiveMode
==0;

51175 
	grc
 = 0;

51177 }ifÐ
	gÝ
>0 ){

51178 
as£¹
Ð
pW®
->
exþusiveMode
==0 );

51179 
as£¹
Ð
pW®
->
»adLock
>=0 );

51180 
w®UÆockSh¬ed
(
pW®
, 
WAL_READ_LOCK
ÕW®->
»adLock
));

51181 
	gpW®
->
	gexþusiveMode
 = 1;

51182 
	grc
 = 1;

51184 
	grc
 = 
pW®
->
exþusiveMode
==0;

51186  
	grc
;

51194 
SQLITE_PRIVATE
 
sql™e3W®H—pMemÜy
(
W®
 *
pW®
){

51195  (
	gpW®
 &&…W®->
	gexþusiveMode
==
WAL_HEAPMEMORY_MODE
 );

51198 #ifdeà
SQLITE_ENABLE_ZIPVFS


51204 
SQLITE_PRIVATE
 
sql™e3W®F¿mesize
(
W®
 *
pW®
){

51205 
as£¹
Ð
pW®
==0 ||…W®->
»adLock
>=0 );

51206  (
	gpW®
 ?…W®->
	gszPage
 : 0);

51453 
	#MX_CELL_SIZE
(
pBt
è(()ÕBt->
·geSize
-8))

	)

51460 
	#MX_CELL
(
pBt
è(ÕBt->
·geSize
-8)/6)

	)

51463 
MemPage
 
	tMemPage
;

51464 
BtLock
 
	tBtLock
;

51478 #iâdeà
SQLITE_FILE_HEADER


51479 
	#SQLITE_FILE_HEADER
 "SQL™fÜm© 3"

	)

51486 
	#PTF_INTKEY
 0x01

	)

51487 
	#PTF_ZERODATA
 0x02

	)

51488 
	#PTF_LEAFDATA
 0x04

	)

51489 
	#PTF_LEAF
 0x08

	)

51504 
	sMemPage
 {

51505 
u8
 
	gisIn™
;

51506 
u8
 
	gnOv”æow
;

51507 
u8
 
	gštKey
;

51508 
u8
 
	gštKeyL—f
;

51509 
u8
 
	gnoPaylßd
;

51510 
u8
 
	gËaf
;

51511 
u8
 
	ghdrOff£t
;

51512 
u8
 
	gchždPŒSize
;

51513 
u8
 
	gmax1by‹Paylßd
;

51514 
u16
 
	gmaxLoÿl
;

51515 
u16
 
	gmšLoÿl
;

51516 
u16
 
	gûÎOff£t
;

51517 
u16
 
	gnF»e
;

51518 
u16
 
	gnC–l
;

51519 
u16
 
	gmaskPage
;

51520 
u16
 
	gaiOvæ
[5];

51522 
u8
 *
	g­Ovæ
[5];

51523 
BtSh¬ed
 *
	gpBt
;

51524 
u8
 *
	gaD©a
;

51525 
u8
 *
	gaD©aEnd
;

51526 
u8
 *
	gaC–lIdx
;

51527 
DbPage
 *
	gpDbPage
;

51528 
Pgno
 
	gpgno
;

51536 
	#EXTRA_SIZE
 (
MemPage
)

	)

51545 
	sBtLock
 {

51546 
BŒ“
 *
	gpBŒ“
;

51547 
Pgno
 
	giTabË
;

51548 
u8
 
	geLock
;

51549 
BtLock
 *
	gpNext
;

51553 
	#READ_LOCK
 1

	)

51554 
	#WRITE_LOCK
 2

	)

51577 
	sBŒ“
 {

51578 
sql™e3
 *
	gdb
;

51579 
BtSh¬ed
 *
	gpBt
;

51580 
u8
 
	gšT¿ns
;

51581 
u8
 
	gsh¬abË
;

51582 
u8
 
	glocked
;

51583 
	gwªtToLock
;

51584 
	gnBackup
;

51585 
BŒ“
 *
	gpNext
;

51586 
BŒ“
 *
	gpP»v
;

51587 #iâdeà
SQLITE_OMIT_SHARED_CACHE


51588 
BtLock
 
	glock
;

51599 
	#TRANS_NONE
 0

	)

51600 
	#TRANS_READ
 1

	)

51601 
	#TRANS_WRITE
 2

	)

51638 
	sBtSh¬ed
 {

51639 
Pag”
 *
	gpPag”
;

51640 
sql™e3
 *
	gdb
;

51641 
BtCursÜ
 *
	gpCursÜ
;

51642 
MemPage
 *
	gpPage1
;

51643 
u8
 
	gÝ’FÏgs
;

51644 #iâdeà
SQLITE_OMIT_AUTOVACUUM


51645 
u8
 
	gautoVacuum
;

51646 
u8
 
	gšüVacuum
;

51647 
u8
 
	gbDoTrunÿ‹
;

51649 
u8
 
	gšT¿n§ùiÚ
;

51650 
u8
 
	gmax1by‹Paylßd
;

51651 
u16
 
	gbtsFÏgs
;

51652 
u16
 
	gmaxLoÿl
;

51653 
u16
 
	gmšLoÿl
;

51654 
u16
 
	gmaxL—f
;

51655 
u16
 
	gmšL—f
;

51656 
u32
 
	g·geSize
;

51657 
u32
 
	gu§bËSize
;

51658 
	gnT¿n§ùiÚ
;

51659 
u32
 
	gnPage
;

51660 *
	gpSchema
;

51661 (*
	gxF»eSchema
)(*);

51662 
sql™e3_mu‹x
 *
	gmu‹x
;

51663 
B™vec
 *
	gpHasCÚ‹Á
;

51664 #iâdeà
SQLITE_OMIT_SHARED_CACHE


51665 
	gnRef
;

51666 
BtSh¬ed
 *
	gpNext
;

51667 
BtLock
 *
	gpLock
;

51668 
BŒ“
 *
	gpWr™”
;

51670 
u8
 *
	gpTmpS·û
;

51676 
	#BTS_READ_ONLY
 0x0001

	)

51677 
	#BTS_PAGESIZE_FIXED
 0x0002

	)

51678 
	#BTS_SECURE_DELETE
 0x0004

	)

51679 
	#BTS_INITIALLY_EMPTY
 0x0008

	)

51680 
	#BTS_NO_WAL
 0x0010

	)

51681 
	#BTS_EXCLUSIVE
 0x0020

	)

51682 
	#BTS_PENDING
 0x0040

	)

51689 
C–lInfo
 
	tC–lInfo
;

51690 
	sC–lInfo
 {

51691 
i64
 
	gnKey
;

51692 
u8
 *
	gpPaylßd
;

51693 
u32
 
	gnPaylßd
;

51694 
u16
 
	gnLoÿl
;

51695 
u16
 
	giOv”æow
;

51696 
u16
 
	gnSize
;

51708 
	#BTCURSOR_MAX_DEPTH
 20

	)

51729 
	sBtCursÜ
 {

51730 
BŒ“
 *
	gpBŒ“
;

51731 
BtSh¬ed
 *
	gpBt
;

51732 
BtCursÜ
 *
	gpNext
, *
	gpP»v
;

51733 
KeyInfo
 *
	gpKeyInfo
;

51734 
Pgno
 *
	gaOv”æow
;

51735 
C–lInfo
 
	gšfo
;

51736 
i64
 
	gnKey
;

51737 *
	gpKey
;

51738 
Pgno
 
	gpgnoRoÙ
;

51739 
	gnOvæAÎoc
;

51740 
	gskNext
;

51742 
u8
 
	gcurFÏgs
;

51743 
u8
 
	geS‹
;

51744 
u8
 
	ghšts
;

51745 
i16
 
	giPage
;

51746 
u16
 
	gaiIdx
[
BTCURSOR_MAX_DEPTH
];

51747 
MemPage
 *
	g­Page
[
BTCURSOR_MAX_DEPTH
];

51753 
	#BTCF_Wr™eFÏg
 0x01

	)

51754 
	#BTCF_V®idNKey
 0x02

	)

51755 
	#BTCF_V®idOvæ
 0x04

	)

51756 
	#BTCF_AtLa¡
 0x08

	)

51757 
	#BTCF_Inüblob
 0x10

	)

51789 
	#CURSOR_INVALID
 0

	)

51790 
	#CURSOR_VALID
 1

	)

51791 
	#CURSOR_SKIPNEXT
 2

	)

51792 
	#CURSOR_REQUIRESEEK
 3

	)

51793 
	#CURSOR_FAULT
 4

	)

51798 
	#PENDING_BYTE_PAGE
(
pBt
è
	`PAGER_MJ_PGNO
ÕBt)

	)

51815 
	#PTRMAP_PAGENO
(
pBt
, 
pgno
è
	`±rm­Pag’o
ÕBt,…gno)

	)

51816 
	#PTRMAP_PTROFFSET
(
pg±rm­
, 
pgno
è(5*Õgno-pg±rm­-1))

	)

51817 
	#PTRMAP_ISPAGE
(
pBt
, 
pgno
è(
	`PTRMAP_PAGENO
(ÕBt),Õgno))==Õgno))

	)

51850 
	#PTRMAP_ROOTPAGE
 1

	)

51851 
	#PTRMAP_FREEPAGE
 2

	)

51852 
	#PTRMAP_OVERFLOW1
 3

	)

51853 
	#PTRMAP_OVERFLOW2
 4

	)

51854 
	#PTRMAP_BTREE
 5

	)

51859 
	#bŒ“IÁegr™y
(
p
) \

51860 
	`as£¹
Ð
p
->
pBt
->
šT¿n§ùiÚ
!=
TRANS_NONE
 ||…->pBt->
nT¿n§ùiÚ
==0 ); \

51861 
	`as£¹
Ð
p
->
pBt
->
šT¿n§ùiÚ
>õ->
šT¿ns
 );

	)

51871 #iâdeà
SQLITE_OMIT_AUTOVACUUM


51872 
	#ISAUTOVACUUM
 (
pBt
->
autoVacuum
)

	)

51874 
	#ISAUTOVACUUM
 0

	)

51888 
IÁegr™yCk
 
	tIÁegr™yCk
;

51889 
	sIÁegr™yCk
 {

51890 
BtSh¬ed
 *
	gpBt
;

51891 
Pag”
 *
	gpPag”
;

51892 
u8
 *
	gaPgRef
;

51893 
Pgno
 
	gnPage
;

51894 
	gmxE¼
;

51895 
	gnE¼
;

51896 
	gm®locFažed
;

51897 cÚ¡ *
	gzPfx
;

51898 
	gv1
, 
	gv2
;

51899 
SŒAccum
 
	g”rMsg
;

51905 
	#g‘2by‹
(
x
è((x)[0]<<8 | (x)[1])

	)

51906 
	#put2by‹
(
p
,
v
è(Õ)[0] = (
u8
)((v)>>8), (p)[1] = (u8)(v))

	)

51907 
	#g‘4by‹
 
sql™e3G‘4by‹


	)

51908 
	#put4by‹
 
sql™e3Put4by‹


	)

51912 #iâdeà
SQLITE_OMIT_SHARED_CACHE


51913 #ià
SQLITE_THREADSAFE


51920 
lockBŒ“Mu‹x
(
BŒ“
 *
p
){

51921 
as£¹
Ð
p
->
locked
==0 );

51922 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
p
->
pBt
->
mu‹x
) );

51923 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

51925 
sql™e3_mu‹x_’‹r
(
p
->
pBt
->
mu‹x
);

51926 
	gp
->
	gpBt
->
	gdb
 = 
p
->
db
;

51927 
	gp
->
	glocked
 = 1;

51934 
SQLITE_NOINLINE
 
uÆockBŒ“Mu‹x
(
BŒ“
 *
p
){

51935 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

51936 
as£¹
Ð
p
->
locked
==1 );

51937 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

51938 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

51939 
as£¹
Ð
p
->
db
==
pBt
->db );

51941 
sql™e3_mu‹x_Ëave
(
pBt
->
mu‹x
);

51942 
	gp
->
	glocked
 = 0;

51946 
SQLITE_NOINLINE
 
bŒ“LockC¬efuÎy
(
BŒ“
 *
p
);

51964 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”
(
BŒ“
 *
p
){

51969 
as£¹
Ð
p
->
pNext
==0 ||…->pNext->
pBt
>p->pBt );

51970 
as£¹
Ð
p
->
pP»v
==0 ||…->pP»v->
pBt
<p->pBt );

51971 
as£¹
Ð
p
->
pNext
==0 ||…->pNext->
db
==p->db );

51972 
as£¹
Ð
p
->
pP»v
==0 ||…->pP»v->
db
==p->db );

51973 
as£¹
Ð
p
->
sh¬abË
 || (p->
pNext
==0 &&…->
pP»v
==0) );

51976 
as£¹
Ð!
p
->
locked
 ||…->
wªtToLock
>0 );

51977 
as£¹
Ð
p
->
sh¬abË
 ||…->
wªtToLock
==0 );

51980 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

51984 
as£¹
Ð(
p
->
locked
==0 &&…->
sh¬abË
è||…->
pBt
->
db
==p->db );

51986 ifÐ!
	gp
->
	gsh¬abË
 ) ;

51987 
	gp
->
	gwªtToLock
++;

51988 ifÐ
	gp
->
	glocked
 ) ;

51989 
bŒ“LockC¬efuÎy
(
p
);

51998 
SQLITE_NOINLINE
 
bŒ“LockC¬efuÎy
(
BŒ“
 *
p
){

51999 
BŒ“
 *
	gpL©”
;

52005 ifÐ
sql™e3_mu‹x_Œy
(
p
->
pBt
->
mu‹x
)==
SQLITE_OK
 ){

52006 
p
->
pBt
->
db
 =…->db;

52007 
	gp
->
	glocked
 = 1;

52016 
	gpL©”
=
p
->
pNext
;…L©”;…L©”=
pL©”
->pNext){

52017 
as£¹
Ð
pL©”
->
sh¬abË
 );

52018 
as£¹
Ð
pL©”
->
pNext
==0 ||…L©”->pNext->
pBt
>pLater->pBt );

52019 
as£¹
Ð!
pL©”
->
locked
 ||…L©”->
wªtToLock
>0 );

52020 ifÐ
	gpL©”
->
	glocked
 ){

52021 
uÆockBŒ“Mu‹x
(
pL©”
);

52024 
lockBŒ“Mu‹x
(
p
);

52025 
	gpL©”
=
p
->
pNext
;…L©”;…L©”=
pL©”
->pNext){

52026 ifÐ
pL©”
->
wªtToLock
 ){

52027 
lockBŒ“Mu‹x
(
pL©”
);

52036 
SQLITE_PRIVATE
 
sql™e3BŒ“L—ve
(
BŒ“
 *
p
){

52037 ifÐ
	gp
->
	gsh¬abË
 ){

52038 
as£¹
Ð
p
->
wªtToLock
>0 );

52039 
	gp
->
	gwªtToLock
--;

52040 ifÐ
	gp
->
	gwªtToLock
==0 ){

52041 
uÆockBŒ“Mu‹x
(
p
);

52046 #iâdeà
NDEBUG


52053 
SQLITE_PRIVATE
 
sql™e3BŒ“HÞdsMu‹x
(
BŒ“
 *
p
){

52054 
as£¹
Ð
p
->
sh¬abË
==0 ||…->
locked
==0 ||…->
wªtToLock
>0 );

52055 
as£¹
Ð
p
->
sh¬abË
==0 ||…->
locked
==0 ||…->
db
=õ->
pBt
->db );

52056 
as£¹
Ð
p
->
sh¬abË
==0 ||…->
locked
==0 || 
sql™e3_mu‹x_h–d
Õ->
pBt
->
mu‹x
) );

52057 
as£¹
Ð
p
->
sh¬abË
==0 ||…->
locked
==0 || 
sql™e3_mu‹x_h–d
Õ->
db
->
mu‹x
) );

52059  (
	gp
->
	gsh¬abË
==0 || 
p
->
locked
);

52064 #iâdeà
SQLITE_OMIT_INCRBLOB


52070 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”CursÜ
(
BtCursÜ
 *
pCur
){

52071 
sql™e3BŒ“EÁ”
(
pCur
->
pBŒ“
);

52073 
SQLITE_PRIVATE
 
sql™e3BŒ“L—veCursÜ
(
BtCursÜ
 *
pCur
){

52074 
sql™e3BŒ“L—ve
(
pCur
->
pBŒ“
);

52093 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”AÎ
(
sql™e3
 *
db
){

52094 
	gi
;

52095 
BŒ“
 *
	gp
;

52096 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

52097 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

52098 
	gp
 = 
db
->
aDb
[
i
].
pBt
;

52099 ifÐ
	gp
 ) 
sql™e3BŒ“EÁ”
(
p
);

52102 
SQLITE_PRIVATE
 
sql™e3BŒ“L—veAÎ
(
sql™e3
 *
db
){

52103 
	gi
;

52104 
BŒ“
 *
	gp
;

52105 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

52106 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

52107 
	gp
 = 
db
->
aDb
[
i
].
pBt
;

52108 ifÐ
	gp
 ) 
sql™e3BŒ“L—ve
(
p
);

52116 
SQLITE_PRIVATE
 
sql™e3BŒ“Sh¬abË
(
BŒ“
 *
p
){

52117  
	gp
->
	gsh¬abË
;

52120 #iâdeà
NDEBUG


52127 
SQLITE_PRIVATE
 
sql™e3BŒ“HÞdsAÎMu‹xes
(
sql™e3
 *
db
){

52128 
	gi
;

52129 ifÐ!
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) ){

52132 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

52133 
BŒ“
 *
	gp
;

52134 
	gp
 = 
db
->
aDb
[
i
].
pBt
;

52135 ifÐ
	gp
 &&…->
	gsh¬abË
 &&

52136 (
	gp
->
	gwªtToLock
==0 || !
sql™e3_mu‹x_h–d
(
p
->
pBt
->
mu‹x
)) ){

52144 #iâdeà
NDEBUG


52156 
SQLITE_PRIVATE
 
sql™e3SchemaMu‹xH–d
(
sql™e3
 *
db
, 
iDb
, 
Schema
 *
pSchema
){

52157 
BŒ“
 *
	gp
;

52158 
as£¹
Ð
db
!=0 );

52159 ifÐ
	gpSchema
 ) 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pSchema
);

52160 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

52161 ifÐ!
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) )  0;

52162 ifÐ
	giDb
==1 )  1;

52163 
	gp
 = 
db
->
aDb
[
iDb
].
pBt
;

52164 
as£¹
Ð
p
!=0 );

52165  
	gp
->
	gsh¬abË
==0 || 
p
->
locked
==1;

52180 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”
(
BŒ“
 *
p
){

52181 
	gp
->
	gpBt
->
	gdb
 = 
p
->
db
;

52183 
SQLITE_PRIVATE
 
sql™e3BŒ“EÁ”AÎ
(
sql™e3
 *
db
){

52184 
	gi
;

52185 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

52186 
BŒ“
 *
	gp
 = 
db
->
aDb
[
i
].
pBt
;

52187 ifÐ
	gp
 ){

52188 
	gp
->
	gpBt
->
	gdb
 = 
p
->
db
;

52217 cÚ¡ 
	gzMagicH—d”
[] = 
SQLITE_FILE_HEADER
;

52224 
	gsql™e3BŒ“T¿û
=1;

52225 
	#TRACE
(
X
èif(
sql™e3BŒ“T¿û
){
´štf
 X;
	`fæush
(
¡dout
);}

	)

52227 
	#TRACE
(
X
)

	)

52239 
	#g‘2by‹NÙZ”o
(
X
è((((()
	`g‘2by‹
(X))-1)&0xffff)+1)

	)

52244 
	#BTALLOC_ANY
 0

	)

52245 
	#BTALLOC_EXACT
 1

	)

52246 
	#BTALLOC_LE
 2

	)

52254 #iâdeà
SQLITE_OMIT_AUTOVACUUM


52255 
	#IfNÙOm™AV
(
ex´
èÓx´)

	)

52257 
	#IfNÙOm™AV
(
ex´
è0

	)

52260 #iâdeà
SQLITE_OMIT_SHARED_CACHE


52269 #ifdeà
SQLITE_TEST


52270 
SQLITE_PRIVATE
 
BtSh¬ed
 *
SQLITE_WSD
 
	gsql™e3Sh¬edCacheLi¡
 = 0;

52272 
BtSh¬ed
 *
SQLITE_WSD
 
	gsql™e3Sh¬edCacheLi¡
 = 0;

52276 #iâdeà
SQLITE_OMIT_SHARED_CACHE


52284 
SQLITE_API
 
sql™e3_’abË_sh¬ed_ÿche
(
’abË
){

52285 
	gsql™e3Glob®CÚfig
.
	gsh¬edCacheEÇbËd
 = 
’abË
;

52286  
	gSQLITE_OK
;

52292 #ifdeà
SQLITE_OMIT_SHARED_CACHE


52302 
	#qu”ySh¬edCacheTabËLock
(
a
,
b
,
c
è
SQLITE_OK


	)

52303 
	#£tSh¬edCacheTabËLock
(
a
,
b
,
c
è
SQLITE_OK


	)

52304 
	#þ—rAÎSh¬edCacheTabËLocks
(
a
)

	)

52305 
	#downg¿deAÎSh¬edCacheTabËLocks
(
a
)

	)

52306 
	#hasSh¬edCacheTabËLock
(
a
,
b
,
c
,
d
è1

	)

52307 
	#hasR—dCÚæiùs
(
a
, 
b
è0

	)

52310 #iâdeà
SQLITE_OMIT_SHARED_CACHE


52312 #ifdeà
SQLITE_DEBUG


52335 
hasSh¬edCacheTabËLock
(

52336 
BŒ“
 *
pBŒ“
,

52337 
Pgno
 
iRoÙ
,

52338 
isIndex
,

52339 
eLockTy³


52341 
Schema
 *
	gpSchema
 = (Schem¨*)
pBŒ“
->
pBt
->
pSchema
;

52342 
Pgno
 
	giTab
 = 0;

52343 
BtLock
 *
	gpLock
;

52349 ifÐ(
	gpBŒ“
->
	gsh¬abË
==0)

52350 || (
eLockTy³
==
READ_LOCK
 && (
pBŒ“
->
db
->
æags
 & 
SQLITE_R—dUncomm™‹d
))

52360 ifÐ
	gisIndex
 && (!
	gpSchema
 || (pSchema->
	gschemaFÏgs
&
	gDB_SchemaLßded
)==0) ){

52368 ifÐ
	gisIndex
 ){

52369 
HashEËm
 *
	gp
;

52370 
	gp
=
sql™eHashFœ¡
(&
pSchema
->
idxHash
);…;…=
sql™eHashNext
(
p
)){

52371 
Index
 *
pIdx
 = (Index *)
sql™eHashD©a
(
p
);

52372 ifÐ
	gpIdx
->
	gŠum
==()
iRoÙ
 ){

52373 
iTab
 = 
pIdx
->
pTabË
->
Šum
;

52377 
	giTab
 = 
iRoÙ
;

52383 
	gpLock
=
pBŒ“
->
pBt
->
pLock
;…Lock;…LockõLock->
pNext
){

52384 ifÐ
pLock
->
pBŒ“
==pBtree

52385 && (
pLock
->
iTabË
==
iTab
 || (pLock->
eLock
==
WRITE_LOCK
 &&…Lock->iTable==1))

52386 && 
pLock
->
eLock
>=
eLockTy³


52397 #ifdeà
SQLITE_DEBUG


52416 
hasR—dCÚæiùs
(
BŒ“
 *
pBŒ“
, 
Pgno
 
iRoÙ
){

52417 
BtCursÜ
 *
	gp
;

52418 
	gp
=
pBŒ“
->
pBt
->
pCursÜ
;…;…=
p
->
pNext
){

52419 ifÐ
p
->
pgnoRoÙ
==
iRoÙ


52420 && 
p
->
pBŒ“
!=pBtree

52421 && 0==(
p
->
pBŒ“
->
db
->
æags
 & 
SQLITE_R—dUncomm™‹d
)

52436 
qu”ySh¬edCacheTabËLock
(
BŒ“
 *
p
, 
Pgno
 
iTab
, 
u8
 
eLock
){

52437 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

52438 
BtLock
 *
	gpI‹r
;

52440 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

52441 
as£¹
Ð
eLock
==
READ_LOCK
 ||ƒLock==
WRITE_LOCK
 );

52442 
as£¹
Ð
p
->
db
!=0 );

52443 
as£¹
Ð!(
p
->
db
->
æags
&
SQLITE_R—dUncomm™‹d
)||
eLock
==
WRITE_LOCK
||
iTab
==1 );

52449 
as£¹
Ð
eLock
==
READ_LOCK
 || (
p
==
pBt
->
pWr™”
 &&…->
šT¿ns
==
TRANS_WRITE
) );

52450 
as£¹
Ð
eLock
==
READ_LOCK
 || 
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

52453 ifÐ!
	gp
->
	gsh¬abË
 ){

52454  
	gSQLITE_OK
;

52460 ifÐ
	gpBt
->
	gpWr™”
!=
p
 && (
pBt
->
btsFÏgs
 & 
BTS_EXCLUSIVE
)!=0 ){

52461 
sql™e3CÚÃùiÚBlocked
(
p
->
db
, 
pBt
->
pWr™”
->db);

52462  
	gSQLITE_LOCKED_SHAREDCACHE
;

52465 
	gpI‹r
=
pBt
->
pLock
;…I‹r;…I‹r=
pI‹r
->
pNext
){

52475 
as£¹
Ð
pI‹r
->
eLock
==
READ_LOCK
 ||…I‹r->eLock==
WRITE_LOCK
 );

52476 
as£¹
Ð
eLock
==
READ_LOCK
 || 
pI‹r
->
pBŒ“
==
p
 ||…Iter->eLock==READ_LOCK);

52477 ifÐ
	gpI‹r
->
	gpBŒ“
!=
p
 && 
pI‹r
->
iTabË
==
iTab
 &&…I‹r->
eLock
!=eLock ){

52478 
sql™e3CÚÃùiÚBlocked
(
p
->
db
, 
pI‹r
->
pBŒ“
->db);

52479 ifÐ
	geLock
==
WRITE_LOCK
 ){

52480 
as£¹
Ð
p
==
pBt
->
pWr™”
 );

52481 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_PENDING
;

52483  
	gSQLITE_LOCKED_SHAREDCACHE
;

52486  
	gSQLITE_OK
;

52490 #iâdeà
SQLITE_OMIT_SHARED_CACHE


52508 
£tSh¬edCacheTabËLock
(
BŒ“
 *
p
, 
Pgno
 
iTabË
, 
u8
 
eLock
){

52509 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

52510 
BtLock
 *
	gpLock
 = 0;

52511 
BtLock
 *
	gpI‹r
;

52513 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

52514 
as£¹
Ð
eLock
==
READ_LOCK
 ||ƒLock==
WRITE_LOCK
 );

52515 
as£¹
Ð
p
->
db
!=0 );

52521 
as£¹
Ð0==(
p
->
db
->
æags
&
SQLITE_R—dUncomm™‹d
è|| 
eLock
==
WRITE_LOCK
 );

52525 
as£¹
Ð
p
->
sh¬abË
 );

52526 
as£¹
Ð
SQLITE_OK
==
qu”ySh¬edCacheTabËLock
(
p
, 
iTabË
, 
eLock
) );

52529 
	gpI‹r
=
pBt
->
pLock
;…I‹r;…I‹r=
pI‹r
->
pNext
){

52530 ifÐ
pI‹r
->
iTabË
==iTabË &&…I‹r->
pBŒ“
==
p
 ){

52531 
pLock
 = 
pI‹r
;

52539 ifÐ!
	gpLock
 ){

52540 
	gpLock
 = (
BtLock
 *)
sql™e3M®locZ”o
((BtLock));

52541 ifÐ!
	gpLock
 ){

52542  
	gSQLITE_NOMEM
;

52544 
	gpLock
->
	giTabË
 = 
iTabË
;

52545 
	gpLock
->
	gpBŒ“
 = 
p
;

52546 
	gpLock
->
	gpNext
 = 
pBt
->
pLock
;

52547 
	gpBt
->
	gpLock
 = 
pLock
;

52554 
as£¹
Ð
WRITE_LOCK
>
READ_LOCK
 );

52555 ifÐ
	geLock
>
	gpLock
->eLock ){

52556 
	gpLock
->
	geLock
 = 
eLock
;

52559  
	gSQLITE_OK
;

52563 #iâdeà
SQLITE_OMIT_SHARED_CACHE


52572 
þ—rAÎSh¬edCacheTabËLocks
(
BŒ“
 *
p
){

52573 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

52574 
BtLock
 **
	gµI‹r
 = &
pBt
->
pLock
;

52576 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

52577 
as£¹
Ð
p
->
sh¬abË
 || 0==*
µI‹r
 );

52578 
as£¹
Ð
p
->
šT¿ns
>0 );

52580  *
	gµI‹r
 ){

52581 
BtLock
 *
	gpLock
 = *
µI‹r
;

52582 
as£¹
Ð(
pBt
->
btsFÏgs
 & 
BTS_EXCLUSIVE
)==0 ||…Bt->
pWr™”
==
pLock
->
pBŒ“
 );

52583 
as£¹
Ð
pLock
->
pBŒ“
->
šT¿ns
>õLock->
eLock
 );

52584 ifÐ
	gpLock
->
	gpBŒ“
==
p
 ){

52585 *
µI‹r
 = 
pLock
->
pNext
;

52586 
as£¹
Ð
pLock
->
iTabË
!=1 ||…Lock==&
p
->
lock
 );

52587 ifÐ
	gpLock
->
	giTabË
!=1 ){

52588 
sql™e3_ä“
(
pLock
);

52591 
	gµI‹r
 = &
pLock
->
pNext
;

52595 
as£¹
Ð(
pBt
->
btsFÏgs
 & 
BTS_PENDING
)==0 ||…Bt->
pWr™”
 );

52596 ifÐ
	gpBt
->
	gpWr™”
==
p
 ){

52597 
pBt
->
pWr™”
 = 0;

52598 
	gpBt
->
	gbtsFÏgs
 &ð~(
BTS_EXCLUSIVE
|
BTS_PENDING
);

52599 }ifÐ
	gpBt
->
	gnT¿n§ùiÚ
==2 ){

52609 
pBt
->
btsFÏgs
 &ð~
BTS_PENDING
;

52616 
downg¿deAÎSh¬edCacheTabËLocks
(
BŒ“
 *
p
){

52617 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

52618 ifÐ
	gpBt
->
	gpWr™”
==
p
 ){

52619 
BtLock
 *
pLock
;

52620 
	gpBt
->
	gpWr™”
 = 0;

52621 
	gpBt
->
	gbtsFÏgs
 &ð~(
BTS_EXCLUSIVE
|
BTS_PENDING
);

52622 
	gpLock
=
pBt
->
pLock
;…Lock;…LockõLock->
pNext
){

52623 
as£¹
Ð
pLock
->
eLock
==
READ_LOCK
 ||…Lock->
pBŒ“
==
p
 );

52624 
	gpLock
->
	geLock
 = 
READ_LOCK
;

52631 
»Ëa£Page
(
MemPage
 *
pPage
);

52638 #ifdeà
SQLITE_DEBUG


52639 
cursÜHÞdsMu‹x
(
BtCursÜ
 *
p
){

52640  
sql™e3_mu‹x_h–d
(
p
->
pBt
->
mu‹x
);

52648 
	#šv®id©eOv”æowCache
(
pCur
èÕCur->
curFÏgs
 &ð~
BTCF_V®idOvæ
)

	)

52654 
šv®id©eAÎOv”æowCache
(
BtSh¬ed
 *
pBt
){

52655 
BtCursÜ
 *
	gp
;

52656 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

52657 
	gp
=
pBt
->
pCursÜ
;…;…=
p
->
pNext
){

52658 
šv®id©eOv”æowCache
(
p
);

52662 #iâdeà
SQLITE_OMIT_INCRBLOB


52676 
šv®id©eInüblobCursÜs
(

52677 
BŒ“
 *
pBŒ“
,

52678 
i64
 
iRow
,

52679 
isCË¬TabË


52681 
BtCursÜ
 *
	gp
;

52682 
BtSh¬ed
 *
	gpBt
 = 
pBŒ“
->
pBt
;

52683 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
pBŒ“
) );

52684 
	gp
=
pBt
->
pCursÜ
;…;…=
p
->
pNext
){

52685 ifÐ(
p
->
curFÏgs
 & 
BTCF_Inüblob
)!=0

52686 && (
isCË¬TabË
 || 
p
->
šfo
.
nKey
==
iRow
)

52688 
p
->
eS‹
 = 
CURSOR_INVALID
;

52695 
	#šv®id©eInüblobCursÜs
(
x
,
y
,
z
)

	)

52733 
bŒ“S‘HasCÚ‹Á
(
BtSh¬ed
 *
pBt
, 
Pgno
 
pgno
){

52734 
	grc
 = 
SQLITE_OK
;

52735 ifÐ!
	gpBt
->
	gpHasCÚ‹Á
 ){

52736 
as£¹
Ð
pgno
<=
pBt
->
nPage
 );

52737 
	gpBt
->
	gpHasCÚ‹Á
 = 
sql™e3B™vecC»©e
(
pBt
->
nPage
);

52738 ifÐ!
	gpBt
->
	gpHasCÚ‹Á
 ){

52739 
	grc
 = 
SQLITE_NOMEM
;

52742 ifÐ
	grc
==
SQLITE_OK
 && 
pgno
<=
sql™e3B™vecSize
(
pBt
->
pHasCÚ‹Á
) ){

52743 
rc
 = 
sql™e3B™vecS‘
(
pBt
->
pHasCÚ‹Á
, 
pgno
);

52745  
	grc
;

52755 
bŒ“G‘HasCÚ‹Á
(
BtSh¬ed
 *
pBt
, 
Pgno
 
pgno
){

52756 
B™vec
 *
	gp
 = 
pBt
->
pHasCÚ‹Á
;

52757  (
	gp
 && (
	gpgno
>
sql™e3B™vecSize
(
p
è|| 
sql™e3B™vecTe¡
Õ, 
pgno
)));

52764 
bŒ“CË¬HasCÚ‹Á
(
BtSh¬ed
 *
pBt
){

52765 
sql™e3B™vecDe¡roy
(
pBt
->
pHasCÚ‹Á
);

52766 
	gpBt
->
	gpHasCÚ‹Á
 = 0;

52772 
bŒ“R–—£AÎCursÜPages
(
BtCursÜ
 *
pCur
){

52773 
	gi
;

52774 
	gi
=0; i<=
pCur
->
iPage
; i++){

52775 
»Ëa£Page
(
pCur
->
­Page
[
i
]);

52776 
	gpCur
->
	g­Page
[
i
] = 0;

52778 
	gpCur
->
	giPage
 = -1;

52789 
§veCursÜPos™iÚ
(
BtCursÜ
 *
pCur
){

52790 
	grc
;

52792 
as£¹
Ð
CURSOR_VALID
==
pCur
->
eS‹
 );

52793 
as£¹
Ð0==
pCur
->
pKey
 );

52794 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

52796 
	grc
 = 
sql™e3BŒ“KeySize
(
pCur
, &pCur->
nKey
);

52797 
as£¹
Ð
rc
==
SQLITE_OK
 );

52805 ifÐ0==
pCur
->
­Page
[0]->
štKey
 ){

52806 *
pKey
 = 
sql™e3M®loc
Ð
pCur
->
nKey
 );

52807 ifÐ
	gpKey
 ){

52808 
	grc
 = 
sql™e3BŒ“Key
(
pCur
, 0, (íCur->
nKey
, 
pKey
);

52809 ifÐ
	grc
==
SQLITE_OK
 ){

52810 
pCur
->
pKey
 =…Key;

52812 
sql™e3_ä“
(
pKey
);

52815 
	grc
 = 
SQLITE_NOMEM
;

52818 
as£¹
Ð!
pCur
->
­Page
[0]->
štKey
 || !pCur->
pKey
 );

52820 ifÐ
	grc
==
SQLITE_OK
 ){

52821 
bŒ“R–—£AÎCursÜPages
(
pCur
);

52822 
	gpCur
->
	geS‹
 = 
CURSOR_REQUIRESEEK
;

52825 
šv®id©eOv”æowCache
(
pCur
);

52826  
	grc
;

52830 
SQLITE_NOINLINE
 
§veCursÜsOnLi¡
(
BtCursÜ
*,
Pgno
,BtCursor*);

52844 
§veAÎCursÜs
(
BtSh¬ed
 *
pBt
, 
Pgno
 
iRoÙ
, 
BtCursÜ
 *
pExû±
){

52845 
BtCursÜ
 *
	gp
;

52846 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

52847 
as£¹
Ð
pExû±
==0 ||…Exû±->
pBt
==pBt );

52848 
	gp
=
pBt
->
pCursÜ
;…;…=
p
->
pNext
){

52849 ifÐ
p
!=
pExû±
 && (0==
iRoÙ
 ||…->
pgnoRoÙ
==iRoot) ) ;

52851  
	gp
 ? 
§veCursÜsOnLi¡
(
p
, 
iRoÙ
, 
pExû±
è: 
SQLITE_OK
;

52859 
SQLITE_NOINLINE
 
§veCursÜsOnLi¡
(

52860 
BtCursÜ
 *
p
,

52861 
Pgno
 
iRoÙ
,

52862 
BtCursÜ
 *
pExû±


52865 ifÐ
	gp
!=
pExû±
 && (0==
iRoÙ
 || 
p
->
pgnoRoÙ
==iRoot) ){

52866 ifÐ
p
->
eS‹
==
CURSOR_VALID
 ){

52867 
rc
 = 
§veCursÜPos™iÚ
(
p
);

52868 ifÐ
	gSQLITE_OK
!=
rc
 ){

52869  
rc
;

52872 
‹¡ÿ£
Ð
p
->
iPage
>0 );

52873 
bŒ“R–—£AÎCursÜPages
(
p
);

52876 
	gp
 = 
p
->
pNext
;

52877 } 
	gp
 );

52878  
	gSQLITE_OK
;

52884 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬CursÜ
(
BtCursÜ
 *
pCur
){

52885 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

52886 
sql™e3_ä“
(
pCur
->
pKey
);

52887 
	gpCur
->
	gpKey
 = 0;

52888 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

52896 
bŒ“Mov‘o
(

52897 
BtCursÜ
 *
pCur
,

52898 cÚ¡ *
pKey
,

52899 
i64
 
nKey
,

52900 
bŸs
,

52901 *
pRes


52903 
	grc
;

52904 
UÅackedRecÜd
 *
	gpIdxKey
;

52905 
	gaS·û
[200];

52906 *
	gpF»e
 = 0;

52908 ifÐ
	gpKey
 ){

52909 
as£¹
Ð
nKey
==(
i64
)()nKey );

52910 
	gpIdxKey
 = 
sql™e3VdbeAÎocUÅackedRecÜd
(

52911 
pCur
->
pKeyInfo
, 
aS·û
, ×S·û), &
pF»e


52913 ifÐ
	gpIdxKey
==0 )  
SQLITE_NOMEM
;

52914 
sql™e3VdbeRecÜdUÅack
(
pCur
->
pKeyInfo
, ()
nKey
, 
pKey
, 
pIdxKey
);

52915 ifÐ
	gpIdxKey
->
	gnF›ld
==0 ){

52916 
sql™e3DbF»e
(
pCur
->
pKeyInfo
->
db
, 
pF»e
);

52917  
	gSQLITE_CORRUPT_BKPT
;

52920 
	gpIdxKey
 = 0;

52922 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pCur
, 
pIdxKey
, 
nKey
, 
bŸs
, 
pRes
);

52923 ifÐ
	gpF»e
 ){

52924 
sql™e3DbF»e
(
pCur
->
pKeyInfo
->
db
, 
pF»e
);

52926  
	grc
;

52936 
bŒ“Re¡ÜeCursÜPos™iÚ
(
BtCursÜ
 *
pCur
){

52937 
	grc
;

52938 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

52939 
as£¹
Ð
pCur
->
eS‹
>=
CURSOR_REQUIRESEEK
 );

52940 ifÐ
	gpCur
->
	geS‹
==
CURSOR_FAULT
 ){

52941  
pCur
->
skNext
;

52943 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

52944 
	grc
 = 
bŒ“Mov‘o
(
pCur
,…Cur->
pKey
,…Cur->
nKey
, 0, &pCur->
skNext
);

52945 ifÐ
	grc
==
SQLITE_OK
 ){

52946 
sql™e3_ä“
(
pCur
->
pKey
);

52947 
	gpCur
->
	gpKey
 = 0;

52948 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 ||…Cur->eS‹==
CURSOR_INVALID
 );

52949 ifÐ
	gpCur
->
	gskNext
 &&…Cur->
	geS‹
==
CURSOR_VALID
 ){

52950 
pCur
->
eS‹
 = 
CURSOR_SKIPNEXT
;

52953  
	grc
;

52956 
	#»¡ÜeCursÜPos™iÚ
(
p
) \

52957 (
p
->
eS‹
>=
CURSOR_REQUIRESEEK
 ? \

52958 
	`bŒ“Re¡ÜeCursÜPos™iÚ
(
p
) : \

52959 
SQLITE_OK
)

	)

52973 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜHasMoved
(
BtCursÜ
 *
pCur
){

52974  
	gpCur
->
	geS‹
!=
CURSOR_VALID
;

52990 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜRe¡Üe
(
BtCursÜ
 *
pCur
, *
pDifã»ÁRow
){

52991 
	grc
;

52993 
as£¹
Ð
pCur
!=0 );

52994 
as£¹
Ð
pCur
->
eS‹
!=
CURSOR_VALID
 );

52995 
	grc
 = 
»¡ÜeCursÜPos™iÚ
(
pCur
);

52996 ifÐ
	grc
 ){

52997 *
	gpDifã»ÁRow
 = 1;

52998  
	grc
;

53000 ifÐ
	gpCur
->
	geS‹
!=
CURSOR_VALID
 || 
NEVER
(
pCur
->
skNext
!=0) ){

53001 *
pDifã»ÁRow
 = 1;

53003 *
	gpDifã»ÁRow
 = 0;

53005  
	gSQLITE_OK
;

53008 #iâdeà
SQLITE_OMIT_AUTOVACUUM


53018 
Pgno
 
±rm­Pag’o
(
BtSh¬ed
 *
pBt
, PgnØ
pgno
){

53019 
	gnPagesP”M­Page
;

53020 
Pgno
 
	giPŒM­
, 
	g»t
;

53021 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53022 ifÐ
	gpgno
<2 )  0;

53023 
	gnPagesP”M­Page
 = (
pBt
->
u§bËSize
/5)+1;

53024 
	giPŒM­
 = (
pgno
-2)/
nPagesP”M­Page
;

53025 
	g»t
 = (
iPŒM­
*
nPagesP”M­Page
) + 2;

53026 ifÐ
	g»t
==
PENDING_BYTE_PAGE
(
pBt
) ){

53027 
»t
++;

53029  
	g»t
;

53042 
±rm­Put
(
BtSh¬ed
 *
pBt
, 
Pgno
 
key
, 
u8
 
eTy³
, PgnØ
·»Á
, *
pRC
){

53043 
DbPage
 *
	gpDbPage
;

53044 
u8
 *
	gpPŒm­
;

53045 
Pgno
 
	giPŒm­
;

53046 
	goff£t
;

53047 
	grc
;

53049 ifÐ*
	gpRC
 ) ;

53051 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53053 
as£¹
Ð0==
PTRMAP_ISPAGE
(
pBt
, 
PENDING_BYTE_PAGE
(pBt)) );

53055 
as£¹
Ð
pBt
->
autoVacuum
 );

53056 ifÐ
	gkey
==0 ){

53057 *
pRC
 = 
SQLITE_CORRUPT_BKPT
;

53060 
	giPŒm­
 = 
PTRMAP_PAGENO
(
pBt
, 
key
);

53061 
	grc
 = 
sql™e3Pag”G‘
(
pBt
->
pPag”
, 
iPŒm­
, &
pDbPage
);

53062 ifÐ
	grc
!=
SQLITE_OK
 ){

53063 *
pRC
 = 
rc
;

53066 
	goff£t
 = 
PTRMAP_PTROFFSET
(
iPŒm­
, 
key
);

53067 ifÐ
	goff£t
<0 ){

53068 *
	gpRC
 = 
SQLITE_CORRUPT_BKPT
;

53069 
	g±rm­_ex™
;

53071 
as£¹
Ð
off£t
 <ð()
pBt
->
u§bËSize
-5 );

53072 
	gpPŒm­
 = (
u8
 *)
sql™e3Pag”G‘D©a
(
pDbPage
);

53074 ifÐ
	geTy³
!=
pPŒm­
[
off£t
] || 
g‘4by‹
(&pPŒm­[off£t+1])!=
·»Á
 ){

53075 
TRACE
(("PTRMAP_UPDATE: %d->(%d,%d)\n", 
key
, 
eTy³
, 
·»Á
));

53076 *
	gpRC
ð
rc
 = 
sql™e3Pag”Wr™e
(
pDbPage
);

53077 ifÐ
	grc
==
SQLITE_OK
 ){

53078 
pPŒm­
[
off£t
] = 
eTy³
;

53079 
put4by‹
(&
pPŒm­
[
off£t
+1], 
·»Á
);

53083 
	g±rm­_ex™
:

53084 
sql™e3Pag”UÄef
(
pDbPage
);

53094 
±rm­G‘
(
BtSh¬ed
 *
pBt
, 
Pgno
 
key
, 
u8
 *
pETy³
, PgnØ*
pPgno
){

53095 
DbPage
 *
	gpDbPage
;

53096 
	giPŒm­
;

53097 
u8
 *
	gpPŒm­
;

53098 
	goff£t
;

53099 
	grc
;

53101 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53103 
	giPŒm­
 = 
PTRMAP_PAGENO
(
pBt
, 
key
);

53104 
	grc
 = 
sql™e3Pag”G‘
(
pBt
->
pPag”
, 
iPŒm­
, &
pDbPage
);

53105 ifÐ
	grc
!=0 ){

53106  
rc
;

53108 
	gpPŒm­
 = (
u8
 *)
sql™e3Pag”G‘D©a
(
pDbPage
);

53110 
	goff£t
 = 
PTRMAP_PTROFFSET
(
iPŒm­
, 
key
);

53111 ifÐ
	goff£t
<0 ){

53112 
sql™e3Pag”UÄef
(
pDbPage
);

53113  
	gSQLITE_CORRUPT_BKPT
;

53115 
as£¹
Ð
off£t
 <ð()
pBt
->
u§bËSize
-5 );

53116 
as£¹
Ð
pETy³
!=0 );

53117 *
	gpETy³
 = 
pPŒm­
[
off£t
];

53118 ifÐ
	gpPgno
 ) *pPgnØð
g‘4by‹
(&
pPŒm­
[
off£t
+1]);

53120 
sql™e3Pag”UÄef
(
pDbPage
);

53121 ifÐ*
	gpETy³
<1 || *pETy³>5 )  
	gSQLITE_CORRUPT_BKPT
;

53122  
	gSQLITE_OK
;

53126 
	#±rm­Put
(
w
,
x
,
y
,
z
,
rc
)

	)

53127 
	#±rm­G‘
(
w
,
x
,
y
,
z
è
SQLITE_OK


	)

53128 
	#±rm­PutOvæPŒ
(
x
, 
y
, 
rc
)

	)

53138 
	#fšdC–l
(
P
,
I
) \

53139 ((
P
)->
aD©a
 + ((P)->
maskPage
 & 
	`g‘2by‹
(&(P)->
aC–lIdx
[2*(
I
)])))

	)

53140 
	#fšdC–lv2
(
D
,
M
,
O
,
I
è(D+(M&
	`g‘2by‹
(D+(O+2*(I)))))

	)

53147 
u8
 *
fšdOv”æowC–l
(
MemPage
 *
pPage
, 
iC–l
){

53148 
	gi
;

53149 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53150 
	gi
=
pPage
->
nOv”æow
-1; i>=0; i--){

53151 
	gk
;

53152 
	gk
 = 
pPage
->
aiOvæ
[
i
];

53153 ifÐ
	gk
<=
iC–l
 ){

53154 ifÐ
k
==
iC–l
 ){

53155  
pPage
->
­Ovæ
[
i
];

53157 
	giC–l
--;

53160  
fšdC–l
(
pPage
, 
iC–l
);

53169 
bŒ“P¬£C–lPŒ
(

53170 
MemPage
 *
pPage
,

53171 
u8
 *
pC–l
,

53172 
C–lInfo
 *
pInfo


53174 
u8
 *
	gpI‹r
;

53175 
u32
 
	gnPaylßd
;

53177 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53178 
as£¹
Ð
pPage
->
Ëaf
==0 ||…Page->leaf==1 );

53179 ifÐ
	gpPage
->
	gštKeyL—f
 ){

53180 
as£¹
Ð
pPage
->
chždPŒSize
==0 );

53181 
	gpI‹r
 = 
pC–l
 + 
g‘V¬št32
ÕC–l, 
nPaylßd
);

53182 
	gpI‹r
 +ð
g‘V¬št
(
pI‹r
, (
u64
*)&
pInfo
->
nKey
);

53183 }ifÐ
	gpPage
->
	gnoPaylßd
 ){

53184 
as£¹
Ð
pPage
->
chždPŒSize
==4 );

53185 
	gpInfo
->
	gnSize
 = 4 + 
g‘V¬št
(&
pC–l
[4], (
u64
*)&
pInfo
->
nKey
);

53186 
	gpInfo
->
	gnPaylßd
 = 0;

53187 
	gpInfo
->
	gnLoÿl
 = 0;

53188 
	gpInfo
->
	giOv”æow
 = 0;

53189 
	gpInfo
->
	gpPaylßd
 = 0;

53192 
	gpI‹r
 = 
pC–l
 + 
pPage
->
chždPŒSize
;

53193 
	gpI‹r
 +ð
g‘V¬št32
(
pI‹r
, 
nPaylßd
);

53194 
	gpInfo
->
	gnKey
 = 
nPaylßd
;

53196 
	gpInfo
->
	gnPaylßd
 = 
nPaylßd
;

53197 
	gpInfo
->
	gpPaylßd
 = 
pI‹r
;

53198 
‹¡ÿ£
Ð
nPaylßd
==
pPage
->
maxLoÿl
 );

53199 
‹¡ÿ£
Ð
nPaylßd
==
pPage
->
maxLoÿl
+1 );

53200 ifÐ
	gnPaylßd
<=
pPage
->
maxLoÿl
 ){

53204 
pInfo
->
nSize
 = 
nPaylßd
 + (
u16
)(
pI‹r
 - 
pC–l
);

53205 ifÐ
	gpInfo
->
	gnSize
<4 )…Info->nSize = 4;

53206 
	gpInfo
->
	gnLoÿl
 = (
u16
)
nPaylßd
;

53207 
	gpInfo
->
	giOv”æow
 = 0;

53218 
	gmšLoÿl
;

53219 
	gmaxLoÿl
;

53220 
	gsu½lus
;

53222 
	gmšLoÿl
 = 
pPage
->
mšLoÿl
;

53223 
	gmaxLoÿl
 = 
pPage
->
maxLoÿl
;

53224 
	gsu½lus
 = 
mšLoÿl
 + (
nPaylßd
 - mšLoÿl)%(
pPage
->
pBt
->
u§bËSize
 - 4);

53225 
‹¡ÿ£
Ð
su½lus
==
maxLoÿl
 );

53226 
‹¡ÿ£
Ð
su½lus
==
maxLoÿl
+1 );

53227 ifÐ
	gsu½lus
 <ð
maxLoÿl
 ){

53228 
pInfo
->
nLoÿl
 = (
u16
)
su½lus
;

53230 
	gpInfo
->
	gnLoÿl
 = (
u16
)
mšLoÿl
;

53232 
	gpInfo
->
	giOv”æow
 = (
u16
)(&
pInfo
->
pPaylßd
[pInfo->
nLoÿl
] - 
pC–l
);

53233 
	gpInfo
->
	gnSize
 = 
pInfo
->
iOv”æow
 + 4;

53236 
bŒ“P¬£C–l
(

53237 
MemPage
 *
pPage
,

53238 
iC–l
,

53239 
C–lInfo
 *
pInfo


53241 
bŒ“P¬£C–lPŒ
(
pPage
, 
fšdC–l
ÕPage, 
iC–l
), 
pInfo
);

53250 
u16
 
ûÎSizePŒ
(
MemPage
 *
pPage
, 
u8
 *
pC–l
){

53251 
u8
 *
	gpI‹r
 = 
pC–l
 + 
pPage
->
chždPŒSize
;

53252 
u8
 *
	gpEnd
;

53253 
u32
 
	gnSize
;

53255 #ifdeà
SQLITE_DEBUG


53260 
C–lInfo
 
	gdebugšfo
;

53261 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
debugšfo
);

53264 ifÐ
	gpPage
->
	gnoPaylßd
 ){

53265 
	gpEnd
 = &
pI‹r
[9];

53266  (*
	gpI‹r
++)&0x80 &&…I‹r<
	gpEnd
 );

53267 
as£¹
Ð
pPage
->
chždPŒSize
==4 );

53268  (
	gu16
)(
	gpI‹r
 - 
	gpC–l
);

53270 
	gnSize
 = *
pI‹r
;

53271 ifÐ
	gnSize
>=0x80 ){

53272 
pEnd
 = &
pI‹r
[9];

53273 
	gnSize
 &= 0x7f;

53275 
	gnSize
 = (
nSize
<<7è| (*++
pI‹r
 & 0x7f);

53276 } *(
	gpI‹r
)>=0x80 && 
pI‹r
<
pEnd
 );

53278 
	gpI‹r
++;

53279 ifÐ
	gpPage
->
	gštKey
 ){

53283 
	gpEnd
 = &
pI‹r
[9];

53284  (*
	gpI‹r
++)&0x80 &&…I‹r<
	gpEnd
 );

53286 
‹¡ÿ£
Ð
nSize
==
pPage
->
maxLoÿl
 );

53287 
‹¡ÿ£
Ð
nSize
==
pPage
->
maxLoÿl
+1 );

53288 ifÐ
	gnSize
<=
pPage
->
maxLoÿl
 ){

53289 
nSize
 +ð(
u32
)(
pI‹r
 - 
pC–l
);

53290 ifÐ
	gnSize
<4 )‚Size = 4;

53292 
	gmšLoÿl
 = 
pPage
->
mšLoÿl
;

53293 
	gnSize
 = 
mšLoÿl
 + (
nSize
 - mšLoÿlè% (
pPage
->
pBt
->
u§bËSize
 - 4);

53294 
‹¡ÿ£
Ð
nSize
==
pPage
->
maxLoÿl
 );

53295 
‹¡ÿ£
Ð
nSize
==
pPage
->
maxLoÿl
+1 );

53296 ifÐ
	gnSize
>
	gpPage
->
	gmaxLoÿl
 ){

53297 
	gnSize
 = 
mšLoÿl
;

53299 
	gnSize
 +ð4 + (
u16
)(
pI‹r
 - 
pC–l
);

53301 
as£¹
Ð
nSize
==
debugšfo
.nSiz|| 
CORRUPT_DB
 );

53302  (
	gu16
)
	gnSize
;

53305 #ifdeà
SQLITE_DEBUG


53308 
u16
 
ûÎSize
(
MemPage
 *
pPage
, 
iC–l
){

53309  
ûÎSizePŒ
(
pPage
, 
fšdC–l
ÕPage, 
iC–l
));

53313 #iâdeà
SQLITE_OMIT_AUTOVACUUM


53319 
±rm­PutOvæPŒ
(
MemPage
 *
pPage
, 
u8
 *
pC–l
, *
pRC
){

53320 
C–lInfo
 
	gšfo
;

53321 ifÐ*
	gpRC
 ) ;

53322 
as£¹
Ð
pC–l
!=0 );

53323 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
šfo
);

53324 ifÐ
	gšfo
.
	giOv”æow
 ){

53325 
Pgno
 
	govæ
 = 
g‘4by‹
(&
pC–l
[
šfo
.
iOv”æow
]);

53326 
±rm­Put
(
pPage
->
pBt
, 
ovæ
, 
PTRMAP_OVERFLOW1
,…Page->
pgno
, 
pRC
);

53338 
deäagm’tPage
(
MemPage
 *
pPage
){

53339 
	gi
;

53340 
	gpc
;

53341 
	ghdr
;

53342 
	gsize
;

53343 
	gu§bËSize
;

53344 
	gûÎOff£t
;

53345 
	gcbrk
;

53346 
	gnC–l
;

53347 *
	gd©a
;

53348 *
	g‹mp
;

53349 
	giC–lFœ¡
;

53350 
	giC–lLa¡
;

53353 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

53354 
as£¹
Ð
pPage
->
pBt
!=0 );

53355 
as£¹
Ð
pPage
->
pBt
->
u§bËSize
 <ð
SQLITE_MAX_PAGE_SIZE
 );

53356 
as£¹
Ð
pPage
->
nOv”æow
==0 );

53357 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53358 
	g‹mp
 = 
sql™e3Pag”TempS·û
(
pPage
->
pBt
->
pPag”
);

53359 
	gd©a
 = 
pPage
->
aD©a
;

53360 
	ghdr
 = 
pPage
->
hdrOff£t
;

53361 
	gûÎOff£t
 = 
pPage
->
ûÎOff£t
;

53362 
	gnC–l
 = 
pPage
->
nC–l
;

53363 
as£¹
Ð
nC–l
==
g‘2by‹
(&
d©a
[
hdr
+3]) );

53364 
	gu§bËSize
 = 
pPage
->
pBt
->
u§bËSize
;

53365 
	gcbrk
 = 
g‘2by‹
(&
d©a
[
hdr
+5]);

53366 
memýy
(&
‹mp
[
cbrk
], &
d©a
[cbrk], 
u§bËSize
 - cbrk);

53367 
	gcbrk
 = 
u§bËSize
;

53368 
	giC–lFœ¡
 = 
ûÎOff£t
 + 2*
nC–l
;

53369 
	giC–lLa¡
 = 
u§bËSize
 - 4;

53370 
	gi
=0; i<
	gnC–l
; i++){

53371 
u8
 *
	gpAddr
;

53372 
	gpAddr
 = &
d©a
[
ûÎOff£t
 + 
i
*2];

53373 
	gpc
 = 
g‘2by‹
(
pAddr
);

53374 
‹¡ÿ£
Ð
pc
==
iC–lFœ¡
 );

53375 
‹¡ÿ£
Ð
pc
==
iC–lLa¡
 );

53376 #ià!
defšed
(
SQLITE_ENABLE_OVERSIZE_CELL_CHECK
)

53380 ifÐ
	gpc
<
	giC–lFœ¡
 ||…c>
	giC–lLa¡
 ){

53381  
	gSQLITE_CORRUPT_BKPT
;

53384 
as£¹
Ð
pc
>=
iC–lFœ¡
 &&…c<=
iC–lLa¡
 );

53385 
	gsize
 = 
ûÎSizePŒ
(
pPage
, &
‹mp
[
pc
]);

53386 
	gcbrk
 -ð
size
;

53387 #ià
defšed
(
SQLITE_ENABLE_OVERSIZE_CELL_CHECK
)

53388 ifÐ
	gcbrk
<
	giC–lFœ¡
 ){

53389  
	gSQLITE_CORRUPT_BKPT
;

53392 ifÐ
	gcbrk
<
	giC–lFœ¡
 || 
	gpc
+
	gsize
>
	gu§bËSize
 ){

53393  
	gSQLITE_CORRUPT_BKPT
;

53396 
as£¹
Ð
cbrk
+
size
<=
u§bËSize
 && cbrk>=
iC–lFœ¡
 );

53397 
‹¡ÿ£
Ð
cbrk
+
size
==
u§bËSize
 );

53398 
‹¡ÿ£
Ð
pc
+
size
==
u§bËSize
 );

53399 
memýy
(&
d©a
[
cbrk
], &
‹mp
[
pc
], 
size
);

53400 
put2by‹
(
pAddr
, 
cbrk
);

53402 
as£¹
Ð
cbrk
>=
iC–lFœ¡
 );

53403 
put2by‹
(&
d©a
[
hdr
+5], 
cbrk
);

53404 
	gd©a
[
hdr
+1] = 0;

53405 
	gd©a
[
hdr
+2] = 0;

53406 
	gd©a
[
hdr
+7] = 0;

53407 
mem£t
(&
d©a
[
iC–lFœ¡
], 0, 
cbrk
-iCellFirst);

53408 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

53409 ifÐ
	gcbrk
-
	giC–lFœ¡
!=
pPage
->
nF»e
 ){

53410  
SQLITE_CORRUPT_BKPT
;

53412  
	gSQLITE_OK
;

53428 
®loÿ‹S·û
(
MemPage
 *
pPage
, 
nBy‹
, *
pIdx
){

53429 cÚ¡ 
	ghdr
 = 
pPage
->
hdrOff£t
;

53430 
u8
 * cÚ¡ 
	gd©a
 = 
pPage
->
aD©a
;

53431 
	gtÝ
;

53432 
	gg­
;

53433 
	grc
;

53434 
	gu§bËSize
;

53436 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

53437 
as£¹
Ð
pPage
->
pBt
 );

53438 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53439 
as£¹
Ð
nBy‹
>=0 );

53440 
as£¹
Ð
pPage
->
nF»e
>=
nBy‹
 );

53441 
as£¹
Ð
pPage
->
nOv”æow
==0 );

53442 
	gu§bËSize
 = 
pPage
->
pBt
->
u§bËSize
;

53443 
as£¹
Ð
nBy‹
 < 
u§bËSize
-8 );

53445 
as£¹
Ð
pPage
->
ûÎOff£t
 =ð
hdr
 + 12 - 4*pPage->
Ëaf
 );

53446 
	gg­
 = 
pPage
->
ûÎOff£t
 + 2*pPage->
nC–l
;

53447 
as£¹
Ð
g­
<=65536 );

53448 
	gtÝ
 = 
g‘2by‹
(&
d©a
[
hdr
+5]);

53449 ifÐ
	gg­
>
	gtÝ
 ){

53450 ifÐ
	gtÝ
==0 ){

53451 
tÝ
 = 65536;

53453  
	gSQLITE_CORRUPT_BKPT
;

53461 
‹¡ÿ£
Ð
g­
+2==
tÝ
 );

53462 
‹¡ÿ£
Ð
g­
+1==
tÝ
 );

53463 
‹¡ÿ£
Ð
g­
==
tÝ
 );

53464 ifÐ
	gg­
+2<=
tÝ
 && (
d©a
[
hdr
+1] || data[hdr+2]) ){

53465 
pc
, 
addr
;

53466 
	gaddr
=
hdr
+1; (
	gpc
 = 
g‘2by‹
(&
d©a
[
addr
]))>0;‡ddr=
pc
){

53467 
size
;

53468 ifÐ
	gpc
>
	gu§bËSize
-4 ||…c<
	gaddr
+4 ){

53469  
	gSQLITE_CORRUPT_BKPT
;

53471 
	gsize
 = 
g‘2by‹
(&
d©a
[
pc
+2]);

53472 ifÐ
	gsize
>=
nBy‹
 ){

53473 
x
 = 
size
 - 
nBy‹
;

53474 
‹¡ÿ£
Ð
x
==4 );

53475 
‹¡ÿ£
Ð
x
==3 );

53476 ifÐ
	gx
<4 ){

53477 ifÐ
	gd©a
[
hdr
+7]>=60 ) 
deäagm’t_·ge
;

53480 
memýy
(&
d©a
[
addr
], &d©a[
pc
], 2);

53481 
	gd©a
[
hdr
+7] +ð(
u8
)
x
;

53482 }ifÐ
	gsize
+
	gpc
 > 
	gu§bËSize
 ){

53483  
	gSQLITE_CORRUPT_BKPT
;

53487 
put2by‹
(&
d©a
[
pc
+2], 
x
);

53489 *
	gpIdx
 = 
pc
 + 
x
;

53490  
	gSQLITE_OK
;

53498 
‹¡ÿ£
Ð
g­
+2+
nBy‹
==
tÝ
 );

53499 ifÐ
	gg­
+2+
	gnBy‹
>
	gtÝ
 ){

53500 
	gdeäagm’t_·ge
:

53501 
‹¡ÿ£
Ð
pPage
->
nC–l
==0 );

53502 
	grc
 = 
deäagm’tPage
(
pPage
);

53503 ifÐ
	grc
 ) „c;

53504 
	gtÝ
 = 
g‘2by‹NÙZ”o
(&
d©a
[
hdr
+5]);

53505 
as£¹
Ð
g­
+
nBy‹
<=
tÝ
 );

53515 
	gtÝ
 -ð
nBy‹
;

53516 
put2by‹
(&
d©a
[
hdr
+5], 
tÝ
);

53517 
as£¹
Ð
tÝ
+
nBy‹
 <ð()
pPage
->
pBt
->
u§bËSize
 );

53518 *
	gpIdx
 = 
tÝ
;

53519  
	gSQLITE_OK
;

53535 
ä“S·û
(
MemPage
 *
pPage
, 
u16
 
iS¹
, u16 
iSize
){

53536 
u16
 
	giPŒ
;

53537 
u16
 
	giF»eBlk
;

53538 
u8
 
	ghdr
;

53539 
u8
 
	gnF¿g
 = 0;

53540 
u16
 
	giOrigSize
 = 
iSize
;

53541 
u32
 
	giLa¡
 = 
pPage
->
pBt
->
u§bËSize
-4;

53542 
u32
 
	giEnd
 = 
iS¹
 + 
iSize
;

53543 *
	gd©a
 = 
pPage
->
aD©a
;

53545 
as£¹
Ð
pPage
->
pBt
!=0 );

53546 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

53547 
as£¹
Ð
iS¹
>=
pPage
->
hdrOff£t
+6+pPage->
chždPŒSize
 );

53548 
as£¹
Ð
iEnd
 <ð
pPage
->
pBt
->
u§bËSize
 );

53549 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53550 
as£¹
Ð
iSize
>=4 );

53551 
as£¹
Ð
iS¹
<=
iLa¡
 );

53555 ifÐ
	gpPage
->
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_SECURE_DELETE
 ){

53556 
mem£t
(&
d©a
[
iS¹
], 0, 
iSize
);

53562 
	ghdr
 = 
pPage
->
hdrOff£t
;

53563 
	giPŒ
 = 
hdr
 + 1;

53564 ifÐ
	gd©a
[
iPŒ
+1]==0 && 
d©a
[iPtr]==0 ){

53565 
iF»eBlk
 = 0;

53567  (
	giF»eBlk
 = 
g‘2by‹
(&
d©a
[
iPŒ
]))>0 && 
iF»eBlk
<
iS¹
 ){

53568 ifÐ
iF»eBlk
<
iPŒ
+4 )  
SQLITE_CORRUPT_BKPT
;

53569 
	giPŒ
 = 
iF»eBlk
;

53571 ifÐ
	giF»eBlk
>
	giLa¡
 )  
	gSQLITE_CORRUPT_BKPT
;

53572 
as£¹
Ð
iF»eBlk
>
iPŒ
 || iFreeBlk==0 );

53580 ifÐ
	giF»eBlk
 && 
	giEnd
+3>=
iF»eBlk
 ){

53581 
nF¿g
 = 
iF»eBlk
 - 
iEnd
;

53582 ifÐ
	giEnd
>
	giF»eBlk
 )  
	gSQLITE_CORRUPT_BKPT
;

53583 
	giEnd
 = 
iF»eBlk
 + 
g‘2by‹
(&
d©a
[iFreeBlk+2]);

53584 
	giSize
 = 
iEnd
 - 
iS¹
;

53585 
	giF»eBlk
 = 
g‘2by‹
(&
d©a
[
iF»eBlk
]);

53592 ifÐ
	giPŒ
>
	ghdr
+1 ){

53593 
	giPŒEnd
 = 
iPŒ
 + 
g‘2by‹
(&
d©a
[iPtr+2]);

53594 ifÐ
	giPŒEnd
+3>=
iS¹
 ){

53595 ifÐ
iPŒEnd
>
iS¹
 )  
SQLITE_CORRUPT_BKPT
;

53596 
	gnF¿g
 +ð
iS¹
 - 
iPŒEnd
;

53597 
	giSize
 = 
iEnd
 - 
iPŒ
;

53598 
	giS¹
 = 
iPŒ
;

53601 ifÐ
	gnF¿g
>
	gd©a
[
hdr
+7] )  
	gSQLITE_CORRUPT_BKPT
;

53602 
	gd©a
[
hdr
+7] -ð
nF¿g
;

53604 ifÐ
	giS¹
==
g‘2by‹
(&
d©a
[
hdr
+5]) ){

53608 ifÐ
iPŒ
!=
hdr
+1 )  
SQLITE_CORRUPT_BKPT
;

53609 
put2by‹
(&
d©a
[
hdr
+1], 
iF»eBlk
);

53610 
put2by‹
(&
d©a
[
hdr
+5], 
iEnd
);

53613 
put2by‹
(&
d©a
[
iPŒ
], 
iS¹
);

53614 
put2by‹
(&
d©a
[
iS¹
], 
iF»eBlk
);

53615 
put2by‹
(&
d©a
[
iS¹
+2], 
iSize
);

53617 
	gpPage
->
	gnF»e
 +ð
iOrigSize
;

53618  
	gSQLITE_OK
;

53633 
decodeFÏgs
(
MemPage
 *
pPage
, 
æagBy‹
){

53634 
BtSh¬ed
 *
	gpBt
;

53636 
as£¹
Ð
pPage
->
hdrOff£t
==ÕPage->
pgno
==1 ? 100 : 0) );

53637 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53638 
	gpPage
->
	gËaf
 = (
u8
)(
æagBy‹
>>3); 
as£¹
Ð
PTF_LEAF
 == 1<<3 );

53639 
	gæagBy‹
 &ð~
PTF_LEAF
;

53640 
	gpPage
->
	gchždPŒSize
 = 4-4*
pPage
->
Ëaf
;

53641 
	gpBt
 = 
pPage
->
pBt
;

53642 ifÐ
	gæagBy‹
==(
PTF_LEAFDATA
 | 
PTF_INTKEY
) ){

53643 
pPage
->
štKey
 = 1;

53644 
	gpPage
->
	gštKeyL—f
 = 
pPage
->
Ëaf
;

53645 
	gpPage
->
	gnoPaylßd
 = !
pPage
->
Ëaf
;

53646 
	gpPage
->
	gmaxLoÿl
 = 
pBt
->
maxL—f
;

53647 
	gpPage
->
	gmšLoÿl
 = 
pBt
->
mšL—f
;

53648 }ifÐ
	gæagBy‹
==
PTF_ZERODATA
 ){

53649 
pPage
->
štKey
 = 0;

53650 
	gpPage
->
	gštKeyL—f
 = 0;

53651 
	gpPage
->
	gnoPaylßd
 = 0;

53652 
	gpPage
->
	gmaxLoÿl
 = 
pBt
->
maxLoÿl
;

53653 
	gpPage
->
	gmšLoÿl
 = 
pBt
->
mšLoÿl
;

53655  
	gSQLITE_CORRUPT_BKPT
;

53657 
	gpPage
->
	gmax1by‹Paylßd
 = 
pBt
->
max1by‹Paylßd
;

53658  
	gSQLITE_OK
;

53670 
bŒ“In™Page
(
MemPage
 *
pPage
){

53672 
as£¹
Ð
pPage
->
pBt
!=0 );

53673 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53674 
as£¹
Ð
pPage
->
pgno
==
sql™e3Pag”Pag’umb”
ÕPage->
pDbPage
) );

53675 
as£¹
Ð
pPage
 =ð
sql™e3Pag”G‘ExŒa
ÕPage->
pDbPage
) );

53676 
as£¹
Ð
pPage
->
aD©a
 =ð
sql™e3Pag”G‘D©a
ÕPage->
pDbPage
) );

53678 ifÐ!
	gpPage
->
	gisIn™
 ){

53679 
u16
 
	gpc
;

53680 
u8
 
	ghdr
;

53681 
u8
 *
	gd©a
;

53682 
BtSh¬ed
 *
	gpBt
;

53683 
	gu§bËSize
;

53684 
u16
 
	gûÎOff£t
;

53685 
	gnF»e
;

53686 
	gtÝ
;

53687 
	giC–lFœ¡
;

53688 
	giC–lLa¡
;

53690 
	gpBt
 = 
pPage
->
pBt
;

53692 
	ghdr
 = 
pPage
->
hdrOff£t
;

53693 
	gd©a
 = 
pPage
->
aD©a
;

53694 ifÐ
decodeFÏgs
(
pPage
, 
d©a
[
hdr
]èè 
	gSQLITE_CORRUPT_BKPT
;

53695 
as£¹
Ð
pBt
->
·geSize
>=512 &&…Bt->pageSize<=65536 );

53696 
	gpPage
->
	gmaskPage
 = (
u16
)(
pBt
->
·geSize
 - 1);

53697 
	gpPage
->
	gnOv”æow
 = 0;

53698 
	gu§bËSize
 = 
pBt
->
u§bËSize
;

53699 
	gpPage
->
	gûÎOff£t
 = 
ûÎOff£t
 = 
hdr
 + 12 - 4*
pPage
->
Ëaf
;

53700 
	gpPage
->
	gaD©aEnd
 = &
d©a
[
u§bËSize
];

53701 
	gpPage
->
	gaC–lIdx
 = &
d©a
[
ûÎOff£t
];

53702 
	gtÝ
 = 
g‘2by‹NÙZ”o
(&
d©a
[
hdr
+5]);

53703 
	gpPage
->
	gnC–l
 = 
g‘2by‹
(&
d©a
[
hdr
+3]);

53704 ifÐ
	gpPage
->
	gnC–l
>
MX_CELL
(
pBt
) ){

53706  
	gSQLITE_CORRUPT_BKPT
;

53708 
‹¡ÿ£
Ð
pPage
->
nC–l
==
MX_CELL
(
pBt
) );

53717 
	giC–lFœ¡
 = 
ûÎOff£t
 + 2*
pPage
->
nC–l
;

53718 
	giC–lLa¡
 = 
u§bËSize
 - 4;

53719 #ià
defšed
(
SQLITE_ENABLE_OVERSIZE_CELL_CHECK
)

53721 
	gi
;

53722 
	gsz
;

53724 ifÐ!
	gpPage
->
	gËaf
 ) 
	giC–lLa¡
--;

53725 
	gi
=0; i<
	gpPage
->
	gnC–l
; i++){

53726 
	gpc
 = 
g‘2by‹
(&
d©a
[
ûÎOff£t
+
i
*2]);

53727 
‹¡ÿ£
Ð
pc
==
iC–lFœ¡
 );

53728 
‹¡ÿ£
Ð
pc
==
iC–lLa¡
 );

53729 ifÐ
	gpc
<
	giC–lFœ¡
 ||…c>
	giC–lLa¡
 ){

53730  
	gSQLITE_CORRUPT_BKPT
;

53732 
	gsz
 = 
ûÎSizePŒ
(
pPage
, &
d©a
[
pc
]);

53733 
‹¡ÿ£
Ð
pc
+
sz
==
u§bËSize
 );

53734 ifÐ
	gpc
+
	gsz
>
	gu§bËSize
 ){

53735  
	gSQLITE_CORRUPT_BKPT
;

53738 ifÐ!
	gpPage
->
	gËaf
 ) 
	giC–lLa¡
++;

53743 
	gpc
 = 
g‘2by‹
(&
d©a
[
hdr
+1]);

53744 
	gnF»e
 = 
d©a
[
hdr
+7] + 
tÝ
;

53745  
	gpc
>0 ){

53746 
u16
 
	gÃxt
, 
	gsize
;

53747 ifÐ
	gpc
<
	giC–lFœ¡
 ||…c>
	giC–lLa¡
 ){

53749  
	gSQLITE_CORRUPT_BKPT
;

53751 
	gÃxt
 = 
g‘2by‹
(&
d©a
[
pc
]);

53752 
	gsize
 = 
g‘2by‹
(&
d©a
[
pc
+2]);

53753 ifÐ(
	gÃxt
>0 &&‚ext<=
pc
+
size
+3è||…c+size>
u§bËSize
 ){

53756  
SQLITE_CORRUPT_BKPT
;

53758 
	gnF»e
 = 
nF»e
 + 
size
;

53759 
	gpc
 = 
Ãxt
;

53769 ifÐ
	gnF»e
>
	gu§bËSize
 ){

53770  
	gSQLITE_CORRUPT_BKPT
;

53772 
	gpPage
->
	gnF»e
 = (
u16
)(
nF»e
 - 
iC–lFœ¡
);

53773 
	gpPage
->
	gisIn™
 = 1;

53775  
	gSQLITE_OK
;

53782 
z”oPage
(
MemPage
 *
pPage
, 
æags
){

53783 *
	gd©a
 = 
pPage
->
aD©a
;

53784 
BtSh¬ed
 *
	gpBt
 = 
pPage
->
pBt
;

53785 
u8
 
	ghdr
 = 
pPage
->
hdrOff£t
;

53786 
u16
 
	gfœ¡
;

53788 
as£¹
Ð
sql™e3Pag”Pag’umb”
(
pPage
->
pDbPage
)=õPage->
pgno
 );

53789 
as£¹
Ð
sql™e3Pag”G‘ExŒa
(
pPage
->
pDbPage
) == (*)pPage );

53790 
as£¹
Ð
sql™e3Pag”G‘D©a
(
pPage
->
pDbPage
è=ð
d©a
 );

53791 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

53792 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53793 ifÐ
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_SECURE_DELETE
 ){

53794 
mem£t
(&
d©a
[
hdr
], 0, 
pBt
->
u§bËSize
 - hdr);

53796 
	gd©a
[
hdr
] = ()
æags
;

53797 
	gfœ¡
 = 
hdr
 + ((
æags
&
PTF_LEAF
)==0 ? 12 : 8);

53798 
mem£t
(&
d©a
[
hdr
+1], 0, 4);

53799 
	gd©a
[
hdr
+7] = 0;

53800 
put2by‹
(&
d©a
[
hdr
+5], 
pBt
->
u§bËSize
);

53801 
	gpPage
->
	gnF»e
 = (
u16
)(
pBt
->
u§bËSize
 - 
fœ¡
);

53802 
decodeFÏgs
(
pPage
, 
æags
);

53803 
	gpPage
->
	gûÎOff£t
 = 
fœ¡
;

53804 
	gpPage
->
	gaD©aEnd
 = &
d©a
[
pBt
->
u§bËSize
];

53805 
	gpPage
->
	gaC–lIdx
 = &
d©a
[
fœ¡
];

53806 
	gpPage
->
	gnOv”æow
 = 0;

53807 
as£¹
Ð
pBt
->
·geSize
>=512 &&…Bt->pageSize<=65536 );

53808 
	gpPage
->
	gmaskPage
 = (
u16
)(
pBt
->
·geSize
 - 1);

53809 
	gpPage
->
	gnC–l
 = 0;

53810 
	gpPage
->
	gisIn™
 = 1;

53818 
MemPage
 *
bŒ“PageFromDbPage
(
DbPage
 *
pDbPage
, 
Pgno
 
pgno
, 
BtSh¬ed
 *
pBt
){

53819 
MemPage
 *
	gpPage
 = (MemPage*)
sql™e3Pag”G‘ExŒa
(
pDbPage
);

53820 
	gpPage
->
	gaD©a
 = 
sql™e3Pag”G‘D©a
(
pDbPage
);

53821 
	gpPage
->
	gpDbPage
 = 
pDbPage
;

53822 
	gpPage
->
	gpBt
 = 
pBt
;

53823 
	gpPage
->
	gpgno
 = 
pgno
;

53824 
	gpPage
->
	ghdrOff£t
 = 
pPage
->
pgno
==1 ? 100 : 0;

53825  
	gpPage
;

53839 
bŒ“G‘Page
(

53840 
BtSh¬ed
 *
pBt
,

53841 
Pgno
 
pgno
,

53842 
MemPage
 **
µPage
,

53843 
æags


53845 
	grc
;

53846 
DbPage
 *
	gpDbPage
;

53848 
as£¹
Ð
æags
==0 || fÏgs==
PAGER_GET_NOCONTENT
 || fÏgs==
PAGER_GET_READONLY
 );

53849 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53850 
	grc
 = 
sql™e3Pag”Acquœe
(
pBt
->
pPag”
, 
pgno
, (
DbPage
**)&
pDbPage
, 
æags
);

53851 ifÐ
	grc
 ) „c;

53852 *
	gµPage
 = 
bŒ“PageFromDbPage
(
pDbPage
, 
pgno
, 
pBt
);

53853  
	gSQLITE_OK
;

53861 
MemPage
 *
bŒ“PageLookup
(
BtSh¬ed
 *
pBt
, 
Pgno
 
pgno
){

53862 
DbPage
 *
	gpDbPage
;

53863 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53864 
	gpDbPage
 = 
sql™e3Pag”Lookup
(
pBt
->
pPag”
, 
pgno
);

53865 ifÐ
	gpDbPage
 ){

53866  
bŒ“PageFromDbPage
(
pDbPage
, 
pgno
, 
pBt
);

53875 
Pgno
 
bŒ“PagecouÁ
(
BtSh¬ed
 *
pBt
){

53876  
	gpBt
->
	gnPage
;

53878 
SQLITE_PRIVATE
 
u32
 
sql™e3BŒ“La¡Page
(
BŒ“
 *
p
){

53879 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

53880 
as£¹
Ð((
p
->
pBt
->
nPage
)&0x8000000)==0 );

53881  
bŒ“PagecouÁ
(
p
->
pBt
);

53892 
g‘AndIn™Page
(

53893 
BtSh¬ed
 *
pBt
,

53894 
Pgno
 
pgno
,

53895 
MemPage
 **
µPage
,

53896 
bR—dÚly


53898 
	grc
;

53899 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

53900 
as£¹
Ð
bR—dÚly
==
PAGER_GET_READONLY
 || bReadonly==0 );

53902 ifÐ
	gpgno
>
bŒ“PagecouÁ
(
pBt
) ){

53903 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

53905 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
pgno
, 
µPage
, 
bR—dÚly
);

53906 ifÐ
	grc
==
SQLITE_OK
 && (*
µPage
)->
isIn™
==0 ){

53907 
rc
 = 
bŒ“In™Page
(*
µPage
);

53908 ifÐ
	grc
!=
SQLITE_OK
 ){

53909 
»Ëa£Page
(*
µPage
);

53914 
‹¡ÿ£
Ð
pgno
==0 );

53915 
as£¹
Ð
pgno
!=0 || 
rc
==
SQLITE_CORRUPT
 );

53916  
	grc
;

53923 
»Ëa£Page
(
MemPage
 *
pPage
){

53924 ifÐ
	gpPage
 ){

53925 
as£¹
Ð
pPage
->
aD©a
 );

53926 
as£¹
Ð
pPage
->
pBt
 );

53927 
as£¹
Ð
pPage
->
pDbPage
!=0 );

53928 
as£¹
Ð
sql™e3Pag”G‘ExŒa
(
pPage
->
pDbPage
) == (*)pPage );

53929 
as£¹
Ð
sql™e3Pag”G‘D©a
(
pPage
->
pDbPage
)=õPage->
aD©a
 );

53930 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53931 
sql™e3Pag”UÄefNÙNuÎ
(
pPage
->
pDbPage
);

53943 
·geReš™
(
DbPage
 *
pD©a
){

53944 
MemPage
 *
	gpPage
;

53945 
	gpPage
 = (
MemPage
 *)
sql™e3Pag”G‘ExŒa
(
pD©a
);

53946 
as£¹
Ð
sql™e3Pag”PageRefcouÁ
(
pD©a
)>0 );

53947 ifÐ
	gpPage
->
	gisIn™
 ){

53948 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

53949 
	gpPage
->
	gisIn™
 = 0;

53950 ifÐ
sql™e3Pag”PageRefcouÁ
(
pD©a
)>1 ){

53957 
bŒ“In™Page
(
pPage
);

53965 
bŒ“InvokeBusyHªdËr
(*
pArg
){

53966 
BtSh¬ed
 *
	gpBt
 = (BtSh¬ed*)
pArg
;

53967 
as£¹
Ð
pBt
->
db
 );

53968 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
db
->
mu‹x
) );

53969  
sql™e3InvokeBusyHªdËr
(&
pBt
->
db
->
busyHªdËr
);

53993 
SQLITE_PRIVATE
 
sql™e3BŒ“O³n
(

53994 
sql™e3_vfs
 *
pVfs
,

53995 cÚ¡ *
zFž’ame
,

53996 
sql™e3
 *
db
,

53997 
BŒ“
 **
µBŒ“
,

53998 
æags
,

53999 
vfsFÏgs


54001 
BtSh¬ed
 *
	gpBt
 = 0;

54002 
BŒ“
 *
	gp
;

54003 
sql™e3_mu‹x
 *
	gmu‹xO³n
 = 0;

54004 
	grc
 = 
SQLITE_OK
;

54005 
u8
 
	gnRe£rve
;

54006 
	gzDbH—d”
[100];

54009 cÚ¡ 
	gisTempDb
 = 
zFž’ame
==0 || zFilename[0]==0;

54014 #ifdeà
SQLITE_OMIT_MEMORYDB


54015 cÚ¡ 
	gisMemdb
 = 0;

54017 cÚ¡ 
	gisMemdb
 = (
zFž’ame
 && 
¡rcmp
(zFilename, ":memory:")==0)

54018 || (
isTempDb
 && 
sql™e3TempInMemÜy
(
db
))

54019 || (
vfsFÏgs
 & 
SQLITE_OPEN_MEMORY
)!=0;

54022 
as£¹
Ð
db
!=0 );

54023 
as£¹
Ð
pVfs
!=0 );

54024 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

54025 
as£¹
Ð(
æags
&0xff)==flags );

54028 
as£¹
Ð(
æags
 & 
BTREE_UNORDERED
)==0 || (æag & 
BTREE_SINGLE
)!=0 );

54031 
as£¹
Ð(
æags
 & 
BTREE_SINGLE
)==0 || 
isTempDb
 );

54033 ifÐ
	gisMemdb
 ){

54034 
	gæags
 |ð
BTREE_MEMORY
;

54036 ifÐ(
	gvfsFÏgs
 & 
	gSQLITE_OPEN_MAIN_DB
)!=0 && (
isMemdb
 || 
isTempDb
) ){

54037 
vfsFÏgs
 = (vfsFÏg & ~
SQLITE_OPEN_MAIN_DB
è| 
SQLITE_OPEN_TEMP_DB
;

54039 
	gp
 = 
sql™e3M®locZ”o
((
BŒ“
));

54040 ifÐ!
	gp
 ){

54041  
	gSQLITE_NOMEM
;

54043 
	gp
->
	gšT¿ns
 = 
TRANS_NONE
;

54044 
	gp
->
	gdb
 = 
db
;

54045 #iâdeà
SQLITE_OMIT_SHARED_CACHE


54046 
	gp
->
	glock
.
	gpBŒ“
 = 
p
;

54047 
	gp
->
	glock
.
	giTabË
 = 1;

54050 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& !defšed(
SQLITE_OMIT_DISKIO
)

54055 ifÐ
	gisTempDb
==0 && (
isMemdb
==0 || (
vfsFÏgs
&
SQLITE_OPEN_URI
)!=0) ){

54056 ifÐ
vfsFÏgs
 & 
SQLITE_OPEN_SHAREDCACHE
 ){

54057 
nFuÎP©hÇme
 = 
pVfs
->
mxP©hÇme
+1;

54058 *
	gzFuÎP©hÇme
 = 
sql™e3M®loc
(
nFuÎP©hÇme
);

54059 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
mu‹xSh¬ed
; )

54060 
	gp
->
	gsh¬abË
 = 1;

54061 ifÐ!
	gzFuÎP©hÇme
 ){

54062 
sql™e3_ä“
(
p
);

54063  
	gSQLITE_NOMEM
;

54065 ifÐ
	gisMemdb
 ){

54066 
memýy
(
zFuÎP©hÇme
, 
zFž’ame
, 
sql™e3SŒËn30
(zFilename)+1);

54068 
	grc
 = 
sql™e3OsFuÎP©hÇme
(
pVfs
, 
zFž’ame
,

54069 
nFuÎP©hÇme
, 
zFuÎP©hÇme
);

54070 ifÐ
	grc
 ){

54071 
sql™e3_ä“
(
zFuÎP©hÇme
);

54072 
sql™e3_ä“
(
p
);

54073  
	grc
;

54076 #ià
SQLITE_THREADSAFE


54077 
	gmu‹xO³n
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_OPEN
);

54078 
sql™e3_mu‹x_’‹r
(
mu‹xO³n
);

54079 
	gmu‹xSh¬ed
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

54080 
sql™e3_mu‹x_’‹r
(
mu‹xSh¬ed
);

54082 
	gpBt
=
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
);…Bt;…Bt=
pBt
->
pNext
){

54083 
as£¹
Ð
pBt
->
nRef
>0 );

54084 ifÐ0==
¡rcmp
(
zFuÎP©hÇme
, 
sql™e3Pag”Fž’ame
(
pBt
->
pPag”
, 0))

54085 && 
sql™e3Pag”Vfs
(
pBt
->
pPag”
)==
pVfs
 ){

54086 
iDb
;

54087 
	giDb
=
db
->
nDb
-1; iDb>=0; iDb--){

54088 
BŒ“
 *
	gpExi¡šg
 = 
db
->
aDb
[
iDb
].
pBt
;

54089 ifÐ
	gpExi¡šg
 &&…Exi¡šg->
	gpBt
==
pBt
 ){

54090 
sql™e3_mu‹x_Ëave
(
mu‹xSh¬ed
);

54091 
sql™e3_mu‹x_Ëave
(
mu‹xO³n
);

54092 
sql™e3_ä“
(
zFuÎP©hÇme
);

54093 
sql™e3_ä“
(
p
);

54094  
	gSQLITE_CONSTRAINT
;

54097 
	gp
->
	gpBt
 = 
pBt
;

54098 
	gpBt
->
	gnRef
++;

54102 
sql™e3_mu‹x_Ëave
(
mu‹xSh¬ed
);

54103 
sql™e3_ä“
(
zFuÎP©hÇme
);

54105 #ifdeà
SQLITE_DEBUG


54112 
	gp
->
	gsh¬abË
 = 1;

54117 ifÐ
	gpBt
==0 ){

54123 
as£¹
Ð(
i64
)==8 || (i64)==4 );

54124 
as£¹
Ð(
u64
)==8 || (u64)==4 );

54125 
as£¹
Ð(
u32
)==4 );

54126 
as£¹
Ð(
u16
)==2 );

54127 
as£¹
Ð(
Pgno
)==4 );

54129 
	gpBt
 = 
sql™e3M®locZ”o
Ð(*
pBt
) );

54130 ifÐ
	gpBt
==0 ){

54131 
rc
 = 
SQLITE_NOMEM
;

54132 
	gbŒ“_Ý’_out
;

54134 
	grc
 = 
sql™e3Pag”O³n
(
pVfs
, &
pBt
->
pPag”
, 
zFž’ame
,

54135 
EXTRA_SIZE
, 
æags
, 
vfsFÏgs
, 
·geReš™
);

54136 ifÐ
	grc
==
SQLITE_OK
 ){

54137 
sql™e3Pag”S‘Mm­Lim™
(
pBt
->
pPag”
, 
db
->
szMm­
);

54138 
	grc
 = 
sql™e3Pag”R—dFžeh—d”
(
pBt
->
pPag”
,(
zDbH—d”
),zDbHeader);

54140 ifÐ
	grc
!=
SQLITE_OK
 ){

54141 
bŒ“_Ý’_out
;

54143 
	gpBt
->
	gÝ’FÏgs
 = (
u8
)
æags
;

54144 
	gpBt
->
	gdb
 = 
db
;

54145 
sql™e3Pag”S‘BusyhªdËr
(
pBt
->
pPag”
, 
bŒ“InvokeBusyHªdËr
,…Bt);

54146 
	gp
->
	gpBt
 = 
pBt
;

54148 
	gpBt
->
	gpCursÜ
 = 0;

54149 
	gpBt
->
	gpPage1
 = 0;

54150 ifÐ
sql™e3Pag”I¤—dÚly
(
pBt
->
pPag”
èè
	gpBt
->
	gbtsFÏgs
 |ð
BTS_READ_ONLY
;

54151 #ifdeà
SQLITE_SECURE_DELETE


54152 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_SECURE_DELETE
;

54154 
	gpBt
->
	g·geSize
 = (
zDbH—d”
[16]<<8) | (zDbHeader[17]<<16);

54155 ifÐ
	gpBt
->
	g·geSize
<512 ||…Bt->·geSize>
	gSQLITE_MAX_PAGE_SIZE


54156 || ((
	gpBt
->
	g·geSize
-1)&pBt->pageSize)!=0 ){

54157 
pBt
->
·geSize
 = 0;

54158 #iâdeà
SQLITE_OMIT_AUTOVACUUM


54165 ifÐ
	gzFž’ame
 && !
	gisMemdb
 ){

54166 
	gpBt
->
	gautoVacuum
 = (
SQLITE_DEFAULT_AUTOVACUUM
 ? 1 : 0);

54167 
	gpBt
->
	gšüVacuum
 = (
SQLITE_DEFAULT_AUTOVACUUM
==2 ? 1 : 0);

54170 
	gnRe£rve
 = 0;

54172 
	gnRe£rve
 = 
zDbH—d”
[20];

54173 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_PAGESIZE_FIXED
;

54174 #iâdeà
SQLITE_OMIT_AUTOVACUUM


54175 
	gpBt
->
	gautoVacuum
 = (
g‘4by‹
(&
zDbH—d”
[36 + 4*4])?1:0);

54176 
	gpBt
->
	gšüVacuum
 = (
g‘4by‹
(&
zDbH—d”
[36 + 7*4])?1:0);

54179 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pBt
->
pPag”
, &pBt->
·geSize
, 
nRe£rve
);

54180 ifÐ
	grc
 ) 
	gbŒ“_Ý’_out
;

54181 
	gpBt
->
	gu§bËSize
 = 
pBt
->
·geSize
 - 
nRe£rve
;

54182 
as£¹
Ð(
pBt
->
·geSize
 & 7)==0 );

54184 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& !defšed(
SQLITE_OMIT_DISKIO
)

54187 ifÐ
	gp
->
	gsh¬abË
 ){

54188 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
mu‹xSh¬ed
; )

54189 
	gpBt
->
	gnRef
 = 1;

54190 
MUTEX_LOGIC
Ð
mu‹xSh¬ed
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);)

54191 ifÐ
	gSQLITE_THREADSAFE
 && 
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 ){

54192 
	gpBt
->
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_FAST
);

54193 ifÐ
	gpBt
->
	gmu‹x
==0 ){

54194 
rc
 = 
SQLITE_NOMEM
;

54195 
	gdb
->
	gm®locFažed
 = 0;

54196 
	gbŒ“_Ý’_out
;

54199 
sql™e3_mu‹x_’‹r
(
mu‹xSh¬ed
);

54200 
	gpBt
->
	gpNext
 = 
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
);

54201 
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
èð
pBt
;

54202 
sql™e3_mu‹x_Ëave
(
mu‹xSh¬ed
);

54207 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& !defšed(
SQLITE_OMIT_DISKIO
)

54212 ifÐ
	gp
->
	gsh¬abË
 ){

54213 
	gi
;

54214 
BŒ“
 *
	gpSib
;

54215 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

54216 ifÐ(
	gpSib
 = 
db
->
aDb
[
i
].
pBt
)!=0 && 
pSib
->
sh¬abË
 ){

54217  
pSib
->
pP»v
 ){…Sib =…Sib->pPrev; }

54218 ifÐ
	gp
->
	gpBt
<
	gpSib
->pBt ){

54219 
	gp
->
	gpNext
 = 
pSib
;

54220 
	gp
->
	gpP»v
 = 0;

54221 
	gpSib
->
	gpP»v
 = 
p
;

54223  
	gpSib
->
	gpNext
 &&…Sib->pNext->
	gpBt
<
	gp
->pBt ){

54224 
	gpSib
 = 
pSib
->
pNext
;

54226 
	gp
->
	gpNext
 = 
pSib
->
pNext
;

54227 
	gp
->
	gpP»v
 = 
pSib
;

54228 ifÐ
	gp
->
	gpNext
 ){

54229 
	gp
->
	gpNext
->
	gpP»v
 = 
p
;

54231 
	gpSib
->
	gpNext
 = 
p
;

54238 *
	gµBŒ“
 = 
p
;

54240 
	gbŒ“_Ý’_out
:

54241 ifÐ
rc
!=
SQLITE_OK
 ){

54242 ifÐ
pBt
 &&…Bt->
pPag”
 ){

54243 
sql™e3Pag”Clo£
(
pBt
->
pPag”
);

54245 
sql™e3_ä“
(
pBt
);

54246 
sql™e3_ä“
(
p
);

54247 *
	gµBŒ“
 = 0;

54253 ifÐ
sql™e3BŒ“Schema
(
p
, 0, 0)==0 ){

54254 
sql™e3Pag”S‘Cachesize
(
p
->
pBt
->
pPag”
, 
SQLITE_DEFAULT_CACHE_SIZE
);

54257 ifÐ
	gmu‹xO³n
 ){

54258 
as£¹
Ð
sql™e3_mu‹x_h–d
(
mu‹xO³n
) );

54259 
sql™e3_mu‹x_Ëave
(
mu‹xO³n
);

54261  
	grc
;

54270 
»moveFromSh¬šgLi¡
(
BtSh¬ed
 *
pBt
){

54271 #iâdeà
SQLITE_OMIT_SHARED_CACHE


54272 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
pMa¡”
; )

54273 
BtSh¬ed
 *
	gpLi¡
;

54274 
	g»moved
 = 0;

54276 
as£¹
Ð
sql™e3_mu‹x_nÙh–d
(
pBt
->
mu‹x
) );

54277 
MUTEX_LOGIC
Ð
pMa¡”
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
); )

54278 
sql™e3_mu‹x_’‹r
(
pMa¡”
);

54279 
	gpBt
->
	gnRef
--;

54280 ifÐ
	gpBt
->
	gnRef
<=0 ){

54281 ifÐ
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
)==
pBt
 ){

54282 
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
èð
pBt
->
pNext
;

54284 
	gpLi¡
 = 
GLOBAL
(
BtSh¬ed
*,
sql™e3Sh¬edCacheLi¡
);

54285  
ALWAYS
(
pLi¡
è&& 
	gpLi¡
->
	gpNext
!=
pBt
 ){

54286 
pLi¡
õLi¡->
pNext
;

54288 ifÐ
ALWAYS
(
pLi¡
) ){

54289 
	gpLi¡
->
	gpNext
 = 
pBt
->
pNext
;

54292 ifÐ
	gSQLITE_THREADSAFE
 ){

54293 
sql™e3_mu‹x_ä“
(
pBt
->
mu‹x
);

54295 
	g»moved
 = 1;

54297 
sql™e3_mu‹x_Ëave
(
pMa¡”
);

54298  
	g»moved
;

54309 
®loÿ‹TempS·û
(
BtSh¬ed
 *
pBt
){

54310 ifÐ!
	gpBt
->
	gpTmpS·û
 ){

54311 
	gpBt
->
	gpTmpS·û
 = 
sql™e3PageM®loc
Ð
pBt
->
·geSize
 );

54328 ifÐ
	gpBt
->
	gpTmpS·û
 ){

54329 
mem£t
(
pBt
->
pTmpS·û
, 0, 8);

54330 
	gpBt
->
	gpTmpS·û
 += 4;

54338 
ä“TempS·û
(
BtSh¬ed
 *
pBt
){

54339 ifÐ
	gpBt
->
	gpTmpS·û
 ){

54340 
	gpBt
->
	gpTmpS·û
 -= 4;

54341 
sql™e3PageF»e
(
pBt
->
pTmpS·û
);

54342 
	gpBt
->
	gpTmpS·û
 = 0;

54349 
SQLITE_PRIVATE
 
sql™e3BŒ“Clo£
(
BŒ“
 *
p
){

54350 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54351 
BtCursÜ
 *
	gpCur
;

54354 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

54355 
sql™e3BŒ“EÁ”
(
p
);

54356 
	gpCur
 = 
pBt
->
pCursÜ
;

54357  
	gpCur
 ){

54358 
BtCursÜ
 *
	gpTmp
 = 
pCur
;

54359 
	gpCur
 = 
pCur
->
pNext
;

54360 ifÐ
	gpTmp
->
	gpBŒ“
==
p
 ){

54361 
sql™e3BŒ“Clo£CursÜ
(
pTmp
);

54369 
sql™e3BŒ“RÞlback
(
p
, 
SQLITE_OK
, 0);

54370 
sql™e3BŒ“L—ve
(
p
);

54376 
as£¹
Ð
p
->
wªtToLock
==0 &&…->
locked
==0 );

54377 ifÐ!
	gp
->
	gsh¬abË
 || 
»moveFromSh¬šgLi¡
(
pBt
) ){

54383 
as£¹
Ð!
pBt
->
pCursÜ
 );

54384 
sql™e3Pag”Clo£
(
pBt
->
pPag”
);

54385 ifÐ
	gpBt
->
	gxF»eSchema
 &&…Bt->
	gpSchema
 ){

54386 
	gpBt
->
xF»eSchema
(
pBt
->
pSchema
);

54388 
sql™e3DbF»e
(0, 
pBt
->
pSchema
);

54389 
ä“TempS·û
(
pBt
);

54390 
sql™e3_ä“
(
pBt
);

54393 #iâdeà
SQLITE_OMIT_SHARED_CACHE


54394 
as£¹
Ð
p
->
wªtToLock
==0 );

54395 
as£¹
Ð
p
->
locked
==0 );

54396 ifÐ
	gp
->
	gpP»v
 )…->pP»v->
	gpNext
 = 
p
->
pNext
;

54397 ifÐ
	gp
->
	gpNext
 )…->pNext->
	gpP»v
 = 
p
->
pP»v
;

54400 
sql™e3_ä“
(
p
);

54401  
	gSQLITE_OK
;

54419 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘CacheSize
(
BŒ“
 *
p
, 
mxPage
){

54420 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54421 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

54422 
sql™e3BŒ“EÁ”
(
p
);

54423 
sql™e3Pag”S‘Cachesize
(
pBt
->
pPag”
, 
mxPage
);

54424 
sql™e3BŒ“L—ve
(
p
);

54425  
	gSQLITE_OK
;

54428 #ià
SQLITE_MAX_MMAP_SIZE
>0

54433 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘Mm­Lim™
(
BŒ“
 *
p
, 
sql™e3_št64
 
szMm­
){

54434 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54435 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

54436 
sql™e3BŒ“EÁ”
(
p
);

54437 
sql™e3Pag”S‘Mm­Lim™
(
pBt
->
pPag”
, 
szMm­
);

54438 
sql™e3BŒ“L—ve
(
p
);

54439  
	gSQLITE_OK
;

54451 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


54452 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘Pag”FÏgs
(

54453 
BŒ“
 *
p
,

54454 
pgFÏgs


54456 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54457 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

54458 
sql™e3BŒ“EÁ”
(
p
);

54459 
sql™e3Pag”S‘FÏgs
(
pBt
->
pPag”
, 
pgFÏgs
);

54460 
sql™e3BŒ“L—ve
(
p
);

54461  
	gSQLITE_OK
;

54469 
SQLITE_PRIVATE
 
sql™e3BŒ“SyncDi§bËd
(
BŒ“
 *
p
){

54470 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54471 
	grc
;

54472 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

54473 
sql™e3BŒ“EÁ”
(
p
);

54474 
as£¹
Ð
pBt
 &&…Bt->
pPag”
 );

54475 
	grc
 = 
sql™e3Pag”Nosync
(
pBt
->
pPag”
);

54476 
sql™e3BŒ“L—ve
(
p
);

54477  
	grc
;

54500 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘PageSize
(
BŒ“
 *
p
, 
·geSize
, 
nRe£rve
, 
iFix
){

54501 
	grc
 = 
SQLITE_OK
;

54502 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54503 
as£¹
Ð
nRe£rve
>=-1 &&‚Reserve<=255 );

54504 
sql™e3BŒ“EÁ”
(
p
);

54505 ifÐ
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_PAGESIZE_FIXED
 ){

54506 
sql™e3BŒ“L—ve
(
p
);

54507  
	gSQLITE_READONLY
;

54509 ifÐ
	gnRe£rve
<0 ){

54510 
	gnRe£rve
 = 
pBt
->
·geSize
 -…Bt->
u§bËSize
;

54512 
as£¹
Ð
nRe£rve
>=0 &&‚Reserve<=255 );

54513 ifÐ
	g·geSize
>=512 && 
·geSize
<=
SQLITE_MAX_PAGE_SIZE
 &&

54514 ((
·geSize
-1)&pageSize)==0 ){

54515 
as£¹
Ð(
·geSize
 & 7)==0 );

54516 
as£¹
Ð!
pBt
->
pPage1
 && !pBt->
pCursÜ
 );

54517 
	gpBt
->
	g·geSize
 = (
u32
)
·geSize
;

54518 
ä“TempS·û
(
pBt
);

54520 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pBt
->
pPag”
, &pBt->
·geSize
, 
nRe£rve
);

54521 
	gpBt
->
	gu§bËSize
 = 
pBt
->
·geSize
 - (
u16
)
nRe£rve
;

54522 ifÐ
	giFix
 ) 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_PAGESIZE_FIXED
;

54523 
sql™e3BŒ“L—ve
(
p
);

54524  
	grc
;

54530 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘PageSize
(
BŒ“
 *
p
){

54531  
	gp
->
	gpBt
->
	g·geSize
;

54534 #ià
defšed
(
SQLITE_HAS_CODEC
è|| defšed(
SQLITE_DEBUG
)

54546 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘Re£rveNoMu‹x
(
BŒ“
 *
p
){

54547 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pBt
->
mu‹x
) );

54548  
	gp
->
	gpBt
->
	g·geSize
 -…->pBt->
	gu§bËSize
;

54552 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
è|| !defšed(
SQLITE_OMIT_VACUUM
)

54558 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘Re£rve
(
BŒ“
 *
p
){

54559 
	gn
;

54560 
sql™e3BŒ“EÁ”
(
p
);

54561 
	gn
 = 
p
->
pBt
->
·geSize
 -…->pBt->
u§bËSize
;

54562 
sql™e3BŒ“L—ve
(
p
);

54563  
	gn
;

54571 
SQLITE_PRIVATE
 
sql™e3BŒ“MaxPageCouÁ
(
BŒ“
 *
p
, 
mxPage
){

54572 
	gn
;

54573 
sql™e3BŒ“EÁ”
(
p
);

54574 
	gn
 = 
sql™e3Pag”MaxPageCouÁ
(
p
->
pBt
->
pPag”
, 
mxPage
);

54575 
sql™e3BŒ“L—ve
(
p
);

54576  
	gn
;

54584 
SQLITE_PRIVATE
 
sql™e3BŒ“Secu»D–‘e
(
BŒ“
 *
p
, 
ÃwFÏg
){

54585 
	gb
;

54586 ifÐ
	gp
==0 )  0;

54587 
sql™e3BŒ“EÁ”
(
p
);

54588 ifÐ
	gÃwFÏg
>=0 ){

54589 
p
->
pBt
->
btsFÏgs
 &ð~
BTS_SECURE_DELETE
;

54590 ifÐ
	gÃwFÏg
 ) 
	gp
->
	gpBt
->
	gbtsFÏgs
 |ð
BTS_SECURE_DELETE
;

54592 
	gb
 = (
p
->
pBt
->
btsFÏgs
 & 
BTS_SECURE_DELETE
)!=0;

54593 
sql™e3BŒ“L—ve
(
p
);

54594  
	gb
;

54604 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘AutoVacuum
(
BŒ“
 *
p
, 
autoVacuum
){

54605 #ifdeà
SQLITE_OMIT_AUTOVACUUM


54606  
	gSQLITE_READONLY
;

54608 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54609 
	grc
 = 
SQLITE_OK
;

54610 
u8
 
	gav
 = (u8)
autoVacuum
;

54612 
sql™e3BŒ“EÁ”
(
p
);

54613 ifÐ(
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_PAGESIZE_FIXED
)!=0 && (
av
 ?1:0)!=
pBt
->
autoVacuum
 ){

54614 
rc
 = 
SQLITE_READONLY
;

54616 
	gpBt
->
	gautoVacuum
 = 
av
 ?1:0;

54617 
	gpBt
->
	gšüVacuum
 = 
av
==2 ?1:0;

54619 
sql™e3BŒ“L—ve
(
p
);

54620  
	grc
;

54628 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘AutoVacuum
(
BŒ“
 *
p
){

54629 #ifdeà
SQLITE_OMIT_AUTOVACUUM


54630  
	gBTREE_AUTOVACUUM_NONE
;

54632 
	grc
;

54633 
sql™e3BŒ“EÁ”
(
p
);

54634 
	grc
 = (

54635 (!
p
->
pBt
->
autoVacuum
)?
BTREE_AUTOVACUUM_NONE
:

54636 (!
p
->
pBt
->
šüVacuum
)?
BTREE_AUTOVACUUM_FULL
:

54637 
BTREE_AUTOVACUUM_INCR


54639 
sql™e3BŒ“L—ve
(
p
);

54640  
	grc
;

54654 
lockBŒ“
(
BtSh¬ed
 *
pBt
){

54655 
	grc
;

54656 
MemPage
 *
	gpPage1
;

54657 
	gnPage
;

54658 
	gnPageFže
 = 0;

54659 
	gnPageH—d”
;

54661 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

54662 
as£¹
Ð
pBt
->
pPage1
==0 );

54663 
	grc
 = 
sql™e3Pag”Sh¬edLock
(
pBt
->
pPag”
);

54664 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

54665 
	grc
 = 
bŒ“G‘Page
(
pBt
, 1, &
pPage1
, 0);

54666 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

54671 
	gnPage
 = 
nPageH—d”
 = 
g‘4by‹
(28+(
u8
*)
pPage1
->
aD©a
);

54672 
sql™e3Pag”PagecouÁ
(
pBt
->
pPag”
, &
nPageFže
);

54673 ifÐ
	gnPage
==0 || 
memcmp
(24+(
u8
*)
pPage1
->
aD©a
, 92+(u8*)pPage1->aData,4)!=0 ){

54674 
nPage
 = 
nPageFže
;

54676 ifÐ
	gnPage
>0 ){

54677 
u32
 
	g·geSize
;

54678 
u32
 
	gu§bËSize
;

54679 
u8
 *
	g·ge1
 = 
pPage1
->
aD©a
;

54680 
	grc
 = 
SQLITE_NOTADB
;

54681 ifÐ
memcmp
(
·ge1
, 
zMagicH—d”
, 16)!=0 ){

54682 
·ge1_š™_çžed
;

54685 #ifdeà
SQLITE_OMIT_WAL


54686 ifÐ
	g·ge1
[18]>1 ){

54687 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_READ_ONLY
;

54689 ifÐ
	g·ge1
[19]>1 ){

54690 
	g·ge1_š™_çžed
;

54693 ifÐ
	g·ge1
[18]>2 ){

54694 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_READ_ONLY
;

54696 ifÐ
	g·ge1
[19]>2 ){

54697 
	g·ge1_š™_çžed
;

54708 ifÐ
	g·ge1
[19]==2 && (
pBt
->
btsFÏgs
 & 
BTS_NO_WAL
)==0 ){

54709 
isO³n
 = 0;

54710 
	grc
 = 
sql™e3Pag”O³nW®
(
pBt
->
pPag”
, &
isO³n
);

54711 ifÐ
	grc
!=
SQLITE_OK
 ){

54712 
·ge1_š™_çžed
;

54713 }ifÐ
	gisO³n
==0 ){

54714 
»Ëa£Page
(
pPage1
);

54715  
	gSQLITE_OK
;

54717 
	grc
 = 
SQLITE_NOTADB
;

54726 ifÐ
memcmp
(&
·ge1
[21], "\100\040\040",3)!=0 ){

54727 
·ge1_š™_çžed
;

54729 
	g·geSize
 = (
·ge1
[16]<<8) | (page1[17]<<16);

54730 ifÐ((
	g·geSize
-1)&pageSize)!=0

54731 || 
·geSize
>
SQLITE_MAX_PAGE_SIZE


54732 || 
·geSize
<=256

54734 
·ge1_š™_çžed
;

54736 
as£¹
Ð(
·geSize
 & 7)==0 );

54737 
	gu§bËSize
 = 
·geSize
 - 
·ge1
[20];

54738 ifÐ(
	gu32
)
	g·geSize
!=
pBt
->
·geSize
 ){

54745 
»Ëa£Page
(
pPage1
);

54746 
	gpBt
->
	gu§bËSize
 = 
u§bËSize
;

54747 
	gpBt
->
	g·geSize
 = 
·geSize
;

54748 
ä“TempS·û
(
pBt
);

54749 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pBt
->
pPag”
, &pBt->
·geSize
,

54750 
·geSize
-
u§bËSize
);

54751  
	grc
;

54753 ifÐ(
	gpBt
->
	gdb
->
	gæags
 & 
	gSQLITE_Recov”yMode
)==0 && 
nPage
>
nPageFže
 ){

54754 
rc
 = 
SQLITE_CORRUPT_BKPT
;

54755 
	g·ge1_š™_çžed
;

54757 ifÐ
	gu§bËSize
<480 ){

54758 
	g·ge1_š™_çžed
;

54760 
	gpBt
->
	g·geSize
 = 
·geSize
;

54761 
	gpBt
->
	gu§bËSize
 = 
u§bËSize
;

54762 #iâdeà
SQLITE_OMIT_AUTOVACUUM


54763 
	gpBt
->
	gautoVacuum
 = (
g‘4by‹
(&
·ge1
[36 + 4*4])?1:0);

54764 
	gpBt
->
	gšüVacuum
 = (
g‘4by‹
(&
·ge1
[36 + 7*4])?1:0);

54781 
	gpBt
->
	gmaxLoÿl
 = (
u16
)((
pBt
->
u§bËSize
-12)*64/255 - 23);

54782 
	gpBt
->
	gmšLoÿl
 = (
u16
)((
pBt
->
u§bËSize
-12)*32/255 - 23);

54783 
	gpBt
->
	gmaxL—f
 = (
u16
)(
pBt
->
u§bËSize
 - 35);

54784 
	gpBt
->
	gmšL—f
 = (
u16
)((
pBt
->
u§bËSize
-12)*32/255 - 23);

54785 ifÐ
	gpBt
->
	gmaxLoÿl
>127 ){

54786 
	gpBt
->
	gmax1by‹Paylßd
 = 127;

54788 
	gpBt
->
	gmax1by‹Paylßd
 = (
u8
)
pBt
->
maxLoÿl
;

54790 
as£¹
Ð
pBt
->
maxL—f
 + 23 <ð
MX_CELL_SIZE
(pBt) );

54791 
	gpBt
->
	gpPage1
 = 
pPage1
;

54792 
	gpBt
->
	gnPage
 = 
nPage
;

54793  
	gSQLITE_OK
;

54795 
	g·ge1_š™_çžed
:

54796 
»Ëa£Page
(
pPage1
);

54797 
	gpBt
->
	gpPage1
 = 0;

54798  
	grc
;

54801 #iâdeà
NDEBUG


54814 
couÁV®idCursÜs
(
BtSh¬ed
 *
pBt
, 
wrOÆy
){

54815 
BtCursÜ
 *
	gpCur
;

54816 
	gr
 = 0;

54817 
	gpCur
=
pBt
->
pCursÜ
;…Cur;…Cur=
pCur
->
pNext
){

54818 ifÐ(
wrOÆy
==0 || (
pCur
->
curFÏgs
 & 
BTCF_Wr™eFÏg
)!=0)

54819 && 
pCur
->
eS‹
!=
CURSOR_FAULT
 ) 
r
++;

54821  
	gr
;

54833 
uÆockBŒ“IfUnu£d
(
BtSh¬ed
 *
pBt
){

54834 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

54835 
as£¹
Ð
couÁV®idCursÜs
(
pBt
,0)==0 ||…Bt->
šT¿n§ùiÚ
>
TRANS_NONE
 );

54836 ifÐ
	gpBt
->
	gšT¿n§ùiÚ
==
TRANS_NONE
 && 
pBt
->
pPage1
!=0 ){

54837 
MemPage
 *
pPage1
 = 
pBt
->pPage1;

54838 
as£¹
Ð
pPage1
->
aD©a
 );

54839 
as£¹
Ð
sql™e3Pag”RefcouÁ
(
pBt
->
pPag”
)==1 );

54840 
	gpBt
->
	gpPage1
 = 0;

54841 
»Ëa£Page
(
pPage1
);

54850 
ÃwD©aba£
(
BtSh¬ed
 *
pBt
){

54851 
MemPage
 *
	gpP1
;

54852 *
	gd©a
;

54853 
	grc
;

54855 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

54856 ifÐ
	gpBt
->
	gnPage
>0 ){

54857  
	gSQLITE_OK
;

54859 
	gpP1
 = 
pBt
->
pPage1
;

54860 
as£¹
Ð
pP1
!=0 );

54861 
	gd©a
 = 
pP1
->
aD©a
;

54862 
	grc
 = 
sql™e3Pag”Wr™e
(
pP1
->
pDbPage
);

54863 ifÐ
	grc
 ) „c;

54864 
memýy
(
d©a
, 
zMagicH—d”
, (zMagicHeader));

54865 
as£¹
Ð(
zMagicH—d”
)==16 );

54866 
	gd©a
[16] = (
u8
)((
pBt
->
·geSize
>>8)&0xff);

54867 
	gd©a
[17] = (
u8
)((
pBt
->
·geSize
>>16)&0xff);

54868 
	gd©a
[18] = 1;

54869 
	gd©a
[19] = 1;

54870 
as£¹
Ð
pBt
->
u§bËSize
<õBt->
·geSize
 &&…Bt->usableSize+255>=pBt->pageSize);

54871 
	gd©a
[20] = (
u8
)(
pBt
->
·geSize
 -…Bt->
u§bËSize
);

54872 
	gd©a
[21] = 64;

54873 
	gd©a
[22] = 32;

54874 
	gd©a
[23] = 32;

54875 
mem£t
(&
d©a
[24], 0, 100-24);

54876 
z”oPage
(
pP1
, 
PTF_INTKEY
|
PTF_LEAF
|
PTF_LEAFDATA
 );

54877 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_PAGESIZE_FIXED
;

54878 #iâdeà
SQLITE_OMIT_AUTOVACUUM


54879 
as£¹
Ð
pBt
->
autoVacuum
==1 ||…Bt->autoVacuum==0 );

54880 
as£¹
Ð
pBt
->
šüVacuum
==1 ||…Bt->incrVacuum==0 );

54881 
put4by‹
(&
d©a
[36 + 4*4], 
pBt
->
autoVacuum
);

54882 
put4by‹
(&
d©a
[36 + 7*4], 
pBt
->
šüVacuum
);

54884 
	gpBt
->
	gnPage
 = 1;

54885 
	gd©a
[31] = 1;

54886  
	gSQLITE_OK
;

54894 
SQLITE_PRIVATE
 
sql™e3BŒ“NewDb
(
BŒ“
 *
p
){

54895 
	grc
;

54896 
sql™e3BŒ“EÁ”
(
p
);

54897 
	gp
->
	gpBt
->
	gnPage
 = 0;

54898 
	grc
 = 
ÃwD©aba£
(
p
->
pBt
);

54899 
sql™e3BŒ“L—ve
(
p
);

54900  
	grc
;

54938 
SQLITE_PRIVATE
 
sql™e3BŒ“BegšT¿ns
(
BŒ“
 *
p
, 
wræag
){

54939 
sql™e3
 *
	gpBlock
 = 0;

54940 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

54941 
	grc
 = 
SQLITE_OK
;

54943 
sql™e3BŒ“EÁ”
(
p
);

54944 
bŒ“IÁegr™y
(
p
);

54950 ifÐ
	gp
->
	gšT¿ns
==
TRANS_WRITE
 || (
p
->
šT¿ns
==
TRANS_READ
 && !
wræag
) ){

54951 
Œªs_begun
;

54953 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 || 
IfNÙOm™AV
ÕBt->
bDoTrunÿ‹
)==0 );

54956 ifÐ(
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_READ_ONLY
)!=0 && 
wræag
 ){

54957 
rc
 = 
SQLITE_READONLY
;

54958 
	gŒªs_begun
;

54961 #iâdeà
SQLITE_OMIT_SHARED_CACHE


54966 ifÐ(
	gwræag
 && 
	gpBt
->
	gšT¿n§ùiÚ
==
TRANS_WRITE
)

54967 || (
pBt
->
btsFÏgs
 & 
BTS_PENDING
)!=0

54969 
pBlock
 = 
pBt
->
pWr™”
->
db
;

54970 }ifÐ
	gwræag
>1 ){

54971 
BtLock
 *
	gpI‹r
;

54972 
	gpI‹r
=
pBt
->
pLock
;…I‹r;…I‹r=
pI‹r
->
pNext
){

54973 ifÐ
pI‹r
->
pBŒ“
!=
p
 ){

54974 
pBlock
 = 
pI‹r
->
pBŒ“
->
db
;

54979 ifÐ
	gpBlock
 ){

54980 
sql™e3CÚÃùiÚBlocked
(
p
->
db
, 
pBlock
);

54981 
	grc
 = 
SQLITE_LOCKED_SHAREDCACHE
;

54982 
	gŒªs_begun
;

54989 
	grc
 = 
qu”ySh¬edCacheTabËLock
(
p
, 
MASTER_ROOT
, 
READ_LOCK
);

54990 ifÐ
	gSQLITE_OK
!=
rc
 ) 
Œªs_begun
;

54992 
	gpBt
->
	gbtsFÏgs
 &ð~
BTS_INITIALLY_EMPTY
;

54993 ifÐ
	gpBt
->
	gnPage
==0 ) 
pBt
->
btsFÏgs
 |ð
BTS_INITIALLY_EMPTY
;

55002  
	gpBt
->
	gpPage1
==0 && 
SQLITE_OK
==(
rc
 = 
lockBŒ“
(
pBt
)) );

55004 ifÐ
	grc
==
SQLITE_OK
 && 
wræag
 ){

55005 ifÐ(
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)!=0 ){

55006 
rc
 = 
SQLITE_READONLY
;

55008 
	grc
 = 
sql™e3Pag”Begš
(
pBt
->
pPag”
,
wræag
>1,
sql™e3TempInMemÜy
(
p
->
db
));

55009 ifÐ
	grc
==
SQLITE_OK
 ){

55010 
rc
 = 
ÃwD©aba£
(
pBt
);

55015 ifÐ
	grc
!=
SQLITE_OK
 ){

55016 
uÆockBŒ“IfUnu£d
(
pBt
);

55018 } (
	grc
&0xFF)==
SQLITE_BUSY
 && 
pBt
->
šT¿n§ùiÚ
==
TRANS_NONE
 &&

55019 
bŒ“InvokeBusyHªdËr
(
pBt
) );

55021 ifÐ
	grc
==
SQLITE_OK
 ){

55022 ifÐ
p
->
šT¿ns
==
TRANS_NONE
 ){

55023 
pBt
->
nT¿n§ùiÚ
++;

55024 #iâdeà
SQLITE_OMIT_SHARED_CACHE


55025 ifÐ
	gp
->
	gsh¬abË
 ){

55026 
as£¹
Ð
p
->
lock
.
pBŒ“
=õ &&…->lock.
iTabË
==1 );

55027 
	gp
->
	glock
.
	geLock
 = 
READ_LOCK
;

55028 
	gp
->
	glock
.
	gpNext
 = 
pBt
->
pLock
;

55029 
	gpBt
->
	gpLock
 = &
p
->
lock
;

55033 
	gp
->
	gšT¿ns
 = (
wræag
?
TRANS_WRITE
:
TRANS_READ
);

55034 ifÐ
	gp
->
	gšT¿ns
>
	gpBt
->
	gšT¿n§ùiÚ
 ){

55035 
	gpBt
->
	gšT¿n§ùiÚ
 = 
p
->
šT¿ns
;

55037 ifÐ
	gwræag
 ){

55038 
MemPage
 *
	gpPage1
 = 
pBt
->
pPage1
;

55039 #iâdeà
SQLITE_OMIT_SHARED_CACHE


55040 
as£¹
Ð!
pBt
->
pWr™”
 );

55041 
	gpBt
->
	gpWr™”
 = 
p
;

55042 
	gpBt
->
	gbtsFÏgs
 &ð~
BTS_EXCLUSIVE
;

55043 ifÐ
	gwræag
>1 ) 
	gpBt
->
	gbtsFÏgs
 |ð
BTS_EXCLUSIVE
;

55052 ifÐ
	gpBt
->
	gnPage
!=
g‘4by‹
(&
pPage1
->
aD©a
[28]) ){

55053 
rc
 = 
sql™e3Pag”Wr™e
(
pPage1
->
pDbPage
);

55054 ifÐ
	grc
==
SQLITE_OK
 ){

55055 
put4by‹
(&
pPage1
->
aD©a
[28], 
pBt
->
nPage
);

55062 
	gŒªs_begun
:

55063 ifÐ
rc
==
SQLITE_OK
 && 
wræag
 ){

55068 
rc
 = 
sql™e3Pag”O³nSav•ošt
(
pBt
->
pPag”
, 
p
->
db
->
nSav•ošt
);

55071 
bŒ“IÁegr™y
(
p
);

55072 
sql™e3BŒ“L—ve
(
p
);

55073  
	grc
;

55076 #iâdeà
SQLITE_OMIT_AUTOVACUUM


55083 
£tChždPŒm­s
(
MemPage
 *
pPage
){

55084 
	gi
;

55085 
	gnC–l
;

55086 
	grc
;

55087 
BtSh¬ed
 *
	gpBt
 = 
pPage
->
pBt
;

55088 
u8
 
	gisIn™Orig
 = 
pPage
->
isIn™
;

55089 
Pgno
 
	gpgno
 = 
pPage
->
pgno
;

55091 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

55092 
	grc
 = 
bŒ“In™Page
(
pPage
);

55093 ifÐ
	grc
!=
SQLITE_OK
 ){

55094 
£t_chžd_±rm­s_out
;

55096 
	gnC–l
 = 
pPage
->
nC–l
;

55098 
	gi
=0; i<
	gnC–l
; i++){

55099 
u8
 *
	gpC–l
 = 
fšdC–l
(
pPage
, 
i
);

55101 
±rm­PutOvæPŒ
(
pPage
, 
pC–l
, &
rc
);

55103 ifÐ!
	gpPage
->
	gËaf
 ){

55104 
Pgno
 
	gchždPgno
 = 
g‘4by‹
(
pC–l
);

55105 
±rm­Put
(
pBt
, 
chždPgno
, 
PTRMAP_BTREE
, 
pgno
, &
rc
);

55109 ifÐ!
	gpPage
->
	gËaf
 ){

55110 
Pgno
 
	gchždPgno
 = 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]);

55111 
±rm­Put
(
pBt
, 
chždPgno
, 
PTRMAP_BTREE
, 
pgno
, &
rc
);

55114 
	g£t_chžd_±rm­s_out
:

55115 
pPage
->
isIn™
 = 
isIn™Orig
;

55116  
	grc
;

55133 
modifyPagePoš‹r
(
MemPage
 *
pPage
, 
Pgno
 
iFrom
, PgnØ
iTo
, 
u8
 
eTy³
){

55134 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

55135 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

55136 ifÐ
	geTy³
==
PTRMAP_OVERFLOW2
 ){

55138 ifÐ
g‘4by‹
(
pPage
->
aD©a
)!=
iFrom
 ){

55139  
SQLITE_CORRUPT_BKPT
;

55141 
put4by‹
(
pPage
->
aD©a
, 
iTo
);

55143 
u8
 
	gisIn™Orig
 = 
pPage
->
isIn™
;

55144 
	gi
;

55145 
	gnC–l
;

55147 
bŒ“In™Page
(
pPage
);

55148 
	gnC–l
 = 
pPage
->
nC–l
;

55150 
	gi
=0; i<
	gnC–l
; i++){

55151 
u8
 *
	gpC–l
 = 
fšdC–l
(
pPage
, 
i
);

55152 ifÐ
	geTy³
==
PTRMAP_OVERFLOW1
 ){

55153 
C–lInfo
 
šfo
;

55154 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
šfo
);

55155 ifÐ
	gšfo
.
	giOv”æow


55156 && 
	gpC–l
+
	gšfo
.
	giOv”æow
+3<=
pPage
->
aD©a
+pPage->
maskPage


55157 && 
iFrom
==
g‘4by‹
(&
pC–l
[
šfo
.
iOv”æow
])

55159 
put4by‹
(&
pC–l
[
šfo
.
iOv”æow
], 
iTo
);

55163 ifÐ
g‘4by‹
(
pC–l
)==
iFrom
 ){

55164 
put4by‹
(
pC–l
, 
iTo
);

55170 ifÐ
	gi
==
nC–l
 ){

55171 ifÐ
eTy³
!=
PTRMAP_BTREE
 ||

55172 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8])!=
iFrom
 ){

55173  
SQLITE_CORRUPT_BKPT
;

55175 
put4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8], 
iTo
);

55178 
	gpPage
->
	gisIn™
 = 
isIn™Orig
;

55180  
	gSQLITE_OK
;

55193 
»loÿ‹Page
(

55194 
BtSh¬ed
 *
pBt
,

55195 
MemPage
 *
pDbPage
,

55196 
u8
 
eTy³
,

55197 
Pgno
 
iPŒPage
,

55198 
Pgno
 
iF»ePage
,

55199 
isComm™


55201 
MemPage
 *
	gpPŒPage
;

55202 
Pgno
 
	giDbPage
 = 
pDbPage
->
pgno
;

55203 
Pag”
 *
	gpPag”
 = 
pBt
->
pPag”
;

55204 
	grc
;

55206 
as£¹
Ð
eTy³
==
PTRMAP_OVERFLOW2
 ||ƒTy³==
PTRMAP_OVERFLOW1
 ||

55207 
eTy³
==
PTRMAP_BTREE
 ||ƒTy³==
PTRMAP_ROOTPAGE
 );

55208 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

55209 
as£¹
Ð
pDbPage
->
pBt
==pBt );

55212 
TRACE
(("AUTOVACUUM: Moving %do free…age %d (ptr…age %dype %d)\n",

55213 
iDbPage
, 
iF»ePage
, 
iPŒPage
, 
eTy³
));

55214 
	grc
 = 
sql™e3Pag”Mov•age
(
pPag”
, 
pDbPage
->pDbPage, 
iF»ePage
, 
isComm™
);

55215 ifÐ
	grc
!=
SQLITE_OK
 ){

55216  
rc
;

55218 
	gpDbPage
->
	gpgno
 = 
iF»ePage
;

55228 ifÐ
	geTy³
==
PTRMAP_BTREE
 || 
eTy³
==
PTRMAP_ROOTPAGE
 ){

55229 
rc
 = 
£tChždPŒm­s
(
pDbPage
);

55230 ifÐ
	grc
!=
SQLITE_OK
 ){

55231  
rc
;

55234 
Pgno
 
	gÃxtOvæ
 = 
g‘4by‹
(
pDbPage
->
aD©a
);

55235 ifÐ
	gÃxtOvæ
!=0 ){

55236 
±rm­Put
(
pBt
, 
ÃxtOvæ
, 
PTRMAP_OVERFLOW2
, 
iF»ePage
, &
rc
);

55237 ifÐ
	grc
!=
SQLITE_OK
 ){

55238  
rc
;

55247 ifÐ
	geTy³
!=
PTRMAP_ROOTPAGE
 ){

55248 
rc
 = 
bŒ“G‘Page
(
pBt
, 
iPŒPage
, &
pPŒPage
, 0);

55249 ifÐ
	grc
!=
SQLITE_OK
 ){

55250  
rc
;

55252 
	grc
 = 
sql™e3Pag”Wr™e
(
pPŒPage
->
pDbPage
);

55253 ifÐ
	grc
!=
SQLITE_OK
 ){

55254 
»Ëa£Page
(
pPŒPage
);

55255  
	grc
;

55257 
	grc
 = 
modifyPagePoš‹r
(
pPŒPage
, 
iDbPage
, 
iF»ePage
, 
eTy³
);

55258 
»Ëa£Page
(
pPŒPage
);

55259 ifÐ
	grc
==
SQLITE_OK
 ){

55260 
±rm­Put
(
pBt
, 
iF»ePage
, 
eTy³
, 
iPŒPage
, &
rc
);

55263  
	grc
;

55267 
®loÿ‹BŒ“Page
(
BtSh¬ed
 *, 
MemPage
 **, 
Pgno
 *, Pgno, 
u8
);

55286 
šüVacuumS‹p
(
BtSh¬ed
 *
pBt
, 
Pgno
 
nFš
, PgnØ
iLa¡Pg
, 
bComm™
){

55287 
Pgno
 
	gnF»eLi¡
;

55288 
	grc
;

55290 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

55291 
as£¹
Ð
iLa¡Pg
>
nFš
 );

55293 ifÐ!
PTRMAP_ISPAGE
(
pBt
, 
iLa¡Pg
è&& 
	giLa¡Pg
!=
PENDING_BYTE_PAGE
(pBt) ){

55294 
u8
 
eTy³
;

55295 
Pgno
 
	giPŒPage
;

55297 
	gnF»eLi¡
 = 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[36]);

55298 ifÐ
	gnF»eLi¡
==0 ){

55299  
SQLITE_DONE
;

55302 
	grc
 = 
±rm­G‘
(
pBt
, 
iLa¡Pg
, &
eTy³
, &
iPŒPage
);

55303 ifÐ
	grc
!=
SQLITE_OK
 ){

55304  
rc
;

55306 ifÐ
	geTy³
==
PTRMAP_ROOTPAGE
 ){

55307  
SQLITE_CORRUPT_BKPT
;

55310 ifÐ
	geTy³
==
PTRMAP_FREEPAGE
 ){

55311 ifÐ
bComm™
==0 ){

55317 
Pgno
 
iF»ePg
;

55318 
MemPage
 *
	gpF»ePg
;

55319 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pF»ePg
, &
iF»ePg
, 
iLa¡Pg
, 
BTALLOC_EXACT
);

55320 ifÐ
	grc
!=
SQLITE_OK
 ){

55321  
rc
;

55323 
as£¹
Ð
iF»ePg
==
iLa¡Pg
 );

55324 
»Ëa£Page
(
pF»ePg
);

55327 
Pgno
 
	giF»ePg
;

55328 
MemPage
 *
	gpLa¡Pg
;

55329 
u8
 
	geMode
 = 
BTALLOC_ANY
;

55330 
Pgno
 
	giN—r
 = 0;

55332 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
iLa¡Pg
, &
pLa¡Pg
, 0);

55333 ifÐ
	grc
!=
SQLITE_OK
 ){

55334  
rc
;

55344 ifÐ
	gbComm™
==0 ){

55345 
eMode
 = 
BTALLOC_LE
;

55346 
	giN—r
 = 
nFš
;

55349 
MemPage
 *
	gpF»ePg
;

55350 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pF»ePg
, &
iF»ePg
, 
iN—r
, 
eMode
);

55351 ifÐ
	grc
!=
SQLITE_OK
 ){

55352 
»Ëa£Page
(
pLa¡Pg
);

55353  
	grc
;

55355 
»Ëa£Page
(
pF»ePg
);

55356 } 
	gbComm™
 && 
	giF»ePg
>
	gnFš
 );

55357 
as£¹
Ð
iF»ePg
<
iLa¡Pg
 );

55359 
	grc
 = 
»loÿ‹Page
(
pBt
, 
pLa¡Pg
, 
eTy³
, 
iPŒPage
, 
iF»ePg
, 
bComm™
);

55360 
»Ëa£Page
(
pLa¡Pg
);

55361 ifÐ
	grc
!=
SQLITE_OK
 ){

55362  
rc
;

55367 ifÐ
	gbComm™
==0 ){

55369 
iLa¡Pg
--;

55370 } 
	giLa¡Pg
==
PENDING_BYTE_PAGE
(
pBt
è|| 
PTRMAP_ISPAGE
ÕBt, 
iLa¡Pg
) );

55371 
	gpBt
->
	gbDoTrunÿ‹
 = 1;

55372 
	gpBt
->
	gnPage
 = 
iLa¡Pg
;

55374  
	gSQLITE_OK
;

55382 
Pgno
 
fš®DbSize
(
BtSh¬ed
 *
pBt
, PgnØ
nOrig
, PgnØ
nF»e
){

55383 
	gnEÁry
;

55384 
Pgno
 
	gnPŒm­
;

55385 
Pgno
 
	gnFš
;

55387 
	gnEÁry
 = 
pBt
->
u§bËSize
/5;

55388 
	gnPŒm­
 = (
nF»e
-
nOrig
+
PTRMAP_PAGENO
(
pBt
,‚Orig)+
	gnEÁry
)/nEntry;

55389 
	gnFš
 = 
nOrig
 - 
nF»e
 - 
nPŒm­
;

55390 ifÐ
	gnOrig
>
PENDING_BYTE_PAGE
(
pBt
è&& 
	gnFš
<PENDING_BYTE_PAGE(pBt) ){

55391 
	gnFš
--;

55393  
PTRMAP_ISPAGE
(
pBt
, 
nFš
è|| 
	gnFš
==
PENDING_BYTE_PAGE
(pBt) ){

55394 
nFš
--;

55397  
	gnFš
;

55408 
SQLITE_PRIVATE
 
sql™e3BŒ“InüVacuum
(
BŒ“
 *
p
){

55409 
	grc
;

55410 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55412 
sql™e3BŒ“EÁ”
(
p
);

55413 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 && 
p
->
šT¿ns
==TRANS_WRITE );

55414 ifÐ!
	gpBt
->
	gautoVacuum
 ){

55415 
	grc
 = 
SQLITE_DONE
;

55417 
Pgno
 
	gnOrig
 = 
bŒ“PagecouÁ
(
pBt
);

55418 
Pgno
 
	gnF»e
 = 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[36]);

55419 
Pgno
 
	gnFš
 = 
fš®DbSize
(
pBt
, 
nOrig
, 
nF»e
);

55421 ifÐ
	gnOrig
<
	gnFš
 ){

55422 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

55423 }ifÐ
	gnF»e
>0 ){

55424 
	grc
 = 
§veAÎCursÜs
(
pBt
, 0, 0);

55425 ifÐ
	grc
==
SQLITE_OK
 ){

55426 
šv®id©eAÎOv”æowCache
(
pBt
);

55427 
	grc
 = 
šüVacuumS‹p
(
pBt
, 
nFš
, 
nOrig
, 0);

55429 ifÐ
	grc
==
SQLITE_OK
 ){

55430 
rc
 = 
sql™e3Pag”Wr™e
(
pBt
->
pPage1
->
pDbPage
);

55431 
put4by‹
(&
pBt
->
pPage1
->
aD©a
[28],…Bt->
nPage
);

55434 
	grc
 = 
SQLITE_DONE
;

55437 
sql™e3BŒ“L—ve
(
p
);

55438  
	grc
;

55450 
autoVacuumComm™
(
BtSh¬ed
 *
pBt
){

55451 
	grc
 = 
SQLITE_OK
;

55452 
Pag”
 *
	gpPag”
 = 
pBt
->
pPag”
;

55453 
VVA_ONLY
Ð
nRef
 = 
sql™e3Pag”RefcouÁ
(
pPag”
) );

55455 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

55456 
šv®id©eAÎOv”æowCache
(
pBt
);

55457 
as£¹
(
pBt
->
autoVacuum
);

55458 ifÐ!
	gpBt
->
	gšüVacuum
 ){

55459 
Pgno
 
	gnFš
;

55460 
Pgno
 
	gnF»e
;

55461 
Pgno
 
	giF»e
;

55462 
Pgno
 
	gnOrig
;

55464 
	gnOrig
 = 
bŒ“PagecouÁ
(
pBt
);

55465 ifÐ
PTRMAP_ISPAGE
(
pBt
, 
nOrig
è|| 
	gnOrig
==
PENDING_BYTE_PAGE
(pBt) ){

55470  
SQLITE_CORRUPT_BKPT
;

55473 
	gnF»e
 = 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[36]);

55474 
	gnFš
 = 
fš®DbSize
(
pBt
, 
nOrig
, 
nF»e
);

55475 ifÐ
	gnFš
>
	gnOrig
 )  
	gSQLITE_CORRUPT_BKPT
;

55476 ifÐ
	gnFš
<
	gnOrig
 ){

55477 
	grc
 = 
§veAÎCursÜs
(
pBt
, 0, 0);

55479 
	giF»e
=
nOrig
; iF»e>
	gnFš
 && 
	grc
==
SQLITE_OK
; iFree--){

55480 
	grc
 = 
šüVacuumS‹p
(
pBt
, 
nFš
, 
iF»e
, 1);

55482 ifÐ(
	grc
==
SQLITE_DONE
 || 
rc
==
SQLITE_OK
è&& 
nF»e
>0 ){

55483 
rc
 = 
sql™e3Pag”Wr™e
(
pBt
->
pPage1
->
pDbPage
);

55484 
put4by‹
(&
pBt
->
pPage1
->
aD©a
[32], 0);

55485 
put4by‹
(&
pBt
->
pPage1
->
aD©a
[36], 0);

55486 
put4by‹
(&
pBt
->
pPage1
->
aD©a
[28], 
nFš
);

55487 
	gpBt
->
	gbDoTrunÿ‹
 = 1;

55488 
	gpBt
->
	gnPage
 = 
nFš
;

55490 ifÐ
	grc
!=
SQLITE_OK
 ){

55491 
sql™e3Pag”RÞlback
(
pPag”
);

55495 
as£¹
Ð
nRef
>=
sql™e3Pag”RefcouÁ
(
pPag”
) );

55496  
	grc
;

55500 
	#£tChždPŒm­s
(
x
è
SQLITE_OK


	)

55529 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™Pha£OÃ
(
BŒ“
 *
p
, cÚ¡ *
zMa¡”
){

55530 
	grc
 = 
SQLITE_OK
;

55531 ifÐ
	gp
->
	gšT¿ns
==
TRANS_WRITE
 ){

55532 
BtSh¬ed
 *
pBt
 = 
p
->pBt;

55533 
sql™e3BŒ“EÁ”
(
p
);

55534 #iâdeà
SQLITE_OMIT_AUTOVACUUM


55535 ifÐ
	gpBt
->
	gautoVacuum
 ){

55536 
	grc
 = 
autoVacuumComm™
(
pBt
);

55537 ifÐ
	grc
!=
SQLITE_OK
 ){

55538 
sql™e3BŒ“L—ve
(
p
);

55539  
	grc
;

55542 ifÐ
	gpBt
->
	gbDoTrunÿ‹
 ){

55543 
sql™e3Pag”Trunÿ‹Image
(
pBt
->
pPag”
,…Bt->
nPage
);

55546 
	grc
 = 
sql™e3Pag”Comm™Pha£OÃ
(
pBt
->
pPag”
, 
zMa¡”
, 0);

55547 
sql™e3BŒ“L—ve
(
p
);

55549  
	grc
;

55556 
bŒ“EndT¿n§ùiÚ
(
BŒ“
 *
p
){

55557 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55558 
sql™e3
 *
	gdb
 = 
p
->
db
;

55559 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

55561 #iâdeà
SQLITE_OMIT_AUTOVACUUM


55562 
	gpBt
->
	gbDoTrunÿ‹
 = 0;

55564 ifÐ
	gp
->
	gšT¿ns
>
	gTRANS_NONE
 && 
	gdb
->
	gnVdbeR—d
>1 ){

55568 
downg¿deAÎSh¬edCacheTabËLocks
(
p
);

55569 
	gp
->
	gšT¿ns
 = 
TRANS_READ
;

55575 ifÐ
	gp
->
	gšT¿ns
!=
TRANS_NONE
 ){

55576 
þ—rAÎSh¬edCacheTabËLocks
(
p
);

55577 
	gpBt
->
	gnT¿n§ùiÚ
--;

55578 ifÐ0==
pBt
->
nT¿n§ùiÚ
 ){

55579 
pBt
->
šT¿n§ùiÚ
 = 
TRANS_NONE
;

55585 
	gp
->
	gšT¿ns
 = 
TRANS_NONE
;

55586 
uÆockBŒ“IfUnu£d
(
pBt
);

55589 
bŒ“IÁegr™y
(
p
);

55618 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™Pha£Two
(
BŒ“
 *
p
, 
bCËªup
){

55620 ifÐ
	gp
->
	gšT¿ns
==
TRANS_NONE
 )  
SQLITE_OK
;

55621 
sql™e3BŒ“EÁ”
(
p
);

55622 
bŒ“IÁegr™y
(
p
);

55627 ifÐ
	gp
->
	gšT¿ns
==
TRANS_WRITE
 ){

55628 
rc
;

55629 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55630 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

55631 
as£¹
Ð
pBt
->
nT¿n§ùiÚ
>0 );

55632 
	grc
 = 
sql™e3Pag”Comm™Pha£Two
(
pBt
->
pPag”
);

55633 ifÐ
	grc
!=
SQLITE_OK
 && 
bCËªup
==0 ){

55634 
sql™e3BŒ“L—ve
(
p
);

55635  
	grc
;

55637 
	gpBt
->
	gšT¿n§ùiÚ
 = 
TRANS_READ
;

55638 
bŒ“CË¬HasCÚ‹Á
(
pBt
);

55641 
bŒ“EndT¿n§ùiÚ
(
p
);

55642 
sql™e3BŒ“L—ve
(
p
);

55643  
	gSQLITE_OK
;

55649 
SQLITE_PRIVATE
 
sql™e3BŒ“Comm™
(
BŒ“
 *
p
){

55650 
	grc
;

55651 
sql™e3BŒ“EÁ”
(
p
);

55652 
	grc
 = 
sql™e3BŒ“Comm™Pha£OÃ
(
p
, 0);

55653 ifÐ
	grc
==
SQLITE_OK
 ){

55654 
rc
 = 
sql™e3BŒ“Comm™Pha£Two
(
p
, 0);

55656 
sql™e3BŒ“L—ve
(
p
);

55657  
	grc
;

55686 
SQLITE_PRIVATE
 
sql™e3BŒ“TrAÎCursÜs
(
BŒ“
 *
pBŒ“
, 
”rCode
, 
wr™eOÆy
){

55687 
BtCursÜ
 *
	gp
;

55688 
	grc
 = 
SQLITE_OK
;

55690 
as£¹
Ð(
wr™eOÆy
==0 || wr™eOÆy==1è&& 
BTCF_Wr™eFÏg
==1 );

55691 ifÐ
	gpBŒ“
 ){

55692 
sql™e3BŒ“EÁ”
(
pBŒ“
);

55693 
	gp
=
pBŒ“
->
pBt
->
pCursÜ
;…;…=
p
->
pNext
){

55694 
i
;

55695 ifÐ
	gwr™eOÆy
 && (
	gp
->
	gcurFÏgs
 & 
	gBTCF_Wr™eFÏg
)==0 ){

55696 ifÐ
p
->
eS‹
==
CURSOR_VALID
 ){

55697 
rc
 = 
§veCursÜPos™iÚ
(
p
);

55698 ifÐ
	grc
!=
SQLITE_OK
 ){

55699 ()
sql™e3BŒ“TrAÎCursÜs
(
pBŒ“
, 
rc
, 0);

55704 
sql™e3BŒ“CË¬CursÜ
(
p
);

55705 
	gp
->
	geS‹
 = 
CURSOR_FAULT
;

55706 
	gp
->
	gskNext
 = 
”rCode
;

55708 
	gi
=0; i<=
p
->
iPage
; i++){

55709 
»Ëa£Page
(
p
->
­Page
[
i
]);

55710 
	gp
->
	g­Page
[
i
] = 0;

55713 
sql™e3BŒ“L—ve
(
pBŒ“
);

55715  
	grc
;

55729 
SQLITE_PRIVATE
 
sql™e3BŒ“RÞlback
(
BŒ“
 *
p
, 
ŒCode
, 
wr™eOÆy
){

55730 
	grc
;

55731 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55732 
MemPage
 *
	gpPage1
;

55734 
as£¹
Ð
wr™eOÆy
==1 || writeOnly==0 );

55735 
as£¹
Ð
ŒCode
==
SQLITE_ABORT_ROLLBACK
 ||rCode==
SQLITE_OK
 );

55736 
sql™e3BŒ“EÁ”
(
p
);

55737 ifÐ
	gŒCode
==
SQLITE_OK
 ){

55738 
rc
 = 
ŒCode
 = 
§veAÎCursÜs
(
pBt
, 0, 0);

55739 ifÐ
	grc
 ) 
	gwr™eOÆy
 = 0;

55741 
	grc
 = 
SQLITE_OK
;

55743 ifÐ
	gŒCode
 ){

55744 
	grc2
 = 
sql™e3BŒ“TrAÎCursÜs
(
p
, 
ŒCode
, 
wr™eOÆy
);

55745 
as£¹
Ð
rc
==
SQLITE_OK
 || (
wr™eOÆy
==0 && 
rc2
==SQLITE_OK) );

55746 ifÐ
	grc2
!=
SQLITE_OK
 ) 
rc
 = 
rc2
;

55748 
bŒ“IÁegr™y
(
p
);

55750 ifÐ
	gp
->
	gšT¿ns
==
TRANS_WRITE
 ){

55751 
rc2
;

55753 
as£¹
Ð
TRANS_WRITE
==
pBt
->
šT¿n§ùiÚ
 );

55754 
	grc2
 = 
sql™e3Pag”RÞlback
(
pBt
->
pPag”
);

55755 ifÐ
	grc2
!=
SQLITE_OK
 ){

55756 
rc
 = 
rc2
;

55762 ifÐ
bŒ“G‘Page
(
pBt
, 1, &
pPage1
, 0)==
SQLITE_OK
 ){

55763 
nPage
 = 
g‘4by‹
(28+(
u8
*)
pPage1
->
aD©a
);

55764 
‹¡ÿ£
Ð
nPage
==0 );

55765 ifÐ
	gnPage
==0 ) 
sql™e3Pag”PagecouÁ
(
pBt
->
pPag”
, &
nPage
);

55766 
‹¡ÿ£
Ð
pBt
->
nPage
!=nPage );

55767 
	gpBt
->
	gnPage
 = 
nPage
;

55768 
»Ëa£Page
(
pPage1
);

55770 
as£¹
Ð
couÁV®idCursÜs
(
pBt
, 1)==0 );

55771 
	gpBt
->
	gšT¿n§ùiÚ
 = 
TRANS_READ
;

55772 
bŒ“CË¬HasCÚ‹Á
(
pBt
);

55775 
bŒ“EndT¿n§ùiÚ
(
p
);

55776 
sql™e3BŒ“L—ve
(
p
);

55777  
	grc
;

55798 
SQLITE_PRIVATE
 
sql™e3BŒ“BegšStmt
(
BŒ“
 *
p
, 
iS‹m’t
){

55799 
	grc
;

55800 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55801 
sql™e3BŒ“EÁ”
(
p
);

55802 
as£¹
Ð
p
->
šT¿ns
==
TRANS_WRITE
 );

55803 
as£¹
Ð(
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)==0 );

55804 
as£¹
Ð
iS‹m’t
>0 );

55805 
as£¹
Ð
iS‹m’t
>
p
->
db
->
nSav•ošt
 );

55806 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

55812 
	grc
 = 
sql™e3Pag”O³nSav•ošt
(
pBt
->
pPag”
, 
iS‹m’t
);

55813 
sql™e3BŒ“L—ve
(
p
);

55814  
	grc
;

55829 
SQLITE_PRIVATE
 
sql™e3BŒ“Sav•ošt
(
BŒ“
 *
p
, 
Ý
, 
iSav•ošt
){

55830 
	grc
 = 
SQLITE_OK
;

55831 ifÐ
	gp
 &&…->
	gšT¿ns
==
TRANS_WRITE
 ){

55832 
BtSh¬ed
 *
pBt
 = 
p
->pBt;

55833 
as£¹
Ð
Ý
==
SAVEPOINT_RELEASE
 || op==
SAVEPOINT_ROLLBACK
 );

55834 
as£¹
Ð
iSav•ošt
>=0 || (iSav•ošt==-1 && 
Ý
==
SAVEPOINT_ROLLBACK
) );

55835 
sql™e3BŒ“EÁ”
(
p
);

55836 
	grc
 = 
sql™e3Pag”Sav•ošt
(
pBt
->
pPag”
, 
Ý
, 
iSav•ošt
);

55837 ifÐ
	grc
==
SQLITE_OK
 ){

55838 ifÐ
iSav•ošt
<0 && (
pBt
->
btsFÏgs
 & 
BTS_INITIALLY_EMPTY
)!=0 ){

55839 
pBt
->
nPage
 = 0;

55841 
	grc
 = 
ÃwD©aba£
(
pBt
);

55842 
	gpBt
->
	gnPage
 = 
g‘4by‹
(28 + 
pBt
->
pPage1
->
aD©a
);

55847 
as£¹
Ð
pBt
->
nPage
>0 );

55849 
sql™e3BŒ“L—ve
(
p
);

55851  
	grc
;

55886 
bŒ“CursÜ
(

55887 
BŒ“
 *
p
,

55888 
iTabË
,

55889 
wrFÏg
,

55890 
KeyInfo
 *
pKeyInfo
,

55891 
BtCursÜ
 *
pCur


55893 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

55895 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

55896 
as£¹
Ð
wrFÏg
==0 || wrFlag==1 );

55902 
as£¹
Ð
hasSh¬edCacheTabËLock
(
p
, 
iTabË
, 
pKeyInfo
!=0, 
wrFÏg
+1) );

55903 
as£¹
Ð
wrFÏg
==0 || !
hasR—dCÚæiùs
(
p
, 
iTabË
) );

55906 
as£¹
Ð
p
->
šT¿ns
>
TRANS_NONE
 );

55907 
as£¹
Ð
wrFÏg
==0 || 
p
->
šT¿ns
==
TRANS_WRITE
 );

55908 
as£¹
Ð
pBt
->
pPage1
 &&…Bt->pPage1->
aD©a
 );

55910 ifÐ
NEVER
(
wrFÏg
 && (
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)!=0) ){

55911  
SQLITE_READONLY
;

55913 ifÐ
	gwrFÏg
 ){

55914 
®loÿ‹TempS·û
(
pBt
);

55915 ifÐ
	gpBt
->
	gpTmpS·û
==0 )  
SQLITE_NOMEM
;

55917 ifÐ
	giTabË
==1 && 
bŒ“PagecouÁ
(
pBt
)==0 ){

55918 
as£¹
Ð
wrFÏg
==0 );

55919 
	giTabË
 = 0;

55924 
	gpCur
->
	gpgnoRoÙ
 = (
Pgno
)
iTabË
;

55925 
	gpCur
->
	giPage
 = -1;

55926 
	gpCur
->
	gpKeyInfo
 = 
pKeyInfo
;

55927 
	gpCur
->
	gpBŒ“
 = 
p
;

55928 
	gpCur
->
	gpBt
 = 
pBt
;

55929 
as£¹
Ð
wrFÏg
==0 || wrFÏg==
BTCF_Wr™eFÏg
 );

55930 
	gpCur
->
	gcurFÏgs
 = 
wrFÏg
;

55931 
	gpCur
->
	gpNext
 = 
pBt
->
pCursÜ
;

55932 ifÐ
	gpCur
->
	gpNext
 ){

55933 
	gpCur
->
	gpNext
->
	gpP»v
 = 
pCur
;

55935 
	gpBt
->
	gpCursÜ
 = 
pCur
;

55936 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

55937  
	gSQLITE_OK
;

55939 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜ
(

55940 
BŒ“
 *
p
,

55941 
iTabË
,

55942 
wrFÏg
,

55943 
KeyInfo
 *
pKeyInfo
,

55944 
BtCursÜ
 *
pCur


55946 
	grc
;

55947 
sql™e3BŒ“EÁ”
(
p
);

55948 
	grc
 = 
bŒ“CursÜ
(
p
, 
iTabË
, 
wrFÏg
, 
pKeyInfo
, 
pCur
);

55949 
sql™e3BŒ“L—ve
(
p
);

55950  
	grc
;

55961 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜSize
(){

55962  
ROUND8
((
BtCursÜ
));

55973 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜZ”o
(
BtCursÜ
 *
p
){

55974 
mem£t
(
p
, 0, 
off£tof
(
BtCursÜ
, 
iPage
));

55981 
SQLITE_PRIVATE
 
sql™e3BŒ“Clo£CursÜ
(
BtCursÜ
 *
pCur
){

55982 
BŒ“
 *
	gpBŒ“
 = 
pCur
->
pBŒ“
;

55983 ifÐ
	gpBŒ“
 ){

55984 
	gi
;

55985 
BtSh¬ed
 *
	gpBt
 = 
pCur
->
pBt
;

55986 
sql™e3BŒ“EÁ”
(
pBŒ“
);

55987 
sql™e3BŒ“CË¬CursÜ
(
pCur
);

55988 ifÐ
	gpCur
->
	gpP»v
 ){

55989 
	gpCur
->
	gpP»v
->
	gpNext
 = 
pCur
->
pNext
;

55991 
	gpBt
->
	gpCursÜ
 = 
pCur
->
pNext
;

55993 ifÐ
	gpCur
->
	gpNext
 ){

55994 
	gpCur
->
	gpNext
->
	gpP»v
 = 
pCur
->
pP»v
;

55996 
	gi
=0; i<=
pCur
->
iPage
; i++){

55997 
»Ëa£Page
(
pCur
->
­Page
[
i
]);

55999 
uÆockBŒ“IfUnu£d
(
pBt
);

56000 
sql™e3DbF»e
(
pBŒ“
->
db
, 
pCur
->
aOv”æow
);

56002 
sql™e3BŒ“L—ve
(
pBŒ“
);

56004  
	gSQLITE_OK
;

56022 #iâdeà
NDEBUG


56023 
as£¹C–lInfo
(
BtCursÜ
 *
pCur
){

56024 
C–lInfo
 
	gšfo
;

56025 
	giPage
 = 
pCur
->
iPage
;

56026 
mem£t
(&
šfo
, 0, (info));

56027 
bŒ“P¬£C–l
(
pCur
->
­Page
[
iPage
],…Cur->
aiIdx
[iPage], &
šfo
);

56028 
as£¹
Ð
CORRUPT_DB
 || 
memcmp
(&
šfo
, &
pCur
->info, (info))==0 );

56031 
	#as£¹C–lInfo
(
x
)

	)

56033 #ifdeà
_MSC_VER


56035 
g‘C–lInfo
(
BtCursÜ
 *
pCur
){

56036 ifÐ
	gpCur
->
	gšfo
.
	gnSize
==0 ){

56037 
iPage
 = 
pCur
->iPage;

56038 
bŒ“P¬£C–l
(
pCur
->
­Page
[
iPage
],pCur->
aiIdx
[iPage],&pCur->
šfo
);

56039 
	gpCur
->
	gcurFÏgs
 |ð
BTCF_V®idNKey
;

56041 
as£¹C–lInfo
(
pCur
);

56046 
	#g‘C–lInfo
(
pCur
) \

56047 ifÐ
pCur
->
šfo
.
nSize
==0 ){ \

56048 
iPage
 = 
pCur
->iPage; \

56049 
	`bŒ“P¬£C–l
(
pCur
->
­Page
[
iPage
],pCur->
aiIdx
[iPage],&pCur->
šfo
); \

56050 
pCur
->
curFÏgs
 |ð
BTCF_V®idNKey
; \

56052 
	`as£¹C–lInfo
(
pCur
); \

56053 }

	)

56056 #iâdeà
NDEBUG


56062 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜIsV®id
(
BtCursÜ
 *
pCur
){

56063  
	gpCur
 &&…Cur->
	geS‹
==
CURSOR_VALID
;

56079 
SQLITE_PRIVATE
 
sql™e3BŒ“KeySize
(
BtCursÜ
 *
pCur
, 
i64
 *
pSize
){

56080 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56081 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56082 
g‘C–lInfo
(
pCur
);

56083 *
	gpSize
 = 
pCur
->
šfo
.
nKey
;

56084  
	gSQLITE_OK
;

56099 
SQLITE_PRIVATE
 
sql™e3BŒ“D©aSize
(
BtCursÜ
 *
pCur
, 
u32
 *
pSize
){

56100 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56101 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56102 
as£¹
Ð
pCur
->
­Page
[pCur->
iPage
]->
štKeyL—f
==1 );

56103 
g‘C–lInfo
(
pCur
);

56104 *
	gpSize
 = 
pCur
->
šfo
.
nPaylßd
;

56105  
	gSQLITE_OK
;

56127 
g‘Ov”æowPage
(

56128 
BtSh¬ed
 *
pBt
,

56129 
Pgno
 
ovæ
,

56130 
MemPage
 **
µPage
,

56131 
Pgno
 *
pPgnoNext


56133 
Pgno
 
	gÃxt
 = 0;

56134 
MemPage
 *
	gpPage
 = 0;

56135 
	grc
 = 
SQLITE_OK
;

56137 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

56138 
as£¹
(
pPgnoNext
);

56140 #iâdeà
SQLITE_OMIT_AUTOVACUUM


56147 ifÐ
	gpBt
->
	gautoVacuum
 ){

56148 
Pgno
 
	gpgno
;

56149 
Pgno
 
	giGuess
 = 
ovæ
+1;

56150 
u8
 
	geTy³
;

56152  
PTRMAP_ISPAGE
(
pBt
, 
iGuess
è|| 
	giGuess
==
PENDING_BYTE_PAGE
(pBt) ){

56153 
iGuess
++;

56156 ifÐ
	giGuess
<=
bŒ“PagecouÁ
(
pBt
) ){

56157 
rc
 = 
±rm­G‘
(
pBt
, 
iGuess
, &
eTy³
, &
pgno
);

56158 ifÐ
	grc
==
SQLITE_OK
 && 
eTy³
==
PTRMAP_OVERFLOW2
 && 
pgno
==
ovæ
 ){

56159 
Ãxt
 = 
iGuess
;

56160 
	grc
 = 
SQLITE_DONE
;

56166 
as£¹
Ð
Ãxt
==0 || 
rc
==
SQLITE_DONE
 );

56167 ifÐ
	grc
==
SQLITE_OK
 ){

56168 
rc
 = 
bŒ“G‘Page
(
pBt
, 
ovæ
, &
pPage
, (
µPage
==0è? 
PAGER_GET_READONLY
 : 0);

56169 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pPage
==0 );

56170 ifÐ
	grc
==
SQLITE_OK
 ){

56171 
Ãxt
 = 
g‘4by‹
(
pPage
->
aD©a
);

56175 *
	gpPgnoNext
 = 
Ãxt
;

56176 ifÐ
	gµPage
 ){

56177 *
	gµPage
 = 
pPage
;

56179 
»Ëa£Page
(
pPage
);

56181  (
	grc
==
SQLITE_DONE
 ? 
SQLITE_OK
 : 
rc
);

56195 
cÝyPaylßd
(

56196 *
pPaylßd
,

56197 *
pBuf
,

56198 
nBy‹
,

56199 
eOp
,

56200 
DbPage
 *
pDbPage


56202 ifÐ
	geOp
 ){

56204 
	grc
 = 
sql™e3Pag”Wr™e
(
pDbPage
);

56205 ifÐ
	grc
!=
SQLITE_OK
 ){

56206  
rc
;

56208 
memýy
(
pPaylßd
, 
pBuf
, 
nBy‹
);

56211 
memýy
(
pBuf
, 
pPaylßd
, 
nBy‹
);

56213  
	gSQLITE_OK
;

56246 
acûssPaylßd
(

56247 
BtCursÜ
 *
pCur
,

56248 
u32
 
off£t
,

56249 
u32
 
amt
,

56250 *
pBuf
,

56251 
eOp


56253 *
	gaPaylßd
;

56254 
	grc
 = 
SQLITE_OK
;

56255 
	giIdx
 = 0;

56256 
MemPage
 *
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

56257 
BtSh¬ed
 *
	gpBt
 = 
pCur
->
pBt
;

56258 #ifdeà
SQLITE_DIRECT_OVERFLOW_READ


56259 * cÚ¡ 
	gpBufS¹
 = 
pBuf
;

56260 
	gbEnd
;

56263 
as£¹
Ð
pPage
 );

56264 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56265 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<
pPage
->
nC–l
 );

56266 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56267 
as£¹
Ð
eOp
!=2 || 
off£t
==0 );

56269 
g‘C–lInfo
(
pCur
);

56270 
	gaPaylßd
 = 
pCur
->
šfo
.
pPaylßd
;

56271 #ifdeà
SQLITE_DIRECT_OVERFLOW_READ


56272 
	gbEnd
 = 
off£t
+
amt
==
pCur
->
šfo
.
nPaylßd
;

56274 
as£¹
Ð
off£t
+
amt
 <ð
pCur
->
šfo
.
nPaylßd
 );

56276 ifÐ&
	gaPaylßd
[
pCur
->
šfo
.
nLoÿl
] > &
	gpPage
->
	gaD©a
[
pBt
->
u§bËSize
] ){

56278  
	gSQLITE_CORRUPT_BKPT
;

56282 ifÐ
	goff£t
<
	gpCur
->
	gšfo
.
	gnLoÿl
 ){

56283 
	ga
 = 
amt
;

56284 ifÐ
	ga
+
	goff£t
>
	gpCur
->
	gšfo
.
	gnLoÿl
 ){

56285 
	ga
 = 
pCur
->
šfo
.
nLoÿl
 - 
off£t
;

56287 
	grc
 = 
cÝyPaylßd
(&
aPaylßd
[
off£t
], 
pBuf
, 
a
, (
eOp
 & 0x01), 
pPage
->
pDbPage
);

56288 
	goff£t
 = 0;

56289 
	gpBuf
 +ð
a
;

56290 
	gamt
 -ð
a
;

56292 
	goff£t
 -ð
pCur
->
šfo
.
nLoÿl
;

56295 ifÐ
	grc
==
SQLITE_OK
 && 
amt
>0 ){

56296 cÚ¡ 
u32
 
ovæSize
 = 
pBt
->
u§bËSize
 - 4;

56297 
Pgno
 
	gÃxtPage
;

56299 
	gÃxtPage
 = 
g‘4by‹
(&
aPaylßd
[
pCur
->
šfo
.
nLoÿl
]);

56309 ifÐ
	geOp
!=2 && (
pCur
->
curFÏgs
 & 
BTCF_V®idOvæ
)==0 ){

56310 
nOvæ
 = (
pCur
->
šfo
.
nPaylßd
-pCur->šfo.
nLoÿl
+
ovæSize
-1)/ovflSize;

56311 ifÐ
	gnOvæ
>
	gpCur
->
	gnOvæAÎoc
 ){

56312 
Pgno
 *
	gaNew
 = (Pgno*)
sql™e3DbR—Îoc
(

56313 
pCur
->
pBŒ“
->
db
,…Cur->
aOv”æow
, 
nOvæ
*2*(
Pgno
)

56315 ifÐ
	gaNew
==0 ){

56316 
rc
 = 
SQLITE_NOMEM
;

56318 
	gpCur
->
	gnOvæAÎoc
 = 
nOvæ
*2;

56319 
	gpCur
->
	gaOv”æow
 = 
aNew
;

56322 ifÐ
	grc
==
SQLITE_OK
 ){

56323 
mem£t
(
pCur
->
aOv”æow
, 0, 
nOvæ
*(
Pgno
));

56324 
	gpCur
->
	gcurFÏgs
 |ð
BTCF_V®idOvæ
;

56332 ifÐ(
	gpCur
->
	gcurFÏgs
 & 
	gBTCF_V®idOvæ
)!=0

56333 && 
pCur
->
aOv”æow
[
off£t
/
ovæSize
]

56335 
iIdx
 = (
off£t
/
ovæSize
);

56336 
	gÃxtPage
 = 
pCur
->
aOv”æow
[
iIdx
];

56337 
	goff£t
 = (
off£t
%
ovæSize
);

56340  ; 
	grc
==
SQLITE_OK
 && 
amt
>0 && 
ÃxtPage
; 
	giIdx
++){

56343 ifÐ(
	gpCur
->
	gcurFÏgs
 & 
	gBTCF_V®idOvæ
)!=0 ){

56344 
as£¹
(!
pCur
->
aOv”æow
[
iIdx
] ||…Cur->aOv”æow[iIdx]==
ÃxtPage
);

56345 
	gpCur
->
	gaOv”æow
[
iIdx
] = 
ÃxtPage
;

56348 ifÐ
	goff£t
>=
ovæSize
 ){

56358 
as£¹
Ð
eOp
!=2 );

56359 
as£¹
Ð
pCur
->
curFÏgs
 & 
BTCF_V®idOvæ
 );

56360 ifÐ
	gpCur
->
	gaOv”æow
[
iIdx
+1] ){

56361 
	gÃxtPage
 = 
pCur
->
aOv”æow
[
iIdx
+1];

56363 
	grc
 = 
g‘Ov”æowPage
(
pBt
, 
ÃxtPage
, 0, &nextPage);

56365 
	goff£t
 -ð
ovæSize
;

56370 #ifdeà
SQLITE_DIRECT_OVERFLOW_READ


56371 
sql™e3_fže
 *
	gfd
;

56373 
	ga
 = 
amt
;

56374 ifÐ
	ga
 + 
	goff£t
 > 
	govæSize
 ){

56375 
	ga
 = 
ovæSize
 - 
off£t
;

56378 #ifdeà
SQLITE_DIRECT_OVERFLOW_READ


56393 ifÐ(
	geOp
&0x01)==0

56394 && 
off£t
==0

56395 && (
bEnd
 || 
a
==
ovæSize
)

56396 && 
pBt
->
šT¿n§ùiÚ
==
TRANS_READ


56397 && (
fd
 = 
sql™e3Pag”Fže
(
pBt
->
pPag”
))->
pM‘hods


56398 && 
pBt
->
pPage1
->
aD©a
[19]==0x01

56399 && &
pBuf
[-4]>=
pBufS¹


56401 
u8
 
aSave
[4];

56402 
u8
 *
	gaWr™e
 = &
pBuf
[-4];

56403 
as£¹
Ð
aWr™e
>=
pBufS¹
 );

56404 
memýy
(
aSave
, 
aWr™e
, 4);

56405 
	grc
 = 
sql™e3OsR—d
(
fd
, 
aWr™e
, 
a
+4, (
i64
)
pBt
->
·geSize
*(
ÃxtPage
-1));

56406 
	gÃxtPage
 = 
g‘4by‹
(
aWr™e
);

56407 
memýy
(
aWr™e
, 
aSave
, 4);

56412 
DbPage
 *
	gpDbPage
;

56413 
	grc
 = 
sql™e3Pag”Acquœe
(
pBt
->
pPag”
, 
ÃxtPage
, &
pDbPage
,

56414 ((
eOp
&0x01)==0 ? 
PAGER_GET_READONLY
 : 0)

56416 ifÐ
	grc
==
SQLITE_OK
 ){

56417 
aPaylßd
 = 
sql™e3Pag”G‘D©a
(
pDbPage
);

56418 
	gÃxtPage
 = 
g‘4by‹
(
aPaylßd
);

56419 
	grc
 = 
cÝyPaylßd
(&
aPaylßd
[
off£t
+4], 
pBuf
, 
a
, (
eOp
&0x01), 
pDbPage
);

56420 
sql™e3Pag”UÄef
(
pDbPage
);

56421 
	goff£t
 = 0;

56424 
	gamt
 -ð
a
;

56425 
	gpBuf
 +ð
a
;

56430 ifÐ
	grc
==
SQLITE_OK
 && 
amt
>0 ){

56431  
SQLITE_CORRUPT_BKPT
;

56433  
	grc
;

56448 
SQLITE_PRIVATE
 
sql™e3BŒ“Key
(
BtCursÜ
 *
pCur
, 
u32
 
off£t
, u32 
amt
, *
pBuf
){

56449 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56450 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56451 
as£¹
Ð
pCur
->
iPage
>=0 &&…Cur->
­Page
[pCur->iPage] );

56452 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<pCur->
­Page
[pCur->iPage]->
nC–l
 );

56453  
acûssPaylßd
(
pCur
, 
off£t
, 
amt
, (*)
pBuf
, 0);

56465 
SQLITE_PRIVATE
 
sql™e3BŒ“D©a
(
BtCursÜ
 *
pCur
, 
u32
 
off£t
, u32 
amt
, *
pBuf
){

56466 
	grc
;

56468 #iâdeà
SQLITE_OMIT_INCRBLOB


56469 iàÐ
	gpCur
->
	geS‹
==
CURSOR_INVALID
 ){

56470  
SQLITE_ABORT
;

56474 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56475 
	grc
 = 
»¡ÜeCursÜPos™iÚ
(
pCur
);

56476 ifÐ
	grc
==
SQLITE_OK
 ){

56477 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56478 
as£¹
Ð
pCur
->
iPage
>=0 &&…Cur->
­Page
[pCur->iPage] );

56479 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<pCur->
­Page
[pCur->iPage]->
nC–l
 );

56480 
	grc
 = 
acûssPaylßd
(
pCur
, 
off£t
, 
amt
, 
pBuf
, 0);

56482  
	grc
;

56504 cÚ¡ *
ãtchPaylßd
(

56505 
BtCursÜ
 *
pCur
,

56506 
u32
 *
pAmt


56508 
as£¹
Ð
pCur
!=0 &&…Cur->
iPage
>=0 &&…Cur->
­Page
[pCur->iPage]);

56509 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56510 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCur
->
pBŒ“
->
db
->
mu‹x
) );

56511 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56512 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<pCur->
­Page
[pCur->iPage]->
nC–l
 );

56513 
as£¹
Ð
pCur
->
šfo
.
nSize
>0 );

56514 *
	gpAmt
 = 
pCur
->
šfo
.
nLoÿl
;

56515  (*)
	gpCur
->
	gšfo
.
	gpPaylßd
;

56533 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“KeyF‘ch
(
BtCursÜ
 *
pCur
, 
u32
 *
pAmt
){

56534  
ãtchPaylßd
(
pCur
, 
pAmt
);

56536 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“D©aF‘ch
(
BtCursÜ
 *
pCur
, 
u32
 *
pAmt
){

56537  
ãtchPaylßd
(
pCur
, 
pAmt
);

56550 
moveToChžd
(
BtCursÜ
 *
pCur
, 
u32
 
ÃwPgno
){

56551 
	grc
;

56552 
	gi
 = 
pCur
->
iPage
;

56553 
MemPage
 *
	gpNewPage
;

56554 
BtSh¬ed
 *
	gpBt
 = 
pCur
->
pBt
;

56556 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56557 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56558 
as£¹
Ð
pCur
->
iPage
<
BTCURSOR_MAX_DEPTH
 );

56559 
as£¹
Ð
pCur
->
iPage
>=0 );

56560 ifÐ
	gpCur
->
	giPage
>=(
BTCURSOR_MAX_DEPTH
-1) ){

56561  
SQLITE_CORRUPT_BKPT
;

56563 
	grc
 = 
g‘AndIn™Page
(
pBt
, 
ÃwPgno
, &
pNewPage
,

56564 (
pCur
->
curFÏgs
 & 
BTCF_Wr™eFÏg
)==0 ? 
PAGER_GET_READONLY
 : 0);

56565 ifÐ
	grc
 ) „c;

56566 
	gpCur
->
	g­Page
[
i
+1] = 
pNewPage
;

56567 
	gpCur
->
	gaiIdx
[
i
+1] = 0;

56568 
	gpCur
->
	giPage
++;

56570 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

56571 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_V®idNKey
|
BTCF_V®idOvæ
);

56572 ifÐ
	gpNewPage
->
	gnC–l
<1 ||…NewPage->
	gštKey
!=
pCur
->
­Page
[
i
]->
štKey
 ){

56573  
SQLITE_CORRUPT_BKPT
;

56575  
	gSQLITE_OK
;

56586 
as£¹P¬’tIndex
(
MemPage
 *
pP¬’t
, 
iIdx
, 
Pgno
 
iChžd
){

56587 
as£¹
Ð
iIdx
<=
pP¬’t
->
nC–l
 );

56588 ifÐ
	giIdx
==
pP¬’t
->
nC–l
 ){

56589 
as£¹
Ð
g‘4by‹
(&
pP¬’t
->
aD©a
[pP¬’t->
hdrOff£t
+8])==
iChžd
 );

56591 
as£¹
Ð
g‘4by‹
(
fšdC–l
(
pP¬’t
, 
iIdx
))==
iChžd
 );

56595 
	#as£¹P¬’tIndex
(
x
,
y
,
z
)

	)

56606 
moveToP¬’t
(
BtCursÜ
 *
pCur
){

56607 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56608 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56609 
as£¹
Ð
pCur
->
iPage
>0 );

56610 
as£¹
Ð
pCur
->
­Page
[pCur->
iPage
] );

56618 
as£¹P¬’tIndex
(

56619 
pCur
->
­Page
[pCur->
iPage
-1],

56620 
pCur
->
aiIdx
[pCur->
iPage
-1],

56621 
pCur
->
­Page
[pCur->
iPage
]->
pgno


56624 
‹¡ÿ£
Ð
pCur
->
aiIdx
[pCur->
iPage
-1] >…Cur->
­Page
[pCur->iPage-1]->
nC–l
 );

56626 
»Ëa£Page
(
pCur
->
­Page
[pCur->
iPage
]);

56627 
	gpCur
->
	giPage
--;

56628 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

56629 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_V®idNKey
|
BTCF_V®idOvæ
);

56653 
moveToRoÙ
(
BtCursÜ
 *
pCur
){

56654 
MemPage
 *
	gpRoÙ
;

56655 
	grc
 = 
SQLITE_OK
;

56657 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56658 
as£¹
Ð
CURSOR_INVALID
 < 
CURSOR_REQUIRESEEK
 );

56659 
as£¹
Ð
CURSOR_VALID
 < 
CURSOR_REQUIRESEEK
 );

56660 
as£¹
Ð
CURSOR_FAULT
 > 
CURSOR_REQUIRESEEK
 );

56661 ifÐ
	gpCur
->
	geS‹
>=
CURSOR_REQUIRESEEK
 ){

56662 ifÐ
pCur
->
eS‹
==
CURSOR_FAULT
 ){

56663 
as£¹
Ð
pCur
->
skNext
!=
SQLITE_OK
 );

56664  
	gpCur
->
	gskNext
;

56666 
sql™e3BŒ“CË¬CursÜ
(
pCur
);

56669 ifÐ
	gpCur
->
	giPage
>=0 ){

56670  
pCur
->
iPage
 ) 
»Ëa£Page
ÕCur->
­Page
[pCur->iPage--]);

56671 }ifÐ
	gpCur
->
	gpgnoRoÙ
==0 ){

56672 
pCur
->
eS‹
 = 
CURSOR_INVALID
;

56673  
	gSQLITE_OK
;

56675 
	grc
 = 
g‘AndIn™Page
(
pCur
->
pBŒ“
->
pBt
,…Cur->
pgnoRoÙ
, &pCur->
­Page
[0],

56676 (
pCur
->
curFÏgs
 & 
BTCF_Wr™eFÏg
)==0 ? 
PAGER_GET_READONLY
 : 0);

56677 ifÐ
	grc
!=
SQLITE_OK
 ){

56678 
pCur
->
eS‹
 = 
CURSOR_INVALID
;

56679  
	grc
;

56681 
	gpCur
->
	giPage
 = 0;

56683 
	gpRoÙ
 = 
pCur
->
­Page
[0];

56684 
as£¹
Ð
pRoÙ
->
pgno
==
pCur
->
pgnoRoÙ
 );

56696 
as£¹
Ð
pRoÙ
->
štKey
==1 ||…Root->intKey==0 );

56697 ifÐ
	gpRoÙ
->
	gisIn™
==0 || (
pCur
->
pKeyInfo
==0)!=
pRoÙ
->
štKey
 ){

56698  
SQLITE_CORRUPT_BKPT
;

56701 
	gpCur
->
	gaiIdx
[0] = 0;

56702 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

56703 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_AtLa¡
|
BTCF_V®idNKey
|
BTCF_V®idOvæ
);

56705 ifÐ
	gpRoÙ
->
	gnC–l
>0 ){

56706 
	gpCur
->
	geS‹
 = 
CURSOR_VALID
;

56707 }ifÐ!
	gpRoÙ
->
	gËaf
 ){

56708 
Pgno
 
	gsub·ge
;

56709 ifÐ
	gpRoÙ
->
	gpgno
!=1 )  
SQLITE_CORRUPT_BKPT
;

56710 
	gsub·ge
 = 
g‘4by‹
(&
pRoÙ
->
aD©a
[pRoÙ->
hdrOff£t
+8]);

56711 
	gpCur
->
	geS‹
 = 
CURSOR_VALID
;

56712 
	grc
 = 
moveToChžd
(
pCur
, 
sub·ge
);

56714 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

56716  
	grc
;

56726 
moveToLeámo¡
(
BtCursÜ
 *
pCur
){

56727 
Pgno
 
	gpgno
;

56728 
	grc
 = 
SQLITE_OK
;

56729 
MemPage
 *
	gpPage
;

56731 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56732 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56733  
	grc
==
SQLITE_OK
 && !(
pPage
 = 
pCur
->
­Page
[pCur->
iPage
])->
Ëaf
 ){

56734 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<
pPage
->
nC–l
 );

56735 
	gpgno
 = 
g‘4by‹
(
fšdC–l
(
pPage
, 
pCur
->
aiIdx
[pCur->
iPage
]));

56736 
	grc
 = 
moveToChžd
(
pCur
, 
pgno
);

56738  
	grc
;

56751 
moveToRightmo¡
(
BtCursÜ
 *
pCur
){

56752 
Pgno
 
	gpgno
;

56753 
	grc
 = 
SQLITE_OK
;

56754 
MemPage
 *
	gpPage
 = 0;

56756 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56757 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56758  !(
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
])->
Ëaf
 ){

56759 
pgno
 = 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]);

56760 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = 
pPage
->
nC–l
;

56761 
	grc
 = 
moveToChžd
(
pCur
, 
pgno
);

56762 ifÐ
	grc
 ) „c;

56764 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = 
pPage
->
nC–l
-1;

56765 
as£¹
Ð
pCur
->
šfo
.
nSize
==0 );

56766 
as£¹
Ð(
pCur
->
curFÏgs
 & 
BTCF_V®idNKey
)==0 );

56767  
	gSQLITE_OK
;

56774 
SQLITE_PRIVATE
 
sql™e3BŒ“Fœ¡
(
BtCursÜ
 *
pCur
, *
pRes
){

56775 
	grc
;

56777 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56778 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCur
->
pBŒ“
->
db
->
mu‹x
) );

56779 
	grc
 = 
moveToRoÙ
(
pCur
);

56780 ifÐ
	grc
==
SQLITE_OK
 ){

56781 ifÐ
pCur
->
eS‹
==
CURSOR_INVALID
 ){

56782 
as£¹
Ð
pCur
->
pgnoRoÙ
==0 ||…Cur->
­Page
[pCur->
iPage
]->
nC–l
==0 );

56783 *
	gpRes
 = 1;

56785 
as£¹
Ð
pCur
->
­Page
[pCur->
iPage
]->
nC–l
>0 );

56786 *
	gpRes
 = 0;

56787 
	grc
 = 
moveToLeámo¡
(
pCur
);

56790  
	grc
;

56797 
SQLITE_PRIVATE
 
sql™e3BŒ“La¡
(
BtCursÜ
 *
pCur
, *
pRes
){

56798 
	grc
;

56800 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56801 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCur
->
pBŒ“
->
db
->
mu‹x
) );

56804 ifÐ
	gCURSOR_VALID
==
pCur
->
eS‹
 && (pCur->
curFÏgs
 & 
BTCF_AtLa¡
)!=0 ){

56805 #ifdeà
SQLITE_DEBUG


56808 
ii
;

56809 
	gii
=0; ii<
	gpCur
->
	giPage
; ii++){

56810 
as£¹
Ð
pCur
->
aiIdx
[
ii
]=õCur->
­Page
[ii]->
nC–l
 );

56812 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]=õCur->
­Page
[pCur->iPage]->
nC–l
-1 );

56813 
as£¹
Ð
pCur
->
­Page
[pCur->
iPage
]->
Ëaf
 );

56815  
	gSQLITE_OK
;

56818 
	grc
 = 
moveToRoÙ
(
pCur
);

56819 ifÐ
	grc
==
SQLITE_OK
 ){

56820 ifÐ
CURSOR_INVALID
==
pCur
->
eS‹
 ){

56821 
as£¹
Ð
pCur
->
pgnoRoÙ
==0 ||…Cur->
­Page
[pCur->
iPage
]->
nC–l
==0 );

56822 *
	gpRes
 = 1;

56824 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 );

56825 *
	gpRes
 = 0;

56826 
	grc
 = 
moveToRightmo¡
(
pCur
);

56827 ifÐ
	grc
==
SQLITE_OK
 ){

56828 
pCur
->
curFÏgs
 |ð
BTCF_AtLa¡
;

56830 
	gpCur
->
	gcurFÏgs
 &ð~
BTCF_AtLa¡
;

56835  
	grc
;

56866 
SQLITE_PRIVATE
 
sql™e3BŒ“Mov‘oUÅacked
(

56867 
BtCursÜ
 *
pCur
,

56868 
UÅackedRecÜd
 *
pIdxKey
,

56869 
i64
 
štKey
,

56870 
bŸsRight
,

56871 *
pRes


56873 
	grc
;

56874 
RecÜdCom·»
 
	gxRecÜdCom·»
;

56876 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

56877 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCur
->
pBŒ“
->
db
->
mu‹x
) );

56878 
as£¹
Ð
pRes
 );

56879 
as£¹
Ð(
pIdxKey
==0)==(
pCur
->
pKeyInfo
==0) );

56883 ifÐ
	gpCur
->
	geS‹
==
CURSOR_VALID
 && (
pCur
->
curFÏgs
 & 
BTCF_V®idNKey
)!=0

56884 && 
pCur
->
­Page
[0]->
štKey


56886 ifÐ
pCur
->
šfo
.
nKey
==
štKey
 ){

56887 *
pRes
 = 0;

56888  
	gSQLITE_OK
;

56890 ifÐ(
	gpCur
->
	gcurFÏgs
 & 
	gBTCF_AtLa¡
)!=0 && 
pCur
->
šfo
.
nKey
<
štKey
 ){

56891 *
pRes
 = -1;

56892  
	gSQLITE_OK
;

56896 ifÐ
	gpIdxKey
 ){

56897 
	gxRecÜdCom·»
 = 
sql™e3VdbeFšdCom·»
(
pIdxKey
);

56898 
	gpIdxKey
->
	g”rCode
 = 0;

56899 
as£¹
Ð
pIdxKey
->
deçuÉ_rc
==1

56900 || 
pIdxKey
->
deçuÉ_rc
==0

56901 || 
pIdxKey
->
deçuÉ_rc
==-1

56904 
	gxRecÜdCom·»
 = 0;

56907 
	grc
 = 
moveToRoÙ
(
pCur
);

56908 ifÐ
	grc
 ){

56909  
	grc
;

56911 
as£¹
Ð
pCur
->
pgnoRoÙ
==0 ||…Cur->
­Page
[pCur->
iPage
] );

56912 
as£¹
Ð
pCur
->
pgnoRoÙ
==0 ||…Cur->
­Page
[pCur->
iPage
]->
isIn™
 );

56913 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_INVALID
 ||…Cur->
­Page
[pCur->
iPage
]->
nC–l
>0 );

56914 ifÐ
	gpCur
->
	geS‹
==
CURSOR_INVALID
 ){

56915 *
pRes
 = -1;

56916 
as£¹
Ð
pCur
->
pgnoRoÙ
==0 ||…Cur->
­Page
[pCur->
iPage
]->
nC–l
==0 );

56917  
	gSQLITE_OK
;

56919 
as£¹
Ð
pCur
->
­Page
[0]->
štKey
 || 
pIdxKey
 );

56921 
	glwr
, 
	gu´
, 
	gidx
, 
	gc
;

56922 
Pgno
 
	gchldPg
;

56923 
MemPage
 *
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

56924 
u8
 *
	gpC–l
;

56932 
as£¹
Ð
pPage
->
nC–l
>0 );

56933 
as£¹
Ð
pPage
->
štKey
==(
pIdxKey
==0) );

56934 
	glwr
 = 0;

56935 
	gu´
 = 
pPage
->
nC–l
-1;

56936 
as£¹
Ð
bŸsRight
==0 || biasRight==1 );

56937 
	gidx
 = 
u´
>>(1-
bŸsRight
);

56938 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
idx
;

56939 ifÐ
	gxRecÜdCom·»
==0 ){

56941 
i64
 
	gnC–lKey
;

56942 
	gpC–l
 = 
fšdC–l
(
pPage
, 
idx
è+ 
	gpPage
->
	gchždPŒSize
;

56943 ifÐ
	gpPage
->
	gštKeyL—f
 ){

56944  0x80 <ð*(
pC–l
++) ){

56945 ifÐ
pC–l
>=
pPage
->
aD©aEnd
 )  
SQLITE_CORRUPT_BKPT
;

56948 
g‘V¬št
(
pC–l
, (
u64
*)&
nC–lKey
);

56949 ifÐ
	gnC–lKey
<
	gštKey
 ){

56950 
	glwr
 = 
idx
+1;

56951 ifÐ
	glwr
>
	gu´
 ){ 
	gc
 = -1; ; }

56952 }ifÐ
	gnC–lKey
>
	gštKey
 ){

56953 
	gu´
 = 
idx
-1;

56954 ifÐ
	glwr
>
	gu´
 ){ 
	gc
 = +1; ; }

56956 
as£¹
Ð
nC–lKey
==
štKey
 );

56957 
	gpCur
->
	gcurFÏgs
 |ð
BTCF_V®idNKey
;

56958 
	gpCur
->
	gšfo
.
	gnKey
 = 
nC–lKey
;

56959 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
idx
;

56960 ifÐ!
	gpPage
->
	gËaf
 ){

56961 
	glwr
 = 
idx
;

56962 
	gmov‘o_Ãxt_Ïy”
;

56964 *
	gpRes
 = 0;

56965 
	grc
 = 
SQLITE_OK
;

56966 
	gmov‘o_fšish
;

56969 
as£¹
Ð
lwr
+
u´
>=0 );

56970 
	gidx
 = (
lwr
+
u´
)>>1;

56974 
	gnC–l
;

56975 
	gpC–l
 = 
fšdC–l
(
pPage
, 
idx
è+ 
	gpPage
->
	gchždPŒSize
;

56985 
	gnC–l
 = 
pC–l
[0];

56986 ifÐ
	gnC–l
<=
pPage
->
max1by‹Paylßd
 ){

56990 
‹¡ÿ£
Ð
pC–l
+
nC–l
+1==
pPage
->
aD©aEnd
 );

56991 
	gc
 = 
xRecÜdCom·»
(
nC–l
, (*)&
pC–l
[1], 
pIdxKey
);

56992 }ifÐ!(
	gpC–l
[1] & 0x80)

56993 && (
	gnC–l
 = ((
nC–l
&0x7f)<<7è+ 
pC–l
[1])<=
pPage
->
maxLoÿl


56997 
‹¡ÿ£
Ð
pC–l
+
nC–l
+2==
pPage
->
aD©aEnd
 );

56998 
	gc
 = 
xRecÜdCom·»
(
nC–l
, (*)&
pC–l
[2], 
pIdxKey
);

57004 *
	gpC–lKey
;

57005 
u8
 * cÚ¡ 
	gpC–lBody
 = 
pC–l
 - 
pPage
->
chždPŒSize
;

57006 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–lBody
, &
pCur
->
šfo
);

57007 
	gnC–l
 = ()
pCur
->
šfo
.
nKey
;

57008 
	gpC–lKey
 = 
sql™e3M®loc
Ð
nC–l
 );

57009 ifÐ
	gpC–lKey
==0 ){

57010 
rc
 = 
SQLITE_NOMEM
;

57011 
	gmov‘o_fšish
;

57013 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
idx
;

57014 
	grc
 = 
acûssPaylßd
(
pCur
, 0, 
nC–l
, (*)
pC–lKey
, 2);

57015 ifÐ
	grc
 ){

57016 
sql™e3_ä“
(
pC–lKey
);

57017 
	gmov‘o_fšish
;

57019 
	gc
 = 
xRecÜdCom·»
(
nC–l
, 
pC–lKey
, 
pIdxKey
);

57020 
sql™e3_ä“
(
pC–lKey
);

57022 
as£¹
(

57023 (
pIdxKey
->
”rCode
!=
SQLITE_CORRUPT
 || 
c
==0)

57024 && (
pIdxKey
->
”rCode
!=
SQLITE_NOMEM
 || 
pCur
->
pBŒ“
->
db
->
m®locFažed
)

57026 ifÐ
	gc
<0 ){

57027 
	glwr
 = 
idx
+1;

57028 }ifÐ
	gc
>0 ){

57029 
	gu´
 = 
idx
-1;

57031 
as£¹
Ð
c
==0 );

57032 *
	gpRes
 = 0;

57033 
	grc
 = 
SQLITE_OK
;

57034 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
idx
;

57035 ifÐ
	gpIdxKey
->
	g”rCode
 ) 
	grc
 = 
SQLITE_CORRUPT
;

57036 
	gmov‘o_fšish
;

57038 ifÐ
	glwr
>
	gu´
 ) ;

57039 
as£¹
Ð
lwr
+
u´
>=0 );

57040 
	gidx
 = (
lwr
+
u´
)>>1;

57043 
as£¹
Ð
lwr
==
u´
+1 || (
pPage
->
štKey
 && !pPage->
Ëaf
) );

57044 
as£¹
Ð
pPage
->
isIn™
 );

57045 ifÐ
	gpPage
->
	gËaf
 ){

57046 
as£¹
Ð
pCur
->
aiIdx
[pCur->
iPage
]<pCur->
­Page
[pCur->iPage]->
nC–l
 );

57047 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
idx
;

57048 *
	gpRes
 = 
c
;

57049 
	grc
 = 
SQLITE_OK
;

57050 
	gmov‘o_fšish
;

57052 
	gmov‘o_Ãxt_Ïy”
:

57053 ifÐ
lwr
>=
pPage
->
nC–l
 ){

57054 
chldPg
 = 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]);

57056 
	gchldPg
 = 
g‘4by‹
(
fšdC–l
(
pPage
, 
lwr
));

57058 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
] = (
u16
)
lwr
;

57059 
	grc
 = 
moveToChžd
(
pCur
, 
chldPg
);

57060 ifÐ
	grc
 ) ;

57062 
	gmov‘o_fšish
:

57063 
pCur
->
šfo
.
nSize
 = 0;

57064 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_V®idNKey
|
BTCF_V®idOvæ
);

57065  
	grc
;

57076 
SQLITE_PRIVATE
 
sql™e3BŒ“Eof
(
BtCursÜ
 *
pCur
){

57081  (
	gCURSOR_VALID
!=
pCur
->
eS‹
);

57105 
SQLITE_NOINLINE
 
bŒ“Next
(
BtCursÜ
 *
pCur
, *
pRes
){

57106 
	grc
;

57107 
	gidx
;

57108 
MemPage
 *
	gpPage
;

57110 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

57111 
as£¹
Ð
pCur
->
skNext
==0 ||…Cur->
eS‹
!=
CURSOR_VALID
 );

57112 
as£¹
Ð*
pRes
==0 );

57113 ifÐ
	gpCur
->
	geS‹
!=
CURSOR_VALID
 ){

57114 
as£¹
Ð(
pCur
->
curFÏgs
 & 
BTCF_V®idOvæ
)==0 );

57115 
	grc
 = 
»¡ÜeCursÜPos™iÚ
(
pCur
);

57116 ifÐ
	grc
!=
SQLITE_OK
 ){

57117  
rc
;

57119 ifÐ
	gCURSOR_INVALID
==
pCur
->
eS‹
 ){

57120 *
pRes
 = 1;

57121  
	gSQLITE_OK
;

57123 ifÐ
	gpCur
->
	gskNext
 ){

57124 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 ||…Cur->eS‹==
CURSOR_SKIPNEXT
 );

57125 
	gpCur
->
	geS‹
 = 
CURSOR_VALID
;

57126 ifÐ
	gpCur
->
	gskNext
>0 ){

57127 
	gpCur
->
	gskNext
 = 0;

57128  
	gSQLITE_OK
;

57130 
	gpCur
->
	gskNext
 = 0;

57134 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

57135 
	gidx
 = ++
pCur
->
aiIdx
[pCur->
iPage
];

57136 
as£¹
Ð
pPage
->
isIn™
 );

57143 
‹¡ÿ£
Ð
idx
>
pPage
->
nC–l
 );

57145 ifÐ
	gidx
>=
pPage
->
nC–l
 ){

57146 ifÐ!
pPage
->
Ëaf
 ){

57147 
rc
 = 
moveToChžd
(
pCur
, 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]));

57148 ifÐ
	grc
 ) „c;

57149  
moveToLeámo¡
(
pCur
);

57152 ifÐ
	gpCur
->
	giPage
==0 ){

57153 *
pRes
 = 1;

57154 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

57155  
	gSQLITE_OK
;

57157 
moveToP¬’t
(
pCur
);

57158 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

57159 } 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]>=
pPage
->
nC–l
 );

57160 ifÐ
	gpPage
->
	gštKey
 ){

57161  
sql™e3BŒ“Next
(
pCur
, 
pRes
);

57163  
	gSQLITE_OK
;

57166 ifÐ
	gpPage
->
	gËaf
 ){

57167  
	gSQLITE_OK
;

57169  
moveToLeámo¡
(
pCur
);

57172 
SQLITE_PRIVATE
 
sql™e3BŒ“Next
(
BtCursÜ
 *
pCur
, *
pRes
){

57173 
MemPage
 *
	gpPage
;

57174 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

57175 
as£¹
Ð
pRes
!=0 );

57176 
as£¹
Ð*
pRes
==0 || *pRes==1 );

57177 
as£¹
Ð
pCur
->
skNext
==0 ||…Cur->
eS‹
!=
CURSOR_VALID
 );

57178 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

57179 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_V®idNKey
|
BTCF_V®idOvæ
);

57180 *
	gpRes
 = 0;

57181 ifÐ
	gpCur
->
	geS‹
!=
CURSOR_VALID
 )  
bŒ“Next
(
pCur
, 
pRes
);

57182 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

57183 ifÐ(++
	gpCur
->
	gaiIdx
[
pCur
->
iPage
])>=
pPage
->
nC–l
 ){

57184 
pCur
->
aiIdx
[pCur->
iPage
]--;

57185  
bŒ“Next
(
pCur
, 
pRes
);

57187 ifÐ
	gpPage
->
	gËaf
 ){

57188  
	gSQLITE_OK
;

57190  
moveToLeámo¡
(
pCur
);

57215 
SQLITE_NOINLINE
 
bŒ“P»vious
(
BtCursÜ
 *
pCur
, *
pRes
){

57216 
	grc
;

57217 
MemPage
 *
	gpPage
;

57219 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

57220 
as£¹
Ð
pRes
!=0 );

57221 
as£¹
Ð*
pRes
==0 );

57222 
as£¹
Ð
pCur
->
skNext
==0 ||…Cur->
eS‹
!=
CURSOR_VALID
 );

57223 
as£¹
Ð(
pCur
->
curFÏgs
 & (
BTCF_AtLa¡
|
BTCF_V®idOvæ
|
BTCF_V®idNKey
))==0 );

57224 
as£¹
Ð
pCur
->
šfo
.
nSize
==0 );

57225 ifÐ
	gpCur
->
	geS‹
!=
CURSOR_VALID
 ){

57226 
rc
 = 
»¡ÜeCursÜPos™iÚ
(
pCur
);

57227 ifÐ
	grc
!=
SQLITE_OK
 ){

57228  
rc
;

57230 ifÐ
	gCURSOR_INVALID
==
pCur
->
eS‹
 ){

57231 *
pRes
 = 1;

57232  
	gSQLITE_OK
;

57234 ifÐ
	gpCur
->
	gskNext
 ){

57235 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 ||…Cur->eS‹==
CURSOR_SKIPNEXT
 );

57236 
	gpCur
->
	geS‹
 = 
CURSOR_VALID
;

57237 ifÐ
	gpCur
->
	gskNext
<0 ){

57238 
	gpCur
->
	gskNext
 = 0;

57239  
	gSQLITE_OK
;

57241 
	gpCur
->
	gskNext
 = 0;

57245 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

57246 
as£¹
Ð
pPage
->
isIn™
 );

57247 ifÐ!
	gpPage
->
	gËaf
 ){

57248 
	gidx
 = 
pCur
->
aiIdx
[pCur->
iPage
];

57249 
	grc
 = 
moveToChžd
(
pCur
, 
g‘4by‹
(
fšdC–l
(
pPage
, 
idx
)));

57250 ifÐ
	grc
 ) „c;

57251 
	grc
 = 
moveToRightmo¡
(
pCur
);

57253  
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]==0 ){

57254 ifÐ
pCur
->
iPage
==0 ){

57255 
pCur
->
eS‹
 = 
CURSOR_INVALID
;

57256 *
	gpRes
 = 1;

57257  
	gSQLITE_OK
;

57259 
moveToP¬’t
(
pCur
);

57261 
as£¹
Ð
pCur
->
šfo
.
nSize
==0 );

57262 
as£¹
Ð(
pCur
->
curFÏgs
 & (
BTCF_V®idNKey
|
BTCF_V®idOvæ
))==0 );

57264 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]--;

57265 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

57266 ifÐ
	gpPage
->
	gštKey
 && !pPage->
	gËaf
 ){

57267 
	grc
 = 
sql™e3BŒ“P»vious
(
pCur
, 
pRes
);

57269 
	grc
 = 
SQLITE_OK
;

57272  
	grc
;

57274 
SQLITE_PRIVATE
 
sql™e3BŒ“P»vious
(
BtCursÜ
 *
pCur
, *
pRes
){

57275 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

57276 
as£¹
Ð
pRes
!=0 );

57277 
as£¹
Ð*
pRes
==0 || *pRes==1 );

57278 
as£¹
Ð
pCur
->
skNext
==0 ||…Cur->
eS‹
!=
CURSOR_VALID
 );

57279 *
	gpRes
 = 0;

57280 
	gpCur
->
	gcurFÏgs
 &ð~(
BTCF_AtLa¡
|
BTCF_V®idOvæ
|
BTCF_V®idNKey
);

57281 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

57282 ifÐ
	gpCur
->
	geS‹
!=
CURSOR_VALID


57283 || 
pCur
->
aiIdx
[pCur->
iPage
]==0

57284 || 
pCur
->
­Page
[pCur->
iPage
]->
Ëaf
==0

57286  
bŒ“P»vious
(
pCur
, 
pRes
);

57288 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]--;

57289  
	gSQLITE_OK
;

57315 
®loÿ‹BŒ“Page
(

57316 
BtSh¬ed
 *
pBt
,

57317 
MemPage
 **
µPage
,

57318 
Pgno
 *
pPgno
,

57319 
Pgno
 
Ã¬by
,

57320 
u8
 
eMode


57322 
MemPage
 *
	gpPage1
;

57323 
	grc
;

57324 
u32
 
	gn
;

57325 
u32
 
	gk
;

57326 
MemPage
 *
	gpTrunk
 = 0;

57327 
MemPage
 *
	gpP»vTrunk
 = 0;

57328 
Pgno
 
	gmxPage
;

57330 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

57331 
as£¹
Ð
eMode
==
BTALLOC_ANY
 || (
Ã¬by
>0 && 
IfNÙOm™AV
(
pBt
->
autoVacuum
)) );

57332 
	gpPage1
 = 
pBt
->
pPage1
;

57333 
	gmxPage
 = 
bŒ“PagecouÁ
(
pBt
);

57334 
	gn
 = 
g‘4by‹
(&
pPage1
->
aD©a
[36]);

57335 
‹¡ÿ£
Ð
n
==
mxPage
-1 );

57336 ifÐ
	gn
>=
mxPage
 ){

57337  
SQLITE_CORRUPT_BKPT
;

57339 ifÐ
	gn
>0 ){

57341 
Pgno
 
	giTrunk
;

57342 
u8
 
	g£¬chLi¡
 = 0;

57348 #iâdeà
SQLITE_OMIT_AUTOVACUUM


57349 ifÐ
	geMode
==
BTALLOC_EXACT
 ){

57350 ifÐ
Ã¬by
<=
mxPage
 ){

57351 
u8
 
eTy³
;

57352 
as£¹
Ð
Ã¬by
>0 );

57353 
as£¹
Ð
pBt
->
autoVacuum
 );

57354 
	grc
 = 
±rm­G‘
(
pBt
, 
Ã¬by
, &
eTy³
, 0);

57355 ifÐ
	grc
 ) „c;

57356 ifÐ
	geTy³
==
PTRMAP_FREEPAGE
 ){

57357 
£¬chLi¡
 = 1;

57360 }ifÐ
	geMode
==
BTALLOC_LE
 ){

57361 
£¬chLi¡
 = 1;

57368 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage1
->
pDbPage
);

57369 ifÐ
	grc
 ) „c;

57370 
put4by‹
(&
pPage1
->
aD©a
[36], 
n
-1);

57378 
	gpP»vTrunk
 = 
pTrunk
;

57379 ifÐ
	gpP»vTrunk
 ){

57380 
	giTrunk
 = 
g‘4by‹
(&
pP»vTrunk
->
aD©a
[0]);

57382 
	giTrunk
 = 
g‘4by‹
(&
pPage1
->
aD©a
[32]);

57384 
‹¡ÿ£
Ð
iTrunk
==
mxPage
 );

57385 ifÐ
	giTrunk
>
	gmxPage
 ){

57386 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

57388 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
iTrunk
, &
pTrunk
, 0);

57390 ifÐ
	grc
 ){

57391 
	gpTrunk
 = 0;

57392 
	g’d_®loÿ‹_·ge
;

57394 
as£¹
Ð
pTrunk
!=0 );

57395 
as£¹
Ð
pTrunk
->
aD©a
!=0 );

57397 
	gk
 = 
g‘4by‹
(&
pTrunk
->
aD©a
[4]);

57398 ifÐ
	gk
==0 && !
£¬chLi¡
 ){

57402 
as£¹
Ð
pP»vTrunk
==0 );

57403 
	grc
 = 
sql™e3Pag”Wr™e
(
pTrunk
->
pDbPage
);

57404 ifÐ
	grc
 ){

57405 
	g’d_®loÿ‹_·ge
;

57407 *
	gpPgno
 = 
iTrunk
;

57408 
memýy
(&
pPage1
->
aD©a
[32], &
pTrunk
->aData[0], 4);

57409 *
	gµPage
 = 
pTrunk
;

57410 
	gpTrunk
 = 0;

57411 
TRACE
(("ALLOCATE: %drunk - %d f»·ge Ëá\n", *
pPgno
, 
n
-1));

57412 }ifÐ
	gk
>(
	gu32
)(
	gpBt
->
	gu§bËSize
/4 - 2) ){

57414 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

57415 
	g’d_®loÿ‹_·ge
;

57416 #iâdeà
SQLITE_OMIT_AUTOVACUUM


57417 }ifÐ
	g£¬chLi¡


57418 && (
	gÃ¬by
==
iTrunk
 || (iTrunk<
Ã¬by
 && 
eMode
==
BTALLOC_LE
))

57423 *
pPgno
 = 
iTrunk
;

57424 *
	gµPage
 = 
pTrunk
;

57425 
	g£¬chLi¡
 = 0;

57426 
	grc
 = 
sql™e3Pag”Wr™e
(
pTrunk
->
pDbPage
);

57427 ifÐ
	grc
 ){

57428 
	g’d_®loÿ‹_·ge
;

57430 ifÐ
	gk
==0 ){

57431 ifÐ!
pP»vTrunk
 ){

57432 
memýy
(&
pPage1
->
aD©a
[32], &
pTrunk
->aData[0], 4);

57434 
	grc
 = 
sql™e3Pag”Wr™e
(
pP»vTrunk
->
pDbPage
);

57435 ifÐ
	grc
!=
SQLITE_OK
 ){

57436 
’d_®loÿ‹_·ge
;

57438 
memýy
(&
pP»vTrunk
->
aD©a
[0], &
pTrunk
->aData[0], 4);

57445 
MemPage
 *
	gpNewTrunk
;

57446 
Pgno
 
	giNewTrunk
 = 
g‘4by‹
(&
pTrunk
->
aD©a
[8]);

57447 ifÐ
	giNewTrunk
>
	gmxPage
 ){

57448 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

57449 
	g’d_®loÿ‹_·ge
;

57451 
‹¡ÿ£
Ð
iNewTrunk
==
mxPage
 );

57452 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
iNewTrunk
, &
pNewTrunk
, 0);

57453 ifÐ
	grc
!=
SQLITE_OK
 ){

57454 
’d_®loÿ‹_·ge
;

57456 
	grc
 = 
sql™e3Pag”Wr™e
(
pNewTrunk
->
pDbPage
);

57457 ifÐ
	grc
!=
SQLITE_OK
 ){

57458 
»Ëa£Page
(
pNewTrunk
);

57459 
	g’d_®loÿ‹_·ge
;

57461 
memýy
(&
pNewTrunk
->
aD©a
[0], &
pTrunk
->aData[0], 4);

57462 
put4by‹
(&
pNewTrunk
->
aD©a
[4], 
k
-1);

57463 
memýy
(&
pNewTrunk
->
aD©a
[8], &
pTrunk
->aD©a[12], (
k
-1)*4);

57464 
»Ëa£Page
(
pNewTrunk
);

57465 ifÐ!
	gpP»vTrunk
 ){

57466 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage1
->
pDbPage
) );

57467 
put4by‹
(&
pPage1
->
aD©a
[32], 
iNewTrunk
);

57469 
	grc
 = 
sql™e3Pag”Wr™e
(
pP»vTrunk
->
pDbPage
);

57470 ifÐ
	grc
 ){

57471 
	g’d_®loÿ‹_·ge
;

57473 
put4by‹
(&
pP»vTrunk
->
aD©a
[0], 
iNewTrunk
);

57476 
	gpTrunk
 = 0;

57477 
TRACE
(("ALLOCATE: %drunk - %d f»·ge Ëá\n", *
pPgno
, 
n
-1));

57479 }ifÐ
	gk
>0 ){

57481 
u32
 
	gþo£¡
;

57482 
Pgno
 
	giPage
;

57483 *
	gaD©a
 = 
pTrunk
->
aD©a
;

57484 ifÐ
	gÃ¬by
>0 ){

57485 
u32
 
	gi
;

57486 
	gþo£¡
 = 0;

57487 ifÐ
	geMode
==
BTALLOC_LE
 ){

57488 
i
=0; 
	gi
<
	gk
; i++){

57489 
	giPage
 = 
g‘4by‹
(&
aD©a
[8+
i
*4]);

57490 ifÐ
	giPage
<=
Ã¬by
 ){

57491 
þo£¡
 = 
i
;

57496 
	gdi¡
;

57497 
	gdi¡
 = 
sql™e3AbsIÁ32
(
g‘4by‹
(&
aD©a
[8]è- 
Ã¬by
);

57498 
	gi
=1; i<
	gk
; i++){

57499 
	gd2
 = 
sql™e3AbsIÁ32
(
g‘4by‹
(&
aD©a
[8+
i
*4]è- 
Ã¬by
);

57500 ifÐ
	gd2
<
	gdi¡
 ){

57501 
	gþo£¡
 = 
i
;

57502 
	gdi¡
 = 
d2
;

57507 
	gþo£¡
 = 0;

57510 
	giPage
 = 
g‘4by‹
(&
aD©a
[8+
þo£¡
*4]);

57511 
‹¡ÿ£
Ð
iPage
==
mxPage
 );

57512 ifÐ
	giPage
>
	gmxPage
 ){

57513 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

57514 
	g’d_®loÿ‹_·ge
;

57516 
‹¡ÿ£
Ð
iPage
==
mxPage
 );

57517 ifÐ!
	g£¬chLi¡


57518 || (
	giPage
==
Ã¬by
 || (
iPage
<Ã¬by && 
eMode
==
BTALLOC_LE
))

57520 
noCÚ‹Á
;

57521 *
	gpPgno
 = 
iPage
;

57522 
TRACE
(("ALLOCATE: %d was†eaf %d of %d onrunk %d"

57524 *
pPgno
, 
þo£¡
+1, 
k
, 
pTrunk
->
pgno
, 
n
-1));

57525 
	grc
 = 
sql™e3Pag”Wr™e
(
pTrunk
->
pDbPage
);

57526 ifÐ
	grc
 ) 
	g’d_®loÿ‹_·ge
;

57527 ifÐ
	gþo£¡
<
	gk
-1 ){

57528 
memýy
(&
aD©a
[8+
þo£¡
*4], &aD©a[4+
k
*4], 4);

57530 
put4by‹
(&
aD©a
[4], 
k
-1);

57531 
	gnoCÚ‹Á
 = !
bŒ“G‘HasCÚ‹Á
(
pBt
, *
pPgno
)? 
	gPAGER_GET_NOCONTENT
 : 0;

57532 
	grc
 = 
bŒ“G‘Page
(
pBt
, *
pPgno
, 
µPage
, 
noCÚ‹Á
);

57533 ifÐ
	grc
==
SQLITE_OK
 ){

57534 
rc
 = 
sql™e3Pag”Wr™e
((*
µPage
)->
pDbPage
);

57535 ifÐ
	grc
!=
SQLITE_OK
 ){

57536 
»Ëa£Page
(*
µPage
);

57539 
	g£¬chLi¡
 = 0;

57542 
»Ëa£Page
(
pP»vTrunk
);

57543 
	gpP»vTrunk
 = 0;

57544 } 
	g£¬chLi¡
 );

57564 
	gbNoCÚ‹Á
 = (0==
IfNÙOm™AV
(
pBt
->
bDoTrunÿ‹
))? 
PAGER_GET_NOCONTENT
:0;

57566 
	grc
 = 
sql™e3Pag”Wr™e
(
pBt
->
pPage1
->
pDbPage
);

57567 ifÐ
	grc
 ) „c;

57568 
	gpBt
->
	gnPage
++;

57569 ifÐ
	gpBt
->
	gnPage
==
PENDING_BYTE_PAGE
(
pBt
èèpBt->
nPage
++;

57571 #iâdeà
SQLITE_OMIT_AUTOVACUUM


57572 ifÐ
	gpBt
->
	gautoVacuum
 && 
PTRMAP_ISPAGE
(
pBt
,…Bt->
nPage
) ){

57577 
MemPage
 *
	gpPg
 = 0;

57578 
TRACE
(("ALLOCATE: %d fromƒnd oàfžÕoš‹r-m­…age)\n", 
pBt
->
nPage
));

57579 
as£¹
Ð
pBt
->
nPage
!=
PENDING_BYTE_PAGE
(pBt) );

57580 
	grc
 = 
bŒ“G‘Page
(
pBt
,…Bt->
nPage
, &
pPg
, 
bNoCÚ‹Á
);

57581 ifÐ
	grc
==
SQLITE_OK
 ){

57582 
rc
 = 
sql™e3Pag”Wr™e
(
pPg
->
pDbPage
);

57583 
»Ëa£Page
(
pPg
);

57585 ifÐ
	grc
 ) „c;

57586 
	gpBt
->
	gnPage
++;

57587 ifÐ
	gpBt
->
	gnPage
==
PENDING_BYTE_PAGE
(
pBt
è){…Bt->
nPage
++; }

57590 
put4by‹
(28 + (
u8
*)
pBt
->
pPage1
->
aD©a
,…Bt->
nPage
);

57591 *
	gpPgno
 = 
pBt
->
nPage
;

57593 
as£¹
Ð*
pPgno
!=
PENDING_BYTE_PAGE
(
pBt
) );

57594 
	grc
 = 
bŒ“G‘Page
(
pBt
, *
pPgno
, 
µPage
, 
bNoCÚ‹Á
);

57595 ifÐ
	grc
 ) „c;

57596 
	grc
 = 
sql™e3Pag”Wr™e
((*
µPage
)->
pDbPage
);

57597 ifÐ
	grc
!=
SQLITE_OK
 ){

57598 
»Ëa£Page
(*
µPage
);

57600 
TRACE
(("ALLOCATE: %d fromƒnd oàfže\n", *
pPgno
));

57603 
as£¹
Ð*
pPgno
!=
PENDING_BYTE_PAGE
(
pBt
) );

57605 
	g’d_®loÿ‹_·ge
:

57606 
»Ëa£Page
(
pTrunk
);

57607 
»Ëa£Page
(
pP»vTrunk
);

57608 ifÐ
	grc
==
SQLITE_OK
 ){

57609 ifÐ
sql™e3Pag”PageRefcouÁ
((*
µPage
)->
pDbPage
)>1 ){

57610 
»Ëa£Page
(*
µPage
);

57611 *
	gµPage
 = 0;

57612  
	gSQLITE_CORRUPT_BKPT
;

57614 (*
	gµPage
)->
	gisIn™
 = 0;

57616 *
	gµPage
 = 0;

57618 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
sql™e3Pag”Iswr™—bË
((*
µPage
)->
pDbPage
) );

57619  
	grc
;

57634 
ä“Page2
(
BtSh¬ed
 *
pBt
, 
MemPage
 *
pMemPage
, 
Pgno
 
iPage
){

57635 
MemPage
 *
	gpTrunk
 = 0;

57636 
Pgno
 
	giTrunk
 = 0;

57637 
MemPage
 *
	gpPage1
 = 
pBt
->
pPage1
;

57638 
MemPage
 *
	gpPage
;

57639 
	grc
;

57640 
	gnF»e
;

57642 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

57643 
as£¹
Ð
iPage
>1 );

57644 
as£¹
Ð!
pMemPage
 ||…MemPage->
pgno
==
iPage
 );

57646 ifÐ
	gpMemPage
 ){

57647 
	gpPage
 = 
pMemPage
;

57648 
sql™e3Pag”Ref
(
pPage
->
pDbPage
);

57650 
	gpPage
 = 
bŒ“PageLookup
(
pBt
, 
iPage
);

57654 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage1
->
pDbPage
);

57655 ifÐ
	grc
 ) 
	gä“·ge_out
;

57656 
	gnF»e
 = 
g‘4by‹
(&
pPage1
->
aD©a
[36]);

57657 
put4by‹
(&
pPage1
->
aD©a
[36], 
nF»e
+1);

57659 ifÐ
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_SECURE_DELETE
 ){

57663 ifÐ(!
	gpPage
 && ((
	grc
 = 
bŒ“G‘Page
(
pBt
, 
iPage
, &
pPage
, 0))!=0) )

57664 || ((
rc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
))!=0)

57666 
ä“·ge_out
;

57668 
mem£t
(
pPage
->
aD©a
, 0,…Page->
pBt
->
·geSize
);

57674 ifÐ
	gISAUTOVACUUM
 ){

57675 
±rm­Put
(
pBt
, 
iPage
, 
PTRMAP_FREEPAGE
, 0, &
rc
);

57676 ifÐ
	grc
 ) 
	gä“·ge_out
;

57686 ifÐ
	gnF»e
!=0 ){

57687 
u32
 
nL—f
;

57689 
	giTrunk
 = 
g‘4by‹
(&
pPage1
->
aD©a
[32]);

57690 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
iTrunk
, &
pTrunk
, 0);

57691 ifÐ
	grc
!=
SQLITE_OK
 ){

57692 
ä“·ge_out
;

57695 
	gnL—f
 = 
g‘4by‹
(&
pTrunk
->
aD©a
[4]);

57696 
as£¹
Ð
pBt
->
u§bËSize
>32 );

57697 ifÐ
	gnL—f
 > (
	gu32
)
	gpBt
->
	gu§bËSize
/4 - 2 ){

57698 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

57699 
	gä“·ge_out
;

57701 ifÐ
	gnL—f
 < (
	gu32
)
	gpBt
->
	gu§bËSize
/4 - 8 ){

57716 
	grc
 = 
sql™e3Pag”Wr™e
(
pTrunk
->
pDbPage
);

57717 ifÐ
	grc
==
SQLITE_OK
 ){

57718 
put4by‹
(&
pTrunk
->
aD©a
[4], 
nL—f
+1);

57719 
put4by‹
(&
pTrunk
->
aD©a
[8+
nL—f
*4], 
iPage
);

57720 ifÐ
	gpPage
 && (
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_SECURE_DELETE
)==0 ){

57721 
sql™e3Pag”DÚtWr™e
(
pPage
->
pDbPage
);

57723 
	grc
 = 
bŒ“S‘HasCÚ‹Á
(
pBt
, 
iPage
);

57725 
TRACE
(("FREE-PAGE: %d†—àÚrunk…ag%d\n",
pPage
->
pgno
,
pTrunk
->pgno));

57726 
	gä“·ge_out
;

57736 ifÐ
	gpPage
==0 && 
SQLITE_OK
!=(
rc
 = 
bŒ“G‘Page
(
pBt
, 
iPage
, &
pPage
, 0)) ){

57737 
	gä“·ge_out
;

57739 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
);

57740 ifÐ
	grc
!=
SQLITE_OK
 ){

57741 
ä“·ge_out
;

57743 
put4by‹
(
pPage
->
aD©a
, 
iTrunk
);

57744 
put4by‹
(&
pPage
->
aD©a
[4], 0);

57745 
put4by‹
(&
pPage1
->
aD©a
[32], 
iPage
);

57746 
TRACE
(("FREE-PAGE: %d‚ewrunk…ag»¶acšg %d\n", 
pPage
->
pgno
, 
iTrunk
));

57748 
	gä“·ge_out
:

57749 ifÐ
pPage
 ){

57750 
pPage
->
isIn™
 = 0;

57752 
»Ëa£Page
(
pPage
);

57753 
»Ëa£Page
(
pTrunk
);

57754  
	grc
;

57756 
ä“Page
(
MemPage
 *
pPage
, *
pRC
){

57757 ifÐ(*
	gpRC
)==
SQLITE_OK
 ){

57758 *
pRC
 = 
ä“Page2
(
pPage
->
pBt
,…Page,…Page->
pgno
);

57767 
þ—rC–l
(

57768 
MemPage
 *
pPage
,

57769 *
pC–l
,

57770 
u16
 *
²Size


57772 
BtSh¬ed
 *
	gpBt
 = 
pPage
->
pBt
;

57773 
C–lInfo
 
	gšfo
;

57774 
Pgno
 
	govæPgno
;

57775 
	grc
;

57776 
	gnOvæ
;

57777 
u32
 
	govæPageSize
;

57779 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

57780 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
šfo
);

57781 *
	g²Size
 = 
šfo
.
nSize
;

57782 ifÐ
	gšfo
.
	giOv”æow
==0 ){

57783  
SQLITE_OK
;

57785 ifÐ
	gpC–l
+
	gšfo
.
	giOv”æow
+3 > 
	gpPage
->
	gaD©a
+pPage->
	gmaskPage
 ){

57786  
	gSQLITE_CORRUPT_BKPT
;

57788 
	govæPgno
 = 
g‘4by‹
(&
pC–l
[
šfo
.
iOv”æow
]);

57789 
as£¹
Ð
pBt
->
u§bËSize
 > 4 );

57790 
	govæPageSize
 = 
pBt
->
u§bËSize
 - 4;

57791 
	gnOvæ
 = (
šfo
.
nPaylßd
 - info.
nLoÿl
 + 
ovæPageSize
 - 1)/ovflPageSize;

57792 
as£¹
Ð
ovæPgno
==0 || 
nOvæ
>0 );

57793  
	gnOvæ
-- ){

57794 
Pgno
 
	giNext
 = 0;

57795 
MemPage
 *
	gpOvæ
 = 0;

57796 ifÐ
	govæPgno
<2 || ovæPgno>
bŒ“PagecouÁ
(
pBt
) ){

57800  
	gSQLITE_CORRUPT_BKPT
;

57802 ifÐ
	gnOvæ
 ){

57803 
	grc
 = 
g‘Ov”æowPage
(
pBt
, 
ovæPgno
, &
pOvæ
, &
iNext
);

57804 ifÐ
	grc
 ) „c;

57807 ifÐÐ
	gpOvæ
 || (ÕOvæ = 
bŒ“PageLookup
(
pBt
, 
ovæPgno
))!=0) )

57808 && 
sql™e3Pag”PageRefcouÁ
(
pOvæ
->
pDbPage
)!=1

57820 
rc
 = 
SQLITE_CORRUPT_BKPT
;

57822 
	grc
 = 
ä“Page2
(
pBt
, 
pOvæ
, 
ovæPgno
);

57825 ifÐ
	gpOvæ
 ){

57826 
sql™e3Pag”UÄef
(
pOvæ
->
pDbPage
);

57828 ifÐ
	grc
 ) „c;

57829 
	govæPgno
 = 
iNext
;

57831  
	gSQLITE_OK
;

57846 
fžlInC–l
(

57847 
MemPage
 *
pPage
,

57848 *
pC–l
,

57849 cÚ¡ *
pKey
, 
i64
 
nKey
,

57850 cÚ¡ *
pD©a
,
nD©a
,

57851 
nZ”o
,

57852 *
²Size


57854 
	gnPaylßd
;

57855 cÚ¡ 
u8
 *
	gpSrc
;

57856 
	gnSrc
, 
	gn
, 
	grc
;

57857 
	g¥aûLeá
;

57858 
MemPage
 *
	gpOvæ
 = 0;

57859 
MemPage
 *
	gpToR–—£
 = 0;

57860 *
	gpPriÜ
;

57861 *
	gpPaylßd
;

57862 
BtSh¬ed
 *
	gpBt
 = 
pPage
->
pBt
;

57863 
Pgno
 
	gpgnoOvæ
 = 0;

57864 
	gnH—d”
;

57866 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

57870 
as£¹
Ð
pC–l
<
pPage
->
aD©a
 ||…C–l>=&pPage->aD©a[
pBt
->
·geSize
]

57871 || 
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

57874 
	gnH—d”
 = 
pPage
->
chždPŒSize
;

57875 
	gnPaylßd
 = 
nD©a
 + 
nZ”o
;

57876 ifÐ
	gpPage
->
	gštKeyL—f
 ){

57877 
	gnH—d”
 +ð
putV¬št32
(&
pC–l
[
nH—d”
], 
nPaylßd
);

57879 
as£¹
Ð
nD©a
==0 );

57880 
as£¹
Ð
nZ”o
==0 );

57882 
	gnH—d”
 +ð
putV¬št
(&
pC–l
[
nH—d”
], *(
u64
*)&
nKey
);

57885 ifÐ
	gpPage
->
	gštKey
 ){

57886 
	gpSrc
 = 
pD©a
;

57887 
	gnSrc
 = 
nD©a
;

57888 
	gnD©a
 = 0;

57890 ifÐ
NEVER
(
nKey
>0x7ffffffà|| 
pKey
==0) ){

57891  
SQLITE_CORRUPT_BKPT
;

57893 
	gnPaylßd
 = ()
nKey
;

57894 
	gpSrc
 = 
pKey
;

57895 
	gnSrc
 = ()
nKey
;

57897 ifÐ
	gnPaylßd
<=
pPage
->
maxLoÿl
 ){

57898 
n
 = 
nH—d”
 + 
nPaylßd
;

57899 
‹¡ÿ£
Ð
n
==3 );

57900 
‹¡ÿ£
Ð
n
==4 );

57901 ifÐ
	gn
<4 )‚ = 4;

57902 *
	g²Size
 = 
n
;

57903 
	g¥aûLeá
 = 
nPaylßd
;

57904 
	gpPriÜ
 = 
pC–l
;

57906 
	gmn
 = 
pPage
->
mšLoÿl
;

57907 
	gn
 = 
mn
 + (
nPaylßd
 - mnè% (
pPage
->
pBt
->
u§bËSize
 - 4);

57908 
‹¡ÿ£
Ð
n
==
pPage
->
maxLoÿl
 );

57909 
‹¡ÿ£
Ð
n
==
pPage
->
maxLoÿl
+1 );

57910 ifÐ
	gn
 > 
	gpPage
->
	gmaxLoÿl
 )‚ = 
mn
;

57911 
	g¥aûLeá
 = 
n
;

57912 *
	g²Size
 = 
n
 + 
nH—d”
 + 4;

57913 
	gpPriÜ
 = &
pC–l
[
nH—d”
+
n
];

57915 
	gpPaylßd
 = &
pC–l
[
nH—d”
];

57929 #ià
SQLITE_DEBUG


57931 
C–lInfo
 
	gšfo
;

57932 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
šfo
);

57933 
as£¹
Ð
nH—d”
=()(
šfo
.
pPaylßd
 - 
pC–l
) );

57934 
as£¹
Ð
šfo
.
nKey
==nKey );

57935 
as£¹
Ð*
²Size
 =ð
šfo
.
nSize
 );

57936 
as£¹
Ð
¥aûLeá
 =ð
šfo
.
nLoÿl
 );

57937 
as£¹
Ð
pPriÜ
 =ð&
pC–l
[
šfo
.
iOv”æow
] );

57942  
	gnPaylßd
>0 ){

57943 ifÐ
	g¥aûLeá
==0 ){

57944 #iâdeà
SQLITE_OMIT_AUTOVACUUM


57945 
Pgno
 
pgnoPŒm­
 = 
pgnoOvæ
;

57946 ifÐ
	gpBt
->
	gautoVacuum
 ){

57948 
	gpgnoOvæ
++;

57950 
PTRMAP_ISPAGE
(
pBt
, 
pgnoOvæ
è|| 
	gpgnoOvæ
==
PENDING_BYTE_PAGE
(pBt)

57954 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pOvæ
, &
pgnoOvæ
,…gnoOvfl, 0);

57955 #iâdeà
SQLITE_OMIT_AUTOVACUUM


57966 ifÐ
	gpBt
->
	gautoVacuum
 && 
	grc
==
SQLITE_OK
 ){

57967 
u8
 
eTy³
 = (
pgnoPŒm­
?
PTRMAP_OVERFLOW2
:
PTRMAP_OVERFLOW1
);

57968 
±rm­Put
(
pBt
, 
pgnoOvæ
, 
eTy³
, 
pgnoPŒm­
, &
rc
);

57969 ifÐ
	grc
 ){

57970 
»Ëa£Page
(
pOvæ
);

57974 ifÐ
	grc
 ){

57975 
»Ëa£Page
(
pToR–—£
);

57976  
	grc
;

57981 
as£¹
Ð
pToR–—£
==0 || 
sql™e3Pag”Iswr™—bË
ÕToR–—£->
pDbPage
) );

57985 
as£¹
Ð
pPriÜ
<
pPage
->
aD©a
 ||…PriÜ>=&pPage->aD©a[
pBt
->
·geSize
]

57986 || 
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

57988 
put4by‹
(
pPriÜ
, 
pgnoOvæ
);

57989 
»Ëa£Page
(
pToR–—£
);

57990 
	gpToR–—£
 = 
pOvæ
;

57991 
	gpPriÜ
 = 
pOvæ
->
aD©a
;

57992 
put4by‹
(
pPriÜ
, 0);

57993 
	gpPaylßd
 = &
pOvæ
->
aD©a
[4];

57994 
	g¥aûLeá
 = 
pBt
->
u§bËSize
 - 4;

57996 
	gn
 = 
nPaylßd
;

57997 ifÐ
	gn
>
	g¥aûLeá
 )‚ = 
¥aûLeá
;

58001 
as£¹
Ð
pToR–—£
==0 || 
sql™e3Pag”Iswr™—bË
ÕToR–—£->
pDbPage
) );

58005 
as£¹
Ð
pPaylßd
<
pPage
->
aD©a
 ||…Paylßd>=&pPage->aD©a[
pBt
->
·geSize
]

58006 || 
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

58008 ifÐ
	gnSrc
>0 ){

58009 ifÐ
	gn
>
	gnSrc
 )‚ = 
nSrc
;

58010 
as£¹
Ð
pSrc
 );

58011 
memýy
(
pPaylßd
, 
pSrc
, 
n
);

58013 
mem£t
(
pPaylßd
, 0, 
n
);

58015 
	gnPaylßd
 -ð
n
;

58016 
	gpPaylßd
 +ð
n
;

58017 
	gpSrc
 +ð
n
;

58018 
	gnSrc
 -ð
n
;

58019 
	g¥aûLeá
 -ð
n
;

58020 ifÐ
	gnSrc
==0 ){

58021 
nSrc
 = 
nD©a
;

58022 
	gpSrc
 = 
pD©a
;

58025 
»Ëa£Page
(
pToR–—£
);

58026  
	gSQLITE_OK
;

58037 
drÝC–l
(
MemPage
 *
pPage
, 
idx
, 
sz
, *
pRC
){

58038 
u32
 
	gpc
;

58039 
u8
 *
	gd©a
;

58040 
u8
 *
	g±r
;

58041 
	grc
;

58042 
	ghdr
;

58044 ifÐ*
	gpRC
 ) ;

58046 
as£¹
Ð
idx
>=0 && idx<
pPage
->
nC–l
 );

58047 
as£¹
Ð
sz
==
ûÎSize
(
pPage
, 
idx
) );

58048 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

58049 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

58050 
	gd©a
 = 
pPage
->
aD©a
;

58051 
	g±r
 = &
pPage
->
aC–lIdx
[2*
idx
];

58052 
	gpc
 = 
g‘2by‹
(
±r
);

58053 
	ghdr
 = 
pPage
->
hdrOff£t
;

58054 
‹¡ÿ£
Ð
pc
==
g‘2by‹
(&
d©a
[
hdr
+5]) );

58055 
‹¡ÿ£
Ð
pc
+
sz
==
pPage
->
pBt
->
u§bËSize
 );

58056 ifÐ
	gpc
 < (
	gu32
)
g‘2by‹
(&
d©a
[
hdr
+5]è||…c+
	gsz
 > 
	gpPage
->
	gpBt
->
	gu§bËSize
 ){

58057 *
	gpRC
 = 
SQLITE_CORRUPT_BKPT
;

58060 
	grc
 = 
ä“S·û
(
pPage
, 
pc
, 
sz
);

58061 ifÐ
	grc
 ){

58062 *
	gpRC
 = 
rc
;

58065 
	gpPage
->
	gnC–l
--;

58066 
memmove
(
±r
,…Œ+2, 2*(
pPage
->
nC–l
 - 
idx
));

58067 
put2by‹
(&
d©a
[
hdr
+3], 
pPage
->
nC–l
);

58068 
	gpPage
->
	gnF»e
 += 2;

58083 
š£¹C–l
(

58084 
MemPage
 *
pPage
,

58085 
i
,

58086 
u8
 *
pC–l
,

58087 
sz
,

58088 
u8
 *
pTemp
,

58089 
Pgno
 
iChžd
,

58090 *
pRC


58092 
	gidx
 = 0;

58093 
	gj
;

58094 
	g’d
;

58095 
	gšs
;

58096 
	gûÎOff£t
;

58097 
u8
 *
	gd©a
;

58099 ifÐ*
	gpRC
 ) ;

58101 
as£¹
Ð
i
>=0 && i<=
pPage
->
nC–l
+pPage->
nOv”æow
 );

58102 
as£¹
Ð
MX_CELL
(
pPage
->
pBt
)<=10921 );

58103 
as£¹
Ð
pPage
->
nC–l
<=
MX_CELL
ÕPage->
pBt
è|| 
CORRUPT_DB
 );

58104 
as£¹
Ð
pPage
->
nOv”æow
<=
A¼aySize
ÕPage->
­Ovæ
) );

58105 
as£¹
Ð
A¼aySize
(
pPage
->
­Ovæ
)==A¼aySizeÕPage->
aiOvæ
) );

58106 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

58112 
as£¹
Ð
sz
==
ûÎSizePŒ
(
pPage
, 
pC–l
è|| (sz==8 && 
iChžd
>0) );

58113 ifÐ
	gpPage
->
	gnOv”æow
 || 
	gsz
+2>pPage->
	gnF»e
 ){

58114 ifÐ
	gpTemp
 ){

58115 
memýy
(
pTemp
, 
pC–l
, 
sz
);

58116 
	gpC–l
 = 
pTemp
;

58118 ifÐ
	giChžd
 ){

58119 
put4by‹
(
pC–l
, 
iChžd
);

58121 
	gj
 = 
pPage
->
nOv”æow
++;

58122 
as£¹
Ð
j
<()((
pPage
->
­Ovæ
)/(pPage->apOvfl[0])) );

58123 
	gpPage
->
	g­Ovæ
[
j
] = 
pC–l
;

58124 
	gpPage
->
	gaiOvæ
[
j
] = (
u16
)
i
;

58126 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
);

58127 ifÐ
	grc
!=
SQLITE_OK
 ){

58128 *
pRC
 = 
rc
;

58131 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

58132 
	gd©a
 = 
pPage
->
aD©a
;

58133 
	gûÎOff£t
 = 
pPage
->
ûÎOff£t
;

58134 
	g’d
 = 
ûÎOff£t
 + 2*
pPage
->
nC–l
;

58135 
	gšs
 = 
ûÎOff£t
 + 2*
i
;

58136 
	grc
 = 
®loÿ‹S·û
(
pPage
, 
sz
, &
idx
);

58137 ifÐ
	grc
 ){ *
	gpRC
 = 
rc
; ; }

58140 
as£¹
Ð
idx
 >ð
’d
+2 );

58141 
as£¹
Ð
idx
+
sz
 <ð()
pPage
->
pBt
->
u§bËSize
 );

58142 
	gpPage
->
	gnC–l
++;

58143 
	gpPage
->
	gnF»e
 -ð(
u16
)(2 + 
sz
);

58144 
memýy
(&
d©a
[
idx
], 
pC–l
, 
sz
);

58145 ifÐ
	giChžd
 ){

58146 
put4by‹
(&
d©a
[
idx
], 
iChžd
);

58148 
memmove
(&
d©a
[
šs
+2], &d©a[šs], 
’d
-ins);

58149 
put2by‹
(&
d©a
[
šs
], 
idx
);

58150 
put2by‹
(&
d©a
[
pPage
->
hdrOff£t
+3],…Page->
nC–l
);

58151 #iâdeà
SQLITE_OMIT_AUTOVACUUM


58152 ifÐ
	gpPage
->
	gpBt
->
	gautoVacuum
 ){

58156 
±rm­PutOvæPŒ
(
pPage
, 
pC–l
, 
pRC
);

58166 
as£mbËPage
(

58167 
MemPage
 *
pPage
,

58168 
nC–l
,

58169 
u8
 **
­C–l
,

58170 
u16
 *
aSize


58172 
	gi
;

58173 
u8
 *
	gpC–ÍŒ
;

58174 
	gûÎbody
;

58175 
u8
 * cÚ¡ 
	gd©a
 = 
pPage
->
aD©a
;

58176 cÚ¡ 
	ghdr
 = 
pPage
->
hdrOff£t
;

58177 cÚ¡ 
	gnU§bË
 = 
pPage
->
pBt
->
u§bËSize
;

58179 
as£¹
Ð
pPage
->
nOv”æow
==0 );

58180 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

58181 
as£¹
Ð
nC–l
>=0 &&‚C–l<=()
MX_CELL
(
pPage
->
pBt
)

58182 && ()
MX_CELL
(
pPage
->
pBt
)<=10921);

58183 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pPage
->
pDbPage
) );

58186 
as£¹
Ð
pPage
->
nC–l
==0 );

58187 
as£¹
Ð
g‘2by‹NÙZ”o
(&
d©a
[
hdr
+5])==
nU§bË
 );

58189 
	gpC–ÍŒ
 = &
pPage
->
aC–lIdx
[
nC–l
*2];

58190 
	gûÎbody
 = 
nU§bË
;

58191 
	gi
=
nC–l
-1; i>=0; i--){

58192 
u16
 
	gsz
 = 
aSize
[
i
];

58193 
	gpC–ÍŒ
 -= 2;

58194 
	gûÎbody
 -ð
sz
;

58195 
put2by‹
(
pC–ÍŒ
, 
ûÎbody
);

58196 
memýy
(&
d©a
[
ûÎbody
], 
­C–l
[
i
], 
sz
);

58198 
put2by‹
(&
d©a
[
hdr
+3], 
nC–l
);

58199 
put2by‹
(&
d©a
[
hdr
+5], 
ûÎbody
);

58200 
	gpPage
->
	gnF»e
 -ð(
nC–l
*2 + 
nU§bË
 - 
ûÎbody
);

58201 
	gpPage
->
	gnC–l
 = (
u16
)
nC–l
;

58216 
	#NN
 1

	)

58217 
	#NB
 (
NN
*2+1è

	)

58220 #iâdeà
SQLITE_OMIT_QUICKBALANCE


58244 
b®ªû_quick
(
MemPage
 *
pP¬’t
, MemPag*
pPage
, 
u8
 *
pS·û
){

58245 
BtSh¬ed
 *cÚ¡ 
	gpBt
 = 
pPage
->
pBt
;

58246 
MemPage
 *
	gpNew
;

58247 
	grc
;

58248 
Pgno
 
	gpgnoNew
;

58250 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pPage
->
pBt
->
mu‹x
) );

58251 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pP¬’t
->
pDbPage
) );

58252 
as£¹
Ð
pPage
->
nOv”æow
==1 );

58255 ifÐ
	gpPage
->
	gnC–l
==0 )  
SQLITE_CORRUPT_BKPT
;

58261 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pNew
, &
pgnoNew
, 0, 0);

58263 ifÐ
	grc
==
SQLITE_OK
 ){

58265 
u8
 *
pOut
 = &
pS·û
[4];

58266 
u8
 *
	gpC–l
 = 
pPage
->
­Ovæ
[0];

58267 
u16
 
	gszC–l
 = 
ûÎSizePŒ
(
pPage
, 
pC–l
);

58268 
u8
 *
	gpStÝ
;

58270 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pNew
->
pDbPage
) );

58271 
as£¹
Ð
pPage
->
aD©a
[0]==(
PTF_INTKEY
|
PTF_LEAFDATA
|
PTF_LEAF
) );

58272 
z”oPage
(
pNew
, 
PTF_INTKEY
|
PTF_LEAFDATA
|
PTF_LEAF
);

58273 
as£mbËPage
(
pNew
, 1, &
pC–l
, &
szC–l
);

58284 ifÐ
	gISAUTOVACUUM
 ){

58285 
±rm­Put
(
pBt
, 
pgnoNew
, 
PTRMAP_BTREE
, 
pP¬’t
->
pgno
, &
rc
);

58286 ifÐ
	gszC–l
>
	gpNew
->
	gmšLoÿl
 ){

58287 
±rm­PutOvæPŒ
(
pNew
, 
pC–l
, &
rc
);

58304 
	gpC–l
 = 
fšdC–l
(
pPage
,…Page->
nC–l
-1);

58305 
	gpStÝ
 = &
pC–l
[9];

58306  (*(
	gpC–l
++)&0x80è&&…C–l<
	gpStÝ
 );

58307 
	gpStÝ
 = &
pC–l
[9];

58308  ((*(
	gpOut
++èð*(
pC–l
++))&0x80è&&…C–l<
pStÝ
 );

58311 
š£¹C–l
(
pP¬’t
,…P¬’t->
nC–l
, 
pS·û
, ()(
pOut
-pSpace),

58312 0, 
pPage
->
pgno
, &
rc
);

58315 
put4by‹
(&
pP¬’t
->
aD©a
[pP¬’t->
hdrOff£t
+8], 
pgnoNew
);

58318 
»Ëa£Page
(
pNew
);

58321  
	grc
;

58331 
±rm­CheckPages
(
MemPage
 **
­Page
, 
nPage
){

58332 
	gi
, 
	gj
;

58333 
	gi
=0; i<
	gnPage
; i++){

58334 
Pgno
 
	gn
;

58335 
u8
 
	ge
;

58336 
MemPage
 *
	gpPage
 = 
­Page
[
i
];

58337 
BtSh¬ed
 *
	gpBt
 = 
pPage
->
pBt
;

58338 
as£¹
Ð
pPage
->
isIn™
 );

58340 
	gj
=0; j<
	gpPage
->
	gnC–l
; j++){

58341 
C–lInfo
 
	gšfo
;

58342 
u8
 *
	gz
;

58344 
	gz
 = 
fšdC–l
(
pPage
, 
j
);

58345 
bŒ“P¬£C–lPŒ
(
pPage
, 
z
, &
šfo
);

58346 ifÐ
	gšfo
.
	giOv”æow
 ){

58347 
Pgno
 
	govæ
 = 
g‘4by‹
(&
z
[
šfo
.
iOv”æow
]);

58348 
±rm­G‘
(
pBt
, 
ovæ
, &
e
, &
n
);

58349 
as£¹
Ð
n
==
pPage
->
pgno
 && 
e
==
PTRMAP_OVERFLOW1
 );

58351 ifÐ!
	gpPage
->
	gËaf
 ){

58352 
Pgno
 
	gchžd
 = 
g‘4by‹
(
z
);

58353 
±rm­G‘
(
pBt
, 
chžd
, &
e
, &
n
);

58354 
as£¹
Ð
n
==
pPage
->
pgno
 && 
e
==
PTRMAP_BTREE
 );

58357 ifÐ!
	gpPage
->
	gËaf
 ){

58358 
Pgno
 
	gchžd
 = 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]);

58359 
±rm­G‘
(
pBt
, 
chžd
, &
e
, &
n
);

58360 
as£¹
Ð
n
==
pPage
->
pgno
 && 
e
==
PTRMAP_BTREE
 );

58384 
cÝyNodeCÚ‹Á
(
MemPage
 *
pFrom
, MemPag*
pTo
, *
pRC
){

58385 ifÐ(*
	gpRC
)==
SQLITE_OK
 ){

58386 
BtSh¬ed
 * cÚ¡ 
pBt
 = 
pFrom
->pBt;

58387 
u8
 * cÚ¡ 
	gaFrom
 = 
pFrom
->
aD©a
;

58388 
u8
 * cÚ¡ 
	gaTo
 = 
pTo
->
aD©a
;

58389 cÚ¡ 
	giFromHdr
 = 
pFrom
->
hdrOff£t
;

58390 cÚ¡ 
	giToHdr
 = ((
pTo
->
pgno
==1) ? 100 : 0);

58391 
	grc
;

58392 
	giD©a
;

58395 
as£¹
Ð
pFrom
->
isIn™
 );

58396 
as£¹
Ð
pFrom
->
nF»e
>=
iToHdr
 );

58397 
as£¹
Ð
g‘2by‹
(&
aFrom
[
iFromHdr
+5]è<ð()
pBt
->
u§bËSize
 );

58400 
	giD©a
 = 
g‘2by‹
(&
aFrom
[
iFromHdr
+5]);

58401 
memýy
(&
aTo
[
iD©a
], &
aFrom
[iD©a], 
pBt
->
u§bËSize
-iData);

58402 
memýy
(&
aTo
[
iToHdr
], &
aFrom
[
iFromHdr
], 
pFrom
->
ûÎOff£t
 + 2*pFrom->
nC–l
);

58409 
	gpTo
->
	gisIn™
 = 0;

58410 
	grc
 = 
bŒ“In™Page
(
pTo
);

58411 ifÐ
	grc
!=
SQLITE_OK
 ){

58412 *
pRC
 = 
rc
;

58419 ifÐ
	gISAUTOVACUUM
 ){

58420 *
	gpRC
 = 
£tChždPŒm­s
(
pTo
);

58465 #ià
defšed
(
_MSC_VER
è&& _MSC_VER >ð1700 && defšed(
_M_ARM
)

58466 #´agm¨
Ýtimize
("", 
off
)

58468 
b®ªû_nÚroÙ
(

58469 
MemPage
 *
pP¬’t
,

58470 
iP¬’tIdx
,

58471 
u8
 *
aOvæS·û
,

58472 
isRoÙ
,

58473 
bBulk


58475 
BtSh¬ed
 *
	gpBt
;

58476 
	gnC–l
 = 0;

58477 
	gnMaxC–ls
 = 0;

58478 
	gnNew
 = 0;

58479 
	gnOld
;

58480 
	gi
, 
	gj
, 
	gk
;

58481 
	gnxDiv
;

58482 
	grc
 = 
SQLITE_OK
;

58483 
u16
 
	gËafCÜ»ùiÚ
;

58484 
	gËafD©a
;

58485 
	gu§bËS·û
;

58486 
	g·geFÏgs
;

58487 
	gsubtÙ®
;

58488 
	giS·û1
 = 0;

58489 
	giOvæS·û
 = 0;

58490 
	gszSü©ch
;

58491 
MemPage
 *
	g­Old
[
NB
];

58492 
MemPage
 *
	g­CÝy
[
NB
];

58493 
MemPage
 *
	g­New
[
NB
+2];

58494 
u8
 *
	gpRight
;

58495 
u8
 *
	g­Div
[
NB
-1];

58496 
	gútNew
[
NB
+2];

58497 
	gszNew
[
NB
+2];

58498 
u8
 **
	g­C–l
 = 0;

58499 
u16
 *
	gszC–l
;

58500 
u8
 *
	gaS·û1
;

58501 
Pgno
 
	gpgno
;

58503 
	gpBt
 = 
pP¬’t
->
pBt
;

58504 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

58505 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pP¬’t
->
pDbPage
) );

58508 
TRACE
(("BALANCE: begš…ag%d chžd oà%d\n", 
pPage
->
pgno
, 
pP¬’t
->pgno));

58516 
as£¹
Ð
pP¬’t
->
nOv”æow
==0 ||…Parent->nOverflow==1 );

58517 
as£¹
Ð
pP¬’t
->
nOv”æow
==0 ||…P¬’t->
aiOvæ
[0]==
iP¬’tIdx
 );

58519 ifÐ!
	gaOvæS·û
 ){

58520  
	gSQLITE_NOMEM
;

58534 
	gi
 = 
pP¬’t
->
nOv”æow
 +…P¬’t->
nC–l
;

58535 ifÐ
	gi
<2 ){

58536 
	gnxDiv
 = 0;

58538 
as£¹
Ð
bBulk
==0 || bBulk==1 );

58539 ifÐ
	giP¬’tIdx
==0 ){

58540 
nxDiv
 = 0;

58541 }ifÐ
	giP¬’tIdx
==
i
 ){

58542 
nxDiv
 = 
i
-2+
bBulk
;

58544 
as£¹
Ð
bBulk
==0 );

58545 
	gnxDiv
 = 
iP¬’tIdx
-1;

58547 
	gi
 = 2-
bBulk
;

58549 
	gnOld
 = 
i
+1;

58550 ifÐ(
	gi
+
	gnxDiv
-
	gpP¬’t
->
	gnOv”æow
)==
pP¬’t
->
nC–l
 ){

58551 
pRight
 = &
pP¬’t
->
aD©a
[pP¬’t->
hdrOff£t
+8];

58553 
	gpRight
 = 
fšdC–l
(
pP¬’t
, 
i
+
nxDiv
-pP¬’t->
nOv”æow
);

58555 
	gpgno
 = 
g‘4by‹
(
pRight
);

58557 
	grc
 = 
g‘AndIn™Page
(
pBt
, 
pgno
, &
­Old
[
i
], 0);

58558 ifÐ
	grc
 ){

58559 
mem£t
(
­Old
, 0, (
i
+1)*(
MemPage
*));

58560 
	gb®ªû_þ—nup
;

58562 
	gnMaxC–ls
 +ð1+
­Old
[
i
]->
nC–l
+­Old[i]->
nOv”æow
;

58563 ifÐ(
	gi
--)==0 ) ;

58565 ifÐ
	gi
+
	gnxDiv
==
pP¬’t
->
aiOvæ
[0] &&…P¬’t->
nOv”æow
 ){

58566 
­Div
[
i
] = 
pP¬’t
->
­Ovæ
[0];

58567 
	gpgno
 = 
g‘4by‹
(
­Div
[
i
]);

58568 
	gszNew
[
i
] = 
ûÎSizePŒ
(
pP¬’t
, 
­Div
[i]);

58569 
	gpP¬’t
->
	gnOv”æow
 = 0;

58571 
	g­Div
[
i
] = 
fšdC–l
(
pP¬’t
, i+
nxDiv
-pP¬’t->
nOv”æow
);

58572 
	gpgno
 = 
g‘4by‹
(
­Div
[
i
]);

58573 
	gszNew
[
i
] = 
ûÎSizePŒ
(
pP¬’t
, 
­Div
[i]);

58587 ifÐ
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_SECURE_DELETE
 ){

58588 
	giOff
;

58590 
	giOff
 = 
SQLITE_PTR_TO_INT
(
­Div
[
i
]è- SQLITE_PTR_TO_INT(
pP¬’t
->
aD©a
);

58591 ifÐ(
	giOff
+
	gszNew
[
i
])>()
	gpBt
->
	gu§bËSize
 ){

58592 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

58593 
mem£t
(
­Old
, 0, (
i
+1)*(
MemPage
*));

58594 
	gb®ªû_þ—nup
;

58596 
memýy
(&
aOvæS·û
[
iOff
], 
­Div
[
i
], 
szNew
[i]);

58597 
	g­Div
[
i
] = &
aOvæS·û
[
­Div
[i]-
pP¬’t
->
aD©a
];

58600 
drÝC–l
(
pP¬’t
, 
i
+
nxDiv
-pP¬’t->
nOv”æow
, 
szNew
[i], &
rc
);

58606 
	gnMaxC–ls
 = (
nMaxC–ls
 + 3)&~3;

58611 
	gk
 = 
pBt
->
·geSize
 + 
ROUND8
((
MemPage
));

58612 
	gszSü©ch
 =

58613 
nMaxC–ls
*(
u8
*)

58614 + 
nMaxC–ls
*(
u16
)

58615 + 
pBt
->
·geSize


58616 + 
k
*
nOld
;

58617 
	g­C–l
 = 
sql™e3Sü©chM®loc
Ð
szSü©ch
 );

58618 ifÐ
	g­C–l
==0 ){

58619 
rc
 = 
SQLITE_NOMEM
;

58620 
	gb®ªû_þ—nup
;

58622 
	gszC–l
 = (
u16
*)&
­C–l
[
nMaxC–ls
];

58623 
	gaS·û1
 = (
u8
*)&
szC–l
[
nMaxC–ls
];

58624 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
aS·û1
) );

58642 
	gËafCÜ»ùiÚ
 = 
­Old
[0]->
Ëaf
*4;

58643 
	gËafD©a
 = 
­Old
[0]->
štKeyL—f
;

58644 
	gi
=0; i<
	gnOld
; i++){

58645 
	glim™
;

58651 
MemPage
 *
	gpOld
 = 
­CÝy
[
i
] = (MemPage*)&
aS·û1
[
pBt
->
·geSize
 + 
k
*i];

58652 
memýy
(
pOld
, 
­Old
[
i
], (
MemPage
));

58653 
	gpOld
->
	gaD©a
 = (*)&
pOld
[1];

58654 
memýy
(
pOld
->
aD©a
, 
­Old
[
i
]->aD©a, 
pBt
->
·geSize
);

58656 
	glim™
 = 
pOld
->
nC–l
+pOld->
nOv”æow
;

58657 ifÐ
	gpOld
->
	gnOv”æow
>0 ){

58658 
	gj
=0; j<
	glim™
; j++){

58659 
as£¹
Ð
nC–l
<
nMaxC–ls
 );

58660 
	g­C–l
[
nC–l
] = 
fšdOv”æowC–l
(
pOld
, 
j
);

58661 
	gszC–l
[
nC–l
] = 
ûÎSizePŒ
(
pOld
, 
­C–l
[nCell]);

58662 
	gnC–l
++;

58665 
u8
 *
	gaD©a
 = 
pOld
->
aD©a
;

58666 
u16
 
	gmaskPage
 = 
pOld
->
maskPage
;

58667 
u16
 
	gûÎOff£t
 = 
pOld
->
ûÎOff£t
;

58668 
	gj
=0; j<
	glim™
; j++){

58669 
as£¹
Ð
nC–l
<
nMaxC–ls
 );

58670 
	g­C–l
[
nC–l
] = 
fšdC–lv2
(
aD©a
, 
maskPage
, 
ûÎOff£t
, 
j
);

58671 
	gszC–l
[
nC–l
] = 
ûÎSizePŒ
(
pOld
, 
­C–l
[nCell]);

58672 
	gnC–l
++;

58675 ifÐ
	gi
<
	gnOld
-1 && !
	gËafD©a
){

58676 
u16
 
	gsz
 = (u16)
szNew
[
i
];

58677 
u8
 *
	gpTemp
;

58678 
as£¹
Ð
nC–l
<
nMaxC–ls
 );

58679 
	gszC–l
[
nC–l
] = 
sz
;

58680 
	gpTemp
 = &
aS·û1
[
iS·û1
];

58681 
	giS·û1
 +ð
sz
;

58682 
as£¹
Ð
sz
<=
pBt
->
maxLoÿl
+23 );

58683 
as£¹
Ð
iS·û1
 <ð()
pBt
->
·geSize
 );

58684 
memýy
(
pTemp
, 
­Div
[
i
], 
sz
);

58685 
	g­C–l
[
nC–l
] = 
pTemp
+
ËafCÜ»ùiÚ
;

58686 
as£¹
Ð
ËafCÜ»ùiÚ
==0 ||†eafCorrection==4 );

58687 
	gszC–l
[
nC–l
] = 
szC–l
[nC–l] - 
ËafCÜ»ùiÚ
;

58688 ifÐ!
	gpOld
->
	gËaf
 ){

58689 
as£¹
Ð
ËafCÜ»ùiÚ
==0 );

58690 
as£¹
Ð
pOld
->
hdrOff£t
==0 );

58693 
memýy
(
­C–l
[
nC–l
], &
pOld
->
aD©a
[8], 4);

58695 
as£¹
Ð
ËafCÜ»ùiÚ
==4 );

58696 ifÐ
	gszC–l
[
nC–l
]<4 ){

58698 
	gszC–l
[
nC–l
] = 4;

58701 
	gnC–l
++;

58721 
	gu§bËS·û
 = 
pBt
->
u§bËSize
 - 12 + 
ËafCÜ»ùiÚ
;

58722 
	gsubtÙ®
=
k
=
i
=0; 
	gi
<
	gnC–l
; i++){

58723 
as£¹
Ð
i
<
nMaxC–ls
 );

58724 
	gsubtÙ®
 +ð
szC–l
[
i
] + 2;

58725 ifÐ
	gsubtÙ®
 > 
	gu§bËS·û
 ){

58726 
	gszNew
[
k
] = 
subtÙ®
 - 
szC–l
[
i
];

58727 
	gútNew
[
k
] = 
i
;

58728 ifÐ
	gËafD©a
 ){ 
	gi
--; }

58729 
	gsubtÙ®
 = 0;

58730 
	gk
++;

58731 ifÐ
	gk
>
	gNB
+1 ){ 
	grc
 = 
SQLITE_CORRUPT_BKPT
; 
	gb®ªû_þ—nup
; }

58734 
	gszNew
[
k
] = 
subtÙ®
;

58735 
	gútNew
[
k
] = 
nC–l
;

58736 
	gk
++;

58748 
	gi
=
k
-1; i>0; i--){

58749 
	gszRight
 = 
szNew
[
i
];

58750 
	gszLeá
 = 
szNew
[
i
-1];

58751 
	gr
;

58752 
	gd
;

58754 
	gr
 = 
útNew
[
i
-1] - 1;

58755 
	gd
 = 
r
 + 1 - 
ËafD©a
;

58756 
as£¹
Ð
d
<
nMaxC–ls
 );

58757 
as£¹
Ð
r
<
nMaxC–ls
 );

58758  
	gszRight
==0

58759 || (!
bBulk
 && 
szRight
+
szC–l
[
d
]+2<=
szLeá
-(szC–l[
r
]+2))

58761 
szRight
 +ð
szC–l
[
d
] + 2;

58762 
	gszLeá
 -ð
szC–l
[
r
] + 2;

58763 
	gútNew
[
i
-1]--;

58764 
	gr
 = 
útNew
[
i
-1] - 1;

58765 
	gd
 = 
r
 + 1 - 
ËafD©a
;

58767 
	gszNew
[
i
] = 
szRight
;

58768 
	gszNew
[
i
-1] = 
szLeá
;

58780 
as£¹
Ð
útNew
[0]>0 || (
pP¬’t
->
pgno
==1 &&…P¬’t->
nC–l
==0) );

58783 
TRACE
(("BALANCE: old: %d %d %d ",

58784 
­Old
[0]->
pgno
,

58785 
nOld
>=2 ? 
­Old
[1]->
pgno
 : 0,

58786 
nOld
>=3 ? 
­Old
[2]->
pgno
 : 0

58792 ifÐ
	g­Old
[0]->
	gpgno
<=1 ){

58793 
rc
 = 
SQLITE_CORRUPT_BKPT
;

58794 
	gb®ªû_þ—nup
;

58796 
	g·geFÏgs
 = 
­Old
[0]->
aD©a
[0];

58797 
	gi
=0; i<
	gk
; i++){

58798 
MemPage
 *
	gpNew
;

58799 ifÐ
	gi
<
	gnOld
 ){

58800 
	gpNew
 = 
­New
[
i
] = 
­Old
[i];

58801 
	g­Old
[
i
] = 0;

58802 
	grc
 = 
sql™e3Pag”Wr™e
(
pNew
->
pDbPage
);

58803 
	gnNew
++;

58804 ifÐ
	grc
 ) 
	gb®ªû_þ—nup
;

58806 
as£¹
Ð
i
>0 );

58807 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pNew
, &
pgno
, (
bBulk
 ? 1 :…gno), 0);

58808 ifÐ
	grc
 ) 
	gb®ªû_þ—nup
;

58809 
	g­New
[
i
] = 
pNew
;

58810 
	gnNew
++;

58813 ifÐ
	gISAUTOVACUUM
 ){

58814 
±rm­Put
(
pBt
, 
pNew
->
pgno
, 
PTRMAP_BTREE
, 
pP¬’t
->pgno, &
rc
);

58815 ifÐ
	grc
!=
SQLITE_OK
 ){

58816 
b®ªû_þ—nup
;

58824  
	gi
<
	gnOld
 ){

58825 
ä“Page
(
­Old
[
i
], &
rc
);

58826 ifÐ
	grc
 ) 
	gb®ªû_þ—nup
;

58827 
»Ëa£Page
(
­Old
[
i
]);

58828 
	g­Old
[
i
] = 0;

58829 
	gi
++;

58846 
	gi
=0; i<
	gk
-1; i++){

58847 
	gmšV
 = 
­New
[
i
]->
pgno
;

58848 
	gmšI
 = 
i
;

58849 
	gj
=
i
+1; j<
	gk
; j++){

58850 ifÐ
	g­New
[
j
]->
	gpgno
<()
	gmšV
 ){

58851 
	gmšI
 = 
j
;

58852 
	gmšV
 = 
­New
[
j
]->
pgno
;

58855 ifÐ
	gmšI
>
	gi
 ){

58856 
MemPage
 *
	gpT
;

58857 
	gpT
 = 
­New
[
i
];

58858 
	g­New
[
i
] = 
­New
[
mšI
];

58859 
	g­New
[
mšI
] = 
pT
;

58862 
TRACE
(("new: %d(%d) %d(%d) %d(%d) %d(%d) %d(%d)\n",

58863 
­New
[0]->
pgno
, 
szNew
[0],

58864 
nNew
>=2 ? 
­New
[1]->
pgno
 : 0,‚New>=2 ? 
szNew
[1] : 0,

58865 
nNew
>=3 ? 
­New
[2]->
pgno
 : 0,‚New>=3 ? 
szNew
[2] : 0,

58866 
nNew
>=4 ? 
­New
[3]->
pgno
 : 0,‚New>=4 ? 
szNew
[3] : 0,

58867 
nNew
>=5 ? 
­New
[4]->
pgno
 : 0,‚New>=5 ? 
szNew
[4] : 0));

58869 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pP¬’t
->
pDbPage
) );

58870 
put4by‹
(
pRight
, 
­New
[
nNew
-1]->
pgno
);

58876 
	gj
 = 0;

58877 
	gi
=0; i<
	gnNew
; i++){

58879 
MemPage
 *
	gpNew
 = 
­New
[
i
];

58880 
as£¹
Ð
j
<
nMaxC–ls
 );

58881 
z”oPage
(
pNew
, 
·geFÏgs
);

58882 
as£mbËPage
(
pNew
, 
útNew
[
i
]-
j
, &
­C–l
[j], &
szC–l
[j]);

58883 
as£¹
Ð
pNew
->
nC–l
>0 || (
nNew
==1 && 
útNew
[0]==0) );

58884 
as£¹
Ð
pNew
->
nOv”æow
==0 );

58886 
	gj
 = 
útNew
[
i
];

58891 
as£¹
Ð
i
<
nNew
-1 || 
j
==
nC–l
 );

58892 ifÐ
	gj
<
	gnC–l
 ){

58893 
u8
 *
	gpC–l
;

58894 
u8
 *
	gpTemp
;

58895 
	gsz
;

58897 
as£¹
Ð
j
<
nMaxC–ls
 );

58898 
	gpC–l
 = 
­C–l
[
j
];

58899 
	gsz
 = 
szC–l
[
j
] + 
ËafCÜ»ùiÚ
;

58900 
	gpTemp
 = &
aOvæS·û
[
iOvæS·û
];

58901 ifÐ!
	gpNew
->
	gËaf
 ){

58902 
memýy
(&
pNew
->
aD©a
[8], 
pC–l
, 4);

58903 }ifÐ
	gËafD©a
 ){

58909 
C–lInfo
 
	gšfo
;

58910 
	gj
--;

58911 
bŒ“P¬£C–lPŒ
(
pNew
, 
­C–l
[
j
], &
šfo
);

58912 
	gpC–l
 = 
pTemp
;

58913 
	gsz
 = 4 + 
putV¬št
(&
pC–l
[4], 
šfo
.
nKey
);

58914 
	gpTemp
 = 0;

58916 
	gpC–l
 -= 4;

58928 ifÐ
	gszC–l
[
j
]==4 ){

58929 
as£¹
(
ËafCÜ»ùiÚ
==4);

58930 
	gsz
 = 
ûÎSizePŒ
(
pP¬’t
, 
pC–l
);

58933 
	giOvæS·û
 +ð
sz
;

58934 
as£¹
Ð
sz
<=
pBt
->
maxLoÿl
+23 );

58935 
as£¹
Ð
iOvæS·û
 <ð()
pBt
->
·geSize
 );

58936 
š£¹C–l
(
pP¬’t
, 
nxDiv
, 
pC–l
, 
sz
, 
pTemp
, 
pNew
->
pgno
, &
rc
);

58937 ifÐ
	grc
!=
SQLITE_OK
 ) 
b®ªû_þ—nup
;

58938 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pP¬’t
->
pDbPage
) );

58940 
	gj
++;

58941 
	gnxDiv
++;

58944 
as£¹
Ð
j
==
nC–l
 );

58945 
as£¹
Ð
nOld
>0 );

58946 
as£¹
Ð
nNew
>0 );

58947 ifÐ(
	g·geFÏgs
 & 
	gPTF_LEAF
)==0 ){

58948 
u8
 *
zChžd
 = &
­CÝy
[
nOld
-1]->
aD©a
[8];

58949 
memýy
(&
­New
[
nNew
-1]->
aD©a
[8], 
zChžd
, 4);

58952 ifÐ
	gisRoÙ
 && 
	gpP¬’t
->
	gnC–l
==0 && 
pP¬’t
->
hdrOff£t
<=
­New
[0]->
nF»e
 ){

58967 
as£¹
Ð
nNew
==1 );

58968 
as£¹
Ð
­New
[0]->
nF»e
 ==

58969 (
g‘2by‹
(&
­New
[0]->
aD©a
[5])-­New[0]->
ûÎOff£t
-­New[0]->
nC–l
*2)

58971 
cÝyNodeCÚ‹Á
(
­New
[0], 
pP¬’t
, &
rc
);

58972 
ä“Page
(
­New
[0], &
rc
);

58973 }ifÐ
	gISAUTOVACUUM
 ){

59005 
MemPage
 *
	gpNew
 = 
­New
[0];

59006 
MemPage
 *
	gpOld
 = 
­CÝy
[0];

59007 
	gnOv”æow
 = 
pOld
->
nOv”æow
;

59008 
	giNextOld
 = 
pOld
->
nC–l
 + 
nOv”æow
;

59009 
	giOv”æow
 = (
nOv”æow
 ? 
pOld
->
aiOvæ
[0] : -1);

59010 
	gj
 = 0;

59011 
	gk
 = 0;

59012 
	gi
=0; i<
	gnC–l
; i++){

59013 
	gisDivid”
 = 0;

59014  
	gi
==
iNextOld
 ){

59018 
as£¹
Ð
j
+1 < 
A¼aySize
(
­CÝy
) );

59019 
as£¹
Ð
j
+1 < 
nOld
 );

59020 
	gpOld
 = 
­CÝy
[++
j
];

59021 
	giNextOld
 = 
i
 + !
ËafD©a
 + 
pOld
->
nC–l
 +…Old->
nOv”æow
;

59022 ifÐ
	gpOld
->
	gnOv”æow
 ){

59023 
	gnOv”æow
 = 
pOld
->
nOv”æow
;

59024 
	giOv”æow
 = 
i
 + !
ËafD©a
 + 
pOld
->
aiOvæ
[0];

59026 
	gisDivid”
 = !
ËafD©a
;

59029 
as£¹
(
nOv”æow
>0 || 
iOv”æow
<
i
 );

59030 
as£¹
(
nOv”æow
<2 || 
pOld
->
aiOvæ
[0]==pOld->aiOvfl[1]-1);

59031 
as£¹
(
nOv”æow
<3 || 
pOld
->
aiOvæ
[1]==pOld->aiOvfl[2]-1);

59032 ifÐ
	gi
==
iOv”æow
 ){

59033 
isDivid”
 = 1;

59034 ifÐ(--
	gnOv”æow
)>0 ){

59035 
	giOv”æow
++;

59039 ifÐ
	gi
==
útNew
[
k
] ){

59043 
pNew
 = 
­New
[++
k
];

59044 ifÐ!
	gËafD©a
 ) ;

59046 
as£¹
Ð
j
<
nOld
 );

59047 
as£¹
Ð
k
<
nNew
 );

59053 ifÐ
	gisDivid”
 || 
	gpOld
->
	gpgno
!=
pNew
->
pgno
 ){

59054 ifÐ!
ËafCÜ»ùiÚ
 ){

59055 
±rm­Put
(
pBt
, 
g‘4by‹
(
­C–l
[
i
]), 
PTRMAP_BTREE
, 
pNew
->
pgno
, &
rc
);

59057 ifÐ
	gszC–l
[
i
]>
	gpNew
->
	gmšLoÿl
 ){

59058 
±rm­PutOvæPŒ
(
pNew
, 
­C–l
[
i
], &
rc
);

59063 ifÐ!
	gËafCÜ»ùiÚ
 ){

59064 
	gi
=0; i<
	gnNew
; i++){

59065 
u32
 
	gkey
 = 
g‘4by‹
(&
­New
[
i
]->
aD©a
[8]);

59066 
±rm­Put
(
pBt
, 
key
, 
PTRMAP_BTREE
, 
­New
[
i
]->
pgno
, &
rc
);

59075 
±rm­CheckPages
(
­New
, 
nNew
);

59076 
±rm­CheckPages
(&
pP¬’t
, 1);

59080 
as£¹
Ð
pP¬’t
->
isIn™
 );

59081 
TRACE
(("BALANCE: finished: old=%d‚ew=%d cells=%d\n",

59082 
nOld
, 
nNew
, 
nC–l
));

59087 
	gb®ªû_þ—nup
:

59088 
sql™e3Sü©chF»e
(
­C–l
);

59089 
	gi
=0; i<
	gnOld
; i++){

59090 
»Ëa£Page
(
­Old
[
i
]);

59092 
	gi
=0; i<
	gnNew
; i++){

59093 
»Ëa£Page
(
­New
[
i
]);

59096  
	grc
;

59098 #ià
defšed
(
_MSC_VER
è&& _MSC_VER >ð1700 && defšed(
_M_ARM
)

59099 #´agm¨
Ýtimize
("", 
Ú
)

59122 
b®ªû_d“³r
(
MemPage
 *
pRoÙ
, MemPag**
µChžd
){

59123 
	grc
;

59124 
MemPage
 *
	gpChžd
 = 0;

59125 
Pgno
 
	gpgnoChžd
 = 0;

59126 
BtSh¬ed
 *
	gpBt
 = 
pRoÙ
->
pBt
;

59128 
as£¹
Ð
pRoÙ
->
nOv”æow
>0 );

59129 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

59135 
	grc
 = 
sql™e3Pag”Wr™e
(
pRoÙ
->
pDbPage
);

59136 ifÐ
	grc
==
SQLITE_OK
 ){

59137 
rc
 = 
®loÿ‹BŒ“Page
(
pBt
,&
pChžd
,&
pgnoChžd
,
pRoÙ
->
pgno
,0);

59138 
cÝyNodeCÚ‹Á
(
pRoÙ
, 
pChžd
, &
rc
);

59139 ifÐ
	gISAUTOVACUUM
 ){

59140 
±rm­Put
(
pBt
, 
pgnoChžd
, 
PTRMAP_BTREE
, 
pRoÙ
->
pgno
, &
rc
);

59143 ifÐ
	grc
 ){

59144 *
	gµChžd
 = 0;

59145 
»Ëa£Page
(
pChžd
);

59146  
	grc
;

59148 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pChžd
->
pDbPage
) );

59149 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pRoÙ
->
pDbPage
) );

59150 
as£¹
Ð
pChžd
->
nC–l
==
pRoÙ
->nCell );

59152 
TRACE
(("BALANCE: cÝy„oÙ %d iÁØ%d\n", 
pRoÙ
->
pgno
, 
pChžd
->pgno));

59155 
memýy
(
pChžd
->
aiOvæ
, 
pRoÙ
->aiOvfl,

59156 
pRoÙ
->
nOv”æow
*ÕRoÙ->
aiOvæ
[0]));

59157 
memýy
(
pChžd
->
­Ovæ
, 
pRoÙ
->apOvfl,

59158 
pRoÙ
->
nOv”æow
*ÕRoÙ->
­Ovæ
[0]));

59159 
	gpChžd
->
	gnOv”æow
 = 
pRoÙ
->
nOv”æow
;

59162 
z”oPage
(
pRoÙ
, 
pChžd
->
aD©a
[0] & ~
PTF_LEAF
);

59163 
put4by‹
(&
pRoÙ
->
aD©a
[pRoÙ->
hdrOff£t
+8], 
pgnoChžd
);

59165 *
	gµChžd
 = 
pChžd
;

59166  
	gSQLITE_OK
;

59179 
b®ªû
(
BtCursÜ
 *
pCur
){

59180 
	grc
 = 
SQLITE_OK
;

59181 cÚ¡ 
	gnMš
 = 
pCur
->
pBt
->
u§bËSize
 * 2 / 3;

59182 
u8
 
	gaB®ªûQuickS·û
[13];

59183 
u8
 *
	gpF»e
 = 0;

59185 
TESTONLY
Ð
b®ªû_quick_ÿÎed
 = 0 );

59186 
TESTONLY
Ð
b®ªû_d“³r_ÿÎed
 = 0 );

59189 
	giPage
 = 
pCur
->
iPage
;

59190 
MemPage
 *
	gpPage
 = 
pCur
->
­Page
[
iPage
];

59192 ifÐ
	giPage
==0 ){

59193 ifÐ
pPage
->
nOv”æow
 ){

59199 
as£¹
Ð(
b®ªû_d“³r_ÿÎed
++)==0 );

59200 
	grc
 = 
b®ªû_d“³r
(
pPage
, &
pCur
->
­Page
[1]);

59201 ifÐ
	grc
==
SQLITE_OK
 ){

59202 
pCur
->
iPage
 = 1;

59203 
	gpCur
->
	gaiIdx
[0] = 0;

59204 
	gpCur
->
	gaiIdx
[1] = 0;

59205 
as£¹
Ð
pCur
->
­Page
[1]->
nOv”æow
 );

59210 }ifÐ
	gpPage
->
	gnOv”æow
==0 && 
pPage
->
nF»e
<=
nMš
 ){

59213 
MemPage
 * cÚ¡ 
	gpP¬’t
 = 
pCur
->
­Page
[
iPage
-1];

59214 cÚ¡ 
	giIdx
 = 
pCur
->
aiIdx
[
iPage
-1];

59216 
	grc
 = 
sql™e3Pag”Wr™e
(
pP¬’t
->
pDbPage
);

59217 ifÐ
	grc
==
SQLITE_OK
 ){

59218 #iâdeà
SQLITE_OMIT_QUICKBALANCE


59219 ifÐ
pPage
->
štKeyL—f


59220 && 
pPage
->
nOv”æow
==1

59221 && 
pPage
->
aiOvæ
[0]=õPage->
nC–l


59222 && 
pP¬’t
->
pgno
!=1

59223 && 
pP¬’t
->
nC–l
==
iIdx


59238 
as£¹
Ð(
b®ªû_quick_ÿÎed
++)==0 );

59239 
	grc
 = 
b®ªû_quick
(
pP¬’t
, 
pPage
, 
aB®ªûQuickS·û
);

59260 
u8
 *
	gpS·û
 = 
sql™e3PageM®loc
(
pCur
->
pBt
->
·geSize
);

59261 
	grc
 = 
b®ªû_nÚroÙ
(
pP¬’t
, 
iIdx
, 
pS·û
, 
iPage
==1, 
pCur
->
hšts
);

59262 ifÐ
	gpF»e
 ){

59267 
sql™e3PageF»e
(
pF»e
);

59273 
	gpF»e
 = 
pS·û
;

59277 
	gpPage
->
	gnOv”æow
 = 0;

59280 
»Ëa£Page
(
pPage
);

59281 
	gpCur
->
	giPage
--;

59283 } 
	grc
==
SQLITE_OK
 );

59285 ifÐ
	gpF»e
 ){

59286 
sql™e3PageF»e
(
pF»e
);

59288  
	grc
;

59314 
SQLITE_PRIVATE
 
sql™e3BŒ“In£¹
(

59315 
BtCursÜ
 *
pCur
,

59316 cÚ¡ *
pKey
, 
i64
 
nKey
,

59317 cÚ¡ *
pD©a
, 
nD©a
,

59318 
nZ”o
,

59319 
­³ndBŸs
,

59320 
£ekResuÉ


59322 
	grc
;

59323 
	gloc
 = 
£ekResuÉ
;

59324 
	gszNew
 = 0;

59325 
	gidx
;

59326 
MemPage
 *
	gpPage
;

59327 
BŒ“
 *
	gp
 = 
pCur
->
pBŒ“
;

59328 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59329 *
	gÞdC–l
;

59330 *
	gÃwC–l
 = 0;

59332 ifÐ
	gpCur
->
	geS‹
==
CURSOR_FAULT
 ){

59333 
as£¹
Ð
pCur
->
skNext
!=
SQLITE_OK
 );

59334  
	gpCur
->
	gskNext
;

59337 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

59338 
as£¹
Ð(
pCur
->
curFÏgs
 & 
BTCF_Wr™eFÏg
)!=0

59339 && 
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE


59340 && (
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)==0 );

59341 
as£¹
Ð
hasSh¬edCacheTabËLock
(
p
, 
pCur
->
pgnoRoÙ
,…Cur->
pKeyInfo
!=0, 2) );

59348 
as£¹
Ð(
pKey
==0)==(
pCur
->
pKeyInfo
==0) );

59361 
	grc
 = 
§veAÎCursÜs
(
pBt
, 
pCur
->
pgnoRoÙ
,…Cur);

59362 ifÐ
	grc
 ) „c;

59364 ifÐ
	gpCur
->
	gpKeyInfo
==0 ){

59367 
šv®id©eInüblobCursÜs
(
p
, 
nKey
, 0);

59372 ifÐ(
	gpCur
->
	gcurFÏgs
&
	gBTCF_V®idNKey
)!=0 && 
nKey
>0

59373 && 
pCur
->
šfo
.
nKey
==nKey-1 ){

59374 
loc
 = -1;

59378 ifÐ!
	gloc
 ){

59379 
	grc
 = 
bŒ“Mov‘o
(
pCur
, 
pKey
, 
nKey
, 
­³ndBŸs
, &
loc
);

59380 ifÐ
	grc
 ) „c;

59382 
as£¹
Ð
pCur
->
eS‹
==
CURSOR_VALID
 || (pCur->eS‹==
CURSOR_INVALID
 && 
loc
) );

59384 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

59385 
as£¹
Ð
pPage
->
štKey
 || 
nKey
>=0 );

59386 
as£¹
Ð
pPage
->
Ëaf
 || !pPage->
štKey
 );

59388 
TRACE
(("INSERT:able=%d‚key=%lld‚data=%d…age=%d %s\n",

59389 
pCur
->
pgnoRoÙ
, 
nKey
, 
nD©a
, 
pPage
->
pgno
,

59390 
loc
==0 ? "overwrite" : "newƒntry"));

59391 
as£¹
Ð
pPage
->
isIn™
 );

59392 
	gÃwC–l
 = 
pBt
->
pTmpS·û
;

59393 
as£¹
Ð
ÃwC–l
!=0 );

59394 
	grc
 = 
fžlInC–l
(
pPage
, 
ÃwC–l
, 
pKey
, 
nKey
, 
pD©a
, 
nD©a
, 
nZ”o
, &
szNew
);

59395 ifÐ
	grc
 ) 
	g’d_š£¹
;

59396 
as£¹
Ð
szNew
==
ûÎSizePŒ
(
pPage
, 
ÃwC–l
) );

59397 
as£¹
Ð
szNew
 <ð
MX_CELL_SIZE
(
pBt
) );

59398 
	gidx
 = 
pCur
->
aiIdx
[pCur->
iPage
];

59399 ifÐ
	gloc
==0 ){

59400 
u16
 
szOld
;

59401 
as£¹
Ð
idx
<
pPage
->
nC–l
 );

59402 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
);

59403 ifÐ
	grc
 ){

59404 
	g’d_š£¹
;

59406 
	gÞdC–l
 = 
fšdC–l
(
pPage
, 
idx
);

59407 ifÐ!
	gpPage
->
	gËaf
 ){

59408 
memýy
(
ÃwC–l
, 
ÞdC–l
, 4);

59410 
	grc
 = 
þ—rC–l
(
pPage
, 
ÞdC–l
, &
szOld
);

59411 
drÝC–l
(
pPage
, 
idx
, 
szOld
, &
rc
);

59412 ifÐ
	grc
 ) 
	g’d_š£¹
;

59413 }ifÐ
	gloc
<0 && 
	gpPage
->
	gnC–l
>0 ){

59414 
as£¹
Ð
pPage
->
Ëaf
 );

59415 
	gidx
 = ++
pCur
->
aiIdx
[pCur->
iPage
];

59417 
as£¹
Ð
pPage
->
Ëaf
 );

59419 
š£¹C–l
(
pPage
, 
idx
, 
ÃwC–l
, 
szNew
, 0, 0, &
rc
);

59420 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pPage
->
nC–l
>0 ||…Page->
nOv”æow
>0 );

59442 
	gpCur
->
	gšfo
.
	gnSize
 = 0;

59443 ifÐ
	grc
==
SQLITE_OK
 && 
pPage
->
nOv”æow
 ){

59444 
pCur
->
curFÏgs
 &ð~(
BTCF_V®idNKey
);

59445 
	grc
 = 
b®ªû
(
pCur
);

59451 
	gpCur
->
	g­Page
[
pCur
->
iPage
]->
	gnOv”æow
 = 0;

59452 
	gpCur
->
	geS‹
 = 
CURSOR_INVALID
;

59454 
as£¹
Ð
pCur
->
­Page
[pCur->
iPage
]->
nOv”æow
==0 );

59456 
	g’d_š£¹
:

59457  
rc
;

59464 
SQLITE_PRIVATE
 
sql™e3BŒ“D–‘e
(
BtCursÜ
 *
pCur
){

59465 
BŒ“
 *
	gp
 = 
pCur
->
pBŒ“
;

59466 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59467 
	grc
;

59468 
MemPage
 *
	gpPage
;

59469 *
	gpC–l
;

59470 
	giC–lIdx
;

59471 
	giC–lD•th
;

59472 
u16
 
	gszC–l
;

59474 
as£¹
Ð
cursÜHÞdsMu‹x
(
pCur
) );

59475 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

59476 
as£¹
Ð(
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)==0 );

59477 
as£¹
Ð
pCur
->
curFÏgs
 & 
BTCF_Wr™eFÏg
 );

59478 
as£¹
Ð
hasSh¬edCacheTabËLock
(
p
, 
pCur
->
pgnoRoÙ
,…Cur->
pKeyInfo
!=0, 2) );

59479 
as£¹
Ð!
hasR—dCÚæiùs
(
p
, 
pCur
->
pgnoRoÙ
) );

59481 ifÐ
NEVER
(
pCur
->
aiIdx
[pCur->
iPage
]>õCur->
­Page
[pCur->iPage]->
nC–l
)

59482 || 
NEVER
(
pCur
->
eS‹
!=
CURSOR_VALID
)

59484  
SQLITE_ERROR
;

59487 
	giC–lD•th
 = 
pCur
->
iPage
;

59488 
	giC–lIdx
 = 
pCur
->
aiIdx
[
iC–lD•th
];

59489 
	gpPage
 = 
pCur
->
­Page
[
iC–lD•th
];

59490 
	gpC–l
 = 
fšdC–l
(
pPage
, 
iC–lIdx
);

59499 ifÐ!
	gpPage
->
	gËaf
 ){

59500 
	gnÙU£d
 = 0;

59501 
	grc
 = 
sql™e3BŒ“P»vious
(
pCur
, &
nÙU£d
);

59502 ifÐ
	grc
 ) „c;

59510 
	grc
 = 
§veAÎCursÜs
(
pBt
, 
pCur
->
pgnoRoÙ
,…Cur);

59511 ifÐ
	grc
 ) „c;

59515 ifÐ
	gpCur
->
	gpKeyInfo
==0 ){

59516 
šv®id©eInüblobCursÜs
(
p
, 
pCur
->
šfo
.
nKey
, 0);

59519 
	grc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
);

59520 ifÐ
	grc
 ) „c;

59521 
	grc
 = 
þ—rC–l
(
pPage
, 
pC–l
, &
szC–l
);

59522 
drÝC–l
(
pPage
, 
iC–lIdx
, 
szC–l
, &
rc
);

59523 ifÐ
	grc
 ) „c;

59530 ifÐ!
	gpPage
->
	gËaf
 ){

59531 
MemPage
 *
	gpL—f
 = 
pCur
->
­Page
[pCur->
iPage
];

59532 
	gnC–l
;

59533 
Pgno
 
	gn
 = 
pCur
->
­Page
[
iC–lD•th
+1]->
pgno
;

59534 *
	gpTmp
;

59536 
	gpC–l
 = 
fšdC–l
(
pL—f
,…L—f->
nC–l
-1);

59537 
	gnC–l
 = 
ûÎSizePŒ
(
pL—f
, 
pC–l
);

59538 
as£¹
Ð
MX_CELL_SIZE
(
pBt
è>ð
nC–l
 );

59539 
	gpTmp
 = 
pBt
->
pTmpS·û
;

59540 
as£¹
Ð
pTmp
!=0 );

59541 
	grc
 = 
sql™e3Pag”Wr™e
(
pL—f
->
pDbPage
);

59542 
š£¹C–l
(
pPage
, 
iC–lIdx
, 
pC–l
-4, 
nC–l
+4, 
pTmp
, 
n
, &
rc
);

59543 
drÝC–l
(
pL—f
,…L—f->
nC–l
-1,‚C–l, &
rc
);

59544 ifÐ
	grc
 ) „c;

59562 
	grc
 = 
b®ªû
(
pCur
);

59563 ifÐ
	grc
==
SQLITE_OK
 && 
pCur
->
iPage
>
iC–lD•th
 ){

59564  
pCur
->
iPage
>
iC–lD•th
 ){

59565 
»Ëa£Page
(
pCur
->
­Page
[pCur->
iPage
--]);

59567 
	grc
 = 
b®ªû
(
pCur
);

59570 ifÐ
	grc
==
SQLITE_OK
 ){

59571 
moveToRoÙ
(
pCur
);

59573  
	grc
;

59587 
bŒ“C»©eTabË
(
BŒ“
 *
p
, *
piTabË
, 
ü—‹TabFÏgs
){

59588 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59589 
MemPage
 *
	gpRoÙ
;

59590 
Pgno
 
	gpgnoRoÙ
;

59591 
	grc
;

59592 
	g±fFÏgs
;

59594 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

59595 
as£¹
Ð
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

59596 
as£¹
Ð(
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)==0 );

59598 #ifdeà
SQLITE_OMIT_AUTOVACUUM


59599 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pRoÙ
, &
pgnoRoÙ
, 1, 0);

59600 ifÐ
	grc
 ){

59601  
	grc
;

59604 ifÐ
	gpBt
->
	gautoVacuum
 ){

59605 
Pgno
 
	gpgnoMove
;

59606 
MemPage
 *
	gpPageMove
;

59613 
šv®id©eAÎOv”æowCache
(
pBt
);

59619 
sql™e3BŒ“G‘M‘a
(
p
, 
BTREE_LARGEST_ROOT_PAGE
, &
pgnoRoÙ
);

59620 
	gpgnoRoÙ
++;

59625  
	gpgnoRoÙ
==
PTRMAP_PAGENO
(
pBt
, 
pgnoRoÙ
) ||

59626 
	gpgnoRoÙ
==
PENDING_BYTE_PAGE
(
pBt
) ){

59627 
pgnoRoÙ
++;

59629 
as£¹
Ð
pgnoRoÙ
>=3 );

59635 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pPageMove
, &
pgnoMove
, 
pgnoRoÙ
, 
BTALLOC_EXACT
);

59636 ifÐ
	grc
!=
SQLITE_OK
 ){

59637  
rc
;

59640 ifÐ
	gpgnoMove
!=
pgnoRoÙ
 ){

59647 
u8
 
eTy³
 = 0;

59648 
Pgno
 
	giPŒPage
 = 0;

59653 
	grc
 = 
§veAÎCursÜs
(
pBt
, 0, 0);

59654 
»Ëa£Page
(
pPageMove
);

59655 ifÐ
	grc
!=
SQLITE_OK
 ){

59656  
rc
;

59660 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
pgnoRoÙ
, &
pRoÙ
, 0);

59661 ifÐ
	grc
!=
SQLITE_OK
 ){

59662  
rc
;

59664 
	grc
 = 
±rm­G‘
(
pBt
, 
pgnoRoÙ
, &
eTy³
, &
iPŒPage
);

59665 ifÐ
	geTy³
==
PTRMAP_ROOTPAGE
 || 
eTy³
==
PTRMAP_FREEPAGE
 ){

59666 
rc
 = 
SQLITE_CORRUPT_BKPT
;

59668 ifÐ
	grc
!=
SQLITE_OK
 ){

59669 
»Ëa£Page
(
pRoÙ
);

59670  
	grc
;

59672 
as£¹
Ð
eTy³
!=
PTRMAP_ROOTPAGE
 );

59673 
as£¹
Ð
eTy³
!=
PTRMAP_FREEPAGE
 );

59674 
	grc
 = 
»loÿ‹Page
(
pBt
, 
pRoÙ
, 
eTy³
, 
iPŒPage
, 
pgnoMove
, 0);

59675 
»Ëa£Page
(
pRoÙ
);

59678 ifÐ
	grc
!=
SQLITE_OK
 ){

59679  
rc
;

59681 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
pgnoRoÙ
, &
pRoÙ
, 0);

59682 ifÐ
	grc
!=
SQLITE_OK
 ){

59683  
rc
;

59685 
	grc
 = 
sql™e3Pag”Wr™e
(
pRoÙ
->
pDbPage
);

59686 ifÐ
	grc
!=
SQLITE_OK
 ){

59687 
»Ëa£Page
(
pRoÙ
);

59688  
	grc
;

59691 
	gpRoÙ
 = 
pPageMove
;

59695 
±rm­Put
(
pBt
, 
pgnoRoÙ
, 
PTRMAP_ROOTPAGE
, 0, &
rc
);

59696 ifÐ
	grc
 ){

59697 
»Ëa£Page
(
pRoÙ
);

59698  
	grc
;

59705 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pBt
->
pPage1
->
pDbPage
) );

59706 
	grc
 = 
sql™e3BŒ“Upd©eM‘a
(
p
, 4, 
pgnoRoÙ
);

59707 ifÐ
NEVER
(
rc
) ){

59708 
»Ëa£Page
(
pRoÙ
);

59709  
	grc
;

59713 
	grc
 = 
®loÿ‹BŒ“Page
(
pBt
, &
pRoÙ
, &
pgnoRoÙ
, 1, 0);

59714 ifÐ
	grc
 ) „c;

59717 
as£¹
Ð
sql™e3Pag”Iswr™—bË
(
pRoÙ
->
pDbPage
) );

59718 ifÐ
	gü—‹TabFÏgs
 & 
	gBTREE_INTKEY
 ){

59719 
	g±fFÏgs
 = 
PTF_INTKEY
 | 
PTF_LEAFDATA
 | 
PTF_LEAF
;

59721 
	g±fFÏgs
 = 
PTF_ZERODATA
 | 
PTF_LEAF
;

59723 
z”oPage
(
pRoÙ
, 
±fFÏgs
);

59724 
sql™e3Pag”UÄef
(
pRoÙ
->
pDbPage
);

59725 
as£¹
Ð(
pBt
->
Ý’FÏgs
 & 
BTREE_SINGLE
)==0 || 
pgnoRoÙ
==2 );

59726 *
	gpiTabË
 = ()
pgnoRoÙ
;

59727  
	gSQLITE_OK
;

59729 
SQLITE_PRIVATE
 
sql™e3BŒ“C»©eTabË
(
BŒ“
 *
p
, *
piTabË
, 
æags
){

59730 
	grc
;

59731 
sql™e3BŒ“EÁ”
(
p
);

59732 
	grc
 = 
bŒ“C»©eTabË
(
p
, 
piTabË
, 
æags
);

59733 
sql™e3BŒ“L—ve
(
p
);

59734  
	grc
;

59741 
þ—rD©aba£Page
(

59742 
BtSh¬ed
 *
pBt
,

59743 
Pgno
 
pgno
,

59744 
ä“PageFÏg
,

59745 *
²Chªge


59747 
MemPage
 *
	gpPage
;

59748 
	grc
;

59749 *
	gpC–l
;

59750 
	gi
;

59751 
	ghdr
;

59752 
u16
 
	gszC–l
;

59754 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pBt
->
mu‹x
) );

59755 ifÐ
	gpgno
>
bŒ“PagecouÁ
(
pBt
) ){

59756  
	gSQLITE_CORRUPT_BKPT
;

59759 
	grc
 = 
g‘AndIn™Page
(
pBt
, 
pgno
, &
pPage
, 0);

59760 ifÐ
	grc
 ) „c;

59761 
	ghdr
 = 
pPage
->
hdrOff£t
;

59762 
	gi
=0; i<
	gpPage
->
	gnC–l
; i++){

59763 
	gpC–l
 = 
fšdC–l
(
pPage
, 
i
);

59764 ifÐ!
	gpPage
->
	gËaf
 ){

59765 
	grc
 = 
þ—rD©aba£Page
(
pBt
, 
g‘4by‹
(
pC–l
), 1, 
²Chªge
);

59766 ifÐ
	grc
 ) 
	gþ—rd©aba£·ge_out
;

59768 
	grc
 = 
þ—rC–l
(
pPage
, 
pC–l
, &
szC–l
);

59769 ifÐ
	grc
 ) 
	gþ—rd©aba£·ge_out
;

59771 ifÐ!
	gpPage
->
	gËaf
 ){

59772 
	grc
 = 
þ—rD©aba£Page
(
pBt
, 
g‘4by‹
(&
pPage
->
aD©a
[
hdr
+8]), 1, 
²Chªge
);

59773 ifÐ
	grc
 ) 
	gþ—rd©aba£·ge_out
;

59774 }ifÐ
	g²Chªge
 ){

59775 
as£¹
Ð
pPage
->
štKey
 );

59776 *
	g²Chªge
 +ð
pPage
->
nC–l
;

59778 ifÐ
	gä“PageFÏg
 ){

59779 
ä“Page
(
pPage
, &
rc
);

59780 }ifÐ(
	grc
 = 
sql™e3Pag”Wr™e
(
pPage
->
pDbPage
))==0 ){

59781 
z”oPage
(
pPage
,…Page->
aD©a
[
hdr
] | 
PTF_LEAF
);

59784 
	gþ—rd©aba£·ge_out
:

59785 
»Ëa£Page
(
pPage
);

59786  
	grc
;

59802 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬TabË
(
BŒ“
 *
p
, 
iTabË
, *
²Chªge
){

59803 
	grc
;

59804 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59805 
sql™e3BŒ“EÁ”
(
p
);

59806 
as£¹
Ð
p
->
šT¿ns
==
TRANS_WRITE
 );

59808 
	grc
 = 
§veAÎCursÜs
(
pBt
, (
Pgno
)
iTabË
, 0);

59810 ifÐ
	gSQLITE_OK
==
rc
 ){

59814 
šv®id©eInüblobCursÜs
(
p
, 0, 1);

59815 
	grc
 = 
þ—rD©aba£Page
(
pBt
, (
Pgno
)
iTabË
, 0, 
²Chªge
);

59817 
sql™e3BŒ“L—ve
(
p
);

59818  
	grc
;

59826 
SQLITE_PRIVATE
 
sql™e3BŒ“CË¬TabËOfCursÜ
(
BtCursÜ
 *
pCur
){

59827  
sql™e3BŒ“CË¬TabË
(
pCur
->
pBŒ“
,…Cur->
pgnoRoÙ
, 0);

59850 
bŒ“DrÝTabË
(
BŒ“
 *
p
, 
Pgno
 
iTabË
, *
piMoved
){

59851 
	grc
;

59852 
MemPage
 *
	gpPage
 = 0;

59853 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59855 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
) );

59856 
as£¹
Ð
p
->
šT¿ns
==
TRANS_WRITE
 );

59866 ifÐ
NEVER
(
pBt
->
pCursÜ
) ){

59867 
sql™e3CÚÃùiÚBlocked
(
p
->
db
, 
pBt
->
pCursÜ
->
pBŒ“
->db);

59868  
	gSQLITE_LOCKED_SHAREDCACHE
;

59871 
	grc
 = 
bŒ“G‘Page
(
pBt
, (
Pgno
)
iTabË
, &
pPage
, 0);

59872 ifÐ
	grc
 ) „c;

59873 
	grc
 = 
sql™e3BŒ“CË¬TabË
(
p
, 
iTabË
, 0);

59874 ifÐ
	grc
 ){

59875 
»Ëa£Page
(
pPage
);

59876  
	grc
;

59879 *
	gpiMoved
 = 0;

59881 ifÐ
	giTabË
>1 ){

59882 #ifdeà
SQLITE_OMIT_AUTOVACUUM


59883 
ä“Page
(
pPage
, &
rc
);

59884 
»Ëa£Page
(
pPage
);

59886 ifÐ
	gpBt
->
	gautoVacuum
 ){

59887 
Pgno
 
	gmaxRoÙPgno
;

59888 
sql™e3BŒ“G‘M‘a
(
p
, 
BTREE_LARGEST_ROOT_PAGE
, &
maxRoÙPgno
);

59890 ifÐ
	giTabË
==
maxRoÙPgno
 ){

59894 
ä“Page
(
pPage
, &
rc
);

59895 
»Ëa£Page
(
pPage
);

59896 ifÐ
	grc
!=
SQLITE_OK
 ){

59897  
rc
;

59904 
MemPage
 *
	gpMove
;

59905 
»Ëa£Page
(
pPage
);

59906 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
maxRoÙPgno
, &
pMove
, 0);

59907 ifÐ
	grc
!=
SQLITE_OK
 ){

59908  
rc
;

59910 
	grc
 = 
»loÿ‹Page
(
pBt
, 
pMove
, 
PTRMAP_ROOTPAGE
, 0, 
iTabË
, 0);

59911 
»Ëa£Page
(
pMove
);

59912 ifÐ
	grc
!=
SQLITE_OK
 ){

59913  
rc
;

59915 
	gpMove
 = 0;

59916 
	grc
 = 
bŒ“G‘Page
(
pBt
, 
maxRoÙPgno
, &
pMove
, 0);

59917 
ä“Page
(
pMove
, &
rc
);

59918 
»Ëa£Page
(
pMove
);

59919 ifÐ
	grc
!=
SQLITE_OK
 ){

59920  
rc
;

59922 *
	gpiMoved
 = 
maxRoÙPgno
;

59930 
	gmaxRoÙPgno
--;

59931  
	gmaxRoÙPgno
==
PENDING_BYTE_PAGE
(
pBt
)

59932 || 
PTRMAP_ISPAGE
(
pBt
, 
maxRoÙPgno
) ){

59933 
	gmaxRoÙPgno
--;

59935 
as£¹
Ð
maxRoÙPgno
!=
PENDING_BYTE_PAGE
(
pBt
) );

59937 
	grc
 = 
sql™e3BŒ“Upd©eM‘a
(
p
, 4, 
maxRoÙPgno
);

59939 
ä“Page
(
pPage
, &
rc
);

59940 
»Ëa£Page
(
pPage
);

59948 
z”oPage
(
pPage
, 
PTF_INTKEY
|
PTF_LEAF
 );

59949 
»Ëa£Page
(
pPage
);

59951  
	grc
;

59953 
SQLITE_PRIVATE
 
sql™e3BŒ“DrÝTabË
(
BŒ“
 *
p
, 
iTabË
, *
piMoved
){

59954 
	grc
;

59955 
sql™e3BŒ“EÁ”
(
p
);

59956 
	grc
 = 
bŒ“DrÝTabË
(
p
, 
iTabË
, 
piMoved
);

59957 
sql™e3BŒ“L—ve
(
p
);

59958  
	grc
;

59975 
SQLITE_PRIVATE
 
sql™e3BŒ“G‘M‘a
(
BŒ“
 *
p
, 
idx
, 
u32
 *
pM‘a
){

59976 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

59978 
sql™e3BŒ“EÁ”
(
p
);

59979 
as£¹
Ð
p
->
šT¿ns
>
TRANS_NONE
 );

59980 
as£¹
Ð
SQLITE_OK
==
qu”ySh¬edCacheTabËLock
(
p
, 
MASTER_ROOT
, 
READ_LOCK
) );

59981 
as£¹
Ð
pBt
->
pPage1
 );

59982 
as£¹
Ð
idx
>=0 && idx<=15 );

59984 *
	gpM‘a
 = 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[36 + 
idx
*4]);

59988 #ifdeà
SQLITE_OMIT_AUTOVACUUM


59989 ifÐ
	gidx
==
BTREE_LARGEST_ROOT_PAGE
 && *
pM‘a
>0 ){

59990 
pBt
->
btsFÏgs
 |ð
BTS_READ_ONLY
;

59994 
sql™e3BŒ“L—ve
(
p
);

60001 
SQLITE_PRIVATE
 
sql™e3BŒ“Upd©eM‘a
(
BŒ“
 *
p
, 
idx
, 
u32
 
iM‘a
){

60002 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

60003 *
	gpP1
;

60004 
	grc
;

60005 
as£¹
Ð
idx
>=1 && idx<=15 );

60006 
sql™e3BŒ“EÁ”
(
p
);

60007 
as£¹
Ð
p
->
šT¿ns
==
TRANS_WRITE
 );

60008 
as£¹
Ð
pBt
->
pPage1
!=0 );

60009 
	gpP1
 = 
pBt
->
pPage1
->
aD©a
;

60010 
	grc
 = 
sql™e3Pag”Wr™e
(
pBt
->
pPage1
->
pDbPage
);

60011 ifÐ
	grc
==
SQLITE_OK
 ){

60012 
put4by‹
(&
pP1
[36 + 
idx
*4], 
iM‘a
);

60013 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60014 ifÐ
	gidx
==
BTREE_INCR_VACUUM
 ){

60015 
as£¹
Ð
pBt
->
autoVacuum
 || 
iM‘a
==0 );

60016 
as£¹
Ð
iM‘a
==0 || iMeta==1 );

60017 
	gpBt
->
	gšüVacuum
 = (
u8
)
iM‘a
;

60021 
sql™e3BŒ“L—ve
(
p
);

60022  
	grc
;

60025 #iâdeà
SQLITE_OMIT_BTREECOUNT


60034 
SQLITE_PRIVATE
 
sql™e3BŒ“CouÁ
(
BtCursÜ
 *
pCur
, 
i64
 *
²EÁry
){

60035 
i64
 
	gnEÁry
 = 0;

60036 
	grc
;

60038 ifÐ
	gpCur
->
	gpgnoRoÙ
==0 ){

60039 *
²EÁry
 = 0;

60040  
	gSQLITE_OK
;

60042 
	grc
 = 
moveToRoÙ
(
pCur
);

60047  
	grc
==
SQLITE_OK
 ){

60048 
iIdx
;

60049 
MemPage
 *
	gpPage
;

60055 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

60056 ifÐ
	gpPage
->
	gËaf
 || !pPage->
	gštKey
 ){

60057 
	gnEÁry
 +ð
pPage
->
nC–l
;

60070 ifÐ
	gpPage
->
	gËaf
 ){

60072 ifÐ
	gpCur
->
	giPage
==0 ){

60074 *
²EÁry
 = 
nEÁry
;

60075  
	gSQLITE_OK
;

60077 
moveToP¬’t
(
pCur
);

60078 } 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]>õCur->
­Page
[pCur->iPage]->
nC–l
 );

60080 
	gpCur
->
	gaiIdx
[
pCur
->
iPage
]++;

60081 
	gpPage
 = 
pCur
->
­Page
[pCur->
iPage
];

60087 
	giIdx
 = 
pCur
->
aiIdx
[pCur->
iPage
];

60088 ifÐ
	giIdx
==
pPage
->
nC–l
 ){

60089 
rc
 = 
moveToChžd
(
pCur
, 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]));

60091 
	grc
 = 
moveToChžd
(
pCur
, 
g‘4by‹
(
fšdC–l
(
pPage
, 
iIdx
)));

60096  
	grc
;

60104 
SQLITE_PRIVATE
 
Pag”
 *
sql™e3BŒ“Pag”
(
BŒ“
 *
p
){

60105  
	gp
->
	gpBt
->
	gpPag”
;

60108 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


60112 
checkAµ’dMsg
(

60113 
IÁegr™yCk
 *
pCheck
,

60114 cÚ¡ *
zFÜm©
,

60117 
va_li¡
 
	g­
;

60118 
	gzBuf
[200];

60119 ifÐ!
	gpCheck
->
	gmxE¼
 ) ;

60120 
	gpCheck
->
	gmxE¼
--;

60121 
	gpCheck
->
	gnE¼
++;

60122 
va_¡¬t
(
­
, 
zFÜm©
);

60123 ifÐ
	gpCheck
->
	g”rMsg
.
	gnCh¬
 ){

60124 
sql™e3SŒAccumAµ’d
(&
pCheck
->
”rMsg
, "\n", 1);

60126 ifÐ
	gpCheck
->
	gzPfx
 ){

60127 
sql™e3_¢´štf
((
zBuf
), zBuf, 
pCheck
->
zPfx
,…Check->
v1
,…Check->
v2
);

60128 
sql™e3SŒAccumAµ’dAÎ
(&
pCheck
->
”rMsg
, 
zBuf
);

60130 
sql™e3VXPrštf
(&
pCheck
->
”rMsg
, 1, 
zFÜm©
, 
­
);

60131 
va_’d
(
­
);

60132 ifÐ
	gpCheck
->
	g”rMsg
.
	gaccE¼Ü
==
STRACCUM_NOMEM
 ){

60133 
pCheck
->
m®locFažed
 = 1;

60138 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


60144 
g‘PageReã»nûd
(
IÁegr™yCk
 *
pCheck
, 
Pgno
 
iPg
){

60145 
as£¹
Ð
iPg
<=
pCheck
->
nPage
 && ÕCheck->
aPgRef
[0])==1 );

60146  (
	gpCheck
->
	gaPgRef
[
iPg
/8] & (1 << (
	giPg
 & 0x07)));

60152 
£tPageReã»nûd
(
IÁegr™yCk
 *
pCheck
, 
Pgno
 
iPg
){

60153 
as£¹
Ð
iPg
<=
pCheck
->
nPage
 && ÕCheck->
aPgRef
[0])==1 );

60154 
	gpCheck
->
	gaPgRef
[
iPg
/8] |= (1 << (iPg & 0x07));

60166 
checkRef
(
IÁegr™yCk
 *
pCheck
, 
Pgno
 
iPage
){

60167 ifÐ
	giPage
==0 )  1;

60168 ifÐ
	giPage
>
	gpCheck
->
	gnPage
 ){

60169 
checkAµ’dMsg
(
pCheck
, "šv®id…agnumb” %d", 
iPage
);

60172 ifÐ
g‘PageReã»nûd
(
pCheck
, 
iPage
) ){

60173 
checkAµ’dMsg
(
pCheck
, "2nd„eã»nûØ·g%d", 
iPage
);

60176 
£tPageReã»nûd
(
pCheck
, 
iPage
);

60180 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60186 
checkPŒm­
(

60187 
IÁegr™yCk
 *
pCheck
,

60188 
Pgno
 
iChžd
,

60189 
u8
 
eTy³
,

60190 
Pgno
 
iP¬’t


60192 
	grc
;

60193 
u8
 
	gePŒm­Ty³
;

60194 
Pgno
 
	giPŒm­P¬’t
;

60196 
	grc
 = 
±rm­G‘
(
pCheck
->
pBt
, 
iChžd
, &
ePŒm­Ty³
, &
iPŒm­P¬’t
);

60197 ifÐ
	grc
!=
SQLITE_OK
 ){

60198 ifÐ
rc
==
SQLITE_NOMEM
 ||„c==
SQLITE_IOERR_NOMEM
 ) 
pCheck
->
m®locFažed
 = 1;

60199 
checkAµ’dMsg
(
pCheck
, "FažedØ»ad…Œm­ key=%d", 
iChžd
);

60203 ifÐ
	gePŒm­Ty³
!=
eTy³
 || 
iPŒm­P¬’t
!=
iP¬’t
 ){

60204 
checkAµ’dMsg
(
pCheck
,

60206 
iChžd
, 
eTy³
, 
iP¬’t
, 
ePŒm­Ty³
, 
iPŒm­P¬’t
);

60215 
checkLi¡
(

60216 
IÁegr™yCk
 *
pCheck
,

60217 
isF»eLi¡
,

60218 
iPage
,

60219 
N


60221 
	gi
;

60222 
	gex³ùed
 = 
N
;

60223 
	giFœ¡
 = 
iPage
;

60224  
	gN
-- > 0 && 
	gpCheck
->
	gmxE¼
 ){

60225 
DbPage
 *
	gpOvæPage
;

60226 *
	gpOvæD©a
;

60227 ifÐ
	giPage
<1 ){

60228 
checkAµ’dMsg
(
pCheck
,

60230 
N
+1, 
ex³ùed
, 
iFœ¡
);

60233 ifÐ
checkRef
(
pCheck
, 
iPage
) ) ;

60234 ifÐ
sql™e3Pag”G‘
(
pCheck
->
pPag”
, (
Pgno
)
iPage
, &
pOvæPage
) ){

60235 
checkAµ’dMsg
(
pCheck
, "çžedØg‘…ag%d", 
iPage
);

60238 
	gpOvæD©a
 = (*)
sql™e3Pag”G‘D©a
(
pOvæPage
);

60239 ifÐ
	gisF»eLi¡
 ){

60240 
	gn
 = 
g‘4by‹
(&
pOvæD©a
[4]);

60241 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60242 ifÐ
	gpCheck
->
	gpBt
->
	gautoVacuum
 ){

60243 
checkPŒm­
(
pCheck
, 
iPage
, 
PTRMAP_FREEPAGE
, 0);

60246 ifÐ
	gn
>()
	gpCheck
->
	gpBt
->
	gu§bËSize
/4-2 ){

60247 
checkAµ’dMsg
(
pCheck
,

60248 "ä“li¡†—àcouÁoØbig oÀ·g%d", 
iPage
);

60249 
	gN
--;

60251 
	gi
=0; i<
	gn
; i++){

60252 
Pgno
 
	giF»ePage
 = 
g‘4by‹
(&
pOvæD©a
[8+
i
*4]);

60253 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60254 ifÐ
	gpCheck
->
	gpBt
->
	gautoVacuum
 ){

60255 
checkPŒm­
(
pCheck
, 
iF»ePage
, 
PTRMAP_FREEPAGE
, 0);

60258 
checkRef
(
pCheck
, 
iF»ePage
);

60260 
	gN
 -ð
n
;

60263 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60269 ifÐ
	gpCheck
->
	gpBt
->
	gautoVacuum
 && 
	gN
>0 ){

60270 
	gi
 = 
g‘4by‹
(
pOvæD©a
);

60271 
checkPŒm­
(
pCheck
, 
i
, 
PTRMAP_OVERFLOW2
, 
iPage
);

60275 
	giPage
 = 
g‘4by‹
(
pOvæD©a
);

60276 
sql™e3Pag”UÄef
(
pOvæPage
);

60281 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


60300 
checkT»ePage
(

60301 
IÁegr™yCk
 *
pCheck
,

60302 
iPage
,

60303 
i64
 *
²P¬’tMšKey
,

60304 
i64
 *
²P¬’tMaxKey


60306 
MemPage
 *
	gpPage
;

60307 
	gi
, 
	grc
, 
	gd•th
, 
	gd2
, 
	gpgno
, 
	gút
;

60308 
	ghdr
, 
	gûÎS¹
;

60309 
	gnC–l
;

60310 
u8
 *
	gd©a
;

60311 
BtSh¬ed
 *
	gpBt
;

60312 
	gu§bËSize
;

60313 *
	gh™
 = 0;

60314 
i64
 
	gnMšKey
 = 0;

60315 
i64
 
	gnMaxKey
 = 0;

60316 cÚ¡ *
	g§ved_zPfx
 = 
pCheck
->
zPfx
;

60317 
	g§ved_v1
 = 
pCheck
->
v1
;

60318 
	g§ved_v2
 = 
pCheck
->
v2
;

60322 
	gpBt
 = 
pCheck
->
pBt
;

60323 
	gu§bËSize
 = 
pBt
->
u§bËSize
;

60324 ifÐ
	giPage
==0 )  0;

60325 ifÐ
checkRef
(
pCheck
, 
iPage
) )  0;

60326 
	gpCheck
->
	gzPfx
 = "Page %d: ";

60327 
	gpCheck
->
	gv1
 = 
iPage
;

60328 ifÐ(
	grc
 = 
bŒ“G‘Page
(
pBt
, (
Pgno
)
iPage
, &
pPage
, 0))!=0 ){

60329 
checkAµ’dMsg
(
pCheck
,

60330 "uÇbËØg‘h·ge.ƒ¼Ü code=%d", 
rc
);

60331 
	gd•th
 = -1;

60332 
	g’d_of_check
;

60337 
	gpPage
->
	gisIn™
 = 0;

60338 ifÐ(
	grc
 = 
bŒ“In™Page
(
pPage
))!=0 ){

60339 
as£¹
Ð
rc
==
SQLITE_CORRUPT
 );

60340 
checkAµ’dMsg
(
pCheck
,

60341 "bŒ“In™Page(è»tuº ”rÜ cod%d", 
rc
);

60342 
»Ëa£Page
(
pPage
);

60343 
	gd•th
 = -1;

60344 
	g’d_of_check
;

60349 
	gd•th
 = 0;

60350 
	gi
=0; i<
	gpPage
->
	gnC–l
 && 
	gpCheck
->
	gmxE¼
; i++){

60351 
u8
 *
	gpC–l
;

60352 
u32
 
	gsz
;

60353 
C–lInfo
 
	gšfo
;

60357 
	gpCheck
->
	gzPfx
 = "Onree…age %d cell %d: ";

60358 
	gpCheck
->
	gv1
 = 
iPage
;

60359 
	gpCheck
->
	gv2
 = 
i
;

60360 
	gpC–l
 = 
fšdC–l
(
pPage
,
i
);

60361 
bŒ“P¬£C–lPŒ
(
pPage
, 
pC–l
, &
šfo
);

60362 
	gsz
 = 
šfo
.
nPaylßd
;

60365 ifÐ
	gpPage
->
	gštKey
 ){

60366 ifÐ
	gi
==0 ){

60367 
nMšKey
 = 
nMaxKey
 = 
šfo
.
nKey
;

60368 }ifÐ
	gšfo
.
	gnKey
 <ð
nMaxKey
 ){

60369 
checkAµ’dMsg
(
pCheck
,

60370 "Rowid %Îd ouˆoàÜd” (´eviou wa %Îd)", 
šfo
.
nKey
, 
nMaxKey
);

60372 
	gnMaxKey
 = 
šfo
.
nKey
;

60374 ifÐ(
	gsz
>
	gšfo
.
	gnLoÿl
)

60375 && (&
	gpC–l
[
šfo
.
iOv”æow
]<=&
pPage
->
aD©a
[
pBt
->
u§bËSize
])

60377 
nPage
 = (
sz
 - 
šfo
.
nLoÿl
 + 
u§bËSize
 - 5)/(usableSize - 4);

60378 
Pgno
 
	gpgnoOvæ
 = 
g‘4by‹
(&
pC–l
[
šfo
.
iOv”æow
]);

60379 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60380 ifÐ
	gpBt
->
	gautoVacuum
 ){

60381 
checkPŒm­
(
pCheck
, 
pgnoOvæ
, 
PTRMAP_OVERFLOW1
, 
iPage
);

60384 
checkLi¡
(
pCheck
, 0, 
pgnoOvæ
, 
nPage
);

60389 ifÐ!
	gpPage
->
	gËaf
 ){

60390 
	gpgno
 = 
g‘4by‹
(
pC–l
);

60391 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60392 ifÐ
	gpBt
->
	gautoVacuum
 ){

60393 
checkPŒm­
(
pCheck
, 
pgno
, 
PTRMAP_BTREE
, 
iPage
);

60396 
	gd2
 = 
checkT»ePage
(
pCheck
, 
pgno
, &
nMšKey
, 
i
==0?
NULL
:&
nMaxKey
);

60397 ifÐ
	gi
>0 && 
	gd2
!=
d•th
 ){

60398 
checkAµ’dMsg
(
pCheck
, "Child…age depth differs");

60400 
	gd•th
 = 
d2
;

60404 ifÐ!
	gpPage
->
	gËaf
 ){

60405 
	gpgno
 = 
g‘4by‹
(&
pPage
->
aD©a
[pPage->
hdrOff£t
+8]);

60406 
	gpCheck
->
	gzPfx
 = "On…age %d‡t„ight child: ";

60407 
	gpCheck
->
	gv1
 = 
iPage
;

60408 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60409 ifÐ
	gpBt
->
	gautoVacuum
 ){

60410 
checkPŒm­
(
pCheck
, 
pgno
, 
PTRMAP_BTREE
, 
iPage
);

60413 
checkT»ePage
(
pCheck
, 
pgno
, 
NULL
, !
pPage
->
nC–l
?NULL:&
nMaxKey
);

60419 
	gpCheck
->
	gzPfx
 = "Page %d: ";

60420 
	gpCheck
->
	gv1
 = 
iPage
;

60421 ifÐ
	gpPage
->
	gËaf
 &&…Page->
	gštKey
 ){

60423 ifÐ
	g²P¬’tMšKey
 ){

60425 ifÐ!
	g²P¬’tMaxKey
 ){

60426 ifÐ
	gnMaxKey
 > *
	g²P¬’tMšKey
 ){

60427 
checkAµ’dMsg
(
pCheck
,

60429 
nMaxKey
, *
²P¬’tMšKey
);

60432 ifÐ
	gnMšKey
 <ð*
²P¬’tMšKey
 ){

60433 
checkAµ’dMsg
(
pCheck
,

60435 
nMšKey
, *
²P¬’tMšKey
);

60437 ifÐ
	gnMaxKey
 > *
	g²P¬’tMaxKey
 ){

60438 
checkAµ’dMsg
(
pCheck
,

60440 
nMaxKey
, *
²P¬’tMaxKey
);

60442 *
	g²P¬’tMšKey
 = 
nMaxKey
;

60445 } ifÐ
	g²P¬’tMaxKey
 ){

60446 ifÐ
	gnMšKey
 <ð*
²P¬’tMaxKey
 ){

60447 
checkAµ’dMsg
(
pCheck
,

60449 
nMšKey
, *
²P¬’tMaxKey
);

60456 
	gd©a
 = 
pPage
->
aD©a
;

60457 
	ghdr
 = 
pPage
->
hdrOff£t
;

60458 
	gh™
 = 
sql™e3PageM®loc
Ð
pBt
->
·geSize
 );

60459 
	gpCheck
->
	gzPfx
 = 0;

60460 ifÐ
	gh™
==0 ){

60461 
pCheck
->
m®locFažed
 = 1;

60463 
	gcÚ‹ÁOff£t
 = 
g‘2by‹NÙZ”o
(&
d©a
[
hdr
+5]);

60464 
as£¹
Ð
cÚ‹ÁOff£t
<=
u§bËSize
 );

60465 
mem£t
(
h™
+
cÚ‹ÁOff£t
, 0, 
u§bËSize
-contentOffset);

60466 
mem£t
(
h™
, 1, 
cÚ‹ÁOff£t
);

60467 
	gnC–l
 = 
g‘2by‹
(&
d©a
[
hdr
+3]);

60468 
	gûÎS¹
 = 
hdr
 + 12 - 4*
pPage
->
Ëaf
;

60469 
	gi
=0; i<
	gnC–l
; i++){

60470 
	gpc
 = 
g‘2by‹
(&
d©a
[
ûÎS¹
+
i
*2]);

60471 
u32
 
	gsize
 = 65536;

60472 
	gj
;

60473 ifÐ
	gpc
<=
u§bËSize
-4 ){

60474 
size
 = 
ûÎSizePŒ
(
pPage
, &
d©a
[
pc
]);

60476 ifÐ()(
	gpc
+
	gsize
-1)>=
u§bËSize
 ){

60477 
pCheck
->
zPfx
 = 0;

60478 
checkAµ’dMsg
(
pCheck
,

60479 "CÜru±iÚ d‘eùed iÀûÎ %d oÀ·g%d",
i
,
iPage
);

60481 
	gj
=
pc
+
size
-1; j>õc; j--è
	gh™
[
j
]++;

60484 
	gi
 = 
g‘2by‹
(&
d©a
[
hdr
+1]);

60485  
	gi
>0 ){

60486 
	gsize
, 
	gj
;

60487 
as£¹
Ð
i
<=
u§bËSize
-4 );

60488 
	gsize
 = 
g‘2by‹
(&
d©a
[
i
+2]);

60489 
as£¹
Ð
i
+
size
<=
u§bËSize
 );

60490 
	gj
=
i
+
size
-1; j>=i; j--è
	gh™
[
j
]++;

60491 
	gj
 = 
g‘2by‹
(&
d©a
[
i
]);

60492 
as£¹
Ð
j
==0 || j>
i
+
size
 );

60493 
as£¹
Ð
j
<=
u§bËSize
-4 );

60494 
	gi
 = 
j
;

60496 
	gi
=
út
=0; i<
	gu§bËSize
; i++){

60497 ifÐ
	gh™
[
i
]==0 ){

60498 
út
++;

60499 }ifÐ
	gh™
[
i
]>1 ){

60500 
checkAµ’dMsg
(
pCheck
,

60501 "MuÉË u£ fÜ by‹ %d oà·g%d", 
i
, 
iPage
);

60505 ifÐ
	gút
!=
d©a
[
hdr
+7] ){

60506 
checkAµ’dMsg
(
pCheck
,

60508 
út
, 
d©a
[
hdr
+7], 
iPage
);

60511 
sql™e3PageF»e
(
h™
);

60512 
»Ëa£Page
(
pPage
);

60514 
	g’d_of_check
:

60515 
pCheck
->
zPfx
 = 
§ved_zPfx
;

60516 
	gpCheck
->
	gv1
 = 
§ved_v1
;

60517 
	gpCheck
->
	gv2
 = 
§ved_v2
;

60518  
	gd•th
+1;

60522 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


60536 
SQLITE_PRIVATE
 *
sql™e3BŒ“IÁegr™yCheck
(

60537 
BŒ“
 *
p
,

60538 *
aRoÙ
,

60539 
nRoÙ
,

60540 
mxE¼
,

60541 *
²E¼


60543 
Pgno
 
	gi
;

60544 
	gnRef
;

60545 
IÁegr™yCk
 
	gsCheck
;

60546 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

60547 
	gzE¼
[100];

60549 
sql™e3BŒ“EÁ”
(
p
);

60550 
as£¹
Ð
p
->
šT¿ns
>
TRANS_NONE
 && 
pBt
->
šT¿n§ùiÚ
>TRANS_NONE );

60551 
	gnRef
 = 
sql™e3Pag”RefcouÁ
(
pBt
->
pPag”
);

60552 
	gsCheck
.
	gpBt
 = 
pBt
;

60553 
	gsCheck
.
	gpPag”
 = 
pBt
->
pPag”
;

60554 
	gsCheck
.
	gnPage
 = 
bŒ“PagecouÁ
(
sCheck
.
pBt
);

60555 
	gsCheck
.
	gmxE¼
 = 
mxE¼
;

60556 
	gsCheck
.
	gnE¼
 = 0;

60557 
	gsCheck
.
	gm®locFažed
 = 0;

60558 
	gsCheck
.
	gzPfx
 = 0;

60559 
	gsCheck
.
	gv1
 = 0;

60560 
	gsCheck
.
	gv2
 = 0;

60561 *
	g²E¼
 = 0;

60562 ifÐ
	gsCheck
.
	gnPage
==0 ){

60563 
sql™e3BŒ“L—ve
(
p
);

60567 
	gsCheck
.
	gaPgRef
 = 
sql™e3M®locZ”o
((
sCheck
.
nPage
 / 8)+ 1);

60568 ifÐ!
	gsCheck
.
	gaPgRef
 ){

60569 *
	g²E¼
 = 1;

60570 
sql™e3BŒ“L—ve
(
p
);

60573 
	gi
 = 
PENDING_BYTE_PAGE
(
pBt
);

60574 ifÐ
	gi
<=
sCheck
.
nPage
 ) 
£tPageReã»nûd
(&sCheck, 
i
);

60575 
sql™e3SŒAccumIn™
(&
sCheck
.
”rMsg
, 
zE¼
, (zE¼), 
SQLITE_MAX_LENGTH
);

60576 
	gsCheck
.
	g”rMsg
.
	gu£M®loc
 = 2;

60580 
	gsCheck
.
	gzPfx
 = "Main freelist: ";

60581 
checkLi¡
(&
sCheck
, 1, 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[32]),

60582 
g‘4by‹
(&
pBt
->
pPage1
->
aD©a
[36]));

60583 
	gsCheck
.
	gzPfx
 = 0;

60587 
	gi
=0; ()i<
	gnRoÙ
 && 
	gsCheck
.
	gmxE¼
; i++){

60588 ifÐ
	gaRoÙ
[
i
]==0 ) ;

60589 #iâdeà
SQLITE_OMIT_AUTOVACUUM


60590 ifÐ
	gpBt
->
	gautoVacuum
 && 
	gaRoÙ
[
i
]>1 ){

60591 
checkPŒm­
(&
sCheck
, 
aRoÙ
[
i
], 
PTRMAP_ROOTPAGE
, 0);

60594 
	gsCheck
.
	gzPfx
 = "List ofree„oots: ";

60595 
checkT»ePage
(&
sCheck
, 
aRoÙ
[
i
], 
NULL
, NULL);

60596 
	gsCheck
.
	gzPfx
 = 0;

60601 
	gi
=1; i<=
sCheck
.
nPage
 && sCheck.
mxE¼
; i++){

60602 #ifdeà
SQLITE_OMIT_AUTOVACUUM


60603 ifÐ
g‘PageReã»nûd
(&
sCheck
, 
i
)==0 ){

60604 
checkAµ’dMsg
(&
sCheck
, "Pag%d i Ãv” u£d", 
i
);

60610 ifÐ
g‘PageReã»nûd
(&
sCheck
, 
i
)==0 &&

60611 (
PTRMAP_PAGENO
(
pBt
, 
i
)!=˜|| !pBt->
autoVacuum
) ){

60612 
checkAµ’dMsg
(&
sCheck
, "Pag%d i Ãv” u£d", 
i
);

60614 ifÐ
g‘PageReã»nûd
(&
sCheck
, 
i
)!=0 &&

60615 (
PTRMAP_PAGENO
(
pBt
, 
i
)==˜&&…Bt->
autoVacuum
) ){

60616 
checkAµ’dMsg
(&
sCheck
, "Poš‹¸m­…ag%d i »ã»nûd", 
i
);

60625 ifÐ
NEVER
(
nRef
 !ð
sql™e3Pag”RefcouÁ
(
pBt
->
pPag”
)) ){

60626 
checkAµ’dMsg
(&
sCheck
,

60628 
nRef
, 
sql™e3Pag”RefcouÁ
(
pBt
->
pPag”
)

60634 
sql™e3BŒ“L—ve
(
p
);

60635 
sql™e3_ä“
(
sCheck
.
aPgRef
);

60636 ifÐ
	gsCheck
.
	gm®locFažed
 ){

60637 
sql™e3SŒAccumRe£t
(&
sCheck
.
”rMsg
);

60638 *
	g²E¼
 = 
sCheck
.
nE¼
+1;

60641 *
	g²E¼
 = 
sCheck
.
nE¼
;

60642 ifÐ
	gsCheck
.
	gnE¼
==0 ) 
sql™e3SŒAccumRe£t
(&
sCheck
.
”rMsg
);

60643  
sql™e3SŒAccumFšish
(&
sCheck
.
”rMsg
);

60654 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“G‘Fž’ame
(
BŒ“
 *
p
){

60655 
as£¹
Ð
p
->
pBt
->
pPag”
!=0 );

60656  
sql™e3Pag”Fž’ame
(
p
->
pBt
->
pPag”
, 1);

60667 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3BŒ“G‘Jouº®Çme
(
BŒ“
 *
p
){

60668 
as£¹
Ð
p
->
pBt
->
pPag”
!=0 );

60669  
sql™e3Pag”Jouº®Çme
(
p
->
pBt
->
pPag”
);

60675 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInT¿ns
(
BŒ“
 *
p
){

60676 
as£¹
Ð
p
==0 || 
sql™e3_mu‹x_h–d
Õ->
db
->
mu‹x
) );

60677  (
	gp
 && (p->
	gšT¿ns
==
TRANS_WRITE
));

60680 #iâdeà
SQLITE_OMIT_WAL


60689 
SQLITE_PRIVATE
 
sql™e3BŒ“Checkpošt
(
BŒ“
 *
p
, 
eMode
, *
²Log
, *
²Ck±
){

60690 
	grc
 = 
SQLITE_OK
;

60691 ifÐ
	gp
 ){

60692 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

60693 
sql™e3BŒ“EÁ”
(
p
);

60694 ifÐ
	gpBt
->
	gšT¿n§ùiÚ
!=
TRANS_NONE
 ){

60695 
rc
 = 
SQLITE_LOCKED
;

60697 
	grc
 = 
sql™e3Pag”Checkpošt
(
pBt
->
pPag”
, 
eMode
, 
²Log
, 
²Ck±
);

60699 
sql™e3BŒ“L—ve
(
p
);

60701  
	grc
;

60708 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInR—dT¿ns
(
BŒ“
 *
p
){

60709 
as£¹
Ð
p
 );

60710 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

60711  
	gp
->
	gšT¿ns
!=
TRANS_NONE
;

60714 
SQLITE_PRIVATE
 
sql™e3BŒ“IsInBackup
(
BŒ“
 *
p
){

60715 
as£¹
Ð
p
 );

60716 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

60717  
	gp
->
	gnBackup
!=0;

60740 
SQLITE_PRIVATE
 *
sql™e3BŒ“Schema
(
BŒ“
 *
p
, 
nBy‹s
, (*
xF»e
)(*)){

60741 
BtSh¬ed
 *
	gpBt
 = 
p
->
pBt
;

60742 
sql™e3BŒ“EÁ”
(
p
);

60743 ifÐ!
	gpBt
->
	gpSchema
 && 
	gnBy‹s
 ){

60744 
	gpBt
->
	gpSchema
 = 
sql™e3DbM®locZ”o
(0, 
nBy‹s
);

60745 
	gpBt
->
	gxF»eSchema
 = 
xF»e
;

60747 
sql™e3BŒ“L—ve
(
p
);

60748  
	gpBt
->
	gpSchema
;

60756 
SQLITE_PRIVATE
 
sql™e3BŒ“SchemaLocked
(
BŒ“
 *
p
){

60757 
	grc
;

60758 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
db
->
mu‹x
) );

60759 
sql™e3BŒ“EÁ”
(
p
);

60760 
	grc
 = 
qu”ySh¬edCacheTabËLock
(
p
, 
MASTER_ROOT
, 
READ_LOCK
);

60761 
as£¹
Ð
rc
==
SQLITE_OK
 ||„c==
SQLITE_LOCKED_SHAREDCACHE
 );

60762 
sql™e3BŒ“L—ve
(
p
);

60763  
	grc
;

60767 #iâdeà
SQLITE_OMIT_SHARED_CACHE


60773 
SQLITE_PRIVATE
 
sql™e3BŒ“LockTabË
(
BŒ“
 *
p
, 
iTab
, 
u8
 
isWr™eLock
){

60774 
	grc
 = 
SQLITE_OK
;

60775 
as£¹
Ð
p
->
šT¿ns
!=
TRANS_NONE
 );

60776 ifÐ
	gp
->
	gsh¬abË
 ){

60777 
u8
 
	glockTy³
 = 
READ_LOCK
 + 
isWr™eLock
;

60778 
as£¹
Ð
READ_LOCK
+1==
WRITE_LOCK
 );

60779 
as£¹
Ð
isWr™eLock
==0 || isWriteLock==1 );

60781 
sql™e3BŒ“EÁ”
(
p
);

60782 
	grc
 = 
qu”ySh¬edCacheTabËLock
(
p
, 
iTab
, 
lockTy³
);

60783 ifÐ
	grc
==
SQLITE_OK
 ){

60784 
rc
 = 
£tSh¬edCacheTabËLock
(
p
, 
iTab
, 
lockTy³
);

60786 
sql™e3BŒ“L—ve
(
p
);

60788  
	grc
;

60792 #iâdeà
SQLITE_OMIT_INCRBLOB


60803 
SQLITE_PRIVATE
 
sql™e3BŒ“PutD©a
(
BtCursÜ
 *
pC¤
, 
u32
 
off£t
, u32 
amt
, *
z
){

60804 
	grc
;

60805 
as£¹
Ð
cursÜHÞdsMu‹x
(
pC¤
) );

60806 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pC¤
->
pBŒ“
->
db
->
mu‹x
) );

60807 
as£¹
Ð
pC¤
->
curFÏgs
 & 
BTCF_Inüblob
 );

60809 
	grc
 = 
»¡ÜeCursÜPos™iÚ
(
pC¤
);

60810 ifÐ
	grc
!=
SQLITE_OK
 ){

60811  
rc
;

60813 
as£¹
Ð
pC¤
->
eS‹
!=
CURSOR_REQUIRESEEK
 );

60814 ifÐ
	gpC¤
->
	geS‹
!=
CURSOR_VALID
 ){

60815  
SQLITE_ABORT
;

60826 
VVA_ONLY
(
rc
 =è
§veAÎCursÜs
(
pC¤
->
pBt
,…C¤->
pgnoRoÙ
,…Csr);

60827 
as£¹
Ð
rc
==
SQLITE_OK
 );

60836 ifÐ(
	gpC¤
->
	gcurFÏgs
 & 
	gBTCF_Wr™eFÏg
)==0 ){

60837  
SQLITE_READONLY
;

60839 
as£¹
Ð(
pC¤
->
pBt
->
btsFÏgs
 & 
BTS_READ_ONLY
)==0

60840 && 
pC¤
->
pBt
->
šT¿n§ùiÚ
==
TRANS_WRITE
 );

60841 
as£¹
Ð
hasSh¬edCacheTabËLock
(
pC¤
->
pBŒ“
,…C¤->
pgnoRoÙ
, 0, 2) );

60842 
as£¹
Ð!
hasR—dCÚæiùs
(
pC¤
->
pBŒ“
,…C¤->
pgnoRoÙ
) );

60843 
as£¹
Ð
pC¤
->
­Page
[pC¤->
iPage
]->
štKey
 );

60845  
acûssPaylßd
(
pC¤
, 
off£t
, 
amt
, (*)
z
, 1);

60851 
SQLITE_PRIVATE
 
sql™e3BŒ“InüblobCursÜ
(
BtCursÜ
 *
pCur
){

60852 
	gpCur
->
	gcurFÏgs
 |ð
BTCF_Inüblob
;

60861 
SQLITE_PRIVATE
 
sql™e3BŒ“S‘V”siÚ
(
BŒ“
 *
pBŒ“
, 
iV”siÚ
){

60862 
BtSh¬ed
 *
	gpBt
 = 
pBŒ“
->
pBt
;

60863 
	grc
;

60865 
as£¹
Ð
iV”siÚ
==1 || iVersion==2 );

60870 
	gpBt
->
	gbtsFÏgs
 &ð~
BTS_NO_WAL
;

60871 ifÐ
	giV”siÚ
==1 ) 
pBt
->
btsFÏgs
 |ð
BTS_NO_WAL
;

60873 
	grc
 = 
sql™e3BŒ“BegšT¿ns
(
pBŒ“
, 0);

60874 ifÐ
	grc
==
SQLITE_OK
 ){

60875 
u8
 *
aD©a
 = 
pBt
->
pPage1
->aData;

60876 ifÐ
	gaD©a
[18]!=(
u8
)
iV”siÚ
 || 
aD©a
[19]!=(u8)iVersion ){

60877 
rc
 = 
sql™e3BŒ“BegšT¿ns
(
pBŒ“
, 2);

60878 ifÐ
	grc
==
SQLITE_OK
 ){

60879 
rc
 = 
sql™e3Pag”Wr™e
(
pBt
->
pPage1
->
pDbPage
);

60880 ifÐ
	grc
==
SQLITE_OK
 ){

60881 
aD©a
[18] = (
u8
)
iV”siÚ
;

60882 
	gaD©a
[19] = (
u8
)
iV”siÚ
;

60888 
	gpBt
->
	gbtsFÏgs
 &ð~
BTS_NO_WAL
;

60889  
	grc
;

60896 
SQLITE_PRIVATE
 
sql™e3BŒ“CursÜHšts
(
BtCursÜ
 *
pC¤
, 
mask
){

60897 
as£¹
Ð
mask
==
BTREE_BULKLOAD
 || mask==0 );

60898 
	gpC¤
->
	ghšts
 = 
mask
;

60904 
SQLITE_PRIVATE
 
sql™e3BŒ“IsR—dÚly
(
BŒ“
 *
p
){

60905  (
	gp
->
	gpBt
->
	gbtsFÏgs
 & 
	gBTS_READ_ONLY
)!=0;

60928 
	ssql™e3_backup
 {

60929 
sql™e3
* 
	gpDe¡Db
;

60930 
BŒ“
 *
	gpDe¡
;

60931 
u32
 
	giDe¡Schema
;

60932 
	gbDe¡Locked
;

60934 
Pgno
 
	giNext
;

60935 
sql™e3
* 
	gpSrcDb
;

60936 
BŒ“
 *
	gpSrc
;

60938 
	grc
;

60943 
Pgno
 
	gnRemaššg
;

60944 
Pgno
 
	gnPagecouÁ
;

60946 
	gisA‰ached
;

60947 
sql™e3_backup
 *
	gpNext
;

60989 
BŒ“
 *
fšdBŒ“
(
sql™e3
 *
pE¼ÜDb
, sql™e3 *
pDb
, cÚ¡ *
zDb
){

60990 
	gi
 = 
sql™e3FšdDbName
(
pDb
, 
zDb
);

60992 ifÐ
	gi
==1 ){

60993 
P¬£
 *
pP¬£
;

60994 
	grc
 = 0;

60995 
	gpP¬£
 = 
sql™e3SckAÎocZ”o
(
pE¼ÜDb
, (*
pP¬£
));

60996 ifÐ
	gpP¬£
==0 ){

60997 
sql™e3E¼ÜW™hMsg
(
pE¼ÜDb
, 
SQLITE_NOMEM
, "out of memory");

60998 
	grc
 = 
SQLITE_NOMEM
;

61000 
	gpP¬£
->
	gdb
 = 
pDb
;

61001 ifÐ
sql™e3O³nTempD©aba£
(
pP¬£
) ){

61002 
sql™e3E¼ÜW™hMsg
(
pE¼ÜDb
, 
pP¬£
->
rc
, "%s",…P¬£->
zE¼Msg
);

61003 
	grc
 = 
SQLITE_ERROR
;

61005 
sql™e3DbF»e
(
pE¼ÜDb
, 
pP¬£
->
zE¼Msg
);

61006 
sql™e3P¬£rRe£t
(
pP¬£
);

61007 
sql™e3SckF»e
(
pE¼ÜDb
, 
pP¬£
);

61009 ifÐ
	grc
 ){

61014 ifÐ
	gi
<0 ){

61015 
sql™e3E¼ÜW™hMsg
(
pE¼ÜDb
, 
SQLITE_ERROR
, "unknowÀd©aba£ %s", 
zDb
);

61019  
	gpDb
->
	gaDb
[
i
].
	gpBt
;

61026 
£tDe¡Pgsz
(
sql™e3_backup
 *
p
){

61027 
	grc
;

61028 
	grc
 = 
sql™e3BŒ“S‘PageSize
(
p
->
pDe¡
,
sql™e3BŒ“G‘PageSize
Õ->
pSrc
),-1,0);

61029  
	grc
;

61040 
SQLITE_API
 
sql™e3_backup
 *
sql™e3_backup_š™
(

61041 
sql™e3
* 
pDe¡Db
,

61042 cÚ¡ *
zDe¡Db
,

61043 
sql™e3
* 
pSrcDb
,

61044 cÚ¡ *
zSrcDb


61046 
sql™e3_backup
 *
	gp
;

61056 
sql™e3_mu‹x_’‹r
(
pSrcDb
->
mu‹x
);

61057 
sql™e3_mu‹x_’‹r
(
pDe¡Db
->
mu‹x
);

61059 ifÐ
	gpSrcDb
==
pDe¡Db
 ){

61060 
sql™e3E¼ÜW™hMsg
(

61061 
pDe¡Db
, 
SQLITE_ERROR
, "source‡nd destination must be distinct"

61063 
	gp
 = 0;

61069 
	gp
 = (
sql™e3_backup
 *)
sql™e3M®locZ”o
((sqlite3_backup));

61070 ifÐ!
	gp
 ){

61071 
sql™e3E¼Ü
(
pDe¡Db
, 
SQLITE_NOMEM
);

61076 ifÐ
	gp
 ){

61077 
	gp
->
	gpSrc
 = 
fšdBŒ“
(
pDe¡Db
, 
pSrcDb
, 
zSrcDb
);

61078 
	gp
->
	gpDe¡
 = 
fšdBŒ“
(
pDe¡Db
,…De¡Db, 
zDe¡Db
);

61079 
	gp
->
	gpDe¡Db
 = 
pDe¡Db
;

61080 
	gp
->
	gpSrcDb
 = 
pSrcDb
;

61081 
	gp
->
	giNext
 = 1;

61082 
	gp
->
	gisA‰ached
 = 0;

61084 ifÐ0==
p
->
pSrc
 || 0=õ->
pDe¡
 || 
£tDe¡Pgsz
Õ)==
SQLITE_NOMEM
 ){

61090 
sql™e3_ä“
(
p
);

61091 
	gp
 = 0;

61094 ifÐ
	gp
 ){

61095 
	gp
->
	gpSrc
->
	gnBackup
++;

61098 
sql™e3_mu‹x_Ëave
(
pDe¡Db
->
mu‹x
);

61099 
sql™e3_mu‹x_Ëave
(
pSrcDb
->
mu‹x
);

61100  
	gp
;

61108 
isF©®E¼Ü
(
rc
){

61109  (
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_BUSY
 && 
ALWAYS
Ôc!=
SQLITE_LOCKED
));

61117 
backupOÃPage
(

61118 
sql™e3_backup
 *
p
,

61119 
Pgno
 
iSrcPg
,

61120 cÚ¡ 
u8
 *
zSrcD©a
,

61121 
bUpd©e


61123 
Pag”
 * cÚ¡ 
	gpDe¡Pag”
 = 
sql™e3BŒ“Pag”
(
p
->
pDe¡
);

61124 cÚ¡ 
	gnSrcPgsz
 = 
sql™e3BŒ“G‘PageSize
(
p
->
pSrc
);

61125 
	gnDe¡Pgsz
 = 
sql™e3BŒ“G‘PageSize
(
p
->
pDe¡
);

61126 cÚ¡ 
	gnCÝy
 = 
MIN
(
nSrcPgsz
, 
nDe¡Pgsz
);

61127 cÚ¡ 
i64
 
	giEnd
 = (i64)
iSrcPg
*(i64)
nSrcPgsz
;

61128 #ifdeà
SQLITE_HAS_CODEC


61132 
	gnSrcRe£rve
 = 
sql™e3BŒ“G‘Re£rveNoMu‹x
(
p
->
pSrc
);

61133 
	gnDe¡Re£rve
 = 
sql™e3BŒ“G‘Re£rve
(
p
->
pDe¡
);

61135 
	grc
 = 
SQLITE_OK
;

61136 
i64
 
	giOff
;

61138 
as£¹
Ð
sql™e3BŒ“G‘Re£rveNoMu‹x
(
p
->
pSrc
)>=0 );

61139 
as£¹
Ð
p
->
bDe¡Locked
 );

61140 
as£¹
Ð!
isF©®E¼Ü
(
p
->
rc
) );

61141 
as£¹
Ð
iSrcPg
!=
PENDING_BYTE_PAGE
(
p
->
pSrc
->
pBt
) );

61142 
as£¹
Ð
zSrcD©a
 );

61147 ifÐ
	gnSrcPgsz
!=
nDe¡Pgsz
 && 
sql™e3Pag”IsMemdb
(
pDe¡Pag”
) ){

61148 
rc
 = 
SQLITE_READONLY
;

61151 #ifdeà
SQLITE_HAS_CODEC


61155 ifÐ
	gnSrcPgsz
!=
nDe¡Pgsz
 && 
sql™e3Pag”G‘Codec
(
pDe¡Pag”
)!=0 ){

61156 
rc
 = 
SQLITE_READONLY
;

61164 ifÐ
	gnSrcRe£rve
!=
nDe¡Re£rve
 ){

61165 
u32
 
ÃwPgsz
 = 
nSrcPgsz
;

61166 
	grc
 = 
sql™e3Pag”S‘Pagesize
(
pDe¡Pag”
, &
ÃwPgsz
, 
nSrcRe£rve
);

61167 ifÐ
	grc
==
SQLITE_OK
 && 
ÃwPgsz
!=
nSrcPgsz
 ) 
rc
 = 
SQLITE_READONLY
;

61175 
	giOff
=
iEnd
-(
i64
)
nSrcPgsz
; 
	grc
==
SQLITE_OK
 && 
iOff
<iEnd; iOff+=
nDe¡Pgsz
){

61176 
DbPage
 *
pDe¡Pg
 = 0;

61177 
Pgno
 
	giDe¡
 = (Pgno)(
iOff
/
nDe¡Pgsz
)+1;

61178 ifÐ
	giDe¡
==
PENDING_BYTE_PAGE
(
p
->
pDe¡
->
pBt
) ) ;

61179 ifÐ
	gSQLITE_OK
==(
rc
 = 
sql™e3Pag”G‘
(
pDe¡Pag”
, 
iDe¡
, &
pDe¡Pg
))

61180 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3Pag”Wr™e
(
pDe¡Pg
))

61182 cÚ¡ 
u8
 *
zIn
 = &
zSrcD©a
[
iOff
%
nSrcPgsz
];

61183 
u8
 *
	gzDe¡D©a
 = 
sql™e3Pag”G‘D©a
(
pDe¡Pg
);

61184 
u8
 *
	gzOut
 = &
zDe¡D©a
[
iOff
%
nDe¡Pgsz
];

61193 
memýy
(
zOut
, 
zIn
, 
nCÝy
);

61194 ((
	gu8
 *)
sql™e3Pag”G‘ExŒa
(
pDe¡Pg
))[0] = 0;

61195 ifÐ
	giOff
==0 && 
bUpd©e
==0 ){

61196 
sql™e3Put4by‹
(&
zOut
[28], 
sql™e3BŒ“La¡Page
(
p
->
pSrc
));

61199 
sql™e3Pag”UÄef
(
pDe¡Pg
);

61202  
	grc
;

61213 
backupTrunÿ‹Fže
(
sql™e3_fže
 *
pFže
, 
i64
 
iSize
){

61214 
i64
 
	giCu¼’t
;

61215 
	grc
 = 
sql™e3OsFžeSize
(
pFže
, &
iCu¼’t
);

61216 ifÐ
	grc
==
SQLITE_OK
 && 
iCu¼’t
>
iSize
 ){

61217 
rc
 = 
sql™e3OsTrunÿ‹
(
pFže
, 
iSize
);

61219  
	grc
;

61226 
©chBackupObjeù
(
sql™e3_backup
 *
p
){

61227 
sql™e3_backup
 **
	gµ
;

61228 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
p
->
pSrc
) );

61229 
	gµ
 = 
sql™e3Pag”BackupPŒ
(
sql™e3BŒ“Pag”
(
p
->
pSrc
));

61230 
	gp
->
	gpNext
 = *
µ
;

61231 *
	gµ
 = 
p
;

61232 
	gp
->
	gisA‰ached
 = 1;

61238 
SQLITE_API
 
sql™e3_backup_¡•
(
sql™e3_backup
 *
p
, 
nPage
){

61239 
	grc
;

61240 
	gde¡Mode
;

61241 
	gpgszSrc
 = 0;

61242 
	gpgszDe¡
 = 0;

61244 
sql™e3_mu‹x_’‹r
(
p
->
pSrcDb
->
mu‹x
);

61245 
sql™e3BŒ“EÁ”
(
p
->
pSrc
);

61246 ifÐ
	gp
->
	gpDe¡Db
 ){

61247 
sql™e3_mu‹x_’‹r
(
p
->
pDe¡Db
->
mu‹x
);

61250 
	grc
 = 
p
->
rc
;

61251 ifÐ!
isF©®E¼Ü
(
rc
) ){

61252 
Pag”
 * cÚ¡ 
	gpSrcPag”
 = 
sql™e3BŒ“Pag”
(
p
->
pSrc
);

61253 
Pag”
 * cÚ¡ 
	gpDe¡Pag”
 = 
sql™e3BŒ“Pag”
(
p
->
pDe¡
);

61254 
	gii
;

61255 
	gnSrcPage
 = -1;

61256 
	gbClo£T¿ns
 = 0;

61261 ifÐ
	gp
->
	gpDe¡Db
 &&…->
	gpSrc
->
	gpBt
->
	gšT¿n§ùiÚ
==
TRANS_WRITE
 ){

61262 
rc
 = 
SQLITE_BUSY
;

61264 
	grc
 = 
SQLITE_OK
;

61268 ifÐ
	gSQLITE_OK
==
rc
 && 
p
->
bDe¡Locked
==0

61269 && 
SQLITE_OK
==(
rc
 = 
sql™e3BŒ“BegšT¿ns
(
p
->
pDe¡
, 2))

61271 
	gp
->
	gbDe¡Locked
 = 1;

61272 
sql™e3BŒ“G‘M‘a
(
p
->
pDe¡
, 
BTREE_SCHEMA_VERSION
, &p->
iDe¡Schema
);

61279 ifÐ
	grc
==
SQLITE_OK
 && 0==
sql™e3BŒ“IsInR—dT¿ns
(
p
->
pSrc
) ){

61280 
rc
 = 
sql™e3BŒ“BegšT¿ns
(
p
->
pSrc
, 0);

61281 
	gbClo£T¿ns
 = 1;

61286 
	gpgszSrc
 = 
sql™e3BŒ“G‘PageSize
(
p
->
pSrc
);

61287 
	gpgszDe¡
 = 
sql™e3BŒ“G‘PageSize
(
p
->
pDe¡
);

61288 
	gde¡Mode
 = 
sql™e3Pag”G‘Jouº®Mode
(
sql™e3BŒ“Pag”
(
p
->
pDe¡
));

61289 ifÐ
	gSQLITE_OK
==
rc
 && 
de¡Mode
==
PAGER_JOURNALMODE_WAL
 && 
pgszSrc
!=
pgszDe¡
 ){

61290 
rc
 = 
SQLITE_READONLY
;

61296 
	gnSrcPage
 = ()
sql™e3BŒ“La¡Page
(
p
->
pSrc
);

61297 
as£¹
Ð
nSrcPage
>=0 );

61298 
	gii
=0; (
	gnPage
<0 || ii<nPageè&& 
	gp
->
	giNext
<=(
Pgno
)
nSrcPage
 && !
rc
; ii++){

61299 cÚ¡ 
Pgno
 
	giSrcPg
 = 
p
->
iNext
;

61300 ifÐ
	giSrcPg
!=
PENDING_BYTE_PAGE
(
p
->
pSrc
->
pBt
) ){

61301 
DbPage
 *
pSrcPg
;

61302 
	grc
 = 
sql™e3Pag”Acquœe
(
pSrcPag”
, 
iSrcPg
, &
pSrcPg
,

61303 
PAGER_GET_READONLY
);

61304 ifÐ
	grc
==
SQLITE_OK
 ){

61305 
rc
 = 
backupOÃPage
(
p
, 
iSrcPg
, 
sql™e3Pag”G‘D©a
(
pSrcPg
), 0);

61306 
sql™e3Pag”UÄef
(
pSrcPg
);

61309 
	gp
->
	giNext
++;

61311 ifÐ
	grc
==
SQLITE_OK
 ){

61312 
p
->
nPagecouÁ
 = 
nSrcPage
;

61313 
	gp
->
	gnRemaššg
 = 
nSrcPage
+1-
p
->
iNext
;

61314 ifÐ
	gp
->
	giNext
>(
	gPgno
)
	gnSrcPage
 ){

61315 
	grc
 = 
SQLITE_DONE
;

61316 }ifÐ!
	gp
->
	gisA‰ached
 ){

61317 
©chBackupObjeù
(
p
);

61326 ifÐ
	grc
==
SQLITE_DONE
 ){

61327 ifÐ
nSrcPage
==0 ){

61328 
rc
 = 
sql™e3BŒ“NewDb
(
p
->
pDe¡
);

61329 
	gnSrcPage
 = 1;

61331 ifÐ
	grc
==
SQLITE_OK
 || 
rc
==
SQLITE_DONE
 ){

61332 
rc
 = 
sql™e3BŒ“Upd©eM‘a
(
p
->
pDe¡
,1,p->
iDe¡Schema
+1);

61334 ifÐ
	grc
==
SQLITE_OK
 ){

61335 ifÐ
p
->
pDe¡Db
 ){

61336 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
p
->
pDe¡Db
);

61338 ifÐ
	gde¡Mode
==
PAGER_JOURNALMODE_WAL
 ){

61339 
rc
 = 
sql™e3BŒ“S‘V”siÚ
(
p
->
pDe¡
, 2);

61342 ifÐ
	grc
==
SQLITE_OK
 ){

61343 
nDe¡Trunÿ‹
;

61356 
as£¹
Ð
pgszSrc
==
sql™e3BŒ“G‘PageSize
(
p
->
pSrc
) );

61357 
as£¹
Ð
pgszDe¡
==
sql™e3BŒ“G‘PageSize
(
p
->
pDe¡
) );

61358 ifÐ
	gpgszSrc
<
	gpgszDe¡
 ){

61359 
	g¿tio
 = 
pgszDe¡
/
pgszSrc
;

61360 
	gnDe¡Trunÿ‹
 = (
nSrcPage
+
¿tio
-1)/ratio;

61361 ifÐ
	gnDe¡Trunÿ‹
==()
PENDING_BYTE_PAGE
(
p
->
pDe¡
->
pBt
) ){

61362 
nDe¡Trunÿ‹
--;

61365 
	gnDe¡Trunÿ‹
 = 
nSrcPage
 * (
pgszSrc
/
pgszDe¡
);

61367 
as£¹
Ð
nDe¡Trunÿ‹
>0 );

61369 ifÐ
	gpgszSrc
<
	gpgszDe¡
 ){

61379 cÚ¡ 
i64
 
	giSize
 = (i64)
pgszSrc
 * (i64)
nSrcPage
;

61380 
sql™e3_fže
 * cÚ¡ 
	gpFže
 = 
sql™e3Pag”Fže
(
pDe¡Pag”
);

61381 
Pgno
 
	giPg
;

61382 
	gnD¡Page
;

61383 
i64
 
	giOff
;

61384 
i64
 
	giEnd
;

61386 
as£¹
Ð
pFže
 );

61387 
as£¹
Ð
nDe¡Trunÿ‹
==0

61388 || (
i64
)
nDe¡Trunÿ‹
*(i64)
pgszDe¡
 >ð
iSize
 || (

61389 
nDe¡Trunÿ‹
==()(
PENDING_BYTE_PAGE
(
p
->
pDe¡
->
pBt
)-1)

61390 && 
iSize
>=
PENDING_BYTE
 && iSize<=PENDING_BYTE+
pgszDe¡


61399 
sql™e3Pag”PagecouÁ
(
pDe¡Pag”
, &
nD¡Page
);

61400 
	giPg
=
nDe¡Trunÿ‹
; 
	grc
==
SQLITE_OK
 && 
iPg
<=(
Pgno
)
nD¡Page
; iPg++){

61401 ifÐ
	giPg
!=
PENDING_BYTE_PAGE
(
p
->
pDe¡
->
pBt
) ){

61402 
DbPage
 *
pPg
;

61403 
	grc
 = 
sql™e3Pag”G‘
(
pDe¡Pag”
, 
iPg
, &
pPg
);

61404 ifÐ
	grc
==
SQLITE_OK
 ){

61405 
rc
 = 
sql™e3Pag”Wr™e
(
pPg
);

61406 
sql™e3Pag”UÄef
(
pPg
);

61410 ifÐ
	grc
==
SQLITE_OK
 ){

61411 
rc
 = 
sql™e3Pag”Comm™Pha£OÃ
(
pDe¡Pag”
, 0, 1);

61415 
	giEnd
 = 
MIN
(
PENDING_BYTE
 + 
pgszDe¡
, 
iSize
);

61417 
	giOff
=
PENDING_BYTE
+
pgszSrc
;

61418 
	grc
==
SQLITE_OK
 && 
iOff
<
iEnd
;

61419 
	giOff
+=
pgszSrc


61421 
PgHdr
 *
pSrcPg
 = 0;

61422 cÚ¡ 
Pgno
 
	giSrcPg
 = (Pgno)((
iOff
/
pgszSrc
)+1);

61423 
	grc
 = 
sql™e3Pag”G‘
(
pSrcPag”
, 
iSrcPg
, &
pSrcPg
);

61424 ifÐ
	grc
==
SQLITE_OK
 ){

61425 
u8
 *
zD©a
 = 
sql™e3Pag”G‘D©a
(
pSrcPg
);

61426 
	grc
 = 
sql™e3OsWr™e
(
pFže
, 
zD©a
, 
pgszSrc
, 
iOff
);

61428 
sql™e3Pag”UÄef
(
pSrcPg
);

61430 ifÐ
	grc
==
SQLITE_OK
 ){

61431 
rc
 = 
backupTrunÿ‹Fže
(
pFže
, 
iSize
);

61435 ifÐ
	grc
==
SQLITE_OK
 ){

61436 
rc
 = 
sql™e3Pag”Sync
(
pDe¡Pag”
, 0);

61439 
sql™e3Pag”Trunÿ‹Image
(
pDe¡Pag”
, 
nDe¡Trunÿ‹
);

61440 
	grc
 = 
sql™e3Pag”Comm™Pha£OÃ
(
pDe¡Pag”
, 0, 0);

61444 ifÐ
	gSQLITE_OK
==
rc


61445 && 
SQLITE_OK
==(
rc
 = 
sql™e3BŒ“Comm™Pha£Two
(
p
->
pDe¡
, 0))

61447 
	grc
 = 
SQLITE_DONE
;

61457 ifÐ
	gbClo£T¿ns
 ){

61458 
TESTONLY
Ð
rc2
 );

61459 
TESTONLY
Ð
rc2
 = ) 
sql™e3BŒ“Comm™Pha£OÃ
(
p
->
pSrc
, 0);

61460 
TESTONLY
Ð
rc2
 |ðè
sql™e3BŒ“Comm™Pha£Two
(
p
->
pSrc
, 0);

61461 
as£¹
Ð
rc2
==
SQLITE_OK
 );

61464 ifÐ
	grc
==
SQLITE_IOERR_NOMEM
 ){

61465 
rc
 = 
SQLITE_NOMEM
;

61467 
	gp
->
	grc
 = 
rc
;

61469 ifÐ
	gp
->
	gpDe¡Db
 ){

61470 
sql™e3_mu‹x_Ëave
(
p
->
pDe¡Db
->
mu‹x
);

61472 
sql™e3BŒ“L—ve
(
p
->
pSrc
);

61473 
sql™e3_mu‹x_Ëave
(
p
->
pSrcDb
->
mu‹x
);

61474  
	grc
;

61480 
SQLITE_API
 
sql™e3_backup_fšish
(
sql™e3_backup
 *
p
){

61481 
sql™e3_backup
 **
	gµ
;

61482 
sql™e3
 *
	gpSrcDb
;

61483 
	grc
;

61486 ifÐ
	gp
==0 )  
SQLITE_OK
;

61487 
	gpSrcDb
 = 
p
->
pSrcDb
;

61488 
sql™e3_mu‹x_’‹r
(
pSrcDb
->
mu‹x
);

61489 
sql™e3BŒ“EÁ”
(
p
->
pSrc
);

61490 ifÐ
	gp
->
	gpDe¡Db
 ){

61491 
sql™e3_mu‹x_’‹r
(
p
->
pDe¡Db
->
mu‹x
);

61495 ifÐ
	gp
->
	gpDe¡Db
 ){

61496 
	gp
->
	gpSrc
->
	gnBackup
--;

61498 ifÐ
	gp
->
	gisA‰ached
 ){

61499 
	gµ
 = 
sql™e3Pag”BackupPŒ
(
sql™e3BŒ“Pag”
(
p
->
pSrc
));

61500  *
	gµ
!=
p
 ){

61501 
µ
 = &(*µ)->
pNext
;

61503 *
	gµ
 = 
p
->
pNext
;

61507 
sql™e3BŒ“RÞlback
(
p
->
pDe¡
, 
SQLITE_OK
, 0);

61510 
	grc
 = (
p
->
rc
==
SQLITE_DONE
è? 
SQLITE_OK
 :…->rc;

61511 ifÐ
	gp
->
	gpDe¡Db
 ){

61512 
sql™e3E¼Ü
(
p
->
pDe¡Db
, 
rc
);

61515 
sql™e3L—veMu‹xAndClo£Zomb›
(
p
->
pDe¡Db
);

61517 
sql™e3BŒ“L—ve
(
p
->
pSrc
);

61518 ifÐ
	gp
->
	gpDe¡Db
 ){

61522 
sql™e3_ä“
(
p
);

61524 
sql™e3L—veMu‹xAndClo£Zomb›
(
pSrcDb
);

61525  
	grc
;

61532 
SQLITE_API
 
sql™e3_backup_»maššg
(
sql™e3_backup
 *
p
){

61533  
	gp
->
	gnRemaššg
;

61540 
SQLITE_API
 
sql™e3_backup_·gecouÁ
(
sql™e3_backup
 *
p
){

61541  
	gp
->
	gnPagecouÁ
;

61556 
SQLITE_PRIVATE
 
sql™e3BackupUpd©e
(
sql™e3_backup
 *
pBackup
, 
Pgno
 
iPage
, cÚ¡ 
u8
 *
aD©a
){

61557 
sql™e3_backup
 *
	gp
;

61558 
	gp
=
pBackup
;…;…=
p
->
pNext
){

61559 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pSrc
->
pBt
->
mu‹x
) );

61560 ifÐ!
isF©®E¼Ü
(
p
->
rc
è&& 
	giPage
<
	gp
->
	giNext
 ){

61565 
	grc
;

61566 
as£¹
Ð
p
->
pDe¡Db
 );

61567 
sql™e3_mu‹x_’‹r
(
p
->
pDe¡Db
->
mu‹x
);

61568 
	grc
 = 
backupOÃPage
(
p
, 
iPage
, 
aD©a
, 1);

61569 
sql™e3_mu‹x_Ëave
(
p
->
pDe¡Db
->
mu‹x
);

61570 
as£¹
Ð
rc
!=
SQLITE_BUSY
 &&„c!=
SQLITE_LOCKED
 );

61571 ifÐ
	grc
!=
SQLITE_OK
 ){

61572 
p
->
rc
 =„c;

61589 
SQLITE_PRIVATE
 
sql™e3BackupRe¡¬t
(
sql™e3_backup
 *
pBackup
){

61590 
sql™e3_backup
 *
	gp
;

61591 
	gp
=
pBackup
;…;…=
p
->
pNext
){

61592 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pSrc
->
pBt
->
mu‹x
) );

61593 
	gp
->
	giNext
 = 1;

61597 #iâdeà
SQLITE_OMIT_VACUUM


61606 
SQLITE_PRIVATE
 
sql™e3BŒ“CÝyFže
(
BŒ“
 *
pTo
, BŒ“ *
pFrom
){

61607 
	grc
;

61608 
sql™e3_fže
 *
	gpFd
;

61609 
sql™e3_backup
 
	gb
;

61610 
sql™e3BŒ“EÁ”
(
pTo
);

61611 
sql™e3BŒ“EÁ”
(
pFrom
);

61613 
as£¹
Ð
sql™e3BŒ“IsInT¿ns
(
pTo
) );

61614 
	gpFd
 = 
sql™e3Pag”Fže
(
sql™e3BŒ“Pag”
(
pTo
));

61615 ifÐ
	gpFd
->
	gpM‘hods
 ){

61616 
i64
 
	gnBy‹
 = 
sql™e3BŒ“G‘PageSize
(
pFrom
)*(i64)
sql™e3BŒ“La¡Page
(pFrom);

61617 
	grc
 = 
sql™e3OsFžeCÚŒÞ
(
pFd
, 
SQLITE_FCNTL_OVERWRITE
, &
nBy‹
);

61618 ifÐ
	grc
==
SQLITE_NOTFOUND
 ) 
rc
 = 
SQLITE_OK
;

61619 ifÐ
	grc
 ) 
	gcÝy_fšished
;

61627 
mem£t
(&
b
, 0, (b));

61628 
	gb
.
	gpSrcDb
 = 
pFrom
->
db
;

61629 
	gb
.
	gpSrc
 = 
pFrom
;

61630 
	gb
.
	gpDe¡
 = 
pTo
;

61631 
	gb
.
	giNext
 = 1;

61640 
sql™e3_backup_¡•
(&
b
, 0x7FFFFFFF);

61641 
as£¹
Ð
b
.
rc
!=
SQLITE_OK
 );

61642 
	grc
 = 
sql™e3_backup_fšish
(&
b
);

61643 ifÐ
	grc
==
SQLITE_OK
 ){

61644 
pTo
->
pBt
->
btsFÏgs
 &ð~
BTS_PAGESIZE_FIXED
;

61646 
sql™e3Pag”CË¬Cache
(
sql™e3BŒ“Pag”
(
b
.
pDe¡
));

61649 
as£¹
Ð
sql™e3BŒ“IsInT¿ns
(
pTo
)==0 );

61650 
	gcÝy_fšished
:

61651 
sql™e3BŒ“L—ve
(
pFrom
);

61652 
sql™e3BŒ“L—ve
(
pTo
);

61653  
	grc
;

61677 #ifdeà
SQLITE_DEBUG


61684 
SQLITE_PRIVATE
 
sql™e3VdbeCheckMemInv¬ŸÁs
(
Mem
 *
p
){

61688 
as£¹
Ð(
p
->
æags
 & 
MEM_Dyn
)==0 ||…->
xD–
!=0 );

61694 
as£¹
Ð(
p
->
æags
 & 
MEM_Dyn
)==0 ||…->
szM®loc
==0 );

61697 
as£¹
Ð(
p
->
æags
 & (
MEM_IÁ
|
MEM_R—l
))!=(MEM_Int|MEM_Real) );

61700 
as£¹
Ð
p
->
szM®loc
==0

61701 || 
p
->
szM®loc
==
sql™e3DbM®locSize
Õ->
db
,p->
zM®loc
) );

61711 ifÐ(
	gp
->
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
)è&&…->
	gn
>0 ){

61712 
as£¹
(

61713 ((
p
->
szM®loc
>0 &&…->
z
=õ->
zM®loc
)? 1 : 0) +

61714 ((
p
->
æags
&
MEM_Dyn
)!=0 ? 1 : 0) +

61715 ((
p
->
æags
&
MEM_Ephem
)!=0 ? 1 : 0) +

61716 ((
p
->
æags
&
MEM_Stic
)!=0 ? 1 : 0) == 1

61737 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeEncodšg
(
Mem
 *
pMem
, 
desœedEnc
){

61738 #iâdeà
SQLITE_OMIT_UTF16


61739 
	grc
;

61741 
as£¹
Ð(
pMem
->
æags
&
MEM_RowS‘
)==0 );

61742 
as£¹
Ð
desœedEnc
==
SQLITE_UTF8
 || desœedEnc==
SQLITE_UTF16LE


61743 || 
desœedEnc
==
SQLITE_UTF16BE
 );

61744 ifÐ!(
	gpMem
->
	gæags
&
	gMEM_SŒ
è||…Mem->
	g’c
==
desœedEnc
 ){

61745  
SQLITE_OK
;

61747 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61748 #ifdeà
SQLITE_OMIT_UTF16


61749  
	gSQLITE_ERROR
;

61755 
	grc
 = 
sql™e3VdbeMemT¿n¦©e
(
pMem
, (
u8
)
desœedEnc
);

61756 
as£¹
(
rc
==
SQLITE_OK
 ||„c==
SQLITE_NOMEM
);

61757 
as£¹
(
rc
==
SQLITE_OK
 || 
pMem
->
’c
!=
desœedEnc
);

61758 
as£¹
(
rc
==
SQLITE_NOMEM
 || 
pMem
->
’c
==
desœedEnc
);

61759  
	grc
;

61772 
SQLITE_PRIVATE
 
SQLITE_NOINLINE
 
sql™e3VdbeMemGrow
(
Mem
 *
pMem
, 
n
, 
bP»£rve
){

61773 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(
pMem
) );

61774 
as£¹
Ð(
pMem
->
æags
&
MEM_RowS‘
)==0 );

61778 
as£¹
Ð
bP»£rve
==0 || 
pMem
->
æags
&(
MEM_Blob
|
MEM_SŒ
) );

61779 
‹¡ÿ£
Ð
bP»£rve
 && 
pMem
->
z
==0 );

61781 
as£¹
Ð
pMem
->
szM®loc
==0

61782 || 
pMem
->
szM®loc
==
sql™e3DbM®locSize
ÕMem->
db
,…Mem->
zM®loc
) );

61783 ifÐ
	gpMem
->
	gszM®loc
<
	gn
 ){

61784 ifÐ
	gn
<32 )‚ = 32;

61785 ifÐ
	gbP»£rve
 && 
	gpMem
->
	gszM®loc
>0 &&…Mem->
	gz
==
pMem
->
zM®loc
 ){

61786 
pMem
->
z
 =…Mem->
zM®loc
 = 
sql™e3DbR—ÎocOrF»e
ÕMem->
db
,…Mem->z, 
n
);

61787 
	gbP»£rve
 = 0;

61789 ifÐ
	gpMem
->
	gszM®loc
>0 ) 
sql™e3DbF»e
(
pMem
->
db
,…Mem->
zM®loc
);

61790 
	gpMem
->
	gzM®loc
 = 
sql™e3DbM®locRaw
(
pMem
->
db
, 
n
);

61792 ifÐ
	gpMem
->
	gzM®loc
==0 ){

61793 
sql™e3VdbeMemS‘NuÎ
(
pMem
);

61794 
	gpMem
->
	gz
 = 0;

61795 
	gpMem
->
	gszM®loc
 = 0;

61796  
	gSQLITE_NOMEM
;

61798 
	gpMem
->
	gszM®loc
 = 
sql™e3DbM®locSize
(
pMem
->
db
,…Mem->
zM®loc
);

61802 ifÐ
	gbP»£rve
 && 
	gpMem
->
	gz
 &&…Mem->z!=
pMem
->
zM®loc
 ){

61803 
memýy
(
pMem
->
zM®loc
,…Mem->
z
,…Mem->
n
);

61805 ifÐ(
	gpMem
->
	gæags
&
	gMEM_Dyn
)!=0 ){

61806 
as£¹
Ð
pMem
->
xD–
!=0 &&…Mem->xD–!=
SQLITE_DYNAMIC
 );

61807 
	gpMem
->
xD–
((*)(
pMem
->
z
));

61810 
	gpMem
->
	gz
 = 
pMem
->
zM®loc
;

61811 
	gpMem
->
	gæags
 &ð~(
MEM_Dyn
|
MEM_Ephem
|
MEM_Stic
);

61812  
	gSQLITE_OK
;

61828 
SQLITE_PRIVATE
 
sql™e3VdbeMemCË¬AndResize
(
Mem
 *
pMem
, 
szNew
){

61829 
as£¹
Ð
szNew
>0 );

61830 
as£¹
Ð(
pMem
->
æags
 & 
MEM_Dyn
)==0 ||…Mem->
szM®loc
==0 );

61831 ifÐ
	gpMem
->
	gszM®loc
<
	gszNew
 ){

61832  
sql™e3VdbeMemGrow
(
pMem
, 
szNew
, 0);

61834 
as£¹
Ð(
pMem
->
æags
 & 
MEM_Dyn
)==0 );

61835 
	gpMem
->
	gz
 = 
pMem
->
zM®loc
;

61836 
	gpMem
->
	gæags
 &ð(
MEM_NuÎ
|
MEM_IÁ
|
MEM_R—l
);

61837  
	gSQLITE_OK
;

61846 
SQLITE_PRIVATE
 
sql™e3VdbeMemMakeWr™—bË
(
Mem
 *
pMem
){

61847 
	gf
;

61848 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61849 
as£¹
Ð(
pMem
->
æags
&
MEM_RowS‘
)==0 );

61850 
Ex·ndBlob
(
pMem
);

61851 
	gf
 = 
pMem
->
æags
;

61852 ifÐ(
	gf
&(
	gMEM_SŒ
|
	gMEM_Blob
)è&& (
	gpMem
->
	gszM®loc
==0 || 
pMem
->
z
!õMem->
zM®loc
) ){

61853 ifÐ
sql™e3VdbeMemGrow
(
pMem
,…Mem->
n
 + 2, 1) ){

61854  
SQLITE_NOMEM
;

61856 
	gpMem
->
	gz
[
pMem
->
n
] = 0;

61857 
	gpMem
->
	gz
[
pMem
->
n
+1] = 0;

61858 
	gpMem
->
	gæags
 |ð
MEM_T”m
;

61859 #ifdeà
SQLITE_DEBUG


61860 
	gpMem
->
	gpScÝyFrom
 = 0;

61864  
	gSQLITE_OK
;

61871 #iâdeà
SQLITE_OMIT_INCRBLOB


61872 
SQLITE_PRIVATE
 
sql™e3VdbeMemEx·ndBlob
(
Mem
 *
pMem
){

61873 ifÐ
	gpMem
->
	gæags
 & 
	gMEM_Z”o
 ){

61874 
	gnBy‹
;

61875 
as£¹
Ð
pMem
->
æags
&
MEM_Blob
 );

61876 
as£¹
Ð(
pMem
->
æags
&
MEM_RowS‘
)==0 );

61877 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61880 
	gnBy‹
 = 
pMem
->
n
 +…Mem->
u
.
nZ”o
;

61881 ifÐ
	gnBy‹
<=0 ){

61882 
nBy‹
 = 1;

61884 ifÐ
sql™e3VdbeMemGrow
(
pMem
, 
nBy‹
, 1) ){

61885  
	gSQLITE_NOMEM
;

61888 
mem£t
(&
pMem
->
z
[pMem->
n
], 0,…Mem->
u
.
nZ”o
);

61889 
	gpMem
->
	gn
 +ð
pMem
->
u
.
nZ”o
;

61890 
	gpMem
->
	gæags
 &ð~(
MEM_Z”o
|
MEM_T”m
);

61892  
	gSQLITE_OK
;

61900 
SQLITE_NOINLINE
 
vdbeMemAddT”mš©Ü
(
Mem
 *
pMem
){

61901 ifÐ
sql™e3VdbeMemGrow
(
pMem
,…Mem->
n
+2, 1) ){

61902  
	gSQLITE_NOMEM
;

61904 
	gpMem
->
	gz
[
pMem
->
n
] = 0;

61905 
	gpMem
->
	gz
[
pMem
->
n
+1] = 0;

61906 
	gpMem
->
	gæags
 |ð
MEM_T”m
;

61907  
	gSQLITE_OK
;

61913 
SQLITE_PRIVATE
 
sql™e3VdbeMemNulT”mš©e
(
Mem
 *
pMem
){

61914 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61915 
‹¡ÿ£
Ð(
pMem
->
æags
 & (
MEM_T”m
|
MEM_SŒ
))==(MEM_Term|MEM_Str) );

61916 
‹¡ÿ£
Ð(
pMem
->
æags
 & (
MEM_T”m
|
MEM_SŒ
))==0 );

61917 ifÐ(
	gpMem
->
	gæags
 & (
	gMEM_T”m
|
	gMEM_SŒ
))!=
MEM_SŒ
 ){

61918  
SQLITE_OK
;

61920  
vdbeMemAddT”mš©Ü
(
pMem
);

61938 
SQLITE_PRIVATE
 
sql™e3VdbeMemSŒšgify
(
Mem
 *
pMem
, 
u8
 
’c
, u8 
bFÜû
){

61939 
	gfg
 = 
pMem
->
æags
;

61940 cÚ¡ 
	gnBy‹
 = 32;

61942 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61943 
as£¹
Ð!(
fg
&
MEM_Z”o
) );

61944 
as£¹
Ð!(
fg
&(
MEM_SŒ
|
MEM_Blob
)) );

61945 
as£¹
Ð
fg
&(
MEM_IÁ
|
MEM_R—l
) );

61946 
as£¹
Ð(
pMem
->
æags
&
MEM_RowS‘
)==0 );

61947 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

61950 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pMem
, 
nBy‹
) ){

61951  
	gSQLITE_NOMEM
;

61960 ifÐ
	gfg
 & 
	gMEM_IÁ
 ){

61961 
sql™e3_¢´štf
(
nBy‹
, 
pMem
->
z
, "%Îd",…Mem->
u
.
i
);

61963 
as£¹
Ð
fg
 & 
MEM_R—l
 );

61964 
sql™e3_¢´štf
(
nBy‹
, 
pMem
->
z
, "%!.15g",…Mem->
u
.
r
);

61966 
	gpMem
->
	gn
 = 
sql™e3SŒËn30
(
pMem
->
z
);

61967 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

61968 
	gpMem
->
	gæags
 |ð
MEM_SŒ
|
MEM_T”m
;

61969 ifÐ
	gbFÜû
 ) 
	gpMem
->
	gæags
 &ð~(
MEM_IÁ
|
MEM_R—l
);

61970 
sql™e3VdbeChªgeEncodšg
(
pMem
, 
’c
);

61971  
	gSQLITE_OK
;

61982 
SQLITE_PRIVATE
 
sql™e3VdbeMemFš®ize
(
Mem
 *
pMem
, 
FuncDef
 *
pFunc
){

61983 
	grc
 = 
SQLITE_OK
;

61984 ifÐ
ALWAYS
(
pFunc
 &&…Func->
xFš®ize
) ){

61985 
sql™e3_cÚ‹xt
 
	gùx
;

61986 
Mem
 
	gt
;

61987 
as£¹
Ð(
pMem
->
æags
 & 
MEM_NuÎ
)!=0 || 
pFunc
=õMem->
u
.
pDef
 );

61988 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

61989 
mem£t
(&
ùx
, 0, (ctx));

61990 
mem£t
(&
t
, 0, (t));

61991 
	gt
.
	gæags
 = 
MEM_NuÎ
;

61992 
	gt
.
	gdb
 = 
pMem
->
db
;

61993 
	gùx
.
	gpOut
 = &
t
;

61994 
	gùx
.
	gpMem
 = 
pMem
;

61995 
	gùx
.
	gpFunc
 = 
pFunc
;

61996 
	gpFunc
->
xFš®ize
(&
ùx
);

61997 
as£¹
Ð(
pMem
->
æags
 & 
MEM_Dyn
)==0 );

61998 ifÐ
	gpMem
->
	gszM®loc
>0 ) 
sql™e3DbF»e
(
pMem
->
db
,…Mem->
zM®loc
);

61999 
memýy
(
pMem
, &
t
, (t));

62000 
	grc
 = 
ùx
.
isE¼Ü
;

62002  
	grc
;

62014 
SQLITE_NOINLINE
 
vdbeMemCË¬Ex‹ºAndS‘NuÎ
(
Mem
 *
p
){

62015 
as£¹
Ð
p
->
db
==0 || 
sql™e3_mu‹x_h–d
Õ->db->
mu‹x
) );

62016 
as£¹
Ð
VdbeMemDyÇmic
(
p
) );

62017 ifÐ
	gp
->
	gæags
&
	gMEM_Agg
 ){

62018 
sql™e3VdbeMemFš®ize
(
p
,…->
u
.
pDef
);

62019 
as£¹
Ð(
p
->
æags
 & 
MEM_Agg
)==0 );

62020 
‹¡ÿ£
Ð
p
->
æags
 & 
MEM_Dyn
 );

62022 ifÐ
	gp
->
	gæags
&
	gMEM_Dyn
 ){

62023 
as£¹
Ð(
p
->
æags
&
MEM_RowS‘
)==0 );

62024 
as£¹
Ð
p
->
xD–
!=
SQLITE_DYNAMIC
 &&…->xDel!=0 );

62025 
	gp
->
xD–
((*)
p
->
z
);

62026 }ifÐ
	gp
->
	gæags
&
	gMEM_RowS‘
 ){

62027 
sql™e3RowS‘CË¬
(
p
->
u
.
pRowS‘
);

62028 }ifÐ
	gp
->
	gæags
&
	gMEM_F¿me
 ){

62029 
VdbeF¿me
 *
	gpF¿me
 = 
p
->
u
.
pF¿me
;

62030 
	gpF¿me
->
	gpP¬’t
 = 
pF¿me
->
v
->
pD–F¿me
;

62031 
	gpF¿me
->
	gv
->
	gpD–F¿me
 = 
pF¿me
;

62033 
	gp
->
	gæags
 = 
MEM_NuÎ
;

62044 
SQLITE_NOINLINE
 
vdbeMemCË¬
(
Mem
 *
p
){

62045 ifÐ
VdbeMemDyÇmic
(
p
) ){

62046 
vdbeMemCË¬Ex‹ºAndS‘NuÎ
(
p
);

62048 ifÐ
	gp
->
	gszM®loc
 ){

62049 
sql™e3DbF»e
(
p
->
db
,…->
zM®loc
);

62050 
	gp
->
	gszM®loc
 = 0;

62052 
	gp
->
	gz
 = 0;

62065 
SQLITE_PRIVATE
 
sql™e3VdbeMemR–—£
(
Mem
 *
p
){

62066 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(
p
) );

62067 ifÐ
VdbeMemDyÇmic
(
p
è|| 
	gp
->
	gszM®loc
 ){

62068 
vdbeMemCË¬
(
p
);

62077 
i64
 
doubËToIÁ64
(
r
){

62078 #ifdeà
SQLITE_OMIT_FLOATING_POINT


62080  
	gr
;

62089 cÚ¡ 
i64
 
	gmaxIÁ
 = 
LARGEST_INT64
;

62090 cÚ¡ 
i64
 
	gmšIÁ
 = 
SMALLEST_INT64
;

62092 ifÐ
	gr
<=()
mšIÁ
 ){

62093  
mšIÁ
;

62094 }ifÐ
	gr
>=()
maxIÁ
 ){

62095  
maxIÁ
;

62097  (
	gi64
)
	gr
;

62113 
SQLITE_PRIVATE
 
i64
 
sql™e3VdbeIÁV®ue
(
Mem
 *
pMem
){

62114 
	gæags
;

62115 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62116 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

62117 
	gæags
 = 
pMem
->
æags
;

62118 ifÐ
	gæags
 & 
	gMEM_IÁ
 ){

62119  
	gpMem
->
	gu
.
	gi
;

62120 }ifÐ
	gæags
 & 
	gMEM_R—l
 ){

62121  
doubËToIÁ64
(
pMem
->
u
.
r
);

62122 }ifÐ
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
) ){

62123 
i64
 
	gv®ue
 = 0;

62124 
as£¹
Ð
pMem
->
z
 ||…Mem->
n
==0 );

62125 
sql™e3Atoi64
(
pMem
->
z
, &
v®ue
,…Mem->
n
,…Mem->
’c
);

62126  
	gv®ue
;

62138 
SQLITE_PRIVATE
 
sql™e3VdbeR—lV®ue
(
Mem
 *
pMem
){

62139 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62140 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

62141 ifÐ
	gpMem
->
	gæags
 & 
	gMEM_R—l
 ){

62142  
	gpMem
->
	gu
.
	gr
;

62143 }ifÐ
	gpMem
->
	gæags
 & 
	gMEM_IÁ
 ){

62144  ()
	gpMem
->
	gu
.
	gi
;

62145 }ifÐ
	gpMem
->
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
) ){

62147 
	gv®
 = ()0;

62148 
sql™e3AtoF
(
pMem
->
z
, &
v®
,…Mem->
n
,…Mem->
’c
);

62149  
	gv®
;

62160 
SQLITE_PRIVATE
 
sql™e3VdbeIÁeg”Affš™y
(
Mem
 *
pMem
){

62161 
i64
 
	gix
;

62162 
as£¹
Ð
pMem
->
æags
 & 
MEM_R—l
 );

62163 
as£¹
Ð(
pMem
->
æags
 & 
MEM_RowS‘
)==0 );

62164 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62165 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

62167 
	gix
 = 
doubËToIÁ64
(
pMem
->
u
.
r
);

62179 ifÐ
	gpMem
->
	gu
.
	gr
==
ix
 && ix>
SMALLEST_INT64
 && ix<
LARGEST_INT64
 ){

62180 
pMem
->
u
.
i
 = 
ix
;

62181 
MemS‘Ty³FÏg
(
pMem
, 
MEM_IÁ
);

62188 
SQLITE_PRIVATE
 
sql™e3VdbeMemIÁeg”ify
(
Mem
 *
pMem
){

62189 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62190 
as£¹
Ð(
pMem
->
æags
 & 
MEM_RowS‘
)==0 );

62191 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

62193 
	gpMem
->
	gu
.
	gi
 = 
sql™e3VdbeIÁV®ue
(
pMem
);

62194 
MemS‘Ty³FÏg
(
pMem
, 
MEM_IÁ
);

62195  
	gSQLITE_OK
;

62202 
SQLITE_PRIVATE
 
sql™e3VdbeMemR—lify
(
Mem
 *
pMem
){

62203 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62204 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

62206 
	gpMem
->
	gu
.
	gr
 = 
sql™e3VdbeR—lV®ue
(
pMem
);

62207 
MemS‘Ty³FÏg
(
pMem
, 
MEM_R—l
);

62208  
	gSQLITE_OK
;

62219 
SQLITE_PRIVATE
 
sql™e3VdbeMemNum”ify
(
Mem
 *
pMem
){

62220 ifÐ(
	gpMem
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
|
	gMEM_NuÎ
))==0 ){

62221 
as£¹
Ð(
pMem
->
æags
 & (
MEM_Blob
|
MEM_SŒ
))!=0 );

62222 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62223 ifÐ0==
sql™e3Atoi64
(
pMem
->
z
, &pMem->
u
.
i
,…Mem->
n
,…Mem->
’c
) ){

62224 
MemS‘Ty³FÏg
(
pMem
, 
MEM_IÁ
);

62226 
	gpMem
->
	gu
.
	gr
 = 
sql™e3VdbeR—lV®ue
(
pMem
);

62227 
MemS‘Ty³FÏg
(
pMem
, 
MEM_R—l
);

62228 
sql™e3VdbeIÁeg”Affš™y
(
pMem
);

62231 
as£¹
Ð(
pMem
->
æags
 & (
MEM_IÁ
|
MEM_R—l
|
MEM_NuÎ
))!=0 );

62232 
	gpMem
->
	gæags
 &ð~(
MEM_SŒ
|
MEM_Blob
);

62233  
	gSQLITE_OK
;

62243 
SQLITE_PRIVATE
 
sql™e3VdbeMemCa¡
(
Mem
 *
pMem
, 
u8
 
aff
, u8 
’codšg
){

62244 ifÐ
	gpMem
->
	gæags
 & 
	gMEM_NuÎ
 ) ;

62245  
	gaff
 ){

62246 
	gSQLITE_AFF_NONE
: {

62247 ifÐ(
pMem
->
æags
 & 
MEM_Blob
)==0 ){

62248 
sql™e3V®ueAµlyAffš™y
(
pMem
, 
SQLITE_AFF_TEXT
, 
’codšg
);

62249 
as£¹
Ð
pMem
->
æags
 & 
MEM_SŒ
 ||…Mem->
db
->
m®locFažed
 );

62250 
MemS‘Ty³FÏg
(
pMem
, 
MEM_Blob
);

62252 
	gpMem
->
	gæags
 &ð~(
MEM_Ty³Mask
&~
MEM_Blob
);

62256 
	gSQLITE_AFF_NUMERIC
: {

62257 
sql™e3VdbeMemNum”ify
(
pMem
);

62260 
	gSQLITE_AFF_INTEGER
: {

62261 
sql™e3VdbeMemIÁeg”ify
(
pMem
);

62264 
	gSQLITE_AFF_REAL
: {

62265 
sql™e3VdbeMemR—lify
(
pMem
);

62269 
as£¹
Ð
aff
==
SQLITE_AFF_TEXT
 );

62270 
as£¹
Ð
MEM_SŒ
==(
MEM_Blob
>>3) );

62271 
	gpMem
->
	gæags
 |ð(
pMem
->
æags
&
MEM_Blob
)>>3;

62272 
sql™e3V®ueAµlyAffš™y
(
pMem
, 
SQLITE_AFF_TEXT
, 
’codšg
);

62273 
as£¹
Ð
pMem
->
æags
 & 
MEM_SŒ
 ||…Mem->
db
->
m®locFažed
 );

62274 
	gpMem
->
	gæags
 &ð~(
MEM_IÁ
|
MEM_R—l
|
MEM_Blob
|
MEM_Z”o
);

62285 
SQLITE_PRIVATE
 
sql™e3VdbeMemIn™
(
Mem
 *
pMem
, 
sql™e3
 *
db
, 
u16
 
æags
){

62286 
as£¹
Ð(
æags
 & ~
MEM_Ty³Mask
)==0 );

62287 
	gpMem
->
	gæags
 = 
æags
;

62288 
	gpMem
->
	gdb
 = 
db
;

62289 
	gpMem
->
	gszM®loc
 = 0;

62305 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘NuÎ
(
Mem
 *
pMem
){

62306 ifÐ
VdbeMemDyÇmic
(
pMem
) ){

62307 
vdbeMemCË¬Ex‹ºAndS‘NuÎ
(
pMem
);

62309 
	gpMem
->
	gæags
 = 
MEM_NuÎ
;

62312 
SQLITE_PRIVATE
 
sql™e3V®ueS‘NuÎ
(
sql™e3_v®ue
 *
p
){

62313 
sql™e3VdbeMemS‘NuÎ
((
Mem
*)
p
);

62320 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘Z”oBlob
(
Mem
 *
pMem
, 
n
){

62321 
sql™e3VdbeMemR–—£
(
pMem
);

62322 
	gpMem
->
	gæags
 = 
MEM_Blob
|
MEM_Z”o
;

62323 
	gpMem
->
	gn
 = 0;

62324 ifÐ
	gn
<0 )‚ = 0;

62325 
	gpMem
->
	gu
.
	gnZ”o
 = 
n
;

62326 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

62327 
	gpMem
->
	gz
 = 0;

62335 
SQLITE_NOINLINE
 
vdbeR–—£AndS‘IÁ64
(
Mem
 *
pMem
, 
i64
 
v®
){

62336 
sql™e3VdbeMemS‘NuÎ
(
pMem
);

62337 
	gpMem
->
	gu
.
	gi
 = 
v®
;

62338 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

62345 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘IÁ64
(
Mem
 *
pMem
, 
i64
 
v®
){

62346 ifÐ
VdbeMemDyÇmic
(
pMem
) ){

62347 
vdbeR–—£AndS‘IÁ64
(
pMem
, 
v®
);

62349 
	gpMem
->
	gu
.
	gi
 = 
v®
;

62350 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

62354 #iâdeà
SQLITE_OMIT_FLOATING_POINT


62359 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘DoubË
(
Mem
 *
pMem
, 
v®
){

62360 
sql™e3VdbeMemS‘NuÎ
(
pMem
);

62361 ifÐ!
sql™e3IsNaN
(
v®
) ){

62362 
	gpMem
->
	gu
.
	gr
 = 
v®
;

62363 
	gpMem
->
	gæags
 = 
MEM_R—l
;

62372 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘RowS‘
(
Mem
 *
pMem
){

62373 
sql™e3
 *
	gdb
 = 
pMem
->
db
;

62374 
as£¹
Ð
db
!=0 );

62375 
as£¹
Ð(
pMem
->
æags
 & 
MEM_RowS‘
)==0 );

62376 
sql™e3VdbeMemR–—£
(
pMem
);

62377 
	gpMem
->
	gzM®loc
 = 
sql™e3DbM®locRaw
(
db
, 64);

62378 ifÐ
	gdb
->
	gm®locFažed
 ){

62379 
	gpMem
->
	gæags
 = 
MEM_NuÎ
;

62380 
	gpMem
->
	gszM®loc
 = 0;

62382 
as£¹
Ð
pMem
->
zM®loc
 );

62383 
	gpMem
->
	gszM®loc
 = 
sql™e3DbM®locSize
(
db
, 
pMem
->
zM®loc
);

62384 
	gpMem
->
	gu
.
	gpRowS‘
 = 
sql™e3RowS‘In™
(
db
, 
pMem
->
zM®loc
,…Mem->
szM®loc
);

62385 
as£¹
Ð
pMem
->
u
.
pRowS‘
!=0 );

62386 
	gpMem
->
	gæags
 = 
MEM_RowS‘
;

62394 
SQLITE_PRIVATE
 
sql™e3VdbeMemTooBig
(
Mem
 *
p
){

62395 
as£¹
Ð
p
->
db
!=0 );

62396 ifÐ
	gp
->
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
) ){

62397 
	gn
 = 
p
->
n
;

62398 ifÐ
	gp
->
	gæags
 & 
	gMEM_Z”o
 ){

62399 
	gn
 +ð
p
->
u
.
nZ”o
;

62401  
	gn
>
	gp
->
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
];

62406 #ifdeà
SQLITE_DEBUG


62415 
SQLITE_PRIVATE
 
sql™e3VdbeMemAboutToChªge
(
Vdbe
 *
pVdbe
, 
Mem
 *
pMem
){

62416 
	gi
;

62417 
Mem
 *
	gpX
;

62418 
	gi
=1, 
	gpX
=&
pVdbe
->
aMem
[1]; i<õVdbe->
nMem
; i++,…X++){

62419 ifÐ
	gpX
->
	gpScÝyFrom
==
pMem
 ){

62420 
pX
->
æags
 |ð
MEM_Undefšed
;

62421 
	gpX
->
	gpScÝyFrom
 = 0;

62424 
	gpMem
->
	gpScÝyFrom
 = 0;

62431 
	#MEMCELLSIZE
 
	`off£tof
(
Mem
,
zM®loc
)

	)

62439 
SQLITE_PRIVATE
 
sql™e3VdbeMemSh®lowCÝy
(
Mem
 *
pTo
, cÚ¡ Mem *
pFrom
, 
¤cTy³
){

62440 
as£¹
Ð(
pFrom
->
æags
 & 
MEM_RowS‘
)==0 );

62441 
as£¹
Ð
pTo
->
db
==
pFrom
->db );

62442 ifÐ
VdbeMemDyÇmic
(
pTo
èè
vdbeMemCË¬Ex‹ºAndS‘NuÎ
(pTo);

62443 
memýy
(
pTo
, 
pFrom
, 
MEMCELLSIZE
);

62444 ifÐ(
	gpFrom
->
	gæags
&
	gMEM_Stic
)==0 ){

62445 
pTo
->
æags
 &ð~(
MEM_Dyn
|
MEM_Stic
|
MEM_Ephem
);

62446 
as£¹
Ð
¤cTy³
==
MEM_Ephem
 || srcTy³==
MEM_Stic
 );

62447 
	gpTo
->
	gæags
 |ð
¤cTy³
;

62455 
SQLITE_PRIVATE
 
sql™e3VdbeMemCÝy
(
Mem
 *
pTo
, cÚ¡ Mem *
pFrom
){

62456 
	grc
 = 
SQLITE_OK
;

62458 
as£¹
Ð
pTo
->
db
==
pFrom
->db );

62459 
as£¹
Ð(
pFrom
->
æags
 & 
MEM_RowS‘
)==0 );

62460 ifÐ
VdbeMemDyÇmic
(
pTo
èè
vdbeMemCË¬Ex‹ºAndS‘NuÎ
(pTo);

62461 
memýy
(
pTo
, 
pFrom
, 
MEMCELLSIZE
);

62462 
	gpTo
->
	gæags
 &ð~
MEM_Dyn
;

62463 ifÐ
	gpTo
->
	gæags
&(
	gMEM_SŒ
|
	gMEM_Blob
) ){

62464 ifÐ0==(
pFrom
->
æags
&
MEM_Stic
) ){

62465 
pTo
->
æags
 |ð
MEM_Ephem
;

62466 
	grc
 = 
sql™e3VdbeMemMakeWr™—bË
(
pTo
);

62470  
	grc
;

62479 
SQLITE_PRIVATE
 
sql™e3VdbeMemMove
(
Mem
 *
pTo
, Mem *
pFrom
){

62480 
as£¹
Ð
pFrom
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕFrom->db->
mu‹x
) );

62481 
as£¹
Ð
pTo
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕTo->db->
mu‹x
) );

62482 
as£¹
Ð
pFrom
->
db
==0 || 
pTo
->db==0 ||…From->db==pTo->db );

62484 
sql™e3VdbeMemR–—£
(
pTo
);

62485 
memýy
(
pTo
, 
pFrom
, (
Mem
));

62486 
	gpFrom
->
	gæags
 = 
MEM_NuÎ
;

62487 
	gpFrom
->
	gszM®loc
 = 0;

62505 
SQLITE_PRIVATE
 
sql™e3VdbeMemS‘SŒ
(

62506 
Mem
 *
pMem
,

62507 cÚ¡ *
z
,

62508 
n
,

62509 
u8
 
’c
,

62510 (*
xD–
)(*)

62512 
	gnBy‹
 = 
n
;

62513 
	giLim™
;

62514 
u16
 
	gæags
 = 0;

62516 
as£¹
Ð
pMem
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕMem->db->
mu‹x
) );

62517 
as£¹
Ð(
pMem
->
æags
 & 
MEM_RowS‘
)==0 );

62520 ifÐ!
	gz
 ){

62521 
sql™e3VdbeMemS‘NuÎ
(
pMem
);

62522  
	gSQLITE_OK
;

62525 ifÐ
	gpMem
->
	gdb
 ){

62526 
	giLim™
 = 
pMem
->
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
];

62528 
	giLim™
 = 
SQLITE_MAX_LENGTH
;

62530 
	gæags
 = (
’c
==0?
MEM_Blob
:
MEM_SŒ
);

62531 ifÐ
	gnBy‹
<0 ){

62532 
as£¹
Ð
’c
!=0 );

62533 ifÐ
	g’c
==
SQLITE_UTF8
 ){

62534 
nBy‹
 = 
sql™e3SŒËn30
(
z
);

62535 ifÐ
	gnBy‹
>
	giLim™
 )‚By‹ = 
iLim™
+1;

62537 
	gnBy‹
=0;‚By‹<=
iLim™
 && (
z
[
nBy‹
] | z[nByte+1]);‚Byte+=2){}

62539 
	gæags
 |ð
MEM_T”m
;

62546 ifÐ
	gxD–
==
SQLITE_TRANSIENT
 ){

62547 
nAÎoc
 = 
nBy‹
;

62548 ifÐ
	gæags
&
	gMEM_T”m
 ){

62549 
	gnAÎoc
 +ð(
’c
==
SQLITE_UTF8
?1:2);

62551 ifÐ
	gnBy‹
>
	giLim™
 ){

62552  
	gSQLITE_TOOBIG
;

62554 
‹¡ÿ£
Ð
nAÎoc
==0 );

62555 
‹¡ÿ£
Ð
nAÎoc
==31 );

62556 
‹¡ÿ£
Ð
nAÎoc
==32 );

62557 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pMem
, 
MAX
(
nAÎoc
,32)) ){

62558  
	gSQLITE_NOMEM
;

62560 
memýy
(
pMem
->
z
, z, 
nAÎoc
);

62561 }ifÐ
	gxD–
==
SQLITE_DYNAMIC
 ){

62562 
sql™e3VdbeMemR–—£
(
pMem
);

62563 
	gpMem
->
	gzM®loc
 = 
pMem
->
z
 = (*)z;

62564 
	gpMem
->
	gszM®loc
 = 
sql™e3DbM®locSize
(
pMem
->
db
,…Mem->
zM®loc
);

62566 
sql™e3VdbeMemR–—£
(
pMem
);

62567 
	gpMem
->
	gz
 = (*)
z
;

62568 
	gpMem
->
	gxD–
 = 
xD–
;

62569 
	gæags
 |ð((
xD–
==
SQLITE_STATIC
)?
MEM_Stic
:
MEM_Dyn
);

62572 
	gpMem
->
	gn
 = 
nBy‹
;

62573 
	gpMem
->
	gæags
 = 
æags
;

62574 
	gpMem
->
	g’c
 = (
’c
==0 ? 
SQLITE_UTF8
 :ƒnc);

62576 #iâdeà
SQLITE_OMIT_UTF16


62577 ifÐ
	gpMem
->
	g’c
!=
SQLITE_UTF8
 && 
sql™e3VdbeMemHªdËBom
(
pMem
) ){

62578  
SQLITE_NOMEM
;

62582 ifÐ
	gnBy‹
>
	giLim™
 ){

62583  
	gSQLITE_TOOBIG
;

62586  
	gSQLITE_OK
;

62605 
SQLITE_PRIVATE
 
sql™e3VdbeMemFromBŒ“
(

62606 
BtCursÜ
 *
pCur
,

62607 
u32
 
off£t
,

62608 
u32
 
amt
,

62609 
key
,

62610 
Mem
 *
pMem


62612 *
	gzD©a
;

62613 
u32
 
	gavažabË
 = 0;

62614 
	grc
 = 
SQLITE_OK
;

62616 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCur
) );

62617 
as£¹
Ð!
VdbeMemDyÇmic
(
pMem
) );

62621 
as£¹
Ð(
pMem
->
æags
 & 
MEM_RowS‘
)==0 );

62622 ifÐ
	gkey
 ){

62623 
	gzD©a
 = (*)
sql™e3BŒ“KeyF‘ch
(
pCur
, &
avažabË
);

62625 
	gzD©a
 = (*)
sql™e3BŒ“D©aF‘ch
(
pCur
, &
avažabË
);

62627 
as£¹
Ð
zD©a
!=0 );

62629 ifÐ
	goff£t
+
	gamt
<=
avažabË
 ){

62630 
pMem
->
z
 = &
zD©a
[
off£t
];

62631 
	gpMem
->
	gæags
 = 
MEM_Blob
|
MEM_Ephem
;

62632 
	gpMem
->
	gn
 = ()
amt
;

62634 
	gpMem
->
	gæags
 = 
MEM_NuÎ
;

62635 ifÐ
	gSQLITE_OK
==(
rc
 = 
sql™e3VdbeMemCË¬AndResize
(
pMem
, 
amt
+2)) ){

62636 ifÐ
	gkey
 ){

62637 
	grc
 = 
sql™e3BŒ“Key
(
pCur
, 
off£t
, 
amt
, 
pMem
->
z
);

62639 
	grc
 = 
sql™e3BŒ“D©a
(
pCur
, 
off£t
, 
amt
, 
pMem
->
z
);

62641 ifÐ
	grc
==
SQLITE_OK
 ){

62642 
pMem
->
z
[
amt
] = 0;

62643 
	gpMem
->
	gz
[
amt
+1] = 0;

62644 
	gpMem
->
	gæags
 = 
MEM_Blob
|
MEM_T”m
;

62645 
	gpMem
->
	gn
 = ()
amt
;

62647 
sql™e3VdbeMemR–—£
(
pMem
);

62652  
	grc
;

62660 
SQLITE_NOINLINE
 cÚ¡ *
v®ueToText
(
sql™e3_v®ue
* 
pV®
, 
u8
 
’c
){

62661 
as£¹
Ð
pV®
!=0 );

62662 
as£¹
Ð
pV®
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕV®->db->
mu‹x
) );

62663 
as£¹
Ð(
’c
&3)==Ónc&~
SQLITE_UTF16_ALIGNED
) );

62664 
as£¹
Ð(
pV®
->
æags
 & 
MEM_RowS‘
)==0 );

62665 
as£¹
Ð(
pV®
->
æags
 & (
MEM_NuÎ
))==0 );

62666 ifÐ
	gpV®
->
	gæags
 & (
	gMEM_Blob
|
	gMEM_SŒ
) ){

62667 
	gpV®
->
	gæags
 |ð
MEM_SŒ
;

62668 ifÐ
	gpV®
->
	gæags
 & 
	gMEM_Z”o
 ){

62669 
sql™e3VdbeMemEx·ndBlob
(
pV®
);

62671 ifÐ
	gpV®
->
	g’c
 !ð(
’c
 & ~
SQLITE_UTF16_ALIGNED
) ){

62672 
sql™e3VdbeChªgeEncodšg
(
pV®
, 
’c
 & ~
SQLITE_UTF16_ALIGNED
);

62674 ifÐ(
	g’c
 & 
	gSQLITE_UTF16_ALIGNED
)!=0 && 1==(1&
SQLITE_PTR_TO_INT
(
pV®
->
z
)) ){

62675 
as£¹
Ð(
pV®
->
æags
 & (
MEM_Ephem
|
MEM_Stic
))!=0 );

62676 ifÐ
sql™e3VdbeMemMakeWr™—bË
(
pV®
)!=
SQLITE_OK
 ){

62680 
sql™e3VdbeMemNulT”mš©e
(
pV®
);

62682 
sql™e3VdbeMemSŒšgify
(
pV®
, 
’c
, 0);

62683 
as£¹
Ð0==(1&
SQLITE_PTR_TO_INT
(
pV®
->
z
)) );

62685 
as£¹
(
pV®
->
’c
==Ónø& ~
SQLITE_UTF16_ALIGNED
è||…V®->
db
==0

62686 || 
pV®
->
db
->
m®locFažed
 );

62687 ifÐ
	gpV®
->
	g’c
==(
’c
 & ~
SQLITE_UTF16_ALIGNED
) ){

62688  
pV®
->
z
;

62704 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3V®ueText
(
sql™e3_v®ue
* 
pV®
, 
u8
 
’c
){

62705 ifÐ!
	gpV®
 )  0;

62706 
as£¹
Ð
pV®
->
db
==0 || 
sql™e3_mu‹x_h–d
ÕV®->db->
mu‹x
) );

62707 
as£¹
Ð(
’c
&3)==Ónc&~
SQLITE_UTF16_ALIGNED
) );

62708 
as£¹
Ð(
pV®
->
æags
 & 
MEM_RowS‘
)==0 );

62709 ifÐ(
	gpV®
->
	gæags
&(
	gMEM_SŒ
|
	gMEM_T”m
))==(
MEM_SŒ
|
MEM_T”m
è&& 
pV®
->
’c
==enc ){

62710  
pV®
->
z
;

62712 ifÐ
	gpV®
->
	gæags
&
	gMEM_NuÎ
 ){

62715  
v®ueToText
(
pV®
, 
’c
);

62721 
SQLITE_PRIVATE
 
sql™e3_v®ue
 *
sql™e3V®ueNew
(
sql™e3
 *
db
){

62722 
Mem
 *
	gp
 = 
sql™e3DbM®locZ”o
(
db
, (*
p
));

62723 ifÐ
	gp
 ){

62724 
	gp
->
	gæags
 = 
MEM_NuÎ
;

62725 
	gp
->
	gdb
 = 
db
;

62727  
	gp
;

62734 
	sV®ueNewSt4Ctx
 {

62735 
P¬£
 *
	gpP¬£
;

62736 
Index
 *
	gpIdx
;

62737 
UÅackedRecÜd
 **
	gµRec
;

62738 
	giV®
;

62752 
sql™e3_v®ue
 *
v®ueNew
(
sql™e3
 *
db
, 
V®ueNewSt4Ctx
 *
p
){

62753 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


62754 ifÐ
	gp
 ){

62755 
UÅackedRecÜd
 *
	gpRec
 = 
p
->
µRec
[0];

62757 ifÐ
	gpRec
==0 ){

62758 
Index
 *
pIdx
 = 
p
->pIdx;

62759 
	gnBy‹
;

62760 
	gi
;

62761 
	gnCÞ
 = 
pIdx
->
nCÞumn
;

62763 
	gnBy‹
 = (
Mem
è* 
nCÞ
 + 
ROUND8
((
UÅackedRecÜd
));

62764 
	gpRec
 = (
UÅackedRecÜd
*)
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

62765 ifÐ
	gpRec
 ){

62766 
	gpRec
->
	gpKeyInfo
 = 
sql™e3KeyInfoOfIndex
(
p
->
pP¬£
, 
pIdx
);

62767 ifÐ
	gpRec
->
	gpKeyInfo
 ){

62768 
as£¹
Ð
pRec
->
pKeyInfo
->
nF›ld
+pRec->pKeyInfo->
nXF›ld
==
nCÞ
 );

62769 
as£¹
Ð
pRec
->
pKeyInfo
->
’c
==
ENC
(
db
) );

62770 
	gpRec
->
	gaMem
 = (
Mem
 *)((
u8
*)
pRec
 + 
ROUND8
((
UÅackedRecÜd
)));

62771 
	gi
=0; i<
	gnCÞ
; i++){

62772 
	gpRec
->
	gaMem
[
i
].
	gæags
 = 
MEM_NuÎ
;

62773 
	gpRec
->
	gaMem
[
i
].
	gdb
 = 
db
;

62776 
sql™e3DbF»e
(
db
, 
pRec
);

62777 
	gpRec
 = 0;

62780 ifÐ
	gpRec
==0 )  0;

62781 
	gp
->
	gµRec
[0] = 
pRec
;

62784 
	gpRec
->
	gnF›ld
 = 
p
->
iV®
+1;

62785  &
	gpRec
->
	gaMem
[
p
->
iV®
];

62788 
UNUSED_PARAMETER
(
p
);

62790  
sql™e3V®ueNew
(
db
);

62803 
v®ueFromEx´
(

62804 
sql™e3
 *
db
,

62805 
Ex´
 *
pEx´
,

62806 
u8
 
’c
,

62807 
u8
 
affš™y
,

62808 
sql™e3_v®ue
 **
µV®
,

62809 
V®ueNewSt4Ctx
 *
pCtx


62811 
	gÝ
;

62812 *
	gzV®
 = 0;

62813 
sql™e3_v®ue
 *
	gpV®
 = 0;

62814 
	gÃgIÁ
 = 1;

62815 cÚ¡ *
	gzNeg
 = "";

62816 
	grc
 = 
SQLITE_OK
;

62818 ifÐ!
	gpEx´
 ){

62819 *
	gµV®
 = 0;

62820  
	gSQLITE_OK
;

62822  (
	gÝ
 = 
pEx´
->
Ý
)==
TK_UPLUS
 )…Ex´ =…Ex´->
pLeá
;

62823 ifÐ
NEVER
(
Ý
==
TK_REGISTER
èèÝ = 
pEx´
->
Ý2
;

62825 ifÐ
	gÝ
==
TK_CAST
 ){

62826 
u8
 
aff
 = 
sql™e3Affš™yTy³
(
pEx´
->
u
.
zTok’
,0);

62827 
	grc
 = 
v®ueFromEx´
(
db
, 
pEx´
->
pLeá
, 
’c
, 
aff
, 
µV®
, 
pCtx
);

62828 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

62829 ifÐ*
	gµV®
 ){

62830 
sql™e3VdbeMemCa¡
(*
µV®
, 
aff
, 
SQLITE_UTF8
);

62831 
sql™e3V®ueAµlyAffš™y
(*
µV®
, 
affš™y
, 
SQLITE_UTF8
);

62833  
	grc
;

62839 ifÐ
	gÝ
==
TK_UMINUS


62840 && (
pEx´
->
pLeá
->
Ý
==
TK_INTEGER
 ||…Ex´->pLeá->Ý==
TK_FLOAT
) ){

62841 
pEx´
 =…Ex´->
pLeá
;

62842 
	gÝ
 = 
pEx´
->
Ý
;

62843 
	gÃgIÁ
 = -1;

62844 
	gzNeg
 = "-";

62847 ifÐ
	gÝ
==
TK_STRING
 || 
Ý
==
TK_FLOAT
 || op==
TK_INTEGER
 ){

62848 
pV®
 = 
v®ueNew
(
db
, 
pCtx
);

62849 ifÐ
	gpV®
==0 ) 
no_mem
;

62850 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) ){

62851 
sql™e3VdbeMemS‘IÁ64
(
pV®
, (
i64
)
pEx´
->
u
.
iV®ue
*
ÃgIÁ
);

62853 
	gzV®
 = 
sql™e3MPrštf
(
db
, "%s%s", 
zNeg
, 
pEx´
->
u
.
zTok’
);

62854 ifÐ
	gzV®
==0 ) 
no_mem
;

62855 
sql™e3V®ueS‘SŒ
(
pV®
, -1, 
zV®
, 
SQLITE_UTF8
, 
SQLITE_DYNAMIC
);

62857 ifÐ(
	gÝ
==
TK_INTEGER
 || 
Ý
==
TK_FLOAT
 ) && 
affš™y
==
SQLITE_AFF_NONE
 ){

62858 
sql™e3V®ueAµlyAffš™y
(
pV®
, 
SQLITE_AFF_NUMERIC
, 
SQLITE_UTF8
);

62860 
sql™e3V®ueAµlyAffš™y
(
pV®
, 
affš™y
, 
SQLITE_UTF8
);

62862 ifÐ
	gpV®
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
èèpV®->æag &ð~
MEM_SŒ
;

62863 ifÐ
	g’c
!=
SQLITE_UTF8
 ){

62864 
rc
 = 
sql™e3VdbeChªgeEncodšg
(
pV®
, 
’c
);

62866 }ifÐ
	gÝ
==
TK_UMINUS
 ) {

62868 ifÐ
SQLITE_OK
==
sql™e3V®ueFromEx´
(
db
,
pEx´
->
pLeá
,
’c
,
affš™y
,&
pV®
)

62869 && 
	gpV®
!=0

62871 
sql™e3VdbeMemNum”ify
(
pV®
);

62872 ifÐ
	gpV®
->
	gæags
 & 
	gMEM_R—l
 ){

62873 
	gpV®
->
	gu
.
	gr
 = -
pV®
->
u
.
r
;

62874 }ifÐ
	gpV®
->
	gu
.
	gi
==
SMALLEST_INT64
 ){

62875 
pV®
->
u
.
r
 = -()
SMALLEST_INT64
;

62876 
MemS‘Ty³FÏg
(
pV®
, 
MEM_R—l
);

62878 
	gpV®
->
	gu
.
	gi
 = -
pV®
->
u
.
i
;

62880 
sql™e3V®ueAµlyAffš™y
(
pV®
, 
affš™y
, 
’c
);

62882 }ifÐ
	gÝ
==
TK_NULL
 ){

62883 
pV®
 = 
v®ueNew
(
db
, 
pCtx
);

62884 ifÐ
	gpV®
==0 ) 
no_mem
;

62886 #iâdeà
SQLITE_OMIT_BLOB_LITERAL


62887 ifÐ
	gÝ
==
TK_BLOB
 ){

62888 
nV®
;

62889 
as£¹
Ð
pEx´
->
u
.
zTok’
[0]=='x' ||…Expr->u.zToken[0]=='X' );

62890 
as£¹
Ð
pEx´
->
u
.
zTok’
[1]=='\'' );

62891 
	gpV®
 = 
v®ueNew
(
db
, 
pCtx
);

62892 ifÐ!
	gpV®
 ) 
	gno_mem
;

62893 
	gzV®
 = &
pEx´
->
u
.
zTok’
[2];

62894 
	gnV®
 = 
sql™e3SŒËn30
(
zV®
)-1;

62895 
as£¹
Ð
zV®
[
nV®
]=='\'' );

62896 
sql™e3VdbeMemS‘SŒ
(
pV®
, 
sql™e3HexToBlob
(
db
, 
zV®
, 
nV®
),‚Val/2,

62897 0, 
SQLITE_DYNAMIC
);

62901 *
	gµV®
 = 
pV®
;

62902  
	grc
;

62904 
	gno_mem
:

62905 
db
->
m®locFažed
 = 1;

62906 
sql™e3DbF»e
(
db
, 
zV®
);

62907 
as£¹
Ð*
µV®
==0 );

62908 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


62909 ifÐ
	gpCtx
==0 ) 
sql™e3V®ueF»e
(
pV®
);

62911 
as£¹
Ð
pCtx
==0 ); 
sql™e3V®ueF»e
(
pV®
);

62913  
	gSQLITE_NOMEM
;

62926 
SQLITE_PRIVATE
 
sql™e3V®ueFromEx´
(

62927 
sql™e3
 *
db
,

62928 
Ex´
 *
pEx´
,

62929 
u8
 
’c
,

62930 
u8
 
affš™y
,

62931 
sql™e3_v®ue
 **
µV®


62933  
v®ueFromEx´
(
db
, 
pEx´
, 
’c
, 
affš™y
, 
µV®
, 0);

62936 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


62945 
»cÜdFunc
(

62946 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

62947 
¬gc
,

62948 
sql™e3_v®ue
 **
¬gv


62950 cÚ¡ 
	gfže_fÜm©
 = 1;

62951 
	giS”Ÿl
;

62952 
	gnS”Ÿl
;

62953 
	gnV®
;

62954 
	gnR‘
;

62955 
sql™e3
 *
	gdb
;

62956 
u8
 *
	gaR‘
;

62958 
UNUSED_PARAMETER
Ð
¬gc
 );

62959 
	giS”Ÿl
 = 
sql™e3VdbeS”ŸlTy³
(
¬gv
[0], 
fže_fÜm©
);

62960 
	gnS”Ÿl
 = 
sql™e3V¬štL’
(
iS”Ÿl
);

62961 
	gnV®
 = 
sql™e3VdbeS”ŸlTy³L’
(
iS”Ÿl
);

62962 
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

62964 
	gnR‘
 = 1 + 
nS”Ÿl
 + 
nV®
;

62965 
	gaR‘
 = 
sql™e3DbM®locRaw
(
db
, 
nR‘
);

62966 ifÐ
	gaR‘
==0 ){

62967 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

62969 
	gaR‘
[0] = 
nS”Ÿl
+1;

62970 
putV¬št32
(&
aR‘
[1], 
iS”Ÿl
);

62971 
sql™e3VdbeS”ŸlPut
(&
aR‘
[1+
nS”Ÿl
], 
¬gv
[0], 
iS”Ÿl
);

62972 
sql™e3_»suÉ_blob
(
cÚ‹xt
, 
aR‘
, 
nR‘
, 
SQLITE_TRANSIENT
);

62973 
sql™e3DbF»e
(
db
, 
aR‘
);

62980 
SQLITE_PRIVATE
 
sql™e3AÇlyzeFunùiÚs
(){

62981 
SQLITE_WSD
 
FuncDef
 
	gaAÇlyzeTabËFuncs
[] = {

62982 
FUNCTION
(
sql™e_»cÜd
, 1, 0, 0, 
»cÜdFunc
),

62984 
	gi
;

62985 
FuncDefHash
 *
	gpHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

62986 
FuncDef
 *
	gaFunc
 = (FuncDef*)&
GLOBAL
(FuncDef, 
aAÇlyzeTabËFuncs
);

62987 
	gi
=0; i<
A¼aySize
(
aAÇlyzeTabËFuncs
); i++){

62988 
sql™e3FuncDefIn£¹
(
pHash
, &
aFunc
[
i
]);

63010 
¡©4V®ueFromEx´
(

63011 
P¬£
 *
pP¬£
,

63012 
Ex´
 *
pEx´
,

63013 
u8
 
affš™y
,

63014 
V®ueNewSt4Ctx
 *
pAÎoc
,

63015 
sql™e3_v®ue
 **
µV®


63017 
	grc
 = 
SQLITE_OK
;

63018 
sql™e3_v®ue
 *
	gpV®
 = 0;

63019 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

63022 
	gpEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pEx´
);

63024 ifÐ!
	gpEx´
 ){

63025 
	gpV®
 = 
v®ueNew
(
db
, 
pAÎoc
);

63026 ifÐ
	gpV®
 ){

63027 
sql™e3VdbeMemS‘NuÎ
((
Mem
*)
pV®
);

63029 }ifÐ
	gpEx´
->
	gÝ
==
TK_VARIABLE


63030 || 
NEVER
(
pEx´
->
Ý
==
TK_REGISTER
 &&…Ex´->
Ý2
==
TK_VARIABLE
)

63032 
Vdbe
 *
v
;

63033 
	giBšdV¬
 = 
pEx´
->
iCÞumn
;

63034 
sql™e3VdbeS‘V¬mask
(
pP¬£
->
pVdbe
, 
iBšdV¬
);

63035 ifÐ(
	gv
 = 
pP¬£
->
pR•»·»
)!=0 ){

63036 
pV®
 = 
v®ueNew
(
db
, 
pAÎoc
);

63037 ifÐ
	gpV®
 ){

63038 
	grc
 = 
sql™e3VdbeMemCÝy
((
Mem
*)
pV®
, &
v
->
aV¬
[
iBšdV¬
-1]);

63039 ifÐ
	grc
==
SQLITE_OK
 ){

63040 
sql™e3V®ueAµlyAffš™y
(
pV®
, 
affš™y
, 
ENC
(
db
));

63042 
	gpV®
->
	gdb
 = 
pP¬£
->
db
;

63046 
	grc
 = 
v®ueFromEx´
(
db
, 
pEx´
, 
ENC
(db), 
affš™y
, &
pV®
, 
pAÎoc
);

63049 
as£¹
Ð
pV®
==0 ||…V®->
db
==db );

63050 *
	gµV®
 = 
pV®
;

63051  
	grc
;

63084 
SQLITE_PRIVATE
 
sql™e3St4ProbeS‘V®ue
(

63085 
P¬£
 *
pP¬£
,

63086 
Index
 *
pIdx
,

63087 
UÅackedRecÜd
 **
µRec
,

63088 
Ex´
 *
pEx´
,

63089 
u8
 
affš™y
,

63090 
iV®
,

63091 *
pbOk


63093 
	grc
;

63094 
sql™e3_v®ue
 *
	gpV®
 = 0;

63095 
V®ueNewSt4Ctx
 
	g®loc
;

63097 
	g®loc
.
	gpP¬£
 = 
pP¬£
;

63098 
	g®loc
.
	gpIdx
 = 
pIdx
;

63099 
	g®loc
.
	gµRec
 = 
µRec
;

63100 
	g®loc
.
	giV®
 = 
iV®
;

63102 
	grc
 = 
¡©4V®ueFromEx´
(
pP¬£
, 
pEx´
, 
affš™y
, &
®loc
, &
pV®
);

63103 
as£¹
Ð
pV®
==0 ||…V®->
db
==
pP¬£
->db );

63104 *
	gpbOk
 = (
pV®
!=0);

63105  
	grc
;

63118 
SQLITE_PRIVATE
 
sql™e3St4V®ueFromEx´
(

63119 
P¬£
 *
pP¬£
,

63120 
Ex´
 *
pEx´
,

63121 
u8
 
affš™y
,

63122 
sql™e3_v®ue
 **
µV®


63124  
¡©4V®ueFromEx´
(
pP¬£
, 
pEx´
, 
affš™y
, 0, 
µV®
);

63135 
SQLITE_PRIVATE
 
sql™e3St4CÞumn
(

63136 
sql™e3
 *
db
,

63137 cÚ¡ *
pRec
,

63138 
nRec
,

63139 
iCÞ
,

63140 
sql™e3_v®ue
 **
µV®


63142 
u32
 
	gt
;

63143 
	gnHdr
;

63144 
	giHdr
;

63145 
	giF›ld
;

63146 
	gszF›ld
;

63147 
	gi
;

63148 
u8
 *
	ga
 = (u8*)
pRec
;

63149 
Mem
 *
	gpMem
 = *
µV®
;

63151 
as£¹
Ð
iCÞ
>0 );

63152 
	giHdr
 = 
g‘V¬št32
(
a
, 
nHdr
);

63153 ifÐ
	gnHdr
>
	gnRec
 || 
	giHdr
>=
nHdr
 )  
SQLITE_CORRUPT_BKPT
;

63154 
	giF›ld
 = 
nHdr
;

63155 
	gi
=0; i<=
iCÞ
; i++){

63156 
	giHdr
 +ð
g‘V¬št32
(&
a
[
iHdr
], 
t
);

63157 
‹¡ÿ£
Ð
iHdr
==
nHdr
 );

63158 
‹¡ÿ£
Ð
iHdr
==
nHdr
+1 );

63159 ifÐ
	giHdr
>
	gnHdr
 )  
	gSQLITE_CORRUPT_BKPT
;

63160 
	gszF›ld
 = 
sql™e3VdbeS”ŸlTy³L’
(
t
);

63161 
	giF›ld
 +ð
szF›ld
;

63163 
‹¡ÿ£
Ð
iF›ld
==
nRec
 );

63164 
‹¡ÿ£
Ð
iF›ld
==
nRec
+1 );

63165 ifÐ
	giF›ld
>
	gnRec
 )  
	gSQLITE_CORRUPT_BKPT
;

63166 ifÐ
	gpMem
==0 ){

63167 
pMem
 = *
µV®
 = 
sql™e3V®ueNew
(
db
);

63168 ifÐ
	gpMem
==0 )  
SQLITE_NOMEM
;

63170 
sql™e3VdbeS”ŸlG‘
(&
a
[
iF›ld
-
szF›ld
], 
t
, 
pMem
);

63171 
	gpMem
->
	g’c
 = 
ENC
(
db
);

63172  
	gSQLITE_OK
;

63180 
SQLITE_PRIVATE
 
sql™e3St4ProbeF»e
(
UÅackedRecÜd
 *
pRec
){

63181 ifÐ
	gpRec
 ){

63182 
	gi
;

63183 
	gnCÞ
 = 
pRec
->
pKeyInfo
->
nF›ld
+pRec->pKeyInfo->
nXF›ld
;

63184 
Mem
 *
	gaMem
 = 
pRec
->
aMem
;

63185 
sql™e3
 *
	gdb
 = 
aMem
[0].
db
;

63186 
	gi
=0; i<
	gnCÞ
; i++){

63187 ifÐ
	gaMem
[
i
].
	gszM®loc
 ) 
sql™e3DbF»e
(
db
, 
aMem
[i].
zM®loc
);

63189 
sql™e3KeyInfoUÄef
(
pRec
->
pKeyInfo
);

63190 
sql™e3DbF»e
(
db
, 
pRec
);

63198 
SQLITE_PRIVATE
 
sql™e3V®ueS‘SŒ
(

63199 
sql™e3_v®ue
 *
v
,

63200 
n
,

63201 cÚ¡ *
z
,

63202 
u8
 
’c
,

63203 (*
xD–
)(*)

63205 ifÐ
	gv
 ) 
sql™e3VdbeMemS‘SŒ
((
Mem
 *)
v
, 
z
, 
n
, 
’c
, 
xD–
);

63211 
SQLITE_PRIVATE
 
sql™e3V®ueF»e
(
sql™e3_v®ue
 *
v
){

63212 ifÐ!
	gv
 ) ;

63213 
sql™e3VdbeMemR–—£
((
Mem
 *)
v
);

63214 
sql™e3DbF»e
(((
Mem
*)
v
)->
db
, v);

63221 
SQLITE_PRIVATE
 
sql™e3V®ueBy‹s
(
sql™e3_v®ue
 *
pV®
, 
u8
 
’c
){

63222 
Mem
 *
	gp
 = (Mem*)
pV®
;

63223 ifÐ(
	gp
->
	gæags
 & 
	gMEM_Blob
)!=0 || 
sql™e3V®ueText
(
pV®
, 
’c
) ){

63224 ifÐ
	gp
->
	gæags
 & 
	gMEM_Z”o
 ){

63225  
	gp
->
	gn
 +…->
	gu
.
	gnZ”o
;

63227  
	gp
->
	gn
;

63253 
SQLITE_PRIVATE
 
Vdbe
 *
sql™e3VdbeC»©e
(
P¬£
 *
pP¬£
){

63254 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

63255 
Vdbe
 *
	gp
;

63256 
	gp
 = 
sql™e3DbM®locZ”o
(
db
, (
Vdbe
) );

63257 ifÐ
	gp
==0 )  0;

63258 
	gp
->
	gdb
 = 
db
;

63259 ifÐ
	gdb
->
	gpVdbe
 ){

63260 
	gdb
->
	gpVdbe
->
	gpP»v
 = 
p
;

63262 
	gp
->
	gpNext
 = 
db
->
pVdbe
;

63263 
	gp
->
	gpP»v
 = 0;

63264 
	gdb
->
	gpVdbe
 = 
p
;

63265 
	gp
->
	gmagic
 = 
VDBE_MAGIC_INIT
;

63266 
	gp
->
	gpP¬£
 = 
pP¬£
;

63267 
as£¹
Ð
pP¬£
->
aLab–
==0 );

63268 
as£¹
Ð
pP¬£
->
nLab–
==0 );

63269 
as£¹
Ð
pP¬£
->
nOpAÎoc
==0 );

63270  
	gp
;

63276 
SQLITE_PRIVATE
 
sql™e3VdbeS‘Sql
(
Vdbe
 *
p
, cÚ¡ *
z
, 
n
, 
isP»·»V2
){

63277 
as£¹
Ð
isP»·»V2
==1 || isPrepareV2==0 );

63278 ifÐ
	gp
==0 ) ;

63279 #ià
defšed
(
SQLITE_OMIT_TRACE
è&& !defšed(
SQLITE_ENABLE_SQLLOG
)

63280 ifÐ!
	gisP»·»V2
 ) ;

63282 
as£¹
Ð
p
->
zSql
==0 );

63283 
	gp
->
	gzSql
 = 
sql™e3DbSŒNDup
(
p
->
db
, 
z
, 
n
);

63284 
	gp
->
	gisP»·»V2
 = (
u8
)
isP»·»V2
;

63290 
SQLITE_API
 cÚ¡ *
sql™e3_sql
(
sql™e3_¡mt
 *
pStmt
){

63291 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

63292  (
	gp
 &&…->
	gisP»·»V2
è?…->
	gzSql
 : 0;

63298 
SQLITE_PRIVATE
 
sql™e3VdbeSw­
(
Vdbe
 *
pA
, Vdb*
pB
){

63299 
Vdbe
 
	gtmp
, *
	gpTmp
;

63300 *
	gzTmp
;

63301 
	gtmp
 = *
pA
;

63302 *
	gpA
 = *
pB
;

63303 *
	gpB
 = 
tmp
;

63304 
	gpTmp
 = 
pA
->
pNext
;

63305 
	gpA
->
	gpNext
 = 
pB
->
pNext
;

63306 
	gpB
->
	gpNext
 = 
pTmp
;

63307 
	gpTmp
 = 
pA
->
pP»v
;

63308 
	gpA
->
	gpP»v
 = 
pB
->
pP»v
;

63309 
	gpB
->
	gpP»v
 = 
pTmp
;

63310 
	gzTmp
 = 
pA
->
zSql
;

63311 
	gpA
->
	gzSql
 = 
pB
->
zSql
;

63312 
	gpB
->
	gzSql
 = 
zTmp
;

63313 
	gpB
->
	gisP»·»V2
 = 
pA
->
isP»·»V2
;

63326 
growOpA¼ay
(
Vdbe
 *
v
, 
nOp
){

63327 
VdbeOp
 *
	gpNew
;

63328 
P¬£
 *
	gp
 = 
v
->
pP¬£
;

63337 #ifdeà
SQLITE_TEST_REALLOC_STRESS


63338 
	gnNew
 = (
p
->
nOpAÎoc
>=512 ?…->nOpAÎoc*2 :…->nOpAÎoc+
nOp
);

63340 
	gnNew
 = (
p
->
nOpAÎoc
 ?…->nOpAÎoc*2 : ()(1024/(
Op
)));

63341 
UNUSED_PARAMETER
(
nOp
);

63344 
as£¹
Ð
nOp
<=(1024/(
Op
)) );

63345 
as£¹
Ð
nNew
>=(
p
->
nOpAÎoc
+
nOp
) );

63346 
	gpNew
 = 
sql™e3DbR—Îoc
(
p
->
db
, 
v
->
aOp
, 
nNew
*(
Op
));

63347 ifÐ
	gpNew
 ){

63348 
	gp
->
	gnOpAÎoc
 = 
sql™e3DbM®locSize
(
p
->
db
, 
pNew
)/(
	gOp
);

63349 
	gv
->
	gaOp
 = 
pNew
;

63351  (
	gpNew
 ? 
	gSQLITE_OK
 : 
SQLITE_NOMEM
);

63354 #ifdeà
SQLITE_DEBUG


63359 
‹¡_addÝ_b»akpošt
(){

63360 
	gn
 = 0;

63361 
	gn
++;

63381 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp3
(
Vdbe
 *
p
, 
Ý
, 
p1
, 
p2
, 
p3
){

63382 
	gi
;

63383 
VdbeOp
 *
	gpOp
;

63385 
	gi
 = 
p
->
nOp
;

63386 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

63387 
as£¹
Ð
Ý
>0 && op<0xff );

63388 ifÐ
	gp
->
	gpP¬£
->
	gnOpAÎoc
<=
i
 ){

63389 ifÐ
growOpA¼ay
(
p
, 1) ){

63393 
	gp
->
	gnOp
++;

63394 
	gpOp
 = &
p
->
aOp
[
i
];

63395 
	gpOp
->
	gÝcode
 = (
u8
)
Ý
;

63396 
	gpOp
->
	gp5
 = 0;

63397 
	gpOp
->
	gp1
 = 
p1
;

63398 
	gpOp
->
	gp2
 = 
p2
;

63399 
	gpOp
->
	gp3
 = 
p3
;

63400 
	gpOp
->
	gp4
.
	gp
 = 0;

63401 
	gpOp
->
	gp4ty³
 = 
P4_NOTUSED
;

63402 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


63403 
	gpOp
->
	gzComm’t
 = 0;

63405 #ifdeà
SQLITE_DEBUG


63406 ifÐ
	gp
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeAddÝT¿û
 ){

63407 
	gjj
, 
	gkk
;

63408 
P¬£
 *
	gpP¬£
 = 
p
->
pP¬£
;

63409 
	gjj
=
kk
=0; jj<
	gSQLITE_N_COLCACHE
; jj++){

63410 
yCÞCache
 *
	gx
 = 
pP¬£
->
aCÞCache
 + 
jj
;

63411 ifÐ
	gx
->
	giLev–
>
	gpP¬£
->
	giCacheLev–
 || x->
	giReg
==0 ) ;

63412 
´štf
("„[%d]={%d:%d}", 
x
->
iReg
, x->
iTabË
, x->
iCÞumn
);

63413 
	gkk
++;

63415 ifÐ
	gkk
 ) 
´štf
("\n");

63416 
sql™e3VdbePrštOp
(0, 
i
, &
p
->
aOp
[i]);

63417 
‹¡_addÝ_b»akpošt
();

63420 #ifdeà
VDBE_PROFILE


63421 
	gpOp
->
	gcyþes
 = 0;

63422 
	gpOp
->
	gút
 = 0;

63424 #ifdeà
SQLITE_VDBE_COVERAGE


63425 
	gpOp
->
	giSrcLše
 = 0;

63427  
	gi
;

63429 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp0
(
Vdbe
 *
p
, 
Ý
){

63430  
sql™e3VdbeAddOp3
(
p
, 
Ý
, 0, 0, 0);

63432 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp1
(
Vdbe
 *
p
, 
Ý
, 
p1
){

63433  
sql™e3VdbeAddOp3
(
p
, 
Ý
, 
p1
, 0, 0);

63435 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp2
(
Vdbe
 *
p
, 
Ý
, 
p1
, 
p2
){

63436  
sql™e3VdbeAddOp3
(
p
, 
Ý
, 
p1
, 
p2
, 0);

63443 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp4
(

63444 
Vdbe
 *
p
,

63445 
Ý
,

63446 
p1
,

63447 
p2
,

63448 
p3
,

63449 cÚ¡ *
zP4
,

63450 
p4ty³


63452 
	gaddr
 = 
sql™e3VdbeAddOp3
(
p
, 
Ý
, 
p1
, 
p2
, 
p3
);

63453 
sql™e3VdbeChªgeP4
(
p
, 
addr
, 
zP4
, 
p4ty³
);

63454  
	gaddr
;

63465 
SQLITE_PRIVATE
 
sql™e3VdbeAddP¬£SchemaOp
(
Vdbe
 *
p
, 
iDb
, *
zWh”e
){

63466 
	gj
;

63467 
	gaddr
 = 
sql™e3VdbeAddOp3
(
p
, 
OP_P¬£Schema
, 
iDb
, 0, 0);

63468 
sql™e3VdbeChªgeP4
(
p
, 
addr
, 
zWh”e
, 
P4_DYNAMIC
);

63469 
	gj
=0; j<
	gp
->
	gdb
->
	gnDb
; j++è
sql™e3VdbeU£sBŒ“
(
p
, 
j
);

63475 
SQLITE_PRIVATE
 
sql™e3VdbeAddOp4IÁ
(

63476 
Vdbe
 *
p
,

63477 
Ý
,

63478 
p1
,

63479 
p2
,

63480 
p3
,

63481 
p4


63483 
	gaddr
 = 
sql™e3VdbeAddOp3
(
p
, 
Ý
, 
p1
, 
p2
, 
p3
);

63484 
sql™e3VdbeChªgeP4
(
p
, 
addr
, 
SQLITE_INT_TO_PTR
(
p4
), 
P4_INT32
);

63485  
	gaddr
;

63502 
SQLITE_PRIVATE
 
sql™e3VdbeMakeLab–
(
Vdbe
 *
v
){

63503 
P¬£
 *
	gp
 = 
v
->
pP¬£
;

63504 
	gi
 = 
p
->
nLab–
++;

63505 
as£¹
Ð
v
->
magic
==
VDBE_MAGIC_INIT
 );

63506 ifÐ(
	gi
 & (i-1))==0 ){

63507 
p
->
aLab–
 = 
sql™e3DbR—ÎocOrF»e
Õ->
db
,…->aLabel,

63508 (
i
*2+1)*(
p
->
aLab–
[0]));

63510 ifÐ
	gp
->
	gaLab–
 ){

63511 
	gp
->
	gaLab–
[
i
] = -1;

63513  -1-
	gi
;

63521 
SQLITE_PRIVATE
 
sql™e3VdbeResÞveLab–
(
Vdbe
 *
v
, 
x
){

63522 
P¬£
 *
	gp
 = 
v
->
pP¬£
;

63523 
	gj
 = -1-
x
;

63524 
as£¹
Ð
v
->
magic
==
VDBE_MAGIC_INIT
 );

63525 
as£¹
Ð
j
<
p
->
nLab–
 );

63526 ifÐ
ALWAYS
(
j
>=0è&& 
p
->
aLab–
 ){

63527 
p
->
aLab–
[
j
] = 
v
->
nOp
;

63529 
	gp
->
	giFixedOp
 = 
v
->
nOp
 - 1;

63535 
SQLITE_PRIVATE
 
sql™e3VdbeRunOÆyOnû
(
Vdbe
 *
p
){

63536 
	gp
->
	grunOÆyOnû
 = 1;

63539 #ifdeà
SQLITE_DEBUG


63557 
VdbeOpI‹r
 
	tVdbeOpI‹r
;

63558 
	sVdbeOpI‹r
 {

63559 
Vdbe
 *
	gv
;

63560 
SubProg¿m
 **
	g­Sub
;

63561 
	gnSub
;

63562 
	giAddr
;

63563 
	giSub
;

63565 
Op
 *
ÝI‹rNext
(
VdbeOpI‹r
 *
p
){

63566 
Vdbe
 *
	gv
 = 
p
->
v
;

63567 
Op
 *
	gpR‘
 = 0;

63568 
Op
 *
	gaOp
;

63569 
	gnOp
;

63571 ifÐ
	gp
->
	giSub
<=
p
->
nSub
 ){

63573 ifÐ
p
->
iSub
==0 ){

63574 
aOp
 = 
v
->aOp;

63575 
	gnOp
 = 
v
->
nOp
;

63577 
	gaOp
 = 
p
->
­Sub
[p->
iSub
-1]->
aOp
;

63578 
	gnOp
 = 
p
->
­Sub
[p->
iSub
-1]->
nOp
;

63580 
as£¹
Ð
p
->
iAddr
<
nOp
 );

63582 
	gpR‘
 = &
aOp
[
p
->
iAddr
];

63583 
	gp
->
	giAddr
++;

63584 ifÐ
	gp
->
	giAddr
==
nOp
 ){

63585 
p
->
iSub
++;

63586 
	gp
->
	giAddr
 = 0;

63589 ifÐ
	gpR‘
->
	gp4ty³
==
P4_SUBPROGRAM
 ){

63590 
nBy‹
 = (
p
->
nSub
+1)*(
SubProg¿m
*);

63591 
	gj
;

63592 
	gj
=0; j<
	gp
->
	gnSub
; j++){

63593 ifÐ
	gp
->
	g­Sub
[
j
]==
pR‘
->
p4
.
pProg¿m
 ) ;

63595 ifÐ
	gj
==
p
->
nSub
 ){

63596 
p
->
­Sub
 = 
sql™e3DbR—ÎocOrF»e
(
v
->
db
,…->­Sub, 
nBy‹
);

63597 ifÐ!
	gp
->
	g­Sub
 ){

63598 
	gpR‘
 = 0;

63600 
	gp
->
	g­Sub
[
p
->
nSub
++] = 
pR‘
->
p4
.
pProg¿m
;

63606  
	gpR‘
;

63629 
SQLITE_PRIVATE
 
sql™e3VdbeAs£¹MayAbÜt
(
Vdbe
 *
v
, 
mayAbÜt
){

63630 
	ghasAbÜt
 = 0;

63631 
Op
 *
	gpOp
;

63632 
VdbeOpI‹r
 
	gsI‹r
;

63633 
mem£t
(&
sI‹r
, 0, (sIter));

63634 
	gsI‹r
.
	gv
 = 
v
;

63636  (
	gpOp
 = 
ÝI‹rNext
(&
sI‹r
))!=0 ){

63637 
Ýcode
 = 
pOp
->opcode;

63638 ifÐ
	gÝcode
==
OP_De¡roy
 || 
Ýcode
==
OP_VUpd©e
 || opcode==
OP_VR’ame


63639 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


63640 || (
Ýcode
==
OP_FkCouÁ”
 && 
pOp
->
p1
==0 &&…Op->
p2
==1)

63642 || ((
Ýcode
==
OP_H®t
 || opcode==
OP_H®tIfNuÎ
)

63643 && ((
pOp
->
p1
&0xff)==
SQLITE_CONSTRAINT
 &&…Op->
p2
==
OE_AbÜt
))

63645 
hasAbÜt
 = 1;

63649 
sql™e3DbF»e
(
v
->
db
, 
sI‹r
.
­Sub
);

63656  ( 
	gv
->
	gdb
->
	gm®locFažed
 || 
	ghasAbÜt
==
mayAbÜt
 );

63673 
»sÞveP2V®ues
(
Vdbe
 *
p
, *
pMaxFuncArgs
){

63674 
	gi
;

63675 
	gnMaxArgs
 = *
pMaxFuncArgs
;

63676 
Op
 *
	gpOp
;

63677 
P¬£
 *
	gpP¬£
 = 
p
->
pP¬£
;

63678 *
	gaLab–
 = 
pP¬£
->
aLab–
;

63679 
	gp
->
	g»adOÆy
 = 1;

63680 
	gp
->
	gbIsR—d”
 = 0;

63681 
	gpOp
=
p
->
aOp
, 
	gi
õ->
nOp
-1; i>=0; i--,…Op++){

63682 
u8
 
	gÝcode
 = 
pOp
->
Ýcode
;

63686  
	gÝcode
 ){

63687 
	gOP_FunùiÚ
:

63688 
OP_AggS‹p
: {

63689 ifÐ
pOp
->
p5
>
nMaxArgs
 )‚MaxArgs =…Op->p5;

63692 
	gOP_T¿n§ùiÚ
: {

63693 ifÐ
pOp
->
p2
!=0 ) 
p
->
»adOÆy
 = 0;

63696 
	gOP_AutoComm™
:

63697 
OP_Sav•ošt
: {

63698 
p
->
bIsR—d”
 = 1;

63701 #iâdeà
SQLITE_OMIT_WAL


63702 
	gOP_Checkpošt
:

63704 
OP_Vacuum
:

63705 
OP_Jouº®Mode
: {

63706 
p
->
»adOÆy
 = 0;

63707 
	gp
->
	gbIsR—d”
 = 1;

63710 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


63711 
	gOP_VUpd©e
: {

63712 ifÐ
pOp
->
p2
>
nMaxArgs
 )‚MaxArgs =…Op->p2;

63715 
	gOP_VFž‹r
: {

63716 
n
;

63717 
as£¹
Ð
p
->
nOp
 - 
i
 >= 3 );

63718 
as£¹
Ð
pOp
[-1].
Ýcode
==
OP_IÁeg”
 );

63719 
	gn
 = 
pOp
[-1].
p1
;

63720 ifÐ
	gn
>
	gnMaxArgs
 )‚MaxArg ð
n
;

63724 
	gOP_Next
:

63725 
OP_NextIfO³n
:

63726 
OP_SÜ‹rNext
: {

63727 
pOp
->
p4
.
xAdvªû
 = 
sql™e3BŒ“Next
;

63728 
	gpOp
->
	gp4ty³
 = 
P4_ADVANCE
;

63731 
	gOP_P»v
:

63732 
OP_P»vIfO³n
: {

63733 
pOp
->
p4
.
xAdvªû
 = 
sql™e3BŒ“P»vious
;

63734 
	gpOp
->
	gp4ty³
 = 
P4_ADVANCE
;

63739 
	gpOp
->
	gÝæags
 = 
sql™e3OpcodePrÝ”ty
[
Ýcode
];

63740 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_JUMP
)!=0 && 
pOp
->
p2
<0 ){

63741 
as£¹
Ð-1-
pOp
->
p2
<
pP¬£
->
nLab–
 );

63742 
	gpOp
->
	gp2
 = 
aLab–
[-1-
pOp
->
p2
];

63745 
sql™e3DbF»e
(
p
->
db
, 
pP¬£
->
aLab–
);

63746 
	gpP¬£
->
	gaLab–
 = 0;

63747 
	gpP¬£
->
	gnLab–
 = 0;

63748 *
	gpMaxFuncArgs
 = 
nMaxArgs
;

63749 
as£¹
Ð
p
->
bIsR—d”
!=0 || 
DbMaskAÎZ”o
Õ->
bŒ“Mask
) );

63755 
SQLITE_PRIVATE
 
sql™e3VdbeCu¼’tAddr
(
Vdbe
 *
p
){

63756 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

63757  
	gp
->
	gnOp
;

63771 
SQLITE_PRIVATE
 
VdbeOp
 *
sql™e3VdbeTakeOpA¼ay
(
Vdbe
 *
p
, *
²Op
, *
²MaxArg
){

63772 
VdbeOp
 *
	gaOp
 = 
p
->
aOp
;

63773 
as£¹
Ð
aOp
 && !
p
->
db
->
m®locFažed
 );

63776 
as£¹
Ð
DbMaskAÎZ”o
(
p
->
bŒ“Mask
) );

63778 
»sÞveP2V®ues
(
p
, 
²MaxArg
);

63779 *
	g²Op
 = 
p
->
nOp
;

63780 
	gp
->
	gaOp
 = 0;

63781  
	gaOp
;

63788 
SQLITE_PRIVATE
 
sql™e3VdbeAddOpLi¡
(
Vdbe
 *
p
, 
nOp
, 
VdbeOpLi¡
 cÚ¡ *
aOp
, 
iLš’o
){

63789 
	gaddr
;

63790 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

63791 ifÐ
	gp
->
	gnOp
 +‚O°>…->
	gpP¬£
->
	gnOpAÎoc
 && 
growOpA¼ay
(
p
, 
nOp
) ){

63794 
	gaddr
 = 
p
->
nOp
;

63795 ifÐ
ALWAYS
(
nOp
>0) ){

63796 
	gi
;

63797 
VdbeOpLi¡
 cÚ¡ *
	gpIn
 = 
aOp
;

63798 
	gi
=0; i<
	gnOp
; i++, 
	gpIn
++){

63799 
	gp2
 = 
pIn
->
p2
;

63800 
VdbeOp
 *
	gpOut
 = &
p
->
aOp
[
i
+
addr
];

63801 
	gpOut
->
	gÝcode
 = 
pIn
->
Ýcode
;

63802 
	gpOut
->
	gp1
 = 
pIn
->
p1
;

63803 ifÐ
	gp2
<0 ){

63804 
as£¹
Ð
sql™e3OpcodePrÝ”ty
[
pOut
->
Ýcode
] & 
OPFLG_JUMP
 );

63805 
	gpOut
->
	gp2
 = 
addr
 + 
ADDR
(
p2
);

63807 
	gpOut
->
	gp2
 = 
p2
;

63809 
	gpOut
->
	gp3
 = 
pIn
->
p3
;

63810 
	gpOut
->
	gp4ty³
 = 
P4_NOTUSED
;

63811 
	gpOut
->
	gp4
.
	gp
 = 0;

63812 
	gpOut
->
	gp5
 = 0;

63813 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


63814 
	gpOut
->
	gzComm’t
 = 0;

63816 #ifdeà
SQLITE_VDBE_COVERAGE


63817 
	gpOut
->
	giSrcLše
 = 
iLš’o
+
i
;

63819 ()
	giLš’o
;

63821 #ifdeà
SQLITE_DEBUG


63822 ifÐ
	gp
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeAddÝT¿û
 ){

63823 
sql™e3VdbePrštOp
(0, 
i
+
addr
, &
p
->
aOp
[i+addr]);

63827 
	gp
->
	gnOp
 +ð
nOp
;

63829  
	gaddr
;

63838 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP1
(
Vdbe
 *
p
, 
u32
 
addr
, 
v®
){

63839 
as£¹
Ð
p
!=0 );

63840 ifÐ((
	gu32
)
	gp
->
	gnOp
)>
	gaddr
 ){

63841 
	gp
->
	gaOp
[
addr
].
	gp1
 = 
v®
;

63849 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP2
(
Vdbe
 *
p
, 
u32
 
addr
, 
v®
){

63850 
as£¹
Ð
p
!=0 );

63851 ifÐ((
	gu32
)
	gp
->
	gnOp
)>
	gaddr
 ){

63852 
	gp
->
	gaOp
[
addr
].
	gp2
 = 
v®
;

63859 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP3
(
Vdbe
 *
p
, 
u32
 
addr
, 
v®
){

63860 
as£¹
Ð
p
!=0 );

63861 ifÐ((
	gu32
)
	gp
->
	gnOp
)>
	gaddr
 ){

63862 
	gp
->
	gaOp
[
addr
].
	gp3
 = 
v®
;

63870 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP5
(
Vdbe
 *
p
, 
u8
 
v®
){

63871 
as£¹
Ð
p
!=0 );

63872 ifÐ
	gp
->
	gaOp
 ){

63873 
as£¹
Ð
p
->
nOp
>0 );

63874 
	gp
->
	gaOp
[
p
->
nOp
-1].
	gp5
 = 
v®
;

63882 
SQLITE_PRIVATE
 
sql™e3VdbeJumpH”e
(
Vdbe
 *
p
, 
addr
){

63883 
sql™e3VdbeChªgeP2
(
p
, 
addr
,…->
nOp
);

63884 
	gp
->
	gpP¬£
->
	giFixedOp
 = 
p
->
nOp
 - 1;

63892 
ä“Ephem”®FunùiÚ
(
sql™e3
 *
db
, 
FuncDef
 *
pDef
){

63893 ifÐ
ALWAYS
(
pDef
è&& (
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_EPHEM
)!=0 ){

63894 
sql™e3DbF»e
(
db
, 
pDef
);

63898 
vdbeF»eOpA¼ay
(
sql™e3
 *, 
Op
 *, );

63903 
ä“P4
(
sql™e3
 *
db
, 
p4ty³
, *
p4
){

63904 ifÐ
	gp4
 ){

63905 
as£¹
Ð
db
 );

63906  
	gp4ty³
 ){

63907 
	gP4_REAL
:

63908 
P4_INT64
:

63909 
P4_DYNAMIC
:

63910 
P4_INTARRAY
: {

63911 
sql™e3DbF»e
(
db
, 
p4
);

63914 
	gP4_KEYINFO
: {

63915 ifÐ
db
->
²By‹sF»ed
==0 ) 
sql™e3KeyInfoUÄef
((
KeyInfo
*)
p4
);

63918 
	gP4_MPRINTF
: {

63919 ifÐ
db
->
²By‹sF»ed
==0 ) 
sql™e3_ä“
(
p4
);

63922 
	gP4_FUNCDEF
: {

63923 
ä“Ephem”®FunùiÚ
(
db
, (
FuncDef
*)
p4
);

63926 
	gP4_MEM
: {

63927 ifÐ
db
->
²By‹sF»ed
==0 ){

63928 
sql™e3V®ueF»e
((
sql™e3_v®ue
*)
p4
);

63930 
Mem
 *
	gp
 = (Mem*)
p4
;

63931 ifÐ
	gp
->
	gszM®loc
 ) 
sql™e3DbF»e
(
db
, 
p
->
zM®loc
);

63932 
sql™e3DbF»e
(
db
, 
p
);

63936 
	gP4_VTAB
 : {

63937 ifÐ
db
->
²By‹sF»ed
==0 ) 
sql™e3VbUÆock
((
VTabË
 *)
p4
);

63949 
vdbeF»eOpA¼ay
(
sql™e3
 *
db
, 
Op
 *
aOp
, 
nOp
){

63950 ifÐ
	gaOp
 ){

63951 
Op
 *
	gpOp
;

63952 
	gpOp
=
aOp
;…Op<&
	gaOp
[
nOp
];…Op++){

63953 
ä“P4
(
db
, 
pOp
->
p4ty³
,…Op->
p4
.
p
);

63954 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


63955 
sql™e3DbF»e
(
db
, 
pOp
->
zComm’t
);

63959 
sql™e3DbF»e
(
db
, 
aOp
);

63967 
SQLITE_PRIVATE
 
sql™e3VdbeLškSubProg¿m
(
Vdbe
 *
pVdbe
, 
SubProg¿m
 *
p
){

63968 
	gp
->
	gpNext
 = 
pVdbe
->
pProg¿m
;

63969 
	gpVdbe
->
	gpProg¿m
 = 
p
;

63975 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeToNoÝ
(
Vdbe
 *
p
, 
addr
){

63976 ifÐ
	gaddr
<
	gp
->
	gnOp
 ){

63977 
VdbeOp
 *
	gpOp
 = &
p
->
aOp
[
addr
];

63978 
sql™e3
 *
	gdb
 = 
p
->
db
;

63979 
ä“P4
(
db
, 
pOp
->
p4ty³
,…Op->
p4
.
p
);

63980 
mem£t
(
pOp
, 0, (pOp[0]));

63981 
	gpOp
->
	gÝcode
 = 
OP_NoÝ
;

63982 ifÐ
	gaddr
==
p
->
nOp
-1 )…->nOp--;

63990 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘ePriÜOpcode
(
Vdbe
 *
p
, 
u8
 
Ý
){

63991 ifÐ(
	gp
->
	gnOp
-1)>Õ->
	gpP¬£
->
	giFixedOp
è&&…->
	gaOp
[
p
->
nOp
-1].
	gÝcode
==
Ý
 ){

63992 
sql™e3VdbeChªgeToNoÝ
(
p
,…->
nOp
-1);

64016 
SQLITE_PRIVATE
 
sql™e3VdbeChªgeP4
(
Vdbe
 *
p
, 
addr
, cÚ¡ *
zP4
, 
n
){

64017 
Op
 *
	gpOp
;

64018 
sql™e3
 *
	gdb
;

64019 
as£¹
Ð
p
!=0 );

64020 
	gdb
 = 
p
->
db
;

64021 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

64022 ifÐ
	gp
->
	gaOp
==0 || 
db
->
m®locFažed
 ){

64023 ifÐ
n
!=
P4_VTAB
 ){

64024 
ä“P4
(
db
, 
n
, (*)*(**)&
zP4
);

64028 
as£¹
Ð
p
->
nOp
>0 );

64029 
as£¹
Ð
addr
<
p
->
nOp
 );

64030 ifÐ
	gaddr
<0 ){

64031 
	gaddr
 = 
p
->
nOp
 - 1;

64033 
	gpOp
 = &
p
->
aOp
[
addr
];

64034 
as£¹
Ð
pOp
->
p4ty³
==
P4_NOTUSED


64035 || 
pOp
->
p4ty³
==
P4_INT32


64036 || 
pOp
->
p4ty³
==
P4_KEYINFO
 );

64037 
ä“P4
(
db
, 
pOp
->
p4ty³
,…Op->
p4
.
p
);

64038 
	gpOp
->
	gp4
.
	gp
 = 0;

64039 ifÐ
	gn
==
P4_INT32
 ){

64042 
pOp
->
p4
.
i
 = 
SQLITE_PTR_TO_INT
(
zP4
);

64043 
	gpOp
->
	gp4ty³
 = 
P4_INT32
;

64044 }ifÐ
	gzP4
==0 ){

64045 
pOp
->
p4
.
p
 = 0;

64046 
	gpOp
->
	gp4ty³
 = 
P4_NOTUSED
;

64047 }ifÐ
	gn
==
P4_KEYINFO
 ){

64048 
pOp
->
p4
.
p
 = (*)
zP4
;

64049 
	gpOp
->
	gp4ty³
 = 
P4_KEYINFO
;

64050 }ifÐ
	gn
==
P4_VTAB
 ){

64051 
pOp
->
p4
.
p
 = (*)
zP4
;

64052 
	gpOp
->
	gp4ty³
 = 
P4_VTAB
;

64053 
sql™e3VbLock
((
VTabË
 *)
zP4
);

64054 
as£¹
Ð((
VTabË
 *)
zP4
)->
db
==
p
->db );

64055 }ifÐ
	gn
<0 ){

64056 
	gpOp
->
	gp4
.
	gp
 = (*)
zP4
;

64057 
	gpOp
->
	gp4ty³
 = (sigÃd )
n
;

64059 ifÐ
	gn
==0 ) 
n
 = 
sql™e3SŒËn30
(
zP4
);

64060 
	gpOp
->
	gp4
.
	gz
 = 
sql™e3DbSŒNDup
(
p
->
db
, 
zP4
, 
n
);

64061 
	gpOp
->
	gp4ty³
 = 
P4_DYNAMIC
;

64069 
SQLITE_PRIVATE
 
sql™e3VdbeS‘P4KeyInfo
(
P¬£
 *
pP¬£
, 
Index
 *
pIdx
){

64070 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

64071 
as£¹
Ð
v
!=0 );

64072 
as£¹
Ð
pIdx
!=0 );

64073 
sql™e3VdbeChªgeP4
(
v
, -1, (*)
sql™e3KeyInfoOfIndex
(
pP¬£
, 
pIdx
),

64074 
P4_KEYINFO
);

64077 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


64084 
vdbeVComm’t
(
Vdbe
 *
p
, cÚ¡ *
zFÜm©
, 
va_li¡
 
­
){

64085 
as£¹
Ð
p
->
nOp
>0 ||…->
aOp
==0 );

64086 
as£¹
Ð
p
->
aOp
==0 ||…->aOp[p->
nOp
-1].
zComm’t
==0 ||…->
db
->
m®locFažed
 );

64087 ifÐ
	gp
->
	gnOp
 ){

64088 
as£¹
Ð
p
->
aOp
 );

64089 
sql™e3DbF»e
(
p
->
db
,…->
aOp
[p->
nOp
-1].
zComm’t
);

64090 
	gp
->
	gaOp
[
p
->
nOp
-1].
	gzComm’t
 = 
sql™e3VMPrštf
Õ->
db
, 
zFÜm©
, 
­
);

64093 
SQLITE_PRIVATE
 
sql™e3VdbeComm’t
(
Vdbe
 *
p
, cÚ¡ *
zFÜm©
, ...){

64094 
va_li¡
 
	g­
;

64095 ifÐ
	gp
 ){

64096 
va_¡¬t
(
­
, 
zFÜm©
);

64097 
vdbeVComm’t
(
p
, 
zFÜm©
, 
­
);

64098 
va_’d
(
­
);

64101 
SQLITE_PRIVATE
 
sql™e3VdbeNoÝComm’t
(
Vdbe
 *
p
, cÚ¡ *
zFÜm©
, ...){

64102 
va_li¡
 
	g­
;

64103 ifÐ
	gp
 ){

64104 
sql™e3VdbeAddOp0
(
p
, 
OP_NoÝ
);

64105 
va_¡¬t
(
­
, 
zFÜm©
);

64106 
vdbeVComm’t
(
p
, 
zFÜm©
, 
­
);

64107 
va_’d
(
­
);

64112 #ifdeà
SQLITE_VDBE_COVERAGE


64116 
SQLITE_PRIVATE
 
sql™e3VdbeS‘LšeNumb”
(
Vdbe
 *
v
, 
iLše
){

64117 
sql™e3VdbeG‘Op
(
v
,-1)->
	giSrcLše
 = 
iLše
;

64134 
SQLITE_PRIVATE
 
VdbeOp
 *
sql™e3VdbeG‘Op
(
Vdbe
 *
p
, 
addr
){

64137 
VdbeOp
 
	gdummy
;

64138 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

64139 ifÐ
	gaddr
<0 ){

64140 
	gaddr
 = 
p
->
nOp
 - 1;

64142 
as£¹
Ð(
addr
>=0 &&‡ddr<
p
->
nOp
è||…->
db
->
m®locFažed
 );

64143 ifÐ
	gp
->
	gdb
->
	gm®locFažed
 ){

64144  (
	gVdbeOp
*)&
	gdummy
;

64146  &
	gp
->
	gaOp
[
addr
];

64150 #ià
defšed
(
SQLITE_ENABLE_EXPLAIN_COMMENTS
)

64155 
Œª¦©eP
(
c
, cÚ¡ 
Op
 *
pOp
){

64156 ifÐ
	gc
=='1' )  
pOp
->
p1
;

64157 ifÐ
	gc
=='2' )  
pOp
->
p2
;

64158 ifÐ
	gc
=='3' )  
pOp
->
p3
;

64159 ifÐ
	gc
=='4' )  
pOp
->
p4
.
i
;

64160  
	gpOp
->
	gp5
;

64176 
di¥ÏyComm’t
(

64177 cÚ¡ 
Op
 *
pOp
,

64178 cÚ¡ *
zP4
,

64179 *
zTemp
,

64180 
nTemp


64182 cÚ¡ *
	gzOpName
;

64183 cÚ¡ *
	gzSynÝsis
;

64184 
	gnOpName
;

64185 
	gii
, 
	gjj
;

64186 
	gzOpName
 = 
sql™e3OpcodeName
(
pOp
->
Ýcode
);

64187 
	gnOpName
 = 
sql™e3SŒËn30
(
zOpName
);

64188 ifÐ
	gzOpName
[
nOpName
+1] ){

64189 
	g£’Com
 = 0;

64190 
	gc
;

64191 
	gzSynÝsis
 = 
zOpName
 +ð
nOpName
 + 1;

64192 
	gii
=
jj
=0; 
	gjj
<
	gnTemp
-1 && (
	gc
 = 
zSynÝsis
[
ii
])!=0; ii++){

64193 ifÐ
	gc
=='P' ){

64194 
c
 = 
zSynÝsis
[++
ii
];

64195 ifÐ
	gc
=='4' ){

64196 
sql™e3_¢´štf
(
nTemp
-
jj
, 
zTemp
+jj, "%s", 
zP4
);

64197 }ifÐ
	gc
=='X' ){

64198 
sql™e3_¢´štf
(
nTemp
-
jj
, 
zTemp
+jj, "%s", 
pOp
->
zComm’t
);

64199 
	g£’Com
 = 1;

64201 
	gv1
 = 
Œª¦©eP
(
c
, 
pOp
);

64202 
	gv2
;

64203 
sql™e3_¢´štf
(
nTemp
-
jj
, 
zTemp
+jj, "%d", 
v1
);

64204 ifÐ
¡ºcmp
(
zSynÝsis
+
ii
+1, "@P", 2)==0 ){

64205 
ii
 += 3;

64206 
	gjj
 +ð
sql™e3SŒËn30
(
zTemp
+
jj
);

64207 
	gv2
 = 
Œª¦©eP
(
zSynÝsis
[
ii
], 
pOp
);

64208 ifÐ
¡ºcmp
(
zSynÝsis
+
ii
+1,"+1",2)==0 ){

64209 
ii
 += 2;

64210 
	gv2
++;

64212 ifÐ
	gv2
>1 ){

64213 
sql™e3_¢´štf
(
nTemp
-
jj
, 
zTemp
+jj, "..%d", 
v1
+
v2
-1);

64215 }ifÐ
¡ºcmp
(
zSynÝsis
+
ii
+1, "..P3", 4)==0 && 
pOp
->
p3
==0 ){

64216 
ii
 += 4;

64219 
	gjj
 +ð
sql™e3SŒËn30
(
zTemp
+
jj
);

64221 
	gzTemp
[
jj
++] = 
c
;

64224 ifÐ!
	g£’Com
 && 
	gjj
<
	gnTemp
-5 && 
	gpOp
->
	gzComm’t
 ){

64225 
sql™e3_¢´štf
(
nTemp
-
jj
, 
zTemp
+jj, "; %s", 
pOp
->
zComm’t
);

64226 
	gjj
 +ð
sql™e3SŒËn30
(
zTemp
+
jj
);

64228 ifÐ
	gjj
<
	gnTemp
 ) 
	gzTemp
[
jj
] = 0;

64229 }ifÐ
	gpOp
->
	gzComm’t
 ){

64230 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%s", 
pOp
->
zComm’t
);

64231 
	gjj
 = 
sql™e3SŒËn30
(
zTemp
);

64233 
	gzTemp
[0] = 0;

64234 
	gjj
 = 0;

64236  
	gjj
;

64241 #ià!
defšed
(
SQLITE_OMIT_EXPLAIN
è|| !defšed(
NDEBUG
) \

64242 || 
defšed
(
VDBE_PROFILE
è|| defšed(
SQLITE_DEBUG
)

64247 *
di¥ÏyP4
(
Op
 *
pOp
, *
zTemp
, 
nTemp
){

64248 *
	gzP4
 = 
zTemp
;

64249 
as£¹
Ð
nTemp
>=20 );

64250  
	gpOp
->
	gp4ty³
 ){

64251 
	gP4_KEYINFO
: {

64252 
i
, 
	gj
;

64253 
KeyInfo
 *
	gpKeyInfo
 = 
pOp
->
p4
.
pKeyInfo
;

64254 
as£¹
Ð
pKeyInfo
->
aSÜtOrd”
!=0 );

64255 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "k(%d", 
pKeyInfo
->
nF›ld
);

64256 
	gi
 = 
sql™e3SŒËn30
(
zTemp
);

64257 
	gj
=0; j<
	gpKeyInfo
->
	gnF›ld
; j++){

64258 
CÞlSeq
 *
	gpCÞl
 = 
pKeyInfo
->
aCÞl
[
j
];

64259 cÚ¡ *
	gzCÞl
 = 
pCÞl
 ?…CÞl->
zName
 : "nil";

64260 
	gn
 = 
sql™e3SŒËn30
(
zCÞl
);

64261 ifÐ
	gn
==6 && 
memcmp
(
zCÞl
,"BINARY",6)==0 ){

64262 
zCÞl
 = "B";

64263 
	gn
 = 1;

64265 ifÐ
	gi
+
	gn
>
	gnTemp
-6 ){

64266 
memýy
(&
zTemp
[
i
],",...",4);

64269 
	gzTemp
[
i
++] = ',';

64270 ifÐ
	gpKeyInfo
->
	gaSÜtOrd”
[
j
] ){

64271 
	gzTemp
[
i
++] = '-';

64273 
memýy
(&
zTemp
[
i
], 
zCÞl
, 
n
+1);

64274 
	gi
 +ð
n
;

64276 
	gzTemp
[
i
++] = ')';

64277 
	gzTemp
[
i
] = 0;

64278 
as£¹
Ð
i
<
nTemp
 );

64281 
	gP4_COLLSEQ
: {

64282 
CÞlSeq
 *
pCÞl
 = 
pOp
->
p4
.pColl;

64283 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "(%.20s)", 
pCÞl
->
zName
);

64286 
	gP4_FUNCDEF
: {

64287 
FuncDef
 *
pDef
 = 
pOp
->
p4
.
pFunc
;

64288 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%s(%d)", 
pDef
->
zName
,…Def->
nArg
);

64291 
	gP4_INT64
: {

64292 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%Îd", *
pOp
->
p4
.
pI64
);

64295 
	gP4_INT32
: {

64296 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%d", 
pOp
->
p4
.
i
);

64299 
	gP4_REAL
: {

64300 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%.16g", *
pOp
->
p4
.
pR—l
);

64303 
	gP4_MEM
: {

64304 
Mem
 *
pMem
 = 
pOp
->
p4
.pMem;

64305 ifÐ
	gpMem
->
	gæags
 & 
	gMEM_SŒ
 ){

64306 
	gzP4
 = 
pMem
->
z
;

64307 }ifÐ
	gpMem
->
	gæags
 & 
	gMEM_IÁ
 ){

64308 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%Îd", 
pMem
->
u
.
i
);

64309 }ifÐ
	gpMem
->
	gæags
 & 
	gMEM_R—l
 ){

64310 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "%.16g", 
pMem
->
u
.
r
);

64311 }ifÐ
	gpMem
->
	gæags
 & 
	gMEM_NuÎ
 ){

64312 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "NULL");

64314 
as£¹
Ð
pMem
->
æags
 & 
MEM_Blob
 );

64315 
	gzP4
 = "(blob)";

64319 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


64320 
	gP4_VTAB
: {

64321 
sql™e3_vb
 *
pVb
 = 
pOp
->
p4
.pVtab->pVtab;

64322 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "vb:%p:%p", 
pVb
,…Vb->
pModuË
);

64326 
	gP4_INTARRAY
: {

64327 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "intarray");

64330 
	gP4_SUBPROGRAM
: {

64331 
sql™e3_¢´štf
(
nTemp
, 
zTemp
, "program");

64334 
	gP4_ADVANCE
: {

64335 
zTemp
[0] = 0;

64339 
zP4
 = 
pOp
->
p4
.
z
;

64340 ifÐ
	gzP4
==0 ){

64341 
zP4
 = 
zTemp
;

64342 
	gzTemp
[0] = 0;

64346 
as£¹
Ð
zP4
!=0 );

64347  
	gzP4
;

64359 
SQLITE_PRIVATE
 
sql™e3VdbeU£sBŒ“
(
Vdbe
 *
p
, 
i
){

64360 
as£¹
Ð
i
>=0 && i<
p
->
db
->
nDb
 && i<()(
yDbMask
)*8 );

64361 
as£¹
Ð
i
<()(
p
->
bŒ“Mask
)*8 );

64362 
DbMaskS‘
(
p
->
bŒ“Mask
, 
i
);

64363 ifÐ
	gi
!=1 && 
sql™e3BŒ“Sh¬abË
(
p
->
db
->
aDb
[
i
].
pBt
) ){

64364 
DbMaskS‘
(
p
->
lockMask
, 
i
);

64368 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& 
SQLITE_THREADSAFE
>0

64390 
SQLITE_PRIVATE
 
sql™e3VdbeEÁ”
(
Vdbe
 *
p
){

64391 
	gi
;

64392 
sql™e3
 *
	gdb
;

64393 
Db
 *
	gaDb
;

64394 
	gnDb
;

64395 ifÐ
DbMaskAÎZ”o
(
p
->
lockMask
) ) ;

64396 
	gdb
 = 
p
->
db
;

64397 
	gaDb
 = 
db
->
aDb
;

64398 
	gnDb
 = 
db
->
nDb
;

64399 
	gi
=0; i<
	gnDb
; i++){

64400 ifÐ
	gi
!=1 && 
DbMaskTe¡
(
p
->
lockMask
,
i
è&& 
ALWAYS
(
aDb
[i].
pBt
!=0) ){

64401 
sql™e3BŒ“EÁ”
(
aDb
[
i
].
pBt
);

64407 #ià!
defšed
(
SQLITE_OMIT_SHARED_CACHE
è&& 
SQLITE_THREADSAFE
>0

64411 
SQLITE_PRIVATE
 
sql™e3VdbeL—ve
(
Vdbe
 *
p
){

64412 
	gi
;

64413 
sql™e3
 *
	gdb
;

64414 
Db
 *
	gaDb
;

64415 
	gnDb
;

64416 ifÐ
DbMaskAÎZ”o
(
p
->
lockMask
) ) ;

64417 
	gdb
 = 
p
->
db
;

64418 
	gaDb
 = 
db
->
aDb
;

64419 
	gnDb
 = 
db
->
nDb
;

64420 
	gi
=0; i<
	gnDb
; i++){

64421 ifÐ
	gi
!=1 && 
DbMaskTe¡
(
p
->
lockMask
,
i
è&& 
ALWAYS
(
aDb
[i].
pBt
!=0) ){

64422 
sql™e3BŒ“L—ve
(
aDb
[
i
].
pBt
);

64428 #ià
defšed
(
VDBE_PROFILE
è|| defšed(
SQLITE_DEBUG
)

64432 
SQLITE_PRIVATE
 
sql™e3VdbePrštOp
(
FILE
 *
pOut
, 
pc
, 
Op
 *
pOp
){

64433 *
	gzP4
;

64434 
	gzPŒ
[50];

64435 
	gzCom
[100];

64436 cÚ¡ *
	gzFÜm©1
 = "%4d %-13s %4d %4d %4d %-13s %.2X %s\n";

64437 ifÐ
	gpOut
==0 ) 
pOut
 = 
¡dout
;

64438 
	gzP4
 = 
di¥ÏyP4
(
pOp
, 
zPŒ
, (zPtr));

64439 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


64440 
di¥ÏyComm’t
(
pOp
, 
zP4
, 
zCom
, (zCom));

64442 
	gzCom
[0] = 0;

64447 
årštf
(
pOut
, 
zFÜm©1
, 
pc
,

64448 
sql™e3OpcodeName
(
pOp
->
Ýcode
),…Op->
p1
,…Op->
p2
,…Op->
p3
, 
zP4
,…Op->
p5
,

64449 
zCom


64451 
fæush
(
pOut
);

64458 
»Ëa£MemA¼ay
(
Mem
 *
p
, 
N
){

64459 ifÐ
	gp
 && 
	gN
 ){

64460 
Mem
 *
	gpEnd
 = &
p
[
N
];

64461 
sql™e3
 *
	gdb
 = 
p
->
db
;

64462 
u8
 
	gm®loc_çžed
 = 
db
->
m®locFažed
;

64463 ifÐ
	gdb
->
	g²By‹sF»ed
 ){

64465 ifÐ
	gp
->
	gszM®loc
 ) 
sql™e3DbF»e
(
db
, 
p
->
zM®loc
);

64466 } (++
	gp
)<
	gpEnd
 );

64470 
as£¹
Ð(&
p
[1])==
pEnd
 ||…[0].
db
==p[1].db );

64471 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(
p
) );

64485 
‹¡ÿ£
Ð
p
->
æags
 & 
MEM_Agg
 );

64486 
‹¡ÿ£
Ð
p
->
æags
 & 
MEM_Dyn
 );

64487 
‹¡ÿ£
Ð
p
->
æags
 & 
MEM_F¿me
 );

64488 
‹¡ÿ£
Ð
p
->
æags
 & 
MEM_RowS‘
 );

64489 ifÐ
	gp
->
	gæags
&(
	gMEM_Agg
|
	gMEM_Dyn
|
	gMEM_F¿me
|
	gMEM_RowS‘
) ){

64490 
sql™e3VdbeMemR–—£
(
p
);

64491 }ifÐ
	gp
->
	gszM®loc
 ){

64492 
sql™e3DbF»e
(
db
, 
p
->
zM®loc
);

64493 
	gp
->
	gszM®loc
 = 0;

64496 
	gp
->
	gæags
 = 
MEM_Undefšed
;

64497 } (++
	gp
)<
	gpEnd
 );

64498 
	gdb
->
	gm®locFažed
 = 
m®loc_çžed
;

64506 
SQLITE_PRIVATE
 
sql™e3VdbeF¿meD–‘e
(
VdbeF¿me
 *
p
){

64507 
	gi
;

64508 
Mem
 *
	gaMem
 = 
VdbeF¿meMem
(
p
);

64509 
VdbeCursÜ
 **
	g­C¤
 = (VdbeCursÜ **)&
aMem
[
p
->
nChždMem
];

64510 
	gi
=0; i<
	gp
->
	gnChždC¤
; i++){

64511 
sql™e3VdbeF»eCursÜ
(
p
->
v
, 
­C¤
[
i
]);

64513 
»Ëa£MemA¼ay
(
aMem
, 
p
->
nChždMem
);

64514 
sql™e3DbF»e
(
p
->
v
->
db
,…);

64517 #iâdeà
SQLITE_OMIT_EXPLAIN


64533 
SQLITE_PRIVATE
 
sql™e3VdbeLi¡
(

64534 
Vdbe
 *
p


64536 
	gnRow
;

64537 
	gnSub
 = 0;

64538 
SubProg¿m
 **
	g­Sub
 = 0;

64539 
Mem
 *
	gpSub
 = 0;

64540 
sql™e3
 *
	gdb
 = 
p
->
db
;

64541 
	gi
;

64542 
	grc
 = 
SQLITE_OK
;

64543 
Mem
 *
	gpMem
 = &
p
->
aMem
[1];

64545 
as£¹
Ð
p
->
ex¶aš
 );

64546 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_RUN
 );

64547 
as£¹
Ð
p
->
rc
==
SQLITE_OK
 ||…->rc==
SQLITE_BUSY
 ||…->rc==
SQLITE_NOMEM
 );

64553 
»Ëa£MemA¼ay
(
pMem
, 8);

64554 
	gp
->
	gpResuÉS‘
 = 0;

64556 ifÐ
	gp
->
	grc
==
SQLITE_NOMEM
 ){

64559 
db
->
m®locFažed
 = 1;

64560  
	gSQLITE_ERROR
;

64570 
	gnRow
 = 
p
->
nOp
;

64571 ifÐ
	gp
->
	gex¶aš
==1 ){

64576 
as£¹
Ð
p
->
nMem
>9 );

64577 
	gpSub
 = &
p
->
aMem
[9];

64578 ifÐ
	gpSub
->
	gæags
&
	gMEM_Blob
 ){

64581 
	gnSub
 = 
pSub
->
n
/(
Vdbe
*);

64582 
	g­Sub
 = (
SubProg¿m
 **)
pSub
->
z
;

64584 
	gi
=0; i<
	gnSub
; i++){

64585 
	gnRow
 +ð
­Sub
[
i
]->
nOp
;

64590 
	gi
 = 
p
->
pc
++;

64591 } 
	gi
<
	gnRow
 && 
	gp
->
	gex¶aš
==2 && 
p
->
aOp
[
i
].
Ýcode
!=
OP_Ex¶aš
 );

64592 ifÐ
	gi
>=
nRow
 ){

64593 
p
->
rc
 = 
SQLITE_OK
;

64594 
	grc
 = 
SQLITE_DONE
;

64595 }ifÐ
	gdb
->
	gu1
.
	gisIÁ”ru±ed
 ){

64596 
	gp
->
	grc
 = 
SQLITE_INTERRUPT
;

64597 
	grc
 = 
SQLITE_ERROR
;

64598 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3E¼SŒ
Õ->
rc
));

64600 *
	gzP4
;

64601 
Op
 *
	gpOp
;

64602 ifÐ
	gi
<
	gp
->
	gnOp
 ){

64605 
	gpOp
 = &
p
->
aOp
[
i
];

64609 
	gj
;

64610 
	gi
 -ð
p
->
nOp
;

64611 
	gj
=0; 
	gi
>=
­Sub
[
j
]->
nOp
; j++){

64612 
	gi
 -ð
­Sub
[
j
]->
nOp
;

64614 
	gpOp
 = &
­Sub
[
j
]->
aOp
[
i
];

64616 ifÐ
	gp
->
	gex¶aš
==1 ){

64617 
pMem
->
æags
 = 
MEM_IÁ
;

64618 
	gpMem
->
	gu
.
	gi
 = 
i
;

64619 
	gpMem
++;

64621 
	gpMem
->
	gæags
 = 
MEM_Stic
|
MEM_SŒ
|
MEM_T”m
;

64622 
	gpMem
->
	gz
 = (*)
sql™e3OpcodeName
(
pOp
->
Ýcode
);

64623 
as£¹
Ð
pMem
->
z
!=0 );

64624 
	gpMem
->
	gn
 = 
sql™e3SŒËn30
(
pMem
->
z
);

64625 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

64626 
	gpMem
++;

64633 ifÐ
	gpOp
->
	gp4ty³
==
P4_SUBPROGRAM
 ){

64634 
nBy‹
 = (
nSub
+1)*(
SubProg¿m
*);

64635 
	gj
;

64636 
	gj
=0; j<
	gnSub
; j++){

64637 ifÐ
	g­Sub
[
j
]==
pOp
->
p4
.
pProg¿m
 ) ;

64639 ifÐ
	gj
==
nSub
 && 
SQLITE_OK
==
sql™e3VdbeMemGrow
(
pSub
, 
nBy‹
,‚Sub!=0) ){

64640 
­Sub
 = (
SubProg¿m
 **)
pSub
->
z
;

64641 
	g­Sub
[
nSub
++] = 
pOp
->
p4
.
pProg¿m
;

64642 
	gpSub
->
	gæags
 |ð
MEM_Blob
;

64643 
	gpSub
->
	gn
 = 
nSub
*(
SubProg¿m
*);

64648 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

64649 
	gpMem
->
	gu
.
	gi
 = 
pOp
->
p1
;

64650 
	gpMem
++;

64652 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

64653 
	gpMem
->
	gu
.
	gi
 = 
pOp
->
p2
;

64654 
	gpMem
++;

64656 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

64657 
	gpMem
->
	gu
.
	gi
 = 
pOp
->
p3
;

64658 
	gpMem
++;

64660 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pMem
, 32) ){

64661 
as£¹
Ð
p
->
db
->
m®locFažed
 );

64662  
	gSQLITE_ERROR
;

64664 
	gpMem
->
	gæags
 = 
MEM_SŒ
|
MEM_T”m
;

64665 
	gzP4
 = 
di¥ÏyP4
(
pOp
, 
pMem
->
z
, 32);

64666 ifÐ
	gzP4
!=
pMem
->
z
 ){

64667 
sql™e3VdbeMemS‘SŒ
(
pMem
, 
zP4
, -1, 
SQLITE_UTF8
, 0);

64669 
as£¹
Ð
pMem
->
z
!=0 );

64670 
	gpMem
->
	gn
 = 
sql™e3SŒËn30
(
pMem
->
z
);

64671 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

64673 
	gpMem
++;

64675 ifÐ
	gp
->
	gex¶aš
==1 ){

64676 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pMem
, 4) ){

64677 
as£¹
Ð
p
->
db
->
m®locFažed
 );

64678  
	gSQLITE_ERROR
;

64680 
	gpMem
->
	gæags
 = 
MEM_SŒ
|
MEM_T”m
;

64681 
	gpMem
->
	gn
 = 2;

64682 
sql™e3_¢´štf
(3, 
pMem
->
z
, "%.2x", 
pOp
->
p5
);

64683 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

64684 
	gpMem
++;

64686 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


64687 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pMem
, 500) ){

64688 
as£¹
Ð
p
->
db
->
m®locFažed
 );

64689  
	gSQLITE_ERROR
;

64691 
	gpMem
->
	gæags
 = 
MEM_SŒ
|
MEM_T”m
;

64692 
	gpMem
->
	gn
 = 
di¥ÏyComm’t
(
pOp
, 
zP4
, 
pMem
->
z
, 500);

64693 
	gpMem
->
	g’c
 = 
SQLITE_UTF8
;

64695 
	gpMem
->
	gæags
 = 
MEM_NuÎ
;

64699 
	gp
->
	gnResCÞumn
 = 8 - 4*(
p
->
ex¶aš
-1);

64700 
	gp
->
	gpResuÉS‘
 = &
p
->
aMem
[1];

64701 
	gp
->
	grc
 = 
SQLITE_OK
;

64702 
	grc
 = 
SQLITE_ROW
;

64704  
	grc
;

64708 #ifdeà
SQLITE_DEBUG


64712 
SQLITE_PRIVATE
 
sql™e3VdbePrštSql
(
Vdbe
 *
p
){

64713 cÚ¡ *
	gz
 = 0;

64714 ifÐ
	gp
->
	gzSql
 ){

64715 
	gz
 = 
p
->
zSql
;

64716 }ifÐ
	gp
->
	gnOp
>=1 ){

64717 cÚ¡ 
VdbeOp
 *
pOp
 = &
p
->
aOp
[0];

64718 ifÐ
	gpOp
->
	gÝcode
==
OP_In™
 && 
pOp
->
p4
.
z
!=0 ){

64719 
z
 = 
pOp
->
p4
.z;

64720  
sql™e3Is¥aû
(*
z
èè
	gz
++;

64723 ifÐ
	gz
 ) 
´štf
("SQL: [%s]\n", 
z
);

64727 #ià!
defšed
(
SQLITE_OMIT_TRACE
è&& defšed(
SQLITE_ENABLE_IOTRACE
)

64731 
SQLITE_PRIVATE
 
sql™e3VdbeIOT¿ûSql
(
Vdbe
 *
p
){

64732 
	gnOp
 = 
p
->
nOp
;

64733 
VdbeOp
 *
	gpOp
;

64734 ifÐ
	gsql™e3IoT¿û
==0 ) ;

64735 ifÐ
	gnOp
<1 ) ;

64736 
	gpOp
 = &
p
->
aOp
[0];

64737 ifÐ
	gpOp
->
	gÝcode
==
OP_In™
 && 
pOp
->
p4
.
z
!=0 ){

64738 
i
, 
j
;

64739 
	gz
[1000];

64740 
sql™e3_¢´štf
((
z
), z, "%s", 
pOp
->
p4
.z);

64741 
	gi
=0; 
sql™e3Is¥aû
(
z
[
i
]); i++){}

64742 
	gj
=0; 
	gz
[
i
]; 
	gi
++){

64743 ifÐ
sql™e3Is¥aû
(
z
[
i
]) ){

64744 ifÐ
	gz
[
i
-1]!=' ' ){

64745 
z
[
j
++] = ' ';

64748 
	gz
[
j
++] = 
z
[
i
];

64751 
	gz
[
j
] = 0;

64752 
sql™e3IoT¿û
("SQL %s\n", 
z
);

64778 *
®locS·û
(

64779 *
pBuf
,

64780 
nBy‹
,

64781 
u8
 **
µFrom
,

64782 
u8
 *
pEnd
,

64783 *
²By‹


64785 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(*
µFrom
) );

64786 ifÐ
	gpBuf
 ) …Buf;

64787 
	gnBy‹
 = 
ROUND8
(
nBy‹
);

64788 ifÐ&(*
	gµFrom
)[
nBy‹
] <ð
pEnd
 ){

64789 
pBuf
 = (*)*
µFrom
;

64790 *
	gµFrom
 +ð
nBy‹
;

64792 *
	g²By‹
 +ð
nBy‹
;

64794  
	gpBuf
;

64801 
SQLITE_PRIVATE
 
sql™e3VdbeRewšd
(
Vdbe
 *
p
){

64802 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
VDBE_PROFILE
)

64803 
	gi
;

64805 
as£¹
Ð
p
!=0 );

64806 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

64810 
as£¹
Ð
p
->
nOp
>0 );

64813 
	gp
->
	gmagic
 = 
VDBE_MAGIC_RUN
;

64815 #ifdeà
SQLITE_DEBUG


64816 
	gi
=1; i<
	gp
->
	gnMem
; i++){

64817 
as£¹
Ð
p
->
aMem
[
i
].
db
==p->db );

64820 
	gp
->
	gpc
 = -1;

64821 
	gp
->
	grc
 = 
SQLITE_OK
;

64822 
	gp
->
	g”rÜAùiÚ
 = 
OE_AbÜt
;

64823 
	gp
->
	gmagic
 = 
VDBE_MAGIC_RUN
;

64824 
	gp
->
	gnChªge
 = 0;

64825 
	gp
->
	gÿcheCŒ
 = 1;

64826 
	gp
->
	gmšWr™eFžeFÜm©
 = 255;

64827 
	gp
->
	giS‹m’t
 = 0;

64828 
	gp
->
	gnFkCÚ¡¿št
 = 0;

64829 #ifdeà
VDBE_PROFILE


64830 
	gi
=0; i<
	gp
->
	gnOp
; i++){

64831 
	gp
->
	gaOp
[
i
].
	gút
 = 0;

64832 
	gp
->
	gaOp
[
i
].
	gcyþes
 = 0;

64855 
SQLITE_PRIVATE
 
sql™e3VdbeMakeR—dy
(

64856 
Vdbe
 *
p
,

64857 
P¬£
 *
pP¬£


64859 
sql™e3
 *
	gdb
;

64860 
	gnV¬
;

64861 
	gnMem
;

64862 
	gnCursÜ
;

64863 
	gnArg
;

64864 
	gnOnû
;

64865 
	gn
;

64866 
u8
 *
	gzC¤
;

64867 
u8
 *
	gzEnd
;

64868 
	gnBy‹
;

64870 
as£¹
Ð
p
!=0 );

64871 
as£¹
Ð
p
->
nOp
>0 );

64872 
as£¹
Ð
pP¬£
!=0 );

64873 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_INIT
 );

64874 
as£¹
Ð
pP¬£
==
p
->pParse );

64875 
	gdb
 = 
p
->
db
;

64876 
as£¹
Ð
db
->
m®locFažed
==0 );

64877 
	gnV¬
 = 
pP¬£
->
nV¬
;

64878 
	gnMem
 = 
pP¬£
->
nMem
;

64879 
	gnCursÜ
 = 
pP¬£
->
nTab
;

64880 
	gnArg
 = 
pP¬£
->
nMaxArg
;

64881 
	gnOnû
 = 
pP¬£
->
nOnû
;

64882 ifÐ
	gnOnû
==0 ) 
nOnû
 = 1;

64893 
	gnMem
 +ð
nCursÜ
;

64898 
	gzC¤
 = (
u8
*)&
p
->
aOp
[p->
nOp
];

64899 
	gzEnd
 = (
u8
*)&
p
->
aOp
[
pP¬£
->
nOpAÎoc
];

64901 
»sÞveP2V®ues
(
p
, &
nArg
);

64902 
	gp
->
	gu£sStmtJouº®
 = (
u8
)(
pP¬£
->
isMuÉiWr™e
 &&…P¬£->
mayAbÜt
);

64903 ifÐ
	gpP¬£
->
	gex¶aš
 && 
	gnMem
<10 ){

64904 
	gnMem
 = 10;

64906 
mem£t
(
zC¤
, 0, 
zEnd
-zCsr);

64907 
	gzC¤
 +ð(
zC¤
 - (
u8
*)0)&7;

64908 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
zC¤
) );

64909 
	gp
->
	gexpœed
 = 0;

64922 
	gnBy‹
 = 0;

64923 
	gp
->
	gaMem
 = 
®locS·û
(
p
->
aMem
, 
nMem
*(
Mem
), &
zC¤
, 
zEnd
, &
nBy‹
);

64924 
	gp
->
	gaV¬
 = 
®locS·û
(
p
->
aV¬
, 
nV¬
*(
Mem
), &
zC¤
, 
zEnd
, &
nBy‹
);

64925 
	gp
->
	g­Arg
 = 
®locS·û
(
p
->
­Arg
, 
nArg
*(
Mem
*), &
zC¤
, 
zEnd
, &
nBy‹
);

64926 
	gp
->
	gazV¬
 = 
®locS·û
(
p
->
azV¬
, 
nV¬
*(*), &
zC¤
, 
zEnd
, &
nBy‹
);

64927 
	gp
->
	g­C¤
 = 
®locS·û
(
p
->
­C¤
, 
nCursÜ
*(
VdbeCursÜ
*),

64928 &
zC¤
, 
zEnd
, &
nBy‹
);

64929 
	gp
->
	gaOnûFÏg
 = 
®locS·û
(
p
->
aOnûFÏg
, 
nOnû
, &
zC¤
, 
zEnd
, &
nBy‹
);

64930 ifÐ
	gnBy‹
 ){

64931 
	gp
->
	gpF»e
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

64933 
	gzC¤
 = 
p
->
pF»e
;

64934 
	gzEnd
 = &
zC¤
[
nBy‹
];

64935 } 
	gnBy‹
 && !
	gdb
->
	gm®locFažed
 );

64937 
	gp
->
	gnCursÜ
 = 
nCursÜ
;

64938 
	gp
->
	gnOnûFÏg
 = 
nOnû
;

64939 ifÐ
	gp
->
	gaV¬
 ){

64940 
	gp
->
	gnV¬
 = (
ynV¬
)
nV¬
;

64941 
	gn
=0;‚<
	gnV¬
;‚++){

64942 
	gp
->
	gaV¬
[
n
].
	gæags
 = 
MEM_NuÎ
;

64943 
	gp
->
	gaV¬
[
n
].
	gdb
 = 
db
;

64946 ifÐ
	gp
->
	gazV¬
 ){

64947 
	gp
->
	gnzV¬
 = 
pP¬£
->
nzV¬
;

64948 
memýy
(
p
->
azV¬
, 
pP¬£
->azV¬,…->
nzV¬
*(p->azVar[0]));

64949 
mem£t
(
pP¬£
->
azV¬
, 0,…P¬£->
nzV¬
*(pParse->azVar[0]));

64951 ifÐ
	gp
->
	gaMem
 ){

64952 
	gp
->
	gaMem
--;

64953 
	gp
->
	gnMem
 = 
nMem
;

64954 
	gn
=1;‚<=
nMem
;‚++){

64955 
	gp
->
	gaMem
[
n
].
	gæags
 = 
MEM_Undefšed
;

64956 
	gp
->
	gaMem
[
n
].
	gdb
 = 
db
;

64959 
	gp
->
	gex¶aš
 = 
pP¬£
->
ex¶aš
;

64960 
sql™e3VdbeRewšd
(
p
);

64967 
SQLITE_PRIVATE
 
sql™e3VdbeF»eCursÜ
(
Vdbe
 *
p
, 
VdbeCursÜ
 *
pCx
){

64968 ifÐ
	gpCx
==0 ){

64971 
sql™e3VdbeSÜ‹rClo£
(
p
->
db
, 
pCx
);

64972 ifÐ
	gpCx
->
	gpBt
 ){

64973 
sql™e3BŒ“Clo£
(
pCx
->
pBt
);

64976 }ifÐ
	gpCx
->
	gpCursÜ
 ){

64977 
sql™e3BŒ“Clo£CursÜ
(
pCx
->
pCursÜ
);

64979 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


64980 ifÐ
	gpCx
->
	gpVbCursÜ
 ){

64981 
sql™e3_vb_cursÜ
 *
	gpVbCursÜ
 = 
pCx
->
pVbCursÜ
;

64982 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
 = 
pVbCursÜ
->
pVb
->
pModuË
;

64983 
	gp
->
	gšVbM‘hod
 = 1;

64984 
	gpModuË
->
xClo£
(
pVbCursÜ
);

64985 
	gp
->
	gšVbM‘hod
 = 0;

64995 
SQLITE_PRIVATE
 
sql™e3VdbeF¿meRe¡Üe
(
VdbeF¿me
 *
pF¿me
){

64996 
Vdbe
 *
	gv
 = 
pF¿me
->
v
;

64997 
	gv
->
	gaOnûFÏg
 = 
pF¿me
->
aOnûFÏg
;

64998 
	gv
->
	gnOnûFÏg
 = 
pF¿me
->
nOnûFÏg
;

64999 
	gv
->
	gaOp
 = 
pF¿me
->
aOp
;

65000 
	gv
->
	gnOp
 = 
pF¿me
->
nOp
;

65001 
	gv
->
	gaMem
 = 
pF¿me
->
aMem
;

65002 
	gv
->
	gnMem
 = 
pF¿me
->
nMem
;

65003 
	gv
->
	g­C¤
 = 
pF¿me
->
­C¤
;

65004 
	gv
->
	gnCursÜ
 = 
pF¿me
->
nCursÜ
;

65005 
	gv
->
	gdb
->
	gÏ¡Rowid
 = 
pF¿me
->
Ï¡Rowid
;

65006 
	gv
->
	gnChªge
 = 
pF¿me
->
nChªge
;

65007  
	gpF¿me
->
	gpc
;

65018 
þo£AÎCursÜs
(
Vdbe
 *
p
){

65019 ifÐ
	gp
->
	gpF¿me
 ){

65020 
VdbeF¿me
 *
	gpF¿me
;

65021 
	gpF¿me
=
p
->
pF¿me
;…F¿me->
	gpP¬’t
;…F¿meõF¿me->
pP¬’t
);

65022 
sql™e3VdbeF¿meRe¡Üe
(
pF¿me
);

65023 
	gp
->
	gpF¿me
 = 0;

65024 
	gp
->
	gnF¿me
 = 0;

65026 
as£¹
Ð
p
->
nF¿me
==0 );

65028 ifÐ
	gp
->
	g­C¤
 ){

65029 
	gi
;

65030 
	gi
=0; i<
	gp
->
	gnCursÜ
; i++){

65031 
VdbeCursÜ
 *
	gpC
 = 
p
->
­C¤
[
i
];

65032 ifÐ
	gpC
 ){

65033 
sql™e3VdbeF»eCursÜ
(
p
, 
pC
);

65034 
	gp
->
	g­C¤
[
i
] = 0;

65038 ifÐ
	gp
->
	gaMem
 ){

65039 
»Ëa£MemA¼ay
(&
p
->
aMem
[1],…->
nMem
);

65041  
	gp
->
	gpD–F¿me
 ){

65042 
VdbeF¿me
 *
	gpD–
 = 
p
->
pD–F¿me
;

65043 
	gp
->
	gpD–F¿me
 = 
pD–
->
pP¬’t
;

65044 
sql™e3VdbeF¿meD–‘e
(
pD–
);

65048 ifÐ
	gp
->
	gpAuxD©a
 ) 
sql™e3VdbeD–‘eAuxD©a
(
p
, -1, 0);

65049 
as£¹
Ð
p
->
pAuxD©a
==0 );

65055 
CËªup
(
Vdbe
 *
p
){

65056 
sql™e3
 *
	gdb
 = 
p
->
db
;

65058 #ifdeà
SQLITE_DEBUG


65061 
	gi
;

65062 ifÐ
	gp
->
	g­C¤
 ) 
	gi
=0; i<p->
	gnCursÜ
; i++è
as£¹
Ð
p
->
­C¤
[
i
]==0 );

65063 ifÐ
	gp
->
	gaMem
 ){

65064 
	gi
=1; i<=
p
->
nMem
; i++è
as£¹
Ðp->
aMem
[
i
].
æags
==
MEM_Undefšed
 );

65068 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

65069 
	gp
->
	gzE¼Msg
 = 0;

65070 
	gp
->
	gpResuÉS‘
 = 0;

65079 
SQLITE_PRIVATE
 
sql™e3VdbeS‘NumCÞs
(
Vdbe
 *
p
, 
nResCÞumn
){

65080 
Mem
 *
	gpCÞName
;

65081 
	gn
;

65082 
sql™e3
 *
	gdb
 = 
p
->
db
;

65084 
»Ëa£MemA¼ay
(
p
->
aCÞName
,…->
nResCÞumn
*
COLNAME_N
);

65085 
sql™e3DbF»e
(
db
, 
p
->
aCÞName
);

65086 
	gn
 = 
nResCÞumn
*
COLNAME_N
;

65087 
	gp
->
	gnResCÞumn
 = (
u16
)
nResCÞumn
;

65088 
	gp
->
	gaCÞName
 = 
pCÞName
 = (
Mem
*)
sql™e3DbM®locZ”o
(
db
, (Mem)*
n
 );

65089 ifÐ
	gp
->
	gaCÞName
==0 ) ;

65090  
	gn
-- > 0 ){

65091 
	gpCÞName
->
	gæags
 = 
MEM_NuÎ
;

65092 
	gpCÞName
->
	gdb
 = 
p
->
db
;

65093 
	gpCÞName
++;

65107 
SQLITE_PRIVATE
 
sql™e3VdbeS‘CÞName
(

65108 
Vdbe
 *
p
,

65109 
idx
,

65110 
v¬
,

65111 cÚ¡ *
zName
,

65112 (*
xD–
)(*)

65114 
	grc
;

65115 
Mem
 *
	gpCÞName
;

65116 
as£¹
Ð
idx
<
p
->
nResCÞumn
 );

65117 
as£¹
Ð
v¬
<
COLNAME_N
 );

65118 ifÐ
	gp
->
	gdb
->
	gm®locFažed
 ){

65119 
as£¹
Ð!
zName
 || 
xD–
!=
SQLITE_DYNAMIC
 );

65120  
	gSQLITE_NOMEM
;

65122 
as£¹
Ð
p
->
aCÞName
!=0 );

65123 
	gpCÞName
 = &(
p
->
aCÞName
[
idx
+
v¬
*p->
nResCÞumn
]);

65124 
	grc
 = 
sql™e3VdbeMemS‘SŒ
(
pCÞName
, 
zName
, -1, 
SQLITE_UTF8
, 
xD–
);

65125 
as£¹
Ð
rc
!=0 || !
zName
 || (
pCÞName
->
æags
&
MEM_T”m
)!=0 );

65126  
	grc
;

65135 
vdbeComm™
(
sql™e3
 *
db
, 
Vdbe
 *
p
){

65136 
	gi
;

65137 
	gnT¿ns
 = 0;

65138 
	grc
 = 
SQLITE_OK
;

65139 
	gÃedXcomm™
 = 0;

65141 #ifdeà
SQLITE_OMIT_VIRTUALTABLE


65145 
UNUSED_PARAMETER
(
p
);

65154 
	grc
 = 
sql™e3VbSync
(
db
, 
p
);

65162 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nDb
; i++){

65163 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65164 ifÐ
sql™e3BŒ“IsInT¿ns
(
pBt
) ){

65165 
	gÃedXcomm™
 = 1;

65166 ifÐ
	gi
!=1 ) 
nT¿ns
++;

65167 
sql™e3BŒ“EÁ”
(
pBt
);

65168 
	grc
 = 
sql™e3Pag”ExþusiveLock
(
sql™e3BŒ“Pag”
(
pBt
));

65169 
sql™e3BŒ“L—ve
(
pBt
);

65172 ifÐ
	grc
!=
SQLITE_OK
 ){

65173  
rc
;

65177 ifÐ
	gÃedXcomm™
 && 
	gdb
->
	gxComm™C®lback
 ){

65178 
	grc
 = 
db
->
xComm™C®lback
(db->
pComm™Arg
);

65179 ifÐ
	grc
 ){

65180  
	gSQLITE_CONSTRAINT_COMMITHOOK
;

65193 ifÐ0==
sql™e3SŒËn30
(
sql™e3BŒ“G‘Fž’ame
(
db
->
aDb
[0].
pBt
))

65194 || 
nT¿ns
<=1

65196 
i
=0; 
	grc
==
SQLITE_OK
 && i<
db
->
nDb
; 
	gi
++){

65197 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65198 ifÐ
	gpBt
 ){

65199 
	grc
 = 
sql™e3BŒ“Comm™Pha£OÃ
(
pBt
, 0);

65208 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nDb
; i++){

65209 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65210 ifÐ
	gpBt
 ){

65211 
	grc
 = 
sql™e3BŒ“Comm™Pha£Two
(
pBt
, 0);

65214 ifÐ
	grc
==
SQLITE_OK
 ){

65215 
sql™e3VbComm™
(
db
);

65223 #iâdeà
SQLITE_OMIT_DISKIO


65225 
sql™e3_vfs
 *
	gpVfs
 = 
db
->
pVfs
;

65226 
	gÃedSync
 = 0;

65227 *
	gzMa¡”
 = 0;

65228 cÚ¡ *
	gzMašFže
 = 
sql™e3BŒ“G‘Fž’ame
(
db
->
aDb
[0].
pBt
);

65229 
sql™e3_fže
 *
	gpMa¡”
 = 0;

65230 
i64
 
	goff£t
 = 0;

65231 
	g»s
;

65232 
	g»ŒyCouÁ
 = 0;

65233 
	gnMašFže
;

65236 
	gnMašFže
 = 
sql™e3SŒËn30
(
zMašFže
);

65237 
	gzMa¡”
 = 
sql™e3MPrštf
(
db
, "%s-mjXXXXXX9XXz", 
zMašFže
);

65238 ifÐ
	gzMa¡”
==0 )  
SQLITE_NOMEM
;

65240 
u32
 
	giRªdom
;

65241 ifÐ
	g»ŒyCouÁ
 ){

65242 ifÐ
	g»ŒyCouÁ
>100 ){

65243 
sql™e3_log
(
SQLITE_FULL
, "MJ d–‘e: %s", 
zMa¡”
);

65244 
sql™e3OsD–‘e
(
pVfs
, 
zMa¡”
, 0);

65246 }ifÐ
	g»ŒyCouÁ
==1 ){

65247 
sql™e3_log
(
SQLITE_FULL
, "MJ cÞlide: %s", 
zMa¡”
);

65250 
	g»ŒyCouÁ
++;

65251 
sql™e3_¿ndomÃss
((
iRªdom
), &iRandom);

65252 
sql™e3_¢´štf
(13, &
zMa¡”
[
nMašFže
], "-mj%06X9%02X",

65253 (
iRªdom
>>8)&0xffffff, iRandom&0xff);

65256 
as£¹
Ð
zMa¡”
[
sql™e3SŒËn30
(zMaster)-3]=='9' );

65257 
sql™e3FžeSuffix3
(
zMašFže
, 
zMa¡”
);

65258 
	grc
 = 
sql™e3OsAcûss
(
pVfs
, 
zMa¡”
, 
SQLITE_ACCESS_EXISTS
, &
»s
);

65259 } 
	grc
==
SQLITE_OK
 && 
»s
 );

65260 ifÐ
	grc
==
SQLITE_OK
 ){

65262 
rc
 = 
sql™e3OsO³nM®loc
(
pVfs
, 
zMa¡”
, &
pMa¡”
,

65263 
SQLITE_OPEN_READWRITE
|
SQLITE_OPEN_CREATE
|

65264 
SQLITE_OPEN_EXCLUSIVE
|
SQLITE_OPEN_MASTER_JOURNAL
, 0

65267 ifÐ
	grc
!=
SQLITE_OK
 ){

65268 
sql™e3DbF»e
(
db
, 
zMa¡”
);

65269  
	grc
;

65278 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

65279 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65280 ifÐ
sql™e3BŒ“IsInT¿ns
(
pBt
) ){

65281 cÚ¡ *
	gzFže
 = 
sql™e3BŒ“G‘Jouº®Çme
(
pBt
);

65282 ifÐ
	gzFže
==0 ){

65285 
as£¹
Ð
zFže
[0]!=0 );

65286 ifÐ!
	gÃedSync
 && !
sql™e3BŒ“SyncDi§bËd
(
pBt
) ){

65287 
	gÃedSync
 = 1;

65289 
	grc
 = 
sql™e3OsWr™e
(
pMa¡”
, 
zFže
, 
sql™e3SŒËn30
(zFže)+1, 
off£t
);

65290 
	goff£t
 +ð
sql™e3SŒËn30
(
zFže
)+1;

65291 ifÐ
	grc
!=
SQLITE_OK
 ){

65292 
sql™e3OsClo£F»e
(
pMa¡”
);

65293 
sql™e3OsD–‘e
(
pVfs
, 
zMa¡”
, 0);

65294 
sql™e3DbF»e
(
db
, 
zMa¡”
);

65295  
	grc
;

65303 ifÐ
	gÃedSync


65304 && 0==(
sql™e3OsDeviûCh¬aù”i¡ics
(
pMa¡”
)&
SQLITE_IOCAP_SEQUENTIAL
)

65305 && 
SQLITE_OK
!=(
rc
 = 
sql™e3OsSync
(
pMa¡”
, 
SQLITE_SYNC_NORMAL
))

65307 
sql™e3OsClo£F»e
(
pMa¡”
);

65308 
sql™e3OsD–‘e
(
pVfs
, 
zMa¡”
, 0);

65309 
sql™e3DbF»e
(
db
, 
zMa¡”
);

65310  
	grc
;

65323 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nDb
; i++){

65324 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65325 ifÐ
	gpBt
 ){

65326 
	grc
 = 
sql™e3BŒ“Comm™Pha£OÃ
(
pBt
, 
zMa¡”
);

65329 
sql™e3OsClo£F»e
(
pMa¡”
);

65330 
as£¹
Ð
rc
!=
SQLITE_BUSY
 );

65331 ifÐ
	grc
!=
SQLITE_OK
 ){

65332 
sql™e3DbF»e
(
db
, 
zMa¡”
);

65333  
	grc
;

65340 
	grc
 = 
sql™e3OsD–‘e
(
pVfs
, 
zMa¡”
, 1);

65341 
sql™e3DbF»e
(
db
, 
zMa¡”
);

65342 
	gzMa¡”
 = 0;

65343 ifÐ
	grc
 ){

65344  
	grc
;

65354 
di§bË_simuÏ‹d_io_”rÜs
();

65355 
sql™e3BegšB’ignM®loc
();

65356 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

65357 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65358 ifÐ
	gpBt
 ){

65359 
sql™e3BŒ“Comm™Pha£Two
(
pBt
, 1);

65362 
sql™e3EndB’ignM®loc
();

65363 
’abË_simuÏ‹d_io_”rÜs
();

65365 
sql™e3VbComm™
(
db
);

65369  
	grc
;

65381 #iâdeà
NDEBUG


65382 
checkAùiveVdbeCÁ
(
sql™e3
 *
db
){

65383 
Vdbe
 *
	gp
;

65384 
	gút
 = 0;

65385 
	gnWr™e
 = 0;

65386 
	gnR—d
 = 0;

65387 
	gp
 = 
db
->
pVdbe
;

65388  
	gp
 ){

65389 ifÐ
sql™e3_¡mt_busy
((
sql™e3_¡mt
*)
p
) ){

65390 
	gút
++;

65391 ifÐ
	gp
->
	g»adOÆy
==0 ) 
nWr™e
++;

65392 ifÐ
	gp
->
	gbIsR—d”
 ) 
	gnR—d
++;

65394 
	gp
 = 
p
->
pNext
;

65396 
as£¹
Ð
út
==
db
->
nVdbeAùive
 );

65397 
as£¹
Ð
nWr™e
==
db
->
nVdbeWr™e
 );

65398 
as£¹
Ð
nR—d
==
db
->
nVdbeR—d
 );

65401 
	#checkAùiveVdbeCÁ
(
x
)

	)

65414 
SQLITE_PRIVATE
 
sql™e3VdbeClo£S‹m’t
(
Vdbe
 *
p
, 
eOp
){

65415 
sql™e3
 *cÚ¡ 
	gdb
 = 
p
->
db
;

65416 
	grc
 = 
SQLITE_OK
;

65423 ifÐ
	gdb
->
	gnS‹m’t
 && 
	gp
->
	giS‹m’t
 ){

65424 
	gi
;

65425 cÚ¡ 
	giSav•ošt
 = 
p
->
iS‹m’t
-1;

65427 
as£¹
Ð
eOp
==
SAVEPOINT_ROLLBACK
 ||ƒOp==
SAVEPOINT_RELEASE
);

65428 
as£¹
Ð
db
->
nS‹m’t
>0 );

65429 
as£¹
Ð
p
->
iS‹m’t
==(
db
->
nS‹m’t
+db->
nSav•ošt
) );

65431 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

65432 
	grc2
 = 
SQLITE_OK
;

65433 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

65434 ifÐ
	gpBt
 ){

65435 ifÐ
	geOp
==
SAVEPOINT_ROLLBACK
 ){

65436 
rc2
 = 
sql™e3BŒ“Sav•ošt
(
pBt
, 
SAVEPOINT_ROLLBACK
, 
iSav•ošt
);

65438 ifÐ
	grc2
==
SQLITE_OK
 ){

65439 
rc2
 = 
sql™e3BŒ“Sav•ošt
(
pBt
, 
SAVEPOINT_RELEASE
, 
iSav•ošt
);

65441 ifÐ
	grc
==
SQLITE_OK
 ){

65442 
rc
 = 
rc2
;

65446 
	gdb
->
	gnS‹m’t
--;

65447 
	gp
->
	giS‹m’t
 = 0;

65449 ifÐ
	grc
==
SQLITE_OK
 ){

65450 ifÐ
eOp
==
SAVEPOINT_ROLLBACK
 ){

65451 
rc
 = 
sql™e3VbSav•ošt
(
db
, 
SAVEPOINT_ROLLBACK
, 
iSav•ošt
);

65453 ifÐ
	grc
==
SQLITE_OK
 ){

65454 
rc
 = 
sql™e3VbSav•ošt
(
db
, 
SAVEPOINT_RELEASE
, 
iSav•ošt
);

65461 ifÐ
	geOp
==
SAVEPOINT_ROLLBACK
 ){

65462 
db
->
nDeã¼edCÚs
 = 
p
->
nStmtDefCÚs
;

65463 
	gdb
->
	gnDeã¼edImmCÚs
 = 
p
->
nStmtDefImmCÚs
;

65466  
	grc
;

65479 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


65480 
SQLITE_PRIVATE
 
sql™e3VdbeCheckFk
(
Vdbe
 *
p
, 
deã¼ed
){

65481 
sql™e3
 *
	gdb
 = 
p
->
db
;

65482 ifÐ(
	gdeã¼ed
 && (
	gdb
->
	gnDeã¼edCÚs
+db->
	gnDeã¼edImmCÚs
)>0)

65483 || (!
	gdeã¼ed
 && 
	gp
->
	gnFkCÚ¡¿št
>0)

65485 
	gp
->
	grc
 = 
SQLITE_CONSTRAINT_FOREIGNKEY
;

65486 
	gp
->
	g”rÜAùiÚ
 = 
OE_AbÜt
;

65487 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "FOREIGN KEY constraint failed");

65488  
	gSQLITE_ERROR
;

65490  
	gSQLITE_OK
;

65507 
SQLITE_PRIVATE
 
sql™e3VdbeH®t
(
Vdbe
 *
p
){

65508 
	grc
;

65509 
sql™e3
 *
	gdb
 = 
p
->
db
;

65527 ifÐ
	gp
->
	gdb
->
	gm®locFažed
 ){

65528 
	gp
->
	grc
 = 
SQLITE_NOMEM
;

65530 ifÐ
	gp
->
	gaOnûFÏg
 ) 
mem£t
(
p
->
aOnûFÏg
, 0,…->
nOnûFÏg
);

65531 
þo£AÎCursÜs
(
p
);

65532 ifÐ
	gp
->
	gmagic
!=
VDBE_MAGIC_RUN
 ){

65533  
SQLITE_OK
;

65535 
checkAùiveVdbeCÁ
(
db
);

65539 ifÐ
	gp
->
	gpc
>=0 && 
p
->
bIsR—d”
 ){

65540 
mrc
;

65541 
	geS‹m’tOp
 = 0;

65542 
	gisS³cŸlE¼Ü
;

65545 
sql™e3VdbeEÁ”
(
p
);

65548 
	gmrc
 = 
p
->
rc
 & 0xff;

65549 
	gisS³cŸlE¼Ü
 = 
mrc
==
SQLITE_NOMEM
 || mrc==
SQLITE_IOERR


65550 || 
mrc
==
SQLITE_INTERRUPT
 || mrc==
SQLITE_FULL
;

65551 ifÐ
	gisS³cŸlE¼Ü
 ){

65564 ifÐ!
	gp
->
	g»adOÆy
 || 
	gmrc
!=
SQLITE_INTERRUPT
 ){

65565 ifÐ(
mrc
==
SQLITE_NOMEM
 || mrc==
SQLITE_FULL
è&& 
p
->
u£sStmtJouº®
 ){

65566 
eS‹m’tOp
 = 
SAVEPOINT_ROLLBACK
;

65571 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_ABORT_ROLLBACK
);

65572 
sql™e3Clo£Sav•ošts
(
db
);

65573 
	gdb
->
	gautoComm™
 = 1;

65579 ifÐ
	gp
->
	grc
==
SQLITE_OK
 ){

65580 
sql™e3VdbeCheckFk
(
p
, 0);

65589 ifÐ!
sql™e3VbInSync
(
db
)

65590 && 
	gdb
->
	gautoComm™


65591 && 
	gdb
->
	gnVdbeWr™e
==(
p
->
»adOÆy
==0)

65593 ifÐ
p
->
rc
==
SQLITE_OK
 || (p->
”rÜAùiÚ
==
OE_Faž
 && !
isS³cŸlE¼Ü
) ){

65594 
rc
 = 
sql™e3VdbeCheckFk
(
p
, 1);

65595 ifÐ
	grc
!=
SQLITE_OK
 ){

65596 ifÐ
NEVER
(
p
->
»adOÆy
) ){

65597 
sql™e3VdbeL—ve
(
p
);

65598  
	gSQLITE_ERROR
;

65600 
	grc
 = 
SQLITE_CONSTRAINT_FOREIGNKEY
;

65606 
	grc
 = 
vdbeComm™
(
db
, 
p
);

65608 ifÐ
	grc
==
SQLITE_BUSY
 && 
p
->
»adOÆy
 ){

65609 
sql™e3VdbeL—ve
(
p
);

65610  
	gSQLITE_BUSY
;

65611 }ifÐ
	grc
!=
SQLITE_OK
 ){

65612 
p
->
rc
 =„c;

65613 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_OK
);

65615 
	gdb
->
	gnDeã¼edCÚs
 = 0;

65616 
	gdb
->
	gnDeã¼edImmCÚs
 = 0;

65617 
	gdb
->
	gæags
 &ð~
SQLITE_DeãrFKs
;

65618 
sql™e3Comm™IÁ”ÇlChªges
(
db
);

65621 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_OK
);

65623 
	gdb
->
	gnS‹m’t
 = 0;

65624 }ifÐ
	geS‹m’tOp
==0 ){

65625 ifÐ
p
->
rc
==
SQLITE_OK
 ||…->
”rÜAùiÚ
==
OE_Faž
 ){

65626 
eS‹m’tOp
 = 
SAVEPOINT_RELEASE
;

65627 }ifÐ
	gp
->
	g”rÜAùiÚ
==
OE_AbÜt
 ){

65628 
eS‹m’tOp
 = 
SAVEPOINT_ROLLBACK
;

65630 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_ABORT_ROLLBACK
);

65631 
sql™e3Clo£Sav•ošts
(
db
);

65632 
	gdb
->
	gautoComm™
 = 1;

65642 ifÐ
	geS‹m’tOp
 ){

65643 
	grc
 = 
sql™e3VdbeClo£S‹m’t
(
p
, 
eS‹m’tOp
);

65644 ifÐ
	grc
 ){

65645 ifÐ
	gp
->
	grc
==
SQLITE_OK
 || (
p
->
rc
&0xff)==
SQLITE_CONSTRAINT
 ){

65646 
p
->
rc
 =„c;

65647 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

65648 
	gp
->
	gzE¼Msg
 = 0;

65650 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_ABORT_ROLLBACK
);

65651 
sql™e3Clo£Sav•ošts
(
db
);

65652 
	gdb
->
	gautoComm™
 = 1;

65659 ifÐ
	gp
->
	gchªgeCÁOn
 ){

65660 ifÐ
	geS‹m’tOp
!=
SAVEPOINT_ROLLBACK
 ){

65661 
sql™e3VdbeS‘Chªges
(
db
, 
p
->
nChªge
);

65663 
sql™e3VdbeS‘Chªges
(
db
, 0);

65665 
	gp
->
	gnChªge
 = 0;

65669 
sql™e3VdbeL—ve
(
p
);

65673 ifÐ
	gp
->
	gpc
>=0 ){

65674 
db
->
nVdbeAùive
--;

65675 ifÐ!
	gp
->
	g»adOÆy
 ) 
	gdb
->
	gnVdbeWr™e
--;

65676 ifÐ
	gp
->
	gbIsR—d”
 ) 
	gdb
->
	gnVdbeR—d
--;

65677 
as£¹
Ð
db
->
nVdbeAùive
>=db->
nVdbeR—d
 );

65678 
as£¹
Ð
db
->
nVdbeR—d
>=db->
nVdbeWr™e
 );

65679 
as£¹
Ð
db
->
nVdbeWr™e
>=0 );

65681 
	gp
->
	gmagic
 = 
VDBE_MAGIC_HALT
;

65682 
checkAùiveVdbeCÁ
(
db
);

65683 ifÐ
	gp
->
	gdb
->
	gm®locFažed
 ){

65684 
	gp
->
	grc
 = 
SQLITE_NOMEM
;

65691 ifÐ
	gdb
->
	gautoComm™
 ){

65692 
sql™e3CÚÃùiÚUÆocked
(
db
);

65695 
as£¹
Ð
db
->
nVdbeAùive
>0 || db->
autoComm™
==0 || db->
nS‹m’t
==0 );

65696  (
	gp
->
	grc
==
SQLITE_BUSY
 ? SQLITE_BUSY : 
SQLITE_OK
);

65704 
SQLITE_PRIVATE
 
sql™e3VdbeRe£tS‹pResuÉ
(
Vdbe
 *
p
){

65705 
	gp
->
	grc
 = 
SQLITE_OK
;

65716 
SQLITE_PRIVATE
 
sql™e3VdbeT¿nsãrE¼Ü
(
Vdbe
 *
p
){

65717 
sql™e3
 *
	gdb
 = 
p
->
db
;

65718 
	grc
 = 
p
->
rc
;

65719 ifÐ
	gp
->
	gzE¼Msg
 ){

65720 
u8
 
	gm®locFažed
 = 
db
->
m®locFažed
;

65721 
sql™e3BegšB’ignM®loc
();

65722 ifÐ
	gdb
->
	gpE¼
==0 ) 
db
->
pE¼
 = 
sql™e3V®ueNew
(db);

65723 
sql™e3V®ueS‘SŒ
(
db
->
pE¼
, -1, 
p
->
zE¼Msg
, 
SQLITE_UTF8
, 
SQLITE_TRANSIENT
);

65724 
sql™e3EndB’ignM®loc
();

65725 
	gdb
->
	gm®locFažed
 = 
m®locFažed
;

65726 
	gdb
->
	g”rCode
 = 
rc
;

65728 
sql™e3E¼Ü
(
db
, 
rc
);

65730  
	grc
;

65733 #ifdeà
SQLITE_ENABLE_SQLLOG


65738 
vdbeInvokeSqÎog
(
Vdbe
 *
v
){

65739 ifÐ
	gsql™e3Glob®CÚfig
.
	gxSqÎog
 && 
	gv
->
	grc
==
SQLITE_OK
 && 
v
->
zSql
 && v->
pc
>=0 ){

65740 *
zEx·nded
 = 
sql™e3VdbeEx·ndSql
(
v
, v->
zSql
);

65741 
as£¹
Ð
v
->
db
->
š™
.
busy
==0 );

65742 ifÐ
	gzEx·nded
 ){

65743 
	gsql™e3Glob®CÚfig
.
xSqÎog
(

65744 
sql™e3Glob®CÚfig
.
pSqÎogArg
, 
v
->
db
, 
zEx·nded
, 1

65746 
sql™e3DbF»e
(
v
->
db
, 
zEx·nded
);

65751 
	#vdbeInvokeSqÎog
(
x
)

	)

65765 
SQLITE_PRIVATE
 
sql™e3VdbeRe£t
(
Vdbe
 *
p
){

65766 
sql™e3
 *
	gdb
;

65767 
	gdb
 = 
p
->
db
;

65773 
sql™e3VdbeH®t
(
p
);

65780 ifÐ
	gp
->
	gpc
>=0 ){

65781 
vdbeInvokeSqÎog
(
p
);

65782 
sql™e3VdbeT¿nsãrE¼Ü
(
p
);

65783 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

65784 
	gp
->
	gzE¼Msg
 = 0;

65785 ifÐ
	gp
->
	grunOÆyOnû
 )…->
	gexpœed
 = 1;

65786 }ifÐ
	gp
->
	grc
 &&…->
	gexpœed
 ){

65791 
sql™e3E¼ÜW™hMsg
(
db
, 
p
->
rc
,…->
zE¼Msg
 ? "%s" : 0,…->zErrMsg);

65792 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

65793 
	gp
->
	gzE¼Msg
 = 0;

65798 
CËªup
(
p
);

65802 #ifdeà
VDBE_PROFILE


65804 
FILE
 *
	gout
 = 
fÝ’
("vdbe_profile.out", "a");

65805 ifÐ
	gout
 ){

65806 
	gi
;

65807 
årštf
(
out
, "---- ");

65808 
	gi
=0; i<
	gp
->
	gnOp
; i++){

65809 
årštf
(
out
, "%02x", 
p
->
aOp
[
i
].
Ýcode
);

65811 
årštf
(
out
, "\n");

65812 ifÐ
	gp
->
	gzSql
 ){

65813 
	gc
, 
	gpc
 = 0;

65814 
årštf
(
out
, "-- ");

65815 
	gi
=0; (
	gc
 = 
p
->
zSql
[
i
])!=0; i++){

65816 ifÐ
	gpc
=='\n' ) 
årštf
(
out
, "-- ");

65817 
putc
(
c
, 
out
);

65818 
	gpc
 = 
c
;

65820 ifÐ
	gpc
!='\n' ) 
årštf
(
out
, "\n");

65822 
	gi
=0; i<
	gp
->
	gnOp
; i++){

65823 
	gzHdr
[100];

65824 
sql™e3_¢´štf
((
zHdr
), zHdr, "%6u %12llu %8llu ",

65825 
p
->
aOp
[
i
].
út
,

65826 
p
->
aOp
[
i
].
cyþes
,

65827 
p
->
aOp
[
i
].
út
>0 ?…->aOp[i].
cyþes
/p->aOp[i].cnt : 0

65829 
årštf
(
out
, "%s", 
zHdr
);

65830 
sql™e3VdbePrštOp
(
out
, 
i
, &
p
->
aOp
[i]);

65832 
fþo£
(
out
);

65836 
	gp
->
	giCu¼’tTime
 = 0;

65837 
	gp
->
	gmagic
 = 
VDBE_MAGIC_INIT
;

65838  
	gp
->
	grc
 & 
	gdb
->
	g”rMask
;

65845 
SQLITE_PRIVATE
 
sql™e3VdbeFš®ize
(
Vdbe
 *
p
){

65846 
	grc
 = 
SQLITE_OK
;

65847 ifÐ
	gp
->
	gmagic
==
VDBE_MAGIC_RUN
 || 
p
->
magic
==
VDBE_MAGIC_HALT
 ){

65848 
rc
 = 
sql™e3VdbeRe£t
(
p
);

65849 
as£¹
Ð(
rc
 & 
p
->
db
->
”rMask
)==rc );

65851 
sql™e3VdbeD–‘e
(
p
);

65852  
	grc
;

65871 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘eAuxD©a
(
Vdbe
 *
pVdbe
, 
iOp
, 
mask
){

65872 
AuxD©a
 **
	gµ
 = &
pVdbe
->
pAuxD©a
;

65873  *
	gµ
 ){

65874 
AuxD©a
 *
	gpAux
 = *
µ
;

65875 ifÐ(
	giOp
<0)

65876 || (
	gpAux
->
	giOp
==
iOp
 && (
pAux
->
iArg
>31 || !(
mask
 & 
MASKBIT32
(pAux->iArg))))

65878 
‹¡ÿ£
Ð
pAux
->
iArg
==31 );

65879 ifÐ
	gpAux
->
	gxD–‘e
 ){

65880 
	gpAux
->
xD–‘e
(
pAux
->pAux);

65882 *
	gµ
 = 
pAux
->
pNext
;

65883 
sql™e3DbF»e
(
pVdbe
->
db
, 
pAux
);

65885 
	gµ
ð&
pAux
->
pNext
;

65898 
SQLITE_PRIVATE
 
sql™e3VdbeCË¬Objeù
(
sql™e3
 *
db
, 
Vdbe
 *
p
){

65899 
SubProg¿m
 *
	gpSub
, *
	gpNext
;

65900 
	gi
;

65901 
as£¹
Ð
p
->
db
==0 ||…->db==db );

65902 
»Ëa£MemA¼ay
(
p
->
aV¬
,…->
nV¬
);

65903 
»Ëa£MemA¼ay
(
p
->
aCÞName
,…->
nResCÞumn
*
COLNAME_N
);

65904 
	gpSub
=
p
->
pProg¿m
;…Sub;…Sub=
pNext
){

65905 
pNext
 = 
pSub
->pNext;

65906 
vdbeF»eOpA¼ay
(
db
, 
pSub
->
aOp
,…Sub->
nOp
);

65907 
sql™e3DbF»e
(
db
, 
pSub
);

65909 
	gi
=
p
->
nzV¬
-1; i>=0; i--è
sql™e3DbF»e
(
db
,…->
azV¬
[
i
]);

65910 
vdbeF»eOpA¼ay
(
db
, 
p
->
aOp
,…->
nOp
);

65911 
sql™e3DbF»e
(
db
, 
p
->
aCÞName
);

65912 
sql™e3DbF»e
(
db
, 
p
->
zSql
);

65913 
sql™e3DbF»e
(
db
, 
p
->
pF»e
);

65919 
SQLITE_PRIVATE
 
sql™e3VdbeD–‘e
(
Vdbe
 *
p
){

65920 
sql™e3
 *
	gdb
;

65922 ifÐ
NEVER
(
p
==0) ) ;

65923 
	gdb
 = 
p
->
db
;

65924 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

65925 
sql™e3VdbeCË¬Objeù
(
db
, 
p
);

65926 ifÐ
	gp
->
	gpP»v
 ){

65927 
	gp
->
	gpP»v
->
	gpNext
 = 
p
->
pNext
;

65929 
as£¹
Ð
db
->
pVdbe
==
p
 );

65930 
	gdb
->
	gpVdbe
 = 
p
->
pNext
;

65932 ifÐ
	gp
->
	gpNext
 ){

65933 
	gp
->
	gpNext
->
	gpP»v
 = 
p
->
pP»v
;

65935 
	gp
->
	gmagic
 = 
VDBE_MAGIC_DEAD
;

65936 
	gp
->
	gdb
 = 0;

65937 
sql™e3DbF»e
(
db
, 
p
);

65945 
SQLITE_NOINLINE
 
hªdËDeã¼edMov‘o
(
VdbeCursÜ
 *
p
){

65946 
	g»s
, 
	grc
;

65947 #ifdeà
SQLITE_TEST


65948 
sql™e3_£¬ch_couÁ
;

65950 
as£¹
Ð
p
->
deã¼edMov‘o
 );

65951 
as£¹
Ð
p
->
isTabË
 );

65952 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
p
->
pCursÜ
, 0,…->
mov‘oT¬g‘
, 0, &
»s
);

65953 ifÐ
	grc
 ) „c;

65954 ifÐ
	g»s
!=0 )  
SQLITE_CORRUPT_BKPT
;

65955 #ifdeà
SQLITE_TEST


65956 
	gsql™e3_£¬ch_couÁ
++;

65958 
	gp
->
	gdeã¼edMov‘o
 = 0;

65959 
	gp
->
	gÿcheStus
 = 
CACHE_STALE
;

65960  
	gSQLITE_OK
;

65970 
SQLITE_NOINLINE
 
hªdËMovedCursÜ
(
VdbeCursÜ
 *
p
){

65971 
	gisDifã»ÁRow
, 
	grc
;

65972 
as£¹
Ð
p
->
pCursÜ
!=0 );

65973 
as£¹
Ð
sql™e3BŒ“CursÜHasMoved
(
p
->
pCursÜ
) );

65974 
	grc
 = 
sql™e3BŒ“CursÜRe¡Üe
(
p
->
pCursÜ
, &
isDifã»ÁRow
);

65975 
	gp
->
	gÿcheStus
 = 
CACHE_STALE
;

65976 ifÐ
	gisDifã»ÁRow
 ) 
	gp
->
	gnuÎRow
 = 1;

65977  
	grc
;

65984 
SQLITE_PRIVATE
 
sql™e3VdbeCursÜRe¡Üe
(
VdbeCursÜ
 *
p
){

65985 ifÐ
sql™e3BŒ“CursÜHasMoved
(
p
->
pCursÜ
) ){

65986  
hªdËMovedCursÜ
(
p
);

65988  
	gSQLITE_OK
;

66004 
SQLITE_PRIVATE
 
sql™e3VdbeCursÜMov‘o
(
VdbeCursÜ
 *
p
){

66005 ifÐ
	gp
->
	gdeã¼edMov‘o
 ){

66006  
hªdËDeã¼edMov‘o
(
p
);

66008 ifÐ
	gp
->
	gpCursÜ
 && 
sql™e3BŒ“CursÜHasMoved
(
p
->
pCursÜ
) ){

66009  
hªdËMovedCursÜ
(
p
);

66011  
	gSQLITE_OK
;

66059 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlTy³
(
Mem
 *
pMem
, 
fže_fÜm©
){

66060 
	gæags
 = 
pMem
->
æags
;

66061 
u32
 
	gn
;

66063 ifÐ
	gæags
&
	gMEM_NuÎ
 ){

66066 ifÐ
	gæags
&
	gMEM_IÁ
 ){

66068 
	#MAX_6BYTE
 ((((
i64
)0x00008000)<<32)-1)

	)

66069 
i64
 
	gi
 = 
pMem
->
u
.
i
;

66070 
u64
 
	gu
;

66071 ifÐ
	gi
<0 ){

66072 ifÐ
	gi
<(-
	gMAX_6BYTE
) )  6;

66074 
	gu
 = -
i
;

66076 
	gu
 = 
i
;

66078 ifÐ
	gu
<=127 ){

66079  ((
i
&1)==˜&& 
fže_fÜm©
>=4è? 8+(
u32
)
u
 : 1;

66081 ifÐ
	gu
<=32767 )  2;

66082 ifÐ
	gu
<=8388607 )  3;

66083 ifÐ
	gu
<=2147483647 )  4;

66084 ifÐ
	gu
<=
MAX_6BYTE
 )  5;

66087 ifÐ
	gæags
&
	gMEM_R—l
 ){

66090 
as£¹
Ð
pMem
->
db
->
m®locFažed
 || 
æags
&(
MEM_SŒ
|
MEM_Blob
) );

66091 
as£¹
Ð
pMem
->
n
>=0 );

66092 
	gn
 = (
u32
)
pMem
->
n
;

66093 ifÐ
	gæags
 & 
	gMEM_Z”o
 ){

66094 
	gn
 +ð
pMem
->
u
.
nZ”o
;

66096  ((
	gn
*2è+ 12 + ((
	gæags
&
	gMEM_SŒ
)!=0));

66102 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlTy³L’
(u32 
£rŸl_ty³
){

66103 ifÐ
	g£rŸl_ty³
>=12 ){

66104  (
£rŸl_ty³
-12)/2;

66106 cÚ¡ 
u8
 
	gaSize
[] = { 0, 1, 2, 3, 4, 6, 8, 8, 0, 0, 0, 0 };

66107  
	gaSize
[
£rŸl_ty³
];

66145 #ifdeà
SQLITE_MIXED_ENDIAN_64BIT_FLOAT


66146 
u64
 
æßtSw­
(u64 
š
){

66148 
u64
 
	gr
;

66149 
u32
 
	gi
[2];

66150 } 
	gu
;

66151 
u32
 
	gt
;

66153 
	gu
.
	gr
 = 
š
;

66154 
	gt
 = 
u
.
i
[0];

66155 
	gu
.
	gi
[0] = 
u
.
i
[1];

66156 
	gu
.
	gi
[1] = 
t
;

66157  
	gu
.
	gr
;

66159 
	#sw­MixedEndŸnFlßt
(
X
èX = 
	`æßtSw­
(X)

	)

66161 
	#sw­MixedEndŸnFlßt
(
X
)

	)

66177 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlPut
(
u8
 *
buf
, 
Mem
 *
pMem
, u32 
£rŸl_ty³
){

66178 
u32
 
	gËn
;

66181 ifÐ
	g£rŸl_ty³
<=7 && 
£rŸl_ty³
>0 ){

66182 
u64
 
v
;

66183 
u32
 
	gi
;

66184 ifÐ
	g£rŸl_ty³
==7 ){

66185 
as£¹
Ð(
v
)==(
pMem
->
u
.
r
) );

66186 
memýy
(&
v
, &
pMem
->
u
.
r
, (v));

66187 
sw­MixedEndŸnFlßt
(
v
);

66189 
	gv
 = 
pMem
->
u
.
i
;

66191 
	gËn
 = 
i
 = 
sql™e3VdbeS”ŸlTy³L’
(
£rŸl_ty³
);

66192 
as£¹
Ð
i
>0 );

66194 
	gbuf
[--
i
] = (
u8
)(
v
&0xFF);

66195 
	gv
 >>= 8;

66196 } 
	gi
 );

66197  
	gËn
;

66201 ifÐ
	g£rŸl_ty³
>=12 ){

66202 
as£¹
Ð
pMem
->
n
 + (ÕMem->
æags
 & 
MEM_Z”o
)?pMem->
u
.
nZ”o
:0)

66203 =ð()
sql™e3VdbeS”ŸlTy³L’
(
£rŸl_ty³
) );

66204 
	gËn
 = 
pMem
->
n
;

66205 
memýy
(
buf
, 
pMem
->
z
, 
Ën
);

66206  
	gËn
;

66216 
	#ONE_BYTE_INT
(
x
è((
i8
)(x)[0])

	)

66217 
	#TWO_BYTE_INT
(
x
è(256*(
i8
)((x)[0])|(x)[1])

	)

66218 
	#THREE_BYTE_INT
(
x
è(65536*(
i8
)((x)[0])|((x)[1]<<8)|(x)[2])

	)

66219 
	#FOUR_BYTE_UINT
(
x
è(((
u32
)(x)[0]<<24)|((x)[1]<<16)|((x)[2]<<8)|(x)[3])

	)

66220 
	#FOUR_BYTE_INT
(
x
è(16777216*(
i8
)((x)[0])|((x)[1]<<16)|((x)[2]<<8)|(x)[3])

	)

66231 
u32
 
SQLITE_NOINLINE
 
£rŸlG‘
(

66232 cÚ¡ *
buf
,

66233 
u32
 
£rŸl_ty³
,

66234 
Mem
 *
pMem


66236 
u64
 
	gx
 = 
FOUR_BYTE_UINT
(
buf
);

66237 
u32
 
	gy
 = 
FOUR_BYTE_UINT
(
buf
+4);

66238 
	gx
 = (
x
<<32è+ 
y
;

66239 ifÐ
	g£rŸl_ty³
==6 ){

66240 
pMem
->
u
.
i
 = *(
i64
*)&
x
;

66241 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66242 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66244 #ià!
defšed
(
NDEBUG
è&& !defšed(
SQLITE_OMIT_FLOATING_POINT
)

66250 cÚ¡ 
u64
 
	gt1
 = ((u64)0x3ff00000)<<32;

66251 cÚ¡ 
	gr1
 = 1.0;

66252 
u64
 
	gt2
 = 
t1
;

66253 
sw­MixedEndŸnFlßt
(
t2
);

66254 
as£¹
Ð(
r1
)==(
t2
è&& 
memcmp
(&r1, &t2, (r1))==0 );

66256 
as£¹
Ð(
x
)==8 && (
pMem
->
u
.
r
)==8 );

66257 
sw­MixedEndŸnFlßt
(
x
);

66258 
memýy
(&
pMem
->
u
.
r
, &
x
, (x));

66259 
	gpMem
->
	gæags
 = 
sql™e3IsNaN
(
pMem
->
u
.
r
è? 
MEM_NuÎ
 : 
MEM_R—l
;

66263 
SQLITE_PRIVATE
 
u32
 
sql™e3VdbeS”ŸlG‘
(

66264 cÚ¡ *
buf
,

66265 
u32
 
£rŸl_ty³
,

66266 
Mem
 *
pMem


66268  
	g£rŸl_ty³
 ){

66272 
pMem
->
æags
 = 
MEM_NuÎ
;

66276 
pMem
->
u
.
i
 = 
ONE_BYTE_INT
(
buf
);

66277 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66278 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66282 
pMem
->
u
.
i
 = 
TWO_BYTE_INT
(
buf
);

66283 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66284 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66288 
pMem
->
u
.
i
 = 
THREE_BYTE_INT
(
buf
);

66289 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66290 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66294 
pMem
->
u
.
i
 = 
FOUR_BYTE_INT
(
buf
);

66295 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66296 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66300 
pMem
->
u
.
i
 = 
FOUR_BYTE_UINT
(
buf
+2è+ (((
i64
)1)<<32)*
TWO_BYTE_INT
(buf);

66301 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66302 
‹¡ÿ£
Ð
pMem
->
u
.
i
<0 );

66309  
£rŸlG‘
(
buf
,
£rŸl_ty³
,
pMem
);

66313 
pMem
->
u
.
i
 = 
£rŸl_ty³
-8;

66314 
	gpMem
->
	gæags
 = 
MEM_IÁ
;

66318 cÚ¡ 
u16
 
aFÏg
[] = { 
MEM_Blob
|
MEM_Ephem
, 
MEM_SŒ
|MEM_Ephem };

66319 
	gpMem
->
	gz
 = (*)
buf
;

66320 
	gpMem
->
	gn
 = (
£rŸl_ty³
-12)/2;

66321 
	gpMem
->
	gæags
 = 
aFÏg
[
£rŸl_ty³
&1];

66322  
	gpMem
->
	gn
;

66341 
SQLITE_PRIVATE
 
UÅackedRecÜd
 *
sql™e3VdbeAÎocUÅackedRecÜd
(

66342 
KeyInfo
 *
pKeyInfo
,

66343 *
pS·û
,

66344 
szS·û
,

66345 **
µF»e


66347 
UÅackedRecÜd
 *
	gp
;

66348 
	gnOff
;

66349 
	gnBy‹
;

66355 
	gnOff
 = (8 - (
SQLITE_PTR_TO_INT
(
pS·û
) & 7)) & 7;

66356 
	gnBy‹
 = 
ROUND8
((
UÅackedRecÜd
)è+ (
Mem
)*(
pKeyInfo
->
nF›ld
+1);

66357 ifÐ
	gnBy‹
>
	gszS·û
+
	gnOff
 ){

66358 
	gp
 = (
UÅackedRecÜd
 *)
sql™e3DbM®locRaw
(
pKeyInfo
->
db
, 
nBy‹
);

66359 *
	gµF»e
 = (*)
p
;

66360 ifÐ!
	gp
 )  0;

66362 
	gp
 = (
UÅackedRecÜd
*)&
pS·û
[
nOff
];

66363 *
	gµF»e
 = 0;

66366 
	gp
->
	gaMem
 = (
Mem
*)&((*)
p
)[
ROUND8
((
UÅackedRecÜd
))];

66367 
as£¹
Ð
pKeyInfo
->
aSÜtOrd”
!=0 );

66368 
	gp
->
	gpKeyInfo
 = 
pKeyInfo
;

66369 
	gp
->
	gnF›ld
 = 
pKeyInfo
->
nF›ld
 + 1;

66370  
	gp
;

66378 
SQLITE_PRIVATE
 
sql™e3VdbeRecÜdUÅack
(

66379 
KeyInfo
 *
pKeyInfo
,

66380 
nKey
,

66381 cÚ¡ *
pKey
,

66382 
UÅackedRecÜd
 *
p


66384 cÚ¡ *
	gaKey
 = (cÚ¡ *)
pKey
;

66385 
	gd
;

66386 
u32
 
	gidx
;

66387 
u16
 
	gu
;

66388 
u32
 
	gszHdr
;

66389 
Mem
 *
	gpMem
 = 
p
->
aMem
;

66391 
	gp
->
	gdeçuÉ_rc
 = 0;

66392 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pMem
) );

66393 
	gidx
 = 
g‘V¬št32
(
aKey
, 
szHdr
);

66394 
	gd
 = 
szHdr
;

66395 
	gu
 = 0;

66396  
	gidx
<
	gszHdr
 && 
	gd
<=
nKey
 ){

66397 
u32
 
£rŸl_ty³
;

66399 
	gidx
 +ð
g‘V¬št32
(&
aKey
[
idx
], 
£rŸl_ty³
);

66400 
	gpMem
->
	g’c
 = 
pKeyInfo
->
’c
;

66401 
	gpMem
->
	gdb
 = 
pKeyInfo
->
db
;

66403 
	gpMem
->
	gszM®loc
 = 0;

66404 
	gd
 +ð
sql™e3VdbeS”ŸlG‘
(&
aKey
[
d
], 
£rŸl_ty³
, 
pMem
);

66405 
	gpMem
++;

66406 ifÐ(++
	gu
)>=
p
->
nF›ld
 ) ;

66408 
as£¹
Ð
u
<=
pKeyInfo
->
nF›ld
 + 1 );

66409 
	gp
->
	gnF›ld
 = 
u
;

66412 #ià
SQLITE_DEBUG


66424 
vdbeRecÜdCom·»Debug
(

66425 
nKey1
, cÚ¡ *
pKey1
,

66426 cÚ¡ 
UÅackedRecÜd
 *
pPKey2
,

66427 
desœedResuÉ


66429 
u32
 
	gd1
;

66430 
u32
 
	gidx1
;

66431 
u32
 
	gszHdr1
;

66432 
	gi
 = 0;

66433 
	grc
 = 0;

66434 cÚ¡ *
	gaKey1
 = (cÚ¡ *)
pKey1
;

66435 
KeyInfo
 *
	gpKeyInfo
;

66436 
Mem
 
	gmem1
;

66438 
	gpKeyInfo
 = 
pPKey2
->
pKeyInfo
;

66439 ifÐ
	gpKeyInfo
->
	gdb
==0 )  1;

66440 
	gmem1
.
	g’c
 = 
pKeyInfo
->
’c
;

66441 
	gmem1
.
	gdb
 = 
pKeyInfo
->
db
;

66443 
VVA_ONLY
Ð
mem1
.
szM®loc
 = 0; )

66454 
	gidx1
 = 
g‘V¬št32
(
aKey1
, 
szHdr1
);

66455 
	gd1
 = 
szHdr1
;

66456 
as£¹
Ð
pKeyInfo
->
nF›ld
+pKeyInfo->
nXF›ld
>=
pPKey2
->nF›ld || 
CORRUPT_DB
 );

66457 
as£¹
Ð
pKeyInfo
->
aSÜtOrd”
!=0 );

66458 
as£¹
Ð
pKeyInfo
->
nF›ld
>0 );

66459 
as£¹
Ð
idx1
<=
szHdr1
 || 
CORRUPT_DB
 );

66461 
u32
 
	g£rŸl_ty³1
;

66464 
	gidx1
 +ð
g‘V¬št32
Ð
aKey1
+
idx1
, 
£rŸl_ty³1
 );

66472 ifÐ
	gd1
+
	g£rŸl_ty³1
+2>(
	gu32
)
	gnKey1


66473 && 
	gd1
+
sql™e3VdbeS”ŸlTy³L’
(
£rŸl_ty³1
)>(
	gu32
)
	gnKey1


66480 
	gd1
 +ð
sql™e3VdbeS”ŸlG‘
(&
aKey1
[
d1
], 
£rŸl_ty³1
, &
mem1
);

66484 
	grc
 = 
sql™e3MemCom·»
(&
mem1
, &
pPKey2
->
aMem
[
i
], 
pKeyInfo
->
aCÞl
[i]);

66485 ifÐ
	grc
!=0 ){

66486 
as£¹
Ð
mem1
.
szM®loc
==0 );

66487 ifÐ
	gpKeyInfo
->
	gaSÜtOrd”
[
i
] ){

66488 
	grc
 = -
rc
;

66490 
	gdebugCom·»End
;

66492 
	gi
++;

66493 } 
	gidx1
<
	gszHdr1
 && 
	gi
<
	gpPKey2
->
	gnF›ld
 );

66499 
as£¹
Ð
mem1
.
szM®loc
==0 );

66504 
	grc
 = 
pPKey2
->
deçuÉ_rc
;

66506 
	gdebugCom·»End
:

66507 ifÐ
desœedResuÉ
==0 && 
rc
==0 )  1;

66508 ifÐ
	gdesœedResuÉ
<0 && 
	grc
<0 )  1;

66509 ifÐ
	gdesœedResuÉ
>0 && 
	grc
>0 )  1;

66510 ifÐ
	gCORRUPT_DB
 )  1;

66511 ifÐ
	gpKeyInfo
->
	gdb
->
	gm®locFažed
 )  1;

66522 
vdbeCom·»MemSŒšg
(

66523 cÚ¡ 
Mem
 *
pMem1
,

66524 cÚ¡ 
Mem
 *
pMem2
,

66525 cÚ¡ 
CÞlSeq
 *
pCÞl
,

66526 
u8
 *
´cE¼


66528 ifÐ
	gpMem1
->
	g’c
==
pCÞl
->
’c
 ){

66531  
pCÞl
->
xCmp
ÕCÞl->
pU£r
,
pMem1
->
n
,pMem1->
z
,
pMem2
->n,pMem2->z);

66533 
	grc
;

66534 cÚ¡ *
	gv1
, *
	gv2
;

66535 
	gn1
, 
	gn2
;

66536 
Mem
 
	gc1
;

66537 
Mem
 
	gc2
;

66538 
sql™e3VdbeMemIn™
(&
c1
, 
pMem1
->
db
, 
MEM_NuÎ
);

66539 
sql™e3VdbeMemIn™
(&
c2
, 
pMem1
->
db
, 
MEM_NuÎ
);

66540 
sql™e3VdbeMemSh®lowCÝy
(&
c1
, 
pMem1
, 
MEM_Ephem
);

66541 
sql™e3VdbeMemSh®lowCÝy
(&
c2
, 
pMem2
, 
MEM_Ephem
);

66542 
	gv1
 = 
sql™e3V®ueText
((
sql™e3_v®ue
*)&
c1
, 
pCÞl
->
’c
);

66543 
	gn1
 = 
v1
==0 ? 0 : 
c1
.
n
;

66544 
	gv2
 = 
sql™e3V®ueText
((
sql™e3_v®ue
*)&
c2
, 
pCÞl
->
’c
);

66545 
	gn2
 = 
v2
==0 ? 0 : 
c2
.
n
;

66546 
	grc
 = 
pCÞl
->
xCmp
ÕCÞl->
pU£r
, 
n1
, 
v1
, 
n2
, 
v2
);

66547 
sql™e3VdbeMemR–—£
(&
c1
);

66548 
sql™e3VdbeMemR–—£
(&
c2
);

66549 ifÐ(
	gv1
==0 || 
v2
==0è&& 
´cE¼
 ) *´cE¼ = 
SQLITE_NOMEM
;

66550  
	grc
;

66559 
SQLITE_NOINLINE
 
sql™e3BlobCom·»
(cÚ¡ 
Mem
 *
pB1
, cÚ¡ Mem *
pB2
){

66560 
	gc
 = 
memcmp
(
pB1
->
z
, 
pB2
->z,…B1->
n
>pB2->n ?…B2->n :…B1->n);

66561 ifÐ
	gc
 )  c;

66562  
	gpB1
->
	gn
 - 
	gpB2
->n;

66575 
SQLITE_PRIVATE
 
sql™e3MemCom·»
(cÚ¡ 
Mem
 *
pMem1
, cÚ¡ Mem *
pMem2
, cÚ¡ 
CÞlSeq
 *
pCÞl
){

66576 
	gf1
, 
	gf2
;

66577 
	gcombšed_æags
;

66579 
	gf1
 = 
pMem1
->
æags
;

66580 
	gf2
 = 
pMem2
->
æags
;

66581 
	gcombšed_æags
 = 
f1
|
f2
;

66582 
as£¹
Ð(
combšed_æags
 & 
MEM_RowS‘
)==0 );

66587 ifÐ
	gcombšed_æags
&
	gMEM_NuÎ
 ){

66588  (
	gf2
&
	gMEM_NuÎ
è- (
	gf1
&MEM_Null);

66595 ifÐ
	gcombšed_æags
&(
	gMEM_IÁ
|
	gMEM_R—l
) ){

66596 
	gr1
, 
	gr2
;

66597 ifÐ(
	gf1
 & 
	gf2
 & 
	gMEM_IÁ
)!=0 ){

66598 ifÐ
pMem1
->
u
.
i
 < 
pMem2
->u.i )  -1;

66599 ifÐ
	gpMem1
->
	gu
.
	gi
 > 
	gpMem2
->u.i )  1;

66602 ifÐ(
	gf1
&
	gMEM_R—l
)!=0 ){

66603 
r1
 = 
pMem1
->
u
.
r
;

66604 }ifÐ(
	gf1
&
	gMEM_IÁ
)!=0 ){

66605 
r1
 = ()
pMem1
->
u
.
i
;

66609 ifÐ(
	gf2
&
	gMEM_R—l
)!=0 ){

66610 
r2
 = 
pMem2
->
u
.
r
;

66611 }ifÐ(
	gf2
&
	gMEM_IÁ
)!=0 ){

66612 
r2
 = ()
pMem2
->
u
.
i
;

66616 ifÐ
	gr1
<
	gr2
 )  -1;

66617 ifÐ
	gr1
>
	gr2
 )  1;

66624 ifÐ
	gcombšed_æags
&
	gMEM_SŒ
 ){

66625 ifÐ(
	gf1
 & 
	gMEM_SŒ
)==0 ){

66628 ifÐ(
	gf2
 & 
	gMEM_SŒ
)==0 ){

66632 
as£¹
Ð
pMem1
->
’c
==
pMem2
->enc );

66633 
as£¹
Ð
pMem1
->
’c
==
SQLITE_UTF8
 ||

66634 
pMem1
->
’c
==
SQLITE_UTF16LE
 ||…Mem1->’c==
SQLITE_UTF16BE
 );

66640 
as£¹
Ð!
pCÞl
 ||…CÞl->
xCmp
 );

66642 ifÐ
	gpCÞl
 ){

66643  
vdbeCom·»MemSŒšg
(
pMem1
, 
pMem2
, 
pCÞl
, 0);

66650  
sql™e3BlobCom·»
(
pMem1
, 
pMem2
);

66661 
i64
 
vdbeRecÜdDecodeIÁ
(
u32
 
£rŸl_ty³
, cÚ¡ 
u8
 *
aKey
){

66662 
u32
 
	gy
;

66663 
as£¹
Ð
CORRUPT_DB
 || (
£rŸl_ty³
>=1 && serial_type<=9 && serial_type!=7) );

66664  
	g£rŸl_ty³
 ){

66667 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66668  
ONE_BYTE_INT
(
aKey
);

66670 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66671  
TWO_BYTE_INT
(
aKey
);

66673 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66674  
THREE_BYTE_INT
(
aKey
);

66676 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66677 
	gy
 = 
FOUR_BYTE_UINT
(
aKey
);

66678  (
	gi64
)*(*)&
	gy
;

66681 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66682  
FOUR_BYTE_UINT
(
aKey
+2è+ (((
	gi64
)1)<<32)*
TWO_BYTE_INT
(aKey);

66685 
u64
 
x
 = 
FOUR_BYTE_UINT
(
aKey
);

66686 
‹¡ÿ£
Ð
aKey
[0]&0x80 );

66687 
	gx
 = (
x
<<32è| 
FOUR_BYTE_UINT
(
aKey
+4);

66688  (
	gi64
)*(i64*)&
	gx
;

66692  (
	g£rŸl_ty³
 - 8);

66716 
vdbeRecÜdCom·»W™hSk
(

66717 
nKey1
, cÚ¡ *
pKey1
,

66718 
UÅackedRecÜd
 *
pPKey2
,

66719 
bSk


66721 
u32
 
	gd1
;

66722 
	gi
;

66723 
u32
 
	gszHdr1
;

66724 
u32
 
	gidx1
;

66725 
	grc
 = 0;

66726 
Mem
 *
	gpRhs
 = 
pPKey2
->
aMem
;

66727 
KeyInfo
 *
	gpKeyInfo
 = 
pPKey2
->
pKeyInfo
;

66728 cÚ¡ *
	gaKey1
 = (cÚ¡ *)
pKey1
;

66729 
Mem
 
	gmem1
;

66734 ifÐ
	gbSk
 ){

66735 
u32
 
	gs1
;

66736 
	gidx1
 = 1 + 
g‘V¬št32
(&
aKey1
[1], 
s1
);

66737 
	gszHdr1
 = 
aKey1
[0];

66738 
	gd1
 = 
szHdr1
 + 
sql™e3VdbeS”ŸlTy³L’
(
s1
);

66739 
	gi
 = 1;

66740 
	gpRhs
++;

66742 
	gidx1
 = 
g‘V¬št32
(
aKey1
, 
szHdr1
);

66743 
	gd1
 = 
szHdr1
;

66744 ifÐ
	gd1
>()
	gnKey1
 ){

66745 
	gpPKey2
->
	g”rCode
 = (
u8
)
SQLITE_CORRUPT_BKPT
;

66748 
	gi
 = 0;

66751 
VVA_ONLY
Ð
mem1
.
szM®loc
 = 0; )

66752 
as£¹
Ð
pPKey2
->
pKeyInfo
->
nF›ld
+pPKey2->pKeyInfo->
nXF›ld
>=pPKey2->nField

66753 || 
CORRUPT_DB
 );

66754 
as£¹
Ð
pPKey2
->
pKeyInfo
->
aSÜtOrd”
!=0 );

66755 
as£¹
Ð
pPKey2
->
pKeyInfo
->
nF›ld
>0 );

66756 
as£¹
Ð
idx1
<=
szHdr1
 || 
CORRUPT_DB
 );

66758 
u32
 
	g£rŸl_ty³
;

66761 ifÐ
	gpRhs
->
	gæags
 & 
	gMEM_IÁ
 ){

66762 
	g£rŸl_ty³
 = 
aKey1
[
idx1
];

66763 
‹¡ÿ£
Ð
£rŸl_ty³
==12 );

66764 ifÐ
	g£rŸl_ty³
>=12 ){

66765 
rc
 = +1;

66766 }ifÐ
	g£rŸl_ty³
==0 ){

66767 
rc
 = -1;

66768 }ifÐ
	g£rŸl_ty³
==7 ){

66769 
rhs
 = ()
pRhs
->
u
.
i
;

66770 
sql™e3VdbeS”ŸlG‘
(&
aKey1
[
d1
], 
£rŸl_ty³
, &
mem1
);

66771 ifÐ
	gmem1
.
	gu
.
	gr
<
	grhs
 ){

66772 
	grc
 = -1;

66773 }ifÐ
	gmem1
.
	gu
.
	gr
>
	grhs
 ){

66774 
	grc
 = +1;

66777 
i64
 
	glhs
 = 
vdbeRecÜdDecodeIÁ
(
£rŸl_ty³
, &
aKey1
[
d1
]);

66778 
i64
 
	grhs
 = 
pRhs
->
u
.
i
;

66779 ifÐ
	glhs
<
	grhs
 ){

66780 
	grc
 = -1;

66781 }ifÐ
	glhs
>
	grhs
 ){

66782 
	grc
 = +1;

66788 ifÐ
	gpRhs
->
	gæags
 & 
	gMEM_R—l
 ){

66789 
	g£rŸl_ty³
 = 
aKey1
[
idx1
];

66790 ifÐ
	g£rŸl_ty³
>=12 ){

66791 
rc
 = +1;

66792 }ifÐ
	g£rŸl_ty³
==0 ){

66793 
rc
 = -1;

66795 
	grhs
 = 
pRhs
->
u
.
r
;

66796 
	glhs
;

66797 
sql™e3VdbeS”ŸlG‘
(&
aKey1
[
d1
], 
£rŸl_ty³
, &
mem1
);

66798 ifÐ
	g£rŸl_ty³
==7 ){

66799 
lhs
 = 
mem1
.
u
.
r
;

66801 
	glhs
 = ()
mem1
.
u
.
i
;

66803 ifÐ
	glhs
<
	grhs
 ){

66804 
	grc
 = -1;

66805 }ifÐ
	glhs
>
	grhs
 ){

66806 
	grc
 = +1;

66812 ifÐ
	gpRhs
->
	gæags
 & 
	gMEM_SŒ
 ){

66813 
g‘V¬št32
(&
aKey1
[
idx1
], 
£rŸl_ty³
);

66814 
‹¡ÿ£
Ð
£rŸl_ty³
==12 );

66815 ifÐ
	g£rŸl_ty³
<12 ){

66816 
	grc
 = -1;

66817 }ifÐ!(
	g£rŸl_ty³
 & 0x01) ){

66818 
	grc
 = +1;

66820 
	gmem1
.
	gn
 = (
£rŸl_ty³
 - 12) / 2;

66821 
‹¡ÿ£
Ð(
d1
+
mem1
.
n
)==()
nKey1
 );

66822 
‹¡ÿ£
Ð(
d1
+
mem1
.
n
+1)==()
nKey1
 );

66823 ifÐ(
	gd1
+
	gmem1
.
	gn
è> ()
	gnKey1
 ){

66824 
	gpPKey2
->
	g”rCode
 = (
u8
)
SQLITE_CORRUPT_BKPT
;

66826 }ifÐ
	gpKeyInfo
->
	gaCÞl
[
i
] ){

66827 
	gmem1
.
	g’c
 = 
pKeyInfo
->
’c
;

66828 
	gmem1
.
	gdb
 = 
pKeyInfo
->
db
;

66829 
	gmem1
.
	gæags
 = 
MEM_SŒ
;

66830 
	gmem1
.
	gz
 = (*)&
aKey1
[
d1
];

66831 
	grc
 = 
vdbeCom·»MemSŒšg
(

66832 &
mem1
, 
pRhs
, 
pKeyInfo
->
aCÞl
[
i
], &
pPKey2
->
”rCode


66835 
	gnCmp
 = 
MIN
(
mem1
.
n
, 
pRhs
->n);

66836 
	grc
 = 
memcmp
(&
aKey1
[
d1
], 
pRhs
->
z
, 
nCmp
);

66837 ifÐ
	grc
==0 ) 
rc
 = 
mem1
.
n
 - 
pRhs
->n;

66843 ifÐ
	gpRhs
->
	gæags
 & 
	gMEM_Blob
 ){

66844 
g‘V¬št32
(&
aKey1
[
idx1
], 
£rŸl_ty³
);

66845 
‹¡ÿ£
Ð
£rŸl_ty³
==12 );

66846 ifÐ
	g£rŸl_ty³
<12 || (serial_type & 0x01) ){

66847 
	grc
 = -1;

66849 
	gnSŒ
 = (
£rŸl_ty³
 - 12) / 2;

66850 
‹¡ÿ£
Ð(
d1
+
nSŒ
)==()
nKey1
 );

66851 
‹¡ÿ£
Ð(
d1
+
nSŒ
+1)==()
nKey1
 );

66852 ifÐ(
	gd1
+
	gnSŒ
è> ()
	gnKey1
 ){

66853 
	gpPKey2
->
	g”rCode
 = (
u8
)
SQLITE_CORRUPT_BKPT
;

66856 
	gnCmp
 = 
MIN
(
nSŒ
, 
pRhs
->
n
);

66857 
	grc
 = 
memcmp
(&
aKey1
[
d1
], 
pRhs
->
z
, 
nCmp
);

66858 ifÐ
	grc
==0 ) 
rc
 = 
nSŒ
 - 
pRhs
->
n
;

66865 
	g£rŸl_ty³
 = 
aKey1
[
idx1
];

66866 
	grc
 = (
£rŸl_ty³
!=0);

66869 ifÐ
	grc
!=0 ){

66870 ifÐ
pKeyInfo
->
aSÜtOrd”
[
i
] ){

66871 
rc
 = -rc;

66873 
as£¹
Ð
vdbeRecÜdCom·»Debug
(
nKey1
, 
pKey1
, 
pPKey2
, 
rc
) );

66874 
as£¹
Ð
mem1
.
szM®loc
==0 );

66875  
	grc
;

66878 
	gi
++;

66879 
	gpRhs
++;

66880 
	gd1
 +ð
sql™e3VdbeS”ŸlTy³L’
(
£rŸl_ty³
);

66881 
	gidx1
 +ð
sql™e3V¬štL’
(
£rŸl_ty³
);

66882 } 
	gidx1
<()
	gszHdr1
 && 
	gi
<
	gpPKey2
->
	gnF›ld
 && 
	gd1
<=()
nKey1
 );

66887 
as£¹
Ð
mem1
.
szM®loc
==0 );

66892 
as£¹
Ð
CORRUPT_DB


66893 || 
vdbeRecÜdCom·»Debug
(
nKey1
, 
pKey1
, 
pPKey2
,…PKey2->
deçuÉ_rc
)

66894 || 
pKeyInfo
->
db
->
m®locFažed


66896  
	gpPKey2
->
	gdeçuÉ_rc
;

66898 
SQLITE_PRIVATE
 
sql™e3VdbeRecÜdCom·»
(

66899 
nKey1
, cÚ¡ *
pKey1
,

66900 
UÅackedRecÜd
 *
pPKey2


66902  
vdbeRecÜdCom·»W™hSk
(
nKey1
, 
pKey1
, 
pPKey2
, 0);

66915 
vdbeRecÜdCom·»IÁ
(

66916 
nKey1
, cÚ¡ *
pKey1
,

66917 
UÅackedRecÜd
 *
pPKey2


66919 cÚ¡ 
u8
 *
	gaKey
 = &((cÚ¡ u8*)
pKey1
)[*(const u8*)pKey1 & 0x3F];

66920 
	g£rŸl_ty³
 = ((cÚ¡ 
u8
*)
pKey1
)[1];

66921 
	g»s
;

66922 
u32
 
	gy
;

66923 
u64
 
	gx
;

66924 
i64
 
	gv
 = 
pPKey2
->
aMem
[0].
u
.
i
;

66925 
i64
 
	glhs
;

66927 
as£¹
Ð(*(
u8
*)
pKey1
)<=0x3F || 
CORRUPT_DB
 );

66928  
	g£rŸl_ty³
 ){

66930 
lhs
 = 
ONE_BYTE_INT
(
aKey
);

66931 
‹¡ÿ£
Ð
lhs
<0 );

66935 
lhs
 = 
TWO_BYTE_INT
(
aKey
);

66936 
‹¡ÿ£
Ð
lhs
<0 );

66940 
lhs
 = 
THREE_BYTE_INT
(
aKey
);

66941 
‹¡ÿ£
Ð
lhs
<0 );

66945 
y
 = 
FOUR_BYTE_UINT
(
aKey
);

66946 
	glhs
 = (
i64
)*(*)&
y
;

66947 
‹¡ÿ£
Ð
lhs
<0 );

66951 
lhs
 = 
FOUR_BYTE_UINT
(
aKey
+2è+ (((
i64
)1)<<32)*
TWO_BYTE_INT
(aKey);

66952 
‹¡ÿ£
Ð
lhs
<0 );

66956 
x
 = 
FOUR_BYTE_UINT
(
aKey
);

66957 
	gx
 = (
x
<<32è| 
FOUR_BYTE_UINT
(
aKey
+4);

66958 
	glhs
 = *(
i64
*)&
x
;

66959 
‹¡ÿ£
Ð
lhs
<0 );

66963 
lhs
 = 0;

66966 
lhs
 = 1;

66976  
sql™e3VdbeRecÜdCom·»
(
nKey1
, 
pKey1
, 
pPKey2
);

66979  
sql™e3VdbeRecÜdCom·»
(
nKey1
, 
pKey1
, 
pPKey2
);

66982 ifÐ
	gv
>
	glhs
 ){

66983 
	g»s
 = 
pPKey2
->
r1
;

66984 }ifÐ
	gv
<
	glhs
 ){

66985 
	g»s
 = 
pPKey2
->
r2
;

66986 }ifÐ
	gpPKey2
->
	gnF›ld
>1 ){

66989 
	g»s
 = 
vdbeRecÜdCom·»W™hSk
(
nKey1
, 
pKey1
, 
pPKey2
, 1);

66993 
	g»s
 = 
pPKey2
->
deçuÉ_rc
;

66996 
as£¹
Ð
vdbeRecÜdCom·»Debug
(
nKey1
, 
pKey1
, 
pPKey2
, 
»s
) );

66997  
	g»s
;

67006 
vdbeRecÜdCom·»SŒšg
(

67007 
nKey1
, cÚ¡ *
pKey1
,

67008 
UÅackedRecÜd
 *
pPKey2


67010 cÚ¡ 
u8
 *
	gaKey1
 = (cÚ¡ u8*)
pKey1
;

67011 
	g£rŸl_ty³
;

67012 
	g»s
;

67014 
g‘V¬št32
(&
aKey1
[1], 
£rŸl_ty³
);

67015 ifÐ
	g£rŸl_ty³
<12 ){

67016 
	g»s
 = 
pPKey2
->
r1
;

67017 }ifÐ!(
	g£rŸl_ty³
 & 0x01) ){

67018 
	g»s
 = 
pPKey2
->
r2
;

67020 
	gnCmp
;

67021 
	gnSŒ
;

67022 
	gszHdr
 = 
aKey1
[0];

67024 
	gnSŒ
 = (
£rŸl_ty³
-12) / 2;

67025 ifÐ(
	gszHdr
 + 
	gnSŒ
è> 
	gnKey1
 ){

67026 
	gpPKey2
->
	g”rCode
 = (
u8
)
SQLITE_CORRUPT_BKPT
;

67029 
	gnCmp
 = 
MIN
Ð
pPKey2
->
aMem
[0].
n
, 
nSŒ
 );

67030 
	g»s
 = 
memcmp
(&
aKey1
[
szHdr
], 
pPKey2
->
aMem
[0].
z
, 
nCmp
);

67032 ifÐ
	g»s
==0 ){

67033 
»s
 = 
nSŒ
 - 
pPKey2
->
aMem
[0].
n
;

67034 ifÐ
	g»s
==0 ){

67035 ifÐ
pPKey2
->
nF›ld
>1 ){

67036 
»s
 = 
vdbeRecÜdCom·»W™hSk
(
nKey1
, 
pKey1
, 
pPKey2
, 1);

67038 
	g»s
 = 
pPKey2
->
deçuÉ_rc
;

67040 }ifÐ
	g»s
>0 ){

67041 
	g»s
 = 
pPKey2
->
r2
;

67043 
	g»s
 = 
pPKey2
->
r1
;

67045 }ifÐ
	g»s
>0 ){

67046 
	g»s
 = 
pPKey2
->
r2
;

67048 
	g»s
 = 
pPKey2
->
r1
;

67052 
as£¹
Ð
vdbeRecÜdCom·»Debug
(
nKey1
, 
pKey1
, 
pPKey2
, 
»s
)

67053 || 
CORRUPT_DB


67054 || 
pPKey2
->
pKeyInfo
->
db
->
m®locFažed


67056  
	g»s
;

67064 
SQLITE_PRIVATE
 
RecÜdCom·»
 
sql™e3VdbeFšdCom·»
(
UÅackedRecÜd
 *
p
){

67078 ifÐ(
	gp
->
	gpKeyInfo
->
	gnF›ld
 +…->pKeyInfo->
	gnXF›ld
)<=13 ){

67079 
æags
 = 
p
->
aMem
[0].flags;

67080 ifÐ
	gp
->
	gpKeyInfo
->
	gaSÜtOrd”
[0] ){

67081 
	gp
->
	gr1
 = 1;

67082 
	gp
->
	gr2
 = -1;

67084 
	gp
->
	gr1
 = -1;

67085 
	gp
->
	gr2
 = 1;

67087 ifÐ(
	gæags
 & 
	gMEM_IÁ
) ){

67088  
	gvdbeRecÜdCom·»IÁ
;

67090 
‹¡ÿ£
Ð
æags
 & 
MEM_R—l
 );

67091 
‹¡ÿ£
Ð
æags
 & 
MEM_NuÎ
 );

67092 
‹¡ÿ£
Ð
æags
 & 
MEM_Blob
 );

67093 ifÐ(
	gæags
 & (
	gMEM_R—l
|
	gMEM_NuÎ
|
	gMEM_Blob
))==0 && 
p
->
pKeyInfo
->
aCÞl
[0]==0 ){

67094 
as£¹
Ð
æags
 & 
MEM_SŒ
 );

67095  
	gvdbeRecÜdCom·»SŒšg
;

67099  
	gsql™e3VdbeRecÜdCom·»
;

67110 
SQLITE_PRIVATE
 
sql™e3VdbeIdxRowid
(
sql™e3
 *
db
, 
BtCursÜ
 *
pCur
, 
i64
 *
rowid
){

67111 
i64
 
	gnC–lKey
 = 0;

67112 
	grc
;

67113 
u32
 
	gszHdr
;

67114 
u32
 
	gty³Rowid
;

67115 
u32
 
	gËnRowid
;

67116 
Mem
 
	gm
, 
	gv
;

67123 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCur
) );

67124 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“KeySize
(
pCur
, &
nC–lKey
);

67125 
as£¹
Ð
rc
==
SQLITE_OK
 );

67126 
as£¹
Ð(
nC–lKey
 & 
SQLITE_MAX_U32
)==(
u64
)nCellKey );

67129 
sql™e3VdbeMemIn™
(&
m
, 
db
, 0);

67130 
	grc
 = 
sql™e3VdbeMemFromBŒ“
(
pCur
, 0, (
u32
)
nC–lKey
, 1, &
m
);

67131 ifÐ
	grc
 ){

67132  
	grc
;

67136 ()
g‘V¬št32
((
u8
*)
m
.
z
, 
szHdr
);

67137 
‹¡ÿ£
Ð
szHdr
==3 );

67138 
‹¡ÿ£
Ð
szHdr
==
m
.
n
 );

67139 ifÐ
uÆik–y
(
szHdr
<3 || ()szHdr>
m
.
n
) ){

67140 
	gidx_rowid_cÜru±iÚ
;

67145 ()
g‘V¬št32
((
u8
*)&
m
.
z
[
szHdr
-1], 
ty³Rowid
);

67146 
‹¡ÿ£
Ð
ty³Rowid
==1 );

67147 
‹¡ÿ£
Ð
ty³Rowid
==2 );

67148 
‹¡ÿ£
Ð
ty³Rowid
==3 );

67149 
‹¡ÿ£
Ð
ty³Rowid
==4 );

67150 
‹¡ÿ£
Ð
ty³Rowid
==5 );

67151 
‹¡ÿ£
Ð
ty³Rowid
==6 );

67152 
‹¡ÿ£
Ð
ty³Rowid
==8 );

67153 
‹¡ÿ£
Ð
ty³Rowid
==9 );

67154 ifÐ
uÆik–y
(
ty³Rowid
<1 ||ypeRowid>9 ||ypeRowid==7) ){

67155 
idx_rowid_cÜru±iÚ
;

67157 
	gËnRowid
 = 
sql™e3VdbeS”ŸlTy³L’
(
ty³Rowid
);

67158 
‹¡ÿ£
Ð(
u32
)
m
.
n
==
szHdr
+
ËnRowid
 );

67159 ifÐ
uÆik–y
((
u32
)
m
.
n
<
szHdr
+
ËnRowid
) ){

67160 
	gidx_rowid_cÜru±iÚ
;

67164 
sql™e3VdbeS”ŸlG‘
((
u8
*)&
m
.
z
[m.
n
-
ËnRowid
], 
ty³Rowid
, &
v
);

67165 *
	growid
 = 
v
.
u
.
i
;

67166 
sql™e3VdbeMemR–—£
(&
m
);

67167  
	gSQLITE_OK
;

67171 
	gidx_rowid_cÜru±iÚ
:

67172 
‹¡ÿ£
Ð
m
.
szM®loc
!=0 );

67173 
sql™e3VdbeMemR–—£
(&
m
);

67174  
	gSQLITE_CORRUPT_BKPT
;

67188 
SQLITE_PRIVATE
 
sql™e3VdbeIdxKeyCom·»
(

67189 
sql™e3
 *
db
,

67190 
VdbeCursÜ
 *
pC
,

67191 
UÅackedRecÜd
 *
pUÅacked
,

67192 *
»s


67194 
i64
 
	gnC–lKey
 = 0;

67195 
	grc
;

67196 
BtCursÜ
 *
	gpCur
 = 
pC
->
pCursÜ
;

67197 
Mem
 
	gm
;

67199 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCur
) );

67200 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“KeySize
(
pCur
, &
nC–lKey
);

67201 
as£¹
Ð
rc
==
SQLITE_OK
 );

67204 ifÐ
	gnC–lKey
<=0 || 
nC–lKey
>0x7fffffff ){

67205 *
»s
 = 0;

67206  
	gSQLITE_CORRUPT_BKPT
;

67208 
sql™e3VdbeMemIn™
(&
m
, 
db
, 0);

67209 
	grc
 = 
sql™e3VdbeMemFromBŒ“
(
pC
->
pCursÜ
, 0, (
u32
)
nC–lKey
, 1, &
m
);

67210 ifÐ
	grc
 ){

67211  
	grc
;

67213 *
	g»s
 = 
sql™e3VdbeRecÜdCom·»
(
m
.
n
, m.
z
, 
pUÅacked
);

67214 
sql™e3VdbeMemR–—£
(&
m
);

67215  
	gSQLITE_OK
;

67222 
SQLITE_PRIVATE
 
sql™e3VdbeS‘Chªges
(
sql™e3
 *
db
, 
nChªge
){

67223 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

67224 
	gdb
->
	gnChªge
 = 
nChªge
;

67225 
	gdb
->
	gnTÙ®Chªge
 +ð
nChªge
;

67232 
SQLITE_PRIVATE
 
sql™e3VdbeCouÁChªges
(
Vdbe
 *
v
){

67233 
	gv
->
	gchªgeCÁOn
 = 1;

67246 
SQLITE_PRIVATE
 
sql™e3ExpœeP»·»dS‹m’ts
(
sql™e3
 *
db
){

67247 
Vdbe
 *
	gp
;

67248 
	gp
 = 
db
->
pVdbe
;…;…=
p
->
pNext
){

67249 
p
->
expœed
 = 1;

67256 
SQLITE_PRIVATE
 
sql™e3
 *
sql™e3VdbeDb
(
Vdbe
 *
v
){

67257  
	gv
->
	gdb
;

67268 
SQLITE_PRIVATE
 
sql™e3_v®ue
 *
sql™e3VdbeG‘BoundV®ue
(
Vdbe
 *
v
, 
iV¬
, 
u8
 
aff
){

67269 
as£¹
Ð
iV¬
>0 );

67270 ifÐ
	gv
 ){

67271 
Mem
 *
	gpMem
 = &
v
->
aV¬
[
iV¬
-1];

67272 ifÐ0==(
pMem
->
æags
 & 
MEM_NuÎ
) ){

67273 
sql™e3_v®ue
 *
pR‘
 = 
sql™e3V®ueNew
(
v
->
db
);

67274 ifÐ
	gpR‘
 ){

67275 
sql™e3VdbeMemCÝy
((
Mem
 *)
pR‘
, 
pMem
);

67276 
sql™e3V®ueAµlyAffš™y
(
pR‘
, 
aff
, 
SQLITE_UTF8
);

67278  
	gpR‘
;

67289 
SQLITE_PRIVATE
 
sql™e3VdbeS‘V¬mask
(
Vdbe
 *
v
, 
iV¬
){

67290 
as£¹
Ð
iV¬
>0 );

67291 ifÐ
	giV¬
>32 ){

67292 
	gv
->
	gexpmask
 = 0xffffffff;

67294 
	gv
->
	gexpmask
 |ð((
u32
)1 << (
iV¬
-1));

67298 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


67304 
SQLITE_PRIVATE
 
sql™e3VbImpÜtE¼msg
(
Vdbe
 *
p
, 
sql™e3_vb
 *
pVb
){

67305 
sql™e3
 *
	gdb
 = 
p
->
db
;

67306 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

67307 
	gp
->
	gzE¼Msg
 = 
sql™e3DbSŒDup
(
db
, 
pVb
->
zE¼Msg
);

67308 
sql™e3_ä“
(
pVb
->
zE¼Msg
);

67309 
	gpVb
->
	gzE¼Msg
 = 0;

67331 #iâdeà
SQLITE_OMIT_DEPRECATED


67340 
SQLITE_API
 
sql™e3_expœed
(
sql™e3_¡mt
 *
pStmt
){

67341 
Vdbe
 *
	gp
 = (Vdbe*)
pStmt
;

67342  
	gp
==0 || 
p
->
expœed
;

67351 
vdbeSaãty
(
Vdbe
 *
p
){

67352 ifÐ
	gp
->
	gdb
==0 ){

67353 
sql™e3_log
(
SQLITE_MISUSE
, "API called with finalized…repared statement");

67359 
vdbeSaãtyNÙNuÎ
(
Vdbe
 *
p
){

67360 ifÐ
	gp
==0 ){

67361 
sql™e3_log
(
SQLITE_MISUSE
, "API called with NULL…repared statement");

67364  
vdbeSaãty
(
p
);

67377 
SQLITE_API
 
sql™e3_fš®ize
(
sql™e3_¡mt
 *
pStmt
){

67378 
	grc
;

67379 ifÐ
	gpStmt
==0 ){

67382 
rc
 = 
SQLITE_OK
;

67384 
Vdbe
 *
	gv
 = (Vdbe*)
pStmt
;

67385 
sql™e3
 *
	gdb
 = 
v
->
db
;

67386 ifÐ
vdbeSaãty
(
v
èè 
	gSQLITE_MISUSE_BKPT
;

67387 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

67388 
	grc
 = 
sql™e3VdbeFš®ize
(
v
);

67389 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

67390 
sql™e3L—veMu‹xAndClo£Zomb›
(
db
);

67392  
	grc
;

67403 
SQLITE_API
 
sql™e3_»£t
(
sql™e3_¡mt
 *
pStmt
){

67404 
	grc
;

67405 ifÐ
	gpStmt
==0 ){

67406 
rc
 = 
SQLITE_OK
;

67408 
Vdbe
 *
	gv
 = (Vdbe*)
pStmt
;

67409 
sql™e3_mu‹x_’‹r
(
v
->
db
->
mu‹x
);

67410 
	grc
 = 
sql™e3VdbeRe£t
(
v
);

67411 
sql™e3VdbeRewšd
(
v
);

67412 
as£¹
Ð(
rc
 & (
v
->
db
->
”rMask
))==rc );

67413 
	grc
 = 
sql™e3ApiEx™
(
v
->
db
, 
rc
);

67414 
sql™e3_mu‹x_Ëave
(
v
->
db
->
mu‹x
);

67416  
	grc
;

67422 
SQLITE_API
 
sql™e3_þ—r_bšdšgs
(
sql™e3_¡mt
 *
pStmt
){

67423 
	gi
;

67424 
	grc
 = 
SQLITE_OK
;

67425 
Vdbe
 *
	gp
 = (Vdbe*)
pStmt
;

67426 #ià
SQLITE_THREADSAFE


67427 
sql™e3_mu‹x
 *
	gmu‹x
 = ((
Vdbe
*)
pStmt
)->
db
->
mu‹x
;

67429 
sql™e3_mu‹x_’‹r
(
mu‹x
);

67430 
	gi
=0; i<
	gp
->
	gnV¬
; i++){

67431 
sql™e3VdbeMemR–—£
(&
p
->
aV¬
[
i
]);

67432 
	gp
->
	gaV¬
[
i
].
	gæags
 = 
MEM_NuÎ
;

67434 ifÐ
	gp
->
	gisP»·»V2
 &&…->
	gexpmask
 ){

67435 
	gp
->
	gexpœed
 = 1;

67437 
sql™e3_mu‹x_Ëave
(
mu‹x
);

67438  
	grc
;

67446 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_blob
(
sql™e3_v®ue
 *
pV®
){

67447 
Mem
 *
	gp
 = (Mem*)
pV®
;

67448 ifÐ
	gp
->
	gæags
 & (
	gMEM_Blob
|
	gMEM_SŒ
) ){

67449 
sql™e3VdbeMemEx·ndBlob
(
p
);

67450 
	gp
->
	gæags
 |ð
MEM_Blob
;

67451  
	gp
->
	gn
 ?…->
	gz
 : 0;

67453  
sql™e3_v®ue_‹xt
(
pV®
);

67456 
SQLITE_API
 
sql™e3_v®ue_by‹s
(
sql™e3_v®ue
 *
pV®
){

67457  
sql™e3V®ueBy‹s
(
pV®
, 
SQLITE_UTF8
);

67459 
SQLITE_API
 
sql™e3_v®ue_by‹s16
(
sql™e3_v®ue
 *
pV®
){

67460  
sql™e3V®ueBy‹s
(
pV®
, 
SQLITE_UTF16NATIVE
);

67462 
SQLITE_API
 
sql™e3_v®ue_doubË
(
sql™e3_v®ue
 *
pV®
){

67463  
sql™e3VdbeR—lV®ue
((
Mem
*)
pV®
);

67465 
SQLITE_API
 
sql™e3_v®ue_št
(
sql™e3_v®ue
 *
pV®
){

67466  ()
sql™e3VdbeIÁV®ue
((
Mem
*)
pV®
);

67468 
SQLITE_API
 
sql™e_št64
 
sql™e3_v®ue_št64
(
sql™e3_v®ue
 *
pV®
){

67469  
sql™e3VdbeIÁV®ue
((
Mem
*)
pV®
);

67471 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt
(
sql™e3_v®ue
 *
pV®
){

67472  (cÚ¡ *)
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF8
);

67474 #iâdeà
SQLITE_OMIT_UTF16


67475 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16
(
sql™e3_v®ue
* 
pV®
){

67476  
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF16NATIVE
);

67478 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16be
(
sql™e3_v®ue
 *
pV®
){

67479  
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF16BE
);

67481 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16Ë
(
sql™e3_v®ue
 *
pV®
){

67482  
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF16LE
);

67485 
SQLITE_API
 
sql™e3_v®ue_ty³
(
sql™e3_v®ue
* 
pV®
){

67486 cÚ¡ 
u8
 
	gaTy³
[] = {

67487 
SQLITE_BLOB
,

67488 
SQLITE_NULL
,

67489 
SQLITE_TEXT
,

67490 
SQLITE_NULL
,

67491 
SQLITE_INTEGER
,

67492 
SQLITE_NULL
,

67493 
SQLITE_INTEGER
,

67494 
SQLITE_NULL
,

67495 
SQLITE_FLOAT
,

67496 
SQLITE_NULL
,

67497 
SQLITE_FLOAT
,

67498 
SQLITE_NULL
,

67499 
SQLITE_INTEGER
,

67500 
SQLITE_NULL
,

67501 
SQLITE_INTEGER
,

67502 
SQLITE_NULL
,

67503 
SQLITE_BLOB
,

67504 
SQLITE_NULL
,

67505 
SQLITE_TEXT
,

67506 
SQLITE_NULL
,

67507 
SQLITE_INTEGER
,

67508 
SQLITE_NULL
,

67509 
SQLITE_INTEGER
,

67510 
SQLITE_NULL
,

67511 
SQLITE_FLOAT
,

67512 
SQLITE_NULL
,

67513 
SQLITE_FLOAT
,

67514 
SQLITE_NULL
,

67515 
SQLITE_INTEGER
,

67516 
SQLITE_NULL
,

67517 
SQLITE_INTEGER
,

67518 
SQLITE_NULL
,

67520  
	gaTy³
[
pV®
->
æags
&
MEM_AffMask
];

67534 
£tResuÉSŒOrE¼Ü
(

67535 
sql™e3_cÚ‹xt
 *
pCtx
,

67536 cÚ¡ *
z
,

67537 
n
,

67538 
u8
 
’c
,

67539 (*
xD–
)(*)

67541 ifÐ
sql™e3VdbeMemS‘SŒ
(
pCtx
->
pOut
, 
z
, 
n
, 
’c
, 
xD–
)==
SQLITE_TOOBIG
 ){

67542 
sql™e3_»suÉ_”rÜ_toobig
(
pCtx
);

67545 
švokeV®ueDe¡ruùÜ
(

67546 cÚ¡ *
p
,

67547 (*
xD–
)(*),

67548 
sql™e3_cÚ‹xt
 *
pCtx


67550 
as£¹
Ð
xD–
!=
SQLITE_DYNAMIC
 );

67551 ifÐ
	gxD–
==0 ){

67553 }ifÐ
xD–
==
SQLITE_TRANSIENT
 ){

67556 
xD–
((*)
p
);

67558 ifÐ
	gpCtx
 ) 
sql™e3_»suÉ_”rÜ_toobig
(
pCtx
);

67559  
	gSQLITE_TOOBIG
;

67561 
SQLITE_API
 
sql™e3_»suÉ_blob
(

67562 
sql™e3_cÚ‹xt
 *
pCtx
,

67563 cÚ¡ *
z
,

67564 
n
,

67565 (*
xD–
)(*)

67567 
as£¹
Ð
n
>=0 );

67568 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67569 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, 
n
, 0, 
xD–
);

67571 
SQLITE_API
 
sql™e3_»suÉ_blob64
(

67572 
sql™e3_cÚ‹xt
 *
pCtx
,

67573 cÚ¡ *
z
,

67574 
sql™e3_ušt64
 
n
,

67575 (*
xD–
)(*)

67577 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67578 
as£¹
Ð
xD–
!=
SQLITE_DYNAMIC
 );

67579 ifÐ
	gn
>0x7fffffff ){

67580 ()
švokeV®ueDe¡ruùÜ
(
z
, 
xD–
, 
pCtx
);

67582 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, ()
n
, 0, 
xD–
);

67585 
SQLITE_API
 
sql™e3_»suÉ_doubË
(
sql™e3_cÚ‹xt
 *
pCtx
, 
rV®
){

67586 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67587 
sql™e3VdbeMemS‘DoubË
(
pCtx
->
pOut
, 
rV®
);

67589 
SQLITE_API
 
sql™e3_»suÉ_”rÜ
(
sql™e3_cÚ‹xt
 *
pCtx
, cÚ¡ *
z
, 
n
){

67590 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67591 
	gpCtx
->
	gisE¼Ü
 = 
SQLITE_ERROR
;

67592 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

67593 
sql™e3VdbeMemS‘SŒ
(
pCtx
->
pOut
, 
z
, 
n
, 
SQLITE_UTF8
, 
SQLITE_TRANSIENT
);

67595 #iâdeà
SQLITE_OMIT_UTF16


67596 
SQLITE_API
 
sql™e3_»suÉ_”rÜ16
(
sql™e3_cÚ‹xt
 *
pCtx
, cÚ¡ *
z
, 
n
){

67597 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67598 
	gpCtx
->
	gisE¼Ü
 = 
SQLITE_ERROR
;

67599 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

67600 
sql™e3VdbeMemS‘SŒ
(
pCtx
->
pOut
, 
z
, 
n
, 
SQLITE_UTF16NATIVE
, 
SQLITE_TRANSIENT
);

67603 
SQLITE_API
 
sql™e3_»suÉ_št
(
sql™e3_cÚ‹xt
 *
pCtx
, 
iV®
){

67604 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67605 
sql™e3VdbeMemS‘IÁ64
(
pCtx
->
pOut
, (
i64
)
iV®
);

67607 
SQLITE_API
 
sql™e3_»suÉ_št64
(
sql™e3_cÚ‹xt
 *
pCtx
, 
i64
 
iV®
){

67608 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67609 
sql™e3VdbeMemS‘IÁ64
(
pCtx
->
pOut
, 
iV®
);

67611 
SQLITE_API
 
sql™e3_»suÉ_nuÎ
(
sql™e3_cÚ‹xt
 *
pCtx
){

67612 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67613 
sql™e3VdbeMemS‘NuÎ
(
pCtx
->
pOut
);

67615 
SQLITE_API
 
sql™e3_»suÉ_‹xt
(

67616 
sql™e3_cÚ‹xt
 *
pCtx
,

67617 cÚ¡ *
z
,

67618 
n
,

67619 (*
xD–
)(*)

67621 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67622 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, 
n
, 
SQLITE_UTF8
, 
xD–
);

67624 
SQLITE_API
 
sql™e3_»suÉ_‹xt64
(

67625 
sql™e3_cÚ‹xt
 *
pCtx
,

67626 cÚ¡ *
z
,

67627 
sql™e3_ušt64
 
n
,

67628 (*
xD–
)(*),

67629 
’c


67631 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67632 
as£¹
Ð
xD–
!=
SQLITE_DYNAMIC
 );

67633 ifÐ
	g’c
==
SQLITE_UTF16
 ) 
’c
 = 
SQLITE_UTF16NATIVE
;

67634 ifÐ
	gn
>0x7fffffff ){

67635 ()
švokeV®ueDe¡ruùÜ
(
z
, 
xD–
, 
pCtx
);

67637 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, ()
n
, 
’c
, 
xD–
);

67640 #iâdeà
SQLITE_OMIT_UTF16


67641 
SQLITE_API
 
sql™e3_»suÉ_‹xt16
(

67642 
sql™e3_cÚ‹xt
 *
pCtx
,

67643 cÚ¡ *
z
,

67644 
n
,

67645 (*
xD–
)(*)

67647 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67648 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, 
n
, 
SQLITE_UTF16NATIVE
, 
xD–
);

67650 
SQLITE_API
 
sql™e3_»suÉ_‹xt16be
(

67651 
sql™e3_cÚ‹xt
 *
pCtx
,

67652 cÚ¡ *
z
,

67653 
n
,

67654 (*
xD–
)(*)

67656 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67657 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, 
n
, 
SQLITE_UTF16BE
, 
xD–
);

67659 
SQLITE_API
 
sql™e3_»suÉ_‹xt16Ë
(

67660 
sql™e3_cÚ‹xt
 *
pCtx
,

67661 cÚ¡ *
z
,

67662 
n
,

67663 (*
xD–
)(*)

67665 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67666 
£tResuÉSŒOrE¼Ü
(
pCtx
, 
z
, 
n
, 
SQLITE_UTF16LE
, 
xD–
);

67669 
SQLITE_API
 
sql™e3_»suÉ_v®ue
(
sql™e3_cÚ‹xt
 *
pCtx
, 
sql™e3_v®ue
 *
pV®ue
){

67670 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67671 
sql™e3VdbeMemCÝy
(
pCtx
->
pOut
, 
pV®ue
);

67673 
SQLITE_API
 
sql™e3_»suÉ_z”oblob
(
sql™e3_cÚ‹xt
 *
pCtx
, 
n
){

67674 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67675 
sql™e3VdbeMemS‘Z”oBlob
(
pCtx
->
pOut
, 
n
);

67677 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_code
(
sql™e3_cÚ‹xt
 *
pCtx
, 
”rCode
){

67678 
	gpCtx
->
	gisE¼Ü
 = 
”rCode
;

67679 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

67680 ifÐ
	gpCtx
->
	gpOut
->
	gæags
 & 
	gMEM_NuÎ
 ){

67681 
sql™e3VdbeMemS‘SŒ
(
pCtx
->
pOut
, 
sql™e3E¼SŒ
(
”rCode
), -1,

67682 
SQLITE_UTF8
, 
SQLITE_STATIC
);

67687 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_toobig
(
sql™e3_cÚ‹xt
 *
pCtx
){

67688 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67689 
	gpCtx
->
	gisE¼Ü
 = 
SQLITE_TOOBIG
;

67690 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

67691 
sql™e3VdbeMemS‘SŒ
(
pCtx
->
pOut
, "string or bloboo big", -1,

67692 
SQLITE_UTF8
, 
SQLITE_STATIC
);

67696 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_nomem
(
sql™e3_cÚ‹xt
 *
pCtx
){

67697 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

67698 
sql™e3VdbeMemS‘NuÎ
(
pCtx
->
pOut
);

67699 
	gpCtx
->
	gisE¼Ü
 = 
SQLITE_NOMEM
;

67700 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

67701 
	gpCtx
->
	gpOut
->
	gdb
->
	gm®locFažed
 = 1;

67708 
doW®C®lbacks
(
sql™e3
 *
db
){

67709 
	grc
 = 
SQLITE_OK
;

67710 #iâdeà
SQLITE_OMIT_WAL


67711 
	gi
;

67712 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

67713 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

67714 ifÐ
	gpBt
 ){

67715 
	gnEÁry
 = 
sql™e3Pag”W®C®lback
(
sql™e3BŒ“Pag”
(
pBt
));

67716 ifÐ
	gdb
->
	gxW®C®lback
 && 
	gnEÁry
>0 && 
	grc
==
SQLITE_OK
 ){

67717 
rc
 = 
db
->
xW®C®lback
(db->
pW®Arg
, db, db->
aDb
[
i
].
zName
, 
nEÁry
);

67722  
	grc
;

67734 
sql™e3S‹p
(
Vdbe
 *
p
){

67735 
sql™e3
 *
	gdb
;

67736 
	grc
;

67738 
as£¹
(
p
);

67739 ifÐ
	gp
->
	gmagic
!=
VDBE_MAGIC_RUN
 ){

67756 #ifdeà
SQLITE_OMIT_AUTORESET


67757 ifÐ
p
->
rc
==
SQLITE_BUSY
 ||…->rc==
SQLITE_LOCKED
 ){

67758 
sql™e3_»£t
((
sql™e3_¡mt
*)
p
);

67760  
	gSQLITE_MISUSE_BKPT
;

67763 
sql™e3_»£t
((
sql™e3_¡mt
*)
p
);

67768 
	gdb
 = 
p
->
db
;

67769 ifÐ
	gdb
->
	gm®locFažed
 ){

67770 
	gp
->
	grc
 = 
SQLITE_NOMEM
;

67771  
	gSQLITE_NOMEM
;

67774 ifÐ
	gp
->
	gpc
<=0 && 
p
->
expœed
 ){

67775 
p
->
rc
 = 
SQLITE_SCHEMA
;

67776 
	grc
 = 
SQLITE_ERROR
;

67777 
	g’d_of_¡•
;

67779 ifÐ
	gp
->
	gpc
<0 ){

67784 ifÐ
	gdb
->
	gnVdbeAùive
==0 ){

67785 
db
->
u1
.
isIÁ”ru±ed
 = 0;

67788 
as£¹
Ð
db
->
nVdbeWr™e
>0 || db->
autoComm™
==0

67789 || (
db
->
nDeã¼edCÚs
==0 && db->
nDeã¼edImmCÚs
==0)

67792 #iâdeà
SQLITE_OMIT_TRACE


67793 ifÐ
	gdb
->
	gxProfže
 && !db->
	gš™
.
	gbusy
 ){

67794 
sql™e3OsCu¼’tTimeIÁ64
(
db
->
pVfs
, &
p
->
¡¬tTime
);

67798 
	gdb
->
	gnVdbeAùive
++;

67799 ifÐ
	gp
->
	g»adOÆy
==0 ) 
db
->
nVdbeWr™e
++;

67800 ifÐ
	gp
->
	gbIsR—d”
 ) 
	gdb
->
	gnVdbeR—d
++;

67801 
	gp
->
	gpc
 = 0;

67803 #iâdeà
SQLITE_OMIT_EXPLAIN


67804 ifÐ
	gp
->
	gex¶aš
 ){

67805 
	grc
 = 
sql™e3VdbeLi¡
(
p
);

67809 
	gdb
->
	gnVdbeExec
++;

67810 
	grc
 = 
sql™e3VdbeExec
(
p
);

67811 
	gdb
->
	gnVdbeExec
--;

67814 #iâdeà
SQLITE_OMIT_TRACE


67817 ifÐ
	grc
!=
SQLITE_ROW
 && 
db
->
xProfže
 && !db->
š™
.
busy
 && 
p
->
zSql
 ){

67818 
sql™e3_št64
 
iNow
;

67819 
sql™e3OsCu¼’tTimeIÁ64
(
db
->
pVfs
, &
iNow
);

67820 
	gdb
->
xProfže
(
db
->
pProfžeArg
, 
p
->
zSql
, (
iNow
 -…->
¡¬tTime
)*1000000);

67824 ifÐ
	grc
==
SQLITE_DONE
 ){

67825 
as£¹
Ð
p
->
rc
==
SQLITE_OK
 );

67826 
	gp
->
	grc
 = 
doW®C®lbacks
(
db
);

67827 ifÐ
	gp
->
	grc
!=
SQLITE_OK
 ){

67828 
rc
 = 
SQLITE_ERROR
;

67832 
	gdb
->
	g”rCode
 = 
rc
;

67833 ifÐ
	gSQLITE_NOMEM
==
sql™e3ApiEx™
(
p
->
db
,…->
rc
) ){

67834 
	gp
->
	grc
 = 
SQLITE_NOMEM
;

67836 
	g’d_of_¡•
:

67844 
as£¹
Ð
rc
==
SQLITE_ROW
 ||„c==
SQLITE_DONE
 ||„c==
SQLITE_ERROR


67845 || 
rc
==
SQLITE_BUSY
 ||„c==
SQLITE_MISUSE


67847 
as£¹
Ð
p
->
rc
!=
SQLITE_ROW
 &&…->rc!=
SQLITE_DONE
 );

67848 ifÐ
	gp
->
	gisP»·»V2
 && 
	grc
!=
SQLITE_ROW
 && 
rc
!=
SQLITE_DONE
 ){

67853 
rc
 = 
sql™e3VdbeT¿nsãrE¼Ü
(
p
);

67855  (
	grc
&
	gdb
->
	g”rMask
);

67863 
SQLITE_API
 
sql™e3_¡•
(
sql™e3_¡mt
 *
pStmt
){

67864 
	grc
 = 
SQLITE_OK
;

67865 
	grc2
 = 
SQLITE_OK
;

67866 
Vdbe
 *
	gv
 = (Vdbe*)
pStmt
;

67867 
	gút
 = 0;

67868 
sql™e3
 *
	gdb
;

67870 ifÐ
vdbeSaãtyNÙNuÎ
(
v
) ){

67871  
	gSQLITE_MISUSE_BKPT
;

67873 
	gdb
 = 
v
->
db
;

67874 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

67875 
	gv
->
	gdošgR”un
 = 0;

67876  (
	grc
 = 
sql™e3S‹p
(
v
))==
SQLITE_SCHEMA


67877 && 
út
++ < 
SQLITE_MAX_SCHEMA_RETRY
 ){

67878 
§vedPc
 = 
v
->
pc
;

67879 
	grc2
 = 
rc
 = 
sql™e3R•»·»
(
v
);

67880 ifÐ
	grc
!=
SQLITE_OK
) ;

67881 
sql™e3_»£t
(
pStmt
);

67882 ifÐ
	g§vedPc
>=0 ) 
v
->
došgR”un
 = 1;

67883 
as£¹
Ð
v
->
expœed
==0 );

67885 ifÐ
	grc2
!=
SQLITE_OK
 ){

67894 cÚ¡ *
zE¼
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
db
->
pE¼
);

67895 
as£¹
Ð
zE¼
!=0 || 
db
->
m®locFažed
 );

67896 
sql™e3DbF»e
(
db
, 
v
->
zE¼Msg
);

67897 ifÐ!
	gdb
->
	gm®locFažed
 ){

67898 
	gv
->
	gzE¼Msg
 = 
sql™e3DbSŒDup
(
db
, 
zE¼
);

67899 
	gv
->
	grc
 = 
rc2
;

67901 
	gv
->
	gzE¼Msg
 = 0;

67902 
	gv
->
	grc
 = 
rc
 = 
SQLITE_NOMEM
;

67905 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

67906 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

67907  
	grc
;

67915 
SQLITE_API
 *
sql™e3_u£r_d©a
(
sql™e3_cÚ‹xt
 *
p
){

67916 
as£¹
Ð
p
 &&…->
pFunc
 );

67917  
	gp
->
	gpFunc
->
	gpU£rD©a
;

67930 
SQLITE_API
 
sql™e3
 *
sql™e3_cÚ‹xt_db_hªdË
(
sql™e3_cÚ‹xt
 *
p
){

67931 
as£¹
Ð
p
 &&…->
pFunc
 );

67932  
	gp
->
	gpOut
->
	gdb
;

67938 
SQLITE_PRIVATE
 
sql™e3_št64
 
sql™e3StmtCu¼’tTime
(
sql™e3_cÚ‹xt
 *
p
){

67939 
Vdbe
 *
	gv
 = 
p
->
pVdbe
;

67940 
	grc
;

67941 ifÐ
	gv
->
	giCu¼’tTime
==0 ){

67942 
rc
 = 
sql™e3OsCu¼’tTimeIÁ64
(
p
->
pOut
->
db
->
pVfs
, &
v
->
iCu¼’tTime
);

67943 ifÐ
	grc
 ) 
	gv
->
	giCu¼’tTime
 = 0;

67945  
	gv
->
	giCu¼’tTime
;

67956 
SQLITE_PRIVATE
 
sql™e3Inv®idFunùiÚ
(

67957 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

67958 
NÙU£d
,

67959 
sql™e3_v®ue
 **
NÙU£d2


67961 cÚ¡ *
	gzName
 = 
cÚ‹xt
->
pFunc
->
zName
;

67962 *
	gzE¼
;

67963 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

67964 
	gzE¼
 = 
sql™e3_m´štf
(

67965 "uÇbËØu£ funùiÚ % šh»que¡ed cÚ‹xt", 
zName
);

67966 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

67967 
sql™e3_ä“
(
zE¼
);

67974 
SQLITE_NOINLINE
 *
ü—‹AggCÚ‹xt
(
sql™e3_cÚ‹xt
 *
p
, 
nBy‹
){

67975 
Mem
 *
	gpMem
 = 
p
->
pMem
;

67976 
as£¹
Ð(
pMem
->
æags
 & 
MEM_Agg
)==0 );

67977 ifÐ
	gnBy‹
<=0 ){

67978 
sql™e3VdbeMemS‘NuÎ
(
pMem
);

67979 
	gpMem
->
	gz
 = 0;

67981 
sql™e3VdbeMemCË¬AndResize
(
pMem
, 
nBy‹
);

67982 
	gpMem
->
	gæags
 = 
MEM_Agg
;

67983 
	gpMem
->
	gu
.
	gpDef
 = 
p
->
pFunc
;

67984 ifÐ
	gpMem
->
	gz
 ){

67985 
mem£t
(
pMem
->
z
, 0, 
nBy‹
);

67988  (*)
	gpMem
->
	gz
;

67996 
SQLITE_API
 *
sql™e3_agg»g©e_cÚ‹xt
(
sql™e3_cÚ‹xt
 *
p
, 
nBy‹
){

67997 
as£¹
Ð
p
 &&…->
pFunc
 &&…->pFunc->
xS‹p
 );

67998 
as£¹
Ð
sql™e3_mu‹x_h–d
(
p
->
pOut
->
db
->
mu‹x
) );

67999 
‹¡ÿ£
Ð
nBy‹
<0 );

68000 ifÐ(
	gp
->
	gpMem
->
	gæags
 & 
	gMEM_Agg
)==0 ){

68001  
ü—‹AggCÚ‹xt
(
p
, 
nBy‹
);

68003  (*)
	gp
->
	gpMem
->
	gz
;

68011 
SQLITE_API
 *
sql™e3_g‘_auxd©a
(
sql™e3_cÚ‹xt
 *
pCtx
, 
iArg
){

68012 
AuxD©a
 *
	gpAuxD©a
;

68014 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

68015 
	gpAuxD©a
=
pCtx
->
pVdbe
->
pAuxD©a
;…AuxD©a;…AuxD©aõAuxD©a->
pNext
){

68016 ifÐ
pAuxD©a
->
iOp
==
pCtx
->iO°&&…AuxD©a->
iArg
==iArg ) ;

68019  (
	gpAuxD©a
 ?…AuxD©a->
	gpAux
 : 0);

68027 
SQLITE_API
 
sql™e3_£t_auxd©a
(

68028 
sql™e3_cÚ‹xt
 *
pCtx
,

68029 
iArg
,

68030 *
pAux
,

68031 (*
xD–‘e
)(*)

68033 
AuxD©a
 *
	gpAuxD©a
;

68034 
Vdbe
 *
	gpVdbe
 = 
pCtx
->
pVdbe
;

68036 
as£¹
Ð
sql™e3_mu‹x_h–d
(
pCtx
->
pOut
->
db
->
mu‹x
) );

68037 ifÐ
	giArg
<0 ) 
	gçžed
;

68039 
	gpAuxD©a
=
pVdbe
->
pAuxD©a
;…AuxD©a;…AuxD©aõAuxD©a->
pNext
){

68040 ifÐ
pAuxD©a
->
iOp
==
pCtx
->iO°&&…AuxD©a->
iArg
==iArg ) ;

68042 ifÐ
	gpAuxD©a
==0 ){

68043 
pAuxD©a
 = 
sql™e3DbM®locZ”o
(
pVdbe
->
db
, (
AuxD©a
));

68044 ifÐ!
	gpAuxD©a
 ) 
	gçžed
;

68045 
	gpAuxD©a
->
	giOp
 = 
pCtx
->
iOp
;

68046 
	gpAuxD©a
->
	giArg
 = 
iArg
;

68047 
	gpAuxD©a
->
	gpNext
 = 
pVdbe
->
pAuxD©a
;

68048 
	gpVdbe
->
	gpAuxD©a
 = 
pAuxD©a
;

68049 ifÐ
	gpCtx
->
	gfE¼ÜOrAux
==0 ){

68050 
pCtx
->
isE¼Ü
 = 0;

68051 
	gpCtx
->
	gfE¼ÜOrAux
 = 1;

68053 }ifÐ
	gpAuxD©a
->
	gxD–‘e
 ){

68054 
	gpAuxD©a
->
xD–‘e
(
pAuxD©a
->
pAux
);

68057 
	gpAuxD©a
->
	gpAux
 = 
pAux
;

68058 
	gpAuxD©a
->
	gxD–‘e
 = 
xD–‘e
;

68061 
	gçžed
:

68062 ifÐ
xD–‘e
 ){

68063 
xD–‘e
(
pAux
);

68067 #iâdeà
SQLITE_OMIT_DEPRECATED


68077 
SQLITE_API
 
sql™e3_agg»g©e_couÁ
(
sql™e3_cÚ‹xt
 *
p
){

68078 
as£¹
Ð
p
 &&…->
pMem
 &&…->
pFunc
 &&…->pFunc->
xS‹p
 );

68079  
	gp
->
	gpMem
->
	gn
;

68086 
SQLITE_API
 
sql™e3_cÞumn_couÁ
(
sql™e3_¡mt
 *
pStmt
){

68087 
Vdbe
 *
	gpVm
 = (Vdb*)
pStmt
;

68088  
	gpVm
 ?…Vm->
	gnResCÞumn
 : 0;

68095 
SQLITE_API
 
sql™e3_d©a_couÁ
(
sql™e3_¡mt
 *
pStmt
){

68096 
Vdbe
 *
	gpVm
 = (Vdb*)
pStmt
;

68097 ifÐ
	gpVm
==0 || 
pVm
->
pResuÉS‘
==0 )  0;

68098  
	gpVm
->
	gnResCÞumn
;

68104 cÚ¡ 
Mem
 *
cÞumnNuÎV®ue
(){

68114 cÚ¡ 
Mem
 
	gnuÎMem


68115 #ià
defšed
(
SQLITE_DEBUG
è&& defšed(
__GNUC__
)

68116 
__©Œibu‹__
((
®igÃd
(8)))

68120  
MEM_NuÎ
,

68129 #ifdeà
SQLITE_DEBUG


68134  &
	gnuÎMem
;

68143 
Mem
 *
cÞumnMem
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68144 
Vdbe
 *
	gpVm
;

68145 
Mem
 *
	gpOut
;

68147 
	gpVm
 = (
Vdbe
 *)
pStmt
;

68148 ifÐ
	gpVm
 &&…Vm->
	gpResuÉS‘
!=0 && 
i
<
pVm
->
nResCÞumn
 && i>=0 ){

68149 
sql™e3_mu‹x_’‹r
(
pVm
->
db
->
mu‹x
);

68150 
	gpOut
 = &
pVm
->
pResuÉS‘
[
i
];

68152 ifÐ
	gpVm
 && 
ALWAYS
(
pVm
->
db
) ){

68153 
sql™e3_mu‹x_’‹r
(
pVm
->
db
->
mu‹x
);

68154 
sql™e3E¼Ü
(
pVm
->
db
, 
SQLITE_RANGE
);

68156 
	gpOut
 = (
Mem
*)
cÞumnNuÎV®ue
();

68158  
	gpOut
;

68179 
cÞumnM®locFažu»
(
sql™e3_¡mt
 *
pStmt
)

68186 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68187 ifÐ
	gp
 ){

68188 
	gp
->
	grc
 = 
sql™e3ApiEx™
(
p
->
db
,…->
rc
);

68189 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68197 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_blob
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68198 cÚ¡ *
	gv®
;

68199 
	gv®
 = 
sql™e3_v®ue_blob
Ð
cÞumnMem
(
pStmt
,
i
) );

68204 
cÞumnM®locFažu»
(
pStmt
);

68205  
	gv®
;

68207 
SQLITE_API
 
sql™e3_cÞumn_by‹s
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68208 
	gv®
 = 
sql™e3_v®ue_by‹s
Ð
cÞumnMem
(
pStmt
,
i
) );

68209 
cÞumnM®locFažu»
(
pStmt
);

68210  
	gv®
;

68212 
SQLITE_API
 
sql™e3_cÞumn_by‹s16
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68213 
	gv®
 = 
sql™e3_v®ue_by‹s16
Ð
cÞumnMem
(
pStmt
,
i
) );

68214 
cÞumnM®locFažu»
(
pStmt
);

68215  
	gv®
;

68217 
SQLITE_API
 
sql™e3_cÞumn_doubË
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68218 
	gv®
 = 
sql™e3_v®ue_doubË
Ð
cÞumnMem
(
pStmt
,
i
) );

68219 
cÞumnM®locFažu»
(
pStmt
);

68220  
	gv®
;

68222 
SQLITE_API
 
sql™e3_cÞumn_št
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68223 
	gv®
 = 
sql™e3_v®ue_št
Ð
cÞumnMem
(
pStmt
,
i
) );

68224 
cÞumnM®locFažu»
(
pStmt
);

68225  
	gv®
;

68227 
SQLITE_API
 
sql™e_št64
 
sql™e3_cÞumn_št64
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68228 
sql™e_št64
 
	gv®
 = 
sql™e3_v®ue_št64
Ð
cÞumnMem
(
pStmt
,
i
) );

68229 
cÞumnM®locFažu»
(
pStmt
);

68230  
	gv®
;

68232 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_‹xt
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68233 cÚ¡ *
	gv®
 = 
sql™e3_v®ue_‹xt
Ð
cÞumnMem
(
pStmt
,
i
) );

68234 
cÞumnM®locFažu»
(
pStmt
);

68235  
	gv®
;

68237 
SQLITE_API
 
sql™e3_v®ue
 *
sql™e3_cÞumn_v®ue
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68238 
Mem
 *
	gpOut
 = 
cÞumnMem
(
pStmt
, 
i
);

68239 ifÐ
	gpOut
->
	gæags
&
	gMEM_Stic
 ){

68240 
	gpOut
->
	gæags
 &ð~
MEM_Stic
;

68241 
	gpOut
->
	gæags
 |ð
MEM_Ephem
;

68243 
cÞumnM®locFažu»
(
pStmt
);

68244  (
	gsql™e3_v®ue
 *)
	gpOut
;

68246 #iâdeà
SQLITE_OMIT_UTF16


68247 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_‹xt16
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68248 cÚ¡ *
	gv®
 = 
sql™e3_v®ue_‹xt16
Ð
cÞumnMem
(
pStmt
,
i
) );

68249 
cÞumnM®locFažu»
(
pStmt
);

68250  
	gv®
;

68253 
SQLITE_API
 
sql™e3_cÞumn_ty³
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68254 
	giTy³
 = 
sql™e3_v®ue_ty³
Ð
cÞumnMem
(
pStmt
,
i
) );

68255 
cÞumnM®locFažu»
(
pStmt
);

68256  
	giTy³
;

68275 cÚ¡ *
cÞumnName
(

68276 
sql™e3_¡mt
 *
pStmt
,

68277 
N
,

68278 cÚ¡ *(*
xFunc
)(
Mem
*),

68279 
u£Ty³


68281 cÚ¡ *
	g»t
 = 0;

68282 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68283 
	gn
;

68284 
sql™e3
 *
	gdb
 = 
p
->
db
;

68286 
as£¹
Ð
db
!=0 );

68287 
	gn
 = 
sql™e3_cÞumn_couÁ
(
pStmt
);

68288 ifÐ
	gN
<
	gn
 && N>=0 ){

68289 
N
 +ð
u£Ty³
*
n
;

68290 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

68291 
as£¹
Ð
db
->
m®locFažed
==0 );

68292 
	g»t
 = 
xFunc
(&
p
->
aCÞName
[
N
]);

68296 ifÐ
	gdb
->
	gm®locFažed
 ){

68297 
	gdb
->
	gm®locFažed
 = 0;

68298 
	g»t
 = 0;

68300 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

68302  
	g»t
;

68309 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Çme
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68310  
cÞumnName
(

68311 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt
, 
COLNAME_NAME
);

68313 #iâdeà
SQLITE_OMIT_UTF16


68314 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Çme16
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68315  
cÞumnName
(

68316 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt16
, 
COLNAME_NAME
);

68324 #ià
defšed
(
SQLITE_OMIT_DECLTYPE
è&& defšed(
SQLITE_ENABLE_COLUMN_METADATA
)

68329 #iâdeà
SQLITE_OMIT_DECLTYPE


68334 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_deþty³
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68335  
cÞumnName
(

68336 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt
, 
COLNAME_DECLTYPE
);

68338 #iâdeà
SQLITE_OMIT_UTF16


68339 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_deþty³16
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68340  
cÞumnName
(

68341 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt16
, 
COLNAME_DECLTYPE
);

68346 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


68352 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_d©aba£_Çme
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68353  
cÞumnName
(

68354 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt
, 
COLNAME_DATABASE
);

68356 #iâdeà
SQLITE_OMIT_UTF16


68357 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_d©aba£_Çme16
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68358  
cÞumnName
(

68359 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt16
, 
COLNAME_DATABASE
);

68368 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_bË_Çme
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68369  
cÞumnName
(

68370 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt
, 
COLNAME_TABLE
);

68372 #iâdeà
SQLITE_OMIT_UTF16


68373 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_bË_Çme16
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68374  
cÞumnName
(

68375 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt16
, 
COLNAME_TABLE
);

68384 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Üigš_Çme
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68385  
cÞumnName
(

68386 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt
, 
COLNAME_COLUMN
);

68388 #iâdeà
SQLITE_OMIT_UTF16


68389 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Üigš_Çme16
(
sql™e3_¡mt
 *
pStmt
, 
N
){

68390  
cÞumnName
(

68391 
pStmt
, 
N
, (cÚ¡ *(*)(
Mem
*))
sql™e3_v®ue_‹xt16
, 
COLNAME_COLUMN
);

68412 
vdbeUnbšd
(
Vdbe
 *
p
, 
i
){

68413 
Mem
 *
	gpV¬
;

68414 ifÐ
vdbeSaãtyNÙNuÎ
(
p
) ){

68415  
	gSQLITE_MISUSE_BKPT
;

68417 
sql™e3_mu‹x_’‹r
(
p
->
db
->
mu‹x
);

68418 ifÐ
	gp
->
	gmagic
!=
VDBE_MAGIC_RUN
 || 
p
->
pc
>=0 ){

68419 
sql™e3E¼Ü
(
p
->
db
, 
SQLITE_MISUSE
);

68420 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68421 
sql™e3_log
(
SQLITE_MISUSE
,

68422 "bšd oÀ¨busy…»·»d s‹m’t: [%s]", 
p
->
zSql
);

68423  
	gSQLITE_MISUSE_BKPT
;

68425 ifÐ
	gi
<1 || i>
	gp
->
	gnV¬
 ){

68426 
sql™e3E¼Ü
(
p
->
db
, 
SQLITE_RANGE
);

68427 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68428  
	gSQLITE_RANGE
;

68430 
	gi
--;

68431 
	gpV¬
 = &
p
->
aV¬
[
i
];

68432 
sql™e3VdbeMemR–—£
(
pV¬
);

68433 
	gpV¬
->
	gæags
 = 
MEM_NuÎ
;

68434 
sql™e3E¼Ü
(
p
->
db
, 
SQLITE_OK
);

68445 ifÐ
	gp
->
	gisP»·»V2
 &&

68446 ((
	gi
<32 && 
	gp
->
	gexpmask
 & ((
	gu32
)1 << i)) ||…->expmask==0xffffffff)

68448 
p
->
expœed
 = 1;

68450  
	gSQLITE_OK
;

68456 
bšdText
(

68457 
sql™e3_¡mt
 *
pStmt
,

68458 
i
,

68459 cÚ¡ *
zD©a
,

68460 
nD©a
,

68461 (*
xD–
)(*),

68462 
u8
 
’codšg


68464 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68465 
Mem
 *
	gpV¬
;

68466 
	grc
;

68468 
	grc
 = 
vdbeUnbšd
(
p
, 
i
);

68469 ifÐ
	grc
==
SQLITE_OK
 ){

68470 ifÐ
zD©a
!=0 ){

68471 
pV¬
 = &
p
->
aV¬
[
i
-1];

68472 
	grc
 = 
sql™e3VdbeMemS‘SŒ
(
pV¬
, 
zD©a
, 
nD©a
, 
’codšg
, 
xD–
);

68473 ifÐ
	grc
==
SQLITE_OK
 && 
’codšg
!=0 ){

68474 
rc
 = 
sql™e3VdbeChªgeEncodšg
(
pV¬
, 
ENC
(
p
->
db
));

68476 
sql™e3E¼Ü
(
p
->
db
, 
rc
);

68477 
	grc
 = 
sql™e3ApiEx™
(
p
->
db
, 
rc
);

68479 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68480 }ifÐ
	gxD–
!=
SQLITE_STATIC
 && 
xD–
!=
SQLITE_TRANSIENT
 ){

68481 
xD–
((*)
zD©a
);

68483  
	grc
;

68490 
SQLITE_API
 
sql™e3_bšd_blob
(

68491 
sql™e3_¡mt
 *
pStmt
,

68492 
i
,

68493 cÚ¡ *
zD©a
,

68494 
nD©a
,

68495 (*
xD–
)(*)

68497  
bšdText
(
pStmt
, 
i
, 
zD©a
, 
nD©a
, 
xD–
, 0);

68499 
SQLITE_API
 
sql™e3_bšd_blob64
(

68500 
sql™e3_¡mt
 *
pStmt
,

68501 
i
,

68502 cÚ¡ *
zD©a
,

68503 
sql™e3_ušt64
 
nD©a
,

68504 (*
xD–
)(*)

68506 
as£¹
Ð
xD–
!=
SQLITE_DYNAMIC
 );

68507 ifÐ
	gnD©a
>0x7fffffff ){

68508  
švokeV®ueDe¡ruùÜ
(
zD©a
, 
xD–
, 0);

68510  
bšdText
(
pStmt
, 
i
, 
zD©a
, ()
nD©a
, 
xD–
, 0);

68513 
SQLITE_API
 
sql™e3_bšd_doubË
(
sql™e3_¡mt
 *
pStmt
, 
i
, 
rV®ue
){

68514 
	grc
;

68515 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68516 
	grc
 = 
vdbeUnbšd
(
p
, 
i
);

68517 ifÐ
	grc
==
SQLITE_OK
 ){

68518 
sql™e3VdbeMemS‘DoubË
(&
p
->
aV¬
[
i
-1], 
rV®ue
);

68519 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68521  
	grc
;

68523 
SQLITE_API
 
sql™e3_bšd_št
(
sql™e3_¡mt
 *
p
, 
i
, 
iV®ue
){

68524  
sql™e3_bšd_št64
(
p
, 
i
, (
i64
)
iV®ue
);

68526 
SQLITE_API
 
sql™e3_bšd_št64
(
sql™e3_¡mt
 *
pStmt
, 
i
, 
sql™e_št64
 
iV®ue
){

68527 
	grc
;

68528 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68529 
	grc
 = 
vdbeUnbšd
(
p
, 
i
);

68530 ifÐ
	grc
==
SQLITE_OK
 ){

68531 
sql™e3VdbeMemS‘IÁ64
(&
p
->
aV¬
[
i
-1], 
iV®ue
);

68532 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68534  
	grc
;

68536 
SQLITE_API
 
sql™e3_bšd_nuÎ
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68537 
	grc
;

68538 
Vdbe
 *
	gp
 = (Vdbe*)
pStmt
;

68539 
	grc
 = 
vdbeUnbšd
(
p
, 
i
);

68540 ifÐ
	grc
==
SQLITE_OK
 ){

68541 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68543  
	grc
;

68545 
SQLITE_API
 
sql™e3_bšd_‹xt
(

68546 
sql™e3_¡mt
 *
pStmt
,

68547 
i
,

68548 cÚ¡ *
zD©a
,

68549 
nD©a
,

68550 (*
xD–
)(*)

68552  
bšdText
(
pStmt
, 
i
, 
zD©a
, 
nD©a
, 
xD–
, 
SQLITE_UTF8
);

68554 
SQLITE_API
 
sql™e3_bšd_‹xt64
(

68555 
sql™e3_¡mt
 *
pStmt
,

68556 
i
,

68557 cÚ¡ *
zD©a
,

68558 
sql™e3_ušt64
 
nD©a
,

68559 (*
xD–
)(*),

68560 
’c


68562 
as£¹
Ð
xD–
!=
SQLITE_DYNAMIC
 );

68563 ifÐ
	gnD©a
>0x7fffffff ){

68564  
švokeV®ueDe¡ruùÜ
(
zD©a
, 
xD–
, 0);

68566 ifÐ
	g’c
==
SQLITE_UTF16
 ) 
’c
 = 
SQLITE_UTF16NATIVE
;

68567  
bšdText
(
pStmt
, 
i
, 
zD©a
, ()
nD©a
, 
xD–
, 
’c
);

68570 #iâdeà
SQLITE_OMIT_UTF16


68571 
SQLITE_API
 
sql™e3_bšd_‹xt16
(

68572 
sql™e3_¡mt
 *
pStmt
,

68573 
i
,

68574 cÚ¡ *
zD©a
,

68575 
nD©a
,

68576 (*
xD–
)(*)

68578  
bšdText
(
pStmt
, 
i
, 
zD©a
, 
nD©a
, 
xD–
, 
SQLITE_UTF16NATIVE
);

68581 
SQLITE_API
 
sql™e3_bšd_v®ue
(
sql™e3_¡mt
 *
pStmt
, 
i
, cÚ¡ 
sql™e3_v®ue
 *
pV®ue
){

68582 
	grc
;

68583  
sql™e3_v®ue_ty³
((
sql™e3_v®ue
*)
pV®ue
) ){

68584 
	gSQLITE_INTEGER
: {

68585 
rc
 = 
sql™e3_bšd_št64
(
pStmt
, 
i
, 
pV®ue
->
u
.i);

68588 
	gSQLITE_FLOAT
: {

68589 
rc
 = 
sql™e3_bšd_doubË
(
pStmt
, 
i
, 
pV®ue
->
u
.
r
);

68592 
	gSQLITE_BLOB
: {

68593 ifÐ
pV®ue
->
æags
 & 
MEM_Z”o
 ){

68594 
rc
 = 
sql™e3_bšd_z”oblob
(
pStmt
, 
i
, 
pV®ue
->
u
.
nZ”o
);

68596 
	grc
 = 
sql™e3_bšd_blob
(
pStmt
, 
i
, 
pV®ue
->
z
,…V®ue->
n
,
SQLITE_TRANSIENT
);

68600 
	gSQLITE_TEXT
: {

68601 
rc
 = 
bšdText
(
pStmt
,
i
, 
pV®ue
->
z
,…V®ue->
n
, 
SQLITE_TRANSIENT
,

68602 
pV®ue
->
’c
);

68606 
rc
 = 
sql™e3_bšd_nuÎ
(
pStmt
, 
i
);

68610  
	grc
;

68612 
SQLITE_API
 
sql™e3_bšd_z”oblob
(
sql™e3_¡mt
 *
pStmt
, 
i
, 
n
){

68613 
	grc
;

68614 
Vdbe
 *
	gp
 = (Vdb*)
pStmt
;

68615 
	grc
 = 
vdbeUnbšd
(
p
, 
i
);

68616 ifÐ
	grc
==
SQLITE_OK
 ){

68617 
sql™e3VdbeMemS‘Z”oBlob
(&
p
->
aV¬
[
i
-1], 
n
);

68618 
sql™e3_mu‹x_Ëave
(
p
->
db
->
mu‹x
);

68620  
	grc
;

68627 
SQLITE_API
 
sql™e3_bšd_·¿m‘”_couÁ
(
sql™e3_¡mt
 *
pStmt
){

68628 
Vdbe
 *
	gp
 = (Vdbe*)
pStmt
;

68629  
	gp
 ?…->
	gnV¬
 : 0;

68638 
SQLITE_API
 cÚ¡ *
sql™e3_bšd_·¿m‘”_Çme
(
sql™e3_¡mt
 *
pStmt
, 
i
){

68639 
Vdbe
 *
	gp
 = (Vdbe*)
pStmt
;

68640 ifÐ
	gp
==0 || 
i
<1 || i>
p
->
nzV¬
 ){

68643  
	gp
->
	gazV¬
[
i
-1];

68651 
SQLITE_PRIVATE
 
sql™e3VdbeP¬am‘”Index
(
Vdbe
 *
p
, cÚ¡ *
zName
, 
nName
){

68652 
	gi
;

68653 ifÐ
	gp
==0 ){

68656 ifÐ
	gzName
 ){

68657 
	gi
=0; i<
	gp
->
	gnzV¬
; i++){

68658 cÚ¡ *
	gz
 = 
p
->
azV¬
[
i
];

68659 ifÐ
	gz
 && 
¡ºcmp
(
z
,
zName
,
nName
)==0 && z[nName]==0 ){

68660  
i
+1;

68666 
SQLITE_API
 
sql™e3_bšd_·¿m‘”_šdex
(
sql™e3_¡mt
 *
pStmt
, cÚ¡ *
zName
){

68667  
sql™e3VdbeP¬am‘”Index
((
Vdbe
*)
pStmt
, 
zName
, 
sql™e3SŒËn30
(zName));

68673 
SQLITE_PRIVATE
 
sql™e3T¿nsãrBšdšgs
(
sql™e3_¡mt
 *
pFromStmt
, sql™e3_¡mˆ*
pToStmt
){

68674 
Vdbe
 *
	gpFrom
 = (Vdbe*)
pFromStmt
;

68675 
Vdbe
 *
	gpTo
 = (Vdbe*)
pToStmt
;

68676 
	gi
;

68677 
as£¹
Ð
pTo
->
db
==
pFrom
->db );

68678 
as£¹
Ð
pTo
->
nV¬
==
pFrom
->nVar );

68679 
sql™e3_mu‹x_’‹r
(
pTo
->
db
->
mu‹x
);

68680 
	gi
=0; i<
	gpFrom
->
	gnV¬
; i++){

68681 
sql™e3VdbeMemMove
(&
pTo
->
aV¬
[
i
], &
pFrom
->aVar[i]);

68683 
sql™e3_mu‹x_Ëave
(
pTo
->
db
->
mu‹x
);

68684  
	gSQLITE_OK
;

68687 #iâdeà
SQLITE_OMIT_DEPRECATED


68700 
SQLITE_API
 
sql™e3_Œªsãr_bšdšgs
(
sql™e3_¡mt
 *
pFromStmt
, sql™e3_¡mˆ*
pToStmt
){

68701 
Vdbe
 *
	gpFrom
 = (Vdbe*)
pFromStmt
;

68702 
Vdbe
 *
	gpTo
 = (Vdbe*)
pToStmt
;

68703 ifÐ
	gpFrom
->
	gnV¬
!=
pTo
->
nV¬
 ){

68704  
SQLITE_ERROR
;

68706 ifÐ
	gpTo
->
	gisP»·»V2
 &&…To->
	gexpmask
 ){

68707 
	gpTo
->
	gexpœed
 = 1;

68709 ifÐ
	gpFrom
->
	gisP»·»V2
 &&…From->
	gexpmask
 ){

68710 
	gpFrom
->
	gexpœed
 = 1;

68712  
sql™e3T¿nsãrBšdšgs
(
pFromStmt
, 
pToStmt
);

68722 
SQLITE_API
 
sql™e3
 *
sql™e3_db_hªdË
(
sql™e3_¡mt
 *
pStmt
){

68723  
	gpStmt
 ? ((
	gVdbe
*íStmt)->
	gdb
 : 0;

68730 
SQLITE_API
 
sql™e3_¡mt_»adÚly
(
sql™e3_¡mt
 *
pStmt
){

68731  
	gpStmt
 ? ((
	gVdbe
*íStmt)->
	g»adOÆy
 : 1;

68737 
SQLITE_API
 
sql™e3_¡mt_busy
(
sql™e3_¡mt
 *
pStmt
){

68738 
Vdbe
 *
	gv
 = (Vdbe*)
pStmt
;

68739  
	gv
!=0 && 
v
->
pc
>=0 && v->
magic
==
VDBE_MAGIC_RUN
;

68748 
SQLITE_API
 
sql™e3_¡mt
 *
sql™e3_Ãxt_¡mt
(
sql™e3
 *
pDb
, sql™e3_¡mˆ*
pStmt
){

68749 
sql™e3_¡mt
 *
	gpNext
;

68750 
sql™e3_mu‹x_’‹r
(
pDb
->
mu‹x
);

68751 ifÐ
	gpStmt
==0 ){

68752 
pNext
 = (
sql™e3_¡mt
*)
pDb
->
pVdbe
;

68754 
	gpNext
 = (
sql™e3_¡mt
*)((
Vdbe
*)
pStmt
)->
pNext
;

68756 
sql™e3_mu‹x_Ëave
(
pDb
->
mu‹x
);

68757  
	gpNext
;

68763 
SQLITE_API
 
sql™e3_¡mt_¡©us
(
sql™e3_¡mt
 *
pStmt
, 
Ý
, 
»£tFÏg
){

68764 
Vdbe
 *
	gpVdbe
 = (Vdbe*)
pStmt
;

68765 
u32
 
	gv
 = 
pVdbe
->
aCouÁ”
[
Ý
];

68766 ifÐ
	g»£tFÏg
 ) 
	gpVdbe
->
	gaCouÁ”
[
Ý
] = 0;

68767  ()
	gv
;

68790 #iâdeà
SQLITE_OMIT_TRACE


68798 
fšdNextHo¡P¬am‘”
(cÚ¡ *
zSql
, *
²Tok’
){

68799 
	gtok’Ty³
;

68800 
	gnTÙ®
 = 0;

68801 
	gn
;

68803 *
	g²Tok’
 = 0;

68804  
	gzSql
[0] ){

68805 
	gn
 = 
sql™e3G‘Tok’
((
u8
*)
zSql
, &
tok’Ty³
);

68806 
as£¹
Ð
n
>0 && 
tok’Ty³
!=
TK_ILLEGAL
 );

68807 ifÐ
	gtok’Ty³
==
TK_VARIABLE
 ){

68808 *
²Tok’
 = 
n
;

68811 
	gnTÙ®
 +ð
n
;

68812 
	gzSql
 +ð
n
;

68814  
	gnTÙ®
;

68841 
SQLITE_PRIVATE
 *
sql™e3VdbeEx·ndSql
(

68842 
Vdbe
 *
p
,

68843 cÚ¡ *
zRawSql


68845 
sql™e3
 *
	gdb
;

68846 
	gidx
 = 0;

68847 
	gÃxtIndex
 = 1;

68848 
	gn
;

68849 
	gnTok’
;

68850 
	gi
;

68851 
Mem
 *
	gpV¬
;

68852 
SŒAccum
 
	gout
;

68853 
	gzBa£
[100];

68855 
	gdb
 = 
p
->
db
;

68856 
sql™e3SŒAccumIn™
(&
out
, 
zBa£
, (zBase),

68857 
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
]);

68858 
	gout
.
	gdb
 = 
db
;

68859 ifÐ
	gdb
->
	gnVdbeExec
>1 ){

68860  *
	gzRawSql
 ){

68861 cÚ¡ *
	gzS¹
 = 
zRawSql
;

68862  *(
	gzRawSql
++)!='\n' && *
zRawSql
 );

68863 
sql™e3SŒAccumAµ’d
(&
out
, "-- ", 3);

68864 
as£¹
Ð(
zRawSql
 - 
zS¹
) > 0 );

68865 
sql™e3SŒAccumAµ’d
(&
out
, 
zS¹
, ()(
zRawSql
-zStart));

68868  
	gzRawSql
[0] ){

68869 
	gn
 = 
fšdNextHo¡P¬am‘”
(
zRawSql
, &
nTok’
);

68870 
as£¹
Ð
n
>0 );

68871 
sql™e3SŒAccumAµ’d
(&
out
, 
zRawSql
, 
n
);

68872 
	gzRawSql
 +ð
n
;

68873 
as£¹
Ð
zRawSql
[0] || 
nTok’
==0 );

68874 ifÐ
	gnTok’
==0 ) ;

68875 ifÐ
	gzRawSql
[0]=='?' ){

68876 ifÐ
nTok’
>1 ){

68877 
as£¹
Ð
sql™e3Isdig™
(
zRawSql
[1]) );

68878 
sql™e3G‘IÁ32
(&
zRawSql
[1], &
idx
);

68880 
	gidx
 = 
ÃxtIndex
;

68883 
as£¹
Ð
zRawSql
[0]==':' || zRawSql[0]=='$' || zRawSql[0]=='@' );

68884 
‹¡ÿ£
Ð
zRawSql
[0]==':' );

68885 
‹¡ÿ£
Ð
zRawSql
[0]=='$' );

68886 
‹¡ÿ£
Ð
zRawSql
[0]=='@' );

68887 
	gidx
 = 
sql™e3VdbeP¬am‘”Index
(
p
, 
zRawSql
, 
nTok’
);

68888 
as£¹
Ð
idx
>0 );

68890 
	gzRawSql
 +ð
nTok’
;

68891 
	gÃxtIndex
 = 
idx
 + 1;

68892 
as£¹
Ð
idx
>0 && idx<=
p
->
nV¬
 );

68893 
	gpV¬
 = &
p
->
aV¬
[
idx
-1];

68894 ifÐ
	gpV¬
->
	gæags
 & 
	gMEM_NuÎ
 ){

68895 
sql™e3SŒAccumAµ’d
(&
out
, "NULL", 4);

68896 }ifÐ
	gpV¬
->
	gæags
 & 
	gMEM_IÁ
 ){

68897 
sql™e3XPrštf
(&
out
, 0, "%Îd", 
pV¬
->
u
.
i
);

68898 }ifÐ
	gpV¬
->
	gæags
 & 
	gMEM_R—l
 ){

68899 
sql™e3XPrštf
(&
out
, 0, "%!.15g", 
pV¬
->
u
.
r
);

68900 }ifÐ
	gpV¬
->
	gæags
 & 
	gMEM_SŒ
 ){

68901 
	gnOut
;

68902 #iâdeà
SQLITE_OMIT_UTF16


68903 
u8
 
	g’c
 = 
ENC
(
db
);

68904 
Mem
 
	gutf8
;

68905 ifÐ
	g’c
!=
SQLITE_UTF8
 ){

68906 
mem£t
(&
utf8
, 0, (utf8));

68907 
	gutf8
.
	gdb
 = 
db
;

68908 
sql™e3VdbeMemS‘SŒ
(&
utf8
, 
pV¬
->
z
,…V¬->
n
, 
’c
, 
SQLITE_STATIC
);

68909 
sql™e3VdbeChªgeEncodšg
(&
utf8
, 
SQLITE_UTF8
);

68910 
	gpV¬
 = &
utf8
;

68913 
	gnOut
 = 
pV¬
->
n
;

68914 #ifdeà
SQLITE_TRACE_SIZE_LIMIT


68915 ifÐ
	gnOut
>
	gSQLITE_TRACE_SIZE_LIMIT
 ){

68916 
	gnOut
 = 
SQLITE_TRACE_SIZE_LIMIT
;

68917  
	gnOut
<
	gpV¬
->
	gn
 && (pV¬->
	gz
[
nOut
]&0xc0)==0x80 ){‚Out++; }

68920 
sql™e3XPrštf
(&
out
, 0, "'%.*q'", 
nOut
, 
pV¬
->
z
);

68921 #ifdeà
SQLITE_TRACE_SIZE_LIMIT


68922 ifÐ
	gnOut
<
	gpV¬
->
	gn
 ){

68923 
sql™e3XPrštf
(&
out
, 0, "/*+%d by‹s*/", 
pV¬
->
n
-
nOut
);

68926 #iâdeà
SQLITE_OMIT_UTF16


68927 ifÐ
	g’c
!=
SQLITE_UTF8
 ) 
sql™e3VdbeMemR–—£
(&
utf8
);

68929 }ifÐ
	gpV¬
->
	gæags
 & 
	gMEM_Z”o
 ){

68930 
sql™e3XPrštf
(&
out
, 0, "z”oblob(%d)", 
pV¬
->
u
.
nZ”o
);

68932 
	gnOut
;

68933 
as£¹
Ð
pV¬
->
æags
 & 
MEM_Blob
 );

68934 
sql™e3SŒAccumAµ’d
(&
out
, "x'", 2);

68935 
	gnOut
 = 
pV¬
->
n
;

68936 #ifdeà
SQLITE_TRACE_SIZE_LIMIT


68937 ifÐ
	gnOut
>
	gSQLITE_TRACE_SIZE_LIMIT
 )‚Ouˆð
SQLITE_TRACE_SIZE_LIMIT
;

68939 
	gi
=0; i<
	gnOut
; i++){

68940 
sql™e3XPrštf
(&
out
, 0, "%02x", 
pV¬
->
z
[
i
]&0xff);

68942 
sql™e3SŒAccumAµ’d
(&
out
, "'", 1);

68943 #ifdeà
SQLITE_TRACE_SIZE_LIMIT


68944 ifÐ
	gnOut
<
	gpV¬
->
	gn
 ){

68945 
sql™e3XPrštf
(&
out
, 0, "/*+%d by‹s*/", 
pV¬
->
n
-
nOut
);

68951  
sql™e3SŒAccumFšish
(&
out
);

68988 #ifdeà
SQLITE_DEBUG


68989 
	#memAboutToChªge
(
P
,
M
è
	`sql™e3VdbeMemAboutToChªge
(P,M)

	)

68991 
	#memAboutToChªge
(
P
,
M
)

	)

69001 #ifdeà
SQLITE_TEST


69002 
SQLITE_API
 
	gsql™e3_£¬ch_couÁ
 = 0;

69013 #ifdeà
SQLITE_TEST


69014 
SQLITE_API
 
	gsql™e3_š‹¼u±_couÁ
 = 0;

69024 #ifdeà
SQLITE_TEST


69025 
SQLITE_API
 
	gsql™e3_sÜt_couÁ
 = 0;

69035 #ifdeà
SQLITE_TEST


69036 
SQLITE_API
 
	gsql™e3_max_blobsize
 = 0;

69037 
upd©eMaxBlobsize
(
Mem
 *
p
){

69038 ifÐ(
	gp
->
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
))!=0 && 
p
->
n
>
sql™e3_max_blobsize
 ){

69039 
sql™e3_max_blobsize
 = 
p
->
n
;

69051 #ifdeà
SQLITE_TEST


69052 
SQLITE_API
 
	gsql™e3_found_couÁ
 = 0;

69059 #ià
defšed
(
SQLITE_TEST
è&& !defšed(
SQLITE_OMIT_BUILTIN_TEST
)

69060 
	#UPDATE_MAX_BLOBSIZE
(
P
è
	`upd©eMaxBlobsize
(P)

	)

69062 
	#UPDATE_MAX_BLOBSIZE
(
P
)

	)

69081 #ià!
defšed
(
SQLITE_VDBE_COVERAGE
)

69082 
	#VdbeB¿nchTak’
(
I
,
M
)

	)

69084 
	#VdbeB¿nchTak’
(
I
,
M
è
	`vdbeTakeB¿nch
(
pOp
->
iSrcLše
,I,M)

	)

69085 
vdbeTakeB¿nch
(
iSrcLše
, 
u8
 
I
, u8 
M
){

69086 ifÐ
	giSrcLše
<=2 && 
ALWAYS
(
iSrcLše
>0) ){

69087 
M
 = 
iSrcLše
;

69090 
as£¹
Ð(
M
 & 
I
)==I );

69092 ifÐ
	gsql™e3Glob®CÚfig
.
	gxVdbeB¿nch
==0 ) ;

69093 
	gsql™e3Glob®CÚfig
.
xVdbeB¿nch
(
sql™e3Glob®CÚfig
.
pVdbeB¿nchArg
,

69094 
iSrcLše
,
I
,
M
);

69103 
	#SŒšgify
(
P
, 
’c
) \

69104 if(((
P
)->
æags
&(
MEM_SŒ
|
MEM_Blob
))==0 && 
	`sql™e3VdbeMemSŒšgify
(P,
’c
,0)) \

69105 { 
no_mem
; }

	)

69118 
	#D“phem”®ize
(
P
) \

69119 ifÐ((
P
)->
æags
&
MEM_Ephem
)!=0 \

69120 && 
	`sql™e3VdbeMemMakeWr™—bË
(
P
è){ 
no_mem
;}

	)

69123 
	#isSÜ‹r
(
x
è((x)->
pSÜ‹r
!=0)

	)

69129 
VdbeCursÜ
 *
®loÿ‹CursÜ
(

69130 
Vdbe
 *
p
,

69131 
iCur
,

69132 
nF›ld
,

69133 
iDb
,

69134 
isBŒ“CursÜ


69154 
Mem
 *
	gpMem
 = &
p
->
aMem
[p->
nMem
-
iCur
];

69156 
	gnBy‹
;

69157 
VdbeCursÜ
 *
	gpCx
 = 0;

69158 
	gnBy‹
 =

69159 
ROUND8
((
VdbeCursÜ
)è+ 2*(
u32
)*
nF›ld
 +

69160 (
isBŒ“CursÜ
?
sql™e3BŒ“CursÜSize
():0);

69162 
as£¹
Ð
iCur
<
p
->
nCursÜ
 );

69163 ifÐ
	gp
->
	g­C¤
[
iCur
] ){

69164 
sql™e3VdbeF»eCursÜ
(
p
,…->
­C¤
[
iCur
]);

69165 
	gp
->
	g­C¤
[
iCur
] = 0;

69167 ifÐ
	gSQLITE_OK
==
sql™e3VdbeMemCË¬AndResize
(
pMem
, 
nBy‹
) ){

69168 
	gp
->
	g­C¤
[
iCur
] = 
pCx
 = (
VdbeCursÜ
*)
pMem
->
z
;

69169 
mem£t
(
pCx
, 0, (
VdbeCursÜ
));

69170 
	gpCx
->
	giDb
 = 
iDb
;

69171 
	gpCx
->
	gnF›ld
 = 
nF›ld
;

69172 
	gpCx
->
	gaOff£t
 = &
pCx
->
aTy³
[
nF›ld
];

69173 ifÐ
	gisBŒ“CursÜ
 ){

69174 
	gpCx
->
	gpCursÜ
 = (
BtCursÜ
*)

69175 &
pMem
->
z
[
ROUND8
((
VdbeCursÜ
))+2*(
u32
)*
nF›ld
];

69176 
sql™e3BŒ“CursÜZ”o
(
pCx
->
pCursÜ
);

69179  
	gpCx
;

69197 
­¶yNum”icAffš™y
(
Mem
 *
pRec
, 
bTryFÜIÁ
){

69198 
	grV®ue
;

69199 
i64
 
	giV®ue
;

69200 
u8
 
	g’c
 = 
pRec
->
’c
;

69201 
as£¹
Ð(
pRec
->
æags
 & (
MEM_SŒ
|
MEM_IÁ
|
MEM_R—l
))==MEM_Str );

69202 ifÐ
sql™e3AtoF
(
pRec
->
z
, &
rV®ue
,…Rec->
n
, 
’c
)==0 ) ;

69203 ifÐ0==
sql™e3Atoi64
(
pRec
->
z
, &
iV®ue
,…Rec->
n
, 
’c
) ){

69204 
	gpRec
->
	gu
.
	gi
 = 
iV®ue
;

69205 
	gpRec
->
	gæags
 |ð
MEM_IÁ
;

69207 
	gpRec
->
	gu
.
	gr
 = 
rV®ue
;

69208 
	gpRec
->
	gæags
 |ð
MEM_R—l
;

69209 ifÐ
	gbTryFÜIÁ
 ) 
sql™e3VdbeIÁeg”Affš™y
(
pRec
);

69231 
­¶yAffš™y
(

69232 
Mem
 *
pRec
,

69233 
affš™y
,

69234 
u8
 
’c


69236 ifÐ
	gaffš™y
>=
SQLITE_AFF_NUMERIC
 ){

69237 
as£¹
Ð
affš™y
==
SQLITE_AFF_INTEGER
 ||‡ffš™y==
SQLITE_AFF_REAL


69238 || 
affš™y
==
SQLITE_AFF_NUMERIC
 );

69239 ifÐ(
	gpRec
->
	gæags
 & 
	gMEM_IÁ
)==0 ){

69240 ifÐ(
pRec
->
æags
 & 
MEM_R—l
)==0 ){

69241 ifÐ
pRec
->
æags
 & 
MEM_SŒ
 ) 
­¶yNum”icAffš™y
(pRec,1);

69243 
sql™e3VdbeIÁeg”Affš™y
(
pRec
);

69246 }ifÐ
	gaffš™y
==
SQLITE_AFF_TEXT
 ){

69251 ifÐ0==(
pRec
->
æags
&
MEM_SŒ
è&& (pRec->æags&(
MEM_R—l
|
MEM_IÁ
)) ){

69252 
sql™e3VdbeMemSŒšgify
(
pRec
, 
’c
, 1);

69263 
SQLITE_API
 
sql™e3_v®ue_num”ic_ty³
(
sql™e3_v®ue
 *
pV®
){

69264 
	geTy³
 = 
sql™e3_v®ue_ty³
(
pV®
);

69265 ifÐ
	geTy³
==
SQLITE_TEXT
 ){

69266 
Mem
 *
pMem
 = (Mem*)
pV®
;

69267 
­¶yNum”icAffš™y
(
pMem
, 0);

69268 
	geTy³
 = 
sql™e3_v®ue_ty³
(
pV®
);

69270  
	geTy³
;

69277 
SQLITE_PRIVATE
 
sql™e3V®ueAµlyAffš™y
(

69278 
sql™e3_v®ue
 *
pV®
,

69279 
u8
 
affš™y
,

69280 
u8
 
’c


69282 
­¶yAffš™y
((
Mem
 *)
pV®
, 
affš™y
, 
’c
);

69291 
u16
 
SQLITE_NOINLINE
 
compu‹Num”icTy³
(
Mem
 *
pMem
){

69292 
as£¹
Ð(
pMem
->
æags
 & (
MEM_IÁ
|
MEM_R—l
))==0 );

69293 
as£¹
Ð(
pMem
->
æags
 & (
MEM_SŒ
|
MEM_Blob
))!=0 );

69294 ifÐ
sql™e3AtoF
(
pMem
->
z
, &pMem->
u
.
r
,…Mem->
n
,…Mem->
’c
)==0 ){

69297 ifÐ
sql™e3Atoi64
(
pMem
->
z
, &pMem->
u
.
i
,…Mem->
n
,…Mem->
’c
)==
SQLITE_OK
 ){

69298  
MEM_IÁ
;

69300  
	gMEM_R—l
;

69310 
u16
 
num”icTy³
(
Mem
 *
pMem
){

69311 ifÐ
	gpMem
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
) ){

69312  
	gpMem
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
);

69314 ifÐ
	gpMem
->
	gæags
 & (
	gMEM_SŒ
|
	gMEM_Blob
) ){

69315  
compu‹Num”icTy³
(
pMem
);

69320 #ifdeà
SQLITE_DEBUG


69325 
SQLITE_PRIVATE
 
sql™e3VdbeMemP»‰yPršt
(
Mem
 *
pMem
, *
zBuf
){

69326 *
	gzC¤
 = 
zBuf
;

69327 
	gf
 = 
pMem
->
æags
;

69329 cÚ¡ *cÚ¡ 
	g’úames
[] = {"(X)", "(8)", "(16LE)", "(16BE)"};

69331 ifÐ
	gf
&
	gMEM_Blob
 ){

69332 
	gi
;

69333 
	gc
;

69334 ifÐ
	gf
 & 
	gMEM_Dyn
 ){

69335 
	gc
 = 'z';

69336 
as£¹
Ð(
f
 & (
MEM_Stic
|
MEM_Ephem
))==0 );

69337 }ifÐ
	gf
 & 
	gMEM_Stic
 ){

69338 
	gc
 = 't';

69339 
as£¹
Ð(
f
 & (
MEM_Dyn
|
MEM_Ephem
))==0 );

69340 }ifÐ
	gf
 & 
	gMEM_Ephem
 ){

69341 
	gc
 = 'e';

69342 
as£¹
Ð(
f
 & (
MEM_Stic
|
MEM_Dyn
))==0 );

69344 
	gc
 = 's';

69347 
sql™e3_¢´štf
(100, 
zC¤
, "%c", 
c
);

69348 
	gzC¤
 +ð
sql™e3SŒËn30
(
zC¤
);

69349 
sql™e3_¢´štf
(100, 
zC¤
, "%d[", 
pMem
->
n
);

69350 
	gzC¤
 +ð
sql™e3SŒËn30
(
zC¤
);

69351 
	gi
=0; i<16 && i<
	gpMem
->
	gn
; i++){

69352 
sql™e3_¢´štf
(100, 
zC¤
, "%02X", (()
pMem
->
z
[
i
] & 0xFF));

69353 
	gzC¤
 +ð
sql™e3SŒËn30
(
zC¤
);

69355 
	gi
=0; i<16 && i<
	gpMem
->
	gn
; i++){

69356 
	gz
 = 
pMem
->
z
[
i
];

69357 ifÐ
	gz
<32 || z>126 ) *
	gzC¤
++ = '.';

69358 *
	gzC¤
++ = 
z
;

69361 
sql™e3_¢´štf
(100, 
zC¤
, "]%s", 
’úames
[
pMem
->
’c
]);

69362 
	gzC¤
 +ð
sql™e3SŒËn30
(
zC¤
);

69363 ifÐ
	gf
 & 
	gMEM_Z”o
 ){

69364 
sql™e3_¢´štf
(100, 
zC¤
,"+%dz",
pMem
->
u
.
nZ”o
);

69365 
	gzC¤
 +ð
sql™e3SŒËn30
(
zC¤
);

69367 *
	gzC¤
 = '\0';

69368 }ifÐ
	gf
 & 
	gMEM_SŒ
 ){

69369 
	gj
, 
	gk
;

69370 
	gzBuf
[0] = ' ';

69371 ifÐ
	gf
 & 
	gMEM_Dyn
 ){

69372 
	gzBuf
[1] = 'z';

69373 
as£¹
Ð(
f
 & (
MEM_Stic
|
MEM_Ephem
))==0 );

69374 }ifÐ
	gf
 & 
	gMEM_Stic
 ){

69375 
	gzBuf
[1] = 't';

69376 
as£¹
Ð(
f
 & (
MEM_Dyn
|
MEM_Ephem
))==0 );

69377 }ifÐ
	gf
 & 
	gMEM_Ephem
 ){

69378 
	gzBuf
[1] = 'e';

69379 
as£¹
Ð(
f
 & (
MEM_Stic
|
MEM_Dyn
))==0 );

69381 
	gzBuf
[1] = 's';

69383 
	gk
 = 2;

69384 
sql™e3_¢´štf
(100, &
zBuf
[
k
], "%d", 
pMem
->
n
);

69385 
	gk
 +ð
sql™e3SŒËn30
(&
zBuf
[
k
]);

69386 
	gzBuf
[
k
++] = '[';

69387 
	gj
=0; j<15 && j<
	gpMem
->
	gn
; j++){

69388 
u8
 
	gc
 = 
pMem
->
z
[
j
];

69389 ifÐ
	gc
>=0x20 && 
c
<0x7f ){

69390 
zBuf
[
k
++] = 
c
;

69392 
	gzBuf
[
k
++] = '.';

69395 
	gzBuf
[
k
++] = ']';

69396 
sql™e3_¢´štf
(100,&
zBuf
[
k
], 
’úames
[
pMem
->
’c
]);

69397 
	gk
 +ð
sql™e3SŒËn30
(&
zBuf
[
k
]);

69398 
	gzBuf
[
k
++] = 0;

69403 #ifdeà
SQLITE_DEBUG


69407 
memT¿ûPršt
(
Mem
 *
p
){

69408 ifÐ
	gp
->
	gæags
 & 
	gMEM_Undefšed
 ){

69409 
´štf
(" undefined");

69410 }ifÐ
	gp
->
	gæags
 & 
	gMEM_NuÎ
 ){

69411 
´štf
(" NULL");

69412 }ifÐ(
	gp
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_SŒ
))==(
MEM_IÁ
|
MEM_SŒ
) ){

69413 
´štf
(" si:%Îd", 
p
->
u
.
i
);

69414 }ifÐ
	gp
->
	gæags
 & 
	gMEM_IÁ
 ){

69415 
´štf
(" i:%Îd", 
p
->
u
.
i
);

69416 #iâdeà
SQLITE_OMIT_FLOATING_POINT


69417 }ifÐ
	gp
->
	gæags
 & 
	gMEM_R—l
 ){

69418 
´štf
("„:%g", 
p
->
u
.
r
);

69420 }ifÐ
	gp
->
	gæags
 & 
	gMEM_RowS‘
 ){

69421 
´štf
(" (rowset)");

69423 
	gzBuf
[200];

69424 
sql™e3VdbeMemP»‰yPršt
(
p
, 
zBuf
);

69425 
´štf
(" %s", 
zBuf
);

69428 
»gi¡”T¿û
(
iReg
, 
Mem
 *
p
){

69429 
´štf
("REG[%d] = ", 
iReg
);

69430 
memT¿ûPršt
(
p
);

69431 
´štf
("\n");

69435 #ifdeà
SQLITE_DEBUG


69436 
	#REGISTER_TRACE
(
R
,
M
èif(
db
->
æags
&
SQLITE_VdbeT¿û
)
	`»gi¡”T¿û
(R,M)

	)

69438 
	#REGISTER_TRACE
(
R
,
M
)

	)

69442 #ifdeà
VDBE_PROFILE


69465 #iâdeà
_HWTIME_H_


69466 
	#_HWTIME_H_


	)

69474 #ià(
defšed
(
__GNUC__
è|| defšed(
_MSC_VER
)) && \

69475 (
defšed
(
i386
è|| defšed(
__i386__
è|| defšed(
_M_IX86
))

69477 #ià
defšed
(
__GNUC__
)

69479 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

69480 
	glo
, 
	ghi
;

69481 
__asm__
 
__vÞ©že__
 ("rdtsc" : "÷" (
lo
), "=d" (
hi
));

69482  (
	gsql™e_ušt64
)
	ghi
 << 32 | 
	glo
;

69485 #–ià
defšed
(
_MSC_VER
)

69487 
__deþ¥ec
(
Çked
è
__šlše
 
sql™e_ušt64
 
__cdeþ
 
sql™e3Hwtime
(){

69488 
	g__asm
 {

69489 
rdtsc


69490 
	g»t
 ;  
v®ue
 
©
 
	gEDX
:
EAX


69496 #–ià(
defšed
(
__GNUC__
è&& defšed(
__x86_64__
))

69498 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

69499 
v®
;

69500 
__asm__
 
__vÞ©že__
 ("rdtsc" : "=A" (
v®
));

69501  
	gv®
;

69504 #–ià(
defšed
(
__GNUC__
è&& defšed(
__µc__
))

69506 
__šlše__
 
sql™e_ušt64
 
sql™e3Hwtime
(){

69507 
	g»tv®
;

69508 
	gjunk
;

69509 
__asm__
 
__vÞ©že__
 ("\n\
1: mftbu %1\n\
 %L0\n\
 %0\n\
 %0,%1\n\
 1b"

69515 : "ô" (
»tv®
), "ô" (
junk
));

69516  
	g»tv®
;

69521 #”rÜ 
N“d
 
im¶em’tiÚ
 
of
 
sql™e3Hwtime
(è
your
 
¶©fÜm
.

69530 
SQLITE_PRIVATE
 
sql™e_ušt64
 
sql™e3Hwtime
(){  ((
	gsql™e_ušt64
)0); }

69541 #iâdeà
NDEBUG


69552 
checkSav•oštCouÁ
(
sql™e3
 *
db
){

69553 
	gn
 = 0;

69554 
Sav•ošt
 *
	gp
;

69555 
	gp
=
db
->
pSav•ošt
;…;…=
p
->
pNext
è
n
++;

69556 
as£¹
Ð
n
==(
db
->
nSav•ošt
 + db->
isT¿n§ùiÚSav•ošt
) );

69566 
SQLITE_PRIVATE
 
sql™e3VdbeExec
(

69567 
Vdbe
 *
p


69569 
	gpc
=0;

69570 
Op
 *
	gaOp
 = 
p
->
aOp
;

69571 
Op
 *
	gpOp
;

69572 
	grc
 = 
SQLITE_OK
;

69573 
sql™e3
 *
	gdb
 = 
p
->
db
;

69574 
u8
 
	g»£tSchemaOnFauÉ
 = 0;

69575 
u8
 
	g’codšg
 = 
ENC
(
db
);

69576 
	giCom·»
 = 0;

69577 
	gnVmS‹p
 = 0;

69578 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


69579 
	gnProg»ssLim™
 = 0;

69581 
Mem
 *
	gaMem
 = 
p
->
aMem
;

69582 
Mem
 *
	gpIn1
 = 0;

69583 
Mem
 *
	gpIn2
 = 0;

69584 
Mem
 *
	gpIn3
 = 0;

69585 
Mem
 *
	gpOut
 = 0;

69586 *
	gaP”mu‹
 = 0;

69587 
i64
 
	gÏ¡Rowid
 = 
db
->
Ï¡Rowid
;

69588 #ifdeà
VDBE_PROFILE


69589 
u64
 
	g¡¬t
;

69593 
as£¹
Ð
p
->
magic
==
VDBE_MAGIC_RUN
 );

69594 
sql™e3VdbeEÁ”
(
p
);

69595 ifÐ
	gp
->
	grc
==
SQLITE_NOMEM
 ){

69598 
no_mem
;

69600 
as£¹
Ð
p
->
rc
==
SQLITE_OK
 ||…->rc==
SQLITE_BUSY
 );

69601 
as£¹
Ð
p
->
bIsR—d”
 ||…->
»adOÆy
!=0 );

69602 
	gp
->
	grc
 = 
SQLITE_OK
;

69603 
	gp
->
	giCu¼’tTime
 = 0;

69604 
as£¹
Ð
p
->
ex¶aš
==0 );

69605 
	gp
->
	gpResuÉS‘
 = 0;

69606 
	gdb
->
	gbusyHªdËr
.
	gnBusy
 = 0;

69607 ifÐ
	gdb
->
	gu1
.
	gisIÁ”ru±ed
 ) 
	gabÜt_due_to_š‹¼u±
;

69608 
sql™e3VdbeIOT¿ûSql
(
p
);

69609 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


69610 ifÐ
	gdb
->
	gxProg»ss
 ){

69611 
as£¹
Ð0 < 
db
->
nProg»ssOps
 );

69612 
	gnProg»ssLim™
 = ()
p
->
aCouÁ”
[
SQLITE_STMTSTATUS_VM_STEP
];

69613 ifÐ
	gnProg»ssLim™
==0 ){

69614 
nProg»ssLim™
 = 
db
->
nProg»ssOps
;

69616 
	gnProg»ssLim™
 %ð()
db
->
nProg»ssOps
;

69620 #ifdeà
SQLITE_DEBUG


69621 
sql™e3BegšB’ignM®loc
();

69622 ifÐ
	gp
->
	gpc
==0

69623 && (
p
->
db
->
æags
 & (
SQLITE_VdbeLi¡šg
|
SQLITE_VdbeEQP
|
SQLITE_VdbeT¿û
))!=0

69625 
i
;

69626 
	gÚû
 = 1;

69627 
sql™e3VdbePrštSql
(
p
);

69628 ifÐ
	gp
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeLi¡šg
 ){

69629 
´štf
("VDBE Program Listing:\n");

69630 
	gi
=0; i<
	gp
->
	gnOp
; i++){

69631 
sql™e3VdbePrštOp
(
¡dout
, 
i
, &
aOp
[i]);

69634 ifÐ
	gp
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeEQP
 ){

69635 
	gi
=0; i<
	gp
->
	gnOp
; i++){

69636 ifÐ
	gaOp
[
i
].
	gÝcode
==
OP_Ex¶aš
 ){

69637 ifÐ
Úû
 ) 
´štf
("VDBE Query Plan:\n");

69638 
´štf
("%s\n", 
aOp
[
i
].
p4
.
z
);

69639 
	gÚû
 = 0;

69643 ifÐ
	gp
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeT¿û
 ) 
´štf
("VDBE Trace:\n");

69645 
sql™e3EndB’ignM®loc
();

69647 
	gpc
=
p
->
pc
; 
	grc
==
SQLITE_OK
;…c++){

69648 
as£¹
Ð
pc
>=0 &&…c<
p
->
nOp
 );

69649 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gno_mem
;

69650 #ifdeà
VDBE_PROFILE


69651 
	g¡¬t
 = 
sql™e3Hwtime
();

69653 
	gnVmS‹p
++;

69654 
	gpOp
 = &
aOp
[
pc
];

69658 #ifdeà
SQLITE_DEBUG


69659 ifÐ
	gdb
->
	gæags
 & 
	gSQLITE_VdbeT¿û
 ){

69660 
sql™e3VdbePrštOp
(
¡dout
, 
pc
, 
pOp
);

69668 #ifdeà
SQLITE_TEST


69669 ifÐ
	gsql™e3_š‹¼u±_couÁ
>0 ){

69670 
	gsql™e3_š‹¼u±_couÁ
--;

69671 ifÐ
	gsql™e3_š‹¼u±_couÁ
==0 ){

69672 
sql™e3_š‹¼u±
(
db
);

69682 
as£¹
Ð
pOp
->
Ýæags
==
sql™e3OpcodePrÝ”ty
[pOp->
Ýcode
] );

69683 ifÐ
	gpOp
->
	gÝæags
 & 
	gOPFLG_OUT2_PRERELEASE
 ){

69684 
as£¹
Ð
pOp
->
p2
>0 );

69685 
as£¹
Ð
pOp
->
p2
<=(
p
->
nMem
-p->
nCursÜ
) );

69686 
	gpOut
 = &
aMem
[
pOp
->
p2
];

69687 
memAboutToChªge
(
p
, 
pOut
);

69688 ifÐ
VdbeMemDyÇmic
(
pOut
èè
sql™e3VdbeMemS‘NuÎ
(pOut);

69689 
	gpOut
->
	gæags
 = 
MEM_IÁ
;

69693 #ifdeà
SQLITE_DEBUG


69694 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_IN1
)!=0 ){

69695 
as£¹
Ð
pOp
->
p1
>0 );

69696 
as£¹
Ð
pOp
->
p1
<=(
p
->
nMem
-p->
nCursÜ
) );

69697 
as£¹
Ð
memIsV®id
(&
aMem
[
pOp
->
p1
]) );

69698 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(&
aMem
[
pOp
->
p1
]) );

69699 
REGISTER_TRACE
(
pOp
->
p1
, &
aMem
[pOp->p1]);

69701 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_IN2
)!=0 ){

69702 
as£¹
Ð
pOp
->
p2
>0 );

69703 
as£¹
Ð
pOp
->
p2
<=(
p
->
nMem
-p->
nCursÜ
) );

69704 
as£¹
Ð
memIsV®id
(&
aMem
[
pOp
->
p2
]) );

69705 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(&
aMem
[
pOp
->
p2
]) );

69706 
REGISTER_TRACE
(
pOp
->
p2
, &
aMem
[pOp->p2]);

69708 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_IN3
)!=0 ){

69709 
as£¹
Ð
pOp
->
p3
>0 );

69710 
as£¹
Ð
pOp
->
p3
<=(
p
->
nMem
-p->
nCursÜ
) );

69711 
as£¹
Ð
memIsV®id
(&
aMem
[
pOp
->
p3
]) );

69712 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(&
aMem
[
pOp
->
p3
]) );

69713 
REGISTER_TRACE
(
pOp
->
p3
, &
aMem
[pOp->p3]);

69715 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_OUT2
)!=0 ){

69716 
as£¹
Ð
pOp
->
p2
>0 );

69717 
as£¹
Ð
pOp
->
p2
<=(
p
->
nMem
-p->
nCursÜ
) );

69718 
memAboutToChªge
(
p
, &
aMem
[
pOp
->
p2
]);

69720 ifÐ(
	gpOp
->
	gÝæags
 & 
	gOPFLG_OUT3
)!=0 ){

69721 
as£¹
Ð
pOp
->
p3
>0 );

69722 
as£¹
Ð
pOp
->
p3
<=(
p
->
nMem
-p->
nCursÜ
) );

69723 
memAboutToChªge
(
p
, &
aMem
[
pOp
->
p3
]);

69727  
	gpOp
->
	gÝcode
 ){

69776 
	gOP_GÙo
: {

69777 
pc
 = 
pOp
->
p2
 - 1;

69789 
	gcheck_fÜ_š‹¼u±
:

69790 ifÐ
db
->
u1
.
isIÁ”ru±ed
 ) 
abÜt_due_to_š‹¼u±
;

69791 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


69798 ifÐ
	gdb
->
	gxProg»ss
!=0 && 
nVmS‹p
>=
nProg»ssLim™
 ){

69799 
as£¹
Ð
db
->
nProg»ssOps
!=0 );

69800 
	gnProg»ssLim™
 = 
nVmS‹p
 + 
db
->
nProg»ssOps
 - (nVmStep%db->nProgressOps);

69801 ifÐ
	gdb
->
xProg»ss
(
db
->
pProg»ssArg
) ){

69802 
	grc
 = 
SQLITE_INTERRUPT
;

69803 
	gvdbe_”rÜ_h®t
;

69816 
	gOP_Gosub
: {

69817 
as£¹
Ð
pOp
->
p1
>0 &&…Op->p1<=(
p
->
nMem
-p->
nCursÜ
) );

69818 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

69819 
as£¹
Ð
VdbeMemDyÇmic
(
pIn1
)==0 );

69820 
memAboutToChªge
(
p
, 
pIn1
);

69821 
	gpIn1
->
	gæags
 = 
MEM_IÁ
;

69822 
	gpIn1
->
	gu
.
	gi
 = 
pc
;

69823 
REGISTER_TRACE
(
pOp
->
p1
, 
pIn1
);

69824 
	gpc
 = 
pOp
->
p2
 - 1;

69833 
	gOP_R‘uº
: {

69834 
pIn1
 = &
aMem
[
pOp
->
p1
];

69835 
as£¹
Ð
pIn1
->
æags
==
MEM_IÁ
 );

69836 
	gpc
 = ()
pIn1
->
u
.
i
;

69837 
	gpIn1
->
	gæags
 = 
MEM_Undefšed
;

69852 
	gOP_In™CÜoutše
: {

69853 
as£¹
Ð
pOp
->
p1
>0 &&…Op->p1<=(
p
->
nMem
-p->
nCursÜ
) );

69854 
as£¹
Ð
pOp
->
p2
>=0 &&…Op->p2<
p
->
nOp
 );

69855 
as£¹
Ð
pOp
->
p3
>=0 &&…Op->p3<
p
->
nOp
 );

69856 
	gpOut
 = &
aMem
[
pOp
->
p1
];

69857 
as£¹
Ð!
VdbeMemDyÇmic
(
pOut
) );

69858 
	gpOut
->
	gu
.
	gi
 = 
pOp
->
p3
 - 1;

69859 
	gpOut
->
	gæags
 = 
MEM_IÁ
;

69860 ifÐ
	gpOp
->
	gp2
 ) 
	gpc
 = 
pOp
->
p2
 - 1;

69872 
	gOP_EndCÜoutše
: {

69873 
VdbeOp
 *
pC®Ër
;

69874 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

69875 
as£¹
Ð
pIn1
->
æags
==
MEM_IÁ
 );

69876 
as£¹
Ð
pIn1
->
u
.
i
>=0 &&…In1->u.i<
p
->
nOp
 );

69877 
	gpC®Ër
 = &
aOp
[
pIn1
->
u
.
i
];

69878 
as£¹
Ð
pC®Ër
->
Ýcode
==
OP_Y›ld
 );

69879 
as£¹
Ð
pC®Ër
->
p2
>=0 &&…C®Ër->p2<
p
->
nOp
 );

69880 
	gpc
 = 
pC®Ër
->
p2
 - 1;

69881 
	gpIn1
->
	gæags
 = 
MEM_Undefšed
;

69898 
	gOP_Y›ld
: {

69899 
pcDe¡
;

69900 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

69901 
as£¹
Ð
VdbeMemDyÇmic
(
pIn1
)==0 );

69902 
	gpIn1
->
	gæags
 = 
MEM_IÁ
;

69903 
	gpcDe¡
 = ()
pIn1
->
u
.
i
;

69904 
	gpIn1
->
	gu
.
	gi
 = 
pc
;

69905 
REGISTER_TRACE
(
pOp
->
p1
, 
pIn1
);

69906 
	gpc
 = 
pcDe¡
;

69918 
	gOP_H®tIfNuÎ
: {

69919 
pIn3
 = &
aMem
[
pOp
->
p3
];

69920 ifÐ(
	gpIn3
->
	gæags
 & 
	gMEM_NuÎ
)==0 ) ;

69954 
	gOP_H®t
: {

69955 cÚ¡ *
zTy³
;

69956 cÚ¡ *
	gzLogFmt
;

69958 ifÐ
	gpOp
->
	gp1
==
SQLITE_OK
 && 
p
->
pF¿me
 ){

69960 
VdbeF¿me
 *
pF¿me
 = 
p
->pFrame;

69961 
	gp
->
	gpF¿me
 = 
pF¿me
->
pP¬’t
;

69962 
	gp
->
	gnF¿me
--;

69963 
sql™e3VdbeS‘Chªges
(
db
, 
p
->
nChªge
);

69964 
	gpc
 = 
sql™e3VdbeF¿meRe¡Üe
(
pF¿me
);

69965 
	gÏ¡Rowid
 = 
db
->
Ï¡Rowid
;

69966 ifÐ
	gpOp
->
	gp2
==
OE_IgnÜe
 ){

69972 
pc
 = 
p
->
aOp
[pc].
p2
-1;

69974 
	gaOp
 = 
p
->
aOp
;

69975 
	gaMem
 = 
p
->
aMem
;

69978 
	gp
->
	grc
 = 
pOp
->
p1
;

69979 
	gp
->
	g”rÜAùiÚ
 = (
u8
)
pOp
->
p2
;

69980 
	gp
->
	gpc
 = 
pc
;

69981 ifÐ
	gp
->
	grc
 ){

69982 ifÐ
	gpOp
->
	gp5
 ){

69983 cÚ¡ * cÚ¡ 
	gazTy³
[] = { "NOT NULL", "UNIQUE", "CHECK",

69985 
as£¹
Ð
pOp
->
p5
>=1 &&…Op->p5<=4 );

69986 
‹¡ÿ£
Ð
pOp
->
p5
==1 );

69987 
‹¡ÿ£
Ð
pOp
->
p5
==2 );

69988 
‹¡ÿ£
Ð
pOp
->
p5
==3 );

69989 
‹¡ÿ£
Ð
pOp
->
p5
==4 );

69990 
	gzTy³
 = 
azTy³
[
pOp
->
p5
-1];

69992 
	gzTy³
 = 0;

69994 
as£¹
Ð
zTy³
!=0 || 
pOp
->
p4
.
z
!=0 );

69995 
	gzLogFmt
 = "abort‡t %d in [%s]: %s";

69996 ifÐ
	gzTy³
 && 
	gpOp
->
	gp4
.
	gz
 ){

69997 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s constraint failed: %s",

69998 
zTy³
, 
pOp
->
p4
.
z
);

69999 }ifÐ
	gpOp
->
	gp4
.
	gz
 ){

70000 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
pOp
->
p4
.
z
);

70002 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "% cÚ¡¿šˆçžed", 
zTy³
);

70004 
sql™e3_log
(
pOp
->
p1
, 
zLogFmt
, 
pc
, 
p
->
zSql
,…->
zE¼Msg
);

70006 
	grc
 = 
sql™e3VdbeH®t
(
p
);

70007 
as£¹
Ð
rc
==
SQLITE_BUSY
 ||„c==
SQLITE_OK
 ||„c==
SQLITE_ERROR
 );

70008 ifÐ
	grc
==
SQLITE_BUSY
 ){

70009 
p
->
rc
 =„øð
SQLITE_BUSY
;

70011 
as£¹
Ð
rc
==
SQLITE_OK
 || (
p
->rc&0xff)==
SQLITE_CONSTRAINT
 );

70012 
as£¹
Ð
rc
==
SQLITE_OK
 || 
db
->
nDeã¼edCÚs
>0 || db->
nDeã¼edImmCÚs
>0 );

70013 
	grc
 = 
p
->
rc
 ? 
SQLITE_ERROR
 : 
SQLITE_DONE
;

70015 
	gvdbe_»tuº
;

70023 
	gOP_IÁeg”
: {

70024 
pOut
->
u
.
i
 = 
pOp
->
p1
;

70034 
	gOP_IÁ64
: {

70035 
as£¹
Ð
pOp
->
p4
.
pI64
!=0 );

70036 
	gpOut
->
	gu
.
	gi
 = *
pOp
->
p4
.
pI64
;

70040 #iâdeà
SQLITE_OMIT_FLOATING_POINT


70047 
	gOP_R—l
: {

70048 
pOut
->
æags
 = 
MEM_R—l
;

70049 
as£¹
Ð!
sql™e3IsNaN
(*
pOp
->
p4
.
pR—l
) );

70050 
	gpOut
->
	gu
.
	gr
 = *
pOp
->
p4
.
pR—l
;

70063 
	gOP_SŒšg8
: {

70064 
as£¹
Ð
pOp
->
p4
.
z
!=0 );

70065 
	gpOp
->
	gÝcode
 = 
OP_SŒšg
;

70066 
	gpOp
->
	gp1
 = 
sql™e3SŒËn30
(
pOp
->
p4
.
z
);

70068 #iâdeà
SQLITE_OMIT_UTF16


70069 ifÐ
	g’codšg
!=
SQLITE_UTF8
 ){

70070 
rc
 = 
sql™e3VdbeMemS‘SŒ
(
pOut
, 
pOp
->
p4
.
z
, -1, 
SQLITE_UTF8
, 
SQLITE_STATIC
);

70071 ifÐ
	grc
==
SQLITE_TOOBIG
 ) 
too_big
;

70072 ifÐ
	gSQLITE_OK
!=
sql™e3VdbeChªgeEncodšg
(
pOut
, 
’codšg
èè
	gno_mem
;

70073 
as£¹
Ð
pOut
->
szM®loc
>0 &&…Out->
zM®loc
=õOut->
z
 );

70074 
as£¹
Ð
VdbeMemDyÇmic
(
pOut
)==0 );

70075 
	gpOut
->
	gszM®loc
 = 0;

70076 
	gpOut
->
	gæags
 |ð
MEM_Stic
;

70077 ifÐ
	gpOp
->
	gp4ty³
==
P4_DYNAMIC
 ){

70078 
sql™e3DbF»e
(
db
, 
pOp
->
p4
.
z
);

70080 
	gpOp
->
	gp4ty³
 = 
P4_DYNAMIC
;

70081 
	gpOp
->
	gp4
.
	gz
 = 
pOut
->
z
;

70082 
	gpOp
->
	gp1
 = 
pOut
->
n
;

70085 ifÐ
	gpOp
->
	gp1
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

70086 
	gtoo_big
;

70096 
	gOP_SŒšg
: {

70097 
as£¹
Ð
pOp
->
p4
.
z
!=0 );

70098 
	gpOut
->
	gæags
 = 
MEM_SŒ
|
MEM_Stic
|
MEM_T”m
;

70099 
	gpOut
->
	gz
 = 
pOp
->
p4
.
z
;

70100 
	gpOut
->
	gn
 = 
pOp
->
p1
;

70101 
	gpOut
->
	g’c
 = 
’codšg
;

70102 
UPDATE_MAX_BLOBSIZE
(
pOut
);

70118 
	gOP_NuÎ
: {

70119 
út
;

70120 
u16
 
	gnuÎFÏg
;

70121 
	gút
 = 
pOp
->
p3
-pOp->
p2
;

70122 
as£¹
Ð
pOp
->
p3
<=(
p
->
nMem
-p->
nCursÜ
) );

70123 
	gpOut
->
	gæags
 = 
nuÎFÏg
 = 
pOp
->
p1
 ? (
MEM_NuÎ
|
MEM_CË¬ed
) : MEM_Null;

70124  
	gút
>0 ){

70125 
	gpOut
++;

70126 
memAboutToChªge
(
p
, 
pOut
);

70127 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

70128 
	gpOut
->
	gæags
 = 
nuÎFÏg
;

70129 
	gút
--;

70142 
	gOP_SoáNuÎ
: {

70143 
as£¹
Ð
pOp
->
p1
>0 &&…Op->p1<=(
p
->
nMem
-p->
nCursÜ
) );

70144 
	gpOut
 = &
aMem
[
pOp
->
p1
];

70145 
	gpOut
->
	gæags
 = (
pOut
->
æags
|
MEM_NuÎ
)&~
MEM_Undefšed
;

70155 
	gOP_Blob
: {

70156 
as£¹
Ð
pOp
->
p1
 <ð
SQLITE_MAX_LENGTH
 );

70157 
sql™e3VdbeMemS‘SŒ
(
pOut
, 
pOp
->
p4
.
z
,…Op->
p1
, 0, 0);

70158 
	gpOut
->
	g’c
 = 
’codšg
;

70159 
UPDATE_MAX_BLOBSIZE
(
pOut
);

70171 
	gOP_V¬ŸbË
: {

70172 
Mem
 *
pV¬
;

70174 
as£¹
Ð
pOp
->
p1
>0 &&…Op->p1<=
p
->
nV¬
 );

70175 
as£¹
Ð
pOp
->
p4
.
z
==0 ||…Op->p4.z==
p
->
azV¬
[pOp->
p1
-1] );

70176 
	gpV¬
 = &
p
->
aV¬
[
pOp
->
p1
 - 1];

70177 ifÐ
sql™e3VdbeMemTooBig
(
pV¬
) ){

70178 
	gtoo_big
;

70180 
sql™e3VdbeMemSh®lowCÝy
(
pOut
, 
pV¬
, 
MEM_Stic
);

70181 
UPDATE_MAX_BLOBSIZE
(
pOut
);

70194 
	gOP_Move
: {

70195 
n
;

70196 
	gp1
;

70197 
	gp2
;

70199 
	gn
 = 
pOp
->
p3
;

70200 
	gp1
 = 
pOp
->
p1
;

70201 
	gp2
 = 
pOp
->
p2
;

70202 
as£¹
Ð
n
>0 && 
p1
>0 && 
p2
>0 );

70203 
as£¹
Ð
p1
+
n
<=
p2
 ||…2+n<=p1 );

70205 
	gpIn1
 = &
aMem
[
p1
];

70206 
	gpOut
 = &
aMem
[
p2
];

70208 
as£¹
Ð
pOut
<=&
aMem
[(
p
->
nMem
-p->
nCursÜ
)] );

70209 
as£¹
Ð
pIn1
<=&
aMem
[(
p
->
nMem
-p->
nCursÜ
)] );

70210 
as£¹
Ð
memIsV®id
(
pIn1
) );

70211 
memAboutToChªge
(
p
, 
pOut
);

70212 
sql™e3VdbeMemMove
(
pOut
, 
pIn1
);

70213 #ifdeà
SQLITE_DEBUG


70214 ifÐ
	gpOut
->
	gpScÝyFrom
>=&
aMem
[
p1
] && 
pOut
->
pScÝyFrom
<&aMem[p1+
pOp
->
p3
] ){

70215 
pOut
->
pScÝyFrom
 +ð
p1
 - 
pOp
->
p2
;

70218 
REGISTER_TRACE
(
p2
++, 
pOut
);

70219 
	gpIn1
++;

70220 
	gpOut
++;

70221 } --
	gn
 );

70233 
	gOP_CÝy
: {

70234 
n
;

70236 
	gn
 = 
pOp
->
p3
;

70237 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70238 
	gpOut
 = &
aMem
[
pOp
->
p2
];

70239 
as£¹
Ð
pOut
!=
pIn1
 );

70241 
sql™e3VdbeMemSh®lowCÝy
(
pOut
, 
pIn1
, 
MEM_Ephem
);

70242 
D“phem”®ize
(
pOut
);

70243 #ifdeà
SQLITE_DEBUG


70244 
	gpOut
->
	gpScÝyFrom
 = 0;

70246 
REGISTER_TRACE
(
pOp
->
p2
+pOp->
p3
-
n
, 
pOut
);

70247 ifÐ(
	gn
--)==0 ) ;

70248 
	gpOut
++;

70249 
	gpIn1
++;

70267 
	gOP_SCÝy
: {

70268 
pIn1
 = &
aMem
[
pOp
->
p1
];

70269 
	gpOut
 = &
aMem
[
pOp
->
p2
];

70270 
as£¹
Ð
pOut
!=
pIn1
 );

70271 
sql™e3VdbeMemSh®lowCÝy
(
pOut
, 
pIn1
, 
MEM_Ephem
);

70272 #ifdeà
SQLITE_DEBUG


70273 ifÐ
	gpOut
->
	gpScÝyFrom
==0 ) 
pOut
->
pScÝyFrom
 = 
pIn1
;

70287 
	gOP_ResuÉRow
: {

70288 
Mem
 *
pMem
;

70289 
	gi
;

70290 
as£¹
Ð
p
->
nResCÞumn
==
pOp
->
p2
 );

70291 
as£¹
Ð
pOp
->
p1
>0 );

70292 
as£¹
Ð
pOp
->
p1
+pOp->
p2
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

70294 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


70297 ifÐ
	gdb
->
	gxProg»ss
!=0

70298 && 
nVmS‹p
>=
nProg»ssLim™


70299 && 
db
->
xProg»ss
(db->
pProg»ssArg
)!=0

70301 
rc
 = 
SQLITE_INTERRUPT
;

70302 
	gvdbe_”rÜ_h®t
;

70309 ifÐ
	gSQLITE_OK
!=(
rc
 = 
sql™e3VdbeCheckFk
(
p
, 0)) ){

70310 
as£¹
Ð
db
->
æags
&
SQLITE_CouÁRows
 );

70311 
as£¹
Ð
p
->
u£sStmtJouº®
 );

70330 
as£¹
Ð
p
->
iS‹m’t
==0 || 
db
->
æags
&
SQLITE_CouÁRows
 );

70331 
	grc
 = 
sql™e3VdbeClo£S‹m’t
(
p
, 
SAVEPOINT_RELEASE
);

70332 ifÐ
NEVER
(
rc
!=
SQLITE_OK
) ){

70337 
	gp
->
	gÿcheCŒ
 = (
p
->
ÿcheCŒ
 + 2)|1;

70343 
	gpMem
 = 
p
->
pResuÉS‘
 = &
aMem
[
pOp
->
p1
];

70344 
	gi
=0; i<
	gpOp
->
	gp2
; i++){

70345 
as£¹
Ð
memIsV®id
(&
pMem
[
i
]) );

70346 
D“phem”®ize
(&
pMem
[
i
]);

70347 
as£¹
Ð(
pMem
[
i
].
æags
 & 
MEM_Ephem
)==0

70348 || (
pMem
[
i
].
æags
 & (
MEM_SŒ
|
MEM_Blob
))==0 );

70349 
sql™e3VdbeMemNulT”mš©e
(&
pMem
[
i
]);

70350 
REGISTER_TRACE
(
pOp
->
p1
+
i
, &
pMem
[i]);

70352 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gno_mem
;

70356 
	gp
->
	gpc
 = 
pc
 + 1;

70357 
	grc
 = 
SQLITE_ROW
;

70358 
	gvdbe_»tuº
;

70374 
	gOP_CÚÿt
: {

70375 
i64
 
nBy‹
;

70377 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70378 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

70379 
	gpOut
 = &
aMem
[
pOp
->
p3
];

70380 
as£¹
Ð
pIn1
!=
pOut
 );

70381 ifÐ(
	gpIn1
->
	gæags
 | 
	gpIn2
->æagsè& 
	gMEM_NuÎ
 ){

70382 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

70385 ifÐ
Ex·ndBlob
(
pIn1
è|| Ex·ndBlob(
pIn2
èè
	gno_mem
;

70386 
SŒšgify
(
pIn1
, 
’codšg
);

70387 
SŒšgify
(
pIn2
, 
’codšg
);

70388 
	gnBy‹
 = 
pIn1
->
n
 + 
pIn2
->n;

70389 ifÐ
	gnBy‹
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

70390 
	gtoo_big
;

70392 ifÐ
sql™e3VdbeMemGrow
(
pOut
, ()
nBy‹
+2,…Out==
pIn2
) ){

70393 
no_mem
;

70395 
MemS‘Ty³FÏg
(
pOut
, 
MEM_SŒ
);

70396 ifÐ
	gpOut
!=
pIn2
 ){

70397 
memýy
(
pOut
->
z
, 
pIn2
->z,…In2->
n
);

70399 
memýy
(&
pOut
->
z
[
pIn2
->
n
], 
pIn1
->z,…In1->n);

70400 
	gpOut
->
	gz
[
nBy‹
]=0;

70401 
	gpOut
->
	gz
[
nBy‹
+1] = 0;

70402 
	gpOut
->
	gæags
 |ð
MEM_T”m
;

70403 
	gpOut
->
	gn
 = ()
nBy‹
;

70404 
	gpOut
->
	g’c
 = 
’codšg
;

70405 
UPDATE_MAX_BLOBSIZE
(
pOut
);

70447 
	gOP_Add
:

70448 
OP_SubŒaù
:

70449 
OP_MuÉly
:

70450 
OP_Divide
:

70451 
OP_Remašd”
: {

70452 
bIÁšt
;

70453 
u16
 
	gæags
;

70454 
u16
 
	gty³1
;

70455 
u16
 
	gty³2
;

70456 
i64
 
	giA
;

70457 
i64
 
	giB
;

70458 
	grA
;

70459 
	grB
;

70461 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70462 
	gty³1
 = 
num”icTy³
(
pIn1
);

70463 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

70464 
	gty³2
 = 
num”icTy³
(
pIn2
);

70465 
	gpOut
 = &
aMem
[
pOp
->
p3
];

70466 
	gæags
 = 
pIn1
->
æags
 | 
pIn2
->flags;

70467 ifÐ(
	gæags
 & 
	gMEM_NuÎ
)!=0 ) 
¬™hm‘ic_»suÉ_is_nuÎ
;

70468 ifÐ(
	gty³1
 & 
	gty³2
 & 
	gMEM_IÁ
)!=0 ){

70469 
iA
 = 
pIn1
->
u
.
i
;

70470 
	giB
 = 
pIn2
->
u
.
i
;

70471 
	gbIÁšt
 = 1;

70472  
	gpOp
->
	gÝcode
 ){

70473 
	gOP_Add
: ifÐ
sql™e3AddIÁ64
(&
iB
,
iA
èè
	gå_m©h
; ;

70474 
	gOP_SubŒaù
: ifÐ
sql™e3SubIÁ64
(&
iB
,
iA
èè
	gå_m©h
; ;

70475 
	gOP_MuÉly
: ifÐ
sql™e3MulIÁ64
(&
iB
,
iA
èè
	gå_m©h
; ;

70476 
	gOP_Divide
: {

70477 ifÐ
iA
==0 ) 
¬™hm‘ic_»suÉ_is_nuÎ
;

70478 ifÐ
	giA
==-1 && 
iB
==
SMALLEST_INT64
 ) 
å_m©h
;

70479 
	giB
 /ð
iA
;

70483 ifÐ
iA
==0 ) 
¬™hm‘ic_»suÉ_is_nuÎ
;

70484 ifÐ
	giA
==-1 ) 
iA
 = 1;

70485 
	giB
 %ð
iA
;

70489 
	gpOut
->
	gu
.
	gi
 = 
iB
;

70490 
MemS‘Ty³FÏg
(
pOut
, 
MEM_IÁ
);

70492 
	gbIÁšt
 = 0;

70493 
	gå_m©h
:

70494 
rA
 = 
sql™e3VdbeR—lV®ue
(
pIn1
);

70495 
	grB
 = 
sql™e3VdbeR—lV®ue
(
pIn2
);

70496  
	gpOp
->
	gÝcode
 ){

70497 
	gOP_Add
: 
rB
 +ð
rA
; ;

70498 
	gOP_SubŒaù
: 
rB
 -ð
rA
; ;

70499 
	gOP_MuÉly
: 
rB
 *ð
rA
; ;

70500 
	gOP_Divide
: {

70502 ifÐ
rA
==()0 ) 
¬™hm‘ic_»suÉ_is_nuÎ
;

70503 
	grB
 /ð
rA
;

70507 
iA
 = (
i64
)
rA
;

70508 
	giB
 = (
i64
)
rB
;

70509 ifÐ
	giA
==0 ) 
¬™hm‘ic_»suÉ_is_nuÎ
;

70510 ifÐ
	giA
==-1 ) 
iA
 = 1;

70511 
	grB
 = ()(
iB
 % 
iA
);

70515 #ifdeà
SQLITE_OMIT_FLOATING_POINT


70516 
	gpOut
->
	gu
.
	gi
 = 
rB
;

70517 
MemS‘Ty³FÏg
(
pOut
, 
MEM_IÁ
);

70519 ifÐ
sql™e3IsNaN
(
rB
) ){

70520 
	g¬™hm‘ic_»suÉ_is_nuÎ
;

70522 
	gpOut
->
	gu
.
	gr
 = 
rB
;

70523 
MemS‘Ty³FÏg
(
pOut
, 
MEM_R—l
);

70524 ifÐ((
	gty³1
|
	gty³2
)&
	gMEM_R—l
)==0 && !
bIÁšt
 ){

70525 
sql™e3VdbeIÁeg”Affš™y
(
pOut
);

70531 
	g¬™hm‘ic_»suÉ_is_nuÎ
:

70532 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

70551 
	gOP_CÞlSeq
: {

70552 
as£¹
Ð
pOp
->
p4ty³
==
P4_COLLSEQ
 );

70553 ifÐ
	gpOp
->
	gp1
 ){

70554 
sql™e3VdbeMemS‘IÁ64
(&
aMem
[
pOp
->
p1
], 0);

70576 
	gOP_FunùiÚ
: {

70577 
i
;

70578 
Mem
 *
	gpArg
;

70579 
sql™e3_cÚ‹xt
 
	gùx
;

70580 
sql™e3_v®ue
 **
	g­V®
;

70581 
	gn
;

70583 
	gn
 = 
pOp
->
p5
;

70584 
	g­V®
 = 
p
->
­Arg
;

70585 
as£¹
Ð
­V®
 || 
n
==0 );

70586 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

70587 
	gùx
.
	gpOut
 = &
aMem
[
pOp
->
p3
];

70588 
memAboutToChªge
(
p
, 
ùx
.
pOut
);

70590 
as£¹
Ð
n
==0 || (
pOp
->
p2
>0 &&…Op->p2+n<=(
p
->
nMem
-p->
nCursÜ
)+1) );

70591 
as£¹
Ð
pOp
->
p3
<pOp->
p2
 ||…Op->p3>õOp->p2+
n
 );

70592 
	gpArg
 = &
aMem
[
pOp
->
p2
];

70593 
	gi
=0; i<
	gn
; i++, 
	gpArg
++){

70594 
as£¹
Ð
memIsV®id
(
pArg
) );

70595 
	g­V®
[
i
] = 
pArg
;

70596 
D“phem”®ize
(
pArg
);

70597 
REGISTER_TRACE
(
pOp
->
p2
+
i
, 
pArg
);

70600 
as£¹
Ð
pOp
->
p4ty³
==
P4_FUNCDEF
 );

70601 
	gùx
.
	gpFunc
 = 
pOp
->
p4
.
pFunc
;

70602 
	gùx
.
	giOp
 = 
pc
;

70603 
	gùx
.
	gpVdbe
 = 
p
;

70604 
MemS‘Ty³FÏg
(
ùx
.
pOut
, 
MEM_NuÎ
);

70605 
	gùx
.
	gfE¼ÜOrAux
 = 0;

70606 
	gdb
->
	gÏ¡Rowid
 = 
Ï¡Rowid
;

70607 (*
	gùx
.
	gpFunc
->
	gxFunc
)(&ùx, 
	gn
, 
	g­V®
);

70608 
	gÏ¡Rowid
 = 
db
->
Ï¡Rowid
;

70611 ifÐ
	gùx
.
	gfE¼ÜOrAux
 ){

70612 ifÐ
	gùx
.
	gisE¼Ü
 ){

70613 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3_v®ue_‹xt
(
ùx
.
pOut
));

70614 
	grc
 = 
ùx
.
isE¼Ü
;

70616 
sql™e3VdbeD–‘eAuxD©a
(
p
, 
pc
, 
pOp
->
p1
);

70620 
sql™e3VdbeChªgeEncodšg
(
ùx
.
pOut
, 
’codšg
);

70621 ifÐ
sql™e3VdbeMemTooBig
(
ùx
.
pOut
) ){

70622 
	gtoo_big
;

70625 
REGISTER_TRACE
(
pOp
->
p3
, 
ùx
.
pOut
);

70626 
UPDATE_MAX_BLOBSIZE
(
ùx
.
pOut
);

70660 
	gOP_B™And
:

70661 
OP_B™Or
:

70662 
OP_ShiáLeá
:

70663 
OP_ShiáRight
: {

70664 
i64
 
iA
;

70665 
u64
 
	guA
;

70666 
i64
 
	giB
;

70667 
u8
 
	gÝ
;

70669 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70670 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

70671 
	gpOut
 = &
aMem
[
pOp
->
p3
];

70672 ifÐ(
	gpIn1
->
	gæags
 | 
	gpIn2
->æagsè& 
	gMEM_NuÎ
 ){

70673 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

70676 
	giA
 = 
sql™e3VdbeIÁV®ue
(
pIn2
);

70677 
	giB
 = 
sql™e3VdbeIÁV®ue
(
pIn1
);

70678 
	gÝ
 = 
pOp
->
Ýcode
;

70679 ifÐ
	gÝ
==
OP_B™And
 ){

70680 
iA
 &ð
iB
;

70681 }ifÐ
	gÝ
==
OP_B™Or
 ){

70682 
iA
 |ð
iB
;

70683 }ifÐ
	giB
!=0 ){

70684 
as£¹
Ð
Ý
==
OP_ShiáRight
 || op==
OP_ShiáLeá
 );

70687 ifÐ
	giB
<0 ){

70688 
as£¹
Ð
OP_ShiáRight
==
OP_ShiáLeá
+1 );

70689 
	gÝ
 = 2*
OP_ShiáLeá
 + 1 - 
Ý
;

70690 
	giB
 = 
iB
>(-64) ? -iB : 64;

70693 ifÐ
	giB
>=64 ){

70694 
iA
 = (iA>=0 || 
Ý
==
OP_ShiáLeá
) ? 0 : -1;

70696 
memýy
(&
uA
, &
iA
, (uA));

70697 ifÐ
	gÝ
==
OP_ShiáLeá
 ){

70698 
uA
 <<ð
iB
;

70700 
	guA
 >>ð
iB
;

70702 ifÐ
	giA
<0 ) 
	guA
 |ð((((
u64
)0xffffffff)<<32)|0xffffffffè<< (64-
iB
);

70704 
memýy
(&
iA
, &
uA
, (iA));

70707 
	gpOut
->
	gu
.
	gi
 = 
iA
;

70708 
MemS‘Ty³FÏg
(
pOut
, 
MEM_IÁ
);

70720 
	gOP_AddImm
: {

70721 
pIn1
 = &
aMem
[
pOp
->
p1
];

70722 
memAboutToChªge
(
p
, 
pIn1
);

70723 
sql™e3VdbeMemIÁeg”ify
(
pIn1
);

70724 
	gpIn1
->
	gu
.
	gi
 +ð
pOp
->
p2
;

70735 
	gOP_Mu¡BeIÁ
: {

70736 
pIn1
 = &
aMem
[
pOp
->
p1
];

70737 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_IÁ
)==0 ){

70738 
­¶yAffš™y
(
pIn1
, 
SQLITE_AFF_NUMERIC
, 
’codšg
);

70739 
VdbeB¿nchTak’
((
pIn1
->
æags
&
MEM_IÁ
)==0, 2);

70740 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_IÁ
)==0 ){

70741 ifÐ
pOp
->
p2
==0 ){

70742 
rc
 = 
SQLITE_MISMATCH
;

70743 
	gabÜt_due_to_”rÜ
;

70745 
	gpc
 = 
pOp
->
p2
 - 1;

70750 
MemS‘Ty³FÏg
(
pIn1
, 
MEM_IÁ
);

70754 #iâdeà
SQLITE_OMIT_FLOATING_POINT


70764 
	gOP_R—lAffš™y
: {

70765 
pIn1
 = &
aMem
[
pOp
->
p1
];

70766 ifÐ
	gpIn1
->
	gæags
 & 
	gMEM_IÁ
 ){

70767 
sql™e3VdbeMemR—lify
(
pIn1
);

70773 #iâdeà
SQLITE_OMIT_CAST


70789 
	gOP_Ca¡
: {

70790 
as£¹
Ð
pOp
->
p2
>=
SQLITE_AFF_NONE
 &&…Op->p2<=
SQLITE_AFF_REAL
 );

70791 
‹¡ÿ£
Ð
pOp
->
p2
==
SQLITE_AFF_TEXT
 );

70792 
‹¡ÿ£
Ð
pOp
->
p2
==
SQLITE_AFF_NONE
 );

70793 
‹¡ÿ£
Ð
pOp
->
p2
==
SQLITE_AFF_NUMERIC
 );

70794 
‹¡ÿ£
Ð
pOp
->
p2
==
SQLITE_AFF_INTEGER
 );

70795 
‹¡ÿ£
Ð
pOp
->
p2
==
SQLITE_AFF_REAL
 );

70796 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70797 
memAboutToChªge
(
p
, 
pIn1
);

70798 
	grc
 = 
Ex·ndBlob
(
pIn1
);

70799 
sql™e3VdbeMemCa¡
(
pIn1
, 
pOp
->
p2
, 
’codšg
);

70800 
UPDATE_MAX_BLOBSIZE
(
pIn1
);

70887 
	gOP_Eq
:

70888 
OP_Ne
:

70889 
OP_Lt
:

70890 
OP_Le
:

70891 
OP_Gt
:

70892 
OP_Ge
: {

70893 
»s
;

70894 
	gaffš™y
;

70895 
u16
 
	gæags1
;

70896 
u16
 
	gæags3
;

70898 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

70899 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

70900 
	gæags1
 = 
pIn1
->
æags
;

70901 
	gæags3
 = 
pIn3
->
æags
;

70902 ifÐ(
	gæags1
 | 
	gæags3
)&
	gMEM_NuÎ
 ){

70904 ifÐ
	gpOp
->
	gp5
 & 
	gSQLITE_NULLEQ
 ){

70909 
as£¹
Ð
pOp
->
Ýcode
==
OP_Eq
 ||…Op->Ýcode==
OP_Ne
 );

70910 
as£¹
Ð(
æags1
 & 
MEM_CË¬ed
)==0 );

70911 
as£¹
Ð(
pOp
->
p5
 & 
SQLITE_JUMPIFNULL
)==0 );

70912 ifÐ(
	gæags1
&
	gMEM_NuÎ
)!=0

70913 && (
æags3
&
MEM_NuÎ
)!=0

70914 && (
æags3
&
MEM_CË¬ed
)==0

70916 
»s
 = 0;

70918 
	g»s
 = 1;

70925 ifÐ
	gpOp
->
	gp5
 & 
	gSQLITE_STOREP2
 ){

70926 
	gpOut
 = &
aMem
[
pOp
->
p2
];

70927 
MemS‘Ty³FÏg
(
pOut
, 
MEM_NuÎ
);

70928 
REGISTER_TRACE
(
pOp
->
p2
, 
pOut
);

70930 
VdbeB¿nchTak’
(2,3);

70931 ifÐ
	gpOp
->
	gp5
 & 
	gSQLITE_JUMPIFNULL
 ){

70932 
	gpc
 = 
pOp
->
p2
-1;

70939 
	gaffš™y
 = 
pOp
->
p5
 & 
SQLITE_AFF_MASK
;

70940 ifÐ
	gaffš™y
>=
SQLITE_AFF_NUMERIC
 ){

70941 ifÐ(
pIn1
->
æags
 & (
MEM_IÁ
|
MEM_R—l
|
MEM_SŒ
))==MEM_Str ){

70942 
­¶yNum”icAffš™y
(
pIn1
,0);

70944 ifÐ(
	gpIn3
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
|
	gMEM_SŒ
))==
MEM_SŒ
 ){

70945 
­¶yNum”icAffš™y
(
pIn3
,0);

70947 }ifÐ
	gaffš™y
==
SQLITE_AFF_TEXT
 ){

70948 ifÐ(
pIn1
->
æags
 & 
MEM_SŒ
)==0 && (pIn1->æag & (
MEM_IÁ
|
MEM_R—l
))!=0 ){

70949 
‹¡ÿ£
Ð
pIn1
->
æags
 & 
MEM_IÁ
 );

70950 
‹¡ÿ£
Ð
pIn1
->
æags
 & 
MEM_R—l
 );

70951 
sql™e3VdbeMemSŒšgify
(
pIn1
, 
’codšg
, 1);

70953 ifÐ(
	gpIn3
->
	gæags
 & 
	gMEM_SŒ
)==0 && (
pIn3
->
æags
 & (
MEM_IÁ
|
MEM_R—l
))!=0 ){

70954 
‹¡ÿ£
Ð
pIn3
->
æags
 & 
MEM_IÁ
 );

70955 
‹¡ÿ£
Ð
pIn3
->
æags
 & 
MEM_R—l
 );

70956 
sql™e3VdbeMemSŒšgify
(
pIn3
, 
’codšg
, 1);

70959 
as£¹
Ð
pOp
->
p4ty³
==
P4_COLLSEQ
 ||…Op->
p4
.
pCÞl
==0 );

70960 ifÐ
	gpIn1
->
	gæags
 & 
	gMEM_Z”o
 ){

70961 
sql™e3VdbeMemEx·ndBlob
(
pIn1
);

70962 
	gæags1
 &ð~
MEM_Z”o
;

70964 ifÐ
	gpIn3
->
	gæags
 & 
	gMEM_Z”o
 ){

70965 
sql™e3VdbeMemEx·ndBlob
(
pIn3
);

70966 
	gæags3
 &ð~
MEM_Z”o
;

70968 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gno_mem
;

70969 
	g»s
 = 
sql™e3MemCom·»
(
pIn3
, 
pIn1
, 
pOp
->
p4
.
pCÞl
);

70971  
	gpOp
->
	gÝcode
 ){

70972 
	gOP_Eq
: 
»s
 =„es==0; ;

70973 
	gOP_Ne
: 
»s
 =„es!=0; ;

70974 
	gOP_Lt
: 
»s
 =„es<0; ;

70975 
	gOP_Le
: 
»s
 =„es<=0; ;

70976 
	gOP_Gt
: 
»s
 =„es>0; ;

70977 : 
»s
 =„es>=0; ;

70980 ifÐ
	gpOp
->
	gp5
 & 
	gSQLITE_STOREP2
 ){

70981 
	gpOut
 = &
aMem
[
pOp
->
p2
];

70982 
memAboutToChªge
(
p
, 
pOut
);

70983 
MemS‘Ty³FÏg
(
pOut
, 
MEM_IÁ
);

70984 
	gpOut
->
	gu
.
	gi
 = 
»s
;

70985 
REGISTER_TRACE
(
pOp
->
p2
, 
pOut
);

70987 
VdbeB¿nchTak’
(
»s
!=0, (
pOp
->
p5
 & 
SQLITE_NULLEQ
)?2:3);

70988 ifÐ
	g»s
 ){

70989 
	gpc
 = 
pOp
->
p2
-1;

70993 
	gpIn1
->
	gæags
 = 
æags1
;

70994 
	gpIn3
->
	gæags
 = 
æags3
;

71007 
	gOP_P”mutiÚ
: {

71008 
as£¹
Ð
pOp
->
p4ty³
==
P4_INTARRAY
 );

71009 
as£¹
Ð
pOp
->
p4
.
ai
 );

71010 
	gaP”mu‹
 = 
pOp
->
p4
.
ai
;

71034 
	gOP_Com·»
: {

71035 
n
;

71036 
	gi
;

71037 
	gp1
;

71038 
	gp2
;

71039 cÚ¡ 
KeyInfo
 *
	gpKeyInfo
;

71040 
	gidx
;

71041 
CÞlSeq
 *
	gpCÞl
;

71042 
	gbRev
;

71044 ifÐ(
	gpOp
->
	gp5
 & 
	gOPFLAG_PERMUTE
)==0 ) 
aP”mu‹
 = 0;

71045 
	gn
 = 
pOp
->
p3
;

71046 
	gpKeyInfo
 = 
pOp
->
p4
.
pKeyInfo
;

71047 
as£¹
Ð
n
>0 );

71048 
as£¹
Ð
pKeyInfo
!=0 );

71049 
	gp1
 = 
pOp
->
p1
;

71050 
	gp2
 = 
pOp
->
p2
;

71051 #ià
SQLITE_DEBUG


71052 ifÐ
	gaP”mu‹
 ){

71053 
	gk
, 
	gmx
 = 0;

71054 
	gk
=0; k<
	gn
; k++èifÐ
	gaP”mu‹
[
k
]>
	gmx
 ) mx = 
aP”mu‹
[k];

71055 
as£¹
Ð
p1
>0 &&…1+
mx
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

71056 
as£¹
Ð
p2
>0 &&…2+
mx
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

71058 
as£¹
Ð
p1
>0 &&…1+
n
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

71059 
as£¹
Ð
p2
>0 &&…2+
n
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

71062 
	gi
=0; i<
	gn
; i++){

71063 
	gidx
 = 
aP”mu‹
 ?‡P”mu‹[
i
] : i;

71064 
as£¹
Ð
memIsV®id
(&
aMem
[
p1
+
idx
]) );

71065 
as£¹
Ð
memIsV®id
(&
aMem
[
p2
+
idx
]) );

71066 
REGISTER_TRACE
(
p1
+
idx
, &
aMem
[p1+idx]);

71067 
REGISTER_TRACE
(
p2
+
idx
, &
aMem
[p2+idx]);

71068 
as£¹
Ð
i
<
pKeyInfo
->
nF›ld
 );

71069 
	gpCÞl
 = 
pKeyInfo
->
aCÞl
[
i
];

71070 
	gbRev
 = 
pKeyInfo
->
aSÜtOrd”
[
i
];

71071 
	giCom·»
 = 
sql™e3MemCom·»
(&
aMem
[
p1
+
idx
], &aMem[
p2
+idx], 
pCÞl
);

71072 ifÐ
	giCom·»
 ){

71073 ifÐ
	gbRev
 ) 
	giCom·»
 = -
iCom·»
;

71077 
	gaP”mu‹
 = 0;

71087 
	gOP_Jump
: {

71088 ifÐ
iCom·»
<0 ){

71089 
pc
 = 
pOp
->
p1
 - 1; 
VdbeB¿nchTak’
(0,3);

71090 }ifÐ
	giCom·»
==0 ){

71091 
pc
 = 
pOp
->
p2
 - 1; 
VdbeB¿nchTak’
(1,3);

71093 
	gpc
 = 
pOp
->
p3
 - 1; 
VdbeB¿nchTak’
(2,3);

71118 
	gOP_And
:

71119 
OP_Or
: {

71120 
v1
;

71121 
	gv2
;

71123 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

71124 ifÐ
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
 ){

71125 
	gv1
 = 2;

71127 
	gv1
 = 
sql™e3VdbeIÁV®ue
(
pIn1
)!=0;

71129 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

71130 ifÐ
	gpIn2
->
	gæags
 & 
	gMEM_NuÎ
 ){

71131 
	gv2
 = 2;

71133 
	gv2
 = 
sql™e3VdbeIÁV®ue
(
pIn2
)!=0;

71135 ifÐ
	gpOp
->
	gÝcode
==
OP_And
 ){

71136 cÚ¡ 
ªd_logic
[] = { 0, 0, 0, 0, 1, 2, 0, 2, 2 };

71137 
	gv1
 = 
ªd_logic
[
v1
*3+
v2
];

71139 cÚ¡ 
	gÜ_logic
[] = { 0, 1, 2, 1, 1, 1, 2, 1, 2 };

71140 
	gv1
 = 
Ü_logic
[
v1
*3+
v2
];

71142 
	gpOut
 = &
aMem
[
pOp
->
p3
];

71143 ifÐ
	gv1
==2 ){

71144 
MemS‘Ty³FÏg
(
pOut
, 
MEM_NuÎ
);

71146 
	gpOut
->
	gu
.
	gi
 = 
v1
;

71147 
MemS‘Ty³FÏg
(
pOut
, 
MEM_IÁ
);

71159 
	gOP_NÙ
: {

71160 
pIn1
 = &
aMem
[
pOp
->
p1
];

71161 
	gpOut
 = &
aMem
[
pOp
->
p2
];

71162 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

71163 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
)==0 ){

71164 
pOut
->
æags
 = 
MEM_IÁ
;

71165 
	gpOut
->
	gu
.
	gi
 = !
sql™e3VdbeIÁV®ue
(
pIn1
);

71177 
	gOP_B™NÙ
: {

71178 
pIn1
 = &
aMem
[
pOp
->
p1
];

71179 
	gpOut
 = &
aMem
[
pOp
->
p2
];

71180 
sql™e3VdbeMemS‘NuÎ
(
pOut
);

71181 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
)==0 ){

71182 
pOut
->
æags
 = 
MEM_IÁ
;

71183 
	gpOut
->
	gu
.
	gi
 = ~
sql™e3VdbeIÁV®ue
(
pIn1
);

71199 
	gOP_Onû
: {

71200 
as£¹
Ð
pOp
->
p1
<
p
->
nOnûFÏg
 );

71201 
VdbeB¿nchTak’
(
p
->
aOnûFÏg
[
pOp
->
p1
]!=0, 2);

71202 ifÐ
	gp
->
	gaOnûFÏg
[
pOp
->
p1
] ){

71203 
	gpc
 = 
pOp
->
p2
-1;

71205 
	gp
->
	gaOnûFÏg
[
pOp
->
p1
] = 1;

71222 
	gOP_If
:

71223 
OP_IfNÙ
: {

71224 
c
;

71225 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

71226 ifÐ
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
 ){

71227 
	gc
 = 
pOp
->
p3
;

71229 #ifdeà
SQLITE_OMIT_FLOATING_POINT


71230 
	gc
 = 
sql™e3VdbeIÁV®ue
(
pIn1
)!=0;

71232 
	gc
 = 
sql™e3VdbeR—lV®ue
(
pIn1
)!=0.0;

71234 ifÐ
	gpOp
->
	gÝcode
==
OP_IfNÙ
 ) 
c
 = !c;

71236 
VdbeB¿nchTak’
(
c
!=0, 2);

71237 ifÐ
	gc
 ){

71238 
	gpc
 = 
pOp
->
p2
-1;

71248 
	gOP_IsNuÎ
: {

71249 
pIn1
 = &
aMem
[
pOp
->
p1
];

71250 
VdbeB¿nchTak’
Ð(
pIn1
->
æags
 & 
MEM_NuÎ
)!=0, 2);

71251 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
)!=0 ){

71252 
pc
 = 
pOp
->
p2
 - 1;

71262 
	gOP_NÙNuÎ
: {

71263 
pIn1
 = &
aMem
[
pOp
->
p1
];

71264 
VdbeB¿nchTak’
Ð(
pIn1
->
æags
 & 
MEM_NuÎ
)==0, 2);

71265 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_NuÎ
)==0 ){

71266 
pc
 = 
pOp
->
p2
 - 1;

71296 
	gOP_CÞumn
: {

71297 
i64
 
·ylßdSize64
;

71298 
	gp2
;

71299 
VdbeCursÜ
 *
	gpC
;

71300 
BtCursÜ
 *
	gpCr¤
;

71301 
u32
 *
	gaOff£t
;

71302 
	gËn
;

71303 
	gi
;

71304 
Mem
 *
	gpDe¡
;

71305 
Mem
 
	gsMem
;

71306 cÚ¡ 
u8
 *
	gzD©a
;

71307 cÚ¡ 
u8
 *
	gzHdr
;

71308 cÚ¡ 
u8
 *
	gzEndHdr
;

71309 
u32
 
	goff£t
;

71310 
u32
 
	gszF›ld
;

71311 
u32
 
	gavaž
;

71312 
u32
 
	gt
;

71313 
u16
 
	gfx
;

71314 
Mem
 *
	gpReg
;

71316 
	gp2
 = 
pOp
->
p2
;

71317 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

71318 
	gpDe¡
 = &
aMem
[
pOp
->
p3
];

71319 
memAboutToChªge
(
p
, 
pDe¡
);

71320 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

71321 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

71322 
as£¹
Ð
pC
!=0 );

71323 
as£¹
Ð
p2
<
pC
->
nF›ld
 );

71324 
	gaOff£t
 = 
pC
->
aOff£t
;

71325 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


71326 
as£¹
Ð
pC
->
pVbCursÜ
==0 );

71328 
	gpCr¤
 = 
pC
->
pCursÜ
;

71329 
as£¹
Ð
pCr¤
!=0 || 
pC
->
p£udoTabËReg
>0 );

71330 
as£¹
Ð
pCr¤
!=0 || 
pC
->
nuÎRow
 );

71333 
	grc
 = 
sql™e3VdbeCursÜMov‘o
(
pC
);

71334 ifÐ
	grc
 ) 
	gabÜt_due_to_”rÜ
;

71335 ifÐ
	gpC
->
	gÿcheStus
!=
p
->
ÿcheCŒ
 ){

71336 ifÐ
pC
->
nuÎRow
 ){

71337 ifÐ
pCr¤
==0 ){

71338 
as£¹
Ð
pC
->
p£udoTabËReg
>0 );

71339 
	gpReg
 = &
aMem
[
pC
->
p£udoTabËReg
];

71340 
as£¹
Ð
pReg
->
æags
 & 
MEM_Blob
 );

71341 
as£¹
Ð
memIsV®id
(
pReg
) );

71342 
	gpC
->
	g·ylßdSize
 = 
pC
->
szRow
 = 
avaž
 = 
pReg
->
n
;

71343 
	gpC
->
	gaRow
 = (
u8
*)
pReg
->
z
;

71345 
sql™e3VdbeMemS‘NuÎ
(
pDe¡
);

71346 
	gÝ_cÞumn_out
;

71349 
as£¹
Ð
pCr¤
 );

71350 ifÐ
	gpC
->
	gisTabË
==0 ){

71351 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCr¤
) );

71352 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“KeySize
(
pCr¤
, &
·ylßdSize64
);

71353 
as£¹
Ð
rc
==
SQLITE_OK
 );

71357 
as£¹
Ð(
·ylßdSize64
 & 
SQLITE_MAX_U32
)==(
u64
)payloadSize64 );

71358 
	gpC
->
	gaRow
 = 
sql™e3BŒ“KeyF‘ch
(
pCr¤
, &
avaž
);

71359 
	gpC
->
	g·ylßdSize
 = (
u32
)
·ylßdSize64
;

71361 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCr¤
) );

71362 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“D©aSize
(
pCr¤
, &
pC
->
·ylßdSize
);

71363 
as£¹
Ð
rc
==
SQLITE_OK
 );

71364 
	gpC
->
	gaRow
 = 
sql™e3BŒ“D©aF‘ch
(
pCr¤
, &
avaž
);

71366 
as£¹
Ð
avaž
<=65536 );

71367 ifÐ
	gpC
->
	g·ylßdSize
 <ð(
u32
)
avaž
 ){

71368 
pC
->
szRow
 =…C->
·ylßdSize
;

71370 
	gpC
->
	gszRow
 = 
avaž
;

71372 ifÐ
	gpC
->
	g·ylßdSize
 > (
	gu32
)
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

71373 
	gtoo_big
;

71376 
	gpC
->
	gÿcheStus
 = 
p
->
ÿcheCŒ
;

71377 
	gpC
->
	giHdrOff£t
 = 
g‘V¬št32
(
pC
->
aRow
, 
off£t
);

71378 
	gpC
->
	gnHdrP¬£d
 = 0;

71379 
	gaOff£t
[0] = 
off£t
;

71390 ifÐ
	goff£t
 > 98307 || off£ˆ> 
	gpC
->
	g·ylßdSize
 ){

71391 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

71392 
	gÝ_cÞumn_”rÜ
;

71395 ifÐ
	gavaž
<
	goff£t
 ){

71400 
	gpC
->
	gaRow
 = 0;

71401 
	gpC
->
	gszRow
 = 0;

71408 
as£¹
Ð
pC
->
nHdrP¬£d
<=
p2
 );

71409 
	gÝ_cÞumn_»ad_h—d”
;

71415 ifÐ
	gpC
->
	gnHdrP¬£d
<=
p2
 ){

71419 
Ý_cÞumn_»ad_h—d”
:

71420 ifÐ
pC
->
iHdrOff£t
<
aOff£t
[0] ){

71422 ifÐ
pC
->
aRow
==0 ){

71423 
mem£t
(&
sMem
, 0, (sMem));

71424 
	grc
 = 
sql™e3VdbeMemFromBŒ“
(
pCr¤
, 0, 
aOff£t
[0],

71425 !
pC
->
isTabË
, &
sMem
);

71426 ifÐ
	grc
!=
SQLITE_OK
 ){

71427 
Ý_cÞumn_”rÜ
;

71429 
	gzD©a
 = (
u8
*)
sMem
.
z
;

71431 
	gzD©a
 = 
pC
->
aRow
;

71435 
	gi
 = 
pC
->
nHdrP¬£d
;

71436 
	goff£t
 = 
aOff£t
[
i
];

71437 
	gzHdr
 = 
zD©a
 + 
pC
->
iHdrOff£t
;

71438 
	gzEndHdr
 = 
zD©a
 + 
aOff£t
[0];

71439 
as£¹
Ð
i
<=
p2
 && 
zHdr
<
zEndHdr
 );

71441 ifÐ
	gzHdr
[0]<0x80 ){

71442 
	gt
 = 
zHdr
[0];

71443 
	gzHdr
++;

71445 
	gzHdr
 +ð
sql™e3G‘V¬št32
(
zHdr
, &
t
);

71447 
	gpC
->
	gaTy³
[
i
] = 
t
;

71448 
	gszF›ld
 = 
sql™e3VdbeS”ŸlTy³L’
(
t
);

71449 
	goff£t
 +ð
szF›ld
;

71450 ifÐ
	goff£t
<
	gszF›ld
 ){

71451 
	gzHdr
 = &
zEndHdr
[1];

71454 
	gi
++;

71455 
	gaOff£t
[
i
] = 
off£t
;

71456 } 
	gi
<=
p2
 && 
zHdr
<
zEndHdr
 );

71457 
	gpC
->
	gnHdrP¬£d
 = 
i
;

71458 
	gpC
->
	giHdrOff£t
 = (
u32
)(
zHdr
 - 
zD©a
);

71459 ifÐ
	gpC
->
	gaRow
==0 ){

71460 
sql™e3VdbeMemR–—£
(&
sMem
);

71461 
	gsMem
.
	gæags
 = 
MEM_NuÎ
;

71472 ifÐ(
	gzHdr
>=
zEndHdr
 && (
zHdr
>zEndHd¸|| 
off£t
!=
pC
->
·ylßdSize
))

71473 || (
off£t
 > 
pC
->
·ylßdSize
)

71475 
rc
 = 
SQLITE_CORRUPT_BKPT
;

71476 
	gÝ_cÞumn_”rÜ
;

71484 ifÐ
	gpC
->
	gnHdrP¬£d
<=
p2
 ){

71485 ifÐ
pOp
->
p4ty³
==
P4_MEM
 ){

71486 
sql™e3VdbeMemSh®lowCÝy
(
pDe¡
, 
pOp
->
p4
.
pMem
, 
MEM_Stic
);

71488 
sql™e3VdbeMemS‘NuÎ
(
pDe¡
);

71490 
	gÝ_cÞumn_out
;

71498 
as£¹
Ð
p2
<
pC
->
nHdrP¬£d
 );

71499 
as£¹
Ð
rc
==
SQLITE_OK
 );

71500 
as£¹
Ð
sql™e3VdbeCheckMemInv¬ŸÁs
(
pDe¡
) );

71501 ifÐ
VdbeMemDyÇmic
(
pDe¡
èè
sql™e3VdbeMemS‘NuÎ
(pDest);

71502 
	gt
 = 
pC
->
aTy³
[
p2
];

71503 ifÐ
	gpC
->
	gszRow
>=
aOff£t
[
p2
+1] ){

71506 
sql™e3VdbeS”ŸlG‘
(
pC
->
aRow
+
aOff£t
[
p2
], 
t
, 
pDe¡
);

71509 ifÐ((
	gpOp
->
	gp5
 & (
	gOPFLAG_LENGTHARG
|
	gOPFLAG_TYPEOFARG
))!=0

71510 && ((
t
>=12 && (t&1)==0è|| (
pOp
->
p5
 & 
OPFLAG_TYPEOFARG
)!=0))

71511 || (
Ën
 = 
sql™e3VdbeS”ŸlTy³L’
(
t
))==0

71521 
sql™e3VdbeS”ŸlG‘
(
t
<=13 ? (
u8
*)&
·ylßdSize64
 : 0,, 
pDe¡
);

71523 
	grc
 = 
sql™e3VdbeMemFromBŒ“
(
pCr¤
, 
aOff£t
[
p2
], 
Ën
, !
pC
->
isTabË
,

71524 
pDe¡
);

71525 ifÐ
	grc
!=
SQLITE_OK
 ){

71526 
Ý_cÞumn_”rÜ
;

71528 
sql™e3VdbeS”ŸlG‘
((cÚ¡ 
u8
*)
pDe¡
->
z
, 
t
,…Dest);

71529 
	gpDe¡
->
	gæags
 &ð~
MEM_Ephem
;

71532 
	gpDe¡
->
	g’c
 = 
’codšg
;

71534 
	gÝ_cÞumn_out
:

71539 ifÐ(
pDe¡
->
æags
 & 
MEM_Ephem
)!=0 &&…De¡->
z
 ){

71540 
fx
 = 
pDe¡
->
æags
 & (
MEM_SŒ
|
MEM_Blob
);

71541 
as£¹
Ð
fx
!=0 );

71542 
	gzD©a
 = (cÚ¡ 
u8
*)
pDe¡
->
z
;

71543 
	gËn
 = 
pDe¡
->
n
;

71544 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pDe¡
, 
Ën
+2èè
	gno_mem
;

71545 
memýy
(
pDe¡
->
z
, 
zD©a
, 
Ën
);

71546 
	gpDe¡
->
	gz
[
Ën
] = 0;

71547 
	gpDe¡
->
	gz
[
Ën
+1] = 0;

71548 
	gpDe¡
->
	gæags
 = 
fx
|
MEM_T”m
;

71550 
	gÝ_cÞumn_”rÜ
:

71551 
UPDATE_MAX_BLOBSIZE
(
pDe¡
);

71552 
REGISTER_TRACE
(
pOp
->
p3
, 
pDe¡
);

71565 
	gOP_Affš™y
: {

71566 cÚ¡ *
zAffš™y
;

71567 
	gcAff
;

71569 
	gzAffš™y
 = 
pOp
->
p4
.
z
;

71570 
as£¹
Ð
zAffš™y
!=0 );

71571 
as£¹
Ð
zAffš™y
[
pOp
->
p2
]==0 );

71572 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

71573  (
	gcAff
 = *(
zAffš™y
++))!=0 ){

71574 
as£¹
Ð
pIn1
 <ð&
p
->
aMem
[Õ->
nMem
-p->
nCursÜ
)] );

71575 
as£¹
Ð
memIsV®id
(
pIn1
) );

71576 
­¶yAffš™y
(
pIn1
, 
cAff
, 
’codšg
);

71577 
	gpIn1
++;

71598 
	gOP_MakeRecÜd
: {

71599 
u8
 *
zNewRecÜd
;

71600 
Mem
 *
	gpRec
;

71601 
u64
 
	gnD©a
;

71602 
	gnHdr
;

71603 
i64
 
	gnBy‹
;

71604 
	gnZ”o
;

71605 
	gnV¬št
;

71606 
u32
 
	g£rŸl_ty³
;

71607 
Mem
 *
	gpD©a0
;

71608 
Mem
 *
	gpLa¡
;

71609 
	gnF›ld
;

71610 *
	gzAffš™y
;

71611 
	gfže_fÜm©
;

71612 
	gi
;

71613 
	gj
;

71614 
	gËn
;

71631 
	gnD©a
 = 0;

71632 
	gnHdr
 = 0;

71633 
	gnZ”o
 = 0;

71634 
	gnF›ld
 = 
pOp
->
p1
;

71635 
	gzAffš™y
 = 
pOp
->
p4
.
z
;

71636 
as£¹
Ð
nF›ld
>0 && 
pOp
->
p2
>0 &&…Op->p2+nF›ld<=(
p
->
nMem
-p->
nCursÜ
)+1 );

71637 
	gpD©a0
 = &
aMem
[
nF›ld
];

71638 
	gnF›ld
 = 
pOp
->
p2
;

71639 
	gpLa¡
 = &
pD©a0
[
nF›ld
-1];

71640 
	gfže_fÜm©
 = 
p
->
mšWr™eFžeFÜm©
;

71643 
as£¹
Ð
pOp
->
p3
<pOp->
p1
 ||…Op->p3>õOp->p1+pOp->
p2
 );

71644 
	gpOut
 = &
aMem
[
pOp
->
p3
];

71645 
memAboutToChªge
(
p
, 
pOut
);

71649 
as£¹
Ð
pD©a0
<=
pLa¡
 );

71650 ifÐ
	gzAffš™y
 ){

71651 
	gpRec
 = 
pD©a0
;

71653 
­¶yAffš™y
(
pRec
++, *(
zAffš™y
++), 
’codšg
);

71654 
as£¹
Ð
zAffš™y
[0]==0 || 
pRec
<=
pLa¡
 );

71655 } 
	gzAffš™y
[0] );

71661 
	gpRec
 = 
pLa¡
;

71663 
as£¹
Ð
memIsV®id
(
pRec
) );

71664 
	gpRec
->
	guTemp
 = 
£rŸl_ty³
 = 
sql™e3VdbeS”ŸlTy³
(
pRec
, 
fže_fÜm©
);

71665 
	gËn
 = 
sql™e3VdbeS”ŸlTy³L’
(
£rŸl_ty³
);

71666 ifÐ
	gpRec
->
	gæags
 & 
	gMEM_Z”o
 ){

71667 ifÐ
	gnD©a
 ){

71668 
sql™e3VdbeMemEx·ndBlob
(
pRec
);

71670 
	gnZ”o
 +ð
pRec
->
u
.
nZ”o
;

71671 
	gËn
 -ð
pRec
->
u
.
nZ”o
;

71674 
	gnD©a
 +ð
Ën
;

71675 
‹¡ÿ£
Ð
£rŸl_ty³
==127 );

71676 
‹¡ÿ£
Ð
£rŸl_ty³
==128 );

71677 
	gnHdr
 +ð
£rŸl_ty³
<=127 ? 1 : 
sql™e3V¬štL’
(serial_type);

71678 } (--
	gpRec
)>=
pD©a0
 );

71681 
‹¡ÿ£
Ð
nHdr
==126 );

71682 
‹¡ÿ£
Ð
nHdr
==127 );

71683 ifÐ
	gnHdr
<=126 ){

71685 
nHdr
 += 1;

71688 
	gnV¬št
 = 
sql™e3V¬štL’
(
nHdr
);

71689 
	gnHdr
 +ð
nV¬št
;

71690 ifÐ
	gnV¬št
<
sql™e3V¬štL’
(
nHdr
èè
	gnHdr
++;

71692 
	gnBy‹
 = 
nHdr
+
nD©a
;

71693 ifÐ
	gnBy‹
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

71694 
	gtoo_big
;

71702 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pOut
, ()
nBy‹
) ){

71703 
	gno_mem
;

71705 
	gzNewRecÜd
 = (
u8
 *)
pOut
->
z
;

71708 
	gi
 = 
putV¬št32
(
zNewRecÜd
, 
nHdr
);

71709 
	gj
 = 
nHdr
;

71710 
as£¹
Ð
pD©a0
<=
pLa¡
 );

71711 
	gpRec
 = 
pD©a0
;

71713 
	g£rŸl_ty³
 = 
pRec
->
uTemp
;

71714 
	gi
 +ð
putV¬št32
(&
zNewRecÜd
[
i
], 
£rŸl_ty³
);

71715 
	gj
 +ð
sql™e3VdbeS”ŸlPut
(&
zNewRecÜd
[
j
], 
pRec
, 
£rŸl_ty³
);

71716 } (++
	gpRec
)<=
pLa¡
 );

71717 
as£¹
Ð
i
==
nHdr
 );

71718 
as£¹
Ð
j
==
nBy‹
 );

71720 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

71721 
	gpOut
->
	gn
 = ()
nBy‹
;

71722 
	gpOut
->
	gæags
 = 
MEM_Blob
;

71723 ifÐ
	gnZ”o
 ){

71724 
	gpOut
->
	gu
.
	gnZ”o
 = 
nZ”o
;

71725 
	gpOut
->
	gæags
 |ð
MEM_Z”o
;

71727 
	gpOut
->
	g’c
 = 
SQLITE_UTF8
;

71728 
REGISTER_TRACE
(
pOp
->
p3
, 
pOut
);

71729 
UPDATE_MAX_BLOBSIZE
(
pOut
);

71739 #iâdeà
SQLITE_OMIT_BTREECOUNT


71740 
	gOP_CouÁ
: {

71741 
i64
 
nEÁry
;

71742 
BtCursÜ
 *
	gpCr¤
;

71744 
	gpCr¤
 = 
p
->
­C¤
[
pOp
->
p1
]->
pCursÜ
;

71745 
as£¹
Ð
pCr¤
 );

71746 
	gnEÁry
 = 0;

71747 
	grc
 = 
sql™e3BŒ“CouÁ
(
pCr¤
, &
nEÁry
);

71748 
	gpOut
->
	gu
.
	gi
 = 
nEÁry
;

71759 
	gOP_Sav•ošt
: {

71760 
p1
;

71761 *
	gzName
;

71762 
	gnName
;

71763 
Sav•ošt
 *
	gpNew
;

71764 
Sav•ošt
 *
	gpSav•ošt
;

71765 
Sav•ošt
 *
	gpTmp
;

71766 
	giSav•ošt
;

71767 
	gii
;

71769 
	gp1
 = 
pOp
->
p1
;

71770 
	gzName
 = 
pOp
->
p4
.
z
;

71775 
as£¹
Ð
db
->
pSav•ošt
==0 || db->
autoComm™
==0 );

71776 
as£¹
Ð
p1
==
SAVEPOINT_BEGIN
||p1==
SAVEPOINT_RELEASE
||p1==
SAVEPOINT_ROLLBACK
 );

71777 
as£¹
Ð
db
->
pSav•ošt
 || db->
isT¿n§ùiÚSav•ošt
==0 );

71778 
as£¹
Ð
checkSav•oštCouÁ
(
db
) );

71779 
as£¹
Ð
p
->
bIsR—d”
 );

71781 ifÐ
	gp1
==
SAVEPOINT_BEGIN
 ){

71782 ifÐ
db
->
nVdbeWr™e
>0 ){

71786 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "cannot open savepoint - "

71788 
	grc
 = 
SQLITE_BUSY
;

71790 
	gnName
 = 
sql™e3SŒËn30
(
zName
);

71792 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


71797 
as£¹
Ð
db
->
autoComm™
==0 || db->
nVT¿ns
==0 );

71798 
	grc
 = 
sql™e3VbSav•ošt
(
db
, 
SAVEPOINT_BEGIN
,

71799 
db
->
nS‹m’t
+db->
nSav•ošt
);

71800 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

71804 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, (
Sav•ošt
)+
nName
+1);

71805 ifÐ
	gpNew
 ){

71806 
	gpNew
->
	gzName
 = (*)&
pNew
[1];

71807 
memýy
(
pNew
->
zName
, zName, 
nName
+1);

71811 ifÐ
	gdb
->
	gautoComm™
 ){

71812 
	gdb
->
	gautoComm™
 = 0;

71813 
	gdb
->
	gisT¿n§ùiÚSav•ošt
 = 1;

71815 
	gdb
->
	gnSav•ošt
++;

71819 
	gpNew
->
	gpNext
 = 
db
->
pSav•ošt
;

71820 
	gdb
->
	gpSav•ošt
 = 
pNew
;

71821 
	gpNew
->
	gnDeã¼edCÚs
 = 
db
->
nDeã¼edCÚs
;

71822 
	gpNew
->
	gnDeã¼edImmCÚs
 = 
db
->
nDeã¼edImmCÚs
;

71826 
	giSav•ošt
 = 0;

71831 
	gpSav•ošt
 = 
db
->
pSav•ošt
;

71832 
	gpSav•ošt
 && 
sql™e3SŒICmp
(
pSav•ošt
->
zName
, zName);

71833 
	gpSav•ošt
 = 
pSav•ošt
->
pNext


71835 
iSav•ošt
++;

71837 ifÐ!
	gpSav•ošt
 ){

71838 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "nØsuch sav•ošt: %s", 
zName
);

71839 
	grc
 = 
SQLITE_ERROR
;

71840 }ifÐ
	gdb
->
	gnVdbeWr™e
>0 && 
	gp1
==
SAVEPOINT_RELEASE
 ){

71844 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
,

71847 
	grc
 = 
SQLITE_BUSY
;

71854 
	gisT¿n§ùiÚ
 = 
pSav•ošt
->
pNext
==0 && 
db
->
isT¿n§ùiÚSav•ošt
;

71855 ifÐ
	gisT¿n§ùiÚ
 && 
	gp1
==
SAVEPOINT_RELEASE
 ){

71856 ifÐ(
rc
 = 
sql™e3VdbeCheckFk
(
p
, 1))!=
SQLITE_OK
 ){

71857 
vdbe_»tuº
;

71859 
	gdb
->
	gautoComm™
 = 1;

71860 ifÐ
sql™e3VdbeH®t
(
p
)==
SQLITE_BUSY
 ){

71861 
p
->
pc
 =…c;

71862 
	gdb
->
	gautoComm™
 = 0;

71863 
	gp
->
	grc
 = 
rc
 = 
SQLITE_BUSY
;

71864 
	gvdbe_»tuº
;

71866 
	gdb
->
	gisT¿n§ùiÚSav•ošt
 = 0;

71867 
	grc
 = 
p
->
rc
;

71869 
	gisSchemaChªge
;

71870 
	giSav•ošt
 = 
db
->
nSav•ošt
 - 
iSav•ošt
 - 1;

71871 ifÐ
	gp1
==
SAVEPOINT_ROLLBACK
 ){

71872 
isSchemaChªge
 = (
db
->
æags
 & 
SQLITE_IÁ”nChªges
)!=0;

71873 
	gii
=0; ii<
	gdb
->
	gnDb
; ii++){

71874 
	grc
 = 
sql™e3BŒ“TrAÎCursÜs
(
db
->
aDb
[
ii
].
pBt
,

71875 
SQLITE_ABORT_ROLLBACK
,

71876 
isSchemaChªge
==0);

71877 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

71880 
	gisSchemaChªge
 = 0;

71882 
	gii
=0; ii<
	gdb
->
	gnDb
; ii++){

71883 
	grc
 = 
sql™e3BŒ“Sav•ošt
(
db
->
aDb
[
ii
].
pBt
, 
p1
, 
iSav•ošt
);

71884 ifÐ
	grc
!=
SQLITE_OK
 ){

71885 
abÜt_due_to_”rÜ
;

71888 ifÐ
	gisSchemaChªge
 ){

71889 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

71890 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

71891 
	gdb
->
	gæags
 = (
db
->
æags
 | 
SQLITE_IÁ”nChªges
);

71897  
	gdb
->
	gpSav•ošt
!=
pSav•ošt
 ){

71898 
pTmp
 = 
db
->
pSav•ošt
;

71899 
	gdb
->
	gpSav•ošt
 = 
pTmp
->
pNext
;

71900 
sql™e3DbF»e
(
db
, 
pTmp
);

71901 
	gdb
->
	gnSav•ošt
--;

71908 ifÐ
	gp1
==
SAVEPOINT_RELEASE
 ){

71909 
as£¹
Ð
pSav•ošt
==
db
->pSavepoint );

71910 
	gdb
->
	gpSav•ošt
 = 
pSav•ošt
->
pNext
;

71911 
sql™e3DbF»e
(
db
, 
pSav•ošt
);

71912 ifÐ!
	gisT¿n§ùiÚ
 ){

71913 
	gdb
->
	gnSav•ošt
--;

71916 
	gdb
->
	gnDeã¼edCÚs
 = 
pSav•ošt
->
nDeã¼edCÚs
;

71917 
	gdb
->
	gnDeã¼edImmCÚs
 = 
pSav•ošt
->
nDeã¼edImmCÚs
;

71920 ifÐ!
	gisT¿n§ùiÚ
 ){

71921 
	grc
 = 
sql™e3VbSav•ošt
(
db
, 
p1
, 
iSav•ošt
);

71922 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

71939 
	gOP_AutoComm™
: {

71940 
desœedAutoComm™
;

71941 
	giRÞlback
;

71942 
	gtuºOnAC
;

71944 
	gdesœedAutoComm™
 = 
pOp
->
p1
;

71945 
	giRÞlback
 = 
pOp
->
p2
;

71946 
	gtuºOnAC
 = 
desœedAutoComm™
 && !
db
->
autoComm™
;

71947 
as£¹
Ð
desœedAutoComm™
==1 || desiredAutoCommit==0 );

71948 
as£¹
Ð
desœedAutoComm™
==1 || 
iRÞlback
==0 );

71949 
as£¹
Ð
db
->
nVdbeAùive
>0 );

71950 
as£¹
Ð
p
->
bIsR—d”
 );

71953 ifÐ
	gtuºOnAC
 && 
	giRÞlback
 && 
	gdb
->
	gnVdbeAùive
>1 ){

71958 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "cannot„ollbackransaction - "

71960 
	grc
 = 
SQLITE_BUSY
;

71963 ifÐ
	gtuºOnAC
 && !
	giRÞlback
 && 
	gdb
->
	gnVdbeWr™e
>0 ){

71967 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "cannot commitransaction - "

71969 
	grc
 = 
SQLITE_BUSY
;

71970 }ifÐ
	gdesœedAutoComm™
!=
db
->
autoComm™
 ){

71971 ifÐ
iRÞlback
 ){

71972 
as£¹
Ð
desœedAutoComm™
==1 );

71973 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_ABORT_ROLLBACK
);

71974 
	gdb
->
	gautoComm™
 = 1;

71975 }ifÐ(
	grc
 = 
sql™e3VdbeCheckFk
(
p
, 1))!=
SQLITE_OK
 ){

71976 
vdbe_»tuº
;

71978 
	gdb
->
	gautoComm™
 = (
u8
)
desœedAutoComm™
;

71979 ifÐ
sql™e3VdbeH®t
(
p
)==
SQLITE_BUSY
 ){

71980 
p
->
pc
 =…c;

71981 
	gdb
->
	gautoComm™
 = (
u8
)(1-
desœedAutoComm™
);

71982 
	gp
->
	grc
 = 
rc
 = 
SQLITE_BUSY
;

71983 
	gvdbe_»tuº
;

71986 
as£¹
Ð
db
->
nS‹m’t
==0 );

71987 
sql™e3Clo£Sav•ošts
(
db
);

71988 ifÐ
	gp
->
	grc
==
SQLITE_OK
 ){

71989 
rc
 = 
SQLITE_DONE
;

71991 
	grc
 = 
SQLITE_ERROR
;

71993 
	gvdbe_»tuº
;

71995 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
,

71996 (!
desœedAutoComm™
)?"cannot start‡ransaction within‡ransaction":(

71997 (
iRÞlback
)?"cannot„ollback -‚oransaction is‡ctive":

72000 
	grc
 = 
SQLITE_ERROR
;

72039 
	gOP_T¿n§ùiÚ
: {

72040 
BŒ“
 *
pBt
;

72041 
	giM‘a
;

72042 
	giG’
;

72044 
as£¹
Ð
p
->
bIsR—d”
 );

72045 
as£¹
Ð
p
->
»adOÆy
==0 || 
pOp
->
p2
==0 );

72046 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

72047 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p1
) );

72048 ifÐ
	gpOp
->
	gp2
 && (
	gdb
->
	gæags
 & 
	gSQLITE_Qu”yOÆy
)!=0 ){

72049 
rc
 = 
SQLITE_READONLY
;

72050 
	gabÜt_due_to_”rÜ
;

72052 
	gpBt
 = 
db
->
aDb
[
pOp
->
p1
].
pBt
;

72054 ifÐ
	gpBt
 ){

72055 
	grc
 = 
sql™e3BŒ“BegšT¿ns
(
pBt
, 
pOp
->
p2
);

72056 ifÐ
	grc
==
SQLITE_BUSY
 ){

72057 
p
->
pc
 =…c;

72058 
	gp
->
	grc
 = 
rc
 = 
SQLITE_BUSY
;

72059 
	gvdbe_»tuº
;

72061 ifÐ
	grc
!=
SQLITE_OK
 ){

72062 
abÜt_due_to_”rÜ
;

72065 ifÐ
	gpOp
->
	gp2
 && 
	gp
->
	gu£sStmtJouº®


72066 && (
	gdb
->
	gautoComm™
==0 || 
db
->
nVdbeR—d
>1)

72068 
as£¹
Ð
sql™e3BŒ“IsInT¿ns
(
pBt
) );

72069 ifÐ
	gp
->
	giS‹m’t
==0 ){

72070 
as£¹
Ð
db
->
nS‹m’t
>=0 && db->
nSav•ošt
>=0 );

72071 
	gdb
->
	gnS‹m’t
++;

72072 
	gp
->
	giS‹m’t
 = 
db
->
nSav•ošt
 + db->
nS‹m’t
;

72075 
	grc
 = 
sql™e3VbSav•ošt
(
db
, 
SAVEPOINT_BEGIN
, 
p
->
iS‹m’t
-1);

72076 ifÐ
	grc
==
SQLITE_OK
 ){

72077 
rc
 = 
sql™e3BŒ“BegšStmt
(
pBt
, 
p
->
iS‹m’t
);

72083 
	gp
->
	gnStmtDefCÚs
 = 
db
->
nDeã¼edCÚs
;

72084 
	gp
->
	gnStmtDefImmCÚs
 = 
db
->
nDeã¼edImmCÚs
;

72088 
sql™e3BŒ“G‘M‘a
(
pBt
, 
BTREE_SCHEMA_VERSION
, (
u32
 *)&
iM‘a
);

72089 
	giG’
 = 
db
->
aDb
[
pOp
->
p1
].
pSchema
->
iG’”©iÚ
;

72091 
	giG’
 = 
iM‘a
 = 0;

72093 
as£¹
Ð
pOp
->
p5
==0 ||…Op->
p4ty³
==
P4_INT32
 );

72094 ifÐ
	gpOp
->
	gp5
 && (
	giM‘a
!=
pOp
->
p3
 || 
iG’
!õOp->
p4
.
i
) ){

72095 
sql™e3DbF»e
(
db
, 
p
->
zE¼Msg
);

72096 
	gp
->
	gzE¼Msg
 = 
sql™e3DbSŒDup
(
db
, "database schema has changed");

72110 ifÐ
	gdb
->
	gaDb
[
pOp
->
p1
].
	gpSchema
->
	gschema_cook›
!=
iM‘a
 ){

72111 
sql™e3Re£tOÃSchema
(
db
, 
pOp
->
p1
);

72113 
	gp
->
	gexpœed
 = 1;

72114 
	grc
 = 
SQLITE_SCHEMA
;

72131 
	gOP_R—dCook›
: {

72132 
iM‘a
;

72133 
	giDb
;

72134 
	giCook›
;

72136 
as£¹
Ð
p
->
bIsR—d”
 );

72137 
	giDb
 = 
pOp
->
p1
;

72138 
	giCook›
 = 
pOp
->
p3
;

72139 
as£¹
Ð
pOp
->
p3
<
SQLITE_N_BTREE_META
 );

72140 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

72141 
as£¹
Ð
db
->
aDb
[
iDb
].
pBt
!=0 );

72142 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
iDb
) );

72144 
sql™e3BŒ“G‘M‘a
(
db
->
aDb
[
iDb
].
pBt
, 
iCook›
, (
u32
 *)&
iM‘a
);

72145 
	gpOut
->
	gu
.
	gi
 = 
iM‘a
;

72159 
	gOP_S‘Cook›
: {

72160 
Db
 *
pDb
;

72161 
as£¹
Ð
pOp
->
p2
<
SQLITE_N_BTREE_META
 );

72162 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

72163 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p1
) );

72164 
as£¹
Ð
p
->
»adOÆy
==0 );

72165 
	gpDb
 = &
db
->
aDb
[
pOp
->
p1
];

72166 
as£¹
Ð
pDb
->
pBt
!=0 );

72167 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
pOp
->
p1
, 0) );

72168 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

72169 
sql™e3VdbeMemIÁeg”ify
(
pIn3
);

72171 
	grc
 = 
sql™e3BŒ“Upd©eM‘a
(
pDb
->
pBt
, 
pOp
->
p2
, ()
pIn3
->
u
.
i
);

72172 ifÐ
	gpOp
->
	gp2
==
BTREE_SCHEMA_VERSION
 ){

72174 
pDb
->
pSchema
->
schema_cook›
 = ()
pIn3
->
u
.
i
;

72175 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

72176 }ifÐ
	gpOp
->
	gp2
==
BTREE_FILE_FORMAT
 ){

72178 
pDb
->
pSchema
->
fže_fÜm©
 = (
u8
)
pIn3
->
u
.
i
;

72180 ifÐ
	gpOp
->
	gp1
==1 ){

72183 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

72184 
	gp
->
	gexpœed
 = 0;

72254 
	gOP_ReÝ’Idx
: {

72255 
VdbeCursÜ
 *
pCur
;

72257 
as£¹
Ð
pOp
->
p5
==0 );

72258 
as£¹
Ð
pOp
->
p4ty³
==
P4_KEYINFO
 );

72259 
	gpCur
 = 
p
->
­C¤
[
pOp
->
p1
];

72260 ifÐ
	gpCur
 &&…Cur->
	gpgnoRoÙ
==(
u32
)
pOp
->
p2
 ){

72261 
as£¹
Ð
pCur
->
iDb
==
pOp
->
p3
 );

72267 
	gOP_O³nR—d
:

72268 
OP_O³nWr™e
: {

72269 
nF›ld
;

72270 
KeyInfo
 *
	gpKeyInfo
;

72271 
	gp2
;

72272 
	giDb
;

72273 
	gwrFÏg
;

72274 
BŒ“
 *
	gpX
;

72275 
VdbeCursÜ
 *
	gpCur
;

72276 
Db
 *
	gpDb
;

72278 
as£¹
Ð(
pOp
->
p5
&(
OPFLAG_P2ISREG
|
OPFLAG_BULKCSR
))==pOp->p5 );

72279 
as£¹
Ð
pOp
->
Ýcode
==
OP_O³nWr™e
 ||…Op->
p5
==0 );

72280 
as£¹
Ð
p
->
bIsR—d”
 );

72281 
as£¹
Ð
pOp
->
Ýcode
==
OP_O³nR—d
 ||…Op->Ýcode==
OP_ReÝ’Idx


72282 || 
p
->
»adOÆy
==0 );

72284 ifÐ
	gp
->
	gexpœed
 ){

72285 
	grc
 = 
SQLITE_ABORT_ROLLBACK
;

72289 
	gnF›ld
 = 0;

72290 
	gpKeyInfo
 = 0;

72291 
	gp2
 = 
pOp
->
p2
;

72292 
	giDb
 = 
pOp
->
p3
;

72293 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

72294 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
iDb
) );

72295 
	gpDb
 = &
db
->
aDb
[
iDb
];

72296 
	gpX
 = 
pDb
->
pBt
;

72297 
as£¹
Ð
pX
!=0 );

72298 ifÐ
	gpOp
->
	gÝcode
==
OP_O³nWr™e
 ){

72299 
wrFÏg
 = 1;

72300 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

72301 ifÐ
	gpDb
->
	gpSchema
->
	gfže_fÜm©
 < 
	gp
->
	gmšWr™eFžeFÜm©
 ){

72302 
	gp
->
	gmšWr™eFžeFÜm©
 = 
pDb
->
pSchema
->
fže_fÜm©
;

72305 
	gwrFÏg
 = 0;

72307 ifÐ
	gpOp
->
	gp5
 & 
	gOPFLAG_P2ISREG
 ){

72308 
as£¹
Ð
p2
>0 );

72309 
as£¹
Ð
p2
<=(
p
->
nMem
-p->
nCursÜ
) );

72310 
	gpIn2
 = &
aMem
[
p2
];

72311 
as£¹
Ð
memIsV®id
(
pIn2
) );

72312 
as£¹
Ð(
pIn2
->
æags
 & 
MEM_IÁ
)!=0 );

72313 
sql™e3VdbeMemIÁeg”ify
(
pIn2
);

72314 
	gp2
 = ()
pIn2
->
u
.
i
;

72319 ifÐ
NEVER
(
p2
<2) ) {

72320 
	grc
 = 
SQLITE_CORRUPT_BKPT
;

72321 
	gabÜt_due_to_”rÜ
;

72324 ifÐ
	gpOp
->
	gp4ty³
==
P4_KEYINFO
 ){

72325 
pKeyInfo
 = 
pOp
->
p4
.pKeyInfo;

72326 
as£¹
Ð
pKeyInfo
->
’c
==
ENC
(
db
) );

72327 
as£¹
Ð
pKeyInfo
->
db
==db );

72328 
	gnF›ld
 = 
pKeyInfo
->
nF›ld
+pKeyInfo->
nXF›ld
;

72329 }ifÐ
	gpOp
->
	gp4ty³
==
P4_INT32
 ){

72330 
nF›ld
 = 
pOp
->
p4
.
i
;

72332 
as£¹
Ð
pOp
->
p1
>=0 );

72333 
as£¹
Ð
nF›ld
>=0 );

72334 
‹¡ÿ£
Ð
nF›ld
==0 );

72335 
	gpCur
 = 
®loÿ‹CursÜ
(
p
, 
pOp
->
p1
, 
nF›ld
, 
iDb
, 1);

72336 ifÐ
	gpCur
==0 ) 
no_mem
;

72337 
	gpCur
->
	gnuÎRow
 = 1;

72338 
	gpCur
->
	gisOrd”ed
 = 1;

72339 
	gpCur
->
	gpgnoRoÙ
 = 
p2
;

72340 
	grc
 = 
sql™e3BŒ“CursÜ
(
pX
, 
p2
, 
wrFÏg
, 
pKeyInfo
, 
pCur
->
pCursÜ
);

72341 
	gpCur
->
	gpKeyInfo
 = 
pKeyInfo
;

72342 
as£¹
Ð
OPFLAG_BULKCSR
==
BTREE_BULKLOAD
 );

72343 
sql™e3BŒ“CursÜHšts
(
pCur
->
pCursÜ
, (
pOp
->
p5
 & 
OPFLAG_BULKCSR
));

72349 
	gpCur
->
	gisTabË
 = 
pOp
->
p4ty³
!=
P4_KEYINFO
;

72379 
	gOP_O³nAutošdex
:

72380 
OP_O³nEphem”®
: {

72381 
VdbeCursÜ
 *
pCx
;

72382 
KeyInfo
 *
	gpKeyInfo
;

72384 cÚ¡ 
	gvfsFÏgs
 =

72385 
SQLITE_OPEN_READWRITE
 |

72386 
SQLITE_OPEN_CREATE
 |

72387 
SQLITE_OPEN_EXCLUSIVE
 |

72388 
SQLITE_OPEN_DELETEONCLOSE
 |

72389 
SQLITE_OPEN_TRANSIENT_DB
;

72390 
as£¹
Ð
pOp
->
p1
>=0 );

72391 
as£¹
Ð
pOp
->
p2
>=0 );

72392 
	gpCx
 = 
®loÿ‹CursÜ
(
p
, 
pOp
->
p1
,…Op->
p2
, -1, 1);

72393 ifÐ
	gpCx
==0 ) 
no_mem
;

72394 
	gpCx
->
	gnuÎRow
 = 1;

72395 
	gpCx
->
	gisEphem”®
 = 1;

72396 
	grc
 = 
sql™e3BŒ“O³n
(
db
->
pVfs
, 0, db, &
pCx
->
pBt
,

72397 
BTREE_OMIT_JOURNAL
 | 
BTREE_SINGLE
 | 
pOp
->
p5
, 
vfsFÏgs
);

72398 ifÐ
	grc
==
SQLITE_OK
 ){

72399 
rc
 = 
sql™e3BŒ“BegšT¿ns
(
pCx
->
pBt
, 1);

72401 ifÐ
	grc
==
SQLITE_OK
 ){

72407 ifÐ(
pKeyInfo
 = 
pOp
->
p4
.pKeyInfo)!=0 ){

72408 
pgno
;

72409 
as£¹
Ð
pOp
->
p4ty³
==
P4_KEYINFO
 );

72410 
	grc
 = 
sql™e3BŒ“C»©eTabË
(
pCx
->
pBt
, &
pgno
, 
BTREE_BLOBKEY
 | 
pOp
->
p5
);

72411 ifÐ
	grc
==
SQLITE_OK
 ){

72412 
as£¹
Ð
pgno
==
MASTER_ROOT
+1 );

72413 
as£¹
Ð
pKeyInfo
->
db
==db );

72414 
as£¹
Ð
pKeyInfo
->
’c
==
ENC
(
db
) );

72415 
	gpCx
->
	gpKeyInfo
 = 
pKeyInfo
;

72416 
	grc
 = 
sql™e3BŒ“CursÜ
(
pCx
->
pBt
, 
pgno
, 1, 
pKeyInfo
,…Cx->
pCursÜ
);

72418 
	gpCx
->
	gisTabË
 = 0;

72420 
	grc
 = 
sql™e3BŒ“CursÜ
(
pCx
->
pBt
, 
MASTER_ROOT
, 1, 0,…Cx->
pCursÜ
);

72421 
	gpCx
->
	gisTabË
 = 1;

72424 
	gpCx
->
	gisOrd”ed
 = (
pOp
->
p5
!=
BTREE_UNORDERED
);

72438 
	gOP_SÜ‹rO³n
: {

72439 
VdbeCursÜ
 *
pCx
;

72441 
as£¹
Ð
pOp
->
p1
>=0 );

72442 
as£¹
Ð
pOp
->
p2
>=0 );

72443 
	gpCx
 = 
®loÿ‹CursÜ
(
p
, 
pOp
->
p1
,…Op->
p2
, -1, 1);

72444 ifÐ
	gpCx
==0 ) 
no_mem
;

72445 
	gpCx
->
	gpKeyInfo
 = 
pOp
->
p4
.
pKeyInfo
;

72446 
as£¹
Ð
pCx
->
pKeyInfo
->
db
==db );

72447 
as£¹
Ð
pCx
->
pKeyInfo
->
’c
==
ENC
(
db
) );

72448 
	grc
 = 
sql™e3VdbeSÜ‹rIn™
(
db
, 
pOp
->
p3
, 
pCx
);

72459 
	gOP_Sequ’ûTe¡
: {

72460 
VdbeCursÜ
 *
pC
;

72461 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72462 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72463 
as£¹
Ð
pC
->
pSÜ‹r
 );

72464 ifÐ(
	gpC
->
	g£qCouÁ
++)==0 ){

72465 
pc
 = 
pOp
->
p2
 - 1;

72486 
	gOP_O³nP£udo
: {

72487 
VdbeCursÜ
 *
pCx
;

72489 
as£¹
Ð
pOp
->
p1
>=0 );

72490 
as£¹
Ð
pOp
->
p3
>=0 );

72491 
	gpCx
 = 
®loÿ‹CursÜ
(
p
, 
pOp
->
p1
,…Op->
p3
, -1, 0);

72492 ifÐ
	gpCx
==0 ) 
no_mem
;

72493 
	gpCx
->
	gnuÎRow
 = 1;

72494 
	gpCx
->
	gp£udoTabËReg
 = 
pOp
->
p2
;

72495 
	gpCx
->
	gisTabË
 = 1;

72496 
as£¹
Ð
pOp
->
p5
==0 );

72505 
	gOP_Clo£
: {

72506 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72507 
sql™e3VdbeF»eCursÜ
(
p
,…->
­C¤
[
pOp
->
p1
]);

72508 
	gp
->
	g­C¤
[
pOp
->
p1
] = 0;

72584 
	gOP_S“kLT
:

72585 
OP_S“kLE
:

72586 
OP_S“kGE
:

72587 
OP_S“kGT
: {

72588 
»s
;

72589 
	goc
;

72590 
VdbeCursÜ
 *
	gpC
;

72591 
UÅackedRecÜd
 
	gr
;

72592 
	gnF›ld
;

72593 
i64
 
	giKey
;

72595 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72596 
as£¹
Ð
pOp
->
p2
!=0 );

72597 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72598 
as£¹
Ð
pC
!=0 );

72599 
as£¹
Ð
pC
->
p£udoTabËReg
==0 );

72600 
as£¹
Ð
OP_S“kLE
 =ð
OP_S“kLT
+1 );

72601 
as£¹
Ð
OP_S“kGE
 =ð
OP_S“kLT
+2 );

72602 
as£¹
Ð
OP_S“kGT
 =ð
OP_S“kLT
+3 );

72603 
as£¹
Ð
pC
->
isOrd”ed
 );

72604 
as£¹
Ð
pC
->
pCursÜ
!=0 );

72605 
	goc
 = 
pOp
->
Ýcode
;

72606 
	gpC
->
	gnuÎRow
 = 0;

72607 #ifdeà
SQLITE_DEBUG


72608 
	gpC
->
	g£ekOp
 = 
pOp
->
Ýcode
;

72610 ifÐ
	gpC
->
	gisTabË
 ){

72614 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

72615 ifÐ(
	gpIn3
->
	gæags
 & (
	gMEM_IÁ
|
	gMEM_R—l
|
	gMEM_SŒ
))==
MEM_SŒ
 ){

72616 
­¶yNum”icAffš™y
(
pIn3
, 0);

72618 
	giKey
 = 
sql™e3VdbeIÁV®ue
(
pIn3
);

72622 ifÐ(
	gpIn3
->
	gæags
 & 
	gMEM_IÁ
)==0 ){

72623 ifÐ(
pIn3
->
æags
 & 
MEM_R—l
)==0 ){

72626 
pc
 = 
pOp
->
p2
 - 1; 
VdbeB¿nchTak’
(1,2);

72637 ifÐ
	gpIn3
->
	gu
.
	gr
<()
	giKey
 ){

72638 
as£¹
Ð
OP_S“kGE
==(
OP_S“kGT
-1) );

72639 
as£¹
Ð
OP_S“kLT
==(
OP_S“kLE
-1) );

72640 
as£¹
Ð(
OP_S“kLE
 & 0x0001)==(
OP_S“kGT
 & 0x0001) );

72641 ifÐ(
	goc
 & 0x0001)==(
OP_S“kGT
 & 0x0001èè
oc
--;

72646 ifÐ
	gpIn3
->
	gu
.
	gr
>()
	giKey
 ){

72647 
as£¹
Ð
OP_S“kLE
==(
OP_S“kLT
+1) );

72648 
as£¹
Ð
OP_S“kGT
==(
OP_S“kGE
+1) );

72649 
as£¹
Ð(
OP_S“kLT
 & 0x0001)==(
OP_S“kGE
 & 0x0001) );

72650 ifÐ(
	goc
 & 0x0001)==(
OP_S“kLT
 & 0x0001èè
oc
++;

72653 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pC
->
pCursÜ
, 0, (
u64
)
iKey
, 0, &
»s
);

72654 
	gpC
->
	gmov‘oT¬g‘
 = 
iKey
;

72655 ifÐ
	grc
!=
SQLITE_OK
 ){

72656 
abÜt_due_to_”rÜ
;

72659 
	gnF›ld
 = 
pOp
->
p4
.
i
;

72660 
as£¹
Ð
pOp
->
p4ty³
==
P4_INT32
 );

72661 
as£¹
Ð
nF›ld
>0 );

72662 
	gr
.
	gpKeyInfo
 = 
pC
->
pKeyInfo
;

72663 
	gr
.
	gnF›ld
 = (
u16
)
nF›ld
;

72672 
	gr
.
	gdeçuÉ_rc
 = ((1 & (
oc
 - 
OP_S“kLT
)) ? -1 : +1);

72673 
as£¹
Ð
oc
!=
OP_S“kGT
 || 
r
.
deçuÉ_rc
==-1 );

72674 
as£¹
Ð
oc
!=
OP_S“kLE
 || 
r
.
deçuÉ_rc
==-1 );

72675 
as£¹
Ð
oc
!=
OP_S“kGE
 || 
r
.
deçuÉ_rc
==+1 );

72676 
as£¹
Ð
oc
!=
OP_S“kLT
 || 
r
.
deçuÉ_rc
==+1 );

72678 
	gr
.
	gaMem
 = &
aMem
[
pOp
->
p3
];

72679 #ifdeà
SQLITE_DEBUG


72680 { 
	gi
; i=0; i<
	gr
.
	gnF›ld
; i++è
as£¹
Ð
memIsV®id
(&
r
.
aMem
[
i
]) ); }

72682 
Ex·ndBlob
(
r
.
aMem
);

72683 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pC
->
pCursÜ
, &
r
, 0, 0, &
»s
);

72684 ifÐ
	grc
!=
SQLITE_OK
 ){

72685 
abÜt_due_to_”rÜ
;

72688 
	gpC
->
	gdeã¼edMov‘o
 = 0;

72689 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

72690 #ifdeà
SQLITE_TEST


72691 
	gsql™e3_£¬ch_couÁ
++;

72693 ifÐ
	goc
>=
OP_S“kGE
 ){ 
as£¹
Ð
oc
==OP_S“kGE || oc==
OP_S“kGT
 );

72694 ifÐ
	g»s
<0 || (»s==0 && 
oc
==
OP_S“kGT
) ){

72695 
»s
 = 0;

72696 
	grc
 = 
sql™e3BŒ“Next
(
pC
->
pCursÜ
, &
»s
);

72697 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

72699 
	g»s
 = 0;

72702 
as£¹
Ð
oc
==
OP_S“kLT
 || oc==
OP_S“kLE
 );

72703 ifÐ
	g»s
>0 || (»s==0 && 
oc
==
OP_S“kLT
) ){

72704 
»s
 = 0;

72705 
	grc
 = 
sql™e3BŒ“P»vious
(
pC
->
pCursÜ
, &
»s
);

72706 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

72711 
	g»s
 = 
sql™e3BŒ“Eof
(
pC
->
pCursÜ
);

72714 
as£¹
Ð
pOp
->
p2
>0 );

72715 
VdbeB¿nchTak’
(
»s
!=0,2);

72716 ifÐ
	g»s
 ){

72717 
	gpc
 = 
pOp
->
p2
 - 1;

72732 
	gOP_S“k
: {

72733 
VdbeCursÜ
 *
pC
;

72735 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72736 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72737 
as£¹
Ð
pC
!=0 );

72738 
as£¹
Ð
pC
->
pCursÜ
!=0 );

72739 
as£¹
Ð
pC
->
isTabË
 );

72740 
	gpC
->
	gnuÎRow
 = 0;

72741 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

72742 
	gpC
->
	gmov‘oT¬g‘
 = 
sql™e3VdbeIÁV®ue
(
pIn2
);

72743 
	gpC
->
	gdeã¼edMov‘o
 = 1;

72807 
	gOP_NoCÚæiù
:

72808 
OP_NÙFound
:

72809 
OP_Found
: {

72810 
®»adyExi¡s
;

72811 
	gii
;

72812 
VdbeCursÜ
 *
	gpC
;

72813 
	g»s
;

72814 *
	gpF»e
;

72815 
UÅackedRecÜd
 *
	gpIdxKey
;

72816 
UÅackedRecÜd
 
	gr
;

72817 
	gaTempRec
[
ROUND8
((
UÅackedRecÜd
)è+ (
Mem
)*4 + 7];

72819 #ifdeà
SQLITE_TEST


72820 ifÐ
	gpOp
->
	gÝcode
!=
OP_NoCÚæiù
 ) 
sql™e3_found_couÁ
++;

72823 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72824 
as£¹
Ð
pOp
->
p4ty³
==
P4_INT32
 );

72825 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72826 
as£¹
Ð
pC
!=0 );

72827 #ifdeà
SQLITE_DEBUG


72828 
	gpC
->
	g£ekOp
 = 
pOp
->
Ýcode
;

72830 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

72831 
as£¹
Ð
pC
->
pCursÜ
!=0 );

72832 
as£¹
Ð
pC
->
isTabË
==0 );

72833 
	gpF»e
 = 0;

72834 ifÐ
	gpOp
->
	gp4
.
	gi
>0 ){

72835 
	gr
.
	gpKeyInfo
 = 
pC
->
pKeyInfo
;

72836 
	gr
.
	gnF›ld
 = (
u16
)
pOp
->
p4
.
i
;

72837 
	gr
.
	gaMem
 = 
pIn3
;

72838 
	gii
=0; ii<
	gr
.
	gnF›ld
; ii++){

72839 
as£¹
Ð
memIsV®id
(&
r
.
aMem
[
ii
]) );

72840 
Ex·ndBlob
(&
r
.
aMem
[
ii
]);

72841 #ifdeà
SQLITE_DEBUG


72842 ifÐ
	gii
 ) 
REGISTER_TRACE
(
pOp
->
p3
+
ii
, &
r
.
aMem
[ii]);

72845 
	gpIdxKey
 = &
r
;

72847 
	gpIdxKey
 = 
sql™e3VdbeAÎocUÅackedRecÜd
(

72848 
pC
->
pKeyInfo
, 
aTempRec
, ×TempRec), &
pF»e


72850 ifÐ
	gpIdxKey
==0 ) 
no_mem
;

72851 
as£¹
Ð
pIn3
->
æags
 & 
MEM_Blob
 );

72852 
as£¹
Ð(
pIn3
->
æags
 & 
MEM_Z”o
)==0 );

72853 
sql™e3VdbeRecÜdUÅack
(
pC
->
pKeyInfo
, 
pIn3
->
n
,…In3->
z
, 
pIdxKey
);

72855 
	gpIdxKey
->
	gdeçuÉ_rc
 = 0;

72856 ifÐ
	gpOp
->
	gÝcode
==
OP_NoCÚæiù
 ){

72860 
ii
=0; 
	gii
<
	gr
.
	gnF›ld
; ii++){

72861 ifÐ
	gr
.
	gaMem
[
ii
].
	gæags
 & 
	gMEM_NuÎ
 ){

72862 
	gpc
 = 
pOp
->
p2
 - 1; 
VdbeB¿nchTak’
(1,2);

72867 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pC
->
pCursÜ
, 
pIdxKey
, 0, 0, &
»s
);

72868 ifÐ
	gpOp
->
	gp4
.
	gi
==0 ){

72869 
sql™e3DbF»e
(
db
, 
pF»e
);

72871 ifÐ
	grc
!=
SQLITE_OK
 ){

72874 
	gpC
->
	g£ekResuÉ
 = 
»s
;

72875 
	g®»adyExi¡s
 = (
»s
==0);

72876 
	gpC
->
	gnuÎRow
 = 1-
®»adyExi¡s
;

72877 
	gpC
->
	gdeã¼edMov‘o
 = 0;

72878 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

72879 ifÐ
	gpOp
->
	gÝcode
==
OP_Found
 ){

72880 
VdbeB¿nchTak’
(
®»adyExi¡s
!=0,2);

72881 ifÐ
	g®»adyExi¡s
 ) 
	gpc
 = 
pOp
->
p2
 - 1;

72883 
VdbeB¿nchTak’
(
®»adyExi¡s
==0,2);

72884 ifÐ!
	g®»adyExi¡s
 ) 
	gpc
 = 
pOp
->
p2
 - 1;

72907 
	gOP_NÙExi¡s
: {

72908 
VdbeCursÜ
 *
pC
;

72909 
BtCursÜ
 *
	gpCr¤
;

72910 
	g»s
;

72911 
u64
 
	giKey
;

72913 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

72914 
as£¹
Ð
pIn3
->
æags
 & 
MEM_IÁ
 );

72915 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72916 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72917 
as£¹
Ð
pC
!=0 );

72918 #ifdeà
SQLITE_DEBUG


72919 
	gpC
->
	g£ekOp
 = 0;

72921 
as£¹
Ð
pC
->
isTabË
 );

72922 
as£¹
Ð
pC
->
p£udoTabËReg
==0 );

72923 
	gpCr¤
 = 
pC
->
pCursÜ
;

72924 
as£¹
Ð
pCr¤
!=0 );

72925 
	g»s
 = 0;

72926 
	giKey
 = 
pIn3
->
u
.
i
;

72927 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pCr¤
, 0, 
iKey
, 0, &
»s
);

72928 
	gpC
->
	gmov‘oT¬g‘
 = 
iKey
;

72929 
	gpC
->
	gnuÎRow
 = 0;

72930 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

72931 
	gpC
->
	gdeã¼edMov‘o
 = 0;

72932 
VdbeB¿nchTak’
(
»s
!=0,2);

72933 ifÐ
	g»s
!=0 ){

72934 
pc
 = 
pOp
->
p2
 - 1;

72936 
	gpC
->
	g£ekResuÉ
 = 
»s
;

72948 
	gOP_Sequ’û
: {

72949 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72950 
as£¹
Ð
p
->
­C¤
[
pOp
->
p1
]!=0 );

72951 
	gpOut
->
	gu
.
	gi
 = 
p
->
­C¤
[
pOp
->
p1
]->
£qCouÁ
++;

72971 
	gOP_NewRowid
: {

72972 
i64
 
v
;

72973 
VdbeCursÜ
 *
	gpC
;

72974 
	g»s
;

72975 
	gút
;

72976 
Mem
 *
	gpMem
;

72977 
VdbeF¿me
 *
	gpF¿me
;

72979 
	gv
 = 0;

72980 
	g»s
 = 0;

72981 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

72982 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

72983 
as£¹
Ð
pC
!=0 );

72984 ifÐ
NEVER
(
pC
->
pCursÜ
==0) ){

73000 
as£¹
Ð
pC
->
isTabË
 );

73002 #ifdeà
SQLITE_32BIT_ROWID


73003 
	#MAX_ROWID
 0x7fffffff

	)

73009 
	#MAX_ROWID
 (
i64
)Ð(((
u64
)0x7fffffff)<<32è| (u64)0xfffffffà)

	)

73012 ifÐ!
	gpC
->
	gu£RªdomRowid
 ){

73013 
	grc
 = 
sql™e3BŒ“La¡
(
pC
->
pCursÜ
, &
»s
);

73014 ifÐ
	grc
!=
SQLITE_OK
 ){

73015 
abÜt_due_to_”rÜ
;

73017 ifÐ
	g»s
 ){

73018 
	gv
 = 1;

73020 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pC
->
pCursÜ
) );

73021 
	grc
 = 
sql™e3BŒ“KeySize
(
pC
->
pCursÜ
, &
v
);

73022 
as£¹
Ð
rc
==
SQLITE_OK
 );

73023 ifÐ
	gv
>=
MAX_ROWID
 ){

73024 
pC
->
u£RªdomRowid
 = 1;

73026 
	gv
++;

73031 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


73032 ifÐ
	gpOp
->
	gp3
 ){

73034 
as£¹
Ð
pOp
->
p3
>0 );

73035 ifÐ
	gp
->
	gpF¿me
 ){

73036 
	gpF¿me
=
p
->
pF¿me
;…F¿me->
	gpP¬’t
;…F¿meõF¿me->
pP¬’t
);

73038 
as£¹
Ð
pOp
->
p3
<=
pF¿me
->
nMem
 );

73039 
	gpMem
 = &
pF¿me
->
aMem
[
pOp
->
p3
];

73042 
as£¹
Ð
pOp
->
p3
<=(
p
->
nMem
-p->
nCursÜ
) );

73043 
	gpMem
 = &
aMem
[
pOp
->
p3
];

73044 
memAboutToChªge
(
p
, 
pMem
);

73046 
as£¹
Ð
memIsV®id
(
pMem
) );

73048 
REGISTER_TRACE
(
pOp
->
p3
, 
pMem
);

73049 
sql™e3VdbeMemIÁeg”ify
(
pMem
);

73050 
as£¹
Ð(
pMem
->
æags
 & 
MEM_IÁ
)!=0 );

73051 ifÐ
	gpMem
->
	gu
.
	gi
==
MAX_ROWID
 || 
pC
->
u£RªdomRowid
 ){

73052 
rc
 = 
SQLITE_FULL
;

73053 
	gabÜt_due_to_”rÜ
;

73055 ifÐ
	gv
<
	gpMem
->
	gu
.
	gi
+1 ){

73056 
	gv
 = 
pMem
->
u
.
i
 + 1;

73058 
	gpMem
->
	gu
.
	gi
 = 
v
;

73061 ifÐ
	gpC
->
	gu£RªdomRowid
 ){

73066 
as£¹
Ð
pOp
->
p3
==0 );

73068 
	gút
 = 0;

73070 
sql™e3_¿ndomÃss
((
v
), &v);

73071 
	gv
 &ð(
MAX_ROWID
>>1); v++;

73072 } ((
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pC
->
pCursÜ
, 0, (
u64
)
v
,

73073 0, &
»s
))==
SQLITE_OK
)

73074 && (
»s
==0)

73075 && (++
út
<100));

73076 ifÐ
	grc
==
SQLITE_OK
 && 
»s
==0 ){

73077 
rc
 = 
SQLITE_FULL
;

73078 
	gabÜt_due_to_”rÜ
;

73080 
as£¹
Ð
v
>0 );

73082 
	gpC
->
	gdeã¼edMov‘o
 = 0;

73083 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73085 
	gpOut
->
	gu
.
	gi
 = 
v
;

73135 
	gOP_In£¹
:

73136 
OP_In£¹IÁ
: {

73137 
Mem
 *
pD©a
;

73138 
Mem
 *
	gpKey
;

73139 
i64
 
	giKey
;

73140 
VdbeCursÜ
 *
	gpC
;

73141 
	gnZ”o
;

73142 
	g£ekResuÉ
;

73143 cÚ¡ *
	gzDb
;

73144 cÚ¡ *
	gzTbl
;

73145 
	gÝ
;

73147 
	gpD©a
 = &
aMem
[
pOp
->
p2
];

73148 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73149 
as£¹
Ð
memIsV®id
(
pD©a
) );

73150 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73151 
as£¹
Ð
pC
!=0 );

73152 
as£¹
Ð
pC
->
pCursÜ
!=0 );

73153 
as£¹
Ð
pC
->
p£udoTabËReg
==0 );

73154 
as£¹
Ð
pC
->
isTabË
 );

73155 
REGISTER_TRACE
(
pOp
->
p2
, 
pD©a
);

73157 ifÐ
	gpOp
->
	gÝcode
==
OP_In£¹
 ){

73158 
pKey
 = &
aMem
[
pOp
->
p3
];

73159 
as£¹
Ð
pKey
->
æags
 & 
MEM_IÁ
 );

73160 
as£¹
Ð
memIsV®id
(
pKey
) );

73161 
REGISTER_TRACE
(
pOp
->
p3
, 
pKey
);

73162 
	giKey
 = 
pKey
->
u
.
i
;

73164 
as£¹
Ð
pOp
->
Ýcode
==
OP_In£¹IÁ
 );

73165 
	giKey
 = 
pOp
->
p3
;

73168 ifÐ
	gpOp
->
	gp5
 & 
	gOPFLAG_NCHANGE
 ) 
	gp
->
	gnChªge
++;

73169 ifÐ
	gpOp
->
	gp5
 & 
	gOPFLAG_LASTROWID
 ) 
	gdb
->
	gÏ¡Rowid
 = 
Ï¡Rowid
 = 
iKey
;

73170 ifÐ
	gpD©a
->
	gæags
 & 
	gMEM_NuÎ
 ){

73171 
	gpD©a
->
	gz
 = 0;

73172 
	gpD©a
->
	gn
 = 0;

73174 
as£¹
Ð
pD©a
->
æags
 & (
MEM_Blob
|
MEM_SŒ
) );

73176 
	g£ekResuÉ
 = ((
pOp
->
p5
 & 
OPFLAG_USESEEKRESULT
è? 
pC
->
£ekResuÉ
 : 0);

73177 ifÐ
	gpD©a
->
	gæags
 & 
	gMEM_Z”o
 ){

73178 
	gnZ”o
 = 
pD©a
->
u
.
nZ”o
;

73180 
	gnZ”o
 = 0;

73182 
	grc
 = 
sql™e3BŒ“In£¹
(
pC
->
pCursÜ
, 0, 
iKey
,

73183 
pD©a
->
z
,…D©a->
n
, 
nZ”o
,

73184 (
pOp
->
p5
 & 
OPFLAG_APPEND
)!=0, 
£ekResuÉ


73186 
	gpC
->
	gdeã¼edMov‘o
 = 0;

73187 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73190 ifÐ
	grc
==
SQLITE_OK
 && 
db
->
xUpd©eC®lback
 && 
pOp
->
p4
.
z
 ){

73191 
zDb
 = 
db
->
aDb
[
pC
->
iDb
].
zName
;

73192 
	gzTbl
 = 
pOp
->
p4
.
z
;

73193 
	gÝ
 = ((
pOp
->
p5
 & 
OPFLAG_ISUPDATE
è? 
SQLITE_UPDATE
 : 
SQLITE_INSERT
);

73194 
as£¹
Ð
pC
->
isTabË
 );

73195 
	gdb
->
xUpd©eC®lback
(
db
->
pUpd©eArg
, 
Ý
, 
zDb
, 
zTbl
, 
iKey
);

73196 
as£¹
Ð
pC
->
iDb
>=0 );

73221 
	gOP_D–‘e
: {

73222 
VdbeCursÜ
 *
pC
;

73224 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73225 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73226 
as£¹
Ð
pC
!=0 );

73227 
as£¹
Ð
pC
->
pCursÜ
!=0 );

73228 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73230 #ifdeà
SQLITE_DEBUG


73234 ifÐ
	gpOp
->
	gp4
.
	gz
 && 
	gpC
->
	gisTabË
 ){

73235 
i64
 
	giKey
 = 0;

73236 
sql™e3BŒ“KeySize
(
pC
->
pCursÜ
, &
iKey
);

73237 
as£¹
Ð
pC
->
mov‘oT¬g‘
==
iKey
 );

73241 
	grc
 = 
sql™e3BŒ“D–‘e
(
pC
->
pCursÜ
);

73242 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73245 ifÐ
	grc
==
SQLITE_OK
 && 
db
->
xUpd©eC®lback
 && 
pOp
->
p4
.
z
 && 
pC
->
isTabË
 ){

73246 
db
->
xUpd©eC®lback
(db->
pUpd©eArg
, 
SQLITE_DELETE
,

73247 
db
->
aDb
[
pC
->
iDb
].
zName
, 
pOp
->
p4
.
z
,…C->
mov‘oT¬g‘
);

73248 
as£¹
Ð
pC
->
iDb
>=0 );

73250 ifÐ
	gpOp
->
	gp2
 & 
	gOPFLAG_NCHANGE
 ) 
	gp
->
	gnChªge
++;

73260 
	gOP_Re£tCouÁ
: {

73261 
sql™e3VdbeS‘Chªges
(
db
, 
p
->
nChªge
);

73262 
	gp
->
	gnChªge
 = 0;

73281 
	gOP_SÜ‹rCom·»
: {

73282 
VdbeCursÜ
 *
pC
;

73283 
	g»s
;

73284 
	gnKeyCÞ
;

73286 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73287 
as£¹
Ð
isSÜ‹r
(
pC
) );

73288 
as£¹
Ð
pOp
->
p4ty³
==
P4_INT32
 );

73289 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

73290 
	gnKeyCÞ
 = 
pOp
->
p4
.
i
;

73291 
	g»s
 = 0;

73292 
	grc
 = 
sql™e3VdbeSÜ‹rCom·»
(
pC
, 
pIn3
, 
nKeyCÞ
, &
»s
);

73293 
VdbeB¿nchTak’
(
»s
!=0,2);

73294 ifÐ
	g»s
 ){

73295 
	gpc
 = 
pOp
->
p2
-1;

73312 
	gOP_SÜ‹rD©a
: {

73313 
VdbeCursÜ
 *
pC
;

73315 
	gpOut
 = &
aMem
[
pOp
->
p2
];

73316 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73317 
as£¹
Ð
isSÜ‹r
(
pC
) );

73318 
	grc
 = 
sql™e3VdbeSÜ‹rRowkey
(
pC
, 
pOut
);

73319 
as£¹
Ð
rc
!=
SQLITE_OK
 || (
pOut
->
æags
 & 
MEM_Blob
) );

73320 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73321 
	gp
->
	g­C¤
[
pOp
->
p3
]->
	gÿcheStus
 = 
CACHE_STALE
;

73347 
	gOP_RowKey
:

73348 
OP_RowD©a
: {

73349 
VdbeCursÜ
 *
pC
;

73350 
BtCursÜ
 *
	gpCr¤
;

73351 
u32
 
	gn
;

73352 
i64
 
	gn64
;

73354 
	gpOut
 = &
aMem
[
pOp
->
p2
];

73355 
memAboutToChªge
(
p
, 
pOut
);

73358 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73359 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73360 
as£¹
Ð
isSÜ‹r
(
pC
)==0 );

73361 
as£¹
Ð
pC
->
isTabË
 || 
pOp
->
Ýcode
!=
OP_RowD©a
 );

73362 
as£¹
Ð
pC
->
isTabË
==0 || 
pOp
->
Ýcode
==
OP_RowD©a
 );

73363 
as£¹
Ð
pC
!=0 );

73364 
as£¹
Ð
pC
->
nuÎRow
==0 );

73365 
as£¹
Ð
pC
->
p£udoTabËReg
==0 );

73366 
as£¹
Ð
pC
->
pCursÜ
!=0 );

73367 
	gpCr¤
 = 
pC
->
pCursÜ
;

73376 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73377 
as£¹
Ð
sql™e3BŒ“CursÜIsV®id
(
pCr¤
) );

73379 
	grc
 = 
sql™e3VdbeCursÜMov‘o
(
pC
);

73380 ifÐ
	grc
!=
SQLITE_OK
 ) 
abÜt_due_to_”rÜ
;

73383 ifÐ
	gpC
->
	gisTabË
==0 ){

73384 
as£¹
Ð!
pC
->
isTabË
 );

73385 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“KeySize
(
pCr¤
, &
n64
);

73386 
as£¹
Ð
rc
==
SQLITE_OK
 );

73387 ifÐ
	gn64
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

73388 
	gtoo_big
;

73390 
	gn
 = (
u32
)
n64
;

73392 
VVA_ONLY
(
rc
 =è
sql™e3BŒ“D©aSize
(
pCr¤
, &
n
);

73393 
as£¹
Ð
rc
==
SQLITE_OK
 );

73394 ifÐ
	gn
>(
	gu32
)
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

73395 
	gtoo_big
;

73398 
‹¡ÿ£
Ð
n
==0 );

73399 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pOut
, 
MAX
(
n
,32)) ){

73400 
	gno_mem
;

73402 
	gpOut
->
	gn
 = 
n
;

73403 
MemS‘Ty³FÏg
(
pOut
, 
MEM_Blob
);

73404 ifÐ
	gpC
->
	gisTabË
==0 ){

73405 
rc
 = 
sql™e3BŒ“Key
(
pCr¤
, 0, 
n
, 
pOut
->
z
);

73407 
	grc
 = 
sql™e3BŒ“D©a
(
pCr¤
, 0, 
n
, 
pOut
->
z
);

73409 
	gpOut
->
	g’c
 = 
SQLITE_UTF8
;

73410 
UPDATE_MAX_BLOBSIZE
(
pOut
);

73411 
REGISTER_TRACE
(
pOp
->
p2
, 
pOut
);

73425 
	gOP_Rowid
: {

73426 
VdbeCursÜ
 *
pC
;

73427 
i64
 
	gv
;

73428 
sql™e3_vb
 *
	gpVb
;

73429 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
;

73431 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73432 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73433 
as£¹
Ð
pC
!=0 );

73434 
as£¹
Ð
pC
->
p£udoTabËReg
==0 ||…C->
nuÎRow
 );

73435 ifÐ
	gpC
->
	gnuÎRow
 ){

73436 
	gpOut
->
	gæags
 = 
MEM_NuÎ
;

73438 }ifÐ
	gpC
->
	gdeã¼edMov‘o
 ){

73439 
	gv
 = 
pC
->
mov‘oT¬g‘
;

73440 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


73441 }ifÐ
	gpC
->
	gpVbCursÜ
 ){

73442 
	gpVb
 = 
pC
->
pVbCursÜ
->
pVb
;

73443 
	gpModuË
 = 
pVb
->
pModuË
;

73444 
as£¹
Ð
pModuË
->
xRowid
 );

73445 
	grc
 = 
pModuË
->
xRowid
(
pC
->
pVbCursÜ
, &
v
);

73446 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

73449 
as£¹
Ð
pC
->
pCursÜ
!=0 );

73450 
	grc
 = 
sql™e3VdbeCursÜRe¡Üe
(
pC
);

73451 ifÐ
	grc
 ) 
	gabÜt_due_to_”rÜ
;

73452 ifÐ
	gpC
->
	gnuÎRow
 ){

73453 
	gpOut
->
	gæags
 = 
MEM_NuÎ
;

73456 
	grc
 = 
sql™e3BŒ“KeySize
(
pC
->
pCursÜ
, &
v
);

73457 
as£¹
Ð
rc
==
SQLITE_OK
 );

73459 
	gpOut
->
	gu
.
	gi
 = 
v
;

73469 
	gOP_NuÎRow
: {

73470 
VdbeCursÜ
 *
pC
;

73472 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73473 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73474 
as£¹
Ð
pC
!=0 );

73475 
	gpC
->
	gnuÎRow
 = 1;

73476 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73477 ifÐ
	gpC
->
	gpCursÜ
 ){

73478 
sql™e3BŒ“CË¬CursÜ
(
pC
->
pCursÜ
);

73495 
	gOP_La¡
: {

73496 
VdbeCursÜ
 *
pC
;

73497 
BtCursÜ
 *
	gpCr¤
;

73498 
	g»s
;

73500 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73501 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73502 
as£¹
Ð
pC
!=0 );

73503 
	gpCr¤
 = 
pC
->
pCursÜ
;

73504 
	g»s
 = 0;

73505 
as£¹
Ð
pCr¤
!=0 );

73506 
	grc
 = 
sql™e3BŒ“La¡
(
pCr¤
, &
»s
);

73507 
	gpC
->
	gnuÎRow
 = (
u8
)
»s
;

73508 
	gpC
->
	gdeã¼edMov‘o
 = 0;

73509 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73510 #ifdeà
SQLITE_DEBUG


73511 
	gpC
->
	g£ekOp
 = 
OP_La¡
;

73513 ifÐ
	gpOp
->
	gp2
>0 ){

73514 
VdbeB¿nchTak’
(
»s
!=0,2);

73515 ifÐ
	g»s
 ) 
	gpc
 = 
pOp
->
p2
 - 1;

73533 
	gOP_SÜ‹rSÜt
:

73534 
OP_SÜt
: {

73535 #ifdeà
SQLITE_TEST


73536 
sql™e3_sÜt_couÁ
++;

73537 
	gsql™e3_£¬ch_couÁ
--;

73539 
	gp
->
	gaCouÁ”
[
SQLITE_STMTSTATUS_SORT
]++;

73554 
	gOP_Rewšd
: {

73555 
VdbeCursÜ
 *
pC
;

73556 
BtCursÜ
 *
	gpCr¤
;

73557 
	g»s
;

73559 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73560 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73561 
as£¹
Ð
pC
!=0 );

73562 
as£¹
Ð
isSÜ‹r
(
pC
)==(
pOp
->
Ýcode
==
OP_SÜ‹rSÜt
) );

73563 
	g»s
 = 1;

73564 #ifdeà
SQLITE_DEBUG


73565 
	gpC
->
	g£ekOp
 = 
OP_Rewšd
;

73567 ifÐ
isSÜ‹r
(
pC
) ){

73568 
	grc
 = 
sql™e3VdbeSÜ‹rRewšd
(
pC
, &
»s
);

73570 
	gpCr¤
 = 
pC
->
pCursÜ
;

73571 
as£¹
Ð
pCr¤
 );

73572 
	grc
 = 
sql™e3BŒ“Fœ¡
(
pCr¤
, &
»s
);

73573 
	gpC
->
	gdeã¼edMov‘o
 = 0;

73574 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73576 
	gpC
->
	gnuÎRow
 = (
u8
)
»s
;

73577 
as£¹
Ð
pOp
->
p2
>0 &&…Op->p2<
p
->
nOp
 );

73578 
VdbeB¿nchTak’
(
»s
!=0,2);

73579 ifÐ
	g»s
 ){

73580 
	gpc
 = 
pOp
->
p2
 - 1;

73648 
	gOP_SÜ‹rNext
: {

73649 
VdbeCursÜ
 *
pC
;

73650 
	g»s
;

73652 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73653 
as£¹
Ð
isSÜ‹r
(
pC
) );

73654 
	g»s
 = 0;

73655 
	grc
 = 
sql™e3VdbeSÜ‹rNext
(
db
, 
pC
, &
»s
);

73656 
	gÃxt_ž
;

73657 
	gOP_P»vIfO³n
:

73658 
OP_NextIfO³n
:

73659 ifÐ
p
->
­C¤
[
pOp
->
p1
]==0 ) ;

73661 
	gOP_P»v
:

73662 
OP_Next
:

73663 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73664 
as£¹
Ð
pOp
->
p5
<
A¼aySize
(
p
->
aCouÁ”
) );

73665 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73666 
	g»s
 = 
pOp
->
p3
;

73667 
as£¹
Ð
pC
!=0 );

73668 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73669 
as£¹
Ð
pC
->
pCursÜ
 );

73670 
as£¹
Ð
»s
==0 || (»s==1 && 
pC
->
isTabË
==0) );

73671 
‹¡ÿ£
Ð
»s
==1 );

73672 
as£¹
Ð
pOp
->
Ýcode
!=
OP_Next
 ||…Op->
p4
.
xAdvªû
==
sql™e3BŒ“Next
 );

73673 
as£¹
Ð
pOp
->
Ýcode
!=
OP_P»v
 ||…Op->
p4
.
xAdvªû
==
sql™e3BŒ“P»vious
 );

73674 
as£¹
Ð
pOp
->
Ýcode
!=
OP_NextIfO³n
 ||…Op->
p4
.
xAdvªû
==
sql™e3BŒ“Next
 );

73675 
as£¹
Ð
pOp
->
Ýcode
!=
OP_P»vIfO³n
 ||…Op->
p4
.
xAdvªû
==
sql™e3BŒ“P»vious
);

73679 
as£¹
Ð
pOp
->
Ýcode
!=
OP_Next
 ||…Op->Ýcode!=
OP_NextIfO³n


73680 || 
pC
->
£ekOp
==
OP_S“kGT
 ||…C->£ekOp==
OP_S“kGE


73681 || 
pC
->
£ekOp
==
OP_Rewšd
 ||…C->£ekOp==
OP_Found
);

73682 
as£¹
Ð
pOp
->
Ýcode
!=
OP_P»v
 ||…Op->Ýcode!=
OP_P»vIfO³n


73683 || 
pC
->
£ekOp
==
OP_S“kLT
 ||…C->£ekOp==
OP_S“kLE


73684 || 
pC
->
£ekOp
==
OP_La¡
 );

73686 
	grc
 = 
pOp
->
p4
.
xAdvªû
(
pC
->
pCursÜ
, &
»s
);

73687 
	gÃxt_ž
:

73688 
pC
->
ÿcheStus
 = 
CACHE_STALE
;

73689 
VdbeB¿nchTak’
(
»s
==0,2);

73690 ifÐ
	g»s
==0 ){

73691 
pC
->
nuÎRow
 = 0;

73692 
	gpc
 = 
pOp
->
p2
 - 1;

73693 
	gp
->
	gaCouÁ”
[
pOp
->
p5
]++;

73694 #ifdeà
SQLITE_TEST


73695 
	gsql™e3_£¬ch_couÁ
++;

73698 
	gpC
->
	gnuÎRow
 = 1;

73700 
	gcheck_fÜ_š‹¼u±
;

73724 
	gOP_SÜ‹rIn£¹
:

73725 
OP_IdxIn£¹
: {

73726 
VdbeCursÜ
 *
pC
;

73727 
BtCursÜ
 *
	gpCr¤
;

73728 
	gnKey
;

73729 cÚ¡ *
	gzKey
;

73731 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73732 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73733 
as£¹
Ð
pC
!=0 );

73734 
as£¹
Ð
isSÜ‹r
(
pC
)==(
pOp
->
Ýcode
==
OP_SÜ‹rIn£¹
) );

73735 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

73736 
as£¹
Ð
pIn2
->
æags
 & 
MEM_Blob
 );

73737 
	gpCr¤
 = 
pC
->
pCursÜ
;

73738 ifÐ
	gpOp
->
	gp5
 & 
	gOPFLAG_NCHANGE
 ) 
	gp
->
	gnChªge
++;

73739 
as£¹
Ð
pCr¤
!=0 );

73740 
as£¹
Ð
pC
->
isTabË
==0 );

73741 
	grc
 = 
Ex·ndBlob
(
pIn2
);

73742 ifÐ
	grc
==
SQLITE_OK
 ){

73743 ifÐ
isSÜ‹r
(
pC
) ){

73744 
rc
 = 
sql™e3VdbeSÜ‹rWr™e
(
pC
, 
pIn2
);

73746 
	gnKey
 = 
pIn2
->
n
;

73747 
	gzKey
 = 
pIn2
->
z
;

73748 
	grc
 = 
sql™e3BŒ“In£¹
(
pCr¤
, 
zKey
, 
nKey
, "", 0, 0, 
pOp
->
p3
,

73749 ((
pOp
->
p5
 & 
OPFLAG_USESEEKRESULT
è? 
pC
->
£ekResuÉ
 : 0)

73751 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73752 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73765 
	gOP_IdxD–‘e
: {

73766 
VdbeCursÜ
 *
pC
;

73767 
BtCursÜ
 *
	gpCr¤
;

73768 
	g»s
;

73769 
UÅackedRecÜd
 
	gr
;

73771 
as£¹
Ð
pOp
->
p3
>0 );

73772 
as£¹
Ð
pOp
->
p2
>0 &&…Op->p2+pOp->
p3
<=(
p
->
nMem
-p->
nCursÜ
)+1 );

73773 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73774 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73775 
as£¹
Ð
pC
!=0 );

73776 
	gpCr¤
 = 
pC
->
pCursÜ
;

73777 
as£¹
Ð
pCr¤
!=0 );

73778 
as£¹
Ð
pOp
->
p5
==0 );

73779 
	gr
.
	gpKeyInfo
 = 
pC
->
pKeyInfo
;

73780 
	gr
.
	gnF›ld
 = (
u16
)
pOp
->
p3
;

73781 
	gr
.
	gdeçuÉ_rc
 = 0;

73782 
	gr
.
	gaMem
 = &
aMem
[
pOp
->
p2
];

73783 #ifdeà
SQLITE_DEBUG


73784 { 
	gi
; i=0; i<
	gr
.
	gnF›ld
; i++è
as£¹
Ð
memIsV®id
(&
r
.
aMem
[
i
]) ); }

73786 
	grc
 = 
sql™e3BŒ“Mov‘oUÅacked
(
pCr¤
, &
r
, 0, 0, &
»s
);

73787 ifÐ
	grc
==
SQLITE_OK
 && 
»s
==0 ){

73788 
rc
 = 
sql™e3BŒ“D–‘e
(
pCr¤
);

73790 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73791 
	gpC
->
	gÿcheStus
 = 
CACHE_STALE
;

73804 
	gOP_IdxRowid
: {

73805 
BtCursÜ
 *
pCr¤
;

73806 
VdbeCursÜ
 *
	gpC
;

73807 
i64
 
	growid
;

73809 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73810 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73811 
as£¹
Ð
pC
!=0 );

73812 
	gpCr¤
 = 
pC
->
pCursÜ
;

73813 
as£¹
Ð
pCr¤
!=0 );

73814 
	gpOut
->
	gæags
 = 
MEM_NuÎ
;

73815 
as£¹
Ð
pC
->
isTabË
==0 );

73816 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73822 
	grc
 = 
sql™e3VdbeCursÜRe¡Üe
(
pC
);

73823 ifÐ
NEVER
(
rc
!=
SQLITE_OK
èè
abÜt_due_to_”rÜ
;

73825 ifÐ!
	gpC
->
	gnuÎRow
 ){

73826 
	growid
 = 0;

73827 
	grc
 = 
sql™e3VdbeIdxRowid
(
db
, 
pCr¤
, &
rowid
);

73828 ifÐ
	grc
!=
SQLITE_OK
 ){

73829 
abÜt_due_to_”rÜ
;

73831 
	gpOut
->
	gu
.
	gi
 = 
rowid
;

73832 
	gpOut
->
	gæags
 = 
MEM_IÁ
;

73881 
	gOP_IdxLE
:

73882 
OP_IdxGT
:

73883 
OP_IdxLT
:

73884 
OP_IdxGE
: {

73885 
VdbeCursÜ
 *
pC
;

73886 
	g»s
;

73887 
UÅackedRecÜd
 
	gr
;

73889 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

73890 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

73891 
as£¹
Ð
pC
!=0 );

73892 
as£¹
Ð
pC
->
isOrd”ed
 );

73893 
as£¹
Ð
pC
->
pCursÜ
!=0);

73894 
as£¹
Ð
pC
->
deã¼edMov‘o
==0 );

73895 
as£¹
Ð
pOp
->
p5
==0 ||…Op->p5==1 );

73896 
as£¹
Ð
pOp
->
p4ty³
==
P4_INT32
 );

73897 
	gr
.
	gpKeyInfo
 = 
pC
->
pKeyInfo
;

73898 
	gr
.
	gnF›ld
 = (
u16
)
pOp
->
p4
.
i
;

73899 ifÐ
	gpOp
->
	gÝcode
<
	gOP_IdxLT
 ){

73900 
as£¹
Ð
pOp
->
Ýcode
==
OP_IdxLE
 ||…Op->Ýcode==
OP_IdxGT
 );

73901 
	gr
.
	gdeçuÉ_rc
 = -1;

73903 
as£¹
Ð
pOp
->
Ýcode
==
OP_IdxGE
 ||…Op->Ýcode==
OP_IdxLT
 );

73904 
	gr
.
	gdeçuÉ_rc
 = 0;

73906 
	gr
.
	gaMem
 = &
aMem
[
pOp
->
p3
];

73907 #ifdeà
SQLITE_DEBUG


73908 { 
	gi
; i=0; i<
	gr
.
	gnF›ld
; i++è
as£¹
Ð
memIsV®id
(&
r
.
aMem
[
i
]) ); }

73910 
	g»s
 = 0;

73911 
	grc
 = 
sql™e3VdbeIdxKeyCom·»
(
db
, 
pC
, &
r
, &
»s
);

73912 
as£¹
Ð(
OP_IdxLE
&1)==(
OP_IdxLT
&1è&& (
OP_IdxGE
&1)==(
OP_IdxGT
&1) );

73913 ifÐ(
	gpOp
->
	gÝcode
&1)==(
OP_IdxLT
&1) ){

73914 
as£¹
Ð
pOp
->
Ýcode
==
OP_IdxLE
 ||…Op->Ýcode==
OP_IdxLT
 );

73915 
	g»s
 = -
»s
;

73917 
as£¹
Ð
pOp
->
Ýcode
==
OP_IdxGE
 ||…Op->Ýcode==
OP_IdxGT
 );

73918 
	g»s
++;

73920 
VdbeB¿nchTak’
(
»s
>0,2);

73921 ifÐ
	g»s
>0 ){

73922 
	gpc
 = 
pOp
->
p2
 - 1 ;

73947 
	gOP_De¡roy
: {

73948 
iMoved
;

73949 
	giCÁ
;

73950 
Vdbe
 *
	gpVdbe
;

73951 
	giDb
;

73953 
as£¹
Ð
p
->
»adOÆy
==0 );

73954 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


73955 
	giCÁ
 = 0;

73956 
	gpVdbe
=
db
->
pVdbe
;…Vdbe;…VdbðpVdbe->
pNext
){

73957 ifÐ
pVdbe
->
magic
==
VDBE_MAGIC_RUN
 &&…Vdbe->
bIsR—d”


73958 && 
pVdbe
->
šVbM‘hod
<2 &&…Vdbe->
pc
>=0

73960 
iCÁ
++;

73964 
	giCÁ
 = 
db
->
nVdbeR—d
;

73966 
	gpOut
->
	gæags
 = 
MEM_NuÎ
;

73967 ifÐ
	giCÁ
>1 ){

73968 
	grc
 = 
SQLITE_LOCKED
;

73969 
	gp
->
	g”rÜAùiÚ
 = 
OE_AbÜt
;

73971 
	giDb
 = 
pOp
->
p3
;

73972 
as£¹
Ð
iCÁ
==1 );

73973 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
iDb
) );

73974 
	giMoved
 = 0;

73975 
	grc
 = 
sql™e3BŒ“DrÝTabË
(
db
->
aDb
[
iDb
].
pBt
, 
pOp
->
p1
, &
iMoved
);

73976 
	gpOut
->
	gæags
 = 
MEM_IÁ
;

73977 
	gpOut
->
	gu
.
	gi
 = 
iMoved
;

73978 #iâdeà
SQLITE_OMIT_AUTOVACUUM


73979 ifÐ
	grc
==
SQLITE_OK
 && 
iMoved
!=0 ){

73980 
sql™e3RoÙPageMoved
(
db
, 
iDb
, 
iMoved
, 
pOp
->
p1
);

73982 
as£¹
Ð
»£tSchemaOnFauÉ
==0 ||„e£tSchemaOnFauÉ==
iDb
+1 );

73983 
	g»£tSchemaOnFauÉ
 = 
iDb
+1;

74008 
	gOP_CË¬
: {

74009 
nChªge
;

74011 
	gnChªge
 = 0;

74012 
as£¹
Ð
p
->
»adOÆy
==0 );

74013 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p2
) );

74014 
	grc
 = 
sql™e3BŒ“CË¬TabË
(

74015 
db
->
aDb
[
pOp
->
p2
].
pBt
,…Op->
p1
, (pOp->
p3
 ? &
nChªge
 : 0)

74017 ifÐ
	gpOp
->
	gp3
 ){

74018 
	gp
->
	gnChªge
 +ð
nChªge
;

74019 ifÐ
	gpOp
->
	gp3
>0 ){

74020 
as£¹
Ð
memIsV®id
(&
aMem
[
pOp
->
p3
]) );

74021 
memAboutToChªge
(
p
, &
aMem
[
pOp
->
p3
]);

74022 
	gaMem
[
pOp
->
p3
].
	gu
.
	gi
 +ð
nChªge
;

74036 
	gOP_Re£tSÜ‹r
: {

74037 
VdbeCursÜ
 *
pC
;

74039 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
p
->
nCursÜ
 );

74040 
	gpC
 = 
p
->
­C¤
[
pOp
->
p1
];

74041 
as£¹
Ð
pC
!=0 );

74042 ifÐ
	gpC
->
	gpSÜ‹r
 ){

74043 
sql™e3VdbeSÜ‹rRe£t
(
db
, 
pC
->
pSÜ‹r
);

74045 
as£¹
Ð
pC
->
isEphem”®
 );

74046 
	grc
 = 
sql™e3BŒ“CË¬TabËOfCursÜ
(
pC
->
pCursÜ
);

74075 
	gOP_C»©eIndex
:

74076 
OP_C»©eTabË
: {

74077 
pgno
;

74078 
	gæags
;

74079 
Db
 *
	gpDb
;

74081 
	gpgno
 = 0;

74082 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

74083 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p1
) );

74084 
as£¹
Ð
p
->
»adOÆy
==0 );

74085 
	gpDb
 = &
db
->
aDb
[
pOp
->
p1
];

74086 
as£¹
Ð
pDb
->
pBt
!=0 );

74087 ifÐ
	gpOp
->
	gÝcode
==
OP_C»©eTabË
 ){

74089 
æags
 = 
BTREE_INTKEY
;

74091 
	gæags
 = 
BTREE_BLOBKEY
;

74093 
	grc
 = 
sql™e3BŒ“C»©eTabË
(
pDb
->
pBt
, &
pgno
, 
æags
);

74094 
	gpOut
->
	gu
.
	gi
 = 
pgno
;

74106 
	gOP_P¬£Schema
: {

74107 
iDb
;

74108 cÚ¡ *
	gzMa¡”
;

74109 *
	gzSql
;

74110 
In™D©a
 
	gš™D©a
;

74116 #ifdeà
SQLITE_DEBUG


74117 
	giDb
=0; iDb<
	gdb
->
	gnDb
; iDb++){

74118 
as£¹
Ð
iDb
==1 || 
sql™e3BŒ“HÞdsMu‹x
(
db
->
aDb
[iDb].
pBt
) );

74122 
	giDb
 = 
pOp
->
p1
;

74123 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

74124 
as£¹
Ð
DbHasPrÝ”ty
(
db
, 
iDb
, 
DB_SchemaLßded
) );

74126 
	gzMa¡”
 = 
SCHEMA_TABLE
(
iDb
);

74127 
	gš™D©a
.
	gdb
 = 
db
;

74128 
	gš™D©a
.
	giDb
 = 
pOp
->
p1
;

74129 
	gš™D©a
.
	gpzE¼Msg
 = &
p
->
zE¼Msg
;

74130 
	gzSql
 = 
sql™e3MPrštf
(
db
,

74132 
db
->
aDb
[
iDb
].
zName
, 
zMa¡”
, 
pOp
->
p4
.
z
);

74133 ifÐ
	gzSql
==0 ){

74134 
rc
 = 
SQLITE_NOMEM
;

74136 
as£¹
Ð
db
->
š™
.
busy
==0 );

74137 
	gdb
->
	gš™
.
	gbusy
 = 1;

74138 
	gš™D©a
.
	grc
 = 
SQLITE_OK
;

74139 
as£¹
Ð!
db
->
m®locFažed
 );

74140 
	grc
 = 
sql™e3_exec
(
db
, 
zSql
, 
sql™e3In™C®lback
, &
š™D©a
, 0);

74141 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
š™D©a
.rc;

74142 
sql™e3DbF»e
(
db
, 
zSql
);

74143 
	gdb
->
	gš™
.
	gbusy
 = 0;

74146 ifÐ
	grc
 ) 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

74147 ifÐ
	grc
==
SQLITE_NOMEM
 ){

74148 
no_mem
;

74153 #ià!
defšed
(
SQLITE_OMIT_ANALYZE
)

74160 
	gOP_LßdAÇlysis
: {

74161 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

74162 
	grc
 = 
sql™e3AÇlysisLßd
(
db
, 
pOp
->
p1
);

74175 
	gOP_DrÝTabË
: {

74176 
sql™e3UÆškAndD–‘eTabË
(
db
, 
pOp
->
p1
,…Op->
p4
.
z
);

74188 
	gOP_DrÝIndex
: {

74189 
sql™e3UÆškAndD–‘eIndex
(
db
, 
pOp
->
p1
,…Op->
p4
.
z
);

74201 
	gOP_DrÝTrigg”
: {

74202 
sql™e3UÆškAndD–‘eTrigg”
(
db
, 
pOp
->
p1
,…Op->
p4
.
z
);

74207 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


74228 
	gOP_IÁegr™yCk
: {

74229 
nRoÙ
;

74230 *
	gaRoÙ
;

74231 
	gj
;

74232 
	gnE¼
;

74233 *
	gz
;

74234 
Mem
 *
	g²E¼
;

74236 
as£¹
Ð
p
->
bIsR—d”
 );

74237 
	gnRoÙ
 = 
pOp
->
p2
;

74238 
as£¹
Ð
nRoÙ
>0 );

74239 
	gaRoÙ
 = 
sql™e3DbM®locRaw
(
db
, ()*(
nRoÙ
+1) );

74240 ifÐ
	gaRoÙ
==0 ) 
no_mem
;

74241 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

74242 
	g²E¼
 = &
aMem
[
pOp
->
p3
];

74243 
as£¹
Ð(
²E¼
->
æags
 & 
MEM_IÁ
)!=0 );

74244 
as£¹
Ð(
²E¼
->
æags
 & (
MEM_SŒ
|
MEM_Blob
))==0 );

74245 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

74246 
	gj
=0; j<
	gnRoÙ
; j++){

74247 
	gaRoÙ
[
j
] = ()
sql™e3VdbeIÁV®ue
(&
pIn1
[j]);

74249 
	gaRoÙ
[
j
] = 0;

74250 
as£¹
Ð
pOp
->
p5
<
db
->
nDb
 );

74251 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p5
) );

74252 
	gz
 = 
sql™e3BŒ“IÁegr™yCheck
(
db
->
aDb
[
pOp
->
p5
].
pBt
, 
aRoÙ
, 
nRoÙ
,

74253 ()
²E¼
->
u
.
i
, &
nE¼
);

74254 
sql™e3DbF»e
(
db
, 
aRoÙ
);

74255 
	g²E¼
->
	gu
.
	gi
 -ð
nE¼
;

74256 
sql™e3VdbeMemS‘NuÎ
(
pIn1
);

74257 ifÐ
	gnE¼
==0 ){

74258 
as£¹
Ð
z
==0 );

74259 }ifÐ
	gz
==0 ){

74260 
no_mem
;

74262 
sql™e3VdbeMemS‘SŒ
(
pIn1
, 
z
, -1, 
SQLITE_UTF8
, 
sql™e3_ä“
);

74264 
UPDATE_MAX_BLOBSIZE
(
pIn1
);

74265 
sql™e3VdbeChªgeEncodšg
(
pIn1
, 
’codšg
);

74278 
	gOP_RowS‘Add
: {

74279 
pIn1
 = &
aMem
[
pOp
->
p1
];

74280 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

74281 
as£¹
Ð(
pIn2
->
æags
 & 
MEM_IÁ
)!=0 );

74282 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_RowS‘
)==0 ){

74283 
sql™e3VdbeMemS‘RowS‘
(
pIn1
);

74284 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_RowS‘
)==0 ) 
no_mem
;

74286 
sql™e3RowS‘In£¹
(
pIn1
->
u
.
pRowS‘
, 
pIn2
->u.
i
);

74297 
	gOP_RowS‘R—d
: {

74298 
i64
 
v®
;

74300 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

74301 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_RowS‘
)==0

74302 || 
sql™e3RowS‘Next
(
pIn1
->
u
.
pRowS‘
, &
v®
)==0

74305 
sql™e3VdbeMemS‘NuÎ
(
pIn1
);

74306 
	gpc
 = 
pOp
->
p2
 - 1;

74307 
VdbeB¿nchTak’
(1,2);

74310 
sql™e3VdbeMemS‘IÁ64
(&
aMem
[
pOp
->
p3
], 
v®
);

74311 
VdbeB¿nchTak’
(0,2);

74313 
	gcheck_fÜ_š‹¼u±
;

74340 
	gOP_RowS‘Te¡
: {

74341 
iS‘
;

74342 
	gexi¡s
;

74344 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

74345 
	gpIn3
 = &
aMem
[
pOp
->
p3
];

74346 
	giS‘
 = 
pOp
->
p4
.
i
;

74347 
as£¹
Ð
pIn3
->
æags
&
MEM_IÁ
 );

74352 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_RowS‘
)==0 ){

74353 
sql™e3VdbeMemS‘RowS‘
(
pIn1
);

74354 ifÐ(
	gpIn1
->
	gæags
 & 
	gMEM_RowS‘
)==0 ) 
no_mem
;

74357 
as£¹
Ð
pOp
->
p4ty³
==
P4_INT32
 );

74358 
as£¹
Ð
iS‘
==-1 || iSet>=0 );

74359 ifÐ
	giS‘
 ){

74360 
	gexi¡s
 = 
sql™e3RowS‘Te¡
(
pIn1
->
u
.
pRowS‘
, 
iS‘
, 
pIn3
->u.
i
);

74361 
VdbeB¿nchTak’
(
exi¡s
!=0,2);

74362 ifÐ
	gexi¡s
 ){

74363 
	gpc
 = 
pOp
->
p2
 - 1;

74367 ifÐ
	giS‘
>=0 ){

74368 
sql™e3RowS‘In£¹
(
pIn1
->
u
.
pRowS‘
, 
pIn3
->u.
i
);

74374 #iâdeà
SQLITE_OMIT_TRIGGER


74391 
	gOP_Prog¿m
: {

74392 
nMem
;

74393 
	gnBy‹
;

74394 
Mem
 *
	gpRt
;

74395 
Mem
 *
	gpMem
;

74396 
Mem
 *
	gpEnd
;

74397 
VdbeF¿me
 *
	gpF¿me
;

74398 
SubProg¿m
 *
	gpProg¿m
;

74399 *
	gt
;

74401 
	gpProg¿m
 = 
pOp
->
p4
.
pProg¿m
;

74402 
	gpRt
 = &
aMem
[
pOp
->
p3
];

74403 
as£¹
Ð
pProg¿m
->
nOp
>0 );

74416 ifÐ
	gpOp
->
	gp5
 ){

74417 
	gt
 = 
pProg¿m
->
tok’
;

74418 
	gpF¿me
=
p
->
pF¿me
;…F¿m&&…F¿me->
	gtok’
!=
t
;…F¿meõF¿me->
pP¬’t
);

74419 ifÐ
	gpF¿me
 ) ;

74422 ifÐ
	gp
->
	gnF¿me
>=
db
->
aLim™
[
SQLITE_LIMIT_TRIGGER_DEPTH
] ){

74423 
rc
 = 
SQLITE_ERROR
;

74424 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "too many†evels ofrigger„ecursion");

74432 ifÐ(
	gpRt
->
	gæags
&
	gMEM_F¿me
)==0 ){

74438 
nMem
 = 
pProg¿m
->nMem +…Prog¿m->
nC¤
;

74439 
	gnBy‹
 = 
ROUND8
((
VdbeF¿me
))

74440 + 
nMem
 * (
Mem
)

74441 + 
pProg¿m
->
nC¤
 * (
VdbeCursÜ
 *)

74442 + 
pProg¿m
->
nOnû
 * (
u8
);

74443 
	gpF¿me
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

74444 ifÐ!
	gpF¿me
 ){

74445 
	gno_mem
;

74447 
sql™e3VdbeMemR–—£
(
pRt
);

74448 
	gpRt
->
	gæags
 = 
MEM_F¿me
;

74449 
	gpRt
->
	gu
.
	gpF¿me
 = 
pF¿me
;

74451 
	gpF¿me
->
	gv
 = 
p
;

74452 
	gpF¿me
->
	gnChždMem
 = 
nMem
;

74453 
	gpF¿me
->
	gnChždC¤
 = 
pProg¿m
->
nC¤
;

74454 
	gpF¿me
->
	gpc
 = 
pc
;

74455 
	gpF¿me
->
	gaMem
 = 
p
->
aMem
;

74456 
	gpF¿me
->
	gnMem
 = 
p
->
nMem
;

74457 
	gpF¿me
->
	g­C¤
 = 
p
->
­C¤
;

74458 
	gpF¿me
->
	gnCursÜ
 = 
p
->
nCursÜ
;

74459 
	gpF¿me
->
	gaOp
 = 
p
->
aOp
;

74460 
	gpF¿me
->
	gnOp
 = 
p
->
nOp
;

74461 
	gpF¿me
->
	gtok’
 = 
pProg¿m
->
tok’
;

74462 
	gpF¿me
->
	gaOnûFÏg
 = 
p
->
aOnûFÏg
;

74463 
	gpF¿me
->
	gnOnûFÏg
 = 
p
->
nOnûFÏg
;

74465 
	gpEnd
 = &
VdbeF¿meMem
(
pF¿me
)[pF¿me->
nChždMem
];

74466 
	gpMem
=
VdbeF¿meMem
(
pF¿me
);…Mem!=
pEnd
;…Mem++){

74467 
	gpMem
->
	gæags
 = 
MEM_Undefšed
;

74468 
	gpMem
->
	gdb
 = 
db
;

74471 
	gpF¿me
 = 
pRt
->
u
.
pF¿me
;

74472 
as£¹
Ð
pProg¿m
->
nMem
+pProg¿m->
nC¤
==
pF¿me
->
nChždMem
 );

74473 
as£¹
Ð
pProg¿m
->
nC¤
==
pF¿me
->
nChždC¤
 );

74474 
as£¹
Ð
pc
==
pF¿me
->pc );

74477 
	gp
->
	gnF¿me
++;

74478 
	gpF¿me
->
	gpP¬’t
 = 
p
->
pF¿me
;

74479 
	gpF¿me
->
	gÏ¡Rowid
 = 
Ï¡Rowid
;

74480 
	gpF¿me
->
	gnChªge
 = 
p
->
nChªge
;

74481 
	gp
->
	gnChªge
 = 0;

74482 
	gp
->
	gpF¿me
 = 
pF¿me
;

74483 
	gp
->
	gaMem
 = 
aMem
 = &
VdbeF¿meMem
(
pF¿me
)[-1];

74484 
	gp
->
	gnMem
 = 
pF¿me
->
nChždMem
;

74485 
	gp
->
	gnCursÜ
 = (
u16
)
pF¿me
->
nChždC¤
;

74486 
	gp
->
	g­C¤
 = (
VdbeCursÜ
 **)&
aMem
[
p
->
nMem
+1];

74487 
	gp
->
	gaOp
 = 
aOp
 = 
pProg¿m
->aOp;

74488 
	gp
->
	gnOp
 = 
pProg¿m
->
nOp
;

74489 
	gp
->
	gaOnûFÏg
 = (
u8
 *)&
p
->
­C¤
[p->
nCursÜ
];

74490 
	gp
->
	gnOnûFÏg
 = 
pProg¿m
->
nOnû
;

74491 
	gpc
 = -1;

74492 
mem£t
(
p
->
aOnûFÏg
, 0,…->
nOnûFÏg
);

74509 
	gOP_P¬am
: {

74510 
VdbeF¿me
 *
pF¿me
;

74511 
Mem
 *
	gpIn
;

74512 
	gpF¿me
 = 
p
->
pF¿me
;

74513 
	gpIn
 = &
pF¿me
->
aMem
[
pOp
->
p1
 +…F¿me->
aOp
[pF¿me->
pc
].p1];

74514 
sql™e3VdbeMemSh®lowCÝy
(
pOut
, 
pIn
, 
MEM_Ephem
);

74520 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


74529 
	gOP_FkCouÁ”
: {

74530 ifÐ
db
->
æags
 & 
SQLITE_DeãrFKs
 ){

74531 
db
->
nDeã¼edImmCÚs
 +ð
pOp
->
p2
;

74532 }ifÐ
	gpOp
->
	gp1
 ){

74533 
	gdb
->
	gnDeã¼edCÚs
 +ð
pOp
->
p2
;

74535 
	gp
->
	gnFkCÚ¡¿št
 +ð
pOp
->
p2
;

74552 
	gOP_FkIfZ”o
: {

74553 ifÐ
pOp
->
p1
 ){

74554 
VdbeB¿nchTak’
(
db
->
nDeã¼edCÚs
==0 && db->
nDeã¼edImmCÚs
==0, 2);

74555 ifÐ
	gdb
->
	gnDeã¼edCÚs
==0 && 
db
->
nDeã¼edImmCÚs
==0 ) 
pc
 = 
pOp
->
p2
-1;

74557 
VdbeB¿nchTak’
(
p
->
nFkCÚ¡¿št
==0 && 
db
->
nDeã¼edImmCÚs
==0, 2);

74558 ifÐ
	gp
->
	gnFkCÚ¡¿št
==0 && 
db
->
nDeã¼edImmCÚs
==0 ) 
pc
 = 
pOp
->
p2
-1;

74564 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


74576 
	gOP_MemMax
: {

74577 
VdbeF¿me
 *
pF¿me
;

74578 ifÐ
	gp
->
	gpF¿me
 ){

74579 
	gpF¿me
=
p
->
pF¿me
;…F¿me->
	gpP¬’t
;…F¿meõF¿me->
pP¬’t
);

74580 
	gpIn1
 = &
pF¿me
->
aMem
[
pOp
->
p1
];

74582 
	gpIn1
 = &
aMem
[
pOp
->
p1
];

74584 
as£¹
Ð
memIsV®id
(
pIn1
) );

74585 
sql™e3VdbeMemIÁeg”ify
(
pIn1
);

74586 
	gpIn2
 = &
aMem
[
pOp
->
p2
];

74587 
sql™e3VdbeMemIÁeg”ify
(
pIn2
);

74588 ifÐ
	gpIn1
->
	gu
.
	gi
<
	gpIn2
->u.i){

74589 
	gpIn1
->
	gu
.
	gi
 = 
pIn2
->
u
.
i
;

74603 
	gOP_IfPos
: {

74604 
pIn1
 = &
aMem
[
pOp
->
p1
];

74605 
as£¹
Ð
pIn1
->
æags
&
MEM_IÁ
 );

74606 
VdbeB¿nchTak’
Ð
pIn1
->
u
.
i
>0, 2);

74607 ifÐ
	gpIn1
->
	gu
.
	gi
>0 ){

74608 
	gpc
 = 
pOp
->
p2
 - 1;

74619 
	gOP_IfNeg
: {

74620 
pIn1
 = &
aMem
[
pOp
->
p1
];

74621 
as£¹
Ð
pIn1
->
æags
&
MEM_IÁ
 );

74622 
	gpIn1
->
	gu
.
	gi
 +ð
pOp
->
p3
;

74623 
VdbeB¿nchTak’
(
pIn1
->
u
.
i
<0, 2);

74624 ifÐ
	gpIn1
->
	gu
.
	gi
<0 ){

74625 
	gpc
 = 
pOp
->
p2
 - 1;

74636 
	gOP_IfZ”o
: {

74637 
pIn1
 = &
aMem
[
pOp
->
p1
];

74638 
as£¹
Ð
pIn1
->
æags
&
MEM_IÁ
 );

74639 
	gpIn1
->
	gu
.
	gi
 +ð
pOp
->
p3
;

74640 
VdbeB¿nchTak’
(
pIn1
->
u
.
i
==0, 2);

74641 ifÐ
	gpIn1
->
	gu
.
	gi
==0 ){

74642 
pc
 = 
pOp
->
p2
 - 1;

74658 
	gOP_AggS‹p
: {

74659 
n
;

74660 
	gi
;

74661 
Mem
 *
	gpMem
;

74662 
Mem
 *
	gpRec
;

74663 
Mem
 
	gt
;

74664 
sql™e3_cÚ‹xt
 
	gùx
;

74665 
sql™e3_v®ue
 **
	g­V®
;

74667 
	gn
 = 
pOp
->
p5
;

74668 
as£¹
Ð
n
>=0 );

74669 
	gpRec
 = &
aMem
[
pOp
->
p2
];

74670 
	g­V®
 = 
p
->
­Arg
;

74671 
as£¹
Ð
­V®
 || 
n
==0 );

74672 
	gi
=0; i<
	gn
; i++, 
	gpRec
++){

74673 
as£¹
Ð
memIsV®id
(
pRec
) );

74674 
	g­V®
[
i
] = 
pRec
;

74675 
memAboutToChªge
(
p
, 
pRec
);

74677 
	gùx
.
	gpFunc
 = 
pOp
->
p4
.
pFunc
;

74678 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

74679 
	gùx
.
	gpMem
 = 
pMem
 = &
aMem
[
pOp
->
p3
];

74680 
	gpMem
->
	gn
++;

74681 
sql™e3VdbeMemIn™
(&
t
, 
db
, 
MEM_NuÎ
);

74682 
	gùx
.
	gpOut
 = &
t
;

74683 
	gùx
.
	gisE¼Ü
 = 0;

74684 
	gùx
.
	gpVdbe
 = 
p
;

74685 
	gùx
.
	giOp
 = 
pc
;

74686 
	gùx
.
	gskFÏg
 = 0;

74687 (
	gùx
.
	gpFunc
->
	gxS‹p
)(&ùx, 
	gn
, 
	g­V®
);

74688 ifÐ
	gùx
.
	gisE¼Ü
 ){

74689 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3_v®ue_‹xt
(&
t
));

74690 
	grc
 = 
ùx
.
isE¼Ü
;

74692 ifÐ
	gùx
.
	gskFÏg
 ){

74693 
as£¹
Ð
pOp
[-1].
Ýcode
==
OP_CÞlSeq
 );

74694 
	gi
 = 
pOp
[-1].
p1
;

74695 ifÐ
	gi
 ) 
sql™e3VdbeMemS‘IÁ64
(&
aMem
[
i
], 1);

74697 
sql™e3VdbeMemR–—£
(&
t
);

74714 
	gOP_AggFš®
: {

74715 
Mem
 *
pMem
;

74716 
as£¹
Ð
pOp
->
p1
>0 &&…Op->p1<=(
p
->
nMem
-p->
nCursÜ
) );

74717 
	gpMem
 = &
aMem
[
pOp
->
p1
];

74718 
as£¹
Ð(
pMem
->
æags
 & ~(
MEM_NuÎ
|
MEM_Agg
))==0 );

74719 
	grc
 = 
sql™e3VdbeMemFš®ize
(
pMem
, 
pOp
->
p4
.
pFunc
);

74720 ifÐ
	grc
 ){

74721 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3_v®ue_‹xt
(
pMem
));

74723 
sql™e3VdbeChªgeEncodšg
(
pMem
, 
’codšg
);

74724 
UPDATE_MAX_BLOBSIZE
(
pMem
);

74725 ifÐ
sql™e3VdbeMemTooBig
(
pMem
) ){

74726 
	gtoo_big
;

74731 #iâdeà
SQLITE_OMIT_WAL


74743 
	gOP_Checkpošt
: {

74744 
i
;

74745 
	gaRes
[3];

74746 
Mem
 *
	gpMem
;

74748 
as£¹
Ð
p
->
»adOÆy
==0 );

74749 
	gaRes
[0] = 0;

74750 
	gaRes
[1] = 
aRes
[2] = -1;

74751 
as£¹
Ð
pOp
->
p2
==
SQLITE_CHECKPOINT_PASSIVE


74752 || 
pOp
->
p2
==
SQLITE_CHECKPOINT_FULL


74753 || 
pOp
->
p2
==
SQLITE_CHECKPOINT_RESTART


74755 
	grc
 = 
sql™e3Checkpošt
(
db
, 
pOp
->
p1
,…Op->
p2
, &
aRes
[1], &aRes[2]);

74756 ifÐ
	grc
==
SQLITE_BUSY
 ){

74757 
rc
 = 
SQLITE_OK
;

74758 
	gaRes
[0] = 1;

74760 
	gi
=0, 
	gpMem
 = &
aMem
[
pOp
->
p3
]; i<3; i++,…Mem++){

74761 
sql™e3VdbeMemS‘IÁ64
(
pMem
, (
i64
)
aRes
[
i
]);

74767 #iâdeà
SQLITE_OMIT_PRAGMA


74779 
	gOP_Jouº®Mode
: {

74780 
BŒ“
 *
pBt
;

74781 
Pag”
 *
	gpPag”
;

74782 
	geNew
;

74783 
	geOld
;

74784 #iâdeà
SQLITE_OMIT_WAL


74785 cÚ¡ *
	gzFž’ame
;

74788 
	geNew
 = 
pOp
->
p3
;

74789 
as£¹
Ð
eNew
==
PAGER_JOURNALMODE_DELETE


74790 || 
eNew
==
PAGER_JOURNALMODE_TRUNCATE


74791 || 
eNew
==
PAGER_JOURNALMODE_PERSIST


74792 || 
eNew
==
PAGER_JOURNALMODE_OFF


74793 || 
eNew
==
PAGER_JOURNALMODE_MEMORY


74794 || 
eNew
==
PAGER_JOURNALMODE_WAL


74795 || 
eNew
==
PAGER_JOURNALMODE_QUERY


74797 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

74798 
as£¹
Ð
p
->
»adOÆy
==0 );

74800 
	gpBt
 = 
db
->
aDb
[
pOp
->
p1
].
pBt
;

74801 
	gpPag”
 = 
sql™e3BŒ“Pag”
(
pBt
);

74802 
	geOld
 = 
sql™e3Pag”G‘Jouº®Mode
(
pPag”
);

74803 ifÐ
	geNew
==
PAGER_JOURNALMODE_QUERY
 ) 
eNew
 = 
eOld
;

74804 ifÐ!
sql™e3Pag”OkToChªgeJouº®Mode
(
pPag”
èè
	geNew
 = 
eOld
;

74806 #iâdeà
SQLITE_OMIT_WAL


74807 
	gzFž’ame
 = 
sql™e3Pag”Fž’ame
(
pPag”
, 1);

74812 ifÐ
	geNew
==
PAGER_JOURNALMODE_WAL


74813 && (
sql™e3SŒËn30
(
zFž’ame
)==0

74814 || !
sql™e3Pag”W®SuµÜ‹d
(
pPag”
))

74816 
eNew
 = 
eOld
;

74819 ifÐ(
	geNew
!=
eOld
)

74820 && (
eOld
==
PAGER_JOURNALMODE_WAL
 || 
eNew
==PAGER_JOURNALMODE_WAL)

74822 ifÐ!
db
->
autoComm™
 || db->
nVdbeR—d
>1 ){

74823 
rc
 = 
SQLITE_ERROR
;

74824 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
,

74826 (
eNew
==
PAGER_JOURNALMODE_WAL
 ? "into" : "out of")

74831 ifÐ
	geOld
==
PAGER_JOURNALMODE_WAL
 ){

74837 
rc
 = 
sql™e3Pag”Clo£W®
(
pPag”
);

74838 ifÐ
	grc
==
SQLITE_OK
 ){

74839 
sql™e3Pag”S‘Jouº®Mode
(
pPag”
, 
eNew
);

74841 }ifÐ
	geOld
==
PAGER_JOURNALMODE_MEMORY
 ){

74844 
sql™e3Pag”S‘Jouº®Mode
(
pPag”
, 
PAGER_JOURNALMODE_OFF
);

74850 
as£¹
Ð
sql™e3BŒ“IsInT¿ns
(
pBt
)==0 );

74851 ifÐ
	grc
==
SQLITE_OK
 ){

74852 
rc
 = 
sql™e3BŒ“S‘V”siÚ
(
pBt
, (
eNew
==
PAGER_JOURNALMODE_WAL
 ? 2 : 1));

74858 ifÐ
	grc
 ){

74859 
	geNew
 = 
eOld
;

74861 
	geNew
 = 
sql™e3Pag”S‘Jouº®Mode
(
pPag”
, 
eNew
);

74863 
	gpOut
 = &
aMem
[
pOp
->
p2
];

74864 
	gpOut
->
	gæags
 = 
MEM_SŒ
|
MEM_Stic
|
MEM_T”m
;

74865 
	gpOut
->
	gz
 = (*)
sql™e3Jouº®Mod’ame
(
eNew
);

74866 
	gpOut
->
	gn
 = 
sql™e3SŒËn30
(
pOut
->
z
);

74867 
	gpOut
->
	g’c
 = 
SQLITE_UTF8
;

74868 
sql™e3VdbeChªgeEncodšg
(
pOut
, 
’codšg
);

74873 #ià!
defšed
(
SQLITE_OMIT_VACUUM
è&& !defšed(
SQLITE_OMIT_ATTACH
)

74880 
	gOP_Vacuum
: {

74881 
as£¹
Ð
p
->
»adOÆy
==0 );

74882 
	grc
 = 
sql™e3RunVacuum
(&
p
->
zE¼Msg
, 
db
);

74887 #ià!
defšed
(
SQLITE_OMIT_AUTOVACUUM
)

74894 
	gOP_InüVacuum
: {

74895 
BŒ“
 *
pBt
;

74897 
as£¹
Ð
pOp
->
p1
>=0 &&…Op->p1<
db
->
nDb
 );

74898 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
pOp
->
p1
) );

74899 
as£¹
Ð
p
->
»adOÆy
==0 );

74900 
	gpBt
 = 
db
->
aDb
[
pOp
->
p1
].
pBt
;

74901 
	grc
 = 
sql™e3BŒ“InüVacuum
(
pBt
);

74902 
VdbeB¿nchTak’
(
rc
==
SQLITE_DONE
,2);

74903 ifÐ
	grc
==
SQLITE_DONE
 ){

74904 
pc
 = 
pOp
->
p2
 - 1;

74905 
	grc
 = 
SQLITE_OK
;

74921 
	gOP_Expœe
: {

74922 ifÐ!
pOp
->
p1
 ){

74923 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

74925 
	gp
->
	gexpœed
 = 1;

74930 #iâdeà
SQLITE_OMIT_SHARED_CACHE


74946 
	gOP_TabËLock
: {

74947 
u8
 
isWr™eLock
 = (u8)
pOp
->
p3
;

74948 ifÐ
	gisWr™eLock
 || 0==(
db
->
æags
&
SQLITE_R—dUncomm™‹d
) ){

74949 
p1
 = 
pOp
->p1;

74950 
as£¹
Ð
p1
>=0 &&…1<
db
->
nDb
 );

74951 
as£¹
Ð
DbMaskTe¡
(
p
->
bŒ“Mask
, 
p1
) );

74952 
as£¹
Ð
isWr™eLock
==0 || isWriteLock==1 );

74953 
	grc
 = 
sql™e3BŒ“LockTabË
(
db
->
aDb
[
p1
].
pBt
, 
pOp
->
p2
, 
isWr™eLock
);

74954 ifÐ(
	grc
&0xFF)==
SQLITE_LOCKED
 ){

74955 cÚ¡ *
z
 = 
pOp
->
p4
.z;

74956 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "d©aba£abË i locked: %s", 
z
);

74963 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


74973 
	gOP_VBegš
: {

74974 
VTabË
 *
pVTab
;

74975 
	gpVTab
 = 
pOp
->
p4
.
pVb
;

74976 
	grc
 = 
sql™e3VbBegš
(
db
, 
pVTab
);

74977 ifÐ
	gpVTab
 ) 
sql™e3VbImpÜtE¼msg
(
p
, 
pVTab
->
pVb
);

74982 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


74988 
	gOP_VC»©e
: {

74989 
rc
 = 
sql™e3VbC®lC»©e
(
db
, 
pOp
->
p1
,…Op->
p4
.
z
, &
p
->
zE¼Msg
);

74994 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75000 
	gOP_VDe¡roy
: {

75001 
p
->
šVbM‘hod
 = 2;

75002 
	grc
 = 
sql™e3VbC®lDe¡roy
(
db
, 
pOp
->
p1
,…Op->
p4
.
z
);

75003 
	gp
->
	gšVbM‘hod
 = 0;

75008 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75015 
	gOP_VO³n
: {

75016 
VdbeCursÜ
 *
pCur
;

75017 
sql™e3_vb_cursÜ
 *
	gpVbCursÜ
;

75018 
sql™e3_vb
 *
	gpVb
;

75019 
sql™e3_moduË
 *
	gpModuË
;

75021 
as£¹
Ð
p
->
bIsR—d”
 );

75022 
	gpCur
 = 0;

75023 
	gpVbCursÜ
 = 0;

75024 
	gpVb
 = 
pOp
->
p4
.
pVb
->pVtab;

75025 
	gpModuË
 = (
sql™e3_moduË
 *)
pVb
->
pModuË
;

75026 
as£¹
(
pVb
 && 
pModuË
);

75027 
	grc
 = 
pModuË
->
xO³n
(
pVb
, &
pVbCursÜ
);

75028 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75029 ifÐ
	gSQLITE_OK
==
rc
 ){

75031 
pVbCursÜ
->
pVb
 =…Vtab;

75034 
	gpCur
 = 
®loÿ‹CursÜ
(
p
, 
pOp
->
p1
, 0, -1, 0);

75035 ifÐ
	gpCur
 ){

75036 
	gpCur
->
	gpVbCursÜ
 = 
pVbCursÜ
;

75038 
	gdb
->
	gm®locFažed
 = 1;

75039 
	gpModuË
->
xClo£
(
pVbCursÜ
);

75046 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75066 
	gOP_VFž‹r
: {

75067 
nArg
;

75068 
	giQu”y
;

75069 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
;

75070 
Mem
 *
	gpQu”y
;

75071 
Mem
 *
	gpArgc
;

75072 
sql™e3_vb_cursÜ
 *
	gpVbCursÜ
;

75073 
sql™e3_vb
 *
	gpVb
;

75074 
VdbeCursÜ
 *
	gpCur
;

75075 
	g»s
;

75076 
	gi
;

75077 
Mem
 **
	g­Arg
;

75079 
	gpQu”y
 = &
aMem
[
pOp
->
p3
];

75080 
	gpArgc
 = &
pQu”y
[1];

75081 
	gpCur
 = 
p
->
­C¤
[
pOp
->
p1
];

75082 
as£¹
Ð
memIsV®id
(
pQu”y
) );

75083 
REGISTER_TRACE
(
pOp
->
p3
, 
pQu”y
);

75084 
as£¹
Ð
pCur
->
pVbCursÜ
 );

75085 
	gpVbCursÜ
 = 
pCur
->
pVbCursÜ
;

75086 
	gpVb
 = 
pVbCursÜ
->
pVb
;

75087 
	gpModuË
 = 
pVb
->
pModuË
;

75090 
as£¹
Ð(
pQu”y
->
æags
&
MEM_IÁ
)!=0 && 
pArgc
->flags==MEM_Int );

75091 
	gnArg
 = ()
pArgc
->
u
.
i
;

75092 
	giQu”y
 = ()
pQu”y
->
u
.
i
;

75096 
	g»s
 = 0;

75097 
	g­Arg
 = 
p
->
­Arg
;

75098 
	gi
 = 0; i<
	gnArg
; i++){

75099 
	g­Arg
[
i
] = &
pArgc
[i+1];

75102 
	gp
->
	gšVbM‘hod
 = 1;

75103 
	grc
 = 
pModuË
->
xFž‹r
(
pVbCursÜ
, 
iQu”y
, 
pOp
->
p4
.
z
, 
nArg
, 
­Arg
);

75104 
	gp
->
	gšVbM‘hod
 = 0;

75105 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75106 ifÐ
	grc
==
SQLITE_OK
 ){

75107 
»s
 = 
pModuË
->
xEof
(
pVbCursÜ
);

75109 
VdbeB¿nchTak’
(
»s
!=0,2);

75110 ifÐ
	g»s
 ){

75111 
	gpc
 = 
pOp
->
p2
 - 1;

75114 
	gpCur
->
	gnuÎRow
 = 0;

75120 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75128 
	gOP_VCÞumn
: {

75129 
sql™e3_vb
 *
pVb
;

75130 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
;

75131 
Mem
 *
	gpDe¡
;

75132 
sql™e3_cÚ‹xt
 
	gsCÚ‹xt
;

75134 
VdbeCursÜ
 *
	gpCur
 = 
p
->
­C¤
[
pOp
->
p1
];

75135 
as£¹
Ð
pCur
->
pVbCursÜ
 );

75136 
as£¹
Ð
pOp
->
p3
>0 &&…Op->p3<=(
p
->
nMem
-p->
nCursÜ
) );

75137 
	gpDe¡
 = &
aMem
[
pOp
->
p3
];

75138 
memAboutToChªge
(
p
, 
pDe¡
);

75139 ifÐ
	gpCur
->
	gnuÎRow
 ){

75140 
sql™e3VdbeMemS‘NuÎ
(
pDe¡
);

75143 
	gpVb
 = 
pCur
->
pVbCursÜ
->
pVb
;

75144 
	gpModuË
 = 
pVb
->
pModuË
;

75145 
as£¹
Ð
pModuË
->
xCÞumn
 );

75146 
mem£t
(&
sCÚ‹xt
, 0, (sContext));

75147 
	gsCÚ‹xt
.
	gpOut
 = 
pDe¡
;

75148 
MemS‘Ty³FÏg
(
pDe¡
, 
MEM_NuÎ
);

75149 
	grc
 = 
pModuË
->
xCÞumn
(
pCur
->
pVbCursÜ
, &
sCÚ‹xt
, 
pOp
->
p2
);

75150 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75151 ifÐ
	gsCÚ‹xt
.
	gisE¼Ü
 ){

75152 
	grc
 = 
sCÚ‹xt
.
isE¼Ü
;

75154 
sql™e3VdbeChªgeEncodšg
(
pDe¡
, 
’codšg
);

75155 
REGISTER_TRACE
(
pOp
->
p3
, 
pDe¡
);

75156 
UPDATE_MAX_BLOBSIZE
(
pDe¡
);

75158 ifÐ
sql™e3VdbeMemTooBig
(
pDe¡
) ){

75159 
	gtoo_big
;

75165 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75172 
	gOP_VNext
: {

75173 
sql™e3_vb
 *
pVb
;

75174 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
;

75175 
	g»s
;

75176 
VdbeCursÜ
 *
	gpCur
;

75178 
	g»s
 = 0;

75179 
	gpCur
 = 
p
->
­C¤
[
pOp
->
p1
];

75180 
as£¹
Ð
pCur
->
pVbCursÜ
 );

75181 ifÐ
	gpCur
->
	gnuÎRow
 ){

75184 
	gpVb
 = 
pCur
->
pVbCursÜ
->
pVb
;

75185 
	gpModuË
 = 
pVb
->
pModuË
;

75186 
as£¹
Ð
pModuË
->
xNext
 );

75194 
	gp
->
	gšVbM‘hod
 = 1;

75195 
	grc
 = 
pModuË
->
xNext
(
pCur
->
pVbCursÜ
);

75196 
	gp
->
	gšVbM‘hod
 = 0;

75197 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75198 ifÐ
	grc
==
SQLITE_OK
 ){

75199 
»s
 = 
pModuË
->
xEof
(
pCur
->
pVbCursÜ
);

75201 
VdbeB¿nchTak’
(!
»s
,2);

75202 ifÐ!
	g»s
 ){

75204 
	gpc
 = 
pOp
->
p2
 - 1;

75206 
	gcheck_fÜ_š‹¼u±
;

75210 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75217 
	gOP_VR’ame
: {

75218 
sql™e3_vb
 *
pVb
;

75219 
Mem
 *
	gpName
;

75221 
	gpVb
 = 
pOp
->
p4
.
pVb
->pVtab;

75222 
	gpName
 = &
aMem
[
pOp
->
p1
];

75223 
as£¹
Ð
pVb
->
pModuË
->
xR’ame
 );

75224 
as£¹
Ð
memIsV®id
(
pName
) );

75225 
as£¹
Ð
p
->
»adOÆy
==0 );

75226 
REGISTER_TRACE
(
pOp
->
p1
, 
pName
);

75227 
as£¹
Ð
pName
->
æags
 & 
MEM_SŒ
 );

75228 
‹¡ÿ£
Ð
pName
->
’c
==
SQLITE_UTF8
 );

75229 
‹¡ÿ£
Ð
pName
->
’c
==
SQLITE_UTF16BE
 );

75230 
‹¡ÿ£
Ð
pName
->
’c
==
SQLITE_UTF16LE
 );

75231 
	grc
 = 
sql™e3VdbeChªgeEncodšg
(
pName
, 
SQLITE_UTF8
);

75232 ifÐ
	grc
==
SQLITE_OK
 ){

75233 
rc
 = 
pVb
->
pModuË
->
xR’ame
ÕVb, 
pName
->
z
);

75234 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75235 
	gp
->
	gexpœed
 = 0;

75241 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


75269 
	gOP_VUpd©e
: {

75270 
sql™e3_vb
 *
pVb
;

75271 
sql™e3_moduË
 *
	gpModuË
;

75272 
	gnArg
;

75273 
	gi
;

75274 
sql™e_št64
 
	growid
;

75275 
Mem
 **
	g­Arg
;

75276 
Mem
 *
	gpX
;

75278 
as£¹
Ð
pOp
->
p2
==1 ||…Op->
p5
==
OE_Faž
 ||…Op->p5==
OE_RÞlback


75279 || 
pOp
->
p5
==
OE_AbÜt
 ||…Op->p5==
OE_IgnÜe
 ||…Op->p5==
OE_R•Ïû


75281 
as£¹
Ð
p
->
»adOÆy
==0 );

75282 
	gpVb
 = 
pOp
->
p4
.
pVb
->pVtab;

75283 
	gpModuË
 = (
sql™e3_moduË
 *)
pVb
->
pModuË
;

75284 
	gnArg
 = 
pOp
->
p2
;

75285 
as£¹
Ð
pOp
->
p4ty³
==
P4_VTAB
 );

75286 ifÐ
ALWAYS
(
pModuË
->
xUpd©e
) ){

75287 
u8
 
	gvbOnCÚæiù
 = 
db
->
vbOnCÚæiù
;

75288 
	g­Arg
 = 
p
->
­Arg
;

75289 
	gpX
 = &
aMem
[
pOp
->
p3
];

75290 
	gi
=0; i<
	gnArg
; i++){

75291 
as£¹
Ð
memIsV®id
(
pX
) );

75292 
memAboutToChªge
(
p
, 
pX
);

75293 
	g­Arg
[
i
] = 
pX
;

75294 
	gpX
++;

75296 
	gdb
->
	gvbOnCÚæiù
 = 
pOp
->
p5
;

75297 
	grc
 = 
pModuË
->
xUpd©e
(
pVb
, 
nArg
, 
­Arg
, &
rowid
);

75298 
	gdb
->
	gvbOnCÚæiù
 = 
vbOnCÚæiù
;

75299 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

75300 ifÐ
	grc
==
SQLITE_OK
 && 
pOp
->
p1
 ){

75301 
as£¹
Ð
nArg
>1 && 
­Arg
[0] && (­Arg[0]->
æags
&
MEM_NuÎ
) );

75302 
	gdb
->
	gÏ¡Rowid
 = 
Ï¡Rowid
 = 
rowid
;

75304 ifÐ(
	grc
&0xff)==
SQLITE_CONSTRAINT
 && 
pOp
->
p4
.
pVb
->
bCÚ¡¿št
 ){

75305 ifÐ
pOp
->
p5
==
OE_IgnÜe
 ){

75306 
rc
 = 
SQLITE_OK
;

75308 
	gp
->
	g”rÜAùiÚ
 = ((
pOp
->
p5
==
OE_R•Ïû
è? 
OE_AbÜt
 :…Op->p5);

75311 
	gp
->
	gnChªge
++;

75318 #iâdeà 
SQLITE_OMIT_PAGER_PRAGMAS


75323 
	gOP_PagecouÁ
: {

75324 
pOut
->
u
.
i
 = 
sql™e3BŒ“La¡Page
(
db
->
aDb
[
pOp
->
p1
].
pBt
);

75330 #iâdeà 
SQLITE_OMIT_PAGER_PRAGMAS


75339 
	gOP_MaxPgút
: {

75340 
ÃwMax
;

75341 
BŒ“
 *
	gpBt
;

75343 
	gpBt
 = 
db
->
aDb
[
pOp
->
p1
].
pBt
;

75344 
	gÃwMax
 = 0;

75345 ifÐ
	gpOp
->
	gp3
 ){

75346 
	gÃwMax
 = 
sql™e3BŒ“La¡Page
(
pBt
);

75347 ifÐ
	gÃwMax
 < ()
	gpOp
->
	gp3
 )‚ewMax = ()
pOp
->
p3
;

75349 
	gpOut
->
	gu
.
	gi
 = 
sql™e3BŒ“MaxPageCouÁ
(
pBt
, 
ÃwMax
);

75367 
	gOP_In™
: {

75368 *
zT¿û
;

75369 *
	gz
;

75371 ifÐ
	gpOp
->
	gp2
 ){

75372 
	gpc
 = 
pOp
->
p2
 - 1;

75374 #iâdeà
SQLITE_OMIT_TRACE


75375 ifÐ
	gdb
->
	gxT¿û


75376 && !
	gp
->
	gdošgR”un


75377 && (
	gzT¿û
 = (
pOp
->
p4
.
z
 ?…Op->p4.z : 
p
->
zSql
))!=0

75379 
z
 = 
sql™e3VdbeEx·ndSql
(
p
, 
zT¿û
);

75380 
	gdb
->
xT¿û
(
db
->
pT¿ûArg
, 
z
);

75381 
sql™e3DbF»e
(
db
, 
z
);

75383 #ifdeà
SQLITE_USE_FCNTL_TRACE


75384 
	gzT¿û
 = (
pOp
->
p4
.
z
 ?…Op->p4.z : 
p
->
zSql
);

75385 ifÐ
	gzT¿û
 ){

75386 
	gi
;

75387 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

75388 ifÐ
DbMaskTe¡
(
p
->
bŒ“Mask
, 
i
)==0 ) ;

75389 
sql™e3_fže_cÚŒÞ
(
db
, db->
aDb
[
i
].
zName
, 
SQLITE_FCNTL_TRACE
, 
zT¿û
);

75393 #ifdeà
SQLITE_DEBUG


75394 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_SqlT¿û
)!=0

75395 && (
zT¿û
 = (
pOp
->
p4
.
z
 ?…Op->p4.z : 
p
->
zSql
))!=0

75397 
sql™e3DebugPrštf
("SQL-Œaû: %s\n", 
zT¿û
);

75417 
as£¹
Ð
pOp
->
Ýcode
==
OP_NoÝ
 ||…Op->Ýcode==
OP_Ex¶aš
 );

75429 #ifdeà
VDBE_PROFILE


75431 
u64
 
	g’dTime
 = 
sql™e3Hwtime
();

75432 ifÐ
	g’dTime
>
	g¡¬t
 ) 
	gpOp
->
	gcyþes
 +ð
’dTime
 - 
¡¬t
;

75433 
	gpOp
->
	gút
++;

75442 #iâdeà
NDEBUG


75443 
as£¹
Ð
pc
>=-1 &&…c<
p
->
nOp
 );

75445 #ifdeà
SQLITE_DEBUG


75446 ifÐ
	gdb
->
	gæags
 & 
	gSQLITE_VdbeT¿û
 ){

75447 ifÐ
	grc
!=0 ) 
´štf
("rc=%d\n",
rc
);

75448 ifÐ
	gpOp
->
	gÝæags
 & (
	gOPFLG_OUT2_PRERELEASE
|
	gOPFLG_OUT2
) ){

75449 
»gi¡”T¿û
(
pOp
->
p2
, &
aMem
[pOp->p2]);

75451 ifÐ
	gpOp
->
	gÝæags
 & 
	gOPFLG_OUT3
 ){

75452 
»gi¡”T¿û
(
pOp
->
p3
, &
aMem
[pOp->p3]);

75462 
	gvdbe_”rÜ_h®t
:

75463 
as£¹
Ð
rc
 );

75464 
	gp
->
	grc
 = 
rc
;

75465 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

75466 
sql™e3_log
(
rc
, "statement‡borts‡t %d: [%s] %s",

75467 
pc
, 
p
->
zSql
,…->
zE¼Msg
);

75468 
sql™e3VdbeH®t
(
p
);

75469 ifÐ
	grc
==
SQLITE_IOERR_NOMEM
 ) 
db
->
m®locFažed
 = 1;

75470 
	grc
 = 
SQLITE_ERROR
;

75471 ifÐ
	g»£tSchemaOnFauÉ
>0 ){

75472 
sql™e3Re£tOÃSchema
(
db
, 
»£tSchemaOnFauÉ
-1);

75478 
	gvdbe_»tuº
:

75479 
db
->
Ï¡Rowid
 =†astRowid;

75480 
‹¡ÿ£
Ð
nVmS‹p
>0 );

75481 
	gp
->
	gaCouÁ”
[
SQLITE_STMTSTATUS_VM_STEP
] +ð()
nVmS‹p
;

75482 
sql™e3VdbeL—ve
(
p
);

75483  
	grc
;

75488 
	gtoo_big
:

75489 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "string or bloboo big");

75490 
	grc
 = 
SQLITE_TOOBIG
;

75491 
	gvdbe_”rÜ_h®t
;

75495 
	gno_mem
:

75496 
db
->
m®locFažed
 = 1;

75497 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "out of memory");

75498 
	grc
 = 
SQLITE_NOMEM
;

75499 
	gvdbe_”rÜ_h®t
;

75504 
	gabÜt_due_to_”rÜ
:

75505 
as£¹
Ð
p
->
zE¼Msg
==0 );

75506 ifÐ
	gdb
->
	gm®locFažed
 ) 
	grc
 = 
SQLITE_NOMEM
;

75507 ifÐ
	grc
!=
SQLITE_IOERR_NOMEM
 ){

75508 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3E¼SŒ
(
rc
));

75510 
	gvdbe_”rÜ_h®t
;

75515 
	gabÜt_due_to_š‹¼u±
:

75516 
as£¹
Ð
db
->
u1
.
isIÁ”ru±ed
 );

75517 
	grc
 = 
SQLITE_INTERRUPT
;

75518 
	gp
->
	grc
 = 
rc
;

75519 
sql™e3S‘SŒšg
(&
p
->
zE¼Msg
, 
db
, "%s", 
sql™e3E¼SŒ
(
rc
));

75520 
	gvdbe_”rÜ_h®t
;

75542 #iâdeà
SQLITE_OMIT_INCRBLOB


75547 
Inüblob
 
	tInüblob
;

75548 
	sInüblob
 {

75549 
	gæags
;

75550 
	gnBy‹
;

75551 
	giOff£t
;

75552 
	giCÞ
;

75553 
BtCursÜ
 *
	gpC¤
;

75554 
sql™e3_¡mt
 *
	gpStmt
;

75555 
sql™e3
 *
	gdb
;

75576 
blobS“kToRow
(
Inüblob
 *
p
, 
sql™e3_št64
 
iRow
, **
pzE¼
){

75577 
	grc
;

75578 *
	gzE¼
 = 0;

75579 
Vdbe
 *
	gv
 = (Vdb*)
p
->
pStmt
;

75585 
as£¹
Ð
v
->
aV¬
[0].
æags
&
MEM_IÁ
 );

75586 
	gv
->
	gaV¬
[0].
	gu
.
	gi
 = 
iRow
;

75588 
	grc
 = 
sql™e3_¡•
(
p
->
pStmt
);

75589 ifÐ
	grc
==
SQLITE_ROW
 ){

75590 
VdbeCursÜ
 *
pC
 = 
v
->
­C¤
[0];

75591 
u32
 
	gty³
 = 
pC
->
aTy³
[
p
->
iCÞ
];

75592 ifÐ
	gty³
<12 ){

75593 
	gzE¼
 = 
sql™e3MPrštf
(
p
->
db
, "cannot open value ofype %s",

75594 
ty³
==0?"null":ype==7?"real": "integer"

75596 
	grc
 = 
SQLITE_ERROR
;

75597 
sql™e3_fš®ize
(
p
->
pStmt
);

75598 
	gp
->
	gpStmt
 = 0;

75600 
	gp
->
	giOff£t
 = 
pC
->
aTy³
[
p
->
iCÞ
 +…C->
nF›ld
];

75601 
	gp
->
	gnBy‹
 = 
sql™e3VdbeS”ŸlTy³L’
(
ty³
);

75602 
	gp
->
	gpC¤
 = 
pC
->
pCursÜ
;

75603 
sql™e3BŒ“InüblobCursÜ
(
p
->
pC¤
);

75607 ifÐ
	grc
==
SQLITE_ROW
 ){

75608 
rc
 = 
SQLITE_OK
;

75609 }ifÐ
	gp
->
	gpStmt
 ){

75610 
	grc
 = 
sql™e3_fš®ize
(
p
->
pStmt
);

75611 
	gp
->
	gpStmt
 = 0;

75612 ifÐ
	grc
==
SQLITE_OK
 ){

75613 
zE¼
 = 
sql™e3MPrštf
(
p
->
db
, "nØsuch„owid: %Îd", 
iRow
);

75614 
	grc
 = 
SQLITE_ERROR
;

75616 
	gzE¼
 = 
sql™e3MPrštf
(
p
->
db
, "%s", 
sql™e3_”rmsg
(p->db));

75620 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
zE¼
==0 );

75621 
as£¹
Ð
rc
!=
SQLITE_ROW
 &&„c!=
SQLITE_DONE
 );

75623 *
	gpzE¼
 = 
zE¼
;

75624  
	grc
;

75630 
SQLITE_API
 
sql™e3_blob_Ý’
(

75631 
sql™e3
* 
db
,

75632 cÚ¡ *
zDb
,

75633 cÚ¡ *
zTabË
,

75634 cÚ¡ *
zCÞumn
,

75635 
sql™e_št64
 
iRow
,

75636 
æags
,

75637 
sql™e3_blob
 **
µBlob


75639 
	gnA‰em±
 = 0;

75640 
	giCÞ
;

75657 cÚ¡ 
	giLn
 = 
VDBE_OFFSET_LINENO
(4);

75658 cÚ¡ 
VdbeOpLi¡
 
	gÝ’Blob
[] = {

75660 {
OP_TabËLock
, 0, 0, 0},

75662 {
OP_O³nR—d
, 0, 0, 0},

75663 {
OP_O³nWr™e
, 0, 0, 0},

75664 {
OP_V¬ŸbË
, 1, 1, 1},

75665 {
OP_NÙExi¡s
, 0, 10, 1},

75666 {
OP_CÞumn
, 0, 0, 1},

75667 {
OP_ResuÉRow
, 1, 0, 0},

75668 {
OP_GÙo
, 0, 4, 0},

75669 {
OP_Clo£
, 0, 0, 0},

75670 {
OP_H®t
, 0, 0, 0},

75673 
	grc
 = 
SQLITE_OK
;

75674 *
	gzE¼
 = 0;

75675 
TabË
 *
	gpTab
;

75676 
P¬£
 *
	gpP¬£
 = 0;

75677 
Inüblob
 *
	gpBlob
 = 0;

75679 
	gæags
 = !!
æags
;

75680 *
	gµBlob
 = 0;

75682 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

75684 
	gpBlob
 = (
Inüblob
 *)
sql™e3DbM®locZ”o
(
db
, (Incrblob));

75685 ifÐ!
	gpBlob
 ) 
	gblob_Ý’_out
;

75686 
	gpP¬£
 = 
sql™e3SckAÎocRaw
(
db
, (*
pP¬£
));

75687 ifÐ!
	gpP¬£
 ) 
	gblob_Ý’_out
;

75690 
mem£t
(
pP¬£
, 0, (
P¬£
));

75691 
	gpP¬£
->
	gdb
 = 
db
;

75692 
sql™e3DbF»e
(
db
, 
zE¼
);

75693 
	gzE¼
 = 0;

75695 
sql™e3BŒ“EÁ”AÎ
(
db
);

75696 
	gpTab
 = 
sql™e3Loÿ‹TabË
(
pP¬£
, 0, 
zTabË
, 
zDb
);

75697 ifÐ
	gpTab
 && 
IsVœtu®
(
pTab
) ){

75698 
	gpTab
 = 0;

75699 
sql™e3E¼ÜMsg
(
pP¬£
, "ÿÂÙ o³Àvœtu®abË: %s", 
zTabË
);

75701 ifÐ
	gpTab
 && !
HasRowid
(
pTab
) ){

75702 
	gpTab
 = 0;

75703 
sql™e3E¼ÜMsg
(
pP¬£
, "ÿÂÙ o³ÀbË w™houˆrowid: %s", 
zTabË
);

75705 #iâdeà
SQLITE_OMIT_VIEW


75706 ifÐ
	gpTab
 &&…Tab->
	gpS–eù
 ){

75707 
	gpTab
 = 0;

75708 
sql™e3E¼ÜMsg
(
pP¬£
, "ÿÂÙ o³Àv›w: %s", 
zTabË
);

75711 ifÐ!
	gpTab
 ){

75712 ifÐ
	gpP¬£
->
	gzE¼Msg
 ){

75713 
sql™e3DbF»e
(
db
, 
zE¼
);

75714 
	gzE¼
 = 
pP¬£
->
zE¼Msg
;

75715 
	gpP¬£
->
	gzE¼Msg
 = 0;

75717 
	grc
 = 
SQLITE_ERROR
;

75718 
sql™e3BŒ“L—veAÎ
(
db
);

75719 
	gblob_Ý’_out
;

75723 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞ
; iCol++) {

75724 ifÐ
sql™e3SŒICmp
(
pTab
->
aCÞ
[
iCÞ
].
zName
, 
zCÞumn
)==0 ){

75728 ifÐ
	giCÞ
==
pTab
->
nCÞ
 ){

75729 
sql™e3DbF»e
(
db
, 
zE¼
);

75730 
	gzE¼
 = 
sql™e3MPrštf
(
db
, "nØsuch cÞumn: \"%s\"", 
zCÞumn
);

75731 
	grc
 = 
SQLITE_ERROR
;

75732 
sql™e3BŒ“L—veAÎ
(
db
);

75733 
	gblob_Ý’_out
;

75740 ifÐ
	gæags
 ){

75741 cÚ¡ *
	gzFauÉ
 = 0;

75742 
Index
 *
	gpIdx
;

75743 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


75744 ifÐ
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

75749 
FKey
 *
	gpFKey
;

75750 
	gpFKey
=
pTab
->
pFKey
;…FKey;…FKeyõFKey->
pNextFrom
){

75751 
j
;

75752 
	gj
=0; j<
	gpFKey
->
	gnCÞ
; j++){

75753 ifÐ
	gpFKey
->
	gaCÞ
[
j
].
	giFrom
==
iCÞ
 ){

75754 
zFauÉ
 = "foreign key";

75760 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

75761 
j
;

75762 
	gj
=0; j<
	gpIdx
->
	gnKeyCÞ
; j++){

75763 ifÐ
	gpIdx
->
	gaiCÞumn
[
j
]==
iCÞ
 ){

75764 
zFauÉ
 = "indexed";

75768 ifÐ
	gzFauÉ
 ){

75769 
sql™e3DbF»e
(
db
, 
zE¼
);

75770 
	gzE¼
 = 
sql™e3MPrštf
(
db
, "ÿÂÙ o³À% cÞumÀfÜ wr™šg", 
zFauÉ
);

75771 
	grc
 = 
SQLITE_ERROR
;

75772 
sql™e3BŒ“L—veAÎ
(
db
);

75773 
	gblob_Ý’_out
;

75777 
	gpBlob
->
	gpStmt
 = (
sql™e3_¡mt
 *)
sql™e3VdbeC»©e
(
pP¬£
);

75778 
as£¹
Ð
pBlob
->
pStmt
 || 
db
->
m®locFažed
 );

75779 ifÐ
	gpBlob
->
	gpStmt
 ){

75780 
Vdbe
 *
	gv
 = (Vdb*)
pBlob
->
pStmt
;

75781 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

75784 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_T¿n§ùiÚ
, 
iDb
, 
æags
,

75785 
pTab
->
pSchema
->
schema_cook›
,

75786 
pTab
->
pSchema
->
iG’”©iÚ
);

75787 
sql™e3VdbeChªgeP5
(
v
, 1);

75788 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
Ý’Blob
), o³nBlob, 
iLn
);

75791 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

75794 #ifdeà
SQLITE_OMIT_SHARED_CACHE


75795 
sql™e3VdbeChªgeToNoÝ
(
v
, 1);

75797 
sql™e3VdbeChªgeP1
(
v
, 1, 
iDb
);

75798 
sql™e3VdbeChªgeP2
(
v
, 1, 
pTab
->
Šum
);

75799 
sql™e3VdbeChªgeP3
(
v
, 1, 
æags
);

75800 
sql™e3VdbeChªgeP4
(
v
, 1, 
pTab
->
zName
, 
P4_TRANSIENT
);

75805 
sql™e3VdbeChªgeToNoÝ
(
v
, 3 - 
æags
);

75806 
sql™e3VdbeChªgeP2
(
v
, 2 + 
æags
, 
pTab
->
Šum
);

75807 
sql™e3VdbeChªgeP3
(
v
, 2 + 
æags
, 
iDb
);

75816 
sql™e3VdbeChªgeP4
(
v
, 2+
æags
, 
SQLITE_INT_TO_PTR
(
pTab
->
nCÞ
+1),
P4_INT32
);

75817 
sql™e3VdbeChªgeP2
(
v
, 6, 
pTab
->
nCÞ
);

75818 ifÐ!
	gdb
->
	gm®locFažed
 ){

75819 
	gpP¬£
->
	gnV¬
 = 1;

75820 
	gpP¬£
->
	gnMem
 = 1;

75821 
	gpP¬£
->
	gnTab
 = 1;

75822 
sql™e3VdbeMakeR—dy
(
v
, 
pP¬£
);

75826 
	gpBlob
->
	gæags
 = 
æags
;

75827 
	gpBlob
->
	giCÞ
 = 
iCÞ
;

75828 
	gpBlob
->
	gdb
 = 
db
;

75829 
sql™e3BŒ“L—veAÎ
(
db
);

75830 ifÐ
	gdb
->
	gm®locFažed
 ){

75831 
	gblob_Ý’_out
;

75833 
sql™e3_bšd_št64
(
pBlob
->
pStmt
, 1, 
iRow
);

75834 
	grc
 = 
blobS“kToRow
(
pBlob
, 
iRow
, &
zE¼
);

75835 }  (++
	gnA‰em±
)<
	gSQLITE_MAX_SCHEMA_RETRY
 && 
	grc
==
SQLITE_SCHEMA
 );

75837 
	gblob_Ý’_out
:

75838 ifÐ
rc
==
SQLITE_OK
 && 
db
->
m®locFažed
==0 ){

75839 *
µBlob
 = (
sql™e3_blob
 *)
pBlob
;

75841 ifÐ
	gpBlob
 &&…Blob->
	gpStmt
 ) 
sql™e3VdbeFš®ize
((
Vdbe
 *)
pBlob
->
pStmt
);

75842 
sql™e3DbF»e
(
db
, 
pBlob
);

75844 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, (
zE¼
 ? "%s" : 0), zErr);

75845 
sql™e3DbF»e
(
db
, 
zE¼
);

75846 
sql™e3P¬£rRe£t
(
pP¬£
);

75847 
sql™e3SckF»e
(
db
, 
pP¬£
);

75848 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

75849 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

75850  
	grc
;

75857 
SQLITE_API
 
sql™e3_blob_þo£
(
sql™e3_blob
 *
pBlob
){

75858 
Inüblob
 *
	gp
 = (Inüblob *)
pBlob
;

75859 
	grc
;

75860 
sql™e3
 *
	gdb
;

75862 ifÐ
	gp
 ){

75863 
	gdb
 = 
p
->
db
;

75864 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

75865 
	grc
 = 
sql™e3_fš®ize
(
p
->
pStmt
);

75866 
sql™e3DbF»e
(
db
, 
p
);

75867 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

75869 
	grc
 = 
SQLITE_OK
;

75871  
	grc
;

75877 
blobR—dWr™e
(

75878 
sql™e3_blob
 *
pBlob
,

75879 *
z
,

75880 
n
,

75881 
iOff£t
,

75882 (*
xC®l
)(
BtCursÜ
*, 
u32
, u32, *)

75884 
	grc
;

75885 
Inüblob
 *
	gp
 = (Inüblob *)
pBlob
;

75886 
Vdbe
 *
	gv
;

75887 
sql™e3
 *
	gdb
;

75889 ifÐ
	gp
==0 )  
SQLITE_MISUSE_BKPT
;

75890 
	gdb
 = 
p
->
db
;

75891 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

75892 
	gv
 = (
Vdbe
*)
p
->
pStmt
;

75894 ifÐ
	gn
<0 || 
	giOff£t
<0 || (iOff£t+n)>
	gp
->
	gnBy‹
 ){

75896 
	grc
 = 
SQLITE_ERROR
;

75897 
sql™e3E¼Ü
(
db
, 
SQLITE_ERROR
);

75898 }ifÐ
	gv
==0 ){

75902 
rc
 = 
SQLITE_ABORT
;

75907 
as£¹
Ð
db
 =ð
v
->db );

75908 
sql™e3BŒ“EÁ”CursÜ
(
p
->
pC¤
);

75909 
	grc
 = 
xC®l
(
p
->
pC¤
, 
iOff£t
+p->iOff£t, 
n
, 
z
);

75910 
sql™e3BŒ“L—veCursÜ
(
p
->
pC¤
);

75911 ifÐ
	grc
==
SQLITE_ABORT
 ){

75912 
sql™e3VdbeFš®ize
(
v
);

75913 
	gp
->
	gpStmt
 = 0;

75915 
	gdb
->
	g”rCode
 = 
rc
;

75916 
	gv
->
	grc
 = 
rc
;

75919 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

75920 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

75921  
	grc
;

75927 
SQLITE_API
 
sql™e3_blob_»ad
(
sql™e3_blob
 *
pBlob
, *
z
, 
n
, 
iOff£t
){

75928  
blobR—dWr™e
(
pBlob
, 
z
, 
n
, 
iOff£t
, 
sql™e3BŒ“D©a
);

75934 
SQLITE_API
 
sql™e3_blob_wr™e
(
sql™e3_blob
 *
pBlob
, cÚ¡ *
z
, 
n
, 
iOff£t
){

75935  
blobR—dWr™e
(
pBlob
, (*)
z
, 
n
, 
iOff£t
, 
sql™e3BŒ“PutD©a
);

75944 
SQLITE_API
 
sql™e3_blob_by‹s
(
sql™e3_blob
 *
pBlob
){

75945 
Inüblob
 *
	gp
 = (Inüblob *)
pBlob
;

75946  (
	gp
 &&…->
	gpStmt
è?…->
	gnBy‹
 : 0;

75959 
SQLITE_API
 
sql™e3_blob_»Ý’
(
sql™e3_blob
 *
pBlob
, 
sql™e3_št64
 
iRow
){

75960 
	grc
;

75961 
Inüblob
 *
	gp
 = (Inüblob *)
pBlob
;

75962 
sql™e3
 *
	gdb
;

75964 ifÐ
	gp
==0 )  
SQLITE_MISUSE_BKPT
;

75965 
	gdb
 = 
p
->
db
;

75966 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

75968 ifÐ
	gp
->
	gpStmt
==0 ){

75972 
rc
 = 
SQLITE_ABORT
;

75974 *
	gzE¼
;

75975 
	grc
 = 
blobS“kToRow
(
p
, 
iRow
, &
zE¼
);

75976 ifÐ
	grc
!=
SQLITE_OK
 ){

75977 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, (
zE¼
 ? "%s" : 0), zErr);

75978 
sql™e3DbF»e
(
db
, 
zE¼
);

75980 
as£¹
Ð
rc
!=
SQLITE_SCHEMA
 );

75983 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

75984 
as£¹
Ð
rc
==
SQLITE_OK
 || 
p
->
pStmt
==0 );

75985 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

75986  
	grc
;

76137 
	#SQLITE_DEBUG_SORTER_THREADS
 1

	)

76143 
M”geEngše
 
	tM”geEngše
;

76144 
PmaR—d”
 
	tPmaR—d”
;

76145 
PmaWr™”
 
	tPmaWr™”
;

76146 
SÜ‹rRecÜd
 
	tSÜ‹rRecÜd
;

76147 
SÜtSubsk
 
	tSÜtSubsk
;

76148 
SÜ‹rFže
 
	tSÜ‹rFže
;

76149 
SÜ‹rLi¡
 
	tSÜ‹rLi¡
;

76150 
InüM”g”
 
	tInüM”g”
;

76156 
	sSÜ‹rFže
 {

76157 
sql™e3_fže
 *
	gpFd
;

76158 
i64
 
	giEof
;

76169 
	sSÜ‹rLi¡
 {

76170 
SÜ‹rRecÜd
 *
	gpLi¡
;

76171 
u8
 *
	gaMemÜy
;

76172 
	gszPMA
;

76239 
	sM”geEngše
 {

76240 
	gnT»e
;

76241 
SÜtSubsk
 *
	gpTask
;

76242 *
	gaT»e
;

76243 
PmaR—d”
 *
	gaR—dr
;

76277 
	sSÜtSubsk
 {

76278 
SQL™eTh»ad
 *
	gpTh»ad
;

76279 
	gbDÚe
;

76280 
VdbeSÜ‹r
 *
	gpSÜ‹r
;

76281 
UÅackedRecÜd
 *
	gpUÅacked
;

76282 
SÜ‹rLi¡
 
	gli¡
;

76283 
	gnPMA
;

76284 
SÜ‹rFže
 
	gfže
;

76285 
SÜ‹rFže
 
	gfže2
;

76297 
	sVdbeSÜ‹r
 {

76298 
	gmnPmaSize
;

76299 
	gmxPmaSize
;

76300 
	gmxKeysize
;

76301 
	gpgsz
;

76302 
PmaR—d”
 *
	gpR—d”
;

76303 
M”geEngše
 *
	gpM”g”
;

76304 
sql™e3
 *
	gdb
;

76305 
KeyInfo
 *
	gpKeyInfo
;

76306 
UÅackedRecÜd
 *
	gpUÅacked
;

76307 
SÜ‹rLi¡
 
	gli¡
;

76308 
	giMemÜy
;

76309 
	gnMemÜy
;

76310 
u8
 
	gbU£PMA
;

76311 
u8
 
	gbU£Th»ads
;

76312 
u8
 
	giP»v
;

76313 
u8
 
	gnTask
;

76314 
SÜtSubsk
 
	gaTask
[1];

76326 
	sPmaR—d”
 {

76327 
i64
 
	giR—dOff
;

76328 
i64
 
	giEof
;

76329 
	gnAÎoc
;

76330 
	gnKey
;

76331 
sql™e3_fže
 *
	gpFd
;

76332 
u8
 *
	gaAÎoc
;

76333 
u8
 *
	gaKey
;

76334 
u8
 *
	gaBufãr
;

76335 
	gnBufãr
;

76336 
u8
 *
	gaM­
;

76337 
InüM”g”
 *
	gpInü
;

76372 
	sInüM”g”
 {

76373 
SÜtSubsk
 *
	gpTask
;

76374 
M”geEngše
 *
	gpM”g”
;

76375 
i64
 
	giS¹Off
;

76376 
	gmxSz
;

76377 
	gbEof
;

76378 
	gbU£Th»ad
;

76379 
SÜ‹rFže
 
	gaFže
[2];

76390 
	sPmaWr™”
 {

76391 
	geFWE¼
;

76392 
u8
 *
	gaBufãr
;

76393 
	gnBufãr
;

76394 
	giBufS¹
;

76395 
	giBufEnd
;

76396 
i64
 
	giWr™eOff
;

76397 
sql™e3_fže
 *
	gpFd
;

76418 
	sSÜ‹rRecÜd
 {

76419 
	gnV®
;

76421 
SÜ‹rRecÜd
 *
	gpNext
;

76422 
	giNext
;

76423 } 
	gu
;

76432 
	#SRVAL
(
p
è((*)((
SÜ‹rRecÜd
*)Õè+ 1))

	)

76436 
	#SORTER_MIN_WORKING
 10

	)

76439 
	#SORTER_MAX_MERGE_COUNT
 16

	)

76441 
vdbeInüSw­
(
InüM”g”
*);

76442 
vdbeInüF»e
(
InüM”g”
 *);

76448 
vdbePmaR—d”CË¬
(
PmaR—d”
 *
pR—dr
){

76449 
sql™e3_ä“
(
pR—dr
->
aAÎoc
);

76450 
sql™e3_ä“
(
pR—dr
->
aBufãr
);

76451 ifÐ
	gpR—dr
->
	gaM­
 ) 
sql™e3OsUnãtch
(
pR—dr
->
pFd
, 0,…R—dr->
aM­
);

76452 
vdbeInüF»e
(
pR—dr
->
pInü
);

76453 
mem£t
(
pR—dr
, 0, (
PmaR—d”
));

76465 
vdbePmaR—dBlob
(

76466 
PmaR—d”
 *
p
,

76467 
nBy‹
,

76468 
u8
 **
µOut


76470 
	giBuf
;

76471 
	gnAvaž
;

76473 ifÐ
	gp
->
	gaM­
 ){

76474 *
	gµOut
 = &
p
->
aM­
[p->
iR—dOff
];

76475 
	gp
->
	giR—dOff
 +ð
nBy‹
;

76476  
	gSQLITE_OK
;

76479 
as£¹
Ð
p
->
aBufãr
 );

76484 
	giBuf
 = 
p
->
iR—dOff
 %…->
nBufãr
;

76485 ifÐ
	giBuf
==0 ){

76486 
nR—d
;

76487 
	grc
;

76490 ifÐ(
	gp
->
	giEof
 -…->
	giR—dOff
è> (
	gi64
í->
	gnBufãr
 ){

76491 
	gnR—d
 = 
p
->
nBufãr
;

76493 
	gnR—d
 = ()(
p
->
iEof
 -…->
iR—dOff
);

76495 
as£¹
Ð
nR—d
>0 );

76498 
	grc
 = 
sql™e3OsR—d
(
p
->
pFd
,…->
aBufãr
, 
nR—d
,…->
iR—dOff
);

76499 
as£¹
Ð
rc
!=
SQLITE_IOERR_SHORT_READ
 );

76500 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

76502 
	gnAvaž
 = 
p
->
nBufãr
 - 
iBuf
;

76504 ifÐ
	gnBy‹
<=
nAvaž
 ){

76508 *
µOut
 = &
p
->
aBufãr
[
iBuf
];

76509 
	gp
->
	giR—dOff
 +ð
nBy‹
;

76514 
	gnRem
;

76517 ifÐ
	gp
->
	gnAÎoc
<
	gnBy‹
 ){

76518 
u8
 *
	gaNew
;

76519 
	gnNew
 = 
MAX
(128, 
p
->
nAÎoc
*2);

76520  
	gnBy‹
>
	gnNew
 )‚New = 
nNew
*2;

76521 
	gaNew
 = 
sql™e3R—Îoc
(
p
->
aAÎoc
, 
nNew
);

76522 ifÐ!
	gaNew
 )  
	gSQLITE_NOMEM
;

76523 
	gp
->
	gnAÎoc
 = 
nNew
;

76524 
	gp
->
	gaAÎoc
 = 
aNew
;

76529 
memýy
(
p
->
aAÎoc
, &p->
aBufãr
[
iBuf
], 
nAvaž
);

76530 
	gp
->
	giR—dOff
 +ð
nAvaž
;

76531 
	gnRem
 = 
nBy‹
 - 
nAvaž
;

76535  
	gnRem
>0 ){

76536 
	grc
;

76537 
	gnCÝy
;

76538 
u8
 *
	gaNext
;

76540 
	gnCÝy
 = 
nRem
;

76541 ifÐ
	gnRem
>
	gp
->
	gnBufãr
 ) 
	gnCÝy
 = 
p
->
nBufãr
;

76542 
	grc
 = 
vdbePmaR—dBlob
(
p
, 
nCÝy
, &
aNext
);

76543 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

76544 
as£¹
Ð
aNext
!=
p
->
aAÎoc
 );

76545 
memýy
(&
p
->
aAÎoc
[
nBy‹
 - 
nRem
], 
aNext
, 
nCÝy
);

76546 
	gnRem
 -ð
nCÝy
;

76549 *
	gµOut
 = 
p
->
aAÎoc
;

76552  
	gSQLITE_OK
;

76559 
vdbePmaR—dV¬št
(
PmaR—d”
 *
p
, 
u64
 *
²Out
){

76560 
	giBuf
;

76562 ifÐ
	gp
->
	gaM­
 ){

76563 
	gp
->
	giR—dOff
 +ð
sql™e3G‘V¬št
(&
p
->
aM­
[p->
iR—dOff
], 
²Out
);

76565 
	giBuf
 = 
p
->
iR—dOff
 %…->
nBufãr
;

76566 ifÐ
	giBuf
 && (
	gp
->
	gnBufãr
-iBuf)>=9 ){

76567 
p
->
iR—dOff
 +ð
sql™e3G‘V¬št
(&p->
aBufãr
[
iBuf
], 
²Out
);

76569 
u8
 
	gaV¬št
[16], *
	ga
;

76570 
	gi
 = 0, 
	grc
;

76572 
	grc
 = 
vdbePmaR—dBlob
(
p
, 1, &
a
);

76573 ifÐ
	grc
 ) „c;

76574 
	gaV¬št
[(
i
++)&0xf] = 
a
[0];

76575 } (
	ga
[0]&0x80)!=0 );

76576 
sql™e3G‘V¬št
(
aV¬št
, 
²Out
);

76580  
	gSQLITE_OK
;

76592 
vdbeSÜ‹rM­Fže
(
SÜtSubsk
 *
pTask
, 
SÜ‹rFže
 *
pFže
, 
u8
 **
µ
){

76593 
	grc
 = 
SQLITE_OK
;

76594 ifÐ
	gpFže
->
	giEof
<=(
i64
)(
pTask
->
pSÜ‹r
->
db
->
nMaxSÜ‹rMm­
) ){

76595 
sql™e3_fže
 *
pFd
 = 
pFže
->pFd;

76596 ifÐ
	gpFd
->
	gpM‘hods
->
	giV”siÚ
>=3 ){

76597 
rc
 = 
sql™e3OsF‘ch
(
pFd
, 0, ()
pFže
->
iEof
, (**)
µ
);

76598 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

76601  
	grc
;

76609 
vdbePmaR—d”S“k
(

76610 
SÜtSubsk
 *
pTask
,

76611 
PmaR—d”
 *
pR—dr
,

76612 
SÜ‹rFže
 *
pFže
,

76613 
i64
 
iOff


76615 
	grc
 = 
SQLITE_OK
;

76617 
as£¹
Ð
pR—dr
->
pInü
==0 ||…R—dr->pInü->
bEof
==0 );

76619 ifÐ
sql™e3FauÉSim
(201èè 
	gSQLITE_IOERR_READ
;

76620 ifÐ
	gpR—dr
->
	gaM­
 ){

76621 
sql™e3OsUnãtch
(
pR—dr
->
pFd
, 0,…R—dr->
aM­
);

76622 
	gpR—dr
->
	gaM­
 = 0;

76624 
	gpR—dr
->
	giR—dOff
 = 
iOff
;

76625 
	gpR—dr
->
	giEof
 = 
pFže
->
iEof
;

76626 
	gpR—dr
->
	gpFd
 = 
pFže
->
pFd
;

76628 
	grc
 = 
vdbeSÜ‹rM­Fže
(
pTask
, 
pFže
, &
pR—dr
->
aM­
);

76629 ifÐ
	grc
==
SQLITE_OK
 && 
pR—dr
->
aM­
==0 ){

76630 
pgsz
 = 
pTask
->
pSÜ‹r
->pgsz;

76631 
	giBuf
 = 
pR—dr
->
iR—dOff
 % 
pgsz
;

76632 ifÐ
	gpR—dr
->
	gaBufãr
==0 ){

76633 
pR—dr
->
aBufãr
 = (
u8
*)
sql™e3M®loc
(
pgsz
);

76634 ifÐ
	gpR—dr
->
	gaBufãr
==0 ) 
rc
 = 
SQLITE_NOMEM
;

76635 
	gpR—dr
->
	gnBufãr
 = 
pgsz
;

76637 ifÐ
	grc
==
SQLITE_OK
 && 
iBuf
 ){

76638 
nR—d
 = 
pgsz
 - 
iBuf
;

76639 ifÐ(
	gpR—dr
->
	giR—dOff
 + 
	gnR—d
è>…R—dr->
	giEof
 ){

76640 
	gnR—d
 = ()(
pR—dr
->
iEof
 -…R—dr->
iR—dOff
);

76642 
	grc
 = 
sql™e3OsR—d
(

76643 
pR—dr
->
pFd
, &pR—dr->
aBufãr
[
iBuf
], 
nR—d
,…R—dr->
iR—dOff


76645 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

76649  
	grc
;

76656 
vdbePmaR—d”Next
(
PmaR—d”
 *
pR—dr
){

76657 
	grc
 = 
SQLITE_OK
;

76658 
u64
 
	gnRec
 = 0;

76661 ifÐ
	gpR—dr
->
	giR—dOff
>=
pR—dr
->
iEof
 ){

76662 
InüM”g”
 *
pInü
 = 
pR—dr
->pIncr;

76663 
	gbEof
 = 1;

76664 ifÐ
	gpInü
 ){

76665 
	grc
 = 
vdbeInüSw­
(
pInü
);

76666 ifÐ
	grc
==
SQLITE_OK
 && 
pInü
->
bEof
==0 ){

76667 
rc
 = 
vdbePmaR—d”S“k
(

76668 
pInü
->
pTask
, 
pR—dr
, &pInü->
aFže
[0],…Inü->
iS¹Off


76670 
	gbEof
 = 0;

76674 ifÐ
	gbEof
 ){

76676 
vdbePmaR—d”CË¬
(
pR—dr
);

76677 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

76678  
	grc
;

76682 ifÐ
	grc
==
SQLITE_OK
 ){

76683 
rc
 = 
vdbePmaR—dV¬št
(
pR—dr
, &
nRec
);

76685 ifÐ
	grc
==
SQLITE_OK
 ){

76686 
pR—dr
->
nKey
 = ()
nRec
;

76687 
	grc
 = 
vdbePmaR—dBlob
(
pR—dr
, ()
nRec
, &pR—dr->
aKey
);

76688 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

76691  
	grc
;

76703 
vdbePmaR—d”In™
(

76704 
SÜtSubsk
 *
pTask
,

76705 
SÜ‹rFže
 *
pFže
,

76706 
i64
 
iS¹
,

76707 
PmaR—d”
 *
pR—dr
,

76708 
i64
 *
²By‹


76710 
	grc
;

76712 
as£¹
Ð
pFže
->
iEof
>
iS¹
 );

76713 
as£¹
Ð
pR—dr
->
aAÎoc
==0 &&…R—dr->
nAÎoc
==0 );

76714 
as£¹
Ð
pR—dr
->
aBufãr
==0 );

76715 
as£¹
Ð
pR—dr
->
aM­
==0 );

76717 
	grc
 = 
vdbePmaR—d”S“k
(
pTask
, 
pR—dr
, 
pFže
, 
iS¹
);

76718 ifÐ
	grc
==
SQLITE_OK
 ){

76719 
u64
 
nBy‹
;

76720 
	grc
 = 
vdbePmaR—dV¬št
(
pR—dr
, &
nBy‹
);

76721 
	gpR—dr
->
	giEof
 = 
pR—dr
->
iR—dOff
 + 
nBy‹
;

76722 *
	g²By‹
 +ð
nBy‹
;

76725 ifÐ
	grc
==
SQLITE_OK
 ){

76726 
rc
 = 
vdbePmaR—d”Next
(
pR—dr
);

76728  
	grc
;

76745 
vdbeSÜ‹rCom·»
(

76746 
SÜtSubsk
 *
pTask
,

76747 cÚ¡ *
pKey1
, 
nKey1
,

76748 cÚ¡ *
pKey2
, 
nKey2


76750 
UÅackedRecÜd
 *
	gr2
 = 
pTask
->
pUÅacked
;

76751 ifÐ
	gpKey2
 ){

76752 
sql™e3VdbeRecÜdUÅack
(
pTask
->
pSÜ‹r
->
pKeyInfo
, 
nKey2
, 
pKey2
, 
r2
);

76754  
sql™e3VdbeRecÜdCom·»
(
nKey1
, 
pKey1
, 
r2
);

76776 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rIn™
(

76777 
sql™e3
 *
db
,

76778 
nF›ld
,

76779 
VdbeCursÜ
 *
pC¤


76781 
	gpgsz
;

76782 
	gi
;

76783 
	gmxCache
;

76784 
VdbeSÜ‹r
 *
	gpSÜ‹r
;

76785 
KeyInfo
 *
	gpKeyInfo
;

76786 
	gszKeyInfo
;

76787 
	gsz
;

76788 
	grc
 = 
SQLITE_OK
;

76789 #ià
SQLITE_MAX_WORKER_THREADS
==0

76790 
	#nWÜk”
 0

	)

76792 
	gnWÜk”
;

76796 #ià
SQLITE_MAX_WORKER_THREADS
>0

76797 ifÐ
sql™e3TempInMemÜy
(
db
è|| 
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
==0 ){

76798 
nWÜk”
 = 0;

76800 
	gnWÜk”
 = 
db
->
aLim™
[
SQLITE_LIMIT_WORKER_THREADS
];

76806 #ià
SQLITE_MAX_WORKER_THREADS
>=
SORTER_MAX_MERGE_COUNT


76807 ifÐ
	gnWÜk”
>=
SORTER_MAX_MERGE_COUNT
 ){

76808 
nWÜk”
 = 
SORTER_MAX_MERGE_COUNT
-1;

76812 
as£¹
Ð
pC¤
->
pKeyInfo
 &&…C¤->
pBt
==0 );

76813 
	gszKeyInfo
 = (
KeyInfo
è+ (
pC¤
->
pKeyInfo
->
nF›ld
-1)*(
CÞlSeq
*);

76814 
	gsz
 = (
VdbeSÜ‹r
è+ 
nWÜk”
 * (
SÜtSubsk
);

76816 
	gpSÜ‹r
 = (
VdbeSÜ‹r
*)
sql™e3DbM®locZ”o
(
db
, 
sz
 + 
szKeyInfo
);

76817 
	gpC¤
->
	gpSÜ‹r
 = 
pSÜ‹r
;

76818 ifÐ
	gpSÜ‹r
==0 ){

76819 
rc
 = 
SQLITE_NOMEM
;

76821 
	gpSÜ‹r
->
	gpKeyInfo
 = 
pKeyInfo
 = (
KeyInfo
*)((
u8
*)
pSÜ‹r
 + 
sz
);

76822 
memýy
(
pKeyInfo
, 
pC¤
->pKeyInfo, 
szKeyInfo
);

76823 
	gpKeyInfo
->
	gdb
 = 0;

76824 ifÐ
	gnF›ld
 && 
	gnWÜk”
==0 ) 
pKeyInfo
->
nF›ld
 =‚Field;

76825 
	gpSÜ‹r
->
	gpgsz
 = 
pgsz
 = 
sql™e3BŒ“G‘PageSize
(
db
->
aDb
[0].
pBt
);

76826 
	gpSÜ‹r
->
	gnTask
 = 
nWÜk”
 + 1;

76827 
	gpSÜ‹r
->
	gbU£Th»ads
 = (
pSÜ‹r
->
nTask
>1);

76828 
	gpSÜ‹r
->
	gdb
 = 
db
;

76829 
	gi
=0; i<
	gpSÜ‹r
->
	gnTask
; i++){

76830 
SÜtSubsk
 *
	gpTask
 = &
pSÜ‹r
->
aTask
[
i
];

76831 
	gpTask
->
	gpSÜ‹r
 = 
pSÜ‹r
;

76834 ifÐ!
sql™e3TempInMemÜy
(
db
) ){

76835 
	gpSÜ‹r
->
	gmnPmaSize
 = 
SORTER_MIN_WORKING
 * 
pgsz
;

76836 
	gmxCache
 = 
db
->
aDb
[0].
pSchema
->
ÿche_size
;

76837 ifÐ
	gmxCache
<
	gSORTER_MIN_WORKING
 ) mxCachð
SORTER_MIN_WORKING
;

76838 
	gpSÜ‹r
->
	gmxPmaSize
 = 
mxCache
 * 
pgsz
;

76846 ifÐ
	gsql™e3Glob®CÚfig
.
	gpSü©ch
==0 ){

76847 
as£¹
Ð
pSÜ‹r
->
iMemÜy
==0 );

76848 
	gpSÜ‹r
->
	gnMemÜy
 = 
pgsz
;

76849 
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 = (
u8
*)
sql™e3M®loc
(
pgsz
);

76850 ifÐ!
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 ) 
	grc
 = 
SQLITE_NOMEM
;

76855  
	grc
;

76857 #undeà
nWÜk”


76862 
vdbeSÜ‹rRecÜdF»e
(
sql™e3
 *
db
, 
SÜ‹rRecÜd
 *
pRecÜd
){

76863 
SÜ‹rRecÜd
 *
	gp
;

76864 
SÜ‹rRecÜd
 *
	gpNext
;

76865 
	gp
=
pRecÜd
;…;…=
pNext
){

76866 
pNext
 = 
p
->
u
.pNext;

76867 
sql™e3DbF»e
(
db
, 
p
);

76875 
vdbeSÜtSubskCËªup
(
sql™e3
 *
db
, 
SÜtSubsk
 *
pTask
){

76876 
sql™e3DbF»e
(
db
, 
pTask
->
pUÅacked
);

76877 
	gpTask
->
	gpUÅacked
 = 0;

76878 #ià
SQLITE_MAX_WORKER_THREADS
>0

76881 ifÐ
	gpTask
->
	gli¡
.
	gaMemÜy
 ){

76882 
sql™e3_ä“
(
pTask
->
li¡
.
aMemÜy
);

76883 
	gpTask
->
	gli¡
.
	gaMemÜy
 = 0;

76887 
as£¹
Ð
pTask
->
li¡
.
aMemÜy
==0 );

76888 
vdbeSÜ‹rRecÜdF»e
(0, 
pTask
->
li¡
.
pLi¡
);

76890 
	gpTask
->
	gli¡
.
	gpLi¡
 = 0;

76891 ifÐ
	gpTask
->
	gfže
.
	gpFd
 ){

76892 
sql™e3OsClo£F»e
(
pTask
->
fže
.
pFd
);

76893 
	gpTask
->
	gfže
.
	gpFd
 = 0;

76894 
	gpTask
->
	gfže
.
	giEof
 = 0;

76896 ifÐ
	gpTask
->
	gfže2
.
	gpFd
 ){

76897 
sql™e3OsClo£F»e
(
pTask
->
fže2
.
pFd
);

76898 
	gpTask
->
	gfže2
.
	gpFd
 = 0;

76899 
	gpTask
->
	gfže2
.
	giEof
 = 0;

76903 #ifdeà
SQLITE_DEBUG_SORTER_THREADS


76904 
vdbeSÜ‹rWÜkDebug
(
SÜtSubsk
 *
pTask
, cÚ¡ *
zEv’t
){

76905 
i64
 
	gt
;

76906 
	giTask
 = (
pTask
 -…Task->
pSÜ‹r
->
aTask
);

76907 
sql™e3OsCu¼’tTimeIÁ64
(
pTask
->
pSÜ‹r
->
db
->
pVfs
, &
t
);

76908 
årštf
(
¡d”r
, "%Îd:%d %s\n", 
t
, 
iTask
, 
zEv’t
);

76910 
vdbeSÜ‹rRewšdDebug
(cÚ¡ *
zEv’t
){

76911 
i64
 
	gt
;

76912 
sql™e3OsCu¼’tTimeIÁ64
(
sql™e3_vfs_fšd
(0), &
t
);

76913 
årštf
(
¡d”r
, "%Îd:X %s\n", 
t
, 
zEv’t
);

76915 
vdbeSÜ‹rPÝuÏ‹Debug
(

76916 
SÜtSubsk
 *
pTask
,

76917 cÚ¡ *
zEv’t


76919 
i64
 
	gt
;

76920 
	giTask
 = (
pTask
 -…Task->
pSÜ‹r
->
aTask
);

76921 
sql™e3OsCu¼’tTimeIÁ64
(
pTask
->
pSÜ‹r
->
db
->
pVfs
, &
t
);

76922 
årštf
(
¡d”r
, "%Îd:bg%d %s\n", 
t
, 
iTask
, 
zEv’t
);

76924 
vdbeSÜ‹rBlockDebug
(

76925 
SÜtSubsk
 *
pTask
,

76926 
bBlocked
,

76927 cÚ¡ *
zEv’t


76929 ifÐ
	gbBlocked
 ){

76930 
i64
 
	gt
;

76931 
sql™e3OsCu¼’tTimeIÁ64
(
pTask
->
pSÜ‹r
->
db
->
pVfs
, &
t
);

76932 
årštf
(
¡d”r
, "%Îd:maš %s\n", 
t
, 
zEv’t
);

76936 
	#vdbeSÜ‹rWÜkDebug
(
x
,
y
)

	)

76937 
	#vdbeSÜ‹rRewšdDebug
(
y
)

	)

76938 
	#vdbeSÜ‹rPÝuÏ‹Debug
(
x
,
y
)

	)

76939 
	#vdbeSÜ‹rBlockDebug
(
x
,
y
,
z
)

	)

76942 #ià
SQLITE_MAX_WORKER_THREADS
>0

76946 
vdbeSÜ‹rJošTh»ad
(
SÜtSubsk
 *
pTask
){

76947 
	grc
 = 
SQLITE_OK
;

76948 ifÐ
	gpTask
->
	gpTh»ad
 ){

76949 #ifdeà
SQLITE_DEBUG_SORTER_THREADS


76950 
	gbDÚe
 = 
pTask
->
bDÚe
;

76952 *
	gpR‘
 = 
SQLITE_INT_TO_PTR
(
SQLITE_ERROR
);

76953 
vdbeSÜ‹rBlockDebug
(
pTask
, !
bDÚe
, "enter");

76954 ()
sql™e3Th»adJoš
(
pTask
->
pTh»ad
, &
pR‘
);

76955 
vdbeSÜ‹rBlockDebug
(
pTask
, !
bDÚe
, "exit");

76956 
	grc
 = 
SQLITE_PTR_TO_INT
(
pR‘
);

76957 
as£¹
Ð
pTask
->
bDÚe
==1 );

76958 
	gpTask
->
	gbDÚe
 = 0;

76959 
	gpTask
->
	gpTh»ad
 = 0;

76961  
	grc
;

76967 
vdbeSÜ‹rC»©eTh»ad
(

76968 
SÜtSubsk
 *
pTask
,

76969 *(*
xTask
)(*),

76970 *
pIn


76972 
as£¹
Ð
pTask
->
pTh»ad
==0 &&…Task->
bDÚe
==0 );

76973  
sql™e3Th»adC»©e
(&
pTask
->
pTh»ad
, 
xTask
, 
pIn
);

76980 
vdbeSÜ‹rJošAÎ
(
VdbeSÜ‹r
 *
pSÜ‹r
, 
rcš
){

76981 
	grc
 = 
rcš
;

76982 
	gi
;

76991 
	gi
=
pSÜ‹r
->
nTask
-1; i>=0; i--){

76992 
SÜtSubsk
 *
	gpTask
 = &
pSÜ‹r
->
aTask
[
i
];

76993 
	grc2
 = 
vdbeSÜ‹rJošTh»ad
(
pTask
);

76994 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

76996  
	grc
;

76999 
	#vdbeSÜ‹rJošAÎ
(
x
,
rcš
èÔcš)

	)

77000 
	#vdbeSÜ‹rJošTh»ad
(
pTask
è
SQLITE_OK


	)

77010 
M”geEngše
 *
vdbeM”geEngšeNew
(
nR—d”
){

77011 
	gN
 = 2;

77012 
	gnBy‹
;

77013 
M”geEngše
 *
	gpNew
;

77015 
as£¹
Ð
nR—d”
<=
SORTER_MAX_MERGE_COUNT
 );

77017  
	gN
<
	gnR—d”
 ) N +ð
N
;

77018 
	gnBy‹
 = (
M”geEngše
è+ 
N
 * ((è+ (
PmaR—d”
));

77020 
	gpNew
 = 
sql™e3FauÉSim
(100è? 0 : (
M”geEngše
*)
sql™e3M®locZ”o
(
nBy‹
);

77021 ifÐ
	gpNew
 ){

77022 
	gpNew
->
	gnT»e
 = 
N
;

77023 
	gpNew
->
	gpTask
 = 0;

77024 
	gpNew
->
	gaR—dr
 = (
PmaR—d”
*)&
pNew
[1];

77025 
	gpNew
->
	gaT»e
 = (*)&
pNew
->
aR—dr
[
N
];

77027  
	gpNew
;

77033 
vdbeM”geEngšeF»e
(
M”geEngše
 *
pM”g”
){

77034 
	gi
;

77035 ifÐ
	gpM”g”
 ){

77036 
	gi
=0; i<
	gpM”g”
->
	gnT»e
; i++){

77037 
vdbePmaR—d”CË¬
(&
pM”g”
->
aR—dr
[
i
]);

77040 
sql™e3_ä“
(
pM”g”
);

77047 
vdbeInüF»e
(
InüM”g”
 *
pInü
){

77048 ifÐ
	gpInü
 ){

77049 #ià
SQLITE_MAX_WORKER_THREADS
>0

77050 ifÐ
	gpInü
->
	gbU£Th»ad
 ){

77051 
vdbeSÜ‹rJošTh»ad
(
pInü
->
pTask
);

77052 ifÐ
	gpInü
->
	gaFže
[0].
	gpFd
 ) 
sql™e3OsClo£F»e
(
pInü
->
aFže
[0].
pFd
);

77053 ifÐ
	gpInü
->
	gaFže
[1].
	gpFd
 ) 
sql™e3OsClo£F»e
(
pInü
->
aFže
[1].
pFd
);

77056 
vdbeM”geEngšeF»e
(
pInü
->
pM”g”
);

77057 
sql™e3_ä“
(
pInü
);

77064 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRe£t
(
sql™e3
 *
db
, 
VdbeSÜ‹r
 *
pSÜ‹r
){

77065 
	gi
;

77066 ()
vdbeSÜ‹rJošAÎ
(
pSÜ‹r
, 
SQLITE_OK
);

77067 
as£¹
Ð
pSÜ‹r
->
bU£Th»ads
 ||…SÜ‹r->
pR—d”
==0 );

77068 #ià
SQLITE_MAX_WORKER_THREADS
>0

77069 ifÐ
	gpSÜ‹r
->
	gpR—d”
 ){

77070 
vdbePmaR—d”CË¬
(
pSÜ‹r
->
pR—d”
);

77071 
sql™e3DbF»e
(
db
, 
pSÜ‹r
->
pR—d”
);

77072 
	gpSÜ‹r
->
	gpR—d”
 = 0;

77075 
vdbeM”geEngšeF»e
(
pSÜ‹r
->
pM”g”
);

77076 
	gpSÜ‹r
->
	gpM”g”
 = 0;

77077 
	gi
=0; i<
	gpSÜ‹r
->
	gnTask
; i++){

77078 
SÜtSubsk
 *
	gpTask
 = &
pSÜ‹r
->
aTask
[
i
];

77079 
vdbeSÜtSubskCËªup
(
db
, 
pTask
);

77081 ifÐ
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
==0 ){

77082 
vdbeSÜ‹rRecÜdF»e
(0, 
pSÜ‹r
->
li¡
.
pLi¡
);

77084 
	gpSÜ‹r
->
	gli¡
.
	gpLi¡
 = 0;

77085 
	gpSÜ‹r
->
	gli¡
.
	gszPMA
 = 0;

77086 
	gpSÜ‹r
->
	gbU£PMA
 = 0;

77087 
	gpSÜ‹r
->
	giMemÜy
 = 0;

77088 
	gpSÜ‹r
->
	gmxKeysize
 = 0;

77089 
sql™e3DbF»e
(
db
, 
pSÜ‹r
->
pUÅacked
);

77090 
	gpSÜ‹r
->
	gpUÅacked
 = 0;

77096 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rClo£
(
sql™e3
 *
db
, 
VdbeCursÜ
 *
pC¤
){

77097 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

77098 ifÐ
	gpSÜ‹r
 ){

77099 
sql™e3VdbeSÜ‹rRe£t
(
db
, 
pSÜ‹r
);

77100 
sql™e3_ä“
(
pSÜ‹r
->
li¡
.
aMemÜy
);

77101 
sql™e3DbF»e
(
db
, 
pSÜ‹r
);

77102 
	gpC¤
->
	gpSÜ‹r
 = 0;

77106 #ià
SQLITE_MAX_MMAP_SIZE
>0

77116 
vdbeSÜ‹rEx‹ndFže
(
sql™e3
 *
db
, 
sql™e3_fže
 *
pFd
, 
i64
 
nBy‹
){

77117 ifÐ
	gnBy‹
<=(
i64
)(
db
->
nMaxSÜ‹rMm­
è&& 
pFd
->
pM‘hods
->
iV”siÚ
>=3 ){

77118 
rc
 = 
sql™e3OsTrunÿ‹
(
pFd
, 
nBy‹
);

77119 ifÐ
	grc
==
SQLITE_OK
 ){

77120 *
p
 = 0;

77121 
sql™e3OsF‘ch
(
pFd
, 0, ()
nBy‹
, &
p
);

77122 
sql™e3OsUnãtch
(
pFd
, 0, 
p
);

77127 
	#vdbeSÜ‹rEx‹ndFže
(
x
,
y
,
z
)

	)

77135 
vdbeSÜ‹rO³nTempFže
(

77136 
sql™e3
 *
db
,

77137 
i64
 
nEx‹nd
,

77138 
sql™e3_fže
 **
µFd


77140 
	grc
;

77141 
	grc
 = 
sql™e3OsO³nM®loc
(
db
->
pVfs
, 0, 
µFd
,

77142 
SQLITE_OPEN_TEMP_JOURNAL
 |

77143 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
 |

77144 
SQLITE_OPEN_EXCLUSIVE
 | 
SQLITE_OPEN_DELETEONCLOSE
, &
rc


77146 ifÐ
	grc
==
SQLITE_OK
 ){

77147 
i64
 
max
 = 
SQLITE_MAX_MMAP_SIZE
;

77148 
sql™e3OsFžeCÚŒÞHšt
(*
µFd
, 
SQLITE_FCNTL_MMAP_SIZE
, (*)&
max
);

77149 ifÐ
	gnEx‹nd
>0 ){

77150 
vdbeSÜ‹rEx‹ndFže
(
db
, *
µFd
, 
nEx‹nd
);

77153  
	grc
;

77161 
vdbeSÜtAÎocUÅacked
(
SÜtSubsk
 *
pTask
){

77162 ifÐ
	gpTask
->
	gpUÅacked
==0 ){

77163 *
pF»e
;

77164 
	gpTask
->
	gpUÅacked
 = 
sql™e3VdbeAÎocUÅackedRecÜd
(

77165 
pTask
->
pSÜ‹r
->
pKeyInfo
, 0, 0, &
pF»e


77167 
as£¹
Ð
pTask
->
pUÅacked
==(
UÅackedRecÜd
*)
pF»e
 );

77168 ifÐ
	gpF»e
==0 )  
SQLITE_NOMEM
;

77169 
	gpTask
->
	gpUÅacked
->
	gnF›ld
 = 
pTask
->
pSÜ‹r
->
pKeyInfo
->
nF›ld
;

77170 
	gpTask
->
	gpUÅacked
->
	g”rCode
 = 0;

77172  
	gSQLITE_OK
;

77180 
vdbeSÜ‹rM”ge
(

77181 
SÜtSubsk
 *
pTask
,

77182 
SÜ‹rRecÜd
 *
p1
,

77183 
SÜ‹rRecÜd
 *
p2
,

77184 
SÜ‹rRecÜd
 **
µOut


77186 
SÜ‹rRecÜd
 *
	gpFš®
 = 0;

77187 
SÜ‹rRecÜd
 **
	gµ
 = &
pFš®
;

77188 *
	gpV®2
 = 
p2
 ? 
SRVAL
(p2) : 0;

77190  
	gp1
 && 
	gp2
 ){

77191 
	g»s
;

77192 
	g»s
 = 
vdbeSÜ‹rCom·»
(
pTask
, 
SRVAL
(
p1
),…1->
nV®
, 
pV®2
, 
p2
->nVal);

77193 ifÐ
	g»s
<=0 ){

77194 *
µ
 = 
p1
;

77195 
	gµ
 = &
p1
->
u
.
pNext
;

77196 
	gp1
 = 
p1
->
u
.
pNext
;

77197 
	gpV®2
 = 0;

77199 *
	gµ
 = 
p2
;

77200 
	gµ
 = &
p2
->
u
.
pNext
;

77201 
	gp2
 = 
p2
->
u
.
pNext
;

77202 ifÐ
	gp2
==0 ) ;

77203 
	gpV®2
 = 
SRVAL
(
p2
);

77206 *
	gµ
 = 
p1
 ?…1 : 
p2
;

77207 *
	gµOut
 = 
pFš®
;

77215 
vdbeSÜ‹rSÜt
(
SÜtSubsk
 *
pTask
, 
SÜ‹rLi¡
 *
pLi¡
){

77216 
	gi
;

77217 
SÜ‹rRecÜd
 **
	gaSlÙ
;

77218 
SÜ‹rRecÜd
 *
	gp
;

77219 
	grc
;

77221 
	grc
 = 
vdbeSÜtAÎocUÅacked
(
pTask
);

77222 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

77224 
	gaSlÙ
 = (
SÜ‹rRecÜd
 **)
sql™e3M®locZ”o
(64 * (SorterRecord *));

77225 ifÐ!
	gaSlÙ
 ){

77226  
	gSQLITE_NOMEM
;

77229 
	gp
 = 
pLi¡
->pList;

77230  
	gp
 ){

77231 
SÜ‹rRecÜd
 *
	gpNext
;

77232 ifÐ
	gpLi¡
->
	gaMemÜy
 ){

77233 ifÐ(
	gu8
*)
	gp
==
pLi¡
->
aMemÜy
 ){

77234 
pNext
 = 0;

77236 
as£¹
Ð
p
->
u
.
iNext
<
sql™e3M®locSize
(
pLi¡
->
aMemÜy
) );

77237 
	gpNext
 = (
SÜ‹rRecÜd
*)&
pLi¡
->
aMemÜy
[
p
->
u
.
iNext
];

77240 
	gpNext
 = 
p
->
u
.
pNext
;

77243 
	gp
->
	gu
.
	gpNext
 = 0;

77244 
	gi
=0; 
	gaSlÙ
[
i
]; i++){

77245 
vdbeSÜ‹rM”ge
(
pTask
, 
p
, 
aSlÙ
[
i
], &p);

77246 
	gaSlÙ
[
i
] = 0;

77248 
	gaSlÙ
[
i
] = 
p
;

77249 
	gp
 = 
pNext
;

77252 
	gp
 = 0;

77253 
	gi
=0; i<64; i++){

77254 
vdbeSÜ‹rM”ge
(
pTask
, 
p
, 
aSlÙ
[
i
], &p);

77256 
	gpLi¡
->pLi¡ = 
p
;

77258 
sql™e3_ä“
(
aSlÙ
);

77259 
as£¹
Ð
pTask
->
pUÅacked
->
”rCode
==
SQLITE_OK


77260 || 
pTask
->
pUÅacked
->
”rCode
==
SQLITE_NOMEM


77262  
	gpTask
->
	gpUÅacked
->
	g”rCode
;

77268 
vdbePmaWr™”In™
(

77269 
sql™e3_fže
 *
pFd
,

77270 
PmaWr™”
 *
p
,

77271 
nBuf
,

77272 
i64
 
iS¹


77274 
mem£t
(
p
, 0, (
PmaWr™”
));

77275 
	gp
->
	gaBufãr
 = (
u8
*)
sql™e3M®loc
(
nBuf
);

77276 ifÐ!
	gp
->
	gaBufãr
 ){

77277 
	gp
->
	geFWE¼
 = 
SQLITE_NOMEM
;

77279 
	gp
->
	giBufEnd
 = 
p
->
iBufS¹
 = (
iS¹
 % 
nBuf
);

77280 
	gp
->
	giWr™eOff
 = 
iS¹
 - 
p
->
iBufS¹
;

77281 
	gp
->
	gnBufãr
 = 
nBuf
;

77282 
	gp
->
	gpFd
 = 
pFd
;

77290 
vdbePmaWr™eBlob
(
PmaWr™”
 *
p
, 
u8
 *
pD©a
, 
nD©a
){

77291 
	gnRem
 = 
nD©a
;

77292  
	gnRem
>0 && 
	gp
->
	geFWE¼
==0 ){

77293 
nCÝy
 = 
nRem
;

77294 ifÐ
	gnCÝy
>(
	gp
->
	gnBufãr
 -…->
	giBufEnd
) ){

77295 
	gnCÝy
 = 
p
->
nBufãr
 -…->
iBufEnd
;

77298 
memýy
(&
p
->
aBufãr
[p->
iBufEnd
], &
pD©a
[
nD©a
-
nRem
], 
nCÝy
);

77299 
	gp
->
	giBufEnd
 +ð
nCÝy
;

77300 ifÐ
	gp
->
	giBufEnd
==
p
->
nBufãr
 ){

77301 
p
->
eFWE¼
 = 
sql™e3OsWr™e
Õ->
pFd
,

77302 &
p
->
aBufãr
[p->
iBufS¹
],…->
iBufEnd
 -…->iBufStart,

77303 
p
->
iWr™eOff
 +…->
iBufS¹


77305 
	gp
->
	giBufS¹
 = 
p
->
iBufEnd
 = 0;

77306 
	gp
->
	giWr™eOff
 +ð
p
->
nBufãr
;

77308 
as£¹
Ð
p
->
iBufEnd
<p->
nBufãr
 );

77310 
	gnRem
 -ð
nCÝy
;

77323 
vdbePmaWr™”Fšish
(
PmaWr™”
 *
p
, 
i64
 *
piEof
){

77324 
	grc
;

77325 ifÐ
	gp
->
	geFWE¼
==0 && 
ALWAYS
(
p
->
aBufãr
è&&…->
iBufEnd
>p->
iBufS¹
 ){

77326 
p
->
eFWE¼
 = 
sql™e3OsWr™e
Õ->
pFd
,

77327 &
p
->
aBufãr
[p->
iBufS¹
],…->
iBufEnd
 -…->iBufStart,

77328 
p
->
iWr™eOff
 +…->
iBufS¹


77331 *
	gpiEof
 = (
p
->
iWr™eOff
 +…->
iBufEnd
);

77332 
sql™e3_ä“
(
p
->
aBufãr
);

77333 
	grc
 = 
p
->
eFWE¼
;

77334 
mem£t
(
p
, 0, (
PmaWr™”
));

77335  
	grc
;

77342 
vdbePmaWr™eV¬št
(
PmaWr™”
 *
p
, 
u64
 
iV®
){

77343 
	gnBy‹
;

77344 
u8
 
	gaBy‹
[10];

77345 
	gnBy‹
 = 
sql™e3PutV¬št
(
aBy‹
, 
iV®
);

77346 
vdbePmaWr™eBlob
(
p
, 
aBy‹
, 
nBy‹
);

77363 
vdbeSÜ‹rLi¡ToPMA
(
SÜtSubsk
 *
pTask
, 
SÜ‹rLi¡
 *
pLi¡
){

77364 
sql™e3
 *
	gdb
 = 
pTask
->
pSÜ‹r
->
db
;

77365 
	grc
 = 
SQLITE_OK
;

77366 
PmaWr™”
 
	gwr™”
;

77368 #ifdeà
SQLITE_DEBUG


77371 
i64
 
	giSz
 = 
pLi¡
->
szPMA
 + 
sql™e3V¬štL’
ÕLi¡->szPMAè+ 
pTask
->
fže
.
iEof
;

77374 
vdbeSÜ‹rWÜkDebug
(
pTask
, "enter");

77375 
mem£t
(&
wr™”
, 0, (
PmaWr™”
));

77376 
as£¹
Ð
pLi¡
->
szPMA
>0 );

77379 ifÐ
	gpTask
->
	gfže
.
	gpFd
==0 ){

77380 
rc
 = 
vdbeSÜ‹rO³nTempFže
(
db
, 0, &
pTask
->
fže
.
pFd
);

77381 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pTask
->
fže
.
pFd
 );

77382 
as£¹
Ð
pTask
->
fže
.
iEof
==0 );

77383 
as£¹
Ð
pTask
->
nPMA
==0 );

77387 ifÐ
	grc
==
SQLITE_OK
 ){

77388 
vdbeSÜ‹rEx‹ndFže
(
db
, 
pTask
->
fže
.
pFd
,…Task->fže.
iEof
+
pLi¡
->
szPMA
+9);

77392 ifÐ
	grc
==
SQLITE_OK
 ){

77393 
rc
 = 
vdbeSÜ‹rSÜt
(
pTask
, 
pLi¡
);

77396 ifÐ
	grc
==
SQLITE_OK
 ){

77397 
SÜ‹rRecÜd
 *
p
;

77398 
SÜ‹rRecÜd
 *
	gpNext
 = 0;

77400 
vdbePmaWr™”In™
(
pTask
->
fže
.
pFd
, &
wr™”
,…Task->
pSÜ‹r
->
pgsz
,

77401 
pTask
->
fže
.
iEof
);

77402 
	gpTask
->
	gnPMA
++;

77403 
vdbePmaWr™eV¬št
(&
wr™”
, 
pLi¡
->
szPMA
);

77404 
	gp
=
pLi¡
->pLi¡;…;…=
pNext
){

77405 
pNext
 = 
p
->
u
.pNext;

77406 
vdbePmaWr™eV¬št
(&
wr™”
, 
p
->
nV®
);

77407 
vdbePmaWr™eBlob
(&
wr™”
, 
SRVAL
(
p
),…->
nV®
);

77408 ifÐ
	gpLi¡
->
	gaMemÜy
==0 ) 
sql™e3_ä“
(
p
);

77410 
	gpLi¡
->pLi¡ = 
p
;

77411 
	grc
 = 
vdbePmaWr™”Fšish
(&
wr™”
, &
pTask
->
fže
.
iEof
);

77414 
vdbeSÜ‹rWÜkDebug
(
pTask
, "exit");

77415 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pLi¡
->pList==0 );

77416 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pTask
->
fže
.
iEof
==
iSz
 );

77417  
	grc
;

77427 
vdbeM”geEngšeS‹p
(

77428 
M”geEngše
 *
pM”g”
,

77429 *
pbEof


77431 
	grc
;

77432 
	giP»v
 = 
pM”g”
->
aT»e
[1];

77433 
SÜtSubsk
 *
	gpTask
 = 
pM”g”
->
pTask
;

77436 
	grc
 = 
vdbePmaR—d”Next
(&
pM”g”
->
aR—dr
[
iP»v
]);

77439 ifÐ
	grc
==
SQLITE_OK
 ){

77440 
i
;

77441 
PmaR—d”
 *
	gpR—dr1
;

77442 
PmaR—d”
 *
	gpR—dr2
;

77443 
u8
 *
	gpKey2
;

77447 
	gpR—dr1
 = &
pM”g”
->
aR—dr
[(
iP»v
 & 0xFFFE)];

77448 
	gpR—dr2
 = &
pM”g”
->
aR—dr
[(
iP»v
 | 0x0001)];

77449 
	gpKey2
 = 
pR—dr2
->
aKey
;

77451 
	gi
=(
pM”g”
->
nT»e
+
iP»v
)/2; i>0; i=
i
/2){

77453 
iRes
;

77454 ifÐ
	gpR—dr1
->
	gpFd
==0 ){

77455 
iRes
 = +1;

77456 }ifÐ
	gpR—dr2
->
	gpFd
==0 ){

77457 
iRes
 = -1;

77459 
	giRes
 = 
vdbeSÜ‹rCom·»
(
pTask
,

77460 
pR—dr1
->
aKey
,…R—dr1->
nKey
, 
pKey2
, 
pR—dr2
->nKey

77479 ifÐ
	giRes
<0 || (iRes==0 && 
pR—dr1
<
pR—dr2
) ){

77480 
pM”g”
->
aT»e
[
i
] = ()(
pR—dr1
 -…M”g”->
aR—dr
);

77481 
	gpR—dr2
 = &
pM”g”
->
aR—dr
[…M”g”->
aT»e
[
i
 ^ 0x0001] ];

77482 
	gpKey2
 = 
pR—dr2
->
aKey
;

77484 ifÐ
	gpR—dr1
->
	gpFd
 ) 
	gpKey2
 = 0;

77485 
	gpM”g”
->
	gaT»e
[
i
] = ()(
pR—dr2
 - 
pM”g”
->
aR—dr
);

77486 
	gpR—dr1
 = &
pM”g”
->
aR—dr
[…M”g”->
aT»e
[
i
 ^ 0x0001] ];

77489 *
	gpbEof
 = (
pM”g”
->
aR—dr
[pM”g”->
aT»e
[1]].
pFd
==0);

77492  (
	grc
==
SQLITE_OK
 ? 
pTask
->
pUÅacked
->
”rCode
 : 
rc
);

77495 #ià
SQLITE_MAX_WORKER_THREADS
>0

77499 *
vdbeSÜ‹rFlushTh»ad
(*
pCtx
){

77500 
SÜtSubsk
 *
	gpTask
 = (SÜtSubsk*)
pCtx
;

77501 
	grc
;

77502 
as£¹
Ð
pTask
->
bDÚe
==0 );

77503 
	grc
 = 
vdbeSÜ‹rLi¡ToPMA
(
pTask
, &pTask->
li¡
);

77504 
	gpTask
->
	gbDÚe
 = 1;

77505  
SQLITE_INT_TO_PTR
(
rc
);

77513 
vdbeSÜ‹rFlushPMA
(
VdbeSÜ‹r
 *
pSÜ‹r
){

77514 #ià
SQLITE_MAX_WORKER_THREADS
==0

77515 
	gpSÜ‹r
->
	gbU£PMA
 = 1;

77516  
vdbeSÜ‹rLi¡ToPMA
(&
pSÜ‹r
->
aTask
[0], &pSÜ‹r->
li¡
);

77518 
	grc
 = 
SQLITE_OK
;

77519 
	gi
;

77520 
SÜtSubsk
 *
	gpTask
 = 0;

77521 
	gnWÜk”
 = (
pSÜ‹r
->
nTask
-1);

77525 
	gpSÜ‹r
->
	gbU£PMA
 = 1;

77535 
	gi
=0; i<
	gnWÜk”
; i++){

77536 
	giTe¡
 = (
pSÜ‹r
->
iP»v
 + 
i
 + 1è% 
nWÜk”
;

77537 
	gpTask
 = &
pSÜ‹r
->
aTask
[
iTe¡
];

77538 ifÐ
	gpTask
->
	gbDÚe
 ){

77539 
	grc
 = 
vdbeSÜ‹rJošTh»ad
(
pTask
);

77541 ifÐ
	grc
!=
SQLITE_OK
 || 
pTask
->
pTh»ad
==0 ) ;

77544 ifÐ
	grc
==
SQLITE_OK
 ){

77545 ifÐ
i
==
nWÜk”
 ){

77547 
rc
 = 
vdbeSÜ‹rLi¡ToPMA
(&
pSÜ‹r
->
aTask
[
nWÜk”
], &pSÜ‹r->
li¡
);

77550 
u8
 *
	gaMem
 = 
pTask
->
li¡
.
aMemÜy
;

77551 *
	gpCtx
 = (*)
pTask
;

77553 
as£¹
Ð
pTask
->
pTh»ad
==0 &&…Task->
bDÚe
==0 );

77554 
as£¹
Ð
pTask
->
li¡
.
pLi¡
==0 );

77555 
as£¹
Ð
pTask
->
li¡
.
aMemÜy
==0 || 
pSÜ‹r
->list.aMemory!=0 );

77557 
	gpSÜ‹r
->
	giP»v
 = (
u8
)(
pTask
 - 
pSÜ‹r
->
aTask
);

77558 
	gpTask
->
	gli¡
 = 
pSÜ‹r
->
li¡
;

77559 
	gpSÜ‹r
->
	gli¡
.
	gpLi¡
 = 0;

77560 
	gpSÜ‹r
->
	gli¡
.
	gszPMA
 = 0;

77561 ifÐ
	gaMem
 ){

77562 
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 = 
aMem
;

77563 
	gpSÜ‹r
->
	gnMemÜy
 = 
sql™e3M®locSize
(
aMem
);

77564 }ifÐ
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 ){

77565 
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 = 
sql™e3M®loc
(
pSÜ‹r
->
nMemÜy
);

77566 ifÐ!
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 )  
	gSQLITE_NOMEM
;

77569 
	grc
 = 
vdbeSÜ‹rC»©eTh»ad
(
pTask
, 
vdbeSÜ‹rFlushTh»ad
, 
pCtx
);

77573  
	grc
;

77580 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rWr™e
(

77581 cÚ¡ 
VdbeCursÜ
 *
pC¤
,

77582 
Mem
 *
pV®


77584 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

77585 
	grc
 = 
SQLITE_OK
;

77586 
SÜ‹rRecÜd
 *
	gpNew
;

77588 
	gbFlush
;

77589 
	gnReq
;

77590 
	gnPMA
;

77592 
as£¹
Ð
pSÜ‹r
 );

77610 
	gnReq
 = 
pV®
->
n
 + (
SÜ‹rRecÜd
);

77611 
	gnPMA
 = 
pV®
->
n
 + 
sql™e3V¬štL’
(pVal->n);

77612 ifÐ
	gpSÜ‹r
->
	gmxPmaSize
 ){

77613 ifÐ
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 ){

77614 
	gbFlush
 = 
pSÜ‹r
->
iMemÜy
 && (pSÜ‹r->iMemÜy+
nReq
è>…SÜ‹r->
mxPmaSize
;

77616 
	gbFlush
 = (

77617 (
pSÜ‹r
->
li¡
.
szPMA
 >…SÜ‹r->
mxPmaSize
)

77618 || (
pSÜ‹r
->
li¡
.
szPMA
 >…SÜ‹r->
mnPmaSize
 && 
sql™e3H—pN—¾yFuÎ
())

77621 ifÐ
	gbFlush
 ){

77622 
	grc
 = 
vdbeSÜ‹rFlushPMA
(
pSÜ‹r
);

77623 
	gpSÜ‹r
->
	gli¡
.
	gszPMA
 = 0;

77624 
	gpSÜ‹r
->
	giMemÜy
 = 0;

77625 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pSÜ‹r
->
li¡
.
pLi¡
==0 );

77629 
	gpSÜ‹r
->
	gli¡
.
	gszPMA
 +ð
nPMA
;

77630 ifÐ
	gnPMA
>
	gpSÜ‹r
->
	gmxKeysize
 ){

77631 
	gpSÜ‹r
->
	gmxKeysize
 = 
nPMA
;

77634 ifÐ
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 ){

77635 
	gnMš
 = 
pSÜ‹r
->
iMemÜy
 + 
nReq
;

77637 ifÐ
	gnMš
>
	gpSÜ‹r
->
	gnMemÜy
 ){

77638 
u8
 *
	gaNew
;

77639 
	gnNew
 = 
pSÜ‹r
->
nMemÜy
 * 2;

77640  
	gnNew
 < 
	gnMš
 )‚New = 
nNew
*2;

77641 ifÐ
	gnNew
 > 
	gpSÜ‹r
->
	gmxPmaSize
 )‚New = 
pSÜ‹r
->
mxPmaSize
;

77642 ifÐ
	gnNew
 < 
	gnMš
 )‚New = 
nMš
;

77644 
	gaNew
 = 
sql™e3R—Îoc
(
pSÜ‹r
->
li¡
.
aMemÜy
, 
nNew
);

77645 ifÐ!
	gaNew
 )  
	gSQLITE_NOMEM
;

77646 
	gpSÜ‹r
->
	gli¡
.
	gpLi¡
 = (
SÜ‹rRecÜd
*)(

77647 
aNew
 + ((
u8
*)
pSÜ‹r
->
li¡
.
pLi¡
 -…SÜ‹r->li¡.
aMemÜy
)

77649 
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
 = 
aNew
;

77650 
	gpSÜ‹r
->
	gnMemÜy
 = 
nNew
;

77653 
	gpNew
 = (
SÜ‹rRecÜd
*)&
pSÜ‹r
->
li¡
.
aMemÜy
[pSÜ‹r->
iMemÜy
];

77654 
	gpSÜ‹r
->
	giMemÜy
 +ð
ROUND8
(
nReq
);

77655 
	gpNew
->
	gu
.
	giNext
 = ()((
u8
*)(
pSÜ‹r
->
li¡
.
pLi¡
è-…SÜ‹r->li¡.
aMemÜy
);

77657 
	gpNew
 = (
SÜ‹rRecÜd
 *)
sql™e3M®loc
(
nReq
);

77658 ifÐ
	gpNew
==0 ){

77659  
SQLITE_NOMEM
;

77661 
	gpNew
->
	gu
.
	gpNext
 = 
pSÜ‹r
->
li¡
.
pLi¡
;

77664 
memýy
(
SRVAL
(
pNew
), 
pV®
->
z
,…V®->
n
);

77665 
	gpNew
->
	gnV®
 = 
pV®
->
n
;

77666 
	gpSÜ‹r
->
	gli¡
.
	gpLi¡
 = 
pNew
;

77668  
	grc
;

77676 
vdbeInüPÝuÏ‹
(
InüM”g”
 *
pInü
){

77677 
	grc
 = 
SQLITE_OK
;

77678 
	grc2
;

77679 
i64
 
	giS¹
 = 
pInü
->
iS¹Off
;

77680 
SÜ‹rFže
 *
	gpOut
 = &
pInü
->
aFže
[1];

77681 
SÜtSubsk
 *
	gpTask
 = 
pInü
->
pTask
;

77682 
M”geEngše
 *
	gpM”g”
 = 
pInü
->
pM”g”
;

77683 
PmaWr™”
 
	gwr™”
;

77684 
as£¹
Ð
pInü
->
bEof
==0 );

77686 
vdbeSÜ‹rPÝuÏ‹Debug
(
pTask
, "enter");

77688 
vdbePmaWr™”In™
(
pOut
->
pFd
, &
wr™”
, 
pTask
->
pSÜ‹r
->
pgsz
, 
iS¹
);

77689  
	grc
==
SQLITE_OK
 ){

77690 
dummy
;

77691 
PmaR—d”
 *
	gpR—d”
 = &
pM”g”
->
aR—dr
[…M”g”->
aT»e
[1] ];

77692 
	gnKey
 = 
pR—d”
->
nKey
;

77693 
i64
 
	giEof
 = 
wr™”
.
iWr™eOff
 + wr™”.
iBufEnd
;

77697 ifÐ
	gpR—d”
->
	gpFd
==0 ) ;

77698 ifÐ(
	giEof
 + 
	gnKey
 + 
sql™e3V¬štL’
(
nKey
))>(
	giS¹
 + 
	gpInü
->
	gmxSz
) ) ;

77701 
vdbePmaWr™eV¬št
(&
wr™”
, 
nKey
);

77702 
vdbePmaWr™eBlob
(&
wr™”
, 
pR—d”
->
aKey
, 
nKey
);

77703 
as£¹
Ð
pInü
->
pM”g”
->
pTask
==pTask );

77704 
	grc
 = 
vdbeM”geEngšeS‹p
(
pInü
->
pM”g”
, &
dummy
);

77707 
	grc2
 = 
vdbePmaWr™”Fšish
(&
wr™”
, &
pOut
->
iEof
);

77708 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

77709 
vdbeSÜ‹rPÝuÏ‹Debug
(
pTask
, "exit");

77710  
	grc
;

77713 #ià
SQLITE_MAX_WORKER_THREADS
>0

77718 *
vdbeInüPÝuÏ‹Th»ad
(*
pCtx
){

77719 
InüM”g”
 *
	gpInü
 = (InüM”g”*)
pCtx
;

77720 *
	gpR‘
 = 
SQLITE_INT_TO_PTR
Ð
vdbeInüPÝuÏ‹
(
pInü
) );

77721 
	gpInü
->
	gpTask
->
	gbDÚe
 = 1;

77722  
	gpR‘
;

77728 
vdbeInüBgPÝuÏ‹
(
InüM”g”
 *
pInü
){

77729 *
	gp
 = (*)
pInü
;

77730 
as£¹
Ð
pInü
->
bU£Th»ad
 );

77731  
vdbeSÜ‹rC»©eTh»ad
(
pInü
->
pTask
, 
vdbeInüPÝuÏ‹Th»ad
, 
p
);

77752 
vdbeInüSw­
(
InüM”g”
 *
pInü
){

77753 
	grc
 = 
SQLITE_OK
;

77755 #ià
SQLITE_MAX_WORKER_THREADS
>0

77756 ifÐ
	gpInü
->
	gbU£Th»ad
 ){

77757 
	grc
 = 
vdbeSÜ‹rJošTh»ad
(
pInü
->
pTask
);

77759 ifÐ
	grc
==
SQLITE_OK
 ){

77760 
SÜ‹rFže
 
f0
 = 
pInü
->
aFže
[0];

77761 
	gpInü
->
	gaFže
[0] = 
pInü
->
aFže
[1];

77762 
	gpInü
->
	gaFže
[1] = 
f0
;

77765 ifÐ
	grc
==
SQLITE_OK
 ){

77766 ifÐ
pInü
->
aFže
[0].
iEof
=õInü->
iS¹Off
 ){

77767 
pInü
->
bEof
 = 1;

77769 
	grc
 = 
vdbeInüBgPÝuÏ‹
(
pInü
);

77775 
	grc
 = 
vdbeInüPÝuÏ‹
(
pInü
);

77776 
	gpInü
->
	gaFže
[0] = 
pInü
->
aFže
[1];

77777 ifÐ
	gpInü
->
	gaFže
[0].
	giEof
==
pInü
->
iS¹Off
 ){

77778 
pInü
->
bEof
 = 1;

77782  
	grc
;

77791 
vdbeInüM”g”New
(

77792 
SÜtSubsk
 *
pTask
,

77793 
M”geEngše
 *
pM”g”
,

77794 
InüM”g”
 **
µOut


77796 
	grc
 = 
SQLITE_OK
;

77797 
InüM”g”
 *
	gpInü
 = *
µOut
 = (IncrMerger*)

77798 (
sql™e3FauÉSim
(100è? 0 : 
sql™e3M®locZ”o
((*
pInü
)));

77799 ifÐ
	gpInü
 ){

77800 
	gpInü
->
	gpM”g”
 = 
pM”g”
;

77801 
	gpInü
->
	gpTask
 = 
pTask
;

77802 
	gpInü
->
	gmxSz
 = 
MAX
(
pTask
->
pSÜ‹r
->
mxKeysize
+9,pTask->pSÜ‹r->
mxPmaSize
/2);

77803 
	gpTask
->
	gfže2
.
	giEof
 +ð
pInü
->
mxSz
;

77805 
vdbeM”geEngšeF»e
(
pM”g”
);

77806 
	grc
 = 
SQLITE_NOMEM
;

77808  
	grc
;

77811 #ià
SQLITE_MAX_WORKER_THREADS
>0

77815 
vdbeInüM”g”S‘Th»ads
(
InüM”g”
 *
pInü
){

77816 
	gpInü
->
	gbU£Th»ad
 = 1;

77817 
	gpInü
->
	gpTask
->
	gfže2
.
	giEof
 -ð
pInü
->
mxSz
;

77828 
vdbeM”geEngšeCom·»
(

77829 
M”geEngše
 *
pM”g”
,

77830 
iOut


77832 
	gi1
;

77833 
	gi2
;

77834 
	giRes
;

77835 
PmaR—d”
 *
	gp1
;

77836 
PmaR—d”
 *
	gp2
;

77838 
as£¹
Ð
iOut
<
pM”g”
->
nT»e
 && iOut>0 );

77840 ifÐ
	giOut
>=(
pM”g”
->
nT»e
/2) ){

77841 
i1
 = (
iOut
 - 
pM”g”
->
nT»e
/2) * 2;

77842 
	gi2
 = 
i1
 + 1;

77844 
	gi1
 = 
pM”g”
->
aT»e
[
iOut
*2];

77845 
	gi2
 = 
pM”g”
->
aT»e
[
iOut
*2+1];

77848 
	gp1
 = &
pM”g”
->
aR—dr
[
i1
];

77849 
	gp2
 = &
pM”g”
->
aR—dr
[
i2
];

77851 ifÐ
	gp1
->
	gpFd
==0 ){

77852 
iRes
 = 
i2
;

77853 }ifÐ
	gp2
->
	gpFd
==0 ){

77854 
iRes
 = 
i1
;

77856 
	g»s
;

77857 
as£¹
Ð
pM”g”
->
pTask
->
pUÅacked
!=0 );

77858 
	g»s
 = 
vdbeSÜ‹rCom·»
(

77859 
pM”g”
->
pTask
, 
p1
->
aKey
,…1->
nKey
, 
p2
->aKey,…2->nKey

77861 ifÐ
	g»s
<=0 ){

77862 
iRes
 = 
i1
;

77864 
	giRes
 = 
i2
;

77868 
	gpM”g”
->
	gaT»e
[
iOut
] = 
iRes
;

77879 
	#INCRINIT_NORMAL
 0

	)

77880 
	#INCRINIT_TASK
 1

	)

77881 
	#INCRINIT_ROOT
 2

	)

77887 
vdbePmaR—d”InüM”geIn™
(
PmaR—d”
 *
pR—dr
, 
eMode
);

77907 
vdbeM”geEngšeIn™
(

77908 
SÜtSubsk
 *
pTask
,

77909 
M”geEngše
 *
pM”g”
,

77910 
eMode


77912 
	grc
 = 
SQLITE_OK
;

77913 
	gi
;

77914 
	gnT»e
 = 
pM”g”
->
nT»e
;

77917 
as£¹
Ð
SQLITE_MAX_WORKER_THREADS
>0 || 
eMode
==
INCRINIT_NORMAL
 );

77920 
as£¹
Ð
pM”g”
->
pTask
==0 );

77921 
	gpM”g”
->
	gpTask
 = 
pTask
;

77923 
	gi
=0; i<
	gnT»e
; i++){

77924 ifÐ
	gSQLITE_MAX_WORKER_THREADS
>0 && 
	geMode
==
INCRINIT_ROOT
 ){

77932 
rc
 = 
vdbePmaR—d”Next
(&
pM”g”
->
aR—dr
[
nT»e
-
i
-1]);

77934 
	grc
 = 
vdbePmaR—d”InüM”geIn™
(&
pM”g”
->
aR—dr
[
i
], 
INCRINIT_NORMAL
);

77936 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

77939 
	gi
=
pM”g”
->
nT»e
-1; i>0; i--){

77940 
vdbeM”geEngšeCom·»
(
pM”g”
, 
i
);

77942  
	gpTask
->
	gpUÅacked
->
	g”rCode
;

77980 
vdbePmaR—d”InüM”geIn™
(
PmaR—d”
 *
pR—dr
, 
eMode
){

77981 
	grc
 = 
SQLITE_OK
;

77982 
InüM”g”
 *
	gpInü
 = 
pR—dr
->
pInü
;

77985 
as£¹
Ð
SQLITE_MAX_WORKER_THREADS
>0 || 
eMode
==
INCRINIT_NORMAL
 );

77987 ifÐ
	gpInü
 ){

77988 
SÜtSubsk
 *
	gpTask
 = 
pInü
->
pTask
;

77989 
sql™e3
 *
	gdb
 = 
pTask
->
pSÜ‹r
->
db
;

77991 
	grc
 = 
vdbeM”geEngšeIn™
(
pTask
, 
pInü
->
pM”g”
, 
eMode
);

77996 ifÐ
	grc
==
SQLITE_OK
 ){

77997 
mxSz
 = 
pInü
->mxSz;

77998 #ià
SQLITE_MAX_WORKER_THREADS
>0

77999 ifÐ
	gpInü
->
	gbU£Th»ad
 ){

78000 
	grc
 = 
vdbeSÜ‹rO³nTempFže
(
db
, 
mxSz
, &
pInü
->
aFže
[0].
pFd
);

78001 ifÐ
	grc
==
SQLITE_OK
 ){

78002 
rc
 = 
vdbeSÜ‹rO³nTempFže
(
db
, 
mxSz
, &
pInü
->
aFže
[1].
pFd
);

78007 ifÐ
	gpTask
->
	gfže2
.
	gpFd
==0 ){

78008 
as£¹
Ð
pTask
->
fže2
.
iEof
>0 );

78009 
	grc
 = 
vdbeSÜ‹rO³nTempFže
(
db
, 
pTask
->
fže2
.
iEof
, &pTask->fže2.
pFd
);

78010 
	gpTask
->
	gfže2
.
	giEof
 = 0;

78012 ifÐ
	grc
==
SQLITE_OK
 ){

78013 
pInü
->
aFže
[1].
pFd
 = 
pTask
->
fže2
.pFd;

78014 
	gpInü
->
	giS¹Off
 = 
pTask
->
fže2
.
iEof
;

78015 
	gpTask
->
	gfže2
.
	giEof
 +ð
mxSz
;

78020 #ià
SQLITE_MAX_WORKER_THREADS
>0

78021 ifÐ
	grc
==
SQLITE_OK
 && 
pInü
->
bU£Th»ad
 ){

78025 
as£¹
Ð
eMode
==
INCRINIT_ROOT
 ||ƒMode==
INCRINIT_TASK
 );

78026 
	grc
 = 
vdbeInüPÝuÏ‹
(
pInü
);

78030 ifÐ
	grc
==
SQLITE_OK


78031 && (
SQLITE_MAX_WORKER_THREADS
==0 || 
eMode
!=
INCRINIT_TASK
)

78033 
rc
 = 
vdbePmaR—d”Next
(
pR—dr
);

78036  
	grc
;

78039 #ià
SQLITE_MAX_WORKER_THREADS
>0

78044 *
vdbePmaR—d”BgIn™
(*
pCtx
){

78045 
PmaR—d”
 *
	gpR—d”
 = (PmaR—d”*)
pCtx
;

78046 *
	gpR‘
 = 
SQLITE_INT_TO_PTR
(

78047 
vdbePmaR—d”InüM”geIn™
(
pR—d”
,
INCRINIT_TASK
)

78049 
	gpR—d”
->
	gpInü
->
	gpTask
->
	gbDÚe
 = 1;

78050  
	gpR‘
;

78061 
vdbePmaR—d”BgInüIn™
(
PmaR—d”
 *
pR—dr
){

78062 *
	gpCtx
 = (*)
pR—dr
;

78063  
vdbeSÜ‹rC»©eTh»ad
(
pR—dr
->
pInü
->
pTask
, 
vdbePmaR—d”BgIn™
, 
pCtx
);

78079 
vdbeM”geEngšeLev–0
(

78080 
SÜtSubsk
 *
pTask
,

78081 
nPMA
,

78082 
i64
 *
piOff£t
,

78083 
M”geEngše
 **
µOut


78085 
M”geEngše
 *
	gpNew
;

78086 
i64
 
	giOff
 = *
piOff£t
;

78087 
	gi
;

78088 
	grc
 = 
SQLITE_OK
;

78090 *
	gµOut
 = 
pNew
 = 
vdbeM”geEngšeNew
(
nPMA
);

78091 ifÐ
	gpNew
==0 ) 
rc
 = 
SQLITE_NOMEM
;

78093 
	gi
=0; i<
	gnPMA
 && 
	grc
==
SQLITE_OK
; i++){

78094 
i64
 
	gnDummy
;

78095 
PmaR—d”
 *
	gpR—dr
 = &
pNew
->
aR—dr
[
i
];

78096 
	grc
 = 
vdbePmaR—d”In™
(
pTask
, &pTask->
fže
, 
iOff
, 
pR—dr
, &
nDummy
);

78097 
	giOff
 = 
pR—dr
->
iEof
;

78100 ifÐ
	grc
!=
SQLITE_OK
 ){

78101 
vdbeM”geEngšeF»e
(
pNew
);

78102 *
	gµOut
 = 0;

78104 *
	gpiOff£t
 = 
iOff
;

78105  
	grc
;

78118 
vdbeSÜ‹rT»eD•th
(
nPMA
){

78119 
	gnD•th
 = 0;

78120 
i64
 
	gnDiv
 = 
SORTER_MAX_MERGE_COUNT
;

78121  
	gnDiv
 < (
	gi64
)
	gnPMA
 ){

78122 
	gnDiv
 = 
nDiv
 * 
SORTER_MAX_MERGE_COUNT
;

78123 
	gnD•th
++;

78125  
	gnD•th
;

78136 
vdbeSÜ‹rAddToT»e
(

78137 
SÜtSubsk
 *
pTask
,

78138 
nD•th
,

78139 
iSeq
,

78140 
M”geEngše
 *
pRoÙ
,

78141 
M”geEngše
 *
pL—f


78143 
	grc
 = 
SQLITE_OK
;

78144 
	gnDiv
 = 1;

78145 
	gi
;

78146 
M”geEngše
 *
	gp
 = 
pRoÙ
;

78147 
InüM”g”
 *
	gpInü
;

78149 
	grc
 = 
vdbeInüM”g”New
(
pTask
, 
pL—f
, &
pInü
);

78151 
	gi
=1; i<
	gnD•th
; i++){

78152 
	gnDiv
 = 
nDiv
 * 
SORTER_MAX_MERGE_COUNT
;

78155 
	gi
=1; i<
	gnD•th
 && 
	grc
==
SQLITE_OK
; i++){

78156 
	giI‹r
 = (
iSeq
 / 
nDiv
è% 
SORTER_MAX_MERGE_COUNT
;

78157 
PmaR—d”
 *
	gpR—dr
 = &
p
->
aR—dr
[
iI‹r
];

78159 ifÐ
	gpR—dr
->
	gpInü
==0 ){

78160 
M”geEngše
 *
pNew
 = 
vdbeM”geEngšeNew
(
SORTER_MAX_MERGE_COUNT
);

78161 ifÐ
	gpNew
==0 ){

78162 
rc
 = 
SQLITE_NOMEM
;

78164 
	grc
 = 
vdbeInüM”g”New
(
pTask
, 
pNew
, &
pR—dr
->
pInü
);

78167 ifÐ
	grc
==
SQLITE_OK
 ){

78168 
p
 = 
pR—dr
->
pInü
->
pM”g”
;

78169 
	gnDiv
 = 
nDiv
 / 
SORTER_MAX_MERGE_COUNT
;

78173 ifÐ
	grc
==
SQLITE_OK
 ){

78174 
p
->
aR—dr
[
iSeq
 % 
SORTER_MAX_MERGE_COUNT
].
pInü
 =…Incr;

78176 
vdbeInüF»e
(
pInü
);

78178  
	grc
;

78192 
vdbeSÜ‹rM”geT»eBužd
(

78193 
VdbeSÜ‹r
 *
pSÜ‹r
,

78194 
M”geEngše
 **
µOut


78196 
M”geEngše
 *
	gpMaš
 = 0;

78197 
	grc
 = 
SQLITE_OK
;

78198 
	giTask
;

78200 #ià
SQLITE_MAX_WORKER_THREADS
>0

78204 
as£¹
Ð
pSÜ‹r
->
bU£Th»ads
 ||…SÜ‹r->
nTask
==1 );

78205 ifÐ
	gpSÜ‹r
->
	gnTask
>1 ){

78206 
	gpMaš
 = 
vdbeM”geEngšeNew
(
pSÜ‹r
->
nTask
);

78207 ifÐ
	gpMaš
==0 ) 
rc
 = 
SQLITE_NOMEM
;

78211 
	giTask
=0; 
	grc
==
SQLITE_OK
 && 
iTask
<
pSÜ‹r
->
nTask
; iTask++){

78212 
SÜtSubsk
 *
	gpTask
 = &
pSÜ‹r
->
aTask
[
iTask
];

78213 
as£¹
Ð
pTask
->
nPMA
>0 || 
SQLITE_MAX_WORKER_THREADS
>0 );

78214 ifÐ
	gSQLITE_MAX_WORKER_THREADS
==0 || 
pTask
->
nPMA
 ){

78215 
M”geEngše
 *
pRoÙ
 = 0;

78216 
	gnD•th
 = 
vdbeSÜ‹rT»eD•th
(
pTask
->
nPMA
);

78217 
i64
 
	giR—dOff
 = 0;

78219 ifÐ
	gpTask
->
	gnPMA
<=
SORTER_MAX_MERGE_COUNT
 ){

78220 
rc
 = 
vdbeM”geEngšeLev–0
(
pTask
,…Task->
nPMA
, &
iR—dOff
, &
pRoÙ
);

78222 
	gi
;

78223 
	giSeq
 = 0;

78224 
	gpRoÙ
 = 
vdbeM”geEngšeNew
(
SORTER_MAX_MERGE_COUNT
);

78225 ifÐ
	gpRoÙ
==0 ) 
rc
 = 
SQLITE_NOMEM
;

78226 
	gi
=0; i<
	gpTask
->
	gnPMA
 && 
	grc
==
SQLITE_OK
; i +ð
SORTER_MAX_MERGE_COUNT
){

78227 
M”geEngše
 *
pM”g”
 = 0;

78228 
	gnR—d”
;

78230 
	gnR—d”
 = 
MIN
(
pTask
->
nPMA
 - 
i
, 
SORTER_MAX_MERGE_COUNT
);

78231 
	grc
 = 
vdbeM”geEngšeLev–0
(
pTask
, 
nR—d”
, &
iR—dOff
, &
pM”g”
);

78232 ifÐ
	grc
==
SQLITE_OK
 ){

78233 
rc
 = 
vdbeSÜ‹rAddToT»e
(
pTask
, 
nD•th
, 
iSeq
++, 
pRoÙ
, 
pM”g”
);

78238 ifÐ
	grc
==
SQLITE_OK
 ){

78239 #ià
SQLITE_MAX_WORKER_THREADS
>0

78240 ifÐ
pMaš
!=0 ){

78241 
rc
 = 
vdbeInüM”g”New
(
pTask
, 
pRoÙ
, &
pMaš
->
aR—dr
[
iTask
].
pInü
);

78245 
as£¹
Ð
pMaš
==0 );

78246 
	gpMaš
 = 
pRoÙ
;

78249 
vdbeM”geEngšeF»e
(
pRoÙ
);

78254 ifÐ
	grc
!=
SQLITE_OK
 ){

78255 
vdbeM”geEngšeF»e
(
pMaš
);

78256 
	gpMaš
 = 0;

78258 *
	gµOut
 = 
pMaš
;

78259  
	grc
;

78271 
vdbeSÜ‹rS‘upM”ge
(
VdbeSÜ‹r
 *
pSÜ‹r
){

78272 
	grc
;

78273 
SÜtSubsk
 *
	gpTask0
 = &
pSÜ‹r
->
aTask
[0];

78274 
M”geEngše
 *
	gpMaš
 = 0;

78275 #ià
SQLITE_MAX_WORKER_THREADS


78276 
sql™e3
 *
	gdb
 = 
pTask0
->
pSÜ‹r
->
db
;

78279 
	grc
 = 
vdbeSÜ‹rM”geT»eBužd
(
pSÜ‹r
, &
pMaš
);

78280 ifÐ
	grc
==
SQLITE_OK
 ){

78281 #ià
SQLITE_MAX_WORKER_THREADS


78282 
as£¹
Ð
pSÜ‹r
->
bU£Th»ads
==0 ||…SÜ‹r->
nTask
>1 );

78283 ifÐ
	gpSÜ‹r
->
	gbU£Th»ads
 ){

78284 
	giTask
;

78285 
PmaR—d”
 *
	gpR—dr
 = 0;

78286 
SÜtSubsk
 *
	gpLa¡
 = &
pSÜ‹r
->
aTask
[pSÜ‹r->
nTask
-1];

78287 
	grc
 = 
vdbeSÜtAÎocUÅacked
(
pLa¡
);

78288 ifÐ
	grc
==
SQLITE_OK
 ){

78289 
pR—dr
 = (
PmaR—d”
*)
sql™e3DbM®locZ”o
(
db
, (PmaReader));

78290 
	gpSÜ‹r
->
	gpR—d”
 = 
pR—dr
;

78291 ifÐ
	gpR—dr
==0 ) 
rc
 = 
SQLITE_NOMEM
;

78293 ifÐ
	grc
==
SQLITE_OK
 ){

78294 
rc
 = 
vdbeInüM”g”New
(
pLa¡
, 
pMaš
, &
pR—dr
->
pInü
);

78295 ifÐ
	grc
==
SQLITE_OK
 ){

78296 
vdbeInüM”g”S‘Th»ads
(
pR—dr
->
pInü
);

78297 
	giTask
=0; iTask<(
	gpSÜ‹r
->
	gnTask
-1); iTask++){

78298 
InüM”g”
 *
	gpInü
;

78299 ifÐ(
	gpInü
 = 
pMaš
->
aR—dr
[
iTask
].
pInü
) ){

78300 
vdbeInüM”g”S‘Th»ads
(
pInü
);

78301 
as£¹
Ð
pInü
->
pTask
!=
pLa¡
 );

78304 
	giTask
=0; 
	grc
==
SQLITE_OK
 && 
iTask
<
pSÜ‹r
->
nTask
; iTask++){

78305 
PmaR—d”
 *
	gp
 = &
pMaš
->
aR—dr
[
iTask
];

78306 
as£¹
Ð
p
->
pInü
==0 ||…->pInü->
pTask
==&
pSÜ‹r
->
aTask
[
iTask
] );

78307 ifÐ
	gp
->
	gpInü
 ){

78308 ifÐ
	giTask
==
pSÜ‹r
->
nTask
-1 ){

78309 
rc
 = 
vdbePmaR—d”InüM”geIn™
(
p
, 
INCRINIT_TASK
);

78311 
	grc
 = 
vdbePmaR—d”BgInüIn™
(
p
);

78316 
	gpMaš
 = 0;

78318 ifÐ
	grc
==
SQLITE_OK
 ){

78319 
rc
 = 
vdbePmaR—d”InüM”geIn™
(
pR—dr
, 
INCRINIT_ROOT
);

78324 
	grc
 = 
vdbeM”geEngšeIn™
(
pTask0
, 
pMaš
, 
INCRINIT_NORMAL
);

78325 
	gpSÜ‹r
->
	gpM”g”
 = 
pMaš
;

78326 
	gpMaš
 = 0;

78330 ifÐ
	grc
!=
SQLITE_OK
 ){

78331 
vdbeM”geEngšeF»e
(
pMaš
);

78333  
	grc
;

78342 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRewšd
(cÚ¡ 
VdbeCursÜ
 *
pC¤
, *
pbEof
){

78343 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

78344 
	grc
 = 
SQLITE_OK
;

78346 
as£¹
Ð
pSÜ‹r
 );

78351 ifÐ
	gpSÜ‹r
->
	gbU£PMA
==0 ){

78352 ifÐ
pSÜ‹r
->
li¡
.
pLi¡
 ){

78353 *
pbEof
 = 0;

78354 
	grc
 = 
vdbeSÜ‹rSÜt
(&
pSÜ‹r
->
aTask
[0], &pSÜ‹r->
li¡
);

78356 *
	gpbEof
 = 1;

78358  
	grc
;

78365 
as£¹
Ð
pSÜ‹r
->
li¡
.
pLi¡
 );

78366 
	grc
 = 
vdbeSÜ‹rFlushPMA
(
pSÜ‹r
);

78369 
	grc
 = 
vdbeSÜ‹rJošAÎ
(
pSÜ‹r
, 
rc
);

78371 
vdbeSÜ‹rRewšdDebug
("rewind");

78375 
as£¹
Ð
pSÜ‹r
->
pR—d”
==0 );

78376 ifÐ
	grc
==
SQLITE_OK
 ){

78377 
rc
 = 
vdbeSÜ‹rS‘upM”ge
(
pSÜ‹r
);

78378 *
	gpbEof
 = 0;

78381 
vdbeSÜ‹rRewšdDebug
("rewinddone");

78382  
	grc
;

78388 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rNext
(
sql™e3
 *
db
, cÚ¡ 
VdbeCursÜ
 *
pC¤
, *
pbEof
){

78389 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

78390 
	grc
;

78392 
as£¹
Ð
pSÜ‹r
->
bU£PMA
 || (pSÜ‹r->
pR—d”
==0 &&…SÜ‹r->
pM”g”
==0) );

78393 ifÐ
	gpSÜ‹r
->
	gbU£PMA
 ){

78394 
as£¹
Ð
pSÜ‹r
->
pR—d”
==0 ||…SÜ‹r->
pM”g”
==0 );

78395 
as£¹
Ð
pSÜ‹r
->
bU£Th»ads
==0 ||…SÜ‹r->
pR—d”
 );

78396 
as£¹
Ð
pSÜ‹r
->
bU£Th»ads
==1 ||…SÜ‹r->
pM”g”
 );

78397 #ià
SQLITE_MAX_WORKER_THREADS
>0

78398 ifÐ
	gpSÜ‹r
->
	gbU£Th»ads
 ){

78399 
	grc
 = 
vdbePmaR—d”Next
(
pSÜ‹r
->
pR—d”
);

78400 *
	gpbEof
 = (
pSÜ‹r
->
pR—d”
->
pFd
==0);

78404 
as£¹
Ð
pSÜ‹r
->
pM”g”
->
pTask
==(&pSÜ‹r->
aTask
[0]) );

78405 
	grc
 = 
vdbeM”geEngšeS‹p
(
pSÜ‹r
->
pM”g”
, 
pbEof
);

78408 
SÜ‹rRecÜd
 *
	gpF»e
 = 
pSÜ‹r
->
li¡
.
pLi¡
;

78409 
	gpSÜ‹r
->
	gli¡
.
	gpLi¡
 = 
pF»e
->
u
.
pNext
;

78410 
	gpF»e
->
	gu
.
	gpNext
 = 0;

78411 ifÐ
	gpSÜ‹r
->
	gli¡
.
	gaMemÜy
==0 ) 
vdbeSÜ‹rRecÜdF»e
(
db
, 
pF»e
);

78412 *
	gpbEof
 = !
pSÜ‹r
->
li¡
.
pLi¡
;

78413 
	grc
 = 
SQLITE_OK
;

78415  
	grc
;

78422 *
vdbeSÜ‹rRowkey
(

78423 cÚ¡ 
VdbeSÜ‹r
 *
pSÜ‹r
,

78424 *
²Key


78426 *
	gpKey
;

78427 ifÐ
	gpSÜ‹r
->
	gbU£PMA
 ){

78428 
PmaR—d”
 *
	gpR—d”
;

78429 #ià
SQLITE_MAX_WORKER_THREADS
>0

78430 ifÐ
	gpSÜ‹r
->
	gbU£Th»ads
 ){

78431 
	gpR—d”
 = 
pSÜ‹r
->
pR—d”
;

78435 
	gpR—d”
 = &
pSÜ‹r
->
pM”g”
->
aR—dr
[pSÜ‹r->pM”g”->
aT»e
[1]];

78437 *
	g²Key
 = 
pR—d”
->
nKey
;

78438 
	gpKey
 = 
pR—d”
->
aKey
;

78440 *
	g²Key
 = 
pSÜ‹r
->
li¡
.
pLi¡
->
nV®
;

78441 
	gpKey
 = 
SRVAL
(
pSÜ‹r
->
li¡
.
pLi¡
);

78443  
	gpKey
;

78449 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rRowkey
(cÚ¡ 
VdbeCursÜ
 *
pC¤
, 
Mem
 *
pOut
){

78450 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

78451 *
	gpKey
; 
	gnKey
;

78453 
	gpKey
 = 
vdbeSÜ‹rRowkey
(
pSÜ‹r
, &
nKey
);

78454 ifÐ
sql™e3VdbeMemCË¬AndResize
(
pOut
, 
nKey
) ){

78455  
	gSQLITE_NOMEM
;

78457 
	gpOut
->
	gn
 = 
nKey
;

78458 
MemS‘Ty³FÏg
(
pOut
, 
MEM_Blob
);

78459 
memýy
(
pOut
->
z
, 
pKey
, 
nKey
);

78461  
	gSQLITE_OK
;

78480 
SQLITE_PRIVATE
 
sql™e3VdbeSÜ‹rCom·»
(

78481 cÚ¡ 
VdbeCursÜ
 *
pC¤
,

78482 
Mem
 *
pV®
,

78483 
nKeyCÞ
,

78484 *
pRes


78486 
VdbeSÜ‹r
 *
	gpSÜ‹r
 = 
pC¤
->
pSÜ‹r
;

78487 
UÅackedRecÜd
 *
	gr2
 = 
pSÜ‹r
->
pUÅacked
;

78488 
KeyInfo
 *
	gpKeyInfo
 = 
pC¤
->
pKeyInfo
;

78489 
	gi
;

78490 *
	gpKey
; 
	gnKey
;

78492 ifÐ
	gr2
==0 ){

78493 *
p
;

78494 
	gr2
 = 
pSÜ‹r
->
pUÅacked
 = 
sql™e3VdbeAÎocUÅackedRecÜd
(
pKeyInfo
,0,0,&
p
);

78495 
as£¹
Ð
pSÜ‹r
->
pUÅacked
==(
UÅackedRecÜd
*)
p
 );

78496 ifÐ
	gr2
==0 )  
SQLITE_NOMEM
;

78497 
	gr2
->
	gnF›ld
 = 
nKeyCÞ
;

78499 
as£¹
Ð
r2
->
nF›ld
==
nKeyCÞ
 );

78501 
	gpKey
 = 
vdbeSÜ‹rRowkey
(
pSÜ‹r
, &
nKey
);

78502 
sql™e3VdbeRecÜdUÅack
(
pKeyInfo
, 
nKey
, 
pKey
, 
r2
);

78503 
	gi
=0; i<
	gnKeyCÞ
; i++){

78504 ifÐ
	gr2
->
	gaMem
[
i
].
	gæags
 & 
	gMEM_NuÎ
 ){

78505 *
	gpRes
 = -1;

78506  
	gSQLITE_OK
;

78510 *
	gpRes
 = 
sql™e3VdbeRecÜdCom·»
(
pV®
->
n
,…V®->
z
, 
r2
);

78511  
	gSQLITE_OK
;

78542 #ifdeà
SQLITE_ENABLE_ATOMIC_WRITE


78549 
	sJouº®Fže
 {

78550 
sql™e3_io_m‘hods
 *
	gpM‘hod
;

78551 
	gnBuf
;

78552 *
	gzBuf
;

78553 
	giSize
;

78554 
	gæags
;

78555 
sql™e3_vfs
 *
	gpVfs
;

78556 
sql™e3_fže
 *
	gpR—l
;

78557 cÚ¡ *
	gzJouº®
;

78559 
Jouº®Fže
 
	tJouº®Fže
;

78565 
ü—‹Fže
(
Jouº®Fže
 *
p
){

78566 
	grc
 = 
SQLITE_OK
;

78567 ifÐ!
	gp
->
	gpR—l
 ){

78568 
sql™e3_fže
 *
	gpR—l
 = (sql™e3_fž*)&
p
[1];

78569 
	grc
 = 
sql™e3OsO³n
(
p
->
pVfs
,…->
zJouº®
, 
pR—l
,…->
æags
, 0);

78570 ifÐ
	grc
==
SQLITE_OK
 ){

78571 
p
->
pR—l
 =…Real;

78572 ifÐ
	gp
->
	giSize
>0 ){

78573 
as£¹
(
p
->
iSize
<õ->
nBuf
);

78574 
	grc
 = 
sql™e3OsWr™e
(
p
->
pR—l
,…->
zBuf
,…->
iSize
, 0);

78576 ifÐ
	grc
!=
SQLITE_OK
 ){

78581 
sql™e3OsClo£
(
pR—l
);

78582 
	gp
->
	gpR—l
 = 0;

78586  
	grc
;

78592 
jºlClo£
(
sql™e3_fže
 *
pJfd
){

78593 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78594 ifÐ
	gp
->
	gpR—l
 ){

78595 
sql™e3OsClo£
(
p
->
pR—l
);

78597 
sql™e3_ä“
(
p
->
zBuf
);

78598  
	gSQLITE_OK
;

78604 
jºlR—d
(

78605 
sql™e3_fže
 *
pJfd
,

78606 *
zBuf
,

78607 
iAmt
,

78608 
sql™e_št64
 
iOf¡


78610 
	grc
 = 
SQLITE_OK
;

78611 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78612 ifÐ
	gp
->
	gpR—l
 ){

78613 
	grc
 = 
sql™e3OsR—d
(
p
->
pR—l
, 
zBuf
, 
iAmt
, 
iOf¡
);

78614 }ifÐ(
	giAmt
+
	giOf¡
)>
	gp
->
	giSize
 ){

78615 
	grc
 = 
SQLITE_IOERR_SHORT_READ
;

78617 
memýy
(
zBuf
, &
p
->zBuf[
iOf¡
], 
iAmt
);

78619  
	grc
;

78625 
jºlWr™e
(

78626 
sql™e3_fže
 *
pJfd
,

78627 cÚ¡ *
zBuf
,

78628 
iAmt
,

78629 
sql™e_št64
 
iOf¡


78631 
	grc
 = 
SQLITE_OK
;

78632 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78633 ifÐ!
	gp
->
	gpR—l
 && (
	giOf¡
+
	giAmt
)>p->
	gnBuf
 ){

78634 
	grc
 = 
ü—‹Fže
(
p
);

78636 ifÐ
	grc
==
SQLITE_OK
 ){

78637 ifÐ
p
->
pR—l
 ){

78638 
rc
 = 
sql™e3OsWr™e
(
p
->
pR—l
, 
zBuf
, 
iAmt
, 
iOf¡
);

78640 
memýy
(&
p
->
zBuf
[
iOf¡
], zBuf, 
iAmt
);

78641 ifÐ
	gp
->
	giSize
<(
	giOf¡
+
	giAmt
) ){

78642 
	gp
->
	giSize
 = (
iOf¡
+
iAmt
);

78646  
	grc
;

78652 
jºlTrunÿ‹
(
sql™e3_fže
 *
pJfd
, 
sql™e_št64
 
size
){

78653 
	grc
 = 
SQLITE_OK
;

78654 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78655 ifÐ
	gp
->
	gpR—l
 ){

78656 
	grc
 = 
sql™e3OsTrunÿ‹
(
p
->
pR—l
, 
size
);

78657 }ifÐ
	gsize
<
	gp
->
	giSize
 ){

78658 
	gp
->
	giSize
 = 
size
;

78660  
	grc
;

78666 
jºlSync
(
sql™e3_fže
 *
pJfd
, 
æags
){

78667 
	grc
;

78668 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78669 ifÐ
	gp
->
	gpR—l
 ){

78670 
	grc
 = 
sql™e3OsSync
(
p
->
pR—l
, 
æags
);

78672 
	grc
 = 
SQLITE_OK
;

78674  
	grc
;

78680 
jºlFžeSize
(
sql™e3_fže
 *
pJfd
, 
sql™e_št64
 *
pSize
){

78681 
	grc
 = 
SQLITE_OK
;

78682 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78683 ifÐ
	gp
->
	gpR—l
 ){

78684 
	grc
 = 
sql™e3OsFžeSize
(
p
->
pR—l
, 
pSize
);

78686 *
	gpSize
 = (
sql™e_št64
è
p
->
iSize
;

78688  
	grc
;

78694 
sql™e3_io_m‘hods
 
	gJouº®FžeM‘hods
 = {

78696 
jºlClo£
,

78697 
jºlR—d
,

78698 
jºlWr™e
,

78699 
jºlTrunÿ‹
,

78700 
jºlSync
,

78701 
jºlFžeSize
,

78717 
SQLITE_PRIVATE
 
sql™e3Jouº®O³n
(

78718 
sql™e3_vfs
 *
pVfs
,

78719 cÚ¡ *
zName
,

78720 
sql™e3_fže
 *
pJfd
,

78721 
æags
,

78722 
nBuf


78724 
Jouº®Fže
 *
	gp
 = (Jouº®Fž*)
pJfd
;

78725 
mem£t
(
p
, 0, 
sql™e3Jouº®Size
(
pVfs
));

78726 ifÐ
	gnBuf
>0 ){

78727 
	gp
->
	gzBuf
 = 
sql™e3M®locZ”o
(
nBuf
);

78728 ifÐ!
	gp
->
	gzBuf
 ){

78729  
	gSQLITE_NOMEM
;

78732  
sql™e3OsO³n
(
pVfs
, 
zName
, 
pJfd
, 
æags
, 0);

78734 
	gp
->
	gpM‘hod
 = &
Jouº®FžeM‘hods
;

78735 
	gp
->
	gnBuf
 = 
nBuf
;

78736 
	gp
->
	gæags
 = 
æags
;

78737 
	gp
->
	gzJouº®
 = 
zName
;

78738 
	gp
->
	gpVfs
 = 
pVfs
;

78739  
	gSQLITE_OK
;

78746 
SQLITE_PRIVATE
 
sql™e3Jouº®C»©e
(
sql™e3_fže
 *
p
){

78747 ifÐ
	gp
->
	gpM‘hods
!=&
Jouº®FžeM‘hods
 ){

78748  
SQLITE_OK
;

78750  
ü—‹Fže
((
Jouº®Fže
 *)
p
);

78759 
SQLITE_PRIVATE
 
sql™e3Jouº®Exi¡s
(
sql™e3_fže
 *
p
){

78760  (
	gp
->
	gpM‘hods
!=&
Jouº®FžeM‘hods
 || ((
Jouº®Fže
 *)
p
)->
pR—l
!=0);

78767 
SQLITE_PRIVATE
 
sql™e3Jouº®Size
(
sql™e3_vfs
 *
pVfs
){

78768  (
	gpVfs
->
	gszOsFže
+(
	gJouº®Fže
));

78792 
MemJouº®
 
	tMemJouº®
;

78793 
FžePošt
 
	tFžePošt
;

78794 
FžeChunk
 
	tFžeChunk
;

78804 
	#JOURNAL_CHUNKSIZE
 (()(1024-(
FžeChunk
*)))

	)

78809 
	sFžeChunk
 {

78810 
FžeChunk
 *
	gpNext
;

78811 
u8
 
	gzChunk
[
JOURNAL_CHUNKSIZE
];

78818 
	sFžePošt
 {

78819 
sql™e3_št64
 
	giOff£t
;

78820 
FžeChunk
 *
	gpChunk
;

78827 
	sMemJouº®
 {

78828 
sql™e3_io_m‘hods
 *
	gpM‘hod
;

78829 
FžeChunk
 *
	gpFœ¡
;

78830 
FžePošt
 
	g’dpošt
;

78831 
FžePošt
 
	g»adpošt
;

78838 
memjºlR—d
(

78839 
sql™e3_fže
 *
pJfd
,

78840 *
zBuf
,

78841 
iAmt
,

78842 
sql™e_št64
 
iOf¡


78844 
MemJouº®
 *
	gp
 = (MemJouº® *)
pJfd
;

78845 
u8
 *
	gzOut
 = 
zBuf
;

78846 
	gnR—d
 = 
iAmt
;

78847 
	giChunkOff£t
;

78848 
FžeChunk
 *
	gpChunk
;

78851 
as£¹
Ð
iOf¡
+
iAmt
<=
p
->
’dpošt
.
iOff£t
 );

78853 ifÐ
	gp
->
	g»adpošt
.
	giOff£t
!=
iOf¡
 || iOfst==0 ){

78854 
sql™e3_št64
 
iOff
 = 0;

78855 
	gpChunk
=
p
->
pFœ¡
;

78856 
ALWAYS
(
pChunk
è&& (
	giOff
+
	gJOURNAL_CHUNKSIZE
)<=
iOf¡
;

78857 
	gpChunk
=
pChunk
->
pNext


78859 
iOff
 +ð
JOURNAL_CHUNKSIZE
;

78862 
	gpChunk
 = 
p
->
»adpošt
.
pChunk
;

78865 
	giChunkOff£t
 = ()(
iOf¡
%
JOURNAL_CHUNKSIZE
);

78867 
	giS·û
 = 
JOURNAL_CHUNKSIZE
 - 
iChunkOff£t
;

78868 
	gnCÝy
 = 
MIN
(
nR—d
, (
JOURNAL_CHUNKSIZE
 - 
iChunkOff£t
));

78869 
memýy
(
zOut
, &
pChunk
->
zChunk
[
iChunkOff£t
], 
nCÝy
);

78870 
	gzOut
 +ð
nCÝy
;

78871 
	gnR—d
 -ð
iS·û
;

78872 
	giChunkOff£t
 = 0;

78873 }  
	gnR—d
>=0 && (
pChunk
õChunk->
pNext
)!=0 && 
nR—d
>0 );

78874 
	gp
->
	g»adpošt
.
	giOff£t
 = 
iOf¡
+
iAmt
;

78875 
	gp
->
	g»adpošt
.
	gpChunk
 = 
pChunk
;

78877  
	gSQLITE_OK
;

78883 
memjºlWr™e
(

78884 
sql™e3_fže
 *
pJfd
,

78885 cÚ¡ *
zBuf
,

78886 
iAmt
,

78887 
sql™e_št64
 
iOf¡


78889 
MemJouº®
 *
	gp
 = (MemJouº® *)
pJfd
;

78890 
	gnWr™e
 = 
iAmt
;

78891 
u8
 *
	gzWr™e
 = (u8 *)
zBuf
;

78896 
as£¹
Ð
iOf¡
==
p
->
’dpošt
.
iOff£t
 );

78897 
UNUSED_PARAMETER
(
iOf¡
);

78899  
	gnWr™e
>0 ){

78900 
FžeChunk
 *
	gpChunk
 = 
p
->
’dpošt
.
pChunk
;

78901 
	giChunkOff£t
 = ()(
p
->
’dpošt
.
iOff£t
%
JOURNAL_CHUNKSIZE
);

78902 
	giS·û
 = 
MIN
(
nWr™e
, 
JOURNAL_CHUNKSIZE
 - 
iChunkOff£t
);

78904 ifÐ
	giChunkOff£t
==0 ){

78906 
FžeChunk
 *
pNew
 = 
sql™e3_m®loc
((FileChunk));

78907 ifÐ!
	gpNew
 ){

78908  
	gSQLITE_IOERR_NOMEM
;

78910 
	gpNew
->
	gpNext
 = 0;

78911 ifÐ
	gpChunk
 ){

78912 
as£¹
Ð
p
->
pFœ¡
 );

78913 
	gpChunk
->
	gpNext
 = 
pNew
;

78915 
as£¹
Ð!
p
->
pFœ¡
 );

78916 
	gp
->
	gpFœ¡
 = 
pNew
;

78918 
	gp
->
	g’dpošt
.
	gpChunk
 = 
pNew
;

78921 
memýy
(&
p
->
’dpošt
.
pChunk
->
zChunk
[
iChunkOff£t
], 
zWr™e
, 
iS·û
);

78922 
	gzWr™e
 +ð
iS·û
;

78923 
	gnWr™e
 -ð
iS·û
;

78924 
	gp
->
	g’dpošt
.
	giOff£t
 +ð
iS·û
;

78927  
	gSQLITE_OK
;

78933 
memjºlTrunÿ‹
(
sql™e3_fže
 *
pJfd
, 
sql™e_št64
 
size
){

78934 
MemJouº®
 *
	gp
 = (MemJouº® *)
pJfd
;

78935 
FžeChunk
 *
	gpChunk
;

78936 
as£¹
(
size
==0);

78937 
UNUSED_PARAMETER
(
size
);

78938 
	gpChunk
 = 
p
->
pFœ¡
;

78939  
	gpChunk
 ){

78940 
FžeChunk
 *
	gpTmp
 = 
pChunk
;

78941 
	gpChunk
 = 
pChunk
->
pNext
;

78942 
sql™e3_ä“
(
pTmp
);

78944 
sql™e3MemJouº®O³n
(
pJfd
);

78945  
	gSQLITE_OK
;

78951 
memjºlClo£
(
sql™e3_fže
 *
pJfd
){

78952 
memjºlTrunÿ‹
(
pJfd
, 0);

78953  
	gSQLITE_OK
;

78965 
memjºlSync
(
sql™e3_fže
 *
NÙU£d
, 
NÙU£d2
){

78966 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

78967  
	gSQLITE_OK
;

78973 
memjºlFžeSize
(
sql™e3_fže
 *
pJfd
, 
sql™e_št64
 *
pSize
){

78974 
MemJouº®
 *
	gp
 = (MemJouº® *)
pJfd
;

78975 *
	gpSize
 = (
sql™e_št64
è
p
->
’dpošt
.
iOff£t
;

78976  
	gSQLITE_OK
;

78982 cÚ¡ 
sql™e3_io_m‘hods
 
	gMemJouº®M‘hods
 = {

78984 
memjºlClo£
,

78985 
memjºlR—d
,

78986 
memjºlWr™e
,

78987 
memjºlTrunÿ‹
,

78988 
memjºlSync
,

78989 
memjºlFžeSize
,

79007 
SQLITE_PRIVATE
 
sql™e3MemJouº®O³n
(
sql™e3_fže
 *
pJfd
){

79008 
MemJouº®
 *
	gp
 = (MemJouº® *)
pJfd
;

79009 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
p
) );

79010 
mem£t
(
p
, 0, 
sql™e3MemJouº®Size
());

79011 
	gp
->
	gpM‘hod
 = (
sql™e3_io_m‘hods
*)&
MemJouº®M‘hods
;

79018 
SQLITE_PRIVATE
 
sql™e3IsMemJouº®
(
sql™e3_fže
 *
pJfd
){

79019  
	gpJfd
->
	gpM‘hods
==&
MemJouº®M‘hods
;

79025 
SQLITE_PRIVATE
 
sql™e3MemJouº®Size
(){

79026  (
	gMemJouº®
);

79068 
SQLITE_PRIVATE
 
sql™e3W®kEx´
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

79069 
	grc
;

79070 ifÐ
	gpEx´
==0 )  
WRC_CÚtšue
;

79071 
‹¡ÿ£
Ð
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
) );

79072 
‹¡ÿ£
Ð
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Reduûd
) );

79073 
	grc
 = 
pW®k”
->
xEx´C®lback
ÕW®k”, 
pEx´
);

79074 ifÐ
	grc
==
WRC_CÚtšue


79075 && !
Ex´HasPrÝ”ty
(
pEx´
,
EP_Tok’OÆy
) ){

79076 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
pEx´
->
pLeá
èè 
	gWRC_AbÜt
;

79077 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
pEx´
->
pRight
èè 
	gWRC_AbÜt
;

79078 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

79079 ifÐ
sql™e3W®kS–eù
(
pW®k”
, 
pEx´
->
x
.
pS–eù
èè 
	gWRC_AbÜt
;

79081 ifÐ
sql™e3W®kEx´Li¡
(
pW®k”
, 
pEx´
->
x
.
pLi¡
èè 
	gWRC_AbÜt
;

79084  
	grc
 & 
	gWRC_AbÜt
;

79091 
SQLITE_PRIVATE
 
sql™e3W®kEx´Li¡
(
W®k”
 *
pW®k”
, 
Ex´Li¡
 *
p
){

79092 
	gi
;

79093 
Ex´Li¡_™em
 *
	gpI‹m
;

79094 ifÐ
	gp
 ){

79095 
	gi
=
p
->
nEx´
, 
	gpI‹m
õ->
a
; i>0; i--,…Item++){

79096 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
pI‹m
->
pEx´
èè 
	gWRC_AbÜt
;

79099  
	gWRC_CÚtšue
;

79108 
SQLITE_PRIVATE
 
sql™e3W®kS–eùEx´
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

79109 ifÐ
sql™e3W®kEx´Li¡
(
pW®k”
, 
p
->
pELi¡
èè 
	gWRC_AbÜt
;

79110 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
p
->
pWh”e
èè 
	gWRC_AbÜt
;

79111 ifÐ
sql™e3W®kEx´Li¡
(
pW®k”
, 
p
->
pGroupBy
èè 
	gWRC_AbÜt
;

79112 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
p
->
pHavšg
èè 
	gWRC_AbÜt
;

79113 ifÐ
sql™e3W®kEx´Li¡
(
pW®k”
, 
p
->
pOrd”By
èè 
	gWRC_AbÜt
;

79114 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
p
->
pLim™
èè 
	gWRC_AbÜt
;

79115 ifÐ
sql™e3W®kEx´
(
pW®k”
, 
p
->
pOff£t
èè 
	gWRC_AbÜt
;

79116  
	gWRC_CÚtšue
;

79126 
SQLITE_PRIVATE
 
sql™e3W®kS–eùFrom
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

79127 
SrcLi¡
 *
	gpSrc
;

79128 
	gi
;

79129 
SrcLi¡_™em
 *
	gpI‹m
;

79131 
	gpSrc
 = 
p
->
pSrc
;

79132 ifÐ
ALWAYS
(
pSrc
) ){

79133 
	gi
=
pSrc
->
nSrc
, 
	gpI‹m
õSrc->
a
; i>0; i--,…Item++){

79134 ifÐ
sql™e3W®kS–eù
(
pW®k”
, 
pI‹m
->
pS–eù
) ){

79135  
	gWRC_AbÜt
;

79139  
	gWRC_CÚtšue
;

79158 
SQLITE_PRIVATE
 
sql™e3W®kS–eù
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

79159 
	grc
;

79160 ifÐ
	gp
==0 || (
pW®k”
->
xS–eùC®lback
==0 &&…W®k”->
xS–eùC®lback2
==0) ){

79161  
WRC_CÚtšue
;

79163 
	grc
 = 
WRC_CÚtšue
;

79164 
	gpW®k”
->
	gw®k”D•th
++;

79165  
	gp
 ){

79166 ifÐ
	gpW®k”
->
	gxS–eùC®lback
 ){

79167 
	grc
 = 
pW®k”
->
xS–eùC®lback
ÕW®k”, 
p
);

79168 ifÐ
	grc
 ) ;

79170 ifÐ
sql™e3W®kS–eùEx´
(
pW®k”
, 
p
)

79171 || 
sql™e3W®kS–eùFrom
(
pW®k”
, 
p
)

79173 
	gpW®k”
->
	gw®k”D•th
--;

79174  
	gWRC_AbÜt
;

79176 ifÐ
	gpW®k”
->
	gxS–eùC®lback2
 ){

79177 
	gpW®k”
->
xS–eùC®lback2
(
pW®k”
, 
p
);

79179 
	gp
 = 
p
->
pPriÜ
;

79181 
	gpW®k”
->
	gw®k”D•th
--;

79182  
	grc
 & 
	gWRC_AbÜt
;

79215 
šüAggD•th
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

79216 ifÐ
	gpEx´
->
	gÝ
==
TK_AGG_FUNCTION
 ) 
pEx´
->
Ý2
 +ð
pW®k”
->
u
.
i
;

79217  
	gWRC_CÚtšue
;

79219 
šüAggFunùiÚD•th
(
Ex´
 *
pEx´
, 
N
){

79220 ifÐ
	gN
>0 ){

79221 
W®k”
 
	gw
;

79222 
mem£t
(&
w
, 0, (w));

79223 
	gw
.
	gxEx´C®lback
 = 
šüAggD•th
;

79224 
	gw
.
	gu
.
	gi
 = 
N
;

79225 
sql™e3W®kEx´
(&
w
, 
pEx´
);

79272 
»sÞveAlŸs
(

79273 
P¬£
 *
pP¬£
,

79274 
Ex´Li¡
 *
pELi¡
,

79275 
iCÞ
,

79276 
Ex´
 *
pEx´
,

79277 cÚ¡ *
zTy³
,

79278 
nSubqu”y


79280 
Ex´
 *
	gpOrig
;

79281 
Ex´
 *
	gpDup
;

79282 
sql™e3
 *
	gdb
;

79284 
as£¹
Ð
iCÞ
>=0 && iCÞ<
pELi¡
->
nEx´
 );

79285 
	gpOrig
 = 
pELi¡
->
a
[
iCÞ
].
pEx´
;

79286 
as£¹
Ð
pOrig
!=0 );

79287 
as£¹
Ð
pOrig
->
æags
 & 
EP_ResÞved
 );

79288 
	gdb
 = 
pP¬£
->
db
;

79289 
	gpDup
 = 
sql™e3Ex´Dup
(
db
, 
pOrig
, 0);

79290 ifÐ
	gpDup
==0 ) ;

79291 ifÐ
	gpOrig
->
	gÝ
!=
TK_COLUMN
 && 
zTy³
[0]!='G' ){

79292 
šüAggFunùiÚD•th
(
pDup
, 
nSubqu”y
);

79293 
	gpDup
 = 
sql™e3PEx´
(
pP¬£
, 
TK_AS
, 
pDup
, 0, 0);

79294 ifÐ
	gpDup
==0 ) ;

79295 
Ex´S‘PrÝ”ty
(
pDup
, 
EP_Sk
);

79296 ifÐ
	gpELi¡
->
	ga
[
iCÞ
].
	gu
.
	gx
.
	giAlŸs
==0 ){

79297 
pELi¡
->
a
[
iCÞ
].
u
.
x
.
iAlŸs
 = (
u16
)(++
pP¬£
->
nAlŸs
);

79299 
	gpDup
->
	giTabË
 = 
pELi¡
->
a
[
iCÞ
].
u
.
x
.
iAlŸs
;

79301 ifÐ
	gpEx´
->
	gÝ
==
TK_COLLATE
 ){

79302 
pDup
 = 
sql™e3Ex´AddCÞÏ‹SŒšg
(
pP¬£
,…Dup, 
pEx´
->
u
.
zTok’
);

79312 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_Stic
);

79313 
sql™e3Ex´D–‘e
(
db
, 
pEx´
);

79314 
memýy
(
pEx´
, 
pDup
, (*pExpr));

79315 ifÐ!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
è&& 
	gpEx´
->
	gu
.
	gzTok’
!=0 ){

79316 
as£¹
Ð(
pEx´
->
æags
 & (
EP_Reduûd
|
EP_Tok’OÆy
))==0 );

79317 
	gpEx´
->
	gu
.
	gzTok’
 = 
sql™e3DbSŒDup
(
db
, 
pEx´
->
u
.
zTok’
);

79318 
	gpEx´
->
	gæags
 |ð
EP_MemTok’
;

79320 
sql™e3DbF»e
(
db
, 
pDup
);

79330 
ÇmeInUsšgCÏu£
(
IdLi¡
 *
pUsšg
, cÚ¡ *
zCÞ
){

79331 ifÐ
	gpUsšg
 ){

79332 
	gk
;

79333 
	gk
=0; k<
	gpUsšg
->
	gnId
; k++){

79334 ifÐ
sql™e3SŒICmp
(
pUsšg
->
a
[
k
].
zName
, 
zCÞ
)==0 )  1;

79347 
SQLITE_PRIVATE
 
sql™e3M©chS·nName
(

79348 cÚ¡ *
zS·n
,

79349 cÚ¡ *
zCÞ
,

79350 cÚ¡ *
zTab
,

79351 cÚ¡ *
zDb


79353 
	gn
;

79354 
	gn
=0; 
ALWAYS
(
zS·n
[
n
]è&& 
	gzS·n
[n]!='.';‚++){}

79355 ifÐ
	gzDb
 && (
sql™e3SŒNICmp
(
zS·n
, 
zDb
, 
n
)!=0 || zDb[n]!=0) ){

79358 
	gzS·n
 +ð
n
+1;

79359 
	gn
=0; 
ALWAYS
(
zS·n
[
n
]è&& 
	gzS·n
[n]!='.';‚++){}

79360 ifÐ
	gzTab
 && (
sql™e3SŒNICmp
(
zS·n
, 
zTab
, 
n
)!=0 || zTab[n]!=0) ){

79363 
	gzS·n
 +ð
n
+1;

79364 ifÐ
	gzCÞ
 && 
sql™e3SŒICmp
(
zS·n
, 
zCÞ
)!=0 ){

79397 
lookupName
(

79398 
P¬£
 *
pP¬£
,

79399 cÚ¡ *
zDb
,

79400 cÚ¡ *
zTab
,

79401 cÚ¡ *
zCÞ
,

79402 
NameCÚ‹xt
 *
pNC
,

79403 
Ex´
 *
pEx´


79405 
	gi
, 
	gj
;

79406 
	gút
 = 0;

79407 
	gútTab
 = 0;

79408 
	gnSubqu”y
 = 0;

79409 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

79410 
SrcLi¡_™em
 *
	gpI‹m
;

79411 
SrcLi¡_™em
 *
	gpM©ch
 = 0;

79412 
NameCÚ‹xt
 *
	gpTÝNC
 = 
pNC
;

79413 
Schema
 *
	gpSchema
 = 0;

79414 
	gisTrigg”
 = 0;

79415 
TabË
 *
	gpTab
 = 0;

79416 
CÞumn
 *
	gpCÞ
;

79418 
as£¹
Ð
pNC
 );

79419 
as£¹
Ð
zCÞ
 );

79420 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

79423 
	gpEx´
->
	giTabË
 = -1;

79424 
	gpEx´
->
	gpTab
 = 0;

79425 
Ex´S‘VVAPrÝ”ty
(
pEx´
, 
EP_NoReduû
);

79431 ifÐ
	gzDb
 ){

79432 
‹¡ÿ£
Ð
pNC
->
ncFÏgs
 & 
NC_P¬tIdx
 );

79433 
‹¡ÿ£
Ð
pNC
->
ncFÏgs
 & 
NC_IsCheck
 );

79434 ifÐ(
	gpNC
->
	gncFÏgs
 & (
	gNC_P¬tIdx
|
	gNC_IsCheck
))!=0 ){

79438 
zDb
 = 0;

79440 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

79441 
as£¹
Ð
db
->
aDb
[
i
].
zName
 );

79442 ifÐ
sql™e3SŒICmp
(
db
->
aDb
[
i
].
zName
,
zDb
)==0 ){

79443 
pSchema
 = 
db
->
aDb
[
i
].pSchema;

79451  
	gpNC
 && 
	gút
==0 ){

79452 
Ex´Li¡
 *
pELi¡
;

79453 
SrcLi¡
 *
	gpSrcLi¡
 = 
pNC
->
pSrcLi¡
;

79455 ifÐ
	gpSrcLi¡
 ){

79456 
	gi
=0, 
	gpI‹m
=
pSrcLi¡
->
a
; i<
	gpSrcLi¡
->
	gnSrc
; i++,…Item++){

79457 
	gpTab
 = 
pI‹m
->
pTab
;

79458 
as£¹
Ð
pTab
!=0 &&…Tab->
zName
!=0 );

79459 
as£¹
Ð
pTab
->
nCÞ
>0 );

79460 ifÐ
	gpI‹m
->
	gpS–eù
 && (pI‹m->pS–eù->
	g£lFÏgs
 & 
	gSF_Ne¡edFrom
)!=0 ){

79461 
h™
 = 0;

79462 
	gpELi¡
 = 
pI‹m
->
pS–eù
->
pELi¡
;

79463 
	gj
=0; j<
	gpELi¡
->
	gnEx´
; j++){

79464 ifÐ
sql™e3M©chS·nName
(
pELi¡
->
a
[
j
].
zS·n
, 
zCÞ
, 
zTab
, 
zDb
) ){

79465 
	gút
++;

79466 
	gútTab
 = 2;

79467 
	gpM©ch
 = 
pI‹m
;

79468 
	gpEx´
->
	giCÞumn
 = 
j
;

79469 
	gh™
 = 1;

79472 ifÐ
	gh™
 || 
	gzTab
==0 ) ;

79474 ifÐ
	gzDb
 && 
	gpTab
->
	gpSchema
!=
pSchema
 ){

79477 ifÐ
	gzTab
 ){

79478 cÚ¡ *
	gzTabName
 = 
pI‹m
->
zAlŸs
 ?…I‹m->zAlŸ : 
pTab
->
zName
;

79479 
as£¹
Ð
zTabName
!=0 );

79480 ifÐ
sql™e3SŒICmp
(
zTabName
, 
zTab
)!=0 ){

79484 ifÐ0==(
útTab
++) ){

79485 
pM©ch
 = 
pI‹m
;

79487 
	gj
=0, 
	gpCÞ
=
pTab
->
aCÞ
; j<
	gpTab
->
	gnCÞ
; j++,…Col++){

79488 ifÐ
sql™e3SŒICmp
(
pCÞ
->
zName
, 
zCÞ
)==0 ){

79493 ifÐ
út
==1 ){

79494 ifÐ
pI‹m
->
jošty³
 & 
JT_NATURAL
 ) ;

79495 ifÐ
ÇmeInUsšgCÏu£
(
pI‹m
->
pUsšg
, 
zCÞ
) ) ;

79497 
	gút
++;

79498 
	gpM©ch
 = 
pI‹m
;

79500 
	gpEx´
->
	giCÞumn
 = 
j
==
pTab
->
iPKey
 ? -1 : (
i16
)j;

79505 ifÐ
	gpM©ch
 ){

79506 
	gpEx´
->
	giTabË
 = 
pM©ch
->
iCursÜ
;

79507 
	gpEx´
->
	gpTab
 = 
pM©ch
->
pTab
;

79508 
as£¹
Ð(
pM©ch
->
jošty³
 & 
JT_RIGHT
)==0 );

79509 ifÐ(
	gpM©ch
->
	gjošty³
 & 
	gJT_LEFT
)!=0 ){

79510 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_CªBeNuÎ
);

79512 
	gpSchema
 = 
pEx´
->
pTab
->
pSchema
;

79516 #iâdeà
SQLITE_OMIT_TRIGGER


79520 ifÐ
	gzDb
==0 && 
zTab
!=0 && 
útTab
==0 && 
pP¬£
->
pTrigg”Tab
!=0 ){

79521 
Ý
 = 
pP¬£
->
eTrigg”Op
;

79522 
as£¹
Ð
Ý
==
TK_DELETE
 || op==
TK_UPDATE
 || op==
TK_INSERT
 );

79523 ifÐ
	gÝ
!=
TK_DELETE
 && 
sql™e3SŒICmp
("Ãw",
zTab
) == 0 ){

79524 
pEx´
->
iTabË
 = 1;

79525 
	gpTab
 = 
pP¬£
->
pTrigg”Tab
;

79526 }ifÐ
	gÝ
!=
TK_INSERT
 && 
sql™e3SŒICmp
("Þd",
zTab
)==0 ){

79527 
pEx´
->
iTabË
 = 0;

79528 
	gpTab
 = 
pP¬£
->
pTrigg”Tab
;

79530 
	gpTab
 = 0;

79533 ifÐ
	gpTab
 ){

79534 
	giCÞ
;

79535 
	gpSchema
 = 
pTab
->
pSchema
;

79536 
	gútTab
++;

79537 
	giCÞ
=0, 
	gpCÞ
=
pTab
->
aCÞ
; iCÞ<
	gpTab
->
	gnCÞ
; iCol++,…Col++){

79538 ifÐ
sql™e3SŒICmp
(
pCÞ
->
zName
, 
zCÞ
)==0 ){

79539 ifÐ
iCÞ
==
pTab
->
iPKey
 ){

79540 
iCÞ
 = -1;

79545 ifÐ
	giCÞ
>=
pTab
->
nCÞ
 && 
sql™e3IsRowid
(
zCÞ
è&& 
HasRowid
(pTab) ){

79548 
iCÞ
 = -1;

79550 ifÐ
	giCÞ
<
	gpTab
->
	gnCÞ
 ){

79551 
	gút
++;

79552 ifÐ
	giCÞ
<0 ){

79553 
	gpEx´
->
	gaffš™y
 = 
SQLITE_AFF_INTEGER
;

79554 }ifÐ
	gpEx´
->
	giTabË
==0 ){

79555 
‹¡ÿ£
Ð
iCÞ
==31 );

79556 
‹¡ÿ£
Ð
iCÞ
==32 );

79557 
	gpP¬£
->
	gÞdmask
 |ð(
iCÞ
>=32 ? 0xfffffffà: (((
u32
)1)<<iCol));

79559 
‹¡ÿ£
Ð
iCÞ
==31 );

79560 
‹¡ÿ£
Ð
iCÞ
==32 );

79561 
	gpP¬£
->
	gÃwmask
 |ð(
iCÞ
>=32 ? 0xfffffffà: (((
u32
)1)<<iCol));

79563 
	gpEx´
->
	giCÞumn
 = (
i16
)
iCÞ
;

79564 
	gpEx´
->
	gpTab
 = 
pTab
;

79565 
	gisTrigg”
 = 1;

79574 ifÐ
	gút
==0 && 
útTab
==1 && 
pM©ch
 && 
sql™e3IsRowid
(
zCÞ
)

79575 && 
HasRowid
(
pM©ch
->
pTab
) ){

79576 
út
 = 1;

79577 
	gpEx´
->
	giCÞumn
 = -1;

79578 
	gpEx´
->
	gaffš™y
 = 
SQLITE_AFF_INTEGER
;

79599 ifÐ(
	gpELi¡
 = 
pNC
->
pELi¡
)!=0

79600 && 
zTab
==0

79601 && 
út
==0

79603 
j
=0; 
	gj
<
	gpELi¡
->
	gnEx´
; j++){

79604 *
	gzAs
 = 
pELi¡
->
a
[
j
].
zName
;

79605 ifÐ
	gzAs
!=0 && 
sql™e3SŒICmp
(
zAs
, 
zCÞ
)==0 ){

79606 
Ex´
 *
pOrig
;

79607 
as£¹
Ð
pEx´
->
pLeá
==0 &&…Ex´->
pRight
==0 );

79608 
as£¹
Ð
pEx´
->
x
.
pLi¡
==0 );

79609 
as£¹
Ð
pEx´
->
x
.
pS–eù
==0 );

79610 
	gpOrig
 = 
pELi¡
->
a
[
j
].
pEx´
;

79611 ifÐ(
	gpNC
->
	gncFÏgs
&
	gNC_AÎowAgg
)==0 && 
Ex´HasPrÝ”ty
(
pOrig
, 
EP_Agg
) ){

79612 
sql™e3E¼ÜMsg
(
pP¬£
, "misu£ oà®Ÿ£d‡gg»g©%s", 
zAs
);

79613  
	gWRC_AbÜt
;

79615 
»sÞveAlŸs
(
pP¬£
, 
pELi¡
, 
j
, 
pEx´
, "", 
nSubqu”y
);

79616 
	gút
 = 1;

79617 
	gpM©ch
 = 0;

79618 
as£¹
Ð
zTab
==0 && 
zDb
==0 );

79619 
	glooku²ame_’d
;

79627 ifÐ
	gút
==0 ){

79628 
pNC
 =…NC->
pNext
;

79629 
	gnSubqu”y
++;

79643 ifÐ
	gút
==0 && 
zTab
==0 && 
Ex´HasPrÝ”ty
(
pEx´
,
EP_DblQuÙed
) ){

79644 
	gpEx´
->
	gÝ
 = 
TK_STRING
;

79645 
	gpEx´
->
	gpTab
 = 0;

79646  
	gWRC_PruÃ
;

79653 ifÐ
	gút
!=1 ){

79654 cÚ¡ *
zE¼
;

79655 
	gzE¼
 = 
út
==0 ? "no such column" : "ambiguous column‚ame";

79656 ifÐ
	gzDb
 ){

79657 
sql™e3E¼ÜMsg
(
pP¬£
, "%s: %s.%s.%s", 
zE¼
, 
zDb
, 
zTab
, 
zCÞ
);

79658 }ifÐ
	gzTab
 ){

79659 
sql™e3E¼ÜMsg
(
pP¬£
, "%s: %s.%s", 
zE¼
, 
zTab
, 
zCÞ
);

79661 
sql™e3E¼ÜMsg
(
pP¬£
, "%s: %s", 
zE¼
, 
zCÞ
);

79663 
	gpP¬£
->
	gcheckSchema
 = 1;

79664 
	gpTÝNC
->
	gnE¼
++;

79673 ifÐ
	gpEx´
->
	giCÞumn
>=0 && 
pM©ch
!=0 ){

79674 
n
 = 
pEx´
->
iCÞumn
;

79675 
‹¡ÿ£
Ð
n
==
BMS
-1 );

79676 ifÐ
	gn
>=
BMS
 ){

79677 
n
 = 
BMS
-1;

79679 
as£¹
Ð
pM©ch
->
iCursÜ
==
pEx´
->
iTabË
 );

79680 
	gpM©ch
->
	gcÞU£d
 |ð((
B™mask
)1)<<
n
;

79685 
sql™e3Ex´D–‘e
(
db
, 
pEx´
->
pLeá
);

79686 
	gpEx´
->
	gpLeá
 = 0;

79687 
sql™e3Ex´D–‘e
(
db
, 
pEx´
->
pRight
);

79688 
	gpEx´
->
	gpRight
 = 0;

79689 
	gpEx´
->
	gÝ
 = (
isTrigg”
 ? 
TK_TRIGGER
 : 
TK_COLUMN
);

79690 
	glooku²ame_’d
:

79691 ifÐ
út
==1 ){

79692 
as£¹
Ð
pNC
!=0 );

79693 ifÐ
	gpEx´
->
	gÝ
!=
TK_AS
 ){

79694 
sql™e3AuthR—d
(
pP¬£
, 
pEx´
, 
pSchema
, 
pNC
->
pSrcLi¡
);

79699 
as£¹
Ð
pTÝNC
!=0 );

79700 
	gpTÝNC
->
	gnRef
++;

79701 ifÐ
	gpTÝNC
==
pNC
 ) ;

79702 
	gpTÝNC
 = 
pTÝNC
->
pNext
;

79704  
	gWRC_PruÃ
;

79706  
	gWRC_AbÜt
;

79714 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3C»©eCÞumnEx´
(
sql™e3
 *
db
, 
SrcLi¡
 *
pSrc
, 
iSrc
, 
iCÞ
){

79715 
Ex´
 *
	gp
 = 
sql™e3Ex´AÎoc
(
db
, 
TK_COLUMN
, 0, 0);

79716 ifÐ
	gp
 ){

79717 
SrcLi¡_™em
 *
	gpI‹m
 = &
pSrc
->
a
[
iSrc
];

79718 
	gp
->
	gpTab
 = 
pI‹m
->
pTab
;

79719 
	gp
->
	giTabË
 = 
pI‹m
->
iCursÜ
;

79720 ifÐ
	gp
->
	gpTab
->
	giPKey
==
iCÞ
 ){

79721 
p
->
iCÞumn
 = -1;

79723 
	gp
->
	giCÞumn
 = (
ynV¬
)
iCÞ
;

79724 
‹¡ÿ£
Ð
iCÞ
==
BMS
 );

79725 
‹¡ÿ£
Ð
iCÞ
==
BMS
-1 );

79726 
	gpI‹m
->
	gcÞU£d
 |ð((
B™mask
)1)<<(
iCÞ
>=
BMS
 ? BMS-1 : iCol);

79728 
Ex´S‘PrÝ”ty
(
p
, 
EP_ResÞved
);

79730  
	gp
;

79737 
nÙV®idP¬tIdxWh”e
(

79738 
P¬£
 *
pP¬£
,

79739 
NameCÚ‹xt
 *
pNC
,

79740 cÚ¡ *
zMsg


79742 ifÐ(
	gpNC
->
	gncFÏgs
 & 
	gNC_P¬tIdx
)!=0 ){

79743 
sql™e3E¼ÜMsg
(
pP¬£
, "%s…rohibited in…artial index WHERE clauses",

79744 
zMsg
);

79748 #iâdeà
SQLITE_OMIT_CHECK


79752 
nÙV®idCheckCÚ¡¿št
(

79753 
P¬£
 *
pP¬£
,

79754 
NameCÚ‹xt
 *
pNC
,

79755 cÚ¡ *
zMsg


79757 ifÐ(
	gpNC
->
	gncFÏgs
 & 
	gNC_IsCheck
)!=0 ){

79758 
sql™e3E¼ÜMsg
(
pP¬£
,"% ´ohib™ed iÀCHECK cÚ¡¿šts", 
zMsg
);

79762 
	#nÙV®idCheckCÚ¡¿št
(
P
,
N
,
M
)

	)

79770 
ex´Probabž™y
(
Ex´
 *
p
){

79771 
	gr
 = -1.0;

79772 ifÐ
	gp
->
	gÝ
!=
TK_FLOAT
 )  -1;

79773 
sql™e3AtoF
(
p
->
u
.
zTok’
, &
r
, 
sql™e3SŒËn30
Õ->u.zTok’), 
SQLITE_UTF8
);

79774 
as£¹
Ð
r
>=0.0 );

79775 ifÐ
	gr
>1.0 )  -1;

79776  ()(
	gr
*1000.0);

79790 
»sÞveEx´S‹p
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

79791 
NameCÚ‹xt
 *
	gpNC
;

79792 
P¬£
 *
	gpP¬£
;

79794 
	gpNC
 = 
pW®k”
->
u
.
pNC
;

79795 
as£¹
Ð
pNC
!=0 );

79796 
	gpP¬£
 = 
pNC
->
pP¬£
;

79797 
as£¹
Ð
pP¬£
==
pW®k”
->pParse );

79799 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_ResÞved
èè 
	gWRC_PruÃ
;

79800 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_ResÞved
);

79801 #iâdeà
NDEBUG


79802 ifÐ
	gpNC
->
	gpSrcLi¡
 &&…NC->pSrcLi¡->
	gnAÎoc
>0 ){

79803 
SrcLi¡
 *
	gpSrcLi¡
 = 
pNC
->
pSrcLi¡
;

79804 
	gi
;

79805 
	gi
=0; i<
	gpNC
->
	gpSrcLi¡
->
	gnSrc
; i++){

79806 
as£¹
Ð
pSrcLi¡
->
a
[
i
].
iCursÜ
>=0 &&…SrcLi¡->a[i].iCursÜ<
pP¬£
->
nTab
);

79810  
	gpEx´
->
	gÝ
 ){

79812 #ià
defšed
(
SQLITE_ENABLE_UPDATE_DELETE_LIMIT
è&& !defšed(
SQLITE_OMIT_SUBQUERY
)

79817 
	gTK_ROW
: {

79818 
SrcLi¡
 *
pSrcLi¡
 = 
pNC
->pSrcList;

79819 
SrcLi¡_™em
 *
	gpI‹m
;

79820 
as£¹
Ð
pSrcLi¡
 &&…SrcLi¡->
nSrc
==1 );

79821 
	gpI‹m
 = 
pSrcLi¡
->
a
;

79822 
	gpEx´
->
	gÝ
 = 
TK_COLUMN
;

79823 
	gpEx´
->
	gpTab
 = 
pI‹m
->
pTab
;

79824 
	gpEx´
->
	giTabË
 = 
pI‹m
->
iCursÜ
;

79825 
	gpEx´
->
	giCÞumn
 = -1;

79826 
	gpEx´
->
	gaffš™y
 = 
SQLITE_AFF_INTEGER
;

79833 
	gTK_ID
: {

79834  
lookupName
(
pP¬£
, 0, 0, 
pEx´
->
u
.
zTok’
, 
pNC
,…Expr);

79840 
	gTK_DOT
: {

79841 cÚ¡ *
zCÞumn
;

79842 cÚ¡ *
	gzTabË
;

79843 cÚ¡ *
	gzDb
;

79844 
Ex´
 *
	gpRight
;

79847 
	gpRight
 = 
pEx´
->
pRight
;

79848 ifÐ
	gpRight
->
	gÝ
==
TK_ID
 ){

79849 
zDb
 = 0;

79850 
	gzTabË
 = 
pEx´
->
pLeá
->
u
.
zTok’
;

79851 
	gzCÞumn
 = 
pRight
->
u
.
zTok’
;

79853 
as£¹
Ð
pRight
->
Ý
==
TK_DOT
 );

79854 
	gzDb
 = 
pEx´
->
pLeá
->
u
.
zTok’
;

79855 
	gzTabË
 = 
pRight
->
pLeá
->
u
.
zTok’
;

79856 
	gzCÞumn
 = 
pRight
->pRight->
u
.
zTok’
;

79858  
lookupName
(
pP¬£
, 
zDb
, 
zTabË
, 
zCÞumn
, 
pNC
, 
pEx´
);

79863 
	gTK_FUNCTION
: {

79864 
Ex´Li¡
 *
pLi¡
 = 
pEx´
->
x
.pList;

79865 
	gn
 = 
pLi¡
 ?…Li¡->
nEx´
 : 0;

79866 
	gno_such_func
 = 0;

79867 
	gwrÚg_num_¬gs
 = 0;

79868 
	gis_agg
 = 0;

79869 
	gauth
;

79870 
	gnId
;

79871 cÚ¡ *
	gzId
;

79872 
FuncDef
 *
	gpDef
;

79873 
u8
 
	g’c
 = 
ENC
(
pP¬£
->
db
);

79875 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

79876 
nÙV®idP¬tIdxWh”e
(
pP¬£
, 
pNC
, "functions");

79877 
	gzId
 = 
pEx´
->
u
.
zTok’
;

79878 
	gnId
 = 
sql™e3SŒËn30
(
zId
);

79879 
	gpDef
 = 
sql™e3FšdFunùiÚ
(
pP¬£
->
db
, 
zId
, 
nId
, 
n
, 
’c
, 0);

79880 ifÐ
	gpDef
==0 ){

79881 
pDef
 = 
sql™e3FšdFunùiÚ
(
pP¬£
->
db
, 
zId
, 
nId
, -2, 
’c
, 0);

79882 ifÐ
	gpDef
==0 ){

79883 
no_such_func
 = 1;

79885 
	gwrÚg_num_¬gs
 = 1;

79888 
	gis_agg
 = 
pDef
->
xFunc
==0;

79889 ifÐ
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_UNLIKELY
 ){

79890 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_UÆik–y
|
EP_Sk
);

79891 ifÐ
	gn
==2 ){

79892 
pEx´
->
iTabË
 = 
ex´Probabž™y
(
pLi¡
->
a
[1].pExpr);

79893 ifÐ
	gpEx´
->
	giTabË
<0 ){

79894 
sql™e3E¼ÜMsg
(
pP¬£
, "second‡rgumento†ikelihood() must be‡ "

79896 
	gpNC
->
	gnE¼
++;

79908 
	gpEx´
->
	giTabË
 = 
pDef
->
zName
[0]=='u' ? 62 : 938;

79911 #iâdeà
SQLITE_OMIT_AUTHORIZATION


79912 
	gauth
 = 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_FUNCTION
, 0, 
pDef
->
zName
, 0);

79913 ifÐ
	gauth
!=
SQLITE_OK
 ){

79914 ifÐ
auth
==
SQLITE_DENY
 ){

79915 
sql™e3E¼ÜMsg
(
pP¬£
, "not‡uthorizedo use function: %s",

79916 
pDef
->
zName
);

79917 
	gpNC
->
	gnE¼
++;

79919 
	gpEx´
->
	gÝ
 = 
TK_NULL
;

79920  
	gWRC_PruÃ
;

79923 ifÐ
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_CONSTANT
 ) 
Ex´S‘PrÝ”ty
(
pEx´
,
EP_CÚ¡ªt
);

79925 ifÐ
	gis_agg
 && (
	gpNC
->
	gncFÏgs
 & 
	gNC_AÎowAgg
)==0 ){

79926 
sql™e3E¼ÜMsg
(
pP¬£
, "misu£ oàagg»g©funùiÚ %.*s()", 
nId
,
zId
);

79927 
	gpNC
->
	gnE¼
++;

79928 
	gis_agg
 = 0;

79929 }ifÐ
	gno_such_func
 && 
	gpP¬£
->
	gdb
->
	gš™
.
	gbusy
==0 ){

79930 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch funùiÚ: %.*s", 
nId
, 
zId
);

79931 
	gpNC
->
	gnE¼
++;

79932 }ifÐ
	gwrÚg_num_¬gs
 ){

79933 
sql™e3E¼ÜMsg
(
pP¬£
,"wrong‚umber of‡rgumentso function %.*s()",

79934 
nId
, 
zId
);

79935 
	gpNC
->
	gnE¼
++;

79937 ifÐ
	gis_agg
 ) 
	gpNC
->
	gncFÏgs
 &ð~
NC_AÎowAgg
;

79938 
sql™e3W®kEx´Li¡
(
pW®k”
, 
pLi¡
);

79939 ifÐ
	gis_agg
 ){

79940 
NameCÚ‹xt
 *
	gpNC2
 = 
pNC
;

79941 
	gpEx´
->
	gÝ
 = 
TK_AGG_FUNCTION
;

79942 
	gpEx´
->
	gÝ2
 = 0;

79943  
	gpNC2
 && !
sql™e3FunùiÚU£sThisSrc
(
pEx´
, 
pNC2
->
pSrcLi¡
) ){

79944 
	gpEx´
->
	gÝ2
++;

79945 
	gpNC2
 = 
pNC2
->
pNext
;

79947 
as£¹
Ð
pDef
!=0 );

79948 ifÐ
	gpNC2
 ){

79949 
as£¹
Ð
SQLITE_FUNC_MINMAX
==
NC_MšMaxAgg
 );

79950 
‹¡ÿ£
Ð(
pDef
->
funcFÏgs
 & 
SQLITE_FUNC_MINMAX
)!=0 );

79951 
	gpNC2
->
	gncFÏgs
 |ð
NC_HasAgg
 | (
pDef
->
funcFÏgs
 & 
SQLITE_FUNC_MINMAX
);

79954 
	gpNC
->
	gncFÏgs
 |ð
NC_AÎowAgg
;

79959  
	gWRC_PruÃ
;

79961 #iâdeà
SQLITE_OMIT_SUBQUERY


79962 
	gTK_SELECT
:

79963 
TK_EXISTS
: 
‹¡ÿ£
Ð
pEx´
->
Ý
==TK_EXISTS );

79965 
	gTK_IN
: {

79966 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_IN
 );

79967 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

79968 
	gnRef
 = 
pNC
->
nRef
;

79969 
nÙV®idCheckCÚ¡¿št
(
pP¬£
, 
pNC
, "subqueries");

79970 
nÙV®idP¬tIdxWh”e
(
pP¬£
, 
pNC
, "subqueries");

79971 
sql™e3W®kS–eù
(
pW®k”
, 
pEx´
->
x
.
pS–eù
);

79972 
as£¹
Ð
pNC
->
nRef
>=nRef );

79973 ifÐ
	gnRef
!=
pNC
->
nRef
 ){

79974 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_V¬S–eù
);

79979 
	gTK_VARIABLE
: {

79980 
nÙV®idCheckCÚ¡¿št
(
pP¬£
, 
pNC
, "parameters");

79981 
nÙV®idP¬tIdxWh”e
(
pP¬£
, 
pNC
, "parameters");

79985  (
	gpP¬£
->
	gnE¼
 ||…P¬£->
	gdb
->
	gm®locFažed
è? 
	gWRC_AbÜt
 : 
WRC_CÚtšue
;

80000 
»sÞveAsName
(

80001 
P¬£
 *
pP¬£
,

80002 
Ex´Li¡
 *
pELi¡
,

80003 
Ex´
 *
pE


80005 
	gi
;

80007 
UNUSED_PARAMETER
(
pP¬£
);

80009 ifÐ
	gpE
->
	gÝ
==
TK_ID
 ){

80010 *
zCÞ
 = 
pE
->
u
.
zTok’
;

80011 
	gi
=0; i<
	gpELi¡
->
	gnEx´
; i++){

80012 *
	gzAs
 = 
pELi¡
->
a
[
i
].
zName
;

80013 ifÐ
	gzAs
!=0 && 
sql™e3SŒICmp
(
zAs
, 
zCÞ
)==0 ){

80014  
i
+1;

80039 
»sÞveOrd”ByT”mToEx´Li¡
(

80040 
P¬£
 *
pP¬£
,

80041 
S–eù
 *
pS–eù
,

80042 
Ex´
 *
pE


80044 
	gi
;

80045 
Ex´Li¡
 *
	gpELi¡
;

80046 
NameCÚ‹xt
 
	gnc
;

80047 
sql™e3
 *
	gdb
;

80048 
	grc
;

80049 
u8
 
	g§vedSuµE¼
;

80051 
as£¹
Ð
sql™e3Ex´IsIÁeg”
(
pE
, &
i
)==0 );

80052 
	gpELi¡
 = 
pS–eù
->
pELi¡
;

80056 
mem£t
(&
nc
, 0, (nc));

80057 
	gnc
.
	gpP¬£
 = 
pP¬£
;

80058 
	gnc
.
	gpSrcLi¡
 = 
pS–eù
->
pSrc
;

80059 
	gnc
.
	gpELi¡
 = 
pELi¡
;

80060 
	gnc
.
	gncFÏgs
 = 
NC_AÎowAgg
;

80061 
	gnc
.
	gnE¼
 = 0;

80062 
	gdb
 = 
pP¬£
->
db
;

80063 
	g§vedSuµE¼
 = 
db
->
suµ»ssE¼
;

80064 
	gdb
->
	gsuµ»ssE¼
 = 1;

80065 
	grc
 = 
sql™e3ResÞveEx´Names
(&
nc
, 
pE
);

80066 
	gdb
->
	gsuµ»ssE¼
 = 
§vedSuµE¼
;

80067 ifÐ
	grc
 )  0;

80073 
	gi
=0; i<
	gpELi¡
->
	gnEx´
; i++){

80074 ifÐ
sql™e3Ex´Com·»
(
pELi¡
->
a
[
i
].
pEx´
, 
pE
, -1)<2 ){

80075  
	gi
+1;

80086 
»sÞveOutOfRªgeE¼Ü
(

80087 
P¬£
 *
pP¬£
,

80088 cÚ¡ *
zTy³
,

80089 
i
,

80090 
mx


80092 
sql™e3E¼ÜMsg
(
pP¬£
,

80094 "b‘w“À1‡nd %d", 
i
, 
zTy³
, 
mx
);

80112 
»sÞveCompoundOrd”By
(

80113 
P¬£
 *
pP¬£
,

80114 
S–eù
 *
pS–eù


80116 
	gi
;

80117 
Ex´Li¡
 *
	gpOrd”By
;

80118 
Ex´Li¡
 *
	gpELi¡
;

80119 
sql™e3
 *
	gdb
;

80120 
	gmÜeToDo
 = 1;

80122 
	gpOrd”By
 = 
pS–eù
->
pOrd”By
;

80123 ifÐ
	gpOrd”By
==0 )  0;

80124 
	gdb
 = 
pP¬£
->
db
;

80125 #ià
SQLITE_MAX_COLUMN


80126 ifÐ
	gpOrd”By
->
	gnEx´
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_COLUMN
] ){

80127 
sql™e3E¼ÜMsg
(
pP¬£
, "too manyerms in ORDER BY clause");

80131 
	gi
=0; i<
	gpOrd”By
->
	gnEx´
; i++){

80132 
	gpOrd”By
->
	ga
[
i
].
	gdÚe
 = 0;

80134 
	gpS–eù
->
	gpNext
 = 0;

80135  
	gpS–eù
->
	gpPriÜ
 ){

80136 
	gpS–eù
->
	gpPriÜ
->
	gpNext
 = 
pS–eù
;

80137 
	gpS–eù
 = 
pS–eù
->
pPriÜ
;

80139  
	gpS–eù
 && 
	gmÜeToDo
 ){

80140 
Ex´Li¡_™em
 *
	gpI‹m
;

80141 
	gmÜeToDo
 = 0;

80142 
	gpELi¡
 = 
pS–eù
->
pELi¡
;

80143 
as£¹
Ð
pELi¡
!=0 );

80144 
	gi
=0, 
	gpI‹m
=
pOrd”By
->
a
; i<
	gpOrd”By
->
	gnEx´
; i++,…Item++){

80145 
	giCÞ
 = -1;

80146 
Ex´
 *
	gpE
, *
	gpDup
;

80147 ifÐ
	gpI‹m
->
	gdÚe
 ) ;

80148 
	gpE
 = 
sql™e3Ex´SkCÞÏ‹
(
pI‹m
->
pEx´
);

80149 ifÐ
sql™e3Ex´IsIÁeg”
(
pE
, &
iCÞ
) ){

80150 ifÐ
	giCÞ
<=0 || 
iCÞ
>
pELi¡
->
nEx´
 ){

80151 
»sÞveOutOfRªgeE¼Ü
(
pP¬£
, "ORDER", 
i
+1, 
pELi¡
->
nEx´
);

80155 
	giCÞ
 = 
»sÞveAsName
(
pP¬£
, 
pELi¡
, 
pE
);

80156 ifÐ
	giCÞ
==0 ){

80157 
pDup
 = 
sql™e3Ex´Dup
(
db
, 
pE
, 0);

80158 ifÐ!
	gdb
->
	gm®locFažed
 ){

80159 
as£¹
(
pDup
);

80160 
	giCÞ
 = 
»sÞveOrd”ByT”mToEx´Li¡
(
pP¬£
, 
pS–eù
, 
pDup
);

80162 
sql™e3Ex´D–‘e
(
db
, 
pDup
);

80165 ifÐ
	giCÞ
>0 ){

80168 
Ex´
 *
	gpNew
 = 
sql™e3Ex´
(
db
, 
TK_INTEGER
, 0);

80169 ifÐ
	gpNew
==0 )  1;

80170 
	gpNew
->
	gæags
 |ð
EP_IÁV®ue
;

80171 
	gpNew
->
	gu
.
	giV®ue
 = 
iCÞ
;

80172 ifÐ
	gpI‹m
->
	gpEx´
==
pE
 ){

80173 
pI‹m
->
pEx´
 = 
pNew
;

80175 
as£¹
Ð
pI‹m
->
pEx´
->
Ý
==
TK_COLLATE
 );

80176 
as£¹
Ð
pI‹m
->
pEx´
->
pLeá
==
pE
 );

80177 
	gpI‹m
->
	gpEx´
->
	gpLeá
 = 
pNew
;

80179 
sql™e3Ex´D–‘e
(
db
, 
pE
);

80180 
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
 = (
u16
)
iCÞ
;

80181 
	gpI‹m
->
	gdÚe
 = 1;

80183 
	gmÜeToDo
 = 1;

80186 
	gpS–eù
 = 
pS–eù
->
pNext
;

80188 
	gi
=0; i<
	gpOrd”By
->
	gnEx´
; i++){

80189 ifÐ
	gpOrd”By
->
	ga
[
i
].
	gdÚe
==0 ){

80190 
sql™e3E¼ÜMsg
(
pP¬£
, "%r ORDER BYerm does‚ot match‡ny "

80191 "cÞumÀšh»suÉ s‘", 
i
+1);

80208 
SQLITE_PRIVATE
 
sql™e3ResÞveOrd”GroupBy
(

80209 
P¬£
 *
pP¬£
,

80210 
S–eù
 *
pS–eù
,

80211 
Ex´Li¡
 *
pOrd”By
,

80212 cÚ¡ *
zTy³


80214 
	gi
;

80215 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

80216 
Ex´Li¡
 *
	gpELi¡
;

80217 
Ex´Li¡_™em
 *
	gpI‹m
;

80219 ifÐ
	gpOrd”By
==0 || 
pP¬£
->
db
->
m®locFažed
 )  0;

80220 #ià
SQLITE_MAX_COLUMN


80221 ifÐ
	gpOrd”By
->
	gnEx´
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_COLUMN
] ){

80222 
sql™e3E¼ÜMsg
(
pP¬£
, "toØmªy”m š % BY cÏu£", 
zTy³
);

80226 
	gpELi¡
 = 
pS–eù
->
pELi¡
;

80227 
as£¹
Ð
pELi¡
!=0 );

80228 
	gi
=0, 
	gpI‹m
=
pOrd”By
->
a
; i<
	gpOrd”By
->
	gnEx´
; i++,…Item++){

80229 ifÐ
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
 ){

80230 ifÐ
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
>
	gpELi¡
->
	gnEx´
 ){

80231 
»sÞveOutOfRªgeE¼Ü
(
pP¬£
, 
zTy³
, 
i
+1, 
pELi¡
->
nEx´
);

80234 
»sÞveAlŸs
(
pP¬£
, 
pELi¡
, 
pI‹m
->
u
.
x
.
iOrd”ByCÞ
-1,…I‹m->
pEx´
, 
zTy³
,0);

80258 
»sÞveOrd”GroupBy
(

80259 
NameCÚ‹xt
 *
pNC
,

80260 
S–eù
 *
pS–eù
,

80261 
Ex´Li¡
 *
pOrd”By
,

80262 cÚ¡ *
zTy³


80264 
	gi
, 
	gj
;

80265 
	giCÞ
;

80266 
Ex´Li¡_™em
 *
	gpI‹m
;

80267 
P¬£
 *
	gpP¬£
;

80268 
	gnResuÉ
;

80270 ifÐ
	gpOrd”By
==0 )  0;

80271 
	gnResuÉ
 = 
pS–eù
->
pELi¡
->
nEx´
;

80272 
	gpP¬£
 = 
pNC
->
pP¬£
;

80273 
	gi
=0, 
	gpI‹m
=
pOrd”By
->
a
; i<
	gpOrd”By
->
	gnEx´
; i++,…Item++){

80274 
Ex´
 *
	gpE
 = 
pI‹m
->
pEx´
;

80275 
Ex´
 *
	gpE2
 = 
sql™e3Ex´SkCÞÏ‹
(
pE
);

80276 ifÐ
	gzTy³
[0]!='G' ){

80277 
iCÞ
 = 
»sÞveAsName
(
pP¬£
, 
pS–eù
->
pELi¡
, 
pE2
);

80278 ifÐ
	giCÞ
>0 ){

80283 
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
 = (
u16
)
iCÞ
;

80287 ifÐ
sql™e3Ex´IsIÁeg”
(
pE2
, &
iCÞ
) ){

80291 ifÐ
	giCÞ
<1 || iCol>0xffff ){

80292 
»sÞveOutOfRªgeE¼Ü
(
pP¬£
, 
zTy³
, 
i
+1, 
nResuÉ
);

80295 
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
 = (
u16
)
iCÞ
;

80300 
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
 = 0;

80301 ifÐ
sql™e3ResÞveEx´Names
(
pNC
, 
pE
) ){

80304 
	gj
=0; j<
	gpS–eù
->
	gpELi¡
->
	gnEx´
; j++){

80305 ifÐ
sql™e3Ex´Com·»
(
pE
, 
pS–eù
->
pELi¡
->
a
[
j
].
pEx´
, -1)==0 ){

80306 
pI‹m
->
u
.
x
.
iOrd”ByCÞ
 = 
j
+1;

80310  
sql™e3ResÞveOrd”GroupBy
(
pP¬£
, 
pS–eù
, 
pOrd”By
, 
zTy³
);

80316 
»sÞveS–eùS‹p
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

80317 
NameCÚ‹xt
 *
	gpOu‹rNC
;

80318 
NameCÚ‹xt
 
	gsNC
;

80319 
	gisCompound
;

80320 
	gnCompound
;

80321 
P¬£
 *
	gpP¬£
;

80322 
Ex´Li¡
 *
	gpELi¡
;

80323 
	gi
;

80324 
Ex´Li¡
 *
	gpGroupBy
;

80325 
S–eù
 *
	gpLeámo¡
;

80326 
sql™e3
 *
	gdb
;

80329 
as£¹
Ð
p
!=0 );

80330 ifÐ
	gp
->
	g£lFÏgs
 & 
	gSF_ResÞved
 ){

80331  
	gWRC_PruÃ
;

80333 
	gpOu‹rNC
 = 
pW®k”
->
u
.
pNC
;

80334 
	gpP¬£
 = 
pW®k”
->
pP¬£
;

80335 
	gdb
 = 
pP¬£
->
db
;

80345 ifÐ(
	gp
->
	g£lFÏgs
 & 
	gSF_Ex·nded
)==0 ){

80346 
sql™e3S–eùP»p
(
pP¬£
, 
p
, 
pOu‹rNC
);

80347  (
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
è? 
	gWRC_AbÜt
 : 
WRC_PruÃ
;

80350 
	gisCompound
 = 
p
->
pPriÜ
!=0;

80351 
	gnCompound
 = 0;

80352 
	gpLeámo¡
 = 
p
;

80353  
	gp
 ){

80354 
as£¹
Ð(
p
->
£lFÏgs
 & 
SF_Ex·nded
)!=0 );

80355 
as£¹
Ð(
p
->
£lFÏgs
 & 
SF_ResÞved
)==0 );

80356 
	gp
->
	g£lFÏgs
 |ð
SF_ResÞved
;

80361 
mem£t
(&
sNC
, 0, (sNC));

80362 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

80363 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
p
->
pLim™
) ||

80364 
sql™e3ResÞveEx´Names
(&
sNC
, 
p
->
pOff£t
) ){

80365  
	gWRC_AbÜt
;

80370 
	gi
=0; i<
	gp
->
	gpSrc
->
	gnSrc
; i++){

80371 
SrcLi¡_™em
 *
	gpI‹m
 = &
p
->
pSrc
->
a
[
i
];

80372 ifÐ
	gpI‹m
->
	gpS–eù
 ){

80373 
NameCÚ‹xt
 *
	gpNC
;

80374 
	gnRef
 = 0;

80375 cÚ¡ *
	gzSavedCÚ‹xt
 = 
pP¬£
->
zAuthCÚ‹xt
;

80382 
	gpNC
=
pOu‹rNC
;…NC;…NC=
pNC
->
pNext
è
nRef
 +=…NC->nRef;

80384 ifÐ
	gpI‹m
->
	gzName
 ) 
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
pI‹m
->
zName
;

80385 
sql™e3ResÞveS–eùNames
(
pP¬£
, 
pI‹m
->
pS–eù
, 
pOu‹rNC
);

80386 
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
zSavedCÚ‹xt
;

80387 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 )  
	gWRC_AbÜt
;

80389 
	gpNC
=
pOu‹rNC
;…NC;…NC=
pNC
->
pNext
è
nRef
 -=…NC->nRef;

80390 
as£¹
Ð
pI‹m
->
isCÜ»Ï‹d
==0 && 
nRef
<=0 );

80391 
	gpI‹m
->
	gisCÜ»Ï‹d
 = (
nRef
!=0);

80398 
	gsNC
.
	gncFÏgs
 = 
NC_AÎowAgg
;

80399 
	gsNC
.
	gpSrcLi¡
 = 
p
->
pSrc
;

80400 
	gsNC
.
	gpNext
 = 
pOu‹rNC
;

80403 
	gpELi¡
 = 
p
->
pELi¡
;

80404 
as£¹
Ð
pELi¡
!=0 );

80405 
	gi
=0; i<
	gpELi¡
->
	gnEx´
; i++){

80406 
Ex´
 *
	gpX
 = 
pELi¡
->
a
[
i
].
pEx´
;

80407 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pX
) ){

80408  
	gWRC_AbÜt
;

80415 
as£¹
Ð(
p
->
£lFÏgs
 & 
SF_Agg»g©e
)==0 );

80416 
	gpGroupBy
 = 
p
->
pGroupBy
;

80417 ifÐ
	gpGroupBy
 || (
	gsNC
.
	gncFÏgs
 & 
	gNC_HasAgg
)!=0 ){

80418 
as£¹
Ð
NC_MšMaxAgg
==
SF_MšMaxAgg
 );

80419 
	gp
->
	g£lFÏgs
 |ð
SF_Agg»g©e
 | (
sNC
.
ncFÏgs
&
NC_MšMaxAgg
);

80421 
	gsNC
.
	gncFÏgs
 &ð~
NC_AÎowAgg
;

80426 ifÐ
	gp
->
	gpHavšg
 && !
	gpGroupBy
 ){

80427 
sql™e3E¼ÜMsg
(
pP¬£
, "a GROUP BY clause is„equired before HAVING");

80428  
	gWRC_AbÜt
;

80439 
	gsNC
.
	gpELi¡
 = 
p
->
pELi¡
;

80440 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
p
->
pHavšg
èè 
	gWRC_AbÜt
;

80441 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
p
->
pWh”e
èè 
	gWRC_AbÜt
;

80446 
	gsNC
.
	gpNext
 = 0;

80447 
	gsNC
.
	gncFÏgs
 |ð
NC_AÎowAgg
;

80454 ifÐ!
	gisCompound
 && 
»sÞveOrd”GroupBy
(&
sNC
, 
p
,…->
pOrd”By
, "ORDER") ){

80455  
	gWRC_AbÜt
;

80457 ifÐ
	gdb
->
	gm®locFažed
 ){

80458  
	gWRC_AbÜt
;

80464 ifÐ
	gpGroupBy
 ){

80465 
Ex´Li¡_™em
 *
	gpI‹m
;

80467 ifÐ
»sÞveOrd”GroupBy
(&
sNC
, 
p
, 
pGroupBy
, "GROUP"è|| 
	gdb
->
	gm®locFažed
 ){

80468  
	gWRC_AbÜt
;

80470 
	gi
=0, 
	gpI‹m
=
pGroupBy
->
a
; i<
	gpGroupBy
->
	gnEx´
; i++,…Item++){

80471 ifÐ
Ex´HasPrÝ”ty
(
pI‹m
->
pEx´
, 
EP_Agg
) ){

80472 
sql™e3E¼ÜMsg
(
pP¬£
, "aggregate functions‡re‚ot‡llowed in "

80474  
	gWRC_AbÜt
;

80481 
	gp
 = 
p
->
pPriÜ
;

80482 
	gnCompound
++;

80488 ifÐ
	gisCompound
 && 
»sÞveCompoundOrd”By
(
pP¬£
, 
pLeámo¡
) ){

80489  
	gWRC_AbÜt
;

80492  
	gWRC_PruÃ
;

80543 
SQLITE_PRIVATE
 
sql™e3ResÞveEx´Names
(

80544 
NameCÚ‹xt
 *
pNC
,

80545 
Ex´
 *
pEx´


80547 
u16
 
	g§vedHasAgg
;

80548 
W®k”
 
	gw
;

80550 ifÐ
	gpEx´
==0 )  0;

80551 #ià
SQLITE_MAX_EXPR_DEPTH
>0

80553 
P¬£
 *
	gpP¬£
 = 
pNC
->
pP¬£
;

80554 ifÐ
sql™e3Ex´CheckHeight
(
pP¬£
, 
pEx´
->
nHeight
+
pNC
->pParse->nHeight) ){

80557 
	gpP¬£
->
	gnHeight
 +ð
pEx´
->
nHeight
;

80560 
	g§vedHasAgg
 = 
pNC
->
ncFÏgs
 & (
NC_HasAgg
|
NC_MšMaxAgg
);

80561 
	gpNC
->
	gncFÏgs
 &ð~(
NC_HasAgg
|
NC_MšMaxAgg
);

80562 
mem£t
(&
w
, 0, (w));

80563 
	gw
.
	gxEx´C®lback
 = 
»sÞveEx´S‹p
;

80564 
	gw
.
	gxS–eùC®lback
 = 
»sÞveS–eùS‹p
;

80565 
	gw
.
	gpP¬£
 = 
pNC
->
pP¬£
;

80566 
	gw
.
	gu
.
	gpNC
 = 
pNC
;

80567 
sql™e3W®kEx´
(&
w
, 
pEx´
);

80568 #ià
SQLITE_MAX_EXPR_DEPTH
>0

80569 
	gpNC
->
	gpP¬£
->
	gnHeight
 -ð
pEx´
->
nHeight
;

80571 ifÐ
	gpNC
->
	gnE¼
>0 || 
	gw
.
	gpP¬£
->nErr>0 ){

80572 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_E¼Ü
);

80574 ifÐ
	gpNC
->
	gncFÏgs
 & 
	gNC_HasAgg
 ){

80575 
Ex´S‘PrÝ”ty
(
pEx´
, 
EP_Agg
);

80577 
	gpNC
->
	gncFÏgs
 |ð
§vedHasAgg
;

80578  
Ex´HasPrÝ”ty
(
pEx´
, 
EP_E¼Ü
);

80594 
SQLITE_PRIVATE
 
sql™e3ResÞveS–eùNames
(

80595 
P¬£
 *
pP¬£
,

80596 
S–eù
 *
p
,

80597 
NameCÚ‹xt
 *
pOu‹rNC


80599 
W®k”
 
	gw
;

80601 
as£¹
Ð
p
!=0 );

80602 
mem£t
(&
w
, 0, (w));

80603 
	gw
.
	gxEx´C®lback
 = 
»sÞveEx´S‹p
;

80604 
	gw
.
	gxS–eùC®lback
 = 
»sÞveS–eùS‹p
;

80605 
	gw
.
	gpP¬£
 = 
pP¬£
;

80606 
	gw
.
	gu
.
	gpNC
 = 
pOu‹rNC
;

80607 
sql™e3W®kS–eù
(&
w
, 
p
);

80621 
SQLITE_PRIVATE
 
sql™e3ResÞveS–fReã»nû
(

80622 
P¬£
 *
pP¬£
,

80623 
TabË
 *
pTab
,

80624 
ty³
,

80625 
Ex´
 *
pEx´
,

80626 
Ex´Li¡
 *
pLi¡


80628 
SrcLi¡
 
	gsSrc
;

80629 
NameCÚ‹xt
 
	gsNC
;

80630 
	gi
;

80632 
as£¹
Ð
ty³
==
NC_IsCheck
 ||y³==
NC_P¬tIdx
 );

80633 
mem£t
(&
sNC
, 0, (sNC));

80634 
mem£t
(&
sSrc
, 0, (sSrc));

80635 
	gsSrc
.
	gnSrc
 = 1;

80636 
	gsSrc
.
	ga
[0].
	gzName
 = 
pTab
->
zName
;

80637 
	gsSrc
.
	ga
[0].
	gpTab
 = 
pTab
;

80638 
	gsSrc
.
	ga
[0].
	giCursÜ
 = -1;

80639 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

80640 
	gsNC
.
	gpSrcLi¡
 = &
sSrc
;

80641 
	gsNC
.
	gncFÏgs
 = 
ty³
;

80642 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pEx´
) ) ;

80643 ifÐ
	gpLi¡
 ){

80644 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

80645 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pLi¡
->
a
[
i
].
pEx´
) ){

80685 
SQLITE_PRIVATE
 
sql™e3Ex´Affš™y
(
Ex´
 *
pEx´
){

80686 
	gÝ
;

80687 
	gpEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pEx´
);

80688 ifÐ
	gpEx´
->
	gæags
 & 
	gEP_G’”ic
 )  0;

80689 
	gÝ
 = 
pEx´
->
Ý
;

80690 ifÐ
	gÝ
==
TK_SELECT
 ){

80691 
as£¹
Ð
pEx´
->
æags
&
EP_xIsS–eù
 );

80692  
sql™e3Ex´Affš™y
(
pEx´
->
x
.
pS–eù
->
pELi¡
->
a
[0].pExpr);

80694 #iâdeà
SQLITE_OMIT_CAST


80695 ifÐ
	gÝ
==
TK_CAST
 ){

80696 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

80697  
sql™e3Affš™yTy³
(
pEx´
->
u
.
zTok’
, 0);

80700 ifÐ(
	gÝ
==
TK_AGG_COLUMN
 || 
Ý
==
TK_COLUMN
 || op==
TK_REGISTER
)

80701 && 
pEx´
->
pTab
!=0

80705 
j
 = 
pEx´
->
iCÞumn
;

80706 ifÐ
	gj
<0 )  
	gSQLITE_AFF_INTEGER
;

80707 
as£¹
Ð
pEx´
->
pTab
 && 
j
<pEx´->pTab->
nCÞ
 );

80708  
	gpEx´
->
	gpTab
->
	gaCÞ
[
j
].
	gaffš™y
;

80710  
	gpEx´
->
	gaffš™y
;

80721 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AddCÞÏ‹Tok’
(

80722 
P¬£
 *
pP¬£
,

80723 
Ex´
 *
pEx´
,

80724 cÚ¡ 
Tok’
 *
pCÞlName


80726 ifÐ
	gpCÞlName
->
	gn
>0 ){

80727 
Ex´
 *
	gpNew
 = 
sql™e3Ex´AÎoc
(
pP¬£
->
db
, 
TK_COLLATE
, 
pCÞlName
, 1);

80728 ifÐ
	gpNew
 ){

80729 
	gpNew
->
	gpLeá
 = 
pEx´
;

80730 
	gpNew
->
	gæags
 |ð
EP_CÞÏ‹
|
EP_Sk
;

80731 
	gpEx´
 = 
pNew
;

80734  
	gpEx´
;

80736 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AddCÞÏ‹SŒšg
(
P¬£
 *
pP¬£
, Ex´ *
pEx´
, cÚ¡ *
zC
){

80737 
Tok’
 
	gs
;

80738 
as£¹
Ð
zC
!=0 );

80739 
	gs
.
	gz
 = 
zC
;

80740 
	gs
.
	gn
 = 
sql™e3SŒËn30
(
s
.
z
);

80741  
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
, 
pEx´
, &
s
);

80748 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´SkCÞÏ‹
(Ex´ *
pEx´
){

80749  
	gpEx´
 && 
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Sk
) ){

80750 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_UÆik–y
) ){

80751 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

80752 
as£¹
Ð
pEx´
->
x
.
pLi¡
->
nEx´
>0 );

80753 
as£¹
Ð
pEx´
->
Ý
==
TK_FUNCTION
 );

80754 
	gpEx´
 = 
pEx´
->
x
.
pLi¡
->
a
[0].pExpr;

80756 
as£¹
Ð
pEx´
->
Ý
==
TK_COLLATE
 ||…Ex´->Ý==
TK_AS
 );

80757 
	gpEx´
 = 
pEx´
->
pLeá
;

80760  
	gpEx´
;

80772 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Ex´CÞlSeq
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
){

80773 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

80774 
CÞlSeq
 *
	gpCÞl
 = 0;

80775 
Ex´
 *
	gp
 = 
pEx´
;

80776  
	gp
 ){

80777 
	gÝ
 = 
p
->
Ý
;

80778 ifÐ
	gp
->
	gæags
 & 
	gEP_G’”ic
 ) ;

80779 ifÐ
	gÝ
==
TK_CAST
 || 
Ý
==
TK_UPLUS
 ){

80780 
p
 =…->
pLeá
;

80783 ifÐ
	gÝ
==
TK_COLLATE
 || (
Ý
==
TK_REGISTER
 && 
p
->
Ý2
==TK_COLLATE) ){

80784 
pCÞl
 = 
sql™e3G‘CÞlSeq
(
pP¬£
, 
ENC
(
db
), 0, 
p
->
u
.
zTok’
);

80787 ifÐ
	gp
->
	gpTab
!=0

80788 && (
Ý
==
TK_AGG_COLUMN
 || op==
TK_COLUMN


80789 || 
Ý
==
TK_REGISTER
 || op==
TK_TRIGGER
)

80793 
j
 = 
p
->
iCÞumn
;

80794 ifÐ
	gj
>=0 ){

80795 cÚ¡ *
zCÞl
 = 
p
->
pTab
->
aCÞ
[
j
].zColl;

80796 
	gpCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, 
ENC
(db), 
zCÞl
, 0);

80800 ifÐ
	gp
->
	gæags
 & 
	gEP_CÞÏ‹
 ){

80801 ifÐ
ALWAYS
(
p
->
pLeá
è&& (
	gp
->
	gpLeá
->
	gæags
 & 
	gEP_CÞÏ‹
)!=0 ){

80802 
p
 =…->
pLeá
;

80804 
	gp
 = 
p
->
pRight
;

80810 ifÐ
sql™e3CheckCÞlSeq
(
pP¬£
, 
pCÞl
) ){

80811 
	gpCÞl
 = 0;

80813  
	gpCÞl
;

80821 
SQLITE_PRIVATE
 
sql™e3Com·»Affš™y
(
Ex´
 *
pEx´
, 
aff2
){

80822 
	gaff1
 = 
sql™e3Ex´Affš™y
(
pEx´
);

80823 ifÐ
	gaff1
 && 
	gaff2
 ){

80827 ifÐ
sql™e3IsNum”icAffš™y
(
aff1
è|| sql™e3IsNum”icAffš™y(
aff2
) ){

80828  
	gSQLITE_AFF_NUMERIC
;

80830  
	gSQLITE_AFF_NONE
;

80832 }ifÐ!
	gaff1
 && !
	gaff2
 ){

80836  
	gSQLITE_AFF_NONE
;

80839 
as£¹
Ð
aff1
==0 || 
aff2
==0 );

80840  (
	gaff1
 + 
	gaff2
);

80848 
com·risÚAffš™y
(
Ex´
 *
pEx´
){

80849 
	gaff
;

80850 
as£¹
Ð
pEx´
->
Ý
==
TK_EQ
 ||…Ex´->Ý==
TK_IN
 ||…Ex´->Ý==
TK_LT
 ||

80851 
pEx´
->
Ý
==
TK_GT
 ||…Ex´->Ý==
TK_GE
 ||…Ex´->Ý==
TK_LE
 ||

80852 
pEx´
->
Ý
==
TK_NE
 ||…Ex´->Ý==
TK_IS
 ||…Ex´->Ý==
TK_ISNOT
 );

80853 
as£¹
Ð
pEx´
->
pLeá
 );

80854 
	gaff
 = 
sql™e3Ex´Affš™y
(
pEx´
->
pLeá
);

80855 ifÐ
	gpEx´
->
	gpRight
 ){

80856 
	gaff
 = 
sql™e3Com·»Affš™y
(
pEx´
->
pRight
, 
aff
);

80857 }ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

80858 
	gaff
 = 
sql™e3Com·»Affš™y
(
pEx´
->
x
.
pS–eù
->
pELi¡
->
a
[0].pEx´, 
aff
);

80859 }ifÐ!
	gaff
 ){

80860 
	gaff
 = 
SQLITE_AFF_NONE
;

80862  
	gaff
;

80871 
SQLITE_PRIVATE
 
sql™e3IndexAffš™yOk
(
Ex´
 *
pEx´
, 
idx_affš™y
){

80872 
	gaff
 = 
com·risÚAffš™y
(
pEx´
);

80873  
	gaff
 ){

80874 
	gSQLITE_AFF_NONE
:

80876 
	gSQLITE_AFF_TEXT
:

80877  
idx_affš™y
==
SQLITE_AFF_TEXT
;

80879  
sql™e3IsNum”icAffš™y
(
idx_affš™y
);

80887 
u8
 
bš¬yCom·»P5
(
Ex´
 *
pEx´1
, Ex´ *
pEx´2
, 
jumpIfNuÎ
){

80888 
u8
 
	gaff
 = ()
sql™e3Ex´Affš™y
(
pEx´2
);

80889 
	gaff
 = (
u8
)
sql™e3Com·»Affš™y
(
pEx´1
, 
aff
è| (
	gu8
)
	gjumpIfNuÎ
;

80890  
	gaff
;

80905 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Bš¬yCom·»CÞlSeq
(

80906 
P¬£
 *
pP¬£
,

80907 
Ex´
 *
pLeá
,

80908 
Ex´
 *
pRight


80910 
CÞlSeq
 *
	gpCÞl
;

80911 
as£¹
Ð
pLeá
 );

80912 ifÐ
	gpLeá
->
	gæags
 & 
	gEP_CÞÏ‹
 ){

80913 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pLeá
);

80914 }ifÐ
	gpRight
 && (pRight->
	gæags
 & 
	gEP_CÞÏ‹
)!=0 ){

80915 
pCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pRight
);

80917 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pLeá
);

80918 ifÐ!
	gpCÞl
 ){

80919 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pRight
);

80922  
	gpCÞl
;

80928 
codeCom·»
(

80929 
P¬£
 *
pP¬£
,

80930 
Ex´
 *
pLeá
,

80931 
Ex´
 *
pRight
,

80932 
Ýcode
,

80933 
š1
, 
š2
,

80934 
de¡
,

80935 
jumpIfNuÎ


80937 
	gp5
;

80938 
	gaddr
;

80939 
CÞlSeq
 *
	gp4
;

80941 
	gp4
 = 
sql™e3Bš¬yCom·»CÞlSeq
(
pP¬£
, 
pLeá
, 
pRight
);

80942 
	gp5
 = 
bš¬yCom·»P5
(
pLeá
, 
pRight
, 
jumpIfNuÎ
);

80943 
	gaddr
 = 
sql™e3VdbeAddOp4
(
pP¬£
->
pVdbe
, 
Ýcode
, 
š2
, 
de¡
, 
š1
,

80944 (*)
p4
, 
P4_COLLSEQ
);

80945 
sql™e3VdbeChªgeP5
(
pP¬£
->
pVdbe
, (
u8
)
p5
);

80946  
	gaddr
;

80949 #ià
SQLITE_MAX_EXPR_DEPTH
>0

80955 
SQLITE_PRIVATE
 
sql™e3Ex´CheckHeight
(
P¬£
 *
pP¬£
, 
nHeight
){

80956 
	grc
 = 
SQLITE_OK
;

80957 
	gmxHeight
 = 
pP¬£
->
db
->
aLim™
[
SQLITE_LIMIT_EXPR_DEPTH
];

80958 ifÐ
	gnHeight
>
	gmxHeight
 ){

80959 
sql™e3E¼ÜMsg
(
pP¬£
,

80960 "Ex´essiÚ»i toØÏrg(maximum d•th %d)", 
mxHeight


80962 
	grc
 = 
SQLITE_ERROR
;

80964  
	grc
;

80976 
heightOfEx´
(
Ex´
 *
p
, *
²Height
){

80977 ifÐ
	gp
 ){

80978 ifÐ
	gp
->
	gnHeight
>*
	g²Height
 ){

80979 *
	g²Height
 = 
p
->
nHeight
;

80983 
heightOfEx´Li¡
(
Ex´Li¡
 *
p
, *
²Height
){

80984 ifÐ
	gp
 ){

80985 
	gi
;

80986 
	gi
=0; i<
	gp
->
	gnEx´
; i++){

80987 
heightOfEx´
(
p
->
a
[
i
].
pEx´
, 
²Height
);

80991 
heightOfS–eù
(
S–eù
 *
p
, *
²Height
){

80992 ifÐ
	gp
 ){

80993 
heightOfEx´
(
p
->
pWh”e
, 
²Height
);

80994 
heightOfEx´
(
p
->
pHavšg
, 
²Height
);

80995 
heightOfEx´
(
p
->
pLim™
, 
²Height
);

80996 
heightOfEx´
(
p
->
pOff£t
, 
²Height
);

80997 
heightOfEx´Li¡
(
p
->
pELi¡
, 
²Height
);

80998 
heightOfEx´Li¡
(
p
->
pGroupBy
, 
²Height
);

80999 
heightOfEx´Li¡
(
p
->
pOrd”By
, 
²Height
);

81000 
heightOfS–eù
(
p
->
pPriÜ
, 
²Height
);

81011 
ex´S‘Height
(
Ex´
 *
p
){

81012 
	gnHeight
 = 0;

81013 
heightOfEx´
(
p
->
pLeá
, &
nHeight
);

81014 
heightOfEx´
(
p
->
pRight
, &
nHeight
);

81015 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_xIsS–eù
) ){

81016 
heightOfS–eù
(
p
->
x
.
pS–eù
, &
nHeight
);

81018 
heightOfEx´Li¡
(
p
->
x
.
pLi¡
, &
nHeight
);

81020 
	gp
->
	gnHeight
 = 
nHeight
 + 1;

81028 
SQLITE_PRIVATE
 
sql™e3Ex´S‘Height
(
P¬£
 *
pP¬£
, 
Ex´
 *
p
){

81029 
ex´S‘Height
(
p
);

81030 
sql™e3Ex´CheckHeight
(
pP¬£
, 
p
->
nHeight
);

81037 
SQLITE_PRIVATE
 
sql™e3S–eùEx´Height
(
S–eù
 *
p
){

81038 
	gnHeight
 = 0;

81039 
heightOfS–eù
(
p
, &
nHeight
);

81040  
	gnHeight
;

81043 
	#ex´S‘Height
(
y
)

	)

81066 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´AÎoc
(

81067 
sql™e3
 *
db
,

81068 
Ý
,

81069 cÚ¡ 
Tok’
 *
pTok’
,

81070 
dequÙe


81072 
Ex´
 *
	gpNew
;

81073 
	gnExŒa
 = 0;

81074 
	giV®ue
 = 0;

81076 ifÐ
	gpTok’
 ){

81077 ifÐ
	gÝ
!=
TK_INTEGER
 || 
pTok’
->
z
==0

81078 || 
sql™e3G‘IÁ32
(
pTok’
->
z
, &
iV®ue
)==0 ){

81079 
nExŒa
 = 
pTok’
->
n
+1;

81080 
as£¹
Ð
iV®ue
>=0 );

81083 
	gpNew
 = 
sql™e3DbM®locZ”o
(
db
, (
Ex´
)+
nExŒa
);

81084 ifÐ
	gpNew
 ){

81085 
	gpNew
->
	gÝ
 = (
u8
)
Ý
;

81086 
	gpNew
->
	giAgg
 = -1;

81087 ifÐ
	gpTok’
 ){

81088 ifÐ
	gnExŒa
==0 ){

81089 
pNew
->
æags
 |ð
EP_IÁV®ue
;

81090 
	gpNew
->
	gu
.
	giV®ue
 = 
iV®ue
;

81092 
	gc
;

81093 
	gpNew
->
	gu
.
	gzTok’
 = (*)&
pNew
[1];

81094 
as£¹
Ð
pTok’
->
z
!=0 ||…Tok’->
n
==0 );

81095 ifÐ
	gpTok’
->
	gn
 ) 
memýy
(
pNew
->
u
.
zTok’
, 
pTok’
->
z
,…Tok’->
n
);

81096 
	gpNew
->
	gu
.
	gzTok’
[
pTok’
->
n
] = 0;

81097 ifÐ
	gdequÙe
 && 
	gnExŒa
>=3

81098 && ((
c
 = 
pTok’
->
z
[0])=='\'' || c=='"' || c=='[' || c=='`') ){

81099 
sql™e3DequÙe
(
pNew
->
u
.
zTok’
);

81100 ifÐ
	gc
=='"' ) 
pNew
->
æags
 |ð
EP_DblQuÙed
;

81104 #ià
SQLITE_MAX_EXPR_DEPTH
>0

81105 
	gpNew
->
	gnHeight
 = 1;

81108  
	gpNew
;

81115 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´
(

81116 
sql™e3
 *
db
,

81117 
Ý
,

81118 cÚ¡ *
zTok’


81120 
Tok’
 
	gx
;

81121 
	gx
.
	gz
 = 
zTok’
;

81122 
	gx
.
	gn
 = 
zTok’
 ? 
sql™e3SŒËn30
(zToken) : 0;

81123  
sql™e3Ex´AÎoc
(
db
, 
Ý
, &
x
, 0);

81132 
SQLITE_PRIVATE
 
sql™e3Ex´A‰achSubŒ“s
(

81133 
sql™e3
 *
db
,

81134 
Ex´
 *
pRoÙ
,

81135 
Ex´
 *
pLeá
,

81136 
Ex´
 *
pRight


81138 ifÐ
	gpRoÙ
==0 ){

81139 
as£¹
Ð
db
->
m®locFažed
 );

81140 
sql™e3Ex´D–‘e
(
db
, 
pLeá
);

81141 
sql™e3Ex´D–‘e
(
db
, 
pRight
);

81143 ifÐ
	gpRight
 ){

81144 
	gpRoÙ
->
	gpRight
 = 
pRight
;

81145 
	gpRoÙ
->
	gæags
 |ð
EP_CÞÏ‹
 & 
pRight
->
æags
;

81147 ifÐ
	gpLeá
 ){

81148 
	gpRoÙ
->
	gpLeá
 = 
pLeá
;

81149 
	gpRoÙ
->
	gæags
 |ð
EP_CÞÏ‹
 & 
pLeá
->
æags
;

81151 
ex´S‘Height
(
pRoÙ
);

81162 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3PEx´
(

81163 
P¬£
 *
pP¬£
,

81164 
Ý
,

81165 
Ex´
 *
pLeá
,

81166 
Ex´
 *
pRight
,

81167 cÚ¡ 
Tok’
 *
pTok’


81169 
Ex´
 *
	gp
;

81170 ifÐ
	gÝ
==
TK_AND
 && 
pLeá
 && 
pRight
 ){

81172 
p
 = 
sql™e3Ex´And
(
pP¬£
->
db
, 
pLeá
, 
pRight
);

81174 
	gp
 = 
sql™e3Ex´AÎoc
(
pP¬£
->
db
, 
Ý
, 
pTok’
, 1);

81175 
sql™e3Ex´A‰achSubŒ“s
(
pP¬£
->
db
, 
p
, 
pLeá
, 
pRight
);

81177 ifÐ
	gp
 ) {

81178 
sql™e3Ex´CheckHeight
(
pP¬£
, 
p
->
nHeight
);

81180  
	gp
;

81197 
ex´AlwaysTrue
(
Ex´
 *
p
){

81198 
	gv
 = 0;

81199 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_FromJoš
) )  0;

81200 ifÐ!
sql™e3Ex´IsIÁeg”
(
p
, &
v
) )  0;

81201  
	gv
!=0;

81203 
ex´AlwaysF®£
(
Ex´
 *
p
){

81204 
	gv
 = 0;

81205 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_FromJoš
) )  0;

81206 ifÐ!
sql™e3Ex´IsIÁeg”
(
p
, &
v
) )  0;

81207  
	gv
==0;

81218 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´And
(
sql™e3
 *
db
, Ex´ *
pLeá
, Ex´ *
pRight
){

81219 ifÐ
	gpLeá
==0 ){

81220  
pRight
;

81221 }ifÐ
	gpRight
==0 ){

81222  
pLeá
;

81223 }ifÐ
ex´AlwaysF®£
(
pLeá
è||ƒx´AlwaysF®£(
pRight
) ){

81224 
sql™e3Ex´D–‘e
(
db
, 
pLeá
);

81225 
sql™e3Ex´D–‘e
(
db
, 
pRight
);

81226  
sql™e3Ex´AÎoc
(
db
, 
TK_INTEGER
, &
sql™e3IÁTok’s
[0], 0);

81228 
Ex´
 *
	gpNew
 = 
sql™e3Ex´AÎoc
(
db
, 
TK_AND
, 0, 0);

81229 
sql™e3Ex´A‰achSubŒ“s
(
db
, 
pNew
, 
pLeá
, 
pRight
);

81230  
	gpNew
;

81238 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´FunùiÚ
(
P¬£
 *
pP¬£
, 
Ex´Li¡
 *
pLi¡
, 
Tok’
 *
pTok’
){

81239 
Ex´
 *
	gpNew
;

81240 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

81241 
as£¹
Ð
pTok’
 );

81242 
	gpNew
 = 
sql™e3Ex´AÎoc
(
db
, 
TK_FUNCTION
, 
pTok’
, 1);

81243 ifÐ
	gpNew
==0 ){

81244 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

81247 
	gpNew
->
	gx
.
	gpLi¡
 = 
pLi¡
;

81248 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pNew
, 
EP_xIsS–eù
) );

81249 
sql™e3Ex´S‘Height
(
pP¬£
, 
pNew
);

81250  
	gpNew
;

81269 
SQLITE_PRIVATE
 
sql™e3Ex´AssignV¬Numb”
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
){

81270 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

81271 cÚ¡ *
	gz
;

81273 ifÐ
	gpEx´
==0 ) ;

81274 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
|
EP_Reduûd
|
EP_Tok’OÆy
) );

81275 
	gz
 = 
pEx´
->
u
.
zTok’
;

81276 
as£¹
Ð
z
!=0 );

81277 
as£¹
Ð
z
[0]!=0 );

81278 ifÐ
	gz
[1]==0 ){

81280 
as£¹
Ð
z
[0]=='?' );

81281 
	gpEx´
->
	giCÞumn
 = (
ynV¬
)(++
pP¬£
->
nV¬
);

81283 
ynV¬
 
	gx
 = 0;

81284 
u32
 
	gn
 = 
sql™e3SŒËn30
(
z
);

81285 ifÐ
	gz
[0]=='?' ){

81288 
i64
 
i
;

81289 
	gbOk
 = 0==
sql™e3Atoi64
(&
z
[1], &
i
, 
n
-1, 
SQLITE_UTF8
);

81290 
	gpEx´
->
	giCÞumn
 = 
x
 = (
ynV¬
)
i
;

81291 
‹¡ÿ£
Ð
i
==0 );

81292 
‹¡ÿ£
Ð
i
==1 );

81293 
‹¡ÿ£
Ð
i
==
db
->
aLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
]-1 );

81294 
‹¡ÿ£
Ð
i
==
db
->
aLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
] );

81295 ifÐ
	gbOk
==0 || 
i
<1 || i>
db
->
aLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
] ){

81296 
sql™e3E¼ÜMsg
(
pP¬£
, "variable‚umber must be between ?1‡nd ?%d",

81297 
db
->
aLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
]);

81298 
	gx
 = 0;

81300 ifÐ
	gi
>
	gpP¬£
->
	gnV¬
 ){

81301 
	gpP¬£
->
	gnV¬
 = ()
i
;

81308 
ynV¬
 
	gi
;

81309 
	gi
=0; i<
	gpP¬£
->
	gnzV¬
; i++){

81310 ifÐ
	gpP¬£
->
	gazV¬
[
i
] && 
¡rcmp
(
pP¬£
->
azV¬
[i],
z
)==0 ){

81311 
pEx´
->
iCÞumn
 = 
x
 = (
ynV¬
)
i
+1;

81315 ifÐ
	gx
==0 ) 
x
 = 
pEx´
->
iCÞumn
 = (
ynV¬
)(++
pP¬£
->
nV¬
);

81317 ifÐ
	gx
>0 ){

81318 ifÐ
	gx
>
	gpP¬£
->
	gnzV¬
 ){

81319 **
	ga
;

81320 
	ga
 = 
sql™e3DbR—Îoc
(
db
, 
pP¬£
->
azV¬
, 
x
*(
a
[0]));

81321 ifÐ
	ga
==0 ) ;

81322 
	gpP¬£
->
	gazV¬
 = 
a
;

81323 
mem£t
(&
a
[
pP¬£
->
nzV¬
], 0, (
x
-pParse->nzVar)*(a[0]));

81324 
	gpP¬£
->
	gnzV¬
 = 
x
;

81326 ifÐ
	gz
[0]!='?' || 
pP¬£
->
azV¬
[
x
-1]==0 ){

81327 
sql™e3DbF»e
(
db
, 
pP¬£
->
azV¬
[
x
-1]);

81328 
	gpP¬£
->
	gazV¬
[
x
-1] = 
sql™e3DbSŒNDup
(
db
, 
z
, 
n
);

81332 ifÐ!
	gpP¬£
->
	gnE¼
 &&…P¬£->
	gnV¬
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
] ){

81333 
sql™e3E¼ÜMsg
(
pP¬£
, "too many SQL variables");

81340 
SQLITE_PRIVATE
 
sql™e3Ex´D–‘e
(
sql™e3
 *
db
, 
Ex´
 *
p
){

81341 ifÐ
	gp
==0 ) ;

81343 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_IÁV®ue
è||…->
u
.
iV®ue
>=0 );

81344 ifÐ!
Ex´HasPrÝ”ty
(
p
, 
EP_Tok’OÆy
) ){

81346 
as£¹
Ð
p
->
x
.
pLi¡
==0 ||…->
pRight
==0 );

81347 
sql™e3Ex´D–‘e
(
db
, 
p
->
pLeá
);

81348 
sql™e3Ex´D–‘e
(
db
, 
p
->
pRight
);

81349 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_MemTok’
èè
sql™e3DbF»e
(
db
,…->
u
.
zTok’
);

81350 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_xIsS–eù
) ){

81351 
sql™e3S–eùD–‘e
(
db
, 
p
->
x
.
pS–eù
);

81353 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
x
.
pLi¡
);

81356 ifÐ!
Ex´HasPrÝ”ty
(
p
, 
EP_Stic
) ){

81357 
sql™e3DbF»e
(
db
, 
p
);

81366 
ex´SŒuùSize
(
Ex´
 *
p
){

81367 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_Tok’OÆy
èè 
	gEXPR_TOKENONLYSIZE
;

81368 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_Reduûd
èè 
	gEXPR_REDUCEDSIZE
;

81369  
	gEXPR_FULLSIZE
;

81406 
du³dEx´SŒuùSize
(
Ex´
 *
p
, 
æags
){

81407 
	gnSize
;

81408 
as£¹
Ð
æags
==
EXPRDUP_REDUCE
 || flags==0 );

81409 
as£¹
Ð
EXPR_FULLSIZE
<=0xfff );

81410 
as£¹
Ð(0xffà& (
EP_Reduûd
|
EP_Tok’OÆy
))==0 );

81411 ifÐ0==(
æags
&
EXPRDUP_REDUCE
) ){

81412 
nSize
 = 
EXPR_FULLSIZE
;

81414 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

81415 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_FromJoš
) );

81416 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_MemTok’
) );

81417 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_NoReduû
) );

81418 ifÐ
	gp
->
	gpLeá
 ||…->
	gx
.
	gpLi¡
 ){

81419 
	gnSize
 = 
EXPR_REDUCEDSIZE
 | 
EP_Reduûd
;

81421 
as£¹
Ð
p
->
pRight
==0 );

81422 
	gnSize
 = 
EXPR_TOKENONLYSIZE
 | 
EP_Tok’OÆy
;

81425  
	gnSize
;

81433 
du³dEx´NodeSize
(
Ex´
 *
p
, 
æags
){

81434 
	gnBy‹
 = 
du³dEx´SŒuùSize
(
p
, 
æags
) & 0xfff;

81435 ifÐ!
Ex´HasPrÝ”ty
(
p
, 
EP_IÁV®ue
è&& 
	gp
->
	gu
.
	gzTok’
 ){

81436 
	gnBy‹
 +ð
sql™e3SŒËn30
(
p
->
u
.
zTok’
)+1;

81438  
ROUND8
(
nBy‹
);

81454 
du³dEx´Size
(
Ex´
 *
p
, 
æags
){

81455 
	gnBy‹
 = 0;

81456 ifÐ
	gp
 ){

81457 
	gnBy‹
 = 
du³dEx´NodeSize
(
p
, 
æags
);

81458 ifÐ
	gæags
&
	gEXPRDUP_REDUCE
 ){

81459 
	gnBy‹
 +ð
du³dEx´Size
(
p
->
pLeá
, 
æags
è+ du³dEx´SizeÕ->
pRight
, flags);

81462  
	gnBy‹
;

81473 
Ex´
 *
ex´Dup
(
sql™e3
 *
db
, Ex´ *
p
, 
æags
, 
u8
 **
pzBufãr
){

81474 
Ex´
 *
	gpNew
 = 0;

81475 ifÐ
	gp
 ){

81476 cÚ¡ 
	gisReduûd
 = (
æags
&
EXPRDUP_REDUCE
);

81477 
u8
 *
	gzAÎoc
;

81478 
u32
 
	g¡©icFÏg
 = 0;

81480 
as£¹
Ð
pzBufãr
==0 || 
isReduûd
 );

81483 ifÐ
	gpzBufãr
 ){

81484 
	gzAÎoc
 = *
pzBufãr
;

81485 
	g¡©icFÏg
 = 
EP_Stic
;

81487 
	gzAÎoc
 = 
sql™e3DbM®locRaw
(
db
, 
du³dEx´Size
(
p
, 
æags
));

81489 
	gpNew
 = (
Ex´
 *)
zAÎoc
;

81491 ifÐ
	gpNew
 ){

81497 cÚ¡ 
	gnSŒuùSize
 = 
du³dEx´SŒuùSize
(
p
, 
æags
);

81498 cÚ¡ 
	gnNewSize
 = 
nSŒuùSize
 & 0xfff;

81499 
	gnTok’
;

81500 ifÐ!
Ex´HasPrÝ”ty
(
p
, 
EP_IÁV®ue
è&& 
	gp
->
	gu
.
	gzTok’
 ){

81501 
	gnTok’
 = 
sql™e3SŒËn30
(
p
->
u
.
zTok’
) + 1;

81503 
	gnTok’
 = 0;

81505 ifÐ
	gisReduûd
 ){

81506 
as£¹
Ð
Ex´HasPrÝ”ty
(
p
, 
EP_Reduûd
)==0 );

81507 
memýy
(
zAÎoc
, 
p
, 
nNewSize
);

81509 
	gnSize
 = 
ex´SŒuùSize
(
p
);

81510 
memýy
(
zAÎoc
, 
p
, 
nSize
);

81511 
mem£t
(&
zAÎoc
[
nSize
], 0, 
EXPR_FULLSIZE
-nSize);

81515 
	gpNew
->
	gæags
 &ð~(
EP_Reduûd
|
EP_Tok’OÆy
|
EP_Stic
|
EP_MemTok’
);

81516 
	gpNew
->
	gæags
 |ð
nSŒuùSize
 & (
EP_Reduûd
|
EP_Tok’OÆy
);

81517 
	gpNew
->
	gæags
 |ð
¡©icFÏg
;

81520 ifÐ
	gnTok’
 ){

81521 *
	gzTok’
 = 
pNew
->
u
.
zTok’
 = (*)&
zAÎoc
[
nNewSize
];

81522 
memýy
(
zTok’
, 
p
->
u
.zTok’, 
nTok’
);

81525 ifÐ0==((
p
->
æags
|
pNew
->æagsè& 
EP_Tok’OÆy
) ){

81527 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_xIsS–eù
) ){

81528 
pNew
->
x
.
pS–eù
 = 
sql™e3S–eùDup
(
db
, 
p
->x.pS–eù, 
isReduûd
);

81530 
	gpNew
->
	gx
.
	gpLi¡
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
x
.
pLi¡
, 
isReduûd
);

81535 ifÐ
Ex´HasPrÝ”ty
(
pNew
, 
EP_Reduûd
|
EP_Tok’OÆy
) ){

81536 
	gzAÎoc
 +ð
du³dEx´NodeSize
(
p
, 
æags
);

81537 ifÐ
Ex´HasPrÝ”ty
(
pNew
, 
EP_Reduûd
) ){

81538 
	gpNew
->
	gpLeá
 = 
ex´Dup
(
db
, 
p
->
pLeá
, 
EXPRDUP_REDUCE
, &
zAÎoc
);

81539 
	gpNew
->
	gpRight
 = 
ex´Dup
(
db
, 
p
->
pRight
, 
EXPRDUP_REDUCE
, &
zAÎoc
);

81541 ifÐ
	gpzBufãr
 ){

81542 *
	gpzBufãr
 = 
zAÎoc
;

81545 ifÐ!
Ex´HasPrÝ”ty
(
p
, 
EP_Tok’OÆy
) ){

81546 
	gpNew
->
	gpLeá
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pLeá
, 0);

81547 
	gpNew
->
	gpRight
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pRight
, 0);

81553  
	gpNew
;

81561 #iâdeà
SQLITE_OMIT_CTE


81562 
W™h
 *
w™hDup
(
sql™e3
 *
db
, W™h *
p
){

81563 
W™h
 *
	gpR‘
 = 0;

81564 ifÐ
	gp
 ){

81565 
	gnBy‹
 = (*
p
è+ Õ->
a
[0]è* (p->
nC‹
-1);

81566 
	gpR‘
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

81567 ifÐ
	gpR‘
 ){

81568 
	gi
;

81569 
	gpR‘
->
	gnC‹
 = 
p
->
nC‹
;

81570 
	gi
=0; i<
	gp
->
	gnC‹
; i++){

81571 
	gpR‘
->
	ga
[
i
].
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
p
->
a
[i].
pS–eù
, 0);

81572 
	gpR‘
->
	ga
[
i
].
	gpCÞs
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
a
[i].
pCÞs
, 0);

81573 
	gpR‘
->
	ga
[
i
].
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
p
->
a
[i].
zName
);

81577  
	gpR‘
;

81580 
	#w™hDup
(
x
,
y
è0

	)

81600 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Ex´Dup
(
sql™e3
 *
db
, Ex´ *
p
, 
æags
){

81601  
ex´Dup
(
db
, 
p
, 
æags
, 0);

81603 
SQLITE_PRIVATE
 
Ex´Li¡
 *
sql™e3Ex´Li¡Dup
(
sql™e3
 *
db
, Ex´Li¡ *
p
, 
æags
){

81604 
Ex´Li¡
 *
	gpNew
;

81605 
Ex´Li¡_™em
 *
	gpI‹m
, *
	gpOldI‹m
;

81606 
	gi
;

81607 ifÐ
	gp
==0 )  0;

81608 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, (*
pNew
) );

81609 ifÐ
	gpNew
==0 )  0;

81610 
	gpNew
->
	gnEx´
 = 
i
 = 
p
->
nEx´
;

81611 ifÐ(
	gæags
 & 
	gEXPRDUP_REDUCE
)==0 ) 
i
=1; 
	gi
<
	gp
->
	gnEx´
; i+=i){}

81612 
pNew
->
a
 = 
pI‹m
 = 
sql™e3DbM®locRaw
(
db
, 
i
*(
p
->a[0]) );

81613 ifÐ
	gpI‹m
==0 ){

81614 
sql™e3DbF»e
(
db
, 
pNew
);

81617 
	gpOldI‹m
 = 
p
->
a
;

81618 
	gi
=0; i<
	gp
->
	gnEx´
; i++, 
	gpI‹m
++, 
	gpOldI‹m
++){

81619 
Ex´
 *
	gpOldEx´
 = 
pOldI‹m
->
pEx´
;

81620 
	gpI‹m
->
	gpEx´
 = 
sql™e3Ex´Dup
(
db
, 
pOldEx´
, 
æags
);

81621 
	gpI‹m
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zName
);

81622 
	gpI‹m
->
	gzS·n
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zS·n
);

81623 
	gpI‹m
->
	gsÜtOrd”
 = 
pOldI‹m
->
sÜtOrd”
;

81624 
	gpI‹m
->
	gdÚe
 = 0;

81625 
	gpI‹m
->
	gbS·nIsTab
 = 
pOldI‹m
->
bS·nIsTab
;

81626 
	gpI‹m
->
	gu
 = 
pOldI‹m
->
u
;

81628  
	gpNew
;

81637 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_TRIGGER
) \

81638 || !
defšed
(
SQLITE_OMIT_SUBQUERY
)

81639 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Dup
(
sql™e3
 *
db
, SrcLi¡ *
p
, 
æags
){

81640 
SrcLi¡
 *
	gpNew
;

81641 
	gi
;

81642 
	gnBy‹
;

81643 ifÐ
	gp
==0 )  0;

81644 
	gnBy‹
 = (*
p
è+ (p->
nSrc
>0 ? Õ->
a
[0]) * (p->nSrc-1) : 0);

81645 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, 
nBy‹
 );

81646 ifÐ
	gpNew
==0 )  0;

81647 
	gpNew
->
	gnSrc
 = 
pNew
->
nAÎoc
 = 
p
->
nSrc
;

81648 
	gi
=0; i<
	gp
->
	gnSrc
; i++){

81649 
SrcLi¡_™em
 *
	gpNewI‹m
 = &
pNew
->
a
[
i
];

81650 
SrcLi¡_™em
 *
	gpOldI‹m
 = &
p
->
a
[
i
];

81651 
TabË
 *
	gpTab
;

81652 
	gpNewI‹m
->
	gpSchema
 = 
pOldI‹m
->
pSchema
;

81653 
	gpNewI‹m
->
	gzD©aba£
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zD©aba£
);

81654 
	gpNewI‹m
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zName
);

81655 
	gpNewI‹m
->
	gzAlŸs
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zAlŸs
);

81656 
	gpNewI‹m
->
	gjošty³
 = 
pOldI‹m
->
jošty³
;

81657 
	gpNewI‹m
->
	giCursÜ
 = 
pOldI‹m
->
iCursÜ
;

81658 
	gpNewI‹m
->
	gaddrFžlSub
 = 
pOldI‹m
->
addrFžlSub
;

81659 
	gpNewI‹m
->
	g»gR‘uº
 = 
pOldI‹m
->
»gR‘uº
;

81660 
	gpNewI‹m
->
	gisCÜ»Ï‹d
 = 
pOldI‹m
->
isCÜ»Ï‹d
;

81661 
	gpNewI‹m
->
	gvŸCÜoutše
 = 
pOldI‹m
->
vŸCÜoutše
;

81662 
	gpNewI‹m
->
	gisRecursive
 = 
pOldI‹m
->
isRecursive
;

81663 
	gpNewI‹m
->
	gzIndex
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zIndex
);

81664 
	gpNewI‹m
->
	gnÙIndexed
 = 
pOldI‹m
->
nÙIndexed
;

81665 
	gpNewI‹m
->
	gpIndex
 = 
pOldI‹m
->
pIndex
;

81666 
	gpTab
 = 
pNewI‹m
->
pTab
 = 
pOldI‹m
->pTab;

81667 ifÐ
	gpTab
 ){

81668 
	gpTab
->
	gnRef
++;

81670 
	gpNewI‹m
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pOldI‹m
->
pS–eù
, 
æags
);

81671 
	gpNewI‹m
->
	gpOn
 = 
sql™e3Ex´Dup
(
db
, 
pOldI‹m
->
pOn
, 
æags
);

81672 
	gpNewI‹m
->
	gpUsšg
 = 
sql™e3IdLi¡Dup
(
db
, 
pOldI‹m
->
pUsšg
);

81673 
	gpNewI‹m
->
	gcÞU£d
 = 
pOldI‹m
->
cÞU£d
;

81675  
	gpNew
;

81677 
SQLITE_PRIVATE
 
IdLi¡
 *
sql™e3IdLi¡Dup
(
sql™e3
 *
db
, IdLi¡ *
p
){

81678 
IdLi¡
 *
	gpNew
;

81679 
	gi
;

81680 ifÐ
	gp
==0 )  0;

81681 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, (*
pNew
) );

81682 ifÐ
	gpNew
==0 )  0;

81683 
	gpNew
->
	gnId
 = 
p
->
nId
;

81684 
	gpNew
->
	ga
 = 
sql™e3DbM®locRaw
(
db
, 
p
->
nId
*Õ->
a
[0]) );

81685 ifÐ
	gpNew
->
	ga
==0 ){

81686 
sql™e3DbF»e
(
db
, 
pNew
);

81692 
	gi
=0; i<
	gp
->
	gnId
; i++){

81693 
IdLi¡_™em
 *
	gpNewI‹m
 = &
pNew
->
a
[
i
];

81694 
IdLi¡_™em
 *
	gpOldI‹m
 = &
p
->
a
[
i
];

81695 
	gpNewI‹m
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pOldI‹m
->
zName
);

81696 
	gpNewI‹m
->
	gidx
 = 
pOldI‹m
->
idx
;

81698  
	gpNew
;

81700 
SQLITE_PRIVATE
 
S–eù
 *
sql™e3S–eùDup
(
sql™e3
 *
db
, S–eù *
p
, 
æags
){

81701 
S–eù
 *
	gpNew
, *
	gpPriÜ
;

81702 ifÐ
	gp
==0 )  0;

81703 
	gpNew
 = 
sql™e3DbM®locRaw
(
db
, (*
p
) );

81704 ifÐ
	gpNew
==0 )  0;

81705 
	gpNew
->
	gpELi¡
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
pELi¡
, 
æags
);

81706 
	gpNew
->
	gpSrc
 = 
sql™e3SrcLi¡Dup
(
db
, 
p
->
pSrc
, 
æags
);

81707 
	gpNew
->
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pWh”e
, 
æags
);

81708 
	gpNew
->
	gpGroupBy
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
pGroupBy
, 
æags
);

81709 
	gpNew
->
	gpHavšg
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pHavšg
, 
æags
);

81710 
	gpNew
->
	gpOrd”By
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
pOrd”By
, 
æags
);

81711 
	gpNew
->
	gÝ
 = 
p
->
Ý
;

81712 
	gpNew
->
	gpPriÜ
 = 
pPriÜ
 = 
sql™e3S–eùDup
(
db
, 
p
->pPriÜ, 
æags
);

81713 ifÐ
	gpPriÜ
 )…PriÜ->
	gpNext
 = 
pNew
;

81714 
	gpNew
->
	gpNext
 = 0;

81715 
	gpNew
->
	gpLim™
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pLim™
, 
æags
);

81716 
	gpNew
->
	gpOff£t
 = 
sql™e3Ex´Dup
(
db
, 
p
->
pOff£t
, 
æags
);

81717 
	gpNew
->
	giLim™
 = 0;

81718 
	gpNew
->
	giOff£t
 = 0;

81719 
	gpNew
->
	g£lFÏgs
 = 
p
->
£lFÏgs
 & ~
SF_U£sEphem”®
;

81720 
	gpNew
->
	gaddrO³nEphm
[0] = -1;

81721 
	gpNew
->
	gaddrO³nEphm
[1] = -1;

81722 
	gpNew
->
	gnS–eùRow
 = 
p
->
nS–eùRow
;

81723 
	gpNew
->
	gpW™h
 = 
w™hDup
(
db
, 
p
->
pW™h
);

81724 
sql™e3S–eùS‘Name
(
pNew
, 
p
->
zS–Name
);

81725  
	gpNew
;

81728 
SQLITE_PRIVATE
 
S–eù
 *
sql™e3S–eùDup
(
sql™e3
 *
db
, S–eù *
p
, 
æags
){

81729 
as£¹
Ð
p
==0 );

81743 
SQLITE_PRIVATE
 
Ex´Li¡
 *
sql™e3Ex´Li¡Aµ’d
(

81744 
P¬£
 *
pP¬£
,

81745 
Ex´Li¡
 *
pLi¡
,

81746 
Ex´
 *
pEx´


81748 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

81749 ifÐ
	gpLi¡
==0 ){

81750 
pLi¡
 = 
sql™e3DbM®locZ”o
(
db
, (
Ex´Li¡
) );

81751 ifÐ
	gpLi¡
==0 ){

81752 
no_mem
;

81754 
	gpLi¡
->
	ga
 = 
sql™e3DbM®locRaw
(
db
, (
pLi¡
->
a
[0]));

81755 ifÐ
	gpLi¡
->
	ga
==0 ) 
no_mem
;

81756 }ifÐ(
	gpLi¡
->
	gnEx´
 & (pList->nExpr-1))==0 ){

81757 
Ex´Li¡_™em
 *
a
;

81758 
as£¹
Ð
pLi¡
->
nEx´
>0 );

81759 
	ga
 = 
sql™e3DbR—Îoc
(
db
, 
pLi¡
->
a
,…Li¡->
nEx´
*2*(pList->a[0]));

81760 ifÐ
	ga
==0 ){

81761 
no_mem
;

81763 
	gpLi¡
->
	ga
 = 
a
;

81765 
as£¹
Ð
pLi¡
->
a
!=0 );

81767 
Ex´Li¡_™em
 *
	gpI‹m
 = &
pLi¡
->
a
[pLi¡->
nEx´
++];

81768 
mem£t
(
pI‹m
, 0, (*pItem));

81769 
	gpI‹m
->
	gpEx´
 = 
pEx´
;

81771  
	gpLi¡
;

81773 
	gno_mem
:

81775 
sql™e3Ex´D–‘e
(
db
, 
pEx´
);

81776 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

81788 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡S‘Name
(

81789 
P¬£
 *
pP¬£
,

81790 
Ex´Li¡
 *
pLi¡
,

81791 
Tok’
 *
pName
,

81792 
dequÙe


81794 
as£¹
Ð
pLi¡
!=0 || 
pP¬£
->
db
->
m®locFažed
!=0 );

81795 ifÐ
	gpLi¡
 ){

81796 
Ex´Li¡_™em
 *
	gpI‹m
;

81797 
as£¹
Ð
pLi¡
->
nEx´
>0 );

81798 
	gpI‹m
 = &
pLi¡
->
a
[pLi¡->
nEx´
-1];

81799 
as£¹
Ð
pI‹m
->
zName
==0 );

81800 
	gpI‹m
->
	gzName
 = 
sql™e3DbSŒNDup
(
pP¬£
->
db
, 
pName
->
z
,…Name->
n
);

81801 ifÐ
	gdequÙe
 && 
	gpI‹m
->
	gzName
 ) 
sql™e3DequÙe
(
pI‹m
->
zName
);

81813 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡S‘S·n
(

81814 
P¬£
 *
pP¬£
,

81815 
Ex´Li¡
 *
pLi¡
,

81816 
Ex´S·n
 *
pS·n


81818 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

81819 
as£¹
Ð
pLi¡
!=0 || 
db
->
m®locFažed
!=0 );

81820 ifÐ
	gpLi¡
 ){

81821 
Ex´Li¡_™em
 *
	gpI‹m
 = &
pLi¡
->
a
[pLi¡->
nEx´
-1];

81822 
as£¹
Ð
pLi¡
->
nEx´
>0 );

81823 
as£¹
Ð
db
->
m®locFažed
 || 
pI‹m
->
pEx´
==
pS·n
->pExpr );

81824 
sql™e3DbF»e
(
db
, 
pI‹m
->
zS·n
);

81825 
	gpI‹m
->
	gzS·n
 = 
sql™e3DbSŒNDup
(
db
, (*)
pS·n
->
zS¹
,

81826 ()(
pS·n
->
zEnd
 -…S·n->
zS¹
));

81834 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡CheckL’gth
(

81835 
P¬£
 *
pP¬£
,

81836 
Ex´Li¡
 *
pELi¡
,

81837 cÚ¡ *
zObjeù


81839 
	gmx
 = 
pP¬£
->
db
->
aLim™
[
SQLITE_LIMIT_COLUMN
];

81840 
‹¡ÿ£
Ð
pELi¡
 &&…ELi¡->
nEx´
==
mx
 );

81841 
‹¡ÿ£
Ð
pELi¡
 &&…ELi¡->
nEx´
==
mx
+1 );

81842 ifÐ
	gpELi¡
 &&…ELi¡->
	gnEx´
>
	gmx
 ){

81843 
sql™e3E¼ÜMsg
(
pP¬£
, "toØmªy cÞumn š %s", 
zObjeù
);

81850 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡D–‘e
(
sql™e3
 *
db
, 
Ex´Li¡
 *
pLi¡
){

81851 
	gi
;

81852 
Ex´Li¡_™em
 *
	gpI‹m
;

81853 ifÐ
	gpLi¡
==0 ) ;

81854 
as£¹
Ð
pLi¡
->
a
!=0 ||…Li¡->
nEx´
==0 );

81855 
	gpI‹m
=
pLi¡
->
a
, 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++,…Item++){

81856 
sql™e3Ex´D–‘e
(
db
, 
pI‹m
->
pEx´
);

81857 
sql™e3DbF»e
(
db
, 
pI‹m
->
zName
);

81858 
sql™e3DbF»e
(
db
, 
pI‹m
->
zS·n
);

81860 
sql™e3DbF»e
(
db
, 
pLi¡
->
a
);

81861 
sql™e3DbF»e
(
db
, 
pLi¡
);

81885 
ex´NodeIsCÚ¡ªt
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

81890 ifÐ
	gpW®k”
->
	gu
.
	gi
==2 && 
Ex´HasPrÝ”ty
(
pEx´
, 
EP_FromJoš
) ){

81891 
	gpW®k”
->
	gu
.
	gi
 = 0;

81892  
	gWRC_AbÜt
;

81895  
	gpEx´
->
	gÝ
 ){

81899 
	gTK_FUNCTION
:

81900 ifÐ
pW®k”
->
u
.
i
>=3 || 
Ex´HasPrÝ”ty
(
pEx´
,
EP_CÚ¡ªt
) ){

81901  
	gWRC_CÚtšue
;

81904 
	gTK_ID
:

81905 
TK_COLUMN
:

81906 
TK_AGG_FUNCTION
:

81907 
TK_AGG_COLUMN
:

81908 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_ID
 );

81909 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_COLUMN
 );

81910 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_AGG_FUNCTION
 );

81911 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_AGG_COLUMN
 );

81912 
	gpW®k”
->
	gu
.
	gi
 = 0;

81913  
	gWRC_AbÜt
;

81914 
	gTK_VARIABLE
:

81915 ifÐ
pW®k”
->
u
.
i
==4 ){

81919 
pEx´
->
Ý
 = 
TK_NULL
;

81920 }ifÐ
	gpW®k”
->
	gu
.
	gi
==3 ){

81923 
pW®k”
->
u
.
i
 = 0;

81924  
	gWRC_AbÜt
;

81928 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_SELECT
 );

81929 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_EXISTS
 );

81930  
	gWRC_CÚtšue
;

81933 
£ËùNodeIsCÚ¡ªt
(
W®k”
 *
pW®k”
, 
S–eù
 *
NÙU£d
){

81934 
UNUSED_PARAMETER
(
NÙU£d
);

81935 
	gpW®k”
->
	gu
.
	gi
 = 0;

81936  
	gWRC_AbÜt
;

81938 
ex´IsCÚ¡
(
Ex´
 *
p
, 
š™FÏg
){

81939 
W®k”
 
	gw
;

81940 
mem£t
(&
w
, 0, (w));

81941 
	gw
.
	gu
.
	gi
 = 
š™FÏg
;

81942 
	gw
.
	gxEx´C®lback
 = 
ex´NodeIsCÚ¡ªt
;

81943 
	gw
.
	gxS–eùC®lback
 = 
£ËùNodeIsCÚ¡ªt
;

81944 
sql™e3W®kEx´
(&
w
, 
p
);

81945  
	gw
.
	gu
.
	gi
;

81956 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªt
(
Ex´
 *
p
){

81957  
ex´IsCÚ¡
(
p
, 1);

81966 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªtNÙJoš
(
Ex´
 *
p
){

81967  
ex´IsCÚ¡
(
p
, 2);

81979 
SQLITE_PRIVATE
 
sql™e3Ex´IsCÚ¡ªtOrFunùiÚ
(
Ex´
 *
p
, 
u8
 
isIn™
){

81980 
as£¹
Ð
isIn™
==0 || isInit==1 );

81981  
ex´IsCÚ¡
(
p
, 3+
isIn™
);

81990 
SQLITE_PRIVATE
 
sql™e3Ex´IsIÁeg”
(
Ex´
 *
p
, *
pV®ue
){

81991 
	grc
 = 0;

81995 
as£¹
Ð
p
->
Ý
!=
TK_INTEGER
 || (p->
æags
 & 
EP_IÁV®ue
)!=0

81996 || 
sql™e3G‘IÁ32
(
p
->
u
.
zTok’
, &
rc
)==0 );

81998 ifÐ
	gp
->
	gæags
 & 
	gEP_IÁV®ue
 ){

81999 *
	gpV®ue
 = 
p
->
u
.
iV®ue
;

82002  
	gp
->
	gÝ
 ){

82003 
	gTK_UPLUS
: {

82004 
rc
 = 
sql™e3Ex´IsIÁeg”
(
p
->
pLeá
, 
pV®ue
);

82007 
	gTK_UMINUS
: {

82008 
v
;

82009 ifÐ
sql™e3Ex´IsIÁeg”
(
p
->
pLeá
, &
v
) ){

82010 
as£¹
Ð
v
!=(-2147483647-1) );

82011 *
	gpV®ue
 = -
v
;

82012 
	grc
 = 1;

82018  
	grc
;

82035 
SQLITE_PRIVATE
 
sql™e3Ex´CªBeNuÎ
(cÚ¡ 
Ex´
 *
p
){

82036 
u8
 
	gÝ
;

82037  
	gp
->
	gÝ
==
TK_UPLUS
 || 
p
->
Ý
==
TK_UMINUS
 ){… =…->
pLeá
; }

82038 
	gÝ
 = 
p
->
Ý
;

82039 ifÐ
	gÝ
==
TK_REGISTER
 ) 
Ý
 = 
p
->
Ý2
;

82040  
	gÝ
 ){

82041 
	gTK_INTEGER
:

82042 
TK_STRING
:

82043 
TK_FLOAT
:

82044 
TK_BLOB
:

82046 
	gTK_COLUMN
:

82047 
as£¹
Ð
p
->
pTab
!=0 );

82048  
Ex´HasPrÝ”ty
(
p
, 
EP_CªBeNuÎ
) ||

82049 (
	gp
->
	giCÞumn
>=0 && 
p
->
pTab
->
aCÞ
[p->
iCÞumn
].
nÙNuÎ
==0);

82065 
SQLITE_PRIVATE
 
sql™e3Ex´N“dsNoAffš™yChªge
(cÚ¡ 
Ex´
 *
p
, 
aff
){

82066 
u8
 
	gÝ
;

82067 ifÐ
	gaff
==
SQLITE_AFF_NONE
 )  1;

82068  
	gp
->
	gÝ
==
TK_UPLUS
 || 
p
->
Ý
==
TK_UMINUS
 ){… =…->
pLeá
; }

82069 
	gÝ
 = 
p
->
Ý
;

82070 ifÐ
	gÝ
==
TK_REGISTER
 ) 
Ý
 = 
p
->
Ý2
;

82071  
	gÝ
 ){

82072 
	gTK_INTEGER
: {

82073  
aff
==
SQLITE_AFF_INTEGER
 ||‡ff==
SQLITE_AFF_NUMERIC
;

82075 
	gTK_FLOAT
: {

82076  
aff
==
SQLITE_AFF_REAL
 ||‡ff==
SQLITE_AFF_NUMERIC
;

82078 
	gTK_STRING
: {

82079  
aff
==
SQLITE_AFF_TEXT
;

82081 
	gTK_BLOB
: {

82084 
	gTK_COLUMN
: {

82085 
as£¹
Ð
p
->
iTabË
>=0 );

82086  
	gp
->
	giCÞumn
<0

82087 && (
	gaff
==
SQLITE_AFF_INTEGER
 || 
aff
==
SQLITE_AFF_NUMERIC
);

82098 
SQLITE_PRIVATE
 
sql™e3IsRowid
(cÚ¡ *
z
){

82099 ifÐ
sql™e3SŒICmp
(
z
, "_ROWID_")==0 )  1;

82100 ifÐ
sql™e3SŒICmp
(
z
, "ROWID")==0 )  1;

82101 ifÐ
sql™e3SŒICmp
(
z
, "OID")==0 )  1;

82117 #iâdeà
SQLITE_OMIT_SUBQUERY


82118 
isCªdid©eFÜInO±
(
S–eù
 *
p
){

82119 
SrcLi¡
 *
	gpSrc
;

82120 
Ex´Li¡
 *
	gpELi¡
;

82121 
TabË
 *
	gpTab
;

82122 ifÐ
	gp
==0 )  0;

82123 ifÐ
	gp
->
	gpPriÜ
 )  0;

82124 ifÐ
	gp
->
	g£lFÏgs
 & (
	gSF_Di¡šù
|
	gSF_Agg»g©e
) ){

82125 
‹¡ÿ£
Ð(
p
->
£lFÏgs
 & (
SF_Di¡šù
|
SF_Agg»g©e
))==SF_Distinct );

82126 
‹¡ÿ£
Ð(
p
->
£lFÏgs
 & (
SF_Di¡šù
|
SF_Agg»g©e
))==SF_Aggregate );

82129 
as£¹
Ð
p
->
pGroupBy
==0 );

82130 ifÐ
	gp
->
	gpLim™
 )  0;

82131 
as£¹
Ð
p
->
pOff£t
==0 );

82132 ifÐ
	gp
->
	gpWh”e
 )  0;

82133 
	gpSrc
 = 
p
->
pSrc
;

82134 
as£¹
Ð
pSrc
!=0 );

82135 ifÐ
	gpSrc
->
	gnSrc
!=1 )  0;

82136 ifÐ
	gpSrc
->
	ga
[0].
	gpS–eù
 )  0;

82137 
	gpTab
 = 
pSrc
->
a
[0].
pTab
;

82138 ifÐ
NEVER
(
pTab
==0) )  0;

82139 
as£¹
Ð
pTab
->
pS–eù
==0 );

82140 ifÐ
IsVœtu®
(
pTab
) )  0;

82141 
	gpELi¡
 = 
p
->
pELi¡
;

82142 ifÐ
	gpELi¡
->
	gnEx´
!=1 )  0;

82143 ifÐ
	gpELi¡
->
	ga
[0].
	gpEx´
->
	gÝ
!=
TK_COLUMN
 )  0;

82152 
SQLITE_PRIVATE
 
sql™e3CodeOnû
(
P¬£
 *
pP¬£
){

82153 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

82154  
sql™e3VdbeAddOp1
(
v
, 
OP_Onû
, 
pP¬£
->
nOnû
++);

82163 
sql™e3S‘HasNuÎFÏg
(
Vdbe
 *
v
, 
iCur
, 
»gHasNuÎ
){

82164 
	gj1
;

82165 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gHasNuÎ
);

82166 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 
iCur
); 
VdbeCov”age
(v);

82167 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iCur
, 0, 
»gHasNuÎ
);

82168 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_TYPEOFARG
);

82169 
VdbeComm’t
((
v
, "fœ¡_’Œy_š(%d)", 
iCur
));

82170 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

82174 #iâdeà
SQLITE_OMIT_SUBQUERY


82179 
sql™e3InRhsIsCÚ¡ªt
(
Ex´
 *
pIn
){

82180 
Ex´
 *
	gpLHS
;

82181 
	g»s
;

82182 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pIn
, 
EP_xIsS–eù
) );

82183 
	gpLHS
 = 
pIn
->
pLeá
;

82184 
	gpIn
->
	gpLeá
 = 0;

82185 
	g»s
 = 
sql™e3Ex´IsCÚ¡ªt
(
pIn
);

82186 
	gpIn
->
	gpLeá
 = 
pLHS
;

82187  
	g»s
;

82261 #iâdeà
SQLITE_OMIT_SUBQUERY


82262 
SQLITE_PRIVATE
 
sql™e3FšdInIndex
(
P¬£
 *
pP¬£
, 
Ex´
 *
pX
, 
u32
 
šFÏgs
, *
´RhsHasNuÎ
){

82263 
S–eù
 *
	gp
;

82264 
	geTy³
 = 0;

82265 
	giTab
 = 
pP¬£
->
nTab
++;

82266 
	gmu¡BeUnique
;

82267 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

82269 
as£¹
Ð
pX
->
Ý
==
TK_IN
 );

82270 
	gmu¡BeUnique
 = (
šFÏgs
 & 
IN_INDEX_LOOP
)!=0;

82276 
	gp
 = (
Ex´HasPrÝ”ty
(
pX
, 
EP_xIsS–eù
è? 
	gpX
->
	gx
.
	gpS–eù
 : 0);

82277 ifÐ
ALWAYS
(
pP¬£
->
nE¼
==0è&& 
isCªdid©eFÜInO±
(
p
) ){

82278 
sql™e3
 *
db
 = 
pP¬£
->db;

82279 
TabË
 *
	gpTab
;

82280 
Ex´
 *
	gpEx´
;

82281 
i16
 
	giCÞ
;

82282 
i16
 
	giDb
;

82284 
as£¹
Ð
p
 );

82285 
as£¹
Ð
p
->
pELi¡
!=0 );

82286 
as£¹
Ð
p
->
pELi¡
->
a
[0].
pEx´
!=0 );

82287 
as£¹
Ð
p
->
pSrc
!=0 );

82288 
	gpTab
 = 
p
->
pSrc
->
a
[0].
pTab
;

82289 
	gpEx´
 = 
p
->
pELi¡
->
a
[0].
pEx´
;

82290 
	giCÞ
 = (
i16
)
pEx´
->
iCÞumn
;

82293 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

82294 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

82295 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 0,…Tab->
zName
);

82301 
as£¹
(
v
);

82302 ifÐ
	giCÞ
<0 ){

82303 
	giAddr
 = 
sql™e3CodeOnû
(
pP¬£
);

82304 
VdbeCov”age
(
v
);

82306 
sql™e3O³nTabË
(
pP¬£
, 
iTab
, 
iDb
, 
pTab
, 
OP_O³nR—d
);

82307 
	geTy³
 = 
IN_INDEX_ROWID
;

82309 
sql™e3VdbeJumpH”e
(
v
, 
iAddr
);

82311 
Index
 *
	gpIdx
;

82316 
CÞlSeq
 *
	gpReq
 = 
sql™e3Bš¬yCom·»CÞlSeq
(
pP¬£
, 
pX
->
pLeá
, 
pEx´
);

82322 
	gaffš™y_ok
 = 
sql™e3IndexAffš™yOk
(
pX
, 
pTab
->
aCÞ
[
iCÞ
].
affš™y
);

82324 
	gpIdx
=
pTab
->
pIndex
;…Idx && 
	geTy³
==0 && 
affš™y_ok
;…Idx=
pIdx
->
pNext
){

82325 ifÐ(
pIdx
->
aiCÞumn
[0]==
iCÞ
)

82326 && 
sql™e3FšdCÞlSeq
(
db
, 
ENC
(db), 
pIdx
->
azCÞl
[0], 0)==
pReq


82327 && (!
mu¡BeUnique
 || (
pIdx
->
nKeyCÞ
==1 && 
IsUniqueIndex
(pIdx)))

82329 
iAddr
 = 
sql™e3CodeOnû
(
pP¬£
); 
VdbeCov”age
(
v
);

82330 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nR—d
, 
iTab
, 
pIdx
->
Šum
, 
iDb
);

82331 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

82332 
VdbeComm’t
((
v
, "%s", 
pIdx
->
zName
));

82333 
as£¹
Ð
IN_INDEX_INDEX_DESC
 =ð
IN_INDEX_INDEX_ASC
+1 );

82334 
	geTy³
 = 
IN_INDEX_INDEX_ASC
 + 
pIdx
->
aSÜtOrd”
[0];

82336 ifÐ
	g´RhsHasNuÎ
 && !
	gpTab
->
	gaCÞ
[
iCÞ
].
	gnÙNuÎ
 ){

82337 *
	g´RhsHasNuÎ
 = ++
pP¬£
->
nMem
;

82338 
sql™e3S‘HasNuÎFÏg
(
v
, 
iTab
, *
´RhsHasNuÎ
);

82340 
sql™e3VdbeJumpH”e
(
v
, 
iAddr
);

82353 ifÐ
	geTy³
==0

82354 && (
šFÏgs
 & 
IN_INDEX_NOOP_OK
)

82355 && !
Ex´HasPrÝ”ty
(
pX
, 
EP_xIsS–eù
)

82356 && (!
sql™e3InRhsIsCÚ¡ªt
(
pX
è|| 
	gpX
->
	gx
.
	gpLi¡
->
	gnEx´
<=2)

82358 
eTy³
 = 
IN_INDEX_NOOP
;

82362 ifÐ
	geTy³
==0 ){

82366 
u32
 
§vedNQu”yLoÝ
 = 
pP¬£
->
nQu”yLoÝ
;

82367 
	grMayHaveNuÎ
 = 0;

82368 
	geTy³
 = 
IN_INDEX_EPH
;

82369 ifÐ
	gšFÏgs
 & 
	gIN_INDEX_LOOP
 ){

82370 
	gpP¬£
->
	gnQu”yLoÝ
 = 0;

82371 ifÐ
	gpX
->
	gpLeá
->
	giCÞumn
<0 && !
Ex´HasPrÝ”ty
(
pX
, 
EP_xIsS–eù
) ){

82372 
	geTy³
 = 
IN_INDEX_ROWID
;

82374 }ifÐ
	g´RhsHasNuÎ
 ){

82375 *
	g´RhsHasNuÎ
 = 
rMayHaveNuÎ
 = ++
pP¬£
->
nMem
;

82377 
sql™e3CodeSub£Ëù
(
pP¬£
, 
pX
, 
rMayHaveNuÎ
, 
eTy³
==
IN_INDEX_ROWID
);

82378 
	gpP¬£
->
	gnQu”yLoÝ
 = 
§vedNQu”yLoÝ
;

82380 
	gpX
->
	giTabË
 = 
iTab
;

82382  
	geTy³
;

82413 #iâdeà
SQLITE_OMIT_SUBQUERY


82414 
SQLITE_PRIVATE
 
sql™e3CodeSub£Ëù
(

82415 
P¬£
 *
pP¬£
,

82416 
Ex´
 *
pEx´
,

82417 
rHasNuÎFÏg
,

82418 
isRowid


82420 
	gjmpIfDyÇmic
 = -1;

82421 
	grReg
 = 0;

82422 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

82423 ifÐ
NEVER
(
v
==0) )  0;

82424 
sql™e3Ex´CachePush
(
pP¬£
);

82436 ifÐ!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_V¬S–eù
) ){

82437 
	gjmpIfDyÇmic
 = 
sql™e3CodeOnû
(
pP¬£
); 
VdbeCov”age
(
v
);

82440 #iâdeà
SQLITE_OMIT_EXPLAIN


82441 ifÐ
	gpP¬£
->
	gex¶aš
==2 ){

82442 *
zMsg
 = 
sql™e3MPrštf
(

82443 
pP¬£
->
db
, "EXECUTE %s% SUBQUERY %d", 
jmpIfDyÇmic
>=0?"":"CORRELATED ",

82444 
pEx´
->
Ý
==
TK_IN
?"LIST":"SCALAR", 
pP¬£
->
iNextS–eùId


82446 
sql™e3VdbeAddOp4
(
v
, 
OP_Ex¶aš
, 
pP¬£
->
iS–eùId
, 0, 0, 
zMsg
, 
P4_DYNAMIC
);

82450  
	gpEx´
->
	gÝ
 ){

82451 
	gTK_IN
: {

82452 
affš™y
;

82453 
	gaddr
;

82454 
Ex´
 *
	gpLeá
 = 
pEx´
->
pLeá
;

82455 
KeyInfo
 *
	gpKeyInfo
 = 0;

82457 
	gaffš™y
 = 
sql™e3Ex´Affš™y
(
pLeá
);

82472 
	gpEx´
->
	giTabË
 = 
pP¬£
->
nTab
++;

82473 
	gaddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
pEx´
->
iTabË
, !
isRowid
);

82474 
	gpKeyInfo
 = 
isRowid
 ? 0 : 
sql™e3KeyInfoAÎoc
(
pP¬£
->
db
, 1, 1);

82476 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

82482 
S–eù
 *
	gpS–eù
 = 
pEx´
->
x
.
pS–eù
;

82483 
S–eùDe¡
 
	gde¡
;

82484 
Ex´Li¡
 *
	gpELi¡
;

82486 
as£¹
Ð!
isRowid
 );

82487 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_S‘
, 
pEx´
->
iTabË
);

82488 
	gde¡
.
	gaffSd¡
 = (
u8
)
affš™y
;

82489 
as£¹
Ð(
pEx´
->
iTabË
&0x0000FFFF)==pExpr->iTable );

82490 
	gpS–eù
->
	giLim™
 = 0;

82491 
‹¡ÿ£
Ð
pS–eù
->
£lFÏgs
 & 
SF_Di¡šù
 );

82492 
‹¡ÿ£
Ð
pKeyInfo
==0 );

82493 ifÐ
sql™e3S–eù
(
pP¬£
, 
pS–eù
, &
de¡
) ){

82494 
sql™e3KeyInfoUÄef
(
pKeyInfo
);

82497 
	gpELi¡
 = 
pS–eù
->
pELi¡
;

82498 
as£¹
Ð
pKeyInfo
!=0 );

82499 
as£¹
Ð
pELi¡
!=0 );

82500 
as£¹
Ð
pELi¡
->
nEx´
>0 );

82501 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pKeyInfo
) );

82502 
	gpKeyInfo
->
	gaCÞl
[0] = 
sql™e3Bš¬yCom·»CÞlSeq
(
pP¬£
, 
pEx´
->
pLeá
,

82503 
pELi¡
->
a
[0].
pEx´
);

82504 }ifÐ
ALWAYS
(
pEx´
->
x
.
pLi¡
!=0) ){

82512 
i
;

82513 
Ex´Li¡
 *
	gpLi¡
 = 
pEx´
->
x
.
pLi¡
;

82514 
Ex´Li¡_™em
 *
	gpI‹m
;

82515 
	gr1
, 
	gr2
, 
	gr3
;

82517 ifÐ!
	gaffš™y
 ){

82518 
	gaffš™y
 = 
SQLITE_AFF_NONE
;

82520 ifÐ
	gpKeyInfo
 ){

82521 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pKeyInfo
) );

82522 
	gpKeyInfo
->
	gaCÞl
[0] = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pEx´
->
pLeá
);

82526 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

82527 
	gr2
 = 
sql™e3G‘TempReg
(
pP¬£
);

82528 ifÐ
	gisRowid
 ) 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
r2
);

82529 
	gi
=
pLi¡
->
nEx´
, 
	gpI‹m
õLi¡->
a
; i>0; i--,…Item++){

82530 
Ex´
 *
	gpE2
 = 
pI‹m
->
pEx´
;

82531 
	giV®ToIns
;

82538 ifÐ
	gjmpIfDyÇmic
>=0 && !
sql™e3Ex´IsCÚ¡ªt
(
pE2
) ){

82539 
sql™e3VdbeChªgeToNoÝ
(
v
, 
jmpIfDyÇmic
);

82540 
	gjmpIfDyÇmic
 = -1;

82544 ifÐ
	gisRowid
 && 
sql™e3Ex´IsIÁeg”
(
pE2
, &
iV®ToIns
) ){

82545 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹IÁ
, 
pEx´
->
iTabË
, 
r2
, 
iV®ToIns
);

82547 
	gr3
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pE2
, 
r1
);

82548 ifÐ
	gisRowid
 ){

82549 
sql™e3VdbeAddOp2
(
v
, 
OP_Mu¡BeIÁ
, 
r3
,

82550 
sql™e3VdbeCu¼’tAddr
(
v
)+2);

82551 
VdbeCov”age
(
v
);

82552 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
pEx´
->
iTabË
, 
r2
, 
r3
);

82554 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
r3
, 1, 
r2
, &
affš™y
, 1);

82555 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
r3
, 1);

82556 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
pEx´
->
iTabË
, 
r2
);

82560 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

82561 
sql™e3R–—£TempReg
(
pP¬£
, 
r2
);

82563 ifÐ
	gpKeyInfo
 ){

82564 
sql™e3VdbeChªgeP4
(
v
, 
addr
, (*)
pKeyInfo
, 
P4_KEYINFO
);

82569 
	gTK_EXISTS
:

82570 
TK_SELECT
:

82578 
S–eù
 *
pS–
;

82579 
S–eùDe¡
 
	gde¡
;

82581 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_EXISTS
 );

82582 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_SELECT
 );

82583 
as£¹
Ð
pEx´
->
Ý
==
TK_EXISTS
 ||…Ex´->Ý==
TK_SELECT
 );

82585 
as£¹
Ð
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

82586 
	gpS–
 = 
pEx´
->
x
.
pS–eù
;

82587 
sql™e3S–eùDe¡In™
(&
de¡
, 0, ++
pP¬£
->
nMem
);

82588 ifÐ
	gpEx´
->
	gÝ
==
TK_SELECT
 ){

82589 
de¡
.
eDe¡
 = 
SRT_Mem
;

82590 
	gde¡
.
	giSd¡
 = 
de¡
.
iSDP¬m
;

82591 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
de¡
.
iSDP¬m
);

82592 
VdbeComm’t
((
v
, "Init subquery„esult"));

82594 
	gde¡
.
	geDe¡
 = 
SRT_Exi¡s
;

82595 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
de¡
.
iSDP¬m
);

82596 
VdbeComm’t
((
v
, "Init EXISTS„esult"));

82598 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
pS–
->
pLim™
);

82599 
	gpS–
->
	gpLim™
 = 
sql™e3PEx´
(
pP¬£
, 
TK_INTEGER
, 0, 0,

82600 &
sql™e3IÁTok’s
[1]);

82601 
	gpS–
->
	giLim™
 = 0;

82602 ifÐ
sql™e3S–eù
(
pP¬£
, 
pS–
, &
de¡
) ){

82605 
	grReg
 = 
de¡
.
iSDP¬m
;

82606 
Ex´S‘VVAPrÝ”ty
(
pEx´
, 
EP_NoReduû
);

82611 ifÐ
	grHasNuÎFÏg
 ){

82612 
sql™e3S‘HasNuÎFÏg
(
v
, 
pEx´
->
iTabË
, 
rHasNuÎFÏg
);

82615 ifÐ
	gjmpIfDyÇmic
>=0 ){

82616 
sql™e3VdbeJumpH”e
(
v
, 
jmpIfDyÇmic
);

82618 
sql™e3Ex´CachePÝ
(
pP¬£
);

82620  
	grReg
;

82624 #iâdeà
SQLITE_OMIT_SUBQUERY


82642 
sql™e3Ex´CodeIN
(

82643 
P¬£
 *
pP¬£
,

82644 
Ex´
 *
pEx´
,

82645 
de¡IfF®£
,

82646 
de¡IfNuÎ


82648 
	grRhsHasNuÎ
 = 0;

82649 
	gaffš™y
;

82650 
	geTy³
;

82651 
	gr1
;

82652 
Vdbe
 *
	gv
;

82657 
	gv
 = 
pP¬£
->
pVdbe
;

82658 
as£¹
Ð
v
!=0 );

82659 
VdbeNoÝComm’t
((
v
, "begin INƒxpr"));

82660 
	geTy³
 = 
sql™e3FšdInIndex
(
pP¬£
, 
pEx´
,

82661 
IN_INDEX_MEMBERSHIP
 | 
IN_INDEX_NOOP_OK
,

82662 
de¡IfF®£
==
de¡IfNuÎ
 ? 0 : &
rRhsHasNuÎ
);

82668 
	gaffš™y
 = 
com·risÚAffš™y
(
pEx´
);

82672 
sql™e3Ex´CachePush
(
pP¬£
);

82673 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

82674 
sql™e3Ex´Code
(
pP¬£
, 
pEx´
->
pLeá
, 
r1
);

82680 ifÐ
	geTy³
==
IN_INDEX_NOOP
 ){

82681 
Ex´Li¡
 *
pLi¡
 = 
pEx´
->
x
.pList;

82682 
CÞlSeq
 *
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pEx´
->
pLeá
);

82683 
	gÏb–Ok
 = 
sql™e3VdbeMakeLab–
(
v
);

82684 
	gr2
, 
	g»gToF»e
;

82685 
	g»gCkNuÎ
 = 0;

82686 
	gii
;

82687 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

82688 ifÐ
	gde¡IfNuÎ
!=
de¡IfF®£
 ){

82689 
»gCkNuÎ
 = 
sql™e3G‘TempReg
(
pP¬£
);

82690 
sql™e3VdbeAddOp3
(
v
, 
OP_B™And
, 
r1
,„1, 
»gCkNuÎ
);

82692 
	gii
=0; ii<
	gpLi¡
->
	gnEx´
; ii++){

82693 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pLi¡
->
a
[
ii
].
pEx´
, &
»gToF»e
);

82694 ifÐ
	g»gCkNuÎ
 && 
sql™e3Ex´CªBeNuÎ
(
pLi¡
->
a
[
ii
].
pEx´
) ){

82695 
sql™e3VdbeAddOp3
(
v
, 
OP_B™And
, 
»gCkNuÎ
, 
r2
,„egCkNull);

82697 ifÐ
	gii
<
	gpLi¡
->
	gnEx´
-1 || 
	gde¡IfNuÎ
!=
de¡IfF®£
 ){

82698 
sql™e3VdbeAddOp4
(
v
, 
OP_Eq
, 
r1
, 
Ïb–Ok
, 
r2
,

82699 (*)
pCÞl
, 
P4_COLLSEQ
);

82700 
VdbeCov”ageIf
(
v
, 
ii
<
pLi¡
->
nEx´
-1);

82701 
VdbeCov”ageIf
(
v
, 
ii
==
pLi¡
->
nEx´
-1);

82702 
sql™e3VdbeChªgeP5
(
v
, 
affš™y
);

82704 
as£¹
Ð
de¡IfNuÎ
==
de¡IfF®£
 );

82705 
sql™e3VdbeAddOp4
(
v
, 
OP_Ne
, 
r1
, 
de¡IfF®£
, 
r2
,

82706 (*)
pCÞl
, 
P4_COLLSEQ
); 
VdbeCov”age
(
v
);

82707 
sql™e3VdbeChªgeP5
(
v
, 
affš™y
 | 
SQLITE_JUMPIFNULL
);

82709 
sql™e3R–—£TempReg
(
pP¬£
, 
»gToF»e
);

82711 ifÐ
	g»gCkNuÎ
 ){

82712 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gCkNuÎ
, 
de¡IfNuÎ
); 
VdbeCov”age
(v);

82713 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡IfF®£
);

82715 
sql™e3VdbeResÞveLab–
(
v
, 
Ïb–Ok
);

82716 
sql™e3R–—£TempReg
(
pP¬£
, 
»gCkNuÎ
);

82722 ifÐ
sql™e3Ex´CªBeNuÎ
(
pEx´
->
pLeá
) ){

82723 ifÐ
	gde¡IfNuÎ
==
de¡IfF®£
 ){

82726 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
r1
, 
de¡IfNuÎ
); 
VdbeCov”age
(v);

82728 
	gaddr1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 
r1
); 
VdbeCov”age
(v);

82729 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
pEx´
->
iTabË
, 
de¡IfF®£
);

82730 
VdbeCov”age
(
v
);

82731 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡IfNuÎ
);

82732 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

82736 ifÐ
	geTy³
==
IN_INDEX_ROWID
 ){

82739 
sql™e3VdbeAddOp2
(
v
, 
OP_Mu¡BeIÁ
, 
r1
, 
de¡IfF®£
); 
VdbeCov”age
(v);

82740 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
pEx´
->
iTabË
, 
de¡IfF®£
, 
r1
);

82741 
VdbeCov”age
(
v
);

82745 
sql™e3VdbeAddOp4
(
v
, 
OP_Affš™y
, 
r1
, 1, 0, &
affš™y
, 1);

82753 
as£¹
Ð
de¡IfF®£
!=
de¡IfNuÎ
 || 
rRhsHasNuÎ
==0 );

82754 ifÐ
	grRhsHasNuÎ
==0 ){

82762 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
pEx´
->
iTabË
, 
de¡IfF®£
, 
r1
, 1);

82763 
VdbeCov”age
(
v
);

82769 
	gj1
;

82777 
	gj1
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
pEx´
->
iTabË
, 0, 
r1
, 1);

82778 
VdbeCov”age
(
v
);

82779 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
rRhsHasNuÎ
, 
de¡IfNuÎ
);

82780 
VdbeCov”age
(
v
);

82781 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡IfF®£
);

82782 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

82786 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

82787 
sql™e3Ex´CachePÝ
(
pP¬£
);

82788 
VdbeComm’t
((
v
, "end INƒxpr"));

82795 *
dup8by‹s
(
Vdbe
 *
v
, cÚ¡ *
š
){

82796 *
	gout
 = 
sql™e3DbM®locRaw
(
sql™e3VdbeDb
(
v
), 8);

82797 ifÐ
	gout
 ){

82798 
memýy
(
out
, 
š
, 8);

82800  
	gout
;

82803 #iâdeà
SQLITE_OMIT_FLOATING_POINT


82812 
codeR—l
(
Vdbe
 *
v
, cÚ¡ *
z
, 
Ãg©eFÏg
, 
iMem
){

82813 ifÐ
ALWAYS
(
z
!=0) ){

82814 
v®ue
;

82815 *
	gzV
;

82816 
sql™e3AtoF
(
z
, &
v®ue
, 
sql™e3SŒËn30
(z), 
SQLITE_UTF8
);

82817 
as£¹
Ð!
sql™e3IsNaN
(
v®ue
) );

82818 ifÐ
	gÃg©eFÏg
 ) 
	gv®ue
 = -
v®ue
;

82819 
	gzV
 = 
dup8by‹s
(
v
, (*)&
v®ue
);

82820 
sql™e3VdbeAddOp4
(
v
, 
OP_R—l
, 0, 
iMem
, 0, 
zV
, 
P4_REAL
);

82832 
codeIÁeg”
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
ÃgFÏg
, 
iMem
){

82833 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

82834 ifÐ
	gpEx´
->
	gæags
 & 
	gEP_IÁV®ue
 ){

82835 
	gi
 = 
pEx´
->
u
.
iV®ue
;

82836 
as£¹
Ð
i
>=0 );

82837 ifÐ
	gÃgFÏg
 ) 
	gi
 = -
i
;

82838 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 
iMem
);

82840 
	gc
;

82841 
i64
 
	gv®ue
;

82842 cÚ¡ *
	gz
 = 
pEx´
->
u
.
zTok’
;

82843 
as£¹
Ð
z
!=0 );

82844 
	gc
 = 
sql™e3DecOrHexToI64
(
z
, &
v®ue
);

82845 ifÐ
	gc
==0 || (
c
==2 && 
ÃgFÏg
) ){

82846 *
zV
;

82847 ifÐ
	gÃgFÏg
 ){ 
	gv®ue
 = 
c
==2 ? 
SMALLEST_INT64
 : -
v®ue
; }

82848 
	gzV
 = 
dup8by‹s
(
v
, (*)&
v®ue
);

82849 
sql™e3VdbeAddOp4
(
v
, 
OP_IÁ64
, 0, 
iMem
, 0, 
zV
, 
P4_INT64
);

82851 #ifdeà
SQLITE_OMIT_FLOATING_POINT


82852 
sql™e3E¼ÜMsg
(
pP¬£
, "ov”sized iÁeg”: %s%s", 
ÃgFÏg
 ? "-" : "", 
z
);

82854 #iâdeà
SQLITE_OMIT_HEX_INTEGER


82855 ifÐ
sql™e3_¡ºicmp
(
z
,"0x",2)==0 ){

82856 
sql™e3E¼ÜMsg
(
pP¬£
, "hex†™”®oØbig: %s", 
z
);

82860 
codeR—l
(
v
, 
z
, 
ÃgFÏg
, 
iMem
);

82870 
ÿcheEÁryCË¬
(
P¬£
 *
pP¬£
, 
yCÞCache
 *
p
){

82871 ifÐ
	gp
->
	g‹mpReg
 ){

82872 ifÐ
	gpP¬£
->
	gnTempReg
<
A¼aySize
(
pP¬£
->
aTempReg
) ){

82873 
	gpP¬£
->
	gaTempReg
[
pP¬£
->
nTempReg
++] = 
p
->
iReg
;

82875 
	gp
->
	g‹mpReg
 = 0;

82884 
SQLITE_PRIVATE
 
sql™e3Ex´CacheStÜe
(
P¬£
 *
pP¬£
, 
iTab
, 
iCÞ
, 
iReg
){

82885 
	gi
;

82886 
	gmšLru
;

82887 
	gidxLru
;

82888 
yCÞCache
 *
	gp
;

82890 
as£¹
Ð
iReg
>0 );

82891 
as£¹
Ð
iCÞ
>=-1 && iCol<32768 );

82897 ifÐ
O±imiz©iÚDi§bËd
(
pP¬£
->
db
, 
SQLITE_CÞumnCache
) ) ;

82904 #iâdeà
NDEBUG


82905 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

82906 
as£¹
Ð
p
->
iReg
==0 ||…->
iTabË
!=
iTab
 ||…->
iCÞumn
!=
iCÞ
 );

82911 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

82912 ifÐ
	gp
->
	giReg
==0 ){

82913 
p
->
iLev–
 = 
pP¬£
->
iCacheLev–
;

82914 
	gp
->
	giTabË
 = 
iTab
;

82915 
	gp
->
	giCÞumn
 = 
iCÞ
;

82916 
	gp
->
	giReg
 = 
iReg
;

82917 
	gp
->
	g‹mpReg
 = 0;

82918 
	gp
->
	gÌu
 = 
pP¬£
->
iCacheCÁ
++;

82924 
	gmšLru
 = 0x7fffffff;

82925 
	gidxLru
 = -1;

82926 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

82927 ifÐ
	gp
->
	gÌu
<
	gmšLru
 ){

82928 
	gidxLru
 = 
i
;

82929 
	gmšLru
 = 
p
->
Ìu
;

82932 ifÐ
ALWAYS
(
idxLru
>=0) ){

82933 
p
 = &
pP¬£
->
aCÞCache
[
idxLru
];

82934 
	gp
->
	giLev–
 = 
pP¬£
->
iCacheLev–
;

82935 
	gp
->
	giTabË
 = 
iTab
;

82936 
	gp
->
	giCÞumn
 = 
iCÞ
;

82937 
	gp
->
	giReg
 = 
iReg
;

82938 
	gp
->
	g‹mpReg
 = 0;

82939 
	gp
->
	gÌu
 = 
pP¬£
->
iCacheCÁ
++;

82948 
SQLITE_PRIVATE
 
sql™e3Ex´CacheRemove
(
P¬£
 *
pP¬£
, 
iReg
, 
nReg
){

82949 
	gi
;

82950 
	giLa¡
 = 
iReg
 + 
nReg
 - 1;

82951 
yCÞCache
 *
	gp
;

82952 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

82953 
	gr
 = 
p
->
iReg
;

82954 ifÐ
	gr
>=
iReg
 && 
r
<=
iLa¡
 ){

82955 
ÿcheEÁryCË¬
(
pP¬£
, 
p
);

82956 
	gp
->
	giReg
 = 0;

82966 
SQLITE_PRIVATE
 
sql™e3Ex´CachePush
(
P¬£
 *
pP¬£
){

82967 
	gpP¬£
->
	giCacheLev–
++;

82968 #ifdeà
SQLITE_DEBUG


82969 ifÐ
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeAddÝT¿û
 ){

82970 
´štf
("PUSHØ%d\n", 
pP¬£
->
iCacheLev–
);

82980 
SQLITE_PRIVATE
 
sql™e3Ex´CachePÝ
(
P¬£
 *
pP¬£
){

82981 
	gi
;

82982 
yCÞCache
 *
	gp
;

82983 
as£¹
Ð
pP¬£
->
iCacheLev–
>=1 );

82984 
	gpP¬£
->
	giCacheLev–
--;

82985 #ifdeà
SQLITE_DEBUG


82986 ifÐ
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeAddÝT¿û
 ){

82987 
´štf
("POPØ%d\n", 
pP¬£
->
iCacheLev–
);

82990 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

82991 ifÐ
	gp
->
	giReg
 &&…->
	giLev–
>
	gpP¬£
->
	giCacheLev–
 ){

82992 
ÿcheEÁryCË¬
(
pP¬£
, 
p
);

82993 
	gp
->
	giReg
 = 0;

83004 
sql™e3Ex´CachePšRegi¡”
(
P¬£
 *
pP¬£
, 
iReg
){

83005 
	gi
;

83006 
yCÞCache
 *
	gp
;

83007 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

83008 ifÐ
	gp
->
	giReg
==
iReg
 ){

83009 
p
->
‹mpReg
 = 0;

83017 
SQLITE_PRIVATE
 
sql™e3Ex´CodeG‘CÞumnOfTabË
(

83018 
Vdbe
 *
v
,

83019 
TabË
 *
pTab
,

83020 
iTabCur
,

83021 
iCÞ
,

83022 
»gOut


83024 ifÐ
	giCÞ
<0 || iCÞ==
pTab
->
iPKey
 ){

83025 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iTabCur
, 
»gOut
);

83027 
	gÝ
 = 
IsVœtu®
(
pTab
è? 
OP_VCÞumn
 : 
OP_CÞumn
;

83028 
	gx
 = 
iCÞ
;

83029 ifÐ!
HasRowid
(
pTab
) ){

83030 
	gx
 = 
sql™e3CÞumnOfIndex
(
sql™e3Prim¬yKeyIndex
(
pTab
), 
iCÞ
);

83032 
sql™e3VdbeAddOp3
(
v
, 
Ý
, 
iTabCur
, 
x
, 
»gOut
);

83034 ifÐ
	giCÞ
>=0 ){

83035 
sql™e3CÞumnDeçuÉ
(
v
, 
pTab
, 
iCÞ
, 
»gOut
);

83048 
SQLITE_PRIVATE
 
sql™e3Ex´CodeG‘CÞumn
(

83049 
P¬£
 *
pP¬£
,

83050 
TabË
 *
pTab
,

83051 
iCÞumn
,

83052 
iTabË
,

83053 
iReg
,

83054 
u8
 
p5


83056 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

83057 
	gi
;

83058 
yCÞCache
 *
	gp
;

83060 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

83061 ifÐ
	gp
->
	giReg
>0 &&…->
	giTabË
==
iTabË
 && 
p
->
iCÞumn
==iColumn ){

83062 
p
->
Ìu
 = 
pP¬£
->
iCacheCÁ
++;

83063 
sql™e3Ex´CachePšRegi¡”
(
pP¬£
, 
p
->
iReg
);

83064  
	gp
->
	giReg
;

83067 
as£¹
Ð
v
!=0 );

83068 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iTabË
, 
iCÞumn
, 
iReg
);

83069 ifÐ
	gp5
 ){

83070 
sql™e3VdbeChªgeP5
(
v
, 
p5
);

83072 
sql™e3Ex´CacheStÜe
(
pP¬£
, 
iTabË
, 
iCÞumn
, 
iReg
);

83074  
	giReg
;

83080 
SQLITE_PRIVATE
 
sql™e3Ex´CacheCË¬
(
P¬£
 *
pP¬£
){

83081 
	gi
;

83082 
yCÞCache
 *
	gp
;

83084 #ià
SQLITE_DEBUG


83085 ifÐ
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_VdbeAddÝT¿û
 ){

83086 
´štf
("CLEAR\n");

83089 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

83090 ifÐ
	gp
->
	giReg
 ){

83091 
ÿcheEÁryCË¬
(
pP¬£
, 
p
);

83092 
	gp
->
	giReg
 = 0;

83101 
SQLITE_PRIVATE
 
sql™e3Ex´CacheAffš™yChªge
(
P¬£
 *
pP¬£
, 
iS¹
, 
iCouÁ
){

83102 
sql™e3Ex´CacheRemove
(
pP¬£
, 
iS¹
, 
iCouÁ
);

83109 
SQLITE_PRIVATE
 
sql™e3Ex´CodeMove
(
P¬£
 *
pP¬£
, 
iFrom
, 
iTo
, 
nReg
){

83110 
as£¹
Ð
iFrom
>=
iTo
+
nReg
 || iFrom+nReg<=iTo );

83111 
sql™e3VdbeAddOp3
(
pP¬£
->
pVdbe
, 
OP_Move
, 
iFrom
, 
iTo
, 
nReg
);

83112 
sql™e3Ex´CacheRemove
(
pP¬£
, 
iFrom
, 
nReg
);

83115 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_COVERAGE_TEST
)

83123 
u£dAsCÞumnCache
(
P¬£
 *
pP¬£
, 
iFrom
, 
iTo
){

83124 
	gi
;

83125 
yCÞCache
 *
	gp
;

83126 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

83127 
	gr
 = 
p
->
iReg
;

83128 ifÐ
	gr
>=
iFrom
 && 
r
<=
iTo
 )  1;

83137 
ex´ToRegi¡”
(
Ex´
 *
p
, 
iReg
){

83138 
	gp
->
	gÝ2
 = 
p
->
Ý
;

83139 
	gp
->
	gÝ
 = 
TK_REGISTER
;

83140 
	gp
->
	giTabË
 = 
iReg
;

83141 
Ex´CË¬PrÝ”ty
(
p
, 
EP_Sk
);

83155 
SQLITE_PRIVATE
 
sql™e3Ex´CodeT¬g‘
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
rg‘
){

83156 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

83157 
	gÝ
;

83158 
	gšReg
 = 
rg‘
;

83159 
	g»gF»e1
 = 0;

83160 
	g»gF»e2
 = 0;

83161 
	gr1
, 
	gr2
, 
	gr3
, 
	gr4
;

83162 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

83163 
Ex´
 
	g‹mpX
;

83165 
as£¹
Ð
rg‘
>0 &&¬g‘<=
pP¬£
->
nMem
 );

83166 ifÐ
	gv
==0 ){

83167 
as£¹
Ð
pP¬£
->
db
->
m®locFažed
 );

83171 ifÐ
	gpEx´
==0 ){

83172 
Ý
 = 
TK_NULL
;

83174 
	gÝ
 = 
pEx´
->
Ý
;

83176  
	gÝ
 ){

83177 
	gTK_AGG_COLUMN
: {

83178 
AggInfo
 *
pAggInfo
 = 
pEx´
->pAggInfo;

83179 
AggInfo_cÞ
 *
	gpCÞ
 = &
pAggInfo
->
aCÞ
[
pEx´
->
iAgg
];

83180 ifÐ!
	gpAggInfo
->
	gdœeùMode
 ){

83181 
as£¹
Ð
pCÞ
->
iMem
>0 );

83182 
	gšReg
 = 
pCÞ
->
iMem
;

83184 }ifÐ
	gpAggInfo
->
	gu£SÜtšgIdx
 ){

83185 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
pAggInfo
->
sÜtšgIdxPTab
,

83186 
pCÞ
->
iSÜ‹rCÞumn
, 
rg‘
);

83191 
	gTK_COLUMN
: {

83192 
iTab
 = 
pEx´
->
iTabË
;

83193 ifÐ
	giTab
<0 ){

83194 ifÐ
	gpP¬£
->
	gckBa£
>0 ){

83196 
	gšReg
 = 
pEx´
->
iCÞumn
 + 
pP¬£
->
ckBa£
;

83200 
	giTab
 = 
pP¬£
->
iP¬tIdxTab
;

83203 
	gšReg
 = 
sql™e3Ex´CodeG‘CÞumn
(
pP¬£
, 
pEx´
->
pTab
,

83204 
pEx´
->
iCÞumn
, 
iTab
, 
rg‘
,

83205 
pEx´
->
Ý2
);

83208 
	gTK_INTEGER
: {

83209 
codeIÁeg”
(
pP¬£
, 
pEx´
, 0, 
rg‘
);

83212 #iâdeà
SQLITE_OMIT_FLOATING_POINT


83213 
	gTK_FLOAT
: {

83214 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83215 
codeR—l
(
v
, 
pEx´
->
u
.
zTok’
, 0, 
rg‘
);

83219 
	gTK_STRING
: {

83220 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83221 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
rg‘
, 0, 
pEx´
->
u
.
zTok’
, 0);

83224 
	gTK_NULL
: {

83225 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
rg‘
);

83228 #iâdeà
SQLITE_OMIT_BLOB_LITERAL


83229 
	gTK_BLOB
: {

83230 
n
;

83231 cÚ¡ *
	gz
;

83232 *
	gzBlob
;

83233 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83234 
as£¹
Ð
pEx´
->
u
.
zTok’
[0]=='x' ||…Expr->u.zToken[0]=='X' );

83235 
as£¹
Ð
pEx´
->
u
.
zTok’
[1]=='\'' );

83236 
	gz
 = &
pEx´
->
u
.
zTok’
[2];

83237 
	gn
 = 
sql™e3SŒËn30
(
z
) - 1;

83238 
as£¹
Ð
z
[
n
]=='\'' );

83239 
	gzBlob
 = 
sql™e3HexToBlob
(
sql™e3VdbeDb
(
v
), 
z
, 
n
);

83240 
sql™e3VdbeAddOp4
(
v
, 
OP_Blob
, 
n
/2, 
rg‘
, 0, 
zBlob
, 
P4_DYNAMIC
);

83244 
	gTK_VARIABLE
: {

83245 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83246 
as£¹
Ð
pEx´
->
u
.
zTok’
!=0 );

83247 
as£¹
Ð
pEx´
->
u
.
zTok’
[0]!=0 );

83248 
sql™e3VdbeAddOp2
(
v
, 
OP_V¬ŸbË
, 
pEx´
->
iCÞumn
, 
rg‘
);

83249 ifÐ
	gpEx´
->
	gu
.
	gzTok’
[1]!=0 ){

83250 
as£¹
Ð
pEx´
->
u
.
zTok’
[0]=='?'

83251 || 
¡rcmp
(
pEx´
->
u
.
zTok’
, 
pP¬£
->
azV¬
[pEx´->
iCÞumn
-1])==0 );

83252 
sql™e3VdbeChªgeP4
(
v
, -1, 
pP¬£
->
azV¬
[
pEx´
->
iCÞumn
-1], 
P4_STATIC
);

83256 
	gTK_REGISTER
: {

83257 
šReg
 = 
pEx´
->
iTabË
;

83260 
	gTK_AS
: {

83261 
šReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
->
pLeá
, 
rg‘
);

83264 #iâdeà
SQLITE_OMIT_CAST


83265 
	gTK_CAST
: {

83267 
šReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
->
pLeá
, 
rg‘
);

83268 ifÐ
	gšReg
!=
rg‘
 ){

83269 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
šReg
, 
rg‘
);

83270 
	gšReg
 = 
rg‘
;

83272 
sql™e3VdbeAddOp2
(
v
, 
OP_Ca¡
, 
rg‘
,

83273 
sql™e3Affš™yTy³
(
pEx´
->
u
.
zTok’
, 0));

83274 
‹¡ÿ£
Ð
u£dAsCÞumnCache
(
pP¬£
, 
šReg
, inReg) );

83275 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
šReg
, 1);

83279 
	gTK_LT
:

83280 
TK_LE
:

83281 
TK_GT
:

83282 
TK_GE
:

83283 
TK_NE
:

83284 
TK_EQ
: {

83285 
r1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

83286 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

83287 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

83288 
r1
, 
r2
, 
šReg
, 
SQLITE_STOREP2
);

83289 
as£¹
(
TK_LT
==
OP_Lt
); 
‹¡ÿ£
(
Ý
==OP_Lt); 
VdbeCov”ageIf
(
v
,op==OP_Lt);

83290 
as£¹
(
TK_LE
==
OP_Le
); 
‹¡ÿ£
(
Ý
==OP_Le); 
VdbeCov”ageIf
(
v
,op==OP_Le);

83291 
as£¹
(
TK_GT
==
OP_Gt
); 
‹¡ÿ£
(
Ý
==OP_Gt); 
VdbeCov”ageIf
(
v
,op==OP_Gt);

83292 
as£¹
(
TK_GE
==
OP_Ge
); 
‹¡ÿ£
(
Ý
==OP_Ge); 
VdbeCov”ageIf
(
v
,op==OP_Ge);

83293 
as£¹
(
TK_EQ
==
OP_Eq
); 
‹¡ÿ£
(
Ý
==OP_Eq); 
VdbeCov”ageIf
(
v
,op==OP_Eq);

83294 
as£¹
(
TK_NE
==
OP_Ne
); 
‹¡ÿ£
(
Ý
==OP_Ne); 
VdbeCov”ageIf
(
v
,op==OP_Ne);

83295 
‹¡ÿ£
Ð
»gF»e1
==0 );

83296 
‹¡ÿ£
Ð
»gF»e2
==0 );

83299 
	gTK_IS
:

83300 
TK_ISNOT
: {

83301 
‹¡ÿ£
Ð
Ý
==
TK_IS
 );

83302 
‹¡ÿ£
Ð
Ý
==
TK_ISNOT
 );

83303 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

83304 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

83305 
	gÝ
 = (
Ý
==
TK_IS
è? 
TK_EQ
 : 
TK_NE
;

83306 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

83307 
r1
, 
r2
, 
šReg
, 
SQLITE_STOREP2
 | 
SQLITE_NULLEQ
);

83308 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_EQ
);

83309 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_NE
);

83310 
‹¡ÿ£
Ð
»gF»e1
==0 );

83311 
‹¡ÿ£
Ð
»gF»e2
==0 );

83314 
	gTK_AND
:

83315 
TK_OR
:

83316 
TK_PLUS
:

83317 
TK_STAR
:

83318 
TK_MINUS
:

83319 
TK_REM
:

83320 
TK_BITAND
:

83321 
TK_BITOR
:

83322 
TK_SLASH
:

83323 
TK_LSHIFT
:

83324 
TK_RSHIFT
:

83325 
TK_CONCAT
: {

83326 
as£¹
Ð
TK_AND
==
OP_And
 ); 
‹¡ÿ£
Ð
Ý
==TK_AND );

83327 
as£¹
Ð
TK_OR
==
OP_Or
 ); 
‹¡ÿ£
Ð
Ý
==TK_OR );

83328 
as£¹
Ð
TK_PLUS
==
OP_Add
 ); 
‹¡ÿ£
Ð
Ý
==TK_PLUS );

83329 
as£¹
Ð
TK_MINUS
==
OP_SubŒaù
 ); 
‹¡ÿ£
Ð
Ý
==TK_MINUS );

83330 
as£¹
Ð
TK_REM
==
OP_Remašd”
 ); 
‹¡ÿ£
Ð
Ý
==TK_REM );

83331 
as£¹
Ð
TK_BITAND
==
OP_B™And
 ); 
‹¡ÿ£
Ð
Ý
==TK_BITAND );

83332 
as£¹
Ð
TK_BITOR
==
OP_B™Or
 ); 
‹¡ÿ£
Ð
Ý
==TK_BITOR );

83333 
as£¹
Ð
TK_SLASH
==
OP_Divide
 ); 
‹¡ÿ£
Ð
Ý
==TK_SLASH );

83334 
as£¹
Ð
TK_LSHIFT
==
OP_ShiáLeá
 ); 
‹¡ÿ£
Ð
Ý
==TK_LSHIFT );

83335 
as£¹
Ð
TK_RSHIFT
==
OP_ShiáRight
 ); 
‹¡ÿ£
Ð
Ý
==TK_RSHIFT );

83336 
as£¹
Ð
TK_CONCAT
==
OP_CÚÿt
 ); 
‹¡ÿ£
Ð
Ý
==TK_CONCAT );

83337 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

83338 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

83339 
sql™e3VdbeAddOp3
(
v
, 
Ý
, 
r2
, 
r1
, 
rg‘
);

83340 
‹¡ÿ£
Ð
»gF»e1
==0 );

83341 
‹¡ÿ£
Ð
»gF»e2
==0 );

83344 
	gTK_UMINUS
: {

83345 
Ex´
 *
pLeá
 = 
pEx´
->pLeft;

83346 
as£¹
Ð
pLeá
 );

83347 ifÐ
	gpLeá
->
	gÝ
==
TK_INTEGER
 ){

83348 
codeIÁeg”
(
pP¬£
, 
pLeá
, 1, 
rg‘
);

83349 #iâdeà
SQLITE_OMIT_FLOATING_POINT


83350 }ifÐ
	gpLeá
->
	gÝ
==
TK_FLOAT
 ){

83351 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83352 
codeR—l
(
v
, 
pLeá
->
u
.
zTok’
, 1, 
rg‘
);

83355 
	g‹mpX
.
	gÝ
 = 
TK_INTEGER
;

83356 
	g‹mpX
.
	gæags
 = 
EP_IÁV®ue
|
EP_Tok’OÆy
;

83357 
	g‹mpX
.
	gu
.
	giV®ue
 = 0;

83358 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, &
‹mpX
, &
»gF»e1
);

83359 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e2
);

83360 
sql™e3VdbeAddOp3
(
v
, 
OP_SubŒaù
, 
r2
, 
r1
, 
rg‘
);

83361 
‹¡ÿ£
Ð
»gF»e2
==0 );

83363 
	gšReg
 = 
rg‘
;

83366 
	gTK_BITNOT
:

83367 
TK_NOT
: {

83368 
as£¹
Ð
TK_BITNOT
==
OP_B™NÙ
 ); 
‹¡ÿ£
Ð
Ý
==TK_BITNOT );

83369 
as£¹
Ð
TK_NOT
==
OP_NÙ
 ); 
‹¡ÿ£
Ð
Ý
==TK_NOT );

83370 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

83371 
‹¡ÿ£
Ð
»gF»e1
==0 );

83372 
	gšReg
 = 
rg‘
;

83373 
sql™e3VdbeAddOp2
(
v
, 
Ý
, 
r1
, 
šReg
);

83376 
	gTK_ISNULL
:

83377 
TK_NOTNULL
: {

83378 
addr
;

83379 
as£¹
Ð
TK_ISNULL
==
OP_IsNuÎ
 ); 
‹¡ÿ£
Ð
Ý
==TK_ISNULL );

83380 
as£¹
Ð
TK_NOTNULL
==
OP_NÙNuÎ
 ); 
‹¡ÿ£
Ð
Ý
==TK_NOTNULL );

83381 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
rg‘
);

83382 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

83383 
‹¡ÿ£
Ð
»gF»e1
==0 );

83384 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
Ý
, 
r1
);

83385 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_ISNULL
);

83386 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_NOTNULL
);

83387 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
rg‘
);

83388 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

83391 
	gTK_AGG_FUNCTION
: {

83392 
AggInfo
 *
pInfo
 = 
pEx´
->
pAggInfo
;

83393 ifÐ
	gpInfo
==0 ){

83394 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83395 
sql™e3E¼ÜMsg
(
pP¬£
, "misu£ oàagg»g©e: %s()", 
pEx´
->
u
.
zTok’
);

83397 
	gšReg
 = 
pInfo
->
aFunc
[
pEx´
->
iAgg
].
iMem
;

83401 
	gTK_FUNCTION
: {

83402 
Ex´Li¡
 *
pF¬g
;

83403 
	gnF¬g
;

83404 
FuncDef
 *
	gpDef
;

83405 
	gnId
;

83406 cÚ¡ *
	gzId
;

83407 
u32
 
	gcÚ¡Mask
 = 0;

83408 
	gi
;

83409 
u8
 
	g’c
 = 
ENC
(
db
);

83410 
CÞlSeq
 *
	gpCÞl
 = 0;

83412 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

83413 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
) ){

83414 
	gpF¬g
 = 0;

83416 
	gpF¬g
 = 
pEx´
->
x
.
pLi¡
;

83418 
	gnF¬g
 = 
pF¬g
 ?…F¬g->
nEx´
 : 0;

83419 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83420 
	gzId
 = 
pEx´
->
u
.
zTok’
;

83421 
	gnId
 = 
sql™e3SŒËn30
(
zId
);

83422 
	gpDef
 = 
sql™e3FšdFunùiÚ
(
db
, 
zId
, 
nId
, 
nF¬g
, 
’c
, 0);

83423 ifÐ
	gpDef
==0 || 
pDef
->
xFunc
==0 ){

83424 
sql™e3E¼ÜMsg
(
pP¬£
, "unknowÀfunùiÚ: %.*s()", 
nId
, 
zId
);

83432 ifÐ
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_COALESCE
 ){

83433 
	g’dCßËsû
 = 
sql™e3VdbeMakeLab–
(
v
);

83434 
as£¹
Ð
nF¬g
>=2 );

83435 
sql™e3Ex´Code
(
pP¬£
, 
pF¬g
->
a
[0].
pEx´
, 
rg‘
);

83436 
	gi
=1; i<
	gnF¬g
; i++){

83437 
sql™e3VdbeAddOp2
(
v
, 
OP_NÙNuÎ
, 
rg‘
, 
’dCßËsû
);

83438 
VdbeCov”age
(
v
);

83439 
sql™e3Ex´CacheRemove
(
pP¬£
, 
rg‘
, 1);

83440 
sql™e3Ex´CachePush
(
pP¬£
);

83441 
sql™e3Ex´Code
(
pP¬£
, 
pF¬g
->
a
[
i
].
pEx´
, 
rg‘
);

83442 
sql™e3Ex´CachePÝ
(
pP¬£
);

83444 
sql™e3VdbeResÞveLab–
(
v
, 
’dCßËsû
);

83451 ifÐ
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_UNLIKELY
 ){

83452 
as£¹
Ð
nF¬g
>=1 );

83453 
sql™e3Ex´Code
(
pP¬£
, 
pF¬g
->
a
[0].
pEx´
, 
rg‘
);

83457 
	gi
=0; i<
	gnF¬g
; i++){

83458 ifÐ
	gi
<32 && 
sql™e3Ex´IsCÚ¡ªt
(
pF¬g
->
a
[
i
].
pEx´
) ){

83459 
‹¡ÿ£
Ð
i
==31 );

83460 
	gcÚ¡Mask
 |ð
MASKBIT32
(
i
);

83462 ifÐ(
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_NEEDCOLL
)!=0 && !
pCÞl
 ){

83463 
pCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pF¬g
->
a
[
i
].
pEx´
);

83466 ifÐ
	gpF¬g
 ){

83467 ifÐ
	gcÚ¡Mask
 ){

83468 
	gr1
 = 
pP¬£
->
nMem
+1;

83469 
	gpP¬£
->
	gnMem
 +ð
nF¬g
;

83471 
	gr1
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nF¬g
);

83479 ifÐ(
	gpDef
->
	gfuncFÏgs
 & (
	gSQLITE_FUNC_LENGTH
|
	gSQLITE_FUNC_TYPEOF
))!=0 ){

83480 
u8
 
ex´Op
;

83481 
as£¹
Ð
nF¬g
==1 );

83482 
as£¹
Ð
pF¬g
->
a
[0].
pEx´
!=0 );

83483 
	gex´Op
 = 
pF¬g
->
a
[0].
pEx´
->
Ý
;

83484 ifÐ
	gex´Op
==
TK_COLUMN
 || 
ex´Op
==
TK_AGG_COLUMN
 ){

83485 
as£¹
Ð
SQLITE_FUNC_LENGTH
==
OPFLAG_LENGTHARG
 );

83486 
as£¹
Ð
SQLITE_FUNC_TYPEOF
==
OPFLAG_TYPEOFARG
 );

83487 
‹¡ÿ£
Ð
pDef
->
funcFÏgs
 & 
OPFLAG_LENGTHARG
 );

83488 
	gpF¬g
->
	ga
[0].
	gpEx´
->
	gÝ2
 =

83489 
pDef
->
funcFÏgs
 & (
OPFLAG_LENGTHARG
|
OPFLAG_TYPEOFARG
);

83493 
sql™e3Ex´CachePush
(
pP¬£
);

83494 
sql™e3Ex´CodeEx´Li¡
(
pP¬£
, 
pF¬g
, 
r1
,

83495 
SQLITE_ECEL_DUP
|
SQLITE_ECEL_FACTOR
);

83496 
sql™e3Ex´CachePÝ
(
pP¬£
);

83498 
	gr1
 = 0;

83500 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


83513 ifÐ
	gnF¬g
>=2 && (
pEx´
->
æags
 & 
EP_InfixFunc
) ){

83514 
pDef
 = 
sql™e3VbOv”lßdFunùiÚ
(
db
,…Def, 
nF¬g
, 
pF¬g
->
a
[1].
pEx´
);

83515 }ifÐ
	gnF¬g
>0 ){

83516 
	gpDef
 = 
sql™e3VbOv”lßdFunùiÚ
(
db
, 
pDef
, 
nF¬g
, 
pF¬g
->
a
[0].
pEx´
);

83519 ifÐ
	gpDef
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_NEEDCOLL
 ){

83520 ifÐ!
	gpCÞl
 )…CÞÈð
db
->
pDætCÞl
;

83521 
sql™e3VdbeAddOp4
(
v
, 
OP_CÞlSeq
, 0, 0, 0, (*)
pCÞl
, 
P4_COLLSEQ
);

83523 
sql™e3VdbeAddOp4
(
v
, 
OP_FunùiÚ
, 
cÚ¡Mask
, 
r1
, 
rg‘
,

83524 (*)
pDef
, 
P4_FUNCDEF
);

83525 
sql™e3VdbeChªgeP5
(
v
, (
u8
)
nF¬g
);

83526 ifÐ
	gnF¬g
 && 
	gcÚ¡Mask
==0 ){

83527 
sql™e3R–—£TempRªge
(
pP¬£
, 
r1
, 
nF¬g
);

83531 #iâdeà
SQLITE_OMIT_SUBQUERY


83532 
	gTK_EXISTS
:

83533 
TK_SELECT
: {

83534 
‹¡ÿ£
Ð
Ý
==
TK_EXISTS
 );

83535 
‹¡ÿ£
Ð
Ý
==
TK_SELECT
 );

83536 
	gšReg
 = 
sql™e3CodeSub£Ëù
(
pP¬£
, 
pEx´
, 0, 0);

83539 
	gTK_IN
: {

83540 
de¡IfF®£
 = 
sql™e3VdbeMakeLab–
(
v
);

83541 
	gde¡IfNuÎ
 = 
sql™e3VdbeMakeLab–
(
v
);

83542 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
rg‘
);

83543 
sql™e3Ex´CodeIN
(
pP¬£
, 
pEx´
, 
de¡IfF®£
, 
de¡IfNuÎ
);

83544 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
rg‘
);

83545 
sql™e3VdbeResÞveLab–
(
v
, 
de¡IfF®£
);

83546 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 
rg‘
, 0);

83547 
sql™e3VdbeResÞveLab–
(
v
, 
de¡IfNuÎ
);

83564 
	gTK_BETWEEN
: {

83565 
Ex´
 *
pLeá
 = 
pEx´
->pLeft;

83566 
Ex´Li¡_™em
 *
	gpLI‹m
 = 
pEx´
->
x
.
pLi¡
->
a
;

83567 
Ex´
 *
	gpRight
 = 
pLI‹m
->
pEx´
;

83569 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pLeá
, &
»gF»e1
);

83570 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pRight
, &
»gF»e2
);

83571 
‹¡ÿ£
Ð
»gF»e1
==0 );

83572 
‹¡ÿ£
Ð
»gF»e2
==0 );

83573 
	gr3
 = 
sql™e3G‘TempReg
(
pP¬£
);

83574 
	gr4
 = 
sql™e3G‘TempReg
(
pP¬£
);

83575 
codeCom·»
(
pP¬£
, 
pLeá
, 
pRight
, 
OP_Ge
,

83576 
r1
, 
r2
, 
r3
, 
SQLITE_STOREP2
); 
VdbeCov”age
(
v
);

83577 
	gpLI‹m
++;

83578 
	gpRight
 = 
pLI‹m
->
pEx´
;

83579 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e2
);

83580 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pRight
, &
»gF»e2
);

83581 
‹¡ÿ£
Ð
»gF»e2
==0 );

83582 
codeCom·»
(
pP¬£
, 
pLeá
, 
pRight
, 
OP_Le
, 
r1
, 
r2
, 
r4
, 
SQLITE_STOREP2
);

83583 
VdbeCov”age
(
v
);

83584 
sql™e3VdbeAddOp3
(
v
, 
OP_And
, 
r3
, 
r4
, 
rg‘
);

83585 
sql™e3R–—£TempReg
(
pP¬£
, 
r3
);

83586 
sql™e3R–—£TempReg
(
pP¬£
, 
r4
);

83589 
	gTK_COLLATE
:

83590 
TK_UPLUS
: {

83591 
šReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
->
pLeá
, 
rg‘
);

83595 
	gTK_TRIGGER
: {

83621 
TabË
 *
pTab
 = 
pEx´
->pTab;

83622 
	gp1
 = 
pEx´
->
iTabË
 * (
pTab
->
nCÞ
+1è+ 1 +…Ex´->
iCÞumn
;

83624 
as£¹
Ð
pEx´
->
iTabË
==0 ||…Expr->iTable==1 );

83625 
as£¹
Ð
pEx´
->
iCÞumn
>=-1 &&…Ex´->iCÞumn<
pTab
->
nCÞ
 );

83626 
as£¹
Ð
pTab
->
iPKey
<0 || 
pEx´
->
iCÞumn
!=pTab->iPKey );

83627 
as£¹
Ð
p1
>=0 &&…1<(
pTab
->
nCÞ
*2+2) );

83629 
sql™e3VdbeAddOp2
(
v
, 
OP_P¬am
, 
p1
, 
rg‘
);

83630 
VdbeComm’t
((
v
, "%s.%s -> $%d",

83631 (
pEx´
->
iTabË
 ? "new" : "old"),

83632 (
pEx´
->
iCÞumn
<0 ? "rowid" :…Ex´->
pTab
->
aCÞ
[pEx´->iCÞumn].
zName
),

83633 
rg‘


83636 #iâdeà
SQLITE_OMIT_FLOATING_POINT


83639 ifÐ
	gpEx´
->
	giCÞumn
>=0

83640 && 
pTab
->
aCÞ
[
pEx´
->
iCÞumn
].
affš™y
==
SQLITE_AFF_REAL


83642 
sql™e3VdbeAddOp1
(
v
, 
OP_R—lAffš™y
, 
rg‘
);

83670 : 
as£¹
Ð
Ý
==
TK_CASE
 ); {

83671 
	g’dLab–
;

83672 
	gÃxtCa£
;

83673 
	gnEx´
;

83674 
	gi
;

83675 
Ex´Li¡
 *
	gpELi¡
;

83676 
Ex´Li¡_™em
 *
	gaLi¡–em
;

83677 
Ex´
 
	gÝCom·»
;

83678 
Ex´
 *
	gpX
;

83679 
Ex´
 *
	gpTe¡
 = 0;

83680 
VVA_ONLY
Ð
iCacheLev–
 = 
pP¬£
->iCacheLevel; )

83682 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
è&&…Ex´->
x
.
pLi¡
 );

83683 
as£¹
(
pEx´
->
x
.
pLi¡
->
nEx´
 > 0);

83684 
	gpELi¡
 = 
pEx´
->
x
.
pLi¡
;

83685 
	gaLi¡–em
 = 
pELi¡
->
a
;

83686 
	gnEx´
 = 
pELi¡
->
nEx´
;

83687 
	g’dLab–
 = 
sql™e3VdbeMakeLab–
(
v
);

83688 ifÐ(
	gpX
 = 
pEx´
->
pLeá
)!=0 ){

83689 
‹mpX
 = *
pX
;

83690 
‹¡ÿ£
Ð
pX
->
Ý
==
TK_COLUMN
 );

83691 
ex´ToRegi¡”
(&
‹mpX
, 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pX
, &
»gF»e1
));

83692 
‹¡ÿ£
Ð
»gF»e1
==0 );

83693 
	gÝCom·»
.
	gÝ
 = 
TK_EQ
;

83694 
	gÝCom·»
.
	gpLeá
 = &
‹mpX
;

83695 
	gpTe¡
 = &
ÝCom·»
;

83700 
	g»gF»e1
 = 0;

83702 
	gi
=0; i<
	gnEx´
-1; i=
i
+2){

83703 
sql™e3Ex´CachePush
(
pP¬£
);

83704 ifÐ
	gpX
 ){

83705 
as£¹
Ð
pTe¡
!=0 );

83706 
	gÝCom·»
.
	gpRight
 = 
aLi¡–em
[
i
].
pEx´
;

83708 
	gpTe¡
 = 
aLi¡–em
[
i
].
pEx´
;

83710 
	gÃxtCa£
 = 
sql™e3VdbeMakeLab–
(
v
);

83711 
‹¡ÿ£
Ð
pTe¡
->
Ý
==
TK_COLUMN
 );

83712 
sql™e3Ex´IfF®£
(
pP¬£
, 
pTe¡
, 
ÃxtCa£
, 
SQLITE_JUMPIFNULL
);

83713 
‹¡ÿ£
Ð
aLi¡–em
[
i
+1].
pEx´
->
Ý
==
TK_COLUMN
 );

83714 
sql™e3Ex´Code
(
pP¬£
, 
aLi¡–em
[
i
+1].
pEx´
, 
rg‘
);

83715 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
’dLab–
);

83716 
sql™e3Ex´CachePÝ
(
pP¬£
);

83717 
sql™e3VdbeResÞveLab–
(
v
, 
ÃxtCa£
);

83719 ifÐ(
	gnEx´
&1)!=0 ){

83720 
sql™e3Ex´CachePush
(
pP¬£
);

83721 
sql™e3Ex´Code
(
pP¬£
, 
pELi¡
->
a
[
nEx´
-1].
pEx´
, 
rg‘
);

83722 
sql™e3Ex´CachePÝ
(
pP¬£
);

83724 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
rg‘
);

83726 
as£¹
Ð
db
->
m®locFažed
 || 
pP¬£
->
nE¼
>0

83727 || 
pP¬£
->
iCacheLev–
==iCacheLevel );

83728 
sql™e3VdbeResÞveLab–
(
v
, 
’dLab–
);

83731 #iâdeà
SQLITE_OMIT_TRIGGER


83732 
	gTK_RAISE
: {

83733 
as£¹
Ð
pEx´
->
affš™y
==
OE_RÞlback


83734 || 
pEx´
->
affš™y
==
OE_AbÜt


83735 || 
pEx´
->
affš™y
==
OE_Faž


83736 || 
pEx´
->
affš™y
==
OE_IgnÜe


83738 ifÐ!
	gpP¬£
->
	gpTrigg”Tab
 ){

83739 
sql™e3E¼ÜMsg
(
pP¬£
,

83743 ifÐ
	gpEx´
->
	gaffš™y
==
OE_AbÜt
 ){

83744 
sql™e3MayAbÜt
(
pP¬£
);

83746 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

83747 ifÐ
	gpEx´
->
	gaffš™y
==
OE_IgnÜe
 ){

83748 
sql™e3VdbeAddOp4
(

83749 
v
, 
OP_H®t
, 
SQLITE_OK
, 
OE_IgnÜe
, 0, 
pEx´
->
u
.
zTok’
,0);

83750 
VdbeCov”age
(
v
);

83752 
sql™e3H®tCÚ¡¿št
(
pP¬£
, 
SQLITE_CONSTRAINT_TRIGGER
,

83753 
pEx´
->
affš™y
,…Ex´->
u
.
zTok’
, 0, 0);

83760 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e1
);

83761 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e2
);

83762  
	gšReg
;

83768 
SQLITE_PRIVATE
 
sql™e3Ex´CodeAtIn™
(

83769 
P¬£
 *
pP¬£
,

83770 
Ex´
 *
pEx´
,

83771 
»gDe¡
,

83772 
u8
 
»u§bË


83774 
Ex´Li¡
 *
	gp
;

83775 
as£¹
Ð
CÚ¡FaùÜOk
(
pP¬£
) );

83776 
	gp
 = 
pP¬£
->
pCÚ¡Ex´
;

83777 
	gpEx´
 = 
sql™e3Ex´Dup
(
pP¬£
->
db
, 
pEx´
, 0);

83778 
	gp
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
p
, 
pEx´
);

83779 ifÐ
	gp
 ){

83780 
Ex´Li¡_™em
 *
	gpI‹m
 = &
p
->
a
[p->
nEx´
-1];

83781 
	gpI‹m
->
	gu
.
	giCÚ¡Ex´Reg
 = 
»gDe¡
;

83782 
	gpI‹m
->
	g»u§bË
 = 
»u§bË
;

83784 
	gpP¬£
->
	gpCÚ¡Ex´
 = 
p
;

83800 
SQLITE_PRIVATE
 
sql™e3Ex´CodeTemp
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, *
pReg
){

83801 
	gr2
;

83802 
	gpEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pEx´
);

83803 ifÐ
CÚ¡FaùÜOk
(
pP¬£
)

83804 && 
	gpEx´
->
	gÝ
!=
TK_REGISTER


83805 && 
sql™e3Ex´IsCÚ¡ªtNÙJoš
(
pEx´
)

83807 
Ex´Li¡
 *
p
 = 
pP¬£
->
pCÚ¡Ex´
;

83808 
	gi
;

83809 *
	gpReg
 = 0;

83810 ifÐ
	gp
 ){

83811 
Ex´Li¡_™em
 *
	gpI‹m
;

83812 
	gpI‹m
=
p
->
a
, 
	gi
õ->
nEx´
; i>0;…Item++, i--){

83813 ifÐ
	gpI‹m
->
	g»u§bË
 && 
sql™e3Ex´Com·»
(
pI‹m
->
pEx´
,pExpr,-1)==0 ){

83814  
pI‹m
->
u
.
iCÚ¡Ex´Reg
;

83818 
	gr2
 = ++
pP¬£
->
nMem
;

83819 
sql™e3Ex´CodeAtIn™
(
pP¬£
, 
pEx´
, 
r2
, 1);

83821 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

83822 
	gr2
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
, 
r1
);

83823 ifÐ
	gr2
==
r1
 ){

83824 *
pReg
 = 
r1
;

83826 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

83827 *
	gpReg
 = 0;

83830  
	gr2
;

83838 
SQLITE_PRIVATE
 
sql™e3Ex´Code
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
rg‘
){

83839 
	gšReg
;

83841 
as£¹
Ð
rg‘
>0 &&¬g‘<=
pP¬£
->
nMem
 );

83842 ifÐ
	gpEx´
 &&…Ex´->
	gÝ
==
TK_REGISTER
 ){

83843 
sql™e3VdbeAddOp2
(
pP¬£
->
pVdbe
, 
OP_CÝy
, 
pEx´
->
iTabË
, 
rg‘
);

83845 
	gšReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
, 
rg‘
);

83846 
as£¹
Ð
pP¬£
->
pVdbe
 ||…P¬£->
db
->
m®locFažed
 );

83847 ifÐ
	gšReg
!=
rg‘
 && 
pP¬£
->
pVdbe
 ){

83848 
sql™e3VdbeAddOp2
(
pP¬£
->
pVdbe
, 
OP_SCÝy
, 
šReg
, 
rg‘
);

83859 
SQLITE_PRIVATE
 
sql™e3Ex´CodeFaùÜabË
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
rg‘
){

83860 ifÐ
	gpP¬£
->
	gokCÚ¡FaùÜ
 && 
sql™e3Ex´IsCÚ¡ªt
(
pEx´
) ){

83861 
sql™e3Ex´CodeAtIn™
(
pP¬£
, 
pEx´
, 
rg‘
, 0);

83863 
sql™e3Ex´Code
(
pP¬£
, 
pEx´
, 
rg‘
);

83879 
SQLITE_PRIVATE
 
sql™e3Ex´CodeAndCache
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
rg‘
){

83880 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

83881 
	giMem
;

83883 
as£¹
Ð
rg‘
>0 );

83884 
as£¹
Ð
pEx´
->
Ý
!=
TK_REGISTER
 );

83885 
sql™e3Ex´Code
(
pP¬£
, 
pEx´
, 
rg‘
);

83886 
	giMem
 = ++
pP¬£
->
nMem
;

83887 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
rg‘
, 
iMem
);

83888 
ex´ToRegi¡”
(
pEx´
, 
iMem
);

83891 #ifdeà
SQLITE_DEBUG


83895 
SQLITE_PRIVATE
 
sql™e3T»eV›wEx´
(
T»eV›w
 *
pV›w
, cÚ¡ 
Ex´
 *
pEx´
, 
u8
 
mÜeToFÞlow
){

83896 cÚ¡ *
	gzBšOp
 = 0;

83897 cÚ¡ *
	gzUniOp
 = 0;

83898 
	gpV›w
 = 
sql™e3T»eV›wPush
(
pV›w
, 
mÜeToFÞlow
);

83899 ifÐ
	gpEx´
==0 ){

83900 
sql™e3T»eV›wLše
(
pV›w
, "nil");

83901 
sql™e3T»eV›wPÝ
(
pV›w
);

83904  
	gpEx´
->
	gÝ
 ){

83905 
	gTK_AGG_COLUMN
: {

83906 
sql™e3T»eV›wLše
(
pV›w
, "AGG{%d:%d}",

83907 
pEx´
->
iTabË
,…Ex´->
iCÞumn
);

83910 
	gTK_COLUMN
: {

83911 ifÐ
pEx´
->
iTabË
<0 ){

83913 
sql™e3T»eV›wLše
(
pV›w
, "COLUMN(%d)", 
pEx´
->
iCÞumn
);

83915 
sql™e3T»eV›wLše
(
pV›w
, "{%d:%d}",

83916 
pEx´
->
iTabË
,…Ex´->
iCÞumn
);

83920 
	gTK_INTEGER
: {

83921 ifÐ
pEx´
->
æags
 & 
EP_IÁV®ue
 ){

83922 
sql™e3T»eV›wLše
(
pV›w
, "%d", 
pEx´
->
u
.
iV®ue
);

83924 
sql™e3T»eV›wLše
(
pV›w
, "%s", 
pEx´
->
u
.
zTok’
);

83928 #iâdeà
SQLITE_OMIT_FLOATING_POINT


83929 
	gTK_FLOAT
: {

83930 
sql™e3T»eV›wLše
(
pV›w
,"%s", 
pEx´
->
u
.
zTok’
);

83934 
	gTK_STRING
: {

83935 
sql™e3T»eV›wLše
(
pV›w
,"%Q", 
pEx´
->
u
.
zTok’
);

83938 
	gTK_NULL
: {

83939 
sql™e3T»eV›wLše
(
pV›w
,"NULL");

83942 #iâdeà
SQLITE_OMIT_BLOB_LITERAL


83943 
	gTK_BLOB
: {

83944 
sql™e3T»eV›wLše
(
pV›w
,"%s", 
pEx´
->
u
.
zTok’
);

83948 
	gTK_VARIABLE
: {

83949 
sql™e3T»eV›wLše
(
pV›w
,"VARIABLE(%s,%d)",

83950 
pEx´
->
u
.
zTok’
,…Ex´->
iCÞumn
);

83953 
	gTK_REGISTER
: {

83954 
sql™e3T»eV›wLše
(
pV›w
,"REGISTER(%d)", 
pEx´
->
iTabË
);

83957 
	gTK_AS
: {

83958 
sql™e3T»eV›wLše
(
pV›w
,"AS %Q", 
pEx´
->
u
.
zTok’
);

83959 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 0);

83962 
	gTK_ID
: {

83963 
sql™e3T»eV›wLše
(
pV›w
,"ID %Q", 
pEx´
->
u
.
zTok’
);

83966 #iâdeà
SQLITE_OMIT_CAST


83967 
	gTK_CAST
: {

83969 
sql™e3T»eV›wLše
(
pV›w
,"CAST %Q", 
pEx´
->
u
.
zTok’
);

83970 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 0);

83974 
	gTK_LT
: 
zBšOp
 = "LT"; ;

83975 
	gTK_LE
: 
zBšOp
 = "LE"; ;

83976 
	gTK_GT
: 
zBšOp
 = "GT"; ;

83977 
	gTK_GE
: 
zBšOp
 = "GE"; ;

83978 
	gTK_NE
: 
zBšOp
 = "NE"; ;

83979 
	gTK_EQ
: 
zBšOp
 = "EQ"; ;

83980 
	gTK_IS
: 
zBšOp
 = "IS"; ;

83981 
	gTK_ISNOT
: 
zBšOp
 = "ISNOT"; ;

83982 
	gTK_AND
: 
zBšOp
 = "AND"; ;

83983 
	gTK_OR
: 
zBšOp
 = "OR"; ;

83984 
	gTK_PLUS
: 
zBšOp
 = "ADD"; ;

83985 
	gTK_STAR
: 
zBšOp
 = "MUL"; ;

83986 
	gTK_MINUS
: 
zBšOp
 = "SUB"; ;

83987 
	gTK_REM
: 
zBšOp
 = "REM"; ;

83988 
	gTK_BITAND
: 
zBšOp
 = "BITAND"; ;

83989 
	gTK_BITOR
: 
zBšOp
 = "BITOR"; ;

83990 
	gTK_SLASH
: 
zBšOp
 = "DIV"; ;

83991 
	gTK_LSHIFT
: 
zBšOp
 = "LSHIFT"; ;

83992 
	gTK_RSHIFT
: 
zBšOp
 = "RSHIFT"; ;

83993 
	gTK_CONCAT
: 
zBšOp
 = "CONCAT"; ;

83994 
	gTK_DOT
: 
zBšOp
 = "DOT"; ;

83996 
	gTK_UMINUS
: 
zUniOp
 = "UMINUS"; ;

83997 
	gTK_UPLUS
: 
zUniOp
 = "UPLUS"; ;

83998 
	gTK_BITNOT
: 
zUniOp
 = "BITNOT"; ;

83999 
	gTK_NOT
: 
zUniOp
 = "NOT"; ;

84000 
	gTK_ISNULL
: 
zUniOp
 = "ISNULL"; ;

84001 
	gTK_NOTNULL
: 
zUniOp
 = "NOTNULL"; ;

84003 
	gTK_COLLATE
: {

84004 
sql™e3T»eV›wLše
(
pV›w
, "COLLATE %Q", 
pEx´
->
u
.
zTok’
);

84005 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 0);

84009 
	gTK_AGG_FUNCTION
:

84010 
TK_FUNCTION
: {

84011 
Ex´Li¡
 *
pF¬g
;

84012 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
) ){

84013 
	gpF¬g
 = 0;

84015 
	gpF¬g
 = 
pEx´
->
x
.
pLi¡
;

84017 ifÐ
	gpEx´
->
	gÝ
==
TK_AGG_FUNCTION
 ){

84018 
sql™e3T»eV›wLše
(
pV›w
, "AGG_FUNCTION%d %Q",

84019 
pEx´
->
Ý2
,…Ex´->
u
.
zTok’
);

84021 
sql™e3T»eV›wLše
(
pV›w
, "FUNCTION %Q", 
pEx´
->
u
.
zTok’
);

84023 ifÐ
	gpF¬g
 ){

84024 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
pF¬g
, 0, 0);

84028 #iâdeà
SQLITE_OMIT_SUBQUERY


84029 
	gTK_EXISTS
: {

84030 
sql™e3T»eV›wLše
(
pV›w
, "EXISTS-expr");

84031 
sql™e3T»eV›wS–eù
(
pV›w
, 
pEx´
->
x
.
pS–eù
, 0);

84034 
	gTK_SELECT
: {

84035 
sql™e3T»eV›wLše
(
pV›w
, "SELECT-expr");

84036 
sql™e3T»eV›wS–eù
(
pV›w
, 
pEx´
->
x
.
pS–eù
, 0);

84039 
	gTK_IN
: {

84040 
sql™e3T»eV›wLše
(
pV›w
, "IN");

84041 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 1);

84042 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

84043 
sql™e3T»eV›wS–eù
(
pV›w
, 
pEx´
->
x
.
pS–eù
, 0);

84045 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
pEx´
->
x
.
pLi¡
, 0, 0);

84062 
	gTK_BETWEEN
: {

84063 
Ex´
 *
pX
 = 
pEx´
->
pLeá
;

84064 
Ex´
 *
	gpY
 = 
pEx´
->
x
.
pLi¡
->
a
[0].pExpr;

84065 
Ex´
 *
	gpZ
 = 
pEx´
->
x
.
pLi¡
->
a
[1].pExpr;

84066 
sql™e3T»eV›wLše
(
pV›w
, "BETWEEN");

84067 
sql™e3T»eV›wEx´
(
pV›w
, 
pX
, 1);

84068 
sql™e3T»eV›wEx´
(
pV›w
, 
pY
, 1);

84069 
sql™e3T»eV›wEx´
(
pV›w
, 
pZ
, 0);

84072 
	gTK_TRIGGER
: {

84080 
sql™e3T»eV›wLše
(
pV›w
, "%s(%d)",

84081 
pEx´
->
iTabË
 ? "NEW" : "OLD",…Ex´->
iCÞumn
);

84084 
	gTK_CASE
: {

84085 
sql™e3T»eV›wLše
(
pV›w
, "CASE");

84086 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 1);

84087 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
pEx´
->
x
.
pLi¡
, 0, 0);

84090 #iâdeà
SQLITE_OMIT_TRIGGER


84091 
	gTK_RAISE
: {

84092 cÚ¡ *
zTy³
 = "unk";

84093  
	gpEx´
->
	gaffš™y
 ){

84094 
	gOE_RÞlback
: 
zTy³
 = "rollback"; ;

84095 
	gOE_AbÜt
: 
zTy³
 = "abort"; ;

84096 
	gOE_Faž
: 
zTy³
 = "fail"; ;

84097 
	gOE_IgnÜe
: 
zTy³
 = "ignore"; ;

84099 
sql™e3T»eV›wLše
(
pV›w
, "RAISE %s(%Q)", 
zTy³
, 
pEx´
->
u
.
zTok’
);

84104 
sql™e3T»eV›wLše
(
pV›w
, "Ý=%d", 
pEx´
->
Ý
);

84108 ifÐ
	gzBšOp
 ){

84109 
sql™e3T»eV›wLše
(
pV›w
, "%s", 
zBšOp
);

84110 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 1);

84111 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pRight
, 0);

84112 }ifÐ
	gzUniOp
 ){

84113 
sql™e3T»eV›wLše
(
pV›w
, "%s", 
zUniOp
);

84114 
sql™e3T»eV›wEx´
(
pV›w
, 
pEx´
->
pLeá
, 0);

84116 
sql™e3T»eV›wPÝ
(
pV›w
);

84120 #ifdeà
SQLITE_DEBUG


84124 
SQLITE_PRIVATE
 
sql™e3T»eV›wEx´Li¡
(

84125 
T»eV›w
 *
pV›w
,

84126 cÚ¡ 
Ex´Li¡
 *
pLi¡
,

84127 
u8
 
mÜeToFÞlow
,

84128 cÚ¡ *
zLab–


84130 
	gi
;

84131 
	gpV›w
 = 
sql™e3T»eV›wPush
(
pV›w
, 
mÜeToFÞlow
);

84132 ifÐ
	gzLab–
==0 || 
zLab–
[0]==0 ) zLabel = "LIST";

84133 ifÐ
	gpLi¡
==0 ){

84134 
sql™e3T»eV›wLše
(
pV›w
, "% Óm±y)", 
zLab–
);

84136 
sql™e3T»eV›wLše
(
pV›w
, "%s", 
zLab–
);

84137 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

84138 
sql™e3T»eV›wEx´
(
pV›w
, 
pLi¡
->
a
[
i
].
pEx´
, i<pLi¡->
nEx´
-1);

84140 ifÐ
	gpLi¡
->
	ga
[
i
].
	gzName
 ){

84141 
sql™e3Ex¶ašPrštf
(
pOut
, " AS %s", 
pLi¡
->
a
[
i
].
zName
);

84143 ifÐ
	gpLi¡
->
	ga
[
i
].
	gbS·nIsTab
 ){

84144 
sql™e3Ex¶ašPrštf
(
pOut
, " (%s)", 
pLi¡
->
a
[
i
].
zS·n
);

84149 
sql™e3T»eV›wPÝ
(
pV›w
);

84165 
SQLITE_PRIVATE
 
sql™e3Ex´CodeEx´Li¡
(

84166 
P¬£
 *
pP¬£
,

84167 
Ex´Li¡
 *
pLi¡
,

84168 
rg‘
,

84169 
u8
 
æags


84171 
Ex´Li¡_™em
 *
	gpI‹m
;

84172 
	gi
, 
	gn
;

84173 
u8
 
	gcÝyOp
 = (
æags
 & 
SQLITE_ECEL_DUP
è? 
OP_CÝy
 : 
OP_SCÝy
;

84174 
as£¹
Ð
pLi¡
!=0 );

84175 
as£¹
Ð
rg‘
>0 );

84176 
as£¹
Ð
pP¬£
->
pVdbe
!=0 );

84177 
	gn
 = 
pLi¡
->
nEx´
;

84178 ifÐ!
CÚ¡FaùÜOk
(
pP¬£
èè
	gæags
 &ð~
SQLITE_ECEL_FACTOR
;

84179 
	gpI‹m
=
pLi¡
->
a
, 
	gi
=0; i<
	gn
; i++,…Item++){

84180 
Ex´
 *
	gpEx´
 = 
pI‹m
->
pEx´
;

84181 ifÐ(
	gæags
 & 
	gSQLITE_ECEL_FACTOR
)!=0 && 
sql™e3Ex´IsCÚ¡ªt
(
pEx´
) ){

84182 
sql™e3Ex´CodeAtIn™
(
pP¬£
, 
pEx´
, 
rg‘
+
i
, 0);

84184 
	gšReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pEx´
, 
rg‘
+
i
);

84185 ifÐ
	gšReg
!=
rg‘
+
i
 ){

84186 
VdbeOp
 *
pOp
;

84187 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

84188 ifÐ
	gcÝyOp
==
OP_CÝy


84189 && (
pOp
=
sql™e3VdbeG‘Op
(
v
, -1))->
	gÝcode
==
OP_CÝy


84190 && 
pOp
->
p1
+pOp->
p3
+1==
šReg


84191 && 
pOp
->
p2
+pOp->
p3
+1==
rg‘
+
i


84193 
pOp
->
p3
++;

84195 
sql™e3VdbeAddOp2
(
v
, 
cÝyOp
, 
šReg
, 
rg‘
+
i
);

84200  
	gn
;

84215 
ex´CodeB‘w“n
(

84216 
P¬£
 *
pP¬£
,

84217 
Ex´
 *
pEx´
,

84218 
de¡
,

84219 
jumpIfTrue
,

84220 
jumpIfNuÎ


84222 
Ex´
 
	gex´And
;

84223 
Ex´
 
	gcompLeá
;

84224 
Ex´
 
	gcompRight
;

84225 
Ex´
 
	gex´X
;

84226 
	g»gF»e1
 = 0;

84228 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

84229 
	gex´X
 = *
pEx´
->
pLeá
;

84230 
	gex´And
.
	gÝ
 = 
TK_AND
;

84231 
	gex´And
.
	gpLeá
 = &
compLeá
;

84232 
	gex´And
.
	gpRight
 = &
compRight
;

84233 
	gcompLeá
.
	gÝ
 = 
TK_GE
;

84234 
	gcompLeá
.
	gpLeá
 = &
ex´X
;

84235 
	gcompLeá
.
	gpRight
 = 
pEx´
->
x
.
pLi¡
->
a
[0].pExpr;

84236 
	gcompRight
.
	gÝ
 = 
TK_LE
;

84237 
	gcompRight
.
	gpLeá
 = &
ex´X
;

84238 
	gcompRight
.
	gpRight
 = 
pEx´
->
x
.
pLi¡
->
a
[1].pExpr;

84239 
ex´ToRegi¡”
(&
ex´X
, 
sql™e3Ex´CodeTemp
(
pP¬£
, &ex´X, &
»gF»e1
));

84240 ifÐ
	gjumpIfTrue
 ){

84241 
sql™e3Ex´IfTrue
(
pP¬£
, &
ex´And
, 
de¡
, 
jumpIfNuÎ
);

84243 
sql™e3Ex´IfF®£
(
pP¬£
, &
ex´And
, 
de¡
, 
jumpIfNuÎ
);

84245 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e1
);

84248 
‹¡ÿ£
Ð
jumpIfTrue
==0 && 
jumpIfNuÎ
==0 && 
»gF»e1
==0 );

84249 
‹¡ÿ£
Ð
jumpIfTrue
==0 && 
jumpIfNuÎ
==0 && 
»gF»e1
!=0 );

84250 
‹¡ÿ£
Ð
jumpIfTrue
==0 && 
jumpIfNuÎ
!=0 && 
»gF»e1
==0 );

84251 
‹¡ÿ£
Ð
jumpIfTrue
==0 && 
jumpIfNuÎ
!=0 && 
»gF»e1
!=0 );

84252 
‹¡ÿ£
Ð
jumpIfTrue
!=0 && 
jumpIfNuÎ
==0 && 
»gF»e1
==0 );

84253 
‹¡ÿ£
Ð
jumpIfTrue
!=0 && 
jumpIfNuÎ
==0 && 
»gF»e1
!=0 );

84254 
‹¡ÿ£
Ð
jumpIfTrue
!=0 && 
jumpIfNuÎ
!=0 && 
»gF»e1
==0 );

84255 
‹¡ÿ£
Ð
jumpIfTrue
!=0 && 
jumpIfNuÎ
!=0 && 
»gF»e1
!=0 );

84272 
SQLITE_PRIVATE
 
sql™e3Ex´IfTrue
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
de¡
, 
jumpIfNuÎ
){

84273 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

84274 
	gÝ
 = 0;

84275 
	g»gF»e1
 = 0;

84276 
	g»gF»e2
 = 0;

84277 
	gr1
, 
	gr2
;

84279 
as£¹
Ð
jumpIfNuÎ
==
SQLITE_JUMPIFNULL
 || jumpIfNull==0 );

84280 ifÐ
NEVER
(
v
==0) ) ;

84281 ifÐ
NEVER
(
pEx´
==0) ) ;

84282 
	gÝ
 = 
pEx´
->
Ý
;

84283  
	gÝ
 ){

84284 
	gTK_AND
: {

84285 
d2
 = 
sql™e3VdbeMakeLab–
(
v
);

84286 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84287 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEx´
->
pLeá
, 
d2
,
jumpIfNuÎ
^
SQLITE_JUMPIFNULL
);

84288 
sql™e3Ex´CachePush
(
pP¬£
);

84289 
sql™e3Ex´IfTrue
(
pP¬£
, 
pEx´
->
pRight
, 
de¡
, 
jumpIfNuÎ
);

84290 
sql™e3VdbeResÞveLab–
(
v
, 
d2
);

84291 
sql™e3Ex´CachePÝ
(
pP¬£
);

84294 
	gTK_OR
: {

84295 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84296 
sql™e3Ex´IfTrue
(
pP¬£
, 
pEx´
->
pLeá
, 
de¡
, 
jumpIfNuÎ
);

84297 
sql™e3Ex´CachePush
(
pP¬£
);

84298 
sql™e3Ex´IfTrue
(
pP¬£
, 
pEx´
->
pRight
, 
de¡
, 
jumpIfNuÎ
);

84299 
sql™e3Ex´CachePÝ
(
pP¬£
);

84302 
	gTK_NOT
: {

84303 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84304 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEx´
->
pLeá
, 
de¡
, 
jumpIfNuÎ
);

84307 
	gTK_LT
:

84308 
TK_LE
:

84309 
TK_GT
:

84310 
TK_GE
:

84311 
TK_NE
:

84312 
TK_EQ
: {

84313 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84314 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84315 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

84316 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

84317 
r1
, 
r2
, 
de¡
, 
jumpIfNuÎ
);

84318 
as£¹
(
TK_LT
==
OP_Lt
); 
‹¡ÿ£
(
Ý
==OP_Lt); 
VdbeCov”ageIf
(
v
,op==OP_Lt);

84319 
as£¹
(
TK_LE
==
OP_Le
); 
‹¡ÿ£
(
Ý
==OP_Le); 
VdbeCov”ageIf
(
v
,op==OP_Le);

84320 
as£¹
(
TK_GT
==
OP_Gt
); 
‹¡ÿ£
(
Ý
==OP_Gt); 
VdbeCov”ageIf
(
v
,op==OP_Gt);

84321 
as£¹
(
TK_GE
==
OP_Ge
); 
‹¡ÿ£
(
Ý
==OP_Ge); 
VdbeCov”ageIf
(
v
,op==OP_Ge);

84322 
as£¹
(
TK_EQ
==
OP_Eq
); 
‹¡ÿ£
(
Ý
==OP_Eq); 
VdbeCov”ageIf
(
v
,op==OP_Eq);

84323 
as£¹
(
TK_NE
==
OP_Ne
); 
‹¡ÿ£
(
Ý
==OP_Ne); 
VdbeCov”ageIf
(
v
,op==OP_Ne);

84324 
‹¡ÿ£
Ð
»gF»e1
==0 );

84325 
‹¡ÿ£
Ð
»gF»e2
==0 );

84328 
	gTK_IS
:

84329 
TK_ISNOT
: {

84330 
‹¡ÿ£
Ð
Ý
==
TK_IS
 );

84331 
‹¡ÿ£
Ð
Ý
==
TK_ISNOT
 );

84332 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84333 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

84334 
	gÝ
 = (
Ý
==
TK_IS
è? 
TK_EQ
 : 
TK_NE
;

84335 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

84336 
r1
, 
r2
, 
de¡
, 
SQLITE_NULLEQ
);

84337 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_EQ
);

84338 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_NE
);

84339 
‹¡ÿ£
Ð
»gF»e1
==0 );

84340 
‹¡ÿ£
Ð
»gF»e2
==0 );

84343 
	gTK_ISNULL
:

84344 
TK_NOTNULL
: {

84345 
as£¹
Ð
TK_ISNULL
==
OP_IsNuÎ
 ); 
‹¡ÿ£
Ð
Ý
==TK_ISNULL );

84346 
as£¹
Ð
TK_NOTNULL
==
OP_NÙNuÎ
 ); 
‹¡ÿ£
Ð
Ý
==TK_NOTNULL );

84347 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84348 
sql™e3VdbeAddOp2
(
v
, 
Ý
, 
r1
, 
de¡
);

84349 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_ISNULL
);

84350 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_NOTNULL
);

84351 
‹¡ÿ£
Ð
»gF»e1
==0 );

84354 
	gTK_BETWEEN
: {

84355 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84356 
ex´CodeB‘w“n
(
pP¬£
, 
pEx´
, 
de¡
, 1, 
jumpIfNuÎ
);

84359 #iâdeà
SQLITE_OMIT_SUBQUERY


84360 
	gTK_IN
: {

84361 
de¡IfF®£
 = 
sql™e3VdbeMakeLab–
(
v
);

84362 
	gde¡IfNuÎ
 = 
jumpIfNuÎ
 ? 
de¡
 : 
de¡IfF®£
;

84363 
sql™e3Ex´CodeIN
(
pP¬£
, 
pEx´
, 
de¡IfF®£
, 
de¡IfNuÎ
);

84364 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡
);

84365 
sql™e3VdbeResÞveLab–
(
v
, 
de¡IfF®£
);

84370 ifÐ
ex´AlwaysTrue
(
pEx´
) ){

84371 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡
);

84372 }ifÐ
ex´AlwaysF®£
(
pEx´
) ){

84375 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
, &
»gF»e1
);

84376 
sql™e3VdbeAddOp3
(
v
, 
OP_If
, 
r1
, 
de¡
, 
jumpIfNuÎ
!=0);

84377 
VdbeCov”age
(
v
);

84378 
‹¡ÿ£
Ð
»gF»e1
==0 );

84379 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84384 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e1
);

84385 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e2
);

84397 
SQLITE_PRIVATE
 
sql™e3Ex´IfF®£
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
, 
de¡
, 
jumpIfNuÎ
){

84398 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

84399 
	gÝ
 = 0;

84400 
	g»gF»e1
 = 0;

84401 
	g»gF»e2
 = 0;

84402 
	gr1
, 
	gr2
;

84404 
as£¹
Ð
jumpIfNuÎ
==
SQLITE_JUMPIFNULL
 || jumpIfNull==0 );

84405 ifÐ
NEVER
(
v
==0) ) ;

84406 ifÐ
	gpEx´
==0 ) ;

84426 
	gÝ
 = ((
pEx´
->
Ý
+(
TK_ISNULL
&1))^1)-(TK_ISNULL&1);

84430 
as£¹
Ð
pEx´
->
Ý
!=
TK_ISNULL
 || op==
OP_NÙNuÎ
 );

84431 
as£¹
Ð
pEx´
->
Ý
!=
TK_NOTNULL
 || op==
OP_IsNuÎ
 );

84432 
as£¹
Ð
pEx´
->
Ý
!=
TK_NE
 || op==
OP_Eq
 );

84433 
as£¹
Ð
pEx´
->
Ý
!=
TK_EQ
 || op==
OP_Ne
 );

84434 
as£¹
Ð
pEx´
->
Ý
!=
TK_LT
 || op==
OP_Ge
 );

84435 
as£¹
Ð
pEx´
->
Ý
!=
TK_LE
 || op==
OP_Gt
 );

84436 
as£¹
Ð
pEx´
->
Ý
!=
TK_GT
 || op==
OP_Le
 );

84437 
as£¹
Ð
pEx´
->
Ý
!=
TK_GE
 || op==
OP_Lt
 );

84439  
	gpEx´
->
	gÝ
 ){

84440 
	gTK_AND
: {

84441 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84442 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEx´
->
pLeá
, 
de¡
, 
jumpIfNuÎ
);

84443 
sql™e3Ex´CachePush
(
pP¬£
);

84444 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEx´
->
pRight
, 
de¡
, 
jumpIfNuÎ
);

84445 
sql™e3Ex´CachePÝ
(
pP¬£
);

84448 
	gTK_OR
: {

84449 
d2
 = 
sql™e3VdbeMakeLab–
(
v
);

84450 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84451 
sql™e3Ex´IfTrue
(
pP¬£
, 
pEx´
->
pLeá
, 
d2
, 
jumpIfNuÎ
^
SQLITE_JUMPIFNULL
);

84452 
sql™e3Ex´CachePush
(
pP¬£
);

84453 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEx´
->
pRight
, 
de¡
, 
jumpIfNuÎ
);

84454 
sql™e3VdbeResÞveLab–
(
v
, 
d2
);

84455 
sql™e3Ex´CachePÝ
(
pP¬£
);

84458 
	gTK_NOT
: {

84459 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84460 
sql™e3Ex´IfTrue
(
pP¬£
, 
pEx´
->
pLeá
, 
de¡
, 
jumpIfNuÎ
);

84463 
	gTK_LT
:

84464 
TK_LE
:

84465 
TK_GT
:

84466 
TK_GE
:

84467 
TK_NE
:

84468 
TK_EQ
: {

84469 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84470 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84471 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

84472 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

84473 
r1
, 
r2
, 
de¡
, 
jumpIfNuÎ
);

84474 
as£¹
(
TK_LT
==
OP_Lt
); 
‹¡ÿ£
(
Ý
==OP_Lt); 
VdbeCov”ageIf
(
v
,op==OP_Lt);

84475 
as£¹
(
TK_LE
==
OP_Le
); 
‹¡ÿ£
(
Ý
==OP_Le); 
VdbeCov”ageIf
(
v
,op==OP_Le);

84476 
as£¹
(
TK_GT
==
OP_Gt
); 
‹¡ÿ£
(
Ý
==OP_Gt); 
VdbeCov”ageIf
(
v
,op==OP_Gt);

84477 
as£¹
(
TK_GE
==
OP_Ge
); 
‹¡ÿ£
(
Ý
==OP_Ge); 
VdbeCov”ageIf
(
v
,op==OP_Ge);

84478 
as£¹
(
TK_EQ
==
OP_Eq
); 
‹¡ÿ£
(
Ý
==OP_Eq); 
VdbeCov”ageIf
(
v
,op==OP_Eq);

84479 
as£¹
(
TK_NE
==
OP_Ne
); 
‹¡ÿ£
(
Ý
==OP_Ne); 
VdbeCov”ageIf
(
v
,op==OP_Ne);

84480 
‹¡ÿ£
Ð
»gF»e1
==0 );

84481 
‹¡ÿ£
Ð
»gF»e2
==0 );

84484 
	gTK_IS
:

84485 
TK_ISNOT
: {

84486 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_IS
 );

84487 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_ISNOT
 );

84488 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84489 
	gr2
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pRight
, &
»gF»e2
);

84490 
	gÝ
 = (
pEx´
->
Ý
==
TK_IS
è? 
TK_NE
 : 
TK_EQ
;

84491 
codeCom·»
(
pP¬£
, 
pEx´
->
pLeá
,…Ex´->
pRight
, 
Ý
,

84492 
r1
, 
r2
, 
de¡
, 
SQLITE_NULLEQ
);

84493 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_EQ
);

84494 
VdbeCov”ageIf
(
v
, 
Ý
==
TK_NE
);

84495 
‹¡ÿ£
Ð
»gF»e1
==0 );

84496 
‹¡ÿ£
Ð
»gF»e2
==0 );

84499 
	gTK_ISNULL
:

84500 
TK_NOTNULL
: {

84501 
r1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
->
pLeá
, &
»gF»e1
);

84502 
sql™e3VdbeAddOp2
(
v
, 
Ý
, 
r1
, 
de¡
);

84503 
‹¡ÿ£
Ð
Ý
==
TK_ISNULL
 ); 
VdbeCov”ageIf
(
v
, op==TK_ISNULL);

84504 
‹¡ÿ£
Ð
Ý
==
TK_NOTNULL
 ); 
VdbeCov”ageIf
(
v
, op==TK_NOTNULL);

84505 
‹¡ÿ£
Ð
»gF»e1
==0 );

84508 
	gTK_BETWEEN
: {

84509 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84510 
ex´CodeB‘w“n
(
pP¬£
, 
pEx´
, 
de¡
, 0, 
jumpIfNuÎ
);

84513 #iâdeà
SQLITE_OMIT_SUBQUERY


84514 
	gTK_IN
: {

84515 ifÐ
jumpIfNuÎ
 ){

84516 
sql™e3Ex´CodeIN
(
pP¬£
, 
pEx´
, 
de¡
, dest);

84518 
	gde¡IfNuÎ
 = 
sql™e3VdbeMakeLab–
(
v
);

84519 
sql™e3Ex´CodeIN
(
pP¬£
, 
pEx´
, 
de¡
, 
de¡IfNuÎ
);

84520 
sql™e3VdbeResÞveLab–
(
v
, 
de¡IfNuÎ
);

84526 ifÐ
ex´AlwaysF®£
(
pEx´
) ){

84527 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
de¡
);

84528 }ifÐ
ex´AlwaysTrue
(
pEx´
) ){

84531 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pEx´
, &
»gF»e1
);

84532 
sql™e3VdbeAddOp3
(
v
, 
OP_IfNÙ
, 
r1
, 
de¡
, 
jumpIfNuÎ
!=0);

84533 
VdbeCov”age
(
v
);

84534 
‹¡ÿ£
Ð
»gF»e1
==0 );

84535 
‹¡ÿ£
Ð
jumpIfNuÎ
==0 );

84540 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e1
);

84541 
sql™e3R–—£TempReg
(
pP¬£
, 
»gF»e2
);

84566 
SQLITE_PRIVATE
 
sql™e3Ex´Com·»
(
Ex´
 *
pA
, Ex´ *
pB
, 
iTab
){

84567 
u32
 
	gcombšedFÏgs
;

84568 ifÐ
	gpA
==0 || 
pB
==0 ){

84569  
pB
==
pA
 ? 0 : 2;

84571 
	gcombšedFÏgs
 = 
pA
->
æags
 | 
pB
->flags;

84572 ifÐ
	gcombšedFÏgs
 & 
	gEP_IÁV®ue
 ){

84573 ifÐ(
	gpA
->
	gæags
&
	gpB
->æags&
	gEP_IÁV®ue
)!=0 && 
pA
->
u
.
iV®ue
==
pB
->u.iValue ){

84578 ifÐ
	gpA
->
	gÝ
!=
pB
->
Ý
 ){

84579 ifÐ
pA
->
Ý
==
TK_COLLATE
 && 
sql™e3Ex´Com·»
ÕA->
pLeá
, 
pB
, 
iTab
)<2 ){

84582 ifÐ
	gpB
->
	gÝ
==
TK_COLLATE
 && 
sql™e3Ex´Com·»
(
pA
, 
pB
->
pLeá
, 
iTab
)<2 ){

84587 ifÐ
	gpA
->
	gÝ
!=
TK_COLUMN
 && 
ALWAYS
(
pA
->
Ý
!=
TK_AGG_COLUMN
è&&…A->
u
.
zTok’
 ){

84588 ifÐ
¡rcmp
(
pA
->
u
.
zTok’
,
pB
->u.zToken)!=0 ){

84589  
pA
->
Ý
==
TK_COLLATE
 ? 1 : 2;

84592 ifÐ(
	gpA
->
	gæags
 & 
	gEP_Di¡šù
)!=(
pB
->
æags
 & 
EP_Di¡šù
) )  2;

84593 ifÐ
ALWAYS
((
combšedFÏgs
 & 
EP_Tok’OÆy
)==0) ){

84594 ifÐ
combšedFÏgs
 & 
EP_xIsS–eù
 )  2;

84595 ifÐ
sql™e3Ex´Com·»
(
pA
->
pLeá
, 
pB
->pLeá, 
iTab
) )  2;

84596 ifÐ
sql™e3Ex´Com·»
(
pA
->
pRight
, 
pB
->pRight, 
iTab
) )  2;

84597 ifÐ
sql™e3Ex´Li¡Com·»
(
pA
->
x
.
pLi¡
, 
pB
->x.pLi¡, 
iTab
) )  2;

84598 ifÐ
ALWAYS
((
combšedFÏgs
 & 
EP_Reduûd
)==0) ){

84599 ifÐ
pA
->
iCÞumn
!=
pB
->iColumn )  2;

84600 ifÐ
	gpA
->
	giTabË
!=
pB
->
iTabË


84601 && (
pA
->
iTabË
!=
iTab
 || 
NEVER
(
pB
->iTable>=0)) )  2;

84622 
SQLITE_PRIVATE
 
sql™e3Ex´Li¡Com·»
(
Ex´Li¡
 *
pA
, Ex´Li¡ *
pB
, 
iTab
){

84623 
	gi
;

84624 ifÐ
	gpA
==0 && 
pB
==0 )  0;

84625 ifÐ
	gpA
==0 || 
pB
==0 )  1;

84626 ifÐ
	gpA
->
	gnEx´
!=
pB
->
nEx´
 )  1;

84627 
	gi
=0; i<
	gpA
->
	gnEx´
; i++){

84628 
Ex´
 *
	gpEx´A
 = 
pA
->
a
[
i
].
pEx´
;

84629 
Ex´
 *
	gpEx´B
 = 
pB
->
a
[
i
].
pEx´
;

84630 ifÐ
	gpA
->
	ga
[
i
].
	gsÜtOrd”
!=
pB
->
a
[i].
sÜtOrd”
 )  1;

84631 ifÐ
sql™e3Ex´Com·»
(
pEx´A
, 
pEx´B
, 
iTab
) )  1;

84656 
SQLITE_PRIVATE
 
sql™e3Ex´Im¶›sEx´
(
Ex´
 *
pE1
, Ex´ *
pE2
, 
iTab
){

84657 ifÐ
sql™e3Ex´Com·»
(
pE1
, 
pE2
, 
iTab
)==0 ){

84660 ifÐ
	gpE2
->
	gÝ
==
TK_OR


84661 && (
sql™e3Ex´Im¶›sEx´
(
pE1
, 
pE2
->
pLeá
, 
iTab
)

84662 || 
sql™e3Ex´Im¶›sEx´
(
pE1
, 
pE2
->
pRight
, 
iTab
) )

84666 ifÐ
	gpE2
->
	gÝ
==
TK_NOTNULL


84667 && 
sql™e3Ex´Com·»
(
pE1
->
pLeá
, 
pE2
->pLeá, 
iTab
)==0

84668 && (
pE1
->
Ý
!=
TK_ISNULL
 &&…E1->Ý!=
TK_IS
)

84681 
	sSrcCouÁ
 {

84682 
SrcLi¡
 *
	gpSrc
;

84683 
	gnThis
;

84684 
	gnOth”
;

84690 
ex´SrcCouÁ
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

84696 ifÐ
	gpEx´
->
	gÝ
==
TK_COLUMN
 || 
NEVER
(
pEx´
->
Ý
==
TK_AGG_COLUMN
) ){

84697 
i
;

84698 
SrcCouÁ
 *
	gp
 = 
pW®k”
->
u
.
pSrcCouÁ
;

84699 
SrcLi¡
 *
	gpSrc
 = 
p
->
pSrc
;

84700 
	gi
=0; i<
	gpSrc
->
	gnSrc
; i++){

84701 ifÐ
	gpEx´
->
	giTabË
==
pSrc
->
a
[
i
].
iCursÜ
 ) ;

84703 ifÐ
	gi
<
	gpSrc
->
	gnSrc
 ){

84704 
	gp
->
	gnThis
++;

84706 
	gp
->
	gnOth”
++;

84709  
	gWRC_CÚtšue
;

84718 
SQLITE_PRIVATE
 
sql™e3FunùiÚU£sThisSrc
(
Ex´
 *
pEx´
, 
SrcLi¡
 *
pSrcLi¡
){

84719 
W®k”
 
	gw
;

84720 
SrcCouÁ
 
	gút
;

84721 
as£¹
Ð
pEx´
->
Ý
==
TK_AGG_FUNCTION
 );

84722 
mem£t
(&
w
, 0, (w));

84723 
	gw
.
	gxEx´C®lback
 = 
ex´SrcCouÁ
;

84724 
	gw
.
	gu
.
	gpSrcCouÁ
 = &
út
;

84725 
	gút
.
	gpSrc
 = 
pSrcLi¡
;

84726 
	gút
.
	gnThis
 = 0;

84727 
	gút
.
	gnOth”
 = 0;

84728 
sql™e3W®kEx´Li¡
(&
w
, 
pEx´
->
x
.
pLi¡
);

84729  
	gút
.
	gnThis
>0 || cÁ.
	gnOth”
==0;

84736 
addAggInfoCÞumn
(
sql™e3
 *
db
, 
AggInfo
 *
pInfo
){

84737 
	gi
;

84738 
	gpInfo
->
	gaCÞ
 = 
sql™e3A¼ayAÎoÿ‹
(

84739 
db
,

84740 
pInfo
->
aCÞ
,

84741 (
pInfo
->
aCÞ
[0]),

84742 &
pInfo
->
nCÞumn
,

84743 &
i


84745  
	gi
;

84752 
addAggInfoFunc
(
sql™e3
 *
db
, 
AggInfo
 *
pInfo
){

84753 
	gi
;

84754 
	gpInfo
->
	gaFunc
 = 
sql™e3A¼ayAÎoÿ‹
(

84755 
db
,

84756 
pInfo
->
aFunc
,

84757 (
pInfo
->
aFunc
[0]),

84758 &
pInfo
->
nFunc
,

84759 &
i


84761  
	gi
;

84769 
ª®yzeAgg»g©e
(
W®k”
 *
pW®k”
, 
Ex´
 *
pEx´
){

84770 
	gi
;

84771 
NameCÚ‹xt
 *
	gpNC
 = 
pW®k”
->
u
.
pNC
;

84772 
P¬£
 *
	gpP¬£
 = 
pNC
->
pP¬£
;

84773 
SrcLi¡
 *
	gpSrcLi¡
 = 
pNC
->
pSrcLi¡
;

84774 
AggInfo
 *
	gpAggInfo
 = 
pNC
->
pAggInfo
;

84776  
	gpEx´
->
	gÝ
 ){

84777 
	gTK_AGG_COLUMN
:

84778 
TK_COLUMN
: {

84779 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_AGG_COLUMN
 );

84780 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_COLUMN
 );

84783 ifÐ
ALWAYS
(
pSrcLi¡
!=0) ){

84784 
SrcLi¡_™em
 *
pI‹m
 = 
pSrcLi¡
->
a
;

84785 
	gi
=0; i<
	gpSrcLi¡
->
	gnSrc
; i++, 
	gpI‹m
++){

84786 
AggInfo_cÞ
 *
	gpCÞ
;

84787 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

84788 ifÐ
	gpEx´
->
	giTabË
==
pI‹m
->
iCursÜ
 ){

84795 
k
;

84796 
	gpCÞ
 = 
pAggInfo
->
aCÞ
;

84797 
	gk
=0; k<
	gpAggInfo
->
	gnCÞumn
; k++, 
	gpCÞ
++){

84798 ifÐ
	gpCÞ
->
	giTabË
==
pEx´
->
iTabË
 &&

84799 
pCÞ
->
iCÞumn
==
pEx´
->iColumn ){

84803 ifÐ(
	gk
>=
pAggInfo
->
nCÞumn
)

84804 && (
k
 = 
addAggInfoCÞumn
(
pP¬£
->
db
, 
pAggInfo
))>=0

84806 
pCÞ
 = &
pAggInfo
->
aCÞ
[
k
];

84807 
	gpCÞ
->
	gpTab
 = 
pEx´
->
pTab
;

84808 
	gpCÞ
->
	giTabË
 = 
pEx´
->
iTabË
;

84809 
	gpCÞ
->
	giCÞumn
 = 
pEx´
->
iCÞumn
;

84810 
	gpCÞ
->
	giMem
 = ++
pP¬£
->
nMem
;

84811 
	gpCÞ
->
	giSÜ‹rCÞumn
 = -1;

84812 
	gpCÞ
->
	gpEx´
 = 
pEx´
;

84813 ifÐ
	gpAggInfo
->
	gpGroupBy
 ){

84814 
	gj
, 
	gn
;

84815 
Ex´Li¡
 *
	gpGB
 = 
pAggInfo
->
pGroupBy
;

84816 
Ex´Li¡_™em
 *
	gpT”m
 = 
pGB
->
a
;

84817 
	gn
 = 
pGB
->
nEx´
;

84818 
	gj
=0; j<
	gn
; j++, 
	gpT”m
++){

84819 
Ex´
 *
	gpE
 = 
pT”m
->
pEx´
;

84820 ifÐ
	gpE
->
	gÝ
==
TK_COLUMN
 && 
pE
->
iTabË
==
pEx´
->iTable &&

84821 
pE
->
iCÞumn
==
pEx´
->iColumn ){

84822 
pCÞ
->
iSÜ‹rCÞumn
 = 
j
;

84827 ifÐ
	gpCÞ
->
	giSÜ‹rCÞumn
<0 ){

84828 
	gpCÞ
->
	giSÜ‹rCÞumn
 = 
pAggInfo
->
nSÜtšgCÞumn
++;

84836 
Ex´S‘VVAPrÝ”ty
(
pEx´
, 
EP_NoReduû
);

84837 
	gpEx´
->
	gpAggInfo
 = 
pAggInfo
;

84838 
	gpEx´
->
	gÝ
 = 
TK_AGG_COLUMN
;

84839 
	gpEx´
->
	giAgg
 = (
i16
)
k
;

84844  
	gWRC_PruÃ
;

84846 
	gTK_AGG_FUNCTION
: {

84847 ifÐ(
pNC
->
ncFÏgs
 & 
NC_InAggFunc
)==0

84848 && 
pW®k”
->
w®k”D•th
==
pEx´
->
Ý2


84853 
AggInfo_func
 *
pI‹m
 = 
pAggInfo
->
aFunc
;

84854 
	gi
=0; i<
	gpAggInfo
->
	gnFunc
; i++, 
	gpI‹m
++){

84855 ifÐ
sql™e3Ex´Com·»
(
pI‹m
->
pEx´
,…Expr, -1)==0 ){

84859 ifÐ
	gi
>=
pAggInfo
->
nFunc
 ){

84862 
u8
 
’c
 = 
ENC
(
pP¬£
->
db
);

84863 
	gi
 = 
addAggInfoFunc
(
pP¬£
->
db
, 
pAggInfo
);

84864 ifÐ
	gi
>=0 ){

84865 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

84866 
	gpI‹m
 = &
pAggInfo
->
aFunc
[
i
];

84867 
	gpI‹m
->
	gpEx´
 = 
pEx´
;

84868 
	gpI‹m
->
	giMem
 = ++
pP¬£
->
nMem
;

84869 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_IÁV®ue
) );

84870 
	gpI‹m
->
	gpFunc
 = 
sql™e3FšdFunùiÚ
(
pP¬£
->
db
,

84871 
pEx´
->
u
.
zTok’
, 
sql™e3SŒËn30
(pExpr->u.zToken),

84872 
pEx´
->
x
.
pLi¡
 ?…Ex´->x.pLi¡->
nEx´
 : 0, 
’c
, 0);

84873 ifÐ
	gpEx´
->
	gæags
 & 
	gEP_Di¡šù
 ){

84874 
	gpI‹m
->
	giDi¡šù
 = 
pP¬£
->
nTab
++;

84876 
	gpI‹m
->
	giDi¡šù
 = -1;

84882 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

84883 
Ex´S‘VVAPrÝ”ty
(
pEx´
, 
EP_NoReduû
);

84884 
	gpEx´
->
	giAgg
 = (
i16
)
i
;

84885 
	gpEx´
->
	gpAggInfo
 = 
pAggInfo
;

84886  
	gWRC_PruÃ
;

84888  
	gWRC_CÚtšue
;

84892  
	gWRC_CÚtšue
;

84894 
ª®yzeAgg»g©esInS–eù
(
W®k”
 *
pW®k”
, 
S–eù
 *
pS–eù
){

84895 
UNUSED_PARAMETER
(
pW®k”
);

84896 
UNUSED_PARAMETER
(
pS–eù
);

84897  
	gWRC_CÚtšue
;

84909 
SQLITE_PRIVATE
 
sql™e3Ex´AÇlyzeAgg»g©es
(
NameCÚ‹xt
 *
pNC
, 
Ex´
 *
pEx´
){

84910 
W®k”
 
	gw
;

84911 
mem£t
(&
w
, 0, (w));

84912 
	gw
.
	gxEx´C®lback
 = 
ª®yzeAgg»g©e
;

84913 
	gw
.
	gxS–eùC®lback
 = 
ª®yzeAgg»g©esInS–eù
;

84914 
	gw
.
	gu
.
	gpNC
 = 
pNC
;

84915 
as£¹
Ð
pNC
->
pSrcLi¡
!=0 );

84916 
sql™e3W®kEx´
(&
w
, 
pEx´
);

84925 
SQLITE_PRIVATE
 
sql™e3Ex´AÇlyzeAggLi¡
(
NameCÚ‹xt
 *
pNC
, 
Ex´Li¡
 *
pLi¡
){

84926 
Ex´Li¡_™em
 *
	gpI‹m
;

84927 
	gi
;

84928 ifÐ
	gpLi¡
 ){

84929 
	gpI‹m
=
pLi¡
->
a
, 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++,…Item++){

84930 
sql™e3Ex´AÇlyzeAgg»g©es
(
pNC
, 
pI‹m
->
pEx´
);

84938 
SQLITE_PRIVATE
 
sql™e3G‘TempReg
(
P¬£
 *
pP¬£
){

84939 ifÐ
	gpP¬£
->
	gnTempReg
==0 ){

84940  ++
pP¬£
->
nMem
;

84942  
	gpP¬£
->
	gaTempReg
[--
pP¬£
->
nTempReg
];

84953 
SQLITE_PRIVATE
 
sql™e3R–—£TempReg
(
P¬£
 *
pP¬£
, 
iReg
){

84954 ifÐ
	giReg
 && 
	gpP¬£
->
	gnTempReg
<
A¼aySize
(
pP¬£
->
aTempReg
) ){

84955 
	gi
;

84956 
yCÞCache
 *
	gp
;

84957 
	gi
=0, 
	gp
=
pP¬£
->
aCÞCache
; i<
	gSQLITE_N_COLCACHE
; i++,…++){

84958 ifÐ
	gp
->
	giReg
==
iReg
 ){

84959 
p
->
‹mpReg
 = 1;

84963 
	gpP¬£
->
	gaTempReg
[
pP¬£
->
nTempReg
++] = 
iReg
;

84970 
SQLITE_PRIVATE
 
sql™e3G‘TempRªge
(
P¬£
 *
pP¬£
, 
nReg
){

84971 
	gi
, 
	gn
;

84972 
	gi
 = 
pP¬£
->
iRªgeReg
;

84973 
	gn
 = 
pP¬£
->
nRªgeReg
;

84974 ifÐ
	gnReg
<=
n
 ){

84975 
as£¹
Ð!
u£dAsCÞumnCache
(
pP¬£
, 
i
, i+
n
-1) );

84976 
	gpP¬£
->
	giRªgeReg
 +ð
nReg
;

84977 
	gpP¬£
->
	gnRªgeReg
 -ð
nReg
;

84979 
	gi
 = 
pP¬£
->
nMem
+1;

84980 
	gpP¬£
->
	gnMem
 +ð
nReg
;

84982  
	gi
;

84984 
SQLITE_PRIVATE
 
sql™e3R–—£TempRªge
(
P¬£
 *
pP¬£
, 
iReg
, 
nReg
){

84985 
sql™e3Ex´CacheRemove
(
pP¬£
, 
iReg
, 
nReg
);

84986 ifÐ
	gnReg
>
	gpP¬£
->
	gnRªgeReg
 ){

84987 
	gpP¬£
->
	gnRªgeReg
 = 
nReg
;

84988 
	gpP¬£
->
	giRªgeReg
 = 
iReg
;

84995 
SQLITE_PRIVATE
 
sql™e3CË¬TempRegCache
(
P¬£
 *
pP¬£
){

84996 
	gpP¬£
->
	gnTempReg
 = 0;

84997 
	gpP¬£
->
	gnRªgeReg
 = 0;

85021 #iâdeà
SQLITE_OMIT_ALTERTABLE


85037 
»ÇmeTabËFunc
(

85038 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

85039 
NÙU£d
,

85040 
sql™e3_v®ue
 **
¬gv


85042 cÚ¡ *
	gzSql
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

85043 cÚ¡ *
	gzTabËName
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

85045 
	gtok’
;

85046 
Tok’
 
	gŠame
;

85047 cÚ¡ *
	gzC¤
 = 
zSql
;

85048 
	gËn
 = 0;

85049 *
	gzR‘
;

85051 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

85053 
UNUSED_PARAMETER
(
NÙU£d
);

85059 ifÐ
	gzSql
 ){

85061 ifÐ!*
	gzC¤
 ){

85067 
	gŠame
.
	gz
 = (*)
zC¤
;

85068 
	gŠame
.
	gn
 = 
Ën
;

85074 
	gzC¤
 +ð
Ën
;

85075 
	gËn
 = 
sql™e3G‘Tok’
(
zC¤
, &
tok’
);

85076 }  
	gtok’
==
TK_SPACE
 );

85077 
as£¹
Ð
Ën
>0 );

85078 }  
	gtok’
!=
TK_LP
 && 
tok’
!=
TK_USING
 );

85080 
	gzR‘
 = 
sql™e3MPrštf
(
db
, "%.*s\"%w\"%s", ()(((
u8
*)
Šame
.
z
è- 
zSql
),

85081 
zSql
, 
zTabËName
, 
Šame
.
z
+Šame.
n
);

85082 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zR‘
, -1, 
SQLITE_DYNAMIC
);

85101 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


85102 
»ÇmeP¬’tFunc
(

85103 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

85104 
NÙU£d
,

85105 
sql™e3_v®ue
 **
¬gv


85107 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

85108 *
	gzOuut
 = 0;

85109 *
	gzResuÉ
;

85110 cÚ¡ *
	gzIÅut
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

85111 cÚ¡ *
	gzOld
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

85112 cÚ¡ *
	gzNew
 = 
sql™e3_v®ue_‹xt
(
¬gv
[2]);

85114 cÚ¡ *
	gz
;

85115 
	gn
;

85116 
	gtok’
;

85118 
UNUSED_PARAMETER
(
NÙU£d
);

85119 ifÐ
	gzIÅut
==0 || 
zOld
==0 ) ;

85120 
	gz
=
zIÅut
; *z; z=
z
+
n
){

85121 
n
 = 
sql™e3G‘Tok’
(
z
, &
tok’
);

85122 ifÐ
	gtok’
==
TK_REFERENCES
 ){

85123 *
zP¬’t
;

85125 
	gz
 +ð
n
;

85126 
	gn
 = 
sql™e3G‘Tok’
(
z
, &
tok’
);

85127 } 
	gtok’
==
TK_SPACE
 );

85129 
	gzP¬’t
 = 
sql™e3DbSŒNDup
(
db
, (cÚ¡ *)
z
, 
n
);

85130 ifÐ
	gzP¬’t
==0 ) ;

85131 
sql™e3DequÙe
(
zP¬’t
);

85132 ifÐ0==
sql™e3SŒICmp
((cÚ¡ *)
zOld
, 
zP¬’t
) ){

85133 *
	gzOut
 = 
sql™e3MPrštf
(
db
, "%s%.*s\"%w\"",

85134 (
zOuut
?zOuut:""), ()(
z
-
zIÅut
), zIÅut, (cÚ¡ *)
zNew


85136 
sql™e3DbF»e
(
db
, 
zOuut
);

85137 
	gzOuut
 = 
zOut
;

85138 
	gzIÅut
 = &
z
[
n
];

85140 
sql™e3DbF»e
(
db
, 
zP¬’t
);

85144 
	gzResuÉ
 = 
sql™e3MPrštf
(
db
, "%s%s", (
zOuut
?zOuut:""), 
zIÅut
),

85145 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zResuÉ
, -1, 
SQLITE_DYNAMIC
);

85146 
sql™e3DbF»e
(
db
, 
zOuut
);

85150 #iâdeà
SQLITE_OMIT_TRIGGER


85158 
»ÇmeTrigg”Func
(

85159 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

85160 
NÙU£d
,

85161 
sql™e3_v®ue
 **
¬gv


85163 cÚ¡ *
	gzSql
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

85164 cÚ¡ *
	gzTabËName
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

85166 
	gtok’
;

85167 
Tok’
 
	gŠame
;

85168 
	gdi¡
 = 3;

85169 cÚ¡ *
	gzC¤
 = 
zSql
;

85170 
	gËn
 = 0;

85171 *
	gzR‘
;

85172 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

85174 
UNUSED_PARAMETER
(
NÙU£d
);

85181 ifÐ
	gzSql
 ){

85184 ifÐ!*
	gzC¤
 ){

85190 
	gŠame
.
	gz
 = (*)
zC¤
;

85191 
	gŠame
.
	gn
 = 
Ën
;

85197 
	gzC¤
 +ð
Ën
;

85198 
	gËn
 = 
sql™e3G‘Tok’
(
zC¤
, &
tok’
);

85199 } 
	gtok’
==
TK_SPACE
 );

85200 
as£¹
Ð
Ën
>0 );

85211 
	gdi¡
++;

85212 ifÐ
	gtok’
==
TK_DOT
 || 
tok’
==
TK_ON
 ){

85213 
di¡
 = 0;

85215 }  
	gdi¡
!=2 || (
tok’
!=
TK_WHEN
 &&ok’!=
TK_FOR
 &&ok’!=
TK_BEGIN
) );

85220 
	gzR‘
 = 
sql™e3MPrštf
(
db
, "%.*s\"%w\"%s", ()(((
u8
*)
Šame
.
z
è- 
zSql
),

85221 
zSql
, 
zTabËName
, 
Šame
.
z
+Šame.
n
);

85222 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zR‘
, -1, 
SQLITE_DYNAMIC
);

85230 
SQLITE_PRIVATE
 
sql™e3AÉ”FunùiÚs
(){

85231 
SQLITE_WSD
 
FuncDef
 
	gaAÉ”TabËFuncs
[] = {

85232 
FUNCTION
(
sql™e_»Çme_bË
, 2, 0, 0, 
»ÇmeTabËFunc
),

85233 #iâdeà
SQLITE_OMIT_TRIGGER


85234 
FUNCTION
(
sql™e_»Çme_Œigg”
, 2, 0, 0, 
»ÇmeTrigg”Func
),

85236 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


85237 
FUNCTION
(
sql™e_»Çme_·»Á
, 3, 0, 0, 
»ÇmeP¬’tFunc
),

85240 
	gi
;

85241 
FuncDefHash
 *
	gpHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

85242 
FuncDef
 *
	gaFunc
 = (FuncDef*)&
GLOBAL
(FuncDef, 
aAÉ”TabËFuncs
);

85244 
	gi
=0; i<
A¼aySize
(
aAÉ”TabËFuncs
); i++){

85245 
sql™e3FuncDefIn£¹
(
pHash
, &
aFunc
[
i
]);

85265 *
wh”eOrName
(
sql™e3
 *
db
, *
zWh”e
, *
zCÚ¡ªt
){

85266 *
	gzNew
;

85267 ifÐ!
	gzWh”e
 ){

85268 
	gzNew
 = 
sql™e3MPrštf
(
db
, "Çme=%Q", 
zCÚ¡ªt
);

85270 
	gzNew
 = 
sql™e3MPrštf
(
db
, "% OR‚ame=%Q", 
zWh”e
, 
zCÚ¡ªt
);

85271 
sql™e3DbF»e
(
db
, 
zWh”e
);

85273  
	gzNew
;

85276 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

85283 *
wh”eFÜeignKeys
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

85284 
FKey
 *
	gp
;

85285 *
	gzWh”e
 = 0;

85286 
	gp
=
sql™e3FkReã»nûs
(
pTab
);…;…=
p
->
pNextTo
){

85287 
zWh”e
 = 
wh”eOrName
(
pP¬£
->
db
, zWh”e, 
p
->
pFrom
->
zName
);

85289  
	gzWh”e
;

85299 *
wh”eTempTrigg”s
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

85300 
Trigg”
 *
	gpTrig
;

85301 *
	gzWh”e
 = 0;

85302 cÚ¡ 
Schema
 *
	gpTempSchema
 = 
pP¬£
->
db
->
aDb
[1].
pSchema
;

85309 ifÐ
	gpTab
->
	gpSchema
!=
pTempSchema
 ){

85310 
sql™e3
 *
db
 = 
pP¬£
->db;

85311 
	gpTrig
=
sql™e3Trigg”Li¡
(
pP¬£
, 
pTab
);…Trig;…Trig=
pTrig
->
pNext
){

85312 ifÐ
pTrig
->
pSchema
==
pTempSchema
 ){

85313 
zWh”e
 = 
wh”eOrName
(
db
, zWh”e, 
pTrig
->
zName
);

85317 ifÐ
	gzWh”e
 ){

85318 *
	gzNew
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "ty³='Œigg”' AND (%s)", 
zWh”e
);

85319 
sql™e3DbF»e
(
pP¬£
->
db
, 
zWh”e
);

85320 
	gzWh”e
 = 
zNew
;

85322  
	gzWh”e
;

85333 
»lßdTabËSchema
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, cÚ¡ *
zName
){

85334 
Vdbe
 *
	gv
;

85335 *
	gzWh”e
;

85336 
	giDb
;

85337 #iâdeà
SQLITE_OMIT_TRIGGER


85338 
Trigg”
 *
	gpTrig
;

85341 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

85342 ifÐ
NEVER
(
v
==0) ) ;

85343 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
pP¬£
->
db
) );

85344 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

85345 
as£¹
Ð
iDb
>=0 );

85347 #iâdeà
SQLITE_OMIT_TRIGGER


85349 
	gpTrig
=
sql™e3Trigg”Li¡
(
pP¬£
, 
pTab
);…Trig;…Trig=
pTrig
->
pNext
){

85350 
iTrigDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTrig
->
pSchema
);

85351 
as£¹
Ð
iTrigDb
==
iDb
 || iTrigDb==1 );

85352 
sql™e3VdbeAddOp4
(
v
, 
OP_DrÝTrigg”
, 
iTrigDb
, 0, 0, 
pTrig
->
zName
, 0);

85357 
sql™e3VdbeAddOp4
(
v
, 
OP_DrÝTabË
, 
iDb
, 0, 0, 
pTab
->
zName
, 0);

85360 
	gzWh”e
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "tbl_Çme=%Q", 
zName
);

85361 ifÐ!
	gzWh”e
 ) ;

85362 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 
iDb
, 
zWh”e
);

85364 #iâdeà
SQLITE_OMIT_TRIGGER


85368 ifÐ(
	gzWh”e
=
wh”eTempTrigg”s
(
pP¬£
, 
pTab
))!=0 ){

85369 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 1, 
zWh”e
);

85382 
isSy¡emTabË
(
P¬£
 *
pP¬£
, cÚ¡ *
zName
){

85383 ifÐ
sql™e3SŒËn30
(
zName
)>6 && 0==
sql™e3SŒNICmp
(zName, "sqlite_", 7) ){

85384 
sql™e3E¼ÜMsg
(
pP¬£
, "bË % may‚Ù b®‹»d", 
zName
);

85394 
SQLITE_PRIVATE
 
sql™e3AÉ”R’ameTabË
(

85395 
P¬£
 *
pP¬£
,

85396 
SrcLi¡
 *
pSrc
,

85397 
Tok’
 *
pName


85399 
	giDb
;

85400 *
	gzDb
;

85401 
TabË
 *
	gpTab
;

85402 *
	gzName
 = 0;

85403 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

85404 
	gnTabName
;

85405 cÚ¡ *
	gzTabName
;

85406 
Vdbe
 *
	gv
;

85407 #iâdeà
SQLITE_OMIT_TRIGGER


85408 *
	gzWh”e
 = 0;

85410 
VTabË
 *
	gpVTab
 = 0;

85411 
	g§vedDbFÏgs
;

85413 
	g§vedDbFÏgs
 = 
db
->
æags
;

85414 ifÐ
NEVER
(
db
->
m®locFažed
èè
	gex™_»Çme_bË
;

85415 
as£¹
Ð
pSrc
->
nSrc
==1 );

85416 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
pP¬£
->
db
) );

85418 
	gpTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, &
pSrc
->
a
[0]);

85419 ifÐ!
	gpTab
 ) 
	gex™_»Çme_bË
;

85420 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

85421 
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

85422 
	gdb
->
	gæags
 |ð
SQLITE_P»ãrBužtš
;

85425 
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

85426 ifÐ!
	gzName
 ) 
	gex™_»Çme_bË
;

85431 ifÐ
sql™e3FšdTabË
(
db
, 
zName
, 
zDb
è|| 
sql™e3FšdIndex
(db, zName, zDb) ){

85432 
sql™e3E¼ÜMsg
(
pP¬£
,

85433 "th”i ®»ady‡nÙh”abË o¸šdex w™hhi Çme: %s", 
zName
);

85434 
	gex™_»Çme_bË
;

85440 ifÐ
	gSQLITE_OK
!=
isSy¡emTabË
(
pP¬£
, 
pTab
->
zName
) ){

85441 
	gex™_»Çme_bË
;

85443 ifÐ
	gSQLITE_OK
!=
sql™e3CheckObjeùName
(
pP¬£
, 
zName
) ){ 

85444 
	gex™_»Çme_bË
;

85447 #iâdeà
SQLITE_OMIT_VIEW


85448 ifÐ
	gpTab
->
	gpS–eù
 ){

85449 
sql™e3E¼ÜMsg
(
pP¬£
, "v›w % may‚Ù b®‹»d", 
pTab
->
zName
);

85450 
	gex™_»Çme_bË
;

85454 #iâdeà
SQLITE_OMIT_AUTHORIZATION


85456 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_ALTER_TABLE
, 
zDb
, 
pTab
->
zName
, 0) ){

85457 
	gex™_»Çme_bË
;

85461 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


85462 ifÐ
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
) ){

85463 
	gex™_»Çme_bË
;

85465 ifÐ
IsVœtu®
(
pTab
) ){

85466 
	gpVTab
 = 
sql™e3G‘VTabË
(
db
, 
pTab
);

85467 ifÐ
	gpVTab
->
	gpVb
->
	gpModuË
->
	gxR’ame
==0 ){

85468 
pVTab
 = 0;

85478 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

85479 ifÐ
	gv
==0 ){

85480 
ex™_»Çme_bË
;

85482 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 
pVTab
!=0, 
iDb
);

85483 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

85490 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


85491 ifÐ
	gpVTab
 ){

85492 
	gi
 = ++
pP¬£
->
nMem
;

85493 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
i
, 0, 
zName
, 0);

85494 
sql™e3VdbeAddOp4
(
v
, 
OP_VR’ame
, 
i
, 0, 0,(cÚ¡ *)
pVTab
, 
P4_VTAB
);

85495 
sql™e3MayAbÜt
(
pP¬£
);

85500 
	gzTabName
 = 
pTab
->
zName
;

85501 
	gnTabName
 = 
sql™e3Utf8Ch¬L’
(
zTabName
, -1);

85503 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

85504 ifÐ
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

85508 ifÐ(
	gzWh”e
=
wh”eFÜeignKeys
(
pP¬£
, 
pTab
))!=0 ){

85509 
sql™e3Ne¡edP¬£
(
pP¬£
,

85512 "WHERE %s;", 
zDb
, 
SCHEMA_TABLE
(
iDb
), 
zTabName
, 
zName
, 
zWh”e
);

85513 
sql™e3DbF»e
(
db
, 
zWh”e
);

85519 
sql™e3Ne¡edP¬£
(
pP¬£
,

85521 #ifdeà
SQLITE_OMIT_TRIGGER


85536 
zDb
, 
SCHEMA_TABLE
(
iDb
), 
zName
, zName, zName,

85537 #iâdeà
SQLITE_OMIT_TRIGGER


85538 
zName
,

85540 
zName
, 
nTabName
, 
zTabName


85543 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


85547 ifÐ
sql™e3FšdTabË
(
db
, "sql™e_£qu’û", 
zDb
) ){

85548 
sql™e3Ne¡edP¬£
(
pP¬£
,

85550 
zDb
, 
zName
, 
pTab
->zName);

85554 #iâdeà
SQLITE_OMIT_TRIGGER


85559 ifÐ(
	gzWh”e
=
wh”eTempTrigg”s
(
pP¬£
, 
pTab
))!=0 ){

85560 
sql™e3Ne¡edP¬£
(
pP¬£
,

85564 "WHERE %s;", 
zName
, zName, 
zWh”e
);

85565 
sql™e3DbF»e
(
db
, 
zWh”e
);

85569 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

85570 ifÐ
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

85571 
FKey
 *
	gp
;

85572 
	gp
=
sql™e3FkReã»nûs
(
pTab
);…;…=
p
->
pNextTo
){

85573 
TabË
 *
pFrom
 = 
p
->pFrom;

85574 ifÐ
	gpFrom
!=
pTab
 ){

85575 
»lßdTabËSchema
(
pP¬£
, 
p
->
pFrom
,…From->
zName
);

85582 
»lßdTabËSchema
(
pP¬£
, 
pTab
, 
zName
);

85584 
	gex™_»Çme_bË
:

85585 
sql™e3SrcLi¡D–‘e
(
db
, 
pSrc
);

85586 
sql™e3DbF»e
(
db
, 
zName
);

85587 
	gdb
->
	gæags
 = 
§vedDbFÏgs
;

85595 
SQLITE_PRIVATE
 
sql™e3MšimumFžeFÜm©
(
P¬£
 *
pP¬£
, 
iDb
, 
mšFÜm©
){

85596 
Vdbe
 *
	gv
;

85597 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

85601 ifÐ
ALWAYS
(
v
) ){

85602 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

85603 
	gr2
 = 
sql™e3G‘TempReg
(
pP¬£
);

85604 
	gj1
;

85605 
sql™e3VdbeAddOp3
(
v
, 
OP_R—dCook›
, 
iDb
, 
r1
, 
BTREE_FILE_FORMAT
);

85606 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

85607 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
mšFÜm©
, 
r2
);

85608 
	gj1
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_Ge
, 
r2
, 0, 
r1
);

85609 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
); 
VdbeCov”age
(v);

85610 
sql™e3VdbeAddOp3
(
v
, 
OP_S‘Cook›
, 
iDb
, 
BTREE_FILE_FORMAT
, 
r2
);

85611 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

85612 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

85613 
sql™e3R–—£TempReg
(
pP¬£
, 
r2
);

85625 
SQLITE_PRIVATE
 
sql™e3AÉ”FšishAddCÞumn
(
P¬£
 *
pP¬£
, 
Tok’
 *
pCÞDef
){

85626 
TabË
 *
	gpNew
;

85627 
TabË
 *
	gpTab
;

85628 
	giDb
;

85629 cÚ¡ *
	gzDb
;

85630 cÚ¡ *
	gzTab
;

85631 *
	gzCÞ
;

85632 
CÞumn
 *
	gpCÞ
;

85633 
Ex´
 *
	gpDæt
;

85634 
sql™e3
 *
	gdb
;

85636 
	gdb
 = 
pP¬£
->
db
;

85637 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ) ;

85638 
	gpNew
 = 
pP¬£
->
pNewTabË
;

85639 
as£¹
Ð
pNew
 );

85641 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

85642 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pNew
->
pSchema
);

85643 
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

85644 
	gzTab
 = &
pNew
->
zName
[16];

85645 
	gpCÞ
 = &
pNew
->
aCÞ
[pNew->
nCÞ
-1];

85646 
	gpDæt
 = 
pCÞ
->
pDæt
;

85647 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zTab
, 
zDb
);

85648 
as£¹
Ð
pTab
 );

85650 #iâdeà
SQLITE_OMIT_AUTHORIZATION


85652 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_ALTER_TABLE
, 
zDb
, 
pTab
->
zName
, 0) ){

85661 ifÐ
	gpDæt
 &&…Dæt->
	gÝ
==
TK_NULL
 ){

85662 
pDæt
 = 0;

85669 ifÐ
	gpCÞ
->
	gcÞFÏgs
 & 
	gCOLFLAG_PRIMKEY
 ){

85670 
sql™e3E¼ÜMsg
(
pP¬£
, "Cannot‡dd‡ PRIMARY KEY column");

85673 ifÐ
	gpNew
->
	gpIndex
 ){

85674 
sql™e3E¼ÜMsg
(
pP¬£
, "Cannot‡dd‡ UNIQUE column");

85677 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
è&& 
	gpNew
->
	gpFKey
 && 
	gpDæt
 ){

85678 
sql™e3E¼ÜMsg
(
pP¬£
,

85682 ifÐ
	gpCÞ
->
	gnÙNuÎ
 && !
	gpDæt
 ){

85683 
sql™e3E¼ÜMsg
(
pP¬£
,

85691 ifÐ
	gpDæt
 ){

85692 
sql™e3_v®ue
 *
	gpV®
 = 0;

85693 ifÐ
sql™e3V®ueFromEx´
(
db
, 
pDæt
, 
SQLITE_UTF8
, 
SQLITE_AFF_NONE
, &
pV®
) ){

85694 
	gdb
->
	gm®locFažed
 = 1;

85697 ifÐ!
	gpV®
 ){

85698 
sql™e3E¼ÜMsg
(
pP¬£
, "Cannot‡dd‡ column with‚on-constant default");

85701 
sql™e3V®ueF»e
(
pV®
);

85705 
	gzCÞ
 = 
sql™e3DbSŒNDup
(
db
, (*)
pCÞDef
->
z
,…CÞDef->
n
);

85706 ifÐ
	gzCÞ
 ){

85707 *
	gzEnd
 = &
zCÞ
[
pCÞDef
->
n
-1];

85708 
	g§vedDbFÏgs
 = 
db
->
æags
;

85709  
	gzEnd
>
	gzCÞ
 && (*zEnd==';' || 
sql™e3Is¥aû
(*
zEnd
)) ){

85710 *
zEnd
-- = '\0';

85712 
	gdb
->
	gæags
 |ð
SQLITE_P»ãrBužtš
;

85713 
sql™e3Ne¡edP¬£
(
pP¬£
,

85717 
zDb
, 
SCHEMA_TABLE
(
iDb
), 
pNew
->
addCÞOff£t
, 
zCÞ
,…New->addColOffset+1,

85718 
zTab


85720 
sql™e3DbF»e
(
db
, 
zCÞ
);

85721 
	gdb
->
	gæags
 = 
§vedDbFÏgs
;

85728 
sql™e3MšimumFžeFÜm©
(
pP¬£
, 
iDb
, 
pDæt
 ? 3 : 2);

85731 
»lßdTabËSchema
(
pP¬£
, 
pTab
,…Tab->
zName
);

85749 
SQLITE_PRIVATE
 
sql™e3AÉ”BegšAddCÞumn
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pSrc
){

85750 
TabË
 *
	gpNew
;

85751 
TabË
 *
	gpTab
;

85752 
Vdbe
 *
	gv
;

85753 
	giDb
;

85754 
	gi
;

85755 
	gnAÎoc
;

85756 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

85759 
as£¹
Ð
pP¬£
->
pNewTabË
==0 );

85760 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

85761 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gex™_begš_add_cÞumn
;

85762 
	gpTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, &
pSrc
->
a
[0]);

85763 ifÐ!
	gpTab
 ) 
	gex™_begš_add_cÞumn
;

85765 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


85766 ifÐ
IsVœtu®
(
pTab
) ){

85767 
sql™e3E¼ÜMsg
(
pP¬£
, "virtualables may‚ot be‡ltered");

85768 
	gex™_begš_add_cÞumn
;

85773 ifÐ
	gpTab
->
	gpS–eù
 ){

85774 
sql™e3E¼ÜMsg
(
pP¬£
, "Cannot‡dd‡ columno‡ view");

85775 
	gex™_begš_add_cÞumn
;

85777 ifÐ
	gSQLITE_OK
!=
isSy¡emTabË
(
pP¬£
, 
pTab
->
zName
) ){

85778 
	gex™_begš_add_cÞumn
;

85781 
as£¹
Ð
pTab
->
addCÞOff£t
>0 );

85782 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

85791 
	gpNew
 = (
TabË
*)
sql™e3DbM®locZ”o
(
db
, (Table));

85792 ifÐ!
	gpNew
 ) 
	gex™_begš_add_cÞumn
;

85793 
	gpP¬£
->
	gpNewTabË
 = 
pNew
;

85794 
	gpNew
->
	gnRef
 = 1;

85795 
	gpNew
->
	gnCÞ
 = 
pTab
->
nCÞ
;

85796 
as£¹
Ð
pNew
->
nCÞ
>0 );

85797 
	gnAÎoc
 = (((
pNew
->
nCÞ
-1)/8)*8)+8;

85798 
as£¹
Ð
nAÎoc
>=
pNew
->
nCÞ
 &&‚Alloc%8==0 &&‚Alloc-pNew->nCol<8 );

85799 
	gpNew
->
	gaCÞ
 = (
CÞumn
*)
sql™e3DbM®locZ”o
(
db
, (CÞumn)*
nAÎoc
);

85800 
	gpNew
->
	gzName
 = 
sql™e3MPrštf
(
db
, "sql™e_®‹¹ab_%s", 
pTab
->
zName
);

85801 ifÐ!
	gpNew
->
	gaCÞ
 || !pNew->
	gzName
 ){

85802 
	gdb
->
	gm®locFažed
 = 1;

85803 
	gex™_begš_add_cÞumn
;

85805 
memýy
(
pNew
->
aCÞ
, 
pTab
->aCÞ, (
CÞumn
)*pNew->
nCÞ
);

85806 
	gi
=0; i<
	gpNew
->
	gnCÞ
; i++){

85807 
CÞumn
 *
	gpCÞ
 = &
pNew
->
aCÞ
[
i
];

85808 
	gpCÞ
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pCÞ
->
zName
);

85809 
	gpCÞ
->
	gzCÞl
 = 0;

85810 
	gpCÞ
->
	gzTy³
 = 0;

85811 
	gpCÞ
->
	gpDæt
 = 0;

85812 
	gpCÞ
->
	gzDæt
 = 0;

85814 
	gpNew
->
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

85815 
	gpNew
->
	gaddCÞOff£t
 = 
pTab
->
addCÞOff£t
;

85816 
	gpNew
->
	gnRef
 = 1;

85819 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

85820 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

85821 ifÐ!
	gv
 ) 
	gex™_begš_add_cÞumn
;

85822 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

85824 
	gex™_begš_add_cÞumn
:

85825 
sql™e3SrcLi¡D–‘e
(
db
, 
pSrc
);

85973 #iâdeà
SQLITE_OMIT_ANALYZE


85975 #ià
defšed
(
SQLITE_ENABLE_STAT4
)

85976 
	#IsSt4
 1

	)

85977 
	#IsSt3
 0

	)

85978 #–ià
defšed
(
SQLITE_ENABLE_STAT3
)

85979 
	#IsSt4
 0

	)

85980 
	#IsSt3
 1

	)

85982 
	#IsSt4
 0

	)

85983 
	#IsSt3
 0

	)

85984 #undeà
SQLITE_STAT4_SAMPLES


85985 
	#SQLITE_STAT4_SAMPLES
 1

	)

85987 
	#IsSt34
 (
IsSt3
+
IsSt4
è

	)

86002 
Ý’StTabË
(

86003 
P¬£
 *
pP¬£
,

86004 
iDb
,

86005 
iStCur
,

86006 cÚ¡ *
zWh”e
,

86007 cÚ¡ *
zWh”eTy³


86010 cÚ¡ *
	gzName
;

86011 cÚ¡ *
	gzCÞs
;

86012 } 
	gaTabË
[] = {

86014 #ià
defšed
(
SQLITE_ENABLE_STAT4
)

86017 #–ià
defšed
(
SQLITE_ENABLE_STAT3
)

86025 
	gi
;

86026 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

86027 
Db
 *
	gpDb
;

86028 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

86029 
	gaRoÙ
[
A¼aySize
(
aTabË
)];

86030 
u8
 
	gaC»©eTbl
[
A¼aySize
(
aTabË
)];

86032 ifÐ
	gv
==0 ) ;

86033 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

86034 
as£¹
Ð
sql™e3VdbeDb
(
v
)==
db
 );

86035 
	gpDb
 = &
db
->
aDb
[
iDb
];

86040 
	gi
=0; i<
A¼aySize
(
aTabË
); i++){

86041 cÚ¡ *
	gzTab
 = 
aTabË
[
i
].
zName
;

86042 
TabË
 *
	gpSt
;

86043 ifÐ(
	gpSt
 = 
sql™e3FšdTabË
(
db
, 
zTab
, 
pDb
->
zName
))==0 ){

86044 ifÐ
aTabË
[
i
].
zCÞs
 ){

86049 
sql™e3Ne¡edP¬£
(
pP¬£
,

86050 "CREATE TABLE %Q.%s(%s)", 
pDb
->
zName
, 
zTab
, 
aTabË
[
i
].
zCÞs


86052 
	gaRoÙ
[
i
] = 
pP¬£
->
»gRoÙ
;

86053 
	gaC»©eTbl
[
i
] = 
OPFLAG_P2ISREG
;

86059 
	gaRoÙ
[
i
] = 
pSt
->
Šum
;

86060 
	gaC»©eTbl
[
i
] = 0;

86061 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
aRoÙ
[
i
], 1, 
zTab
);

86062 ifÐ
	gzWh”e
 ){

86063 
sql™e3Ne¡edP¬£
(
pP¬£
,

86065 
pDb
->
zName
, 
zTab
, 
zWh”eTy³
, 
zWh”e


86069 
sql™e3VdbeAddOp2
(
v
, 
OP_CË¬
, 
aRoÙ
[
i
], 
iDb
);

86075 
	gi
=0; 
	gaTabË
[
i
].
	gzCÞs
; i++){

86076 
as£¹
Ð
i
<
A¼aySize
(
aTabË
) );

86077 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_O³nWr™e
, 
iStCur
+
i
, 
aRoÙ
[i], 
iDb
, 3);

86078 
sql™e3VdbeChªgeP5
(
v
, 
aC»©eTbl
[
i
]);

86079 
VdbeComm’t
((
v
, 
aTabË
[
i
].
zName
));

86086 #iâdeà
SQLITE_STAT4_SAMPLES


86087 
	#SQLITE_STAT4_SAMPLES
 24

	)

86095 
St4Accum
 
	tSt4Accum
;

86096 
St4Sam¶e
 
	tSt4Sam¶e
;

86097 
	sSt4Sam¶e
 {

86098 
tRowút
 *
	gªEq
;

86099 
tRowút
 *
	gªDLt
;

86100 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86101 
tRowút
 *
	gªLt
;

86103 
i64
 
	giRowid
;

86104 
u8
 *
	gaRowid
;

86105 } 
	gu
;

86106 
u32
 
	gnRowid
;

86107 
u8
 
	gisPSam¶e
;

86108 
	giCÞ
;

86109 
u32
 
	giHash
;

86112 
	sSt4Accum
 {

86113 
tRowút
 
	gnRow
;

86114 
tRowút
 
	gnPSam¶e
;

86115 
	gnCÞ
;

86116 
	gnKeyCÞ
;

86117 
	gmxSam¶e
;

86118 
St4Sam¶e
 
	gcu¼’t
;

86119 
u32
 
	giPº
;

86120 
St4Sam¶e
 *
	gaBe¡
;

86121 
	giMš
;

86122 
	gnSam¶e
;

86123 
	giG‘
;

86124 
St4Sam¶e
 *
	ga
;

86125 
sql™e3
 *
	gdb
;

86130 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86131 
§m¶eCË¬
(
sql™e3
 *
db
, 
St4Sam¶e
 *
p
){

86132 
as£¹
Ð
db
!=0 );

86133 ifÐ
	gp
->
	gnRowid
 ){

86134 
sql™e3DbF»e
(
db
, 
p
->
u
.
aRowid
);

86135 
	gp
->
	gnRowid
 = 0;

86142 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86143 
§m¶eS‘Rowid
(
sql™e3
 *
db
, 
St4Sam¶e
 *
p
, 
n
, cÚ¡ 
u8
 *
pD©a
){

86144 
as£¹
Ð
db
!=0 );

86145 ifÐ
	gp
->
	gnRowid
 ) 
sql™e3DbF»e
(
db
, 
p
->
u
.
aRowid
);

86146 
	gp
->
	gu
.
	gaRowid
 = 
sql™e3DbM®locRaw
(
db
, 
n
);

86147 ifÐ
	gp
->
	gu
.
	gaRowid
 ){

86148 
	gp
->
	gnRowid
 = 
n
;

86149 
memýy
(
p
->
u
.
aRowid
, 
pD©a
, 
n
);

86151 
	gp
->
	gnRowid
 = 0;

86158 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86159 
§m¶eS‘RowidIÁ64
(
sql™e3
 *
db
, 
St4Sam¶e
 *
p
, 
i64
 
iRowid
){

86160 
as£¹
Ð
db
!=0 );

86161 ifÐ
	gp
->
	gnRowid
 ) 
sql™e3DbF»e
(
db
, 
p
->
u
.
aRowid
);

86162 
	gp
->
	gnRowid
 = 0;

86163 
	gp
->
	gu
.
	giRowid
 = 
iRowid
;

86171 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86172 
§m¶eCÝy
(
St4Accum
 *
p
, 
St4Sam¶e
 *
pTo
, St4Sam¶*
pFrom
){

86173 
	gpTo
->
	gisPSam¶e
 = 
pFrom
->
isPSam¶e
;

86174 
	gpTo
->
	giCÞ
 = 
pFrom
->
iCÞ
;

86175 
	gpTo
->
	giHash
 = 
pFrom
->
iHash
;

86176 
memýy
(
pTo
->
ªEq
, 
pFrom
->ªEq, (
tRowút
)*
p
->
nCÞ
);

86177 
memýy
(
pTo
->
ªLt
, 
pFrom
->ªLt, (
tRowút
)*
p
->
nCÞ
);

86178 
memýy
(
pTo
->
ªDLt
, 
pFrom
->ªDLt, (
tRowút
)*
p
->
nCÞ
);

86179 ifÐ
	gpFrom
->
	gnRowid
 ){

86180 
§m¶eS‘Rowid
(
p
->
db
, 
pTo
, 
pFrom
->
nRowid
,…From->
u
.
aRowid
);

86182 
§m¶eS‘RowidIÁ64
(
p
->
db
, 
pTo
, 
pFrom
->
u
.
iRowid
);

86190 
¡©4De¡ruùÜ
(*
pOld
){

86191 
St4Accum
 *
	gp
 = (St4Accum*)
pOld
;

86192 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86193 
	gi
;

86194 
	gi
=0; i<
	gp
->
	gnCÞ
; i++è
§m¶eCË¬
(
p
->
db
,…->
aBe¡
+
i
);

86195 
	gi
=0; i<
	gp
->
	gmxSam¶e
; i++è
§m¶eCË¬
(
p
->
db
,…->
a
+
i
);

86196 
§m¶eCË¬
(
p
->
db
, &p->
cu¼’t
);

86198 
sql™e3DbF»e
(
p
->
db
,…);

86224 
¡©In™
(

86225 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

86226 
¬gc
,

86227 
sql™e3_v®ue
 **
¬gv


86229 
St4Accum
 *
	gp
;

86230 
	gnCÞ
;

86231 
	gnKeyCÞ
;

86232 
	gnCÞUp
;

86233 
	gn
;

86234 
sql™e3
 *
	gdb
;

86235 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86236 
	gmxSam¶e
 = 
SQLITE_STAT4_SAMPLES
;

86240 
UNUSED_PARAMETER
(
¬gc
);

86241 
	gnCÞ
 = 
sql™e3_v®ue_št
(
¬gv
[0]);

86242 
as£¹
Ð
nCÞ
>0 );

86243 
	gnCÞUp
 = (
tRowút
)<8 ? (
nCÞ
+1)&~1 :‚Col;

86244 
	gnKeyCÞ
 = 
sql™e3_v®ue_št
(
¬gv
[1]);

86245 
as£¹
Ð
nKeyCÞ
<=
nCÞ
 );

86246 
as£¹
Ð
nKeyCÞ
>0 );

86249 
	gn
 = (*
p
)

86250 + (
tRowút
)*
nCÞUp


86251 + (
tRowút
)*
nCÞUp


86252 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86253 + (
tRowút
)*
nCÞUp


86254 + (
St4Sam¶e
)*(
nCÞ
+
mxSam¶e
)

86255 + (
tRowút
)*3*
nCÞUp
*(
nCÞ
+
mxSam¶e
)

86258 
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

86259 
	gp
 = 
sql™e3DbM®locZ”o
(
db
, 
n
);

86260 ifÐ
	gp
==0 ){

86261 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

86265 
	gp
->
	gdb
 = 
db
;

86266 
	gp
->
	gnRow
 = 0;

86267 
	gp
->
	gnCÞ
 = 
nCÞ
;

86268 
	gp
->
	gnKeyCÞ
 = 
nKeyCÞ
;

86269 
	gp
->
	gcu¼’t
.
	gªDLt
 = (
tRowút
*)&
p
[1];

86270 
	gp
->
	gcu¼’t
.
	gªEq
 = &
p
->
cu¼’t
.
ªDLt
[
nCÞUp
];

86272 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86274 
u8
 *
	gpS·û
;

86275 
	gi
;

86277 
	gp
->
	giG‘
 = -1;

86278 
	gp
->
	gmxSam¶e
 = 
mxSam¶e
;

86279 
	gp
->
	gnPSam¶e
 = (
tRowút
)(
sql™e3_v®ue_št64
(
¬gv
[2])/(
mxSam¶e
/3+1) + 1);

86280 
	gp
->
	gcu¼’t
.
	gªLt
 = &
p
->
cu¼’t
.
ªEq
[
nCÞUp
];

86281 
	gp
->
	giPº
 = 
nCÞ
*0x689e962d ^ 
sql™e3_v®ue_št
(
¬gv
[2])*0xd0944565;

86284 
	gp
->
	ga
 = (
St4Sam¶e
*)&
p
->
cu¼’t
.
ªLt
[
nCÞUp
];

86285 
	gp
->
	gaBe¡
 = &
p
->
a
[
mxSam¶e
];

86286 
	gpS·û
 = (
u8
*)(&
p
->
a
[
mxSam¶e
+
nCÞ
]);

86287 
	gi
=0; i<(
	gmxSam¶e
+
	gnCÞ
); i++){

86288 
	gp
->
	ga
[
i
].
	gªEq
 = (
tRowút
 *)
pS·û
; 
	gpS·û
 +ð(ÑRowútè* 
nCÞUp
);

86289 
	gp
->
	ga
[
i
].
	gªLt
 = (
tRowút
 *)
pS·û
; 
	gpS·û
 +ð(ÑRowútè* 
nCÞUp
);

86290 
	gp
->
	ga
[
i
].
	gªDLt
 = (
tRowút
 *)
pS·û
; 
	gpS·û
 +ð(ÑRowútè* 
nCÞUp
);

86292 
as£¹
Ð(
pS·û
 - (
u8
*)
p
)==
n
 );

86294 
	gi
=0; i<
	gnCÞ
; i++){

86295 
	gp
->
	gaBe¡
[
i
].
	giCÞ
 = i;

86304 
sql™e3_»suÉ_blob
(
cÚ‹xt
, 
p
, (*p), 
¡©4De¡ruùÜ
);

86306 cÚ¡ 
FuncDef
 
	g¡©In™Funcdef
 = {

86307 2+
IsSt34
,

86308 
SQLITE_UTF8
,

86311 
¡©In™
,

86319 #ifdeà
SQLITE_ENABLE_STAT4


86331 
§m¶eIsB‘‹rPo¡
(

86332 
St4Accum
 *
pAccum
,

86333 
St4Sam¶e
 *
pNew
,

86334 
St4Sam¶e
 *
pOld


86336 
	gnCÞ
 = 
pAccum
->
nCÞ
;

86337 
	gi
;

86338 
as£¹
Ð
pNew
->
iCÞ
==
pOld
->iCol );

86339 
	gi
=
pNew
->
iCÞ
+1; i<
	gnCÞ
; i++){

86340 ifÐ
	gpNew
->
	gªEq
[
i
]>
	gpOld
->anEq[i] )  1;

86341 ifÐ
	gpNew
->
	gªEq
[
i
]<
	gpOld
->anEq[i] )  0;

86343 ifÐ
	gpNew
->
	giHash
>
	gpOld
->iHash )  1;

86348 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86355 
§m¶eIsB‘‹r
(

86356 
St4Accum
 *
pAccum
,

86357 
St4Sam¶e
 *
pNew
,

86358 
St4Sam¶e
 *
pOld


86360 
tRowút
 
	gnEqNew
 = 
pNew
->
ªEq
[pNew->
iCÞ
];

86361 
tRowút
 
	gnEqOld
 = 
pOld
->
ªEq
[pOld->
iCÞ
];

86363 
as£¹
Ð
pOld
->
isPSam¶e
==0 && 
pNew
->isPSample==0 );

86364 
as£¹
Ð
IsSt4
 || (
pNew
->
iCÞ
==0 && 
pOld
->iCol==0) );

86366 ifÐ(
	gnEqNew
>
	gnEqOld
) )  1;

86367 #ifdeà
SQLITE_ENABLE_STAT4


86368 ifÐ
	gnEqNew
==
nEqOld
 ){

86369 ifÐ
pNew
->
iCÞ
<
pOld
->iCol )  1;

86370  (
	gpNew
->
	giCÞ
==
pOld
->
iCÞ
 && 
§m¶eIsB‘‹rPo¡
(
pAccum
, 
pNew
,…Old));

86374  (
	gnEqNew
==
nEqOld
 && 
pNew
->
iHash
>
pOld
->iHash);

86382 
§m¶eIn£¹
(
St4Accum
 *
p
, 
St4Sam¶e
 *
pNew
, 
nEqZ”o
){

86383 
St4Sam¶e
 *
	gpSam¶e
 = 0;

86384 
	gi
;

86386 
as£¹
Ð
IsSt4
 || 
nEqZ”o
==0 );

86388 #ifdeà
SQLITE_ENABLE_STAT4


86389 ifÐ
	gpNew
->
	gisPSam¶e
==0 ){

86390 
St4Sam¶e
 *
pUpg¿de
 = 0;

86391 
as£¹
Ð
pNew
->
ªEq
[pNew->
iCÞ
]>0 );

86398 
	gi
=
p
->
nSam¶e
-1; i>=0; i--){

86399 
St4Sam¶e
 *
	gpOld
 = &
p
->
a
[
i
];

86400 ifÐ
	gpOld
->
	gªEq
[
pNew
->
iCÞ
]==0 ){

86401 ifÐ
pOld
->
isPSam¶e
 ) ;

86402 
as£¹
Ð
pOld
->
iCÞ
>
pNew
->iCol );

86403 
as£¹
Ð
§m¶eIsB‘‹r
(
p
, 
pNew
, 
pOld
) );

86404 ifÐ
	gpUpg¿de
==0 || 
§m¶eIsB‘‹r
(
p
, 
pOld
, 
pUpg¿de
) ){

86405 
	gpUpg¿de
 = 
pOld
;

86409 ifÐ
	gpUpg¿de
 ){

86410 
	gpUpg¿de
->
	giCÞ
 = 
pNew
->
iCÞ
;

86411 
	gpUpg¿de
->
	gªEq
[
pUpg¿de
->
iCÞ
] = 
pNew
->
ªEq
[pUpgrade->iCol];

86412 
	gfšd_Ãw_mš
;

86418 ifÐ
	gp
->
	gnSam¶e
>=
p
->
mxSam¶e
 ){

86419 
St4Sam¶e
 *
pMš
 = &
p
->
a
[p->
iMš
];

86420 
tRowút
 *
	gªEq
 = 
pMš
->
ªEq
;

86421 
tRowút
 *
	gªLt
 = 
pMš
->
ªLt
;

86422 
tRowút
 *
	gªDLt
 = 
pMš
->
ªDLt
;

86423 
§m¶eCË¬
(
p
->
db
, 
pMš
);

86424 
memmove
(
pMš
, &pMš[1], (
p
->
a
[0])*Õ->
nSam¶e
-p->
iMš
-1));

86425 
	gpSam¶e
 = &
p
->
a
[p->
nSam¶e
-1];

86426 
	gpSam¶e
->
	gnRowid
 = 0;

86427 
	gpSam¶e
->
	gªEq
 = 
ªEq
;

86428 
	gpSam¶e
->
	gªDLt
 = 
ªDLt
;

86429 
	gpSam¶e
->
	gªLt
 = 
ªLt
;

86430 
	gp
->
	gnSam¶e
 = 
p
->
mxSam¶e
-1;

86436 #ifdeà
SQLITE_ENABLE_STAT4


86437 
as£¹
Ð
p
->
nSam¶e
==0

86438 || 
pNew
->
ªLt
[
p
->
nCÞ
-1] >…->
a
[p->
nSam¶e
-1].anLt[p->nCol-1] );

86442 
	gpSam¶e
 = &
p
->
a
[p->
nSam¶e
];

86443 
§m¶eCÝy
(
p
, 
pSam¶e
, 
pNew
);

86444 
	gp
->
	gnSam¶e
++;

86447 
mem£t
(
pSam¶e
->
ªEq
, 0, (
tRowút
)*
nEqZ”o
);

86449 #ifdeà
SQLITE_ENABLE_STAT4


86450 
	gfšd_Ãw_mš
:

86452 ifÐ
p
->
nSam¶e
>õ->
mxSam¶e
 ){

86453 
iMš
 = -1;

86454 
	gi
=0; i<
	gp
->
	gmxSam¶e
; i++){

86455 ifÐ
	gp
->
	ga
[
i
].
	gisPSam¶e
 ) ;

86456 ifÐ
	giMš
<0 || 
§m¶eIsB‘‹r
(
p
, &p->
a
[
iMš
], &p->a[
i
]) ){

86457 
	giMš
 = 
i
;

86460 
as£¹
Ð
iMš
>=0 );

86461 
	gp
->
	giMš
 = 
iMš
;

86472 
§m¶ePushP»vious
(
St4Accum
 *
p
, 
iChng
){

86473 #ifdeà
SQLITE_ENABLE_STAT4


86474 
	gi
;

86478 
	gi
=(
p
->
nCÞ
-2); i>=
iChng
; i--){

86479 
St4Sam¶e
 *
	gpBe¡
 = &
p
->
aBe¡
[
i
];

86480 
	gpBe¡
->
	gªEq
[
i
] = 
p
->
cu¼’t
.
ªEq
[i];

86481 ifÐ
	gp
->
	gnSam¶e
<p->
	gmxSam¶e
 || 
§m¶eIsB‘‹r
(
p
, 
pBe¡
, &p->
a
[p->
iMš
]) ){

86482 
§m¶eIn£¹
(
p
, 
pBe¡
, 
i
);

86487 
	gi
=
p
->
nSam¶e
-1; i>=0; i--){

86488 
	gj
;

86489 
	gj
=
iChng
; j<
	gp
->
	gnCÞ
; j++){

86490 ifÐ
	gp
->
	ga
[
i
].
	gªEq
[
j
]==0 ) 
p
->
a
[i].
ªEq
[j] =…->
cu¼’t
.anEq[j];

86495 #ià
defšed
(
SQLITE_ENABLE_STAT3
è&& !defšed(
SQLITE_ENABLE_STAT4
)

86496 ifÐ
	giChng
==0 ){

86497 
tRowút
 
nLt
 = 
p
->
cu¼’t
.
ªLt
[0];

86498 
tRowút
 
	gnEq
 = 
p
->
cu¼’t
.
ªEq
[0];

86501 ifÐ(
	gnLt
/
	gp
->
	gnPSam¶e
)!=(
nLt
+
nEq
)/
p
->
nPSam¶e
 ){

86502 
p
->
cu¼’t
.
isPSam¶e
 = 1;

86503 
§m¶eIn£¹
(
p
, &p->
cu¼’t
, 0);

86504 
	gp
->
	gcu¼’t
.
	gisPSam¶e
 = 0;

86508 ifÐ
	gp
->
	gnSam¶e
<p->
	gmxSam¶e


86509 || 
§m¶eIsB‘‹r
(
p
, &p->
cu¼’t
, &p->
a
[p->
iMš
])

86511 
§m¶eIn£¹
(
p
, &p->
cu¼’t
, 0);

86516 #iâdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86517 
UNUSED_PARAMETER
Ð
p
 );

86518 
UNUSED_PARAMETER
Ð
iChng
 );

86538 
¡©Push
(

86539 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

86540 
¬gc
,

86541 
sql™e3_v®ue
 **
¬gv


86543 
	gi
;

86546 
St4Accum
 *
	gp
 = (St4Accum*)
sql™e3_v®ue_blob
(
¬gv
[0]);

86547 
	giChng
 = 
sql™e3_v®ue_št
(
¬gv
[1]);

86549 
UNUSED_PARAMETER
Ð
¬gc
 );

86550 
UNUSED_PARAMETER
Ð
cÚ‹xt
 );

86551 
as£¹
Ð
p
->
nCÞ
>0 );

86552 
as£¹
Ð
iChng
<
p
->
nCÞ
 );

86554 ifÐ
	gp
->
	gnRow
==0 ){

86556 
i
=0; 
	gi
<
	gp
->
	gnCÞ
; i++èp->
	gcu¼’t
.
	gªEq
[i] = 1;

86559 
§m¶ePushP»vious
(
p
, 
iChng
);

86563 
	gi
=0; i<
	giChng
; i++){

86564 
	gp
->
	gcu¼’t
.
	gªEq
[
i
]++;

86566 
	gi
=
iChng
; i<
	gp
->
	gnCÞ
; i++){

86567 
	gp
->
	gcu¼’t
.
	gªDLt
[
i
]++;

86568 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86569 
	gp
->
	gcu¼’t
.
	gªLt
[
i
] +ð
p
->
cu¼’t
.
ªEq
[i];

86571 
	gp
->
	gcu¼’t
.
	gªEq
[
i
] = 1;

86574 
	gp
->
	gnRow
++;

86575 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86576 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[2])==
SQLITE_INTEGER
 ){

86577 
§m¶eS‘RowidIÁ64
(
p
->
db
, &p->
cu¼’t
, 
sql™e3_v®ue_št64
(
¬gv
[2]));

86579 
§m¶eS‘Rowid
(
p
->
db
, &p->
cu¼’t
, 
sql™e3_v®ue_by‹s
(
¬gv
[2]),

86580 
sql™e3_v®ue_blob
(
¬gv
[2]));

86582 
	gp
->
	gcu¼’t
.
	giHash
 = 
p
->
iPº
 =…->iPrn*1103515245 + 12345;

86585 #ifdeà
SQLITE_ENABLE_STAT4


86587 
tRowút
 
	gnLt
 = 
p
->
cu¼’t
.
ªLt
[p->
nCÞ
-1];

86590 ifÐ(
	gnLt
/
	gp
->
	gnPSam¶e
)!=(
nLt
+1)/
p
->
nPSam¶e
 ){

86591 
p
->
cu¼’t
.
isPSam¶e
 = 1;

86592 
	gp
->
	gcu¼’t
.
	giCÞ
 = 0;

86593 
§m¶eIn£¹
(
p
, &p->
cu¼’t
,…->
nCÞ
-1);

86594 
	gp
->
	gcu¼’t
.
	gisPSam¶e
 = 0;

86598 
	gi
=0; i<(
	gp
->
	gnCÞ
-1); i++){

86599 
	gp
->
	gcu¼’t
.
	giCÞ
 = 
i
;

86600 ifÐ
	gi
>=
iChng
 || 
§m¶eIsB‘‹rPo¡
(
p
, &p->
cu¼’t
, &p->
aBe¡
[
i
]) ){

86601 
§m¶eCÝy
(
p
, &p->
aBe¡
[
i
], &p->
cu¼’t
);

86607 cÚ¡ 
FuncDef
 
	g¡©PushFuncdef
 = {

86608 2+
IsSt34
,

86609 
SQLITE_UTF8
,

86612 
¡©Push
,

86620 
	#STAT_GET_STAT1
 0

	)

86621 
	#STAT_GET_ROWID
 1

	)

86622 
	#STAT_GET_NEQ
 2

	)

86623 
	#STAT_GET_NLT
 3

	)

86624 
	#STAT_GET_NDLT
 4

	)

86639 
¡©G‘
(

86640 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

86641 
¬gc
,

86642 
sql™e3_v®ue
 **
¬gv


86644 
St4Accum
 *
	gp
 = (St4Accum*)
sql™e3_v®ue_blob
(
¬gv
[0]);

86645 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86647 
	geC®l
 = 
sql™e3_v®ue_št
(
¬gv
[1]);

86648 
as£¹
Ð
¬gc
==2 );

86649 
as£¹
Ð
eC®l
==
STAT_GET_STAT1
 ||ƒC®l==
STAT_GET_NEQ


86650 || 
eC®l
==
STAT_GET_ROWID
 ||ƒC®l==
STAT_GET_NLT


86651 || 
eC®l
==
STAT_GET_NDLT


86653 ifÐ
	geC®l
==
STAT_GET_STAT1
 )

86655 
as£¹
Ð
¬gc
==1 );

86679 *
	gz
;

86680 
	gi
;

86682 *
	gzR‘
 = 
sql™e3M®locZ”o
Ð(
p
->
nKeyCÞ
+1)*25 );

86683 ifÐ
	gzR‘
==0 ){

86684 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

86688 
sql™e3_¢´štf
(24, 
zR‘
, "%Îu", (
u64
)
p
->
nRow
);

86689 
	gz
 = 
zR‘
 + 
sql™e3SŒËn30
(zRet);

86690 
	gi
=0; i<
	gp
->
	gnKeyCÞ
; i++){

86691 
u64
 
	gnDi¡šù
 = 
p
->
cu¼’t
.
ªDLt
[
i
] + 1;

86692 
u64
 
	giV®
 = (
p
->
nRow
 + 
nDi¡šù
 - 1) /‚Distinct;

86693 
sql™e3_¢´štf
(24, 
z
, " %Îu", 
iV®
);

86694 
	gz
 +ð
sql™e3SŒËn30
(
z
);

86695 
as£¹
Ð
p
->
cu¼’t
.
ªEq
[
i
] );

86697 
as£¹
Ð
z
[0]=='\0' && z>
zR‘
 );

86699 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zR‘
, -1, 
sql™e3_ä“
);

86701 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86702 ifÐ
	geC®l
==
STAT_GET_ROWID
 ){

86703 ifÐ
p
->
iG‘
<0 ){

86704 
§m¶ePushP»vious
(
p
, 0);

86705 
	gp
->
	giG‘
 = 0;

86707 ifÐ
	gp
->
	giG‘
<p->
	gnSam¶e
 ){

86708 
St4Sam¶e
 *
	gpS
 = 
p
->
a
 +…->
iG‘
;

86709 ifÐ
	gpS
->
	gnRowid
==0 ){

86710 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
pS
->
u
.
iRowid
);

86712 
sql™e3_»suÉ_blob
(
cÚ‹xt
, 
pS
->
u
.
aRowid
,…S->
nRowid
,

86713 
SQLITE_TRANSIENT
);

86717 
tRowút
 *
	gaCÁ
 = 0;

86719 
as£¹
Ð
p
->
iG‘
<p->
nSam¶e
 );

86720  
	geC®l
 ){

86721 
	gSTAT_GET_NEQ
: 
aCÁ
 = 
p
->
a
[p->
iG‘
].
ªEq
; ;

86722 
	gSTAT_GET_NLT
: 
aCÁ
 = 
p
->
a
[p->
iG‘
].
ªLt
; ;

86724 
aCÁ
 = 
p
->
a
[p->
iG‘
].
ªDLt
;

86725 
	gp
->
	giG‘
++;

86730 ifÐ
	gIsSt3
 ){

86731 
sql™e3_»suÉ_št64
(
cÚ‹xt
, (
i64
)
aCÁ
[0]);

86733 *
	gzR‘
 = 
sql™e3M®locZ”o
(
p
->
nCÞ
 * 25);

86734 ifÐ
	gzR‘
==0 ){

86735 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

86737 
	gi
;

86738 *
	gz
 = 
zR‘
;

86739 
	gi
=0; i<
	gp
->
	gnCÞ
; i++){

86740 
sql™e3_¢´štf
(24, 
z
, "%Îu ", (
u64
)
aCÁ
[
i
]);

86741 
	gz
 +ð
sql™e3SŒËn30
(
z
);

86743 
as£¹
Ð
z
[0]=='\0' && z>
zR‘
 );

86744 
	gz
[-1] = '\0';

86745 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zR‘
, -1, 
sql™e3_ä“
);

86750 #iâdeà
SQLITE_DEBUG


86751 
UNUSED_PARAMETER
Ð
¬gc
 );

86754 cÚ¡ 
FuncDef
 
	g¡©G‘Funcdef
 = {

86755 1+
IsSt34
,

86756 
SQLITE_UTF8
,

86759 
¡©G‘
,

86767 
ÿÎStG‘
(
Vdbe
 *
v
, 
»gSt4
, 
iP¬am
, 
»gOut
){

86768 
as£¹
Ð
»gOut
!=
»gSt4
 &&„egOut!=regStat4+1 );

86769 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86770 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
iP¬am
, 
»gSt4
+1);

86771 #–ià
SQLITE_DEBUG


86772 
as£¹
Ð
iP¬am
==
STAT_GET_STAT1
 );

86774 
UNUSED_PARAMETER
Ð
iP¬am
 );

86776 
sql™e3VdbeAddOp3
(
v
, 
OP_FunùiÚ
, 0, 
»gSt4
, 
»gOut
);

86777 
sql™e3VdbeChªgeP4
(
v
, -1, (*)&
¡©G‘Funcdef
, 
P4_FUNCDEF
);

86778 
sql™e3VdbeChªgeP5
(
v
, 1 + 
IsSt34
);

86785 
ª®yzeOÃTabË
(

86786 
P¬£
 *
pP¬£
,

86787 
TabË
 *
pTab
,

86788 
Index
 *
pOÆyIdx
,

86789 
iStCur
,

86790 
iMem
,

86791 
iTab


86793 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

86794 
Index
 *
	gpIdx
;

86795 
	giIdxCur
;

86796 
	giTabCur
;

86797 
Vdbe
 *
	gv
;

86798 
	gi
;

86799 
	gjZ”oRows
 = -1;

86800 
	giDb
;

86801 
u8
 
	gÃedTabËCÁ
 = 1;

86802 
	g»gNewRowid
 = 
iMem
++;

86803 
	g»gSt4
 = 
iMem
++;

86804 
	g»gChng
 = 
iMem
++;

86805 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86806 
	g»gRowid
 = 
iMem
++;

86808 
	g»gTemp
 = 
iMem
++;

86809 
	g»gTabÇme
 = 
iMem
++;

86810 
	g»gIdxÇme
 = 
iMem
++;

86811 
	g»gSt1
 = 
iMem
++;

86812 
	g»gP»v
 = 
iMem
;

86814 
	gpP¬£
->
	gnMem
 = 
MAX
(
pP¬£
->
nMem
, 
iMem
);

86815 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

86816 ifÐ
	gv
==0 || 
NEVER
(
pTab
==0) ){

86819 ifÐ
	gpTab
->
	gŠum
==0 ){

86823 ifÐ
sql™e3_¡ºicmp
(
pTab
->
zName
, "sqlite_", 7)==0 ){

86827 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

86828 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

86829 
as£¹
Ð
iDb
>=0 );

86830 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

86831 #iâdeà
SQLITE_OMIT_AUTHORIZATION


86832 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_ANALYZE
, 
pTab
->
zName
, 0,

86833 
db
->
aDb
[
iDb
].
zName
 ) ){

86842 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 0,…Tab->
zName
);

86843 
	giTabCur
 = 
iTab
++;

86844 
	giIdxCur
 = 
iTab
++;

86845 
	gpP¬£
->
	gnTab
 = 
MAX
(
pP¬£
->
nTab
, 
iTab
);

86846 
sql™e3O³nTabË
(
pP¬£
, 
iTabCur
, 
iDb
, 
pTab
, 
OP_O³nR—d
);

86847 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
»gTabÇme
, 0, 
pTab
->
zName
, 0);

86849 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

86850 
nCÞ
;

86851 
	gaddrRewšd
;

86852 
	gaddrNextRow
;

86853 cÚ¡ *
	gzIdxName
;

86854 
	gnCÞTe¡
;

86856 ifÐ
	gpOÆyIdx
 &&…OÆyIdx!=
pIdx
 ) ;

86857 ifÐ
	gpIdx
->
	gpP¬tIdxWh”e
==0 ) 
ÃedTabËCÁ
 = 0;

86858 ifÐ!
HasRowid
(
pTab
è&& 
IsPrim¬yKeyIndex
(
pIdx
) ){

86859 
	gnCÞ
 = 
pIdx
->
nKeyCÞ
;

86860 
	gzIdxName
 = 
pTab
->
zName
;

86861 
	gnCÞTe¡
 = 
nCÞ
 - 1;

86863 
	gnCÞ
 = 
pIdx
->
nCÞumn
;

86864 
	gzIdxName
 = 
pIdx
->
zName
;

86865 
	gnCÞTe¡
 = 
pIdx
->
uniqNÙNuÎ
 ?…Idx->
nKeyCÞ
-1 : 
nCÞ
-1;

86869 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
»gIdxÇme
, 0, 
zIdxName
, 0);

86870 
VdbeComm’t
((
v
, "AÇlysi fÜ %s.%s", 
pTab
->
zName
, 
zIdxName
));

86908 
	gpP¬£
->
	gnMem
 = 
MAX
(
pP¬£
->
nMem
, 
»gP»v
+
nCÞTe¡
);

86911 
as£¹
Ð
iDb
==
sql™e3SchemaToIndex
(
db
, 
pIdx
->
pSchema
) );

86912 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nR—d
, 
iIdxCur
, 
pIdx
->
Šum
, 
iDb
);

86913 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

86914 
VdbeComm’t
((
v
, "%s", 
pIdx
->
zName
));

86926 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


86927 
sql™e3VdbeAddOp2
(
v
, 
OP_CouÁ
, 
iIdxCur
, 
»gSt4
+3);

86929 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
nCÞ
, 
»gSt4
+1);

86930 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
pIdx
->
nKeyCÞ
, 
»gSt4
+2);

86931 
sql™e3VdbeAddOp3
(
v
, 
OP_FunùiÚ
, 0, 
»gSt4
+1,„egStat4);

86932 
sql™e3VdbeChªgeP4
(
v
, -1, (*)&
¡©In™Funcdef
, 
P4_FUNCDEF
);

86933 
sql™e3VdbeChªgeP5
(
v
, 2+
IsSt34
);

86943 
	gaddrRewšd
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 
iIdxCur
);

86944 
VdbeCov”age
(
v
);

86945 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gChng
);

86946 
	gaddrNextRow
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

86948 ifÐ
	gnCÞTe¡
>0 ){

86949 
	g’dDi¡šùTe¡
 = 
sql™e3VdbeMakeLab–
(
v
);

86950 *
	gaGÙoChng
;

86951 
	gaGÙoChng
 = 
sql™e3DbM®locRaw
(
db
, ()*
nCÞTe¡
);

86952 ifÐ
	gaGÙoChng
==0 ) ;

86964 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

86965 
	gaddrNextRow
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

86966 ifÐ
	gnCÞTe¡
==1 && 
pIdx
->
nKeyCÞ
==1 && 
IsUniqueIndex
(pIdx) ){

86970 
sql™e3VdbeAddOp2
(
v
, 
OP_NÙNuÎ
, 
»gP»v
, 
’dDi¡šùTe¡
);

86971 
VdbeCov”age
(
v
);

86973 
	gi
=0; i<
	gnCÞTe¡
; i++){

86974 *
	gpCÞl
 = (*)
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
pIdx
->
azCÞl
[
i
]);

86975 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 
»gChng
);

86976 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iIdxCur
, 
i
, 
»gTemp
);

86977 
	gaGÙoChng
[
i
] =

86978 
sql™e3VdbeAddOp4
(
v
, 
OP_Ne
, 
»gTemp
, 0, 
»gP»v
+
i
, 
pCÞl
, 
P4_COLLSEQ
);

86979 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NULLEQ
);

86980 
VdbeCov”age
(
v
);

86982 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
nCÞTe¡
, 
»gChng
);

86983 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
’dDi¡šùTe¡
);

86993 
sql™e3VdbeJumpH”e
(
v
, 
addrNextRow
-1);

86994 
	gi
=0; i<
	gnCÞTe¡
; i++){

86995 
sql™e3VdbeJumpH”e
(
v
, 
aGÙoChng
[
i
]);

86996 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iIdxCur
, 
i
, 
»gP»v
+i);

86998 
sql™e3VdbeResÞveLab–
(
v
, 
’dDi¡šùTe¡
);

86999 
sql™e3DbF»e
(
db
, 
aGÙoChng
);

87009 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87010 
as£¹
Ð
»gRowid
==(
»gSt4
+2) );

87011 ifÐ
HasRowid
(
pTab
) ){

87012 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxRowid
, 
iIdxCur
, 
»gRowid
);

87014 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pIdx
->
pTabË
);

87015 
	gj
, 
	gk
, 
	g»gKey
;

87016 
	g»gKey
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
pPk
->
nKeyCÞ
);

87017 
	gj
=0; j<
	gpPk
->
	gnKeyCÞ
; j++){

87018 
	gk
 = 
sql™e3CÞumnOfIndex
(
pIdx
, 
pPk
->
aiCÞumn
[
j
]);

87019 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iIdxCur
, 
k
, 
»gKey
+
j
);

87020 
VdbeComm’t
((
v
, "%s", 
pTab
->
aCÞ
[
pPk
->
aiCÞumn
[
j
]].
zName
));

87022 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gKey
, 
pPk
->
nKeyCÞ
, 
»gRowid
);

87023 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gKey
, 
pPk
->
nKeyCÞ
);

87026 
as£¹
Ð
»gChng
==(
»gSt4
+1) );

87027 
sql™e3VdbeAddOp3
(
v
, 
OP_FunùiÚ
, 1, 
»gSt4
, 
»gTemp
);

87028 
sql™e3VdbeChªgeP4
(
v
, -1, (*)&
¡©PushFuncdef
, 
P4_FUNCDEF
);

87029 
sql™e3VdbeChªgeP5
(
v
, 2+
IsSt34
);

87030 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iIdxCur
, 
addrNextRow
); 
VdbeCov”age
(v);

87033 
ÿÎStG‘
(
v
, 
»gSt4
, 
STAT_GET_STAT1
, 
»gSt1
);

87034 
as£¹
Ð"BBB"[0]==
SQLITE_AFF_TEXT
 );

87035 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gTabÇme
, 3, 
»gTemp
, "BBB", 0);

87036 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iStCur
, 
»gNewRowid
);

87037 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iStCur
, 
»gTemp
, 
»gNewRowid
);

87038 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

87041 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87043 
	g»gEq
 = 
»gSt1
;

87044 
	g»gLt
 = 
»gSt1
+1;

87045 
	g»gDLt
 = 
»gSt1
+2;

87046 
	g»gSam¶e
 = 
»gSt1
+3;

87047 
	g»gCÞ
 = 
»gSt1
+4;

87048 
	g»gSam¶eRowid
 = 
»gCÞ
 + 
nCÞ
;

87049 
	gaddrNext
;

87050 
	gaddrIsNuÎ
;

87051 
u8
 
	g£ekOp
 = 
HasRowid
(
pTab
è? 
OP_NÙExi¡s
 : 
OP_NÙFound
;

87053 
	gpP¬£
->
	gnMem
 = 
MAX
(
pP¬£
->
nMem
, 
»gCÞ
+
nCÞ
);

87055 
	gaddrNext
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

87056 
ÿÎStG‘
(
v
, 
»gSt4
, 
STAT_GET_ROWID
, 
»gSam¶eRowid
);

87057 
	gaddrIsNuÎ
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IsNuÎ
, 
»gSam¶eRowid
);

87058 
VdbeCov”age
(
v
);

87059 
ÿÎStG‘
(
v
, 
»gSt4
, 
STAT_GET_NEQ
, 
»gEq
);

87060 
ÿÎStG‘
(
v
, 
»gSt4
, 
STAT_GET_NLT
, 
»gLt
);

87061 
ÿÎStG‘
(
v
, 
»gSt4
, 
STAT_GET_NDLT
, 
»gDLt
);

87062 
sql™e3VdbeAddOp4IÁ
(
v
, 
£ekOp
, 
iTabCur
, 
addrNext
, 
»gSam¶eRowid
, 0);

87066 
VdbeCov”ageNev”Tak’
(
v
);

87067 #ifdeà
SQLITE_ENABLE_STAT3


87068 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iTabCur
,

87069 
pIdx
->
aiCÞumn
[0], 
»gSam¶e
);

87071 
	gi
=0; i<
	gnCÞ
; i++){

87072 
i16
 
	giCÞ
 = 
pIdx
->
aiCÞumn
[
i
];

87073 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iTabCur
, 
iCÞ
, 
»gCÞ
+
i
);

87075 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gCÞ
, 
nCÞ
, 
»gSam¶e
);

87077 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gTabÇme
, 6, 
»gTemp
);

87078 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iStCur
+1, 
»gNewRowid
);

87079 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iStCur
+1, 
»gTemp
, 
»gNewRowid
);

87080 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 1, 
addrNext
);

87081 
sql™e3VdbeJumpH”e
(
v
, 
addrIsNuÎ
);

87086 
sql™e3VdbeJumpH”e
(
v
, 
addrRewšd
);

87093 ifÐ
	gpOÆyIdx
==0 && 
ÃedTabËCÁ
 ){

87094 
VdbeComm’t
((
v
, "%s", 
pTab
->
zName
));

87095 
sql™e3VdbeAddOp2
(
v
, 
OP_CouÁ
, 
iTabCur
, 
»gSt1
);

87096 
	gjZ”oRows
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfNÙ
, 
»gSt1
); 
VdbeCov”age
(v);

87097 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gIdxÇme
);

87098 
as£¹
Ð"BBB"[0]==
SQLITE_AFF_TEXT
 );

87099 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gTabÇme
, 3, 
»gTemp
, "BBB", 0);

87100 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iStCur
, 
»gNewRowid
);

87101 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iStCur
, 
»gTemp
, 
»gNewRowid
);

87102 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

87103 
sql™e3VdbeJumpH”e
(
v
, 
jZ”oRows
);

87112 
lßdAÇlysis
(
P¬£
 *
pP¬£
, 
iDb
){

87113 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

87114 ifÐ
	gv
 ){

87115 
sql™e3VdbeAddOp1
(
v
, 
OP_LßdAÇlysis
, 
iDb
);

87122 
ª®yzeD©aba£
(
P¬£
 *
pP¬£
, 
iDb
){

87123 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

87124 
Schema
 *
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

87125 
HashEËm
 *
	gk
;

87126 
	giStCur
;

87127 
	giMem
;

87128 
	giTab
;

87130 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

87131 
	giStCur
 = 
pP¬£
->
nTab
;

87132 
	gpP¬£
->
	gnTab
 += 3;

87133 
Ý’StTabË
(
pP¬£
, 
iDb
, 
iStCur
, 0, 0);

87134 
	giMem
 = 
pP¬£
->
nMem
+1;

87135 
	giTab
 = 
pP¬£
->
nTab
;

87136 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

87137 
	gk
=
sql™eHashFœ¡
(&
pSchema
->
tblHash
); k; k=
sql™eHashNext
(
k
)){

87138 
TabË
 *
pTab
 = (TabË*)
sql™eHashD©a
(
k
);

87139 
ª®yzeOÃTabË
(
pP¬£
, 
pTab
, 0, 
iStCur
, 
iMem
, 
iTab
);

87141 
lßdAÇlysis
(
pP¬£
, 
iDb
);

87149 
ª®yzeTabË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, 
Index
 *
pOÆyIdx
){

87150 
	giDb
;

87151 
	giStCur
;

87153 
as£¹
Ð
pTab
!=0 );

87154 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
pP¬£
->
db
) );

87155 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

87156 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

87157 
	giStCur
 = 
pP¬£
->
nTab
;

87158 
	gpP¬£
->
	gnTab
 += 3;

87159 ifÐ
	gpOÆyIdx
 ){

87160 
Ý’StTabË
(
pP¬£
, 
iDb
, 
iStCur
, 
pOÆyIdx
->
zName
, "idx");

87162 
Ý’StTabË
(
pP¬£
, 
iDb
, 
iStCur
, 
pTab
->
zName
, "tbl");

87164 
ª®yzeOÃTabË
(
pP¬£
, 
pTab
, 
pOÆyIdx
, 
iStCur
,pP¬£->
nMem
+1,pP¬£->
nTab
);

87165 
lßdAÇlysis
(
pP¬£
, 
iDb
);

87180 
SQLITE_PRIVATE
 
sql™e3AÇlyze
(
P¬£
 *
pP¬£
, 
Tok’
 *
pName1
, Tok’ *
pName2
){

87181 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

87182 
	giDb
;

87183 
	gi
;

87184 *
	gz
, *
	gzDb
;

87185 
TabË
 *
	gpTab
;

87186 
Index
 *
	gpIdx
;

87187 
Tok’
 *
	gpTabËName
;

87188 
Vdbe
 *
	gv
;

87192 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
pP¬£
->
db
) );

87193 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

87197 
as£¹
Ð
pName2
!=0 || 
pName1
==0 );

87198 ifÐ
	gpName1
==0 ){

87200 
i
=0; 
	gi
<
	gdb
->
	gnDb
; i++){

87201 ifÐ
	gi
==1 ) ;

87202 
ª®yzeD©aba£
(
pP¬£
, 
i
);

87204 }ifÐ
	gpName2
->
	gn
==0 ){

87206 
iDb
 = 
sql™e3FšdDb
(
db
, 
pName1
);

87207 ifÐ
	giDb
>=0 ){

87208 
ª®yzeD©aba£
(
pP¬£
, 
iDb
);

87210 
	gz
 = 
sql™e3NameFromTok’
(
db
, 
pName1
);

87211 ifÐ
	gz
 ){

87212 ifÐ(
	gpIdx
 = 
sql™e3FšdIndex
(
db
, 
z
, 0))!=0 ){

87213 
ª®yzeTabË
(
pP¬£
, 
pIdx
->
pTabË
,…Idx);

87214 }ifÐ(
	gpTab
 = 
sql™e3Loÿ‹TabË
(
pP¬£
, 0, 
z
, 0))!=0 ){

87215 
ª®yzeTabË
(
pP¬£
, 
pTab
, 0);

87217 
sql™e3DbF»e
(
db
, 
z
);

87222 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pTabËName
);

87223 ifÐ
	giDb
>=0 ){

87224 
zDb
 = 
db
->
aDb
[
iDb
].
zName
;

87225 
	gz
 = 
sql™e3NameFromTok’
(
db
, 
pTabËName
);

87226 ifÐ
	gz
 ){

87227 ifÐ(
	gpIdx
 = 
sql™e3FšdIndex
(
db
, 
z
, 
zDb
))!=0 ){

87228 
ª®yzeTabË
(
pP¬£
, 
pIdx
->
pTabË
,…Idx);

87229 }ifÐ(
	gpTab
 = 
sql™e3Loÿ‹TabË
(
pP¬£
, 0, 
z
, 
zDb
))!=0 ){

87230 
ª®yzeTabË
(
pP¬£
, 
pTab
, 0);

87232 
sql™e3DbF»e
(
db
, 
z
);

87236 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

87237 ifÐ
	gv
 ) 
sql™e3VdbeAddOp0
(
v
, 
OP_Expœe
);

87244 
ª®ysisInfo
 
	tª®ysisInfo
;

87245 
	sª®ysisInfo
 {

87246 
sql™e3
 *
	gdb
;

87247 cÚ¡ *
	gzD©aba£
;

87255 
decodeIÁA¼ay
(

87256 *
zIÁA¼ay
,

87257 
nOut
,

87258 
tRowút
 *
aOut
,

87259 
LogE¡
 *
aLog
,

87260 
Index
 *
pIndex


87262 *
	gz
 = 
zIÁA¼ay
;

87263 
	gc
;

87264 
	gi
;

87265 
tRowút
 
	gv
;

87267 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87268 ifÐ
	gz
==0 ) 
z
 = "";

87270 
as£¹
Ð
z
!=0 );

87272 
	gi
=0; *
	gz
 && i<
	gnOut
; i++){

87273 
	gv
 = 0;

87274  (
	gc
=
z
[0])>='0' && 
c
<='9' ){

87275 
v
 = v*10 + 
c
 - '0';

87276 
	gz
++;

87278 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87279 ifÐ
	gaOut
 )‡Out[
i
] = 
v
;

87280 ifÐ
	gaLog
 )‡Log[
i
] = 
sql™e3LogE¡
(
v
);

87282 
as£¹
Ð
aOut
==0 );

87283 
UNUSED_PARAMETER
(
aOut
);

87284 
as£¹
Ð
aLog
!=0 );

87285 
	gaLog
[
i
] = 
sql™e3LogE¡
(
v
);

87287 ifÐ*
	gz
==' ' ) 
z
++;

87289 #iâdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87290 
as£¹
Ð
pIndex
!=0 );

87292 ifÐ
	gpIndex
 )

87294  
	gz
[0] ){

87295 ifÐ
sql™e3_¡rglob
("unÜd”ed*", 
z
)==0 ){

87296 
pIndex
->
bUnÜd”ed
 = 1;

87297 }ifÐ
sql™e3_¡rglob
("sz=[0-9]*", 
z
)==0 ){

87298 
pIndex
->
szIdxRow
 = 
sql™e3LogE¡
(
sql™e3Atoi
(
z
+3));

87300 #ifdeà
SQLITE_ENABLE_COSTMULT


87301 ifÐ
sql™e3_¡rglob
("co¡muÉ=[0-9]*",
z
)==0 ){

87302 
pIndex
->
pTabË
->
co¡MuÉ
 = 
sql™e3LogE¡
(
sql™e3Atoi
(
z
+9));

87305  
	gz
[0]!=0 && 
z
[0]!=' ' ) z++;

87306  
	gz
[0]==' ' ) 
z
++;

87321 
ª®ysisLßd”
(*
pD©a
, 
¬gc
, **
¬gv
, **
NÙU£d
){

87322 
ª®ysisInfo
 *
	gpInfo
 = (ª®ysisInfo*)
pD©a
;

87323 
Index
 *
	gpIndex
;

87324 
TabË
 *
	gpTabË
;

87325 cÚ¡ *
	gz
;

87327 
as£¹
Ð
¬gc
==3 );

87328 
UNUSED_PARAMETER2
(
NÙU£d
, 
¬gc
);

87330 ifÐ
	g¬gv
==0 || 
¬gv
[0]==0 ||‡rgv[2]==0 ){

87333 
	gpTabË
 = 
sql™e3FšdTabË
(
pInfo
->
db
, 
¬gv
[0],…Info->
zD©aba£
);

87334 ifÐ
	gpTabË
==0 ){

87337 ifÐ
	g¬gv
[1]==0 ){

87338 
pIndex
 = 0;

87339 }ifÐ
sql™e3_¡ricmp
(
¬gv
[0],argv[1])==0 ){

87340 
pIndex
 = 
sql™e3Prim¬yKeyIndex
(
pTabË
);

87342 
	gpIndex
 = 
sql™e3FšdIndex
(
pInfo
->
db
, 
¬gv
[1],…Info->
zD©aba£
);

87344 
	gz
 = 
¬gv
[2];

87346 ifÐ
	gpIndex
 ){

87347 
	gnCÞ
 = 
pIndex
->
nKeyCÞ
+1;

87348 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87349 
tRowút
 * cÚ¡ 
	gaiRowE¡
 = 
pIndex
->
aiRowE¡
 = (tRowút*)
sql™e3M®locZ”o
(

87350 (
tRowút
è* 
nCÞ


87352 ifÐ
	gaiRowE¡
==0 ) 
pInfo
->
db
->
m®locFažed
 = 1;

87354 
tRowút
 * cÚ¡ 
	gaiRowE¡
 = 0;

87356 
	gpIndex
->
	gbUnÜd”ed
 = 0;

87357 
decodeIÁA¼ay
((*)
z
, 
nCÞ
, 
aiRowE¡
, 
pIndex
->
aiRowLogE¡
,…Index);

87358 ifÐ
	gpIndex
->
	gpP¬tIdxWh”e
==0 ) 
pTabË
->
nRowLogE¡
 = 
pIndex
->
aiRowLogE¡
[0];

87360 
Index
 
	gçkeIdx
;

87361 
	gçkeIdx
.
	gszIdxRow
 = 
pTabË
->
szTabRow
;

87362 #ifdeà
SQLITE_ENABLE_COSTMULT


87363 
	gçkeIdx
.
	gpTabË
 = 
pTabË
;

87365 
decodeIÁA¼ay
((*)
z
, 1, 0, &
pTabË
->
nRowLogE¡
, &
çkeIdx
);

87366 
	gpTabË
->
	gszTabRow
 = 
çkeIdx
.
szIdxRow
;

87376 
SQLITE_PRIVATE
 
sql™e3D–‘eIndexSam¶es
(
sql™e3
 *
db
, 
Index
 *
pIdx
){

87377 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87378 ifÐ
	gpIdx
->
	gaSam¶e
 ){

87379 
	gj
;

87380 
	gj
=0; j<
	gpIdx
->
	gnSam¶e
; j++){

87381 
IndexSam¶e
 *
	gp
 = &
pIdx
->
aSam¶e
[
j
];

87382 
sql™e3DbF»e
(
db
, 
p
->p);

87384 
sql™e3DbF»e
(
db
, 
pIdx
->
aSam¶e
);

87386 ifÐ
	gdb
 && db->
	g²By‹sF»ed
==0 ){

87387 
pIdx
->
nSam¶e
 = 0;

87388 
	gpIdx
->
	gaSam¶e
 = 0;

87391 
UNUSED_PARAMETER
(
db
);

87392 
UNUSED_PARAMETER
(
pIdx
);

87396 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87401 
š™AvgEq
(
Index
 *
pIdx
){

87402 ifÐ
	gpIdx
 ){

87403 
IndexSam¶e
 *
	gaSam¶e
 = 
pIdx
->
aSam¶e
;

87404 
IndexSam¶e
 *
	gpFš®
 = &
aSam¶e
[
pIdx
->
nSam¶e
-1];

87405 
	giCÞ
;

87406 
	gnCÞ
 = 1;

87407 ifÐ
	gpIdx
->
	gnSam¶eCÞ
>1 ){

87412 
	gnCÞ
 = 
pIdx
->
nSam¶eCÞ
-1;

87413 
	gpIdx
->
	gaAvgEq
[
nCÞ
] = 1;

87415 
	giCÞ
=0; iCÞ<
	gnCÞ
; iCol++){

87416 
	gnSam¶e
 = 
pIdx
->
nSam¶e
;

87417 
	gi
;

87418 
tRowút
 
	gsumEq
 = 0;

87419 
tRowút
 
	gavgEq
 = 0;

87420 
tRowút
 
	gnRow
;

87421 
i64
 
	gnSum100
 = 0;

87422 
i64
 
	gnDi¡100
;

87424 ifÐ!
	gpIdx
->
	gaiRowE¡
 || 
	giCÞ
>=
pIdx
->
nKeyCÞ
 ||…Idx->
aiRowE¡
[
iCÞ
+1]==0 ){

87425 
nRow
 = 
pFš®
->
ªLt
[
iCÞ
];

87426 
	gnDi¡100
 = (
i64
)100 * 
pFš®
->
ªDLt
[
iCÞ
];

87427 
	gnSam¶e
--;

87429 
	gnRow
 = 
pIdx
->
aiRowE¡
[0];

87430 
	gnDi¡100
 = ((
i64
)100 * 
pIdx
->
aiRowE¡
[0]è/…Idx->aiRowE¡[
iCÞ
+1];

87437 
	gi
=0; i<
	gnSam¶e
; i++){

87438 ifÐ
	gi
==(
pIdx
->
nSam¶e
-1)

87439 || 
aSam¶e
[
i
].
ªDLt
[
iCÞ
]!=aSample[i+1].anDLt[iCol]

87441 
sumEq
 +ð
aSam¶e
[
i
].
ªEq
[
iCÞ
];

87442 
	gnSum100
 += 100;

87446 ifÐ
	gnDi¡100
>
	gnSum100
 ){

87447 
	gavgEq
 = ((
i64
)100 * (
nRow
 - 
sumEq
))/(
nDi¡100
 - 
nSum100
);

87449 ifÐ
	gavgEq
==0 ) 
avgEq
 = 1;

87450 
	gpIdx
->
	gaAvgEq
[
iCÞ
] = 
avgEq
;

87459 
Index
 *
fšdIndexOrPrim¬yKey
(

87460 
sql™e3
 *
db
,

87461 cÚ¡ *
zName
,

87462 cÚ¡ *
zDb


87464 
Index
 *
	gpIdx
 = 
sql™e3FšdIndex
(
db
, 
zName
, 
zDb
);

87465 ifÐ
	gpIdx
==0 ){

87466 
TabË
 *
pTab
 = 
sql™e3FšdTabË
(
db
, 
zName
, 
zDb
);

87467 ifÐ
	gpTab
 && !
HasRowid
(
pTab
èè
	gpIdx
 = 
sql™e3Prim¬yKeyIndex
(pTab);

87469  
	gpIdx
;

87485 
lßdStTbl
(

87486 
sql™e3
 *
db
,

87487 
bSt3
,

87488 cÚ¡ *
zSql1
,

87489 cÚ¡ *
zSql2
,

87490 cÚ¡ *
zDb


87492 
	grc
;

87493 
sql™e3_¡mt
 *
	gpStmt
 = 0;

87494 *
	gzSql
;

87495 
Index
 *
	gpP»vIdx
 = 0;

87496 
IndexSam¶e
 *
	gpSam¶e
;

87498 
as£¹
Ð
db
->
lookaside
.
bEÇbËd
==0 );

87499 
	gzSql
 = 
sql™e3MPrštf
(
db
, 
zSql1
, 
zDb
);

87500 ifÐ!
	gzSql
 ){

87501  
	gSQLITE_NOMEM
;

87503 
	grc
 = 
sql™e3_´•¬e
(
db
, 
zSql
, -1, &
pStmt
, 0);

87504 
sql™e3DbF»e
(
db
, 
zSql
);

87505 ifÐ
	grc
 ) „c;

87507  
sql™e3_¡•
(
pStmt
)==
SQLITE_ROW
 ){

87508 
nIdxCÞ
 = 1;

87510 *
	gzIndex
;

87511 
Index
 *
	gpIdx
;

87512 
	gnSam¶e
;

87513 
	gnBy‹
;

87514 
	gi
;

87515 
tRowút
 *
	gpS·û
;

87517 
	gzIndex
 = (*)
sql™e3_cÞumn_‹xt
(
pStmt
, 0);

87518 ifÐ
	gzIndex
==0 ) ;

87519 
	gnSam¶e
 = 
sql™e3_cÞumn_št
(
pStmt
, 1);

87520 
	gpIdx
 = 
fšdIndexOrPrim¬yKey
(
db
, 
zIndex
, 
zDb
);

87521 
as£¹
Ð
pIdx
==0 || 
bSt3
 ||…Idx->
nSam¶e
==0 );

87524 ifÐ
	gpIdx
==0 || 
pIdx
->
nSam¶e
 ) ;

87525 ifÐ
	gbSt3
==0 ){

87526 
as£¹
Ð!
HasRowid
(
pIdx
->
pTabË
è||…Idx->
nCÞumn
=õIdx->
nKeyCÞ
+1 );

87527 ifÐ!
HasRowid
(
pIdx
->
pTabË
è&& 
IsPrim¬yKeyIndex
(pIdx) ){

87528 
	gnIdxCÞ
 = 
pIdx
->
nKeyCÞ
;

87530 
	gnIdxCÞ
 = 
pIdx
->
nCÞumn
;

87533 
	gpIdx
->
	gnSam¶eCÞ
 = 
nIdxCÞ
;

87534 
	gnBy‹
 = (
IndexSam¶e
è* 
nSam¶e
;

87535 
	gnBy‹
 +ð(
tRowút
è* 
nIdxCÞ
 * 3 * 
nSam¶e
;

87536 
	gnBy‹
 +ð
nIdxCÞ
 * (
tRowút
);

87538 
	gpIdx
->
	gaSam¶e
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

87539 ifÐ
	gpIdx
->
	gaSam¶e
==0 ){

87540 
sql™e3_fš®ize
(
pStmt
);

87541  
	gSQLITE_NOMEM
;

87543 
	gpS·û
 = (
tRowút
*)&
pIdx
->
aSam¶e
[
nSam¶e
];

87544 
	gpIdx
->
	gaAvgEq
 = 
pS·û
; 
	gpS·û
 +ð
nIdxCÞ
;

87545 
	gi
=0; i<
	gnSam¶e
; i++){

87546 
	gpIdx
->
	gaSam¶e
[
i
].
	gªEq
 = 
pS·û
; 
	gpS·û
 +ð
nIdxCÞ
;

87547 
	gpIdx
->
	gaSam¶e
[
i
].
	gªLt
 = 
pS·û
; 
	gpS·û
 +ð
nIdxCÞ
;

87548 
	gpIdx
->
	gaSam¶e
[
i
].
	gªDLt
 = 
pS·û
; 
	gpS·û
 +ð
nIdxCÞ
;

87550 
as£¹
Ð((
u8
*)
pS·û
)-
nBy‹
==(u8*)(
pIdx
->
aSam¶e
) );

87552 
	grc
 = 
sql™e3_fš®ize
(
pStmt
);

87553 ifÐ
	grc
 ) „c;

87555 
	gzSql
 = 
sql™e3MPrštf
(
db
, 
zSql2
, 
zDb
);

87556 ifÐ!
	gzSql
 ){

87557  
	gSQLITE_NOMEM
;

87559 
	grc
 = 
sql™e3_´•¬e
(
db
, 
zSql
, -1, &
pStmt
, 0);

87560 
sql™e3DbF»e
(
db
, 
zSql
);

87561 ifÐ
	grc
 ) „c;

87563  
sql™e3_¡•
(
pStmt
)==
SQLITE_ROW
 ){

87564 *
zIndex
;

87565 
Index
 *
	gpIdx
;

87566 
	gnCÞ
 = 1;

87568 
	gzIndex
 = (*)
sql™e3_cÞumn_‹xt
(
pStmt
, 0);

87569 ifÐ
	gzIndex
==0 ) ;

87570 
	gpIdx
 = 
fšdIndexOrPrim¬yKey
(
db
, 
zIndex
, 
zDb
);

87571 ifÐ
	gpIdx
==0 ) ;

87574 
	gnCÞ
 = 
pIdx
->
nSam¶eCÞ
;

87575 ifÐ
	gbSt3
 && 
	gnCÞ
>1 ) ;

87576 ifÐ
	gpIdx
!=
pP»vIdx
 ){

87577 
š™AvgEq
(
pP»vIdx
);

87578 
	gpP»vIdx
 = 
pIdx
;

87580 
	gpSam¶e
 = &
pIdx
->
aSam¶e
[pIdx->
nSam¶e
];

87581 
decodeIÁA¼ay
((*)
sql™e3_cÞumn_‹xt
(
pStmt
,1),
nCÞ
,
pSam¶e
->
ªEq
,0,0);

87582 
decodeIÁA¼ay
((*)
sql™e3_cÞumn_‹xt
(
pStmt
,2),
nCÞ
,
pSam¶e
->
ªLt
,0,0);

87583 
decodeIÁA¼ay
((*)
sql™e3_cÞumn_‹xt
(
pStmt
,3),
nCÞ
,
pSam¶e
->
ªDLt
,0,0);

87591 
	gpSam¶e
->
	gn
 = 
sql™e3_cÞumn_by‹s
(
pStmt
, 4);

87592 
	gpSam¶e
->
	gp
 = 
sql™e3DbM®locZ”o
(
db
, 
pSam¶e
->
n
 + 2);

87593 ifÐ
	gpSam¶e
->
	gp
==0 ){

87594 
sql™e3_fš®ize
(
pStmt
);

87595  
	gSQLITE_NOMEM
;

87597 
memýy
(
pSam¶e
->
p
, 
sql™e3_cÞumn_blob
(
pStmt
, 4),…Sam¶e->
n
);

87598 
	gpIdx
->
	gnSam¶e
++;

87600 
	grc
 = 
sql™e3_fš®ize
(
pStmt
);

87601 ifÐ
	grc
==
SQLITE_OK
 ) 
š™AvgEq
(
pP»vIdx
);

87602  
	grc
;

87609 
lßdSt4
(
sql™e3
 *
db
, cÚ¡ *
zDb
){

87610 
	grc
 = 
SQLITE_OK
;

87612 
as£¹
Ð
db
->
lookaside
.
bEÇbËd
==0 );

87613 ifÐ
sql™e3FšdTabË
(
db
, "sql™e_¡©4", 
zDb
) ){

87614 
	grc
 = 
lßdStTbl
(
db
, 0,

87617 
zDb


87621 ifÐ
	grc
==
SQLITE_OK
 && 
sql™e3FšdTabË
(
db
, "sql™e_¡©3", 
zDb
) ){

87622 
	grc
 = 
lßdStTbl
(
db
, 1,

87625 
zDb


87629  
	grc
;

87653 
SQLITE_PRIVATE
 
sql™e3AÇlysisLßd
(
sql™e3
 *
db
, 
iDb
){

87654 
ª®ysisInfo
 
	gsInfo
;

87655 
HashEËm
 *
	gi
;

87656 *
	gzSql
;

87657 
	grc
;

87659 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

87660 
as£¹
Ð
db
->
aDb
[
iDb
].
pBt
!=0 );

87663 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

87664 
	gi
=
sql™eHashFœ¡
(&
db
->
aDb
[
iDb
].
pSchema
->
idxHash
);i;i=
sql™eHashNext
(
i
)){

87665 
Index
 *
pIdx
 = 
sql™eHashD©a
(
i
);

87666 
sql™e3DeçuÉRowE¡
(
pIdx
);

87667 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87668 
sql™e3D–‘eIndexSam¶es
(
db
, 
pIdx
);

87669 
	gpIdx
->
	gaSam¶e
 = 0;

87674 
	gsInfo
.
	gdb
 = 
db
;

87675 
	gsInfo
.
	gzD©aba£
 = 
db
->
aDb
[
iDb
].
zName
;

87676 ifÐ
sql™e3FšdTabË
(
db
, "sql™e_¡©1", 
sInfo
.
zD©aba£
)==0 ){

87677  
SQLITE_ERROR
;

87681 
	gzSql
 = 
sql™e3MPrštf
(
db
,

87682 "SELECTbl,idx,¡© FROM %Q.sql™e_¡©1", 
sInfo
.
zD©aba£
);

87683 ifÐ
	gzSql
==0 ){

87684 
rc
 = 
SQLITE_NOMEM
;

87686 
	grc
 = 
sql™e3_exec
(
db
, 
zSql
, 
ª®ysisLßd”
, &
sInfo
, 0);

87687 
sql™e3DbF»e
(
db
, 
zSql
);

87692 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


87693 ifÐ
	grc
==
SQLITE_OK
 ){

87694 
lookasideEÇbËd
 = 
db
->
lookaside
.
bEÇbËd
;

87695 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 0;

87696 
	grc
 = 
lßdSt4
(
db
, 
sInfo
.
zD©aba£
);

87697 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 
lookasideEÇbËd
;

87699 
	gi
=
sql™eHashFœ¡
(&
db
->
aDb
[
iDb
].
pSchema
->
idxHash
);i;i=
sql™eHashNext
(
i
)){

87700 
Index
 *
pIdx
 = 
sql™eHashD©a
(
i
);

87701 
sql™e3_ä“
(
pIdx
->
aiRowE¡
);

87702 
	gpIdx
->
	gaiRowE¡
 = 0;

87706 ifÐ
	grc
==
SQLITE_NOMEM
 ){

87707 
db
->
m®locFažed
 = 1;

87709  
	grc
;

87731 #iâdeà
SQLITE_OMIT_ATTACH


87750 
»sÞveA‰achEx´
(
NameCÚ‹xt
 *
pName
, 
Ex´
 *
pEx´
)

87752 
	grc
 = 
SQLITE_OK
;

87753 ifÐ
	gpEx´
 ){

87754 ifÐ
	gpEx´
->
	gÝ
!=
TK_ID
 ){

87755 
rc
 = 
sql™e3ResÞveEx´Names
(
pName
, 
pEx´
);

87757 
	gpEx´
->
	gÝ
 = 
TK_STRING
;

87760  
	grc
;

87774 
©chFunc
(

87775 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

87776 
NÙU£d
,

87777 
sql™e3_v®ue
 **
¬gv


87779 
	gi
;

87780 
	grc
 = 0;

87781 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

87782 cÚ¡ *
	gzName
;

87783 cÚ¡ *
	gzFže
;

87784 *
	gzP©h
 = 0;

87785 *
	gzE¼
 = 0;

87786 
	gæags
;

87787 
Db
 *
	gaNew
;

87788 *
	gzE¼Dyn
 = 0;

87789 
sql™e3_vfs
 *
	gpVfs
;

87791 
UNUSED_PARAMETER
(
NÙU£d
);

87793 
	gzFže
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

87794 
	gzName
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[1]);

87795 ifÐ
	gzFže
==0 ) 
zFže
 = "";

87796 ifÐ
	gzName
==0 ) 
zName
 = "";

87804 ifÐ
	gdb
->
	gnDb
>=
db
->
aLim™
[
SQLITE_LIMIT_ATTACHED
]+2 ){

87805 
zE¼Dyn
 = 
sql™e3MPrštf
(
db
, "too many‡ttached databases - max %d",

87806 
db
->
aLim™
[
SQLITE_LIMIT_ATTACHED
]

87808 
	g©ch_”rÜ
;

87810 ifÐ!
	gdb
->
	gautoComm™
 ){

87811 
	gzE¼Dyn
 = 
sql™e3MPrštf
(
db
, "cannot ATTACH database withinransaction");

87812 
	g©ch_”rÜ
;

87814 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

87815 *
	gz
 = 
db
->
aDb
[
i
].
zName
;

87816 
as£¹
Ð
z
 && 
zName
 );

87817 ifÐ
sql™e3SŒICmp
(
z
, 
zName
)==0 ){

87818 
zE¼Dyn
 = 
sql™e3MPrštf
(
db
, "d©aba£ % i ®»ady iÀu£", 
zName
);

87819 
	g©ch_”rÜ
;

87826 ifÐ
	gdb
->
	gaDb
==
db
->
aDbStic
 ){

87827 
aNew
 = 
sql™e3DbM®locRaw
(
db
, (db->
aDb
[0])*3 );

87828 ifÐ
	gaNew
==0 ) ;

87829 
memýy
(
aNew
, 
db
->
aDb
, (db->aDb[0])*2);

87831 
	gaNew
 = 
sql™e3DbR—Îoc
(
db
, db->
aDb
, (db->aDb[0])*(db->
nDb
+1) );

87832 ifÐ
	gaNew
==0 ) ;

87834 
	gdb
->
	gaDb
 = 
aNew
;

87835 
	gaNew
 = &
db
->
aDb
[db->
nDb
];

87836 
mem£t
(
aNew
, 0, (*aNew));

87842 
	gæags
 = 
db
->
Ý’FÏgs
;

87843 
	grc
 = 
sql™e3P¬£Uri
(
db
->
pVfs
->
zName
, 
zFže
, &
æags
, &pVfs, &
zP©h
, &
zE¼
);

87844 ifÐ
	grc
!=
SQLITE_OK
 ){

87845 ifÐ
rc
==
SQLITE_NOMEM
 ) 
db
->
m®locFažed
 = 1;

87846 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

87847 
sql™e3_ä“
(
zE¼
);

87850 
as£¹
Ð
pVfs
 );

87851 
	gæags
 |ð
SQLITE_OPEN_MAIN_DB
;

87852 
	grc
 = 
sql™e3BŒ“O³n
(
pVfs
, 
zP©h
, 
db
, &
aNew
->
pBt
, 0, 
æags
);

87853 
sql™e3_ä“
Ð
zP©h
 );

87854 
	gdb
->
	gnDb
++;

87855 ifÐ
	grc
==
SQLITE_CONSTRAINT
 ){

87856 
rc
 = 
SQLITE_ERROR
;

87857 
	gzE¼Dyn
 = 
sql™e3MPrštf
(
db
, "database is‡lready‡ttached");

87858 }ifÐ
	grc
==
SQLITE_OK
 ){

87859 
Pag”
 *
pPag”
;

87860 
	gaNew
->
	gpSchema
 = 
sql™e3SchemaG‘
(
db
, 
aNew
->
pBt
);

87861 ifÐ!
	gaNew
->
	gpSchema
 ){

87862 
	grc
 = 
SQLITE_NOMEM
;

87863 }ifÐ
	gaNew
->
	gpSchema
->
	gfže_fÜm©
 &&‡New->pSchema->
	g’c
!=
ENC
(
db
) ){

87864 
zE¼Dyn
 = 
sql™e3MPrštf
(
db
,

87866 
	grc
 = 
SQLITE_ERROR
;

87868 
	gpPag”
 = 
sql™e3BŒ“Pag”
(
aNew
->
pBt
);

87869 
sql™e3Pag”LockšgMode
(
pPag”
, 
db
->
dætLockMode
);

87870 
sql™e3BŒ“Secu»D–‘e
(
aNew
->
pBt
,

87871 
sql™e3BŒ“Secu»D–‘e
(
db
->
aDb
[0].
pBt
,-1) );

87872 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


87873 
sql™e3BŒ“S‘Pag”FÏgs
(
aNew
->
pBt
, 3 | (
db
->
æags
 & 
PAGER_FLAGS_MASK
));

87876 
	gaNew
->
	g§ãty_Ëv–
 = 3;

87877 
	gaNew
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
zName
);

87878 ifÐ
	grc
==
SQLITE_OK
 && 
aNew
->
zName
==0 ){

87879 
rc
 = 
SQLITE_NOMEM
;

87883 #ifdeà
SQLITE_HAS_CODEC


87884 ifÐ
	grc
==
SQLITE_OK
 ){

87885 
sql™e3CodecA‰ach
(
sql™e3
*, , const *, );

87886 
sql™e3CodecG‘Key
(
sql™e3
*, , **, *);

87887 
	gnKey
;

87888 *
	gzKey
;

87889 
	gt
 = 
sql™e3_v®ue_ty³
(
¬gv
[2]);

87890  
	gt
 ){

87891 
	gSQLITE_INTEGER
:

87892 
SQLITE_FLOAT
:

87893 
zE¼Dyn
 = 
sql™e3DbSŒDup
(
db
, "Invalid key value");

87894 
	grc
 = 
SQLITE_ERROR
;

87897 
	gSQLITE_TEXT
:

87898 
SQLITE_BLOB
:

87899 
nKey
 = 
sql™e3_v®ue_by‹s
(
¬gv
[2]);

87900 
	gzKey
 = (*)
sql™e3_v®ue_blob
(
¬gv
[2]);

87901 
	grc
 = 
sql™e3CodecA‰ach
(
db
, db->
nDb
-1, 
zKey
, 
nKey
);

87904 
	gSQLITE_NULL
:

87906 
sql™e3CodecG‘Key
(
db
, 0, (**)&
zKey
, &
nKey
);

87907 ifÐ
	gnKey
>0 || 
sql™e3BŒ“G‘Re£rve
(
db
->
aDb
[0].
pBt
)>0 ){

87908 
	grc
 = 
sql™e3CodecA‰ach
(
db
, db->
nDb
-1, 
zKey
, 
nKey
);

87920 ifÐ
	grc
==
SQLITE_OK
 ){

87921 
sql™e3BŒ“EÁ”AÎ
(
db
);

87922 
	grc
 = 
sql™e3In™
(
db
, &
zE¼Dyn
);

87923 
sql™e3BŒ“L—veAÎ
(
db
);

87925 #ifdeà
SQLITE_USER_AUTHENTICATION


87926 ifÐ
	grc
==
SQLITE_OK
 ){

87927 
u8
 
ÃwAuth
 = 0;

87928 
	grc
 = 
sql™e3U£rAuthCheckLogš
(
db
, 
zName
, &
ÃwAuth
);

87929 ifÐ
	gÃwAuth
<
	gdb
->
	gauth
.
	gauthLev–
 ){

87930 
	grc
 = 
SQLITE_AUTH_USER
;

87934 ifÐ
	grc
 ){

87935 
	giDb
 = 
db
->
nDb
 - 1;

87936 
as£¹
Ð
iDb
>=2 );

87937 ifÐ
	gdb
->
	gaDb
[
iDb
].
	gpBt
 ){

87938 
sql™e3BŒ“Clo£
(
db
->
aDb
[
iDb
].
pBt
);

87939 
	gdb
->
	gaDb
[
iDb
].
	gpBt
 = 0;

87940 
	gdb
->
	gaDb
[
iDb
].
	gpSchema
 = 0;

87942 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

87943 
	gdb
->
	gnDb
 = 
iDb
;

87944 ifÐ
	grc
==
SQLITE_NOMEM
 || 
rc
==
SQLITE_IOERR_NOMEM
 ){

87945 
db
->
m®locFažed
 = 1;

87946 
sql™e3DbF»e
(
db
, 
zE¼Dyn
);

87947 
	gzE¼Dyn
 = 
sql™e3MPrštf
(
db
, "out of memory");

87948 }ifÐ
	gzE¼Dyn
==0 ){

87949 
zE¼Dyn
 = 
sql™e3MPrštf
(
db
, "uÇbËØÝ’ d©aba£: %s", 
zFže
);

87951 
	g©ch_”rÜ
;

87956 
	g©ch_”rÜ
:

87958 ifÐ
zE¼Dyn
 ){

87959 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼Dyn
, -1);

87960 
sql™e3DbF»e
(
db
, 
zE¼Dyn
);

87962 ifÐ
	grc
 ) 
sql™e3_»suÉ_”rÜ_code
(
cÚ‹xt
, 
rc
);

87973 
d‘achFunc
(

87974 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

87975 
NÙU£d
,

87976 
sql™e3_v®ue
 **
¬gv


87978 cÚ¡ *
	gzName
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

87979 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

87980 
	gi
;

87981 
Db
 *
	gpDb
 = 0;

87982 
	gzE¼
[128];

87984 
UNUSED_PARAMETER
(
NÙU£d
);

87986 ifÐ
	gzName
==0 ) 
zName
 = "";

87987 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

87988 
	gpDb
 = &
db
->
aDb
[
i
];

87989 ifÐ
	gpDb
->
	gpBt
==0 ) ;

87990 ifÐ
sql™e3SŒICmp
(
pDb
->
zName
, zName)==0 ) ;

87993 ifÐ
	gi
>=
db
->
nDb
 ){

87994 
sql™e3_¢´štf
((
zE¼
),zE¼, "nØsuch d©aba£: %s", 
zName
);

87995 
	gd‘ach_”rÜ
;

87997 ifÐ
	gi
<2 ){

87998 
sql™e3_¢´štf
((
zE¼
),zE¼, "ÿÂÙ d‘ach d©aba£ %s", 
zName
);

87999 
	gd‘ach_”rÜ
;

88001 ifÐ!
	gdb
->
	gautoComm™
 ){

88002 
sql™e3_¢´štf
((
zE¼
), zErr,

88004 
	gd‘ach_”rÜ
;

88006 ifÐ
sql™e3BŒ“IsInR—dT¿ns
(
pDb
->
pBt
è|| 
sql™e3BŒ“IsInBackup
(pDb->pBt) ){

88007 
sql™e3_¢´štf
((
zE¼
),zE¼, "d©aba£ % i locked", 
zName
);

88008 
	gd‘ach_”rÜ
;

88011 
sql™e3BŒ“Clo£
(
pDb
->
pBt
);

88012 
	gpDb
->
	gpBt
 = 0;

88013 
	gpDb
->
	gpSchema
 = 0;

88014 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

88017 
	gd‘ach_”rÜ
:

88018 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

88025 
codeA‰ach
(

88026 
P¬£
 *
pP¬£
,

88027 
ty³
,

88028 
FuncDef
 cÚ¡ *
pFunc
,

88029 
Ex´
 *
pAuthArg
,

88030 
Ex´
 *
pFž’ame
,

88031 
Ex´
 *
pDbÇme
,

88032 
Ex´
 *
pKey


88034 
	grc
;

88035 
NameCÚ‹xt
 
	gsName
;

88036 
Vdbe
 *
	gv
;

88037 
sql™e3
* 
	gdb
 = 
pP¬£
->
db
;

88038 
	g»gArgs
;

88040 
mem£t
(&
sName
, 0, (
NameCÚ‹xt
));

88041 
	gsName
.
	gpP¬£
 = 
pP¬£
;

88044 
	gSQLITE_OK
!=(
rc
 = 
»sÞveA‰achEx´
(&
sName
, 
pFž’ame
)) ||

88045 
	gSQLITE_OK
!=(
rc
 = 
»sÞveA‰achEx´
(&
sName
, 
pDbÇme
)) ||

88046 
	gSQLITE_OK
!=(
rc
 = 
»sÞveA‰achEx´
(&
sName
, 
pKey
))

88048 
	gpP¬£
->
	gnE¼
++;

88049 
	g©ch_’d
;

88052 #iâdeà
SQLITE_OMIT_AUTHORIZATION


88053 ifÐ
	gpAuthArg
 ){

88054 *
	gzAuthArg
;

88055 ifÐ
	gpAuthArg
->
	gÝ
==
TK_STRING
 ){

88056 
zAuthArg
 = 
pAuthArg
->
u
.
zTok’
;

88058 
	gzAuthArg
 = 0;

88060 
	grc
 = 
sql™e3AuthCheck
(
pP¬£
, 
ty³
, 
zAuthArg
, 0, 0);

88061 if(
	grc
!=
SQLITE_OK
 ){

88062 
©ch_’d
;

88068 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

88069 
	g»gArgs
 = 
sql™e3G‘TempRªge
(
pP¬£
, 4);

88070 
sql™e3Ex´Code
(
pP¬£
, 
pFž’ame
, 
»gArgs
);

88071 
sql™e3Ex´Code
(
pP¬£
, 
pDbÇme
, 
»gArgs
+1);

88072 
sql™e3Ex´Code
(
pP¬£
, 
pKey
, 
»gArgs
+2);

88074 
as£¹
Ð
v
 || 
db
->
m®locFažed
 );

88075 ifÐ
	gv
 ){

88076 
sql™e3VdbeAddOp3
(
v
, 
OP_FunùiÚ
, 0, 
»gArgs
+3-
pFunc
->
nArg
,„egArgs+3);

88077 
as£¹
Ð
pFunc
->
nArg
==-1 || (pFunc->nArg&0xff)==pFunc->nArg );

88078 
sql™e3VdbeChªgeP5
(
v
, (
u8
)(
pFunc
->
nArg
));

88079 
sql™e3VdbeChªgeP4
(
v
, -1, (*)
pFunc
, 
P4_FUNCDEF
);

88085 
sql™e3VdbeAddOp1
(
v
, 
OP_Expœe
, (
ty³
==
SQLITE_ATTACH
));

88088 
	g©ch_’d
:

88089 
sql™e3Ex´D–‘e
(
db
, 
pFž’ame
);

88090 
sql™e3Ex´D–‘e
(
db
, 
pDbÇme
);

88091 
sql™e3Ex´D–‘e
(
db
, 
pKey
);

88099 
SQLITE_PRIVATE
 
sql™e3D‘ach
(
P¬£
 *
pP¬£
, 
Ex´
 *
pDbÇme
){

88100 cÚ¡ 
FuncDef
 
	gd‘ach_func
 = {

88102 
SQLITE_UTF8
,

88105 
d‘achFunc
,

88112 
codeA‰ach
(
pP¬£
, 
SQLITE_DETACH
, &
d‘ach_func
, 
pDbÇme
, 0, 0,…Dbname);

88120 
SQLITE_PRIVATE
 
sql™e3A‰ach
(
P¬£
 *
pP¬£
, 
Ex´
 *
p
, Ex´ *
pDbÇme
, Ex´ *
pKey
){

88121 cÚ¡ 
FuncDef
 
	g©ch_func
 = {

88123 
SQLITE_UTF8
,

88126 
©chFunc
,

88133 
codeA‰ach
(
pP¬£
, 
SQLITE_ATTACH
, &
©ch_func
, 
p
,…, 
pDbÇme
, 
pKey
);

88141 
SQLITE_PRIVATE
 
sql™e3FixIn™
(

88142 
DbFix”
 *
pFix
,

88143 
P¬£
 *
pP¬£
,

88144 
iDb
,

88145 cÚ¡ *
zTy³
,

88146 cÚ¡ 
Tok’
 *
pName


88148 
sql™e3
 *
	gdb
;

88150 
	gdb
 = 
pP¬£
->
db
;

88151 
as£¹
Ð
db
->
nDb
>
iDb
 );

88152 
	gpFix
->
	gpP¬£
 = 
pP¬£
;

88153 
	gpFix
->
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

88154 
	gpFix
->
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

88155 
	gpFix
->
	gzTy³
 = 
zTy³
;

88156 
	gpFix
->
	gpName
 = 
pName
;

88157 
	gpFix
->
	gbV¬OÆy
 = (
iDb
==1);

88174 
SQLITE_PRIVATE
 
sql™e3FixSrcLi¡
(

88175 
DbFix”
 *
pFix
,

88176 
SrcLi¡
 *
pLi¡


88178 
	gi
;

88179 cÚ¡ *
	gzDb
;

88180 
SrcLi¡_™em
 *
	gpI‹m
;

88182 ifÐ
NEVER
(
pLi¡
==0) )  0;

88183 
	gzDb
 = 
pFix
->
zDb
;

88184 
	gi
=0, 
	gpI‹m
=
pLi¡
->
a
; i<
	gpLi¡
->
	gnSrc
; i++,…Item++){

88185 ifÐ
	gpFix
->
	gbV¬OÆy
==0 ){

88186 ifÐ
pI‹m
->
zD©aba£
 && 
sql™e3SŒICmp
ÕI‹m->zD©aba£, 
zDb
) ){

88187 
sql™e3E¼ÜMsg
(
pFix
->
pP¬£
,

88189 
pFix
->
zTy³
,…Fix->
pName
, 
pI‹m
->
zD©aba£
);

88192 
sql™e3DbF»e
(
pFix
->
pP¬£
->
db
, 
pI‹m
->
zD©aba£
);

88193 
	gpI‹m
->
	gzD©aba£
 = 0;

88194 
	gpI‹m
->
	gpSchema
 = 
pFix
->
pSchema
;

88196 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_TRIGGER
)

88197 ifÐ
sql™e3FixS–eù
(
pFix
, 
pI‹m
->
pS–eù
) )  1;

88198 ifÐ
sql™e3FixEx´
(
pFix
, 
pI‹m
->
pOn
) )  1;

88203 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_TRIGGER
)

88204 
SQLITE_PRIVATE
 
sql™e3FixS–eù
(

88205 
DbFix”
 *
pFix
,

88206 
S–eù
 *
pS–eù


88208  
	gpS–eù
 ){

88209 ifÐ
sql™e3FixEx´Li¡
(
pFix
, 
pS–eù
->
pELi¡
) ){

88212 ifÐ
sql™e3FixSrcLi¡
(
pFix
, 
pS–eù
->
pSrc
) ){

88215 ifÐ
sql™e3FixEx´
(
pFix
, 
pS–eù
->
pWh”e
) ){

88218 ifÐ
sql™e3FixEx´Li¡
(
pFix
, 
pS–eù
->
pGroupBy
) ){

88221 ifÐ
sql™e3FixEx´
(
pFix
, 
pS–eù
->
pHavšg
) ){

88224 ifÐ
sql™e3FixEx´Li¡
(
pFix
, 
pS–eù
->
pOrd”By
) ){

88227 ifÐ
sql™e3FixEx´
(
pFix
, 
pS–eù
->
pLim™
) ){

88230 ifÐ
sql™e3FixEx´
(
pFix
, 
pS–eù
->
pOff£t
) ){

88233 
	gpS–eù
 = 
pS–eù
->
pPriÜ
;

88237 
SQLITE_PRIVATE
 
sql™e3FixEx´
(

88238 
DbFix”
 *
pFix
,

88239 
Ex´
 *
pEx´


88241  
	gpEx´
 ){

88242 ifÐ
	gpEx´
->
	gÝ
==
TK_VARIABLE
 ){

88243 ifÐ
pFix
->
pP¬£
->
db
->
š™
.
busy
 ){

88244 
pEx´
->
Ý
 = 
TK_NULL
;

88246 
sql™e3E¼ÜMsg
(
pFix
->
pP¬£
, "% ÿÂÙ u£ v¬ŸbËs",…Fix->
zTy³
);

88250 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_Tok’OÆy
) ) ;

88251 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

88252 ifÐ
sql™e3FixS–eù
(
pFix
, 
pEx´
->
x
.
pS–eù
) )  1;

88254 ifÐ
sql™e3FixEx´Li¡
(
pFix
, 
pEx´
->
x
.
pLi¡
) )  1;

88256 ifÐ
sql™e3FixEx´
(
pFix
, 
pEx´
->
pRight
) ){

88259 
	gpEx´
 = 
pEx´
->
pLeá
;

88263 
SQLITE_PRIVATE
 
sql™e3FixEx´Li¡
(

88264 
DbFix”
 *
pFix
,

88265 
Ex´Li¡
 *
pLi¡


88267 
	gi
;

88268 
Ex´Li¡_™em
 *
	gpI‹m
;

88269 ifÐ
	gpLi¡
==0 )  0;

88270 
	gi
=0, 
	gpI‹m
=
pLi¡
->
a
; i<
	gpLi¡
->
	gnEx´
; i++,…Item++){

88271 ifÐ
sql™e3FixEx´
(
pFix
, 
pI‹m
->
pEx´
) ){

88279 #iâdeà
SQLITE_OMIT_TRIGGER


88280 
SQLITE_PRIVATE
 
sql™e3FixTrigg”S‹p
(

88281 
DbFix”
 *
pFix
,

88282 
Trigg”S‹p
 *
pS‹p


88284  
	gpS‹p
 ){

88285 ifÐ
sql™e3FixS–eù
(
pFix
, 
pS‹p
->
pS–eù
) ){

88288 ifÐ
sql™e3FixEx´
(
pFix
, 
pS‹p
->
pWh”e
) ){

88291 ifÐ
sql™e3FixEx´Li¡
(
pFix
, 
pS‹p
->
pEx´Li¡
) ){

88294 
	gpS‹p
 = 
pS‹p
->
pNext
;

88323 #iâdeà
SQLITE_OMIT_AUTHORIZATION


88370 
SQLITE_API
 
sql™e3_£t_authÜiz”
(

88371 
sql™e3
 *
db
,

88372 (*
xAuth
)(*,,const *,const *,const *,const *),

88373 *
pArg


88375 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

88376 
	gdb
->
	gxAuth
 = (
sql™e3_xauth
)
xAuth
;

88377 
	gdb
->
	gpAuthArg
 = 
pArg
;

88378 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

88379 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

88380  
	gSQLITE_OK
;

88387 
sql™eAuthBadR‘uºCode
(
P¬£
 *
pP¬£
){

88388 
sql™e3E¼ÜMsg
(
pP¬£
, "authorizer malfunction");

88389 
	gpP¬£
->
	grc
 = 
SQLITE_ERROR
;

88401 
SQLITE_PRIVATE
 
sql™e3AuthR—dCÞ
(

88402 
P¬£
 *
pP¬£
,

88403 cÚ¡ *
zTab
,

88404 cÚ¡ *
zCÞ
,

88405 
iDb


88407 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

88408 *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

88409 
	grc
;

88411 
	grc
 = 
db
->
xAuth
(db->
pAuthArg
, 
SQLITE_READ
, 
zTab
,
zCÞ
,
zDb
,
pP¬£
->
zAuthCÚ‹xt


88412 #ifdeà
SQLITE_USER_AUTHENTICATION


88413 ,
db
->
auth
.
zAuthU£r


88416 ifÐ
	grc
==
SQLITE_DENY
 ){

88417 ifÐ
db
->
nDb
>2 || 
iDb
!=0 ){

88418 
sql™e3E¼ÜMsg
(
pP¬£
, "acûs tØ%s.%s.% i ´ohib™ed",
zDb
,
zTab
,
zCÞ
);

88420 
sql™e3E¼ÜMsg
(
pP¬£
, "acûs tØ%s.% i ´ohib™ed", 
zTab
, 
zCÞ
);

88422 
	gpP¬£
->
	grc
 = 
SQLITE_AUTH
;

88423 }ifÐ
	grc
!=
SQLITE_IGNORE
 && 
rc
!=
SQLITE_OK
 ){

88424 
sql™eAuthBadR‘uºCode
(
pP¬£
);

88426  
	grc
;

88438 
SQLITE_PRIVATE
 
sql™e3AuthR—d
(

88439 
P¬£
 *
pP¬£
,

88440 
Ex´
 *
pEx´
,

88441 
Schema
 *
pSchema
,

88442 
SrcLi¡
 *
pTabLi¡


88444 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

88445 
TabË
 *
	gpTab
 = 0;

88446 cÚ¡ *
	gzCÞ
;

88447 
	giSrc
;

88448 
	giDb
;

88449 
	giCÞ
;

88451 ifÐ
	gdb
->
	gxAuth
==0 ) ;

88452 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pSchema
);

88453 ifÐ
	giDb
<0 ){

88459 
as£¹
Ð
pEx´
->
Ý
==
TK_COLUMN
 ||…Ex´->Ý==
TK_TRIGGER
 );

88460 ifÐ
	gpEx´
->
	gÝ
==
TK_TRIGGER
 ){

88461 
pTab
 = 
pP¬£
->
pTrigg”Tab
;

88463 
as£¹
Ð
pTabLi¡
 );

88464 
	giSrc
=0; 
ALWAYS
(
iSrc
<
pTabLi¡
->
nSrc
); iSrc++){

88465 ifÐ
	gpEx´
->
	giTabË
==
pTabLi¡
->
a
[
iSrc
].
iCursÜ
 ){

88466 
pTab
 = 
pTabLi¡
->
a
[
iSrc
].pTab;

88471 
	giCÞ
 = 
pEx´
->
iCÞumn
;

88472 ifÐ
NEVER
(
pTab
==0) ) ;

88474 ifÐ
	giCÞ
>=0 ){

88475 
as£¹
Ð
iCÞ
<
pTab
->
nCÞ
 );

88476 
	gzCÞ
 = 
pTab
->
aCÞ
[
iCÞ
].
zName
;

88477 }ifÐ
	gpTab
->
	giPKey
>=0 ){

88478 
as£¹
Ð
pTab
->
iPKey
<pTab->
nCÞ
 );

88479 
	gzCÞ
 = 
pTab
->
aCÞ
[pTab->
iPKey
].
zName
;

88481 
	gzCÞ
 = "ROWID";

88483 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

88484 ifÐ
	gSQLITE_IGNORE
==
sql™e3AuthR—dCÞ
(
pP¬£
, 
pTab
->
zName
, 
zCÞ
, 
iDb
) ){

88485 
	gpEx´
->
	gÝ
 = 
TK_NULL
;

88495 
SQLITE_PRIVATE
 
sql™e3AuthCheck
(

88496 
P¬£
 *
pP¬£
,

88497 
code
,

88498 cÚ¡ *
zArg1
,

88499 cÚ¡ *
zArg2
,

88500 cÚ¡ *
zArg3


88502 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

88503 
	grc
;

88508 ifÐ
	gdb
->
	gš™
.
	gbusy
 || 
	gIN_DECLARE_VTAB
 ){

88509  
	gSQLITE_OK
;

88512 ifÐ
	gdb
->
	gxAuth
==0 ){

88513  
SQLITE_OK
;

88515 
	grc
 = 
db
->
xAuth
(db->
pAuthArg
, 
code
, 
zArg1
, 
zArg2
, 
zArg3
, 
pP¬£
->
zAuthCÚ‹xt


88516 #ifdeà
SQLITE_USER_AUTHENTICATION


88517 ,
db
->
auth
.
zAuthU£r


88520 ifÐ
	grc
==
SQLITE_DENY
 ){

88521 
sql™e3E¼ÜMsg
(
pP¬£
, "not‡uthorized");

88522 
	gpP¬£
->
	grc
 = 
SQLITE_AUTH
;

88523 }ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_IGNORE
 ){

88524 
rc
 = 
SQLITE_DENY
;

88525 
sql™eAuthBadR‘uºCode
(
pP¬£
);

88527  
	grc
;

88535 
SQLITE_PRIVATE
 
sql™e3AuthCÚ‹xtPush
(

88536 
P¬£
 *
pP¬£
,

88537 
AuthCÚ‹xt
 *
pCÚ‹xt
,

88538 cÚ¡ *
zCÚ‹xt


88540 
as£¹
Ð
pP¬£
 );

88541 
	gpCÚ‹xt
->
	gpP¬£
 = 
pP¬£
;

88542 
	gpCÚ‹xt
->
	gzAuthCÚ‹xt
 = 
pP¬£
->
zAuthCÚ‹xt
;

88543 
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
zCÚ‹xt
;

88550 
SQLITE_PRIVATE
 
sql™e3AuthCÚ‹xtPÝ
(
AuthCÚ‹xt
 *
pCÚ‹xt
){

88551 ifÐ
	gpCÚ‹xt
->
	gpP¬£
 ){

88552 
	gpCÚ‹xt
->
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
pCÚ‹xt
->
zAuthCÚ‹xt
;

88553 
	gpCÚ‹xt
->
	gpP¬£
 = 0;

88590 
SQLITE_PRIVATE
 
sql™e3BegšP¬£
(
P¬£
 *
pP¬£
, 
ex¶ašFÏg
){

88591 
	gpP¬£
->
	gex¶aš
 = (
u8
)
ex¶ašFÏg
;

88592 
	gpP¬£
->
	gnV¬
 = 0;

88595 #iâdeà
SQLITE_OMIT_SHARED_CACHE


88600 
	sTabËLock
 {

88601 
	giDb
;

88602 
	giTab
;

88603 
u8
 
	gisWr™eLock
;

88604 cÚ¡ *
	gzName
;

88617 
SQLITE_PRIVATE
 
sql™e3TabËLock
(

88618 
P¬£
 *
pP¬£
,

88619 
iDb
,

88620 
iTab
,

88621 
u8
 
isWr™eLock
,

88622 cÚ¡ *
zName


88624 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

88625 
	gi
;

88626 
	gnBy‹s
;

88627 
TabËLock
 *
	gp
;

88628 
as£¹
Ð
iDb
>=0 );

88630 
	gi
=0; i<
	gpTÝËv–
->
	gnTabËLock
; i++){

88631 
	gp
 = &
pTÝËv–
->
aTabËLock
[
i
];

88632 ifÐ
	gp
->
	giDb
==
iDb
 && 
p
->
iTab
==iTab ){

88633 
p
->
isWr™eLock
 = (p->isWriteLock || isWriteLock);

88638 
	gnBy‹s
 = (
TabËLock
è* (
pTÝËv–
->
nTabËLock
+1);

88639 
	gpTÝËv–
->
	gaTabËLock
 =

88640 
sql™e3DbR—ÎocOrF»e
(
pTÝËv–
->
db
,…TÝËv–->
aTabËLock
, 
nBy‹s
);

88641 ifÐ
	gpTÝËv–
->
	gaTabËLock
 ){

88642 
	gp
 = &
pTÝËv–
->
aTabËLock
[pTÝËv–->
nTabËLock
++];

88643 
	gp
->
	giDb
 = 
iDb
;

88644 
	gp
->
	giTab
 = 
iTab
;

88645 
	gp
->
	gisWr™eLock
 = 
isWr™eLock
;

88646 
	gp
->
	gzName
 = 
zName
;

88648 
	gpTÝËv–
->
	gnTabËLock
 = 0;

88649 
	gpTÝËv–
->
	gdb
->
	gm®locFažed
 = 1;

88657 
codeTabËLocks
(
P¬£
 *
pP¬£
){

88658 
	gi
;

88659 
Vdbe
 *
	gpVdbe
;

88661 
	gpVdbe
 = 
sql™e3G‘Vdbe
(
pP¬£
);

88662 
as£¹
Ð
pVdbe
!=0 );

88664 
	gi
=0; i<
	gpP¬£
->
	gnTabËLock
; i++){

88665 
TabËLock
 *
	gp
 = &
pP¬£
->
aTabËLock
[
i
];

88666 
	gp1
 = 
p
->
iDb
;

88667 
sql™e3VdbeAddOp4
(
pVdbe
, 
OP_TabËLock
, 
p1
, 
p
->
iTab
,…->
isWr™eLock
,

88668 
p
->
zName
, 
P4_STATIC
);

88672 
	#codeTabËLocks
(
x
)

	)

88680 #ià
SQLITE_MAX_ATTACHED
>30

88681 
SQLITE_PRIVATE
 
sql™e3DbMaskAÎZ”o
(
yDbMask
 
m
){

88682 
	gi
;

88683 
	gi
=0; i<(
	gyDbMask
); i++èifÐ
	gm
[
i
] )  0;

88698 
SQLITE_PRIVATE
 
sql™e3FšishCodšg
(
P¬£
 *
pP¬£
){

88699 
sql™e3
 *
	gdb
;

88700 
Vdbe
 *
	gv
;

88702 
as£¹
Ð
pP¬£
->
pTÝËv–
==0 );

88703 
	gdb
 = 
pP¬£
->
db
;

88704 ifÐ
	gdb
->
	gm®locFažed
 ) ;

88705 ifÐ
	gpP¬£
->
	gÃ¡ed
 ) ;

88706 ifÐ
	gpP¬£
->
	gnE¼
 ) ;

88711 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

88712 
as£¹
Ð!
pP¬£
->
isMuÉiWr™e


88713 || 
sql™e3VdbeAs£¹MayAbÜt
(
v
, 
pP¬£
->
mayAbÜt
));

88714 ifÐ
	gv
 ){

88715  
sql™e3VdbeD–‘ePriÜOpcode
(
v
, 
OP_Clo£
) ){}

88716 
sql™e3VdbeAddOp0
(
v
, 
OP_H®t
);

88718 #ià
SQLITE_USER_AUTHENTICATION


88719 ifÐ
	gpP¬£
->
	gnTabËLock
>0 && 
	gdb
->
	gš™
.
	gbusy
==0 ){

88720 
sql™e3U£rAuthIn™
(
db
);

88721 ifÐ
	gdb
->
	gauth
.
	gauthLev–
<
	gUAUTH_U£r
 ){

88722 
	gpP¬£
->
	grc
 = 
SQLITE_AUTH_USER
;

88723 
sql™e3E¼ÜMsg
(
pP¬£
, "user‚ot‡uthenticated");

88735 ifÐ
	gdb
->
	gm®locFažed
==0

88736 && (
DbMaskNÚZ”o
(
pP¬£
->
cook›Mask
è||…P¬£->
pCÚ¡Ex´
)

88738 
iDb
, 
i
;

88739 
as£¹
Ð
sql™e3VdbeG‘Op
(
v
, 0)->
Ýcode
==
OP_In™
 );

88740 
sql™e3VdbeJumpH”e
(
v
, 0);

88741 
	giDb
=0; iDb<
	gdb
->
	gnDb
; iDb++){

88742 ifÐ
DbMaskTe¡
(
pP¬£
->
cook›Mask
, 
iDb
)==0 ) ;

88743 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

88744 
sql™e3VdbeAddOp4IÁ
(
v
,

88745 
OP_T¿n§ùiÚ
,

88746 
iDb
,

88747 
DbMaskTe¡
(
pP¬£
->
wr™eMask
,
iDb
),

88748 
pP¬£
->
cook›V®ue
[
iDb
],

88749 
db
->
aDb
[
iDb
].
pSchema
->
iG’”©iÚ


88751 ifÐ
	gdb
->
	gš™
.
	gbusy
==0 ) 
sql™e3VdbeChªgeP5
(
v
, 1);

88753 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


88754 
	gi
=0; i<
	gpP¬£
->
	gnVbLock
; i++){

88755 *
	gvb
 = (*)
sql™e3G‘VTabË
(
db
, 
pP¬£
->
­VbLock
[
i
]);

88756 
sql™e3VdbeAddOp4
(
v
, 
OP_VBegš
, 0, 0, 0, 
vb
, 
P4_VTAB
);

88758 
	gpP¬£
->
	gnVbLock
 = 0;

88765 
codeTabËLocks
(
pP¬£
);

88769 
sql™e3Autošüem’tBegš
(
pP¬£
);

88772 ifÐ
	gpP¬£
->
	gpCÚ¡Ex´
 ){

88773 
Ex´Li¡
 *
	gpEL
 = 
pP¬£
->
pCÚ¡Ex´
;

88774 
	gpP¬£
->
	gokCÚ¡FaùÜ
 = 0;

88775 
	gi
=0; i<
	gpEL
->
	gnEx´
; i++){

88776 
sql™e3Ex´Code
(
pP¬£
, 
pEL
->
a
[
i
].
pEx´
,…EL->a[i].
u
.
iCÚ¡Ex´Reg
);

88781 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 1);

88788 ifÐ
	gv
 && 
ALWAYS
(
pP¬£
->
nE¼
==0è&& !
db
->
m®locFažed
 ){

88789 
as£¹
Ð
pP¬£
->
iCacheLev–
==0 );

88792 ifÐ
	gpP¬£
->
	gpAšc
!=0 && 
pP¬£
->
nTab
==0 )…Parse->nTab = 1;

88793 
sql™e3VdbeMakeR—dy
(
v
, 
pP¬£
);

88794 
	gpP¬£
->
	grc
 = 
SQLITE_DONE
;

88795 
	gpP¬£
->
	gcÞNamesS‘
 = 0;

88797 
	gpP¬£
->
	grc
 = 
SQLITE_ERROR
;

88799 
	gpP¬£
->
	gnTab
 = 0;

88800 
	gpP¬£
->
	gnMem
 = 0;

88801 
	gpP¬£
->
	gnS‘
 = 0;

88802 
	gpP¬£
->
	gnV¬
 = 0;

88803 
DbMaskZ”o
(
pP¬£
->
cook›Mask
);

88818 
SQLITE_PRIVATE
 
sql™e3Ne¡edP¬£
(
P¬£
 *
pP¬£
, cÚ¡ *
zFÜm©
, ...){

88819 
va_li¡
 
	g­
;

88820 *
	gzSql
;

88821 *
	gzE¼Msg
 = 0;

88822 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

88823 
	#SAVE_SZ
 ((
P¬£
è- 
	`off£tof
(P¬£,
nV¬
))

	)

88824 
	g§veBuf
[
SAVE_SZ
];

88826 ifÐ
	gpP¬£
->
	gnE¼
 ) ;

88827 
as£¹
Ð
pP¬£
->
Ã¡ed
<10 );

88828 
va_¡¬t
(
­
, 
zFÜm©
);

88829 
	gzSql
 = 
sql™e3VMPrštf
(
db
, 
zFÜm©
, 
­
);

88830 
va_’d
(
­
);

88831 ifÐ
	gzSql
==0 ){

88834 
	gpP¬£
->
	gÃ¡ed
++;

88835 
memýy
(
§veBuf
, &
pP¬£
->
nV¬
, 
SAVE_SZ
);

88836 
mem£t
(&
pP¬£
->
nV¬
, 0, 
SAVE_SZ
);

88837 
sql™e3RunP¬£r
(
pP¬£
, 
zSql
, &
zE¼Msg
);

88838 
sql™e3DbF»e
(
db
, 
zE¼Msg
);

88839 
sql™e3DbF»e
(
db
, 
zSql
);

88840 
memýy
(&
pP¬£
->
nV¬
, 
§veBuf
, 
SAVE_SZ
);

88841 
	gpP¬£
->
	gÃ¡ed
--;

88844 #ià
SQLITE_USER_AUTHENTICATION


88849 
SQLITE_PRIVATE
 
sql™e3U£rAuthTabË
(cÚ¡ *
zTabË
){

88850  
sql™e3_¡ricmp
(
zTabË
, "sqlite_user")==0;

88866 
SQLITE_PRIVATE
 
TabË
 *
sql™e3FšdTabË
(
sql™e3
 *
db
, cÚ¡ *
zName
, cÚ¡ *
zD©aba£
){

88867 
TabË
 *
	gp
 = 0;

88868 
	gi
;

88869 
as£¹
Ð
zName
!=0 );

88871 
as£¹
Ð
zD©aba£
!=0 || 
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

88872 #ià
SQLITE_USER_AUTHENTICATION


88875 ifÐ
	gdb
->
	gauth
.
	gauthLev–
<
	gUAUTH_Admš
 && 
sql™e3U£rAuthTabË
(
zName
)!=0 ){

88879 
	gi
=
OMIT_TEMPDB
; i<
	gdb
->
	gnDb
; i++){

88880 
	gj
 = (
i
<2) ? i^1 : i;

88881 ifÐ
	gzD©aba£
!=0 && 
sql™e3SŒICmp
(
zD©aba£
, 
db
->
aDb
[
j
].
zName
) ) ;

88882 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
j
, 0) );

88883 
	gp
 = 
sql™e3HashFšd
(&
db
->
aDb
[
j
].
pSchema
->
tblHash
, 
zName
);

88884 ifÐ
	gp
 ) ;

88886  
	gp
;

88899 
SQLITE_PRIVATE
 
TabË
 *
sql™e3Loÿ‹TabË
(

88900 
P¬£
 *
pP¬£
,

88901 
isV›w
,

88902 cÚ¡ *
zName
,

88903 cÚ¡ *
zDba£


88905 
TabË
 *
	gp
;

88909 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

88913 
	gp
 = 
sql™e3FšdTabË
(
pP¬£
->
db
, 
zName
, 
zDba£
);

88914 ifÐ
	gp
==0 ){

88915 cÚ¡ *
zMsg
 = 
isV›w
 ? "no such view" : "no suchable";

88916 ifÐ
	gzDba£
 ){

88917 
sql™e3E¼ÜMsg
(
pP¬£
, "%s: %s.%s", 
zMsg
, 
zDba£
, 
zName
);

88919 
sql™e3E¼ÜMsg
(
pP¬£
, "%s: %s", 
zMsg
, 
zName
);

88921 
	gpP¬£
->
	gcheckSchema
 = 1;

88923 #ià
SQLITE_USER_AUTHENICATION


88924 ifÐ
	gpP¬£
->
	gdb
->
	gauth
.
	gauthLev–
<
	gUAUTH_U£r
 ){

88925 
sql™e3E¼ÜMsg
(
pP¬£
, "user‚ot‡uthenticated");

88926 
	gp
 = 0;

88929  
	gp
;

88941 
SQLITE_PRIVATE
 
TabË
 *
sql™e3Loÿ‹TabËI‹m
(

88942 
P¬£
 *
pP¬£
,

88943 
isV›w
,

88944 
SrcLi¡_™em
 *
p


88946 cÚ¡ *
	gzDb
;

88947 
as£¹
Ð
p
->
pSchema
==0 ||…->
zD©aba£
==0 );

88948 ifÐ
	gp
->
	gpSchema
 ){

88949 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
p
->
pSchema
);

88950 
	gzDb
 = 
pP¬£
->
db
->
aDb
[
iDb
].
zName
;

88952 
	gzDb
 = 
p
->
zD©aba£
;

88954  
sql™e3Loÿ‹TabË
(
pP¬£
, 
isV›w
, 
p
->
zName
, 
zDb
);

88969 
SQLITE_PRIVATE
 
Index
 *
sql™e3FšdIndex
(
sql™e3
 *
db
, cÚ¡ *
zName
, cÚ¡ *
zDb
){

88970 
Index
 *
	gp
 = 0;

88971 
	gi
;

88973 
as£¹
Ð
zDb
!=0 || 
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

88974 
	gi
=
OMIT_TEMPDB
; i<
	gdb
->
	gnDb
; i++){

88975 
	gj
 = (
i
<2) ? i^1 : i;

88976 
Schema
 *
	gpSchema
 = 
db
->
aDb
[
j
].
pSchema
;

88977 
as£¹
Ð
pSchema
 );

88978 ifÐ
	gzDb
 && 
sql™e3SŒICmp
(
zDb
, 
db
->
aDb
[
j
].
zName
) ) ;

88979 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
j
, 0) );

88980 
	gp
 = 
sql™e3HashFšd
(&
pSchema
->
idxHash
, 
zName
);

88981 ifÐ
	gp
 ) ;

88983  
	gp
;

88989 
ä“Index
(
sql™e3
 *
db
, 
Index
 *
p
){

88990 #iâdeà
SQLITE_OMIT_ANALYZE


88991 
sql™e3D–‘eIndexSam¶es
(
db
, 
p
);

88993 ifÐ
	gdb
==0 || 
db
->
²By‹sF»ed
==0 ) 
sql™e3KeyInfoUÄef
(
p
->
pKeyInfo
);

88994 
sql™e3Ex´D–‘e
(
db
, 
p
->
pP¬tIdxWh”e
);

88995 
sql™e3DbF»e
(
db
, 
p
->
zCÞAff
);

88996 ifÐ
	gp
->
	gisResized
 ) 
sql™e3DbF»e
(
db
, 
p
->
azCÞl
);

88997 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


88998 
sql™e3_ä“
(
p
->
aiRowE¡
);

89000 
sql™e3DbF»e
(
db
, 
p
);

89009 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eIndex
(
sql™e3
 *
db
, 
iDb
, cÚ¡ *
zIdxName
){

89010 
Index
 *
	gpIndex
;

89011 
Hash
 *
	gpHash
;

89013 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

89014 
	gpHash
 = &
db
->
aDb
[
iDb
].
pSchema
->
idxHash
;

89015 
	gpIndex
 = 
sql™e3HashIn£¹
(
pHash
, 
zIdxName
, 0);

89016 ifÐ
ALWAYS
(
pIndex
) ){

89017 ifÐ
	gpIndex
->
	gpTabË
->pIndex==
pIndex
 ){

89018 
pIndex
->
pTabË
->pIndex =…Index->
pNext
;

89020 
Index
 *
	gp
;

89023 
	gp
 = 
pIndex
->
pTabË
->pIndex;

89024  
ALWAYS
(
p
è&& 
	gp
->
	gpNext
!=
pIndex
 ){… =…->
pNext
; }

89025 ifÐ
ALWAYS
(
p
 &&…->
pNext
==
pIndex
) ){

89026 
p
->
pNext
 = 
pIndex
->pNext;

89029 
ä“Index
(
db
, 
pIndex
);

89031 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

89042 
SQLITE_PRIVATE
 
sql™e3CÞÏp£D©aba£A¼ay
(
sql™e3
 *
db
){

89043 
	gi
, 
	gj
;

89044 
	gi
=
j
=2; i<
	gdb
->
	gnDb
; i++){

89045 
Db
 *
	gpDb
 = &
db
->
aDb
[
i
];

89046 ifÐ
	gpDb
->
	gpBt
==0 ){

89047 
sql™e3DbF»e
(
db
, 
pDb
->
zName
);

89048 
	gpDb
->
	gzName
 = 0;

89051 ifÐ
	gj
<
	gi
 ){

89052 
	gdb
->
	gaDb
[
j
] = 
db
->
aDb
[
i
];

89054 
	gj
++;

89056 
mem£t
(&
db
->
aDb
[
j
], 0, (db->
nDb
-j)*(db->aDb[j]));

89057 
	gdb
->
	gnDb
 = 
j
;

89058 ifÐ
	gdb
->
	gnDb
<=2 && 
db
->
aDb
!=db->
aDbStic
 ){

89059 
memýy
(
db
->
aDbStic
, db->
aDb
, 2*(db->aDb[0]));

89060 
sql™e3DbF»e
(
db
, db->
aDb
);

89061 
	gdb
->
	gaDb
 = 
db
->
aDbStic
;

89069 
SQLITE_PRIVATE
 
sql™e3Re£tOÃSchema
(
sql™e3
 *
db
, 
iDb
){

89070 
Db
 *
	gpDb
;

89071 
as£¹
Ð
iDb
<
db
->
nDb
 );

89074 
	gpDb
 = &
db
->
aDb
[
iDb
];

89075 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

89076 
as£¹
Ð
pDb
->
pSchema
!=0 );

89077 
sql™e3SchemaCË¬
(
pDb
->
pSchema
);

89083 ifÐ
	giDb
!=1 ){

89084 
pDb
 = &
db
->
aDb
[1];

89085 
as£¹
Ð
pDb
->
pSchema
!=0 );

89086 
sql™e3SchemaCË¬
(
pDb
->
pSchema
);

89095 
SQLITE_PRIVATE
 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
sql™e3
 *
db
){

89096 
	gi
;

89097 
sql™e3BŒ“EÁ”AÎ
(
db
);

89098 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

89099 
Db
 *
	gpDb
 = &
db
->
aDb
[
i
];

89100 ifÐ
	gpDb
->
	gpSchema
 ){

89101 
sql™e3SchemaCË¬
(
pDb
->
pSchema
);

89104 
	gdb
->
	gæags
 &ð~
SQLITE_IÁ”nChªges
;

89105 
sql™e3VbUÆockLi¡
(
db
);

89106 
sql™e3BŒ“L—veAÎ
(
db
);

89107 
sql™e3CÞÏp£D©aba£A¼ay
(
db
);

89113 
SQLITE_PRIVATE
 
sql™e3Comm™IÁ”ÇlChªges
(
sql™e3
 *
db
){

89114 
	gdb
->
	gæags
 &ð~
SQLITE_IÁ”nChªges
;

89121 
sql™eD–‘eCÞumnNames
(
sql™e3
 *
db
, 
TabË
 *
pTabË
){

89122 
	gi
;

89123 
CÞumn
 *
	gpCÞ
;

89124 
as£¹
Ð
pTabË
!=0 );

89125 ifÐ(
	gpCÞ
 = 
pTabË
->
aCÞ
)!=0 ){

89126 
i
=0; 
	gi
<
	gpTabË
->
	gnCÞ
; i++, 
	gpCÞ
++){

89127 
sql™e3DbF»e
(
db
, 
pCÞ
->
zName
);

89128 
sql™e3Ex´D–‘e
(
db
, 
pCÞ
->
pDæt
);

89129 
sql™e3DbF»e
(
db
, 
pCÞ
->
zDæt
);

89130 
sql™e3DbF»e
(
db
, 
pCÞ
->
zTy³
);

89131 
sql™e3DbF»e
(
db
, 
pCÞ
->
zCÞl
);

89133 
sql™e3DbF»e
(
db
, 
pTabË
->
aCÞ
);

89152 
SQLITE_PRIVATE
 
sql™e3D–‘eTabË
(
sql™e3
 *
db
, 
TabË
 *
pTabË
){

89153 
Index
 *
	gpIndex
, *
	gpNext
;

89154 
TESTONLY
Ð
nLookaside
; )

89156 
as£¹
Ð!
pTabË
 ||…TabË->
nRef
>0 );

89159 ifÐ!
	gpTabË
 ) ;

89160 ifÐ((!
	gdb
 || db->
	g²By‹sF»ed
==0è&& (--
pTabË
->
nRef
)>0) ) ;

89165 
TESTONLY
Ð
nLookaside
 = (
db
 && (
pTabË
->
bFÏgs
 & 
TF_Ephem”®
)==0) ?

89166 
db
->
lookaside
.
nOut
 : 0 );

89169 
	gpIndex
 = 
pTabË
->
pIndex
;…Index;…Index=
pNext
){

89170 
pNext
 = 
pIndex
->pNext;

89171 
as£¹
Ð
pIndex
->
pSchema
==
pTabË
->pSchema );

89172 ifÐ!
	gdb
 || db->
	g²By‹sF»ed
==0 ){

89173 *
zName
 = 
pIndex
->zName;

89174 
TESTONLY
 ( 
Index
 *
pOld
 = ) 
sql™e3HashIn£¹
(

89175 &
pIndex
->
pSchema
->
idxHash
, 
zName
, 0

89177 
as£¹
Ð
db
==0 || 
sql™e3SchemaMu‹xH–d
(db, 0, 
pIndex
->
pSchema
) );

89178 
as£¹
Ð
pOld
==
pIndex
 ||…Old==0 );

89180 
ä“Index
(
db
, 
pIndex
);

89184 
sql™e3FkD–‘e
(
db
, 
pTabË
);

89188 
sql™eD–‘eCÞumnNames
(
db
, 
pTabË
);

89189 
sql™e3DbF»e
(
db
, 
pTabË
->
zName
);

89190 
sql™e3DbF»e
(
db
, 
pTabË
->
zCÞAff
);

89191 
sql™e3S–eùD–‘e
(
db
, 
pTabË
->
pS–eù
);

89192 #iâdeà
SQLITE_OMIT_CHECK


89193 
sql™e3Ex´Li¡D–‘e
(
db
, 
pTabË
->
pCheck
);

89195 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


89196 
sql™e3VbCË¬
(
db
, 
pTabË
);

89198 
sql™e3DbF»e
(
db
, 
pTabË
);

89201 
as£¹
Ð
nLookaside
==0 ||‚Lookaside==
db
->
lookaside
.
nOut
 );

89208 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eTabË
(
sql™e3
 *
db
, 
iDb
, cÚ¡ *
zTabName
){

89209 
TabË
 *
	gp
;

89210 
Db
 *
	gpDb
;

89212 
as£¹
Ð
db
!=0 );

89213 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

89214 
as£¹
Ð
zTabName
 );

89215 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

89216 
‹¡ÿ£
Ð
zTabName
[0]==0 );

89217 
	gpDb
 = &
db
->
aDb
[
iDb
];

89218 
	gp
 = 
sql™e3HashIn£¹
(&
pDb
->
pSchema
->
tblHash
, 
zTabName
, 0);

89219 
sql™e3D–‘eTabË
(
db
, 
p
);

89220 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

89236 
SQLITE_PRIVATE
 *
sql™e3NameFromTok’
(
sql™e3
 *
db
, 
Tok’
 *
pName
){

89237 *
	gzName
;

89238 ifÐ
	gpName
 ){

89239 
	gzName
 = 
sql™e3DbSŒNDup
(
db
, (*)
pName
->
z
,…Name->
n
);

89240 
sql™e3DequÙe
(
zName
);

89242 
	gzName
 = 0;

89244  
	gzName
;

89251 
SQLITE_PRIVATE
 
sql™e3O³nMa¡”TabË
(
P¬£
 *
p
, 
iDb
){

89252 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
p
);

89253 
sql™e3TabËLock
(
p
, 
iDb
, 
MASTER_ROOT
, 1, 
SCHEMA_TABLE
(iDb));

89254 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_O³nWr™e
, 0, 
MASTER_ROOT
, 
iDb
, 5);

89255 ifÐ
	gp
->
	gnTab
==0 ){

89256 
p
->
nTab
 = 1;

89266 
SQLITE_PRIVATE
 
sql™e3FšdDbName
(
sql™e3
 *
db
, cÚ¡ *
zName
){

89267 
	gi
 = -1;

89268 ifÐ
	gzName
 ){

89269 
Db
 *
	gpDb
;

89270 
	gn
 = 
sql™e3SŒËn30
(
zName
);

89271 
	gi
=(
db
->
nDb
-1), 
	gpDb
=&db->
aDb
[
i
]; i>=0; i--,…Db--){

89272 ifÐ(!
	gOMIT_TEMPDB
 || 
	gi
!=1 ) && 
n
==
sql™e3SŒËn30
(
pDb
->
zName
) &&

89273 0==
sql™e3SŒICmp
(
pDb
->
zName
, zName) ){

89278  
	gi
;

89287 
SQLITE_PRIVATE
 
sql™e3FšdDb
(
sql™e3
 *
db
, 
Tok’
 *
pName
){

89288 
	gi
;

89289 *
	gzName
;

89290 
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

89291 
	gi
 = 
sql™e3FšdDbName
(
db
, 
zName
);

89292 
sql™e3DbF»e
(
db
, 
zName
);

89293  
	gi
;

89312 
SQLITE_PRIVATE
 
sql™e3TwoP¬tName
(

89313 
P¬£
 *
pP¬£
,

89314 
Tok’
 *
pName1
,

89315 
Tok’
 *
pName2
,

89316 
Tok’
 **
pUnqu®


89318 
	giDb
;

89319 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89321 ifÐ
ALWAYS
(
pName2
!=0è&&…Name2->
n
>0 ){

89322 ifÐ
db
->
š™
.
busy
 ) {

89323 
sql™e3E¼ÜMsg
(
pP¬£
, "corrupt database");

89324 
	gpP¬£
->
	gnE¼
++;

89327 *
	gpUnqu®
 = 
pName2
;

89328 
	giDb
 = 
sql™e3FšdDb
(
db
, 
pName1
);

89329 ifÐ
	giDb
<0 ){

89330 
sql™e3E¼ÜMsg
(
pP¬£
, "unknowÀd©aba£ %T", 
pName1
);

89331 
	gpP¬£
->
	gnE¼
++;

89335 
as£¹
Ð
db
->
š™
.
iDb
==0 || db->š™.
busy
 );

89336 
	giDb
 = 
db
->
š™
.
iDb
;

89337 *
	gpUnqu®
 = 
pName1
;

89339  
	giDb
;

89349 
SQLITE_PRIVATE
 
sql™e3CheckObjeùName
(
P¬£
 *
pP¬£
, cÚ¡ *
zName
){

89350 ifÐ!
	gpP¬£
->
	gdb
->
	gš™
.
	gbusy
 &&…P¬£->
	gÃ¡ed
==0

89351 && (
pP¬£
->
db
->
æags
 & 
SQLITE_Wr™eSchema
)==0

89352 && 0==
sql™e3SŒNICmp
(
zName
, "sqlite_", 7) ){

89353 
sql™e3E¼ÜMsg
(
pP¬£
, "objeù‚am»£rved fÜ iÁ”ÇÈu£: %s", 
zName
);

89354  
	gSQLITE_ERROR
;

89356  
	gSQLITE_OK
;

89362 
SQLITE_PRIVATE
 
Index
 *
sql™e3Prim¬yKeyIndex
(
TabË
 *
pTab
){

89363 
Index
 *
	gp
;

89364 
	gp
=
pTab
->
pIndex
;… && !
IsPrim¬yKeyIndex
(
p
);…õ->
pNext
){}

89365  
p
;

89372 
SQLITE_PRIVATE
 
i16
 
sql™e3CÞumnOfIndex
(
Index
 *
pIdx
, i16 
iCÞ
){

89373 
	gi
;

89374 
	gi
=0; i<
	gpIdx
->
	gnCÞumn
; i++){

89375 ifÐ
	giCÞ
==
pIdx
->
aiCÞumn
[
i
] )  i;

89396 
SQLITE_PRIVATE
 
sql™e3S¹TabË
(

89397 
P¬£
 *
pP¬£
,

89398 
Tok’
 *
pName1
,

89399 
Tok’
 *
pName2
,

89400 
isTemp
,

89401 
isV›w
,

89402 
isVœtu®
,

89403 
noE¼


89405 
TabË
 *
	gpTabË
;

89406 *
	gzName
 = 0;

89407 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89408 
Vdbe
 *
	gv
;

89409 
	giDb
;

89410 
Tok’
 *
	gpName
;

89429 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pName
);

89430 ifÐ
	giDb
<0 ) ;

89431 ifÐ!
	gOMIT_TEMPDB
 && 
	gisTemp
 && 
	gpName2
->
	gn
>0 && 
	giDb
!=1 ){

89434 
sql™e3E¼ÜMsg
(
pP¬£
, "temporaryable‚ame must be unqualified");

89437 ifÐ!
	gOMIT_TEMPDB
 && 
	gisTemp
 ) 
	giDb
 = 1;

89439 
	gpP¬£
->
	gsNameTok’
 = *
pName
;

89440 
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

89441 ifÐ
	gzName
==0 ) ;

89442 ifÐ
	gSQLITE_OK
!=
sql™e3CheckObjeùName
(
pP¬£
, 
zName
) ){

89443 
	gbegš_bË_”rÜ
;

89445 ifÐ
	gdb
->
	gš™
.
	giDb
==1 ) 
isTemp
 = 1;

89446 #iâdeà
SQLITE_OMIT_AUTHORIZATION


89447 
as£¹
Ð(
isTemp
 & 1)==isTemp );

89449 
	gcode
;

89450 *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

89451 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_INSERT
, 
SCHEMA_TABLE
(
isTemp
), 0, 
zDb
) ){

89452 
	gbegš_bË_”rÜ
;

89454 ifÐ
	gisV›w
 ){

89455 ifÐ!
	gOMIT_TEMPDB
 && 
	gisTemp
 ){

89456 
	gcode
 = 
SQLITE_CREATE_TEMP_VIEW
;

89458 
	gcode
 = 
SQLITE_CREATE_VIEW
;

89461 ifÐ!
	gOMIT_TEMPDB
 && 
	gisTemp
 ){

89462 
	gcode
 = 
SQLITE_CREATE_TEMP_TABLE
;

89464 
	gcode
 = 
SQLITE_CREATE_TABLE
;

89467 ifÐ!
	gisVœtu®
 && 
sql™e3AuthCheck
(
pP¬£
, 
code
, 
zName
, 0, 
zDb
) ){

89468 
	gbegš_bË_”rÜ
;

89480 ifÐ!
	gIN_DECLARE_VTAB
 ){

89481 *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

89482 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

89483 
begš_bË_”rÜ
;

89485 
	gpTabË
 = 
sql™e3FšdTabË
(
db
, 
zName
, 
zDb
);

89486 ifÐ
	gpTabË
 ){

89487 ifÐ!
	gnoE¼
 ){

89488 
sql™e3E¼ÜMsg
(
pP¬£
, "bË %T‡Ì—dyƒxi¡s", 
pName
);

89490 
as£¹
Ð!
db
->
š™
.
busy
 );

89491 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

89493 
	gbegš_bË_”rÜ
;

89495 ifÐ
sql™e3FšdIndex
(
db
, 
zName
, 
zDb
)!=0 ){

89496 
sql™e3E¼ÜMsg
(
pP¬£
, "th”i ®»ady‡Àšdex‚amed %s", 
zName
);

89497 
	gbegš_bË_”rÜ
;

89501 
	gpTabË
 = 
sql™e3DbM®locZ”o
(
db
, (
TabË
));

89502 ifÐ
	gpTabË
==0 ){

89503 
db
->
m®locFažed
 = 1;

89504 
	gpP¬£
->
	grc
 = 
SQLITE_NOMEM
;

89505 
	gpP¬£
->
	gnE¼
++;

89506 
	gbegš_bË_”rÜ
;

89508 
	gpTabË
->
	gzName
 = 
zName
;

89509 
	gpTabË
->
	giPKey
 = -1;

89510 
	gpTabË
->
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

89511 
	gpTabË
->
	gnRef
 = 1;

89512 
	gpTabË
->
	gnRowLogE¡
 = 200; 
as£¹
Ð200==
sql™e3LogE¡
(1048576) );

89513 
as£¹
Ð
pP¬£
->
pNewTabË
==0 );

89514 
	gpP¬£
->
	gpNewTabË
 = 
pTabË
;

89520 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


89521 ifÐ!
	gpP¬£
->
	gÃ¡ed
 && 
¡rcmp
(
zName
, "sqlite_sequence")==0 ){

89522 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

89523 
	gpTabË
->
	gpSchema
->
	gpSeqTab
 = 
pTabË
;

89535 ifÐ!
	gdb
->
	gš™
.
	gbusy
 && (
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
))!=0 ){

89536 
j1
;

89537 
	gfžeFÜm©
;

89538 
	g»g1
, 
	g»g2
, 
	g»g3
;

89539 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

89541 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


89542 ifÐ
	gisVœtu®
 ){

89543 
sql™e3VdbeAddOp0
(
v
, 
OP_VBegš
);

89550 
	g»g1
 = 
pP¬£
->
»gRowid
 = ++pP¬£->
nMem
;

89551 
	g»g2
 = 
pP¬£
->
»gRoÙ
 = ++pP¬£->
nMem
;

89552 
	g»g3
 = ++
pP¬£
->
nMem
;

89553 
sql™e3VdbeAddOp3
(
v
, 
OP_R—dCook›
, 
iDb
, 
»g3
, 
BTREE_FILE_FORMAT
);

89554 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

89555 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_If
, 
»g3
); 
VdbeCov”age
(v);

89556 
	gfžeFÜm©
 = (
db
->
æags
 & 
SQLITE_LegacyFžeFmt
)!=0 ?

89557 1 : 
SQLITE_MAX_FILE_FORMAT
;

89558 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
fžeFÜm©
, 
»g3
);

89559 
sql™e3VdbeAddOp3
(
v
, 
OP_S‘Cook›
, 
iDb
, 
BTREE_FILE_FORMAT
, 
»g3
);

89560 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
ENC
(
db
), 
»g3
);

89561 
sql™e3VdbeAddOp3
(
v
, 
OP_S‘Cook›
, 
iDb
, 
BTREE_TEXT_ENCODING
, 
»g3
);

89562 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

89573 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_VIRTUALTABLE
)

89574 ifÐ
	gisV›w
 || 
	gisVœtu®
 ){

89575 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»g2
);

89579 
	gpP¬£
->
	gaddrCrTab
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_C»©eTabË
, 
iDb
, 
»g2
);

89581 
sql™e3O³nMa¡”TabË
(
pP¬£
, 
iDb
);

89582 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 0, 
»g1
);

89583 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»g3
);

89584 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 0, 
»g3
, 
»g1
);

89585 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

89586 
sql™e3VdbeAddOp0
(
v
, 
OP_Clo£
);

89593 
	gbegš_bË_”rÜ
:

89594 
sql™e3DbF»e
(
db
, 
zName
);

89606 
	#STRICMP
(
x
, 
y
) (\

89607 
sql™e3Uµ”ToLow”
[*(*)(
x
)]== \

89608 
sql™e3Uµ”ToLow”
[*(*)(
y
)] \

89609 && 
	`sql™e3SŒICmp
((
x
)+1,(
y
)+1)==0 )

	)

89619 
SQLITE_PRIVATE
 
sql™e3AddCÞumn
(
P¬£
 *
pP¬£
, 
Tok’
 *
pName
){

89620 
TabË
 *
	gp
;

89621 
	gi
;

89622 *
	gz
;

89623 
CÞumn
 *
	gpCÞ
;

89624 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89625 ifÐ(
	gp
 = 
pP¬£
->
pNewTabË
)==0 ) ;

89626 #ià
SQLITE_MAX_COLUMN


89627 ifÐ
	gp
->
	gnCÞ
+1>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_COLUMN
] ){

89628 
sql™e3E¼ÜMsg
(
pP¬£
, "toØmªy cÞumn Ú %s", 
p
->
zName
);

89632 
	gz
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

89633 ifÐ
	gz
==0 ) ;

89634 
	gi
=0; i<
	gp
->
	gnCÞ
; i++){

89635 ifÐ
STRICMP
(
z
, 
p
->
aCÞ
[
i
].
zName
) ){

89636 
sql™e3E¼ÜMsg
(
pP¬£
, "du¶iÿ‹ cÞumÀÇme: %s", 
z
);

89637 
sql™e3DbF»e
(
db
, 
z
);

89641 ifÐ(
	gp
->
	gnCÞ
 & 0x7)==0 ){

89642 
CÞumn
 *
aNew
;

89643 
	gaNew
 = 
sql™e3DbR—Îoc
(
db
,
p
->
aCÞ
,Õ->
nCÞ
+8)*(p->aCol[0]));

89644 ifÐ
	gaNew
==0 ){

89645 
sql™e3DbF»e
(
db
, 
z
);

89648 
	gp
->
	gaCÞ
 = 
aNew
;

89650 
	gpCÞ
 = &
p
->
aCÞ
[p->
nCÞ
];

89651 
mem£t
(
pCÞ
, 0, (
p
->
aCÞ
[0]));

89652 
	gpCÞ
->
	gzName
 = 
z
;

89658 
	gpCÞ
->
	gaffš™y
 = 
SQLITE_AFF_NONE
;

89659 
	gpCÞ
->
	gszE¡
 = 1;

89660 
	gp
->
	gnCÞ
++;

89669 
SQLITE_PRIVATE
 
sql™e3AddNÙNuÎ
(
P¬£
 *
pP¬£
, 
ÚE¼Ü
){

89670 
TabË
 *
	gp
;

89671 
	gp
 = 
pP¬£
->
pNewTabË
;

89672 ifÐ
	gp
==0 || 
NEVER
(
p
->
nCÞ
<1) ) ;

89673 
	gp
->
	gaCÞ
[
p
->
nCÞ
-1].
	gnÙNuÎ
 = (
u8
)
ÚE¼Ü
;

89701 
SQLITE_PRIVATE
 
sql™e3Affš™yTy³
(cÚ¡ *
zIn
, 
u8
 *
pszE¡
){

89702 
u32
 
	gh
 = 0;

89703 
	gaff
 = 
SQLITE_AFF_NUMERIC
;

89704 cÚ¡ *
	gzCh¬
 = 0;

89706 ifÐ
	gzIn
==0 )  
aff
;

89707  
	gzIn
[0] ){

89708 
	gh
 = (
h
<<8è+ 
sql™e3Uµ”ToLow”
[(*
zIn
)&0xff];

89709 
	gzIn
++;

89710 ifÐ
	gh
==(('c'<<24)+('h'<<16)+('a'<<8)+'r') ){

89711 
aff
 = 
SQLITE_AFF_TEXT
;

89712 
	gzCh¬
 = 
zIn
;

89713 }ifÐ
	gh
==(('c'<<24)+('l'<<16)+('o'<<8)+'b') ){

89714 
aff
 = 
SQLITE_AFF_TEXT
;

89715 }ifÐ
	gh
==(('t'<<24)+('e'<<16)+('x'<<8)+'t') ){

89716 
aff
 = 
SQLITE_AFF_TEXT
;

89717 }ifÐ
	gh
==(('b'<<24)+('l'<<16)+('o'<<8)+'b')

89718 && (
aff
==
SQLITE_AFF_NUMERIC
 ||‡ff==
SQLITE_AFF_REAL
) ){

89719 
aff
 = 
SQLITE_AFF_NONE
;

89720 ifÐ
	gzIn
[0]=='(' ) 
zCh¬
 = 
zIn
;

89721 #iâdeà
SQLITE_OMIT_FLOATING_POINT


89722 }ifÐ
	gh
==(('r'<<24)+('e'<<16)+('a'<<8)+'l')

89723 && 
aff
==
SQLITE_AFF_NUMERIC
 ){

89724 
aff
 = 
SQLITE_AFF_REAL
;

89725 }ifÐ
	gh
==(('f'<<24)+('l'<<16)+('o'<<8)+'a')

89726 && 
aff
==
SQLITE_AFF_NUMERIC
 ){

89727 
aff
 = 
SQLITE_AFF_REAL
;

89728 }ifÐ
	gh
==(('d'<<24)+('o'<<16)+('u'<<8)+'b')

89729 && 
aff
==
SQLITE_AFF_NUMERIC
 ){

89730 
aff
 = 
SQLITE_AFF_REAL
;

89732 }ifÐ(
	gh
&0x00FFFFFF)==(('i'<<16)+('n'<<8)+'t') ){

89733 
aff
 = 
SQLITE_AFF_INTEGER
;

89740 ifÐ
	gpszE¡
 ){

89741 *
	gpszE¡
 = 1;

89742 ifÐ
	gaff
<
	gSQLITE_AFF_NUMERIC
 ){

89743 ifÐ
	gzCh¬
 ){

89744  
	gzCh¬
[0] ){

89745 ifÐ
sql™e3Isdig™
(
zCh¬
[0]) ){

89746 
	gv
 = 0;

89747 
sql™e3G‘IÁ32
(
zCh¬
, &
v
);

89748 
	gv
 = 
v
/4 + 1;

89749 ifÐ
	gv
>255 ) v = 255;

89750 *
	gpszE¡
 = 
v
;

89753 
	gzCh¬
++;

89756 *
	gpszE¡
 = 5;

89760  
	gaff
;

89772 
SQLITE_PRIVATE
 
sql™e3AddCÞumnTy³
(
P¬£
 *
pP¬£
, 
Tok’
 *
pTy³
){

89773 
TabË
 *
	gp
;

89774 
CÞumn
 *
	gpCÞ
;

89776 
	gp
 = 
pP¬£
->
pNewTabË
;

89777 ifÐ
	gp
==0 || 
NEVER
(
p
->
nCÞ
<1) ) ;

89778 
	gpCÞ
 = &
p
->
aCÞ
[p->
nCÞ
-1];

89779 
as£¹
Ð
pCÞ
->
zTy³
==0 );

89780 
	gpCÞ
->
	gzTy³
 = 
sql™e3NameFromTok’
(
pP¬£
->
db
, 
pTy³
);

89781 
	gpCÞ
->
	gaffš™y
 = 
sql™e3Affš™yTy³
(
pCÞ
->
zTy³
, &pCÞ->
szE¡
);

89794 
SQLITE_PRIVATE
 
sql™e3AddDeçuÉV®ue
(
P¬£
 *
pP¬£
, 
Ex´S·n
 *
pS·n
){

89795 
TabË
 *
	gp
;

89796 
CÞumn
 *
	gpCÞ
;

89797 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89798 
	gp
 = 
pP¬£
->
pNewTabË
;

89799 ifÐ
	gp
!=0 ){

89800 
pCÞ
 = &(
p
->
aCÞ
[p->
nCÞ
-1]);

89801 ifÐ!
sql™e3Ex´IsCÚ¡ªtOrFunùiÚ
(
pS·n
->
pEx´
, 
db
->
š™
.
busy
) ){

89802 
sql™e3E¼ÜMsg
(
pP¬£
, "default value of column [%s] is‚ot constant",

89803 
pCÞ
->
zName
);

89809 
sql™e3Ex´D–‘e
(
db
, 
pCÞ
->
pDæt
);

89810 
	gpCÞ
->
	gpDæt
 = 
sql™e3Ex´Dup
(
db
, 
pS·n
->
pEx´
, 
EXPRDUP_REDUCE
);

89811 
sql™e3DbF»e
(
db
, 
pCÞ
->
zDæt
);

89812 
	gpCÞ
->
	gzDæt
 = 
sql™e3DbSŒNDup
(
db
, (*)
pS·n
->
zS¹
,

89813 ()(
pS·n
->
zEnd
 -…S·n->
zS¹
));

89816 
sql™e3Ex´D–‘e
(
db
, 
pS·n
->
pEx´
);

89837 
SQLITE_PRIVATE
 
sql™e3AddPrim¬yKey
(

89838 
P¬£
 *
pP¬£
,

89839 
Ex´Li¡
 *
pLi¡
,

89840 
ÚE¼Ü
,

89841 
autoInc
,

89842 
sÜtOrd”


89844 
TabË
 *
	gpTab
 = 
pP¬£
->
pNewTabË
;

89845 *
	gzTy³
 = 0;

89846 
	giCÞ
 = -1, 
	gi
;

89847 
	gnT”m
;

89848 ifÐ
	gpTab
==0 || 
IN_DECLARE_VTAB
 ) 
´im¬y_key_ex™
;

89849 ifÐ
	gpTab
->
	gbFÏgs
 & 
	gTF_HasPrim¬yKey
 ){

89850 
sql™e3E¼ÜMsg
(
pP¬£
,

89851 "bË \"%s\" ha mÜthª oÃ…rim¬y key", 
pTab
->
zName
);

89852 
	g´im¬y_key_ex™
;

89854 
	gpTab
->
	gbFÏgs
 |ð
TF_HasPrim¬yKey
;

89855 ifÐ
	gpLi¡
==0 ){

89856 
iCÞ
 = 
pTab
->
nCÞ
 - 1;

89857 
	gpTab
->
	gaCÞ
[
iCÞ
].
	gcÞFÏgs
 |ð
COLFLAG_PRIMKEY
;

89858 
	gzTy³
 = 
pTab
->
aCÞ
[
iCÞ
].
zTy³
;

89859 
	gnT”m
 = 1;

89861 
	gnT”m
 = 
pLi¡
->
nEx´
;

89862 
	gi
=0; i<
	gnT”m
; i++){

89863 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞ
; iCol++){

89864 ifÐ
sql™e3SŒICmp
(
pLi¡
->
a
[
i
].
zName
, 
pTab
->
aCÞ
[
iCÞ
].zName)==0 ){

89865 
pTab
->
aCÞ
[
iCÞ
].
cÞFÏgs
 |ð
COLFLAG_PRIMKEY
;

89866 
	gzTy³
 = 
pTab
->
aCÞ
[
iCÞ
].
zTy³
;

89872 ifÐ
	gnT”m
==1

89873 && 
zTy³
 && 
sql™e3SŒICmp
(zType, "INTEGER")==0

89874 && 
sÜtOrd”
==
SQLITE_SO_ASC


89876 
pTab
->
iPKey
 = 
iCÞ
;

89877 
	gpTab
->
	gkeyCÚf
 = (
u8
)
ÚE¼Ü
;

89878 
as£¹
Ð
autoInc
==0 ||‡utoInc==1 );

89879 
	gpTab
->
	gbFÏgs
 |ð
autoInc
*
TF_Autošüem’t
;

89880 ifÐ
	gpLi¡
 ) 
	gpP¬£
->
	giPkSÜtOrd”
 = 
pLi¡
->
a
[0].
sÜtOrd”
;

89881 }ifÐ
	gautoInc
 ){

89882 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


89883 
sql™e3E¼ÜMsg
(
pP¬£
, "AUTOINCREMENT is only‡llowed on‡n "

89887 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

89888 
Index
 *
	gp
;

89889 ifÐ
	gv
 ) 
	gpP¬£
->
	gaddrSkPK
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_NoÝ
);

89890 
	gp
 = 
sql™e3C»©eIndex
(
pP¬£
, 0, 0, 0, 
pLi¡
, 
ÚE¼Ü
, 0,

89891 0, 
sÜtOrd”
, 0);

89892 ifÐ
	gp
 ){

89893 
	gp
->
	gidxTy³
 = 
SQLITE_IDXTYPE_PRIMARYKEY
;

89894 ifÐ
	gv
 ) 
sql™e3VdbeJumpH”e
(
v
, 
pP¬£
->
addrSkPK
);

89896 
	gpLi¡
 = 0;

89899 
	g´im¬y_key_ex™
:

89900 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
pLi¡
);

89907 
SQLITE_PRIVATE
 
sql™e3AddCheckCÚ¡¿št
(

89908 
P¬£
 *
pP¬£
,

89909 
Ex´
 *
pCheckEx´


89911 #iâdeà
SQLITE_OMIT_CHECK


89912 
TabË
 *
	gpTab
 = 
pP¬£
->
pNewTabË
;

89913 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89914 ifÐ
	gpTab
 && !
	gIN_DECLARE_VTAB


89915 && !
sql™e3BŒ“IsR—dÚly
(
db
->
aDb
[db->
š™
.
iDb
].
pBt
)

89917 
	gpTab
->
	gpCheck
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pTab
->
pCheck
, 
pCheckEx´
);

89918 ifÐ
	gpP¬£
->
	gcÚ¡¿štName
.
	gn
 ){

89919 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
pTab
->
pCheck
, &pP¬£->
cÚ¡¿štName
, 1);

89924 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
pCheckEx´
);

89932 
SQLITE_PRIVATE
 
sql™e3AddCÞÏ‹Ty³
(
P¬£
 *
pP¬£
, 
Tok’
 *
pTok’
){

89933 
TabË
 *
	gp
;

89934 
	gi
;

89935 *
	gzCÞl
;

89936 
sql™e3
 *
	gdb
;

89938 ifÐ(
	gp
 = 
pP¬£
->
pNewTabË
)==0 ) ;

89939 
	gi
 = 
p
->
nCÞ
-1;

89940 
	gdb
 = 
pP¬£
->
db
;

89941 
	gzCÞl
 = 
sql™e3NameFromTok’
(
db
, 
pTok’
);

89942 ifÐ!
	gzCÞl
 ) ;

89944 ifÐ
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
zCÞl
) ){

89945 
Index
 *
	gpIdx
;

89946 
sql™e3DbF»e
(
db
, 
p
->
aCÞ
[
i
].
zCÞl
);

89947 
	gp
->
	gaCÞ
[
i
].
	gzCÞl
 = 
zCÞl
;

89953 
	gpIdx
=
p
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

89954 
as£¹
Ð
pIdx
->
nKeyCÞ
==1 );

89955 ifÐ
	gpIdx
->
	gaiCÞumn
[0]==
i
 ){

89956 
pIdx
->
azCÞl
[0] = 
p
->
aCÞ
[
i
].
zCÞl
;

89960 
sql™e3DbF»e
(
db
, 
zCÞl
);

89984 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3Loÿ‹CÞlSeq
(
P¬£
 *
pP¬£
, cÚ¡ *
zName
){

89985 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

89986 
u8
 
	g’c
 = 
ENC
(
db
);

89987 
u8
 
	gš™busy
 = 
db
->
š™
.
busy
;

89988 
CÞlSeq
 *
	gpCÞl
;

89990 
	gpCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, 
’c
, 
zName
, 
š™busy
);

89991 ifÐ!
	gš™busy
 && (!
	gpCÞl
 || !pCÞl->
	gxCmp
) ){

89992 
	gpCÞl
 = 
sql™e3G‘CÞlSeq
(
pP¬£
, 
’c
, 
pCÞl
, 
zName
);

89995  
	gpCÞl
;

90015 
SQLITE_PRIVATE
 
sql™e3ChªgeCook›
(
P¬£
 *
pP¬£
, 
iDb
){

90016 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

90017 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90018 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

90019 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

90020 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
db
->
aDb
[
iDb
].
pSchema
->
schema_cook›
+1, 
r1
);

90021 
sql™e3VdbeAddOp3
(
v
, 
OP_S‘Cook›
, 
iDb
, 
BTREE_SCHEMA_VERSION
, 
r1
);

90022 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

90033 
id’tL’gth
(cÚ¡ *
z
){

90034 
	gn
;

90035 
	gn
=0; *
	gz
;‚++, z++){

90036 ifÐ*
	gz
=='"' ){ 
n
++; }

90038  
	gn
 + 2;

90054 
id’tPut
(*
z
, *
pIdx
, *
zSigÃdId’t
){

90055 *
	gzId’t
 = (*)
zSigÃdId’t
;

90056 
	gi
, 
	gj
, 
	gÃedQuÙe
;

90057 
	gi
 = *
pIdx
;

90059 
	gj
=0; 
	gzId’t
[
j
]; j++){

90060 ifÐ!
sql™e3I§Êum
(
zId’t
[
j
]è&& 
	gzId’t
[j]!='_' ) ;

90062 
	gÃedQuÙe
 = 
sql™e3Isdig™
(
zId’t
[0])

90063 || 
sql™e3KeywÜdCode
(
zId’t
, 
j
)!=
TK_ID


90064 || 
zId’t
[
j
]!=0

90065 || 
j
==0;

90067 ifÐ
	gÃedQuÙe
 ) 
	gz
[
i
++] = '"';

90068 
	gj
=0; 
	gzId’t
[
j
]; j++){

90069 
	gz
[
i
++] = 
zId’t
[
j
];

90070 ifÐ
	gzId’t
[
j
]=='"' ) 
z
[
i
++] = '"';

90072 ifÐ
	gÃedQuÙe
 ) 
	gz
[
i
++] = '"';

90073 
	gz
[
i
] = 0;

90074 *
	gpIdx
 = 
i
;

90082 *
ü—‹TabËStmt
(
sql™e3
 *
db
, 
TabË
 *
p
){

90083 
	gi
, 
	gk
, 
	gn
;

90084 *
	gzStmt
;

90085 *
	gzS•
, *
	gzS•2
, *
	gzEnd
;

90086 
CÞumn
 *
	gpCÞ
;

90087 
	gn
 = 0;

90088 
	gpCÞ
 = 
p
->
aCÞ
, 
	gi
=0; i<
	gp
->
	gnCÞ
; i++,…Col++){

90089 
	gn
 +ð
id’tL’gth
(
pCÞ
->
zName
) + 5;

90091 
	gn
 +ð
id’tL’gth
(
p
->
zName
);

90092 ifÐ
	gn
<50 ){

90093 
	gzS•
 = "";

90094 
	gzS•2
 = ",";

90095 
	gzEnd
 = ")";

90097 
	gzS•
 = "\n ";

90098 
	gzS•2
 = ",\n ";

90099 
	gzEnd
 = "\n)";

90101 
	gn
 +ð35 + 6*
p
->
nCÞ
;

90102 
	gzStmt
 = 
sql™e3DbM®locRaw
(0, 
n
);

90103 ifÐ
	gzStmt
==0 ){

90104 
db
->
m®locFažed
 = 1;

90107 
sql™e3_¢´štf
(
n
, 
zStmt
, "CREATE TABLE ");

90108 
	gk
 = 
sql™e3SŒËn30
(
zStmt
);

90109 
id’tPut
(
zStmt
, &
k
, 
p
->
zName
);

90110 
	gzStmt
[
k
++] = '(';

90111 
	gpCÞ
=
p
->
aCÞ
, 
	gi
=0; i<
	gp
->
	gnCÞ
; i++,…Col++){

90112 cÚ¡ * cÚ¡ 
	gazTy³
[] = {

90119 
	gËn
;

90120 cÚ¡ *
	gzTy³
;

90122 
sql™e3_¢´štf
(
n
-
k
, &
zStmt
[k], 
zS•
);

90123 
	gk
 +ð
sql™e3SŒËn30
(&
zStmt
[
k
]);

90124 
	gzS•
 = 
zS•2
;

90125 
id’tPut
(
zStmt
, &
k
, 
pCÞ
->
zName
);

90126 
as£¹
Ð
pCÞ
->
affš™y
-
SQLITE_AFF_NONE
 >= 0 );

90127 
as£¹
Ð
pCÞ
->
affš™y
-
SQLITE_AFF_NONE
 < 
A¼aySize
(
azTy³
) );

90128 
‹¡ÿ£
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_NONE
 );

90129 
‹¡ÿ£
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_TEXT
 );

90130 
‹¡ÿ£
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_NUMERIC
 );

90131 
‹¡ÿ£
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_INTEGER
 );

90132 
‹¡ÿ£
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_REAL
 );

90134 
	gzTy³
 = 
azTy³
[
pCÞ
->
affš™y
 - 
SQLITE_AFF_NONE
];

90135 
	gËn
 = 
sql™e3SŒËn30
(
zTy³
);

90136 
as£¹
Ð
pCÞ
->
affš™y
==
SQLITE_AFF_NONE


90137 || 
pCÞ
->
affš™y
==
sql™e3Affš™yTy³
(
zTy³
, 0) );

90138 
memýy
(&
zStmt
[
k
], 
zTy³
, 
Ën
);

90139 
	gk
 +ð
Ën
;

90140 
as£¹
Ð
k
<=
n
 );

90142 
sql™e3_¢´štf
(
n
-
k
, &
zStmt
[k], "%s", 
zEnd
);

90143  
	gzStmt
;

90150 
»sizeIndexObjeù
(
sql™e3
 *
db
, 
Index
 *
pIdx
, 
N
){

90151 *
	gzExŒa
;

90152 
	gnBy‹
;

90153 ifÐ
	gpIdx
->
	gnCÞumn
>=
N
 )  
SQLITE_OK
;

90154 
as£¹
Ð
pIdx
->
isResized
==0 );

90155 
	gnBy‹
 = ((*è+ (
i16
è+ 1)*
N
;

90156 
	gzExŒa
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
);

90157 ifÐ
	gzExŒa
==0 )  
SQLITE_NOMEM
;

90158 
memýy
(
zExŒa
, 
pIdx
->
azCÞl
, (*)*pIdx->
nCÞumn
);

90159 
	gpIdx
->
	gazCÞl
 = (**)
zExŒa
;

90160 
	gzExŒa
 +ð(*)*
N
;

90161 
memýy
(
zExŒa
, 
pIdx
->
aiCÞumn
, (
i16
)*pIdx->
nCÞumn
);

90162 
	gpIdx
->
	gaiCÞumn
 = (
i16
*)
zExŒa
;

90163 
	gzExŒa
 +ð(
i16
)*
N
;

90164 
memýy
(
zExŒa
, 
pIdx
->
aSÜtOrd”
,…Idx->
nCÞumn
);

90165 
	gpIdx
->
	gaSÜtOrd”
 = (
u8
*)
zExŒa
;

90166 
	gpIdx
->
	gnCÞumn
 = 
N
;

90167 
	gpIdx
->
	gisResized
 = 1;

90168  
	gSQLITE_OK
;

90174 
e¡im©eTabËWidth
(
TabË
 *
pTab
){

90175 
	gwTabË
 = 0;

90176 cÚ¡ 
CÞumn
 *
	gpTabCÞ
;

90177 
	gi
;

90178 
	gi
=
pTab
->
nCÞ
, 
	gpTabCÞ
õTab->
aCÞ
; i>0; i--,…TabCol++){

90179 
	gwTabË
 +ð
pTabCÞ
->
szE¡
;

90181 ifÐ
	gpTab
->
	giPKey
<0 ) 
	gwTabË
++;

90182 
	gpTab
->
	gszTabRow
 = 
sql™e3LogE¡
(
wTabË
*4);

90188 
e¡im©eIndexWidth
(
Index
 *
pIdx
){

90189 
	gwIndex
 = 0;

90190 
	gi
;

90191 cÚ¡ 
CÞumn
 *
	gaCÞ
 = 
pIdx
->
pTabË
->
aCÞ
;

90192 
	gi
=0; i<
	gpIdx
->
	gnCÞumn
; i++){

90193 
i16
 
	gx
 = 
pIdx
->
aiCÞumn
[
i
];

90194 
as£¹
Ð
x
<
pIdx
->
pTabË
->
nCÞ
 );

90195 
	gwIndex
 +ð
x
<0 ? 1 : 
aCÞ
[
pIdx
->
aiCÞumn
[
i
]].
szE¡
;

90197 
	gpIdx
->
	gszIdxRow
 = 
sql™e3LogE¡
(
wIndex
*4);

90202 
hasCÞumn
(cÚ¡ 
i16
 *
aiCÞ
, 
nCÞ
, 
x
){

90203  
	gnCÞ
-- > 0 ) ifÐ
	gx
==*(
aiCÞ
++) )  1;

90230 
cÚv”tToW™houtRowidTabË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

90231 
Index
 *
	gpIdx
;

90232 
Index
 *
	gpPk
;

90233 
	gnPk
;

90234 
	gi
, 
	gj
;

90235 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90236 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

90242 ifÐ
	gpP¬£
->
	gaddrCrTab
 ){

90243 
as£¹
Ð
v
 );

90244 
sql™e3VdbeG‘Op
(
v
, 
pP¬£
->
addrCrTab
)->
	gÝcode
 = 
OP_C»©eIndex
;

90250 ifÐ
	gpP¬£
->
	gaddrSkPK
 ){

90251 
as£¹
Ð
v
 );

90252 
sql™e3VdbeG‘Op
(
v
, 
pP¬£
->
addrSkPK
)->
	gÝcode
 = 
OP_GÙo
;

90258 ifÐ
	gpTab
->
	giPKey
>=0 ){

90259 
Ex´Li¡
 *
pLi¡
;

90260 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 0);

90261 ifÐ
	gpLi¡
==0 ) ;

90262 
	gpLi¡
->
	ga
[0].
	gzName
 = 
sql™e3DbSŒDup
(
pP¬£
->
db
,

90263 
pTab
->
aCÞ
[pTab->
iPKey
].
zName
);

90264 
	gpLi¡
->
	ga
[0].
	gsÜtOrd”
 = 
pP¬£
->
iPkSÜtOrd”
;

90265 
as£¹
Ð
pP¬£
->
pNewTabË
==
pTab
 );

90266 
	gpPk
 = 
sql™e3C»©eIndex
(
pP¬£
, 0, 0, 0, 
pLi¡
, 
pTab
->
keyCÚf
, 0, 0, 0, 0);

90267 ifÐ
	gpPk
==0 ) ;

90268 
	gpPk
->
	gidxTy³
 = 
SQLITE_IDXTYPE_PRIMARYKEY
;

90269 
	gpTab
->
	giPKey
 = -1;

90271 
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

90273 
	gpPk
->
	gisCov”šg
 = 1;

90274 
as£¹
Ð
pPk
!=0 );

90275 
	gnPk
 = 
pPk
->
nKeyCÞ
;

90278 
	gi
=0; i<
	gnPk
; i++){

90279 
	gpTab
->
	gaCÞ
[
pPk
->
aiCÞumn
[
i
]].
	gnÙNuÎ
 = 1;

90281 
	gpPk
->
	guniqNÙNuÎ
 = 1;

90284 
	gpPk
->
	gŠum
 = 
pTab
->
Šum
;

90289 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

90290 
n
;

90291 ifÐ
IsPrim¬yKeyIndex
(
pIdx
) ) ;

90292 
	gi
=
n
=0; i<
	gnPk
; i++){

90293 ifÐ!
hasCÞumn
(
pIdx
->
aiCÞumn
,…Idx->
nKeyCÞ
, 
pPk
->aiCÞumn[
i
]èè
	gn
++;

90295 ifÐ
	gn
==0 ){

90297 
pIdx
->
nCÞumn
 =…Idx->
nKeyCÞ
;

90300 ifÐ
»sizeIndexObjeù
(
db
, 
pIdx
,…Idx->
nKeyCÞ
+
n
) ) ;

90301 
	gi
=0, 
	gj
=
pIdx
->
nKeyCÞ
; i<
	gnPk
; i++){

90302 ifÐ!
hasCÞumn
(
pIdx
->
aiCÞumn
,…Idx->
nKeyCÞ
, 
pPk
->aiCÞumn[
i
]) ){

90303 
	gpIdx
->
	gaiCÞumn
[
j
] = 
pPk
->
aiCÞumn
[
i
];

90304 
	gpIdx
->
	gazCÞl
[
j
] = 
pPk
->
azCÞl
[
i
];

90305 
	gj
++;

90308 
as£¹
Ð
pIdx
->
nCÞumn
>õIdx->
nKeyCÞ
+
n
 );

90309 
as£¹
Ð
pIdx
->
nCÞumn
>=
j
 );

90314 ifÐ
	gnPk
<
	gpTab
->
	gnCÞ
 ){

90315 ifÐ
»sizeIndexObjeù
(
db
, 
pPk
, 
pTab
->
nCÞ
) ) ;

90316 
	gi
=0, 
	gj
=
nPk
; i<
	gpTab
->
	gnCÞ
; i++){

90317 ifÐ!
hasCÞumn
(
pPk
->
aiCÞumn
, 
j
, 
i
) ){

90318 
as£¹
Ð
j
<
pPk
->
nCÞumn
 );

90319 
	gpPk
->
	gaiCÞumn
[
j
] = 
i
;

90320 
	gpPk
->
	gazCÞl
[
j
] = "BINARY";

90321 
	gj
++;

90324 
as£¹
Ð
pPk
->
nCÞumn
==
j
 );

90325 
as£¹
Ð
pTab
->
nCÞ
==
j
 );

90327 
	gpPk
->
	gnCÞumn
 = 
pTab
->
nCÞ
;

90351 
SQLITE_PRIVATE
 
sql™e3EndTabË
(

90352 
P¬£
 *
pP¬£
,

90353 
Tok’
 *
pCÚs
,

90354 
Tok’
 *
pEnd
,

90355 
u8
 
bO±s
,

90356 
S–eù
 *
pS–eù


90358 
TabË
 *
	gp
;

90359 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90360 
	giDb
;

90361 
Index
 *
	gpIdx
;

90363 ifÐ(
	gpEnd
==0 && 
pS–eù
==0è|| 
db
->
m®locFažed
 ){

90366 
	gp
 = 
pP¬£
->
pNewTabË
;

90367 ifÐ
	gp
==0 ) ;

90369 
as£¹
Ð!
db
->
š™
.
busy
 || !
pS–eù
 );

90377 ifÐ
	gdb
->
	gš™
.
	gbusy
 ){

90378 
	gp
->
	gŠum
 = 
db
->
š™
.
ÃwTnum
;

90382 ifÐ
	gbO±s
 & 
	gTF_W™houtRowid
 ){

90383 ifÐ(
	gp
->
	gbFÏgs
 & 
	gTF_Autošüem’t
) ){

90384 
sql™e3E¼ÜMsg
(
pP¬£
,

90388 ifÐ(
	gp
->
	gbFÏgs
 & 
	gTF_HasPrim¬yKey
)==0 ){

90389 
sql™e3E¼ÜMsg
(
pP¬£
, "PRIMARY KEY missšg oÀbË %s", 
p
->
zName
);

90391 
	gp
->
	gbFÏgs
 |ð
TF_W™houtRowid
;

90392 
cÚv”tToW™houtRowidTabË
(
pP¬£
, 
p
);

90396 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
p
->
pSchema
);

90398 #iâdeà
SQLITE_OMIT_CHECK


90401 ifÐ
	gp
->
	gpCheck
 ){

90402 
sql™e3ResÞveS–fReã»nû
(
pP¬£
, 
p
, 
NC_IsCheck
, 0,…->
pCheck
);

90407 
e¡im©eTabËWidth
(
p
);

90408 
	gpIdx
=
p
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

90409 
e¡im©eIndexWidth
(
pIdx
);

90418 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

90419 
	gn
;

90420 
Vdbe
 *
	gv
;

90421 *
	gzTy³
;

90422 *
	gzTy³2
;

90423 *
	gzStmt
;

90425 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

90426 ifÐ
NEVER
(
v
==0) ) ;

90428 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 0);

90433 ifÐ
	gp
->
	gpS–eù
==0 ){

90435 
zTy³
 = "table";

90436 
	gzTy³2
 = "TABLE";

90437 #iâdeà
SQLITE_OMIT_VIEW


90440 
	gzTy³
 = "view";

90441 
	gzTy³2
 = "VIEW";

90458 ifÐ
	gpS–eù
 ){

90459 
S–eùDe¡
 
	gde¡
;

90460 
TabË
 *
	gpS–Tab
;

90462 
as£¹
(
pP¬£
->
nTab
==1);

90463 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nWr™e
, 1, 
pP¬£
->
»gRoÙ
, 
iDb
);

90464 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_P2ISREG
);

90465 
	gpP¬£
->
	gnTab
 = 2;

90466 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_TabË
, 1);

90467 
sql™e3S–eù
(
pP¬£
, 
pS–eù
, &
de¡
);

90468 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 1);

90469 ifÐ
	gpP¬£
->
	gnE¼
==0 ){

90470 
pS–Tab
 = 
sql™e3ResuÉS‘OfS–eù
(
pP¬£
, 
pS–eù
);

90471 ifÐ
	gpS–Tab
==0 ) ;

90472 
as£¹
Ð
p
->
aCÞ
==0 );

90473 
	gp
->
	gnCÞ
 = 
pS–Tab
->
nCÞ
;

90474 
	gp
->
	gaCÞ
 = 
pS–Tab
->
aCÞ
;

90475 
	gpS–Tab
->
	gnCÞ
 = 0;

90476 
	gpS–Tab
->
	gaCÞ
 = 0;

90477 
sql™e3D–‘eTabË
(
db
, 
pS–Tab
);

90482 ifÐ
	gpS–eù
 ){

90483 
	gzStmt
 = 
ü—‹TabËStmt
(
db
, 
p
);

90485 
Tok’
 *
	gpEnd2
 = 
bO±s
 ? &
pP¬£
->
sLa¡Tok’
 : 
pEnd
;

90486 
	gn
 = ()(
pEnd2
->
z
 - 
pP¬£
->
sNameTok’
.z);

90487 ifÐ
	gpEnd2
->
	gz
[0]!=';' ) 
n
 +ð
pEnd2
->n;

90488 
	gzStmt
 = 
sql™e3MPrštf
(
db
,

90489 "CREATE % %.*s", 
zTy³2
, 
n
, 
pP¬£
->
sNameTok’
.
z


90497 
sql™e3Ne¡edP¬£
(
pP¬£
,

90501 
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb),

90502 
zTy³
,

90503 
p
->
zName
,

90504 
p
->
zName
,

90505 
pP¬£
->
»gRoÙ
,

90506 
zStmt
,

90507 
pP¬£
->
»gRowid


90509 
sql™e3DbF»e
(
db
, 
zStmt
);

90510 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

90512 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


90516 ifÐ
	gp
->
	gbFÏgs
 & 
	gTF_Autošüem’t
 ){

90517 
Db
 *
	gpDb
 = &
db
->
aDb
[
iDb
];

90518 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

90519 ifÐ
	gpDb
->
	gpSchema
->
	gpSeqTab
==0 ){

90520 
sql™e3Ne¡edP¬£
(
pP¬£
,

90522 
pDb
->
zName


90529 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 
iDb
,

90530 
sql™e3MPrštf
(
db
, "tbl_Çme='%q' ANDy³!='Œigg”'", 
p
->
zName
));

90536 ifÐ
	gdb
->
	gš™
.
	gbusy
 ){

90537 
TabË
 *
	gpOld
;

90538 
Schema
 *
	gpSchema
 = 
p
->
pSchema
;

90539 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

90540 
	gpOld
 = 
sql™e3HashIn£¹
(&
pSchema
->
tblHash
, 
p
->
zName
,…);

90541 ifÐ
	gpOld
 ){

90542 
as£¹
Ð
p
==
pOld
 );

90543 
	gdb
->
	gm®locFažed
 = 1;

90546 
	gpP¬£
->
	gpNewTabË
 = 0;

90547 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

90549 #iâdeà
SQLITE_OMIT_ALTERTABLE


90550 ifÐ!
	gp
->
	gpS–eù
 ){

90551 cÚ¡ *
	gzName
 = (cÚ¡ *)
pP¬£
->
sNameTok’
.
z
;

90552 
	gnName
;

90553 
as£¹
Ð!
pS–eù
 && 
pCÚs
 && 
pEnd
 );

90554 ifÐ
	gpCÚs
->
	gz
==0 ){

90555 
pCÚs
 = 
pEnd
;

90557 
	gnName
 = ()((cÚ¡ *)
pCÚs
->
z
 - 
zName
);

90558 
	gp
->
	gaddCÞOff£t
 = 13 + 
sql™e3Utf8Ch¬L’
(
zName
, 
nName
);

90564 #iâdeà
SQLITE_OMIT_VIEW


90568 
SQLITE_PRIVATE
 
sql™e3C»©eV›w
(

90569 
P¬£
 *
pP¬£
,

90570 
Tok’
 *
pBegš
,

90571 
Tok’
 *
pName1
,

90572 
Tok’
 *
pName2
,

90573 
S–eù
 *
pS–eù
,

90574 
isTemp
,

90575 
noE¼


90577 
TabË
 *
	gp
;

90578 
	gn
;

90579 cÚ¡ *
	gz
;

90580 
Tok’
 
	gsEnd
;

90581 
DbFix”
 
	gsFix
;

90582 
Tok’
 *
	gpName
 = 0;

90583 
	giDb
;

90584 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90586 ifÐ
	gpP¬£
->
	gnV¬
>0 ){

90587 
sql™e3E¼ÜMsg
(
pP¬£
, "parameters‡re‚ot‡llowed in views");

90588 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

90591 
sql™e3S¹TabË
(
pP¬£
, 
pName1
, 
pName2
, 
isTemp
, 1, 0, 
noE¼
);

90592 
	gp
 = 
pP¬£
->
pNewTabË
;

90593 ifÐ
	gp
==0 || 
pP¬£
->
nE¼
 ){

90594 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

90597 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pName
);

90598 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
p
->
pSchema
);

90599 
sql™e3FixIn™
(&
sFix
, 
pP¬£
, 
iDb
, "v›w", 
pName
);

90600 ifÐ
sql™e3FixS–eù
(&
sFix
, 
pS–eù
) ){

90601 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

90610 
	gp
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pS–eù
, 
EXPRDUP_REDUCE
);

90611 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

90612 ifÐ
	gdb
->
	gm®locFažed
 ){

90615 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

90616 
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
p
);

90622 
	gsEnd
 = 
pP¬£
->
sLa¡Tok’
;

90623 ifÐ
ALWAYS
(
sEnd
.
z
[0]!=0) && sEnd.z[0]!=';' ){

90624 
sEnd
.
z
 +ðsEnd.
n
;

90626 
	gsEnd
.
	gn
 = 0;

90627 
	gn
 = ()(
sEnd
.
z
 - 
pBegš
->z);

90628 
	gz
 = 
pBegš
->
z
;

90629  
ALWAYS
(
n
>0è&& 
sql™e3Is¥aû
(
z
[n-1]è){ 
	gn
--; }

90630 
	gsEnd
.
	gz
 = &
z
[
n
-1];

90631 
	gsEnd
.
	gn
 = 1;

90634 
sql™e3EndTabË
(
pP¬£
, 0, &
sEnd
, 0, 0);

90639 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed(
SQLITE_OMIT_VIRTUALTABLE
)

90645 
SQLITE_PRIVATE
 
sql™e3V›wG‘CÞumnNames
(
P¬£
 *
pP¬£
, 
TabË
 *
pTabË
){

90646 
TabË
 *
	gpS–Tab
;

90647 
S–eù
 *
	gpS–
;

90648 
	gnE¼
 = 0;

90649 
	gn
;

90650 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90651 
sql™e3_xauth
 
	gxAuth
;

90653 
as£¹
Ð
pTabË
 );

90655 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


90656 ifÐ
sql™e3VbC®lCÚÃù
(
pP¬£
, 
pTabË
) ){

90657  
	gSQLITE_ERROR
;

90659 ifÐ
IsVœtu®
(
pTabË
) )  0;

90662 #iâdeà
SQLITE_OMIT_VIEW


90666 ifÐ
	gpTabË
->
	gnCÞ
>0 )  0;

90683 ifÐ
	gpTabË
->
	gnCÞ
<0 ){

90684 
sql™e3E¼ÜMsg
(
pP¬£
, "v›w % i cœcuÏ¾y defšed", 
pTabË
->
zName
);

90687 
as£¹
Ð
pTabË
->
nCÞ
>=0 );

90696 
as£¹
Ð
pTabË
->
pS–eù
 );

90697 
	gpS–
 = 
sql™e3S–eùDup
(
db
, 
pTabË
->
pS–eù
, 0);

90698 ifÐ
	gpS–
 ){

90699 
u8
 
	g’abËLookaside
 = 
db
->
lookaside
.
bEÇbËd
;

90700 
	gn
 = 
pP¬£
->
nTab
;

90701 
sql™e3SrcLi¡AssignCursÜs
(
pP¬£
, 
pS–
->
pSrc
);

90702 
	gpTabË
->
	gnCÞ
 = -1;

90703 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 0;

90704 #iâdeà
SQLITE_OMIT_AUTHORIZATION


90705 
	gxAuth
 = 
db
->
xAuth
;

90706 
	gdb
->
	gxAuth
 = 0;

90707 
	gpS–Tab
 = 
sql™e3ResuÉS‘OfS–eù
(
pP¬£
, 
pS–
);

90708 
	gdb
->
	gxAuth
 = 
xAuth
;

90710 
	gpS–Tab
 = 
sql™e3ResuÉS‘OfS–eù
(
pP¬£
, 
pS–
);

90712 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 
’abËLookaside
;

90713 
	gpP¬£
->
	gnTab
 = 
n
;

90714 ifÐ
	gpS–Tab
 ){

90715 
as£¹
Ð
pTabË
->
aCÞ
==0 );

90716 
	gpTabË
->
	gnCÞ
 = 
pS–Tab
->
nCÞ
;

90717 
	gpTabË
->
	gaCÞ
 = 
pS–Tab
->
aCÞ
;

90718 
	gpS–Tab
->
	gnCÞ
 = 0;

90719 
	gpS–Tab
->
	gaCÞ
 = 0;

90720 
sql™e3D–‘eTabË
(
db
, 
pS–Tab
);

90721 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
pTabË
->
pSchema
) );

90722 
	gpTabË
->
	gpSchema
->
	gschemaFÏgs
 |ð
DB_UÄe£tV›ws
;

90724 
	gpTabË
->
	gnCÞ
 = 0;

90725 
	gnE¼
++;

90727 
sql™e3S–eùD–‘e
(
db
, 
pS–
);

90729 
	gnE¼
++;

90732  
	gnE¼
;

90736 #iâdeà
SQLITE_OMIT_VIEW


90740 
sql™eV›wRe£tAÎ
(
sql™e3
 *
db
, 
idx
){

90741 
HashEËm
 *
	gi
;

90742 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
idx
, 0) );

90743 ifÐ!
DbHasPrÝ”ty
(
db
, 
idx
, 
DB_UÄe£tV›ws
) ) ;

90744 
	gi
=
sql™eHashFœ¡
(&
db
->
aDb
[
idx
].
pSchema
->
tblHash
); i;i=
sql™eHashNext
(
i
)){

90745 
TabË
 *
pTab
 = 
sql™eHashD©a
(
i
);

90746 ifÐ
	gpTab
->
	gpS–eù
 ){

90747 
sql™eD–‘eCÞumnNames
(
db
, 
pTab
);

90748 
	gpTab
->
	gaCÞ
 = 0;

90749 
	gpTab
->
	gnCÞ
 = 0;

90752 
DbCË¬PrÝ”ty
(
db
, 
idx
, 
DB_UÄe£tV›ws
);

90755 
	#sql™eV›wRe£tAÎ
(
A
,
B
)

	)

90775 #iâdeà
SQLITE_OMIT_AUTOVACUUM


90776 
SQLITE_PRIVATE
 
sql™e3RoÙPageMoved
(
sql™e3
 *
db
, 
iDb
, 
iFrom
, 
iTo
){

90777 
HashEËm
 *
	gpEËm
;

90778 
Hash
 *
	gpHash
;

90779 
Db
 *
	gpDb
;

90781 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

90782 
	gpDb
 = &
db
->
aDb
[
iDb
];

90783 
	gpHash
 = &
pDb
->
pSchema
->
tblHash
;

90784 
	gpEËm
=
sql™eHashFœ¡
(
pHash
);…EËm;…EËm=
sql™eHashNext
(
pEËm
)){

90785 
TabË
 *
pTab
 = 
sql™eHashD©a
(
pEËm
);

90786 ifÐ
	gpTab
->
	gŠum
==
iFrom
 ){

90787 
pTab
->
Šum
 = 
iTo
;

90790 
	gpHash
 = &
pDb
->
pSchema
->
idxHash
;

90791 
	gpEËm
=
sql™eHashFœ¡
(
pHash
);…EËm;…EËm=
sql™eHashNext
(
pEËm
)){

90792 
Index
 *
pIdx
 = 
sql™eHashD©a
(
pEËm
);

90793 ifÐ
	gpIdx
->
	gŠum
==
iFrom
 ){

90794 
pIdx
->
Šum
 = 
iTo
;

90806 
de¡royRoÙPage
(
P¬£
 *
pP¬£
, 
iTabË
, 
iDb
){

90807 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

90808 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

90809 
sql™e3VdbeAddOp3
(
v
, 
OP_De¡roy
, 
iTabË
, 
r1
, 
iDb
);

90810 
sql™e3MayAbÜt
(
pP¬£
);

90811 #iâdeà
SQLITE_OMIT_AUTOVACUUM


90821 
sql™e3Ne¡edP¬£
(
pP¬£
,

90823 
pP¬£
->
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb), 
iTabË
, 
r1
,„1);

90825 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

90834 
de¡royTabË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

90835 #ifdeà
SQLITE_OMIT_AUTOVACUUM


90836 
Index
 *
	gpIdx
;

90837 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

90838 
de¡royRoÙPage
(
pP¬£
, 
pTab
->
Šum
, 
iDb
);

90839 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

90840 
de¡royRoÙPage
(
pP¬£
, 
pIdx
->
Šum
, 
iDb
);

90859 
	giTab
 = 
pTab
->
Šum
;

90860 
	giDe¡royed
 = 0;

90863 
Index
 *
	gpIdx
;

90864 
	giL¬ge¡
 = 0;

90866 ifÐ
	giDe¡royed
==0 || 
iTab
<
iDe¡royed
 ){

90867 
iL¬ge¡
 = 
iTab
;

90869 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

90870 
iIdx
 = 
pIdx
->
Šum
;

90871 
as£¹
Ð
pIdx
->
pSchema
==
pTab
->pSchema );

90872 ifÐ(
	giDe¡royed
==0 || (
iIdx
<
iDe¡royed
)è&& iIdx>
iL¬ge¡
 ){

90873 
iL¬ge¡
 = 
iIdx
;

90876 ifÐ
	giL¬ge¡
==0 ){

90879 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

90880 
as£¹
Ð
iDb
>=0 && iDb<
pP¬£
->
db
->
nDb
 );

90881 
de¡royRoÙPage
(
pP¬£
, 
iL¬ge¡
, 
iDb
);

90882 
	giDe¡royed
 = 
iL¬ge¡
;

90892 
sql™e3CË¬StTabËs
(

90893 
P¬£
 *
pP¬£
,

90894 
iDb
,

90895 cÚ¡ *
zTy³
,

90896 cÚ¡ *
zName


90898 
	gi
;

90899 cÚ¡ *
	gzDbName
 = 
pP¬£
->
db
->
aDb
[
iDb
].
zName
;

90900 
	gi
=1; i<=4; i++){

90901 
	gzTab
[24];

90902 
sql™e3_¢´štf
((
zTab
),zTab,"sql™e_¡©%d",
i
);

90903 ifÐ
sql™e3FšdTabË
(
pP¬£
->
db
, 
zTab
, 
zDbName
) ){

90904 
sql™e3Ne¡edP¬£
(
pP¬£
,

90906 
zDbName
, 
zTab
, 
zTy³
, 
zName


90915 
SQLITE_PRIVATE
 
sql™e3CodeDrÝTabË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, 
iDb
, 
isV›w
){

90916 
Vdbe
 *
	gv
;

90917 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90918 
Trigg”
 *
	gpTrigg”
;

90919 
Db
 *
	gpDb
 = &
db
->
aDb
[
iDb
];

90921 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

90922 
as£¹
Ð
v
!=0 );

90923 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

90925 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


90926 ifÐ
IsVœtu®
(
pTab
) ){

90927 
sql™e3VdbeAddOp0
(
v
, 
OP_VBegš
);

90935 
	gpTrigg”
 = 
sql™e3Trigg”Li¡
(
pP¬£
, 
pTab
);

90936  
	gpTrigg”
 ){

90937 
as£¹
Ð
pTrigg”
->
pSchema
==
pTab
->pSchema ||

90938 
pTrigg”
->
pSchema
==
db
->
aDb
[1].pSchema );

90939 
sql™e3DrÝTrigg”PŒ
(
pP¬£
, 
pTrigg”
);

90940 
	gpTrigg”
 = 
pTrigg”
->
pNext
;

90943 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


90949 ifÐ
	gpTab
->
	gbFÏgs
 & 
	gTF_Autošüem’t
 ){

90950 
sql™e3Ne¡edP¬£
(
pP¬£
,

90952 
pDb
->
zName
, 
pTab
->zName

90964 
sql™e3Ne¡edP¬£
(
pP¬£
,

90966 
pDb
->
zName
, 
SCHEMA_TABLE
(
iDb
), 
pTab
->zName);

90967 ifÐ!
	gisV›w
 && !
IsVœtu®
(
pTab
) ){

90968 
de¡royTabË
(
pP¬£
, 
pTab
);

90974 ifÐ
IsVœtu®
(
pTab
) ){

90975 
sql™e3VdbeAddOp4
(
v
, 
OP_VDe¡roy
, 
iDb
, 0, 0, 
pTab
->
zName
, 0);

90977 
sql™e3VdbeAddOp4
(
v
, 
OP_DrÝTabË
, 
iDb
, 0, 0, 
pTab
->
zName
, 0);

90978 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

90979 
sql™eV›wRe£tAÎ
(
db
, 
iDb
);

90986 
SQLITE_PRIVATE
 
sql™e3DrÝTabË
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pName
, 
isV›w
, 
noE¼
){

90987 
TabË
 *
	gpTab
;

90988 
Vdbe
 *
	gv
;

90989 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

90990 
	giDb
;

90992 ifÐ
	gdb
->
	gm®locFažed
 ){

90993 
	gex™_drÝ_bË
;

90995 
as£¹
Ð
pP¬£
->
nE¼
==0 );

90996 
as£¹
Ð
pName
->
nSrc
==1 );

90997 ifÐ
	gnoE¼
 ) 
	gdb
->
	gsuµ»ssE¼
++;

90998 
	gpTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 
isV›w
, &
pName
->
a
[0]);

90999 ifÐ
	gnoE¼
 ) 
	gdb
->
	gsuµ»ssE¼
--;

91001 ifÐ
	gpTab
==0 ){

91002 ifÐ
noE¼
 ) 
sql™e3CodeV”ifyNamedSchema
(
pP¬£
, 
pName
->
a
[0].
zD©aba£
);

91003 
	gex™_drÝ_bË
;

91005 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

91006 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

91011 ifÐ
IsVœtu®
(
pTab
è&& 
sql™e3V›wG‘CÞumnNames
(
pP¬£
,…Tab) ){

91012 
	gex™_drÝ_bË
;

91014 #iâdeà
SQLITE_OMIT_AUTHORIZATION


91016 
	gcode
;

91017 cÚ¡ *
	gzTab
 = 
SCHEMA_TABLE
(
iDb
);

91018 cÚ¡ *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

91019 cÚ¡ *
	gzArg2
 = 0;

91020 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_DELETE
, 
zTab
, 0, 
zDb
)){

91021 
	gex™_drÝ_bË
;

91023 ifÐ
	gisV›w
 ){

91024 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
==1 ){

91025 
code
 = 
SQLITE_DROP_TEMP_VIEW
;

91027 
	gcode
 = 
SQLITE_DROP_VIEW
;

91029 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


91030 }ifÐ
IsVœtu®
(
pTab
) ){

91031 
	gcode
 = 
SQLITE_DROP_VTABLE
;

91032 
	gzArg2
 = 
sql™e3G‘VTabË
(
db
, 
pTab
)->
	gpMod
->
	gzName
;

91035 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
==1 ){

91036 
code
 = 
SQLITE_DROP_TEMP_TABLE
;

91038 
	gcode
 = 
SQLITE_DROP_TABLE
;

91041 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
code
, 
pTab
->
zName
, 
zArg2
, 
zDb
) ){

91042 
	gex™_drÝ_bË
;

91044 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_DELETE
, 
pTab
->
zName
, 0, 
zDb
) ){

91045 
	gex™_drÝ_bË
;

91049 ifÐ
sql™e3SŒNICmp
(
pTab
->
zName
, "sqlite_", 7)==0

91050 && 
sql™e3SŒNICmp
(
pTab
->
zName
, "sqlite_stat", 11)!=0 ){

91051 
sql™e3E¼ÜMsg
(
pP¬£
, "bË % may‚Ù bdrÝ³d", 
pTab
->
zName
);

91052 
	gex™_drÝ_bË
;

91055 #iâdeà
SQLITE_OMIT_VIEW


91059 ifÐ
	gisV›w
 && 
	gpTab
->
	gpS–eù
==0 ){

91060 
sql™e3E¼ÜMsg
(
pP¬£
, "u£ DROP TABLEØd–‘bË %s", 
pTab
->
zName
);

91061 
	gex™_drÝ_bË
;

91063 ifÐ!
	gisV›w
 && 
	gpTab
->
	gpS–eù
 ){

91064 
sql™e3E¼ÜMsg
(
pP¬£
, "u£ DROP VIEWØd–‘v›w %s", 
pTab
->
zName
);

91065 
	gex™_drÝ_bË
;

91072 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

91073 ifÐ
	gv
 ){

91074 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

91075 
sql™e3CË¬StTabËs
(
pP¬£
, 
iDb
, "tbl", 
pTab
->
zName
);

91076 
sql™e3FkDrÝTabË
(
pP¬£
, 
pName
, 
pTab
);

91077 
sql™e3CodeDrÝTabË
(
pP¬£
, 
pTab
, 
iDb
, 
isV›w
);

91080 
	gex™_drÝ_bË
:

91081 
sql™e3SrcLi¡D–‘e
(
db
, 
pName
);

91100 
SQLITE_PRIVATE
 
sql™e3C»©eFÜeignKey
(

91101 
P¬£
 *
pP¬£
,

91102 
Ex´Li¡
 *
pFromCÞ
,

91103 
Tok’
 *
pTo
,

91104 
Ex´Li¡
 *
pToCÞ
,

91105 
æags


91107 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

91108 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


91109 
FKey
 *
	gpFKey
 = 0;

91110 
FKey
 *
	gpNextTo
;

91111 
TabË
 *
	gp
 = 
pP¬£
->
pNewTabË
;

91112 
	gnBy‹
;

91113 
	gi
;

91114 
	gnCÞ
;

91115 *
	gz
;

91117 
as£¹
Ð
pTo
!=0 );

91118 ifÐ
	gp
==0 || 
IN_DECLARE_VTAB
 ) 
fk_’d
;

91119 ifÐ
	gpFromCÞ
==0 ){

91120 
iCÞ
 = 
p
->
nCÞ
-1;

91121 ifÐ
NEVER
(
iCÞ
<0èè
	gfk_’d
;

91122 ifÐ
	gpToCÞ
 &&…ToCÞ->
	gnEx´
!=1 ){

91123 
sql™e3E¼ÜMsg
(
pP¬£
, "foreign key on %s"

91125 
p
->
aCÞ
[
iCÞ
].
zName
, 
pTo
);

91126 
	gfk_’d
;

91128 
	gnCÞ
 = 1;

91129 }ifÐ
	gpToCÞ
 &&…ToCÞ->
	gnEx´
!=
pFromCÞ
->
nEx´
 ){

91130 
sql™e3E¼ÜMsg
(
pP¬£
,

91133 
	gfk_’d
;

91135 
	gnCÞ
 = 
pFromCÞ
->
nEx´
;

91137 
	gnBy‹
 = (*
pFKey
è+ (
nCÞ
-1)*ÕFKey->
aCÞ
[0]è+ 
pTo
->
n
 + 1;

91138 ifÐ
	gpToCÞ
 ){

91139 
	gi
=0; i<
	gpToCÞ
->
	gnEx´
; i++){

91140 
	gnBy‹
 +ð
sql™e3SŒËn30
(
pToCÞ
->
a
[
i
].
zName
) + 1;

91143 
	gpFKey
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
 );

91144 ifÐ
	gpFKey
==0 ){

91145 
fk_’d
;

91147 
	gpFKey
->
	gpFrom
 = 
p
;

91148 
	gpFKey
->
	gpNextFrom
 = 
p
->
pFKey
;

91149 
	gz
 = (*)&
pFKey
->
aCÞ
[
nCÞ
];

91150 
	gpFKey
->
	gzTo
 = 
z
;

91151 
memýy
(
z
, 
pTo
->z,…To->
n
);

91152 
	gz
[
pTo
->
n
] = 0;

91153 
sql™e3DequÙe
(
z
);

91154 
	gz
 +ð
pTo
->
n
+1;

91155 
	gpFKey
->
	gnCÞ
 = 
nCÞ
;

91156 ifÐ
	gpFromCÞ
==0 ){

91157 
pFKey
->
aCÞ
[0].
iFrom
 = 
p
->
nCÞ
-1;

91159 
	gi
=0; i<
	gnCÞ
; i++){

91160 
	gj
;

91161 
	gj
=0; j<
	gp
->
	gnCÞ
; j++){

91162 ifÐ
sql™e3SŒICmp
(
p
->
aCÞ
[
j
].
zName
, 
pFromCÞ
->
a
[
i
].zName)==0 ){

91163 
pFKey
->
aCÞ
[
i
].
iFrom
 = 
j
;

91167 ifÐ
	gj
>=
p
->
nCÞ
 ){

91168 
sql™e3E¼ÜMsg
(
pP¬£
,

91170 
pFromCÞ
->
a
[
i
].
zName
);

91171 
	gfk_’d
;

91175 ifÐ
	gpToCÞ
 ){

91176 
	gi
=0; i<
	gnCÞ
; i++){

91177 
	gn
 = 
sql™e3SŒËn30
(
pToCÞ
->
a
[
i
].
zName
);

91178 
	gpFKey
->
	gaCÞ
[
i
].
	gzCÞ
 = 
z
;

91179 
memýy
(
z
, 
pToCÞ
->
a
[
i
].
zName
, 
n
);

91180 
	gz
[
n
] = 0;

91181 
	gz
 +ð
n
+1;

91184 
	gpFKey
->
	gisDeã¼ed
 = 0;

91185 
	gpFKey
->
	gaAùiÚ
[0] = (
u8
)(
æags
 & 0xff);

91186 
	gpFKey
->
	gaAùiÚ
[1] = (
u8
)((
æags
 >> 8 ) & 0xff);

91188 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
p
->
pSchema
) );

91189 
	gpNextTo
 = (
FKey
 *)
sql™e3HashIn£¹
(&
p
->
pSchema
->
fkeyHash
,

91190 
pFKey
->
zTo
, (*)pFKey

91192 ifÐ
	gpNextTo
==
pFKey
 ){

91193 
db
->
m®locFažed
 = 1;

91194 
	gfk_’d
;

91196 ifÐ
	gpNextTo
 ){

91197 
as£¹
Ð
pNextTo
->
pP»vTo
==0 );

91198 
	gpFKey
->
	gpNextTo
 = 
pNextTo
;

91199 
	gpNextTo
->
	gpP»vTo
 = 
pFKey
;

91204 
	gp
->
	gpFKey
 = 
pFKey
;

91205 
	gpFKey
 = 0;

91207 
	gfk_’d
:

91208 
sql™e3DbF»e
(
db
, 
pFKey
);

91210 
sql™e3Ex´Li¡D–‘e
(
db
, 
pFromCÞ
);

91211 
sql™e3Ex´Li¡D–‘e
(
db
, 
pToCÞ
);

91221 
SQLITE_PRIVATE
 
sql™e3DeãrFÜeignKey
(
P¬£
 *
pP¬£
, 
isDeã¼ed
){

91222 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


91223 
TabË
 *
	gpTab
;

91224 
FKey
 *
	gpFKey
;

91225 ifÐ(
	gpTab
 = 
pP¬£
->
pNewTabË
)==0 || (
pFKey
 = 
pTab
->pFKey)==0 ) ;

91226 
as£¹
Ð
isDeã¼ed
==0 || isDeferred==1 );

91227 
	gpFKey
->
	gisDeã¼ed
 = (
u8
)
isDeã¼ed
;

91242 
sql™e3RefžlIndex
(
P¬£
 *
pP¬£
, 
Index
 *
pIndex
, 
memRoÙPage
){

91243 
TabË
 *
	gpTab
 = 
pIndex
->
pTabË
;

91244 
	giTab
 = 
pP¬£
->
nTab
++;

91245 
	giIdx
 = 
pP¬£
->
nTab
++;

91246 
	giSÜ‹r
;

91247 
	gaddr1
;

91248 
	gaddr2
;

91249 
	gŠum
;

91250 
	giP¬tIdxLab–
;

91251 
Vdbe
 *
	gv
;

91252 
KeyInfo
 *
	gpKey
;

91253 
	g»gRecÜd
;

91254 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

91255 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pIndex
->
pSchema
);

91257 #iâdeà
SQLITE_OMIT_AUTHORIZATION


91258 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_REINDEX
, 
pIndex
->
zName
, 0,

91259 
db
->
aDb
[
iDb
].
zName
 ) ){

91265 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 1,…Tab->
zName
);

91267 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

91268 ifÐ
	gv
==0 ) ;

91269 ifÐ
	gmemRoÙPage
>=0 ){

91270 
Šum
 = 
memRoÙPage
;

91272 
	gŠum
 = 
pIndex
->
Šum
;

91274 
	gpKey
 = 
sql™e3KeyInfoOfIndex
(
pP¬£
, 
pIndex
);

91277 
	giSÜ‹r
 = 
pP¬£
->
nTab
++;

91278 
sql™e3VdbeAddOp4
(
v
, 
OP_SÜ‹rO³n
, 
iSÜ‹r
, 0, 
pIndex
->
nKeyCÞ
, (*)

91279 
sql™e3KeyInfoRef
(
pKey
), 
P4_KEYINFO
);

91283 
sql™e3O³nTabË
(
pP¬£
, 
iTab
, 
iDb
, 
pTab
, 
OP_O³nR—d
);

91284 
	gaddr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iTab
, 0); 
VdbeCov”age
(v);

91285 
	g»gRecÜd
 = 
sql™e3G‘TempReg
(
pP¬£
);

91287 
sql™e3G’”©eIndexKey
(
pP¬£
,
pIndex
,
iTab
,
»gRecÜd
,0,&
iP¬tIdxLab–
,0,0);

91288 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rIn£¹
, 
iSÜ‹r
, 
»gRecÜd
);

91289 
sql™e3ResÞveP¬tIdxLab–
(
pP¬£
, 
iP¬tIdxLab–
);

91290 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iTab
, 
addr1
+1); 
VdbeCov”age
(v);

91291 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

91292 ifÐ
	gmemRoÙPage
<0 ) 
sql™e3VdbeAddOp2
(
v
, 
OP_CË¬
, 
Šum
, 
iDb
);

91293 
sql™e3VdbeAddOp4
(
v
, 
OP_O³nWr™e
, 
iIdx
, 
Šum
, 
iDb
,

91294 (*)
pKey
, 
P4_KEYINFO
);

91295 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_BULKCSR
|((
memRoÙPage
>=0)?
OPFLAG_P2ISREG
:0));

91297 
	gaddr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rSÜt
, 
iSÜ‹r
, 0); 
VdbeCov”age
(v);

91298 
as£¹
Ð
pKey
!=0 || 
db
->
m®locFažed
 || 
pP¬£
->
nE¼
 );

91299 ifÐ
IsUniqueIndex
(
pIndex
è&& 
	gpKey
!=0 ){

91300 
j2
 = 
sql™e3VdbeCu¼’tAddr
(
v
) + 3;

91301 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
j2
);

91302 
	gaddr2
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

91303 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_SÜ‹rCom·»
, 
iSÜ‹r
, 
j2
, 
»gRecÜd
,

91304 
pIndex
->
nKeyCÞ
); 
VdbeCov”age
(
v
);

91305 
sql™e3UniqueCÚ¡¿št
(
pP¬£
, 
OE_AbÜt
, 
pIndex
);

91307 
	gaddr2
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

91309 
sql™e3VdbeAddOp3
(
v
, 
OP_SÜ‹rD©a
, 
iSÜ‹r
, 
»gRecÜd
, 
iIdx
);

91310 
sql™e3VdbeAddOp3
(
v
, 
OP_IdxIn£¹
, 
iIdx
, 
»gRecÜd
, 1);

91311 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_USESEEKRESULT
);

91312 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRecÜd
);

91313 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rNext
, 
iSÜ‹r
, 
addr2
); 
VdbeCov”age
(v);

91314 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

91316 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iTab
);

91317 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iIdx
);

91318 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iSÜ‹r
);

91328 
SQLITE_PRIVATE
 
Index
 *
sql™e3AÎoÿ‹IndexObjeù
(

91329 
sql™e3
 *
db
,

91330 
i16
 
nCÞ
,

91331 
nExŒa
,

91332 **
µExŒa


91334 
Index
 *
	gp
;

91335 
	gnBy‹
;

91337 
	gnBy‹
 = 
ROUND8
((
Index
)) +

91338 
ROUND8
((*)*
nCÞ
) +

91339 
ROUND8
((
LogE¡
)*(
nCÞ
+1) +

91340 (
i16
)*
nCÞ
 +

91341 (
u8
)*
nCÞ
);

91342 
	gp
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹
 + 
nExŒa
);

91343 ifÐ
	gp
 ){

91344 *
	gpExŒa
 = ((*)
p
)+
ROUND8
((
Index
));

91345 
	gp
->
	gazCÞl
 = (**)
pExŒa
; 
	gpExŒa
 +ð
ROUND8
((*)*
nCÞ
);

91346 
	gp
->
	gaiRowLogE¡
 = (
LogE¡
*)
pExŒa
; 
	gpExŒa
 +ð(LogE¡)*(
nCÞ
+1);

91347 
	gp
->
	gaiCÞumn
 = (
i16
*)
pExŒa
; 
	gpExŒa
 +ð(i16)*
nCÞ
;

91348 
	gp
->
	gaSÜtOrd”
 = (
u8
*)
pExŒa
;

91349 
	gp
->
	gnCÞumn
 = 
nCÞ
;

91350 
	gp
->
	gnKeyCÞ
 = 
nCÞ
 - 1;

91351 *
	gµExŒa
 = ((*)
p
è+ 
nBy‹
;

91353  
	gp
;

91372 
SQLITE_PRIVATE
 
Index
 *
sql™e3C»©eIndex
(

91373 
P¬£
 *
pP¬£
,

91374 
Tok’
 *
pName1
,

91375 
Tok’
 *
pName2
,

91376 
SrcLi¡
 *
pTblName
,

91377 
Ex´Li¡
 *
pLi¡
,

91378 
ÚE¼Ü
,

91379 
Tok’
 *
pS¹
,

91380 
Ex´
 *
pPIWh”e
,

91381 
sÜtOrd”
,

91382 
ifNÙExi¡


91384 
Index
 *
	gpR‘
 = 0;

91385 
TabË
 *
	gpTab
 = 0;

91386 
Index
 *
	gpIndex
 = 0;

91387 *
	gzName
 = 0;

91388 
	gnName
;

91389 
	gi
, 
	gj
;

91390 
DbFix”
 
	gsFix
;

91391 
	gsÜtOrd”Mask
;

91392 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

91393 
Db
 *
	gpDb
;

91394 
	giDb
;

91395 
Tok’
 *
	gpName
 = 0;

91396 
Ex´Li¡_™em
 *
	gpLi¡I‹m
;

91397 cÚ¡ 
CÞumn
 *
	gpTabCÞ
;

91398 
	gnExŒa
 = 0;

91399 
	gnExŒaCÞ
;

91400 *
	gzExŒa
 = 0;

91401 
Index
 *
	gpPk
 = 0;

91403 
as£¹
Ð
pP¬£
->
nE¼
==0 );

91404 ifÐ
	gdb
->
	gm®locFažed
 || 
	gIN_DECLARE_VTAB
 ){

91405 
	gex™_ü—‹_šdex
;

91407 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

91408 
ex™_ü—‹_šdex
;

91414 ifÐ
	gpTblName
!=0 ){

91420 
as£¹
Ð
pName1
 && 
pName2
 );

91421 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pName
);

91422 ifÐ
	giDb
<0 ) 
	gex™_ü—‹_šdex
;

91423 
as£¹
Ð
pName
 &&…Name->
z
 );

91425 #iâdeà
SQLITE_OMIT_TEMPDB


91430 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

91431 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTblName
);

91432 ifÐ
	gpName2
->
	gn
==0 && 
pTab
 &&…Tab->
pSchema
==
db
->
aDb
[1].pSchema ){

91433 
iDb
 = 1;

91438 
sql™e3FixIn™
(&
sFix
, 
pP¬£
, 
iDb
, "šdex", 
pName
);

91439 ifÐ
sql™e3FixSrcLi¡
(&
sFix
, 
pTblName
) ){

91442 
as£¹
(0);

91444 
	gpTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, &
pTblName
->
a
[0]);

91445 
as£¹
Ð
db
->
m®locFažed
==0 || 
pTab
==0 );

91446 ifÐ
	gpTab
==0 ) 
ex™_ü—‹_šdex
;

91447 ifÐ
	giDb
==1 && 
db
->
aDb
[
iDb
].
pSchema
!=
pTab
->pSchema ){

91448 
sql™e3E¼ÜMsg
(
pP¬£
,

91450 
pTab
->
zName
);

91451 
	gex™_ü—‹_šdex
;

91453 ifÐ!
HasRowid
(
pTab
èè
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(pTab);

91455 
as£¹
Ð
pName
==0 );

91456 
as£¹
Ð
pS¹
==0 );

91457 
	gpTab
 = 
pP¬£
->
pNewTabË
;

91458 ifÐ!
	gpTab
 ) 
	gex™_ü—‹_šdex
;

91459 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

91461 
	gpDb
 = &
db
->
aDb
[
iDb
];

91463 
as£¹
Ð
pTab
!=0 );

91464 
as£¹
Ð
pP¬£
->
nE¼
==0 );

91465 ifÐ
sql™e3SŒNICmp
(
pTab
->
zName
, "sqlite_", 7)==0

91466 && 
db
->
š™
.
busy
==0

91467 #ià
SQLITE_USER_AUTHENTICATION


91468 && 
sql™e3U£rAuthTabË
(
pTab
->
zName
)==0

91470 && 
sql™e3SŒNICmp
(&
pTab
->
zName
[7],"altertab_",9)!=0 ){

91471 
sql™e3E¼ÜMsg
(
pP¬£
, "bË % may‚Ù bšdexed", 
pTab
->
zName
);

91472 
	gex™_ü—‹_šdex
;

91474 #iâdeà
SQLITE_OMIT_VIEW


91475 ifÐ
	gpTab
->
	gpS–eù
 ){

91476 
sql™e3E¼ÜMsg
(
pP¬£
, "views may‚ot be indexed");

91477 
	gex™_ü—‹_šdex
;

91480 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


91481 ifÐ
IsVœtu®
(
pTab
) ){

91482 
sql™e3E¼ÜMsg
(
pP¬£
, "virtualables may‚ot be indexed");

91483 
	gex™_ü—‹_šdex
;

91500 ifÐ
	gpName
 ){

91501 
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

91502 ifÐ
	gzName
==0 ) 
ex™_ü—‹_šdex
;

91503 
as£¹
Ð
pName
->
z
!=0 );

91504 ifÐ
	gSQLITE_OK
!=
sql™e3CheckObjeùName
(
pP¬£
, 
zName
) ){

91505 
	gex™_ü—‹_šdex
;

91507 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

91508 ifÐ
sql™e3FšdTabË
(
db
, 
zName
, 0)!=0 ){

91509 
sql™e3E¼ÜMsg
(
pP¬£
, "th”i ®»ady‡abË‚amed %s", 
zName
);

91510 
	gex™_ü—‹_šdex
;

91513 ifÐ
sql™e3FšdIndex
(
db
, 
zName
, 
pDb
->zName)!=0 ){

91514 ifÐ!
ifNÙExi¡
 ){

91515 
sql™e3E¼ÜMsg
(
pP¬£
, "šdex % ®»adyƒxi¡s", 
zName
);

91517 
as£¹
Ð!
db
->
š™
.
busy
 );

91518 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

91520 
	gex™_ü—‹_šdex
;

91523 
	gn
;

91524 
Index
 *
	gpLoÝ
;

91525 
	gpLoÝ
=
pTab
->
pIndex
, 
	gn
=1;…LoÝ;…LoÝ=
pLoÝ
->
pNext
,‚++){}

91526 
	gzName
 = 
sql™e3MPrštf
(
db
, "sql™e_autošdex_%s_%d", 
pTab
->
zName
, 
n
);

91527 ifÐ
	gzName
==0 ){

91528 
ex™_ü—‹_šdex
;

91534 #iâdeà
SQLITE_OMIT_AUTHORIZATION


91536 cÚ¡ *
	gzDb
 = 
pDb
->
zName
;

91537 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_INSERT
, 
SCHEMA_TABLE
(
iDb
), 0, 
zDb
) ){

91538 
	gex™_ü—‹_šdex
;

91540 
	gi
 = 
SQLITE_CREATE_INDEX
;

91541 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
==1 ) 
i
 = 
SQLITE_CREATE_TEMP_INDEX
;

91542 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
i
, 
zName
, 
pTab
->zName, 
zDb
) ){

91543 
	gex™_ü—‹_šdex
;

91552 ifÐ
	gpLi¡
==0 ){

91553 
pLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 0);

91554 ifÐ
	gpLi¡
==0 ) 
ex™_ü—‹_šdex
;

91555 
	gpLi¡
->
	ga
[0].
	gzName
 = 
sql™e3DbSŒDup
(
pP¬£
->
db
,

91556 
pTab
->
aCÞ
[pTab->
nCÞ
-1].
zName
);

91557 
	gpLi¡
->
	ga
[0].
	gsÜtOrd”
 = (
u8
)
sÜtOrd”
;

91563 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

91564 
Ex´
 *
	gpEx´
 = 
pLi¡
->
a
[
i
].
pEx´
;

91565 ifÐ
	gpEx´
 ){

91566 
as£¹
Ð
pEx´
->
Ý
==
TK_COLLATE
 );

91567 
	gnExŒa
 +ð(1 + 
sql™e3SŒËn30
(
pEx´
->
u
.
zTok’
));

91574 
	gnName
 = 
sql™e3SŒËn30
(
zName
);

91575 
	gnExŒaCÞ
 = 
pPk
 ?…Pk->
nKeyCÞ
 : 1;

91576 
	gpIndex
 = 
sql™e3AÎoÿ‹IndexObjeù
(
db
, 
pLi¡
->
nEx´
 + 
nExŒaCÞ
,

91577 
nName
 + 
nExŒa
 + 1, &
zExŒa
);

91578 ifÐ
	gdb
->
	gm®locFažed
 ){

91579 
	gex™_ü—‹_šdex
;

91581 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pIndex
->
aiRowLogE¡
) );

91582 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
pIndex
->
azCÞl
) );

91583 
	gpIndex
->
	gzName
 = 
zExŒa
;

91584 
	gzExŒa
 +ð
nName
 + 1;

91585 
memýy
(
pIndex
->
zName
, zName, 
nName
+1);

91586 
	gpIndex
->
	gpTabË
 = 
pTab
;

91587 
	gpIndex
->
	gÚE¼Ü
 = (
u8
)
ÚE¼Ü
;

91588 
	gpIndex
->
	guniqNÙNuÎ
 = 
ÚE¼Ü
!=
OE_NÚe
;

91589 
	gpIndex
->
	gidxTy³
 = 
pName
 ? 
SQLITE_IDXTYPE_APPDEF
 : 
SQLITE_IDXTYPE_UNIQUE
;

91590 
	gpIndex
->
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

91591 
	gpIndex
->
	gnKeyCÞ
 = 
pLi¡
->
nEx´
;

91592 ifÐ
	gpPIWh”e
 ){

91593 
sql™e3ResÞveS–fReã»nû
(
pP¬£
, 
pTab
, 
NC_P¬tIdx
, 
pPIWh”e
, 0);

91594 
	gpIndex
->
	gpP¬tIdxWh”e
 = 
pPIWh”e
;

91595 
	gpPIWh”e
 = 0;

91597 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

91601 ifÐ
	gpDb
->
	gpSchema
->
	gfže_fÜm©
>=4 ){

91602 
sÜtOrd”Mask
 = -1;

91604 
	gsÜtOrd”Mask
 = 0;

91617 
	gi
=0, 
	gpLi¡I‹m
=
pLi¡
->
a
; i<
	gpLi¡
->
	gnEx´
; i++,…ListItem++){

91618 cÚ¡ *
	gzCÞName
 = 
pLi¡I‹m
->
zName
;

91619 
	g»que¡edSÜtOrd”
;

91620 *
	gzCÞl
;

91622 
	gj
=0, 
	gpTabCÞ
=
pTab
->
aCÞ
; j<
	gpTab
->
	gnCÞ
; j++,…TabCol++){

91623 ifÐ
sql™e3SŒICmp
(
zCÞName
, 
pTabCÞ
->
zName
)==0 ) ;

91625 ifÐ
	gj
>=
pTab
->
nCÞ
 ){

91626 
sql™e3E¼ÜMsg
(
pP¬£
, "table %s has‚o column‚amed %s",

91627 
pTab
->
zName
, 
zCÞName
);

91628 
	gpP¬£
->
	gcheckSchema
 = 1;

91629 
	gex™_ü—‹_šdex
;

91631 
as£¹
Ð
j
<=0x7fff );

91632 
	gpIndex
->
	gaiCÞumn
[
i
] = (
i16
)
j
;

91633 ifÐ
	gpLi¡I‹m
->
	gpEx´
 ){

91634 
	gnCÞl
;

91635 
as£¹
Ð
pLi¡I‹m
->
pEx´
->
Ý
==
TK_COLLATE
 );

91636 
	gzCÞl
 = 
pLi¡I‹m
->
pEx´
->
u
.
zTok’
;

91637 
	gnCÞl
 = 
sql™e3SŒËn30
(
zCÞl
) + 1;

91638 
as£¹
Ð
nExŒa
>=
nCÞl
 );

91639 
memýy
(
zExŒa
, 
zCÞl
, 
nCÞl
);

91640 
	gzCÞl
 = 
zExŒa
;

91641 
	gzExŒa
 +ð
nCÞl
;

91642 
	gnExŒa
 -ð
nCÞl
;

91644 
	gzCÞl
 = 
pTab
->
aCÞ
[
j
].
zCÞl
;

91645 ifÐ!
	gzCÞl
 ) zColl = "BINARY";

91647 ifÐ!
	gdb
->
	gš™
.
	gbusy
 && !
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
zCÞl
) ){

91648 
	gex™_ü—‹_šdex
;

91650 
	gpIndex
->
	gazCÞl
[
i
] = 
zCÞl
;

91651 
	g»que¡edSÜtOrd”
 = 
pLi¡I‹m
->
sÜtOrd”
 & 
sÜtOrd”Mask
;

91652 
	gpIndex
->
	gaSÜtOrd”
[
i
] = (
u8
)
»que¡edSÜtOrd”
;

91653 ifÐ
	gpTab
->
	gaCÞ
[
j
].
	gnÙNuÎ
==0 ) 
pIndex
->
uniqNÙNuÎ
 = 0;

91655 ifÐ
	gpPk
 ){

91656 
	gj
=0; j<
	gpPk
->
	gnKeyCÞ
; j++){

91657 
	gx
 = 
pPk
->
aiCÞumn
[
j
];

91658 ifÐ
hasCÞumn
(
pIndex
->
aiCÞumn
,…Index->
nKeyCÞ
, 
x
) ){

91659 
	gpIndex
->
	gnCÞumn
--;

91661 
	gpIndex
->
	gaiCÞumn
[
i
] = 
x
;

91662 
	gpIndex
->
	gazCÞl
[
i
] = 
pPk
->
azCÞl
[
j
];

91663 
	gpIndex
->
	gaSÜtOrd”
[
i
] = 
pPk
->
aSÜtOrd”
[
j
];

91664 
	gi
++;

91667 
as£¹
Ð
i
==
pIndex
->
nCÞumn
 );

91669 
	gpIndex
->
	gaiCÞumn
[
i
] = -1;

91670 
	gpIndex
->
	gazCÞl
[
i
] = "BINARY";

91672 
sql™e3DeçuÉRowE¡
(
pIndex
);

91673 ifÐ
	gpP¬£
->
	gpNewTabË
==0 ) 
e¡im©eIndexWidth
(
pIndex
);

91675 ifÐ
	gpTab
==
pP¬£
->
pNewTabË
 ){

91697 
Index
 *
pIdx
;

91698 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

91699 
k
;

91700 
as£¹
Ð
IsUniqueIndex
(
pIdx
) );

91701 
as£¹
Ð
pIdx
->
idxTy³
!=
SQLITE_IDXTYPE_APPDEF
 );

91702 
as£¹
Ð
IsUniqueIndex
(
pIndex
) );

91704 ifÐ
	gpIdx
->
	gnKeyCÞ
!=
pIndex
->
nKeyCÞ
 ) ;

91705 
	gk
=0; k<
	gpIdx
->
	gnKeyCÞ
; k++){

91706 cÚ¡ *
	gz1
;

91707 cÚ¡ *
	gz2
;

91708 ifÐ
	gpIdx
->
	gaiCÞumn
[
k
]!=
pIndex
->
aiCÞumn
[k] ) ;

91709 
	gz1
 = 
pIdx
->
azCÞl
[
k
];

91710 
	gz2
 = 
pIndex
->
azCÞl
[
k
];

91711 ifÐ
	gz1
!=
z2
 && 
sql™e3SŒICmp
(
z1
, z2) ) ;

91713 ifÐ
	gk
==
pIdx
->
nKeyCÞ
 ){

91714 ifÐ
pIdx
->
ÚE¼Ü
!=
pIndex
->onError ){

91722 ifÐ!(
pIdx
->
ÚE¼Ü
==
OE_DeçuÉ
 || 
pIndex
->onError==OE_Default) ){

91723 
sql™e3E¼ÜMsg
(
pP¬£
,

91726 ifÐ
	gpIdx
->
	gÚE¼Ü
==
OE_DeçuÉ
 ){

91727 
pIdx
->
ÚE¼Ü
 = 
pIndex
->onError;

91730 
	gex™_ü—‹_šdex
;

91738 ifÐ
	gdb
->
	gš™
.
	gbusy
 ){

91739 
Index
 *
	gp
;

91740 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
pIndex
->
pSchema
) );

91741 
	gp
 = 
sql™e3HashIn£¹
(&
pIndex
->
pSchema
->
idxHash
,

91742 
pIndex
->
zName
,…Index);

91743 ifÐ
	gp
 ){

91744 
as£¹
Ð
p
==
pIndex
 );

91745 
	gdb
->
	gm®locFažed
 = 1;

91746 
	gex™_ü—‹_šdex
;

91748 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

91749 ifÐ
	gpTblName
!=0 ){

91750 
pIndex
->
Šum
 = 
db
->
š™
.
ÃwTnum
;

91767 ifÐ
	gpP¬£
->
	gnE¼
==0 && (
HasRowid
(
pTab
è|| 
pTblName
!=0) ){

91768 
Vdbe
 *
v
;

91769 *
	gzStmt
;

91770 
	giMem
 = ++
pP¬£
->
nMem
;

91772 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

91773 ifÐ
	gv
==0 ) 
ex™_ü—‹_šdex
;

91778 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

91779 
sql™e3VdbeAddOp2
(
v
, 
OP_C»©eIndex
, 
iDb
, 
iMem
);

91784 ifÐ
	gpS¹
 ){

91785 
	gn
 = ()(
pP¬£
->
sLa¡Tok’
.
z
 - 
pName
->zè+…P¬£->sLa¡Tok’.
n
;

91786 ifÐ
	gpName
->
	gz
[
n
-1]==';' )‚--;

91788 
	gzStmt
 = 
sql™e3MPrštf
(
db
, "CREATE%s INDEX %.*s",

91789 
ÚE¼Ü
==
OE_NÚe
 ? "" : " UNIQUE", 
n
, 
pName
->
z
);

91793 
	gzStmt
 = 0;

91798 
sql™e3Ne¡edP¬£
(
pP¬£
,

91800 
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb),

91801 
pIndex
->
zName
,

91802 
pTab
->
zName
,

91803 
iMem
,

91804 
zStmt


91806 
sql™e3DbF»e
(
db
, 
zStmt
);

91811 ifÐ
	gpTblName
 ){

91812 
sql™e3RefžlIndex
(
pP¬£
, 
pIndex
, 
iMem
);

91813 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

91814 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 
iDb
,

91815 
sql™e3MPrštf
(
db
, "Çme='%q' ANDy³='šdex'", 
pIndex
->
zName
));

91816 
sql™e3VdbeAddOp1
(
v
, 
OP_Expœe
, 0);

91826 ifÐ
	gdb
->
	gš™
.
	gbusy
 || 
	gpTblName
==0 ){

91827 ifÐ
ÚE¼Ü
!=
OE_R•Ïû
 || 
pTab
->
pIndex
==0

91828 || 
pTab
->
pIndex
->
ÚE¼Ü
==
OE_R•Ïû
){

91829 
pIndex
->
pNext
 = 
pTab
->pIndex;

91830 
	gpTab
->
	gpIndex
 = 
pIndex
;

91832 
Index
 *
	gpOth”
 = 
pTab
->
pIndex
;

91833  
	gpOth”
->
	gpNext
 &&…Oth”->pNext->
	gÚE¼Ü
!=
OE_R•Ïû
 ){

91834 
pOth”
 =…Oth”->
pNext
;

91836 
	gpIndex
->
	gpNext
 = 
pOth”
->
pNext
;

91837 
	gpOth”
->
	gpNext
 = 
pIndex
;

91839 
	gpR‘
 = 
pIndex
;

91840 
	gpIndex
 = 0;

91844 
	gex™_ü—‹_šdex
:

91845 ifÐ
pIndex
 ) 
ä“Index
(
db
,…Index);

91846 
sql™e3Ex´D–‘e
(
db
, 
pPIWh”e
);

91847 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

91848 
sql™e3SrcLi¡D–‘e
(
db
, 
pTblName
);

91849 
sql™e3DbF»e
(
db
, 
zName
);

91850  
	gpR‘
;

91871 
SQLITE_PRIVATE
 
sql™e3DeçuÉRowE¡
(
Index
 *
pIdx
){

91873 
LogE¡
 
	gaV®
[] = { 33, 32, 30, 28, 26 };

91874 
LogE¡
 *
	ga
 = 
pIdx
->
aiRowLogE¡
;

91875 
	gnCÝy
 = 
MIN
(
A¼aySize
(
aV®
), 
pIdx
->
nKeyCÞ
);

91876 
	gi
;

91881 
	ga
[0] = 
pIdx
->
pTabË
->
nRowLogE¡
;

91882 ifÐ
	ga
[0]<33 )‡[0] = 33; 
as£¹
Ð33==
sql™e3LogE¡
(10) );

91886 
memýy
(&
a
[1], 
aV®
, 
nCÝy
*(
LogE¡
));

91887 
	gi
=
nCÝy
+1; i<=
pIdx
->
nKeyCÞ
; i++){

91888 
	ga
[
i
] = 23; 
as£¹
Ð23==
sql™e3LogE¡
(5) );

91891 
as£¹
Ð0==
sql™e3LogE¡
(1) );

91892 ifÐ
IsUniqueIndex
(
pIdx
èè
	ga
[pIdx->
nKeyCÞ
] = 0;

91899 
SQLITE_PRIVATE
 
sql™e3DrÝIndex
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pName
, 
ifExi¡s
){

91900 
Index
 *
	gpIndex
;

91901 
Vdbe
 *
	gv
;

91902 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

91903 
	giDb
;

91905 
as£¹
Ð
pP¬£
->
nE¼
==0 );

91906 ifÐ
	gdb
->
	gm®locFažed
 ){

91907 
	gex™_drÝ_šdex
;

91909 
as£¹
Ð
pName
->
nSrc
==1 );

91910 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

91911 
ex™_drÝ_šdex
;

91913 
	gpIndex
 = 
sql™e3FšdIndex
(
db
, 
pName
->
a
[0].
zName
,…Name->a[0].
zD©aba£
);

91914 ifÐ
	gpIndex
==0 ){

91915 ifÐ!
ifExi¡s
 ){

91916 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch index: %S", 
pName
, 0);

91918 
sql™e3CodeV”ifyNamedSchema
(
pP¬£
, 
pName
->
a
[0].
zD©aba£
);

91920 
	gpP¬£
->
	gcheckSchema
 = 1;

91921 
	gex™_drÝ_šdex
;

91923 ifÐ
	gpIndex
->
	gidxTy³
!=
SQLITE_IDXTYPE_APPDEF
 ){

91924 
sql™e3E¼ÜMsg
(
pP¬£
, "index‡ssociated with UNIQUE "

91926 
	gex™_drÝ_šdex
;

91928 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pIndex
->
pSchema
);

91929 #iâdeà
SQLITE_OMIT_AUTHORIZATION


91931 
	gcode
 = 
SQLITE_DROP_INDEX
;

91932 
TabË
 *
	gpTab
 = 
pIndex
->
pTabË
;

91933 cÚ¡ *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

91934 cÚ¡ *
	gzTab
 = 
SCHEMA_TABLE
(
iDb
);

91935 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_DELETE
, 
zTab
, 0, 
zDb
) ){

91936 
	gex™_drÝ_šdex
;

91938 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
 ) 
	gcode
 = 
SQLITE_DROP_TEMP_INDEX
;

91939 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
code
, 
pIndex
->
zName
, 
pTab
->zName, 
zDb
) ){

91940 
	gex™_drÝ_šdex
;

91946 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

91947 ifÐ
	gv
 ){

91948 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

91949 
sql™e3Ne¡edP¬£
(
pP¬£
,

91951 
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb), 
pIndex
->zName

91953 
sql™e3CË¬StTabËs
(
pP¬£
, 
iDb
, "idx", 
pIndex
->
zName
);

91954 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

91955 
de¡royRoÙPage
(
pP¬£
, 
pIndex
->
Šum
, 
iDb
);

91956 
sql™e3VdbeAddOp4
(
v
, 
OP_DrÝIndex
, 
iDb
, 0, 0, 
pIndex
->
zName
, 0);

91959 
	gex™_drÝ_šdex
:

91960 
sql™e3SrcLi¡D–‘e
(
db
, 
pName
);

91980 
SQLITE_PRIVATE
 *
sql™e3A¼ayAÎoÿ‹
(

91981 
sql™e3
 *
db
,

91982 *
pA¼ay
,

91983 
szEÁry
,

91984 *
²EÁry
,

91985 *
pIdx


91987 *
	gz
;

91988 
	gn
 = *
²EÁry
;

91989 ifÐ(
	gn
 & (n-1))==0 ){

91990 
sz
 = (
n
==0) ? 1 : 2*n;

91991 *
	gpNew
 = 
sql™e3DbR—Îoc
(
db
, 
pA¼ay
, 
sz
*
szEÁry
);

91992 ifÐ
	gpNew
==0 ){

91993 *
pIdx
 = -1;

91994  
	gpA¼ay
;

91996 
	gpA¼ay
 = 
pNew
;

91998 
	gz
 = (*)
pA¼ay
;

91999 
mem£t
(&
z
[
n
 * 
szEÁry
], 0, szEntry);

92000 *
	gpIdx
 = 
n
;

92001 ++*
	g²EÁry
;

92002  
	gpA¼ay
;

92011 
SQLITE_PRIVATE
 
IdLi¡
 *
sql™e3IdLi¡Aµ’d
(
sql™e3
 *
db
, IdLi¡ *
pLi¡
, 
Tok’
 *
pTok’
){

92012 
	gi
;

92013 ifÐ
	gpLi¡
==0 ){

92014 
pLi¡
 = 
sql™e3DbM®locZ”o
(
db
, (
IdLi¡
) );

92015 ifÐ
	gpLi¡
==0 )  0;

92017 
	gpLi¡
->
	ga
 = 
sql™e3A¼ayAÎoÿ‹
(

92018 
db
,

92019 
pLi¡
->
a
,

92020 (
pLi¡
->
a
[0]),

92021 &
pLi¡
->
nId
,

92022 &
i


92024 ifÐ
	gi
<0 ){

92025 
sql™e3IdLi¡D–‘e
(
db
, 
pLi¡
);

92028 
	gpLi¡
->
	ga
[
i
].
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pTok’
);

92029  
	gpLi¡
;

92035 
SQLITE_PRIVATE
 
sql™e3IdLi¡D–‘e
(
sql™e3
 *
db
, 
IdLi¡
 *
pLi¡
){

92036 
	gi
;

92037 ifÐ
	gpLi¡
==0 ) ;

92038 
	gi
=0; i<
	gpLi¡
->
	gnId
; i++){

92039 
sql™e3DbF»e
(
db
, 
pLi¡
->
a
[
i
].
zName
);

92041 
sql™e3DbF»e
(
db
, 
pLi¡
->
a
);

92042 
sql™e3DbF»e
(
db
, 
pLi¡
);

92049 
SQLITE_PRIVATE
 
sql™e3IdLi¡Index
(
IdLi¡
 *
pLi¡
, cÚ¡ *
zName
){

92050 
	gi
;

92051 ifÐ
	gpLi¡
==0 )  -1;

92052 
	gi
=0; i<
	gpLi¡
->
	gnId
; i++){

92053 ifÐ
sql™e3SŒICmp
(
pLi¡
->
a
[
i
].
zName
, zName)==0 )  i;

92077 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡EÆ¬ge
(

92078 
sql™e3
 *
db
,

92079 
SrcLi¡
 *
pSrc
,

92080 
nExŒa
,

92081 
iS¹


92083 
	gi
;

92086 
as£¹
Ð
iS¹
>=0 );

92087 
as£¹
Ð
nExŒa
>=1 );

92088 
as£¹
Ð
pSrc
!=0 );

92089 
as£¹
Ð
iS¹
<=
pSrc
->
nSrc
 );

92092 ifÐ(
	gu32
)
	gpSrc
->
	gnSrc
+
	gnExŒa
>pSrc->
	gnAÎoc
 ){

92093 
SrcLi¡
 *
	gpNew
;

92094 
	gnAÎoc
 = 
pSrc
->
nSrc
+
nExŒa
;

92095 
	gnGÙ
;

92096 
	gpNew
 = 
sql™e3DbR—Îoc
(
db
, 
pSrc
,

92097 (*
pSrc
è+ (
nAÎoc
-1)*ÕSrc->
a
[0]) );

92098 ifÐ
	gpNew
==0 ){

92099 
as£¹
Ð
db
->
m®locFažed
 );

92100  
	gpSrc
;

92102 
	gpSrc
 = 
pNew
;

92103 
	gnGÙ
 = (
sql™e3DbM®locSize
(
db
, 
pNew
è- (*
	gpSrc
))/ÕSrc->
	ga
[0])+1;

92104 
	gpSrc
->
	gnAÎoc
 = 
nGÙ
;

92109 
	gi
=
pSrc
->
nSrc
-1; i>=
iS¹
; i--){

92110 
	gpSrc
->
	ga
[
i
+
nExŒa
] = 
pSrc
->
a
[i];

92112 
	gpSrc
->
	gnSrc
 +ð
nExŒa
;

92115 
mem£t
(&
pSrc
->
a
[
iS¹
], 0, ÕSrc->a[0])*
nExŒa
);

92116 
	gi
=
iS¹
; i<
	giS¹
+
	gnExŒa
; i++){

92117 
	gpSrc
->
	ga
[
i
].
	giCursÜ
 = -1;

92121  
	gpSrc
;

92159 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Aµ’d
(

92160 
sql™e3
 *
db
,

92161 
SrcLi¡
 *
pLi¡
,

92162 
Tok’
 *
pTabË
,

92163 
Tok’
 *
pD©aba£


92165 
SrcLi¡_™em
 *
	gpI‹m
;

92166 
as£¹
Ð
pD©aba£
==0 || 
pTabË
!=0 );

92167 ifÐ
	gpLi¡
==0 ){

92168 
pLi¡
 = 
sql™e3DbM®locZ”o
(
db
, (
SrcLi¡
) );

92169 ifÐ
	gpLi¡
==0 )  0;

92170 
	gpLi¡
->
	gnAÎoc
 = 1;

92172 
	gpLi¡
 = 
sql™e3SrcLi¡EÆ¬ge
(
db
, 
pLi¡
, 1,…Li¡->
nSrc
);

92173 ifÐ
	gdb
->
	gm®locFažed
 ){

92174 
sql™e3SrcLi¡D–‘e
(
db
, 
pLi¡
);

92177 
	gpI‹m
 = &
pLi¡
->
a
[pLi¡->
nSrc
-1];

92178 ifÐ
	gpD©aba£
 &&…D©aba£->
	gz
==0 ){

92179 
pD©aba£
 = 0;

92181 ifÐ
	gpD©aba£
 ){

92182 
Tok’
 *
	gpTemp
 = 
pD©aba£
;

92183 
	gpD©aba£
 = 
pTabË
;

92184 
	gpTabË
 = 
pTemp
;

92186 
	gpI‹m
->
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pTabË
);

92187 
	gpI‹m
->
	gzD©aba£
 = 
sql™e3NameFromTok’
(
db
, 
pD©aba£
);

92188  
	gpLi¡
;

92194 
SQLITE_PRIVATE
 
sql™e3SrcLi¡AssignCursÜs
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pLi¡
){

92195 
	gi
;

92196 
SrcLi¡_™em
 *
	gpI‹m
;

92197 
as£¹
(
pLi¡
 || 
pP¬£
->
db
->
m®locFažed
 );

92198 ifÐ
	gpLi¡
 ){

92199 
	gi
=0, 
	gpI‹m
=
pLi¡
->
a
; i<
	gpLi¡
->
	gnSrc
; i++,…Item++){

92200 ifÐ
	gpI‹m
->
	giCursÜ
>=0 ) ;

92201 
	gpI‹m
->
	giCursÜ
 = 
pP¬£
->
nTab
++;

92202 ifÐ
	gpI‹m
->
	gpS–eù
 ){

92203 
sql™e3SrcLi¡AssignCursÜs
(
pP¬£
, 
pI‹m
->
pS–eù
->
pSrc
);

92212 
SQLITE_PRIVATE
 
sql™e3SrcLi¡D–‘e
(
sql™e3
 *
db
, 
SrcLi¡
 *
pLi¡
){

92213 
	gi
;

92214 
SrcLi¡_™em
 *
	gpI‹m
;

92215 ifÐ
	gpLi¡
==0 ) ;

92216 
	gpI‹m
=
pLi¡
->
a
, 
	gi
=0; i<
	gpLi¡
->
	gnSrc
; i++,…Item++){

92217 
sql™e3DbF»e
(
db
, 
pI‹m
->
zD©aba£
);

92218 
sql™e3DbF»e
(
db
, 
pI‹m
->
zName
);

92219 
sql™e3DbF»e
(
db
, 
pI‹m
->
zAlŸs
);

92220 
sql™e3DbF»e
(
db
, 
pI‹m
->
zIndex
);

92221 
sql™e3D–‘eTabË
(
db
, 
pI‹m
->
pTab
);

92222 
sql™e3S–eùD–‘e
(
db
, 
pI‹m
->
pS–eù
);

92223 
sql™e3Ex´D–‘e
(
db
, 
pI‹m
->
pOn
);

92224 
sql™e3IdLi¡D–‘e
(
db
, 
pI‹m
->
pUsšg
);

92226 
sql™e3DbF»e
(
db
, 
pLi¡
);

92245 
SQLITE_PRIVATE
 
SrcLi¡
 *
sql™e3SrcLi¡Aµ’dFromT”m
(

92246 
P¬£
 *
pP¬£
,

92247 
SrcLi¡
 *
p
,

92248 
Tok’
 *
pTabË
,

92249 
Tok’
 *
pD©aba£
,

92250 
Tok’
 *
pAlŸs
,

92251 
S–eù
 *
pSubqu”y
,

92252 
Ex´
 *
pOn
,

92253 
IdLi¡
 *
pUsšg


92255 
SrcLi¡_™em
 *
	gpI‹m
;

92256 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92257 ifÐ!
	gp
 && (
	gpOn
 || 
	gpUsšg
) ){

92258 
sql™e3E¼ÜMsg
(
pP¬£
, "a JOIN clause is„equired before %s",

92259 (
pOn
 ? "ON" : "USING")

92261 
	g­³nd_äom_”rÜ
;

92263 
	gp
 = 
sql™e3SrcLi¡Aµ’d
(
db
, 
p
, 
pTabË
, 
pD©aba£
);

92264 ifÐ
	gp
==0 || 
NEVER
(
p
->
nSrc
==0) ){

92265 
­³nd_äom_”rÜ
;

92267 
	gpI‹m
 = &
p
->
a
[p->
nSrc
-1];

92268 
as£¹
Ð
pAlŸs
!=0 );

92269 ifÐ
	gpAlŸs
->
	gn
 ){

92270 
	gpI‹m
->
	gzAlŸs
 = 
sql™e3NameFromTok’
(
db
, 
pAlŸs
);

92272 
	gpI‹m
->
	gpS–eù
 = 
pSubqu”y
;

92273 
	gpI‹m
->
	gpOn
 = 
pOn
;

92274 
	gpI‹m
->
	gpUsšg
 = 
pUsšg
;

92275  
	gp
;

92277 
	g­³nd_äom_”rÜ
:

92278 
as£¹
Ð
p
==0 );

92279 
sql™e3Ex´D–‘e
(
db
, 
pOn
);

92280 
sql™e3IdLi¡D–‘e
(
db
, 
pUsšg
);

92281 
sql™e3S–eùD–‘e
(
db
, 
pSubqu”y
);

92289 
SQLITE_PRIVATE
 
sql™e3SrcLi¡IndexedBy
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
p
, 
Tok’
 *
pIndexedBy
){

92290 
as£¹
Ð
pIndexedBy
!=0 );

92291 ifÐ
	gp
 && 
ALWAYS
(
p
->
nSrc
>0) ){

92292 
SrcLi¡_™em
 *
	gpI‹m
 = &
p
->
a
[p->
nSrc
-1];

92293 
as£¹
Ð
pI‹m
->
nÙIndexed
==0 &&…I‹m->
zIndex
==0 );

92294 ifÐ
	gpIndexedBy
->
	gn
==1 && !
pIndexedBy
->
z
 ){

92297 
pI‹m
->
nÙIndexed
 = 1;

92299 
	gpI‹m
->
	gzIndex
 = 
sql™e3NameFromTok’
(
pP¬£
->
db
, 
pIndexedBy
);

92319 
SQLITE_PRIVATE
 
sql™e3SrcLi¡ShiáJošTy³
(
SrcLi¡
 *
p
){

92320 ifÐ
	gp
 ){

92321 
	gi
;

92322 
as£¹
Ð
p
->
a
 ||…->
nSrc
==0 );

92323 
	gi
=
p
->
nSrc
-1; i>0; i--){

92324 
	gp
->
	ga
[
i
].
	gjošty³
 = 
p
->
a
[i-1].
jošty³
;

92326 
	gp
->
	ga
[0].
	gjošty³
 = 0;

92333 
SQLITE_PRIVATE
 
sql™e3BegšT¿n§ùiÚ
(
P¬£
 *
pP¬£
, 
ty³
){

92334 
sql™e3
 *
	gdb
;

92335 
Vdbe
 *
	gv
;

92336 
	gi
;

92338 
as£¹
Ð
pP¬£
!=0 );

92339 
	gdb
 = 
pP¬£
->
db
;

92340 
as£¹
Ð
db
!=0 );

92342 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_TRANSACTION
, "BEGIN", 0, 0) ){

92345 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

92346 ifÐ!
	gv
 ) ;

92347 ifÐ
	gty³
!=
TK_DEFERRED
 ){

92348 
i
=0; 
	gi
<
	gdb
->
	gnDb
; i++){

92349 
sql™e3VdbeAddOp2
(
v
, 
OP_T¿n§ùiÚ
, 
i
, (
ty³
==
TK_EXCLUSIVE
)+1);

92350 
sql™e3VdbeU£sBŒ“
(
v
, 
i
);

92353 
sql™e3VdbeAddOp2
(
v
, 
OP_AutoComm™
, 0, 0);

92359 
SQLITE_PRIVATE
 
sql™e3Comm™T¿n§ùiÚ
(
P¬£
 *
pP¬£
){

92360 
Vdbe
 *
	gv
;

92362 
as£¹
Ð
pP¬£
!=0 );

92363 
as£¹
Ð
pP¬£
->
db
!=0 );

92364 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_TRANSACTION
, "COMMIT", 0, 0) ){

92367 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

92368 ifÐ
	gv
 ){

92369 
sql™e3VdbeAddOp2
(
v
, 
OP_AutoComm™
, 1, 0);

92376 
SQLITE_PRIVATE
 
sql™e3RÞlbackT¿n§ùiÚ
(
P¬£
 *
pP¬£
){

92377 
Vdbe
 *
	gv
;

92379 
as£¹
Ð
pP¬£
!=0 );

92380 
as£¹
Ð
pP¬£
->
db
!=0 );

92381 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_TRANSACTION
, "ROLLBACK", 0, 0) ){

92384 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

92385 ifÐ
	gv
 ){

92386 
sql™e3VdbeAddOp2
(
v
, 
OP_AutoComm™
, 1, 1);

92394 
SQLITE_PRIVATE
 
sql™e3Sav•ošt
(
P¬£
 *
pP¬£
, 
Ý
, 
Tok’
 *
pName
){

92395 *
	gzName
 = 
sql™e3NameFromTok’
(
pP¬£
->
db
, 
pName
);

92396 ifÐ
	gzName
 ){

92397 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

92398 #iâdeà
SQLITE_OMIT_AUTHORIZATION


92399 cÚ¡ * cÚ¡ 
	gaz
[] = { "BEGIN", "RELEASE", "ROLLBACK" };

92400 
as£¹
Ð!
SAVEPOINT_BEGIN
 && 
SAVEPOINT_RELEASE
==1 && 
SAVEPOINT_ROLLBACK
==2 );

92402 ifÐ!
	gv
 || 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_SAVEPOINT
, 
az
[
Ý
], 
zName
, 0) ){

92403 
sql™e3DbF»e
(
pP¬£
->
db
, 
zName
);

92406 
sql™e3VdbeAddOp4
(
v
, 
OP_Sav•ošt
, 
Ý
, 0, 0, 
zName
, 
P4_DYNAMIC
);

92414 
SQLITE_PRIVATE
 
sql™e3O³nTempD©aba£
(
P¬£
 *
pP¬£
){

92415 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92416 ifÐ
	gdb
->
	gaDb
[1].
	gpBt
==0 && !
pP¬£
->
ex¶aš
 ){

92417 
rc
;

92418 
BŒ“
 *
	gpBt
;

92419 cÚ¡ 
	gæags
 =

92420 
SQLITE_OPEN_READWRITE
 |

92421 
SQLITE_OPEN_CREATE
 |

92422 
SQLITE_OPEN_EXCLUSIVE
 |

92423 
SQLITE_OPEN_DELETEONCLOSE
 |

92424 
SQLITE_OPEN_TEMP_DB
;

92426 
	grc
 = 
sql™e3BŒ“O³n
(
db
->
pVfs
, 0, db, &
pBt
, 0, 
æags
);

92427 ifÐ
	grc
!=
SQLITE_OK
 ){

92428 
sql™e3E¼ÜMsg
(
pP¬£
, "unableo open‡emporary database "

92430 
	gpP¬£
->
	grc
 = 
rc
;

92433 
	gdb
->
	gaDb
[1].
	gpBt
 = 
pBt
;

92434 
as£¹
Ð
db
->
aDb
[1].
pSchema
 );

92435 ifÐ
	gSQLITE_NOMEM
==
sql™e3BŒ“S‘PageSize
(
pBt
, 
db
->
ÃxtPagesize
, -1, 0) ){

92436 
	gdb
->
	gm®locFažed
 = 1;

92449 
SQLITE_PRIVATE
 
sql™e3CodeV”ifySchema
(
P¬£
 *
pP¬£
, 
iDb
){

92450 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

92451 
sql™e3
 *
	gdb
 = 
pTÝËv–
->
db
;

92453 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

92454 
as£¹
Ð
db
->
aDb
[
iDb
].
pBt
!=0 || iDb==1 );

92455 
as£¹
Ð
iDb
<
SQLITE_MAX_ATTACHED
+2 );

92456 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

92457 ifÐ
DbMaskTe¡
(
pTÝËv–
->
cook›Mask
, 
iDb
)==0 ){

92458 
DbMaskS‘
(
pTÝËv–
->
cook›Mask
, 
iDb
);

92459 
	gpTÝËv–
->
	gcook›V®ue
[
iDb
] = 
db
->
aDb
[iDb].
pSchema
->
schema_cook›
;

92460 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
==1 ){

92461 
sql™e3O³nTempD©aba£
(
pTÝËv–
);

92470 
SQLITE_PRIVATE
 
sql™e3CodeV”ifyNamedSchema
(
P¬£
 *
pP¬£
, cÚ¡ *
zDb
){

92471 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92472 
	gi
;

92473 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

92474 
Db
 *
	gpDb
 = &
db
->
aDb
[
i
];

92475 ifÐ
	gpDb
->
	gpBt
 && (!
	gzDb
 || 0==
sql™e3SŒICmp
(
zDb
, 
pDb
->
zName
)) ){

92476 
sql™e3CodeV”ifySchema
(
pP¬£
, 
i
);

92494 
SQLITE_PRIVATE
 
sql™e3BegšWr™eO³¿tiÚ
(
P¬£
 *
pP¬£
, 
£tS‹m’t
, 
iDb
){

92495 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

92496 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

92497 
DbMaskS‘
(
pTÝËv–
->
wr™eMask
, 
iDb
);

92498 
	gpTÝËv–
->
	gisMuÉiWr™e
 |ð
£tS‹m’t
;

92508 
SQLITE_PRIVATE
 
sql™e3MuÉiWr™e
(
P¬£
 *
pP¬£
){

92509 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

92510 
	gpTÝËv–
->
	gisMuÉiWr™e
 = 1;

92529 
SQLITE_PRIVATE
 
sql™e3MayAbÜt
(
P¬£
 *
pP¬£
){

92530 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

92531 
	gpTÝËv–
->
	gmayAbÜt
 = 1;

92539 
SQLITE_PRIVATE
 
sql™e3H®tCÚ¡¿št
(

92540 
P¬£
 *
pP¬£
,

92541 
”rCode
,

92542 
ÚE¼Ü
,

92543 *
p4
,

92544 
i8
 
p4ty³
,

92545 
u8
 
p5E¼msg


92547 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

92548 
as£¹
Ð(
”rCode
&0xff)==
SQLITE_CONSTRAINT
 );

92549 ifÐ
	gÚE¼Ü
==
OE_AbÜt
 ){

92550 
sql™e3MayAbÜt
(
pP¬£
);

92552 
sql™e3VdbeAddOp4
(
v
, 
OP_H®t
, 
”rCode
, 
ÚE¼Ü
, 0, 
p4
, 
p4ty³
);

92553 ifÐ
	gp5E¼msg
 ) 
sql™e3VdbeChªgeP5
(
v
, 
p5E¼msg
);

92559 
SQLITE_PRIVATE
 
sql™e3UniqueCÚ¡¿št
(

92560 
P¬£
 *
pP¬£
,

92561 
ÚE¼Ü
,

92562 
Index
 *
pIdx


92564 *
	gzE¼
;

92565 
	gj
;

92566 
SŒAccum
 
	g”rMsg
;

92567 
TabË
 *
	gpTab
 = 
pIdx
->
pTabË
;

92569 
sql™e3SŒAccumIn™
(&
”rMsg
, 0, 0, 200);

92570 
	g”rMsg
.
	gdb
 = 
pP¬£
->
db
;

92571 
	gj
=0; j<
	gpIdx
->
	gnKeyCÞ
; j++){

92572 *
	gzCÞ
 = 
pTab
->
aCÞ
[
pIdx
->
aiCÞumn
[
j
]].
zName
;

92573 ifÐ
	gj
 ) 
sql™e3SŒAccumAµ’d
(&
”rMsg
, ", ", 2);

92574 
sql™e3SŒAccumAµ’dAÎ
(&
”rMsg
, 
pTab
->
zName
);

92575 
sql™e3SŒAccumAµ’d
(&
”rMsg
, ".", 1);

92576 
sql™e3SŒAccumAµ’dAÎ
(&
”rMsg
, 
zCÞ
);

92578 
	gzE¼
 = 
sql™e3SŒAccumFšish
(&
”rMsg
);

92579 
sql™e3H®tCÚ¡¿št
(
pP¬£
,

92580 
IsPrim¬yKeyIndex
(
pIdx
è? 
SQLITE_CONSTRAINT_PRIMARYKEY


92581 : 
SQLITE_CONSTRAINT_UNIQUE
,

92582 
ÚE¼Ü
, 
zE¼
, 
P4_DYNAMIC
, 
P5_CÚ¡¿štUnique
);

92589 
SQLITE_PRIVATE
 
sql™e3RowidCÚ¡¿št
(

92590 
P¬£
 *
pP¬£
,

92591 
ÚE¼Ü
,

92592 
TabË
 *
pTab


92594 *
	gzMsg
;

92595 
	grc
;

92596 ifÐ
	gpTab
->
	giPKey
>=0 ){

92597 
zMsg
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "%s.%s", 
pTab
->
zName
,

92598 
pTab
->
aCÞ
[pTab->
iPKey
].
zName
);

92599 
	grc
 = 
SQLITE_CONSTRAINT_PRIMARYKEY
;

92601 
	gzMsg
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "%s.rowid", 
pTab
->
zName
);

92602 
	grc
 = 
SQLITE_CONSTRAINT_ROWID
;

92604 
sql™e3H®tCÚ¡¿št
(
pP¬£
, 
rc
, 
ÚE¼Ü
, 
zMsg
, 
P4_DYNAMIC
,

92605 
P5_CÚ¡¿štUnique
);

92612 #iâdeà
SQLITE_OMIT_REINDEX


92613 
cÞÏtiÚM©ch
(cÚ¡ *
zCÞl
, 
Index
 *
pIndex
){

92614 
	gi
;

92615 
as£¹
Ð
zCÞl
!=0 );

92616 
	gi
=0; i<
	gpIndex
->
	gnCÞumn
; i++){

92617 cÚ¡ *
	gz
 = 
pIndex
->
azCÞl
[
i
];

92618 
as£¹
Ð
z
!=0 || 
pIndex
->
aiCÞumn
[
i
]<0 );

92619 ifÐ
	gpIndex
->
	gaiCÞumn
[
i
]>=0 && 0==
sql™e3SŒICmp
(
z
, 
zCÞl
) ){

92631 #iâdeà
SQLITE_OMIT_REINDEX


92632 
»šdexTabË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, cÚ¡ *
zCÞl
){

92633 
Index
 *
	gpIndex
;

92635 
	gpIndex
=
pTab
->
pIndex
;…Index;…IndexõIndex->
pNext
){

92636 ifÐ
zCÞl
==0 || 
cÞÏtiÚM©ch
(zCÞl, 
pIndex
) ){

92637 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

92638 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

92639 
sql™e3RefžlIndex
(
pP¬£
, 
pIndex
, -1);

92650 #iâdeà
SQLITE_OMIT_REINDEX


92651 
»šdexD©aba£s
(
P¬£
 *
pP¬£
, cÚ¡ *
zCÞl
){

92652 
Db
 *
	gpDb
;

92653 
	giDb
;

92654 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92655 
HashEËm
 *
	gk
;

92656 
TabË
 *
	gpTab
;

92658 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

92659 
	giDb
=0, 
	gpDb
=
db
->
aDb
; iDb<
	gdb
->
	gnDb
; iDb++,…Db++){

92660 
as£¹
Ð
pDb
!=0 );

92661 
	gk
=
sql™eHashFœ¡
(&
pDb
->
pSchema
->
tblHash
); k; k=
sql™eHashNext
(
k
)){

92662 
pTab
 = (
TabË
*)
sql™eHashD©a
(
k
);

92663 
»šdexTabË
(
pP¬£
, 
pTab
, 
zCÞl
);

92682 #iâdeà
SQLITE_OMIT_REINDEX


92683 
SQLITE_PRIVATE
 
sql™e3Rešdex
(
P¬£
 *
pP¬£
, 
Tok’
 *
pName1
, Tok’ *
pName2
){

92684 
CÞlSeq
 *
	gpCÞl
;

92685 *
	gz
;

92686 cÚ¡ *
	gzDb
;

92687 
TabË
 *
	gpTab
;

92688 
Index
 *
	gpIndex
;

92689 
	giDb
;

92690 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92691 
Tok’
 *
	gpObjName
;

92695 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

92699 ifÐ
	gpName1
==0 ){

92700 
»šdexD©aba£s
(
pP¬£
, 0);

92702 }ifÐ
NEVER
(
pName2
==0è||…Name2->
z
==0 ){

92703 *
zCÞl
;

92704 
as£¹
Ð
pName1
->
z
 );

92705 
	gzCÞl
 = 
sql™e3NameFromTok’
(
pP¬£
->
db
, 
pName1
);

92706 ifÐ!
	gzCÞl
 ) ;

92707 
	gpCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, 
ENC
(db), 
zCÞl
, 0);

92708 ifÐ
	gpCÞl
 ){

92709 
»šdexD©aba£s
(
pP¬£
, 
zCÞl
);

92710 
sql™e3DbF»e
(
db
, 
zCÞl
);

92713 
sql™e3DbF»e
(
db
, 
zCÞl
);

92715 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pObjName
);

92716 ifÐ
	giDb
<0 ) ;

92717 
	gz
 = 
sql™e3NameFromTok’
(
db
, 
pObjName
);

92718 ifÐ
	gz
==0 ) ;

92719 
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

92720 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
z
, 
zDb
);

92721 ifÐ
	gpTab
 ){

92722 
»šdexTabË
(
pP¬£
, 
pTab
, 0);

92723 
sql™e3DbF»e
(
db
, 
z
);

92726 
	gpIndex
 = 
sql™e3FšdIndex
(
db
, 
z
, 
zDb
);

92727 
sql™e3DbF»e
(
db
, 
z
);

92728 ifÐ
	gpIndex
 ){

92729 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

92730 
sql™e3RefžlIndex
(
pP¬£
, 
pIndex
, -1);

92733 
sql™e3E¼ÜMsg
(
pP¬£
, "unableo identifyhe objecto be„eindexed");

92747 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoOfIndex
(
P¬£
 *
pP¬£
, 
Index
 *
pIdx
){

92748 ifÐ
	gpP¬£
->
	gnE¼
 )  0;

92749 #iâdeà
SQLITE_OMIT_SHARED_CACHE


92750 ifÐ
	gpIdx
->
	gpKeyInfo
 &&…Idx->pKeyInfo->
	gdb
!=
pP¬£
->
db
 ){

92751 
sql™e3KeyInfoUÄef
(
pIdx
->
pKeyInfo
);

92752 
	gpIdx
->
	gpKeyInfo
 = 0;

92755 ifÐ
	gpIdx
->
	gpKeyInfo
==0 ){

92756 
i
;

92757 
	gnCÞ
 = 
pIdx
->
nCÞumn
;

92758 
	gnKey
 = 
pIdx
->
nKeyCÞ
;

92759 
KeyInfo
 *
	gpKey
;

92760 ifÐ
	gpIdx
->
	guniqNÙNuÎ
 ){

92761 
	gpKey
 = 
sql™e3KeyInfoAÎoc
(
pP¬£
->
db
, 
nKey
, 
nCÞ
-nKey);

92763 
	gpKey
 = 
sql™e3KeyInfoAÎoc
(
pP¬£
->
db
, 
nCÞ
, 0);

92765 ifÐ
	gpKey
 ){

92766 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pKey
) );

92767 
	gi
=0; i<
	gnCÞ
; i++){

92768 *
	gzCÞl
 = 
pIdx
->
azCÞl
[
i
];

92769 
as£¹
Ð
zCÞl
!=0 );

92770 
	gpKey
->
	gaCÞl
[
i
] = 
¡rcmp
(
zCÞl
,"BINARY")==0 ? 0 :

92771 
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
zCÞl
);

92772 
	gpKey
->
	gaSÜtOrd”
[
i
] = 
pIdx
->
aSÜtOrd”
[i];

92774 ifÐ
	gpP¬£
->
	gnE¼
 ){

92775 
sql™e3KeyInfoUÄef
(
pKey
);

92777 
	gpIdx
->
	gpKeyInfo
 = 
pKey
;

92781  
sql™e3KeyInfoRef
(
pIdx
->
pKeyInfo
);

92784 #iâdeà
SQLITE_OMIT_CTE


92789 
SQLITE_PRIVATE
 
W™h
 *
sql™e3W™hAdd
(

92790 
P¬£
 *
pP¬£
,

92791 
W™h
 *
pW™h
,

92792 
Tok’
 *
pName
,

92793 
Ex´Li¡
 *
pArgli¡
,

92794 
S–eù
 *
pQu”y


92796 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92797 
W™h
 *
	gpNew
;

92798 *
	gzName
;

92802 
	gzName
 = 
sql™e3NameFromTok’
(
pP¬£
->
db
, 
pName
);

92803 ifÐ
	gzName
 && 
	gpW™h
 ){

92804 
	gi
;

92805 
	gi
=0; i<
	gpW™h
->
	gnC‹
; i++){

92806 ifÐ
sql™e3SŒICmp
(
zName
, 
pW™h
->
a
[
i
].zName)==0 ){

92807 
sql™e3E¼ÜMsg
(
pP¬£
, "du¶iÿ‹ WITHabË‚ame: %s", 
zName
);

92812 ifÐ
	gpW™h
 ){

92813 
	gnBy‹
 = (*
pW™h
è+ (ÕW™h->
a
[1]è*…W™h->
nC‹
);

92814 
	gpNew
 = 
sql™e3DbR—Îoc
(
db
, 
pW™h
, 
nBy‹
);

92816 
	gpNew
 = 
sql™e3DbM®locZ”o
(
db
, (*
pW™h
));

92818 
as£¹
Ð
zName
!=0 || 
pNew
==0 );

92819 
as£¹
Ð
db
->
m®locFažed
==0 || 
pNew
==0 );

92821 ifÐ
	gpNew
==0 ){

92822 
sql™e3Ex´Li¡D–‘e
(
db
, 
pArgli¡
);

92823 
sql™e3S–eùD–‘e
(
db
, 
pQu”y
);

92824 
sql™e3DbF»e
(
db
, 
zName
);

92825 
	gpNew
 = 
pW™h
;

92827 
	gpNew
->
	ga
[
pNew
->
nC‹
].
	gpS–eù
 = 
pQu”y
;

92828 
	gpNew
->
	ga
[
pNew
->
nC‹
].
	gpCÞs
 = 
pArgli¡
;

92829 
	gpNew
->
	ga
[
pNew
->
nC‹
].
	gzName
 = 
zName
;

92830 
	gpNew
->
	ga
[
pNew
->
nC‹
].
	gzE¼
 = 0;

92831 
	gpNew
->
	gnC‹
++;

92834  
	gpNew
;

92840 
SQLITE_PRIVATE
 
sql™e3W™hD–‘e
(
sql™e3
 *
db
, 
W™h
 *
pW™h
){

92841 ifÐ
	gpW™h
 ){

92842 
	gi
;

92843 
	gi
=0; i<
	gpW™h
->
	gnC‹
; i++){

92844 
C‹
 *
	gpC‹
 = &
pW™h
->
a
[
i
];

92845 
sql™e3Ex´Li¡D–‘e
(
db
, 
pC‹
->
pCÞs
);

92846 
sql™e3S–eùD–‘e
(
db
, 
pC‹
->
pS–eù
);

92847 
sql™e3DbF»e
(
db
, 
pC‹
->
zName
);

92849 
sql™e3DbF»e
(
db
, 
pW™h
);

92877 
ÿÎCÞlN“ded
(
sql™e3
 *
db
, 
’c
, cÚ¡ *
zName
){

92878 
as£¹
Ð!
db
->
xCÞlN“ded
 || !db->
xCÞlN“ded16
 );

92879 ifÐ
	gdb
->
	gxCÞlN“ded
 ){

92880 *
	gzEx‹º®
 = 
sql™e3DbSŒDup
(
db
, 
zName
);

92881 ifÐ!
	gzEx‹º®
 ) ;

92882 
	gdb
->
xCÞlN“ded
(
db
->
pCÞlN“dedArg
, db, 
’c
, 
zEx‹º®
);

92883 
sql™e3DbF»e
(
db
, 
zEx‹º®
);

92885 #iâdeà
SQLITE_OMIT_UTF16


92886 ifÐ
	gdb
->
	gxCÞlN“ded16
 ){

92887 cÚ¡ *
	gzEx‹º®
;

92888 
sql™e3_v®ue
 *
	gpTmp
 = 
sql™e3V®ueNew
(
db
);

92889 
sql™e3V®ueS‘SŒ
(
pTmp
, -1, 
zName
, 
SQLITE_UTF8
, 
SQLITE_STATIC
);

92890 
	gzEx‹º®
 = 
sql™e3V®ueText
(
pTmp
, 
SQLITE_UTF16NATIVE
);

92891 ifÐ
	gzEx‹º®
 ){

92892 
	gdb
->
xCÞlN“ded16
(
db
->
pCÞlN“dedArg
, db, ()
ENC
(db), 
zEx‹º®
);

92894 
sql™e3V®ueF»e
(
pTmp
);

92906 
syÁhCÞlSeq
(
sql™e3
 *
db
, 
CÞlSeq
 *
pCÞl
){

92907 
CÞlSeq
 *
	gpCÞl2
;

92908 *
	gz
 = 
pCÞl
->
zName
;

92909 
	gi
;

92910 cÚ¡ 
u8
 
	gaEnc
[] = { 
SQLITE_UTF16BE
, 
SQLITE_UTF16LE
, 
SQLITE_UTF8
 };

92911 
	gi
=0; i<3; i++){

92912 
	gpCÞl2
 = 
sql™e3FšdCÞlSeq
(
db
, 
aEnc
[
i
], 
z
, 0);

92913 ifÐ
	gpCÞl2
->
	gxCmp
!=0 ){

92914 
memýy
(
pCÞl
, 
pCÞl2
, (
CÞlSeq
));

92915 
	gpCÞl
->
	gxD–
 = 0;

92916  
	gSQLITE_OK
;

92919  
	gSQLITE_ERROR
;

92936 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3G‘CÞlSeq
(

92937 
P¬£
 *
pP¬£
,

92938 
u8
 
’c
,

92939 
CÞlSeq
 *
pCÞl
,

92940 cÚ¡ *
zName


92942 
CÞlSeq
 *
	gp
;

92943 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92945 
	gp
 = 
pCÞl
;

92946 ifÐ!
	gp
 ){

92947 
	gp
 = 
sql™e3FšdCÞlSeq
(
db
, 
’c
, 
zName
, 0);

92949 ifÐ!
	gp
 || !p->
	gxCmp
 ){

92953 
ÿÎCÞlN“ded
(
db
, 
’c
, 
zName
);

92954 
	gp
 = 
sql™e3FšdCÞlSeq
(
db
, 
’c
, 
zName
, 0);

92956 ifÐ
	gp
 && !p->
	gxCmp
 && 
syÁhCÞlSeq
(
db
, 
p
) ){

92957 
	gp
 = 0;

92959 
as£¹
Ð!
p
 ||…->
xCmp
 );

92960 ifÐ
	gp
==0 ){

92961 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch cÞÏtiÚ sequ’û: %s", 
zName
);

92963  
	gp
;

92977 
SQLITE_PRIVATE
 
sql™e3CheckCÞlSeq
(
P¬£
 *
pP¬£
, 
CÞlSeq
 *
pCÞl
){

92978 ifÐ
	gpCÞl
 ){

92979 cÚ¡ *
	gzName
 = 
pCÞl
->
zName
;

92980 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

92981 
CÞlSeq
 *
	gp
 = 
sql™e3G‘CÞlSeq
(
pP¬£
, 
ENC
(
db
), 
pCÞl
, 
zName
);

92982 ifÐ!
	gp
 ){

92983  
	gSQLITE_ERROR
;

92985 
as£¹
Ð
p
==
pCÞl
 );

92987  
	gSQLITE_OK
;

93005 
CÞlSeq
 *
fšdCÞlSeqEÁry
(

93006 
sql™e3
 *
db
,

93007 cÚ¡ *
zName
,

93008 
ü—‹


93010 
CÞlSeq
 *
	gpCÞl
;

93011 
	gpCÞl
 = 
sql™e3HashFšd
(&
db
->
aCÞlSeq
, 
zName
);

93013 ifÐ0==
pCÞl
 && 
ü—‹
 ){

93014 
nName
 = 
sql™e3SŒËn30
(
zName
);

93015 
	gpCÞl
 = 
sql™e3DbM®locZ”o
(
db
, 3*(*
pCÞl
è+ 
nName
 + 1);

93016 ifÐ
	gpCÞl
 ){

93017 
CÞlSeq
 *
	gpD–
 = 0;

93018 
	gpCÞl
[0].
	gzName
 = (*)&
pCÞl
[3];

93019 
	gpCÞl
[0].
	g’c
 = 
SQLITE_UTF8
;

93020 
	gpCÞl
[1].
	gzName
 = (*)&
pCÞl
[3];

93021 
	gpCÞl
[1].
	g’c
 = 
SQLITE_UTF16LE
;

93022 
	gpCÞl
[2].
	gzName
 = (*)&
pCÞl
[3];

93023 
	gpCÞl
[2].
	g’c
 = 
SQLITE_UTF16BE
;

93024 
memýy
(
pCÞl
[0].
zName
, zName, 
nName
);

93025 
	gpCÞl
[0].
	gzName
[
nName
] = 0;

93026 
	gpD–
 = 
sql™e3HashIn£¹
(&
db
->
aCÞlSeq
, 
pCÞl
[0].
zName
,…Coll);

93032 
as£¹
Ð
pD–
==0 ||…D–==
pCÞl
 );

93033 ifÐ
	gpD–
!=0 ){

93034 
db
->
m®locFažed
 = 1;

93035 
sql™e3DbF»e
(
db
, 
pD–
);

93036 
	gpCÞl
 = 0;

93040  
	gpCÞl
;

93058 
SQLITE_PRIVATE
 
CÞlSeq
 *
sql™e3FšdCÞlSeq
(

93059 
sql™e3
 *
db
,

93060 
u8
 
’c
,

93061 cÚ¡ *
zName
,

93062 
ü—‹


93064 
CÞlSeq
 *
	gpCÞl
;

93065 ifÐ
	gzName
 ){

93066 
	gpCÞl
 = 
fšdCÞlSeqEÁry
(
db
, 
zName
, 
ü—‹
);

93068 
	gpCÞl
 = 
db
->
pDætCÞl
;

93070 
as£¹
Ð
SQLITE_UTF8
==1 && 
SQLITE_UTF16LE
==2 && 
SQLITE_UTF16BE
==3 );

93071 
as£¹
Ð
’c
>=
SQLITE_UTF8
 &&ƒnc<=
SQLITE_UTF16BE
 );

93072 ifÐ
	gpCÞl
 )…CÞÈ+ð
’c
-1;

93073  
	gpCÞl
;

93104 
	#FUNC_PERFECT_MATCH
 6

	)

93105 
m©chQu®™y
(

93106 
FuncDef
 *
p
,

93107 
nArg
,

93108 
u8
 
’c


93110 
	gm©ch
;

93113 ifÐ
	gnArg
==(-2èè (
p
->
xFunc
==0 &&…->
xS‹p
==0è? 0 : 
FUNC_PERFECT_MATCH
;

93116 ifÐ
	gp
->
	gnArg
!=
nArg
 && 
p
->nArg>=0 )  0;

93120 ifÐ
	gp
->
	gnArg
==
nArg
 ){

93121 
m©ch
 = 4;

93123 
	gm©ch
 = 1;

93127 ifÐ
	g’c
==(
p
->
funcFÏgs
 & 
SQLITE_FUNC_ENCMASK
) ){

93128 
m©ch
 += 2;

93129 }ifÐ(
	g’c
 & 
	gp
->
	gfuncFÏgs
 & 2)!=0 ){

93130 
m©ch
 += 1;

93133  
	gm©ch
;

93140 
FuncDef
 *
funùiÚS—rch
(

93141 
FuncDefHash
 *
pHash
,

93142 
h
,

93143 cÚ¡ *
zFunc
,

93144 
nFunc


93146 
FuncDef
 *
	gp
;

93147 
	gp
=
pHash
->
a
[
h
];…;…=
p
->pHash){

93148 ifÐ
sql™e3SŒNICmp
(
p
->
zName
, 
zFunc
, 
nFunc
)==0 &&…->zName[nFunc]==0 ){

93149  
p
;

93158 
SQLITE_PRIVATE
 
sql™e3FuncDefIn£¹
(

93159 
FuncDefHash
 *
pHash
,

93160 
FuncDef
 *
pDef


93162 
FuncDef
 *
	gpOth”
;

93163 
	gnName
 = 
sql™e3SŒËn30
(
pDef
->
zName
);

93164 
u8
 
	gc1
 = (u8)
pDef
->
zName
[0];

93165 
	gh
 = (
sql™e3Uµ”ToLow”
[
c1
] + 
nName
è% 
A¼aySize
(
pHash
->
a
);

93166 
	gpOth”
 = 
funùiÚS—rch
(
pHash
, 
h
, 
pDef
->
zName
, 
nName
);

93167 ifÐ
	gpOth”
 ){

93168 
as£¹
Ð
pOth”
!=
pDef
 &&…Oth”->
pNext
!=pDef );

93169 
	gpDef
->
	gpNext
 = 
pOth”
->
pNext
;

93170 
	gpOth”
->
	gpNext
 = 
pDef
;

93172 
	gpDef
->
	gpNext
 = 0;

93173 
	gpDef
->
	gpHash
 = 
pHash
->
a
[
h
];

93174 
	gpHash
->
	ga
[
h
] = 
pDef
;

93199 
SQLITE_PRIVATE
 
FuncDef
 *
sql™e3FšdFunùiÚ
(

93200 
sql™e3
 *
db
,

93201 cÚ¡ *
zName
,

93202 
nName
,

93203 
nArg
,

93204 
u8
 
’c
,

93205 
u8
 
ü—‹FÏg


93207 
FuncDef
 *
	gp
;

93208 
FuncDef
 *
	gpBe¡
 = 0;

93209 
	gbe¡ScÜe
 = 0;

93210 
	gh
;

93212 
as£¹
Ð
nArg
>=(-2) );

93213 
as£¹
Ð
nArg
>=(-1è|| 
ü—‹FÏg
==0 );

93214 
	gh
 = (
sql™e3Uµ”ToLow”
[(
u8
)
zName
[0]] + 
nName
è% 
A¼aySize
(
db
->
aFunc
.
a
);

93218 
	gp
 = 
funùiÚS—rch
(&
db
->
aFunc
, 
h
, 
zName
, 
nName
);

93219  
	gp
 ){

93220 
	gscÜe
 = 
m©chQu®™y
(
p
, 
nArg
, 
’c
);

93221 ifÐ
	gscÜe
>
	gbe¡ScÜe
 ){

93222 
	gpBe¡
 = 
p
;

93223 
	gbe¡ScÜe
 = 
scÜe
;

93225 
	gp
 = 
p
->
pNext
;

93240 ifÐ!
	gü—‹FÏg
 && (
	gpBe¡
==0 || (
db
->
æags
 & 
SQLITE_P»ãrBužtš
)!=0) ){

93241 
FuncDefHash
 *
pHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

93242 
	gbe¡ScÜe
 = 0;

93243 
	gp
 = 
funùiÚS—rch
(
pHash
, 
h
, 
zName
, 
nName
);

93244  
	gp
 ){

93245 
	gscÜe
 = 
m©chQu®™y
(
p
, 
nArg
, 
’c
);

93246 ifÐ
	gscÜe
>
	gbe¡ScÜe
 ){

93247 
	gpBe¡
 = 
p
;

93248 
	gbe¡ScÜe
 = 
scÜe
;

93250 
	gp
 = 
p
->
pNext
;

93258 ifÐ
	gü—‹FÏg
 && 
	gbe¡ScÜe
<
	gFUNC_PERFECT_MATCH
 &&

93259 (
	gpBe¡
 = 
sql™e3DbM®locZ”o
(
db
, (*
pBe¡
)+
nName
+1))!=0 ){

93260 
pBe¡
->
zName
 = (*)&pBest[1];

93261 
	gpBe¡
->
	gnArg
 = (
u16
)
nArg
;

93262 
	gpBe¡
->
	gfuncFÏgs
 = 
’c
;

93263 
memýy
(
pBe¡
->
zName
, zName, 
nName
);

93264 
	gpBe¡
->
	gzName
[
nName
] = 0;

93265 
sql™e3FuncDefIn£¹
(&
db
->
aFunc
, 
pBe¡
);

93268 ifÐ
	gpBe¡
 && (pBe¡->
	gxS‹p
 ||…Be¡->
	gxFunc
 || 
	gü—‹FÏg
) ){

93269  
	gpBe¡
;

93282 
SQLITE_PRIVATE
 
sql™e3SchemaCË¬
(*
p
){

93283 
Hash
 
	g‹mp1
;

93284 
Hash
 
	g‹mp2
;

93285 
HashEËm
 *
	gpEËm
;

93286 
Schema
 *
	gpSchema
 = (Schem¨*)
p
;

93288 
	g‹mp1
 = 
pSchema
->
tblHash
;

93289 
	g‹mp2
 = 
pSchema
->
ŒigHash
;

93290 
sql™e3HashIn™
(&
pSchema
->
ŒigHash
);

93291 
sql™e3HashCË¬
(&
pSchema
->
idxHash
);

93292 
	gpEËm
=
sql™eHashFœ¡
(&
‹mp2
);…EËm;…EËm=
sql™eHashNext
(
pEËm
)){

93293 
sql™e3D–‘eTrigg”
(0, (
Trigg”
*)
sql™eHashD©a
(
pEËm
));

93295 
sql™e3HashCË¬
(&
‹mp2
);

93296 
sql™e3HashIn™
(&
pSchema
->
tblHash
);

93297 
	gpEËm
=
sql™eHashFœ¡
(&
‹mp1
);…EËm;…EËm=
sql™eHashNext
(
pEËm
)){

93298 
TabË
 *
pTab
 = 
sql™eHashD©a
(
pEËm
);

93299 
sql™e3D–‘eTabË
(0, 
pTab
);

93301 
sql™e3HashCË¬
(&
‹mp1
);

93302 
sql™e3HashCË¬
(&
pSchema
->
fkeyHash
);

93303 
	gpSchema
->
	gpSeqTab
 = 0;

93304 ifÐ
	gpSchema
->
	gschemaFÏgs
 & 
	gDB_SchemaLßded
 ){

93305 
	gpSchema
->
	giG’”©iÚ
++;

93306 
	gpSchema
->
	gschemaFÏgs
 &ð~
DB_SchemaLßded
;

93314 
SQLITE_PRIVATE
 
Schema
 *
sql™e3SchemaG‘
(
sql™e3
 *
db
, 
BŒ“
 *
pBt
){

93315 
Schema
 * 
	gp
;

93316 ifÐ
	gpBt
 ){

93317 
	gp
 = (
Schema
 *)
sql™e3BŒ“Schema
(
pBt
, (Schema), 
sql™e3SchemaCË¬
);

93319 
	gp
 = (
Schema
 *)
sql™e3DbM®locZ”o
(0, (Schema));

93321 ifÐ!
	gp
 ){

93322 
	gdb
->
	gm®locFažed
 = 1;

93323 }iàÐ0==
p
->
fže_fÜm©
 ){

93324 
sql™e3HashIn™
(&
p
->
tblHash
);

93325 
sql™e3HashIn™
(&
p
->
idxHash
);

93326 
sql™e3HashIn™
(&
p
->
ŒigHash
);

93327 
sql™e3HashIn™
(&
p
->
fkeyHash
);

93328 
	gp
->
	g’c
 = 
SQLITE_UTF8
;

93330  
	gp
;

93364 
SQLITE_PRIVATE
 
TabË
 *
sql™e3SrcLi¡Lookup
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pSrc
){

93365 
SrcLi¡_™em
 *
	gpI‹m
 = 
pSrc
->
a
;

93366 
TabË
 *
	gpTab
;

93367 
as£¹
Ð
pI‹m
 && 
pSrc
->
nSrc
==1 );

93368 
	gpTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, 
pI‹m
);

93369 
sql™e3D–‘eTabË
(
pP¬£
->
db
, 
pI‹m
->
pTab
);

93370 
	gpI‹m
->
	gpTab
 = 
pTab
;

93371 ifÐ
	gpTab
 ){

93372 
	gpTab
->
	gnRef
++;

93374 ifÐ
sql™e3IndexedByLookup
(
pP¬£
, 
pI‹m
) ){

93375 
	gpTab
 = 0;

93377  
	gpTab
;

93385 
SQLITE_PRIVATE
 
sql™e3IsR—dOÆy
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, 
v›wOk
){

93396 ifÐÐ
IsVœtu®
(
pTab
)

93397 && 
sql™e3G‘VTabË
(
pP¬£
->
db
, 
pTab
)->
	gpMod
->
	gpModuË
->
	gxUpd©e
==0 )

93398 || ( (
pTab
->
bFÏgs
 & 
TF_R—dÚly
)!=0

93399 && (
pP¬£
->
db
->
æags
 & 
SQLITE_Wr™eSchema
)==0

93400 && 
pP¬£
->
Ã¡ed
==0 )

93402 
sql™e3E¼ÜMsg
(
pP¬£
, "bË % may‚Ù bmodif›d", 
pTab
->
zName
);

93406 #iâdeà
SQLITE_OMIT_VIEW


93407 ifÐ!
	gv›wOk
 && 
	gpTab
->
	gpS–eù
 ){

93408 
sql™e3E¼ÜMsg
(
pP¬£
,"ÿÂÙ modify % beÿu£ iˆi ¨v›w",
pTab
->
zName
);

93416 #ià!
defšed
(
SQLITE_OMIT_VIEW
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

93422 
SQLITE_PRIVATE
 
sql™e3M©”ŸlizeV›w
(

93423 
P¬£
 *
pP¬£
,

93424 
TabË
 *
pV›w
,

93425 
Ex´
 *
pWh”e
,

93426 
iCur


93428 
S–eùDe¡
 
	gde¡
;

93429 
S–eù
 *
	gpS–
;

93430 
SrcLi¡
 *
	gpFrom
;

93431 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

93432 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pV›w
->
pSchema
);

93433 
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
pWh”e
, 0);

93434 
	gpFrom
 = 
sql™e3SrcLi¡Aµ’d
(
db
, 0, 0, 0);

93435 ifÐ
	gpFrom
 ){

93436 
as£¹
Ð
pFrom
->
nSrc
==1 );

93437 
	gpFrom
->
	ga
[0].
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pV›w
->
zName
);

93438 
	gpFrom
->
	ga
[0].
	gzD©aba£
 = 
sql™e3DbSŒDup
(
db
, db->
aDb
[
iDb
].
zName
);

93439 
as£¹
Ð
pFrom
->
a
[0].
pOn
==0 );

93440 
as£¹
Ð
pFrom
->
a
[0].
pUsšg
==0 );

93442 
	gpS–
 = 
sql™e3S–eùNew
(
pP¬£
, 0, 
pFrom
, 
pWh”e
, 0, 0, 0, 0, 0, 0);

93443 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_EphemTab
, 
iCur
);

93444 
sql™e3S–eù
(
pP¬£
, 
pS–
, &
de¡
);

93445 
sql™e3S–eùD–‘e
(
db
, 
pS–
);

93449 #ià
defšed
(
SQLITE_ENABLE_UPDATE_DELETE_LIMIT
è&& !defšed(
SQLITE_OMIT_SUBQUERY
)

93458 
SQLITE_PRIVATE
 
Ex´
 *
sql™e3Lim™Wh”e
(

93459 
P¬£
 *
pP¬£
,

93460 
SrcLi¡
 *
pSrc
,

93461 
Ex´
 *
pWh”e
,

93462 
Ex´Li¡
 *
pOrd”By
,

93463 
Ex´
 *
pLim™
,

93464 
Ex´
 *
pOff£t
,

93465 *
zStmtTy³


93467 
Ex´
 *
	gpWh”eRowid
 = 
NULL
;

93468 
Ex´
 *
	gpInCÏu£
 = 
NULL
;

93469 
Ex´
 *
	gpS–eùRowid
 = 
NULL
;

93470 
Ex´Li¡
 *
	gpELi¡
 = 
NULL
;

93471 
SrcLi¡
 *
	gpS–eùSrc
 = 
NULL
;

93472 
S–eù
 *
	gpS–eù
 = 
NULL
;

93476 ifÐ
	gpOrd”By
 && (
	gpLim™
 == 0) ) {

93477 
sql™e3E¼ÜMsg
(
pP¬£
, "ORDER BY w™houˆLIMIT oÀ%s", 
zStmtTy³
);

93478 
	glim™_wh”e_þ—nup_2
;

93484 ifÐ
	gpLim™
 == 0 ) {

93486 
as£¹
Ð
pOff£t
 == 0 );

93487  
	gpWh”e
;

93499 
	gpS–eùRowid
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ROW
, 0, 0, 0);

93500 ifÐ
	gpS–eùRowid
 =ð0 ) 
lim™_wh”e_þ—nup_2
;

93501 
	gpELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
pS–eùRowid
);

93502 ifÐ
	gpELi¡
 =ð0 ) 
lim™_wh”e_þ—nup_2
;

93506 
	gpS–eùSrc
 = 
sql™e3SrcLi¡Dup
(
pP¬£
->
db
, 
pSrc
, 0);

93507 ifÐ
	gpS–eùSrc
 == 0 ) {

93508 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
pELi¡
);

93509 
	glim™_wh”e_þ—nup_2
;

93513 
	gpS–eù
 = 
sql™e3S–eùNew
(
pP¬£
,
pELi¡
,
pS–eùSrc
,
pWh”e
,0,0,

93514 
pOrd”By
,0,
pLim™
,
pOff£t
);

93515 ifÐ
	gpS–eù
 == 0 )  0;

93518 
	gpWh”eRowid
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ROW
, 0, 0, 0);

93519 ifÐ
	gpWh”eRowid
 =ð0 ) 
lim™_wh”e_þ—nup_1
;

93520 
	gpInCÏu£
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IN
, 
pWh”eRowid
, 0, 0);

93521 ifÐ
	gpInCÏu£
 =ð0 ) 
lim™_wh”e_þ—nup_1
;

93523 
	gpInCÏu£
->
	gx
.
	gpS–eù
 = 
pS–eù
;

93524 
	gpInCÏu£
->
	gæags
 |ð
EP_xIsS–eù
;

93525 
sql™e3Ex´S‘Height
(
pP¬£
, 
pInCÏu£
);

93526  
	gpInCÏu£
;

93529 
	glim™_wh”e_þ—nup_1
:

93530 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
pS–eù
);

93533 
	glim™_wh”e_þ—nup_2
:

93534 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
pWh”e
);

93535 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
pOrd”By
);

93536 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
pLim™
);

93537 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
pOff£t
);

93550 
SQLITE_PRIVATE
 
sql™e3D–‘eFrom
(

93551 
P¬£
 *
pP¬£
,

93552 
SrcLi¡
 *
pTabLi¡
,

93553 
Ex´
 *
pWh”e


93555 
Vdbe
 *
	gv
;

93556 
TabË
 *
	gpTab
;

93557 cÚ¡ *
	gzDb
;

93558 
	gi
;

93559 
Wh”eInfo
 *
	gpWInfo
;

93560 
Index
 *
	gpIdx
;

93561 
	giTabCur
;

93562 
	giD©aCur
;

93563 
	giIdxCur
;

93564 
	gnIdx
;

93565 
sql™e3
 *
	gdb
;

93566 
AuthCÚ‹xt
 
	gsCÚ‹xt
;

93567 
NameCÚ‹xt
 
	gsNC
;

93568 
	giDb
;

93569 
	gmemCÁ
 = -1;

93570 
	grÿuth
;

93571 
	gokOÃPass
;

93572 
	gaiCurOÃPass
[2];

93573 
u8
 *
	gaToO³n
 = 0;

93574 
Index
 *
	gpPk
;

93575 
	giPk
 = 0;

93576 
i16
 
	gnPk
 = 1;

93577 
	giKey
;

93578 
i16
 
	gnKey
;

93579 
	giEphCur
 = 0;

93580 
	giRowS‘
 = 0;

93581 
	gaddrBy·ss
 = 0;

93582 
	gaddrLoÝ
 = 0;

93583 
	gaddrD–‘e
 = 0;

93584 
	gaddrEphO³n
 = 0;

93586 #iâdeà
SQLITE_OMIT_TRIGGER


93587 
	gisV›w
;

93588 
Trigg”
 *
	gpTrigg”
;

93591 
mem£t
(&
sCÚ‹xt
, 0, (sContext));

93592 
	gdb
 = 
pP¬£
->
db
;

93593 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ){

93594 
	gd–‘e_äom_þ—nup
;

93596 
as£¹
Ð
pTabLi¡
->
nSrc
==1 );

93603 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTabLi¡
);

93604 ifÐ
	gpTab
==0 ) 
d–‘e_äom_þ—nup
;

93609 #iâdeà
SQLITE_OMIT_TRIGGER


93610 
	gpTrigg”
 = 
sql™e3Trigg”sExi¡
(
pP¬£
, 
pTab
, 
TK_DELETE
, 0, 0);

93611 
	gisV›w
 = 
pTab
->
pS–eù
!=0;

93613 
	#pTrigg”
 0

	)

93614 
	#isV›w
 0

	)

93616 #ifdeà
SQLITE_OMIT_VIEW


93617 #undeà
isV›w


93618 
	#isV›w
 0

	)

93623 ifÐ
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
) ){

93624 
	gd–‘e_äom_þ—nup
;

93627 ifÐ
sql™e3IsR—dOÆy
(
pP¬£
, 
pTab
, (
pTrigg”
?1:0)) ){

93628 
d–‘e_äom_þ—nup
;

93630 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

93631 
as£¹
Ð
iDb
<
db
->
nDb
 );

93632 
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

93633 
	grÿuth
 = 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_DELETE
, 
pTab
->
zName
, 0, 
zDb
);

93634 
as£¹
Ð
rÿuth
==
SQLITE_OK
 ||„ÿuth==
SQLITE_DENY
 ||„ÿuth==
SQLITE_IGNORE
 );

93635 ifÐ
	grÿuth
==
SQLITE_DENY
 ){

93636 
d–‘e_äom_þ—nup
;

93638 
as£¹
(!
isV›w
 || 
pTrigg”
);

93642 
as£¹
Ð
pTabLi¡
->
nSrc
==1 );

93643 
	giTabCur
 = 
pTabLi¡
->
a
[0].
iCursÜ
 = 
pP¬£
->
nTab
++;

93644 
	gnIdx
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
,‚Idx++){

93645 
	gpP¬£
->
	gnTab
++;

93650 ifÐ
	gisV›w
 ){

93651 
sql™e3AuthCÚ‹xtPush
(
pP¬£
, &
sCÚ‹xt
, 
pTab
->
zName
);

93656 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

93657 ifÐ
	gv
==0 ){

93658 
d–‘e_äom_þ—nup
;

93660 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 ) 
sql™e3VdbeCouÁChªges
(
v
);

93661 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

93666 #ià!
defšed
(
SQLITE_OMIT_VIEW
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

93667 ifÐ
	gisV›w
 ){

93668 
sql™e3M©”ŸlizeV›w
(
pP¬£
, 
pTab
, 
pWh”e
, 
iTabCur
);

93669 
	giD©aCur
 = 
iIdxCur
 = 
iTabCur
;

93675 
mem£t
(&
sNC
, 0, (sNC));

93676 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

93677 
	gsNC
.
	gpSrcLi¡
 = 
pTabLi¡
;

93678 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pWh”e
) ){

93679 
	gd–‘e_äom_þ—nup
;

93685 ifÐ
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
 ){

93686 
	gmemCÁ
 = ++
pP¬£
->
nMem
;

93687 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
memCÁ
);

93690 #iâdeà
SQLITE_OMIT_TRUNCATE_OPTIMIZATION


93695 ifÐ
	grÿuth
==
SQLITE_OK
 && 
pWh”e
==0 && !
pTrigg”
 && !
IsVœtu®
(
pTab
)

93696 && 0==
sql™e3FkRequœed
(
pP¬£
, 
pTab
, 0, 0)

93698 
as£¹
Ð!
isV›w
 );

93699 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 1,…Tab->
zName
);

93700 ifÐ
HasRowid
(
pTab
) ){

93701 
sql™e3VdbeAddOp4
(
v
, 
OP_CË¬
, 
pTab
->
Šum
, 
iDb
, 
memCÁ
,

93702 
pTab
->
zName
, 
P4_STATIC
);

93704 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

93705 
as£¹
Ð
pIdx
->
pSchema
==
pTab
->pSchema );

93706 
sql™e3VdbeAddOp2
(
v
, 
OP_CË¬
, 
pIdx
->
Šum
, 
iDb
);

93711 ifÐ
HasRowid
(
pTab
) ){

93713 
	gpPk
 = 0;

93714 
	gnPk
 = 1;

93715 
	giRowS‘
 = ++
pP¬£
->
nMem
;

93716 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
iRowS‘
);

93720 
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

93721 
as£¹
Ð
pPk
!=0 );

93722 
	gnPk
 = 
pPk
->
nKeyCÞ
;

93723 
	giPk
 = 
pP¬£
->
nMem
+1;

93724 
	gpP¬£
->
	gnMem
 +ð
nPk
;

93725 
	giEphCur
 = 
pP¬£
->
nTab
++;

93726 
	gaddrEphO³n
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
iEphCur
, 
nPk
);

93727 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pPk
);

93733 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pTabLi¡
, 
pWh”e
, 0, 0,

93734 
WHERE_ONEPASS_DESIRED
|
WHERE_DUPLICATES_OK
,

93735 
iTabCur
+1);

93736 ifÐ
	gpWInfo
==0 ) 
d–‘e_äom_þ—nup
;

93737 
	gokOÃPass
 = 
sql™e3Wh”eOkOÃPass
(
pWInfo
, 
aiCurOÃPass
);

93740 ifÐ
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
 ){

93741 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 
memCÁ
, 1);

93745 ifÐ
	gpPk
 ){

93746 
	gi
=0; i<
	gnPk
; i++){

93747 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iTabCur
,

93748 
pPk
->
aiCÞumn
[
i
], 
iPk
+i);

93750 
	giKey
 = 
iPk
;

93752 
	giKey
 = 
pP¬£
->
nMem
 + 1;

93753 
	giKey
 = 
sql™e3Ex´CodeG‘CÞumn
(
pP¬£
, 
pTab
, -1, 
iTabCur
, 
iKey
, 0);

93754 ifÐ
	giKey
>
	gpP¬£
->
	gnMem
 )…P¬£->nMem = 
iKey
;

93757 ifÐ
	gokOÃPass
 ){

93762 
	gnKey
 = 
nPk
;

93763 
	gaToO³n
 = 
sql™e3DbM®locRaw
(
db
, 
nIdx
+2);

93764 ifÐ
	gaToO³n
==0 ){

93765 
sql™e3Wh”eEnd
(
pWInfo
);

93766 
	gd–‘e_äom_þ—nup
;

93768 
mem£t
(
aToO³n
, 1, 
nIdx
+1);

93769 
	gaToO³n
[
nIdx
+1] = 0;

93770 ifÐ
	gaiCurOÃPass
[0]>=0 ) 
aToO³n
[
aiCurOÃPass
[0]-
iTabCur
] = 0;

93771 ifÐ
	gaiCurOÃPass
[1]>=0 ) 
aToO³n
[
aiCurOÃPass
[1]-
iTabCur
] = 0;

93772 ifÐ
	gaddrEphO³n
 ) 
sql™e3VdbeChªgeToNoÝ
(
v
, 
addrEphO³n
);

93773 
	gaddrD–‘e
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

93774 }ifÐ
	gpPk
 ){

93776 
	giKey
 = ++
pP¬£
->
nMem
;

93777 
	gnKey
 = 0;

93778 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
iPk
, 
nPk
, 
iKey
,

93779 
sql™e3IndexAffš™ySŒ
(
v
, 
pPk
), 
nPk
);

93780 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iEphCur
, 
iKey
);

93783 
	gnKey
 = 1;

93784 
sql™e3VdbeAddOp2
(
v
, 
OP_RowS‘Add
, 
iRowS‘
, 
iKey
);

93788 
sql™e3Wh”eEnd
(
pWInfo
);

93789 ifÐ
	gokOÃPass
 ){

93791 
	gaddrBy·ss
 = 
sql™e3VdbeMakeLab–
(
v
);

93792 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrBy·ss
);

93793 
sql™e3VdbeJumpH”e
(
v
, 
addrD–‘e
);

93801 ifÐ!
	gisV›w
 ){

93802 
‹¡ÿ£
Ð
IsVœtu®
(
pTab
) );

93803 
sql™e3O³nTabËAndIndiûs
(
pP¬£
, 
pTab
, 
OP_O³nWr™e
, 
iTabCur
, 
aToO³n
,

93804 &
iD©aCur
, &
iIdxCur
);

93805 
as£¹
Ð
pPk
 || 
IsVœtu®
(
pTab
è|| 
iD©aCur
==
iTabCur
 );

93806 
as£¹
Ð
pPk
 || 
IsVœtu®
(
pTab
è|| 
iIdxCur
==
iD©aCur
+1 );

93812 ifÐ
	gokOÃPass
 ){

93814 
as£¹
Ð
nKey
==
nPk
 );

93815 
as£¹
Ð!
IsVœtu®
(
pTab
) );

93816 ifÐ
	gaToO³n
[
iD©aCur
-
iTabCur
] ){

93817 
as£¹
Ð
pPk
!=0 || 
pTab
->
pS–eù
!=0 );

93818 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iD©aCur
, 
addrBy·ss
, 
iKey
, 
nKey
);

93819 
VdbeCov”age
(
v
);

93821 }ifÐ
	gpPk
 ){

93822 
	gaddrLoÝ
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 
iEphCur
); 
VdbeCov”age
(v);

93823 
sql™e3VdbeAddOp2
(
v
, 
OP_RowKey
, 
iEphCur
, 
iKey
);

93824 
as£¹
Ð
nKey
==0 );

93826 
	gaddrLoÝ
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_RowS‘R—d
, 
iRowS‘
, 0, 
iKey
);

93827 
VdbeCov”age
(
v
);

93828 
as£¹
Ð
nKey
==1 );

93832 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


93833 ifÐ
IsVœtu®
(
pTab
) ){

93834 cÚ¡ *
	gpVTab
 = (cÚ¡ *)
sql™e3G‘VTabË
(
db
, 
pTab
);

93835 
sql™e3VbMakeWr™abË
(
pP¬£
, 
pTab
);

93836 
sql™e3VdbeAddOp4
(
v
, 
OP_VUpd©e
, 0, 1, 
iKey
, 
pVTab
, 
P4_VTAB
);

93837 
sql™e3VdbeChªgeP5
(
v
, 
OE_AbÜt
);

93838 
sql™e3MayAbÜt
(
pP¬£
);

93842 
	gcouÁ
 = (
pP¬£
->
Ã¡ed
==0);

93843 
sql™e3G’”©eRowD–‘e
(
pP¬£
, 
pTab
, 
pTrigg”
, 
iD©aCur
, 
iIdxCur
,

93844 
iKey
, 
nKey
, 
couÁ
, 
OE_DeçuÉ
, 
okOÃPass
);

93848 ifÐ
	gokOÃPass
 ){

93849 
sql™e3VdbeResÞveLab–
(
v
, 
addrBy·ss
);

93850 }ifÐ
	gpPk
 ){

93851 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iEphCur
, 
addrLoÝ
+1); 
VdbeCov”age
(v);

93852 
sql™e3VdbeJumpH”e
(
v
, 
addrLoÝ
);

93854 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrLoÝ
);

93855 
sql™e3VdbeJumpH”e
(
v
, 
addrLoÝ
);

93859 ifÐ!
	gisV›w
 && !
IsVœtu®
(
pTab
) ){

93860 ifÐ!
	gpPk
 ) 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iD©aCur
);

93861 
	gi
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx; i++,…Idx=
pIdx
->
pNext
){

93862 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iIdxCur
 + 
i
);

93871 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 && 
pP¬£
->
pTrigg”Tab
==0 ){

93872 
sql™e3Autošüem’tEnd
(
pP¬£
);

93879 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_CouÁRows
è&& !
	gpP¬£
->
	gÃ¡ed
 && !pP¬£->
	gpTrigg”Tab
 ){

93880 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
memCÁ
, 1);

93881 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

93882 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "row d–‘ed", 
SQLITE_STATIC
);

93885 
	gd–‘e_äom_þ—nup
:

93886 
sql™e3AuthCÚ‹xtPÝ
(&
sCÚ‹xt
);

93887 
sql™e3SrcLi¡D–‘e
(
db
, 
pTabLi¡
);

93888 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

93889 
sql™e3DbF»e
(
db
, 
aToO³n
);

93895 #ifdeà
isV›w


93896 #undeà
isV›w


93898 #ifdeà
pTrigg”


93899 #undeà
pTrigg”


93922 
SQLITE_PRIVATE
 
sql™e3G’”©eRowD–‘e
(

93923 
P¬£
 *
pP¬£
,

93924 
TabË
 *
pTab
,

93925 
Trigg”
 *
pTrigg”
,

93926 
iD©aCur
,

93927 
iIdxCur
,

93928 
iPk
,

93929 
i16
 
nPk
,

93930 
u8
 
couÁ
,

93931 
u8
 
ÚcÚf
,

93932 
u8
 
bNoS“k


93934 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

93935 
	giOld
 = 0;

93936 
	giLab–
;

93937 
u8
 
	gÝS“k
;

93940 
as£¹
Ð
v
 );

93941 
VdbeModuËComm’t
((
v
, "BEGIN: GenRowDel(%d,%d,%d,%d)",

93942 
iD©aCur
, 
iIdxCur
, 
iPk
, ()
nPk
));

93947 
	giLab–
 = 
sql™e3VdbeMakeLab–
(
v
);

93948 
	gÝS“k
 = 
HasRowid
(
pTab
è? 
OP_NÙExi¡s
 : 
OP_NÙFound
;

93949 ifÐ!
	gbNoS“k
 ){

93950 
sql™e3VdbeAddOp4IÁ
(
v
, 
ÝS“k
, 
iD©aCur
, 
iLab–
, 
iPk
, 
nPk
);

93951 
VdbeCov”ageIf
(
v
, 
ÝS“k
==
OP_NÙExi¡s
);

93952 
VdbeCov”ageIf
(
v
, 
ÝS“k
==
OP_NÙFound
);

93957 ifÐ
sql™e3FkRequœed
(
pP¬£
, 
pTab
, 0, 0è|| 
	gpTrigg”
 ){

93958 
u32
 
	gmask
;

93959 
	giCÞ
;

93960 
	gaddrS¹
;

93964 
	gmask
 = 
sql™e3Trigg”CÞmask
(

93965 
pP¬£
, 
pTrigg”
, 0, 0, 
TRIGGER_BEFORE
|
TRIGGER_AFTER
, 
pTab
, 
ÚcÚf


93967 
	gmask
 |ð
sql™e3FkOldmask
(
pP¬£
, 
pTab
);

93968 
	giOld
 = 
pP¬£
->
nMem
+1;

93969 
	gpP¬£
->
	gnMem
 +ð(1 + 
pTab
->
nCÞ
);

93973 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
iPk
, 
iOld
);

93974 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞ
; iCol++){

93975 
‹¡ÿ£
Ð
mask
!=0xfffffffà&& 
iCÞ
==31 );

93976 
‹¡ÿ£
Ð
mask
!=0xfffffffà&& 
iCÞ
==32 );

93977 ifÐ
	gmask
==0xfffffffà|| (
iCÞ
<=31 && (
mask
 & 
MASKBIT32
(iCol))!=0) ){

93978 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
iCÞ
, 
iOld
+iCol+1);

93983 
	gaddrS¹
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

93984 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
,

93985 
TK_DELETE
, 0, 
TRIGGER_BEFORE
, 
pTab
, 
iOld
, 
ÚcÚf
, 
iLab–


93993 ifÐ
	gaddrS¹
<
sql™e3VdbeCu¼’tAddr
(
v
) ){

93994 
sql™e3VdbeAddOp4IÁ
(
v
, 
ÝS“k
, 
iD©aCur
, 
iLab–
, 
iPk
, 
nPk
);

93995 
VdbeCov”ageIf
(
v
, 
ÝS“k
==
OP_NÙExi¡s
);

93996 
VdbeCov”ageIf
(
v
, 
ÝS“k
==
OP_NÙFound
);

94002 
sql™e3FkCheck
(
pP¬£
, 
pTab
, 
iOld
, 0, 0, 0);

94008 ifÐ
	gpTab
->
	gpS–eù
==0 ){

94009 
sql™e3G’”©eRowIndexD–‘e
(
pP¬£
, 
pTab
, 
iD©aCur
, 
iIdxCur
, 0);

94010 
sql™e3VdbeAddOp2
(
v
, 
OP_D–‘e
, 
iD©aCur
, (
couÁ
?
OPFLAG_NCHANGE
:0));

94011 ifÐ
	gcouÁ
 ){

94012 
sql™e3VdbeChªgeP4
(
v
, -1, 
pTab
->
zName
, 
P4_TRANSIENT
);

94019 
sql™e3FkAùiÚs
(
pP¬£
, 
pTab
, 0, 
iOld
, 0, 0);

94022 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
,

94023 
TK_DELETE
, 0, 
TRIGGER_AFTER
, 
pTab
, 
iOld
, 
ÚcÚf
, 
iLab–


94029 
sql™e3VdbeResÞveLab–
(
v
, 
iLab–
);

94030 
VdbeModuËComm’t
((
v
, "END: GenRowDel()"));

94051 
SQLITE_PRIVATE
 
sql™e3G’”©eRowIndexD–‘e
(

94052 
P¬£
 *
pP¬£
,

94053 
TabË
 *
pTab
,

94054 
iD©aCur
,

94055 
iIdxCur
,

94056 *
aRegIdx


94058 
	gi
;

94059 
	gr1
 = -1;

94060 
	giP¬tIdxLab–
;

94061 
Index
 *
	gpIdx
;

94062 
Index
 *
	gpPriÜ
 = 0;

94063 
Vdbe
 *
	gv
;

94064 
Index
 *
	gpPk
;

94066 
	gv
 = 
pP¬£
->
pVdbe
;

94067 
	gpPk
 = 
HasRowid
(
pTab
è? 0 : 
sql™e3Prim¬yKeyIndex
(pTab);

94068 
	gi
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx; i++,…Idx=
pIdx
->
pNext
){

94069 
as£¹
Ð
iIdxCur
+
i
!=
iD©aCur
 || 
pPk
==
pIdx
 );

94070 ifÐ
	gaRegIdx
!=0 && 
aRegIdx
[
i
]==0 ) ;

94071 ifÐ
	gpIdx
==
pPk
 ) ;

94072 
VdbeModuËComm’t
((
v
, "G’RowIdxD– fÜ %s", 
pIdx
->
zName
));

94073 
	gr1
 = 
sql™e3G’”©eIndexKey
(
pP¬£
, 
pIdx
, 
iD©aCur
, 0, 1,

94074 &
iP¬tIdxLab–
, 
pPriÜ
, 
r1
);

94075 
sql™e3VdbeAddOp3
(
v
, 
OP_IdxD–‘e
, 
iIdxCur
+
i
, 
r1
,

94076 
pIdx
->
uniqNÙNuÎ
 ?…Idx->
nKeyCÞ
 :…Idx->
nCÞumn
);

94077 
sql™e3ResÞveP¬tIdxLab–
(
pP¬£
, 
iP¬tIdxLab–
);

94078 
	gpPriÜ
 = 
pIdx
;

94113 
SQLITE_PRIVATE
 
sql™e3G’”©eIndexKey
(

94114 
P¬£
 *
pP¬£
,

94115 
Index
 *
pIdx
,

94116 
iD©aCur
,

94117 
»gOut
,

94118 
´efixOÆy
,

94119 *
piP¬tIdxLab–
,

94120 
Index
 *
pPriÜ
,

94121 
»gPriÜ


94123 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

94124 
	gj
;

94125 
TabË
 *
	gpTab
 = 
pIdx
->
pTabË
;

94126 
	g»gBa£
;

94127 
	gnCÞ
;

94129 ifÐ
	gpiP¬tIdxLab–
 ){

94130 ifÐ
	gpIdx
->
	gpP¬tIdxWh”e
 ){

94131 *
	gpiP¬tIdxLab–
 = 
sql™e3VdbeMakeLab–
(
v
);

94132 
	gpP¬£
->
	giP¬tIdxTab
 = 
iD©aCur
;

94133 
sql™e3Ex´CachePush
(
pP¬£
);

94134 
sql™e3Ex´IfF®£
(
pP¬£
, 
pIdx
->
pP¬tIdxWh”e
, *
piP¬tIdxLab–
,

94135 
SQLITE_JUMPIFNULL
);

94137 *
	gpiP¬tIdxLab–
 = 0;

94140 
	gnCÞ
 = (
´efixOÆy
 && 
pIdx
->
uniqNÙNuÎ
è?…Idx->
nKeyCÞ
 :…Idx->
nCÞumn
;

94141 
	g»gBa£
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nCÞ
);

94142 ifÐ
	gpPriÜ
 && (
	g»gBa£
!=
»gPriÜ
 || 
pPriÜ
->
pP¬tIdxWh”e
) )…Prior = 0;

94143 
	gj
=0; j<
	gnCÞ
; j++){

94144 ifÐ
	gpPriÜ
 &&…PriÜ->
	gaiCÞumn
[
j
]==
pIdx
->
aiCÞumn
[j] ) ;

94145 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
pIdx
->
aiCÞumn
[
j
],

94146 
»gBa£
+
j
);

94153 
sql™e3VdbeD–‘ePriÜOpcode
(
v
, 
OP_R—lAffš™y
);

94155 ifÐ
	g»gOut
 ){

94156 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gBa£
, 
nCÞ
, 
»gOut
);

94158 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gBa£
, 
nCÞ
);

94159  
	g»gBa£
;

94167 
SQLITE_PRIVATE
 
sql™e3ResÞveP¬tIdxLab–
(
P¬£
 *
pP¬£
, 
iLab–
){

94168 ifÐ
	giLab–
 ){

94169 
sql™e3VdbeResÞveLab–
(
pP¬£
->
pVdbe
, 
iLab–
);

94170 
sql™e3Ex´CachePÝ
(
pP¬£
);

94197 
CÞlSeq
 *
sql™e3G‘FuncCÞlSeq
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

94198 
VdbeOp
 *
	gpOp
 = &
cÚ‹xt
->
pVdbe
->
aOp
[cÚ‹xt->
iOp
-1];

94199 
as£¹
Ð
pOp
->
Ýcode
==
OP_CÞlSeq
 );

94200 
as£¹
Ð
pOp
->
p4ty³
==
P4_COLLSEQ
 );

94201  
	gpOp
->
	gp4
.
	gpCÞl
;

94208 
sql™e3SkAccumuÏtÜLßd
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

94209 
	gcÚ‹xt
->
	gskFÏg
 = 1;

94215 
mšmaxFunc
(

94216 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94217 
¬gc
,

94218 
sql™e3_v®ue
 **
¬gv


94220 
	gi
;

94221 
	gmask
;

94222 
	giBe¡
;

94223 
CÞlSeq
 *
	gpCÞl
;

94225 
as£¹
Ð
¬gc
>1 );

94226 
	gmask
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
)==0 ? 0 : -1;

94227 
	gpCÞl
 = 
sql™e3G‘FuncCÞlSeq
(
cÚ‹xt
);

94228 
as£¹
Ð
pCÞl
 );

94229 
as£¹
Ð
mask
==-1 || mask==0 );

94230 
	giBe¡
 = 0;

94231 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 ) ;

94232 
	gi
=1; i<
	g¬gc
; i++){

94233 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[
i
])==
SQLITE_NULL
 ) ;

94234 ifÐ(
sql™e3MemCom·»
(
¬gv
[
iBe¡
],‡rgv[
i
], 
pCÞl
)^
	gmask
)>=0 ){

94235 
‹¡ÿ£
Ð
mask
==0 );

94236 
	giBe¡
 = 
i
;

94239 
sql™e3_»suÉ_v®ue
(
cÚ‹xt
, 
¬gv
[
iBe¡
]);

94245 
ty³ofFunc
(

94246 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94247 
NÙU£d
,

94248 
sql™e3_v®ue
 **
¬gv


94250 cÚ¡ *
	gz
 = 0;

94251 
UNUSED_PARAMETER
(
NÙU£d
);

94252  
sql™e3_v®ue_ty³
(
¬gv
[0]) ){

94253 
	gSQLITE_INTEGER
: 
z
 = "integer"; ;

94254 
	gSQLITE_TEXT
: 
z
 = "text"; ;

94255 
	gSQLITE_FLOAT
: 
z
 = "real"; ;

94256 
	gSQLITE_BLOB
: 
z
 = "blob"; ;

94257 : 
z
 = "null"; ;

94259 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
z
, -1, 
SQLITE_STATIC
);

94266 
ËngthFunc
(

94267 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94268 
¬gc
,

94269 
sql™e3_v®ue
 **
¬gv


94271 
	gËn
;

94273 
as£¹
Ð
¬gc
==1 );

94274 
UNUSED_PARAMETER
(
¬gc
);

94275  
sql™e3_v®ue_ty³
(
¬gv
[0]) ){

94276 
	gSQLITE_BLOB
:

94277 
SQLITE_INTEGER
:

94278 
SQLITE_FLOAT
: {

94279 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
sql™e3_v®ue_by‹s
(
¬gv
[0]));

94282 
	gSQLITE_TEXT
: {

94283 cÚ¡ *
z
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94284 ifÐ
	gz
==0 ) ;

94285 
	gËn
 = 0;

94286  *
	gz
 ){

94287 
	gËn
++;

94288 
SQLITE_SKIP_UTF8
(
z
);

94290 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
Ën
);

94294 
sql™e3_»suÉ_nuÎ
(
cÚ‹xt
);

94306 
absFunc
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

94307 
as£¹
Ð
¬gc
==1 );

94308 
UNUSED_PARAMETER
(
¬gc
);

94309  
sql™e3_v®ue_ty³
(
¬gv
[0]) ){

94310 
	gSQLITE_INTEGER
: {

94311 
i64
 
iV®
 = 
sql™e3_v®ue_št64
(
¬gv
[0]);

94312 ifÐ
	giV®
<0 ){

94313 ifÐ
	giV®
==
SMALLEST_INT64
 ){

94317 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "integer overflow", -1);

94320 
	giV®
 = -
iV®
;

94322 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
iV®
);

94325 
	gSQLITE_NULL
: {

94327 
sql™e3_»suÉ_nuÎ
(
cÚ‹xt
);

94336 
rV®
 = 
sql™e3_v®ue_doubË
(
¬gv
[0]);

94337 ifÐ
	grV®
<0 )„V® = -
rV®
;

94338 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
rV®
);

94355 
š¡rFunc
(

94356 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94357 
¬gc
,

94358 
sql™e3_v®ue
 **
¬gv


94360 cÚ¡ *
	gzHay¡ack
;

94361 cÚ¡ *
	gzN“dË
;

94362 
	gnHay¡ack
;

94363 
	gnN“dË
;

94364 
	gty³Hay¡ack
, 
	gty³N“dË
;

94365 
	gN
 = 1;

94366 
	gisText
;

94368 
UNUSED_PARAMETER
(
¬gc
);

94369 
	gty³Hay¡ack
 = 
sql™e3_v®ue_ty³
(
¬gv
[0]);

94370 
	gty³N“dË
 = 
sql™e3_v®ue_ty³
(
¬gv
[1]);

94371 ifÐ
	gty³Hay¡ack
==
SQLITE_NULL
 || 
ty³N“dË
==SQLITE_NULL ) ;

94372 
	gnHay¡ack
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

94373 
	gnN“dË
 = 
sql™e3_v®ue_by‹s
(
¬gv
[1]);

94374 ifÐ
	gty³Hay¡ack
==
SQLITE_BLOB
 && 
ty³N“dË
==SQLITE_BLOB ){

94375 
zHay¡ack
 = 
sql™e3_v®ue_blob
(
¬gv
[0]);

94376 
	gzN“dË
 = 
sql™e3_v®ue_blob
(
¬gv
[1]);

94377 
	gisText
 = 0;

94379 
	gzHay¡ack
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94380 
	gzN“dË
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

94381 
	gisText
 = 1;

94383  
	gnN“dË
<=
nHay¡ack
 && 
memcmp
(
zHay¡ack
, 
zN“dË
, 
nN“dË
)!=0 ){

94384 
N
++;

94386 
	gnHay¡ack
--;

94387 
	gzHay¡ack
++;

94388 } 
	gisText
 && (
	gzHay¡ack
[0]&0xc0)==0x80 );

94390 ifÐ
	gnN“dË
>
	gnHay¡ack
 ) 
	gN
 = 0;

94391 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
N
);

94397 
´štfFunc
(

94398 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94399 
¬gc
,

94400 
sql™e3_v®ue
 **
¬gv


94402 
PrštfArgum’ts
 
	gx
;

94403 
SŒAccum
 
	g¡r
;

94404 cÚ¡ *
	gzFÜm©
;

94405 
	gn
;

94407 ifÐ
	g¬gc
>=1 && (
zFÜm©
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]))!=0 ){

94408 
x
.
nArg
 = 
¬gc
-1;

94409 
	gx
.
	gnU£d
 = 0;

94410 
	gx
.
	g­Arg
 = 
¬gv
+1;

94411 
sql™e3SŒAccumIn™
(&
¡r
, 0, 0, 
SQLITE_MAX_LENGTH
);

94412 
	g¡r
.
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94413 
sql™e3XPrštf
(&
¡r
, 
SQLITE_PRINTF_SQLFUNC
, 
zFÜm©
, &
x
);

94414 
	gn
 = 
¡r
.
nCh¬
;

94415 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
sql™e3SŒAccumFšish
(&
¡r
), 
n
,

94416 
SQLITE_DYNAMIC
);

94432 
sub¡rFunc
(

94433 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94434 
¬gc
,

94435 
sql™e3_v®ue
 **
¬gv


94437 cÚ¡ *
	gz
;

94438 cÚ¡ *
	gz2
;

94439 
	gËn
;

94440 
	gp0ty³
;

94441 
i64
 
	gp1
, 
	gp2
;

94442 
	gÃgP2
 = 0;

94444 
as£¹
Ð
¬gc
==3 ||‡rgc==2 );

94445 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[1])==
SQLITE_NULL


94446 || (
¬gc
==3 && 
sql™e3_v®ue_ty³
(
¬gv
[2])==
SQLITE_NULL
)

94450 
	gp0ty³
 = 
sql™e3_v®ue_ty³
(
¬gv
[0]);

94451 
	gp1
 = 
sql™e3_v®ue_št
(
¬gv
[1]);

94452 ifÐ
	gp0ty³
==
SQLITE_BLOB
 ){

94453 
Ën
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

94454 
	gz
 = 
sql™e3_v®ue_blob
(
¬gv
[0]);

94455 ifÐ
	gz
==0 ) ;

94456 
as£¹
Ð
Ën
==
sql™e3_v®ue_by‹s
(
¬gv
[0]) );

94458 
	gz
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94459 ifÐ
	gz
==0 ) ;

94460 
	gËn
 = 0;

94461 ifÐ
	gp1
<0 ){

94462 
	gz2
=
z
; *z2; 
	gËn
++){

94463 
SQLITE_SKIP_UTF8
(
z2
);

94467 ifÐ
	g¬gc
==3 ){

94468 
p2
 = 
sql™e3_v®ue_št
(
¬gv
[2]);

94469 ifÐ
	gp2
<0 ){

94470 
	gp2
 = -
p2
;

94471 
	gÃgP2
 = 1;

94474 
	gp2
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
)->
aLim™
[
SQLITE_LIMIT_LENGTH
];

94476 ifÐ
	gp1
<0 ){

94477 
	gp1
 +ð
Ën
;

94478 ifÐ
	gp1
<0 ){

94479 
	gp2
 +ð
p1
;

94480 ifÐ
	gp2
<0 )…2 = 0;

94481 
	gp1
 = 0;

94483 }ifÐ
	gp1
>0 ){

94484 
	gp1
--;

94485 }ifÐ
	gp2
>0 ){

94486 
	gp2
--;

94488 ifÐ
	gÃgP2
 ){

94489 
	gp1
 -ð
p2
;

94490 ifÐ
	gp1
<0 ){

94491 
	gp2
 +ð
p1
;

94492 
	gp1
 = 0;

94495 
as£¹
Ð
p1
>=0 && 
p2
>=0 );

94496 ifÐ
	gp0ty³
!=
SQLITE_BLOB
 ){

94497  *
z
 && 
p1
 ){

94498 
SQLITE_SKIP_UTF8
(
z
);

94499 
	gp1
--;

94501 
	gz2
=
z
; *z2 && 
	gp2
;…2--){

94502 
SQLITE_SKIP_UTF8
(
z2
);

94504 
sql™e3_»suÉ_‹xt64
(
cÚ‹xt
, (*)
z
, 
z2
-z, 
SQLITE_TRANSIENT
,

94505 
SQLITE_UTF8
);

94507 ifÐ
	gp1
+
	gp2
>
	gËn
 ){

94508 
	gp2
 = 
Ën
-
p1
;

94509 ifÐ
	gp2
<0 )…2 = 0;

94511 
sql™e3_»suÉ_blob64
(
cÚ‹xt
, (*)&
z
[
p1
], (
u64
)
p2
, 
SQLITE_TRANSIENT
);

94518 #iâdeà
SQLITE_OMIT_FLOATING_POINT


94519 
roundFunc
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

94520 
	gn
 = 0;

94521 
	gr
;

94522 *
	gzBuf
;

94523 
as£¹
Ð
¬gc
==1 ||‡rgc==2 );

94524 ifÐ
	g¬gc
==2 ){

94525 ifÐ
SQLITE_NULL
==
sql™e3_v®ue_ty³
(
¬gv
[1]) ) ;

94526 
	gn
 = 
sql™e3_v®ue_št
(
¬gv
[1]);

94527 ifÐ
	gn
>30 )‚ = 30;

94528 ifÐ
	gn
<0 )‚ = 0;

94530 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 ) ;

94531 
	gr
 = 
sql™e3_v®ue_doubË
(
¬gv
[0]);

94536 ifÐ
	gn
==0 && 
r
>=0 &&„<
LARGEST_INT64
-1 ){

94537 
r
 = ()((
sql™e_št64
)(r+0.5));

94538 }ifÐ
	gn
==0 && 
r
<0 && (-r)<
LARGEST_INT64
-1 ){

94539 
r
 = -()((
sql™e_št64
)((-r)+0.5));

94541 
	gzBuf
 = 
sql™e3_m´štf
("%.*f",
n
,
r
);

94542 ifÐ
	gzBuf
==0 ){

94543 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

94546 
sql™e3AtoF
(
zBuf
, &
r
, 
sql™e3SŒËn30
(zBuf), 
SQLITE_UTF8
);

94547 
sql™e3_ä“
(
zBuf
);

94549 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
r
);

94560 *
cÚ‹xtM®loc
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
i64
 
nBy‹
){

94561 *
	gz
;

94562 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94563 
as£¹
Ð
nBy‹
>0 );

94564 
‹¡ÿ£
Ð
nBy‹
==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] );

94565 
‹¡ÿ£
Ð
nBy‹
==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
]+1 );

94566 ifÐ
	gnBy‹
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

94567 
sql™e3_»suÉ_”rÜ_toobig
(
cÚ‹xt
);

94568 
	gz
 = 0;

94570 
	gz
 = 
sql™e3M®loc
(
nBy‹
);

94571 ifÐ!
	gz
 ){

94572 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

94575  
	gz
;

94581 
uµ”Func
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

94582 *
	gz1
;

94583 cÚ¡ *
	gz2
;

94584 
	gi
, 
	gn
;

94585 
UNUSED_PARAMETER
(
¬gc
);

94586 
	gz2
 = (*)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94587 
	gn
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

94589 
as£¹
Ð
z2
==(*)
sql™e3_v®ue_‹xt
(
¬gv
[0]) );

94590 ifÐ
	gz2
 ){

94591 
	gz1
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, ((
i64
)
n
)+1);

94592 ifÐ
	gz1
 ){

94593 
	gi
=0; i<
	gn
; i++){

94594 
	gz1
[
i
] = ()
sql™e3Touµ”
(
z2
[i]);

94596 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
z1
, 
n
, 
sql™e3_ä“
);

94600 
low”Func
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

94601 *
	gz1
;

94602 cÚ¡ *
	gz2
;

94603 
	gi
, 
	gn
;

94604 
UNUSED_PARAMETER
(
¬gc
);

94605 
	gz2
 = (*)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94606 
	gn
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

94608 
as£¹
Ð
z2
==(*)
sql™e3_v®ue_‹xt
(
¬gv
[0]) );

94609 ifÐ
	gz2
 ){

94610 
	gz1
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, ((
i64
)
n
)+1);

94611 ifÐ
	gz1
 ){

94612 
	gi
=0; i<
	gn
; i++){

94613 
	gz1
[
i
] = 
sql™e3TÞow”
(
z2
[i]);

94615 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
z1
, 
n
, 
sql™e3_ä“
);

94628 
	#noÝFunc
 
v”siÚFunc


	)

94633 
¿ndomFunc
(

94634 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94635 
NÙU£d
,

94636 
sql™e3_v®ue
 **
NÙU£d2


94638 
sql™e_št64
 
	gr
;

94639 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

94640 
sql™e3_¿ndomÃss
((
r
), &r);

94641 ifÐ
	gr
<0 ){

94650 
	gr
 = -(
r
 & 
LARGEST_INT64
);

94652 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
r
);

94659 
¿ndomBlob
(

94660 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94661 
¬gc
,

94662 
sql™e3_v®ue
 **
¬gv


94664 
	gn
;

94665 *
	gp
;

94666 
as£¹
Ð
¬gc
==1 );

94667 
UNUSED_PARAMETER
(
¬gc
);

94668 
	gn
 = 
sql™e3_v®ue_št
(
¬gv
[0]);

94669 ifÐ
	gn
<1 ){

94670 
	gn
 = 1;

94672 
	gp
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, 
n
);

94673 ifÐ
	gp
 ){

94674 
sql™e3_¿ndomÃss
(
n
, 
p
);

94675 
sql™e3_»suÉ_blob
(
cÚ‹xt
, (*)
p
, 
n
, 
sql™e3_ä“
);

94683 
Ï¡_š£¹_rowid
(

94684 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94685 
NÙU£d
,

94686 
sql™e3_v®ue
 **
NÙU£d2


94688 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94689 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

94693 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
sql™e3_Ï¡_š£¹_rowid
(
db
));

94703 
chªges
(

94704 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94705 
NÙU£d
,

94706 
sql™e3_v®ue
 **
NÙU£d2


94708 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94709 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

94710 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
sql™e3_chªges
(
db
));

94717 
tÙ®_chªges
(

94718 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94719 
NÙU£d
,

94720 
sql™e3_v®ue
 **
NÙU£d2


94722 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94723 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

94726 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
sql™e3_tÙ®_chªges
(
db
));

94732 
	scom·»Info
 {

94733 
u8
 
	gm©chAÎ
;

94734 
u8
 
	gm©chOÃ
;

94735 
u8
 
	gm©chS‘
;

94736 
u8
 
	gnoCa£
;

94745 #ià
defšed
(
SQLITE_EBCDIC
)

94746 
	#sql™e3Utf8R—d
(
A
è(*((*A)++))

	)

94747 
	#GlobUµ”ToLow”
(
A
èA = 
sql™e3Uµ”ToLow”
[A]

	)

94748 
	#GlobUµ”ToLow”Ascii
(
A
èA = 
sql™e3Uµ”ToLow”
[A]

	)

94750 
	#GlobUµ”ToLow”
(
A
èifÐA<=0x7à){ A = 
sql™e3Uµ”ToLow”
[A]; }

	)

94751 
	#GlobUµ”ToLow”Ascii
(
A
èA = 
sql™e3Uµ”ToLow”
[A]

	)

94754 cÚ¡ 
com·»Info
 
	gglobInfo
 = { '*', '?', '[', 0 };

94757 cÚ¡ 
com·»Info
 
	glikeInfoNÜm
 = { '%', '_', 0, 1 };

94760 cÚ¡ 
com·»Info
 
	glikeInfoAÉ
 = { '%', '_', 0, 0 };

94797 
·‰”nCom·»
(

94798 cÚ¡ 
u8
 *
zP©‹º
,

94799 cÚ¡ 
u8
 *
zSŒšg
,

94800 cÚ¡ 
com·»Info
 *
pInfo
,

94801 
u32
 
esc


94803 
u32
 
	gc
, 
	gc2
;

94804 
u32
 
	gm©chOÃ
 = 
pInfo
->
m©chOÃ
;

94805 
u32
 
	gm©chAÎ
 = 
pInfo
->
m©chAÎ
;

94806 
u32
 
	gm©chOth”
;

94807 
u8
 
	gnoCa£
 = 
pInfo
->
noCa£
;

94808 cÚ¡ 
u8
 *
	gzEsÿ³d
 = 0;

94815 
	gm©chOth”
 = 
esc
 ?ƒsø: 
pInfo
->
m©chS‘
;

94817  (
	gc
 = 
sql™e3Utf8R—d
(&
zP©‹º
))!=0 ){

94818 ifÐ
c
==
m©chAÎ
 ){

94822  (
c
=
sql™e3Utf8R—d
(&
zP©‹º
)è=ð
m©chAÎ


94823 || 
c
 =ð
m©chOÃ
 ){

94824 ifÐ
c
==
m©chOÃ
 && 
sql™e3Utf8R—d
(&
zSŒšg
)==0 ){

94828 ifÐ
	gc
==0 ){

94830 }ifÐ
	gc
==
m©chOth”
 ){

94831 ifÐ
esc
 ){

94832 
c
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94833 ifÐ
	gc
==0 )  0;

94837 
as£¹
Ð
m©chOth”
<0x80 );

94838  *
	gzSŒšg


94839 && 
·‰”nCom·»
(&
zP©‹º
[-1],
zSŒšg
,
pInfo
,
esc
)==0 ){

94840 
SQLITE_SKIP_UTF8
(
zSŒšg
);

94842  *
	gzSŒšg
!=0;

94855 ifÐ
	gc
<=0x80 ){

94856 
u32
 
cx
;

94857 ifÐ
	gnoCa£
 ){

94858 
	gcx
 = 
sql™e3Touµ”
(
c
);

94859 
	gc
 = 
sql™e3TÞow”
(
c
);

94861 
	gcx
 = 
c
;

94863  (
	gc2
 = *(
zSŒšg
++))!=0 ){

94864 ifÐ
c2
!=
c
 && c2!=
cx
 ) ;

94865 ifÐ
·‰”nCom·»
(
zP©‹º
,
zSŒšg
,
pInfo
,
esc
) )  1;

94868  (
	gc2
 = 
sql™e3Utf8R—d
(&
zSŒšg
))!=0 ){

94869 ifÐ
c2
!=
c
 ) ;

94870 ifÐ
·‰”nCom·»
(
zP©‹º
,
zSŒšg
,
pInfo
,
esc
) )  1;

94875 ifÐ
	gc
==
m©chOth”
 ){

94876 ifÐ
esc
 ){

94877 
c
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94878 ifÐ
	gc
==0 )  0;

94879 
	gzEsÿ³d
 = 
zP©‹º
;

94881 
u32
 
	g´iÜ_c
 = 0;

94882 
	g£’
 = 0;

94883 
	gšv”t
 = 0;

94884 
	gc
 = 
sql™e3Utf8R—d
(&
zSŒšg
);

94885 ifÐ
	gc
==0 )  0;

94886 
	gc2
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94887 ifÐ
	gc2
=='^' ){

94888 
šv”t
 = 1;

94889 
	gc2
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94891 ifÐ
	gc2
==']' ){

94892 ifÐ
c
==']' ) 
£’
 = 1;

94893 
	gc2
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94895  
	gc2
 && c2!=']' ){

94896 ifÐ
c2
=='-' && 
zP©‹º
[0]!=']' && zP©‹º[0]!=0 && 
´iÜ_c
>0 ){

94897 
c2
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94898 ifÐ
	gc
>=
´iÜ_c
 && 
c
<=
c2
 ) 
£’
 = 1;

94899 
	g´iÜ_c
 = 0;

94901 ifÐ
	gc
==
c2
 ){

94902 
£’
 = 1;

94904 
	g´iÜ_c
 = 
c2
;

94906 
	gc2
 = 
sql™e3Utf8R—d
(&
zP©‹º
);

94908 ifÐ
	gc2
==0 || (
£’
 ^ 
šv”t
)==0 ){

94914 
	gc2
 = 
sql™e3Utf8R—d
(&
zSŒšg
);

94915 ifÐ
	gc
==
c2
 ) ;

94916 ifÐ
	gnoCa£
 && 
	gc
<0x80 && 
	gc2
<0x80 && 
sql™e3TÞow”
(
c
)==sql™e3TÞow”(
c2
) ){

94919 ifÐ
	gc
==
m©chOÃ
 && 
zP©‹º
!=
zEsÿ³d
 && 
c2
!=0 ) ;

94922  *
	gzSŒšg
==0;

94928 
SQLITE_API
 
sql™e3_¡rglob
(cÚ¡ *
zGlobP©‹º
, cÚ¡ *
zSŒšg
){

94929  
·‰”nCom·»
((
u8
*)
zGlobP©‹º
, (u8*)
zSŒšg
, &
globInfo
, 0)==0;

94937 #ifdeà
SQLITE_TEST


94938 
SQLITE_API
 
	gsql™e3_like_couÁ
 = 0;

94954 
likeFunc
(

94955 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

94956 
¬gc
,

94957 
sql™e3_v®ue
 **
¬gv


94959 cÚ¡ *
	gzA
, *
	gzB
;

94960 
u32
 
	gesÿ³
 = 0;

94961 
	gnP©
;

94962 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

94964 
	gzB
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

94965 
	gzA
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

94970 
	gnP©
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

94971 
‹¡ÿ£
Ð
nP©
==
db
->
aLim™
[
SQLITE_LIMIT_LIKE_PATTERN_LENGTH
] );

94972 
‹¡ÿ£
Ð
nP©
==
db
->
aLim™
[
SQLITE_LIMIT_LIKE_PATTERN_LENGTH
]+1 );

94973 ifÐ
	gnP©
 > 
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LIKE_PATTERN_LENGTH
] ){

94974 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "LIKE or GLOB…atternoo complex", -1);

94977 
as£¹
Ð
zB
==
sql™e3_v®ue_‹xt
(
¬gv
[0]) );

94979 ifÐ
	g¬gc
==3 ){

94983 cÚ¡ *
zEsc
 = 
sql™e3_v®ue_‹xt
(
¬gv
[2]);

94984 ifÐ
	gzEsc
==0 ) ;

94985 ifÐ
sql™e3Utf8Ch¬L’
((*)
zEsc
, -1)!=1 ){

94986 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
,

94990 
	gesÿ³
 = 
sql™e3Utf8R—d
(&
zEsc
);

94992 ifÐ
	gzA
 && 
	gzB
 ){

94993 
com·»Info
 *
	gpInfo
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

94994 #ifdeà
SQLITE_TEST


94995 
	gsql™e3_like_couÁ
++;

94998 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
·‰”nCom·»
(
zB
, 
zA
, 
pInfo
, 
esÿ³
));

95007 
nuÎifFunc
(

95008 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95009 
NÙU£d
,

95010 
sql™e3_v®ue
 **
¬gv


95012 
CÞlSeq
 *
	gpCÞl
 = 
sql™e3G‘FuncCÞlSeq
(
cÚ‹xt
);

95013 
UNUSED_PARAMETER
(
NÙU£d
);

95014 ifÐ
sql™e3MemCom·»
(
¬gv
[0],‡rgv[1], 
pCÞl
)!=0 ){

95015 
sql™e3_»suÉ_v®ue
(
cÚ‹xt
, 
¬gv
[0]);

95023 
v”siÚFunc
(

95024 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95025 
NÙU£d
,

95026 
sql™e3_v®ue
 **
NÙU£d2


95028 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

95031 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
sql™e3_libv”siÚ
(), -1, 
SQLITE_STATIC
);

95039 
sourûidFunc
(

95040 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95041 
NÙU£d
,

95042 
sql™e3_v®ue
 **
NÙU£d2


95044 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

95047 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
sql™e3_sourûid
(), -1, 
SQLITE_STATIC
);

95055 
”¾ogFunc
(

95056 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95057 
¬gc
,

95058 
sql™e3_v®ue
 **
¬gv


95060 
UNUSED_PARAMETER
(
¬gc
);

95061 
UNUSED_PARAMETER
(
cÚ‹xt
);

95062 
sql™e3_log
(
sql™e3_v®ue_št
(
¬gv
[0]), "%s", 
sql™e3_v®ue_‹xt
(argv[1]));

95070 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


95071 
compžeÝtiÚu£dFunc
(

95072 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95073 
¬gc
,

95074 
sql™e3_v®ue
 **
¬gv


95076 cÚ¡ *
	gzO±Name
;

95077 
as£¹
Ð
¬gc
==1 );

95078 
UNUSED_PARAMETER
(
¬gc
);

95083 ifÐ(
	gzO±Name
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]))!=0 ){

95084 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
sql™e3_compžeÝtiÚ_u£d
(
zO±Name
));

95094 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


95095 
compžeÝtiÚg‘Func
(

95096 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95097 
¬gc
,

95098 
sql™e3_v®ue
 **
¬gv


95100 
	gn
;

95101 
as£¹
Ð
¬gc
==1 );

95102 
UNUSED_PARAMETER
(
¬gc
);

95106 
	gn
 = 
sql™e3_v®ue_št
(
¬gv
[0]);

95107 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
sql™e3_compžeÝtiÚ_g‘
(
n
), -1, 
SQLITE_STATIC
);

95113 cÚ¡ 
	ghexdig™s
[] = {

95125 
quÙeFunc
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

95126 
as£¹
Ð
¬gc
==1 );

95127 
UNUSED_PARAMETER
(
¬gc
);

95128  
sql™e3_v®ue_ty³
(
¬gv
[0]) ){

95129 
	gSQLITE_FLOAT
: {

95130 
r1
, 
	gr2
;

95131 
	gzBuf
[50];

95132 
	gr1
 = 
sql™e3_v®ue_doubË
(
¬gv
[0]);

95133 
sql™e3_¢´štf
((
zBuf
), zBuf, "%!.15g", 
r1
);

95134 
sql™e3AtoF
(
zBuf
, &
r2
, 20, 
SQLITE_UTF8
);

95135 ifÐ
	gr1
!=
r2
 ){

95136 
sql™e3_¢´štf
((
zBuf
), zBuf, "%!.20e", 
r1
);

95138 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

95141 
	gSQLITE_INTEGER
: {

95142 
sql™e3_»suÉ_v®ue
(
cÚ‹xt
, 
¬gv
[0]);

95145 
	gSQLITE_BLOB
: {

95146 *
zText
 = 0;

95147 cÚ¡ *
	gzBlob
 = 
sql™e3_v®ue_blob
(
¬gv
[0]);

95148 
	gnBlob
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

95149 
as£¹
Ð
zBlob
==
sql™e3_v®ue_blob
(
¬gv
[0]) );

95150 
	gzText
 = (*)
cÚ‹xtM®loc
(
cÚ‹xt
, (2*(
i64
)
nBlob
)+4);

95151 ifÐ
	gzText
 ){

95152 
	gi
;

95153 
	gi
=0; i<
	gnBlob
; i++){

95154 
	gzText
[(
i
*2)+2] = 
hexdig™s
[(
zBlob
[i]>>4)&0x0F];

95155 
	gzText
[(
i
*2)+3] = 
hexdig™s
[(
zBlob
[i])&0x0F];

95157 
	gzText
[(
nBlob
*2)+2] = '\'';

95158 
	gzText
[(
nBlob
*2)+3] = '\0';

95159 
	gzText
[0] = 'X';

95160 
	gzText
[1] = '\'';

95161 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zText
, -1, 
SQLITE_TRANSIENT
);

95162 
sql™e3_ä“
(
zText
);

95166 
	gSQLITE_TEXT
: {

95167 
i
,
	gj
;

95168 
u64
 
	gn
;

95169 cÚ¡ *
	gzArg
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95170 *
	gz
;

95172 ifÐ
	gzArg
==0 ) ;

95173 
	gi
=0, 
	gn
=0; 
	gzArg
[
i
]; i++){ ifÐzArg[i]=='\'' ) 
n
++; }

95174 
	gz
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, ((
i64
)
i
)+((i64)
n
)+3);

95175 ifÐ
	gz
 ){

95176 
	gz
[0] = '\'';

95177 
	gi
=0, 
	gj
=1; 
	gzArg
[
i
]; i++){

95178 
	gz
[
j
++] = 
zArg
[
i
];

95179 ifÐ
	gzArg
[
i
]=='\'' ){

95180 
z
[
j
++] = '\'';

95183 
	gz
[
j
++] = '\'';

95184 
	gz
[
j
] = 0;

95185 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
z
, 
j
, 
sql™e3_ä“
);

95190 
as£¹
Ð
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 );

95191 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, "NULL", 4, 
SQLITE_STATIC
);

95201 
unicodeFunc
(

95202 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95203 
¬gc
,

95204 
sql™e3_v®ue
 **
¬gv


95206 cÚ¡ *
	gz
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95207 ()
	g¬gc
;

95208 ifÐ
	gz
 && z[0] ) 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
sql™e3Utf8R—d
(&
z
));

95216 
ch¬Func
(

95217 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95218 
¬gc
,

95219 
sql™e3_v®ue
 **
¬gv


95221 *
	gz
, *
	gzOut
;

95222 
	gi
;

95223 
	gzOut
 = 
z
 = 
sql™e3_m®loc
Ð
¬gc
*4+1 );

95224 ifÐ
	gz
==0 ){

95225 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

95228 
	gi
=0; i<
	g¬gc
; i++){

95229 
sql™e3_št64
 
	gx
;

95230 
	gc
;

95231 
	gx
 = 
sql™e3_v®ue_št64
(
¬gv
[
i
]);

95232 ifÐ
	gx
<0 || x>0x10ffff ) x = 0xfffd;

95233 
	gc
 = ()(
x
 & 0x1fffff);

95234 ifÐ
	gc
<0x00080 ){

95235 *
	gzOut
++ = (
u8
)(
c
&0xFF);

95236 }ifÐ
	gc
<0x00800 ){

95237 *
	gzOut
++ = 0xC0 + (
u8
)((
c
>>6)&0x1F);

95238 *
	gzOut
++ = 0x80 + (
u8
)(
c
 & 0x3F);

95239 }ifÐ
	gc
<0x10000 ){

95240 *
	gzOut
++ = 0xE0 + (
u8
)((
c
>>12)&0x0F);

95241 *
	gzOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F);

95242 *
	gzOut
++ = 0x80 + (
u8
)(
c
 & 0x3F);

95244 *
	gzOut
++ = 0xF0 + (
u8
)((
c
>>18) & 0x07);

95245 *
	gzOut
++ = 0x80 + (
u8
)((
c
>>12) & 0x3F);

95246 *
	gzOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F);

95247 *
	gzOut
++ = 0x80 + (
u8
)(
c
 & 0x3F);

95250 
sql™e3_»suÉ_‹xt64
(
cÚ‹xt
, (*)
z
, 
zOut
-z, 
sql™e3_ä“
, 
SQLITE_UTF8
);

95257 
hexFunc
(

95258 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95259 
¬gc
,

95260 
sql™e3_v®ue
 **
¬gv


95262 
	gi
, 
	gn
;

95263 cÚ¡ *
	gpBlob
;

95264 *
	gzHex
, *
	gz
;

95265 
as£¹
Ð
¬gc
==1 );

95266 
UNUSED_PARAMETER
(
¬gc
);

95267 
	gpBlob
 = 
sql™e3_v®ue_blob
(
¬gv
[0]);

95268 
	gn
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

95269 
as£¹
Ð
pBlob
==
sql™e3_v®ue_blob
(
¬gv
[0]) );

95270 
	gz
 = 
zHex
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, ((
i64
)
n
)*2 + 1);

95271 ifÐ
	gzHex
 ){

95272 
	gi
=0; i<
	gn
; i++, 
	gpBlob
++){

95273 
	gc
 = *
pBlob
;

95274 *(
	gz
++èð
hexdig™s
[(
c
>>4)&0xf];

95275 *(
	gz
++èð
hexdig™s
[
c
&0xf];

95277 *
	gz
 = 0;

95278 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zHex
, 
n
*2, 
sql™e3_ä“
);

95285 
z”oblobFunc
(

95286 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95287 
¬gc
,

95288 
sql™e3_v®ue
 **
¬gv


95290 
i64
 
	gn
;

95291 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

95292 
as£¹
Ð
¬gc
==1 );

95293 
UNUSED_PARAMETER
(
¬gc
);

95294 
	gn
 = 
sql™e3_v®ue_št64
(
¬gv
[0]);

95295 
‹¡ÿ£
Ð
n
==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] );

95296 
‹¡ÿ£
Ð
n
==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
]+1 );

95297 ifÐ
	gn
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

95298 
sql™e3_»suÉ_”rÜ_toobig
(
cÚ‹xt
);

95300 
sql™e3_»suÉ_z”oblob
(
cÚ‹xt
, ()
n
);

95310 
»¶aûFunc
(

95311 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95312 
¬gc
,

95313 
sql™e3_v®ue
 **
¬gv


95315 cÚ¡ *
	gzSŒ
;

95316 cÚ¡ *
	gzP©‹º
;

95317 cÚ¡ *
	gzR•
;

95318 *
	gzOut
;

95319 
	gnSŒ
;

95320 
	gnP©‹º
;

95321 
	gnR•
;

95322 
i64
 
	gnOut
;

95323 
	gloÝLim™
;

95324 
	gi
, 
	gj
;

95326 
as£¹
Ð
¬gc
==3 );

95327 
UNUSED_PARAMETER
(
¬gc
);

95328 
	gzSŒ
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95329 ifÐ
	gzSŒ
==0 ) ;

95330 
	gnSŒ
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

95331 
as£¹
Ð
zSŒ
==
sql™e3_v®ue_‹xt
(
¬gv
[0]) );

95332 
	gzP©‹º
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

95333 ifÐ
	gzP©‹º
==0 ){

95334 
as£¹
Ð
sql™e3_v®ue_ty³
(
¬gv
[1])==
SQLITE_NULL


95335 || 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
)->
m®locFažed
 );

95338 ifÐ
	gzP©‹º
[0]==0 ){

95339 
as£¹
Ð
sql™e3_v®ue_ty³
(
¬gv
[1])!=
SQLITE_NULL
 );

95340 
sql™e3_»suÉ_v®ue
(
cÚ‹xt
, 
¬gv
[0]);

95343 
	gnP©‹º
 = 
sql™e3_v®ue_by‹s
(
¬gv
[1]);

95344 
as£¹
Ð
zP©‹º
==
sql™e3_v®ue_‹xt
(
¬gv
[1]) );

95345 
	gzR•
 = 
sql™e3_v®ue_‹xt
(
¬gv
[2]);

95346 ifÐ
	gzR•
==0 ) ;

95347 
	gnR•
 = 
sql™e3_v®ue_by‹s
(
¬gv
[2]);

95348 
as£¹
Ð
zR•
==
sql™e3_v®ue_‹xt
(
¬gv
[2]) );

95349 
	gnOut
 = 
nSŒ
 + 1;

95350 
as£¹
Ð
nOut
<
SQLITE_MAX_LENGTH
 );

95351 
	gzOut
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, (
i64
)
nOut
);

95352 ifÐ
	gzOut
==0 ){

95355 
	gloÝLim™
 = 
nSŒ
 - 
nP©‹º
;

95356 
	gi
=
j
=0; i<=
loÝLim™
; i++){

95357 ifÐ
	gzSŒ
[
i
]!=
zP©‹º
[0] || 
memcmp
(&
zSŒ
[i], zP©‹º, 
nP©‹º
) ){

95358 
	gzOut
[
j
++] = 
zSŒ
[
i
];

95360 
u8
 *
	gzOld
;

95361 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

95362 
	gnOut
 +ð
nR•
 - 
nP©‹º
;

95363 
‹¡ÿ£
Ð
nOut
-1==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] );

95364 
‹¡ÿ£
Ð
nOut
-2==
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
] );

95365 ifÐ
	gnOut
-1>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_LENGTH
] ){

95366 
sql™e3_»suÉ_”rÜ_toobig
(
cÚ‹xt
);

95367 
sql™e3_ä“
(
zOut
);

95370 
	gzOld
 = 
zOut
;

95371 
	gzOut
 = 
sql™e3_»®loc
(
zOut
, ()
nOut
);

95372 ifÐ
	gzOut
==0 ){

95373 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

95374 
sql™e3_ä“
(
zOld
);

95377 
memýy
(&
zOut
[
j
], 
zR•
, 
nR•
);

95378 
	gj
 +ð
nR•
;

95379 
	gi
 +ð
nP©‹º
-1;

95382 
as£¹
Ð
j
+
nSŒ
-
i
+1==
nOut
 );

95383 
memýy
(&
zOut
[
j
], &
zSŒ
[
i
], 
nSŒ
-i);

95384 
	gj
 +ð
nSŒ
 - 
i
;

95385 
as£¹
Ð
j
<=
nOut
 );

95386 
	gzOut
[
j
] = 0;

95387 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, (*)
zOut
, 
j
, 
sql™e3_ä“
);

95394 
ŒimFunc
(

95395 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95396 
¬gc
,

95397 
sql™e3_v®ue
 **
¬gv


95399 cÚ¡ *
	gzIn
;

95400 cÚ¡ *
	gzCh¬S‘
;

95401 
	gnIn
;

95402 
	gæags
;

95403 
	gi
;

95404 *
	gaL’
 = 0;

95405 **
	gazCh¬
 = 0;

95406 
	gnCh¬
;

95408 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 ){

95411 
	gzIn
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95412 ifÐ
	gzIn
==0 ) ;

95413 
	gnIn
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

95414 
as£¹
Ð
zIn
==
sql™e3_v®ue_‹xt
(
¬gv
[0]) );

95415 ifÐ
	g¬gc
==1 ){

95416 cÚ¡ 
ËnOÃ
[] = { 1 };

95417 * cÚ¡ 
	gazOÃ
[] = { (
u8
*)" " };

95418 
	gnCh¬
 = 1;

95419 
	gaL’
 = (
u8
*)
ËnOÃ
;

95420 
	gazCh¬
 = (**)
azOÃ
;

95421 
	gzCh¬S‘
 = 0;

95422 }ifÐ(
	gzCh¬S‘
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]))==0 ){

95425 cÚ¡ *
	gz
;

95426 
	gz
=
zCh¬S‘
, 
	gnCh¬
=0; *z;‚Char++){

95427 
SQLITE_SKIP_UTF8
(
z
);

95429 ifÐ
	gnCh¬
>0 ){

95430 
	gazCh¬
 = 
cÚ‹xtM®loc
(
cÚ‹xt
, ((
i64
)
nCh¬
)*((*)+1));

95431 ifÐ
	gazCh¬
==0 ){

95434 
	gaL’
 = (*)&
azCh¬
[
nCh¬
];

95435 
	gz
=
zCh¬S‘
, 
	gnCh¬
=0; *z;‚Char++){

95436 
	gazCh¬
[
nCh¬
] = (*)
z
;

95437 
SQLITE_SKIP_UTF8
(
z
);

95438 
	gaL’
[
nCh¬
] = (
u8
)(
z
 - 
azCh¬
[nChar]);

95442 ifÐ
	gnCh¬
>0 ){

95443 
	gæags
 = 
SQLITE_PTR_TO_INT
(
sql™e3_u£r_d©a
(
cÚ‹xt
));

95444 ifÐ
	gæags
 & 1 ){

95445  
	gnIn
>0 ){

95446 
	gËn
 = 0;

95447 
	gi
=0; i<
	gnCh¬
; i++){

95448 
	gËn
 = 
aL’
[
i
];

95449 ifÐ
	gËn
<=
nIn
 && 
memcmp
(
zIn
, 
azCh¬
[
i
], 
Ën
)==0 ) ;

95451 ifÐ
	gi
>=
nCh¬
 ) ;

95452 
	gzIn
 +ð
Ën
;

95453 
	gnIn
 -ð
Ën
;

95456 ifÐ
	gæags
 & 2 ){

95457  
	gnIn
>0 ){

95458 
	gËn
 = 0;

95459 
	gi
=0; i<
	gnCh¬
; i++){

95460 
	gËn
 = 
aL’
[
i
];

95461 ifÐ
	gËn
<=
nIn
 && 
memcmp
(&
zIn
[nIn-
Ën
],
azCh¬
[
i
],len)==0 ) ;

95463 ifÐ
	gi
>=
nCh¬
 ) ;

95464 
	gnIn
 -ð
Ën
;

95467 ifÐ
	gzCh¬S‘
 ){

95468 
sql™e3_ä“
(
azCh¬
);

95471 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, (*)
zIn
, 
nIn
, 
SQLITE_TRANSIENT
);

95479 #ifdeà
SQLITE_SOUNDEX


95486 
soundexFunc
(

95487 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95488 
¬gc
,

95489 
sql™e3_v®ue
 **
¬gv


95491 
	gzResuÉ
[8];

95492 cÚ¡ 
u8
 *
	gzIn
;

95493 
	gi
, 
	gj
;

95494 cÚ¡ 
	giCode
[] = {

95504 
as£¹
Ð
¬gc
==1 );

95505 
	gzIn
 = (
u8
*)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95506 ifÐ
	gzIn
==0 ) 
zIn
 = (
u8
*)"";

95507 
	gi
=0; 
	gzIn
[
i
] && !
sql™e3I§Íha
(
zIn
[i]); i++){}

95508 ifÐ
	gzIn
[
i
] ){

95509 
u8
 
	g´evcode
 = 
iCode
[
zIn
[
i
]&0x7f];

95510 
	gzResuÉ
[0] = 
sql™e3Touµ”
(
zIn
[
i
]);

95511 
	gj
=1; j<4 && 
	gzIn
[
i
]; 
	gi
++){

95512 
	gcode
 = 
iCode
[
zIn
[
i
]&0x7f];

95513 ifÐ
	gcode
>0 ){

95514 ifÐ
	gcode
!=
´evcode
 ){

95515 
´evcode
 = 
code
;

95516 
	gzResuÉ
[
j
++] = 
code
 + '0';

95519 
	g´evcode
 = 0;

95522  
	gj
<4 ){

95523 
	gzResuÉ
[
j
++] = '0';

95525 
	gzResuÉ
[
j
] = 0;

95526 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zResuÉ
, 4, 
SQLITE_TRANSIENT
);

95530 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, "?000", 4, 
SQLITE_STATIC
);

95535 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


95539 
lßdExt
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

95540 cÚ¡ *
	gzFže
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95541 cÚ¡ *
	gzProc
;

95542 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

95543 *
	gzE¼Msg
 = 0;

95545 ifÐ
	g¬gc
==2 ){

95546 
zProc
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[1]);

95548 
	gzProc
 = 0;

95550 ifÐ
	gzFže
 && 
sql™e3_lßd_ex‹nsiÚ
(
db
, 
zFže
, 
zProc
, &
zE¼Msg
) ){

95551 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼Msg
, -1);

95552 
sql™e3_ä“
(
zE¼Msg
);

95562 
SumCtx
 
	tSumCtx
;

95563 
	sSumCtx
 {

95564 
	grSum
;

95565 
i64
 
	giSum
;

95566 
i64
 
	gút
;

95567 
u8
 
	gov”æow
;

95568 
u8
 
	g­´ox
;

95581 
sumS‹p
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

95582 
SumCtx
 *
	gp
;

95583 
	gty³
;

95584 
as£¹
Ð
¬gc
==1 );

95585 
UNUSED_PARAMETER
(
¬gc
);

95586 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, (*
p
));

95587 
	gty³
 = 
sql™e3_v®ue_num”ic_ty³
(
¬gv
[0]);

95588 ifÐ
	gp
 && 
	gty³
!=
SQLITE_NULL
 ){

95589 
p
->
út
++;

95590 ifÐ
	gty³
==
SQLITE_INTEGER
 ){

95591 
i64
 
v
 = 
sql™e3_v®ue_št64
(
¬gv
[0]);

95592 
	gp
->
	grSum
 +ð
v
;

95593 ifÐ(
	gp
->
	g­´ox
|p->
	gov”æow
)==0 && 
sql™e3AddIÁ64
(&
p
->
iSum
, 
v
) ){

95594 
	gp
->
	gov”æow
 = 1;

95597 
	gp
->
	grSum
 +ð
sql™e3_v®ue_doubË
(
¬gv
[0]);

95598 
	gp
->
	g­´ox
 = 1;

95602 
sumFš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95603 
SumCtx
 *
	gp
;

95604 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95605 ifÐ
	gp
 &&…->
	gút
>0 ){

95606 ifÐ
	gp
->
	gov”æow
 ){

95607 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
,"integer overflow",-1);

95608 }ifÐ
	gp
->
	g­´ox
 ){

95609 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
p
->
rSum
);

95611 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
p
->
iSum
);

95615 
avgFš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95616 
SumCtx
 *
	gp
;

95617 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95618 ifÐ
	gp
 &&…->
	gút
>0 ){

95619 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
p
->
rSum
/(í->
út
);

95622 
tÙ®Fš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95623 
SumCtx
 *
	gp
;

95624 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95626 
sql™e3_»suÉ_doubË
(
cÚ‹xt
, 
p
 ?…->
rSum
 : ()0);

95633 
CouÁCtx
 
	tCouÁCtx
;

95634 
	sCouÁCtx
 {

95635 
i64
 
	gn
;

95641 
couÁS‹p
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
, 
¬gc
, 
sql™e3_v®ue
 **
¬gv
){

95642 
CouÁCtx
 *
	gp
;

95643 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, (*
p
));

95644 ifÐ(
	g¬gc
==0 || 
SQLITE_NULL
!=
sql™e3_v®ue_ty³
(
¬gv
[0])è&& 
p
 ){

95645 
p
->
n
++;

95648 #iâdeà
SQLITE_OMIT_DEPRECATED


95653 
as£¹
Ð
¬gc
==1 || 
p
==0 ||…->
n
>0x7fffffff

95654 || 
p
->
n
==
sql™e3_agg»g©e_couÁ
(
cÚ‹xt
) );

95657 
couÁFš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95658 
CouÁCtx
 *
	gp
;

95659 
	gp
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95660 
sql™e3_»suÉ_št64
(
cÚ‹xt
, 
p
 ?…->
n
 : 0);

95666 
mšmaxS‹p
(

95667 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95668 
NÙU£d
,

95669 
sql™e3_v®ue
 **
¬gv


95671 
Mem
 *
	gpArg
 = (Mem *)
¬gv
[0];

95672 
Mem
 *
	gpBe¡
;

95673 
UNUSED_PARAMETER
(
NÙU£d
);

95675 
	gpBe¡
 = (
Mem
 *)
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, (*
pBe¡
));

95676 ifÐ!
	gpBe¡
 ) ;

95678 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 ){

95679 ifÐ
pBe¡
->
æags
 ) 
sql™e3SkAccumuÏtÜLßd
(
cÚ‹xt
);

95680 }ifÐ
	gpBe¡
->
	gæags
 ){

95681 
	gmax
;

95682 
	gcmp
;

95683 
CÞlSeq
 *
	gpCÞl
 = 
sql™e3G‘FuncCÞlSeq
(
cÚ‹xt
);

95692 
	gmax
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
)!=0;

95693 
	gcmp
 = 
sql™e3MemCom·»
(
pBe¡
, 
pArg
, 
pCÞl
);

95694 ifÐ(
	gmax
 && 
	gcmp
<0) || (!max && cmp>0) ){

95695 
sql™e3VdbeMemCÝy
(
pBe¡
, 
pArg
);

95697 
sql™e3SkAccumuÏtÜLßd
(
cÚ‹xt
);

95700 
	gpBe¡
->
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

95701 
sql™e3VdbeMemCÝy
(
pBe¡
, 
pArg
);

95704 
mšMaxFš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95705 
sql™e3_v®ue
 *
	gpRes
;

95706 
	gpRes
 = (
sql™e3_v®ue
 *)
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95707 ifÐ
	gpRes
 ){

95708 ifÐ
	gpRes
->
	gæags
 ){

95709 
sql™e3_»suÉ_v®ue
(
cÚ‹xt
, 
pRes
);

95711 
sql™e3VdbeMemR–—£
(
pRes
);

95718 
groupCÚÿtS‹p
(

95719 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

95720 
¬gc
,

95721 
sql™e3_v®ue
 **
¬gv


95723 cÚ¡ *
	gzV®
;

95724 
SŒAccum
 *
	gpAccum
;

95725 cÚ¡ *
	gzS•
;

95726 
	gnV®
, 
	gnS•
;

95727 
as£¹
Ð
¬gc
==1 ||‡rgc==2 );

95728 ifÐ
sql™e3_v®ue_ty³
(
¬gv
[0])==
SQLITE_NULL
 ) ;

95729 
	gpAccum
 = (
SŒAccum
*)
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, (*
pAccum
));

95731 ifÐ
	gpAccum
 ){

95732 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

95733 
	gfœ¡T”m
 = 
pAccum
->
u£M®loc
==0;

95734 
	gpAccum
->
	gu£M®loc
 = 2;

95735 
	gpAccum
->
	gmxAÎoc
 = 
db
->
aLim™
[
SQLITE_LIMIT_LENGTH
];

95736 ifÐ!
	gfœ¡T”m
 ){

95737 ifÐ
	g¬gc
==2 ){

95738 
zS•
 = (*)
sql™e3_v®ue_‹xt
(
¬gv
[1]);

95739 
	gnS•
 = 
sql™e3_v®ue_by‹s
(
¬gv
[1]);

95741 
	gzS•
 = ",";

95742 
	gnS•
 = 1;

95744 ifÐ
	gnS•
 ) 
sql™e3SŒAccumAµ’d
(
pAccum
, 
zS•
, 
nS•
);

95746 
	gzV®
 = (*)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

95747 
	gnV®
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

95748 ifÐ
	gzV®
 ) 
sql™e3SŒAccumAµ’d
(
pAccum
, 
zV®
, 
nV®
);

95751 
groupCÚÿtFš®ize
(
sql™e3_cÚ‹xt
 *
cÚ‹xt
){

95752 
SŒAccum
 *
	gpAccum
;

95753 
	gpAccum
 = 
sql™e3_agg»g©e_cÚ‹xt
(
cÚ‹xt
, 0);

95754 ifÐ
	gpAccum
 ){

95755 ifÐ
	gpAccum
->
	gaccE¼Ü
==
STRACCUM_TOOBIG
 ){

95756 
sql™e3_»suÉ_”rÜ_toobig
(
cÚ‹xt
);

95757 }ifÐ
	gpAccum
->
	gaccE¼Ü
==
STRACCUM_NOMEM
 ){

95758 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

95760 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
sql™e3SŒAccumFšish
(
pAccum
), -1,

95761 
sql™e3_ä“
);

95771 
SQLITE_PRIVATE
 
sql™e3Regi¡”BužtšFunùiÚs
(
sql™e3
 *
db
){

95772 
	grc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "MATCH", 2);

95773 
as£¹
Ð
rc
==
SQLITE_NOMEM
 ||„c==
SQLITE_OK
 );

95774 ifÐ
	grc
==
SQLITE_NOMEM
 ){

95775 
db
->
m®locFažed
 = 1;

95782 
£tLikeO±FÏg
(
sql™e3
 *
db
, cÚ¡ *
zName
, 
u8
 
æagV®
){

95783 
FuncDef
 *
	gpDef
;

95784 
	gpDef
 = 
sql™e3FšdFunùiÚ
(
db
, 
zName
, 
sql™e3SŒËn30
(zName),

95785 2, 
SQLITE_UTF8
, 0);

95786 ifÐ
ALWAYS
(
pDef
) ){

95787 
	gpDef
->
	gfuncFÏgs
 |ð
æagV®
;

95796 
SQLITE_PRIVATE
 
sql™e3Regi¡”LikeFunùiÚs
(
sql™e3
 *
db
, 
ÿ£S’s™ive
){

95797 
com·»Info
 *
	gpInfo
;

95798 ifÐ
	gÿ£S’s™ive
 ){

95799 
	gpInfo
 = (
com·»Info
*)&
likeInfoAÉ
;

95801 
	gpInfo
 = (
com·»Info
*)&
likeInfoNÜm
;

95803 
sql™e3C»©eFunc
(
db
, "like", 2, 
SQLITE_UTF8
, 
pInfo
, 
likeFunc
, 0, 0, 0);

95804 
sql™e3C»©eFunc
(
db
, "like", 3, 
SQLITE_UTF8
, 
pInfo
, 
likeFunc
, 0, 0, 0);

95805 
sql™e3C»©eFunc
(
db
, "glob", 2, 
SQLITE_UTF8
,

95806 (
com·»Info
*)&
globInfo
, 
likeFunc
, 0, 0, 0);

95807 
£tLikeO±FÏg
(
db
, "glob", 
SQLITE_FUNC_LIKE
 | 
SQLITE_FUNC_CASE
);

95808 
£tLikeO±FÏg
(
db
, "like",

95809 
ÿ£S’s™ive
 ? (
SQLITE_FUNC_LIKE
 | 
SQLITE_FUNC_CASE
) : SQLITE_FUNC_LIKE);

95819 
SQLITE_PRIVATE
 
sql™e3IsLikeFunùiÚ
(
sql™e3
 *
db
, 
Ex´
 *
pEx´
, *
pIsNoÿ£
, *
aWc
){

95820 
FuncDef
 *
	gpDef
;

95821 ifÐ
	gpEx´
->
	gÝ
!=
TK_FUNCTION


95822 || !
pEx´
->
x
.
pLi¡


95823 || 
pEx´
->
x
.
pLi¡
->
nEx´
!=2

95827 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

95828 
	gpDef
 = 
sql™e3FšdFunùiÚ
(
db
, 
pEx´
->
u
.
zTok’
,

95829 
sql™e3SŒËn30
(
pEx´
->
u
.
zTok’
),

95830 2, 
SQLITE_UTF8
, 0);

95831 ifÐ
NEVER
(
pDef
==0è|| (pDef->
funcFÏgs
 & 
SQLITE_FUNC_LIKE
)==0 ){

95839 
memýy
(
aWc
, 
pDef
->
pU£rD©a
, 3);

95840 
as£¹
Ð(*)&
likeInfoAÉ
 =ð(*)&likeInfoAÉ.
m©chAÎ
 );

95841 
as£¹
Ð&((*)&
likeInfoAÉ
)[1] =ð(*)&likeInfoAÉ.
m©chOÃ
 );

95842 
as£¹
Ð&((*)&
likeInfoAÉ
)[2] =ð(*)&likeInfoAÉ.
m©chS‘
 );

95843 *
	gpIsNoÿ£
 = (
pDef
->
funcFÏgs
 & 
SQLITE_FUNC_CASE
)==0;

95854 
SQLITE_PRIVATE
 
sql™e3Regi¡”Glob®FunùiÚs
(){

95863 
SQLITE_WSD
 
FuncDef
 
	gaBužtšFunc
[] = {

95864 
FUNCTION
(
Érim
, 1, 1, 0, 
ŒimFunc
 ),

95865 
FUNCTION
(
Érim
, 2, 1, 0, 
ŒimFunc
 ),

95866 
FUNCTION
(
¹rim
, 1, 2, 0, 
ŒimFunc
 ),

95867 
FUNCTION
(
¹rim
, 2, 2, 0, 
ŒimFunc
 ),

95868 
FUNCTION
(
Œim
, 1, 3, 0, 
ŒimFunc
 ),

95869 
FUNCTION
(
Œim
, 2, 3, 0, 
ŒimFunc
 ),

95870 
FUNCTION
(
mš
, -1, 0, 1, 
mšmaxFunc
 ),

95871 
FUNCTION
(
mš
, 0, 0, 1, 0 ),

95872 
AGGREGATE2
(
mš
, 1, 0, 1, 
mšmaxS‹p
, 
mšMaxFš®ize
,

95873 
SQLITE_FUNC_MINMAX
 ),

95874 
FUNCTION
(
max
, -1, 1, 1, 
mšmaxFunc
 ),

95875 
FUNCTION
(
max
, 0, 1, 1, 0 ),

95876 
AGGREGATE2
(
max
, 1, 1, 1, 
mšmaxS‹p
, 
mšMaxFš®ize
,

95877 
SQLITE_FUNC_MINMAX
 ),

95878 
FUNCTION2
(
ty³of
, 1, 0, 0, 
ty³ofFunc
, 
SQLITE_FUNC_TYPEOF
),

95879 
FUNCTION2
(
Ëngth
, 1, 0, 0, 
ËngthFunc
, 
SQLITE_FUNC_LENGTH
),

95880 
FUNCTION
(
š¡r
, 2, 0, 0, 
š¡rFunc
 ),

95881 
FUNCTION
(
sub¡r
, 2, 0, 0, 
sub¡rFunc
 ),

95882 
FUNCTION
(
sub¡r
, 3, 0, 0, 
sub¡rFunc
 ),

95883 
FUNCTION
(
´štf
, -1, 0, 0, 
´štfFunc
 ),

95884 
FUNCTION
(
unicode
, 1, 0, 0, 
unicodeFunc
 ),

95885 
FUNCTION
(, -1, 0, 0, 
ch¬Func
 ),

95886 
FUNCTION
(
abs
, 1, 0, 0, 
absFunc
 ),

95887 #iâdeà
SQLITE_OMIT_FLOATING_POINT


95888 
FUNCTION
(
round
, 1, 0, 0, 
roundFunc
 ),

95889 
FUNCTION
(
round
, 2, 0, 0, 
roundFunc
 ),

95891 
FUNCTION
(
uµ”
, 1, 0, 0, 
uµ”Func
 ),

95892 
FUNCTION
(
low”
, 1, 0, 0, 
low”Func
 ),

95893 
FUNCTION
(
cßËsû
, 1, 0, 0, 0 ),

95894 
FUNCTION
(
cßËsû
, 0, 0, 0, 0 ),

95895 
FUNCTION2
(
cßËsû
, -1, 0, 0, 
noÝFunc
, 
SQLITE_FUNC_COALESCE
),

95896 
FUNCTION
(
hex
, 1, 0, 0, 
hexFunc
 ),

95897 
FUNCTION2
(
iâuÎ
, 2, 0, 0, 
noÝFunc
, 
SQLITE_FUNC_COALESCE
),

95898 
FUNCTION2
(
uÆik–y
, 1, 0, 0, 
noÝFunc
, 
SQLITE_FUNC_UNLIKELY
),

95899 
FUNCTION2
(
lik–ihood
, 2, 0, 0, 
noÝFunc
, 
SQLITE_FUNC_UNLIKELY
),

95900 
FUNCTION2
(
lik–y
, 1, 0, 0, 
noÝFunc
, 
SQLITE_FUNC_UNLIKELY
),

95901 
VFUNCTION
(
¿ndom
, 0, 0, 0, 
¿ndomFunc
 ),

95902 
VFUNCTION
(
¿ndomblob
, 1, 0, 0, 
¿ndomBlob
 ),

95903 
FUNCTION
(
nuÎif
, 2, 0, 1, 
nuÎifFunc
 ),

95904 
FUNCTION
(
sql™e_v”siÚ
, 0, 0, 0, 
v”siÚFunc
 ),

95905 
FUNCTION
(
sql™e_sourû_id
, 0, 0, 0, 
sourûidFunc
 ),

95906 
FUNCTION
(
sql™e_log
, 2, 0, 0, 
”¾ogFunc
 ),

95907 #ià
SQLITE_USER_AUTHENTICATION


95908 
FUNCTION
(
sql™e_üy±
, 2, 0, 0, 
sql™e3Cry±Func
 ),

95910 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


95911 
FUNCTION
(
sql™e_compžeÝtiÚ_u£d
,1, 0, 0, 
compžeÝtiÚu£dFunc
 ),

95912 
FUNCTION
(
sql™e_compžeÝtiÚ_g‘
, 1, 0, 0, 
compžeÝtiÚg‘Func
 ),

95914 
FUNCTION
(
quÙe
, 1, 0, 0, 
quÙeFunc
 ),

95915 
VFUNCTION
(
Ï¡_š£¹_rowid
, 0, 0, 0,†ast_insert_rowid),

95916 
VFUNCTION
(
chªges
, 0, 0, 0, changes ),

95917 
VFUNCTION
(
tÙ®_chªges
, 0, 0, 0,otal_changes ),

95918 
FUNCTION
(
»¶aû
, 3, 0, 0, 
»¶aûFunc
 ),

95919 
FUNCTION
(
z”oblob
, 1, 0, 0, 
z”oblobFunc
 ),

95920 #ifdeà
SQLITE_SOUNDEX


95921 
FUNCTION
(
soundex
, 1, 0, 0, 
soundexFunc
 ),

95923 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


95924 
FUNCTION
(
lßd_ex‹nsiÚ
, 1, 0, 0, 
lßdExt
 ),

95925 
FUNCTION
(
lßd_ex‹nsiÚ
, 2, 0, 0, 
lßdExt
 ),

95927 
AGGREGATE
(
sum
, 1, 0, 0, 
sumS‹p
, 
sumFš®ize
 ),

95928 
AGGREGATE
(
tÙ®
, 1, 0, 0, 
sumS‹p
, 
tÙ®Fš®ize
 ),

95929 
AGGREGATE
(
avg
, 1, 0, 0, 
sumS‹p
, 
avgFš®ize
 ),

95930 
AGGREGATE2
(
couÁ
, 0, 0, 0, 
couÁS‹p
, 
couÁFš®ize
,

95931 
SQLITE_FUNC_COUNT
 ),

95932 
AGGREGATE
(
couÁ
, 1, 0, 0, 
couÁS‹p
, 
couÁFš®ize
 ),

95933 
AGGREGATE
(
group_cÚÿt
, 1, 0, 0, 
groupCÚÿtS‹p
, 
groupCÚÿtFš®ize
),

95934 
AGGREGATE
(
group_cÚÿt
, 2, 0, 0, 
groupCÚÿtS‹p
, 
groupCÚÿtFš®ize
),

95936 
LIKEFUNC
(
glob
, 2, &
globInfo
, 
SQLITE_FUNC_LIKE
|
SQLITE_FUNC_CASE
),

95937 #ifdeà
SQLITE_CASE_SENSITIVE_LIKE


95938 
LIKEFUNC
(
like
, 2, &
likeInfoAÉ
, 
SQLITE_FUNC_LIKE
|
SQLITE_FUNC_CASE
),

95939 
LIKEFUNC
(
like
, 3, &
likeInfoAÉ
, 
SQLITE_FUNC_LIKE
|
SQLITE_FUNC_CASE
),

95941 
LIKEFUNC
(
like
, 2, &
likeInfoNÜm
, 
SQLITE_FUNC_LIKE
),

95942 
LIKEFUNC
(
like
, 3, &
likeInfoNÜm
, 
SQLITE_FUNC_LIKE
),

95946 
	gi
;

95947 
FuncDefHash
 *
	gpHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

95948 
FuncDef
 *
	gaFunc
 = (FuncDef*)&
GLOBAL
(FuncDef, 
aBužtšFunc
);

95950 
	gi
=0; i<
A¼aySize
(
aBužtšFunc
); i++){

95951 
sql™e3FuncDefIn£¹
(
pHash
, &
aFunc
[
i
]);

95953 
sql™e3Regi¡”D©eTimeFunùiÚs
();

95954 #iâdeà
SQLITE_OMIT_ALTERTABLE


95955 
sql™e3AÉ”FunùiÚs
();

95957 #ià
defšed
(
SQLITE_ENABLE_STAT3
è|| defšed(
SQLITE_ENABLE_STAT4
)

95958 
sql™e3AÇlyzeFunùiÚs
();

95978 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


95979 #iâdeà
SQLITE_OMIT_TRIGGER


96145 
SQLITE_PRIVATE
 
sql™e3FkLoÿ‹Index
(

96146 
P¬£
 *
pP¬£
,

96147 
TabË
 *
pP¬’t
,

96148 
FKey
 *
pFKey
,

96149 
Index
 **
µIdx
,

96150 **
·iCÞ


96152 
Index
 *
	gpIdx
 = 0;

96153 *
	gaiCÞ
 = 0;

96154 
	gnCÞ
 = 
pFKey
->
nCÞ
;

96155 *
	gzKey
 = 
pFKey
->
aCÞ
[0].
zCÞ
;

96158 
as£¹
Ð
µIdx
 && *ppIdx==0 );

96159 
as£¹
Ð!
·iCÞ
 || *paiCol==0 );

96160 
as£¹
Ð
pP¬£
 );

96170 ifÐ
	gnCÞ
==1 ){

96178 ifÐ
pP¬’t
->
iPKey
>=0 ){

96179 ifÐ!
zKey
 )  0;

96180 ifÐ!
sql™e3SŒICmp
(
pP¬’t
->
aCÞ
[pP¬’t->
iPKey
].
zName
, 
zKey
) )  0;

96182 }ifÐ
	g·iCÞ
 ){

96183 
as£¹
Ð
nCÞ
>1 );

96184 
	gaiCÞ
 = (*)
sql™e3DbM®locRaw
(
pP¬£
->
db
, 
nCÞ
*());

96185 ifÐ!
	gaiCÞ
 )  1;

96186 *
	g·iCÞ
 = 
aiCÞ
;

96189 
	gpIdx
=
pP¬’t
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

96190 ifÐ
pIdx
->
nKeyCÞ
==
nCÞ
 && 
IsUniqueIndex
(pIdx) ){

96195 ifÐ
zKey
==0 ){

96199 ifÐ
IsPrim¬yKeyIndex
(
pIdx
) ){

96200 ifÐ
aiCÞ
 ){

96201 
i
;

96202 
	gi
=0; i<
	gnCÞ
; i++è
	gaiCÞ
[
i
] = 
pFKey
->
aCÞ
[i].
iFrom
;

96211 
	gi
, 
	gj
;

96212 
	gi
=0; i<
	gnCÞ
; i++){

96213 
i16
 
	giCÞ
 = 
pIdx
->
aiCÞumn
[
i
];

96214 *
	gzDætCÞl
;

96215 *
	gzIdxCÞ
;

96220 
	gzDætCÞl
 = 
pP¬’t
->
aCÞ
[
iCÞ
].
zCÞl
;

96221 ifÐ!
	gzDætCÞl
 ){

96222 
	gzDætCÞl
 = "BINARY";

96224 ifÐ
sql™e3SŒICmp
(
pIdx
->
azCÞl
[
i
], 
zDætCÞl
) ) ;

96226 
	gzIdxCÞ
 = 
pP¬’t
->
aCÞ
[
iCÞ
].
zName
;

96227 
	gj
=0; j<
	gnCÞ
; j++){

96228 ifÐ
sql™e3SŒICmp
(
pFKey
->
aCÞ
[
j
].
zCÞ
, 
zIdxCÞ
)==0 ){

96229 ifÐ
aiCÞ
 )‡iCÞ[
i
] = 
pFKey
->
aCÞ
[
j
].
iFrom
;

96233 ifÐ
	gj
==
nCÞ
 ) ;

96235 ifÐ
	gi
==
nCÞ
 ) ;

96240 ifÐ!
	gpIdx
 ){

96241 ifÐ!
	gpP¬£
->
	gdi§bËTrigg”s
 ){

96242 
sql™e3E¼ÜMsg
(
pP¬£
,

96244 
pFKey
->
pFrom
->
zName
,…FKey->
zTo
);

96246 
sql™e3DbF»e
(
pP¬£
->
db
, 
aiCÞ
);

96250 *
	gµIdx
 = 
pIdx
;

96280 
fkLookupP¬’t
(

96281 
P¬£
 *
pP¬£
,

96282 
iDb
,

96283 
TabË
 *
pTab
,

96284 
Index
 *
pIdx
,

96285 
FKey
 *
pFKey
,

96286 *
aiCÞ
,

96287 
»gD©a
,

96288 
nInü
,

96289 
isIgnÜe


96291 
	gi
;

96292 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

96293 
	giCur
 = 
pP¬£
->
nTab
 - 1;

96294 
	giOk
 = 
sql™e3VdbeMakeLab–
(
v
);

96303 ifÐ
	gnInü
<0 ){

96304 
sql™e3VdbeAddOp2
(
v
, 
OP_FkIfZ”o
, 
pFKey
->
isDeã¼ed
, 
iOk
);

96305 
VdbeCov”age
(
v
);

96307 
	gi
=0; i<
	gpFKey
->
	gnCÞ
; i++){

96308 
	giReg
 = 
aiCÞ
[
i
] + 
»gD©a
 + 1;

96309 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
iReg
, 
iOk
); 
VdbeCov”age
(v);

96312 ifÐ
	gisIgnÜe
==0 ){

96313 ifÐ
pIdx
==0 ){

96316 
iMu¡BeIÁ
;

96317 
	g»gTemp
 = 
sql™e3G‘TempReg
(
pP¬£
);

96324 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
aiCÞ
[0]+1+
»gD©a
, 
»gTemp
);

96325 
	giMu¡BeIÁ
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Mu¡BeIÁ
, 
»gTemp
, 0);

96326 
VdbeCov”age
(
v
);

96332 ifÐ
	gpTab
==
pFKey
->
pFrom
 && 
nInü
==1 ){

96333 
sql™e3VdbeAddOp3
(
v
, 
OP_Eq
, 
»gD©a
, 
iOk
, 
»gTemp
); 
VdbeCov”age
(v);

96334 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
);

96337 
sql™e3O³nTabË
(
pP¬£
, 
iCur
, 
iDb
, 
pTab
, 
OP_O³nR—d
);

96338 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iCur
, 0, 
»gTemp
); 
VdbeCov”age
(v);

96339 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
iOk
);

96340 
sql™e3VdbeJumpH”e
(
v
, 
sql™e3VdbeCu¼’tAddr
(v)-2);

96341 
sql™e3VdbeJumpH”e
(
v
, 
iMu¡BeIÁ
);

96342 
sql™e3R–—£TempReg
(
pP¬£
, 
»gTemp
);

96344 
	gnCÞ
 = 
pFKey
->
nCÞ
;

96345 
	g»gTemp
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nCÞ
);

96346 
	g»gRec
 = 
sql™e3G‘TempReg
(
pP¬£
);

96348 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nR—d
, 
iCur
, 
pIdx
->
Šum
, 
iDb
);

96349 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

96350 
	gi
=0; i<
	gnCÞ
; i++){

96351 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
aiCÞ
[
i
]+1+
»gD©a
, 
»gTemp
+i);

96364 ifÐ
	gpTab
==
pFKey
->
pFrom
 && 
nInü
==1 ){

96365 
iJump
 = 
sql™e3VdbeCu¼’tAddr
(
v
è+ 
nCÞ
 + 1;

96366 
	gi
=0; i<
	gnCÞ
; i++){

96367 
	giChžd
 = 
aiCÞ
[
i
]+1+
»gD©a
;

96368 
	giP¬’t
 = 
pIdx
->
aiCÞumn
[
i
]+1+
»gD©a
;

96369 
as£¹
Ð
aiCÞ
[
i
]!=
pTab
->
iPKey
 );

96370 ifÐ
	gpIdx
->
	gaiCÞumn
[
i
]==
pTab
->
iPKey
 ){

96372 
iP¬’t
 = 
»gD©a
;

96374 
sql™e3VdbeAddOp3
(
v
, 
OP_Ne
, 
iChžd
, 
iJump
, 
iP¬’t
); 
VdbeCov”age
(v);

96375 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_JUMPIFNULL
);

96377 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
iOk
);

96380 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gTemp
, 
nCÞ
, 
»gRec
,

96381 
sql™e3IndexAffš™ySŒ
(
v
,
pIdx
), 
nCÞ
);

96382 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
iCur
, 
iOk
, 
»gRec
, 0); 
VdbeCov”age
(v);

96384 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRec
);

96385 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gTemp
, 
nCÞ
);

96389 ifÐ!
	gpFKey
->
	gisDeã¼ed
 && !(
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_DeãrFKs
)

96390 && !
	gpP¬£
->
	gpTÝËv–


96391 && !
	gpP¬£
->
	gisMuÉiWr™e


96397 
as£¹
Ð
nInü
==1 );

96398 
sql™e3H®tCÚ¡¿št
(
pP¬£
, 
SQLITE_CONSTRAINT_FOREIGNKEY
,

96399 
OE_AbÜt
, 0, 
P4_STATIC
, 
P5_CÚ¡¿štFK
);

96401 ifÐ
	gnInü
>0 && 
	gpFKey
->
	gisDeã¼ed
==0 ){

96402 
sql™e3P¬£TÝËv–
(
pP¬£
)->
mayAbÜt
 = 1;

96404 
sql™e3VdbeAddOp2
(
v
, 
OP_FkCouÁ”
, 
pFKey
->
isDeã¼ed
, 
nInü
);

96407 
sql™e3VdbeResÞveLab–
(
v
, 
iOk
);

96408 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iCur
);

96420 
Ex´
 *
ex´TabËRegi¡”
(

96421 
P¬£
 *
pP¬£
,

96422 
TabË
 *
pTab
,

96423 
»gBa£
,

96424 
i16
 
iCÞ


96426 
Ex´
 *
	gpEx´
;

96427 
CÞumn
 *
	gpCÞ
;

96428 cÚ¡ *
	gzCÞl
;

96429 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

96431 
	gpEx´
 = 
sql™e3Ex´
(
db
, 
TK_REGISTER
, 0);

96432 ifÐ
	gpEx´
 ){

96433 ifÐ
	giCÞ
>=0 && 
iCÞ
!=
pTab
->
iPKey
 ){

96434 
pCÞ
 = &
pTab
->
aCÞ
[
iCÞ
];

96435 
	gpEx´
->
	giTabË
 = 
»gBa£
 + 
iCÞ
 + 1;

96436 
	gpEx´
->
	gaffš™y
 = 
pCÞ
->
affš™y
;

96437 
	gzCÞl
 = 
pCÞ
->
zCÞl
;

96438 ifÐ
	gzCÞl
==0 ) 
zCÞl
 = 
db
->
pDætCÞl
->
zName
;

96439 
	gpEx´
 = 
sql™e3Ex´AddCÞÏ‹SŒšg
(
pP¬£
, 
pEx´
, 
zCÞl
);

96441 
	gpEx´
->
	giTabË
 = 
»gBa£
;

96442 
	gpEx´
->
	gaffš™y
 = 
SQLITE_AFF_INTEGER
;

96445  
	gpEx´
;

96452 
Ex´
 *
ex´TabËCÞumn
(

96453 
sql™e3
 *
db
,

96454 
TabË
 *
pTab
,

96455 
iCursÜ
,

96456 
i16
 
iCÞ


96458 
Ex´
 *
	gpEx´
 = 
sql™e3Ex´
(
db
, 
TK_COLUMN
, 0);

96459 ifÐ
	gpEx´
 ){

96460 
	gpEx´
->
	gpTab
 = 
pTab
;

96461 
	gpEx´
->
	giTabË
 = 
iCursÜ
;

96462 
	gpEx´
->
	giCÞumn
 = 
iCÞ
;

96464  
	gpEx´
;

96495 
fkSÿnChžd»n
(

96496 
P¬£
 *
pP¬£
,

96497 
SrcLi¡
 *
pSrc
,

96498 
TabË
 *
pTab
,

96499 
Index
 *
pIdx
,

96500 
FKey
 *
pFKey
,

96501 *
aiCÞ
,

96502 
»gD©a
,

96503 
nInü


96505 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

96506 
	gi
;

96507 
Ex´
 *
	gpWh”e
 = 0;

96508 
NameCÚ‹xt
 
	gsNameCÚ‹xt
;

96509 
Wh”eInfo
 *
	gpWInfo
;

96510 
	giFkIfZ”o
 = 0;

96511 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

96513 
as£¹
Ð
pIdx
==0 ||…Idx->
pTabË
==
pTab
 );

96514 
as£¹
Ð
pIdx
==0 ||…Idx->
nKeyCÞ
==
pFKey
->
nCÞ
 );

96515 
as£¹
Ð
pIdx
!=0 || 
pFKey
->
nCÞ
==1 );

96516 
as£¹
Ð
pIdx
!=0 || 
HasRowid
(
pTab
) );

96518 ifÐ
	gnInü
<0 ){

96519 
	giFkIfZ”o
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_FkIfZ”o
, 
pFKey
->
isDeã¼ed
, 0);

96520 
VdbeCov”age
(
v
);

96531 
	gi
=0; i<
	gpFKey
->
	gnCÞ
; i++){

96532 
Ex´
 *
	gpLeá
;

96533 
Ex´
 *
	gpRight
;

96534 
Ex´
 *
	gpEq
;

96535 
i16
 
	giCÞ
;

96536 cÚ¡ *
	gzCÞ
;

96538 
	giCÞ
 = 
pIdx
 ?…Idx->
aiCÞumn
[
i
] : -1;

96539 
	gpLeá
 = 
ex´TabËRegi¡”
(
pP¬£
, 
pTab
, 
»gD©a
, 
iCÞ
);

96540 
	giCÞ
 = 
aiCÞ
 ?‡iCÞ[
i
] : 
pFKey
->
aCÞ
[0].
iFrom
;

96541 
as£¹
Ð
iCÞ
>=0 );

96542 
	gzCÞ
 = 
pFKey
->
pFrom
->
aCÞ
[
iCÞ
].
zName
;

96543 
	gpRight
 = 
sql™e3Ex´
(
db
, 
TK_ID
, 
zCÞ
);

96544 
	gpEq
 = 
sql™e3PEx´
(
pP¬£
, 
TK_EQ
, 
pLeá
, 
pRight
, 0);

96545 
	gpWh”e
 = 
sql™e3Ex´And
(
db
, 
pWh”e
, 
pEq
);

96559 ifÐ
	gpTab
==
pFKey
->
pFrom
 && 
nInü
>0 ){

96560 
Ex´
 *
pNe
;

96561 
Ex´
 *
	gpLeá
;

96562 
Ex´
 *
	gpRight
;

96563 ifÐ
HasRowid
(
pTab
) ){

96564 
	gpLeá
 = 
ex´TabËRegi¡”
(
pP¬£
, 
pTab
, 
»gD©a
, -1);

96565 
	gpRight
 = 
ex´TabËCÞumn
(
db
, 
pTab
, 
pSrc
->
a
[0].
iCursÜ
, -1);

96566 
	gpNe
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NE
, 
pLeá
, 
pRight
, 0);

96568 
Ex´
 *
	gpEq
, *
	gpAÎ
 = 0;

96569 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

96570 
as£¹
Ð
pIdx
!=0 );

96571 
	gi
=0; i<
	gpPk
->
	gnKeyCÞ
; i++){

96572 
i16
 
	giCÞ
 = 
pIdx
->
aiCÞumn
[
i
];

96573 
	gpLeá
 = 
ex´TabËRegi¡”
(
pP¬£
, 
pTab
, 
»gD©a
, 
iCÞ
);

96574 
	gpRight
 = 
ex´TabËCÞumn
(
db
, 
pTab
, 
pSrc
->
a
[0].
iCursÜ
, 
iCÞ
);

96575 
	gpEq
 = 
sql™e3PEx´
(
pP¬£
, 
TK_EQ
, 
pLeá
, 
pRight
, 0);

96576 
	gpAÎ
 = 
sql™e3Ex´And
(
db
, 
pAÎ
, 
pEq
);

96578 
	gpNe
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
pAÎ
, 0, 0);

96580 
	gpWh”e
 = 
sql™e3Ex´And
(
db
, 
pWh”e
, 
pNe
);

96584 
mem£t
(&
sNameCÚ‹xt
, 0, (
NameCÚ‹xt
));

96585 
	gsNameCÚ‹xt
.
	gpSrcLi¡
 = 
pSrc
;

96586 
	gsNameCÚ‹xt
.
	gpP¬£
 = 
pP¬£
;

96587 
sql™e3ResÞveEx´Names
(&
sNameCÚ‹xt
, 
pWh”e
);

96593 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pSrc
, 
pWh”e
, 0, 0, 0, 0);

96594 ifÐ
	gnInü
>0 && 
	gpFKey
->
	gisDeã¼ed
==0 ){

96595 
sql™e3P¬£TÝËv–
(
pP¬£
)->
mayAbÜt
 = 1;

96597 
sql™e3VdbeAddOp2
(
v
, 
OP_FkCouÁ”
, 
pFKey
->
isDeã¼ed
, 
nInü
);

96598 ifÐ
	gpWInfo
 ){

96599 
sql™e3Wh”eEnd
(
pWInfo
);

96603 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

96604 ifÐ
	giFkIfZ”o
 ){

96605 
sql™e3VdbeJumpH”e
(
v
, 
iFkIfZ”o
);

96623 
SQLITE_PRIVATE
 
FKey
 *
sql™e3FkReã»nûs
(
TabË
 *
pTab
){

96624  (
	gFKey
 *)
sql™e3HashFšd
(&
pTab
->
pSchema
->
fkeyHash
,…Tab->
zName
);

96635 
fkTrigg”D–‘e
(
sql™e3
 *
dbMem
, 
Trigg”
 *
p
){

96636 ifÐ
	gp
 ){

96637 
Trigg”S‹p
 *
	gpS‹p
 = 
p
->
¡•_li¡
;

96638 
sql™e3Ex´D–‘e
(
dbMem
, 
pS‹p
->
pWh”e
);

96639 
sql™e3Ex´Li¡D–‘e
(
dbMem
, 
pS‹p
->
pEx´Li¡
);

96640 
sql™e3S–eùD–‘e
(
dbMem
, 
pS‹p
->
pS–eù
);

96641 
sql™e3Ex´D–‘e
(
dbMem
, 
p
->
pWh’
);

96642 
sql™e3DbF»e
(
dbMem
, 
p
);

96663 
SQLITE_PRIVATE
 
sql™e3FkDrÝTabË
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pName
, 
TabË
 *
pTab
){

96664 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

96665 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
è&& !
IsVœtu®
(
pTab
è&& !
	gpTab
->
	gpS–eù
 ){

96666 
	giSk
 = 0;

96667 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

96669 
as£¹
Ð
v
 );

96670 ifÐ
sql™e3FkReã»nûs
(
pTab
)==0 ){

96676 
FKey
 *
p
;

96677 
	gp
=
pTab
->
pFKey
;…;…=
p
->
pNextFrom
){

96678 ifÐ
p
->
isDeã¼ed
 || (
db
->
æags
 & 
SQLITE_DeãrFKs
) ) ;

96680 ifÐ!
	gp
 ) ;

96681 
	giSk
 = 
sql™e3VdbeMakeLab–
(
v
);

96682 
sql™e3VdbeAddOp2
(
v
, 
OP_FkIfZ”o
, 1, 
iSk
); 
VdbeCov”age
(v);

96685 
	gpP¬£
->
	gdi§bËTrigg”s
 = 1;

96686 
sql™e3D–‘eFrom
(
pP¬£
, 
sql™e3SrcLi¡Dup
(
db
, 
pName
, 0), 0);

96687 
	gpP¬£
->
	gdi§bËTrigg”s
 = 0;

96698 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_DeãrFKs
)==0 ){

96699 
sql™e3VdbeAddOp2
(
v
, 
OP_FkIfZ”o
, 0, 
sql™e3VdbeCu¼’tAddr
(v)+2);

96700 
VdbeCov”age
(
v
);

96701 
sql™e3H®tCÚ¡¿št
(
pP¬£
, 
SQLITE_CONSTRAINT_FOREIGNKEY
,

96702 
OE_AbÜt
, 0, 
P4_STATIC
, 
P5_CÚ¡¿štFK
);

96705 ifÐ
	giSk
 ){

96706 
sql™e3VdbeResÞveLab–
(
v
, 
iSk
);

96724 
fkChždIsModif›d
(

96725 
TabË
 *
pTab
,

96726 
FKey
 *
p
,

96727 *
aChªge
,

96728 
bChngRowid


96730 
	gi
;

96731 
	gi
=0; i<
	gp
->
	gnCÞ
; i++){

96732 
	giChždKey
 = 
p
->
aCÞ
[
i
].
iFrom
;

96733 ifÐ
	gaChªge
[
iChždKey
]>=0 )  1;

96734 ifÐ
	giChždKey
==
pTab
->
iPKey
 && 
bChngRowid
 )  1;

96751 
fkP¬’tIsModif›d
(

96752 
TabË
 *
pTab
,

96753 
FKey
 *
p
,

96754 *
aChªge
,

96755 
bChngRowid


96757 
	gi
;

96758 
	gi
=0; i<
	gp
->
	gnCÞ
; i++){

96759 *
	gzKey
 = 
p
->
aCÞ
[
i
].
zCÞ
;

96760 
	giKey
;

96761 
	giKey
=0; iKey<
	gpTab
->
	gnCÞ
; iKey++){

96762 ifÐ
	gaChªge
[
iKey
]>=0 || (iKey==
pTab
->
iPKey
 && 
bChngRowid
) ){

96763 
CÞumn
 *
pCÞ
 = &
pTab
->
aCÞ
[
iKey
];

96764 ifÐ
	gzKey
 ){

96765 ifÐ0==
sql™e3SŒICmp
(
pCÞ
->
zName
, 
zKey
) )  1;

96766 }ifÐ
	gpCÞ
->
	gcÞFÏgs
 & 
	gCOLFLAG_PRIMKEY
 ){

96795 
SQLITE_PRIVATE
 
sql™e3FkCheck
(

96796 
P¬£
 *
pP¬£
,

96797 
TabË
 *
pTab
,

96798 
»gOld
,

96799 
»gNew
,

96800 *
aChªge
,

96801 
bChngRowid


96803 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

96804 
FKey
 *
	gpFKey
;

96805 
	giDb
;

96806 cÚ¡ *
	gzDb
;

96807 
	gisIgnÜeE¼Üs
 = 
pP¬£
->
di§bËTrigg”s
;

96810 
as£¹
Ð(
»gOld
==0)!=(
»gNew
==0) );

96813 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
)==0 ) ;

96815 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

96816 
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

96820 
	gpFKey
=
pTab
->
pFKey
;…FKey;…FKeyõFKey->
pNextFrom
){

96821 
TabË
 *
pTo
;

96822 
Index
 *
	gpIdx
 = 0;

96823 *
	gaiF»e
 = 0;

96824 *
	gaiCÞ
;

96825 
	giCÞ
;

96826 
	gi
;

96827 
	gisIgnÜe
 = 0;

96829 ifÐ
	gaChªge


96830 && 
sql™e3_¡ricmp
(
pTab
->
zName
, 
pFKey
->
zTo
)!=0

96831 && 
fkChždIsModif›d
(
pTab
, 
pFKey
, 
aChªge
, 
bChngRowid
)==0

96840 ifÐ
	gpP¬£
->
	gdi§bËTrigg”s
 ){

96841 
	gpTo
 = 
sql™e3FšdTabË
(
db
, 
pFKey
->
zTo
, 
zDb
);

96843 
	gpTo
 = 
sql™e3Loÿ‹TabË
(
pP¬£
, 0, 
pFKey
->
zTo
, 
zDb
);

96845 ifÐ!
	gpTo
 || 
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pTo
, 
pFKey
, &
pIdx
, &
aiF»e
) ){

96846 
as£¹
Ð
isIgnÜeE¼Üs
==0 || (
»gOld
!=0 && 
»gNew
==0) );

96847 ifÐ!
	gisIgnÜeE¼Üs
 || 
	gdb
->
	gm®locFažed
 ) ;

96848 ifÐ
	gpTo
==0 ){

96856 
Vdbe
 *
v
 = 
sql™e3G‘Vdbe
(
pP¬£
);

96857 
	giJump
 = 
sql™e3VdbeCu¼’tAddr
(
v
è+ 
pFKey
->
nCÞ
 + 1;

96858 
	gi
=0; i<
	gpFKey
->
	gnCÞ
; i++){

96859 
	giReg
 = 
pFKey
->
aCÞ
[
i
].
iFrom
 + 
»gOld
 + 1;

96860 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
iReg
, 
iJump
); 
VdbeCov”age
(v);

96862 
sql™e3VdbeAddOp2
(
v
, 
OP_FkCouÁ”
, 
pFKey
->
isDeã¼ed
, -1);

96866 
as£¹
Ð
pFKey
->
nCÞ
==1 || (
aiF»e
 && 
pIdx
) );

96868 ifÐ
	gaiF»e
 ){

96869 
	gaiCÞ
 = 
aiF»e
;

96871 
	giCÞ
 = 
pFKey
->
aCÞ
[0].
iFrom
;

96872 
	gaiCÞ
 = &
iCÞ
;

96874 
	gi
=0; i<
	gpFKey
->
	gnCÞ
; i++){

96875 ifÐ
	gaiCÞ
[
i
]==
pTab
->
iPKey
 ){

96876 
aiCÞ
[
i
] = -1;

96878 #iâdeà
SQLITE_OMIT_AUTHORIZATION


96882 ifÐ
	gdb
->
	gxAuth
 ){

96883 
	grÿuth
;

96884 *
	gzCÞ
 = 
pTo
->
aCÞ
[
pIdx
 ?…Idx->
aiCÞumn
[
i
] :…To->
iPKey
].
zName
;

96885 
	grÿuth
 = 
sql™e3AuthR—dCÞ
(
pP¬£
, 
pTo
->
zName
, 
zCÞ
, 
iDb
);

96886 
	gisIgnÜe
 = (
rÿuth
==
SQLITE_IGNORE
);

96894 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTo
->
Šum
, 0,…To->
zName
);

96895 
	gpP¬£
->
	gnTab
++;

96897 ifÐ
	g»gOld
!=0 ){

96901 
fkLookupP¬’t
(
pP¬£
, 
iDb
, 
pTo
, 
pIdx
, 
pFKey
, 
aiCÞ
, 
»gOld
, -1,
isIgnÜe
);

96903 ifÐ
	g»gNew
!=0 ){

96906 
fkLookupP¬’t
(
pP¬£
, 
iDb
, 
pTo
, 
pIdx
, 
pFKey
, 
aiCÞ
, 
»gNew
, +1,
isIgnÜe
);

96909 
sql™e3DbF»e
(
db
, 
aiF»e
);

96914 
	gpFKey
 = 
sql™e3FkReã»nûs
(
pTab
);…FKey;…FKey=
pFKey
->
pNextTo
){

96915 
Index
 *
pIdx
 = 0;

96916 
SrcLi¡
 *
	gpSrc
;

96917 *
	gaiCÞ
 = 0;

96919 ifÐ
	gaChªge
 && 
fkP¬’tIsModif›d
(
pTab
, 
pFKey
, 
aChªge
, 
bChngRowid
)==0 ){

96923 ifÐ!
	gpFKey
->
	gisDeã¼ed
 && !(
	gdb
->
	gæags
 & 
	gSQLITE_DeãrFKs
)

96924 && !
	gpP¬£
->
	gpTÝËv–
 && !pP¬£->
	gisMuÉiWr™e


96926 
as£¹
Ð
»gOld
==0 && 
»gNew
!=0 );

96932 ifÐ
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pTab
, 
pFKey
, &
pIdx
, &
aiCÞ
) ){

96933 ifÐ!
	gisIgnÜeE¼Üs
 || 
	gdb
->
	gm®locFažed
 ) ;

96936 
as£¹
Ð
aiCÞ
 || 
pFKey
->
nCÞ
==1 );

96940 
	gpSrc
 = 
sql™e3SrcLi¡Aµ’d
(
db
, 0, 0, 0);

96941 ifÐ
	gpSrc
 ){

96942 
SrcLi¡_™em
 *
	gpI‹m
 = 
pSrc
->
a
;

96943 
	gpI‹m
->
	gpTab
 = 
pFKey
->
pFrom
;

96944 
	gpI‹m
->
	gzName
 = 
pFKey
->
pFrom
->
zName
;

96945 
	gpI‹m
->
	gpTab
->
	gnRef
++;

96946 
	gpI‹m
->
	giCursÜ
 = 
pP¬£
->
nTab
++;

96948 ifÐ
	g»gNew
!=0 ){

96949 
fkSÿnChžd»n
(
pP¬£
, 
pSrc
, 
pTab
, 
pIdx
, 
pFKey
, 
aiCÞ
, 
»gNew
, -1);

96951 ifÐ
	g»gOld
!=0 ){

96958 
fkSÿnChžd»n
(
pP¬£
, 
pSrc
, 
pTab
, 
pIdx
, 
pFKey
, 
aiCÞ
, 
»gOld
, 1);

96960 
	gpI‹m
->
	gzName
 = 0;

96961 
sql™e3SrcLi¡D–‘e
(
db
, 
pSrc
);

96963 
sql™e3DbF»e
(
db
, 
aiCÞ
);

96967 
	#COLUMN_MASK
(
x
è(((x)>31è? 0xfffffffà: ((
u32
)1<<(x)))

	)

96973 
SQLITE_PRIVATE
 
u32
 
sql™e3FkOldmask
(

96974 
P¬£
 *
pP¬£
,

96975 
TabË
 *
pTab


96977 
u32
 
	gmask
 = 0;

96978 ifÐ
	gpP¬£
->
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

96979 
FKey
 *
	gp
;

96980 
	gi
;

96981 
	gp
=
pTab
->
pFKey
;…;…=
p
->
pNextFrom
){

96982 
i
=0; 
	gi
<
	gp
->
	gnCÞ
; i++è
	gmask
 |ð
COLUMN_MASK
(
p
->
aCÞ
[i].
iFrom
);

96984 
	gp
=
sql™e3FkReã»nûs
(
pTab
);…;…=
p
->
pNextTo
){

96985 
Index
 *
pIdx
 = 0;

96986 
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pTab
, 
p
, &
pIdx
, 0);

96987 ifÐ
	gpIdx
 ){

96988 
	gi
=0; i<
	gpIdx
->
	gnKeyCÞ
; i++è
	gmask
 |ð
COLUMN_MASK
(
pIdx
->
aiCÞumn
[
i
]);

96992  
	gmask
;

97010 
SQLITE_PRIVATE
 
sql™e3FkRequœed
(

97011 
P¬£
 *
pP¬£
,

97012 
TabË
 *
pTab
,

97013 *
aChªge
,

97014 
chngRowid


97016 ifÐ
	gpP¬£
->
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

97017 ifÐ!
	gaChªge
 ){

97021  (
sql™e3FkReã»nûs
(
pTab
è|| 
	gpTab
->
	gpFKey
);

97025 
FKey
 *
	gp
;

97028 
	gp
=
pTab
->
pFKey
;…;…=
p
->
pNextFrom
){

97029 ifÐ
fkChždIsModif›d
(
pTab
, 
p
, 
aChªge
, 
chngRowid
) )  1;

97033 
	gp
=
sql™e3FkReã»nûs
(
pTab
);…;…=
p
->
pNextTo
){

97034 ifÐ
fkP¬’tIsModif›d
(
pTab
, 
p
, 
aChªge
, 
chngRowid
) )  1;

97070 
Trigg”
 *
fkAùiÚTrigg”
(

97071 
P¬£
 *
pP¬£
,

97072 
TabË
 *
pTab
,

97073 
FKey
 *
pFKey
,

97074 
Ex´Li¡
 *
pChªges


97076 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

97077 
	gaùiÚ
;

97078 
Trigg”
 *
	gpTrigg”
;

97079 
	giAùiÚ
 = (
pChªges
!=0);

97081 
	gaùiÚ
 = 
pFKey
->
aAùiÚ
[
iAùiÚ
];

97082 
	gpTrigg”
 = 
pFKey
->
­Trigg”
[
iAùiÚ
];

97084 ifÐ
	gaùiÚ
!=
OE_NÚe
 && !
pTrigg”
 ){

97085 
u8
 
’abËLookaside
;

97086 cÚ¡ *
	gzFrom
;

97087 
	gnFrom
;

97088 
Index
 *
	gpIdx
 = 0;

97089 *
	gaiCÞ
 = 0;

97090 
Trigg”S‹p
 *
	gpS‹p
 = 0;

97091 
Ex´
 *
	gpWh”e
 = 0;

97092 
Ex´Li¡
 *
	gpLi¡
 = 0;

97093 
S–eù
 *
	gpS–eù
 = 0;

97094 
	gi
;

97095 
Ex´
 *
	gpWh’
 = 0;

97097 ifÐ
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pTab
, 
pFKey
, &
pIdx
, &
aiCÞ
) )  0;

97098 
as£¹
Ð
aiCÞ
 || 
pFKey
->
nCÞ
==1 );

97100 
	gi
=0; i<
	gpFKey
->
	gnCÞ
; i++){

97101 
Tok’
 
	gtOld
 = { "old", 3 };

97102 
Tok’
 
	gtNew
 = { "new", 3 };

97103 
Tok’
 
	gtFromCÞ
;

97104 
Tok’
 
	gtToCÞ
;

97105 
	giFromCÞ
;

97106 
Ex´
 *
	gpEq
;

97108 
	giFromCÞ
 = 
aiCÞ
 ?‡iCÞ[
i
] : 
pFKey
->
aCÞ
[0].
iFrom
;

97109 
as£¹
Ð
iFromCÞ
>=0 );

97110 
	gtToCÞ
.
	gz
 = 
pIdx
 ? 
pTab
->
aCÞ
[pIdx->
aiCÞumn
[
i
]].
zName
 : "oid";

97111 
	gtFromCÞ
.
	gz
 = 
pFKey
->
pFrom
->
aCÞ
[
iFromCÞ
].
zName
;

97113 
	gtToCÞ
.
	gn
 = 
sql™e3SŒËn30
(
tToCÞ
.
z
);

97114 
	gtFromCÞ
.
	gn
 = 
sql™e3SŒËn30
(
tFromCÞ
.
z
);

97120 
	gpEq
 = 
sql™e3PEx´
(
pP¬£
, 
TK_EQ
,

97121 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
,

97122 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tOld
),

97123 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tToCÞ
)

97125 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tFromCÞ
)

97127 
	gpWh”e
 = 
sql™e3Ex´And
(
db
, 
pWh”e
, 
pEq
);

97134 ifÐ
	gpChªges
 ){

97135 
	gpEq
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IS
,

97136 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
,

97137 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tOld
),

97138 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tToCÞ
),

97140 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
,

97141 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tNew
),

97142 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tToCÞ
),

97145 
	gpWh’
 = 
sql™e3Ex´And
(
db
, 
pWh’
, 
pEq
);

97148 ifÐ
	gaùiÚ
!=
OE_Re¡riù
 && (
aùiÚ
!=
OE_Casÿde
 || 
pChªges
) ){

97149 
Ex´
 *
pNew
;

97150 ifÐ
	gaùiÚ
==
OE_Casÿde
 ){

97151 
pNew
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
,

97152 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tNew
),

97153 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
tToCÞ
)

97155 }ifÐ
	gaùiÚ
==
OE_S‘Dæt
 ){

97156 
Ex´
 *
pDæt
 = 
pFKey
->
pFrom
->
aCÞ
[
iFromCÞ
].pDflt;

97157 ifÐ
	gpDæt
 ){

97158 
	gpNew
 = 
sql™e3Ex´Dup
(
db
, 
pDæt
, 0);

97160 
	gpNew
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NULL
, 0, 0, 0);

97163 
	gpNew
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NULL
, 0, 0, 0);

97165 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pLi¡
, 
pNew
);

97166 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
pLi¡
, &
tFromCÞ
, 0);

97169 
sql™e3DbF»e
(
db
, 
aiCÞ
);

97171 
	gzFrom
 = 
pFKey
->
pFrom
->
zName
;

97172 
	gnFrom
 = 
sql™e3SŒËn30
(
zFrom
);

97174 ifÐ
	gaùiÚ
==
OE_Re¡riù
 ){

97175 
Tok’
 
tFrom
;

97176 
Ex´
 *
	gpRai£
;

97178 
	gtFrom
.
	gz
 = 
zFrom
;

97179 
	gtFrom
.
	gn
 = 
nFrom
;

97180 
	gpRai£
 = 
sql™e3Ex´
(
db
, 
TK_RAISE
, "FOREIGN KEY constraint failed");

97181 ifÐ
	gpRai£
 ){

97182 
	gpRai£
->
	gaffš™y
 = 
OE_AbÜt
;

97184 
	gpS–eù
 = 
sql™e3S–eùNew
(
pP¬£
,

97185 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
pRai£
),

97186 
sql™e3SrcLi¡Aµ’d
(
db
, 0, &
tFrom
, 0),

97187 
pWh”e
,

97190 
	gpWh”e
 = 0;

97194 
	g’abËLookaside
 = 
db
->
lookaside
.
bEÇbËd
;

97195 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 0;

97197 
	gpTrigg”
 = (
Trigg”
 *)
sql™e3DbM®locZ”o
(
db
,

97198 (
Trigg”
) +

97199 (
Trigg”S‹p
) +

97200 
nFrom
 + 1

97202 ifÐ
	gpTrigg”
 ){

97203 
	gpS‹p
 = 
pTrigg”
->
¡•_li¡
 = (
Trigg”S‹p
 *)&pTrigger[1];

97204 
	gpS‹p
->
	grg‘
.
	gz
 = (*)&
pS‹p
[1];

97205 
	gpS‹p
->
	grg‘
.
	gn
 = 
nFrom
;

97206 
memýy
((*)
pS‹p
->
rg‘
.
z
, 
zFrom
, 
nFrom
);

97208 
	gpS‹p
->
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
pWh”e
, 
EXPRDUP_REDUCE
);

97209 
	gpS‹p
->
	gpEx´Li¡
 = 
sql™e3Ex´Li¡Dup
(
db
, 
pLi¡
, 
EXPRDUP_REDUCE
);

97210 
	gpS‹p
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pS–eù
, 
EXPRDUP_REDUCE
);

97211 ifÐ
	gpWh’
 ){

97212 
	gpWh’
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
pWh’
, 0, 0);

97213 
	gpTrigg”
->
	gpWh’
 = 
sql™e3Ex´Dup
(
db
, 
pWh’
, 
EXPRDUP_REDUCE
);

97218 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 
’abËLookaside
;

97220 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

97221 
sql™e3Ex´D–‘e
(
db
, 
pWh’
);

97222 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

97223 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

97224 ifÐ
	gdb
->
	gm®locFažed
==1 ){

97225 
fkTrigg”D–‘e
(
db
, 
pTrigg”
);

97228 
as£¹
Ð
pS‹p
!=0 );

97230  
	gaùiÚ
 ){

97231 
	gOE_Re¡riù
:

97232 
pS‹p
->
Ý
 = 
TK_SELECT
;

97234 
	gOE_Casÿde
:

97235 ifÐ!
pChªges
 ){

97236 
pS‹p
->
Ý
 = 
TK_DELETE
;

97240 
pS‹p
->
Ý
 = 
TK_UPDATE
;

97242 
	gpS‹p
->
	gpTrig
 = 
pTrigg”
;

97243 
	gpTrigg”
->
	gpSchema
 = 
pTab
->
pSchema
;

97244 
	gpTrigg”
->
	gpTabSchema
 = 
pTab
->
pSchema
;

97245 
	gpFKey
->
	g­Trigg”
[
iAùiÚ
] = 
pTrigg”
;

97246 
	gpTrigg”
->
	gÝ
 = (
pChªges
 ? 
TK_UPDATE
 : 
TK_DELETE
);

97249  
	gpTrigg”
;

97256 
SQLITE_PRIVATE
 
sql™e3FkAùiÚs
(

97257 
P¬£
 *
pP¬£
,

97258 
TabË
 *
pTab
,

97259 
Ex´Li¡
 *
pChªges
,

97260 
»gOld
,

97261 *
aChªge
,

97262 
bChngRowid


97268 ifÐ
	gpP¬£
->
	gdb
->
	gæags
&
	gSQLITE_FÜeignKeys
 ){

97269 
FKey
 *
	gpFKey
;

97270 
	gpFKey
 = 
sql™e3FkReã»nûs
(
pTab
);…FKey;…FKey=
pFKey
->
pNextTo
){

97271 ifÐ
aChªge
==0 || 
fkP¬’tIsModif›d
(
pTab
, 
pFKey
,‡Chªge, 
bChngRowid
) ){

97272 
Trigg”
 *
	gpAù
 = 
fkAùiÚTrigg”
(
pP¬£
, 
pTab
, 
pFKey
, 
pChªges
);

97273 ifÐ
	gpAù
 ){

97274 
sql™e3CodeRowTrigg”Dœeù
(
pP¬£
, 
pAù
, 
pTab
, 
»gOld
, 
OE_AbÜt
, 0);

97288 
SQLITE_PRIVATE
 
sql™e3FkD–‘e
(
sql™e3
 *
db
, 
TabË
 *
pTab
){

97289 
FKey
 *
	gpFKey
;

97290 
FKey
 *
	gpNext
;

97292 
as£¹
Ð
db
==0 || 
sql™e3SchemaMu‹xH–d
(db, 0, 
pTab
->
pSchema
) );

97293 
	gpFKey
=
pTab
->
pFKey
;…FKey;…FKey=
pNext
){

97296 ifÐ!
db
 || db->
²By‹sF»ed
==0 ){

97297 ifÐ
pFKey
->
pP»vTo
 ){

97298 
pFKey
->
pP»vTo
->
pNextTo
 =…FKey->pNextTo;

97300 *
	gp
 = (*)
pFKey
->
pNextTo
;

97301 cÚ¡ *
	gz
 = (
p
 ? 
pFKey
->
pNextTo
->
zTo
 :…FKey->zTo);

97302 
sql™e3HashIn£¹
(&
pTab
->
pSchema
->
fkeyHash
, 
z
, 
p
);

97304 ifÐ
	gpFKey
->
	gpNextTo
 ){

97305 
	gpFKey
->
	gpNextTo
->
	gpP»vTo
 = 
pFKey
->
pP»vTo
;

97312 
as£¹
Ð
pFKey
->
isDeã¼ed
==0 ||…FKey->isDeferred==1 );

97315 #iâdeà
SQLITE_OMIT_TRIGGER


97316 
fkTrigg”D–‘e
(
db
, 
pFKey
->
­Trigg”
[0]);

97317 
fkTrigg”D–‘e
(
db
, 
pFKey
->
­Trigg”
[1]);

97320 
	gpNext
 = 
pFKey
->
pNextFrom
;

97321 
sql™e3DbF»e
(
db
, 
pFKey
);

97352 
SQLITE_PRIVATE
 
sql™e3O³nTabË
(

97353 
P¬£
 *
pP¬£
,

97354 
iCur
,

97355 
iDb
,

97356 
TabË
 *
pTab
,

97357 
Ýcode


97359 
Vdbe
 *
	gv
;

97360 
as£¹
Ð!
IsVœtu®
(
pTab
) );

97361 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

97362 
as£¹
Ð
Ýcode
==
OP_O³nWr™e
 || opcode==
OP_O³nR—d
 );

97363 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
,

97364 (
Ýcode
==
OP_O³nWr™e
)?1:0, 
pTab
->
zName
);

97365 ifÐ
HasRowid
(
pTab
) ){

97366 
sql™e3VdbeAddOp4IÁ
(
v
, 
Ýcode
, 
iCur
, 
pTab
->
Šum
, 
iDb
,…Tab->
nCÞ
);

97367 
VdbeComm’t
((
v
, "%s", 
pTab
->
zName
));

97369 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

97370 
as£¹
Ð
pPk
!=0 );

97371 
as£¹
Ð
pPk
->
Šum
=
pTab
->tnum );

97372 
sql™e3VdbeAddOp3
(
v
, 
Ýcode
, 
iCur
, 
pPk
->
Šum
, 
iDb
);

97373 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pPk
);

97374 
VdbeComm’t
((
v
, "%s", 
pTab
->
zName
));

97398 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3IndexAffš™ySŒ
(
Vdbe
 *
v
, 
Index
 *
pIdx
){

97399 ifÐ!
	gpIdx
->
	gzCÞAff
 ){

97408 
	gn
;

97409 
TabË
 *
	gpTab
 = 
pIdx
->
pTabË
;

97410 
sql™e3
 *
	gdb
 = 
sql™e3VdbeDb
(
v
);

97411 
	gpIdx
->
	gzCÞAff
 = (*)
sql™e3DbM®locRaw
(0, 
pIdx
->
nCÞumn
+1);

97412 ifÐ!
	gpIdx
->
	gzCÞAff
 ){

97413 
	gdb
->
	gm®locFažed
 = 1;

97416 
	gn
=0;‚<
	gpIdx
->
	gnCÞumn
;‚++){

97417 
i16
 
	gx
 = 
pIdx
->
aiCÞumn
[
n
];

97418 
	gpIdx
->
	gzCÞAff
[
n
] = 
x
<0 ? 
SQLITE_AFF_INTEGER
 : 
pTab
->
aCÞ
[x].
affš™y
;

97420 
	gpIdx
->
	gzCÞAff
[
n
] = 0;

97423  
	gpIdx
->
	gzCÞAff
;

97446 
SQLITE_PRIVATE
 
sql™e3TabËAffš™y
(
Vdbe
 *
v
, 
TabË
 *
pTab
, 
iReg
){

97447 
	gi
;

97448 *
	gzCÞAff
 = 
pTab
->
zCÞAff
;

97449 ifÐ
	gzCÞAff
==0 ){

97450 
sql™e3
 *
db
 = 
sql™e3VdbeDb
(
v
);

97451 
	gzCÞAff
 = (*)
sql™e3DbM®locRaw
(0, 
pTab
->
nCÞ
+1);

97452 ifÐ!
	gzCÞAff
 ){

97453 
	gdb
->
	gm®locFažed
 = 1;

97457 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

97458 
	gzCÞAff
[
i
] = 
pTab
->
aCÞ
[i].
affš™y
;

97461 
	gzCÞAff
[
i
--] = 0;

97462 } 
	gi
>=0 && 
zCÞAff
[
i
]==
SQLITE_AFF_NONE
 );

97463 
	gpTab
->
	gzCÞAff
 = 
zCÞAff
;

97465 
	gi
 = 
sql™e3SŒËn30
(
zCÞAff
);

97466 ifÐ
	gi
 ){

97467 ifÐ
	giReg
 ){

97468 
sql™e3VdbeAddOp4
(
v
, 
OP_Affš™y
, 
iReg
, 
i
, 0, 
zCÞAff
, i);

97470 
sql™e3VdbeChªgeP4
(
v
, -1, 
zCÞAff
, 
i
);

97481 
»adsTabË
(
P¬£
 *
p
, 
iDb
, 
TabË
 *
pTab
){

97482 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
p
);

97483 
	gi
;

97484 
	giEnd
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

97485 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


97486 
VTabË
 *
	gpVTab
 = 
IsVœtu®
(
pTab
è? 
sql™e3G‘VTabË
(
p
->
db
,…Tab) : 0;

97489 
	gi
=1; i<
	giEnd
; i++){

97490 
VdbeOp
 *
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, 
i
);

97491 
as£¹
Ð
pOp
!=0 );

97492 ifÐ
	gpOp
->
	gÝcode
==
OP_O³nR—d
 && 
pOp
->
p3
==
iDb
 ){

97493 
Index
 *
pIndex
;

97494 
	gŠum
 = 
pOp
->
p2
;

97495 ifÐ
	gŠum
==
pTab
->
Šum
 ){

97498 
	gpIndex
=
pTab
->
pIndex
;…Index;…IndexõIndex->
pNext
){

97499 ifÐ
Šum
==
pIndex
->tnum ){

97504 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


97505 ifÐ
	gpOp
->
	gÝcode
==
OP_VO³n
 && 
pOp
->
p4
.
pVb
==
pVTab
 ){

97506 
as£¹
Ð
pOp
->
p4
.
pVb
!=0 );

97507 
as£¹
Ð
pOp
->
p4ty³
==
P4_VTAB
 );

97515 #iâdeà
SQLITE_OMIT_AUTOINCREMENT


97536 
autoIncBegš
(

97537 
P¬£
 *
pP¬£
,

97538 
iDb
,

97539 
TabË
 *
pTab


97541 
	gmemId
 = 0;

97542 ifÐ
	gpTab
->
	gbFÏgs
 & 
	gTF_Autošüem’t
 ){

97543 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

97544 
AutošcInfo
 *
	gpInfo
;

97546 
	gpInfo
 = 
pTÝËv–
->
pAšc
;

97547  
	gpInfo
 &&…Info->
	gpTab
!=
pTab
 ){ 
pInfo
 =…Info->
pNext
; }

97548 ifÐ
	gpInfo
==0 ){

97549 
pInfo
 = 
sql™e3DbM®locRaw
(
pP¬£
->
db
, (*pInfo));

97550 ifÐ
	gpInfo
==0 )  0;

97551 
	gpInfo
->
	gpNext
 = 
pTÝËv–
->
pAšc
;

97552 
	gpTÝËv–
->
	gpAšc
 = 
pInfo
;

97553 
	gpInfo
->
	gpTab
 = 
pTab
;

97554 
	gpInfo
->
	giDb
 = 
iDb
;

97555 
	gpTÝËv–
->
	gnMem
++;

97556 
	gpInfo
->
	g»gCŒ
 = ++
pTÝËv–
->
nMem
;

97557 
	gpTÝËv–
->
	gnMem
++;

97559 
	gmemId
 = 
pInfo
->
»gCŒ
;

97561  
	gmemId
;

97568 
SQLITE_PRIVATE
 
sql™e3Autošüem’tBegš
(
P¬£
 *
pP¬£
){

97569 
AutošcInfo
 *
	gp
;

97570 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

97571 
Db
 *
	gpDb
;

97572 
	gmemId
;

97573 
	gaddr
;

97574 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

97578 
as£¹
Ð
pP¬£
->
pTrigg”Tab
==0 );

97579 
as£¹
Ð
pP¬£
==
sql™e3P¬£TÝËv–
(pParse) );

97581 
as£¹
Ð
v
 );

97582 
	gp
 = 
pP¬£
->
pAšc
;…;… = 
p
->
pNext
){

97583 
pDb
 = &
db
->
aDb
[
p
->
iDb
];

97584 
	gmemId
 = 
p
->
»gCŒ
;

97585 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
pDb
->
pSchema
) );

97586 
sql™e3O³nTabË
(
pP¬£
, 0, 
p
->
iDb
, 
pDb
->
pSchema
->
pSeqTab
, 
OP_O³nR—d
);

97587 
sql™e3VdbeAddOp3
(
v
, 
OP_NuÎ
, 0, 
memId
, memId+1);

97588 
	gaddr
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

97589 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
memId
-1, 0, 
p
->
pTab
->
zName
, 0);

97590 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 0, 
addr
+9); 
VdbeCov”age
(v);

97591 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 0, 0, 
memId
);

97592 
sql™e3VdbeAddOp3
(
v
, 
OP_Ne
, 
memId
-1, 
addr
+7, memId); 
VdbeCov”age
(v);

97593 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_JUMPIFNULL
);

97594 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 0, 
memId
+1);

97595 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 0, 1, 
memId
);

97596 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addr
+9);

97597 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 0, 
addr
+2); 
VdbeCov”age
(v);

97598 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
memId
);

97599 
sql™e3VdbeAddOp0
(
v
, 
OP_Clo£
);

97611 
autoIncS‹p
(
P¬£
 *
pP¬£
, 
memId
, 
»gRowid
){

97612 ifÐ
	gmemId
>0 ){

97613 
sql™e3VdbeAddOp2
(
pP¬£
->
pVdbe
, 
OP_MemMax
, 
memId
, 
»gRowid
);

97624 
SQLITE_PRIVATE
 
sql™e3Autošüem’tEnd
(
P¬£
 *
pP¬£
){

97625 
AutošcInfo
 *
	gp
;

97626 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

97627 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

97629 
as£¹
Ð
v
 );

97630 
	gp
 = 
pP¬£
->
pAšc
;…;… = 
p
->
pNext
){

97631 
Db
 *
pDb
 = &
db
->
aDb
[
p
->
iDb
];

97632 
	gj1
;

97633 
	giRec
;

97634 
	gmemId
 = 
p
->
»gCŒ
;

97636 
	giRec
 = 
sql™e3G‘TempReg
(
pP¬£
);

97637 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
pDb
->
pSchema
) );

97638 
sql™e3O³nTabË
(
pP¬£
, 0, 
p
->
iDb
, 
pDb
->
pSchema
->
pSeqTab
, 
OP_O³nWr™e
);

97639 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 
memId
+1); 
VdbeCov”age
(v);

97640 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 0, 
memId
+1);

97641 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

97642 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
memId
-1, 2, 
iRec
);

97643 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 0, 
iRec
, 
memId
+1);

97644 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

97645 
sql™e3VdbeAddOp0
(
v
, 
OP_Clo£
);

97646 
sql™e3R–—£TempReg
(
pP¬£
, 
iRec
);

97654 
	#autoIncBegš
(
A
,
B
,
C
è(0)

	)

97655 
	#autoIncS‹p
(
A
,
B
,
C
)

	)

97660 
xãrO±imiz©iÚ
(

97661 
P¬£
 *
pP¬£
,

97662 
TabË
 *
pDe¡
,

97663 
S–eù
 *
pS–eù
,

97664 
ÚE¼Ü
,

97665 
iDbDe¡


97762 
SQLITE_PRIVATE
 
sql™e3In£¹
(

97763 
P¬£
 *
pP¬£
,

97764 
SrcLi¡
 *
pTabLi¡
,

97765 
S–eù
 *
pS–eù
,

97766 
IdLi¡
 *
pCÞumn
,

97767 
ÚE¼Ü


97769 
sql™e3
 *
	gdb
;

97770 
TabË
 *
	gpTab
;

97771 *
	gzTab
;

97772 cÚ¡ *
	gzDb
;

97773 
	gi
, 
	gj
, 
	gidx
;

97774 
Vdbe
 *
	gv
;

97775 
Index
 *
	gpIdx
;

97776 
	gnCÞumn
;

97777 
	gnHidd’
 = 0;

97778 
	giD©aCur
 = 0;

97779 
	giIdxCur
 = 0;

97780 
	gkCÞumn
 = -1;

97781 
	g’dOfLoÝ
;

97782 
	g¤cTab
 = 0;

97783 
	gaddrInsTÝ
 = 0;

97784 
	gaddrCÚt
 = 0;

97785 
S–eùDe¡
 
	gde¡
;

97786 
	giDb
;

97787 
Db
 *
	gpDb
;

97788 
u8
 
	gu£TempTabË
 = 0;

97789 
u8
 
	g­³ndFÏg
 = 0;

97790 
u8
 
	gw™houtRowid
;

97791 
u8
 
	gbIdLi¡InOrd”
 = 1;

97792 
Ex´Li¡
 *
	gpLi¡
 = 0;

97795 
	g»gFromS–eù
 = 0;

97796 
	g»gAutošc
 = 0;

97797 
	g»gRowCouÁ
 = 0;

97798 
	g»gIns
;

97799 
	g»gRowid
;

97800 
	g»gD©a
;

97801 *
	gaRegIdx
 = 0;

97803 #iâdeà
SQLITE_OMIT_TRIGGER


97804 
	gisV›w
;

97805 
Trigg”
 *
	gpTrigg”
;

97806 
	gtmask
;

97809 
	gdb
 = 
pP¬£
->
db
;

97810 
mem£t
(&
de¡
, 0, (dest));

97811 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ){

97812 
	gš£¹_þ—nup
;

97819 ifÐ
	gpS–eù
 && (pS–eù->
	g£lFÏgs
 & 
	gSF_V®ues
)!=0 && 
pS–eù
->
pPriÜ
==0 ){

97820 
pLi¡
 = 
pS–eù
->
pELi¡
;

97821 
	gpS–eù
->
	gpELi¡
 = 0;

97822 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

97823 
	gpS–eù
 = 0;

97828 
as£¹
Ð
pTabLi¡
->
nSrc
==1 );

97829 
	gzTab
 = 
pTabLi¡
->
a
[0].
zName
;

97830 ifÐ
NEVER
(
zTab
==0èè
š£¹_þ—nup
;

97831 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTabLi¡
);

97832 ifÐ
	gpTab
==0 ){

97833 
š£¹_þ—nup
;

97835 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

97836 
as£¹
Ð
iDb
<
db
->
nDb
 );

97837 
	gpDb
 = &
db
->
aDb
[
iDb
];

97838 
	gzDb
 = 
pDb
->
zName
;

97839 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_INSERT
, 
pTab
->
zName
, 0, 
zDb
) ){

97840 
	gš£¹_þ—nup
;

97842 
	gw™houtRowid
 = !
HasRowid
(
pTab
);

97847 #iâdeà
SQLITE_OMIT_TRIGGER


97848 
	gpTrigg”
 = 
sql™e3Trigg”sExi¡
(
pP¬£
, 
pTab
, 
TK_INSERT
, 0, &
tmask
);

97849 
	gisV›w
 = 
pTab
->
pS–eù
!=0;

97851 
	#pTrigg”
 0

	)

97852 
	#tmask
 0

	)

97853 
	#isV›w
 0

	)

97855 #ifdeà
SQLITE_OMIT_VIEW


97856 #undeà
isV›w


97857 
	#isV›w
 0

	)

97859 
as£¹
Ð(
pTrigg”
 && 
tmask
) || (pTrigger==0 &&mask==0) );

97864 ifÐ
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
) ){

97865 
	gš£¹_þ—nup
;

97870 ifÐ
sql™e3IsR—dOÆy
(
pP¬£
, 
pTab
, 
tmask
) ){

97871 
	gš£¹_þ—nup
;

97876 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

97877 ifÐ
	gv
==0 ) 
š£¹_þ—nup
;

97878 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 ) 
sql™e3VdbeCouÁChªges
(
v
);

97879 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 
pS–eù
 || 
pTrigg”
, 
iDb
);

97881 #iâdeà
SQLITE_OMIT_XFER_OPT


97891 ifÐ
	gpCÞumn
==0 && 
xãrO±imiz©iÚ
(
pP¬£
, 
pTab
, 
pS–eù
, 
ÚE¼Ü
, 
iDb
) ){

97892 
as£¹
Ð!
pTrigg”
 );

97893 
as£¹
Ð
pLi¡
==0 );

97894 
	gš£¹_’d
;

97901 
	g»gAutošc
 = 
autoIncBegš
(
pP¬£
, 
iDb
, 
pTab
);

97906 
	g»gRowid
 = 
»gIns
 = 
pP¬£
->
nMem
+1;

97907 
	gpP¬£
->
	gnMem
 +ð
pTab
->
nCÞ
 + 1;

97908 ifÐ
IsVœtu®
(
pTab
) ){

97909 
	g»gRowid
++;

97910 
	gpP¬£
->
	gnMem
++;

97912 
	g»gD©a
 = 
»gRowid
+1;

97925 ifÐ
	gpCÞumn
 ){

97926 
	gi
=0; i<
	gpCÞumn
->
	gnId
; i++){

97927 
	gpCÞumn
->
	ga
[
i
].
	gidx
 = -1;

97929 
	gi
=0; i<
	gpCÞumn
->
	gnId
; i++){

97930 
	gj
=0; j<
	gpTab
->
	gnCÞ
; j++){

97931 ifÐ
sql™e3SŒICmp
(
pCÞumn
->
a
[
i
].
zName
, 
pTab
->
aCÞ
[
j
].zName)==0 ){

97932 
pCÞumn
->
a
[
i
].
idx
 = 
j
;

97933 ifÐ
	gi
!=
j
 ) 
bIdLi¡InOrd”
 = 0;

97934 ifÐ
	gj
==
pTab
->
iPKey
 ){

97935 
kCÞumn
 = 
i
; 
as£¹
Ð!
w™houtRowid
 );

97940 ifÐ
	gj
>=
pTab
->
nCÞ
 ){

97941 ifÐ
sql™e3IsRowid
(
pCÞumn
->
a
[
i
].
zName
è&& !
w™houtRowid
 ){

97942 
kCÞumn
 = 
i
;

97943 
	gbIdLi¡InOrd”
 = 0;

97945 
sql™e3E¼ÜMsg
(
pP¬£
, "table %S has‚o column‚amed %s",

97946 
pTabLi¡
, 0, 
pCÞumn
->
a
[
i
].
zName
);

97947 
	gpP¬£
->
	gcheckSchema
 = 1;

97948 
	gš£¹_þ—nup
;

97959 ifÐ
	gpS–eù
 ){

97961 
	g»gY›ld
;

97962 
	gaddrTÝ
;

97963 
	grc
;

97965 
	g»gY›ld
 = ++
pP¬£
->
nMem
;

97966 
	gaddrTÝ
 = 
sql™e3VdbeCu¼’tAddr
(
v
) + 1;

97967 
sql™e3VdbeAddOp3
(
v
, 
OP_In™CÜoutše
, 
»gY›ld
, 0, 
addrTÝ
);

97968 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_CÜoutše
, 
»gY›ld
);

97969 
	gde¡
.
	giSd¡
 = 
bIdLi¡InOrd”
 ? 
»gD©a
 : 0;

97970 
	gde¡
.
	gnSd¡
 = 
pTab
->
nCÞ
;

97971 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
pS–eù
, &
de¡
);

97972 
	g»gFromS–eù
 = 
de¡
.
iSd¡
;

97973 
as£¹
Ð
pP¬£
->
nE¼
==0 || 
rc
 );

97974 ifÐ
	grc
 || 
	gdb
->
	gm®locFažed
 ) 
	gš£¹_þ—nup
;

97975 
sql™e3VdbeAddOp1
(
v
, 
OP_EndCÜoutše
, 
»gY›ld
);

97976 
sql™e3VdbeJumpH”e
(
v
, 
addrTÝ
 - 1);

97977 
as£¹
Ð
pS–eù
->
pELi¡
 );

97978 
	gnCÞumn
 = 
pS–eù
->
pELi¡
->
nEx´
;

97989 ifÐ
	gpTrigg”
 || 
»adsTabË
(
pP¬£
, 
iDb
, 
pTab
) ){

97990 
	gu£TempTabË
 = 1;

97993 ifÐ
	gu£TempTabË
 ){

98004 
	g»gRec
;

98005 
	g»gTempRowid
;

98006 
	gaddrL
;

98008 
	g¤cTab
 = 
pP¬£
->
nTab
++;

98009 
	g»gRec
 = 
sql™e3G‘TempReg
(
pP¬£
);

98010 
	g»gTempRowid
 = 
sql™e3G‘TempReg
(
pP¬£
);

98011 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
¤cTab
, 
nCÞumn
);

98012 
	gaddrL
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Y›ld
, 
de¡
.
iSDP¬m
); 
VdbeCov”age
(v);

98013 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gFromS–eù
, 
nCÞumn
, 
»gRec
);

98014 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
¤cTab
, 
»gTempRowid
);

98015 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
¤cTab
, 
»gRec
, 
»gTempRowid
);

98016 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrL
);

98017 
sql™e3VdbeJumpH”e
(
v
, 
addrL
);

98018 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRec
);

98019 
sql™e3R–—£TempReg
(
pP¬£
, 
»gTempRowid
);

98025 
NameCÚ‹xt
 
	gsNC
;

98026 
mem£t
(&
sNC
, 0, (sNC));

98027 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

98028 
	g¤cTab
 = -1;

98029 
as£¹
Ð
u£TempTabË
==0 );

98030 
	gnCÞumn
 = 
pLi¡
 ?…Li¡->
nEx´
 : 0;

98031 
	gi
=0; i<
	gnCÞumn
; i++){

98032 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pLi¡
->
a
[
i
].
pEx´
) ){

98033 
	gš£¹_þ—nup
;

98042 ifÐ
	gpCÞumn
==0 && 
nCÞumn
>0 ){

98043 
kCÞumn
 = 
pTab
->
iPKey
;

98049 ifÐ
IsVœtu®
(
pTab
) ){

98050 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

98051 
	gnHidd’
 +ð(
IsHidd’CÞumn
(&
pTab
->
aCÞ
[
i
]) ? 1 : 0);

98054 ifÐ
	gpCÞumn
==0 && 
nCÞumn
 &&‚CÞumn!=(
pTab
->
nCÞ
-
nHidd’
) ){

98055 
sql™e3E¼ÜMsg
(
pP¬£
,

98057 
pTabLi¡
, 0, 
pTab
->
nCÞ
-
nHidd’
, 
nCÞumn
);

98058 
	gš£¹_þ—nup
;

98060 ifÐ
	gpCÞumn
!=0 && 
nCÞumn
!=
pCÞumn
->
nId
 ){

98061 
sql™e3E¼ÜMsg
(
pP¬£
, "%d v®ue fÜ %d cÞumns", 
nCÞumn
, 
pCÞumn
->
nId
);

98062 
	gš£¹_þ—nup
;

98067 ifÐ
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
 ){

98068 
	g»gRowCouÁ
 = ++
pP¬£
->
nMem
;

98069 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gRowCouÁ
);

98073 ifÐ!
	gisV›w
 ){

98074 
	gnIdx
;

98075 
	gnIdx
 = 
sql™e3O³nTabËAndIndiûs
(
pP¬£
, 
pTab
, 
OP_O³nWr™e
, -1, 0,

98076 &
iD©aCur
, &
iIdxCur
);

98077 
	gaRegIdx
 = 
sql™e3DbM®locRaw
(
db
, ()*(
nIdx
+1));

98078 ifÐ
	gaRegIdx
==0 ){

98079 
š£¹_þ—nup
;

98081 
	gi
=0; i<
	gnIdx
; i++){

98082 
	gaRegIdx
[
i
] = ++
pP¬£
->
nMem
;

98087 ifÐ
	gu£TempTabË
 ){

98097 
	gaddrInsTÝ
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 
¤cTab
); 
VdbeCov”age
(v);

98098 
	gaddrCÚt
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

98099 }ifÐ
	gpS–eù
 ){

98108 
	gaddrInsTÝ
 = 
addrCÚt
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Y›ld
, 
de¡
.
iSDP¬m
);

98109 
VdbeCov”age
(
v
);

98114 
	g’dOfLoÝ
 = 
sql™e3VdbeMakeLab–
(
v
);

98115 ifÐ
	gtmask
 & 
	gTRIGGER_BEFORE
 ){

98116 
	g»gCÞs
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
pTab
->
nCÞ
+1);

98124 ifÐ
	gkCÞumn
<0 ){

98125 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, -1, 
»gCÞs
);

98127 
	gj1
;

98128 
as£¹
Ð!
w™houtRowid
 );

98129 ifÐ
	gu£TempTabË
 ){

98130 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
¤cTab
, 
kCÞumn
, 
»gCÞs
);

98132 
as£¹
Ð
pS–eù
==0 );

98133 
sql™e3Ex´Code
(
pP¬£
, 
pLi¡
->
a
[
kCÞumn
].
pEx´
, 
»gCÞs
);

98135 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 
»gCÞs
); 
VdbeCov”age
(v);

98136 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, -1, 
»gCÞs
);

98137 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

98138 
sql™e3VdbeAddOp1
(
v
, 
OP_Mu¡BeIÁ
, 
»gCÞs
); 
VdbeCov”age
(v);

98144 
as£¹
Ð!
IsVœtu®
(
pTab
) );

98148 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

98149 ifÐ
	gpCÞumn
==0 ){

98150 
j
 = 
i
;

98152 
	gj
=0; j<
	gpCÞumn
->
	gnId
; j++){

98153 ifÐ
	gpCÞumn
->
	ga
[
j
].
	gidx
==
i
 ) ;

98156 ifÐ(!
	gu£TempTabË
 && !
	gpLi¡
è|| (
	gpCÞumn
 && 
	gj
>=
pCÞumn
->
nId
) ){

98157 
sql™e3Ex´Code
(
pP¬£
, 
pTab
->
aCÞ
[
i
].
pDæt
, 
»gCÞs
+i+1);

98158 }ifÐ
	gu£TempTabË
 ){

98159 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
¤cTab
, 
j
, 
»gCÞs
+
i
+1);

98161 
as£¹
Ð
pS–eù
==0 );

98162 
sql™e3Ex´CodeAndCache
(
pP¬£
, 
pLi¡
->
a
[
j
].
pEx´
, 
»gCÞs
+
i
+1);

98171 ifÐ!
	gisV›w
 ){

98172 
sql™e3TabËAffš™y
(
v
, 
pTab
, 
»gCÞs
+1);

98176 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
, 
TK_INSERT
, 0, 
TRIGGER_BEFORE
,

98177 
pTab
, 
»gCÞs
-pTab->
nCÞ
-1, 
ÚE¼Ü
, 
’dOfLoÝ
);

98179 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gCÞs
, 
pTab
->
nCÞ
+1);

98185 ifÐ!
	gisV›w
 ){

98186 ifÐ
IsVœtu®
(
pTab
) ){

98188 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gIns
);

98190 ifÐ
	gkCÞumn
>=0 ){

98191 ifÐ
u£TempTabË
 ){

98192 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
¤cTab
, 
kCÞumn
, 
»gRowid
);

98193 }ifÐ
	gpS–eù
 ){

98194 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
»gFromS–eù
+
kCÞumn
, 
»gRowid
);

98196 
VdbeOp
 *
	gpOp
;

98197 
sql™e3Ex´Code
(
pP¬£
, 
pLi¡
->
a
[
kCÞumn
].
pEx´
, 
»gRowid
);

98198 
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, -1);

98199 ifÐ
ALWAYS
(
pOp
è&& 
	gpOp
->
	gÝcode
==
OP_NuÎ
 && !
IsVœtu®
(
pTab
) ){

98200 
­³ndFÏg
 = 1;

98201 
	gpOp
->
	gÝcode
 = 
OP_NewRowid
;

98202 
	gpOp
->
	gp1
 = 
iD©aCur
;

98203 
	gpOp
->
	gp2
 = 
»gRowid
;

98204 
	gpOp
->
	gp3
 = 
»gAutošc
;

98210 ifÐ!
	g­³ndFÏg
 ){

98211 
	gj1
;

98212 ifÐ!
IsVœtu®
(
pTab
) ){

98213 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 
»gRowid
); 
VdbeCov”age
(v);

98214 
sql™e3VdbeAddOp3
(
v
, 
OP_NewRowid
, 
iD©aCur
, 
»gRowid
, 
»gAutošc
);

98215 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

98217 
	gj1
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

98218 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gRowid
, 
j1
+2); 
VdbeCov”age
(v);

98220 
sql™e3VdbeAddOp1
(
v
, 
OP_Mu¡BeIÁ
, 
»gRowid
); 
VdbeCov”age
(v);

98222 }ifÐ
IsVœtu®
(
pTab
è|| 
	gw™houtRowid
 ){

98223 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gRowid
);

98225 
sql™e3VdbeAddOp3
(
v
, 
OP_NewRowid
, 
iD©aCur
, 
»gRowid
, 
»gAutošc
);

98226 
	g­³ndFÏg
 = 1;

98228 
autoIncS‹p
(
pP¬£
, 
»gAutošc
, 
»gRowid
);

98233 
	gnHidd’
 = 0;

98234 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

98235 
	giRegStÜe
 = 
»gRowid
+1+
i
;

98236 ifÐ
	gi
==
pTab
->
iPKey
 ){

98242 
sql™e3VdbeAddOp1
(
v
, 
OP_SoáNuÎ
, 
iRegStÜe
);

98245 ifÐ
	gpCÞumn
==0 ){

98246 ifÐ
IsHidd’CÞumn
(&
pTab
->
aCÞ
[
i
]) ){

98247 
as£¹
Ð
IsVœtu®
(
pTab
) );

98248 
	gj
 = -1;

98249 
	gnHidd’
++;

98251 
	gj
 = 
i
 - 
nHidd’
;

98254 
	gj
=0; j<
	gpCÞumn
->
	gnId
; j++){

98255 ifÐ
	gpCÞumn
->
	ga
[
j
].
	gidx
==
i
 ) ;

98258 ifÐ
	gj
<0 || 
	gnCÞumn
==0 || (
pCÞumn
 && 
j
>õCÞumn->
nId
) ){

98259 
sql™e3Ex´CodeFaùÜabË
(
pP¬£
, 
pTab
->
aCÞ
[
i
].
pDæt
, 
iRegStÜe
);

98260 }ifÐ
	gu£TempTabË
 ){

98261 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
¤cTab
, 
j
, 
iRegStÜe
);

98262 }ifÐ
	gpS–eù
 ){

98263 ifÐ
	g»gFromS–eù
!=
»gD©a
 ){

98264 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
»gFromS–eù
+
j
, 
iRegStÜe
);

98267 
sql™e3Ex´Code
(
pP¬£
, 
pLi¡
->
a
[
j
].
pEx´
, 
iRegStÜe
);

98274 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


98275 ifÐ
IsVœtu®
(
pTab
) ){

98276 cÚ¡ *
	gpVTab
 = (cÚ¡ *)
sql™e3G‘VTabË
(
db
, 
pTab
);

98277 
sql™e3VbMakeWr™abË
(
pP¬£
, 
pTab
);

98278 
sql™e3VdbeAddOp4
(
v
, 
OP_VUpd©e
, 1, 
pTab
->
nCÞ
+2, 
»gIns
, 
pVTab
, 
P4_VTAB
);

98279 
sql™e3VdbeChªgeP5
(
v
, 
ÚE¼Ü
==
OE_DeçuÉ
 ? 
OE_AbÜt
 : onError);

98280 
sql™e3MayAbÜt
(
pP¬£
);

98284 
	gisR•Ïû
;

98285 
sql™e3G’”©eCÚ¡¿štChecks
(
pP¬£
, 
pTab
, 
aRegIdx
, 
iD©aCur
, 
iIdxCur
,

98286 
»gIns
, 0, 
kCÞumn
>=0, 
ÚE¼Ü
, 
’dOfLoÝ
, &
isR•Ïû


98288 
sql™e3FkCheck
(
pP¬£
, 
pTab
, 0, 
»gIns
, 0, 0);

98289 
sql™e3Com¶‘eIn£¹iÚ
(
pP¬£
, 
pTab
, 
iD©aCur
, 
iIdxCur
,

98290 
»gIns
, 
aRegIdx
, 0, 
­³ndFÏg
, 
isR•Ïû
==0);

98296 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
)!=0 ){

98297 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 
»gRowCouÁ
, 1);

98300 ifÐ
	gpTrigg”
 ){

98302 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
, 
TK_INSERT
, 0, 
TRIGGER_AFTER
,

98303 
pTab
, 
»gD©a
-2-pTab->
nCÞ
, 
ÚE¼Ü
, 
’dOfLoÝ
);

98309 
sql™e3VdbeResÞveLab–
(
v
, 
’dOfLoÝ
);

98310 ifÐ
	gu£TempTabË
 ){

98311 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
¤cTab
, 
addrCÚt
); 
VdbeCov”age
(v);

98312 
sql™e3VdbeJumpH”e
(
v
, 
addrInsTÝ
);

98313 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
¤cTab
);

98314 }ifÐ
	gpS–eù
 ){

98315 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrCÚt
);

98316 
sql™e3VdbeJumpH”e
(
v
, 
addrInsTÝ
);

98319 ifÐ!
IsVœtu®
(
pTab
è&& !
	gisV›w
 ){

98321 ifÐ
	giD©aCur
<
	giIdxCur
 ) 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iD©aCur
);

98322 
	gidx
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, idx++){

98323 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
idx
+
iIdxCur
);

98327 
	gš£¹_’d
:

98332 ifÐ
pP¬£
->
Ã¡ed
==0 &&…P¬£->
pTrigg”Tab
==0 ){

98333 
sql™e3Autošüem’tEnd
(
pP¬£
);

98341 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_CouÁRows
è&& !
	gpP¬£
->
	gÃ¡ed
 && !pP¬£->
	gpTrigg”Tab
 ){

98342 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
»gRowCouÁ
, 1);

98343 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

98344 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "row š£¹ed", 
SQLITE_STATIC
);

98347 
	gš£¹_þ—nup
:

98348 
sql™e3SrcLi¡D–‘e
(
db
, 
pTabLi¡
);

98349 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

98350 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

98351 
sql™e3IdLi¡D–‘e
(
db
, 
pCÞumn
);

98352 
sql™e3DbF»e
(
db
, 
aRegIdx
);

98358 #ifdeà
isV›w


98359 #undeà
isV›w


98361 #ifdeà
pTrigg”


98362 #undeà
pTrigg”


98364 #ifdeà
tmask


98365 #undeà
tmask


98451 
SQLITE_PRIVATE
 
sql™e3G’”©eCÚ¡¿štChecks
(

98452 
P¬£
 *
pP¬£
,

98453 
TabË
 *
pTab
,

98454 *
aRegIdx
,

98455 
iD©aCur
,

98456 
iIdxCur
,

98457 
»gNewD©a
,

98458 
»gOldD©a
,

98459 
u8
 
pkChng
,

98460 
u8
 
ov”rideE¼Ü
,

98461 
ignÜeDe¡
,

98462 *
pbMayR•Ïû


98464 
Vdbe
 *
	gv
;

98465 
Index
 *
	gpIdx
;

98466 
Index
 *
	gpPk
 = 0;

98467 
sql™e3
 *
	gdb
;

98468 
	gi
;

98469 
	gix
;

98470 
	gnCÞ
;

98471 
	gÚE¼Ü
;

98472 
	gj1
;

98473 
	g£’R•Ïû
 = 0;

98474 
	gnPkF›ld
;

98475 
	gkTÝ
 = 0;

98476 
	gkBÙtom
 = 0;

98477 
u8
 
	gisUpd©e
;

98478 
u8
 
	gbAffš™yDÚe
 = 0;

98479 
	g»gRowid
 = -1;

98481 
	gisUpd©e
 = 
»gOldD©a
!=0;

98482 
	gdb
 = 
pP¬£
->
db
;

98483 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

98484 
as£¹
Ð
v
!=0 );

98485 
as£¹
Ð
pTab
->
pS–eù
==0 );

98486 
	gnCÞ
 = 
pTab
->
nCÞ
;

98492 ifÐ
HasRowid
(
pTab
) ){

98493 
	gpPk
 = 0;

98494 
	gnPkF›ld
 = 1;

98496 
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

98497 
	gnPkF›ld
 = 
pPk
->
nKeyCÞ
;

98501 
VdbeModuËComm’t
((
v
, "BEGIN: GenCnstCks(%d,%d,%d,%d,%d)",

98502 
iD©aCur
, 
iIdxCur
, 
»gNewD©a
, 
»gOldD©a
, 
pkChng
));

98506 
	gi
=0; i<
	gnCÞ
; i++){

98507 ifÐ
	gi
==
pTab
->
iPKey
 ){

98510 
	gÚE¼Ü
 = 
pTab
->
aCÞ
[
i
].
nÙNuÎ
;

98511 ifÐ
	gÚE¼Ü
==
OE_NÚe
 ) ;

98512 ifÐ
	gov”rideE¼Ü
!=
OE_DeçuÉ
 ){

98513 
ÚE¼Ü
 = 
ov”rideE¼Ü
;

98514 }ifÐ
	gÚE¼Ü
==
OE_DeçuÉ
 ){

98515 
ÚE¼Ü
 = 
OE_AbÜt
;

98517 ifÐ
	gÚE¼Ü
==
OE_R•Ïû
 && 
pTab
->
aCÞ
[
i
].
pDæt
==0 ){

98518 
ÚE¼Ü
 = 
OE_AbÜt
;

98520 
as£¹
Ð
ÚE¼Ü
==
OE_RÞlback
 || onE¼Ü==
OE_AbÜt
 || onE¼Ü==
OE_Faž


98521 || 
ÚE¼Ü
==
OE_IgnÜe
 || onE¼Ü==
OE_R•Ïû
 );

98522  
	gÚE¼Ü
 ){

98523 
	gOE_AbÜt
:

98524 
sql™e3MayAbÜt
(
pP¬£
);

98526 
	gOE_RÞlback
:

98527 
OE_Faž
: {

98528 *
zMsg
 = 
sql™e3MPrštf
(
db
, "%s.%s", 
pTab
->
zName
,

98529 
pTab
->
aCÞ
[
i
].
zName
);

98530 
sql™e3VdbeAddOp4
(
v
, 
OP_H®tIfNuÎ
, 
SQLITE_CONSTRAINT_NOTNULL
, 
ÚE¼Ü
,

98531 
»gNewD©a
+1+
i
, 
zMsg
, 
P4_DYNAMIC
);

98532 
sql™e3VdbeChªgeP5
(
v
, 
P5_CÚ¡¿štNÙNuÎ
);

98533 
VdbeCov”age
(
v
);

98536 
	gOE_IgnÜe
: {

98537 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gNewD©a
+1+
i
, 
ignÜeDe¡
);

98538 
VdbeCov”age
(
v
);

98542 
as£¹
Ð
ÚE¼Ü
==
OE_R•Ïû
 );

98543 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 
»gNewD©a
+1+
i
); 
VdbeCov”age
(v);

98544 
sql™e3Ex´Code
(
pP¬£
, 
pTab
->
aCÞ
[
i
].
pDæt
, 
»gNewD©a
+1+i);

98545 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

98553 #iâdeà
SQLITE_OMIT_CHECK


98554 ifÐ
	gpTab
->
	gpCheck
 && (
	gdb
->
	gæags
 & 
	gSQLITE_IgnÜeChecks
)==0 ){

98555 
Ex´Li¡
 *
pCheck
 = 
pTab
->pCheck;

98556 
	gpP¬£
->
	gckBa£
 = 
»gNewD©a
+1;

98557 
	gÚE¼Ü
 = 
ov”rideE¼Ü
!=
OE_DeçuÉ
 ? ov”rideE¼Ü : 
OE_AbÜt
;

98558 
	gi
=0; i<
	gpCheck
->
	gnEx´
; i++){

98559 
	g®lOk
 = 
sql™e3VdbeMakeLab–
(
v
);

98560 
sql™e3Ex´IfTrue
(
pP¬£
, 
pCheck
->
a
[
i
].
pEx´
, 
®lOk
, 
SQLITE_JUMPIFNULL
);

98561 ifÐ
	gÚE¼Ü
==
OE_IgnÜe
 ){

98562 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
ignÜeDe¡
);

98564 *
	gzName
 = 
pCheck
->
a
[
i
].
zName
;

98565 ifÐ
	gzName
==0 ) 
zName
 = 
pTab
->zName;

98566 ifÐ
	gÚE¼Ü
==
OE_R•Ïû
 ) 
ÚE¼Ü
 = 
OE_AbÜt
;

98567 
sql™e3H®tCÚ¡¿št
(
pP¬£
, 
SQLITE_CONSTRAINT_CHECK
,

98568 
ÚE¼Ü
, 
zName
, 
P4_TRANSIENT
,

98569 
P5_CÚ¡¿štCheck
);

98571 
sql™e3VdbeResÞveLab–
(
v
, 
®lOk
);

98579 ifÐ
	gpkChng
 && 
	gpPk
==0 ){

98580 
addrRowidOk
 = 
sql™e3VdbeMakeLab–
(
v
);

98583 
	gÚE¼Ü
 = 
pTab
->
keyCÚf
;

98584 ifÐ
	gov”rideE¼Ü
!=
OE_DeçuÉ
 ){

98585 
ÚE¼Ü
 = 
ov”rideE¼Ü
;

98586 }ifÐ
	gÚE¼Ü
==
OE_DeçuÉ
 ){

98587 
ÚE¼Ü
 = 
OE_AbÜt
;

98590 ifÐ
	gisUpd©e
 ){

98594 
sql™e3VdbeAddOp3
(
v
, 
OP_Eq
, 
»gNewD©a
, 
addrRowidOk
, 
»gOldD©a
);

98595 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
);

98596 
VdbeCov”age
(
v
);

98604 ifÐ
	gÚE¼Ü
==
OE_R•Ïû
 && 
ov”rideE¼Ü
!=OE_Replace ){

98605 
pIdx
=
pTab
->
pIndex
; 
	gpIdx
;…IdxõIdx->
pNext
){

98606 ifÐ
pIdx
->
ÚE¼Ü
==
OE_IgnÜe
 ||…Idx->ÚE¼Ü==
OE_Faž
 ){

98607 
kTÝ
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

98615 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iD©aCur
, 
addrRowidOk
, 
»gNewD©a
);

98616 
VdbeCov”age
(
v
);

98619  
	gÚE¼Ü
 ){

98621 
ÚE¼Ü
 = 
OE_AbÜt
;

98624 
	gOE_RÞlback
:

98625 
OE_AbÜt
:

98626 
OE_Faž
: {

98627 
sql™e3RowidCÚ¡¿št
(
pP¬£
, 
ÚE¼Ü
, 
pTab
);

98630 
	gOE_R•Ïû
: {

98653 
Trigg”
 *
pTrigg”
 = 0;

98654 ifÐ
	gdb
->
	gæags
&
	gSQLITE_RecTrigg”s
 ){

98655 
	gpTrigg”
 = 
sql™e3Trigg”sExi¡
(
pP¬£
, 
pTab
, 
TK_DELETE
, 0, 0);

98657 ifÐ
	gpTrigg”
 || 
sql™e3FkRequœed
(
pP¬£
, 
pTab
, 0, 0) ){

98658 
sql™e3MuÉiWr™e
(
pP¬£
);

98659 
sql™e3G’”©eRowD–‘e
(
pP¬£
, 
pTab
, 
pTrigg”
, 
iD©aCur
, 
iIdxCur
,

98660 
»gNewD©a
, 1, 0, 
OE_R•Ïû
, 1);

98661 }ifÐ
	gpTab
->
	gpIndex
 ){

98662 
sql™e3MuÉiWr™e
(
pP¬£
);

98663 
sql™e3G’”©eRowIndexD–‘e
(
pP¬£
, 
pTab
, 
iD©aCur
, 
iIdxCur
, 0);

98665 
	g£’R•Ïû
 = 1;

98668 
	gOE_IgnÜe
: {

98670 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
ignÜeDe¡
);

98674 
sql™e3VdbeResÞveLab–
(
v
, 
addrRowidOk
);

98675 ifÐ
	gkTÝ
 ){

98676 
	gkBÙtom
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

98677 
sql™e3VdbeJumpH”e
(
v
, 
kTÝ
);

98688 
	gix
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, ix++){

98689 
	g»gIdx
;

98690 
	g»gR
;

98691 
	giThisCur
;

98692 
	gaddrUniqueOk
;

98694 ifÐ
	gaRegIdx
[
ix
]==0 ) ;

98695 ifÐ
	gbAffš™yDÚe
==0 ){

98696 
sql™e3TabËAffš™y
(
v
, 
pTab
, 
»gNewD©a
+1);

98697 
	gbAffš™yDÚe
 = 1;

98699 
	giThisCur
 = 
iIdxCur
+
ix
;

98700 
	gaddrUniqueOk
 = 
sql™e3VdbeMakeLab–
(
v
);

98703 ifÐ
	gpIdx
->
	gpP¬tIdxWh”e
 ){

98704 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
aRegIdx
[
ix
]);

98705 
	gpP¬£
->
	gckBa£
 = 
»gNewD©a
+1;

98706 
sql™e3Ex´IfF®£
(
pP¬£
, 
pIdx
->
pP¬tIdxWh”e
, 
addrUniqueOk
,

98707 
SQLITE_JUMPIFNULL
);

98708 
	gpP¬£
->
	gckBa£
 = 0;

98714 
	g»gIdx
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
pIdx
->
nCÞumn
);

98715 
	gi
=0; i<
	gpIdx
->
	gnCÞumn
; i++){

98716 
	giF›ld
 = 
pIdx
->
aiCÞumn
[
i
];

98717 
	gx
;

98718 ifÐ
	giF›ld
<0 || iF›ld==
pTab
->
iPKey
 ){

98719 ifÐ
»gRowid
==
»gIdx
+
i
 ) ;

98720 
	gx
 = 
»gNewD©a
;

98721 
	g»gRowid
 = 
pIdx
->
pP¬tIdxWh”e
 ? -1 : 
»gIdx
+
i
;

98723 
	gx
 = 
iF›ld
 + 
»gNewD©a
 + 1;

98725 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
x
, 
»gIdx
+
i
);

98726 
VdbeComm’t
((
v
, "%s", 
iF›ld
<0 ? "rowid" : 
pTab
->
aCÞ
[iF›ld].
zName
));

98728 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gIdx
, 
pIdx
->
nCÞumn
, 
aRegIdx
[
ix
]);

98729 
VdbeComm’t
((
v
, "fÜ %s", 
pIdx
->
zName
));

98730 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gIdx
, 
pIdx
->
nCÞumn
);

98736 ifÐ
	gisUpd©e
 && 
	gpPk
==
pIdx
 && 
pkChng
==0 ){

98737 
sql™e3VdbeResÞveLab–
(
v
, 
addrUniqueOk
);

98742 
	gÚE¼Ü
 = 
pIdx
->
ÚE¼Ü
;

98743 ifÐ
	gÚE¼Ü
==
OE_NÚe
 ){

98744 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gIdx
, 
pIdx
->
nCÞumn
);

98745 
sql™e3VdbeResÞveLab–
(
v
, 
addrUniqueOk
);

98748 ifÐ
	gov”rideE¼Ü
!=
OE_DeçuÉ
 ){

98749 
ÚE¼Ü
 = 
ov”rideE¼Ü
;

98750 }ifÐ
	gÚE¼Ü
==
OE_DeçuÉ
 ){

98751 
ÚE¼Ü
 = 
OE_AbÜt
;

98755 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NoCÚæiù
, 
iThisCur
, 
addrUniqueOk
,

98756 
»gIdx
, 
pIdx
->
nKeyCÞ
); 
VdbeCov”age
(
v
);

98759 
	g»gR
 = (
pIdx
==
pPk
è? 
»gIdx
 : 
sql™e3G‘TempRªge
(
pP¬£
, 
nPkF›ld
);

98760 ifÐ
	gisUpd©e
 || 
	gÚE¼Ü
==
OE_R•Ïû
 ){

98761 ifÐ
HasRowid
(
pTab
) ){

98762 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxRowid
, 
iThisCur
, 
»gR
);

98765 ifÐ
	gisUpd©e
 ){

98766 
sql™e3VdbeAddOp3
(
v
, 
OP_Eq
, 
»gR
, 
addrUniqueOk
, 
»gOldD©a
);

98767 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
);

98768 
VdbeCov”age
(
v
);

98771 
	gx
;

98774 ifÐ
	gpIdx
!=
pPk
 ){

98775 
i
=0; 
	gi
<
	gpPk
->
	gnKeyCÞ
; i++){

98776 
	gx
 = 
sql™e3CÞumnOfIndex
(
pIdx
, 
pPk
->
aiCÞumn
[
i
]);

98777 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iThisCur
, 
x
, 
»gR
+
i
);

98778 
VdbeComm’t
((
v
, "%s.%s", 
pTab
->
zName
,

98779 
pTab
->
aCÞ
[
pPk
->
aiCÞumn
[
i
]].
zName
));

98782 ifÐ
	gisUpd©e
 ){

98790 
	gaddrJump
 = 
sql™e3VdbeCu¼’tAddr
(
v
)+
pPk
->
nKeyCÞ
;

98791 
	gÝ
 = 
OP_Ne
;

98792 
	g»gCmp
 = (
IsPrim¬yKeyIndex
(
pIdx
è? 
»gIdx
 : 
»gR
);

98794 
	gi
=0; i<
	gpPk
->
	gnKeyCÞ
; i++){

98795 *
	gp4
 = (*)
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
pPk
->
azCÞl
[
i
]);

98796 
	gx
 = 
pPk
->
aiCÞumn
[
i
];

98797 ifÐ
	gi
==(
pPk
->
nKeyCÞ
-1) ){

98798 
addrJump
 = 
addrUniqueOk
;

98799 
	gÝ
 = 
OP_Eq
;

98801 
sql™e3VdbeAddOp4
(
v
, 
Ý
,

98802 
»gOldD©a
+1+
x
, 
addrJump
, 
»gCmp
+
i
, 
p4
, 
P4_COLLSEQ


98804 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
);

98805 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_Eq
);

98806 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_Ne
);

98813 
as£¹
Ð
ÚE¼Ü
==
OE_RÞlback
 || onE¼Ü==
OE_AbÜt
 || onE¼Ü==
OE_Faž


98814 || 
ÚE¼Ü
==
OE_IgnÜe
 || onE¼Ü==
OE_R•Ïû
 );

98815  
	gÚE¼Ü
 ){

98816 
	gOE_RÞlback
:

98817 
OE_AbÜt
:

98818 
OE_Faž
: {

98819 
sql™e3UniqueCÚ¡¿št
(
pP¬£
, 
ÚE¼Ü
, 
pIdx
);

98822 
	gOE_IgnÜe
: {

98823 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
ignÜeDe¡
);

98827 
Trigg”
 *
pTrigg”
 = 0;

98828 
as£¹
Ð
ÚE¼Ü
==
OE_R•Ïû
 );

98829 
sql™e3MuÉiWr™e
(
pP¬£
);

98830 ifÐ
	gdb
->
	gæags
&
	gSQLITE_RecTrigg”s
 ){

98831 
	gpTrigg”
 = 
sql™e3Trigg”sExi¡
(
pP¬£
, 
pTab
, 
TK_DELETE
, 0, 0);

98833 
sql™e3G’”©eRowD–‘e
(
pP¬£
, 
pTab
, 
pTrigg”
, 
iD©aCur
, 
iIdxCur
,

98834 
»gR
, 
nPkF›ld
, 0, 
OE_R•Ïû
, 
pIdx
==
pPk
);

98835 
	g£’R•Ïû
 = 1;

98839 
sql™e3VdbeResÞveLab–
(
v
, 
addrUniqueOk
);

98840 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gIdx
, 
pIdx
->
nCÞumn
);

98841 ifÐ
	g»gR
!=
»gIdx
 ) 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gR
, 
nPkF›ld
);

98843 ifÐ
	gkTÝ
 ){

98844 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
kTÝ
+1);

98845 
sql™e3VdbeJumpH”e
(
v
, 
kBÙtom
);

98848 *
	gpbMayR•Ïû
 = 
£’R•Ïû
;

98849 
VdbeModuËComm’t
((
v
, "END: G’Cn¡Cks(%d)", 
£’R•Ïû
));

98861 
SQLITE_PRIVATE
 
sql™e3Com¶‘eIn£¹iÚ
(

98862 
P¬£
 *
pP¬£
,

98863 
TabË
 *
pTab
,

98864 
iD©aCur
,

98865 
iIdxCur
,

98866 
»gNewD©a
,

98867 *
aRegIdx
,

98868 
isUpd©e
,

98869 
­³ndBŸs
,

98870 
u£S“kResuÉ


98872 
Vdbe
 *
	gv
;

98873 
Index
 *
	gpIdx
;

98874 
u8
 
	gpik_æags
;

98875 
	g»gD©a
;

98876 
	g»gRec
;

98877 
	gi
;

98878 
u8
 
	gbAffš™yDÚe
 = 0;

98880 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

98881 
as£¹
Ð
v
!=0 );

98882 
as£¹
Ð
pTab
->
pS–eù
==0 );

98883 
	gi
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, i++){

98884 ifÐ
	gaRegIdx
[
i
]==0 ) ;

98885 
	gbAffš™yDÚe
 = 1;

98886 ifÐ
	gpIdx
->
	gpP¬tIdxWh”e
 ){

98887 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
aRegIdx
[
i
], 
sql™e3VdbeCu¼’tAddr
(v)+2);

98888 
VdbeCov”age
(
v
);

98890 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iIdxCur
+
i
, 
aRegIdx
[i]);

98891 
	gpik_æags
 = 0;

98892 ifÐ
	gu£S“kResuÉ
 ) 
	gpik_æags
 = 
OPFLAG_USESEEKRESULT
;

98893 ifÐ
IsPrim¬yKeyIndex
(
pIdx
è&& !
HasRowid
(
pTab
) ){

98894 
as£¹
Ð
pP¬£
->
Ã¡ed
==0 );

98895 
	gpik_æags
 |ð
OPFLAG_NCHANGE
;

98897 ifÐ
	gpik_æags
 ) 
sql™e3VdbeChªgeP5
(
v
, 
pik_æags
);

98899 ifÐ!
HasRowid
(
pTab
) ) ;

98900 
	g»gD©a
 = 
»gNewD©a
 + 1;

98901 
	g»gRec
 = 
sql™e3G‘TempReg
(
pP¬£
);

98902 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gD©a
, 
pTab
->
nCÞ
, 
»gRec
);

98903 ifÐ!
	gbAffš™yDÚe
 ) 
sql™e3TabËAffš™y
(
v
, 
pTab
, 0);

98904 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gD©a
, 
pTab
->
nCÞ
);

98905 ifÐ
	gpP¬£
->
	gÃ¡ed
 ){

98906 
	gpik_æags
 = 0;

98908 
	gpik_æags
 = 
OPFLAG_NCHANGE
;

98909 
	gpik_æags
 |ð(
isUpd©e
?
OPFLAG_ISUPDATE
:
OPFLAG_LASTROWID
);

98911 ifÐ
	g­³ndBŸs
 ){

98912 
	gpik_æags
 |ð
OPFLAG_APPEND
;

98914 ifÐ
	gu£S“kResuÉ
 ){

98915 
	gpik_æags
 |ð
OPFLAG_USESEEKRESULT
;

98917 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iD©aCur
, 
»gRec
, 
»gNewD©a
);

98918 ifÐ!
	gpP¬£
->
	gÃ¡ed
 ){

98919 
sql™e3VdbeChªgeP4
(
v
, -1, 
pTab
->
zName
, 
P4_TRANSIENT
);

98921 
sql™e3VdbeChªgeP5
(
v
, 
pik_æags
);

98945 
SQLITE_PRIVATE
 
sql™e3O³nTabËAndIndiûs
(

98946 
P¬£
 *
pP¬£
,

98947 
TabË
 *
pTab
,

98948 
Ý
,

98949 
iBa£
,

98950 
u8
 *
aToO³n
,

98951 *
piD©aCur
,

98952 *
piIdxCur


98954 
	gi
;

98955 
	giDb
;

98956 
	giD©aCur
;

98957 
Index
 *
	gpIdx
;

98958 
Vdbe
 *
	gv
;

98960 
as£¹
Ð
Ý
==
OP_O³nR—d
 || op==
OP_O³nWr™e
 );

98961 ifÐ
IsVœtu®
(
pTab
) ){

98967 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

98968 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

98969 
as£¹
Ð
v
!=0 );

98970 ifÐ
	giBa£
<0 ) iBa£ = 
pP¬£
->
nTab
;

98971 
	giD©aCur
 = 
iBa£
++;

98972 ifÐ
	gpiD©aCur
 ) *piD©aCu¸ð
iD©aCur
;

98973 ifÐ
HasRowid
(
pTab
è&& (
	gaToO³n
==0 || 
aToO³n
[0]) ){

98974 
sql™e3O³nTabË
(
pP¬£
, 
iD©aCur
, 
iDb
, 
pTab
, 
Ý
);

98976 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 
Ý
==
OP_O³nWr™e
,…Tab->
zName
);

98978 ifÐ
	gpiIdxCur
 ) *piIdxCu¸ð
iBa£
;

98979 
	gi
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, i++){

98980 
	giIdxCur
 = 
iBa£
++;

98981 
as£¹
Ð
pIdx
->
pSchema
==
pTab
->pSchema );

98982 ifÐ
IsPrim¬yKeyIndex
(
pIdx
è&& !
HasRowid
(
pTab
è&& 
	gpiD©aCur
 ){

98983 *
	gpiD©aCur
 = 
iIdxCur
;

98985 ifÐ
	gaToO³n
==0 || 
aToO³n
[
i
+1] ){

98986 
sql™e3VdbeAddOp3
(
v
, 
Ý
, 
iIdxCur
, 
pIdx
->
Šum
, 
iDb
);

98987 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

98988 
VdbeComm’t
((
v
, "%s", 
pIdx
->
zName
));

98991 ifÐ
	giBa£
>
	gpP¬£
->
	gnTab
 )…P¬£->nTab = 
iBa£
;

98992  
	gi
;

98996 #ifdeà
SQLITE_TEST


99003 
SQLITE_API
 
	gsql™e3_xãrÝt_couÁ
;

99007 #iâdeà
SQLITE_OMIT_XFER_OPT


99011 
xãrCom·tibËCÞÏtiÚ
(cÚ¡ *
z1
, cÚ¡ *
z2
){

99012 ifÐ
	gz1
==0 ){

99013  
z2
==0;

99015 ifÐ
	gz2
==0 ){

99018  
sql™e3SŒICmp
(
z1
, 
z2
)==0;

99033 
xãrCom·tibËIndex
(
Index
 *
pDe¡
, Index *
pSrc
){

99034 
	gi
;

99035 
as£¹
Ð
pDe¡
 && 
pSrc
 );

99036 
as£¹
Ð
pDe¡
->
pTabË
!=
pSrc
->pTable );

99037 ifÐ
	gpDe¡
->
	gnKeyCÞ
!=
pSrc
->
nKeyCÞ
 ){

99040 ifÐ
	gpDe¡
->
	gÚE¼Ü
!=
pSrc
->
ÚE¼Ü
 ){

99043 
	gi
=0; i<
	gpSrc
->
	gnKeyCÞ
; i++){

99044 ifÐ
	gpSrc
->
	gaiCÞumn
[
i
]!=
pDe¡
->
aiCÞumn
[i] ){

99047 ifÐ
	gpSrc
->
	gaSÜtOrd”
[
i
]!=
pDe¡
->
aSÜtOrd”
[i] ){

99050 ifÐ!
xãrCom·tibËCÞÏtiÚ
(
pSrc
->
azCÞl
[
i
],
pDe¡
->azColl[i]) ){

99054 ifÐ
sql™e3Ex´Com·»
(
pSrc
->
pP¬tIdxWh”e
, 
pDe¡
->pPartIdxWhere, -1) ){

99087 
xãrO±imiz©iÚ
(

99088 
P¬£
 *
pP¬£
,

99089 
TabË
 *
pDe¡
,

99090 
S–eù
 *
pS–eù
,

99091 
ÚE¼Ü
,

99092 
iDbDe¡


99094 
Ex´Li¡
 *
	gpELi¡
;

99095 
TabË
 *
	gpSrc
;

99096 
Index
 *
	gpSrcIdx
, *
	gpDe¡Idx
;

99097 
SrcLi¡_™em
 *
	gpI‹m
;

99098 
	gi
;

99099 
	giDbSrc
;

99100 
	giSrc
, 
	giDe¡
;

99101 
	gaddr1
, 
	gaddr2
;

99102 
	gem±yDe¡Te¡
 = 0;

99103 
	gem±ySrcTe¡
 = 0;

99104 
Vdbe
 *
	gv
;

99105 
	g»gAutošc
;

99106 
	gde¡HasUniqueIdx
 = 0;

99107 
	g»gD©a
, 
	g»gRowid
;

99109 ifÐ
	gpS–eù
==0 ){

99112 ifÐ
	gpP¬£
->
	gpW™h
 || 
	gpS–eù
->pWith ){

99118 ifÐ
sql™e3Trigg”Li¡
(
pP¬£
, 
pDe¡
) ){

99121 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


99122 ifÐ
	gpDe¡
->
	gbFÏgs
 & 
	gTF_Vœtu®
 ){

99126 ifÐ
	gÚE¼Ü
==
OE_DeçuÉ
 ){

99127 ifÐ
pDe¡
->
iPKey
>=0 ) 
ÚE¼Ü
 =…De¡->
keyCÚf
;

99128 ifÐ
	gÚE¼Ü
==
OE_DeçuÉ
 ) 
ÚE¼Ü
 = 
OE_AbÜt
;

99130 
as£¹
(
pS–eù
->
pSrc
);

99131 ifÐ
	gpS–eù
->
	gpSrc
->
	gnSrc
!=1 ){

99134 ifÐ
	gpS–eù
->
	gpSrc
->
	ga
[0].pSelect ){

99137 ifÐ
	gpS–eù
->
	gpWh”e
 ){

99140 ifÐ
	gpS–eù
->
	gpOrd”By
 ){

99145 ifÐ
	gpS–eù
->
	gpGroupBy
 ){

99148 ifÐ
	gpS–eù
->
	gpLim™
 ){

99151 
as£¹
Ð
pS–eù
->
pOff£t
==0 );

99152 ifÐ
	gpS–eù
->
	gpPriÜ
 ){

99155 ifÐ
	gpS–eù
->
	g£lFÏgs
 & 
	gSF_Di¡šù
 ){

99158 
	gpELi¡
 = 
pS–eù
->
pELi¡
;

99159 
as£¹
Ð
pELi¡
!=0 );

99160 ifÐ
	gpELi¡
->
	gnEx´
!=1 ){

99163 
as£¹
Ð
pELi¡
->
a
[0].
pEx´
 );

99164 ifÐ
	gpELi¡
->
	ga
[0].
	gpEx´
->
	gÝ
!=
TK_ALL
 ){

99172 
	gpI‹m
 = 
pS–eù
->
pSrc
->
a
;

99173 
	gpSrc
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, 
pI‹m
);

99174 ifÐ
	gpSrc
==0 ){

99177 ifÐ
	gpSrc
==
pDe¡
 ){

99180 ifÐ
HasRowid
(
pDe¡
)!=HasRowid(
pSrc
) ){

99183 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


99184 ifÐ
	gpSrc
->
	gbFÏgs
 & 
	gTF_Vœtu®
 ){

99188 ifÐ
	gpSrc
->
	gpS–eù
 ){

99191 ifÐ
	gpDe¡
->
	gnCÞ
!=
pSrc
->
nCÞ
 ){

99194 ifÐ
	gpDe¡
->
	giPKey
!=
pSrc
->
iPKey
 ){

99197 
	gi
=0; i<
	gpDe¡
->
	gnCÞ
; i++){

99198 
CÞumn
 *
	gpDe¡CÞ
 = &
pDe¡
->
aCÞ
[
i
];

99199 
CÞumn
 *
	gpSrcCÞ
 = &
pSrc
->
aCÞ
[
i
];

99200 ifÐ
	gpDe¡CÞ
->
	gaffš™y
!=
pSrcCÞ
->
affš™y
 ){

99203 ifÐ!
xãrCom·tibËCÞÏtiÚ
(
pDe¡CÞ
->
zCÞl
, 
pSrcCÞ
->zColl) ){

99206 ifÐ
	gpDe¡CÞ
->
	gnÙNuÎ
 && !
	gpSrcCÞ
->notNull ){

99210 ifÐ
	gi
>0

99211 && ((
	gpDe¡CÞ
->
	gzDæt
==0)!=(
pSrcCÞ
->
zDæt
==0)

99212 || (
pDe¡CÞ
->
zDæt
 && 
¡rcmp
ÕDe¡CÞ->zDæt, 
pSrcCÞ
->zDflt)!=0))

99217 
	gpDe¡Idx
=
pDe¡
->
pIndex
;…De¡Idx;…De¡Idx=
pDe¡Idx
->
pNext
){

99218 ifÐ
IsUniqueIndex
(
pDe¡Idx
) ){

99219 
de¡HasUniqueIdx
 = 1;

99221 
	gpSrcIdx
=
pSrc
->
pIndex
;…SrcIdx;…SrcIdx=
pSrcIdx
->
pNext
){

99222 ifÐ
xãrCom·tibËIndex
(
pDe¡Idx
, 
pSrcIdx
) ) ;

99224 ifÐ
	gpSrcIdx
==0 ){

99228 #iâdeà
SQLITE_OMIT_CHECK


99229 ifÐ
	gpDe¡
->
	gpCheck
 && 
sql™e3Ex´Li¡Com·»
(
pSrc
->
pCheck
,
pDe¡
->pCheck,-1) ){

99233 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


99241 ifÐ(
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_FÜeignKeys
)!=0 && 
pDe¡
->
pFKey
!=0 ){

99245 ifÐ(
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
)!=0 ){

99253 #ifdeà
SQLITE_TEST


99254 
	gsql™e3_xãrÝt_couÁ
++;

99256 
	giDbSrc
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pSrc
->
pSchema
);

99257 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

99258 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDbSrc
);

99259 
	giSrc
 = 
pP¬£
->
nTab
++;

99260 
	giDe¡
 = 
pP¬£
->
nTab
++;

99261 
	g»gAutošc
 = 
autoIncBegš
(
pP¬£
, 
iDbDe¡
, 
pDe¡
);

99262 
	g»gD©a
 = 
sql™e3G‘TempReg
(
pP¬£
);

99263 
	g»gRowid
 = 
sql™e3G‘TempReg
(
pP¬£
);

99264 
sql™e3O³nTabË
(
pP¬£
, 
iDe¡
, 
iDbDe¡
, 
pDe¡
, 
OP_O³nWr™e
);

99265 
as£¹
Ð
HasRowid
(
pDe¡
è|| 
de¡HasUniqueIdx
 );

99266 ifÐ(
	gpDe¡
->
	giPKey
<0 &&…De¡->
	gpIndex
!=0)

99267 || 
de¡HasUniqueIdx


99268 || (
ÚE¼Ü
!=
OE_AbÜt
 && onE¼Ü!=
OE_RÞlback
)

99284 
addr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iDe¡
, 0); 
VdbeCov”age
(v);

99285 
	gem±yDe¡Te¡
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 0);

99286 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

99288 ifÐ
HasRowid
(
pSrc
) ){

99289 
sql™e3O³nTabË
(
pP¬£
, 
iSrc
, 
iDbSrc
, 
pSrc
, 
OP_O³nR—d
);

99290 
	gem±ySrcTe¡
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iSrc
, 0); 
VdbeCov”age
(v);

99291 ifÐ
	gpDe¡
->
	giPKey
>=0 ){

99292 
addr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iSrc
, 
»gRowid
);

99293 
	gaddr2
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iDe¡
, 0, 
»gRowid
);

99294 
VdbeCov”age
(
v
);

99295 
sql™e3RowidCÚ¡¿št
(
pP¬£
, 
ÚE¼Ü
, 
pDe¡
);

99296 
sql™e3VdbeJumpH”e
(
v
, 
addr2
);

99297 
autoIncS‹p
(
pP¬£
, 
»gAutošc
, 
»gRowid
);

99298 }ifÐ
	gpDe¡
->
	gpIndex
==0 ){

99299 
addr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iDe¡
, 
»gRowid
);

99301 
	gaddr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iSrc
, 
»gRowid
);

99302 
as£¹
Ð(
pDe¡
->
bFÏgs
 & 
TF_Autošüem’t
)==0 );

99304 
sql™e3VdbeAddOp2
(
v
, 
OP_RowD©a
, 
iSrc
, 
»gD©a
);

99305 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iDe¡
, 
»gD©a
, 
»gRowid
);

99306 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_NCHANGE
|
OPFLAG_LASTROWID
|
OPFLAG_APPEND
);

99307 
sql™e3VdbeChªgeP4
(
v
, -1, 
pDe¡
->
zName
, 0);

99308 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iSrc
, 
addr1
); 
VdbeCov”age
(v);

99309 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iSrc
, 0);

99310 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iDe¡
, 0);

99312 
sql™e3TabËLock
(
pP¬£
, 
iDbDe¡
, 
pDe¡
->
Šum
, 1,…De¡->
zName
);

99313 
sql™e3TabËLock
(
pP¬£
, 
iDbSrc
, 
pSrc
->
Šum
, 0,…Src->
zName
);

99315 
	gpDe¡Idx
=
pDe¡
->
pIndex
;…De¡Idx;…De¡Idx=
pDe¡Idx
->
pNext
){

99316 
pSrcIdx
=
pSrc
->
pIndex
; 
ALWAYS
ÕSrcIdx); 
	gpSrcIdx
õSrcIdx->
pNext
){

99317 ifÐ
xãrCom·tibËIndex
(
pDe¡Idx
, 
pSrcIdx
) ) ;

99319 
as£¹
Ð
pSrcIdx
 );

99320 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nR—d
, 
iSrc
, 
pSrcIdx
->
Šum
, 
iDbSrc
);

99321 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pSrcIdx
);

99322 
VdbeComm’t
((
v
, "%s", 
pSrcIdx
->
zName
));

99323 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nWr™e
, 
iDe¡
, 
pDe¡Idx
->
Šum
, 
iDbDe¡
);

99324 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pDe¡Idx
);

99325 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_BULKCSR
);

99326 
VdbeComm’t
((
v
, "%s", 
pDe¡Idx
->
zName
));

99327 
	gaddr1
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iSrc
, 0); 
VdbeCov”age
(v);

99328 
sql™e3VdbeAddOp2
(
v
, 
OP_RowKey
, 
iSrc
, 
»gD©a
);

99329 
sql™e3VdbeAddOp3
(
v
, 
OP_IdxIn£¹
, 
iDe¡
, 
»gD©a
, 1);

99330 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iSrc
, 
addr1
+1); 
VdbeCov”age
(v);

99331 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

99332 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iSrc
, 0);

99333 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iDe¡
, 0);

99335 ifÐ
	gem±ySrcTe¡
 ) 
sql™e3VdbeJumpH”e
(
v
, 
em±ySrcTe¡
);

99336 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRowid
);

99337 
sql™e3R–—£TempReg
(
pP¬£
, 
»gD©a
);

99338 ifÐ
	gem±yDe¡Te¡
 ){

99339 
sql™e3VdbeAddOp2
(
v
, 
OP_H®t
, 
SQLITE_OK
, 0);

99340 
sql™e3VdbeJumpH”e
(
v
, 
em±yDe¡Te¡
);

99341 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iDe¡
, 0);

99379 
SQLITE_API
 
sql™e3_exec
(

99380 
sql™e3
 *
db
,

99381 cÚ¡ *
zSql
,

99382 
sql™e3_ÿÎback
 
xC®lback
,

99383 *
pArg
,

99384 **
pzE¼Msg


99386 
	grc
 = 
SQLITE_OK
;

99387 cÚ¡ *
	gzLeáov”
;

99388 
sql™e3_¡mt
 *
	gpStmt
 = 0;

99389 **
	gazCÞs
 = 0;

99390 
	gÿÎbackIsIn™
;

99392 ifÐ!
sql™e3SaãtyCheckOk
(
db
èè 
	gSQLITE_MISUSE_BKPT
;

99393 ifÐ
	gzSql
==0 ) 
zSql
 = "";

99395 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

99396 
sql™e3E¼Ü
(
db
, 
SQLITE_OK
);

99397  
	grc
==
SQLITE_OK
 && 
zSql
[0] ){

99398 
nCÞ
;

99399 **
	gazV®s
 = 0;

99401 
	gpStmt
 = 0;

99402 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
pStmt
, &
zLeáov”
);

99403 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pStmt
==0 );

99404 ifÐ
	grc
!=
SQLITE_OK
 ){

99407 ifÐ!
	gpStmt
 ){

99409 
	gzSql
 = 
zLeáov”
;

99413 
	gÿÎbackIsIn™
 = 0;

99414 
	gnCÞ
 = 
sql™e3_cÞumn_couÁ
(
pStmt
);

99417 
	gi
;

99418 
	grc
 = 
sql™e3_¡•
(
pStmt
);

99421 ifÐ
	gxC®lback
 && (
	gSQLITE_ROW
==
rc
 ||

99422 (
SQLITE_DONE
==
rc
 && !
ÿÎbackIsIn™


99423 && 
db
->
æags
&
SQLITE_NuÎC®lback
)) ){

99424 ifÐ!
ÿÎbackIsIn™
 ){

99425 
azCÞs
 = 
sql™e3DbM®locZ”o
(
db
, 2*
nCÞ
*(const *) + 1);

99426 ifÐ
	gazCÞs
==0 ){

99427 
exec_out
;

99429 
	gi
=0; i<
	gnCÞ
; i++){

99430 
	gazCÞs
[
i
] = (*)
sql™e3_cÞumn_Çme
(
pStmt
, i);

99433 
as£¹
Ð
azCÞs
[
i
]!=0 );

99435 
	gÿÎbackIsIn™
 = 1;

99437 ifÐ
	grc
==
SQLITE_ROW
 ){

99438 
azV®s
 = &
azCÞs
[
nCÞ
];

99439 
	gi
=0; i<
	gnCÞ
; i++){

99440 
	gazV®s
[
i
] = (*)
sql™e3_cÞumn_‹xt
(
pStmt
, i);

99441 ifÐ!
	gazV®s
[
i
] && 
sql™e3_cÞumn_ty³
(
pStmt
, i)!=
SQLITE_NULL
 ){

99442 
db
->
m®locFažed
 = 1;

99443 
	gexec_out
;

99447 ifÐ
xC®lback
(
pArg
, 
nCÞ
, 
azV®s
, 
azCÞs
) ){

99451 
	grc
 = 
SQLITE_ABORT
;

99452 
sql™e3VdbeFš®ize
((
Vdbe
 *)
pStmt
);

99453 
	gpStmt
 = 0;

99454 
sql™e3E¼Ü
(
db
, 
SQLITE_ABORT
);

99455 
	gexec_out
;

99459 ifÐ
	grc
!=
SQLITE_ROW
 ){

99460 
rc
 = 
sql™e3VdbeFš®ize
((
Vdbe
 *)
pStmt
);

99461 
	gpStmt
 = 0;

99462 
	gzSql
 = 
zLeáov”
;

99463  
sql™e3Is¥aû
(
zSql
[0]èè
	gzSql
++;

99468 
sql™e3DbF»e
(
db
, 
azCÞs
);

99469 
	gazCÞs
 = 0;

99472 
	gexec_out
:

99473 ifÐ
pStmt
 ) 
sql™e3VdbeFš®ize
((
Vdbe
 *)pStmt);

99474 
sql™e3DbF»e
(
db
, 
azCÞs
);

99476 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

99477 ifÐ
	grc
!=
SQLITE_OK
 && 
pzE¼Msg
 ){

99478 
nE¼Msg
 = 1 + 
sql™e3SŒËn30
(
sql™e3_”rmsg
(
db
));

99479 *
	gpzE¼Msg
 = 
sql™e3M®loc
(
nE¼Msg
);

99480 ifÐ*
	gpzE¼Msg
 ){

99481 
memýy
(*
pzE¼Msg
, 
sql™e3_”rmsg
(
db
), 
nE¼Msg
);

99483 
	grc
 = 
SQLITE_NOMEM
;

99484 
sql™e3E¼Ü
(
db
, 
SQLITE_NOMEM
);

99486 }ifÐ
	gpzE¼Msg
 ){

99487 *
	gpzE¼Msg
 = 0;

99490 
as£¹
Ð(
rc
&
db
->
”rMask
)==rc );

99491 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

99492  
	grc
;

99512 #iâdeà
SQLITE_CORE


99513 
	#SQLITE_CORE
 1

	)

99534 #iâdeà
_SQLITE3EXT_H_


99535 
	#_SQLITE3EXT_H_


	)

99537 
sql™e3_­i_routšes
 
	tsql™e3_­i_routšes
;

99549 
	ssql™e3_­i_routšes
 {

99550 * (*
	gagg»g©e_cÚ‹xt
)(
	gsql™e3_cÚ‹xt
*,
	gnBy‹s
);

99551 (*
	gagg»g©e_couÁ
)(
	gsql™e3_cÚ‹xt
*);

99552 (*
	gbšd_blob
)(
	gsql™e3_¡mt
*,,cÚ¡ *,
	gn
,(*)(*));

99553 (*
	gbšd_doubË
)(
	gsql™e3_¡mt
*,,);

99554 (*
	gbšd_št
)(
	gsql™e3_¡mt
*,,);

99555 (*
	gbšd_št64
)(
	gsql™e3_¡mt
*,,
	gsql™e_št64
);

99556 (*
	gbšd_nuÎ
)(
	gsql™e3_¡mt
*,);

99557 (*
	gbšd_·¿m‘”_couÁ
)(
	gsql™e3_¡mt
*);

99558 (*
	gbšd_·¿m‘”_šdex
)(
	gsql™e3_¡mt
*,cÚ¡ *
	gzName
);

99559 cÚ¡ * (*
	gbšd_·¿m‘”_Çme
)(
	gsql™e3_¡mt
*,);

99560 (*
	gbšd_‹xt
)(
	gsql™e3_¡mt
*,,cÚ¡ *,
	gn
,(*)(*));

99561 (*
	gbšd_‹xt16
)(
	gsql™e3_¡mt
*,,const *,,(*)(*));

99562 (*
	gbšd_v®ue
)(
	gsql™e3_¡mt
*,,cÚ¡ 
	gsql™e3_v®ue
*);

99563 (*
	gbusy_hªdËr
)(
	gsql™e3
*,(*)(*,),*);

99564 (*
	gbusy_timeout
)(
	gsql™e3
*,
	gms
);

99565 (*
	gchªges
)(
	gsql™e3
*);

99566 (*
	gþo£
)(
	gsql™e3
*);

99567 (*
	gcÞÏtiÚ_Ãeded
)(
	gsql™e3
*,*,(*)(*,sqlite3*,

99568 
	geTextR•
,const *));

99569 (*
	gcÞÏtiÚ_Ãeded16
)(
	gsql™e3
*,*,(*)(*,sqlite3*,

99570 
	geTextR•
,const *));

99571 cÚ¡ * (*
	gcÞumn_blob
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99572 (*
	gcÞumn_by‹s
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99573 (*
	gcÞumn_by‹s16
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99574 (*
	gcÞumn_couÁ
)(
sql™e3_¡mt
*
	gpStmt
);

99575 cÚ¡ * (*
	gcÞumn_d©aba£_Çme
)(
	gsql™e3_¡mt
*,);

99576 cÚ¡ * (*
	gcÞumn_d©aba£_Çme16
)(
	gsql™e3_¡mt
*,);

99577 cÚ¡ * (*
	gcÞumn_deþty³
)(
	gsql™e3_¡mt
*,
	gi
);

99578 cÚ¡ * (*
	gcÞumn_deþty³16
)(
	gsql™e3_¡mt
*,);

99579 (*
	gcÞumn_doubË
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99580 (*
	gcÞumn_št
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99581 
sql™e_št64
 (*
cÞumn_št64
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99582 cÚ¡ * (*
	gcÞumn_Çme
)(
	gsql™e3_¡mt
*,);

99583 cÚ¡ * (*
	gcÞumn_Çme16
)(
	gsql™e3_¡mt
*,);

99584 cÚ¡ * (*
	gcÞumn_Üigš_Çme
)(
	gsql™e3_¡mt
*,);

99585 cÚ¡ * (*
	gcÞumn_Üigš_Çme16
)(
	gsql™e3_¡mt
*,);

99586 cÚ¡ * (*
	gcÞumn_bË_Çme
)(
	gsql™e3_¡mt
*,);

99587 cÚ¡ * (*
	gcÞumn_bË_Çme16
)(
	gsql™e3_¡mt
*,);

99588 cÚ¡ * (*
	gcÞumn_‹xt
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99589 cÚ¡ * (*
	gcÞumn_‹xt16
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99590 (*
	gcÞumn_ty³
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99591 
	gsql™e3_v®ue
* (*
	gcÞumn_v®ue
)(
	gsql™e3_¡mt
*,
	giCÞ
);

99592 * (*
	gcomm™_hook
)(
	gsql™e3
*,(*)(*),*);

99593 (*
	gcom¶‘e
)(cÚ¡ *
	gsql
);

99594 (*
	gcom¶‘e16
)(cÚ¡ *
	gsql
);

99595 (*
	gü—‹_cÞÏtiÚ
)(
	gsql™e3
*,const *,,*,

99597 (*
	gü—‹_cÞÏtiÚ16
)(
	gsql™e3
*,const *,,*,

99599 (*
	gü—‹_funùiÚ
)(
	gsql™e3
*,const *,,,*,

99600 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99601 (*
	gxS‹p
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99602 (*
	gxFš®
)(
	gsql™e3_cÚ‹xt
*));

99603 (*
	gü—‹_funùiÚ16
)(
	gsql™e3
*,const *,,,*,

99604 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99605 (*
	gxS‹p
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99606 (*
	gxFš®
)(
	gsql™e3_cÚ‹xt
*));

99607 (*
	gü—‹_moduË
)(
	gsql™e3
*,cÚ¡ *,cÚ¡ 
	gsql™e3_moduË
*,*);

99608 (*
	gd©a_couÁ
)(
sql™e3_¡mt
*
	gpStmt
);

99609 
	gsql™e3
 * (*
	gdb_hªdË
)(
	gsql™e3_¡mt
*);

99610 (*
	gdeþ¬e_vb
)(
	gsql™e3
*,const *);

99611 (*
	g’abË_sh¬ed_ÿche
)();

99612 (*
	g”rcode
)(
sql™e3
*
	gdb
);

99613 cÚ¡ * (*
	g”rmsg
)(
	gsql™e3
*);

99614 cÚ¡ * (*
	g”rmsg16
)(
	gsql™e3
*);

99615 (*
	gexec
)(
	gsql™e3
*,cÚ¡ *,
	gsql™e3_ÿÎback
,*,**);

99616 (*
	gexpœed
)(
	gsql™e3_¡mt
*);

99617 (*
	gfš®ize
)(
sql™e3_¡mt
*
	gpStmt
);

99618 (*
	gä“
)(*);

99619 (*
	gä“_bË
)(**
	g»suÉ
);

99620 (*
	gg‘_autocomm™
)(
	gsql™e3
*);

99621 * (*
	gg‘_auxd©a
)(
	gsql™e3_cÚ‹xt
*,);

99622 (*
	gg‘_bË
)(
	gsql™e3
*,const *,***,*,*,**);

99623 (*
	gglob®_»cov”
)();

99624 (*
	gš‹¼u±x
)(
	gsql™e3
*);

99625 
sql™e_št64
 (*
Ï¡_š£¹_rowid
)(
	gsql™e3
*);

99626 cÚ¡ * (*
	glibv”siÚ
)();

99627 (*
	glibv”siÚ_numb”
)();

99628 *(*
	gm®loc
)();

99629 * (*
	gm´štf
)(const *,...);

99630 (*
	gÝ’
)(cÚ¡ *,
	gsql™e3
**);

99631 (*
	gÝ’16
)(cÚ¡ *,
	gsql™e3
**);

99632 (*
	g´•¬e
)(
	gsql™e3
*,cÚ¡ *,,
	gsql™e3_¡mt
**,const **);

99633 (*
	g´•¬e16
)(
	gsql™e3
*,cÚ¡ *,,
	gsql™e3_¡mt
**,const **);

99634 * (*
	g´ofže
)(
	gsql™e3
*,(*)(*,cÚ¡ *,
	gsql™e_ušt64
),*);

99635 (*
	g´og»ss_hªdËr
)(
	gsql™e3
*,,(*)(*),*);

99636 *(*
	g»®loc
)(*,);

99637 (*
	g»£t
)(
sql™e3_¡mt
*
	gpStmt
);

99638 (*
	g»suÉ_blob
)(
	gsql™e3_cÚ‹xt
*,const *,,(*)(*));

99639 (*
	g»suÉ_doubË
)(
	gsql™e3_cÚ‹xt
*,);

99640 (*
	g»suÉ_”rÜ
)(
	gsql™e3_cÚ‹xt
*,const *,);

99641 (*
	g»suÉ_”rÜ16
)(
	gsql™e3_cÚ‹xt
*,const *,);

99642 (*
	g»suÉ_št
)(
	gsql™e3_cÚ‹xt
*,);

99643 (*
	g»suÉ_št64
)(
	gsql™e3_cÚ‹xt
*,
	gsql™e_št64
);

99644 (*
	g»suÉ_nuÎ
)(
	gsql™e3_cÚ‹xt
*);

99645 (*
	g»suÉ_‹xt
)(
	gsql™e3_cÚ‹xt
*,const *,,(*)(*));

99646 (*
	g»suÉ_‹xt16
)(
	gsql™e3_cÚ‹xt
*,const *,,(*)(*));

99647 (*
	g»suÉ_‹xt16be
)(
	gsql™e3_cÚ‹xt
*,const *,,(*)(*));

99648 (*
	g»suÉ_‹xt16Ë
)(
	gsql™e3_cÚ‹xt
*,const *,,(*)(*));

99649 (*
	g»suÉ_v®ue
)(
	gsql™e3_cÚ‹xt
*,
	gsql™e3_v®ue
*);

99650 * (*
	grÞlback_hook
)(
	gsql™e3
*,(*)(*),*);

99651 (*
	g£t_authÜiz”
)(
	gsql™e3
*,(*)(*,,const *,const *,

99653 (*
	g£t_auxd©a
)(
	gsql™e3_cÚ‹xt
*,,*,(*)(*));

99654 * (*
	g¢´štf
)(,*,const *,...);

99655 (*
	g¡•
)(
	gsql™e3_¡mt
*);

99656 (*
	gbË_cÞumn_m‘ad©a
)(
	gsql™e3
*,const *,const *,const *,

99658 (*
	gth»ad_þ—nup
)();

99659 (*
	gtÙ®_chªges
)(
	gsql™e3
*);

99660 * (*
	gŒaû
)(
	gsql™e3
*,(*
	gxT¿û
)(*,const *),*);

99661 (*
	gŒªsãr_bšdšgs
)(
	gsql™e3_¡mt
*,sqlite3_stmt*);

99662 * (*
	gupd©e_hook
)(
	gsql™e3
*,(*)(*,,const*,const*,

99663 
	gsql™e_št64
),*);

99664 * (*
	gu£r_d©a
)(
	gsql™e3_cÚ‹xt
*);

99665 cÚ¡ * (*
	gv®ue_blob
)(
	gsql™e3_v®ue
*);

99666 (*
	gv®ue_by‹s
)(
	gsql™e3_v®ue
*);

99667 (*
	gv®ue_by‹s16
)(
	gsql™e3_v®ue
*);

99668 (*
	gv®ue_doubË
)(
	gsql™e3_v®ue
*);

99669 (*
	gv®ue_št
)(
	gsql™e3_v®ue
*);

99670 
sql™e_št64
 (*
v®ue_št64
)(
	gsql™e3_v®ue
*);

99671 (*
	gv®ue_num”ic_ty³
)(
	gsql™e3_v®ue
*);

99672 cÚ¡ * (*
	gv®ue_‹xt
)(
	gsql™e3_v®ue
*);

99673 cÚ¡ * (*
	gv®ue_‹xt16
)(
	gsql™e3_v®ue
*);

99674 cÚ¡ * (*
	gv®ue_‹xt16be
)(
	gsql™e3_v®ue
*);

99675 cÚ¡ * (*
	gv®ue_‹xt16Ë
)(
	gsql™e3_v®ue
*);

99676 (*
	gv®ue_ty³
)(
	gsql™e3_v®ue
*);

99677 *(*
	gvm´štf
)(cÚ¡ *,
	gva_li¡
);

99679 (*
	gov”lßd_funùiÚ
)(
	gsql™e3
*, cÚ¡ *
	gzFuncName
, 
	gnArg
);

99681 (*
	g´•¬e_v2
)(
	gsql™e3
*,cÚ¡ *,,
	gsql™e3_¡mt
**,const **);

99682 (*
	g´•¬e16_v2
)(
	gsql™e3
*,cÚ¡ *,,
	gsql™e3_¡mt
**,const **);

99683 (*
	gþ—r_bšdšgs
)(
	gsql™e3_¡mt
*);

99685 (*
	gü—‹_moduË_v2
)(
	gsql™e3
*,cÚ¡ *,cÚ¡ 
	gsql™e3_moduË
*,*,

99686 (*
	gxDe¡roy
)(*));

99688 (*
	gbšd_z”oblob
)(
	gsql™e3_¡mt
*,,);

99689 (*
	gblob_by‹s
)(
	gsql™e3_blob
*);

99690 (*
	gblob_þo£
)(
	gsql™e3_blob
*);

99691 (*
	gblob_Ý’
)(
	gsql™e3
*,cÚ¡ *,cÚ¡ *,cÚ¡ *,
	gsql™e3_št64
,

99692 ,
	gsql™e3_blob
**);

99693 (*
	gblob_»ad
)(
	gsql™e3_blob
*,*,,);

99694 (*
	gblob_wr™e
)(
	gsql™e3_blob
*,const *,,);

99695 (*
	gü—‹_cÞÏtiÚ_v2
)(
	gsql™e3
*,const *,,*,

99698 (*
	gfže_cÚŒÞ
)(
	gsql™e3
*,const *,,*);

99699 
sql™e3_št64
 (*
memÜy_highw©”
)();

99700 
sql™e3_št64
 (*
memÜy_u£d
)();

99701 
	gsql™e3_mu‹x
 *(*
	gmu‹x_®loc
)();

99702 (*
	gmu‹x_’‹r
)(
	gsql™e3_mu‹x
*);

99703 (*
	gmu‹x_ä“
)(
	gsql™e3_mu‹x
*);

99704 (*
	gmu‹x_Ëave
)(
	gsql™e3_mu‹x
*);

99705 (*
	gmu‹x_Œy
)(
	gsql™e3_mu‹x
*);

99706 (*
	gÝ’_v2
)(cÚ¡ *,
	gsql™e3
**,,const *);

99707 (*
	g»Ëa£_memÜy
)();

99708 (*
	g»suÉ_”rÜ_nomem
)(
	gsql™e3_cÚ‹xt
*);

99709 (*
	g»suÉ_”rÜ_toobig
)(
	gsql™e3_cÚ‹xt
*);

99710 (*
	g¦“p
)();

99711 (*
	gsoá_h—p_lim™
)();

99712 
	gsql™e3_vfs
 *(*
	gvfs_fšd
)(const *);

99713 (*
	gvfs_»gi¡”
)(
	gsql™e3_vfs
*,);

99714 (*
	gvfs_uÄegi¡”
)(
	gsql™e3_vfs
*);

99715 (*
	gxth»ad§ã
)();

99716 (*
	g»suÉ_z”oblob
)(
	gsql™e3_cÚ‹xt
*,);

99717 (*
	g»suÉ_”rÜ_code
)(
	gsql™e3_cÚ‹xt
*,);

99718 (*
	g‹¡_cÚŒÞ
)(, ...);

99719 (*
	g¿ndomÃss
)(,*);

99720 
	gsql™e3
 *(*
	gcÚ‹xt_db_hªdË
)(
	gsql™e3_cÚ‹xt
*);

99721 (*
	gex‹nded_»suÉ_codes
)(
	gsql™e3
*,);

99722 (*
	glim™
)(
	gsql™e3
*,,);

99723 
	gsql™e3_¡mt
 *(*
	gÃxt_¡mt
)(
	gsql™e3
*,sqlite3_stmt*);

99724 cÚ¡ *(*
	gsql
)(
	gsql™e3_¡mt
*);

99725 (*
	g¡©us
)(,*,*,);

99726 (*
	gbackup_fšish
)(
	gsql™e3_backup
*);

99727 
	gsql™e3_backup
 *(*
	gbackup_š™
)(
	gsql™e3
*,const *,sqlite3*,const *);

99728 (*
	gbackup_·gecouÁ
)(
	gsql™e3_backup
*);

99729 (*
	gbackup_»maššg
)(
	gsql™e3_backup
*);

99730 (*
	gbackup_¡•
)(
	gsql™e3_backup
*,);

99731 cÚ¡ *(*
	gcompžeÝtiÚ_g‘
)();

99732 (*
	gcompžeÝtiÚ_u£d
)(const *);

99733 (*
	gü—‹_funùiÚ_v2
)(
	gsql™e3
*,const *,,,*,

99734 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99735 (*
	gxS‹p
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**),

99736 (*
	gxFš®
)(
	gsql™e3_cÚ‹xt
*),

99737 (*
	gxDe¡roy
)(*));

99738 (*
	gdb_cÚfig
)(
	gsql™e3
*,,...);

99739 
	gsql™e3_mu‹x
 *(*
	gdb_mu‹x
)(
	gsql™e3
*);

99740 (*
	gdb_¡©us
)(
	gsql™e3
*,,*,*,);

99741 (*
	gex‹nded_”rcode
)(
	gsql™e3
*);

99742 (*
	glog
)(,const *,...);

99743 
sql™e3_št64
 (*
soá_h—p_lim™64
)(
	gsql™e3_št64
);

99744 cÚ¡ *(*
	gsourûid
)();

99745 (*
	g¡mt_¡©us
)(
	gsql™e3_¡mt
*,,);

99746 (*
	g¡ºicmp
)(const *,const *,);

99747 (*
	guÆock_nÙify
)(
	gsql™e3
*,(*)(**,),*);

99748 (*
	gw®_autocheckpošt
)(
	gsql™e3
*,);

99749 (*
	gw®_checkpošt
)(
	gsql™e3
*,const *);

99750 *(*
	gw®_hook
)(
	gsql™e3
*,(*)(*,sqlite3*,const *,),*);

99751 (*
	gblob_»Ý’
)(
	gsql™e3_blob
*,
	gsql™e3_št64
);

99752 (*
	gvb_cÚfig
)(
	gsql™e3
*,
	gÝ
,...);

99753 (*
	gvb_Ú_cÚæiù
)(
	gsql™e3
*);

99755 (*
	gþo£_v2
)(
	gsql™e3
*);

99756 cÚ¡ *(*
	gdb_fž’ame
)(
	gsql™e3
*,const *);

99757 (*
	gdb_»adÚly
)(
	gsql™e3
*,const *);

99758 (*
	gdb_»Ëa£_memÜy
)(
	gsql™e3
*);

99759 cÚ¡ *(*
	g”r¡r
)();

99760 (*
	g¡mt_busy
)(
	gsql™e3_¡mt
*);

99761 (*
	g¡mt_»adÚly
)(
	gsql™e3_¡mt
*);

99762 (*
	g¡ricmp
)(const *,const *);

99763 (*
	guri_boÞ—n
)(const *,const *,);

99764 
sql™e3_št64
 (*
uri_št64
)(cÚ¡ *,cÚ¡ *,
	gsql™e3_št64
);

99765 cÚ¡ *(*
	guri_·¿m‘”
)(const *,const *);

99766 *(*
	gv¢´štf
)(,*,cÚ¡ *,
	gva_li¡
);

99767 (*
	gw®_checkpošt_v2
)(
	gsql™e3
*,const *,,*,*);

99769 (*
	gauto_ex‹nsiÚ
)((*)());

99770 (*
	gbšd_blob64
)(
	gsql™e3_¡mt
*,,cÚ¡ *,
	gsql™e3_ušt64
,

99772 (*
	gbšd_‹xt64
)(
	gsql™e3_¡mt
*,,cÚ¡ *,
	gsql™e3_ušt64
,

99774 (*
	gÿnûl_auto_ex‹nsiÚ
)((*)());

99775 (*
	glßd_ex‹nsiÚ
)(
	gsql™e3
*,const *,const *,**);

99776 *(*
	gm®loc64
)(
	gsql™e3_ušt64
);

99777 
sql™e3_ušt64
 (*
msize
)(*);

99778 *(*
	g»®loc64
)(*,
	gsql™e3_ušt64
);

99779 (*
	g»£t_auto_ex‹nsiÚ
)();

99780 (*
	g»suÉ_blob64
)(
	gsql™e3_cÚ‹xt
*,cÚ¡ *,
	gsql™e3_ušt64
,

99782 (*
	g»suÉ_‹xt64
)(
	gsql™e3_cÚ‹xt
*,cÚ¡ *,
	gsql™e3_ušt64
,

99784 (*
	g¡rglob
)(const *,const *);

99798 #iâdeà
SQLITE_CORE


99799 
	#sql™e3_agg»g©e_cÚ‹xt
 
sql™e3_­i
->
agg»g©e_cÚ‹xt


	)

99800 #iâdeà
SQLITE_OMIT_DEPRECATED


99801 
	#sql™e3_agg»g©e_couÁ
 
sql™e3_­i
->
agg»g©e_couÁ


	)

99803 
	#sql™e3_bšd_blob
 
sql™e3_­i
->
bšd_blob


	)

99804 
	#sql™e3_bšd_doubË
 
sql™e3_­i
->
bšd_doubË


	)

99805 
	#sql™e3_bšd_št
 
sql™e3_­i
->
bšd_št


	)

99806 
	#sql™e3_bšd_št64
 
sql™e3_­i
->
bšd_št64


	)

99807 
	#sql™e3_bšd_nuÎ
 
sql™e3_­i
->
bšd_nuÎ


	)

99808 
	#sql™e3_bšd_·¿m‘”_couÁ
 
sql™e3_­i
->
bšd_·¿m‘”_couÁ


	)

99809 
	#sql™e3_bšd_·¿m‘”_šdex
 
sql™e3_­i
->
bšd_·¿m‘”_šdex


	)

99810 
	#sql™e3_bšd_·¿m‘”_Çme
 
sql™e3_­i
->
bšd_·¿m‘”_Çme


	)

99811 
	#sql™e3_bšd_‹xt
 
sql™e3_­i
->
bšd_‹xt


	)

99812 
	#sql™e3_bšd_‹xt16
 
sql™e3_­i
->
bšd_‹xt16


	)

99813 
	#sql™e3_bšd_v®ue
 
sql™e3_­i
->
bšd_v®ue


	)

99814 
	#sql™e3_busy_hªdËr
 
sql™e3_­i
->
busy_hªdËr


	)

99815 
	#sql™e3_busy_timeout
 
sql™e3_­i
->
busy_timeout


	)

99816 
	#sql™e3_chªges
 
sql™e3_­i
->
chªges


	)

99817 
	#sql™e3_þo£
 
sql™e3_­i
->
þo£


	)

99818 
	#sql™e3_cÞÏtiÚ_Ãeded
 
sql™e3_­i
->
cÞÏtiÚ_Ãeded


	)

99819 
	#sql™e3_cÞÏtiÚ_Ãeded16
 
sql™e3_­i
->
cÞÏtiÚ_Ãeded16


	)

99820 
	#sql™e3_cÞumn_blob
 
sql™e3_­i
->
cÞumn_blob


	)

99821 
	#sql™e3_cÞumn_by‹s
 
sql™e3_­i
->
cÞumn_by‹s


	)

99822 
	#sql™e3_cÞumn_by‹s16
 
sql™e3_­i
->
cÞumn_by‹s16


	)

99823 
	#sql™e3_cÞumn_couÁ
 
sql™e3_­i
->
cÞumn_couÁ


	)

99824 
	#sql™e3_cÞumn_d©aba£_Çme
 
sql™e3_­i
->
cÞumn_d©aba£_Çme


	)

99825 
	#sql™e3_cÞumn_d©aba£_Çme16
 
sql™e3_­i
->
cÞumn_d©aba£_Çme16


	)

99826 
	#sql™e3_cÞumn_deþty³
 
sql™e3_­i
->
cÞumn_deþty³


	)

99827 
	#sql™e3_cÞumn_deþty³16
 
sql™e3_­i
->
cÞumn_deþty³16


	)

99828 
	#sql™e3_cÞumn_doubË
 
sql™e3_­i
->
cÞumn_doubË


	)

99829 
	#sql™e3_cÞumn_št
 
sql™e3_­i
->
cÞumn_št


	)

99830 
	#sql™e3_cÞumn_št64
 
sql™e3_­i
->
cÞumn_št64


	)

99831 
	#sql™e3_cÞumn_Çme
 
sql™e3_­i
->
cÞumn_Çme


	)

99832 
	#sql™e3_cÞumn_Çme16
 
sql™e3_­i
->
cÞumn_Çme16


	)

99833 
	#sql™e3_cÞumn_Üigš_Çme
 
sql™e3_­i
->
cÞumn_Üigš_Çme


	)

99834 
	#sql™e3_cÞumn_Üigš_Çme16
 
sql™e3_­i
->
cÞumn_Üigš_Çme16


	)

99835 
	#sql™e3_cÞumn_bË_Çme
 
sql™e3_­i
->
cÞumn_bË_Çme


	)

99836 
	#sql™e3_cÞumn_bË_Çme16
 
sql™e3_­i
->
cÞumn_bË_Çme16


	)

99837 
	#sql™e3_cÞumn_‹xt
 
sql™e3_­i
->
cÞumn_‹xt


	)

99838 
	#sql™e3_cÞumn_‹xt16
 
sql™e3_­i
->
cÞumn_‹xt16


	)

99839 
	#sql™e3_cÞumn_ty³
 
sql™e3_­i
->
cÞumn_ty³


	)

99840 
	#sql™e3_cÞumn_v®ue
 
sql™e3_­i
->
cÞumn_v®ue


	)

99841 
	#sql™e3_comm™_hook
 
sql™e3_­i
->
comm™_hook


	)

99842 
	#sql™e3_com¶‘e
 
sql™e3_­i
->
com¶‘e


	)

99843 
	#sql™e3_com¶‘e16
 
sql™e3_­i
->
com¶‘e16


	)

99844 
	#sql™e3_ü—‹_cÞÏtiÚ
 
sql™e3_­i
->
ü—‹_cÞÏtiÚ


	)

99845 
	#sql™e3_ü—‹_cÞÏtiÚ16
 
sql™e3_­i
->
ü—‹_cÞÏtiÚ16


	)

99846 
	#sql™e3_ü—‹_funùiÚ
 
sql™e3_­i
->
ü—‹_funùiÚ


	)

99847 
	#sql™e3_ü—‹_funùiÚ16
 
sql™e3_­i
->
ü—‹_funùiÚ16


	)

99848 
	#sql™e3_ü—‹_moduË
 
sql™e3_­i
->
ü—‹_moduË


	)

99849 
	#sql™e3_ü—‹_moduË_v2
 
sql™e3_­i
->
ü—‹_moduË_v2


	)

99850 
	#sql™e3_d©a_couÁ
 
sql™e3_­i
->
d©a_couÁ


	)

99851 
	#sql™e3_db_hªdË
 
sql™e3_­i
->
db_hªdË


	)

99852 
	#sql™e3_deþ¬e_vb
 
sql™e3_­i
->
deþ¬e_vb


	)

99853 
	#sql™e3_’abË_sh¬ed_ÿche
 
sql™e3_­i
->
’abË_sh¬ed_ÿche


	)

99854 
	#sql™e3_”rcode
 
sql™e3_­i
->
”rcode


	)

99855 
	#sql™e3_”rmsg
 
sql™e3_­i
->
”rmsg


	)

99856 
	#sql™e3_”rmsg16
 
sql™e3_­i
->
”rmsg16


	)

99857 
	#sql™e3_exec
 
sql™e3_­i
->
exec


	)

99858 #iâdeà
SQLITE_OMIT_DEPRECATED


99859 
	#sql™e3_expœed
 
sql™e3_­i
->
expœed


	)

99861 
	#sql™e3_fš®ize
 
sql™e3_­i
->
fš®ize


	)

99862 
	#sql™e3_ä“
 
sql™e3_­i
->
ä“


	)

99863 
	#sql™e3_ä“_bË
 
sql™e3_­i
->
ä“_bË


	)

99864 
	#sql™e3_g‘_autocomm™
 
sql™e3_­i
->
g‘_autocomm™


	)

99865 
	#sql™e3_g‘_auxd©a
 
sql™e3_­i
->
g‘_auxd©a


	)

99866 
	#sql™e3_g‘_bË
 
sql™e3_­i
->
g‘_bË


	)

99867 #iâdeà
SQLITE_OMIT_DEPRECATED


99868 
	#sql™e3_glob®_»cov”
 
sql™e3_­i
->
glob®_»cov”


	)

99870 
	#sql™e3_š‹¼u±
 
sql™e3_­i
->
š‹¼u±x


	)

99871 
	#sql™e3_Ï¡_š£¹_rowid
 
sql™e3_­i
->
Ï¡_š£¹_rowid


	)

99872 
	#sql™e3_libv”siÚ
 
sql™e3_­i
->
libv”siÚ


	)

99873 
	#sql™e3_libv”siÚ_numb”
 
sql™e3_­i
->
libv”siÚ_numb”


	)

99874 
	#sql™e3_m®loc
 
sql™e3_­i
->
m®loc


	)

99875 
	#sql™e3_m´štf
 
sql™e3_­i
->
m´štf


	)

99876 
	#sql™e3_Ý’
 
sql™e3_­i
->
Ý’


	)

99877 
	#sql™e3_Ý’16
 
sql™e3_­i
->
Ý’16


	)

99878 
	#sql™e3_´•¬e
 
sql™e3_­i
->
´•¬e


	)

99879 
	#sql™e3_´•¬e16
 
sql™e3_­i
->
´•¬e16


	)

99880 
	#sql™e3_´•¬e_v2
 
sql™e3_­i
->
´•¬e_v2


	)

99881 
	#sql™e3_´•¬e16_v2
 
sql™e3_­i
->
´•¬e16_v2


	)

99882 
	#sql™e3_´ofže
 
sql™e3_­i
->
´ofže


	)

99883 
	#sql™e3_´og»ss_hªdËr
 
sql™e3_­i
->
´og»ss_hªdËr


	)

99884 
	#sql™e3_»®loc
 
sql™e3_­i
->
»®loc


	)

99885 
	#sql™e3_»£t
 
sql™e3_­i
->
»£t


	)

99886 
	#sql™e3_»suÉ_blob
 
sql™e3_­i
->
»suÉ_blob


	)

99887 
	#sql™e3_»suÉ_doubË
 
sql™e3_­i
->
»suÉ_doubË


	)

99888 
	#sql™e3_»suÉ_”rÜ
 
sql™e3_­i
->
»suÉ_”rÜ


	)

99889 
	#sql™e3_»suÉ_”rÜ16
 
sql™e3_­i
->
»suÉ_”rÜ16


	)

99890 
	#sql™e3_»suÉ_št
 
sql™e3_­i
->
»suÉ_št


	)

99891 
	#sql™e3_»suÉ_št64
 
sql™e3_­i
->
»suÉ_št64


	)

99892 
	#sql™e3_»suÉ_nuÎ
 
sql™e3_­i
->
»suÉ_nuÎ


	)

99893 
	#sql™e3_»suÉ_‹xt
 
sql™e3_­i
->
»suÉ_‹xt


	)

99894 
	#sql™e3_»suÉ_‹xt16
 
sql™e3_­i
->
»suÉ_‹xt16


	)

99895 
	#sql™e3_»suÉ_‹xt16be
 
sql™e3_­i
->
»suÉ_‹xt16be


	)

99896 
	#sql™e3_»suÉ_‹xt16Ë
 
sql™e3_­i
->
»suÉ_‹xt16Ë


	)

99897 
	#sql™e3_»suÉ_v®ue
 
sql™e3_­i
->
»suÉ_v®ue


	)

99898 
	#sql™e3_rÞlback_hook
 
sql™e3_­i
->
rÞlback_hook


	)

99899 
	#sql™e3_£t_authÜiz”
 
sql™e3_­i
->
£t_authÜiz”


	)

99900 
	#sql™e3_£t_auxd©a
 
sql™e3_­i
->
£t_auxd©a


	)

99901 
	#sql™e3_¢´štf
 
sql™e3_­i
->
¢´štf


	)

99902 
	#sql™e3_¡•
 
sql™e3_­i
->
¡•


	)

99903 
	#sql™e3_bË_cÞumn_m‘ad©a
 
sql™e3_­i
->
bË_cÞumn_m‘ad©a


	)

99904 
	#sql™e3_th»ad_þ—nup
 
sql™e3_­i
->
th»ad_þ—nup


	)

99905 
	#sql™e3_tÙ®_chªges
 
sql™e3_­i
->
tÙ®_chªges


	)

99906 
	#sql™e3_Œaû
 
sql™e3_­i
->
Œaû


	)

99907 #iâdeà
SQLITE_OMIT_DEPRECATED


99908 
	#sql™e3_Œªsãr_bšdšgs
 
sql™e3_­i
->
Œªsãr_bšdšgs


	)

99910 
	#sql™e3_upd©e_hook
 
sql™e3_­i
->
upd©e_hook


	)

99911 
	#sql™e3_u£r_d©a
 
sql™e3_­i
->
u£r_d©a


	)

99912 
	#sql™e3_v®ue_blob
 
sql™e3_­i
->
v®ue_blob


	)

99913 
	#sql™e3_v®ue_by‹s
 
sql™e3_­i
->
v®ue_by‹s


	)

99914 
	#sql™e3_v®ue_by‹s16
 
sql™e3_­i
->
v®ue_by‹s16


	)

99915 
	#sql™e3_v®ue_doubË
 
sql™e3_­i
->
v®ue_doubË


	)

99916 
	#sql™e3_v®ue_št
 
sql™e3_­i
->
v®ue_št


	)

99917 
	#sql™e3_v®ue_št64
 
sql™e3_­i
->
v®ue_št64


	)

99918 
	#sql™e3_v®ue_num”ic_ty³
 
sql™e3_­i
->
v®ue_num”ic_ty³


	)

99919 
	#sql™e3_v®ue_‹xt
 
sql™e3_­i
->
v®ue_‹xt


	)

99920 
	#sql™e3_v®ue_‹xt16
 
sql™e3_­i
->
v®ue_‹xt16


	)

99921 
	#sql™e3_v®ue_‹xt16be
 
sql™e3_­i
->
v®ue_‹xt16be


	)

99922 
	#sql™e3_v®ue_‹xt16Ë
 
sql™e3_­i
->
v®ue_‹xt16Ë


	)

99923 
	#sql™e3_v®ue_ty³
 
sql™e3_­i
->
v®ue_ty³


	)

99924 
	#sql™e3_vm´štf
 
sql™e3_­i
->
vm´štf


	)

99925 
	#sql™e3_ov”lßd_funùiÚ
 
sql™e3_­i
->
ov”lßd_funùiÚ


	)

99926 
	#sql™e3_´•¬e_v2
 
sql™e3_­i
->
´•¬e_v2


	)

99927 
	#sql™e3_´•¬e16_v2
 
sql™e3_­i
->
´•¬e16_v2


	)

99928 
	#sql™e3_þ—r_bšdšgs
 
sql™e3_­i
->
þ—r_bšdšgs


	)

99929 
	#sql™e3_bšd_z”oblob
 
sql™e3_­i
->
bšd_z”oblob


	)

99930 
	#sql™e3_blob_by‹s
 
sql™e3_­i
->
blob_by‹s


	)

99931 
	#sql™e3_blob_þo£
 
sql™e3_­i
->
blob_þo£


	)

99932 
	#sql™e3_blob_Ý’
 
sql™e3_­i
->
blob_Ý’


	)

99933 
	#sql™e3_blob_»ad
 
sql™e3_­i
->
blob_»ad


	)

99934 
	#sql™e3_blob_wr™e
 
sql™e3_­i
->
blob_wr™e


	)

99935 
	#sql™e3_ü—‹_cÞÏtiÚ_v2
 
sql™e3_­i
->
ü—‹_cÞÏtiÚ_v2


	)

99936 
	#sql™e3_fže_cÚŒÞ
 
sql™e3_­i
->
fže_cÚŒÞ


	)

99937 
	#sql™e3_memÜy_highw©”
 
sql™e3_­i
->
memÜy_highw©”


	)

99938 
	#sql™e3_memÜy_u£d
 
sql™e3_­i
->
memÜy_u£d


	)

99939 
	#sql™e3_mu‹x_®loc
 
sql™e3_­i
->
mu‹x_®loc


	)

99940 
	#sql™e3_mu‹x_’‹r
 
sql™e3_­i
->
mu‹x_’‹r


	)

99941 
	#sql™e3_mu‹x_ä“
 
sql™e3_­i
->
mu‹x_ä“


	)

99942 
	#sql™e3_mu‹x_Ëave
 
sql™e3_­i
->
mu‹x_Ëave


	)

99943 
	#sql™e3_mu‹x_Œy
 
sql™e3_­i
->
mu‹x_Œy


	)

99944 
	#sql™e3_Ý’_v2
 
sql™e3_­i
->
Ý’_v2


	)

99945 
	#sql™e3_»Ëa£_memÜy
 
sql™e3_­i
->
»Ëa£_memÜy


	)

99946 
	#sql™e3_»suÉ_”rÜ_nomem
 
sql™e3_­i
->
»suÉ_”rÜ_nomem


	)

99947 
	#sql™e3_»suÉ_”rÜ_toobig
 
sql™e3_­i
->
»suÉ_”rÜ_toobig


	)

99948 
	#sql™e3_¦“p
 
sql™e3_­i
->
¦“p


	)

99949 
	#sql™e3_soá_h—p_lim™
 
sql™e3_­i
->
soá_h—p_lim™


	)

99950 
	#sql™e3_vfs_fšd
 
sql™e3_­i
->
vfs_fšd


	)

99951 
	#sql™e3_vfs_»gi¡”
 
sql™e3_­i
->
vfs_»gi¡”


	)

99952 
	#sql™e3_vfs_uÄegi¡”
 
sql™e3_­i
->
vfs_uÄegi¡”


	)

99953 
	#sql™e3_th»ad§ã
 
sql™e3_­i
->
xth»ad§ã


	)

99954 
	#sql™e3_»suÉ_z”oblob
 
sql™e3_­i
->
»suÉ_z”oblob


	)

99955 
	#sql™e3_»suÉ_”rÜ_code
 
sql™e3_­i
->
»suÉ_”rÜ_code


	)

99956 
	#sql™e3_‹¡_cÚŒÞ
 
sql™e3_­i
->
‹¡_cÚŒÞ


	)

99957 
	#sql™e3_¿ndomÃss
 
sql™e3_­i
->
¿ndomÃss


	)

99958 
	#sql™e3_cÚ‹xt_db_hªdË
 
sql™e3_­i
->
cÚ‹xt_db_hªdË


	)

99959 
	#sql™e3_ex‹nded_»suÉ_codes
 
sql™e3_­i
->
ex‹nded_»suÉ_codes


	)

99960 
	#sql™e3_lim™
 
sql™e3_­i
->
lim™


	)

99961 
	#sql™e3_Ãxt_¡mt
 
sql™e3_­i
->
Ãxt_¡mt


	)

99962 
	#sql™e3_sql
 
sql™e3_­i
->
sql


	)

99963 
	#sql™e3_¡©us
 
sql™e3_­i
->
¡©us


	)

99964 
	#sql™e3_backup_fšish
 
sql™e3_­i
->
backup_fšish


	)

99965 
	#sql™e3_backup_š™
 
sql™e3_­i
->
backup_š™


	)

99966 
	#sql™e3_backup_·gecouÁ
 
sql™e3_­i
->
backup_·gecouÁ


	)

99967 
	#sql™e3_backup_»maššg
 
sql™e3_­i
->
backup_»maššg


	)

99968 
	#sql™e3_backup_¡•
 
sql™e3_­i
->
backup_¡•


	)

99969 
	#sql™e3_compžeÝtiÚ_g‘
 
sql™e3_­i
->
compžeÝtiÚ_g‘


	)

99970 
	#sql™e3_compžeÝtiÚ_u£d
 
sql™e3_­i
->
compžeÝtiÚ_u£d


	)

99971 
	#sql™e3_ü—‹_funùiÚ_v2
 
sql™e3_­i
->
ü—‹_funùiÚ_v2


	)

99972 
	#sql™e3_db_cÚfig
 
sql™e3_­i
->
db_cÚfig


	)

99973 
	#sql™e3_db_mu‹x
 
sql™e3_­i
->
db_mu‹x


	)

99974 
	#sql™e3_db_¡©us
 
sql™e3_­i
->
db_¡©us


	)

99975 
	#sql™e3_ex‹nded_”rcode
 
sql™e3_­i
->
ex‹nded_”rcode


	)

99976 
	#sql™e3_log
 
sql™e3_­i
->
log


	)

99977 
	#sql™e3_soá_h—p_lim™64
 
sql™e3_­i
->
soá_h—p_lim™64


	)

99978 
	#sql™e3_sourûid
 
sql™e3_­i
->
sourûid


	)

99979 
	#sql™e3_¡mt_¡©us
 
sql™e3_­i
->
¡mt_¡©us


	)

99980 
	#sql™e3_¡ºicmp
 
sql™e3_­i
->
¡ºicmp


	)

99981 
	#sql™e3_uÆock_nÙify
 
sql™e3_­i
->
uÆock_nÙify


	)

99982 
	#sql™e3_w®_autocheckpošt
 
sql™e3_­i
->
w®_autocheckpošt


	)

99983 
	#sql™e3_w®_checkpošt
 
sql™e3_­i
->
w®_checkpošt


	)

99984 
	#sql™e3_w®_hook
 
sql™e3_­i
->
w®_hook


	)

99985 
	#sql™e3_blob_»Ý’
 
sql™e3_­i
->
blob_»Ý’


	)

99986 
	#sql™e3_vb_cÚfig
 
sql™e3_­i
->
vb_cÚfig


	)

99987 
	#sql™e3_vb_Ú_cÚæiù
 
sql™e3_­i
->
vb_Ú_cÚæiù


	)

99989 
	#sql™e3_þo£_v2
 
sql™e3_­i
->
þo£_v2


	)

99990 
	#sql™e3_db_fž’ame
 
sql™e3_­i
->
db_fž’ame


	)

99991 
	#sql™e3_db_»adÚly
 
sql™e3_­i
->
db_»adÚly


	)

99992 
	#sql™e3_db_»Ëa£_memÜy
 
sql™e3_­i
->
db_»Ëa£_memÜy


	)

99993 
	#sql™e3_”r¡r
 
sql™e3_­i
->
”r¡r


	)

99994 
	#sql™e3_¡mt_busy
 
sql™e3_­i
->
¡mt_busy


	)

99995 
	#sql™e3_¡mt_»adÚly
 
sql™e3_­i
->
¡mt_»adÚly


	)

99996 
	#sql™e3_¡ricmp
 
sql™e3_­i
->
¡ricmp


	)

99997 
	#sql™e3_uri_boÞ—n
 
sql™e3_­i
->
uri_boÞ—n


	)

99998 
	#sql™e3_uri_št64
 
sql™e3_­i
->
uri_št64


	)

99999 
	#sql™e3_uri_·¿m‘”
 
sql™e3_­i
->
uri_·¿m‘”


	)

100000 
	#sql™e3_uri_v¢´štf
 
sql™e3_­i
->
v¢´štf


	)

100001 
	#sql™e3_w®_checkpošt_v2
 
sql™e3_­i
->
w®_checkpošt_v2


	)

100003 
	#sql™e3_auto_ex‹nsiÚ
 
sql™e3_­i
->
auto_ex‹nsiÚ


	)

100004 
	#sql™e3_bšd_blob64
 
sql™e3_­i
->
bšd_blob64


	)

100005 
	#sql™e3_bšd_‹xt64
 
sql™e3_­i
->
bšd_‹xt64


	)

100006 
	#sql™e3_ÿnûl_auto_ex‹nsiÚ
 
sql™e3_­i
->
ÿnûl_auto_ex‹nsiÚ


	)

100007 
	#sql™e3_lßd_ex‹nsiÚ
 
sql™e3_­i
->
lßd_ex‹nsiÚ


	)

100008 
	#sql™e3_m®loc64
 
sql™e3_­i
->
m®loc64


	)

100009 
	#sql™e3_msize
 
sql™e3_­i
->
msize


	)

100010 
	#sql™e3_»®loc64
 
sql™e3_­i
->
»®loc64


	)

100011 
	#sql™e3_»£t_auto_ex‹nsiÚ
 
sql™e3_­i
->
»£t_auto_ex‹nsiÚ


	)

100012 
	#sql™e3_»suÉ_blob64
 
sql™e3_­i
->
»suÉ_blob64


	)

100013 
	#sql™e3_»suÉ_‹xt64
 
sql™e3_­i
->
»suÉ_‹xt64


	)

100014 
	#sql™e3_¡rglob
 
sql™e3_­i
->
¡rglob


	)

100017 #iâdeà
SQLITE_CORE


100020 
	#SQLITE_EXTENSION_INIT1
 cÚ¡ 
sql™e3_­i_routšes
 *
sql™e3_­i
=0;

	)

100021 
	#SQLITE_EXTENSION_INIT2
(
v
è
sql™e3_­i
=v;

	)

100022 
	#SQLITE_EXTENSION_INIT3
 \

100023 cÚ¡ 
sql™e3_­i_routšes
 *
sql™e3_­i
;

	)

100027 
	#SQLITE_EXTENSION_INIT1


	)

100028 
	#SQLITE_EXTENSION_INIT2
(
v
è()v;

	)

100029 
	#SQLITE_EXTENSION_INIT3


	)

100038 #iâdeà
SQLITE_OMIT_LOAD_EXTENSION


100045 #iâdeà
SQLITE_ENABLE_COLUMN_METADATA


100046 
	#sql™e3_cÞumn_d©aba£_Çme
 0

	)

100047 
	#sql™e3_cÞumn_d©aba£_Çme16
 0

	)

100048 
	#sql™e3_cÞumn_bË_Çme
 0

	)

100049 
	#sql™e3_cÞumn_bË_Çme16
 0

	)

100050 
	#sql™e3_cÞumn_Üigš_Çme
 0

	)

100051 
	#sql™e3_cÞumn_Üigš_Çme16
 0

	)

100052 
	#sql™e3_bË_cÞumn_m‘ad©a
 0

	)

100055 #ifdeà
SQLITE_OMIT_AUTHORIZATION


100056 
	#sql™e3_£t_authÜiz”
 0

	)

100059 #ifdeà
SQLITE_OMIT_UTF16


100060 
	#sql™e3_bšd_‹xt16
 0

	)

100061 
	#sql™e3_cÞÏtiÚ_Ãeded16
 0

	)

100062 
	#sql™e3_cÞumn_deþty³16
 0

	)

100063 
	#sql™e3_cÞumn_Çme16
 0

	)

100064 
	#sql™e3_cÞumn_‹xt16
 0

	)

100065 
	#sql™e3_com¶‘e16
 0

	)

100066 
	#sql™e3_ü—‹_cÞÏtiÚ16
 0

	)

100067 
	#sql™e3_ü—‹_funùiÚ16
 0

	)

100068 
	#sql™e3_”rmsg16
 0

	)

100069 
	#sql™e3_Ý’16
 0

	)

100070 
	#sql™e3_´•¬e16
 0

	)

100071 
	#sql™e3_´•¬e16_v2
 0

	)

100072 
	#sql™e3_»suÉ_”rÜ16
 0

	)

100073 
	#sql™e3_»suÉ_‹xt16
 0

	)

100074 
	#sql™e3_»suÉ_‹xt16be
 0

	)

100075 
	#sql™e3_»suÉ_‹xt16Ë
 0

	)

100076 
	#sql™e3_v®ue_‹xt16
 0

	)

100077 
	#sql™e3_v®ue_‹xt16be
 0

	)

100078 
	#sql™e3_v®ue_‹xt16Ë
 0

	)

100079 
	#sql™e3_cÞumn_d©aba£_Çme16
 0

	)

100080 
	#sql™e3_cÞumn_bË_Çme16
 0

	)

100081 
	#sql™e3_cÞumn_Üigš_Çme16
 0

	)

100084 #ifdeà
SQLITE_OMIT_COMPLETE


100085 
	#sql™e3_com¶‘e
 0

	)

100086 
	#sql™e3_com¶‘e16
 0

	)

100089 #ifdeà
SQLITE_OMIT_DECLTYPE


100090 
	#sql™e3_cÞumn_deþty³16
 0

	)

100091 
	#sql™e3_cÞumn_deþty³
 0

	)

100094 #ifdeà
SQLITE_OMIT_PROGRESS_CALLBACK


100095 
	#sql™e3_´og»ss_hªdËr
 0

	)

100098 #ifdeà
SQLITE_OMIT_VIRTUALTABLE


100099 
	#sql™e3_ü—‹_moduË
 0

	)

100100 
	#sql™e3_ü—‹_moduË_v2
 0

	)

100101 
	#sql™e3_deþ¬e_vb
 0

	)

100102 
	#sql™e3_vb_cÚfig
 0

	)

100103 
	#sql™e3_vb_Ú_cÚæiù
 0

	)

100106 #ifdeà
SQLITE_OMIT_SHARED_CACHE


100107 
	#sql™e3_’abË_sh¬ed_ÿche
 0

	)

100110 #ifdeà
SQLITE_OMIT_TRACE


100111 
	#sql™e3_´ofže
 0

	)

100112 
	#sql™e3_Œaû
 0

	)

100115 #ifdeà
SQLITE_OMIT_GET_TABLE


100116 
	#sql™e3_ä“_bË
 0

	)

100117 
	#sql™e3_g‘_bË
 0

	)

100120 #ifdeà
SQLITE_OMIT_INCRBLOB


100121 
	#sql™e3_bšd_z”oblob
 0

	)

100122 
	#sql™e3_blob_by‹s
 0

	)

100123 
	#sql™e3_blob_þo£
 0

	)

100124 
	#sql™e3_blob_Ý’
 0

	)

100125 
	#sql™e3_blob_»ad
 0

	)

100126 
	#sql™e3_blob_wr™e
 0

	)

100127 
	#sql™e3_blob_»Ý’
 0

	)

100145 cÚ¡ 
sql™e3_­i_routšes
 
	gsql™e3Apis
 = {

100146 
sql™e3_agg»g©e_cÚ‹xt
,

100147 #iâdeà
SQLITE_OMIT_DEPRECATED


100148 
sql™e3_agg»g©e_couÁ
,

100152 
sql™e3_bšd_blob
,

100153 
sql™e3_bšd_doubË
,

100154 
sql™e3_bšd_št
,

100155 
sql™e3_bšd_št64
,

100156 
sql™e3_bšd_nuÎ
,

100157 
sql™e3_bšd_·¿m‘”_couÁ
,

100158 
sql™e3_bšd_·¿m‘”_šdex
,

100159 
sql™e3_bšd_·¿m‘”_Çme
,

100160 
sql™e3_bšd_‹xt
,

100161 
sql™e3_bšd_‹xt16
,

100162 
sql™e3_bšd_v®ue
,

100163 
sql™e3_busy_hªdËr
,

100164 
sql™e3_busy_timeout
,

100165 
sql™e3_chªges
,

100166 
sql™e3_þo£
,

100167 
sql™e3_cÞÏtiÚ_Ãeded
,

100168 
sql™e3_cÞÏtiÚ_Ãeded16
,

100169 
sql™e3_cÞumn_blob
,

100170 
sql™e3_cÞumn_by‹s
,

100171 
sql™e3_cÞumn_by‹s16
,

100172 
sql™e3_cÞumn_couÁ
,

100173 
sql™e3_cÞumn_d©aba£_Çme
,

100174 
sql™e3_cÞumn_d©aba£_Çme16
,

100175 
sql™e3_cÞumn_deþty³
,

100176 
sql™e3_cÞumn_deþty³16
,

100177 
sql™e3_cÞumn_doubË
,

100178 
sql™e3_cÞumn_št
,

100179 
sql™e3_cÞumn_št64
,

100180 
sql™e3_cÞumn_Çme
,

100181 
sql™e3_cÞumn_Çme16
,

100182 
sql™e3_cÞumn_Üigš_Çme
,

100183 
sql™e3_cÞumn_Üigš_Çme16
,

100184 
sql™e3_cÞumn_bË_Çme
,

100185 
sql™e3_cÞumn_bË_Çme16
,

100186 
sql™e3_cÞumn_‹xt
,

100187 
sql™e3_cÞumn_‹xt16
,

100188 
sql™e3_cÞumn_ty³
,

100189 
sql™e3_cÞumn_v®ue
,

100190 
sql™e3_comm™_hook
,

100191 
sql™e3_com¶‘e
,

100192 
sql™e3_com¶‘e16
,

100193 
sql™e3_ü—‹_cÞÏtiÚ
,

100194 
sql™e3_ü—‹_cÞÏtiÚ16
,

100195 
sql™e3_ü—‹_funùiÚ
,

100196 
sql™e3_ü—‹_funùiÚ16
,

100197 
sql™e3_ü—‹_moduË
,

100198 
sql™e3_d©a_couÁ
,

100199 
sql™e3_db_hªdË
,

100200 
sql™e3_deþ¬e_vb
,

100201 
sql™e3_’abË_sh¬ed_ÿche
,

100202 
sql™e3_”rcode
,

100203 
sql™e3_”rmsg
,

100204 
sql™e3_”rmsg16
,

100205 
sql™e3_exec
,

100206 #iâdeà
SQLITE_OMIT_DEPRECATED


100207 
sql™e3_expœed
,

100211 
sql™e3_fš®ize
,

100212 
sql™e3_ä“
,

100213 
sql™e3_ä“_bË
,

100214 
sql™e3_g‘_autocomm™
,

100215 
sql™e3_g‘_auxd©a
,

100216 
sql™e3_g‘_bË
,

100218 
sql™e3_š‹¼u±
,

100219 
sql™e3_Ï¡_š£¹_rowid
,

100220 
sql™e3_libv”siÚ
,

100221 
sql™e3_libv”siÚ_numb”
,

100222 
sql™e3_m®loc
,

100223 
sql™e3_m´štf
,

100224 
sql™e3_Ý’
,

100225 
sql™e3_Ý’16
,

100226 
sql™e3_´•¬e
,

100227 
sql™e3_´•¬e16
,

100228 
sql™e3_´ofže
,

100229 
sql™e3_´og»ss_hªdËr
,

100230 
sql™e3_»®loc
,

100231 
sql™e3_»£t
,

100232 
sql™e3_»suÉ_blob
,

100233 
sql™e3_»suÉ_doubË
,

100234 
sql™e3_»suÉ_”rÜ
,

100235 
sql™e3_»suÉ_”rÜ16
,

100236 
sql™e3_»suÉ_št
,

100237 
sql™e3_»suÉ_št64
,

100238 
sql™e3_»suÉ_nuÎ
,

100239 
sql™e3_»suÉ_‹xt
,

100240 
sql™e3_»suÉ_‹xt16
,

100241 
sql™e3_»suÉ_‹xt16be
,

100242 
sql™e3_»suÉ_‹xt16Ë
,

100243 
sql™e3_»suÉ_v®ue
,

100244 
sql™e3_rÞlback_hook
,

100245 
sql™e3_£t_authÜiz”
,

100246 
sql™e3_£t_auxd©a
,

100247 
sql™e3_¢´štf
,

100248 
sql™e3_¡•
,

100249 
sql™e3_bË_cÞumn_m‘ad©a
,

100250 #iâdeà
SQLITE_OMIT_DEPRECATED


100251 
sql™e3_th»ad_þ—nup
,

100255 
sql™e3_tÙ®_chªges
,

100256 
sql™e3_Œaû
,

100257 #iâdeà
SQLITE_OMIT_DEPRECATED


100258 
sql™e3_Œªsãr_bšdšgs
,

100262 
sql™e3_upd©e_hook
,

100263 
sql™e3_u£r_d©a
,

100264 
sql™e3_v®ue_blob
,

100265 
sql™e3_v®ue_by‹s
,

100266 
sql™e3_v®ue_by‹s16
,

100267 
sql™e3_v®ue_doubË
,

100268 
sql™e3_v®ue_št
,

100269 
sql™e3_v®ue_št64
,

100270 
sql™e3_v®ue_num”ic_ty³
,

100271 
sql™e3_v®ue_‹xt
,

100272 
sql™e3_v®ue_‹xt16
,

100273 
sql™e3_v®ue_‹xt16be
,

100274 
sql™e3_v®ue_‹xt16Ë
,

100275 
sql™e3_v®ue_ty³
,

100276 
sql™e3_vm´štf
,

100285 
sql™e3_ov”lßd_funùiÚ
,

100290 
sql™e3_´•¬e_v2
,

100291 
sql™e3_´•¬e16_v2
,

100292 
sql™e3_þ—r_bšdšgs
,

100297 
sql™e3_ü—‹_moduË_v2
,

100302 
sql™e3_bšd_z”oblob
,

100303 
sql™e3_blob_by‹s
,

100304 
sql™e3_blob_þo£
,

100305 
sql™e3_blob_Ý’
,

100306 
sql™e3_blob_»ad
,

100307 
sql™e3_blob_wr™e
,

100308 
sql™e3_ü—‹_cÞÏtiÚ_v2
,

100309 
sql™e3_fže_cÚŒÞ
,

100310 
sql™e3_memÜy_highw©”
,

100311 
sql™e3_memÜy_u£d
,

100312 #ifdeà
SQLITE_MUTEX_OMIT


100319 
sql™e3_mu‹x_®loc
,

100320 
sql™e3_mu‹x_’‹r
,

100321 
sql™e3_mu‹x_ä“
,

100322 
sql™e3_mu‹x_Ëave
,

100323 
sql™e3_mu‹x_Œy
,

100325 
sql™e3_Ý’_v2
,

100326 
sql™e3_»Ëa£_memÜy
,

100327 
sql™e3_»suÉ_”rÜ_nomem
,

100328 
sql™e3_»suÉ_”rÜ_toobig
,

100329 
sql™e3_¦“p
,

100330 
sql™e3_soá_h—p_lim™
,

100331 
sql™e3_vfs_fšd
,

100332 
sql™e3_vfs_»gi¡”
,

100333 
sql™e3_vfs_uÄegi¡”
,

100338 
sql™e3_th»ad§ã
,

100339 
sql™e3_»suÉ_z”oblob
,

100340 
sql™e3_»suÉ_”rÜ_code
,

100341 
sql™e3_‹¡_cÚŒÞ
,

100342 
sql™e3_¿ndomÃss
,

100343 
sql™e3_cÚ‹xt_db_hªdË
,

100348 
sql™e3_ex‹nded_»suÉ_codes
,

100349 
sql™e3_lim™
,

100350 
sql™e3_Ãxt_¡mt
,

100351 
sql™e3_sql
,

100352 
sql™e3_¡©us
,

100357 
sql™e3_backup_fšish
,

100358 
sql™e3_backup_š™
,

100359 
sql™e3_backup_·gecouÁ
,

100360 
sql™e3_backup_»maššg
,

100361 
sql™e3_backup_¡•
,

100362 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


100363 
sql™e3_compžeÝtiÚ_g‘
,

100364 
sql™e3_compžeÝtiÚ_u£d
,

100369 
sql™e3_ü—‹_funùiÚ_v2
,

100370 
sql™e3_db_cÚfig
,

100371 
sql™e3_db_mu‹x
,

100372 
sql™e3_db_¡©us
,

100373 
sql™e3_ex‹nded_”rcode
,

100374 
sql™e3_log
,

100375 
sql™e3_soá_h—p_lim™64
,

100376 
sql™e3_sourûid
,

100377 
sql™e3_¡mt_¡©us
,

100378 
sql™e3_¡ºicmp
,

100379 #ifdeà
SQLITE_ENABLE_UNLOCK_NOTIFY


100380 
sql™e3_uÆock_nÙify
,

100384 #iâdeà
SQLITE_OMIT_WAL


100385 
sql™e3_w®_autocheckpošt
,

100386 
sql™e3_w®_checkpošt
,

100387 
sql™e3_w®_hook
,

100393 
sql™e3_blob_»Ý’
,

100394 
sql™e3_vb_cÚfig
,

100395 
sql™e3_vb_Ú_cÚæiù
,

100396 
sql™e3_þo£_v2
,

100397 
sql™e3_db_fž’ame
,

100398 
sql™e3_db_»adÚly
,

100399 
sql™e3_db_»Ëa£_memÜy
,

100400 
sql™e3_”r¡r
,

100401 
sql™e3_¡mt_busy
,

100402 
sql™e3_¡mt_»adÚly
,

100403 
sql™e3_¡ricmp
,

100404 
sql™e3_uri_boÞ—n
,

100405 
sql™e3_uri_št64
,

100406 
sql™e3_uri_·¿m‘”
,

100407 
sql™e3_v¢´štf
,

100408 
sql™e3_w®_checkpošt_v2
,

100410 
sql™e3_auto_ex‹nsiÚ
,

100411 
sql™e3_bšd_blob64
,

100412 
sql™e3_bšd_‹xt64
,

100413 
sql™e3_ÿnûl_auto_ex‹nsiÚ
,

100414 
sql™e3_lßd_ex‹nsiÚ
,

100415 
sql™e3_m®loc64
,

100416 
sql™e3_msize
,

100417 
sql™e3_»®loc64
,

100418 
sql™e3_»£t_auto_ex‹nsiÚ
,

100419 
sql™e3_»suÉ_blob64
,

100420 
sql™e3_»suÉ_‹xt64
,

100421 
sql™e3_¡rglob


100436 
sql™e3LßdEx‹nsiÚ
(

100437 
sql™e3
 *
db
,

100438 cÚ¡ *
zFže
,

100439 cÚ¡ *
zProc
,

100440 **
pzE¼Msg


100442 
sql™e3_vfs
 *
	gpVfs
 = 
db
->
pVfs
;

100443 *
	ghªdË
;

100444 (*
	gxIn™
)(
	gsql™e3
*,**,cÚ¡ 
	gsql™e3_­i_routšes
*);

100445 *
	gzE¼msg
 = 0;

100446 cÚ¡ *
	gzEÁry
;

100447 *
	gzAÉEÁry
 = 0;

100448 **
	gaHªdË
;

100449 
	gnMsg
 = 300 + 
sql™e3SŒËn30
(
zFže
);

100450 
	gii
;

100453 cÚ¡ *
	gazEndšgs
[] = {

100454 #ià
SQLITE_OS_WIN


100456 #–ià
defšed
(
__APPLE__
)

100464 ifÐ
	gpzE¼Msg
 ) *pzErrMsg = 0;

100472 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_LßdEx‹nsiÚ
)==0 ){

100473 ifÐ
pzE¼Msg
 ){

100474 *
pzE¼Msg
 = 
sql™e3_m´štf
("not‡uthorized");

100476  
	gSQLITE_ERROR
;

100479 
	gzEÁry
 = 
zProc
 ? zProc : "sqlite3_extension_init";

100481 
	ghªdË
 = 
sql™e3OsDlO³n
(
pVfs
, 
zFže
);

100482 #ià
SQLITE_OS_UNIX
 || 
SQLITE_OS_WIN


100483 
	gii
=0; ii<
A¼aySize
(
azEndšgs
è&& 
	ghªdË
==0; ii++){

100484 *
	gzAÉFže
 = 
sql™e3_m´štf
("%s.%s", 
zFže
, 
azEndšgs
[
ii
]);

100485 ifÐ
	gzAÉFže
==0 )  
SQLITE_NOMEM
;

100486 
	ghªdË
 = 
sql™e3OsDlO³n
(
pVfs
, 
zAÉFže
);

100487 
sql™e3_ä“
(
zAÉFže
);

100490 ifÐ
	ghªdË
==0 ){

100491 ifÐ
pzE¼Msg
 ){

100492 *
pzE¼Msg
 = 
zE¼msg
 = 
sql™e3_m®loc
(
nMsg
);

100493 ifÐ
	gzE¼msg
 ){

100494 
sql™e3_¢´štf
(
nMsg
, 
zE¼msg
,

100495 "uÇbËØÝ’ sh¬ed†ib¿ry [%s]", 
zFže
);

100496 
sql™e3OsDlE¼Ü
(
pVfs
, 
nMsg
-1, 
zE¼msg
);

100499  
	gSQLITE_ERROR
;

100501 
	gxIn™
 = ((*)(
sql™e3
*,**,cÚ¡ 
	gsql™e3_­i_routšes
*))

100502 
sql™e3OsDlSym
(
pVfs
, 
hªdË
, 
zEÁry
);

100515 ifÐ
	gxIn™
==0 && 
zProc
==0 ){

100516 
iFže
, 
iEÁry
, 
c
;

100517 
	gncFže
 = 
sql™e3SŒËn30
(
zFže
);

100518 
	gzAÉEÁry
 = 
sql™e3_m®loc
(
ncFže
+30);

100519 ifÐ
	gzAÉEÁry
==0 ){

100520 
sql™e3OsDlClo£
(
pVfs
, 
hªdË
);

100521  
	gSQLITE_NOMEM
;

100523 
memýy
(
zAÉEÁry
, "sqlite3_", 8);

100524 
	giFže
=
ncFže
-1; iFže>=0 && 
zFže
[
iFže
]!='/'; iFile--){}

100525 
	giFže
++;

100526 ifÐ
sql™e3_¡ºicmp
(
zFže
+
iFže
, "lib", 3)==0 ) iFile += 3;

100527 
	giEÁry
=8; (
	gc
 = 
zFže
[
iFže
])!=0 && 
c
!='.'; 
	giFže
++){

100528 ifÐ
sql™e3I§Íha
(
c
) ){

100529 
	gzAÉEÁry
[
iEÁry
++] = ()
sql™e3Uµ”ToLow”
[()
c
];

100532 
memýy
(
zAÉEÁry
+
iEÁry
, "_init", 6);

100533 
	gzEÁry
 = 
zAÉEÁry
;

100534 
	gxIn™
 = ((*)(
sql™e3
*,**,cÚ¡ 
	gsql™e3_­i_routšes
*))

100535 
sql™e3OsDlSym
(
pVfs
, 
hªdË
, 
zEÁry
);

100537 ifÐ
	gxIn™
==0 ){

100538 ifÐ
pzE¼Msg
 ){

100539 
nMsg
 +ð
sql™e3SŒËn30
(
zEÁry
);

100540 *
	gpzE¼Msg
 = 
zE¼msg
 = 
sql™e3_m®loc
(
nMsg
);

100541 ifÐ
	gzE¼msg
 ){

100542 
sql™e3_¢´štf
(
nMsg
, 
zE¼msg
,

100543 "nØ’Œy…ošˆ[%s] iÀsh¬ed†ib¿ry [%s]", 
zEÁry
, 
zFže
);

100544 
sql™e3OsDlE¼Ü
(
pVfs
, 
nMsg
-1, 
zE¼msg
);

100547 
sql™e3OsDlClo£
(
pVfs
, 
hªdË
);

100548 
sql™e3_ä“
(
zAÉEÁry
);

100549  
	gSQLITE_ERROR
;

100551 
sql™e3_ä“
(
zAÉEÁry
);

100552 ifÐ
xIn™
(
db
, &
zE¼msg
, &
sql™e3Apis
) ){

100553 ifÐ
	gpzE¼Msg
 ){

100554 *
	gpzE¼Msg
 = 
sql™e3_m´štf
("”rÜ duršg in™Ÿliz©iÚ: %s", 
zE¼msg
);

100556 
sql™e3_ä“
(
zE¼msg
);

100557 
sql™e3OsDlClo£
(
pVfs
, 
hªdË
);

100558  
	gSQLITE_ERROR
;

100562 
	gaHªdË
 = 
sql™e3DbM®locZ”o
(
db
, (
hªdË
)*(db->
nEx‹nsiÚ
+1));

100563 ifÐ
	gaHªdË
==0 ){

100564  
SQLITE_NOMEM
;

100566 ifÐ
	gdb
->
	gnEx‹nsiÚ
>0 ){

100567 
memýy
(
aHªdË
, 
db
->
aEx‹nsiÚ
, (
hªdË
)*db->
nEx‹nsiÚ
);

100569 
sql™e3DbF»e
(
db
, db->
aEx‹nsiÚ
);

100570 
	gdb
->
	gaEx‹nsiÚ
 = 
aHªdË
;

100572 
	gdb
->
	gaEx‹nsiÚ
[
db
->
nEx‹nsiÚ
++] = 
hªdË
;

100573  
	gSQLITE_OK
;

100575 
SQLITE_API
 
sql™e3_lßd_ex‹nsiÚ
(

100576 
sql™e3
 *
db
,

100577 cÚ¡ *
zFže
,

100578 cÚ¡ *
zProc
,

100579 **
pzE¼Msg


100581 
	grc
;

100582 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

100583 
	grc
 = 
sql™e3LßdEx‹nsiÚ
(
db
, 
zFže
, 
zProc
, 
pzE¼Msg
);

100584 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

100585 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

100586  
	grc
;

100593 
SQLITE_PRIVATE
 
sql™e3Clo£Ex‹nsiÚs
(
sql™e3
 *
db
){

100594 
	gi
;

100595 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

100596 
	gi
=0; i<
	gdb
->
	gnEx‹nsiÚ
; i++){

100597 
sql™e3OsDlClo£
(
db
->
pVfs
, db->
aEx‹nsiÚ
[
i
]);

100599 
sql™e3DbF»e
(
db
, db->
aEx‹nsiÚ
);

100606 
SQLITE_API
 
sql™e3_’abË_lßd_ex‹nsiÚ
(
sql™e3
 *
db
, 
Úoff
){

100607 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

100608 ifÐ
	gÚoff
 ){

100609 
	gdb
->
	gæags
 |ð
SQLITE_LßdEx‹nsiÚ
;

100611 
	gdb
->
	gæags
 &ð~
SQLITE_LßdEx‹nsiÚ
;

100613 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

100614  
	gSQLITE_OK
;

100625 #ifdeà
SQLITE_OMIT_LOAD_EXTENSION


100626 cÚ¡ 
sql™e3_­i_routšes
 
	gsql™e3Apis
 = { 0 };

100637 
sql™e3AutoExtLi¡
 
	tsql™e3AutoExtLi¡
;

100638 
SQLITE_WSD
 
	ssql™e3AutoExtLi¡
 {

100639 
	gnExt
;

100640 (**
	gaExt
)();

100641 } 
	gsql™e3AutÛxt
 = { 0, 0 };

100649 #ifdeà
SQLITE_OMIT_WSD


100650 
	#wsdAutÛxtIn™
 \

100651 
sql™e3AutoExtLi¡
 *
x
 = &
	`GLOBAL
(sql™e3AutoExtLi¡,
sql™e3AutÛxt
)

	)

100652 
	#wsdAutÛxt
 
x
[0]

	)

100654 
	#wsdAutÛxtIn™


	)

100655 
	#wsdAutÛxt
 
sql™e3AutÛxt


	)

100663 
SQLITE_API
 
sql™e3_auto_ex‹nsiÚ
((*
xIn™
)()){

100664 
	grc
 = 
SQLITE_OK
;

100665 #iâdeà
SQLITE_OMIT_AUTOINIT


100666 
	grc
 = 
sql™e3_š™Ÿlize
();

100667 ifÐ
	grc
 ){

100668  
	grc
;

100672 
	gi
;

100673 #ià
SQLITE_THREADSAFE


100674 
sql™e3_mu‹x
 *
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

100676 
	gwsdAutÛxtIn™
;

100677 
sql™e3_mu‹x_’‹r
(
mu‹x
);

100678 
	gi
=0; i<
	gwsdAutÛxt
.
	gnExt
; i++){

100679 ifÐ
	gwsdAutÛxt
.
	gaExt
[
i
]==
xIn™
 ) ;

100681 ifÐ
	gi
==
wsdAutÛxt
.
nExt
 ){

100682 
nBy‹
 = (
wsdAutÛxt
.
nExt
+1)*(wsdAutÛxt.
aExt
[0]);

100683 (**
	gaNew
)();

100684 
	gaNew
 = 
sql™e3_»®loc
(
wsdAutÛxt
.
aExt
, 
nBy‹
);

100685 ifÐ
	gaNew
==0 ){

100686 
rc
 = 
SQLITE_NOMEM
;

100688 
	gwsdAutÛxt
.
	gaExt
 = 
aNew
;

100689 
	gwsdAutÛxt
.
	gaExt
[
wsdAutÛxt
.
nExt
] = 
xIn™
;

100690 
	gwsdAutÛxt
.
	gnExt
++;

100693 
sql™e3_mu‹x_Ëave
(
mu‹x
);

100694 
as£¹
Ð(
rc
&0xff)==rc );

100695  
	grc
;

100708 
SQLITE_API
 
sql™e3_ÿnûl_auto_ex‹nsiÚ
((*
xIn™
)()){

100709 #ià
SQLITE_THREADSAFE


100710 
sql™e3_mu‹x
 *
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

100712 
	gi
;

100713 
	gn
 = 0;

100714 
	gwsdAutÛxtIn™
;

100715 
sql™e3_mu‹x_’‹r
(
mu‹x
);

100716 
	gi
=
wsdAutÛxt
.
nExt
-1; i>=0; i--){

100717 ifÐ
	gwsdAutÛxt
.
	gaExt
[
i
]==
xIn™
 ){

100718 
wsdAutÛxt
.
nExt
--;

100719 
	gwsdAutÛxt
.
	gaExt
[
i
] = 
wsdAutÛxt
.
aExt
[wsdAutÛxt.
nExt
];

100720 
	gn
++;

100724 
sql™e3_mu‹x_Ëave
(
mu‹x
);

100725  
	gn
;

100731 
SQLITE_API
 
sql™e3_»£t_auto_ex‹nsiÚ
(){

100732 #iâdeà
SQLITE_OMIT_AUTOINIT


100733 ifÐ
sql™e3_š™Ÿlize
()==
SQLITE_OK
 )

100736 #ià
SQLITE_THREADSAFE


100737 
sql™e3_mu‹x
 *
mu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

100739 
	gwsdAutÛxtIn™
;

100740 
sql™e3_mu‹x_’‹r
(
mu‹x
);

100741 
sql™e3_ä“
(
wsdAutÛxt
.
aExt
);

100742 
	gwsdAutÛxt
.
	gaExt
 = 0;

100743 
	gwsdAutÛxt
.
	gnExt
 = 0;

100744 
sql™e3_mu‹x_Ëave
(
mu‹x
);

100753 
SQLITE_PRIVATE
 
sql™e3AutoLßdEx‹nsiÚs
(
sql™e3
 *
db
){

100754 
	gi
;

100755 
	ggo
 = 1;

100756 
	grc
;

100757 (*
	gxIn™
)(
	gsql™e3
*,**,cÚ¡ 
	gsql™e3_­i_routšes
*);

100759 
	gwsdAutÛxtIn™
;

100760 ifÐ
	gwsdAutÛxt
.
	gnExt
==0 ){

100764 
	gi
=0; 
	ggo
; i++){

100765 *
	gzE¼msg
;

100766 #ià
SQLITE_THREADSAFE


100767 
sql™e3_mu‹x
 *
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
);

100769 
sql™e3_mu‹x_’‹r
(
mu‹x
);

100770 ifÐ
	gi
>=
wsdAutÛxt
.
nExt
 ){

100771 
xIn™
 = 0;

100772 
	ggo
 = 0;

100774 
	gxIn™
 = ((*)(
sql™e3
*,**,cÚ¡ 
	gsql™e3_­i_routšes
*))

100775 
	gwsdAutÛxt
.
	gaExt
[
i
];

100777 
sql™e3_mu‹x_Ëave
(
mu‹x
);

100778 
	gzE¼msg
 = 0;

100779 ifÐ
	gxIn™
 && (
	grc
 = 
xIn™
(
db
, &
zE¼msg
, &
sql™e3Apis
))!=0 ){

100780 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
,

100781 "autom©iøex‹nsiÚ†ßdšg fažed: %s", 
zE¼msg
);

100782 
	ggo
 = 0;

100784 
sql™e3_ä“
(
zE¼msg
);

100804 #ià!
defšed
(
SQLITE_ENABLE_LOCKING_STYLE
)

100805 #ià
defšed
(
__APPLE__
)

100806 
	#SQLITE_ENABLE_LOCKING_STYLE
 1

	)

100808 
	#SQLITE_ENABLE_LOCKING_STYLE
 0

	)

100819 
	#P¿gTyp_HEADER_VALUE
 0

	)

100820 
	#P¿gTyp_AUTO_VACUUM
 1

	)

100821 
	#P¿gTyp_FLAG
 2

	)

100822 
	#P¿gTyp_BUSY_TIMEOUT
 3

	)

100823 
	#P¿gTyp_CACHE_SIZE
 4

	)

100824 
	#P¿gTyp_CASE_SENSITIVE_LIKE
 5

	)

100825 
	#P¿gTyp_COLLATION_LIST
 6

	)

100826 
	#P¿gTyp_COMPILE_OPTIONS
 7

	)

100827 
	#P¿gTyp_DATA_STORE_DIRECTORY
 8

	)

100828 
	#P¿gTyp_DATABASE_LIST
 9

	)

100829 
	#P¿gTyp_DEFAULT_CACHE_SIZE
 10

	)

100830 
	#P¿gTyp_ENCODING
 11

	)

100831 
	#P¿gTyp_FOREIGN_KEY_CHECK
 12

	)

100832 
	#P¿gTyp_FOREIGN_KEY_LIST
 13

	)

100833 
	#P¿gTyp_INCREMENTAL_VACUUM
 14

	)

100834 
	#P¿gTyp_INDEX_INFO
 15

	)

100835 
	#P¿gTyp_INDEX_LIST
 16

	)

100836 
	#P¿gTyp_INTEGRITY_CHECK
 17

	)

100837 
	#P¿gTyp_JOURNAL_MODE
 18

	)

100838 
	#P¿gTyp_JOURNAL_SIZE_LIMIT
 19

	)

100839 
	#P¿gTyp_LOCK_PROXY_FILE
 20

	)

100840 
	#P¿gTyp_LOCKING_MODE
 21

	)

100841 
	#P¿gTyp_PAGE_COUNT
 22

	)

100842 
	#P¿gTyp_MMAP_SIZE
 23

	)

100843 
	#P¿gTyp_PAGE_SIZE
 24

	)

100844 
	#P¿gTyp_SECURE_DELETE
 25

	)

100845 
	#P¿gTyp_SHRINK_MEMORY
 26

	)

100846 
	#P¿gTyp_SOFT_HEAP_LIMIT
 27

	)

100847 
	#P¿gTyp_STATS
 28

	)

100848 
	#P¿gTyp_SYNCHRONOUS
 29

	)

100849 
	#P¿gTyp_TABLE_INFO
 30

	)

100850 
	#P¿gTyp_TEMP_STORE
 31

	)

100851 
	#P¿gTyp_TEMP_STORE_DIRECTORY
 32

	)

100852 
	#P¿gTyp_THREADS
 33

	)

100853 
	#P¿gTyp_WAL_AUTOCHECKPOINT
 34

	)

100854 
	#P¿gTyp_WAL_CHECKPOINT
 35

	)

100855 
	#P¿gTyp_ACTIVATE_EXTENSIONS
 36

	)

100856 
	#P¿gTyp_HEXKEY
 37

	)

100857 
	#P¿gTyp_KEY
 38

	)

100858 
	#P¿gTyp_REKEY
 39

	)

100859 
	#P¿gTyp_LOCK_STATUS
 40

	)

100860 
	#P¿gTyp_PARSER_TRACE
 41

	)

100861 
	#P¿gFÏg_N“dSchema
 0x01

	)

100862 cÚ¡ 
	ssP¿gmaNames
 {

100863 cÚ¡ *cÚ¡ 
	gzName
;

100864 
u8
 
	geP¿gTyp
;

100865 
u8
 
	gmP¿gFÏg
;

100866 
u32
 
	giArg
;

100867 } 
	gaP¿gmaNames
[] = {

100868 #ià
defšed
(
SQLITE_HAS_CODEC
è|| defšed(
SQLITE_ENABLE_CEROD
)

100870  
P¿gTyp_ACTIVATE_EXTENSIONS
,

100874 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
)

100876  
P¿gTyp_HEADER_VALUE
,

100880 #ià!
defšed
(
SQLITE_OMIT_AUTOVACUUM
)

100882  
P¿gTyp_AUTO_VACUUM
,

100883  
P¿gFÏg_N“dSchema
,

100886 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100887 #ià!
defšed
(
SQLITE_OMIT_AUTOMATIC_INDEX
)

100889  
P¿gTyp_FLAG
,

100891  
SQLITE_AutoIndex
 },

100895  
P¿gTyp_BUSY_TIMEOUT
,

100898 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

100900  
P¿gTyp_CACHE_SIZE
,

100901  
P¿gFÏg_N“dSchema
,

100904 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100906  
P¿gTyp_FLAG
,

100908  
SQLITE_CacheSpžl
 },

100911  
P¿gTyp_CASE_SENSITIVE_LIKE
,

100914 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100916  
P¿gTyp_FLAG
,

100918  
SQLITE_Ck±FuÎFSync
 },

100920 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_PRAGMAS
)

100922  
P¿gTyp_COLLATION_LIST
,

100926 #ià!
defšed
(
SQLITE_OMIT_COMPILEOPTION_DIAGS
)

100928  
P¿gTyp_COMPILE_OPTIONS
,

100932 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100934  
P¿gTyp_FLAG
,

100936  
SQLITE_CouÁRows
 },

100938 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
è&& 
SQLITE_OS_WIN


100940  
P¿gTyp_DATA_STORE_DIRECTORY
,

100944 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_PRAGMAS
)

100946  
P¿gTyp_DATABASE_LIST
,

100947  
P¿gFÏg_N“dSchema
,

100950 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
è&& !defšed(
SQLITE_OMIT_DEPRECATED
)

100952  
P¿gTyp_DEFAULT_CACHE_SIZE
,

100953  
P¿gFÏg_N“dSchema
,

100956 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100957 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

100959  
P¿gTyp_FLAG
,

100961  
SQLITE_DeãrFKs
 },

100964 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100966  
P¿gTyp_FLAG
,

100968  
SQLITE_NuÎC®lback
 },

100970 #ià!
defšed
(
SQLITE_OMIT_UTF16
)

100972  
P¿gTyp_ENCODING
,

100976 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

100978  
P¿gTyp_FOREIGN_KEY_CHECK
,

100979  
P¿gFÏg_N“dSchema
,

100982 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
)

100984  
P¿gTyp_FOREIGN_KEY_LIST
,

100985  
P¿gFÏg_N“dSchema
,

100988 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

100989 #ià!
defšed
(
SQLITE_OMIT_FOREIGN_KEY
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

100991  
P¿gTyp_FLAG
,

100993  
SQLITE_FÜeignKeys
 },

100996 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
)

100998  
P¿gTyp_HEADER_VALUE
,

101002 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101004  
P¿gTyp_FLAG
,

101006  
SQLITE_FuÎCÞNames
 },

101008  
P¿gTyp_FLAG
,

101010  
SQLITE_FuÎFSync
 },

101012 #ià
defšed
(
SQLITE_HAS_CODEC
)

101014  
P¿gTyp_HEXKEY
,

101018  
P¿gTyp_HEXKEY
,

101022 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101023 #ià!
defšed
(
SQLITE_OMIT_CHECK
)

101025  
P¿gTyp_FLAG
,

101027  
SQLITE_IgnÜeChecks
 },

101030 #ià!
defšed
(
SQLITE_OMIT_AUTOVACUUM
)

101032  
P¿gTyp_INCREMENTAL_VACUUM
,

101033  
P¿gFÏg_N“dSchema
,

101036 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_PRAGMAS
)

101038  
P¿gTyp_INDEX_INFO
,

101039  
P¿gFÏg_N“dSchema
,

101042  
P¿gTyp_INDEX_LIST
,

101043  
P¿gFÏg_N“dSchema
,

101046 #ià!
defšed
(
SQLITE_OMIT_INTEGRITY_CHECK
)

101048  
P¿gTyp_INTEGRITY_CHECK
,

101049  
P¿gFÏg_N“dSchema
,

101052 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101054  
P¿gTyp_JOURNAL_MODE
,

101055  
P¿gFÏg_N“dSchema
,

101058  
P¿gTyp_JOURNAL_SIZE_LIMIT
,

101062 #ià
defšed
(
SQLITE_HAS_CODEC
)

101064  
P¿gTyp_KEY
,

101068 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101070  
P¿gTyp_FLAG
,

101072  
SQLITE_LegacyFžeFmt
 },

101074 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
è&& 
SQLITE_ENABLE_LOCKING_STYLE


101076  
P¿gTyp_LOCK_PROXY_FILE
,

101080 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_TEST
)

101082  
P¿gTyp_LOCK_STATUS
,

101086 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101088  
P¿gTyp_LOCKING_MODE
,

101092  
P¿gTyp_PAGE_COUNT
,

101093  
P¿gFÏg_N“dSchema
,

101096  
P¿gTyp_MMAP_SIZE
,

101100  
P¿gTyp_PAGE_COUNT
,

101101  
P¿gFÏg_N“dSchema
,

101104  
P¿gTyp_PAGE_SIZE
,

101108 #ià
defšed
(
SQLITE_DEBUG
)

101110  
P¿gTyp_PARSER_TRACE
,

101114 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101116  
P¿gTyp_FLAG
,

101118  
SQLITE_Qu”yOÆy
 },

101120 #ià!
defšed
(
SQLITE_OMIT_INTEGRITY_CHECK
)

101122  
P¿gTyp_INTEGRITY_CHECK
,

101123  
P¿gFÏg_N“dSchema
,

101126 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101128  
P¿gTyp_FLAG
,

101130  
SQLITE_R—dUncomm™‹d
 },

101132  
P¿gTyp_FLAG
,

101134  
SQLITE_RecTrigg”s
 },

101136 #ià
defšed
(
SQLITE_HAS_CODEC
)

101138  
P¿gTyp_REKEY
,

101142 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101144  
P¿gTyp_FLAG
,

101146  
SQLITE_Rev”£Ord”
 },

101148 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
)

101150  
P¿gTyp_HEADER_VALUE
,

101154 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101156  
P¿gTyp_SECURE_DELETE
,

101160 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101162  
P¿gTyp_FLAG
,

101164  
SQLITE_ShÜtCÞNames
 },

101167  
P¿gTyp_SHRINK_MEMORY
,

101171  
P¿gTyp_SOFT_HEAP_LIMIT
,

101174 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101175 #ià
defšed
(
SQLITE_DEBUG
)

101177  
P¿gTyp_FLAG
,

101179  
SQLITE_SqlT¿û
 },

101182 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_PRAGMAS
)

101184  
P¿gTyp_STATS
,

101185  
P¿gFÏg_N“dSchema
,

101188 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101190  
P¿gTyp_SYNCHRONOUS
,

101191  
P¿gFÏg_N“dSchema
,

101194 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_PRAGMAS
)

101196  
P¿gTyp_TABLE_INFO
,

101197  
P¿gFÏg_N“dSchema
,

101200 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101202  
P¿gTyp_TEMP_STORE
,

101206  
P¿gTyp_TEMP_STORE_DIRECTORY
,

101211  
P¿gTyp_THREADS
,

101214 #ià!
defšed
(
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
)

101216  
P¿gTyp_HEADER_VALUE
,

101220 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101221 #ià
defšed
(
SQLITE_DEBUG
)

101223  
P¿gTyp_FLAG
,

101225  
SQLITE_VdbeAddÝT¿û
 },

101227  
P¿gTyp_FLAG
,

101229  
SQLITE_SqlT¿û
|
SQLITE_VdbeLi¡šg
|
SQLITE_VdbeT¿û
 },

101231  
P¿gTyp_FLAG
,

101233  
SQLITE_VdbeEQP
 },

101235  
P¿gTyp_FLAG
,

101237  
SQLITE_VdbeLi¡šg
 },

101239  
P¿gTyp_FLAG
,

101241  
SQLITE_VdbeT¿û
 },

101244 #ià!
defšed
(
SQLITE_OMIT_WAL
)

101246  
P¿gTyp_WAL_AUTOCHECKPOINT
,

101250  
P¿gTyp_WAL_CHECKPOINT
,

101251  
P¿gFÏg_N“dSchema
,

101254 #ià!
defšed
(
SQLITE_OMIT_FLAG_PRAGMAS
)

101256  
P¿gTyp_FLAG
,

101258  
SQLITE_Wr™eSchema
|
SQLITE_Recov”yMode
 },

101276 
u8
 
g‘SaãtyLev–
(cÚ¡ *
z
, 
om™FuÎ
, u8 
dæt
){

101278 cÚ¡ 
	gzText
[] = "onoffalseyestruefull";

101279 cÚ¡ 
u8
 
	giOff£t
[] = {0, 1, 2, 4, 9, 12, 16};

101280 cÚ¡ 
u8
 
	giL’gth
[] = {2, 2, 3, 5, 3, 4, 4};

101281 cÚ¡ 
u8
 
	giV®ue
[] = {1, 0, 0, 0, 1, 1, 2};

101282 
	gi
, 
	gn
;

101283 ifÐ
sql™e3Isdig™
(*
z
) ){

101284  (
	gu8
)
sql™e3Atoi
(
z
);

101286 
	gn
 = 
sql™e3SŒËn30
(
z
);

101287 
	gi
=0; i<
A¼aySize
(
iL’gth
)-
	gom™FuÎ
; i++){

101288 ifÐ
	giL’gth
[
i
]==
n
 && 
sql™e3SŒNICmp
(&
zText
[
iOff£t
[i]],
z
,n)==0 ){

101289  
iV®ue
[
i
];

101292  
	gdæt
;

101298 
SQLITE_PRIVATE
 
u8
 
sql™e3G‘BoÞ—n
(cÚ¡ *
z
, u8 
dæt
){

101299  
g‘SaãtyLev–
(
z
,1,
dæt
)!=0;

101306 #ià!
defšed
(
SQLITE_OMIT_PRAGMA
)

101311 
g‘LockšgMode
(cÚ¡ *
z
){

101312 ifÐ
	gz
 ){

101313 ifÐ0==
sql™e3SŒICmp
(
z
, "exþusive"èè 
	gPAGER_LOCKINGMODE_EXCLUSIVE
;

101314 ifÐ0==
sql™e3SŒICmp
(
z
, "nÜm®"èè 
	gPAGER_LOCKINGMODE_NORMAL
;

101316  
	gPAGER_LOCKINGMODE_QUERY
;

101319 #iâdeà
SQLITE_OMIT_AUTOVACUUM


101326 
g‘AutoVacuum
(cÚ¡ *
z
){

101327 
	gi
;

101328 ifÐ0==
sql™e3SŒICmp
(
z
, "nÚe"èè 
	gBTREE_AUTOVACUUM_NONE
;

101329 ifÐ0==
sql™e3SŒICmp
(
z
, "fuÎ"èè 
	gBTREE_AUTOVACUUM_FULL
;

101330 ifÐ0==
sql™e3SŒICmp
(
z
, "šüem’l"èè 
	gBTREE_AUTOVACUUM_INCR
;

101331 
	gi
 = 
sql™e3Atoi
(
z
);

101332  (
	gu8
)((
	gi
>=0&&
i
<=2)?i:0);

101336 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


101342 
g‘TempStÜe
(cÚ¡ *
z
){

101343 ifÐ
	gz
[0]>='0' && 
z
[0]<='2' ){

101344  
z
[0] - '0';

101345 }ifÐ
sql™e3SŒICmp
(
z
, "file")==0 ){

101347 }ifÐ
sql™e3SŒICmp
(
z
, "memory")==0 ){

101355 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


101360 
šv®id©eTempStÜage
(
P¬£
 *
pP¬£
){

101361 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

101362 ifÐ
	gdb
->
	gaDb
[1].
	gpBt
!=0 ){

101363 ifÐ!
db
->
autoComm™
 || 
sql™e3BŒ“IsInR—dT¿ns
(db->
aDb
[1].
pBt
) ){

101364 
sql™e3E¼ÜMsg
(
pP¬£
, "temporary storage cannot be changed "

101366  
	gSQLITE_ERROR
;

101368 
sql™e3BŒ“Clo£
(
db
->
aDb
[1].
pBt
);

101369 
	gdb
->
	gaDb
[1].
	gpBt
 = 0;

101370 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

101372  
	gSQLITE_OK
;

101376 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


101382 
chªgeTempStÜage
(
P¬£
 *
pP¬£
, cÚ¡ *
zStÜageTy³
){

101383 
	gts
 = 
g‘TempStÜe
(
zStÜageTy³
);

101384 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

101385 ifÐ
	gdb
->
	g‹mp_¡Üe
==
ts
 )  
SQLITE_OK
;

101386 ifÐ
šv®id©eTempStÜage
Ð
pP¬£
 ) !ð
SQLITE_OK
 ){

101387  
SQLITE_ERROR
;

101389 
	gdb
->
	g‹mp_¡Üe
 = (
u8
)
ts
;

101390  
	gSQLITE_OK
;

101397 
»tuºSšgËIÁ
(
P¬£
 *
pP¬£
, cÚ¡ *
zLab–
, 
i64
 
v®ue
){

101398 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

101399 
	gmem
 = ++
pP¬£
->
nMem
;

101400 
i64
 *
	gpI64
 = 
sql™e3DbM®locRaw
(
pP¬£
->
db
, (
v®ue
));

101401 ifÐ
	gpI64
 ){

101402 
memýy
(
pI64
, &
v®ue
, (value));

101404 
sql™e3VdbeAddOp4
(
v
, 
OP_IÁ64
, 0, 
mem
, 0, (*)
pI64
, 
P4_INT64
);

101405 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101406 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, 
zLab–
, 
SQLITE_STATIC
);

101407 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
mem
, 1);

101415 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


101416 
£tAÎPag”FÏgs
(
sql™e3
 *
db
){

101417 ifÐ
	gdb
->
	gautoComm™
 ){

101418 
Db
 *
	gpDb
 = 
db
->
aDb
;

101419 
	gn
 = 
db
->
nDb
;

101420 
as£¹
Ð
SQLITE_FuÎFSync
==
PAGER_FULLFSYNC
 );

101421 
as£¹
Ð
SQLITE_Ck±FuÎFSync
==
PAGER_CKPT_FULLFSYNC
 );

101422 
as£¹
Ð
SQLITE_CacheSpžl
==
PAGER_CACHESPILL
 );

101423 
as£¹
Ð(
PAGER_FULLFSYNC
 | 
PAGER_CKPT_FULLFSYNC
 | 
PAGER_CACHESPILL
)

101424 =ð
PAGER_FLAGS_MASK
 );

101425 
as£¹
Ð(
pDb
->
§ãty_Ëv–
 & 
PAGER_SYNCHRONOUS_MASK
)==pDb->safety_level );

101426  (
	gn
--) > 0 ){

101427 ifÐ
	gpDb
->
	gpBt
 ){

101428 
sql™e3BŒ“S‘Pag”FÏgs
(
pDb
->
pBt
,

101429 
pDb
->
§ãty_Ëv–
 | (
db
->
æags
 & 
PAGER_FLAGS_MASK
) );

101431 
	gpDb
++;

101436 
	#£tAÎPag”FÏgs
(
X
è

	)

101443 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


101444 cÚ¡ *
aùiÚName
(
u8
 
aùiÚ
){

101445 cÚ¡ *
	gzName
;

101446  
	gaùiÚ
 ){

101447 
	gOE_S‘NuÎ
: 
zName
 = "SET NULL"; ;

101448 
	gOE_S‘Dæt
: 
zName
 = "SET DEFAULT"; ;

101449 
	gOE_Casÿde
: 
zName
 = "CASCADE"; ;

101450 
	gOE_Re¡riù
: 
zName
 = "RESTRICT"; ;

101451 : 
zName
 = "NO ACTION";

101452 
as£¹
Ð
aùiÚ
==
OE_NÚe
 ); ;

101454  
	gzName
;

101464 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Jouº®Mod’ame
(
eMode
){

101465 * cÚ¡ 
	gazModeName
[] = {

101467 #iâdeà
SQLITE_OMIT_WAL


101471 
as£¹
Ð
PAGER_JOURNALMODE_DELETE
==0 );

101472 
as£¹
Ð
PAGER_JOURNALMODE_PERSIST
==1 );

101473 
as£¹
Ð
PAGER_JOURNALMODE_OFF
==2 );

101474 
as£¹
Ð
PAGER_JOURNALMODE_TRUNCATE
==3 );

101475 
as£¹
Ð
PAGER_JOURNALMODE_MEMORY
==4 );

101476 
as£¹
Ð
PAGER_JOURNALMODE_WAL
==5 );

101477 
as£¹
Ð
eMode
>=0 &&ƒMode<=
A¼aySize
(
azModeName
) );

101479 ifÐ
	geMode
==
A¼aySize
(
azModeName
) )  0;

101480  
	gazModeName
[
eMode
];

101498 
SQLITE_PRIVATE
 
sql™e3P¿gma
(

101499 
P¬£
 *
pP¬£
,

101500 
Tok’
 *
pId1
,

101501 
Tok’
 *
pId2
,

101502 
Tok’
 *
pV®ue
,

101503 
mšusFÏg


101505 *
	gzLeá
 = 0;

101506 *
	gzRight
 = 0;

101507 cÚ¡ *
	gzDb
 = 0;

101508 
Tok’
 *
	gpId
;

101509 *
	gaFúŽ
[4];

101510 
	giDb
;

101511 
	glwr
, 
	gu´
, 
	gmid
;

101512 
	grc
;

101513 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

101514 
Db
 *
	gpDb
;

101515 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

101517 ifÐ
	gv
==0 ) ;

101518 
sql™e3VdbeRunOÆyOnû
(
v
);

101519 
	gpP¬£
->
	gnMem
 = 2;

101523 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pId1
, 
pId2
, &
pId
);

101524 ifÐ
	giDb
<0 ) ;

101525 
	gpDb
 = &
db
->
aDb
[
iDb
];

101530 ifÐ
	giDb
==1 && 
sql™e3O³nTempD©aba£
(
pP¬£
) ){

101534 
	gzLeá
 = 
sql™e3NameFromTok’
(
db
, 
pId
);

101535 ifÐ!
	gzLeá
 ) ;

101536 ifÐ
	gmšusFÏg
 ){

101537 
	gzRight
 = 
sql™e3MPrštf
(
db
, "-%T", 
pV®ue
);

101539 
	gzRight
 = 
sql™e3NameFromTok’
(
db
, 
pV®ue
);

101542 
as£¹
Ð
pId2
 );

101543 
	gzDb
 = 
pId2
->
n
>0 ? 
pDb
->
zName
 : 0;

101544 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_PRAGMA
, 
zLeá
, 
zRight
, 
zDb
) ){

101545 
	g´agma_out
;

101552 
	gaFúŽ
[0] = 0;

101553 
	gaFúŽ
[1] = 
zLeá
;

101554 
	gaFúŽ
[2] = 
zRight
;

101555 
	gaFúŽ
[3] = 0;

101556 
	gdb
->
	gbusyHªdËr
.
	gnBusy
 = 0;

101557 
	grc
 = 
sql™e3_fže_cÚŒÞ
(
db
, 
zDb
, 
SQLITE_FCNTL_PRAGMA
, (*)
aFúŽ
);

101558 ifÐ
	grc
==
SQLITE_OK
 ){

101559 ifÐ
aFúŽ
[0] ){

101560 
mem
 = ++
pP¬£
->
nMem
;

101561 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
mem
, 0, 
aFúŽ
[0], 0);

101562 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101563 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "»suÉ", 
SQLITE_STATIC
);

101564 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
mem
, 1);

101565 
sql™e3_ä“
(
aFúŽ
[0]);

101567 
	g´agma_out
;

101569 ifÐ
	grc
!=
SQLITE_NOTFOUND
 ){

101570 ifÐ
aFúŽ
[0] ){

101571 
sql™e3E¼ÜMsg
(
pP¬£
, "%s", 
aFúŽ
[0]);

101572 
sql™e3_ä“
(
aFúŽ
[0]);

101574 
	gpP¬£
->
	gnE¼
++;

101575 
	gpP¬£
->
	grc
 = 
rc
;

101576 
	g´agma_out
;

101580 
	glwr
 = 0;

101581 
	gu´
 = 
A¼aySize
(
aP¿gmaNames
)-1;

101582  
	glwr
<=
u´
 ){

101583 
mid
 = (
lwr
+
u´
)/2;

101584 
	grc
 = 
sql™e3_¡ricmp
(
zLeá
, 
aP¿gmaNames
[
mid
].
zName
);

101585 ifÐ
	grc
==0 ) ;

101586 ifÐ
	grc
<0 ){

101587 
	gu´
 = 
mid
 - 1;

101589 
	glwr
 = 
mid
 + 1;

101592 ifÐ
	glwr
>
	gu´
 ) 
	g´agma_out
;

101595 ifÐ(
	gaP¿gmaNames
[
mid
].
	gmP¿gFÏg
 & 
	gP¿gFÏg_N“dSchema
)!=0 ){

101596 ifÐ
sql™e3R—dSchema
(
pP¬£
èè
´agma_out
;

101600  
	gaP¿gmaNames
[
mid
].
	geP¿gTyp
 ){

101602 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
è&& !defšed(
SQLITE_OMIT_DEPRECATED
)

101619 
	gP¿gTyp_DEFAULT_CACHE_SIZE
: {

101620 cÚ¡ 
iLn
 = 
VDBE_OFFSET_LINENO
(2);

101621 cÚ¡ 
VdbeOpLi¡
 
	gg‘CacheSize
[] = {

101622 { 
OP_T¿n§ùiÚ
, 0, 0, 0},

101623 { 
OP_R—dCook›
, 0, 1, 
BTREE_DEFAULT_CACHE_SIZE
},

101624 { 
OP_IfPos
, 1, 8, 0},

101625 { 
OP_IÁeg”
, 0, 2, 0},

101626 { 
OP_SubŒaù
, 1, 2, 1},

101627 { 
OP_IfPos
, 1, 8, 0},

101628 { 
OP_IÁeg”
, 0, 1, 0},

101629 { 
OP_NoÝ
, 0, 0, 0},

101630 { 
OP_ResuÉRow
, 1, 1, 0},

101632 
	gaddr
;

101633 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

101634 ifÐ!
	gzRight
 ){

101635 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101636 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "ÿche_size", 
SQLITE_STATIC
);

101637 
	gpP¬£
->
	gnMem
 += 2;

101638 
	gaddr
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
g‘CacheSize
), g‘CacheSize,
iLn
);

101639 
sql™e3VdbeChªgeP1
(
v
, 
addr
, 
iDb
);

101640 
sql™e3VdbeChªgeP1
(
v
, 
addr
+1, 
iDb
);

101641 
sql™e3VdbeChªgeP1
(
v
, 
addr
+6, 
SQLITE_DEFAULT_CACHE_SIZE
);

101643 
	gsize
 = 
sql™e3AbsIÁ32
(
sql™e3Atoi
(
zRight
));

101644 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

101645 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
size
, 1);

101646 
sql™e3VdbeAddOp3
(
v
, 
OP_S‘Cook›
, 
iDb
, 
BTREE_DEFAULT_CACHE_SIZE
, 1);

101647 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

101648 
	gpDb
->
	gpSchema
->
	gÿche_size
 = 
size
;

101649 
sql™e3BŒ“S‘CacheSize
(
pDb
->
pBt
,…Db->
pSchema
->
ÿche_size
);

101655 #ià!
defšed
(
SQLITE_OMIT_PAGER_PRAGMAS
)

101665 
	gP¿gTyp_PAGE_SIZE
: {

101666 
BŒ“
 *
pBt
 = 
pDb
->pBt;

101667 
as£¹
Ð
pBt
!=0 );

101668 ifÐ!
	gzRight
 ){

101669 
	gsize
 = 
ALWAYS
(
pBt
è? 
sql™e3BŒ“G‘PageSize
(pBt) : 0;

101670 
»tuºSšgËIÁ
(
pP¬£
, "·ge_size", 
size
);

101675 
	gdb
->
	gÃxtPagesize
 = 
sql™e3Atoi
(
zRight
);

101676 ifÐ
	gSQLITE_NOMEM
==
sql™e3BŒ“S‘PageSize
(
pBt
, 
db
->
ÃxtPagesize
,-1,0) ){

101677 
	gdb
->
	gm®locFažed
 = 1;

101691 
	gP¿gTyp_SECURE_DELETE
: {

101692 
BŒ“
 *
pBt
 = 
pDb
->pBt;

101693 
	gb
 = -1;

101694 
as£¹
Ð
pBt
!=0 );

101695 ifÐ
	gzRight
 ){

101696 
	gb
 = 
sql™e3G‘BoÞ—n
(
zRight
, 0);

101698 ifÐ
	gpId2
->
	gn
==0 && 
b
>=0 ){

101699 
ii
;

101700 
	gii
=0; ii<
	gdb
->
	gnDb
; ii++){

101701 
sql™e3BŒ“Secu»D–‘e
(
db
->
aDb
[
ii
].
pBt
, 
b
);

101704 
	gb
 = 
sql™e3BŒ“Secu»D–‘e
(
pBt
, 
b
);

101705 
»tuºSšgËIÁ
(
pP¬£
, "£cu»_d–‘e", 
b
);

101726 
	gP¿gTyp_PAGE_COUNT
: {

101727 
iReg
;

101728 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

101729 
	giReg
 = ++
pP¬£
->
nMem
;

101730 ifÐ
sql™e3TÞow”
(
zLeá
[0])=='p' ){

101731 
sql™e3VdbeAddOp2
(
v
, 
OP_PagecouÁ
, 
iDb
, 
iReg
);

101733 
sql™e3VdbeAddOp3
(
v
, 
OP_MaxPgút
, 
iDb
, 
iReg
,

101734 
sql™e3AbsIÁ32
(
sql™e3Atoi
(
zRight
)));

101736 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
iReg
, 1);

101737 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101738 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, 
zLeá
, 
SQLITE_TRANSIENT
);

101746 
	gP¿gTyp_LOCKING_MODE
: {

101747 cÚ¡ *
zR‘
 = "normal";

101748 
	geMode
 = 
g‘LockšgMode
(
zRight
);

101750 ifÐ
	gpId2
->
	gn
==0 && 
eMode
==
PAGER_LOCKINGMODE_QUERY
 ){

101755 
eMode
 = 
db
->
dætLockMode
;

101757 
Pag”
 *
	gpPag”
;

101758 ifÐ
	gpId2
->
	gn
==0 ){

101767 
ii
;

101768 
as£¹
(
pDb
==&
db
->
aDb
[0]);

101769 
	gii
=2; ii<
	gdb
->
	gnDb
; ii++){

101770 
	gpPag”
 = 
sql™e3BŒ“Pag”
(
db
->
aDb
[
ii
].
pBt
);

101771 
sql™e3Pag”LockšgMode
(
pPag”
, 
eMode
);

101773 
	gdb
->
	gdætLockMode
 = (
u8
)
eMode
;

101775 
	gpPag”
 = 
sql™e3BŒ“Pag”
(
pDb
->
pBt
);

101776 
	geMode
 = 
sql™e3Pag”LockšgMode
(
pPag”
, 
eMode
);

101779 
as£¹
Ð
eMode
==
PAGER_LOCKINGMODE_NORMAL


101780 || 
eMode
==
PAGER_LOCKINGMODE_EXCLUSIVE
 );

101781 ifÐ
	geMode
==
PAGER_LOCKINGMODE_EXCLUSIVE
 ){

101782 
zR‘
 = "exclusive";

101784 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101785 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "lockšg_mode", 
SQLITE_STATIC
);

101786 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
zR‘
, 0);

101787 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

101796 
	gP¿gTyp_JOURNAL_MODE
: {

101797 
eMode
;

101798 
	gii
;

101800 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

101801 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "jouº®_mode", 
SQLITE_STATIC
);

101803 ifÐ
	gzRight
==0 ){

101806 
eMode
 = 
PAGER_JOURNALMODE_QUERY
;

101808 cÚ¡ *
	gzMode
;

101809 
	gn
 = 
sql™e3SŒËn30
(
zRight
);

101810 
	geMode
=0; (
	gzMode
 = 
sql™e3Jouº®Mod’ame
(
eMode
))!=0;ƒMode++){

101811 ifÐ
sql™e3SŒNICmp
(
zRight
, 
zMode
, 
n
)==0 ) ;

101813 ifÐ!
	gzMode
 ){

101816 
	geMode
 = 
PAGER_JOURNALMODE_QUERY
;

101819 ifÐ
	geMode
==
PAGER_JOURNALMODE_QUERY
 && 
pId2
->
n
==0 ){

101821 
iDb
 = 0;

101822 
	gpId2
->
	gn
 = 1;

101824 
	gii
=
db
->
nDb
-1; ii>=0; ii--){

101825 ifÐ
	gdb
->
	gaDb
[
ii
].
	gpBt
 && (
	gii
==
iDb
 || 
pId2
->
n
==0) ){

101826 
sql™e3VdbeU£sBŒ“
(
v
, 
ii
);

101827 
sql™e3VdbeAddOp3
(
v
, 
OP_Jouº®Mode
, 
ii
, 1, 
eMode
);

101830 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

101840 
	gP¿gTyp_JOURNAL_SIZE_LIMIT
: {

101841 
Pag”
 *
pPag”
 = 
sql™e3BŒ“Pag”
(
pDb
->
pBt
);

101842 
i64
 
	giLim™
 = -2;

101843 ifÐ
	gzRight
 ){

101844 
sql™e3DecOrHexToI64
(
zRight
, &
iLim™
);

101845 ifÐ
	giLim™
<-1 ) iLimit = -1;

101847 
	giLim™
 = 
sql™e3Pag”Jouº®SizeLim™
(
pPag”
, 
iLim™
);

101848 
»tuºSšgËIÁ
(
pP¬£
, "jouº®_size_lim™", 
iLim™
);

101861 #iâdeà
SQLITE_OMIT_AUTOVACUUM


101862 
	gP¿gTyp_AUTO_VACUUM
: {

101863 
BŒ“
 *
pBt
 = 
pDb
->pBt;

101864 
as£¹
Ð
pBt
!=0 );

101865 ifÐ!
	gzRight
 ){

101866 
»tuºSšgËIÁ
(
pP¬£
, "auto_vacuum", 
sql™e3BŒ“G‘AutoVacuum
(
pBt
));

101868 
	geAuto
 = 
g‘AutoVacuum
(
zRight
);

101869 
as£¹
Ð
eAuto
>=0 &&ƒAuto<=2 );

101870 
	gdb
->
	gÃxtAutovac
 = (
u8
)
eAuto
;

101876 
	grc
 = 
sql™e3BŒ“S‘AutoVacuum
(
pBt
, 
eAuto
);

101877 ifÐ
	grc
==
SQLITE_OK
 && (
eAuto
==1 ||ƒAuto==2) ){

101883 cÚ¡ 
iLn
 = 
VDBE_OFFSET_LINENO
(2);

101884 cÚ¡ 
VdbeOpLi¡
 
	g£tM‘a6
[] = {

101885 { 
OP_T¿n§ùiÚ
, 0, 1, 0},

101886 { 
OP_R—dCook›
, 0, 1, 
BTREE_LARGEST_ROOT_PAGE
},

101887 { 
OP_If
, 1, 0, 0},

101888 { 
OP_H®t
, 
SQLITE_OK
, 
OE_AbÜt
, 0},

101889 { 
OP_IÁeg”
, 0, 1, 0},

101890 { 
OP_S‘Cook›
, 0, 
BTREE_INCR_VACUUM
, 1},

101892 
	giAddr
;

101893 
	giAddr
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
£tM‘a6
), s‘M‘a6, 
iLn
);

101894 
sql™e3VdbeChªgeP1
(
v
, 
iAddr
, 
iDb
);

101895 
sql™e3VdbeChªgeP1
(
v
, 
iAddr
+1, 
iDb
);

101896 
sql™e3VdbeChªgeP2
(
v
, 
iAddr
+2, iAddr+4);

101897 
sql™e3VdbeChªgeP1
(
v
, 
iAddr
+4, 
eAuto
-1);

101898 
sql™e3VdbeChªgeP1
(
v
, 
iAddr
+5, 
iDb
);

101899 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

101911 #iâdeà
SQLITE_OMIT_AUTOVACUUM


101912 
	gP¿gTyp_INCREMENTAL_VACUUM
: {

101913 
iLim™
, 
	gaddr
;

101914 ifÐ
	gzRight
==0 || !
sql™e3G‘IÁ32
(
zRight
, &
iLim™
è|| 
	giLim™
<=0 ){

101915 
iLim™
 = 0x7fffffff;

101917 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

101918 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
iLim™
, 1);

101919 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_InüVacuum
, 
iDb
); 
VdbeCov”age
(v);

101920 
sql™e3VdbeAddOp1
(
v
, 
OP_ResuÉRow
, 1);

101921 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 1, -1);

101922 
sql™e3VdbeAddOp2
(
v
, 
OP_IfPos
, 1, 
addr
); 
VdbeCov”age
(v);

101923 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

101928 #iâdeà
SQLITE_OMIT_PAGER_PRAGMAS


101940 
	gP¿gTyp_CACHE_SIZE
: {

101941 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

101942 ifÐ!
	gzRight
 ){

101943 
»tuºSšgËIÁ
(
pP¬£
, "ÿche_size", 
pDb
->
pSchema
->
ÿche_size
);

101945 
	gsize
 = 
sql™e3Atoi
(
zRight
);

101946 
	gpDb
->
	gpSchema
->
	gÿche_size
 = 
size
;

101947 
sql™e3BŒ“S‘CacheSize
(
pDb
->
pBt
,…Db->
pSchema
->
ÿche_size
);

101966 
	gP¿gTyp_MMAP_SIZE
: {

101967 
sql™e3_št64
 
sz
;

101968 #ià
SQLITE_MAX_MMAP_SIZE
>0

101969 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

101970 ifÐ
	gzRight
 ){

101971 
	gii
;

101972 
sql™e3DecOrHexToI64
(
zRight
, &
sz
);

101973 ifÐ
	gsz
<0 ) sz = 
sql™e3Glob®CÚfig
.
szMm­
;

101974 ifÐ
	gpId2
->
	gn
==0 ) 
db
->
szMm­
 = 
sz
;

101975 
	gii
=
db
->
nDb
-1; ii>=0; ii--){

101976 ifÐ
	gdb
->
	gaDb
[
ii
].
	gpBt
 && (
	gii
==
iDb
 || 
pId2
->
n
==0) ){

101977 
sql™e3BŒ“S‘Mm­Lim™
(
db
->
aDb
[
ii
].
pBt
, 
sz
);

101981 
	gsz
 = -1;

101982 
	grc
 = 
sql™e3_fže_cÚŒÞ
(
db
, 
zDb
, 
SQLITE_FCNTL_MMAP_SIZE
, &
sz
);

101984 
	gsz
 = 0;

101985 
	grc
 = 
SQLITE_OK
;

101987 ifÐ
	grc
==
SQLITE_OK
 ){

101988 
»tuºSšgËIÁ
(
pP¬£
, "mm­_size", 
sz
);

101989 }ifÐ
	grc
!=
SQLITE_NOTFOUND
 ){

101990 
pP¬£
->
nE¼
++;

101991 
	gpP¬£
->
	grc
 = 
rc
;

102007 
	gP¿gTyp_TEMP_STORE
: {

102008 ifÐ!
zRight
 ){

102009 
»tuºSšgËIÁ
(
pP¬£
, "‹mp_¡Üe", 
db
->
‹mp_¡Üe
);

102011 
chªgeTempStÜage
(
pP¬£
, 
zRight
);

102026 
	gP¿gTyp_TEMP_STORE_DIRECTORY
: {

102027 ifÐ!
zRight
 ){

102028 ifÐ
sql™e3_‹mp_dœeùÜy
 ){

102029 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102030 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
,

102031 "‹mp_¡Üe_dœeùÜy", 
SQLITE_STATIC
);

102032 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
sql™e3_‹mp_dœeùÜy
, 0);

102033 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

102036 #iâdeà
SQLITE_OMIT_WSD


102037 ifÐ
	gzRight
[0] ){

102038 
	g»s
;

102039 
	grc
 = 
sql™e3OsAcûss
(
db
->
pVfs
, 
zRight
, 
SQLITE_ACCESS_READWRITE
, &
»s
);

102040 ifÐ
	grc
!=
SQLITE_OK
 || 
»s
==0 ){

102041 
sql™e3E¼ÜMsg
(
pP¬£
, "not‡ writable directory");

102042 
	g´agma_out
;

102045 ifÐ
	gSQLITE_TEMP_STORE
==0

102046 || (
SQLITE_TEMP_STORE
==1 && 
db
->
‹mp_¡Üe
<=1)

102047 || (
SQLITE_TEMP_STORE
==2 && 
db
->
‹mp_¡Üe
==1)

102049 
šv®id©eTempStÜage
(
pP¬£
);

102051 
sql™e3_ä“
(
sql™e3_‹mp_dœeùÜy
);

102052 ifÐ
	gzRight
[0] ){

102053 
	gsql™e3_‹mp_dœeùÜy
 = 
sql™e3_m´štf
("%s", 
zRight
);

102055 
	gsql™e3_‹mp_dœeùÜy
 = 0;

102062 #ià
SQLITE_OS_WIN


102076 
	gP¿gTyp_DATA_STORE_DIRECTORY
: {

102077 ifÐ!
zRight
 ){

102078 ifÐ
sql™e3_d©a_dœeùÜy
 ){

102079 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102080 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
,

102081 "d©a_¡Üe_dœeùÜy", 
SQLITE_STATIC
);

102082 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
sql™e3_d©a_dœeùÜy
, 0);

102083 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

102086 #iâdeà
SQLITE_OMIT_WSD


102087 ifÐ
	gzRight
[0] ){

102088 
	g»s
;

102089 
	grc
 = 
sql™e3OsAcûss
(
db
->
pVfs
, 
zRight
, 
SQLITE_ACCESS_READWRITE
, &
»s
);

102090 ifÐ
	grc
!=
SQLITE_OK
 || 
»s
==0 ){

102091 
sql™e3E¼ÜMsg
(
pP¬£
, "not‡ writable directory");

102092 
	g´agma_out
;

102095 
sql™e3_ä“
(
sql™e3_d©a_dœeùÜy
);

102096 ifÐ
	gzRight
[0] ){

102097 
	gsql™e3_d©a_dœeùÜy
 = 
sql™e3_m´štf
("%s", 
zRight
);

102099 
	gsql™e3_d©a_dœeùÜy
 = 0;

102107 #ià
SQLITE_ENABLE_LOCKING_STYLE


102116 
	gP¿gTyp_LOCK_PROXY_FILE
: {

102117 ifÐ!
zRight
 ){

102118 
Pag”
 *
pPag”
 = 
sql™e3BŒ“Pag”
(
pDb
->
pBt
);

102119 *
	g´oxy_fže_·th
 = 
NULL
;

102120 
sql™e3_fže
 *
	gpFže
 = 
sql™e3Pag”Fže
(
pPag”
);

102121 
sql™e3OsFžeCÚŒÞHšt
(
pFže
, 
SQLITE_GET_LOCKPROXYFILE
,

102122 &
´oxy_fže_·th
);

102124 ifÐ
	g´oxy_fže_·th
 ){

102125 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102126 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
,

102127 "lock_´oxy_fže", 
SQLITE_STATIC
);

102128 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
´oxy_fže_·th
, 0);

102129 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

102132 
Pag”
 *
	gpPag”
 = 
sql™e3BŒ“Pag”
(
pDb
->
pBt
);

102133 
sql™e3_fže
 *
	gpFže
 = 
sql™e3Pag”Fže
(
pPag”
);

102134 
	g»s
;

102135 ifÐ
	gzRight
[0] ){

102136 
	g»s
=
sql™e3OsFžeCÚŒÞ
(
pFže
, 
SQLITE_SET_LOCKPROXYFILE
,

102137 
zRight
);

102139 
	g»s
=
sql™e3OsFžeCÚŒÞ
(
pFže
, 
SQLITE_SET_LOCKPROXYFILE
,

102140 
NULL
);

102142 ifÐ
	g»s
!=
SQLITE_OK
 ){

102143 
sql™e3E¼ÜMsg
(
pP¬£
, "failedo set†ock…roxy file");

102144 
	g´agma_out
;

102160 
	gP¿gTyp_SYNCHRONOUS
: {

102161 ifÐ!
zRight
 ){

102162 
»tuºSšgËIÁ
(
pP¬£
, "synchrÚous", 
pDb
->
§ãty_Ëv–
-1);

102164 ifÐ!
	gdb
->
	gautoComm™
 ){

102165 
sql™e3E¼ÜMsg
(
pP¬£
,

102168 
	gpDb
->
	g§ãty_Ëv–
 = 
g‘SaãtyLev–
(
zRight
,0,1)+1;

102169 
£tAÎPag”FÏgs
(
db
);

102176 #iâdeà
SQLITE_OMIT_FLAG_PRAGMAS


102177 
	gP¿gTyp_FLAG
: {

102178 ifÐ
zRight
==0 ){

102179 
»tuºSšgËIÁ
(
pP¬£
, 
aP¿gmaNames
[
mid
].
zName
,

102180 (
db
->
æags
 & 
aP¿gmaNames
[
mid
].
iArg
)!=0 );

102182 
	gmask
 = 
aP¿gmaNames
[
mid
].
iArg
;

102183 ifÐ
	gdb
->
	gautoComm™
==0 ){

102186 
mask
 &ð~(
SQLITE_FÜeignKeys
);

102188 #ià
SQLITE_USER_AUTHENTICATION


102189 ifÐ
	gdb
->
	gauth
.
	gauthLev–
==
UAUTH_U£r
 ){

102191 
mask
 &ð~(
SQLITE_Wr™eSchema
);

102195 ifÐ
sql™e3G‘BoÞ—n
(
zRight
, 0) ){

102196 
	gdb
->
	gæags
 |ð
mask
;

102198 
	gdb
->
	gæags
 &ð~
mask
;

102199 ifÐ
	gmask
==
SQLITE_DeãrFKs
 ) 
db
->
nDeã¼edImmCÚs
 = 0;

102206 
sql™e3VdbeAddOp2
(
v
, 
OP_Expœe
, 0, 0);

102207 
£tAÎPag”FÏgs
(
db
);

102213 #iâdeà
SQLITE_OMIT_SCHEMA_PRAGMAS


102226 
	gP¿gTyp_TABLE_INFO
: ifÐ
zRight
 ){

102227 
TabË
 *
pTab
;

102228 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zRight
, 
zDb
);

102229 ifÐ
	gpTab
 ){

102230 
	gi
, 
	gk
;

102231 
	gnHidd’
 = 0;

102232 
CÞumn
 *
	gpCÞ
;

102233 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

102234 
sql™e3VdbeS‘NumCÞs
(
v
, 6);

102235 
	gpP¬£
->
	gnMem
 = 6;

102236 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102237 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "cid", 
SQLITE_STATIC
);

102238 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "Çme", 
SQLITE_STATIC
);

102239 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "ty³", 
SQLITE_STATIC
);

102240 
sql™e3VdbeS‘CÞName
(
v
, 3, 
COLNAME_NAME
, "nÙnuÎ", 
SQLITE_STATIC
);

102241 
sql™e3VdbeS‘CÞName
(
v
, 4, 
COLNAME_NAME
, "dæt_v®ue", 
SQLITE_STATIC
);

102242 
sql™e3VdbeS‘CÞName
(
v
, 5, 
COLNAME_NAME
, "pk", 
SQLITE_STATIC
);

102243 
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
);

102244 
	gi
=0, 
	gpCÞ
=
pTab
->
aCÞ
; i<
	gpTab
->
	gnCÞ
; i++,…Col++){

102245 ifÐ
IsHidd’CÞumn
(
pCÞ
) ){

102246 
	gnHidd’
++;

102249 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
-
nHidd’
, 1);

102250 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
pCÞ
->
zName
, 0);

102251 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0,

102252 
pCÞ
->
zTy³
 ?…Col->zType : "", 0);

102253 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, (
pCÞ
->
nÙNuÎ
 ? 1 : 0), 4);

102254 ifÐ
	gpCÞ
->
	gzDæt
 ){

102255 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 5, 0, (*)
pCÞ
->
zDæt
, 0);

102257 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 5);

102259 ifÐ(
	gpCÞ
->
	gcÞFÏgs
 & 
	gCOLFLAG_PRIMKEY
)==0 ){

102260 
k
 = 0;

102261 }ifÐ
	gpPk
==0 ){

102262 
k
 = 1;

102264 
	gk
=1; 
ALWAYS
(
k
<=
pTab
->
nCÞ
è&& 
pPk
->
aiCÞumn
[k-1]!=
i
; k++){}

102266 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
k
, 6);

102267 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 6);

102273 
	gP¿gTyp_STATS
: {

102274 
Index
 *
pIdx
;

102275 
HashEËm
 *
	gi
;

102276 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

102277 
sql™e3VdbeS‘NumCÞs
(
v
, 4);

102278 
	gpP¬£
->
	gnMem
 = 4;

102279 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102280 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "bË", 
SQLITE_STATIC
);

102281 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "šdex", 
SQLITE_STATIC
);

102282 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "width", 
SQLITE_STATIC
);

102283 
sql™e3VdbeS‘CÞName
(
v
, 3, 
COLNAME_NAME
, "height", 
SQLITE_STATIC
);

102284 
	gi
=
sql™eHashFœ¡
(&
pDb
->
pSchema
->
tblHash
); i; i=
sql™eHashNext
(
i
)){

102285 
TabË
 *
pTab
 = 
sql™eHashD©a
(
i
);

102286 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
pTab
->
zName
, 0);

102287 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 2);

102288 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
,

102289 ()
sql™e3LogE¡ToIÁ
(
pTab
->
szTabRow
), 3);

102290 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
,

102291 ()
sql™e3LogE¡ToIÁ
(
pTab
->
nRowLogE¡
), 4);

102292 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 4);

102293 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

102294 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
pIdx
->
zName
, 0);

102295 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
,

102296 ()
sql™e3LogE¡ToIÁ
(
pIdx
->
szIdxRow
), 3);

102297 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
,

102298 ()
sql™e3LogE¡ToIÁ
(
pIdx
->
aiRowLogE¡
[0]), 4);

102299 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 4);

102305 
	gP¿gTyp_INDEX_INFO
: ifÐ
zRight
 ){

102306 
Index
 *
pIdx
;

102307 
TabË
 *
	gpTab
;

102308 
	gpIdx
 = 
sql™e3FšdIndex
(
db
, 
zRight
, 
zDb
);

102309 ifÐ
	gpIdx
 ){

102310 
	gi
;

102311 
	gpTab
 = 
pIdx
->
pTabË
;

102312 
sql™e3VdbeS‘NumCÞs
(
v
, 3);

102313 
	gpP¬£
->
	gnMem
 = 3;

102314 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102315 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "£qno", 
SQLITE_STATIC
);

102316 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "cid", 
SQLITE_STATIC
);

102317 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "Çme", 
SQLITE_STATIC
);

102318 
	gi
=0; i<
	gpIdx
->
	gnKeyCÞ
; i++){

102319 
i16
 
	gúum
 = 
pIdx
->
aiCÞumn
[
i
];

102320 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 1);

102321 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
úum
, 2);

102322 
as£¹
Ð
pTab
->
nCÞ
>
úum
 );

102323 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0, 
pTab
->
aCÞ
[
úum
].
zName
, 0);

102324 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 3);

102330 
	gP¿gTyp_INDEX_LIST
: ifÐ
zRight
 ){

102331 
Index
 *
pIdx
;

102332 
TabË
 *
	gpTab
;

102333 
	gi
;

102334 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zRight
, 
zDb
);

102335 ifÐ
	gpTab
 ){

102336 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

102337 
sql™e3VdbeS‘NumCÞs
(
v
, 3);

102338 
	gpP¬£
->
	gnMem
 = 3;

102339 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102340 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "£q", 
SQLITE_STATIC
);

102341 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "Çme", 
SQLITE_STATIC
);

102342 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "unique", 
SQLITE_STATIC
);

102343 
	gpIdx
=
pTab
->
pIndex
, 
	gi
=0;…Idx;…Idx=
pIdx
->
pNext
, i++){

102344 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 1);

102345 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
pIdx
->
zName
, 0);

102346 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
IsUniqueIndex
(
pIdx
), 3);

102347 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 3);

102353 
	gP¿gTyp_DATABASE_LIST
: {

102354 
i
;

102355 
sql™e3VdbeS‘NumCÞs
(
v
, 3);

102356 
	gpP¬£
->
	gnMem
 = 3;

102357 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "£q", 
SQLITE_STATIC
);

102358 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "Çme", 
SQLITE_STATIC
);

102359 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "fže", 
SQLITE_STATIC
);

102360 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

102361 ifÐ
	gdb
->
	gaDb
[
i
].
	gpBt
==0 ) ;

102362 
as£¹
Ð
db
->
aDb
[
i
].
zName
!=0 );

102363 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 1);

102364 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
db
->
aDb
[
i
].
zName
, 0);

102365 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0,

102366 
sql™e3BŒ“G‘Fž’ame
(
db
->
aDb
[
i
].
pBt
), 0);

102367 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 3);

102372 
	gP¿gTyp_COLLATION_LIST
: {

102373 
i
 = 0;

102374 
HashEËm
 *
	gp
;

102375 
sql™e3VdbeS‘NumCÞs
(
v
, 2);

102376 
	gpP¬£
->
	gnMem
 = 2;

102377 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "£q", 
SQLITE_STATIC
);

102378 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "Çme", 
SQLITE_STATIC
);

102379 
	gp
=
sql™eHashFœ¡
(&
db
->
aCÞlSeq
);…;…=
sql™eHashNext
(
p
)){

102380 
CÞlSeq
 *
pCÞl
 = (CÞlSeq *)
sql™eHashD©a
(
p
);

102381 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
++, 1);

102382 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
pCÞl
->
zName
, 0);

102383 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 2);

102389 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


102390 
	gP¿gTyp_FOREIGN_KEY_LIST
: ifÐ
zRight
 ){

102391 
FKey
 *
pFK
;

102392 
TabË
 *
	gpTab
;

102393 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zRight
, 
zDb
);

102394 ifÐ
	gpTab
 ){

102395 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

102396 
	gpFK
 = 
pTab
->
pFKey
;

102397 ifÐ
	gpFK
 ){

102398 
	gi
 = 0;

102399 
sql™e3VdbeS‘NumCÞs
(
v
, 8);

102400 
	gpP¬£
->
	gnMem
 = 8;

102401 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102402 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "id", 
SQLITE_STATIC
);

102403 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "£q", 
SQLITE_STATIC
);

102404 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "bË", 
SQLITE_STATIC
);

102405 
sql™e3VdbeS‘CÞName
(
v
, 3, 
COLNAME_NAME
, "äom", 
SQLITE_STATIC
);

102406 
sql™e3VdbeS‘CÞName
(
v
, 4, 
COLNAME_NAME
, "to", 
SQLITE_STATIC
);

102407 
sql™e3VdbeS‘CÞName
(
v
, 5, 
COLNAME_NAME
, "Ú_upd©e", 
SQLITE_STATIC
);

102408 
sql™e3VdbeS‘CÞName
(
v
, 6, 
COLNAME_NAME
, "Ú_d–‘e", 
SQLITE_STATIC
);

102409 
sql™e3VdbeS‘CÞName
(
v
, 7, 
COLNAME_NAME
, "m©ch", 
SQLITE_STATIC
);

102410 
	gpFK
){

102411 
	gj
;

102412 
	gj
=0; j<
	gpFK
->
	gnCÞ
; j++){

102413 *
	gzCÞ
 = 
pFK
->
aCÞ
[
j
].
zCÞ
;

102414 *
	gzOnD–‘e
 = (*)
aùiÚName
(
pFK
->
aAùiÚ
[0]);

102415 *
	gzOnUpd©e
 = (*)
aùiÚName
(
pFK
->
aAùiÚ
[1]);

102416 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
, 1);

102417 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
j
, 2);

102418 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0, 
pFK
->
zTo
, 0);

102419 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 4, 0,

102420 
pTab
->
aCÞ
[
pFK
->aCÞ[
j
].
iFrom
].
zName
, 0);

102421 
sql™e3VdbeAddOp4
(
v
, 
zCÞ
 ? 
OP_SŒšg8
 : 
OP_NuÎ
, 0, 5, 0, zCol, 0);

102422 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 6, 0, 
zOnUpd©e
, 0);

102423 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 7, 0, 
zOnD–‘e
, 0);

102424 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 8, 0, "NONE", 0);

102425 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 8);

102427 ++
	gi
;

102428 
	gpFK
 = 
pFK
->
pNextFrom
;

102436 #iâdeà
SQLITE_OMIT_FOREIGN_KEY


102437 #iâdeà
SQLITE_OMIT_TRIGGER


102438 
	gP¿gTyp_FOREIGN_KEY_CHECK
: {

102439 
FKey
 *
pFK
;

102440 
TabË
 *
	gpTab
;

102441 
TabË
 *
	gpP¬’t
;

102442 
Index
 *
	gpIdx
;

102443 
	gi
;

102444 
	gj
;

102445 
HashEËm
 *
	gk
;

102446 
	gx
;

102447 
	g»gResuÉ
;

102448 
	g»gKey
;

102449 
	g»gRow
;

102450 
	gaddrTÝ
;

102451 
	gaddrOk
;

102452 *
	gaiCÞs
;

102454 
	g»gResuÉ
 = 
pP¬£
->
nMem
+1;

102455 
	gpP¬£
->
	gnMem
 += 4;

102456 
	g»gKey
 = ++
pP¬£
->
nMem
;

102457 
	g»gRow
 = ++
pP¬£
->
nMem
;

102458 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

102459 
sql™e3VdbeS‘NumCÞs
(
v
, 4);

102460 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "bË", 
SQLITE_STATIC
);

102461 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "rowid", 
SQLITE_STATIC
);

102462 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "·»Á", 
SQLITE_STATIC
);

102463 
sql™e3VdbeS‘CÞName
(
v
, 3, 
COLNAME_NAME
, "fkid", 
SQLITE_STATIC
);

102464 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

102465 
	gk
 = 
sql™eHashFœ¡
(&
db
->
aDb
[
iDb
].
pSchema
->
tblHash
);

102466  
	gk
 ){

102467 ifÐ
	gzRight
 ){

102468 
	gpTab
 = 
sql™e3Loÿ‹TabË
(
pP¬£
, 0, 
zRight
, 
zDb
);

102469 
	gk
 = 0;

102471 
	gpTab
 = (
TabË
*)
sql™eHashD©a
(
k
);

102472 
	gk
 = 
sql™eHashNext
(
k
);

102474 ifÐ
	gpTab
==0 || 
pTab
->
pFKey
==0 ) ;

102475 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 0,…Tab->
zName
);

102476 ifÐ
	gpTab
->
	gnCÞ
+
	g»gRow
>
	gpP¬£
->
	gnMem
 )…P¬£->nMem = 
pTab
->
nCÞ
 + 
»gRow
;

102477 
sql™e3O³nTabË
(
pP¬£
, 0, 
iDb
, 
pTab
, 
OP_O³nR—d
);

102478 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
»gResuÉ
, 0, 
pTab
->
zName
,

102479 
P4_TRANSIENT
);

102480 
	gi
=1, 
	gpFK
=
pTab
->
pFKey
;…FK; i++,…FK=
pFK
->
pNextFrom
){

102481 
pP¬’t
 = 
sql™e3FšdTabË
(
db
, 
pFK
->
zTo
, 
zDb
);

102482 ifÐ
	gpP¬’t
==0 ) ;

102483 
	gpIdx
 = 0;

102484 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pP¬’t
->
Šum
, 0,…P¬’t->
zName
);

102485 
	gx
 = 
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pP¬’t
, 
pFK
, &
pIdx
, 0);

102486 ifÐ
	gx
==0 ){

102487 ifÐ
pIdx
==0 ){

102488 
sql™e3O³nTabË
(
pP¬£
, 
i
, 
iDb
, 
pP¬’t
, 
OP_O³nR—d
);

102490 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nR—d
, 
i
, 
pIdx
->
Šum
, 
iDb
);

102491 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

102494 
	gk
 = 0;

102498 
as£¹
Ð
pP¬£
->
nE¼
>0 || 
pFK
==0 );

102499 ifÐ
	gpFK
 ) ;

102500 ifÐ
	gpP¬£
->
	gnTab
<
	gi
 )…P¬£->nTab = 
i
;

102501 
	gaddrTÝ
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 0); 
VdbeCov”age
(v);

102502 
	gi
=1, 
	gpFK
=
pTab
->
pFKey
;…FK; i++,…FK=
pFK
->
pNextFrom
){

102503 
pP¬’t
 = 
sql™e3FšdTabË
(
db
, 
pFK
->
zTo
, 
zDb
);

102504 
	gpIdx
 = 0;

102505 
	gaiCÞs
 = 0;

102506 ifÐ
	gpP¬’t
 ){

102507 
	gx
 = 
sql™e3FkLoÿ‹Index
(
pP¬£
, 
pP¬’t
, 
pFK
, &
pIdx
, &
aiCÞs
);

102508 
as£¹
Ð
x
==0 );

102510 
	gaddrOk
 = 
sql™e3VdbeMakeLab–
(
v
);

102511 ifÐ
	gpP¬’t
 && 
	gpIdx
==0 ){

102512 
iKey
 = 
pFK
->
aCÞ
[0].
iFrom
;

102513 
as£¹
Ð
iKey
>=0 && iKey<
pTab
->
nCÞ
 );

102514 ifÐ
	giKey
!=
pTab
->
iPKey
 ){

102515 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 0, 
iKey
, 
»gRow
);

102516 
sql™e3CÞumnDeçuÉ
(
v
, 
pTab
, 
iKey
, 
»gRow
);

102517 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gRow
, 
addrOk
); 
VdbeCov”age
(v);

102518 
sql™e3VdbeAddOp2
(
v
, 
OP_Mu¡BeIÁ
, 
»gRow
,

102519 
sql™e3VdbeCu¼’tAddr
(
v
)+3); 
VdbeCov”age
(v);

102521 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 0, 
»gRow
);

102523 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
i
, 0, 
»gRow
); 
VdbeCov”age
(v);

102524 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrOk
);

102525 
sql™e3VdbeJumpH”e
(
v
, 
sql™e3VdbeCu¼’tAddr
(v)-2);

102527 
	gj
=0; j<
	gpFK
->
	gnCÞ
; j++){

102528 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 0,

102529 
aiCÞs
 ?‡iCÞs[
j
] : 
pFK
->
aCÞ
[j].
iFrom
, 
»gRow
+j);

102530 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gRow
+
j
, 
addrOk
); 
VdbeCov”age
(v);

102532 ifÐ
	gpP¬’t
 ){

102533 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gRow
, 
pFK
->
nCÞ
, 
»gKey
,

102534 
sql™e3IndexAffš™ySŒ
(
v
,
pIdx
), 
pFK
->
nCÞ
);

102535 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
i
, 
addrOk
, 
»gKey
, 0);

102536 
VdbeCov”age
(
v
);

102539 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 0, 
»gResuÉ
+1);

102540 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 
»gResuÉ
+2, 0,

102541 
pFK
->
zTo
, 
P4_TRANSIENT
);

102542 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
i
-1, 
»gResuÉ
+3);

102543 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
»gResuÉ
, 4);

102544 
sql™e3VdbeResÞveLab–
(
v
, 
addrOk
);

102545 
sql™e3DbF»e
(
db
, 
aiCÞs
);

102547 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 0, 
addrTÝ
+1); 
VdbeCov”age
(v);

102548 
sql™e3VdbeJumpH”e
(
v
, 
addrTÝ
);

102555 #iâdeà
NDEBUG


102556 
	gP¿gTyp_PARSER_TRACE
: {

102557 ifÐ
zRight
 ){

102558 ifÐ
sql™e3G‘BoÞ—n
(
zRight
, 0) ){

102559 
sql™e3P¬£rT¿û
(
¡d”r
, "parser: ");

102561 
sql™e3P¬£rT¿û
(0, 0);

102571 
	gP¿gTyp_CASE_SENSITIVE_LIKE
: {

102572 ifÐ
zRight
 ){

102573 
sql™e3Regi¡”LikeFunùiÚs
(
db
, 
sql™e3G‘BoÞ—n
(
zRight
, 0));

102578 #iâdeà
SQLITE_INTEGRITY_CHECK_ERROR_MAX


102579 
	#SQLITE_INTEGRITY_CHECK_ERROR_MAX
 100

	)

102582 #iâdeà
SQLITE_OMIT_INTEGRITY_CHECK


102587 
	gP¿gTyp_INTEGRITY_CHECK
: {

102588 
i
, 
	gj
, 
	gaddr
, 
	gmxE¼
;

102594 cÚ¡ 
	giLn
 = 
VDBE_OFFSET_LINENO
(2);

102595 cÚ¡ 
VdbeOpLi¡
 
	g’dCode
[] = {

102596 { 
OP_IfNeg
, 1, 0, 0},

102597 { 
OP_SŒšg8
, 0, 3, 0},

102598 { 
OP_ResuÉRow
, 3, 1, 0},

102601 
	gisQuick
 = (
sql™e3TÞow”
(
zLeá
[0])=='q');

102612 
as£¹
Ð
iDb
>=0 );

102613 
as£¹
Ð
iDb
==0 || 
pId2
->
z
 );

102614 ifÐ
	gpId2
->
	gz
==0 ) 
iDb
 = -1;

102617 
	gpP¬£
->
	gnMem
 = 6;

102618 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102619 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "š‹gr™y_check", 
SQLITE_STATIC
);

102622 
	gmxE¼
 = 
SQLITE_INTEGRITY_CHECK_ERROR_MAX
;

102623 ifÐ
	gzRight
 ){

102624 
sql™e3G‘IÁ32
(
zRight
, &
mxE¼
);

102625 ifÐ
	gmxE¼
<=0 ){

102626 
mxE¼
 = 
SQLITE_INTEGRITY_CHECK_ERROR_MAX
;

102629 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
mxE¼
, 1);

102632 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

102633 
HashEËm
 *
	gx
;

102634 
Hash
 *
	gpTbls
;

102635 
	gút
 = 0;

102637 ifÐ
	gOMIT_TEMPDB
 && 
	gi
==1 ) ;

102638 ifÐ
	giDb
>=0 && 
i
!=
iDb
 ) ;

102640 
sql™e3CodeV”ifySchema
(
pP¬£
, 
i
);

102641 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 1);

102642 
VdbeCov”age
(
v
);

102643 
sql™e3VdbeAddOp2
(
v
, 
OP_H®t
, 0, 0);

102644 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

102651 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
i
, 0) );

102652 
	gpTbls
 = &
db
->
aDb
[
i
].
pSchema
->
tblHash
;

102653 
	gx
=
sql™eHashFœ¡
(
pTbls
); x; x=
sql™eHashNext
(
x
)){

102654 
TabË
 *
pTab
 = 
sql™eHashD©a
(
x
);

102655 
Index
 *
	gpIdx
;

102656 ifÐ
HasRowid
(
pTab
) ){

102657 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
pTab
->
Šum
, 2+
út
);

102658 
VdbeComm’t
((
v
, "%s", 
pTab
->
zName
));

102659 
	gút
++;

102661 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

102662 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
pIdx
->
Šum
, 2+
út
);

102663 
VdbeComm’t
((
v
, "%s", 
pIdx
->
zName
));

102664 
	gút
++;

102669 
	gpP¬£
->
	gnMem
 = 
MAX
Ð
pP¬£
->
nMem
, 
út
+8 );

102672 
sql™e3VdbeAddOp3
(
v
, 
OP_IÁegr™yCk
, 2, 
út
, 1);

102673 
sql™e3VdbeChªgeP5
(
v
, (
u8
)
i
);

102674 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IsNuÎ
, 2); 
VdbeCov”age
(v);

102675 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0,

102676 
sql™e3MPrštf
(
db
, "*** iÀd©aba£ % ***\n", db->
aDb
[
i
].
zName
),

102677 
P4_DYNAMIC
);

102678 
sql™e3VdbeAddOp3
(
v
, 
OP_Move
, 2, 4, 1);

102679 
sql™e3VdbeAddOp3
(
v
, 
OP_CÚÿt
, 4, 3, 2);

102680 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 2, 1);

102681 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

102685 
	gx
=
sql™eHashFœ¡
(
pTbls
); x && !
	gisQuick
; x=
sql™eHashNext
(
x
)){

102686 
TabË
 *
pTab
 = 
sql™eHashD©a
(
x
);

102687 
Index
 *
	gpIdx
, *
	gpPk
;

102688 
Index
 *
	gpPriÜ
 = 0;

102689 
	gloÝTÝ
;

102690 
	giD©aCur
, 
	giIdxCur
;

102691 
	gr1
 = -1;

102693 ifÐ
	gpTab
->
	gpIndex
==0 ) ;

102694 
	gpPk
 = 
HasRowid
(
pTab
è? 0 : 
sql™e3Prim¬yKeyIndex
(pTab);

102695 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 1);

102696 
VdbeCov”age
(
v
);

102697 
sql™e3VdbeAddOp2
(
v
, 
OP_H®t
, 0, 0);

102698 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

102699 
sql™e3Ex´CacheCË¬
(
pP¬£
);

102700 
sql™e3O³nTabËAndIndiûs
(
pP¬£
, 
pTab
, 
OP_O³nR—d
,

102701 1, 0, &
iD©aCur
, &
iIdxCur
);

102702 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 7);

102703 
	gj
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, j++){

102704 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 8+
j
);

102706 
	gpP¬£
->
	gnMem
 = 
MAX
(
pP¬£
->
nMem
, 8+
j
);

102707 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iD©aCur
, 0); 
VdbeCov”age
(v);

102708 
	gloÝTÝ
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 7, 1);

102710 
	gj
=0; j<
	gpTab
->
	gnCÞ
; j++){

102711 *
	gzE¼
;

102712 
	gjmp2
, 
	gjmp3
;

102713 ifÐ
	gj
==
pTab
->
iPKey
 ) ;

102714 ifÐ
	gpTab
->
	gaCÞ
[
j
].
	gnÙNuÎ
==0 ) ;

102715 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
j
, 3);

102716 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_TYPEOFARG
);

102717 
	gjmp2
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_NÙNuÎ
, 3); 
VdbeCov”age
(v);

102718 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 1, -1);

102719 
	gzE¼
 = 
sql™e3MPrštf
(
db
, "NULL v®uš %s.%s", 
pTab
->
zName
,

102720 
pTab
->
aCÞ
[
j
].
zName
);

102721 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0, 
zE¼
, 
P4_DYNAMIC
);

102722 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 3, 1);

102723 
	gjmp3
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 1); 
VdbeCov”age
(v);

102724 
sql™e3VdbeAddOp0
(
v
, 
OP_H®t
);

102725 
sql™e3VdbeJumpH”e
(
v
, 
jmp2
);

102726 
sql™e3VdbeJumpH”e
(
v
, 
jmp3
);

102729 
	gj
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, j++){

102730 
	gjmp2
, 
	gjmp3
, 
	gjmp4
, 
	gjmp5
;

102731 
	gckUniq
 = 
sql™e3VdbeMakeLab–
(
v
);

102732 ifÐ
	gpPk
==
pIdx
 ) ;

102733 
	gr1
 = 
sql™e3G’”©eIndexKey
(
pP¬£
, 
pIdx
, 
iD©aCur
, 0, 0, &
jmp3
,

102734 
pPriÜ
, 
r1
);

102735 
	gpPriÜ
 = 
pIdx
;

102736 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 8+
j
, 1);

102738 
	gjmp2
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
iIdxCur
+
j
, 
ckUniq
, 
r1
,

102739 
pIdx
->
nCÞumn
); 
VdbeCov”age
(
v
);

102740 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 1, -1);

102741 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0, "row ", 
P4_STATIC
);

102742 
sql™e3VdbeAddOp3
(
v
, 
OP_CÚÿt
, 7, 3, 3);

102743 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 4, 0,

102744 " missšg from index ", 
P4_STATIC
);

102745 
sql™e3VdbeAddOp3
(
v
, 
OP_CÚÿt
, 4, 3, 3);

102746 
	gjmp5
 = 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 4, 0,

102747 
pIdx
->
zName
, 
P4_TRANSIENT
);

102748 
sql™e3VdbeAddOp3
(
v
, 
OP_CÚÿt
, 4, 3, 3);

102749 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 3, 1);

102750 
	gjmp4
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 1); 
VdbeCov”age
(v);

102751 
sql™e3VdbeAddOp0
(
v
, 
OP_H®t
);

102752 
sql™e3VdbeJumpH”e
(
v
, 
jmp2
);

102756 ifÐ
IsUniqueIndex
(
pIdx
) ){

102757 
	guniqOk
 = 
sql™e3VdbeMakeLab–
(
v
);

102758 
	gjmp6
;

102759 
	gkk
;

102760 
	gkk
=0; kk<
	gpIdx
->
	gnKeyCÞ
; kk++){

102761 
	giCÞ
 = 
pIdx
->
aiCÞumn
[
kk
];

102762 
as£¹
Ð
iCÞ
>=0 && iCÞ<
pTab
->
nCÞ
 );

102763 ifÐ
	gpTab
->
	gaCÞ
[
iCÞ
].
	gnÙNuÎ
 ) ;

102764 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
r1
+
kk
, 
uniqOk
);

102765 
VdbeCov”age
(
v
);

102767 
	gjmp6
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Next
, 
iIdxCur
+
j
); 
VdbeCov”age
(v);

102768 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
uniqOk
);

102769 
sql™e3VdbeJumpH”e
(
v
, 
jmp6
);

102770 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_IdxGT
, 
iIdxCur
+
j
, 
uniqOk
, 
r1
,

102771 
pIdx
->
nKeyCÞ
); 
VdbeCov”age
(
v
);

102772 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 1, -1);

102773 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0,

102774 "nÚ-uniqu’Œy iÀšdex ", 
P4_STATIC
);

102775 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
jmp5
);

102776 
sql™e3VdbeResÞveLab–
(
v
, 
uniqOk
);

102778 
sql™e3VdbeJumpH”e
(
v
, 
jmp4
);

102779 
sql™e3ResÞveP¬tIdxLab–
(
pP¬£
, 
jmp3
);

102781 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iD©aCur
, 
loÝTÝ
); 
VdbeCov”age
(v);

102782 
sql™e3VdbeJumpH”e
(
v
, 
loÝTÝ
-1);

102783 #iâdeà
SQLITE_OMIT_BTREECOUNT


102784 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0,

102785 "wrÚg # oà’Œ› š index ", 
P4_STATIC
);

102786 
	gj
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, j++){

102787 ifÐ
	gpPk
==
pIdx
 ) ;

102788 
	gaddr
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

102789 
sql™e3VdbeAddOp2
(
v
, 
OP_IfPos
, 1, 
addr
+2); 
VdbeCov”age
(v);

102790 
sql™e3VdbeAddOp2
(
v
, 
OP_H®t
, 0, 0);

102791 
sql™e3VdbeAddOp2
(
v
, 
OP_CouÁ
, 
iIdxCur
+
j
, 3);

102792 
sql™e3VdbeAddOp3
(
v
, 
OP_Eq
, 8+
j
, 
addr
+8, 3); 
VdbeCov”age
(v);

102793 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NOTNULL
);

102794 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 1, -1);

102795 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 3, 0, 
pIdx
->
zName
, 
P4_TRANSIENT
);

102796 
sql™e3VdbeAddOp3
(
v
, 
OP_CÚÿt
, 3, 2, 7);

102797 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 7, 1);

102802 
	gaddr
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
’dCode
),ƒndCode, 
iLn
);

102803 
sql™e3VdbeChªgeP3
(
v
, 
addr
, -
mxE¼
);

102804 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

102805 
sql™e3VdbeChªgeP4
(
v
, 
addr
+1, "ok", 
P4_STATIC
);

102810 #iâdeà
SQLITE_OMIT_UTF16


102833 
	gP¿gTyp_ENCODING
: {

102834 cÚ¡ 
	sEncName
 {

102835 *
zName
;

102836 
u8
 
	g’c
;

102837 } 
	g’úames
[] = {

102838 { "UTF8", 
SQLITE_UTF8
 },

102839 { "UTF-8", 
SQLITE_UTF8
 },

102840 { "UTF-16Ë", 
SQLITE_UTF16LE
 },

102841 { "UTF-16be", 
SQLITE_UTF16BE
 },

102842 { "UTF16Ë", 
SQLITE_UTF16LE
 },

102843 { "UTF16be", 
SQLITE_UTF16BE
 },

102848 cÚ¡ 
EncName
 *
	gpEnc
;

102849 ifÐ!
	gzRight
 ){

102850 ifÐ
sql™e3R—dSchema
(
pP¬£
èè
	g´agma_out
;

102851 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102852 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "’codšg", 
SQLITE_STATIC
);

102853 
sql™e3VdbeAddOp2
(
v
, 
OP_SŒšg8
, 0, 1);

102854 
as£¹
Ð
’úames
[
SQLITE_UTF8
].
’c
==SQLITE_UTF8 );

102855 
as£¹
Ð
’úames
[
SQLITE_UTF16LE
].
’c
==SQLITE_UTF16LE );

102856 
as£¹
Ð
’úames
[
SQLITE_UTF16BE
].
’c
==SQLITE_UTF16BE );

102857 
sql™e3VdbeChªgeP4
(
v
, -1, 
’úames
[
ENC
(
pP¬£
->
db
)].
zName
, 
P4_STATIC
);

102858 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

102866 !(
DbHasPrÝ”ty
(
db
, 0, 
DB_SchemaLßded
)) ||

102867 
DbHasPrÝ”ty
(
db
, 0, 
DB_Em±y
)

102869 
	gpEnc
=&
’úames
[0];…Enc->
	gzName
;…Enc++){

102870 ifÐ0==
sql™e3SŒICmp
(
zRight
, 
pEnc
->
zName
) ){

102871 
ENC
(
pP¬£
->
db
èð
pEnc
->
’c
 ?…Enc->’ø: 
SQLITE_UTF16NATIVE
;

102875 ifÐ!
	gpEnc
->
	gzName
 ){

102876 
sql™e3E¼ÜMsg
(
pP¬£
, "unsuµÜ‹dƒncodšg: %s", 
zRight
);

102884 #iâdeà
SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS


102915 
	gP¿gTyp_HEADER_VALUE
: {

102916 
iCook›
;

102917 
sql™e3VdbeU£sBŒ“
(
v
, 
iDb
);

102918  
	gzLeá
[0] ){

102920 
iCook›
 = 
BTREE_APPLICATION_ID
;

102923 
iCook›
 = 
BTREE_FREE_PAGE_COUNT
;

102926 
iCook›
 = 
BTREE_SCHEMA_VERSION
;

102929 
iCook›
 = 
BTREE_USER_VERSION
;

102933 ifÐ
	gzRight
 && 
	giCook›
!=
BTREE_FREE_PAGE_COUNT
 ){

102935 cÚ¡ 
VdbeOpLi¡
 
£tCook›
[] = {

102936 { 
OP_T¿n§ùiÚ
, 0, 1, 0},

102937 { 
OP_IÁeg”
, 0, 1, 0},

102938 { 
OP_S‘Cook›
, 0, 0, 1},

102940 
	gaddr
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
£tCook›
), setCookie, 0);

102941 
sql™e3VdbeChªgeP1
(
v
, 
addr
, 
iDb
);

102942 
sql™e3VdbeChªgeP1
(
v
, 
addr
+1, 
sql™e3Atoi
(
zRight
));

102943 
sql™e3VdbeChªgeP1
(
v
, 
addr
+2, 
iDb
);

102944 
sql™e3VdbeChªgeP2
(
v
, 
addr
+2, 
iCook›
);

102947 cÚ¡ 
VdbeOpLi¡
 
	g»adCook›
[] = {

102948 { 
OP_T¿n§ùiÚ
, 0, 0, 0},

102949 { 
OP_R—dCook›
, 0, 1, 0},

102950 { 
OP_ResuÉRow
, 1, 1, 0}

102952 
	gaddr
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
»adCook›
),„eadCookie, 0);

102953 
sql™e3VdbeChªgeP1
(
v
, 
addr
, 
iDb
);

102954 
sql™e3VdbeChªgeP1
(
v
, 
addr
+1, 
iDb
);

102955 
sql™e3VdbeChªgeP3
(
v
, 
addr
+1, 
iCook›
);

102956 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102957 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, 
zLeá
, 
SQLITE_TRANSIENT
);

102963 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


102970 
	gP¿gTyp_COMPILE_OPTIONS
: {

102971 
i
 = 0;

102972 cÚ¡ *
	gzO±
;

102973 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

102974 
	gpP¬£
->
	gnMem
 = 1;

102975 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "compže_ÝtiÚ", 
SQLITE_STATIC
);

102976  (
	gzO±
 = 
sql™e3_compžeÝtiÚ_g‘
(
i
++))!=0 ){

102977 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
zO±
, 0);

102978 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 1);

102984 #iâdeà
SQLITE_OMIT_WAL


102990 
	gP¿gTyp_WAL_CHECKPOINT
: {

102991 
iBt
 = (
pId2
->
z
?
iDb
:
SQLITE_MAX_ATTACHED
);

102992 
	geMode
 = 
SQLITE_CHECKPOINT_PASSIVE
;

102993 ifÐ
	gzRight
 ){

102994 ifÐ
sql™e3SŒICmp
(
zRight
, "full")==0 ){

102995 
eMode
 = 
SQLITE_CHECKPOINT_FULL
;

102996 }ifÐ
sql™e3SŒICmp
(
zRight
, "restart")==0 ){

102997 
eMode
 = 
SQLITE_CHECKPOINT_RESTART
;

103000 
sql™e3VdbeS‘NumCÞs
(
v
, 3);

103001 
	gpP¬£
->
	gnMem
 = 3;

103002 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "busy", 
SQLITE_STATIC
);

103003 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "log", 
SQLITE_STATIC
);

103004 
sql™e3VdbeS‘CÞName
(
v
, 2, 
COLNAME_NAME
, "checkpoš‹d", 
SQLITE_STATIC
);

103006 
sql™e3VdbeAddOp3
(
v
, 
OP_Checkpošt
, 
iBt
, 
eMode
, 1);

103007 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 3);

103019 
	gP¿gTyp_WAL_AUTOCHECKPOINT
: {

103020 ifÐ
zRight
 ){

103021 
sql™e3_w®_autocheckpošt
(
db
, 
sql™e3Atoi
(
zRight
));

103023 
»tuºSšgËIÁ
(
pP¬£
, "wal_autocheckpoint",

103024 
db
->
xW®C®lback
==
sql™e3W®DeçuÉHook
 ?

103025 
SQLITE_PTR_TO_INT
(
db
->
pW®Arg
) : 0);

103036 
	gP¿gTyp_SHRINK_MEMORY
: {

103037 
sql™e3_db_»Ëa£_memÜy
(
db
);

103051 
as£¹
Ð
aP¿gmaNames
[
mid
].
eP¿gTyp
==
P¿gTyp_BUSY_TIMEOUT
 );

103052 ifÐ
	gzRight
 ){

103053 
sql™e3_busy_timeout
(
db
, 
sql™e3Atoi
(
zRight
));

103055 
»tuºSšgËIÁ
(
pP¬£
, "timeout", 
db
->
busyTimeout
);

103066 
	gP¿gTyp_SOFT_HEAP_LIMIT
: {

103067 
sql™e3_št64
 
N
;

103068 ifÐ
	gzRight
 && 
sql™e3DecOrHexToI64
(
zRight
, &
N
)==
SQLITE_OK
 ){

103069 
sql™e3_soá_h—p_lim™64
(
N
);

103071 
»tuºSšgËIÁ
(
pP¬£
, "soá_h—p_lim™", 
sql™e3_soá_h—p_lim™64
(-1));

103082 
	gP¿gTyp_THREADS
: {

103083 
sql™e3_št64
 
N
;

103084 ifÐ
	gzRight


103085 && 
sql™e3DecOrHexToI64
(
zRight
, &
N
)==
SQLITE_OK


103086 && 
N
>=0

103088 
sql™e3_lim™
(
db
, 
SQLITE_LIMIT_WORKER_THREADS
, ()(
N
&0x7fffffff));

103090 
»tuºSšgËIÁ
(
pP¬£
, "threads",

103091 
sql™e3_lim™
(
db
, 
SQLITE_LIMIT_WORKER_THREADS
, -1));

103095 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_TEST
)

103099 
	gP¿gTyp_LOCK_STATUS
: {

103100 cÚ¡ *cÚ¡ 
azLockName
[] = {

103103 
	gi
;

103104 
sql™e3VdbeS‘NumCÞs
(
v
, 2);

103105 
	gpP¬£
->
	gnMem
 = 2;

103106 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "d©aba£", 
SQLITE_STATIC
);

103107 
sql™e3VdbeS‘CÞName
(
v
, 1, 
COLNAME_NAME
, "¡©us", 
SQLITE_STATIC
);

103108 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

103109 
BŒ“
 *
	gpBt
;

103110 cÚ¡ *
	gzS‹
 = "unknown";

103111 
	gj
;

103112 ifÐ
	gdb
->
	gaDb
[
i
].
	gzName
==0 ) ;

103113 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 1, 0, 
db
->
aDb
[
i
].
zName
, 
P4_STATIC
);

103114 
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

103115 ifÐ
	gpBt
==0 || 
sql™e3BŒ“Pag”
(
pBt
)==0 ){

103116 
zS‹
 = "closed";

103117 }ifÐ
sql™e3_fže_cÚŒÞ
(
db
, 
i
 ? db->
aDb
[i].
zName
 : 0,

103118 
SQLITE_FCNTL_LOCKSTATE
, &
j
)==
SQLITE_OK
 ){

103119 
zS‹
 = 
azLockName
[
j
];

103121 
sql™e3VdbeAddOp4
(
v
, 
OP_SŒšg8
, 0, 2, 0, 
zS‹
, 
P4_STATIC
);

103122 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 1, 2);

103128 #ifdeà
SQLITE_HAS_CODEC


103129 
	gP¿gTyp_KEY
: {

103130 ifÐ
zRight
 ) 
sql™e3_key_v2
(
db
, 
zDb
, zRight, 
sql™e3SŒËn30
(zRight));

103133 
	gP¿gTyp_REKEY
: {

103134 ifÐ
zRight
 ) 
sql™e3_»key_v2
(
db
, 
zDb
, zRight, 
sql™e3SŒËn30
(zRight));

103137 
	gP¿gTyp_HEXKEY
: {

103138 ifÐ
zRight
 ){

103139 
u8
 
iBy‹
;

103140 
	gi
;

103141 
	gzKey
[40];

103142 
	gi
=0, 
	giBy‹
=0; i<(
	gzKey
)*2 && 
sql™e3Isxdig™
(
zRight
[
i
]); i++){

103143 
	giBy‹
 = (
iBy‹
<<4è+ 
sql™e3HexToIÁ
(
zRight
[
i
]);

103144 ifÐ(
	gi
&1)!=0 ) 
zKey
[
i
/2] = 
iBy‹
;

103146 ifÐ(
	gzLeá
[3] & 0xf)==0xb ){

103147 
sql™e3_key_v2
(
db
, 
zDb
, 
zKey
, 
i
/2);

103149 
sql™e3_»key_v2
(
db
, 
zDb
, 
zKey
, 
i
/2);

103155 #ià
defšed
(
SQLITE_HAS_CODEC
è|| defšed(
SQLITE_ENABLE_CEROD
)

103156 
	gP¿gTyp_ACTIVATE_EXTENSIONS
: ifÐ
zRight
 ){

103157 #ifdeà
SQLITE_HAS_CODEC


103158 ifÐ
sql™e3SŒNICmp
(
zRight
, "see-", 4)==0 ){

103159 
sql™e3_aùiv©e_£e
(&
zRight
[4]);

103162 #ifdeà
SQLITE_ENABLE_CEROD


103163 ifÐ
sql™e3SŒNICmp
(
zRight
, "cerod-", 6)==0 ){

103164 
sql™e3_aùiv©e_ûrod
(&
zRight
[6]);

103173 
	g´agma_out
:

103174 
sql™e3DbF»e
(
db
, 
zLeá
);

103175 
sql™e3DbF»e
(
db
, 
zRight
);

103202 
cÜru±Schema
(

103203 
In™D©a
 *
pD©a
,

103204 cÚ¡ *
zObj
,

103205 cÚ¡ *
zExŒa


103207 
sql™e3
 *
	gdb
 = 
pD©a
->
db
;

103208 ifÐ!
	gdb
->
	gm®locFažed
 && (db->
	gæags
 & 
	gSQLITE_Recov”yMode
)==0 ){

103209 ifÐ
zObj
==0 ) zObj = "?";

103210 
sql™e3S‘SŒšg
(
pD©a
->
pzE¼Msg
, 
db
,

103211 "m®fÜmed d©aba£ schem¨(%s)", 
zObj
);

103212 ifÐ
	gzExŒa
 ){

103213 *
	gpD©a
->
	gpzE¼Msg
 = 
sql™e3MAµ’df
(
db
, *
pD©a
->
pzE¼Msg
,

103214 "% - %s", *
pD©a
->
pzE¼Msg
, 
zExŒa
);

103217 
	gpD©a
->
	grc
 = 
db
->
m®locFažed
 ? 
SQLITE_NOMEM
 : 
SQLITE_CORRUPT_BKPT
;

103232 
SQLITE_PRIVATE
 
sql™e3In™C®lback
(*
pIn™
, 
¬gc
, **
¬gv
, **
NÙU£d
){

103233 
In™D©a
 *
	gpD©a
 = (In™D©a*)
pIn™
;

103234 
sql™e3
 *
	gdb
 = 
pD©a
->
db
;

103235 
	giDb
 = 
pD©a
->
iDb
;

103237 
as£¹
Ð
¬gc
==3 );

103238 
UNUSED_PARAMETER2
(
NÙU£d
, 
¬gc
);

103239 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103240 
DbCË¬PrÝ”ty
(
db
, 
iDb
, 
DB_Em±y
);

103241 ifÐ
	gdb
->
	gm®locFažed
 ){

103242 
cÜru±Schema
(
pD©a
, 
¬gv
[0], 0);

103246 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

103247 ifÐ
	g¬gv
==0 )  0;

103248 ifÐ
	g¬gv
[1]==0 ){

103249 
cÜru±Schema
(
pD©a
, 
¬gv
[0], 0);

103250 }ifÐ
	g¬gv
[2] &&‡rgv[2][0] ){

103256 
	grc
;

103257 
sql™e3_¡mt
 *
	gpStmt
;

103258 
TESTONLY
(
rý
);

103260 
as£¹
Ð
db
->
š™
.
busy
 );

103261 
	gdb
->
	gš™
.
	giDb
 = 
iDb
;

103262 
	gdb
->
	gš™
.
	gÃwTnum
 = 
sql™e3Atoi
(
¬gv
[1]);

103263 
	gdb
->
	gš™
.
	gÜphªTrigg”
 = 0;

103264 
TESTONLY
(
rý
 = ) 
sql™e3_´•¬e
(
db
, 
¬gv
[2], -1, &
pStmt
, 0);

103265 
	grc
 = 
db
->
”rCode
;

103266 
as£¹
Ð(
rc
&0xFF)==(
rý
&0xFF) );

103267 
	gdb
->
	gš™
.
	giDb
 = 0;

103268 ifÐ
	gSQLITE_OK
!=
rc
 ){

103269 ifÐ
db
->
š™
.
ÜphªTrigg”
 ){

103270 
as£¹
Ð
iDb
==1 );

103272 
	gpD©a
->
	grc
 = 
rc
;

103273 ifÐ
	grc
==
SQLITE_NOMEM
 ){

103274 
db
->
m®locFažed
 = 1;

103275 }ifÐ
	grc
!=
SQLITE_INTERRUPT
 && (
rc
&0xFF)!=
SQLITE_LOCKED
 ){

103276 
cÜru±Schema
(
pD©a
, 
¬gv
[0], 
sql™e3_”rmsg
(
db
));

103280 
sql™e3_fš®ize
(
pStmt
);

103281 }ifÐ
	g¬gv
[0]==0 ){

103282 
cÜru±Schema
(
pD©a
, 0, 0);

103290 
Index
 *
	gpIndex
;

103291 
	gpIndex
 = 
sql™e3FšdIndex
(
db
, 
¬gv
[0], db->
aDb
[
iDb
].
zName
);

103292 ifÐ
	gpIndex
==0 ){

103299 }ifÐ
sql™e3G‘IÁ32
(
¬gv
[1], &
pIndex
->
Šum
)==0 ){

103300 
cÜru±Schema
(
pD©a
, 
¬gv
[0], "invalid„ootpage");

103314 
sql™e3In™OÃ
(
sql™e3
 *
db
, 
iDb
, **
pzE¼Msg
){

103315 
	grc
;

103316 
	gi
;

103317 #iâdeà
SQLITE_OMIT_DEPRECATED


103318 
	gsize
;

103320 
TabË
 *
	gpTab
;

103321 
Db
 *
	gpDb
;

103322 cÚ¡ *
	gazArg
[4];

103323 
	gm‘a
[5];

103324 
In™D©a
 
	gš™D©a
;

103325 cÚ¡ *
	gzMa¡”Schema
;

103326 cÚ¡ *
	gzMa¡”Name
;

103327 
	gÝ’edT¿n§ùiÚ
 = 0;

103332 cÚ¡ 
	gma¡”_schema
[] =

103341 #iâdeà
SQLITE_OMIT_TEMPDB


103342 cÚ¡ 
	g‹mp_ma¡”_schema
[] =

103352 
	#‹mp_ma¡”_schema
 0

	)

103355 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

103356 
as£¹
Ð
db
->
aDb
[
iDb
].
pSchema
 );

103357 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103358 
as£¹
Ð
iDb
==1 || 
sql™e3BŒ“HÞdsMu‹x
(
db
->
aDb
[iDb].
pBt
) );

103364 ifÐ!
	gOMIT_TEMPDB
 && 
	giDb
==1 ){

103365 
zMa¡”Schema
 = 
‹mp_ma¡”_schema
;

103367 
	gzMa¡”Schema
 = 
ma¡”_schema
;

103369 
	gzMa¡”Name
 = 
SCHEMA_TABLE
(
iDb
);

103372 
	gazArg
[0] = 
zMa¡”Name
;

103373 
	gazArg
[1] = "1";

103374 
	gazArg
[2] = 
zMa¡”Schema
;

103375 
	gazArg
[3] = 0;

103376 
	gš™D©a
.
	gdb
 = 
db
;

103377 
	gš™D©a
.
	giDb
 = 
iDb
;

103378 
	gš™D©a
.
	grc
 = 
SQLITE_OK
;

103379 
	gš™D©a
.
	gpzE¼Msg
 = 
pzE¼Msg
;

103380 
sql™e3In™C®lback
(&
š™D©a
, 3, (**)
azArg
, 0);

103381 ifÐ
	gš™D©a
.
	grc
 ){

103382 
	grc
 = 
š™D©a
.
rc
;

103383 
	g”rÜ_out
;

103385 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zMa¡”Name
, db->
aDb
[
iDb
].
zName
);

103386 ifÐ
ALWAYS
(
pTab
) ){

103387 
	gpTab
->
	gbFÏgs
 |ð
TF_R—dÚly
;

103392 
	gpDb
 = &
db
->
aDb
[
iDb
];

103393 ifÐ
	gpDb
->
	gpBt
==0 ){

103394 ifÐ!
OMIT_TEMPDB
 && 
ALWAYS
(
iDb
==1) ){

103395 
DbS‘PrÝ”ty
(
db
, 1, 
DB_SchemaLßded
);

103397  
	gSQLITE_OK
;

103403 
sql™e3BŒ“EÁ”
(
pDb
->
pBt
);

103404 ifÐ!
sql™e3BŒ“IsInR—dT¿ns
(
pDb
->
pBt
) ){

103405 
	grc
 = 
sql™e3BŒ“BegšT¿ns
(
pDb
->
pBt
, 0);

103406 ifÐ
	grc
!=
SQLITE_OK
 ){

103407 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, "%s", 
sql™e3E¼SŒ
(
rc
));

103408 
	gš™Úe_”rÜ_out
;

103410 
	gÝ’edT¿n§ùiÚ
 = 1;

103430 
	gi
=0; i<
A¼aySize
(
m‘a
); i++){

103431 
sql™e3BŒ“G‘M‘a
(
pDb
->
pBt
, 
i
+1, (
u32
 *)&
m‘a
[i]);

103433 
	gpDb
->
	gpSchema
->
	gschema_cook›
 = 
m‘a
[
BTREE_SCHEMA_VERSION
-1];

103440 ifÐ
	gm‘a
[
BTREE_TEXT_ENCODING
-1] ){

103441 ifÐ
	giDb
==0 ){

103442 #iâdeà
SQLITE_OMIT_UTF16


103443 
u8
 
’codšg
;

103445 
	g’codšg
 = (
u8
)
m‘a
[
BTREE_TEXT_ENCODING
-1] & 3;

103446 ifÐ
	g’codšg
==0 ) 
’codšg
 = 
SQLITE_UTF8
;

103447 
ENC
(
db
èð
’codšg
;

103449 
ENC
(
db
èð
SQLITE_UTF8
;

103453 ifÐ
	gm‘a
[
BTREE_TEXT_ENCODING
-1]!=
ENC
(
db
) ){

103454 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, "attached databases must usehe same"

103456 
	grc
 = 
SQLITE_ERROR
;

103457 
	gš™Úe_”rÜ_out
;

103461 
DbS‘PrÝ”ty
(
db
, 
iDb
, 
DB_Em±y
);

103463 
	gpDb
->
	gpSchema
->
	g’c
 = 
ENC
(
db
);

103465 ifÐ
	gpDb
->
	gpSchema
->
	gÿche_size
==0 ){

103466 #iâdeà
SQLITE_OMIT_DEPRECATED


103467 
size
 = 
sql™e3AbsIÁ32
(
m‘a
[
BTREE_DEFAULT_CACHE_SIZE
-1]);

103468 ifÐ
	gsize
==0 ){ 
size
 = 
SQLITE_DEFAULT_CACHE_SIZE
; }

103469 
	gpDb
->
	gpSchema
->
	gÿche_size
 = 
size
;

103471 
	gpDb
->
	gpSchema
->
	gÿche_size
 = 
SQLITE_DEFAULT_CACHE_SIZE
;

103473 
sql™e3BŒ“S‘CacheSize
(
pDb
->
pBt
,…Db->
pSchema
->
ÿche_size
);

103482 
	gpDb
->
	gpSchema
->
	gfže_fÜm©
 = (
u8
)
m‘a
[
BTREE_FILE_FORMAT
-1];

103483 ifÐ
	gpDb
->
	gpSchema
->
	gfže_fÜm©
==0 ){

103484 
pDb
->
pSchema
->
fže_fÜm©
 = 1;

103486 ifÐ
	gpDb
->
	gpSchema
->
	gfže_fÜm©
>
	gSQLITE_MAX_FILE_FORMAT
 ){

103487 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, "unsupported file format");

103488 
	grc
 = 
SQLITE_ERROR
;

103489 
	gš™Úe_”rÜ_out
;

103497 ifÐ
	giDb
==0 && 
m‘a
[
BTREE_FILE_FORMAT
-1]>=4 ){

103498 
db
->
æags
 &ð~
SQLITE_LegacyFžeFmt
;

103503 
as£¹
Ð
db
->
š™
.
busy
 );

103505 *
	gzSql
;

103506 
	gzSql
 = 
sql™e3MPrštf
(
db
,

103508 
db
->
aDb
[
iDb
].
zName
, 
zMa¡”Name
);

103509 #iâdeà
SQLITE_OMIT_AUTHORIZATION


103511 
sql™e3_xauth
 
	gxAuth
;

103512 
	gxAuth
 = 
db
->
xAuth
;

103513 
	gdb
->
	gxAuth
 = 0;

103515 
	grc
 = 
sql™e3_exec
(
db
, 
zSql
, 
sql™e3In™C®lback
, &
š™D©a
, 0);

103516 #iâdeà
SQLITE_OMIT_AUTHORIZATION


103517 
	gdb
->
	gxAuth
 = 
xAuth
;

103520 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
š™D©a
.rc;

103521 
sql™e3DbF»e
(
db
, 
zSql
);

103522 #iâdeà
SQLITE_OMIT_ANALYZE


103523 ifÐ
	grc
==
SQLITE_OK
 ){

103524 
sql™e3AÇlysisLßd
(
db
, 
iDb
);

103528 ifÐ
	gdb
->
	gm®locFažed
 ){

103529 
	grc
 = 
SQLITE_NOMEM
;

103530 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

103532 ifÐ
	grc
==
SQLITE_OK
 || (
db
->
æags
&
SQLITE_Recov”yMode
)){

103541 
DbS‘PrÝ”ty
(
db
, 
iDb
, 
DB_SchemaLßded
);

103542 
	grc
 = 
SQLITE_OK
;

103549 
	gš™Úe_”rÜ_out
:

103550 ifÐ
Ý’edT¿n§ùiÚ
 ){

103551 
sql™e3BŒ“Comm™
(
pDb
->
pBt
);

103553 
sql™e3BŒ“L—ve
(
pDb
->
pBt
);

103555 
	g”rÜ_out
:

103556 ifÐ
rc
==
SQLITE_NOMEM
 ||„c==
SQLITE_IOERR_NOMEM
 ){

103557 
db
->
m®locFažed
 = 1;

103559  
	grc
;

103572 
SQLITE_PRIVATE
 
sql™e3In™
(
sql™e3
 *
db
, **
pzE¼Msg
){

103573 
	gi
, 
	grc
;

103574 
	gcomm™_š‹º®
 = !(
db
->
æags
&
SQLITE_IÁ”nChªges
);

103576 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103577 
as£¹
Ð
db
->
š™
.
busy
==0 );

103578 
	grc
 = 
SQLITE_OK
;

103579 
	gdb
->
	gš™
.
	gbusy
 = 1;

103580 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nDb
; i++){

103581 ifÐ
DbHasPrÝ”ty
(
db
, 
i
, 
DB_SchemaLßded
è|| 
	gi
==1 ) ;

103582 
	grc
 = 
sql™e3In™OÃ
(
db
, 
i
, 
pzE¼Msg
);

103583 ifÐ
	grc
 ){

103584 
sql™e3Re£tOÃSchema
(
db
, 
i
);

103592 #iâdeà
SQLITE_OMIT_TEMPDB


103593 
as£¹
Ð
db
->
nDb
>1 );

103594 ifÐ
	grc
==
SQLITE_OK
 && !
DbHasPrÝ”ty
(
db
, 1, 
DB_SchemaLßded
) ){

103595 
	grc
 = 
sql™e3In™OÃ
(
db
, 1, 
pzE¼Msg
);

103596 ifÐ
	grc
 ){

103597 
sql™e3Re£tOÃSchema
(
db
, 1);

103602 
	gdb
->
	gš™
.
	gbusy
 = 0;

103603 ifÐ
	grc
==
SQLITE_OK
 && 
comm™_š‹º®
 ){

103604 
sql™e3Comm™IÁ”ÇlChªges
(
db
);

103607  
	grc
;

103614 
SQLITE_PRIVATE
 
sql™e3R—dSchema
(
P¬£
 *
pP¬£
){

103615 
	grc
 = 
SQLITE_OK
;

103616 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

103617 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103618 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

103619 
	grc
 = 
sql™e3In™
(
db
, &
pP¬£
->
zE¼Msg
);

103621 ifÐ
	grc
!=
SQLITE_OK
 ){

103622 
pP¬£
->
rc
 =„c;

103623 
	gpP¬£
->
	gnE¼
++;

103625  
	grc
;

103634 
schemaIsV®id
(
P¬£
 *
pP¬£
){

103635 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

103636 
	giDb
;

103637 
	grc
;

103638 
	gcook›
;

103640 
as£¹
Ð
pP¬£
->
checkSchema
 );

103641 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103642 
	giDb
=0; iDb<
	gdb
->
	gnDb
; iDb++){

103643 
	gÝ’edT¿n§ùiÚ
 = 0;

103644 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
iDb
].
pBt
;

103645 ifÐ
	gpBt
==0 ) ;

103650 ifÐ!
sql™e3BŒ“IsInR—dT¿ns
(
pBt
) ){

103651 
	grc
 = 
sql™e3BŒ“BegšT¿ns
(
pBt
, 0);

103652 ifÐ
	grc
==
SQLITE_NOMEM
 || 
rc
==
SQLITE_IOERR_NOMEM
 ){

103653 
db
->
m®locFažed
 = 1;

103655 ifÐ
	grc
!=
SQLITE_OK
 ) ;

103656 
	gÝ’edT¿n§ùiÚ
 = 1;

103662 
sql™e3BŒ“G‘M‘a
(
pBt
, 
BTREE_SCHEMA_VERSION
, (
u32
 *)&
cook›
);

103663 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

103664 ifÐ
	gcook›
!=
db
->
aDb
[
iDb
].
pSchema
->
schema_cook›
 ){

103665 
sql™e3Re£tOÃSchema
(
db
, 
iDb
);

103666 
	gpP¬£
->
	grc
 = 
SQLITE_SCHEMA
;

103670 ifÐ
	gÝ’edT¿n§ùiÚ
 ){

103671 
sql™e3BŒ“Comm™
(
pBt
);

103683 
SQLITE_PRIVATE
 
sql™e3SchemaToIndex
(
sql™e3
 *
db
, 
Schema
 *
pSchema
){

103684 
	gi
 = -1000000;

103696 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103697 ifÐ
	gpSchema
 ){

103698 
	gi
=0; 
ALWAYS
(
i
<
db
->
nDb
); i++){

103699 ifÐ
	gdb
->
	gaDb
[
i
].
	gpSchema
==
pSchema
 ){

103703 
as£¹
Ð
i
>=0 && i<
db
->
nDb
 );

103705  
	gi
;

103711 
SQLITE_PRIVATE
 
sql™e3P¬£rRe£t
(
P¬£
 *
pP¬£
){

103712 ifÐ
	gpP¬£
 ){

103713 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

103714 
sql™e3DbF»e
(
db
, 
pP¬£
->
aLab–
);

103715 
sql™e3Ex´Li¡D–‘e
(
db
, 
pP¬£
->
pCÚ¡Ex´
);

103722 
sql™e3P»·»
(

103723 
sql™e3
 *
db
,

103724 cÚ¡ *
zSql
,

103725 
nBy‹s
,

103726 
§veSqlFÏg
,

103727 
Vdbe
 *
pR•»·»
,

103728 
sql™e3_¡mt
 **
µStmt
,

103729 cÚ¡ **
pzTaž


103731 
P¬£
 *
	gpP¬£
;

103732 *
	gzE¼Msg
 = 0;

103733 
	grc
 = 
SQLITE_OK
;

103734 
	gi
;

103737 
	gpP¬£
 = 
sql™e3SckAÎocZ”o
(
db
, (*
pP¬£
));

103738 ifÐ
	gpP¬£
==0 ){

103739 
rc
 = 
SQLITE_NOMEM
;

103740 
	g’d_´•¬e
;

103742 
	gpP¬£
->
	gpR•»·»
 = 
pR•»·»
;

103743 
as£¹
Ð
µStmt
 && *ppStmt==0 );

103744 
as£¹
Ð!
db
->
m®locFažed
 );

103745 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103770 
	gi
=0; i<
	gdb
->
	gnDb
; i++) {

103771 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

103772 ifÐ
	gpBt
 ){

103773 
as£¹
Ð
sql™e3BŒ“HÞdsMu‹x
(
pBt
) );

103774 
	grc
 = 
sql™e3BŒ“SchemaLocked
(
pBt
);

103775 ifÐ
	grc
 ){

103776 cÚ¡ *
	gzDb
 = 
db
->
aDb
[
i
].
zName
;

103777 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, "d©aba£ schem¨i locked: %s", 
zDb
);

103778 
‹¡ÿ£
Ð
db
->
æags
 & 
SQLITE_R—dUncomm™‹d
 );

103779 
	g’d_´•¬e
;

103784 
sql™e3VbUÆockLi¡
(
db
);

103786 
	gpP¬£
->
	gdb
 = 
db
;

103787 
	gpP¬£
->
	gnQu”yLoÝ
 = 0;

103788 ifÐ
	gnBy‹s
>=0 && (
nBy‹s
==0 || 
zSql
[nBytes-1]!=0) ){

103789 *
zSqlCÝy
;

103790 
	gmxL’
 = 
db
->
aLim™
[
SQLITE_LIMIT_SQL_LENGTH
];

103791 
‹¡ÿ£
Ð
nBy‹s
==
mxL’
 );

103792 
‹¡ÿ£
Ð
nBy‹s
==
mxL’
+1 );

103793 ifÐ
	gnBy‹s
>
	gmxL’
 ){

103794 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_TOOBIG
, "statementoo†ong");

103795 
	grc
 = 
sql™e3ApiEx™
(
db
, 
SQLITE_TOOBIG
);

103796 
	g’d_´•¬e
;

103798 
	gzSqlCÝy
 = 
sql™e3DbSŒNDup
(
db
, 
zSql
, 
nBy‹s
);

103799 ifÐ
	gzSqlCÝy
 ){

103800 
sql™e3RunP¬£r
(
pP¬£
, 
zSqlCÝy
, &
zE¼Msg
);

103801 
sql™e3DbF»e
(
db
, 
zSqlCÝy
);

103802 
	gpP¬£
->
	gzTaž
 = &
zSql
[
pP¬£
->
zTaž
-
zSqlCÝy
];

103804 
	gpP¬£
->
	gzTaž
 = &
zSql
[
nBy‹s
];

103807 
sql™e3RunP¬£r
(
pP¬£
, 
zSql
, &
zE¼Msg
);

103809 
as£¹
Ð0==
pP¬£
->
nQu”yLoÝ
 );

103811 ifÐ
	gdb
->
	gm®locFažed
 ){

103812 
	gpP¬£
->
	grc
 = 
SQLITE_NOMEM
;

103814 ifÐ
	gpP¬£
->
	grc
==
SQLITE_DONE
 ) 
pP¬£
->
rc
 = 
SQLITE_OK
;

103815 ifÐ
	gpP¬£
->
	gcheckSchema
 ){

103816 
schemaIsV®id
(
pP¬£
);

103818 ifÐ
	gdb
->
	gm®locFažed
 ){

103819 
	gpP¬£
->
	grc
 = 
SQLITE_NOMEM
;

103821 ifÐ
	gpzTaž
 ){

103822 *
	gpzTaž
 = 
pP¬£
->
zTaž
;

103824 
	grc
 = 
pP¬£
->
rc
;

103826 #iâdeà
SQLITE_OMIT_EXPLAIN


103827 ifÐ
	grc
==
SQLITE_OK
 && 
pP¬£
->
pVdbe
 &&…P¬£->
ex¶aš
 ){

103828 cÚ¡ * cÚ¡ 
azCÞName
[] = {

103832 
	giFœ¡
, 
	gmx
;

103833 ifÐ
	gpP¬£
->
	gex¶aš
==2 ){

103834 
sql™e3VdbeS‘NumCÞs
(
pP¬£
->
pVdbe
, 4);

103835 
	giFœ¡
 = 8;

103836 
	gmx
 = 12;

103838 
sql™e3VdbeS‘NumCÞs
(
pP¬£
->
pVdbe
, 8);

103839 
	giFœ¡
 = 0;

103840 
	gmx
 = 8;

103842 
	gi
=
iFœ¡
; i<
	gmx
; i++){

103843 
sql™e3VdbeS‘CÞName
(
pP¬£
->
pVdbe
, 
i
-
iFœ¡
, 
COLNAME_NAME
,

103844 
azCÞName
[
i
], 
SQLITE_STATIC
);

103849 ifÐ
	gdb
->
	gš™
.
	gbusy
==0 ){

103850 
Vdbe
 *
pVdbe
 = 
pP¬£
->pVdbe;

103851 
sql™e3VdbeS‘Sql
(
pVdbe
, 
zSql
, ()(
pP¬£
->
zTaž
-zSql), 
§veSqlFÏg
);

103853 ifÐ
	gpP¬£
->
	gpVdbe
 && (
	grc
!=
SQLITE_OK
 || 
db
->
m®locFažed
) ){

103854 
sql™e3VdbeFš®ize
(
pP¬£
->
pVdbe
);

103855 
as£¹
(!(*
µStmt
));

103857 *
	gµStmt
 = (
sql™e3_¡mt
*)
pP¬£
->
pVdbe
;

103860 ifÐ
	gzE¼Msg
 ){

103861 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, "%s", 
zE¼Msg
);

103862 
sql™e3DbF»e
(
db
, 
zE¼Msg
);

103864 
sql™e3E¼Ü
(
db
, 
rc
);

103868  
	gpP¬£
->
	gpTrigg”Prg
 ){

103869 
Trigg”Prg
 *
	gpT
 = 
pP¬£
->
pTrigg”Prg
;

103870 
	gpP¬£
->
	gpTrigg”Prg
 = 
pT
->
pNext
;

103871 
sql™e3DbF»e
(
db
, 
pT
);

103874 
	g’d_´•¬e
:

103876 
sql™e3P¬£rRe£t
(
pP¬£
);

103877 
sql™e3SckF»e
(
db
, 
pP¬£
);

103878 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

103879 
as£¹
Ð(
rc
&
db
->
”rMask
)==rc );

103880  
	grc
;

103882 
sql™e3LockAndP»·»
(

103883 
sql™e3
 *
db
,

103884 cÚ¡ *
zSql
,

103885 
nBy‹s
,

103886 
§veSqlFÏg
,

103887 
Vdbe
 *
pOld
,

103888 
sql™e3_¡mt
 **
µStmt
,

103889 cÚ¡ **
pzTaž


103891 
	grc
;

103892 
as£¹
Ð
µStmt
!=0 );

103893 *
	gµStmt
 = 0;

103894 ifÐ!
sql™e3SaãtyCheckOk
(
db
) ){

103895  
	gSQLITE_MISUSE_BKPT
;

103897 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

103898 
sql™e3BŒ“EÁ”AÎ
(
db
);

103899 
	grc
 = 
sql™e3P»·»
(
db
, 
zSql
, 
nBy‹s
, 
§veSqlFÏg
, 
pOld
, 
µStmt
, 
pzTaž
);

103900 ifÐ
	grc
==
SQLITE_SCHEMA
 ){

103901 
sql™e3_fš®ize
(*
µStmt
);

103902 
	grc
 = 
sql™e3P»·»
(
db
, 
zSql
, 
nBy‹s
, 
§veSqlFÏg
, 
pOld
, 
µStmt
, 
pzTaž
);

103904 
sql™e3BŒ“L—veAÎ
(
db
);

103905 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

103906 
as£¹
Ð
rc
==
SQLITE_OK
 || *
µStmt
==0 );

103907  
	grc
;

103918 
SQLITE_PRIVATE
 
sql™e3R•»·»
(
Vdbe
 *
p
){

103919 
	grc
;

103920 
sql™e3_¡mt
 *
	gpNew
;

103921 cÚ¡ *
	gzSql
;

103922 
sql™e3
 *
	gdb
;

103924 
as£¹
Ð
sql™e3_mu‹x_h–d
(
sql™e3VdbeDb
(
p
)->
mu‹x
) );

103925 
	gzSql
 = 
sql™e3_sql
((
sql™e3_¡mt
 *)
p
);

103926 
as£¹
Ð
zSql
!=0 );

103927 
	gdb
 = 
sql™e3VdbeDb
(
p
);

103928 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

103929 
	grc
 = 
sql™e3LockAndP»·»
(
db
, 
zSql
, -1, 0, 
p
, &
pNew
, 0);

103930 ifÐ
	grc
 ){

103931 ifÐ
	grc
==
SQLITE_NOMEM
 ){

103932 
db
->
m®locFažed
 = 1;

103934 
as£¹
Ð
pNew
==0 );

103935  
	grc
;

103937 
as£¹
Ð
pNew
!=0 );

103939 
sql™e3VdbeSw­
((
Vdbe
*)
pNew
, 
p
);

103940 
sql™e3T¿nsãrBšdšgs
(
pNew
, (
sql™e3_¡mt
*)
p
);

103941 
sql™e3VdbeRe£tS‹pResuÉ
((
Vdbe
*)
pNew
);

103942 
sql™e3VdbeFš®ize
((
Vdbe
*)
pNew
);

103943  
	gSQLITE_OK
;

103955 
SQLITE_API
 
sql™e3_´•¬e
(

103956 
sql™e3
 *
db
,

103957 cÚ¡ *
zSql
,

103958 
nBy‹s
,

103959 
sql™e3_¡mt
 **
µStmt
,

103960 cÚ¡ **
pzTaž


103962 
	grc
;

103963 
	grc
 = 
sql™e3LockAndP»·»
(
db
,
zSql
,
nBy‹s
,0,0,
µStmt
,
pzTaž
);

103964 
as£¹
Ð
rc
==
SQLITE_OK
 || 
µStmt
==0 || *ppStmt==0 );

103965  
	grc
;

103967 
SQLITE_API
 
sql™e3_´•¬e_v2
(

103968 
sql™e3
 *
db
,

103969 cÚ¡ *
zSql
,

103970 
nBy‹s
,

103971 
sql™e3_¡mt
 **
µStmt
,

103972 cÚ¡ **
pzTaž


103974 
	grc
;

103975 
	grc
 = 
sql™e3LockAndP»·»
(
db
,
zSql
,
nBy‹s
,1,0,
µStmt
,
pzTaž
);

103976 
as£¹
Ð
rc
==
SQLITE_OK
 || 
µStmt
==0 || *ppStmt==0 );

103977  
	grc
;

103981 #iâdeà
SQLITE_OMIT_UTF16


103985 
sql™e3P»·»16
(

103986 
sql™e3
 *
db
,

103987 cÚ¡ *
zSql
,

103988 
nBy‹s
,

103989 
§veSqlFÏg
,

103990 
sql™e3_¡mt
 **
µStmt
,

103991 cÚ¡ **
pzTaž


103997 *
	gzSql8
;

103998 cÚ¡ *
	gzTaž8
 = 0;

103999 
	grc
 = 
SQLITE_OK
;

104001 
as£¹
Ð
µStmt
 );

104002 *
	gµStmt
 = 0;

104003 ifÐ!
sql™e3SaãtyCheckOk
(
db
) ){

104004  
	gSQLITE_MISUSE_BKPT
;

104006 ifÐ
	gnBy‹s
>=0 ){

104007 
sz
;

104008 cÚ¡ *
	gz
 = (cÚ¡ *)
zSql
;

104009 
	gsz
=0; sz<
	gnBy‹s
 && (
	gz
[
sz
]!=0 || 
z
[sz+1]!=0); sz += 2){}

104010 
nBy‹s
 = 
sz
;

104012 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

104013 
	gzSql8
 = 
sql™e3Utf16to8
(
db
, 
zSql
, 
nBy‹s
, 
SQLITE_UTF16NATIVE
);

104014 ifÐ
	gzSql8
 ){

104015 
	grc
 = 
sql™e3LockAndP»·»
(
db
, 
zSql8
, -1, 
§veSqlFÏg
, 0, 
µStmt
, &
zTaž8
);

104018 ifÐ
	gzTaž8
 && 
	gpzTaž
 ){

104024 
	gch¬s_·r£d
 = 
sql™e3Utf8Ch¬L’
(
zSql8
, ()(
zTaž8
-zSql8));

104025 *
	gpzTaž
 = (
u8
 *)
zSql
 + 
sql™e3Utf16By‹L’
(zSql, 
ch¬s_·r£d
);

104027 
sql™e3DbF»e
(
db
, 
zSql8
);

104028 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

104029 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

104030  
	grc
;

104041 
SQLITE_API
 
sql™e3_´•¬e16
(

104042 
sql™e3
 *
db
,

104043 cÚ¡ *
zSql
,

104044 
nBy‹s
,

104045 
sql™e3_¡mt
 **
µStmt
,

104046 cÚ¡ **
pzTaž


104048 
	grc
;

104049 
	grc
 = 
sql™e3P»·»16
(
db
,
zSql
,
nBy‹s
,0,
µStmt
,
pzTaž
);

104050 
as£¹
Ð
rc
==
SQLITE_OK
 || 
µStmt
==0 || *ppStmt==0 );

104051  
	grc
;

104053 
SQLITE_API
 
sql™e3_´•¬e16_v2
(

104054 
sql™e3
 *
db
,

104055 cÚ¡ *
zSql
,

104056 
nBy‹s
,

104057 
sql™e3_¡mt
 **
µStmt
,

104058 cÚ¡ **
pzTaž


104060 
	grc
;

104061 
	grc
 = 
sql™e3P»·»16
(
db
,
zSql
,
nBy‹s
,1,
µStmt
,
pzTaž
);

104062 
as£¹
Ð
rc
==
SQLITE_OK
 || 
µStmt
==0 || *ppStmt==0 );

104063  
	grc
;

104088 #ià
SELECTTRACE_ENABLED


104089  
	gsql™e3S–eùT¿û
 = 0;

104090 
	#SELECTTRACE
(
K
,
P
,
S
,
X
) \

104091 if(
sql™e3S–eùT¿û
&(
K
)) \

104092 
	`sql™e3DebugPrštf
("%*s%s.%p: ",(
P
)->
nS–eùInd’t
*2-2,"",(
S
)->
zS–Name
,(S)),\

104093 
sql™e3DebugPrštf
 
X


	)

104095 
	#SELECTTRACE
(
K
,
P
,
S
,
X
)

	)

104104 
Di¡šùCtx
 
	tDi¡šùCtx
;

104105 
	sDi¡šùCtx
 {

104106 
u8
 
	gisTnù
;

104107 
u8
 
	geTnùTy³
;

104108 
	gbTnù
;

104109 
	gaddrTnù
;

104116 
SÜtCtx
 
	tSÜtCtx
;

104117 
	sSÜtCtx
 {

104118 
Ex´Li¡
 *
	gpOrd”By
;

104119 
	gnOBS©
;

104120 
	giECursÜ
;

104121 
	g»gR‘uº
;

104122 
	gÏb–BkOut
;

104123 
	gaddrSÜtIndex
;

104124 
u8
 
	gsÜtFÏgs
;

104126 
	#SORTFLAG_U£SÜ‹r
 0x01

	)

104132 
þ—rS–eù
(
sql™e3
 *
db
, 
S–eù
 *
p
){

104133 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
pELi¡
);

104134 
sql™e3SrcLi¡D–‘e
(
db
, 
p
->
pSrc
);

104135 
sql™e3Ex´D–‘e
(
db
, 
p
->
pWh”e
);

104136 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
pGroupBy
);

104137 
sql™e3Ex´D–‘e
(
db
, 
p
->
pHavšg
);

104138 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
pOrd”By
);

104139 
sql™e3S–eùD–‘e
(
db
, 
p
->
pPriÜ
);

104140 
sql™e3Ex´D–‘e
(
db
, 
p
->
pLim™
);

104141 
sql™e3Ex´D–‘e
(
db
, 
p
->
pOff£t
);

104142 
sql™e3W™hD–‘e
(
db
, 
p
->
pW™h
);

104148 
SQLITE_PRIVATE
 
sql™e3S–eùDe¡In™
(
S–eùDe¡
 *
pDe¡
, 
eDe¡
, 
iP¬m
){

104149 
	gpDe¡
->
	geDe¡
 = (
u8
)
eDe¡
;

104150 
	gpDe¡
->
	giSDP¬m
 = 
iP¬m
;

104151 
	gpDe¡
->
	gaffSd¡
 = 0;

104152 
	gpDe¡
->
	giSd¡
 = 0;

104153 
	gpDe¡
->
	gnSd¡
 = 0;

104161 
SQLITE_PRIVATE
 
S–eù
 *
sql™e3S–eùNew
(

104162 
P¬£
 *
pP¬£
,

104163 
Ex´Li¡
 *
pELi¡
,

104164 
SrcLi¡
 *
pSrc
,

104165 
Ex´
 *
pWh”e
,

104166 
Ex´Li¡
 *
pGroupBy
,

104167 
Ex´
 *
pHavšg
,

104168 
Ex´Li¡
 *
pOrd”By
,

104169 
u16
 
£lFÏgs
,

104170 
Ex´
 *
pLim™
,

104171 
Ex´
 *
pOff£t


104173 
S–eù
 *
	gpNew
;

104174 
S–eù
 
	g¡ªdš
;

104175 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

104176 
	gpNew
 = 
sql™e3DbM®locZ”o
(
db
, (*
pNew
) );

104177 
as£¹
Ð
db
->
m®locFažed
 || !
pOff£t
 || 
pLim™
 );

104178 ifÐ
	gpNew
==0 ){

104179 
as£¹
Ð
db
->
m®locFažed
 );

104180 
	gpNew
 = &
¡ªdš
;

104181 
mem£t
(
pNew
, 0, (*pNew));

104183 ifÐ
	gpELi¡
==0 ){

104184 
pELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
sql™e3Ex´
(
db
,
TK_ALL
,0));

104186 
	gpNew
->
	gpELi¡
 = 
pELi¡
;

104187 ifÐ
	gpSrc
==0 ) 
pSrc
 = 
sql™e3DbM®locZ”o
(
db
, (*pSrc));

104188 
	gpNew
->
	gpSrc
 = 
pSrc
;

104189 
	gpNew
->
	gpWh”e
 = 
pWh”e
;

104190 
	gpNew
->
	gpGroupBy
 = 
pGroupBy
;

104191 
	gpNew
->
	gpHavšg
 = 
pHavšg
;

104192 
	gpNew
->
	gpOrd”By
 = 
pOrd”By
;

104193 
	gpNew
->
	g£lFÏgs
 = 
£lFÏgs
;

104194 
	gpNew
->
	gÝ
 = 
TK_SELECT
;

104195 
	gpNew
->
	gpLim™
 = 
pLim™
;

104196 
	gpNew
->
	gpOff£t
 = 
pOff£t
;

104197 
as£¹
Ð
pOff£t
==0 || 
pLim™
!=0 );

104198 
	gpNew
->
	gaddrO³nEphm
[0] = -1;

104199 
	gpNew
->
	gaddrO³nEphm
[1] = -1;

104200 ifÐ
	gdb
->
	gm®locFažed
 ) {

104201 
þ—rS–eù
(
db
, 
pNew
);

104202 ifÐ
	gpNew
!=&
¡ªdš
 ) 
sql™e3DbF»e
(
db
, 
pNew
);

104203 
	gpNew
 = 0;

104205 
as£¹
Ð
pNew
->
pSrc
!=0 || 
pP¬£
->
nE¼
>0 );

104207 
as£¹
Ð
pNew
!=&
¡ªdš
 );

104208  
	gpNew
;

104211 #ià
SELECTTRACE_ENABLED


104215 
SQLITE_PRIVATE
 
sql™e3S–eùS‘Name
(
S–eù
 *
p
, cÚ¡ *
zName
){

104216 ifÐ
	gp
 && 
	gzName
 ){

104217 
sql™e3_¢´štf
((
p
->
zS–Name
),…->zS–Name, "%s", 
zName
);

104226 
SQLITE_PRIVATE
 
sql™e3S–eùD–‘e
(
sql™e3
 *
db
, 
S–eù
 *
p
){

104227 ifÐ
	gp
 ){

104228 
þ—rS–eù
(
db
, 
p
);

104229 
sql™e3DbF»e
(
db
, 
p
);

104236 
S–eù
 *
fšdRightmo¡
(S–eù *
p
){

104237  
	gp
->
	gpNext
 )… = 
p
->
pNext
;

104238  
	gp
;

104258 
SQLITE_PRIVATE
 
sql™e3JošTy³
(
P¬£
 *
pP¬£
, 
Tok’
 *
pA
, Tok’ *
pB
, Tok’ *
pC
){

104259 
	gjošty³
 = 0;

104260 
Tok’
 *
	g­AÎ
[3];

104261 
Tok’
 *
	gp
;

104263 cÚ¡ 
	gzKeyText
[] = "naturaleftouterightfullinnercross";

104265 
u8
 
	gi
;

104266 
u8
 
	gnCh¬
;

104267 
u8
 
	gcode
;

104268 } 
	gaKeywÜd
[] = {

104269  { 0, 7, 
JT_NATURAL
 },

104270  { 6, 4, 
JT_LEFT
|
JT_OUTER
 },

104271  { 10, 5, 
JT_OUTER
 },

104272  { 14, 5, 
JT_RIGHT
|
JT_OUTER
 },

104273  { 19, 4, 
JT_LEFT
|
JT_RIGHT
|
JT_OUTER
 },

104274  { 23, 5, 
JT_INNER
 },

104275  { 28, 5, 
JT_INNER
|
JT_CROSS
 },

104277 
	gi
, 
	gj
;

104278 
	g­AÎ
[0] = 
pA
;

104279 
	g­AÎ
[1] = 
pB
;

104280 
	g­AÎ
[2] = 
pC
;

104281 
	gi
=0; i<3 && 
	g­AÎ
[
i
]; i++){

104282 
	gp
 = 
­AÎ
[
i
];

104283 
	gj
=0; j<
A¼aySize
(
aKeywÜd
); j++){

104284 ifÐ
	gp
->
	gn
==
aKeywÜd
[
j
].
nCh¬


104285 && 
sql™e3SŒNICmp
((*)
p
->
z
, &
zKeyText
[
aKeywÜd
[
j
].
i
],…->
n
)==0 ){

104286 
jošty³
 |ð
aKeywÜd
[
j
].
code
;

104290 
‹¡ÿ£
Ð
j
==0 || j==1 || j==2 || j==3 || j==4 || j==5 || j==6 );

104291 ifÐ
	gj
>=
A¼aySize
(
aKeywÜd
) ){

104292 
jošty³
 |ð
JT_ERROR
;

104297 (
	gjošty³
 & (
	gJT_INNER
|
	gJT_OUTER
))==(
JT_INNER
|
JT_OUTER
) ||

104298 (
jošty³
 & 
JT_ERROR
)!=0

104300 cÚ¡ *
zSp
 = " ";

104301 
as£¹
Ð
pB
!=0 );

104302 ifÐ
	gpC
==0 ){ 
zSp
++; }

104303 
sql™e3E¼ÜMsg
(
pP¬£
, "unknown or unsupported joinype: "

104304 "%T %T%s%T", 
pA
, 
pB
, 
zSp
, 
pC
);

104305 
	gjošty³
 = 
JT_INNER
;

104306 }ifÐ(
	gjošty³
 & 
	gJT_OUTER
)!=0

104307 && (
jošty³
 & (
JT_LEFT
|
JT_RIGHT
))!=JT_LEFT ){

104308 
sql™e3E¼ÜMsg
(
pP¬£
,

104310 
	gjošty³
 = 
JT_INNER
;

104312  
	gjošty³
;

104319 
cÞumnIndex
(
TabË
 *
pTab
, cÚ¡ *
zCÞ
){

104320 
	gi
;

104321 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

104322 ifÐ
sql™e3SŒICmp
(
pTab
->
aCÞ
[
i
].
zName
, 
zCÞ
)==0 )  i;

104336 
bËAndCÞumnIndex
(

104337 
SrcLi¡
 *
pSrc
,

104338 
N
,

104339 cÚ¡ *
zCÞ
,

104340 *
piTab
,

104341 *
piCÞ


104343 
	gi
;

104344 
	giCÞ
;

104346 
as£¹
Ð(
piTab
==0)==(
piCÞ
==0) );

104347 
	gi
=0; i<
	gN
; i++){

104348 
	giCÞ
 = 
cÞumnIndex
(
pSrc
->
a
[
i
].
pTab
, 
zCÞ
);

104349 ifÐ
	giCÞ
>=0 ){

104350 ifÐ
piTab
 ){

104351 *
piTab
 = 
i
;

104352 *
	gpiCÞ
 = 
iCÞ
;

104371 
addWh”eT”m
(

104372 
P¬£
 *
pP¬£
,

104373 
SrcLi¡
 *
pSrc
,

104374 
iLeá
,

104375 
iCÞLeá
,

104376 
iRight
,

104377 
iCÞRight
,

104378 
isOu‹rJoš
,

104379 
Ex´
 **
µWh”e


104381 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

104382 
Ex´
 *
	gpE1
;

104383 
Ex´
 *
	gpE2
;

104384 
Ex´
 *
	gpEq
;

104386 
as£¹
Ð
iLeá
<
iRight
 );

104387 
as£¹
Ð
pSrc
->
nSrc
>
iRight
 );

104388 
as£¹
Ð
pSrc
->
a
[
iLeá
].
pTab
 );

104389 
as£¹
Ð
pSrc
->
a
[
iRight
].
pTab
 );

104391 
	gpE1
 = 
sql™e3C»©eCÞumnEx´
(
db
, 
pSrc
, 
iLeá
, 
iCÞLeá
);

104392 
	gpE2
 = 
sql™e3C»©eCÞumnEx´
(
db
, 
pSrc
, 
iRight
, 
iCÞRight
);

104394 
	gpEq
 = 
sql™e3PEx´
(
pP¬£
, 
TK_EQ
, 
pE1
, 
pE2
, 0);

104395 ifÐ
	gpEq
 && 
	gisOu‹rJoš
 ){

104396 
Ex´S‘PrÝ”ty
(
pEq
, 
EP_FromJoš
);

104397 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pEq
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

104398 
Ex´S‘VVAPrÝ”ty
(
pEq
, 
EP_NoReduû
);

104399 
	gpEq
->
	giRightJošTabË
 = (
i16
)
pE2
->
iTabË
;

104401 *
	gµWh”e
 = 
sql™e3Ex´And
(
db
, *
µWh”e
, 
pEq
);

104430 
£tJošEx´
(
Ex´
 *
p
, 
iTabË
){

104431  
	gp
 ){

104432 
Ex´S‘PrÝ”ty
(
p
, 
EP_FromJoš
);

104433 
as£¹
Ð!
Ex´HasPrÝ”ty
(
p
, 
EP_Tok’OÆy
|
EP_Reduûd
) );

104434 
Ex´S‘VVAPrÝ”ty
(
p
, 
EP_NoReduû
);

104435 
	gp
->
	giRightJošTabË
 = (
i16
)
iTabË
;

104436 
£tJošEx´
(
p
->
pLeá
, 
iTabË
);

104437 
	gp
 = 
p
->
pRight
;

104455 
sql™eProûssJoš
(
P¬£
 *
pP¬£
, 
S–eù
 *
p
){

104456 
SrcLi¡
 *
	gpSrc
;

104457 
	gi
, 
	gj
;

104458 
SrcLi¡_™em
 *
	gpLeá
;

104459 
SrcLi¡_™em
 *
	gpRight
;

104461 
	gpSrc
 = 
p
->
pSrc
;

104462 
	gpLeá
 = &
pSrc
->
a
[0];

104463 
	gpRight
 = &
pLeá
[1];

104464 
	gi
=0; i<
	gpSrc
->
	gnSrc
-1; i++, 
	gpRight
++, 
	gpLeá
++){

104465 
TabË
 *
	gpLeáTab
 = 
pLeá
->
pTab
;

104466 
TabË
 *
	gpRightTab
 = 
pRight
->
pTab
;

104467 
	gisOu‹r
;

104469 ifÐ
NEVER
(
pLeáTab
==0 || 
pRightTab
==0) ) ;

104470 
	gisOu‹r
 = (
pRight
->
jošty³
 & 
JT_OUTER
)!=0;

104475 ifÐ
	gpRight
->
	gjošty³
 & 
	gJT_NATURAL
 ){

104476 ifÐ
	gpRight
->
	gpOn
 ||…Right->
	gpUsšg
 ){

104477 
sql™e3E¼ÜMsg
(
pP¬£
, "a NATURAL join may‚ot have "

104481 
	gj
=0; j<
	gpRightTab
->
	gnCÞ
; j++){

104482 *
	gzName
;

104483 
	giLeá
;

104484 
	giLeáCÞ
;

104486 
	gzName
 = 
pRightTab
->
aCÞ
[
j
].
zName
;

104487 ifÐ
bËAndCÞumnIndex
(
pSrc
, 
i
+1, 
zName
, &
iLeá
, &
iLeáCÞ
) ){

104488 
addWh”eT”m
(
pP¬£
, 
pSrc
, 
iLeá
, 
iLeáCÞ
, 
i
+1, 
j
,

104489 
isOu‹r
, &
p
->
pWh”e
);

104496 ifÐ
	gpRight
->
	gpOn
 &&…Right->
	gpUsšg
 ){

104497 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot have both ON‡nd USING "

104505 ifÐ
	gpRight
->
	gpOn
 ){

104506 ifÐ
	gisOu‹r
 ) 
£tJošEx´
(
pRight
->
pOn
,…Right->
iCursÜ
);

104507 
	gp
->
	gpWh”e
 = 
sql™e3Ex´And
(
pP¬£
->
db
, 
p
->
pWh”e
, 
pRight
->
pOn
);

104508 
	gpRight
->
	gpOn
 = 0;

104518 ifÐ
	gpRight
->
	gpUsšg
 ){

104519 
IdLi¡
 *
	gpLi¡
 = 
pRight
->
pUsšg
;

104520 
	gj
=0; j<
	gpLi¡
->
	gnId
; j++){

104521 *
	gzName
;

104522 
	giLeá
;

104523 
	giLeáCÞ
;

104524 
	giRightCÞ
;

104526 
	gzName
 = 
pLi¡
->
a
[
j
].
zName
;

104527 
	giRightCÞ
 = 
cÞumnIndex
(
pRightTab
, 
zName
);

104528 ifÐ
	giRightCÞ
<0

104529 || !
bËAndCÞumnIndex
(
pSrc
, 
i
+1, 
zName
, &
iLeá
, &
iLeáCÞ
)

104531 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot join using column %s - column "

104532 "nÙ…»£Á iÀbÙhabËs", 
zName
);

104535 
addWh”eT”m
(
pP¬£
, 
pSrc
, 
iLeá
, 
iLeáCÞ
, 
i
+1, 
iRightCÞ
,

104536 
isOu‹r
, &
p
->
pWh”e
);

104544 
KeyInfo
 *
keyInfoFromEx´Li¡
(

104545 
P¬£
 *
pP¬£
,

104546 
Ex´Li¡
 *
pLi¡
,

104547 
iS¹
,

104548 
nExŒa


104555 
pushOÁoSÜ‹r
(

104556 
P¬£
 *
pP¬£
,

104557 
SÜtCtx
 *
pSÜt
,

104558 
S–eù
 *
pS–eù
,

104559 
»gD©a
,

104560 
nD©a
,

104561 
nP»fixReg


104563 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

104564 
	gbSeq
 = ((
pSÜt
->
sÜtFÏgs
 & 
SORTFLAG_U£SÜ‹r
)==0);

104565 
	gnEx´
 = 
pSÜt
->
pOrd”By
->
nEx´
;

104566 
	gnBa£
 = 
nEx´
 + 
bSeq
 + 
nD©a
;

104567 
	g»gBa£
;

104568 
	g»gRecÜd
 = ++
pP¬£
->
nMem
;

104569 
	gnOBS©
 = 
pSÜt
->
nOBS©
;

104570 
	gÝ
;

104572 
as£¹
Ð
bSeq
==0 || bSeq==1 );

104573 ifÐ
	gnP»fixReg
 ){

104574 
as£¹
Ð
nP»fixReg
==
nEx´
+
bSeq
 );

104575 
	g»gBa£
 = 
»gD©a
 - 
nEx´
 - 
bSeq
;

104577 
	g»gBa£
 = 
pP¬£
->
nMem
 + 1;

104578 
	gpP¬£
->
	gnMem
 +ð
nBa£
;

104580 
sql™e3Ex´CodeEx´Li¡
(
pP¬£
, 
pSÜt
->
pOrd”By
, 
»gBa£
, 
SQLITE_ECEL_DUP
);

104581 ifÐ
	gbSeq
 ){

104582 
sql™e3VdbeAddOp2
(
v
, 
OP_Sequ’û
, 
pSÜt
->
iECursÜ
, 
»gBa£
+
nEx´
);

104584 ifÐ
	gnP»fixReg
==0 ){

104585 
sql™e3Ex´CodeMove
(
pP¬£
, 
»gD©a
, 
»gBa£
+
nEx´
+
bSeq
, 
nD©a
);

104588 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gBa£
+
nOBS©
, 
nBa£
-nOBS©, 
»gRecÜd
);

104589 ifÐ
	gnOBS©
>0 ){

104590 
	g»gP»vKey
;

104591 
	gaddrFœ¡
;

104592 
	gaddrJmp
;

104593 
VdbeOp
 *
	gpOp
;

104594 
	gnKey
;

104595 
KeyInfo
 *
	gpKI
;

104597 
	g»gP»vKey
 = 
pP¬£
->
nMem
+1;

104598 
	gpP¬£
->
	gnMem
 +ð
pSÜt
->
nOBS©
;

104599 
	gnKey
 = 
nEx´
 - 
pSÜt
->
nOBS©
 + 
bSeq
;

104600 ifÐ
	gbSeq
 ){

104601 
	gaddrFœ¡
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfNÙ
, 
»gBa£
+
nEx´
);

104603 
	gaddrFœ¡
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Sequ’ûTe¡
, 
pSÜt
->
iECursÜ
);

104605 
VdbeCov”age
(
v
);

104606 
sql™e3VdbeAddOp3
(
v
, 
OP_Com·»
, 
»gP»vKey
, 
»gBa£
, 
pSÜt
->
nOBS©
);

104607 
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, 
pSÜt
->
addrSÜtIndex
);

104608 ifÐ
	gpP¬£
->
	gdb
->
	gm®locFažed
 ) ;

104609 
	gpOp
->
	gp2
 = 
nKey
 + 
nD©a
;

104610 
	gpKI
 = 
pOp
->
p4
.
pKeyInfo
;

104611 
mem£t
(
pKI
->
aSÜtOrd”
, 0,…KI->
nF›ld
);

104612 
sql™e3VdbeChªgeP4
(
v
, -1, (*)
pKI
, 
P4_KEYINFO
);

104613 
	gpOp
->
	gp4
.
	gpKeyInfo
 = 
keyInfoFromEx´Li¡
(
pP¬£
, 
pSÜt
->
pOrd”By
, 
nOBS©
, 1);

104614 
	gaddrJmp
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

104615 
sql™e3VdbeAddOp3
(
v
, 
OP_Jump
, 
addrJmp
+1, 0,‡ddrJmp+1); 
VdbeCov”age
(v);

104616 
	gpSÜt
->
	gÏb–BkOut
 = 
sql™e3VdbeMakeLab–
(
v
);

104617 
	gpSÜt
->
	g»gR‘uº
 = ++
pP¬£
->
nMem
;

104618 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
pSÜt
->
»gR‘uº
,…SÜt->
Ïb–BkOut
);

104619 
sql™e3VdbeAddOp1
(
v
, 
OP_Re£tSÜ‹r
, 
pSÜt
->
iECursÜ
);

104620 
sql™e3VdbeJumpH”e
(
v
, 
addrFœ¡
);

104621 
sql™e3Ex´CodeMove
(
pP¬£
, 
»gBa£
, 
»gP»vKey
, 
pSÜt
->
nOBS©
);

104622 
sql™e3VdbeJumpH”e
(
v
, 
addrJmp
);

104624 ifÐ
	gpSÜt
->
	gsÜtFÏgs
 & 
	gSORTFLAG_U£SÜ‹r
 ){

104625 
	gÝ
 = 
OP_SÜ‹rIn£¹
;

104627 
	gÝ
 = 
OP_IdxIn£¹
;

104629 
sql™e3VdbeAddOp2
(
v
, 
Ý
, 
pSÜt
->
iECursÜ
, 
»gRecÜd
);

104630 ifÐ
	gpS–eù
->
	giLim™
 ){

104631 
	gaddr1
, 
	gaddr2
;

104632 
	giLim™
;

104633 ifÐ
	gpS–eù
->
	giOff£t
 ){

104634 
	giLim™
 = 
pS–eù
->
iOff£t
+1;

104636 
	giLim™
 = 
pS–eù
->
iLim™
;

104638 
	gaddr1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfZ”o
, 
iLim™
); 
VdbeCov”age
(v);

104639 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 
iLim™
, -1);

104640 
	gaddr2
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

104641 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

104642 
sql™e3VdbeAddOp1
(
v
, 
OP_La¡
, 
pSÜt
->
iECursÜ
);

104643 
sql™e3VdbeAddOp1
(
v
, 
OP_D–‘e
, 
pSÜt
->
iECursÜ
);

104644 
sql™e3VdbeJumpH”e
(
v
, 
addr2
);

104651 
codeOff£t
(

104652 
Vdbe
 *
v
,

104653 
iOff£t
,

104654 
iCÚtšue


104656 ifÐ
	giOff£t
>0 ){

104657 
	gaddr
;

104658 
	gaddr
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_IfNeg
, 
iOff£t
, 0, -1); 
VdbeCov”age
(v);

104659 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
iCÚtšue
);

104660 
VdbeComm’t
((
v
, "skip OFFSET„ecords"));

104661 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

104674 
codeDi¡šù
(

104675 
P¬£
 *
pP¬£
,

104676 
iTab
,

104677 
addrR•—t
,

104678 
N
,

104679 
iMem


104681 
Vdbe
 *
	gv
;

104682 
	gr1
;

104684 
	gv
 = 
pP¬£
->
pVdbe
;

104685 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

104686 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
iTab
, 
addrR•—t
, 
iMem
, 
N
); 
VdbeCov”age
(v);

104687 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
iMem
, 
N
, 
r1
);

104688 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iTab
, 
r1
);

104689 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

104692 #iâdeà
SQLITE_OMIT_SUBQUERY


104700 
checkFÜMuÉiCÞumnS–eùE¼Ü
(

104701 
P¬£
 *
pP¬£
,

104702 
S–eùDe¡
 *
pDe¡
,

104703 
nEx´


104705 
	geDe¡
 = 
pDe¡
->
eDe¡
;

104706 ifÐ
	gnEx´
>1 && (
	geDe¡
==
SRT_Mem
 || 
eDe¡
==
SRT_S‘
) ){

104707 
sql™e3E¼ÜMsg
(
pP¬£
, "only‡ single„esult‡llowed for "

104725 
£ËùIÂ”LoÝ
(

104726 
P¬£
 *
pP¬£
,

104727 
S–eù
 *
p
,

104728 
Ex´Li¡
 *
pELi¡
,

104729 
¤cTab
,

104730 
SÜtCtx
 *
pSÜt
,

104731 
Di¡šùCtx
 *
pDi¡šù
,

104732 
S–eùDe¡
 *
pDe¡
,

104733 
iCÚtšue
,

104734 
iB»ak


104736 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

104737 
	gi
;

104738 
	ghasDi¡šù
;

104739 
	g»gResuÉ
;

104740 
	geDe¡
 = 
pDe¡
->
eDe¡
;

104741 
	giP¬m
 = 
pDe¡
->
iSDP¬m
;

104742 
	gnResuÉCÞ
;

104743 
	gnP»fixReg
 = 0;

104745 
as£¹
Ð
v
 );

104746 
as£¹
Ð
pELi¡
!=0 );

104747 
	ghasDi¡šù
 = 
pDi¡šù
 ?…Di¡šù->
eTnùTy³
 : 
WHERE_DISTINCT_NOOP
;

104748 ifÐ
	gpSÜt
 &&…SÜt->
	gpOrd”By
==0 ) 
pSÜt
 = 0;

104749 ifÐ
	gpSÜt
==0 && !
hasDi¡šù
 ){

104750 
as£¹
Ð
iCÚtšue
!=0 );

104751 
codeOff£t
(
v
, 
p
->
iOff£t
, 
iCÚtšue
);

104756 
	gnResuÉCÞ
 = 
pELi¡
->
nEx´
;

104758 ifÐ
	gpDe¡
->
	giSd¡
==0 ){

104759 ifÐ
pSÜt
 ){

104760 
nP»fixReg
 = 
pSÜt
->
pOrd”By
->
nEx´
;

104761 ifÐ!(
	gpSÜt
->
	gsÜtFÏgs
 & 
	gSORTFLAG_U£SÜ‹r
èè
	gnP»fixReg
++;

104762 
	gpP¬£
->
	gnMem
 +ð
nP»fixReg
;

104764 
	gpDe¡
->
	giSd¡
 = 
pP¬£
->
nMem
+1;

104765 
	gpP¬£
->
	gnMem
 +ð
nResuÉCÞ
;

104766 }ifÐ
	gpDe¡
->
	giSd¡
+
	gnResuÉCÞ
 > 
	gpP¬£
->
	gnMem
 ){

104772 
	gpP¬£
->
	gnMem
 +ð
nResuÉCÞ
;

104774 
	gpDe¡
->
	gnSd¡
 = 
nResuÉCÞ
;

104775 
	g»gResuÉ
 = 
pDe¡
->
iSd¡
;

104776 ifÐ
	g¤cTab
>=0 ){

104777 
i
=0; 
	gi
<
	gnResuÉCÞ
; i++){

104778 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
¤cTab
, 
i
, 
»gResuÉ
+i);

104779 
VdbeComm’t
((
v
, "%s", 
pELi¡
->
a
[
i
].
zName
));

104781 }ifÐ
	geDe¡
!=
SRT_Exi¡s
 ){

104785 
sql™e3Ex´CodeEx´Li¡
(
pP¬£
, 
pELi¡
, 
»gResuÉ
,

104786 (
eDe¡
==
SRT_Ouut
||eDe¡==
SRT_CÜoutše
)?
SQLITE_ECEL_DUP
:0);

104793 ifÐ
	ghasDi¡šù
 ){

104794  
	gpDi¡šù
->
	geTnùTy³
 ){

104795 
	gWHERE_DISTINCT_ORDERED
: {

104796 
VdbeOp
 *
pOp
;

104797 
	giJump
;

104798 
	g»gP»v
;

104801 
	g»gP»v
 = 
pP¬£
->
nMem
+1;

104802 
	gpP¬£
->
	gnMem
 +ð
nResuÉCÞ
;

104810 
sql™e3VdbeChªgeToNoÝ
(
v
, 
pDi¡šù
->
addrTnù
);

104811 
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, 
pDi¡šù
->
addrTnù
);

104812 
	gpOp
->
	gÝcode
 = 
OP_NuÎ
;

104813 
	gpOp
->
	gp1
 = 1;

104814 
	gpOp
->
	gp2
 = 
»gP»v
;

104816 
	giJump
 = 
sql™e3VdbeCu¼’tAddr
(
v
è+ 
nResuÉCÞ
;

104817 
	gi
=0; i<
	gnResuÉCÞ
; i++){

104818 
CÞlSeq
 *
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pELi¡
->
a
[
i
].
pEx´
);

104819 ifÐ
	gi
<
	gnResuÉCÞ
-1 ){

104820 
sql™e3VdbeAddOp3
(
v
, 
OP_Ne
, 
»gResuÉ
+
i
, 
iJump
, 
»gP»v
+i);

104821 
VdbeCov”age
(
v
);

104823 
sql™e3VdbeAddOp3
(
v
, 
OP_Eq
, 
»gResuÉ
+
i
, 
iCÚtšue
, 
»gP»v
+i);

104824 
VdbeCov”age
(
v
);

104826 
sql™e3VdbeChªgeP4
(
v
, -1, (cÚ¡ *)
pCÞl
, 
P4_COLLSEQ
);

104827 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_NULLEQ
);

104829 
as£¹
Ð
sql™e3VdbeCu¼’tAddr
(
v
)==
iJump
 || 
pP¬£
->
db
->
m®locFažed
 );

104830 
sql™e3VdbeAddOp3
(
v
, 
OP_CÝy
, 
»gResuÉ
, 
»gP»v
, 
nResuÉCÞ
-1);

104834 
	gWHERE_DISTINCT_UNIQUE
: {

104835 
sql™e3VdbeChªgeToNoÝ
(
v
, 
pDi¡šù
->
addrTnù
);

104840 
as£¹
Ð
pDi¡šù
->
eTnùTy³
==
WHERE_DISTINCT_UNORDERED
 );

104841 
codeDi¡šù
(
pP¬£
, 
pDi¡šù
->
bTnù
, 
iCÚtšue
, 
nResuÉCÞ
, 
»gResuÉ
);

104845 ifÐ
	gpSÜt
==0 ){

104846 
codeOff£t
(
v
, 
p
->
iOff£t
, 
iCÚtšue
);

104850  
	geDe¡
 ){

104854 #iâdeà
SQLITE_OMIT_COMPOUND_SELECT


104855 
	gSRT_UniÚ
: {

104856 
r1
;

104857 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

104858 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gResuÉ
, 
nResuÉCÞ
, 
r1
);

104859 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
, 
r1
);

104860 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

104868 
	gSRT_Exû±
: {

104869 
sql™e3VdbeAddOp3
(
v
, 
OP_IdxD–‘e
, 
iP¬m
, 
»gResuÉ
, 
nResuÉCÞ
);

104876 
	gSRT_Fifo
:

104877 
SRT_Di¡Fifo
:

104878 
SRT_TabË
:

104879 
SRT_EphemTab
: {

104880 
r1
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nP»fixReg
+1);

104881 
‹¡ÿ£
Ð
eDe¡
==
SRT_TabË
 );

104882 
‹¡ÿ£
Ð
eDe¡
==
SRT_EphemTab
 );

104883 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gResuÉ
, 
nResuÉCÞ
, 
r1
+
nP»fixReg
);

104884 #iâdeà
SQLITE_OMIT_CTE


104885 ifÐ
	geDe¡
==
SRT_Di¡Fifo
 ){

104891 
addr
 = 
sql™e3VdbeCu¼’tAddr
(
v
) + 4;

104892 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
iP¬m
+1, 
addr
, 
r1
, 0); 
VdbeCov”age
(v);

104893 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
+1, 
r1
);

104894 
as£¹
Ð
pSÜt
==0 );

104897 ifÐ
	gpSÜt
 ){

104898 
pushOÁoSÜ‹r
(
pP¬£
, 
pSÜt
, 
p
, 
r1
+
nP»fixReg
, 1,‚PrefixReg);

104900 
	gr2
 = 
sql™e3G‘TempReg
(
pP¬£
);

104901 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iP¬m
, 
r2
);

104902 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iP¬m
, 
r1
, 
r2
);

104903 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

104904 
sql™e3R–—£TempReg
(
pP¬£
, 
r2
);

104906 
sql™e3R–—£TempRªge
(
pP¬£
, 
r1
, 
nP»fixReg
+1);

104910 #iâdeà
SQLITE_OMIT_SUBQUERY


104915 
	gSRT_S‘
: {

104916 
as£¹
Ð
nResuÉCÞ
==1 );

104917 
	gpDe¡
->
	gaffSd¡
 =

104918 
sql™e3Com·»Affš™y
(
pELi¡
->
a
[0].
pEx´
, 
pDe¡
->
affSd¡
);

104919 ifÐ
	gpSÜt
 ){

104924 
pushOÁoSÜ‹r
(
pP¬£
, 
pSÜt
, 
p
, 
»gResuÉ
, 1, 
nP»fixReg
);

104926 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

104927 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gResuÉ
,1,
r1
, &
pDe¡
->
affSd¡
, 1);

104928 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gResuÉ
, 1);

104929 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
, 
r1
);

104930 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

104937 
	gSRT_Exi¡s
: {

104938 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
iP¬m
);

104947 
	gSRT_Mem
: {

104948 
as£¹
Ð
nResuÉCÞ
==1 );

104949 ifÐ
	gpSÜt
 ){

104950 
pushOÁoSÜ‹r
(
pP¬£
, 
pSÜt
, 
p
, 
»gResuÉ
, 1, 
nP»fixReg
);

104952 
as£¹
Ð
»gResuÉ
==
iP¬m
 );

104959 
	gSRT_CÜoutše
:

104960 
SRT_Ouut
: {

104961 
‹¡ÿ£
Ð
eDe¡
==
SRT_CÜoutše
 );

104962 
‹¡ÿ£
Ð
eDe¡
==
SRT_Ouut
 );

104963 ifÐ
	gpSÜt
 ){

104964 
pushOÁoSÜ‹r
(
pP¬£
, 
pSÜt
, 
p
, 
»gResuÉ
, 
nResuÉCÞ
, 
nP»fixReg
);

104965 }ifÐ
	geDe¡
==
SRT_CÜoutše
 ){

104966 
sql™e3VdbeAddOp1
(
v
, 
OP_Y›ld
, 
pDe¡
->
iSDP¬m
);

104968 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
»gResuÉ
, 
nResuÉCÞ
);

104969 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gResuÉ
, 
nResuÉCÞ
);

104974 #iâdeà
SQLITE_OMIT_CTE


104981 
	gSRT_Di¡Queue
:

104982 
SRT_Queue
: {

104983 
nKey
;

104984 
	gr1
, 
	gr2
, 
	gr3
;

104985 
	gaddrTe¡
 = 0;

104986 
Ex´Li¡
 *
	gpSO
;

104987 
	gpSO
 = 
pDe¡
->
pOrd”By
;

104988 
as£¹
Ð
pSO
 );

104989 
	gnKey
 = 
pSO
->
nEx´
;

104990 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

104991 
	gr2
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nKey
+2);

104992 
	gr3
 = 
r2
+
nKey
+1;

104993 ifÐ
	geDe¡
==
SRT_Di¡Queue
 ){

104997 
addrTe¡
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
iP¬m
+1, 0,

104998 
»gResuÉ
, 
nResuÉCÞ
);

104999 
VdbeCov”age
(
v
);

105001 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gResuÉ
, 
nResuÉCÞ
, 
r3
);

105002 ifÐ
	geDe¡
==
SRT_Di¡Queue
 ){

105003 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
+1, 
r3
);

105004 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_USESEEKRESULT
);

105006 
	gi
=0; i<
	gnKey
; i++){

105007 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
,

105008 
»gResuÉ
 + 
pSO
->
a
[
i
].
u
.
x
.
iOrd”ByCÞ
 - 1,

105009 
r2
+
i
);

105011 
sql™e3VdbeAddOp2
(
v
, 
OP_Sequ’û
, 
iP¬m
, 
r2
+
nKey
);

105012 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
r2
, 
nKey
+2, 
r1
);

105013 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
, 
r1
);

105014 ifÐ
	gaddrTe¡
 ) 
sql™e3VdbeJumpH”e
(
v
, 
addrTe¡
);

105015 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

105016 
sql™e3R–—£TempRªge
(
pP¬£
, 
r2
, 
nKey
+2);

105023 #ià!
defšed
(
SQLITE_OMIT_TRIGGER
)

105030 
as£¹
Ð
eDe¡
==
SRT_Disÿrd
 );

105040 ifÐ
	gpSÜt
==0 && 
p
->
iLim™
 ){

105041 
sql™e3VdbeAddOp3
(
v
, 
OP_IfZ”o
, 
p
->
iLim™
, 
iB»ak
, -1); 
VdbeCov”age
(v);

105049 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoAÎoc
(
sql™e3
 *
db
, 
N
, 
X
){

105050 
KeyInfo
 *
	gp
 = 
sql™e3DbM®locZ”o
(0,

105051 (
KeyInfo
è+ (
N
+
X
)*((
CÞlSeq
*)+1));

105052 ifÐ
	gp
 ){

105053 
	gp
->
	gaSÜtOrd”
 = (
u8
*)&
p
->
aCÞl
[
N
+
X
];

105054 
	gp
->
	gnF›ld
 = (
u16
)
N
;

105055 
	gp
->
	gnXF›ld
 = (
u16
)
X
;

105056 
	gp
->
	g’c
 = 
ENC
(
db
);

105057 
	gp
->
	gdb
 = 
db
;

105058 
	gp
->
	gnRef
 = 1;

105060 
	gdb
->
	gm®locFažed
 = 1;

105062  
	gp
;

105068 
SQLITE_PRIVATE
 
sql™e3KeyInfoUÄef
(
KeyInfo
 *
p
){

105069 ifÐ
	gp
 ){

105070 
as£¹
Ð
p
->
nRef
>0 );

105071 
	gp
->
	gnRef
--;

105072 ifÐ
	gp
->
	gnRef
==0 ) 
sql™e3DbF»e
(0, 
p
);

105079 
SQLITE_PRIVATE
 
KeyInfo
 *
sql™e3KeyInfoRef
(KeyInfØ*
p
){

105080 ifÐ
	gp
 ){

105081 
as£¹
Ð
p
->
nRef
>0 );

105082 
	gp
->
	gnRef
++;

105084  
	gp
;

105087 #ifdeà
SQLITE_DEBUG


105094 
SQLITE_PRIVATE
 
sql™e3KeyInfoIsWr™—bË
(
KeyInfo
 *
p
){  
	gp
->
	gnRef
==1; }

105111 
KeyInfo
 *
keyInfoFromEx´Li¡
(

105112 
P¬£
 *
pP¬£
,

105113 
Ex´Li¡
 *
pLi¡
,

105114 
iS¹
,

105115 
nExŒa


105117 
	gnEx´
;

105118 
KeyInfo
 *
	gpInfo
;

105119 
Ex´Li¡_™em
 *
	gpI‹m
;

105120 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105121 
	gi
;

105123 
	gnEx´
 = 
pLi¡
->
nEx´
;

105124 
	gpInfo
 = 
sql™e3KeyInfoAÎoc
(
db
, 
nEx´
+
nExŒa
-
iS¹
, 1);

105125 ifÐ
	gpInfo
 ){

105126 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pInfo
) );

105127 
	gi
=
iS¹
, 
	gpI‹m
=
pLi¡
->
a
+iS¹; i<
	gnEx´
; i++,…Item++){

105128 
CÞlSeq
 *
	gpCÞl
;

105129 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pI‹m
->
pEx´
);

105130 ifÐ!
	gpCÞl
 )…CÞÈð
db
->
pDætCÞl
;

105131 
	gpInfo
->
	gaCÞl
[
i
-
iS¹
] = 
pCÞl
;

105132 
	gpInfo
->
	gaSÜtOrd”
[
i
-
iS¹
] = 
pI‹m
->
sÜtOrd”
;

105135  
	gpInfo
;

105138 #iâdeà
SQLITE_OMIT_COMPOUND_SELECT


105142 cÚ¡ *
£ËùOpName
(
id
){

105143 *
	gz
;

105144  
	gid
 ){

105145 
	gTK_ALL
: 
z
 = "UNION ALL"; ;

105146 
	gTK_INTERSECT
: 
z
 = "INTERSECT"; ;

105147 
	gTK_EXCEPT
: 
z
 = "EXCEPT"; ;

105148 : 
z
 = "UNION"; ;

105150  
	gz
;

105154 #iâdeà
SQLITE_OMIT_EXPLAIN


105165 
ex¶ašTempTabË
(
P¬£
 *
pP¬£
, cÚ¡ *
zU§ge
){

105166 ifÐ
	gpP¬£
->
	gex¶aš
==2 ){

105167 
Vdbe
 *
v
 = 
pP¬£
->
pVdbe
;

105168 *
	gzMsg
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "USE TEMP B-TREE FOR %s", 
zU§ge
);

105169 
sql™e3VdbeAddOp4
(
v
, 
OP_Ex¶aš
, 
pP¬£
->
iS–eùId
, 0, 0, 
zMsg
, 
P4_DYNAMIC
);

105180 
	#ex¶ašS‘IÁeg”
(
a
, 
b
è¨ð
	)
b

105184 
	#ex¶ašTempTabË
(
y
,
z
)

	)

105185 
	#ex¶ašS‘IÁeg”
(
y
,
z
)

	)

105188 #ià!
defšed
(
SQLITE_OMIT_EXPLAIN
è&& !defšed(
SQLITE_OMIT_COMPOUND_SELECT
)

105203 
ex¶ašCompos™e
(

105204 
P¬£
 *
pP¬£
,

105205 
Ý
,

105206 
iSub1
,

105207 
iSub2
,

105208 
bU£Tmp


105210 
as£¹
Ð
Ý
==
TK_UNION
 || op==
TK_EXCEPT
 || op==
TK_INTERSECT
 || op==
TK_ALL
 );

105211 ifÐ
	gpP¬£
->
	gex¶aš
==2 ){

105212 
Vdbe
 *
v
 = 
pP¬£
->
pVdbe
;

105213 *
	gzMsg
 = 
sql™e3MPrštf
(

105214 
pP¬£
->
db
, "COMPOUND SUBQUERIES %d AND %d %s(%s)", 
iSub1
, 
iSub2
,

105215 
bU£Tmp
?"USING TEMP B-TREE ":"", 
£ËùOpName
(
Ý
)

105217 
sql™e3VdbeAddOp4
(
v
, 
OP_Ex¶aš
, 
pP¬£
->
iS–eùId
, 0, 0, 
zMsg
, 
P4_DYNAMIC
);

105222 
	#ex¶ašCompos™e
(
v
,
w
,
x
,
y
,
z
)

	)

105231 
g’”©eSÜtTaž
(

105232 
P¬£
 *
pP¬£
,

105233 
S–eù
 *
p
,

105234 
SÜtCtx
 *
pSÜt
,

105235 
nCÞumn
,

105236 
S–eùDe¡
 *
pDe¡


105238 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

105239 
	gaddrB»ak
 = 
sql™e3VdbeMakeLab–
(
v
);

105240 
	gaddrCÚtšue
 = 
sql™e3VdbeMakeLab–
(
v
);

105241 
	gaddr
;

105242 
	gaddrOnû
 = 0;

105243 
	giTab
;

105244 
Ex´Li¡
 *
	gpOrd”By
 = 
pSÜt
->
pOrd”By
;

105245 
	geDe¡
 = 
pDe¡
->
eDe¡
;

105246 
	giP¬m
 = 
pDe¡
->
iSDP¬m
;

105247 
	g»gRow
;

105248 
	g»gRowid
;

105249 
	gnKey
;

105250 
	giSÜtTab
;

105251 
	gnSÜtD©a
;

105252 
	gi
;

105253 
	gbSeq
;

105254 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


105255 
Ex´Li¡_™em
 *
	gaOutEx
 = 
p
->
pELi¡
->
a
;

105258 ifÐ
	gpSÜt
->
	gÏb–BkOut
 ){

105259 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
pSÜt
->
»gR‘uº
,…SÜt->
Ïb–BkOut
);

105260 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrB»ak
);

105261 
sql™e3VdbeResÞveLab–
(
v
, 
pSÜt
->
Ïb–BkOut
);

105263 
	giTab
 = 
pSÜt
->
iECursÜ
;

105264 ifÐ
	geDe¡
==
SRT_Ouut
 || 
eDe¡
==
SRT_CÜoutše
 ){

105265 
»gRowid
 = 0;

105266 
	g»gRow
 = 
pDe¡
->
iSd¡
;

105267 
	gnSÜtD©a
 = 
nCÞumn
;

105269 
	g»gRowid
 = 
sql™e3G‘TempReg
(
pP¬£
);

105270 
	g»gRow
 = 
sql™e3G‘TempReg
(
pP¬£
);

105271 
	gnSÜtD©a
 = 1;

105273 
	gnKey
 = 
pOrd”By
->
nEx´
 - 
pSÜt
->
nOBS©
;

105274 ifÐ
	gpSÜt
->
	gsÜtFÏgs
 & 
	gSORTFLAG_U£SÜ‹r
 ){

105275 
	g»gSÜtOut
 = ++
pP¬£
->
nMem
;

105276 
	giSÜtTab
 = 
pP¬£
->
nTab
++;

105277 ifÐ
	gpSÜt
->
	gÏb–BkOut
 ){

105278 
	gaddrOnû
 = 
sql™e3CodeOnû
(
pP¬£
); 
VdbeCov”age
(
v
);

105280 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nP£udo
, 
iSÜtTab
, 
»gSÜtOut
, 
nKey
+1+
nSÜtD©a
);

105281 ifÐ
	gaddrOnû
 ) 
sql™e3VdbeJumpH”e
(
v
, 
addrOnû
);

105282 
	gaddr
 = 1 + 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rSÜt
, 
iTab
, 
addrB»ak
);

105283 
VdbeCov”age
(
v
);

105284 
codeOff£t
(
v
, 
p
->
iOff£t
, 
addrCÚtšue
);

105285 
sql™e3VdbeAddOp3
(
v
, 
OP_SÜ‹rD©a
, 
iTab
, 
»gSÜtOut
, 
iSÜtTab
);

105286 
	gbSeq
 = 0;

105288 
	gaddr
 = 1 + 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜt
, 
iTab
, 
addrB»ak
); 
VdbeCov”age
(v);

105289 
codeOff£t
(
v
, 
p
->
iOff£t
, 
addrCÚtšue
);

105290 
	giSÜtTab
 = 
iTab
;

105291 
	gbSeq
 = 1;

105293 
	gi
=0; i<
	gnSÜtD©a
; i++){

105294 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iSÜtTab
, 
nKey
+
bSeq
+
i
, 
»gRow
+i);

105295 
VdbeComm’t
((
v
, "%s", 
aOutEx
[
i
].
zName
 ?‡OutEx[i].zNam:‡OutEx[i].
zS·n
));

105297  
	geDe¡
 ){

105298 
	gSRT_TabË
:

105299 
SRT_EphemTab
: {

105300 
‹¡ÿ£
Ð
eDe¡
==
SRT_TabË
 );

105301 
‹¡ÿ£
Ð
eDe¡
==
SRT_EphemTab
 );

105302 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
iP¬m
, 
»gRowid
);

105303 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
iP¬m
, 
»gRow
, 
»gRowid
);

105304 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

105307 #iâdeà
SQLITE_OMIT_SUBQUERY


105308 
	gSRT_S‘
: {

105309 
as£¹
Ð
nCÞumn
==1 );

105310 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
»gRow
, 1, 
»gRowid
,

105311 &
pDe¡
->
affSd¡
, 1);

105312 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gRow
, 1);

105313 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iP¬m
, 
»gRowid
);

105316 
	gSRT_Mem
: {

105317 
as£¹
Ð
nCÞumn
==1 );

105318 
sql™e3Ex´CodeMove
(
pP¬£
, 
»gRow
, 
iP¬m
, 1);

105324 
as£¹
Ð
eDe¡
==
SRT_Ouut
 ||ƒDe¡==
SRT_CÜoutše
 );

105325 
‹¡ÿ£
Ð
eDe¡
==
SRT_Ouut
 );

105326 
‹¡ÿ£
Ð
eDe¡
==
SRT_CÜoutše
 );

105327 ifÐ
	geDe¡
==
SRT_Ouut
 ){

105328 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
pDe¡
->
iSd¡
, 
nCÞumn
);

105329 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
pDe¡
->
iSd¡
, 
nCÞumn
);

105331 
sql™e3VdbeAddOp1
(
v
, 
OP_Y›ld
, 
pDe¡
->
iSDP¬m
);

105336 ifÐ
	g»gRowid
 ){

105337 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRow
);

105338 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRowid
);

105342 
sql™e3VdbeResÞveLab–
(
v
, 
addrCÚtšue
);

105343 ifÐ
	gpSÜt
->
	gsÜtFÏgs
 & 
	gSORTFLAG_U£SÜ‹r
 ){

105344 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rNext
, 
iTab
, 
addr
); 
VdbeCov”age
(v);

105346 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iTab
, 
addr
); 
VdbeCov”age
(v);

105348 ifÐ
	gpSÜt
->
	g»gR‘uº
 ) 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
pSÜt
->
»gR‘uº
);

105349 
sql™e3VdbeResÞveLab–
(
v
, 
addrB»ak
);

105376 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


105377 
	#cÞumnTy³
(
A
,
B
,
C
,
D
,
E
,
F
è
	`cÞumnTy³Im¶
(A,B,C,D,E,F)

	)

105378 cÚ¡ *
cÞumnTy³Im¶
(

105379 
NameCÚ‹xt
 *
pNC
,

105380 
Ex´
 *
pEx´
,

105381 cÚ¡ **
pzOrigDb
,

105382 cÚ¡ **
pzOrigTab
,

105383 cÚ¡ **
pzOrigCÞ
,

105384 
u8
 *
pE¡Width


105386 cÚ¡ *
	gzOrigDb
 = 0;

105387 cÚ¡ *
	gzOrigTab
 = 0;

105388 cÚ¡ *
	gzOrigCÞ
 = 0;

105390 
	#cÞumnTy³
(
A
,
B
,
C
,
D
,
E
,
F
è
	`cÞumnTy³Im¶
(A,B,F)

	)

105391 cÚ¡ *
cÞumnTy³Im¶
(

105392 
NameCÚ‹xt
 *
pNC
,

105393 
Ex´
 *
pEx´
,

105394 
u8
 *
pE¡Width


105397 cÚ¡ *
	gzTy³
 = 0;

105398 
	gj
;

105399 
u8
 
	ge¡Width
 = 1;

105401 ifÐ
NEVER
(
pEx´
==0è|| 
pNC
->
pSrcLi¡
==0 )  0;

105402  
	gpEx´
->
	gÝ
 ){

105403 
	gTK_AGG_COLUMN
:

105404 
TK_COLUMN
: {

105409 
TabË
 *
pTab
 = 0;

105410 
S–eù
 *
	gpS
 = 0;

105411 
	giCÞ
 = 
pEx´
->
iCÞumn
;

105412 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_AGG_COLUMN
 );

105413 
‹¡ÿ£
Ð
pEx´
->
Ý
==
TK_COLUMN
 );

105414  
	gpNC
 && !
	gpTab
 ){

105415 
SrcLi¡
 *
	gpTabLi¡
 = 
pNC
->
pSrcLi¡
;

105416 
	gj
=0;j<
	gpTabLi¡
->
	gnSrc
 &&…TabLi¡->
	ga
[
j
].
	giCursÜ
!=
pEx´
->
iTabË
;j++);

105417 ifÐ
	gj
<
	gpTabLi¡
->
	gnSrc
 ){

105418 
	gpTab
 = 
pTabLi¡
->
a
[
j
].
pTab
;

105419 
	gpS
 = 
pTabLi¡
->
a
[
j
].
pS–eù
;

105421 
	gpNC
 = 
pNC
->
pNext
;

105425 ifÐ
	gpTab
==0 ){

105446 
as£¹
Ð
pTab
 && 
pEx´
->pTab==pTab );

105447 ifÐ
	gpS
 ){

105452 ifÐ
	giCÞ
>=0 && 
ALWAYS
(
iCÞ
<
pS
->
pELi¡
->
nEx´
) ){

105457 
NameCÚ‹xt
 
sNC
;

105458 
Ex´
 *
	gp
 = 
pS
->
pELi¡
->
a
[
iCÞ
].
pEx´
;

105459 
	gsNC
.
	gpSrcLi¡
 = 
pS
->
pSrc
;

105460 
	gsNC
.
	gpNext
 = 
pNC
;

105461 
	gsNC
.
	gpP¬£
 = 
pNC
->
pP¬£
;

105462 
	gzTy³
 = 
cÞumnTy³
(&
sNC
, 
p
,&
zOrigDb
,&
zOrigTab
,&
zOrigCÞ
, &
e¡Width
);

105464 }ifÐ
	gpTab
->
	gpSchema
 ){

105466 
as£¹
Ð!
pS
 );

105467 ifÐ
	giCÞ
<0 ) iCÞ = 
pTab
->
iPKey
;

105468 
as£¹
Ð
iCÞ
==-1 || (iCÞ>=0 && iCÞ<
pTab
->
nCÞ
) );

105469 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


105470 ifÐ
	giCÞ
<0 ){

105471 
	gzTy³
 = "INTEGER";

105472 
	gzOrigCÞ
 = "rowid";

105474 
	gzTy³
 = 
pTab
->
aCÞ
[
iCÞ
].
zTy³
;

105475 
	gzOrigCÞ
 = 
pTab
->
aCÞ
[
iCÞ
].
zName
;

105476 
	ge¡Width
 = 
pTab
->
aCÞ
[
iCÞ
].
szE¡
;

105478 
	gzOrigTab
 = 
pTab
->
zName
;

105479 ifÐ
	gpNC
->
	gpP¬£
 ){

105480 
	giDb
 = 
sql™e3SchemaToIndex
(
pNC
->
pP¬£
->
db
, 
pTab
->
pSchema
);

105481 
	gzOrigDb
 = 
pNC
->
pP¬£
->
db
->
aDb
[
iDb
].
zName
;

105484 ifÐ
	giCÞ
<0 ){

105485 
	gzTy³
 = "INTEGER";

105487 
	gzTy³
 = 
pTab
->
aCÞ
[
iCÞ
].
zTy³
;

105488 
	ge¡Width
 = 
pTab
->
aCÞ
[
iCÞ
].
szE¡
;

105494 #iâdeà
SQLITE_OMIT_SUBQUERY


105495 
	gTK_SELECT
: {

105500 
NameCÚ‹xt
 
sNC
;

105501 
S–eù
 *
	gpS
 = 
pEx´
->
x
.
pS–eù
;

105502 
Ex´
 *
	gp
 = 
pS
->
pELi¡
->
a
[0].
pEx´
;

105503 
as£¹
Ð
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) );

105504 
	gsNC
.
	gpSrcLi¡
 = 
pS
->
pSrc
;

105505 
	gsNC
.
	gpNext
 = 
pNC
;

105506 
	gsNC
.
	gpP¬£
 = 
pNC
->
pP¬£
;

105507 
	gzTy³
 = 
cÞumnTy³
(&
sNC
, 
p
, &
zOrigDb
, &
zOrigTab
, &
zOrigCÞ
, &
e¡Width
);

105513 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


105514 ifÐ
	gpzOrigDb
 ){

105515 
as£¹
Ð
pzOrigTab
 && 
pzOrigCÞ
 );

105516 *
	gpzOrigDb
 = 
zOrigDb
;

105517 *
	gpzOrigTab
 = 
zOrigTab
;

105518 *
	gpzOrigCÞ
 = 
zOrigCÞ
;

105521 ifÐ
	gpE¡Width
 ) *pE¡Width = 
e¡Width
;

105522  
	gzTy³
;

105529 
g’”©eCÞumnTy³s
(

105530 
P¬£
 *
pP¬£
,

105531 
SrcLi¡
 *
pTabLi¡
,

105532 
Ex´Li¡
 *
pELi¡


105534 #iâdeà
SQLITE_OMIT_DECLTYPE


105535 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

105536 
	gi
;

105537 
NameCÚ‹xt
 
	gsNC
;

105538 
	gsNC
.
	gpSrcLi¡
 = 
pTabLi¡
;

105539 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

105540 
	gi
=0; i<
	gpELi¡
->
	gnEx´
; i++){

105541 
Ex´
 *
	gp
 = 
pELi¡
->
a
[
i
].
pEx´
;

105542 cÚ¡ *
	gzTy³
;

105543 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


105544 cÚ¡ *
	gzOrigDb
 = 0;

105545 cÚ¡ *
	gzOrigTab
 = 0;

105546 cÚ¡ *
	gzOrigCÞ
 = 0;

105547 
	gzTy³
 = 
cÞumnTy³
(&
sNC
, 
p
, &
zOrigDb
, &
zOrigTab
, &
zOrigCÞ
, 0);

105553 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_DATABASE
, 
zOrigDb
, 
SQLITE_TRANSIENT
);

105554 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_TABLE
, 
zOrigTab
, 
SQLITE_TRANSIENT
);

105555 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_COLUMN
, 
zOrigCÞ
, 
SQLITE_TRANSIENT
);

105557 
	gzTy³
 = 
cÞumnTy³
(&
sNC
, 
p
, 0, 0, 0, 0);

105559 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_DECLTYPE
, 
zTy³
, 
SQLITE_TRANSIENT
);

105569 
g’”©eCÞumnNames
(

105570 
P¬£
 *
pP¬£
,

105571 
SrcLi¡
 *
pTabLi¡
,

105572 
Ex´Li¡
 *
pELi¡


105574 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

105575 
	gi
, 
	gj
;

105576 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105577 
	gfuÎNames
, 
	gshÜtNames
;

105579 #iâdeà
SQLITE_OMIT_EXPLAIN


105581 ifÐ
	gpP¬£
->
	gex¶aš
 ){

105586 ifÐ
	gpP¬£
->
	gcÞNamesS‘
 || 
NEVER
(
v
==0è|| 
db
->
m®locFažed
 ) ;

105587 
	gpP¬£
->
	gcÞNamesS‘
 = 1;

105588 
	gfuÎNames
 = (
db
->
æags
 & 
SQLITE_FuÎCÞNames
)!=0;

105589 
	gshÜtNames
 = (
db
->
æags
 & 
SQLITE_ShÜtCÞNames
)!=0;

105590 
sql™e3VdbeS‘NumCÞs
(
v
, 
pELi¡
->
nEx´
);

105591 
	gi
=0; i<
	gpELi¡
->
	gnEx´
; i++){

105592 
Ex´
 *
	gp
;

105593 
	gp
 = 
pELi¡
->
a
[
i
].
pEx´
;

105594 ifÐ
NEVER
(
p
==0) ) ;

105595 ifÐ
	gpELi¡
->
	ga
[
i
].
	gzName
 ){

105596 *
	gzName
 = 
pELi¡
->
a
[
i
].
zName
;

105597 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_NAME
, 
zName
, 
SQLITE_TRANSIENT
);

105598 }ifÐ(
	gp
->
	gÝ
==
TK_COLUMN
 || 
p
->
Ý
==
TK_AGG_COLUMN
è&& 
pTabLi¡
 ){

105599 
TabË
 *
pTab
;

105600 *
	gzCÞ
;

105601 
	giCÞ
 = 
p
->
iCÞumn
;

105602 
	gj
=0; 
ALWAYS
(
j
<
pTabLi¡
->
nSrc
); j++){

105603 ifÐ
	gpTabLi¡
->
	ga
[
j
].
	giCursÜ
==
p
->
iTabË
 ) ;

105605 
as£¹
Ð
j
<
pTabLi¡
->
nSrc
 );

105606 
	gpTab
 = 
pTabLi¡
->
a
[
j
].
pTab
;

105607 ifÐ
	giCÞ
<0 ) iCÞ = 
pTab
->
iPKey
;

105608 
as£¹
Ð
iCÞ
==-1 || (iCÞ>=0 && iCÞ<
pTab
->
nCÞ
) );

105609 ifÐ
	giCÞ
<0 ){

105610 
	gzCÞ
 = "rowid";

105612 
	gzCÞ
 = 
pTab
->
aCÞ
[
iCÞ
].
zName
;

105614 ifÐ!
	gshÜtNames
 && !
	gfuÎNames
 ){

105615 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_NAME
,

105616 
sql™e3DbSŒDup
(
db
, 
pELi¡
->
a
[
i
].
zS·n
), 
SQLITE_DYNAMIC
);

105617 }ifÐ
	gfuÎNames
 ){

105618 *
	gzName
 = 0;

105619 
	gzName
 = 
sql™e3MPrštf
(
db
, "%s.%s", 
pTab
->
zName
, 
zCÞ
);

105620 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_NAME
, 
zName
, 
SQLITE_DYNAMIC
);

105622 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_NAME
, 
zCÞ
, 
SQLITE_TRANSIENT
);

105625 cÚ¡ *
	gz
 = 
pELi¡
->
a
[
i
].
zS·n
;

105626 
	gz
 = 
z
==0 ? 
sql™e3MPrštf
(
db
, "cÞumn%d", 
i
+1è: 
sql™e3DbSŒDup
(db, z);

105627 
sql™e3VdbeS‘CÞName
(
v
, 
i
, 
COLNAME_NAME
, 
z
, 
SQLITE_DYNAMIC
);

105630 
g’”©eCÞumnTy³s
(
pP¬£
, 
pTabLi¡
, 
pELi¡
);

105646 
£ËùCÞumnsFromEx´Li¡
(

105647 
P¬£
 *
pP¬£
,

105648 
Ex´Li¡
 *
pELi¡
,

105649 
i16
 *
²CÞ
,

105650 
CÞumn
 **
·CÞ


105652 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105653 
	gi
, 
	gj
;

105654 
	gút
;

105655 
CÞumn
 *
	gaCÞ
, *
	gpCÞ
;

105656 
	gnCÞ
;

105657 
Ex´
 *
	gp
;

105658 *
	gzName
;

105659 
	gnName
;

105661 ifÐ
	gpELi¡
 ){

105662 
	gnCÞ
 = 
pELi¡
->
nEx´
;

105663 
	gaCÞ
 = 
sql™e3DbM®locZ”o
(
db
, (
aCÞ
[0])*
nCÞ
);

105664 
‹¡ÿ£
Ð
aCÞ
==0 );

105666 
	gnCÞ
 = 0;

105667 
	gaCÞ
 = 0;

105669 *
	g²CÞ
 = 
nCÞ
;

105670 *
	g·CÞ
 = 
aCÞ
;

105672 
	gi
=0, 
	gpCÞ
=
aCÞ
; i<
	gnCÞ
; i++,…Col++){

105675 
	gp
 = 
sql™e3Ex´SkCÞÏ‹
(
pELi¡
->
a
[
i
].
pEx´
);

105676 ifÐ(
	gzName
 = 
pELi¡
->
a
[
i
].
zName
)!=0 ){

105678 
zName
 = 
sql™e3DbSŒDup
(
db
, zName);

105680 
Ex´
 *
	gpCÞEx´
 = 
p
;

105681 
TabË
 *
	gpTab
;

105682  
	gpCÞEx´
->
	gÝ
==
TK_DOT
 ){

105683 
pCÞEx´
 =…CÞEx´->
pRight
;

105684 
as£¹
Ð
pCÞEx´
!=0 );

105686 ifÐ
	gpCÞEx´
->
	gÝ
==
TK_COLUMN
 && 
ALWAYS
(
pCÞEx´
->
pTab
!=0) ){

105688 
iCÞ
 = 
pCÞEx´
->
iCÞumn
;

105689 
	gpTab
 = 
pCÞEx´
->
pTab
;

105690 ifÐ
	giCÞ
<0 ) iCÞ = 
pTab
->
iPKey
;

105691 
	gzName
 = 
sql™e3MPrštf
(
db
, "%s",

105692 
iCÞ
>=0 ? 
pTab
->
aCÞ
[iCÞ].
zName
 : "rowid");

105693 }ifÐ
	gpCÞEx´
->
	gÝ
==
TK_ID
 ){

105694 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pCÞEx´
, 
EP_IÁV®ue
) );

105695 
	gzName
 = 
sql™e3MPrštf
(
db
, "%s", 
pCÞEx´
->
u
.
zTok’
);

105698 
	gzName
 = 
sql™e3MPrštf
(
db
, "%s", 
pELi¡
->
a
[
i
].
zS·n
);

105701 ifÐ
	gdb
->
	gm®locFažed
 ){

105702 
sql™e3DbF»e
(
db
, 
zName
);

105709 
	gnName
 = 
sql™e3SŒËn30
(
zName
);

105710 
	gj
=
út
=0; j<
	gi
; j++){

105711 ifÐ
sql™e3SŒICmp
(
aCÞ
[
j
].
zName
, zName)==0 ){

105712 *
zNewName
;

105713 
	gk
;

105714 
	gk
=
nName
-1; k>1 && 
sql™e3Isdig™
(
zName
[
k
]); k--){}

105715 ifÐ
	gk
>=0 && 
zName
[
k
]==':' ) 
nName
 = k;

105716 
	gzName
[
nName
] = 0;

105717 
	gzNewName
 = 
sql™e3MPrštf
(
db
, "%s:%d", 
zName
, ++
út
);

105718 
sql™e3DbF»e
(
db
, 
zName
);

105719 
	gzName
 = 
zNewName
;

105720 
	gj
 = -1;

105721 ifÐ
	gzName
==0 ) ;

105724 
	gpCÞ
->
	gzName
 = 
zName
;

105726 ifÐ
	gdb
->
	gm®locFažed
 ){

105727 
	gj
=0; j<
	gi
; j++){

105728 
sql™e3DbF»e
(
db
, 
aCÞ
[
j
].
zName
);

105730 
sql™e3DbF»e
(
db
, 
aCÞ
);

105731 *
	g·CÞ
 = 0;

105732 *
	g²CÞ
 = 0;

105733  
	gSQLITE_NOMEM
;

105735  
	gSQLITE_OK
;

105749 
£ËùAddCÞumnTy³AndCÞÏtiÚ
(

105750 
P¬£
 *
pP¬£
,

105751 
TabË
 *
pTab
,

105752 
S–eù
 *
pS–eù


105754 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105755 
NameCÚ‹xt
 
	gsNC
;

105756 
CÞumn
 *
	gpCÞ
;

105757 
CÞlSeq
 *
	gpCÞl
;

105758 
	gi
;

105759 
Ex´
 *
	gp
;

105760 
Ex´Li¡_™em
 *
	ga
;

105761 
u64
 
	gszAÎ
 = 0;

105763 
as£¹
Ð
pS–eù
!=0 );

105764 
as£¹
Ð(
pS–eù
->
£lFÏgs
 & 
SF_ResÞved
)!=0 );

105765 
as£¹
Ð
pTab
->
nCÞ
==
pS–eù
->
pELi¡
->
nEx´
 || 
db
->
m®locFažed
 );

105766 ifÐ
	gdb
->
	gm®locFažed
 ) ;

105767 
mem£t
(&
sNC
, 0, (sNC));

105768 
	gsNC
.
	gpSrcLi¡
 = 
pS–eù
->
pSrc
;

105769 
	ga
 = 
pS–eù
->
pELi¡
->
a
;

105770 
	gi
=0, 
	gpCÞ
=
pTab
->
aCÞ
; i<
	gpTab
->
	gnCÞ
; i++,…Col++){

105771 
	gp
 = 
a
[
i
].
pEx´
;

105772 
	gpCÞ
->
	gzTy³
 = 
sql™e3DbSŒDup
(
db
, 
cÞumnTy³
(&
sNC
, 
p
,0,0,0, &
pCÞ
->
szE¡
));

105773 
	gszAÎ
 +ð
pCÞ
->
szE¡
;

105774 
	gpCÞ
->
	gaffš™y
 = 
sql™e3Ex´Affš™y
(
p
);

105775 ifÐ
	gpCÞ
->
	gaffš™y
==0 ) 
pCÞ
->
affš™y
 = 
SQLITE_AFF_NONE
;

105776 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
p
);

105777 ifÐ
	gpCÞl
 ){

105778 
	gpCÞ
->
	gzCÞl
 = 
sql™e3DbSŒDup
(
db
, 
pCÞl
->
zName
);

105781 
	gpTab
->
	gszTabRow
 = 
sql™e3LogE¡
(
szAÎ
*4);

105788 
SQLITE_PRIVATE
 
TabË
 *
sql™e3ResuÉS‘OfS–eù
(
P¬£
 *
pP¬£
, 
S–eù
 *
pS–eù
){

105789 
TabË
 *
	gpTab
;

105790 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105791 
	g§vedFÏgs
;

105793 
	g§vedFÏgs
 = 
db
->
æags
;

105794 
	gdb
->
	gæags
 &ð~
SQLITE_FuÎCÞNames
;

105795 
	gdb
->
	gæags
 |ð
SQLITE_ShÜtCÞNames
;

105796 
sql™e3S–eùP»p
(
pP¬£
, 
pS–eù
, 0);

105797 ifÐ
	gpP¬£
->
	gnE¼
 )  0;

105798  
	gpS–eù
->
	gpPriÜ
 )…S–eù = 
pS–eù
->
pPriÜ
;

105799 
	gdb
->
	gæags
 = 
§vedFÏgs
;

105800 
	gpTab
 = 
sql™e3DbM®locZ”o
(
db
, (
TabË
) );

105801 ifÐ
	gpTab
==0 ){

105806 
as£¹
Ð
db
->
lookaside
.
bEÇbËd
==0 );

105807 
	gpTab
->
	gnRef
 = 1;

105808 
	gpTab
->
	gzName
 = 0;

105809 
	gpTab
->
	gnRowLogE¡
 = 200; 
as£¹
Ð200==
sql™e3LogE¡
(1048576) );

105810 
£ËùCÞumnsFromEx´Li¡
(
pP¬£
, 
pS–eù
->
pELi¡
, &
pTab
->
nCÞ
, &pTab->
aCÞ
);

105811 
£ËùAddCÞumnTy³AndCÞÏtiÚ
(
pP¬£
, 
pTab
, 
pS–eù
);

105812 
	gpTab
->
	giPKey
 = -1;

105813 ifÐ
	gdb
->
	gm®locFažed
 ){

105814 
sql™e3D–‘eTabË
(
db
, 
pTab
);

105817  
	gpTab
;

105824 
SQLITE_PRIVATE
 
Vdbe
 *
sql™e3G‘Vdbe
(
P¬£
 *
pP¬£
){

105825 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

105826 ifÐ
	gv
==0 ){

105827 
v
 = 
pP¬£
->
pVdbe
 = 
sql™e3VdbeC»©e
(pParse);

105828 ifÐ
	gv
 ) 
sql™e3VdbeAddOp0
(
v
, 
OP_In™
);

105829 ifÐ
	gpP¬£
->
	gpTÝËv–
==0

105830 && 
O±imiz©iÚEÇbËd
(
pP¬£
->
db
,
SQLITE_FaùÜOutCÚ¡
)

105832 
	gpP¬£
->
	gokCÚ¡FaùÜ
 = 1;

105836  
	gv
;

105863 
compu‹Lim™Regi¡”s
(
P¬£
 *
pP¬£
, 
S–eù
 *
p
, 
iB»ak
){

105864 
Vdbe
 *
	gv
 = 0;

105865 
	giLim™
 = 0;

105866 
	giOff£t
;

105867 
	gaddr1
, 
	gn
;

105868 ifÐ
	gp
->
	giLim™
 ) ;

105876 
sql™e3Ex´CacheCË¬
(
pP¬£
);

105877 
as£¹
Ð
p
->
pOff£t
==0 ||…->
pLim™
!=0 );

105878 ifÐ
	gp
->
	gpLim™
 ){

105879 
	gp
->
	giLim™
 = 
iLim™
 = ++
pP¬£
->
nMem
;

105880 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

105881 
as£¹
Ð
v
!=0 );

105882 ifÐ
sql™e3Ex´IsIÁeg”
(
p
->
pLim™
, &
n
) ){

105883 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
n
, 
iLim™
);

105884 
VdbeComm’t
((
v
, "LIMIT counter"));

105885 ifÐ
	gn
==0 ){

105886 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
iB»ak
);

105887 }ifÐ
	gn
>=0 && 
p
->
nS–eùRow
>(
u64
)
n
 ){

105888 
p
->
nS–eùRow
 = 
n
;

105891 
sql™e3Ex´Code
(
pP¬£
, 
p
->
pLim™
, 
iLim™
);

105892 
sql™e3VdbeAddOp1
(
v
, 
OP_Mu¡BeIÁ
, 
iLim™
); 
VdbeCov”age
(v);

105893 
VdbeComm’t
((
v
, "LIMIT counter"));

105894 
sql™e3VdbeAddOp2
(
v
, 
OP_IfZ”o
, 
iLim™
, 
iB»ak
); 
VdbeCov”age
(v);

105896 ifÐ
	gp
->
	gpOff£t
 ){

105897 
	gp
->
	giOff£t
 = 
iOff£t
 = ++
pP¬£
->
nMem
;

105898 
	gpP¬£
->
	gnMem
++;

105899 
sql™e3Ex´Code
(
pP¬£
, 
p
->
pOff£t
, 
iOff£t
);

105900 
sql™e3VdbeAddOp1
(
v
, 
OP_Mu¡BeIÁ
, 
iOff£t
); 
VdbeCov”age
(v);

105901 
VdbeComm’t
((
v
, "OFFSET counter"));

105902 
	gaddr1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 
iOff£t
); 
VdbeCov”age
(v);

105903 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
iOff£t
);

105904 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

105905 
sql™e3VdbeAddOp3
(
v
, 
OP_Add
, 
iLim™
, 
iOff£t
, iOffset+1);

105906 
VdbeComm’t
((
v
, "LIMIT+OFFSET"));

105907 
	gaddr1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 
iLim™
); 
VdbeCov”age
(v);

105908 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, -1, 
iOff£t
+1);

105909 
sql™e3VdbeJumpH”e
(
v
, 
addr1
);

105914 #iâdeà
SQLITE_OMIT_COMPOUND_SELECT


105923 
CÞlSeq
 *
muÉiS–eùCÞlSeq
(
P¬£
 *
pP¬£
, 
S–eù
 *
p
, 
iCÞ
){

105924 
CÞlSeq
 *
	gpR‘
;

105925 ifÐ
	gp
->
	gpPriÜ
 ){

105926 
	gpR‘
 = 
muÉiS–eùCÞlSeq
(
pP¬£
, 
p
->
pPriÜ
, 
iCÞ
);

105928 
	gpR‘
 = 0;

105930 
as£¹
Ð
iCÞ
>=0 );

105931 ifÐ
	gpR‘
==0 && 
iCÞ
<
p
->
pELi¡
->
nEx´
 ){

105932 
pR‘
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
p
->
pELi¡
->
a
[
iCÞ
].
pEx´
);

105934  
	gpR‘
;

105946 
KeyInfo
 *
muÉiS–eùOrd”ByKeyInfo
(
P¬£
 *
pP¬£
, 
S–eù
 *
p
, 
nExŒa
){

105947 
Ex´Li¡
 *
	gpOrd”By
 = 
p
->
pOrd”By
;

105948 
	gnOrd”By
 = 
p
->
pOrd”By
->
nEx´
;

105949 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

105950 
KeyInfo
 *
	gpR‘
 = 
sql™e3KeyInfoAÎoc
(
db
, 
nOrd”By
+
nExŒa
, 1);

105951 ifÐ
	gpR‘
 ){

105952 
	gi
;

105953 
	gi
=0; i<
	gnOrd”By
; i++){

105954 
Ex´Li¡_™em
 *
	gpI‹m
 = &
pOrd”By
->
a
[
i
];

105955 
Ex´
 *
	gpT”m
 = 
pI‹m
->
pEx´
;

105956 
CÞlSeq
 *
	gpCÞl
;

105958 ifÐ
	gpT”m
->
	gæags
 & 
	gEP_CÞÏ‹
 ){

105959 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pT”m
);

105961 
	gpCÞl
 = 
muÉiS–eùCÞlSeq
(
pP¬£
, 
p
, 
pI‹m
->
u
.
x
.
iOrd”ByCÞ
-1);

105962 ifÐ
	gpCÞl
==0 ) 
pCÞl
 = 
db
->
pDætCÞl
;

105963 
	gpOrd”By
->
	ga
[
i
].
	gpEx´
 =

105964 
sql™e3Ex´AddCÞÏ‹SŒšg
(
pP¬£
, 
pT”m
, 
pCÞl
->
zName
);

105966 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pR‘
) );

105967 
	gpR‘
->
	gaCÞl
[
i
] = 
pCÞl
;

105968 
	gpR‘
->
	gaSÜtOrd”
[
i
] = 
pOrd”By
->
a
[i].
sÜtOrd”
;

105972  
	gpR‘
;

105975 #iâdeà
SQLITE_OMIT_CTE


106012 
g’”©eW™hRecursiveQu”y
(

106013 
P¬£
 *
pP¬£
,

106014 
S–eù
 *
p
,

106015 
S–eùDe¡
 *
pDe¡


106017 
SrcLi¡
 *
	gpSrc
 = 
p
->
pSrc
;

106018 
	gnCÞ
 = 
p
->
pELi¡
->
nEx´
;

106019 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

106020 
S–eù
 *
	gpS‘up
 = 
p
->
pPriÜ
;

106021 
	gaddrTÝ
;

106022 
	gaddrCÚt
, 
	gaddrB»ak
;

106023 
	giCu¼’t
 = 0;

106024 
	g»gCu¼’t
;

106025 
	giQueue
;

106026 
	giDi¡šù
 = 0;

106027 
	geDe¡
 = 
SRT_Fifo
;

106028 
S–eùDe¡
 
	gde¡Queue
;

106029 
	gi
;

106030 
	grc
;

106031 
Ex´Li¡
 *
	gpOrd”By
;

106032 
Ex´
 *
	gpLim™
, *
	gpOff£t
;

106033 
	g»gLim™
, 
	g»gOff£t
;

106036 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_RECURSIVE
, 0, 0, 0) ) ;

106039 
	gaddrB»ak
 = 
sql™e3VdbeMakeLab–
(
v
);

106040 
compu‹Lim™Regi¡”s
(
pP¬£
, 
p
, 
addrB»ak
);

106041 
	gpLim™
 = 
p
->
pLim™
;

106042 
	gpOff£t
 = 
p
->
pOff£t
;

106043 
	g»gLim™
 = 
p
->
iLim™
;

106044 
	g»gOff£t
 = 
p
->
iOff£t
;

106045 
	gp
->
	gpLim™
 = 
p
->
pOff£t
 = 0;

106046 
	gp
->
	giLim™
 = 
p
->
iOff£t
 = 0;

106047 
	gpOrd”By
 = 
p
->
pOrd”By
;

106050 
	gi
=0; 
ALWAYS
(
i
<
pSrc
->
nSrc
); i++){

106051 ifÐ
	gpSrc
->
	ga
[
i
].
	gisRecursive
 ){

106052 
	giCu¼’t
 = 
pSrc
->
a
[
i
].
iCursÜ
;

106060 
	giQueue
 = 
pP¬£
->
nTab
++;

106061 ifÐ
	gp
->
	gÝ
==
TK_UNION
 ){

106062 
eDe¡
 = 
pOrd”By
 ? 
SRT_Di¡Queue
 : 
SRT_Di¡Fifo
;

106063 
	giDi¡šù
 = 
pP¬£
->
nTab
++;

106065 
	geDe¡
 = 
pOrd”By
 ? 
SRT_Queue
 : 
SRT_Fifo
;

106067 
sql™e3S–eùDe¡In™
(&
de¡Queue
, 
eDe¡
, 
iQueue
);

106070 
	g»gCu¼’t
 = ++
pP¬£
->
nMem
;

106071 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nP£udo
, 
iCu¼’t
, 
»gCu¼’t
, 
nCÞ
);

106072 ifÐ
	gpOrd”By
 ){

106073 
KeyInfo
 *
	gpKeyInfo
 = 
muÉiS–eùOrd”ByKeyInfo
(
pP¬£
, 
p
, 1);

106074 
sql™e3VdbeAddOp4
(
v
, 
OP_O³nEphem”®
, 
iQueue
, 
pOrd”By
->
nEx´
+2, 0,

106075 (*)
pKeyInfo
, 
P4_KEYINFO
);

106076 
	gde¡Queue
.
	gpOrd”By
 = 
pOrd”By
;

106078 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
iQueue
, 
nCÞ
);

106080 
VdbeComm’t
((
v
, "Queueable"));

106081 ifÐ
	giDi¡šù
 ){

106082 
	gp
->
	gaddrO³nEphm
[0] = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
iDi¡šù
, 0);

106083 
	gp
->
	g£lFÏgs
 |ð
SF_U£sEphem”®
;

106087 
	gp
->
	gpOrd”By
 = 0;

106090 
	gpS‘up
->
	gpNext
 = 0;

106091 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
pS‘up
, &
de¡Queue
);

106092 
	gpS‘up
->
	gpNext
 = 
p
;

106093 ifÐ
	grc
 ) 
	g’d_of_»cursive_qu”y
;

106096 
	gaddrTÝ
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iQueue
, 
addrB»ak
); 
VdbeCov”age
(v);

106099 
sql™e3VdbeAddOp1
(
v
, 
OP_NuÎRow
, 
iCu¼’t
);

106100 ifÐ
	gpOrd”By
 ){

106101 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iQueue
, 
pOrd”By
->
nEx´
+1, 
»gCu¼’t
);

106103 
sql™e3VdbeAddOp2
(
v
, 
OP_RowD©a
, 
iQueue
, 
»gCu¼’t
);

106105 
sql™e3VdbeAddOp1
(
v
, 
OP_D–‘e
, 
iQueue
);

106108 
	gaddrCÚt
 = 
sql™e3VdbeMakeLab–
(
v
);

106109 
codeOff£t
(
v
, 
»gOff£t
, 
addrCÚt
);

106110 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
,…->
pELi¡
, 
iCu¼’t
,

106111 0, 0, 
pDe¡
, 
addrCÚt
, 
addrB»ak
);

106112 ifÐ
	g»gLim™
 ){

106113 
sql™e3VdbeAddOp3
(
v
, 
OP_IfZ”o
, 
»gLim™
, 
addrB»ak
, -1);

106114 
VdbeCov”age
(
v
);

106116 
sql™e3VdbeResÞveLab–
(
v
, 
addrCÚt
);

106121 
	gp
->
	gpPriÜ
 = 0;

106122 
sql™e3S–eù
(
pP¬£
, 
p
, &
de¡Queue
);

106123 
as£¹
Ð
p
->
pPriÜ
==0 );

106124 
	gp
->
	gpPriÜ
 = 
pS‘up
;

106127 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrTÝ
);

106128 
sql™e3VdbeResÞveLab–
(
v
, 
addrB»ak
);

106130 
	g’d_of_»cursive_qu”y
:

106131 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
p
->
pOrd”By
);

106132 
	gp
->
	gpOrd”By
 = 
pOrd”By
;

106133 
	gp
->
	gpLim™
 = 
pLim™
;

106134 
	gp
->
	gpOff£t
 = 
pOff£t
;

106140 
muÉiS–eùOrd”By
(

106141 
P¬£
 *
pP¬£
,

106142 
S–eù
 *
p
,

106143 
S–eùDe¡
 *
pDe¡


106178 
muÉiS–eù
(

106179 
P¬£
 *
pP¬£
,

106180 
S–eù
 *
p
,

106181 
S–eùDe¡
 *
pDe¡


106183 
	grc
 = 
SQLITE_OK
;

106184 
S–eù
 *
	gpPriÜ
;

106185 
Vdbe
 *
	gv
;

106186 
S–eùDe¡
 
	gde¡
;

106187 
S–eù
 *
	gpD–‘e
 = 0;

106188 
sql™e3
 *
	gdb
;

106189 #iâdeà
SQLITE_OMIT_EXPLAIN


106190 
	giSub1
 = 0;

106191 
	giSub2
 = 0;

106197 
as£¹
Ð
p
 &&…->
pPriÜ
 );

106198 
as£¹
Ð(
p
->
£lFÏgs
 & 
SF_Recursive
)==0 ||…->
Ý
==
TK_ALL
 ||…->Ý==
TK_UNION
 );

106199 
	gdb
 = 
pP¬£
->
db
;

106200 
	gpPriÜ
 = 
p
->
pPriÜ
;

106201 
	gde¡
 = *
pDe¡
;

106202 ifÐ
	gpPriÜ
->
	gpOrd”By
 ){

106203 
sql™e3E¼ÜMsg
(
pP¬£
,"ORDER BY clause should come‡fter %s‚ot before",

106204 
£ËùOpName
(
p
->
Ý
));

106205 
	grc
 = 1;

106206 
	gmuÉi_£Ëù_’d
;

106208 ifÐ
	gpPriÜ
->
	gpLim™
 ){

106209 
sql™e3E¼ÜMsg
(
pP¬£
,"LIMIT clause should come‡fter %s‚ot before",

106210 
£ËùOpName
(
p
->
Ý
));

106211 
	grc
 = 1;

106212 
	gmuÉi_£Ëù_’d
;

106215 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

106216 
as£¹
Ð
v
!=0 );

106220 ifÐ
	gde¡
.
	geDe¡
==
SRT_EphemTab
 ){

106221 
as£¹
Ð
p
->
pELi¡
 );

106222 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
de¡
.
iSDP¬m
, 
p
->
pELi¡
->
nEx´
);

106223 
sql™e3VdbeChªgeP5
(
v
, 
BTREE_UNORDERED
);

106224 
	gde¡
.
	geDe¡
 = 
SRT_TabË
;

106230 
as£¹
Ð
p
->
pELi¡
 && 
pPriÜ
->pEList );

106231 ifÐ
	gp
->
	gpELi¡
->
	gnEx´
!=
pPriÜ
->
pELi¡
->
nEx´
 ){

106232 ifÐ
p
->
£lFÏgs
 & 
SF_V®ues
 ){

106233 
sql™e3E¼ÜMsg
(
pP¬£
, "all VALUES must havehe same‚umber oferms");

106235 
sql™e3E¼ÜMsg
(
pP¬£
, "SELECTsohe†eft‡nd„ight of %s"

106236 " dØnÙ havth§mnumb” oà»suÉ cÞumns", 
£ËùOpName
(
p
->
Ý
));

106238 
	grc
 = 1;

106239 
	gmuÉi_£Ëù_’d
;

106242 #iâdeà
SQLITE_OMIT_CTE


106243 ifÐ
	gp
->
	g£lFÏgs
 & 
	gSF_Recursive
 ){

106244 
g’”©eW™hRecursiveQu”y
(
pP¬£
, 
p
, &
de¡
);

106250 ifÐ
	gp
->
	gpOrd”By
 ){

106251  
muÉiS–eùOrd”By
(
pP¬£
, 
p
, 
pDe¡
);

106256  
	gp
->
	gÝ
 ){

106257 
	gTK_ALL
: {

106258 
addr
 = 0;

106259 
	gnLim™
;

106260 
as£¹
Ð!
pPriÜ
->
pLim™
 );

106261 
	gpPriÜ
->
	giLim™
 = 
p
->
iLim™
;

106262 
	gpPriÜ
->
	giOff£t
 = 
p
->
iOff£t
;

106263 
	gpPriÜ
->
	gpLim™
 = 
p
->
pLim™
;

106264 
	gpPriÜ
->
	gpOff£t
 = 
p
->
pOff£t
;

106265 
ex¶ašS‘IÁeg”
(
iSub1
, 
pP¬£
->
iNextS–eùId
);

106266 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
pPriÜ
, &
de¡
);

106267 
	gp
->
	gpLim™
 = 0;

106268 
	gp
->
	gpOff£t
 = 0;

106269 ifÐ
	grc
 ){

106270 
	gmuÉi_£Ëù_’d
;

106272 
	gp
->
	gpPriÜ
 = 0;

106273 
	gp
->
	giLim™
 = 
pPriÜ
->
iLim™
;

106274 
	gp
->
	giOff£t
 = 
pPriÜ
->
iOff£t
;

106275 ifÐ
	gp
->
	giLim™
 ){

106276 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfZ”o
, 
p
->
iLim™
); 
VdbeCov”age
(v);

106277 
VdbeComm’t
((
v
, "Jump‡head if LIMIT„eached"));

106279 
ex¶ašS‘IÁeg”
(
iSub2
, 
pP¬£
->
iNextS–eùId
);

106280 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
p
, &
de¡
);

106281 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

106282 
	gpD–‘e
 = 
p
->
pPriÜ
;

106283 
	gp
->
	gpPriÜ
 = 
pPriÜ
;

106284 
	gp
->
	gnS–eùRow
 +ð
pPriÜ
->
nS–eùRow
;

106285 ifÐ
	gpPriÜ
->
	gpLim™


106286 && 
sql™e3Ex´IsIÁeg”
(
pPriÜ
->
pLim™
, &
nLim™
)

106287 && 
	gnLim™
>0 && 
	gp
->
	gnS–eùRow
 > (
	gu64
)nLimit

106289 
	gp
->
	gnS–eùRow
 = 
nLim™
;

106291 ifÐ
	gaddr
 ){

106292 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

106296 
	gTK_EXCEPT
:

106297 
TK_UNION
: {

106298 
uniÚTab
;

106299 
u8
 
	gÝ
 = 0;

106300 
	g´iÜOp
;

106301 
Ex´
 *
	gpLim™
, *
	gpOff£t
;

106302 
	gaddr
;

106303 
S–eùDe¡
 
	guniÚde¡
;

106305 
‹¡ÿ£
Ð
p
->
Ý
==
TK_EXCEPT
 );

106306 
‹¡ÿ£
Ð
p
->
Ý
==
TK_UNION
 );

106307 
	g´iÜOp
 = 
SRT_UniÚ
;

106308 ifÐ
	gde¡
.
	geDe¡
==
´iÜOp
 ){

106312 
as£¹
Ð
p
->
pLim™
==0 );

106313 
as£¹
Ð
p
->
pOff£t
==0 );

106314 
	guniÚTab
 = 
de¡
.
iSDP¬m
;

106319 
	guniÚTab
 = 
pP¬£
->
nTab
++;

106320 
as£¹
Ð
p
->
pOrd”By
==0 );

106321 
	gaddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
uniÚTab
, 0);

106322 
as£¹
Ð
p
->
addrO³nEphm
[0] == -1 );

106323 
	gp
->
	gaddrO³nEphm
[0] = 
addr
;

106324 
fšdRightmo¡
(
p
)->
	g£lFÏgs
 |ð
SF_U£sEphem”®
;

106325 
as£¹
Ð
p
->
pELi¡
 );

106330 
as£¹
Ð!
pPriÜ
->
pOrd”By
 );

106331 
sql™e3S–eùDe¡In™
(&
uniÚde¡
, 
´iÜOp
, 
uniÚTab
);

106332 
ex¶ašS‘IÁeg”
(
iSub1
, 
pP¬£
->
iNextS–eùId
);

106333 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
pPriÜ
, &
uniÚde¡
);

106334 ifÐ
	grc
 ){

106335 
	gmuÉi_£Ëù_’d
;

106340 ifÐ
	gp
->
	gÝ
==
TK_EXCEPT
 ){

106341 
Ý
 = 
SRT_Exû±
;

106343 
as£¹
Ð
p
->
Ý
==
TK_UNION
 );

106344 
	gÝ
 = 
SRT_UniÚ
;

106346 
	gp
->
	gpPriÜ
 = 0;

106347 
	gpLim™
 = 
p
->
pLim™
;

106348 
	gp
->
	gpLim™
 = 0;

106349 
	gpOff£t
 = 
p
->
pOff£t
;

106350 
	gp
->
	gpOff£t
 = 0;

106351 
	guniÚde¡
.
	geDe¡
 = 
Ý
;

106352 
ex¶ašS‘IÁeg”
(
iSub2
, 
pP¬£
->
iNextS–eùId
);

106353 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
p
, &
uniÚde¡
);

106354 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

106357 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
pOrd”By
);

106358 
	gpD–‘e
 = 
p
->
pPriÜ
;

106359 
	gp
->
	gpPriÜ
 = 
pPriÜ
;

106360 
	gp
->
	gpOrd”By
 = 0;

106361 ifÐ
	gp
->
	gÝ
==
TK_UNION
 ) 
p
->
nS–eùRow
 +ð
pPriÜ
->nSelectRow;

106362 
sql™e3Ex´D–‘e
(
db
, 
p
->
pLim™
);

106363 
	gp
->
	gpLim™
 = 
pLim™
;

106364 
	gp
->
	gpOff£t
 = 
pOff£t
;

106365 
	gp
->
	giLim™
 = 0;

106366 
	gp
->
	giOff£t
 = 0;

106371 
as£¹
Ð
uniÚTab
==
de¡
.
iSDP¬m
 || de¡.
eDe¡
!=
´iÜOp
 );

106372 ifÐ
	gde¡
.
	geDe¡
!=
´iÜOp
 ){

106373 
iCÚt
, 
iB»ak
, 
iS¹
;

106374 
as£¹
Ð
p
->
pELi¡
 );

106375 ifÐ
	gde¡
.
	geDe¡
==
SRT_Ouut
 ){

106376 
S–eù
 *
pFœ¡
 = 
p
;

106377  
	gpFœ¡
->
	gpPriÜ
 )…Fœ¡ = 
pFœ¡
->
pPriÜ
;

106378 
g’”©eCÞumnNames
(
pP¬£
, 0, 
pFœ¡
->
pELi¡
);

106380 
	giB»ak
 = 
sql™e3VdbeMakeLab–
(
v
);

106381 
	giCÚt
 = 
sql™e3VdbeMakeLab–
(
v
);

106382 
compu‹Lim™Regi¡”s
(
pP¬£
, 
p
, 
iB»ak
);

106383 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
uniÚTab
, 
iB»ak
); 
VdbeCov”age
(v);

106384 
	giS¹
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

106385 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
,…->
pELi¡
, 
uniÚTab
,

106386 0, 0, &
de¡
, 
iCÚt
, 
iB»ak
);

106387 
sql™e3VdbeResÞveLab–
(
v
, 
iCÚt
);

106388 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
uniÚTab
, 
iS¹
); 
VdbeCov”age
(v);

106389 
sql™e3VdbeResÞveLab–
(
v
, 
iB»ak
);

106390 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
uniÚTab
, 0);

106394 : 
as£¹
Ð
p
->
Ý
==
TK_INTERSECT
 ); {

106395 
	gb1
, 
	gb2
;

106396 
	giCÚt
, 
	giB»ak
, 
	giS¹
;

106397 
Ex´
 *
	gpLim™
, *
	gpOff£t
;

106398 
	gaddr
;

106399 
S–eùDe¡
 
	gš‹r£ùde¡
;

106400 
	gr1
;

106406 
	gb1
 = 
pP¬£
->
nTab
++;

106407 
	gb2
 = 
pP¬£
->
nTab
++;

106408 
as£¹
Ð
p
->
pOrd”By
==0 );

106410 
	gaddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
b1
, 0);

106411 
as£¹
Ð
p
->
addrO³nEphm
[0] == -1 );

106412 
	gp
->
	gaddrO³nEphm
[0] = 
addr
;

106413 
fšdRightmo¡
(
p
)->
	g£lFÏgs
 |ð
SF_U£sEphem”®
;

106414 
as£¹
Ð
p
->
pELi¡
 );

106418 
sql™e3S–eùDe¡In™
(&
š‹r£ùde¡
, 
SRT_UniÚ
, 
b1
);

106419 
ex¶ašS‘IÁeg”
(
iSub1
, 
pP¬£
->
iNextS–eùId
);

106420 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
pPriÜ
, &
š‹r£ùde¡
);

106421 ifÐ
	grc
 ){

106422 
	gmuÉi_£Ëù_’d
;

106427 
	gaddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
b2
, 0);

106428 
as£¹
Ð
p
->
addrO³nEphm
[1] == -1 );

106429 
	gp
->
	gaddrO³nEphm
[1] = 
addr
;

106430 
	gp
->
	gpPriÜ
 = 0;

106431 
	gpLim™
 = 
p
->
pLim™
;

106432 
	gp
->
	gpLim™
 = 0;

106433 
	gpOff£t
 = 
p
->
pOff£t
;

106434 
	gp
->
	gpOff£t
 = 0;

106435 
	gš‹r£ùde¡
.
	giSDP¬m
 = 
b2
;

106436 
ex¶ašS‘IÁeg”
(
iSub2
, 
pP¬£
->
iNextS–eùId
);

106437 
	grc
 = 
sql™e3S–eù
(
pP¬£
, 
p
, &
š‹r£ùde¡
);

106438 
‹¡ÿ£
Ð
rc
!=
SQLITE_OK
 );

106439 
	gpD–‘e
 = 
p
->
pPriÜ
;

106440 
	gp
->
	gpPriÜ
 = 
pPriÜ
;

106441 ifÐ
	gp
->
	gnS–eùRow
>
	gpPriÜ
->nS–eùRow )…->nS–eùRow = 
pPriÜ
->
nS–eùRow
;

106442 
sql™e3Ex´D–‘e
(
db
, 
p
->
pLim™
);

106443 
	gp
->
	gpLim™
 = 
pLim™
;

106444 
	gp
->
	gpOff£t
 = 
pOff£t
;

106449 
as£¹
Ð
p
->
pELi¡
 );

106450 ifÐ
	gde¡
.
	geDe¡
==
SRT_Ouut
 ){

106451 
S–eù
 *
pFœ¡
 = 
p
;

106452  
	gpFœ¡
->
	gpPriÜ
 )…Fœ¡ = 
pFœ¡
->
pPriÜ
;

106453 
g’”©eCÞumnNames
(
pP¬£
, 0, 
pFœ¡
->
pELi¡
);

106455 
	giB»ak
 = 
sql™e3VdbeMakeLab–
(
v
);

106456 
	giCÚt
 = 
sql™e3VdbeMakeLab–
(
v
);

106457 
compu‹Lim™Regi¡”s
(
pP¬£
, 
p
, 
iB»ak
);

106458 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
b1
, 
iB»ak
); 
VdbeCov”age
(v);

106459 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

106460 
	giS¹
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_RowKey
, 
b1
, 
r1
);

106461 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
b2
, 
iCÚt
, 
r1
, 0); 
VdbeCov”age
(v);

106462 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

106463 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
,…->
pELi¡
, 
b1
,

106464 0, 0, &
de¡
, 
iCÚt
, 
iB»ak
);

106465 
sql™e3VdbeResÞveLab–
(
v
, 
iCÚt
);

106466 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
b1
, 
iS¹
); 
VdbeCov”age
(v);

106467 
sql™e3VdbeResÞveLab–
(
v
, 
iB»ak
);

106468 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
b2
, 0);

106469 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
b1
, 0);

106474 
ex¶ašCompos™e
(
pP¬£
, 
p
->
Ý
, 
iSub1
, 
iSub2
,…->Ý!=
TK_ALL
);

106485 ifÐ
	gp
->
	g£lFÏgs
 & 
	gSF_U£sEphem”®
 ){

106486 
	gi
;

106487 
KeyInfo
 *
	gpKeyInfo
;

106488 
S–eù
 *
	gpLoÝ
;

106489 
CÞlSeq
 **
	g­CÞl
;

106490 
	gnCÞ
;

106492 
as£¹
Ð
p
->
pNext
==0 );

106493 
	gnCÞ
 = 
p
->
pELi¡
->
nEx´
;

106494 
	gpKeyInfo
 = 
sql™e3KeyInfoAÎoc
(
db
, 
nCÞ
, 1);

106495 ifÐ!
	gpKeyInfo
 ){

106496 
	grc
 = 
SQLITE_NOMEM
;

106497 
	gmuÉi_£Ëù_’d
;

106499 
	gi
=0, 
	g­CÞl
=
pKeyInfo
->
aCÞl
; i<
	gnCÞ
; i++,‡pColl++){

106500 *
	g­CÞl
 = 
muÉiS–eùCÞlSeq
(
pP¬£
, 
p
, 
i
);

106501 ifÐ0==*
­CÞl
 ){

106502 *
­CÞl
 = 
db
->
pDætCÞl
;

106506 
	gpLoÝ
=
p
;…LoÝ;…LoÝ=
pLoÝ
->
pPriÜ
){

106507 
i
=0; 
	gi
<2; i++){

106508 
	gaddr
 = 
pLoÝ
->
addrO³nEphm
[
i
];

106509 ifÐ
	gaddr
<0 ){

106512 
as£¹
Ð
pLoÝ
->
addrO³nEphm
[1]<0 );

106515 
sql™e3VdbeChªgeP2
(
v
, 
addr
, 
nCÞ
);

106516 
sql™e3VdbeChªgeP4
(
v
, 
addr
, (*)
sql™e3KeyInfoRef
(
pKeyInfo
),

106517 
P4_KEYINFO
);

106518 
	gpLoÝ
->
	gaddrO³nEphm
[
i
] = -1;

106521 
sql™e3KeyInfoUÄef
(
pKeyInfo
);

106524 
	gmuÉi_£Ëù_’d
:

106525 
pDe¡
->
iSd¡
 = 
de¡
.iSdst;

106526 
	gpDe¡
->
	gnSd¡
 = 
de¡
.
nSd¡
;

106527 
sql™e3S–eùD–‘e
(
db
, 
pD–‘e
);

106528  
	grc
;

106552 
g’”©eOuutSubroutše
(

106553 
P¬£
 *
pP¬£
,

106554 
S–eù
 *
p
,

106555 
S–eùDe¡
 *
pIn
,

106556 
S–eùDe¡
 *
pDe¡
,

106557 
»gR‘uº
,

106558 
»gP»v
,

106559 
KeyInfo
 *
pKeyInfo
,

106560 
iB»ak


106562 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

106563 
	giCÚtšue
;

106564 
	gaddr
;

106566 
	gaddr
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

106567 
	giCÚtšue
 = 
sql™e3VdbeMakeLab–
(
v
);

106571 ifÐ
	g»gP»v
 ){

106572 
	gj1
, 
	gj2
;

106573 
	gj1
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfNÙ
, 
»gP»v
); 
VdbeCov”age
(v);

106574 
	gj2
 = 
sql™e3VdbeAddOp4
(
v
, 
OP_Com·»
, 
pIn
->
iSd¡
, 
»gP»v
+1,…In->
nSd¡
,

106575 (*)
sql™e3KeyInfoRef
(
pKeyInfo
), 
P4_KEYINFO
);

106576 
sql™e3VdbeAddOp3
(
v
, 
OP_Jump
, 
j2
+2, 
iCÚtšue
, j2+2); 
VdbeCov”age
(v);

106577 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

106578 
sql™e3VdbeAddOp3
(
v
, 
OP_CÝy
, 
pIn
->
iSd¡
, 
»gP»v
+1,…In->
nSd¡
-1);

106579 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
»gP»v
);

106581 ifÐ
	gpP¬£
->
	gdb
->
	gm®locFažed
 )  0;

106585 
codeOff£t
(
v
, 
p
->
iOff£t
, 
iCÚtšue
);

106587  
	gpDe¡
->
	geDe¡
 ){

106590 
	gSRT_TabË
:

106591 
SRT_EphemTab
: {

106592 
r1
 = 
sql™e3G‘TempReg
(
pP¬£
);

106593 
	gr2
 = 
sql™e3G‘TempReg
(
pP¬£
);

106594 
‹¡ÿ£
Ð
pDe¡
->
eDe¡
==
SRT_TabË
 );

106595 
‹¡ÿ£
Ð
pDe¡
->
eDe¡
==
SRT_EphemTab
 );

106596 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
pIn
->
iSd¡
,…In->
nSd¡
, 
r1
);

106597 
sql™e3VdbeAddOp2
(
v
, 
OP_NewRowid
, 
pDe¡
->
iSDP¬m
, 
r2
);

106598 
sql™e3VdbeAddOp3
(
v
, 
OP_In£¹
, 
pDe¡
->
iSDP¬m
, 
r1
, 
r2
);

106599 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_APPEND
);

106600 
sql™e3R–—£TempReg
(
pP¬£
, 
r2
);

106601 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

106605 #iâdeà
SQLITE_OMIT_SUBQUERY


106610 
	gSRT_S‘
: {

106611 
r1
;

106612 
as£¹
Ð
pIn
->
nSd¡
==1 );

106613 
	gpDe¡
->
	gaffSd¡
 =

106614 
sql™e3Com·»Affš™y
(
p
->
pELi¡
->
a
[0].
pEx´
, 
pDe¡
->
affSd¡
);

106615 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

106616 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
pIn
->
iSd¡
, 1, 
r1
, &
pDe¡
->
affSd¡
,1);

106617 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
pIn
->
iSd¡
, 1);

106618 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
pDe¡
->
iSDP¬m
, 
r1
);

106619 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

106626 
	gSRT_Exi¡s
: {

106627 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
pDe¡
->
iSDP¬m
);

106637 
	gSRT_Mem
: {

106638 
as£¹
Ð
pIn
->
nSd¡
==1 );

106639 
sql™e3Ex´CodeMove
(
pP¬£
, 
pIn
->
iSd¡
, 
pDe¡
->
iSDP¬m
, 1);

106648 
	gSRT_CÜoutše
: {

106649 ifÐ
pDe¡
->
iSd¡
==0 ){

106650 
pDe¡
->
iSd¡
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
pIn
->
nSd¡
);

106651 
	gpDe¡
->
	gnSd¡
 = 
pIn
->
nSd¡
;

106653 
sql™e3Ex´CodeMove
(
pP¬£
, 
pIn
->
iSd¡
, 
pDe¡
->iSd¡,…De¡->
nSd¡
);

106654 
sql™e3VdbeAddOp1
(
v
, 
OP_Y›ld
, 
pDe¡
->
iSDP¬m
);

106667 
as£¹
Ð
pDe¡
->
eDe¡
==
SRT_Ouut
 );

106668 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
pIn
->
iSd¡
,…In->
nSd¡
);

106669 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
pIn
->
iSd¡
,…In->
nSd¡
);

106676 ifÐ
	gp
->
	giLim™
 ){

106677 
sql™e3VdbeAddOp3
(
v
, 
OP_IfZ”o
, 
p
->
iLim™
, 
iB»ak
, -1); 
VdbeCov”age
(v);

106682 
sql™e3VdbeResÞveLab–
(
v
, 
iCÚtšue
);

106683 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
»gR‘uº
);

106685  
	gaddr
;

106773 #iâdeà
SQLITE_OMIT_COMPOUND_SELECT


106774 
muÉiS–eùOrd”By
(

106775 
P¬£
 *
pP¬£
,

106776 
S–eù
 *
p
,

106777 
S–eùDe¡
 *
pDe¡


106779 
	gi
, 
	gj
;

106780 
S–eù
 *
	gpPriÜ
;

106781 
Vdbe
 *
	gv
;

106782 
S–eùDe¡
 
	gde¡A
;

106783 
S–eùDe¡
 
	gde¡B
;

106784 
	g»gAddrA
;

106785 
	g»gAddrB
;

106786 
	gaddrS–eùA
;

106787 
	gaddrS–eùB
;

106788 
	g»gOutA
;

106789 
	g»gOutB
;

106790 
	gaddrOutA
;

106791 
	gaddrOutB
 = 0;

106792 
	gaddrEofA
;

106793 
	gaddrEofA_noB
;

106794 
	gaddrEofB
;

106795 
	gaddrAÉB
;

106796 
	gaddrAeqB
;

106797 
	gaddrAgtB
;

106798 
	g»gLim™A
;

106799 
	g»gLim™B
;

106800 
	g»gP»v
;

106801 
	g§vedLim™
;

106802 
	g§vedOff£t
;

106803 
	gÏb–Cm´
;

106804 
	gÏb–End
;

106805 
	gj1
;

106806 
	gÝ
;

106807 
KeyInfo
 *
	gpKeyDup
 = 0;

106808 
KeyInfo
 *
	gpKeyM”ge
;

106809 
sql™e3
 *
	gdb
;

106810 
Ex´Li¡
 *
	gpOrd”By
;

106811 
	gnOrd”By
;

106812 *
	gaP”mu‹
;

106813 #iâdeà
SQLITE_OMIT_EXPLAIN


106814 
	giSub1
;

106815 
	giSub2
;

106818 
as£¹
Ð
p
->
pOrd”By
!=0 );

106819 
as£¹
Ð
pKeyDup
==0 );

106820 
	gdb
 = 
pP¬£
->
db
;

106821 
	gv
 = 
pP¬£
->
pVdbe
;

106822 
as£¹
Ð
v
!=0 );

106823 
	gÏb–End
 = 
sql™e3VdbeMakeLab–
(
v
);

106824 
	gÏb–Cm´
 = 
sql™e3VdbeMakeLab–
(
v
);

106829 
	gÝ
 = 
p
->
Ý
;

106830 
	gpPriÜ
 = 
p
->
pPriÜ
;

106831 
as£¹
Ð
pPriÜ
->
pOrd”By
==0 );

106832 
	gpOrd”By
 = 
p
->
pOrd”By
;

106833 
as£¹
Ð
pOrd”By
 );

106834 
	gnOrd”By
 = 
pOrd”By
->
nEx´
;

106840 ifÐ
	gÝ
!=
TK_ALL
 ){

106841 
i
=1; 
	gdb
->
	gm®locFažed
==0 && i<=
p
->
pELi¡
->
nEx´
; 
	gi
++){

106842 
Ex´Li¡_™em
 *
	gpI‹m
;

106843 
	gj
=0, 
	gpI‹m
=
pOrd”By
->
a
; j<
	gnOrd”By
; j++,…Item++){

106844 
as£¹
Ð
pI‹m
->
u
.
x
.
iOrd”ByCÞ
>0 );

106845 ifÐ
	gpI‹m
->
	gu
.
	gx
.
	giOrd”ByCÞ
==
i
 ) ;

106847 ifÐ
	gj
==
nOrd”By
 ){

106848 
Ex´
 *
pNew
 = 
sql™e3Ex´
(
db
, 
TK_INTEGER
, 0);

106849 ifÐ
	gpNew
==0 )  
SQLITE_NOMEM
;

106850 
	gpNew
->
	gæags
 |ð
EP_IÁV®ue
;

106851 
	gpNew
->
	gu
.
	giV®ue
 = 
i
;

106852 
	gpOrd”By
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pOrd”By
, 
pNew
);

106853 ifÐ
	gpOrd”By
 )…Ord”By->
	ga
[
nOrd”By
++].
	gu
.
	gx
.
	giOrd”ByCÞ
 = (
u16
)
i
;

106865 
	gaP”mu‹
 = 
sql™e3DbM®locRaw
(
db
, ()*
nOrd”By
);

106866 ifÐ
	gaP”mu‹
 ){

106867 
Ex´Li¡_™em
 *
	gpI‹m
;

106868 
	gi
=0, 
	gpI‹m
=
pOrd”By
->
a
; i<
	gnOrd”By
; i++,…Item++){

106869 
as£¹
Ð
pI‹m
->
u
.
x
.
iOrd”ByCÞ
>0

106870 && 
pI‹m
->
u
.
x
.
iOrd”ByCÞ
<=
p
->
pELi¡
->
nEx´
 );

106871 
	gaP”mu‹
[
i
] = 
pI‹m
->
u
.
x
.
iOrd”ByCÞ
 - 1;

106873 
	gpKeyM”ge
 = 
muÉiS–eùOrd”ByKeyInfo
(
pP¬£
, 
p
, 1);

106875 
	gpKeyM”ge
 = 0;

106880 
	gp
->
	gpOrd”By
 = 
pOrd”By
;

106881 
	gpPriÜ
->
	gpOrd”By
 = 
sql™e3Ex´Li¡Dup
(
pP¬£
->
db
, 
pOrd”By
, 0);

106887 ifÐ
	gÝ
==
TK_ALL
 ){

106888 
»gP»v
 = 0;

106890 
	gnEx´
 = 
p
->
pELi¡
->
nEx´
;

106891 
as£¹
Ð
nOrd”By
>=
nEx´
 || 
db
->
m®locFažed
 );

106892 
	g»gP»v
 = 
pP¬£
->
nMem
+1;

106893 
	gpP¬£
->
	gnMem
 +ð
nEx´
+1;

106894 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gP»v
);

106895 
	gpKeyDup
 = 
sql™e3KeyInfoAÎoc
(
db
, 
nEx´
, 1);

106896 ifÐ
	gpKeyDup
 ){

106897 
as£¹
Ð
sql™e3KeyInfoIsWr™—bË
(
pKeyDup
) );

106898 
	gi
=0; i<
	gnEx´
; i++){

106899 
	gpKeyDup
->
	gaCÞl
[
i
] = 
muÉiS–eùCÞlSeq
(
pP¬£
, 
p
, i);

106900 
	gpKeyDup
->
	gaSÜtOrd”
[
i
] = 0;

106907 
	gp
->
	gpPriÜ
 = 0;

106908 
	gpPriÜ
->
	gpNext
 = 0;

106909 
sql™e3ResÞveOrd”GroupBy
(
pP¬£
, 
p
,…->
pOrd”By
, "ORDER");

106910 ifÐ
	gpPriÜ
->pPrior==0 ){

106911 
sql™e3ResÞveOrd”GroupBy
(
pP¬£
, 
pPriÜ
,…PriÜ->
pOrd”By
, "ORDER");

106915 
compu‹Lim™Regi¡”s
(
pP¬£
, 
p
, 
Ïb–End
);

106916 ifÐ
	gp
->
	giLim™
 && 
	gÝ
==
TK_ALL
 ){

106917 
»gLim™A
 = ++
pP¬£
->
nMem
;

106918 
	g»gLim™B
 = ++
pP¬£
->
nMem
;

106919 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
p
->
iOff£t
 ?…->iOff£t+1 :…->
iLim™
,

106920 
»gLim™A
);

106921 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
»gLim™A
, 
»gLim™B
);

106923 
	g»gLim™A
 = 
»gLim™B
 = 0;

106925 
sql™e3Ex´D–‘e
(
db
, 
p
->
pLim™
);

106926 
	gp
->
	gpLim™
 = 0;

106927 
sql™e3Ex´D–‘e
(
db
, 
p
->
pOff£t
);

106928 
	gp
->
	gpOff£t
 = 0;

106930 
	g»gAddrA
 = ++
pP¬£
->
nMem
;

106931 
	g»gAddrB
 = ++
pP¬£
->
nMem
;

106932 
	g»gOutA
 = ++
pP¬£
->
nMem
;

106933 
	g»gOutB
 = ++
pP¬£
->
nMem
;

106934 
sql™e3S–eùDe¡In™
(&
de¡A
, 
SRT_CÜoutše
, 
»gAddrA
);

106935 
sql™e3S–eùDe¡In™
(&
de¡B
, 
SRT_CÜoutše
, 
»gAddrB
);

106940 
	gaddrS–eùA
 = 
sql™e3VdbeCu¼’tAddr
(
v
) + 1;

106941 
	gj1
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_In™CÜoutše
, 
»gAddrA
, 0, 
addrS–eùA
);

106942 
VdbeComm’t
((
v
, "left SELECT"));

106943 
	gpPriÜ
->
	giLim™
 = 
»gLim™A
;

106944 
ex¶ašS‘IÁeg”
(
iSub1
, 
pP¬£
->
iNextS–eùId
);

106945 
sql™e3S–eù
(
pP¬£
, 
pPriÜ
, &
de¡A
);

106946 
sql™e3VdbeAddOp1
(
v
, 
OP_EndCÜoutše
, 
»gAddrA
);

106947 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

106952 
	gaddrS–eùB
 = 
sql™e3VdbeCu¼’tAddr
(
v
) + 1;

106953 
	gj1
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_In™CÜoutše
, 
»gAddrB
, 0, 
addrS–eùB
);

106954 
VdbeComm’t
((
v
, "right SELECT"));

106955 
	g§vedLim™
 = 
p
->
iLim™
;

106956 
	g§vedOff£t
 = 
p
->
iOff£t
;

106957 
	gp
->
	giLim™
 = 
»gLim™B
;

106958 
	gp
->
	giOff£t
 = 0;

106959 
ex¶ašS‘IÁeg”
(
iSub2
, 
pP¬£
->
iNextS–eùId
);

106960 
sql™e3S–eù
(
pP¬£
, 
p
, &
de¡B
);

106961 
	gp
->
	giLim™
 = 
§vedLim™
;

106962 
	gp
->
	giOff£t
 = 
§vedOff£t
;

106963 
sql™e3VdbeAddOp1
(
v
, 
OP_EndCÜoutše
, 
»gAddrB
);

106968 
VdbeNoÝComm’t
((
v
, "Output„outine for A"));

106969 
	gaddrOutA
 = 
g’”©eOuutSubroutše
(
pP¬£
,

106970 
p
, &
de¡A
, 
pDe¡
, 
»gOutA
,

106971 
»gP»v
, 
pKeyDup
, 
Ïb–End
);

106976 ifÐ
	gÝ
==
TK_ALL
 || 
Ý
==
TK_UNION
 ){

106977 
VdbeNoÝComm’t
((
v
, "Output„outine for B"));

106978 
	gaddrOutB
 = 
g’”©eOuutSubroutše
(
pP¬£
,

106979 
p
, &
de¡B
, 
pDe¡
, 
»gOutB
,

106980 
»gP»v
, 
pKeyDup
, 
Ïb–End
);

106982 
sql™e3KeyInfoUÄef
(
pKeyDup
);

106987 ifÐ
	gÝ
==
TK_EXCEPT
 || 
Ý
==
TK_INTERSECT
 ){

106988 
addrEofA_noB
 = 
addrEofA
 = 
Ïb–End
;

106990 
VdbeNoÝComm’t
((
v
, "eof-A subroutine"));

106991 
	gaddrEofA
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOutB
, 
addrOutB
);

106992 
	gaddrEofA_noB
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrB
, 
Ïb–End
);

106993 
VdbeCov”age
(
v
);

106994 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrEofA
);

106995 
	gp
->
	gnS–eùRow
 +ð
pPriÜ
->
nS–eùRow
;

107001 ifÐ
	gÝ
==
TK_INTERSECT
 ){

107002 
addrEofB
 = 
addrEofA
;

107003 ifÐ
	gp
->
	gnS–eùRow
 > 
	gpPriÜ
->nS–eùRow )…->nS–eùRow = 
pPriÜ
->
nS–eùRow
;

107005 
VdbeNoÝComm’t
((
v
, "eof-B subroutine"));

107006 
	gaddrEofB
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOutA
, 
addrOutA
);

107007 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrA
, 
Ïb–End
); 
VdbeCov”age
(v);

107008 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrEofB
);

107013 
VdbeNoÝComm’t
((
v
, "A-lt-B subroutine"));

107014 
	gaddrAÉB
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOutA
, 
addrOutA
);

107015 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrA
, 
addrEofA
); 
VdbeCov”age
(v);

107016 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
Ïb–Cm´
);

107020 ifÐ
	gÝ
==
TK_ALL
 ){

107021 
addrAeqB
 = 
addrAÉB
;

107022 }ifÐ
	gÝ
==
TK_INTERSECT
 ){

107023 
addrAeqB
 = 
addrAÉB
;

107024 
	gaddrAÉB
++;

107026 
VdbeNoÝComm’t
((
v
, "A-eq-B subroutine"));

107027 
	gaddrAeqB
 =

107028 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrA
, 
addrEofA
); 
VdbeCov”age
(v);

107029 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
Ïb–Cm´
);

107034 
VdbeNoÝComm’t
((
v
, "A-gt-B subroutine"));

107035 
	gaddrAgtB
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

107036 ifÐ
	gÝ
==
TK_ALL
 || 
Ý
==
TK_UNION
 ){

107037 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOutB
, 
addrOutB
);

107039 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrB
, 
addrEofB
); 
VdbeCov”age
(v);

107040 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
Ïb–Cm´
);

107044 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

107045 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrA
, 
addrEofA_noB
); 
VdbeCov”age
(v);

107046 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gAddrB
, 
addrEofB
); 
VdbeCov”age
(v);

107050 
sql™e3VdbeResÞveLab–
(
v
, 
Ïb–Cm´
);

107051 
sql™e3VdbeAddOp4
(
v
, 
OP_P”mutiÚ
, 0, 0, 0, (*)
aP”mu‹
, 
P4_INTARRAY
);

107052 
sql™e3VdbeAddOp4
(
v
, 
OP_Com·»
, 
de¡A
.
iSd¡
, 
de¡B
.iSd¡, 
nOrd”By
,

107053 (*)
pKeyM”ge
, 
P4_KEYINFO
);

107054 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_PERMUTE
);

107055 
sql™e3VdbeAddOp3
(
v
, 
OP_Jump
, 
addrAÉB
, 
addrAeqB
, 
addrAgtB
); 
VdbeCov”age
(v);

107059 
sql™e3VdbeResÞveLab–
(
v
, 
Ïb–End
);

107063 ifÐ
	gpDe¡
->
	geDe¡
==
SRT_Ouut
 ){

107064 
S–eù
 *
pFœ¡
 = 
pPriÜ
;

107065  
	gpFœ¡
->
	gpPriÜ
 )…Fœ¡ = 
pFœ¡
->
pPriÜ
;

107066 
g’”©eCÞumnNames
(
pP¬£
, 0, 
pFœ¡
->
pELi¡
);

107071 ifÐ
	gp
->
	gpPriÜ
 ){

107072 
sql™e3S–eùD–‘e
(
db
, 
p
->
pPriÜ
);

107074 
	gp
->
	gpPriÜ
 = 
pPriÜ
;

107075 
	gpPriÜ
->
	gpNext
 = 
p
;

107079 
ex¶ašCompos™e
(
pP¬£
, 
p
->
Ý
, 
iSub1
, 
iSub2
, 0);

107080  
	gSQLITE_OK
;

107084 #ià!
defšed
(
SQLITE_OMIT_SUBQUERY
è|| !defšed(
SQLITE_OMIT_VIEW
)

107086 
sub¡Ex´Li¡
(
sql™e3
*, 
Ex´Li¡
*, , ExprList*);

107087 
sub¡S–eù
(
sql™e3
*, 
S–eù
 *, , 
Ex´Li¡
 *);

107102 
Ex´
 *
sub¡Ex´
(

107103 
sql™e3
 *
db
,

107104 
Ex´
 *
pEx´
,

107105 
iTabË
,

107106 
Ex´Li¡
 *
pELi¡


107108 ifÐ
	gpEx´
==0 )  0;

107109 ifÐ
	gpEx´
->
	gÝ
==
TK_COLUMN
 && 
pEx´
->
iTabË
==iTable ){

107110 ifÐ
pEx´
->
iCÞumn
<0 ){

107111 
pEx´
->
Ý
 = 
TK_NULL
;

107113 
Ex´
 *
	gpNew
;

107114 
as£¹
Ð
pELi¡
!=0 && 
pEx´
->
iCÞumn
<pELi¡->
nEx´
 );

107115 
as£¹
Ð
pEx´
->
pLeá
==0 &&…Ex´->
pRight
==0 );

107116 
	gpNew
 = 
sql™e3Ex´Dup
(
db
, 
pELi¡
->
a
[
pEx´
->
iCÞumn
].pExpr, 0);

107117 
sql™e3Ex´D–‘e
(
db
, 
pEx´
);

107118 
	gpEx´
 = 
pNew
;

107121 
	gpEx´
->
	gpLeá
 = 
sub¡Ex´
(
db
, 
pEx´
->
pLeá
, 
iTabË
, 
pELi¡
);

107122 
	gpEx´
->
	gpRight
 = 
sub¡Ex´
(
db
, 
pEx´
->
pRight
, 
iTabË
, 
pELi¡
);

107123 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

107124 
sub¡S–eù
(
db
, 
pEx´
->
x
.
pS–eù
, 
iTabË
, 
pELi¡
);

107126 
sub¡Ex´Li¡
(
db
, 
pEx´
->
x
.
pLi¡
, 
iTabË
, 
pELi¡
);

107129  
	gpEx´
;

107131 
sub¡Ex´Li¡
(

107132 
sql™e3
 *
db
,

107133 
Ex´Li¡
 *
pLi¡
,

107134 
iTabË
,

107135 
Ex´Li¡
 *
pELi¡


107137 
	gi
;

107138 ifÐ
	gpLi¡
==0 ) ;

107139 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

107140 
	gpLi¡
->
	ga
[
i
].
	gpEx´
 = 
sub¡Ex´
(
db
, 
pLi¡
->
a
[i].
pEx´
, 
iTabË
, 
pELi¡
);

107143 
sub¡S–eù
(

107144 
sql™e3
 *
db
,

107145 
S–eù
 *
p
,

107146 
iTabË
,

107147 
Ex´Li¡
 *
pELi¡


107149 
SrcLi¡
 *
	gpSrc
;

107150 
SrcLi¡_™em
 *
	gpI‹m
;

107151 
	gi
;

107152 ifÐ!
	gp
 ) ;

107153 
sub¡Ex´Li¡
(
db
, 
p
->
pELi¡
, 
iTabË
,…EList);

107154 
sub¡Ex´Li¡
(
db
, 
p
->
pGroupBy
, 
iTabË
, 
pELi¡
);

107155 
sub¡Ex´Li¡
(
db
, 
p
->
pOrd”By
, 
iTabË
, 
pELi¡
);

107156 
	gp
->
	gpHavšg
 = 
sub¡Ex´
(
db
, 
p
->
pHavšg
, 
iTabË
, 
pELi¡
);

107157 
	gp
->
	gpWh”e
 = 
sub¡Ex´
(
db
, 
p
->
pWh”e
, 
iTabË
, 
pELi¡
);

107158 
sub¡S–eù
(
db
, 
p
->
pPriÜ
, 
iTabË
, 
pELi¡
);

107159 
	gpSrc
 = 
p
->
pSrc
;

107160 
as£¹
Ð
pSrc
 );

107161 ifÐ
ALWAYS
(
pSrc
) ){

107162 
	gi
=
pSrc
->
nSrc
, 
	gpI‹m
õSrc->
a
; i>0; i--,…Item++){

107163 
sub¡S–eù
(
db
, 
pI‹m
->
pS–eù
, 
iTabË
, 
pELi¡
);

107169 #ià!
defšed
(
SQLITE_OMIT_SUBQUERY
è|| !defšed(
SQLITE_OMIT_VIEW
)

107306 
æ©‹nSubqu”y
(

107307 
P¬£
 *
pP¬£
,

107308 
S–eù
 *
p
,

107309 
iFrom
,

107310 
isAgg
,

107311 
subqu”yIsAgg


107313 cÚ¡ *
	gzSavedAuthCÚ‹xt
 = 
pP¬£
->
zAuthCÚ‹xt
;

107314 
S–eù
 *
	gpP¬’t
;

107315 
S–eù
 *
	gpSub
;

107316 
S–eù
 *
	gpSub1
;

107317 
SrcLi¡
 *
	gpSrc
;

107318 
SrcLi¡
 *
	gpSubSrc
;

107319 
Ex´Li¡
 *
	gpLi¡
;

107320 
	giP¬’t
;

107321 
	gi
;

107322 
Ex´
 *
	gpWh”e
;

107323 
SrcLi¡_™em
 *
	gpSub™em
;

107324 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

107328 
as£¹
Ð
p
!=0 );

107329 
as£¹
Ð
p
->
pPriÜ
==0 );

107330 ifÐ
O±imiz©iÚDi§bËd
(
db
, 
SQLITE_Qu”yFÏ‰’”
) )  0;

107331 
	gpSrc
 = 
p
->
pSrc
;

107332 
as£¹
Ð
pSrc
 && 
iFrom
>=0 && iFrom<pSrc->
nSrc
 );

107333 
	gpSub™em
 = &
pSrc
->
a
[
iFrom
];

107334 
	giP¬’t
 = 
pSub™em
->
iCursÜ
;

107335 
	gpSub
 = 
pSub™em
->
pS–eù
;

107336 
as£¹
Ð
pSub
!=0 );

107337 ifÐ
	gisAgg
 && 
	gsubqu”yIsAgg
 )  0;

107338 ifÐ
	gsubqu”yIsAgg
 && 
	gpSrc
->
	gnSrc
>1 )  0;

107339 
	gpSubSrc
 = 
pSub
->
pSrc
;

107340 
as£¹
Ð
pSubSrc
 );

107346 ifÐ
	gpSub
->
	gpLim™
 && 
	gp
->pLimit )  0;

107347 ifÐ
	gpSub
->
	gpOff£t
 )  0;

107348 ifÐ(
	gp
->
	g£lFÏgs
 & 
	gSF_Compound
)!=0 && 
pSub
->
pLim™
 ){

107351 ifÐ
	gpSubSrc
->
	gnSrc
==0 )  0;

107352 ifÐ
	gpSub
->
	g£lFÏgs
 & 
	gSF_Di¡šù
 )  0;

107353 ifÐ
	gpSub
->
	gpLim™
 && (
	gpSrc
->
	gnSrc
>1 || 
	gisAgg
) ){

107356 ifÐ(
	gp
->
	g£lFÏgs
 & 
	gSF_Di¡šù
)!=0 && 
subqu”yIsAgg
 ){

107359 ifÐ
	gp
->
	gpOrd”By
 && 
	gpSub
->pOrderBy ){

107362 ifÐ
	gisAgg
 && 
	gpSub
->
	gpOrd”By
 )  0;

107363 ifÐ
	gpSub
->
	gpLim™
 && 
	gp
->
	gpWh”e
 )  0;

107364 ifÐ
	gpSub
->
	gpLim™
 && (
	gp
->
	g£lFÏgs
 & 
	gSF_Di¡šù
)!=0 ){

107367 
‹¡ÿ£
Ð
pSub
->
£lFÏgs
 & 
SF_Recursive
 );

107368 
‹¡ÿ£
Ð
pSub
->
£lFÏgs
 & 
SF_MšMaxAgg
 );

107369 ifÐ
	gpSub
->
	g£lFÏgs
 & (
	gSF_Recursive
|
	gSF_MšMaxAgg
) ){

107372 ifÐ(
	gp
->
	g£lFÏgs
 & 
	gSF_Recursive
è&& 
	gpSub
->
	gpPriÜ
 ){

107408 ifÐ(
	gpSub™em
->
	gjošty³
 & 
	gJT_OUTER
)!=0 ){

107417 ifÐ
	gpSub
->
	gpPriÜ
 ){

107418 ifÐ
	gpSub
->
	gpOrd”By
 ){

107421 ifÐ
	gisAgg
 || (
	gp
->
	g£lFÏgs
 & 
	gSF_Di¡šù
)!=0 || 
pSrc
->
nSrc
!=1 ){

107424 
	gpSub1
=
pSub
;…Sub1;…Sub1=
pSub1
->
pPriÜ
){

107425 
‹¡ÿ£
Ð(
pSub1
->
£lFÏgs
 & (
SF_Di¡šù
|
SF_Agg»g©e
))==SF_Distinct );

107426 
‹¡ÿ£
Ð(
pSub1
->
£lFÏgs
 & (
SF_Di¡šù
|
SF_Agg»g©e
))==SF_Aggregate );

107427 
as£¹
Ð
pSub
->
pSrc
!=0 );

107428 ifÐ(
	gpSub1
->
	g£lFÏgs
 & (
	gSF_Di¡šù
|
	gSF_Agg»g©e
))!=0

107429 || (
pSub1
->
pPriÜ
 &&…Sub1->
Ý
!=
TK_ALL
)

107430 || 
pSub1
->
pSrc
->
nSrc
<1

107431 || 
pSub
->
pELi¡
->
nEx´
!=
pSub1
->pEList->nExpr

107435 
‹¡ÿ£
Ð
pSub1
->
pSrc
->
nSrc
>1 );

107439 ifÐ
	gp
->
	gpOrd”By
 ){

107440 
	gii
;

107441 
	gii
=0; ii<
	gp
->
	gpOrd”By
->
	gnEx´
; ii++){

107442 ifÐ
	gp
->
	gpOrd”By
->
	ga
[
ii
].
	gu
.
	gx
.
	giOrd”ByCÞ
==0 )  0;

107448 
SELECTTRACE
(1,
pP¬£
,
p
,("flatten %s.%p fromerm %d\n",

107449 
pSub
->
zS–Name
,…Sub, 
iFrom
));

107452 
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
pSub™em
->
zName
;

107453 
TESTONLY
(
i
 =è
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_SELECT
, 0, 0, 0);

107454 
‹¡ÿ£
Ð
i
==
SQLITE_DENY
 );

107455 
	gpP¬£
->
	gzAuthCÚ‹xt
 = 
zSavedAuthCÚ‹xt
;

107490 
	gpSub
=
pSub
->
pPriÜ
;…Sub;…Sub=pSub->pPrior){

107491 
S–eù
 *
pNew
;

107492 
Ex´Li¡
 *
	gpOrd”By
 = 
p
->
pOrd”By
;

107493 
Ex´
 *
	gpLim™
 = 
p
->
pLim™
;

107494 
Ex´
 *
	gpOff£t
 = 
p
->
pOff£t
;

107495 
S–eù
 *
	gpPriÜ
 = 
p
->
pPriÜ
;

107496 
	gp
->
	gpOrd”By
 = 0;

107497 
	gp
->
	gpSrc
 = 0;

107498 
	gp
->
	gpPriÜ
 = 0;

107499 
	gp
->
	gpLim™
 = 0;

107500 
	gp
->
	gpOff£t
 = 0;

107501 
	gpNew
 = 
sql™e3S–eùDup
(
db
, 
p
, 0);

107502 
sql™e3S–eùS‘Name
(
pNew
, 
pSub
->
zS–Name
);

107503 
	gp
->
	gpOff£t
 = 
pOff£t
;

107504 
	gp
->
	gpLim™
 = 
pLim™
;

107505 
	gp
->
	gpOrd”By
 = 
pOrd”By
;

107506 
	gp
->
	gpSrc
 = 
pSrc
;

107507 
	gp
->
	gÝ
 = 
TK_ALL
;

107508 ifÐ
	gpNew
==0 ){

107509 
p
->
pPriÜ
 =…Prior;

107511 
	gpNew
->
	gpPriÜ
 = 
pPriÜ
;

107512 ifÐ
	gpPriÜ
 )…PriÜ->
	gpNext
 = 
pNew
;

107513 
	gpNew
->
	gpNext
 = 
p
;

107514 
	gp
->
	gpPriÜ
 = 
pNew
;

107515 
SELECTTRACE
(2,
pP¬£
,
p
,

107517 
pNew
->
zS–Name
,…New));

107519 ifÐ
	gdb
->
	gm®locFažed
 )  1;

107525 
	gpSub
 = 
pSub1
 = 
pSub™em
->
pS–eù
;

107530 
sql™e3DbF»e
(
db
, 
pSub™em
->
zD©aba£
);

107531 
sql™e3DbF»e
(
db
, 
pSub™em
->
zName
);

107532 
sql™e3DbF»e
(
db
, 
pSub™em
->
zAlŸs
);

107533 
	gpSub™em
->
	gzD©aba£
 = 0;

107534 
	gpSub™em
->
	gzName
 = 0;

107535 
	gpSub™em
->
	gzAlŸs
 = 0;

107536 
	gpSub™em
->
	gpS–eù
 = 0;

107545 ifÐ
ALWAYS
(
pSub™em
->
pTab
!=0) ){

107546 
TabË
 *
pTabToD–
 = 
pSub™em
->
pTab
;

107547 ifÐ
	gpTabToD–
->
	gnRef
==1 ){

107548 
P¬£
 *
pTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

107549 
	gpTabToD–
->
	gpNextZomb›
 = 
pTÝËv–
->
pZomb›Tab
;

107550 
	gpTÝËv–
->
	gpZomb›Tab
 = 
pTabToD–
;

107552 
	gpTabToD–
->
	gnRef
--;

107554 
	gpSub™em
->
	gpTab
 = 0;

107570 
	gpP¬’t
=
p
;…P¬’t;…P¬’t=
pP¬’t
->
pPriÜ
, 
	gpSub
=
pSub
->pPrior){

107571 
nSubSrc
;

107572 
u8
 
	gjošty³
 = 0;

107573 
	gpSubSrc
 = 
pSub
->
pSrc
;

107574 
	gnSubSrc
 = 
pSubSrc
->
nSrc
;

107575 
	gpSrc
 = 
pP¬’t
->
pSrc
;

107577 ifÐ
	gpSrc
 ){

107578 
as£¹
Ð
pP¬’t
==
p
 );

107579 
	gjošty³
 = 
pSub™em
->
jošty³
;

107581 
as£¹
Ð
pP¬’t
!=
p
 );

107582 
	gpSrc
 = 
pP¬’t
->
pSrc
 = 
sql™e3SrcLi¡Aµ’d
(
db
, 0, 0, 0);

107583 ifÐ
	gpSrc
==0 ){

107584 
as£¹
Ð
db
->
m®locFažed
 );

107604 ifÐ
	gnSubSrc
>1 ){

107605 
	gpP¬’t
->
	gpSrc
 = 
pSrc
 = 
sql™e3SrcLi¡EÆ¬ge
(
db
,…Src, 
nSubSrc
-1,
iFrom
+1);

107606 ifÐ
	gdb
->
	gm®locFažed
 ){

107614 
	gi
=0; i<
	gnSubSrc
; i++){

107615 
sql™e3IdLi¡D–‘e
(
db
, 
pSrc
->
a
[
i
+
iFrom
].
pUsšg
);

107616 
	gpSrc
->
	ga
[
i
+
iFrom
] = 
pSubSrc
->
a
[i];

107617 
mem£t
(&
pSubSrc
->
a
[
i
], 0, (pSubSrc->a[i]));

107619 
	gpSrc
->
	ga
[
iFrom
].
	gjošty³
 = 
jošty³
;

107633 
	gpLi¡
 = 
pP¬’t
->
pELi¡
;

107634 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

107635 ifÐ
	gpLi¡
->
	ga
[
i
].
	gzName
==0 ){

107636 *
zName
 = 
sql™e3DbSŒDup
(
db
, 
pLi¡
->
a
[
i
].
zS·n
);

107637 
sql™e3DequÙe
(
zName
);

107638 
	gpLi¡
->
	ga
[
i
].
	gzName
 = 
zName
;

107641 
sub¡Ex´Li¡
(
db
, 
pP¬’t
->
pELi¡
, 
iP¬’t
, 
pSub
->pEList);

107642 ifÐ
	gisAgg
 ){

107643 
sub¡Ex´Li¡
(
db
, 
pP¬’t
->
pGroupBy
, 
iP¬’t
, 
pSub
->
pELi¡
);

107644 
	gpP¬’t
->
	gpHavšg
 = 
sub¡Ex´
(
db
, 
pP¬’t
->
pHavšg
, 
iP¬’t
, 
pSub
->
pELi¡
);

107646 ifÐ
	gpSub
->
	gpOrd”By
 ){

107657 
Ex´Li¡
 *
	gpOrd”By
 = 
pSub
->
pOrd”By
;

107658 
	gi
=0; i<
	gpOrd”By
->
	gnEx´
; i++){

107659 
	gpOrd”By
->
	ga
[
i
].
	gu
.
	gx
.
	giOrd”ByCÞ
 = 0;

107661 
as£¹
Ð
pP¬’t
->
pOrd”By
==0 );

107662 
as£¹
Ð
pSub
->
pPriÜ
==0 );

107663 
	gpP¬’t
->
	gpOrd”By
 = 
pOrd”By
;

107664 
	gpSub
->
	gpOrd”By
 = 0;

107665 }ifÐ
	gpP¬’t
->
	gpOrd”By
 ){

107666 
sub¡Ex´Li¡
(
db
, 
pP¬’t
->
pOrd”By
, 
iP¬’t
, 
pSub
->
pELi¡
);

107668 ifÐ
	gpSub
->
	gpWh”e
 ){

107669 
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
pSub
->
pWh”e
, 0);

107671 
	gpWh”e
 = 0;

107673 ifÐ
	gsubqu”yIsAgg
 ){

107674 
as£¹
Ð
pP¬’t
->
pHavšg
==0 );

107675 
	gpP¬’t
->
	gpHavšg
 = 
pP¬’t
->
pWh”e
;

107676 
	gpP¬’t
->
	gpWh”e
 = 
pWh”e
;

107677 
	gpP¬’t
->
	gpHavšg
 = 
sub¡Ex´
(
db
, 
pP¬’t
->
pHavšg
, 
iP¬’t
, 
pSub
->
pELi¡
);

107678 
	gpP¬’t
->
	gpHavšg
 = 
sql™e3Ex´And
(
db
, 
pP¬’t
->
pHavšg
,

107679 
sql™e3Ex´Dup
(
db
, 
pSub
->
pHavšg
, 0));

107680 
as£¹
Ð
pP¬’t
->
pGroupBy
==0 );

107681 
	gpP¬’t
->
	gpGroupBy
 = 
sql™e3Ex´Li¡Dup
(
db
, 
pSub
->
pGroupBy
, 0);

107683 
	gpP¬’t
->
	gpWh”e
 = 
sub¡Ex´
(
db
, 
pP¬’t
->
pWh”e
, 
iP¬’t
, 
pSub
->
pELi¡
);

107684 
	gpP¬’t
->
	gpWh”e
 = 
sql™e3Ex´And
(
db
, 
pP¬’t
->
pWh”e
,…Where);

107690 
	gpP¬’t
->
	g£lFÏgs
 |ð
pSub
->
£lFÏgs
 & 
SF_Di¡šù
;

107698 ifÐ
	gpSub
->
	gpLim™
 ){

107699 
	gpP¬’t
->
	gpLim™
 = 
pSub
->
pLim™
;

107700 
	gpSub
->
	gpLim™
 = 0;

107707 
sql™e3S–eùD–‘e
(
db
, 
pSub1
);

107709 #ià
SELECTTRACE_ENABLED


107710 ifÐ
	gsql™e3S–eùT¿û
 & 0x100 ){

107711 
sql™e3DebugPrštf
("After flattening:\n");

107712 
sql™e3T»eV›wS–eù
(0, 
p
, 0);

107735 
u8
 
mšMaxQu”y
(
AggInfo
 *
pAggInfo
, 
Ex´Li¡
 **
µMšMax
){

107736 
	geR‘
 = 
WHERE_ORDERBY_NORMAL
;

107738 *
	gµMšMax
 = 0;

107739 ifÐ
	gpAggInfo
->
	gnFunc
==1 ){

107740 
Ex´
 *
pEx´
 = 
pAggInfo
->
aFunc
[0].pExpr;

107741 
Ex´Li¡
 *
	gpELi¡
 = 
pEx´
->
x
.
pLi¡
;

107743 
as£¹
Ð
pEx´
->
Ý
==
TK_AGG_FUNCTION
 );

107744 ifÐ
	gpELi¡
 &&…ELi¡->
	gnEx´
==1 && 
pELi¡
->
a
[0].
pEx´
->
Ý
==
TK_AGG_COLUMN
 ){

107745 cÚ¡ *
zFunc
 = 
pEx´
->
u
.
zTok’
;

107746 ifÐ
sql™e3SŒICmp
(
zFunc
, "min")==0 ){

107747 
eR‘
 = 
WHERE_ORDERBY_MIN
;

107748 *
	gµMšMax
 = 
pELi¡
;

107749 }ifÐ
sql™e3SŒICmp
(
zFunc
, "max")==0 ){

107750 
eR‘
 = 
WHERE_ORDERBY_MAX
;

107751 *
	gµMšMax
 = 
pELi¡
;

107756 
as£¹
Ð*
µMšMax
==0 || (*µMšMax)->
nEx´
==1 );

107757  
	geR‘
;

107771 
TabË
 *
isSim¶eCouÁ
(
S–eù
 *
p
, 
AggInfo
 *
pAggInfo
){

107772 
TabË
 *
	gpTab
;

107773 
Ex´
 *
	gpEx´
;

107775 
as£¹
Ð!
p
->
pGroupBy
 );

107777 ifÐ
	gp
->
	gpWh”e
 ||…->
	gpELi¡
->
	gnEx´
!=1

107778 || 
p
->
pSrc
->
nSrc
!=1 ||…->pSrc->
a
[0].
pS–eù


107782 
	gpTab
 = 
p
->
pSrc
->
a
[0].
pTab
;

107783 
	gpEx´
 = 
p
->
pELi¡
->
a
[0].
pEx´
;

107784 
as£¹
Ð
pTab
 && !pTab->
pS–eù
 && 
pEx´
 );

107786 ifÐ
IsVœtu®
(
pTab
) )  0;

107787 ifÐ
	gpEx´
->
	gÝ
!=
TK_AGG_FUNCTION
 )  0;

107788 ifÐ
NEVER
(
pAggInfo
->
nFunc
==0) )  0;

107789 ifÐ(
	gpAggInfo
->
	gaFunc
[0].
	gpFunc
->
	gfuncFÏgs
&
	gSQLITE_FUNC_COUNT
)==0 )  0;

107790 ifÐ
	gpEx´
->
	gæags
&
	gEP_Di¡šù
 )  0;

107792  
	gpTab
;

107802 
SQLITE_PRIVATE
 
sql™e3IndexedByLookup
(
P¬£
 *
pP¬£
, 
SrcLi¡_™em
 *
pFrom
){

107803 ifÐ
	gpFrom
->
	gpTab
 &&…From->
	gzIndex
 ){

107804 
TabË
 *
	gpTab
 = 
pFrom
->
pTab
;

107805 *
	gzIndex
 = 
pFrom
->
zIndex
;

107806 
Index
 *
	gpIdx
;

107807 
	gpIdx
=
pTab
->
pIndex
;

107808 
	gpIdx
 && 
sql™e3SŒICmp
(
pIdx
->
zName
, 
zIndex
);

107809 
	gpIdx
=
pIdx
->
pNext


107811 ifÐ!
	gpIdx
 ){

107812 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch index: %s", 
zIndex
, 0);

107813 
	gpP¬£
->
	gcheckSchema
 = 1;

107814  
	gSQLITE_ERROR
;

107816 
	gpFrom
->
	gpIndex
 = 
pIdx
;

107818  
	gSQLITE_OK
;

107841 
cÚv”tCompoundS–eùToSubqu”y
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

107842 
	gi
;

107843 
S–eù
 *
	gpNew
;

107844 
S–eù
 *
	gpX
;

107845 
sql™e3
 *
	gdb
;

107846 
Ex´Li¡_™em
 *
	ga
;

107847 
SrcLi¡
 *
	gpNewSrc
;

107848 
P¬£
 *
	gpP¬£
;

107849 
Tok’
 
	gdummy
;

107851 ifÐ
	gp
->
	gpPriÜ
==0 )  
WRC_CÚtšue
;

107852 ifÐ
	gp
->
	gpOrd”By
==0 )  
WRC_CÚtšue
;

107853 
	gpX
=
p
;…X && (pX->
	gÝ
==
TK_ALL
 || 
pX
->
Ý
==
TK_SELECT
);…XõX->
pPriÜ
){}

107854 ifÐ
pX
==0 )  
WRC_CÚtšue
;

107855 
	ga
 = 
p
->
pOrd”By
->
a
;

107856 
	gi
=
p
->
pOrd”By
->
nEx´
-1; i>=0; i--){

107857 ifÐ
	ga
[
i
].
	gpEx´
->
	gæags
 & 
	gEP_CÞÏ‹
 ) ;

107859 ifÐ
	gi
<0 )  
	gWRC_CÚtšue
;

107863 
	gpP¬£
 = 
pW®k”
->
pP¬£
;

107864 
	gdb
 = 
pP¬£
->
db
;

107865 
	gpNew
 = 
sql™e3DbM®locZ”o
(
db
, (*
pNew
) );

107866 ifÐ
	gpNew
==0 )  
WRC_AbÜt
;

107867 
mem£t
(&
dummy
, 0, (dummy));

107868 
	gpNewSrc
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,0,0,0,&
dummy
,
pNew
,0,0);

107869 ifÐ
	gpNewSrc
==0 )  
WRC_AbÜt
;

107870 *
	gpNew
 = *
p
;

107871 
	gp
->
	gpSrc
 = 
pNewSrc
;

107872 
	gp
->
	gpELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
sql™e3Ex´
(
db
, 
TK_ALL
, 0));

107873 
	gp
->
	gÝ
 = 
TK_SELECT
;

107874 
	gp
->
	gpWh”e
 = 0;

107875 
	gpNew
->
	gpGroupBy
 = 0;

107876 
	gpNew
->
	gpHavšg
 = 0;

107877 
	gpNew
->
	gpOrd”By
 = 0;

107878 
	gp
->
	gpPriÜ
 = 0;

107879 
	gp
->
	gpNext
 = 0;

107880 
	gp
->
	g£lFÏgs
 &ð~
SF_Compound
;

107881 
as£¹
Ð
pNew
->
pPriÜ
!=0 );

107882 
	gpNew
->
	gpPriÜ
->
	gpNext
 = 
pNew
;

107883 
	gpNew
->
	gpLim™
 = 0;

107884 
	gpNew
->
	gpOff£t
 = 0;

107885  
	gWRC_CÚtšue
;

107888 #iâdeà
SQLITE_OMIT_CTE


107899 
C‹
 *
£¬chW™h
(

107900 
W™h
 *
pW™h
,

107901 
SrcLi¡_™em
 *
pI‹m
,

107902 
W™h
 **
µCÚ‹xt


107904 cÚ¡ *
	gzName
;

107905 ifÐ
	gpI‹m
->
	gzD©aba£
==0 && (
zName
 = 
pI‹m
->zName)!=0 ){

107906 
W™h
 *
p
;

107907 
	gp
=
pW™h
;…;…=
p
->
pOu‹r
){

107908 
i
;

107909 
	gi
=0; i<
	gp
->
	gnC‹
; i++){

107910 ifÐ
sql™e3SŒICmp
(
zName
, 
p
->
a
[
i
].zName)==0 ){

107911 *
µCÚ‹xt
 = 
p
;

107912  &
	gp
->
	ga
[
i
];

107930 
SQLITE_PRIVATE
 
sql™e3W™hPush
(
P¬£
 *
pP¬£
, 
W™h
 *
pW™h
, 
u8
 
bF»e
){

107931 
as£¹
Ð
bF»e
==0 || 
pP¬£
->
pW™h
==0 );

107932 ifÐ
	gpW™h
 ){

107933 
	gpW™h
->
	gpOu‹r
 = 
pP¬£
->
pW™h
;

107934 
	gpP¬£
->
	gpW™h
 = 
pW™h
;

107935 
	gpP¬£
->
	gbF»eW™h
 = 
bF»e
;

107954 
w™hEx·nd
(

107955 
W®k”
 *
pW®k”
,

107956 
SrcLi¡_™em
 *
pFrom


107958 
P¬£
 *
	gpP¬£
 = 
pW®k”
->
pP¬£
;

107959 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

107960 
C‹
 *
	gpC‹
;

107961 
W™h
 *
	gpW™h
;

107963 
as£¹
Ð
pFrom
->
pTab
==0 );

107965 
	gpC‹
 = 
£¬chW™h
(
pP¬£
->
pW™h
, 
pFrom
, &pWith);

107966 ifÐ
	gpC‹
 ){

107967 
TabË
 *
	gpTab
;

107968 
Ex´Li¡
 *
	gpELi¡
;

107969 
S–eù
 *
	gpS–
;

107970 
S–eù
 *
	gpLeá
;

107971 
	gbMayRecursive
;

107972 
W™h
 *
	gpSavedW™h
;

107978 ifÐ
	gpC‹
->
	gzE¼
 ){

107979 
sql™e3E¼ÜMsg
(
pP¬£
, 
pC‹
->
zE¼
,…C‹->
zName
);

107980  
	gSQLITE_ERROR
;

107983 
as£¹
Ð
pFrom
->
pTab
==0 );

107984 
	gpFrom
->
	gpTab
 = 
pTab
 = 
sql™e3DbM®locZ”o
(
db
, (
TabË
));

107985 ifÐ
	gpTab
==0 )  
WRC_AbÜt
;

107986 
	gpTab
->
	gnRef
 = 1;

107987 
	gpTab
->
	gzName
 = 
sql™e3DbSŒDup
(
db
, 
pC‹
->
zName
);

107988 
	gpTab
->
	giPKey
 = -1;

107989 
	gpTab
->
	gnRowLogE¡
 = 200; 
as£¹
Ð200==
sql™e3LogE¡
(1048576) );

107990 
	gpTab
->
	gbFÏgs
 |ð
TF_Ephem”®
;

107991 
	gpFrom
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pC‹
->
pS–eù
, 0);

107992 ifÐ
	gdb
->
	gm®locFažed
 )  
	gSQLITE_NOMEM
;

107993 
as£¹
Ð
pFrom
->
pS–eù
 );

107996 
	gpS–
 = 
pFrom
->
pS–eù
;

107997 
	gbMayRecursive
 = ( 
pS–
->
Ý
==
TK_ALL
 ||…S–->Ý==
TK_UNION
 );

107998 ifÐ
	gbMayRecursive
 ){

107999 
	gi
;

108000 
SrcLi¡
 *
	gpSrc
 = 
pFrom
->
pS–eù
->
pSrc
;

108001 
	gi
=0; i<
	gpSrc
->
	gnSrc
; i++){

108002 
SrcLi¡_™em
 *
	gpI‹m
 = &
pSrc
->
a
[
i
];

108003 ifÐ
	gpI‹m
->
	gzD©aba£
==0

108004 && 
pI‹m
->
zName
!=0

108005 && 0==
sql™e3SŒICmp
(
pI‹m
->
zName
, 
pC‹
->zName)

108007 
	gpI‹m
->
	gpTab
 = 
pTab
;

108008 
	gpI‹m
->
	gisRecursive
 = 1;

108009 
	gpTab
->
	gnRef
++;

108010 
	gpS–
->
	g£lFÏgs
 |ð
SF_Recursive
;

108016 ifÐ
	gpTab
->
	gnRef
>2 ){

108017 
sql™e3E¼ÜMsg
(

108018 
pP¬£
, "muÉË„eã»nû tØ»cursivbË: %s", 
pC‹
->
zName


108020  
	gSQLITE_ERROR
;

108022 
as£¹
Ð
pTab
->
nRef
==1 || ((
pS–
->
£lFÏgs
&
SF_Recursive
) &&…Tab->nRef==2 ));

108024 
	gpC‹
->
	gzE¼
 = "circular„eference: %s";

108025 
	gpSavedW™h
 = 
pP¬£
->
pW™h
;

108026 
	gpP¬£
->
	gpW™h
 = 
pW™h
;

108027 
sql™e3W®kS–eù
(
pW®k”
, 
bMayRecursive
 ? 
pS–
->
pPriÜ
 :…Sel);

108029 
	gpLeá
=
pS–
;…Leá->
	gpPriÜ
;…Leá=
pLeá
->
pPriÜ
);

108030 
	gpELi¡
 = 
pLeá
->
pELi¡
;

108031 ifÐ
	gpC‹
->
	gpCÞs
 ){

108032 ifÐ
	gpELi¡
->
	gnEx´
!=
pC‹
->
pCÞs
->
nEx´
 ){

108033 
sql™e3E¼ÜMsg
(
pP¬£
, "table %s has %d values for %d columns",

108034 
pC‹
->
zName
, 
pELi¡
->
nEx´
,…C‹->
pCÞs
->nExpr

108036 
	gpP¬£
->
	gpW™h
 = 
pSavedW™h
;

108037  
	gSQLITE_ERROR
;

108039 
	gpELi¡
 = 
pC‹
->
pCÞs
;

108042 
£ËùCÞumnsFromEx´Li¡
(
pP¬£
, 
pELi¡
, &
pTab
->
nCÞ
, &pTab->
aCÞ
);

108043 ifÐ
	gbMayRecursive
 ){

108044 ifÐ
	gpS–
->
	g£lFÏgs
 & 
	gSF_Recursive
 ){

108045 
	gpC‹
->
	gzE¼
 = "multiple„ecursive„eferences: %s";

108047 
	gpC‹
->
	gzE¼
 = "recursive„eference in‡ subquery: %s";

108049 
sql™e3W®kS–eù
(
pW®k”
, 
pS–
);

108051 
	gpC‹
->
	gzE¼
 = 0;

108052 
	gpP¬£
->
	gpW™h
 = 
pSavedW™h
;

108055  
	gSQLITE_OK
;

108059 #iâdeà
SQLITE_OMIT_CTE


108068 
£ËùPÝW™h
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

108069 
P¬£
 *
	gpP¬£
 = 
pW®k”
->
pP¬£
;

108070 
W™h
 *
	gpW™h
 = 
fšdRightmo¡
(
p
)->
pW™h
;

108071 ifÐ
	gpW™h
!=0 ){

108072 
as£¹
Ð
pP¬£
->
pW™h
==pWith );

108073 
	gpP¬£
->
	gpW™h
 = 
pW™h
->
pOu‹r
;

108077 
	#£ËùPÝW™h
 0

	)

108104 
£ËùEx·nd”
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

108105 
P¬£
 *
	gpP¬£
 = 
pW®k”
->
pP¬£
;

108106 
	gi
, 
	gj
, 
	gk
;

108107 
SrcLi¡
 *
	gpTabLi¡
;

108108 
Ex´Li¡
 *
	gpELi¡
;

108109 
SrcLi¡_™em
 *
	gpFrom
;

108110 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

108111 
Ex´
 *
	gpE
, *
	gpRight
, *
	gpEx´
;

108112 
u16
 
	g£lFÏgs
 = 
p
->
£lFÏgs
;

108114 
	gp
->
	g£lFÏgs
 |ð
SF_Ex·nded
;

108115 ifÐ
	gdb
->
	gm®locFažed
 ){

108116  
	gWRC_AbÜt
;

108118 ifÐ
NEVER
(
p
->
pSrc
==0è|| (
£lFÏgs
 & 
SF_Ex·nded
)!=0 ){

108119  
WRC_PruÃ
;

108121 
	gpTabLi¡
 = 
p
->
pSrc
;

108122 
	gpELi¡
 = 
p
->
pELi¡
;

108123 
sql™e3W™hPush
(
pP¬£
, 
fšdRightmo¡
(
p
)->
pW™h
, 0);

108128 
sql™e3SrcLi¡AssignCursÜs
(
pP¬£
, 
pTabLi¡
);

108134 
	gi
=0, 
	gpFrom
=
pTabLi¡
->
a
; i<
	gpTabLi¡
->
	gnSrc
; i++,…From++){

108135 
TabË
 *
	gpTab
;

108136 
as£¹
Ð
pFrom
->
isRecursive
==0 ||…From->
pTab
 );

108137 ifÐ
	gpFrom
->
	gisRecursive
 ) ;

108138 ifÐ
	gpFrom
->
	gpTab
!=0 ){

108141 
as£¹
Ð
i
==0 );

108142 #iâdeà
SQLITE_OMIT_CTE


108143 
£ËùPÝW™h
(
pW®k”
, 
p
);

108145  
	gWRC_PruÃ
;

108147 #iâdeà
SQLITE_OMIT_CTE


108148 ifÐ
w™hEx·nd
(
pW®k”
, 
pFrom
èè 
	gWRC_AbÜt
;

108149 ifÐ
	gpFrom
->
	gpTab
 ) {} 

108151 ifÐ
	gpFrom
->
	gzName
==0 ){

108152 #iâdeà
SQLITE_OMIT_SUBQUERY


108153 
S–eù
 *
pS–
 = 
pFrom
->
pS–eù
;

108155 
as£¹
Ð
pS–
!=0 );

108156 
as£¹
Ð
pFrom
->
pTab
==0 );

108157 
sql™e3W®kS–eù
(
pW®k”
, 
pS–
);

108158 
	gpFrom
->
	gpTab
 = 
pTab
 = 
sql™e3DbM®locZ”o
(
db
, (
TabË
));

108159 ifÐ
	gpTab
==0 )  
WRC_AbÜt
;

108160 
	gpTab
->
	gnRef
 = 1;

108161 
	gpTab
->
	gzName
 = 
sql™e3MPrštf
(
db
, "sql™e_sq_%p", (*)
pTab
);

108162  
	gpS–
->
	gpPriÜ
 ){…S– = 
pS–
->
pPriÜ
; }

108163 
£ËùCÞumnsFromEx´Li¡
(
pP¬£
, 
pS–
->
pELi¡
, &
pTab
->
nCÞ
, &pTab->
aCÞ
);

108164 
	gpTab
->
	giPKey
 = -1;

108165 
	gpTab
->
	gnRowLogE¡
 = 200; 
as£¹
Ð200==
sql™e3LogE¡
(1048576) );

108166 
	gpTab
->
	gbFÏgs
 |ð
TF_Ephem”®
;

108170 
as£¹
Ð
pFrom
->
pTab
==0 );

108171 
	gpFrom
->
	gpTab
 = 
pTab
 = 
sql™e3Loÿ‹TabËI‹m
(
pP¬£
, 0, 
pFrom
);

108172 ifÐ
	gpTab
==0 )  
WRC_AbÜt
;

108173 ifÐ
	gpTab
->
	gnRef
==0xffff ){

108174 
sql™e3E¼ÜMsg
(
pP¬£
, "too many„eferenceso \"%s\": max 65535",

108175 
pTab
->
zName
);

108176 
	gpFrom
->
	gpTab
 = 0;

108177  
	gWRC_AbÜt
;

108179 
	gpTab
->
	gnRef
++;

108180 #ià!
defšed
(
SQLITE_OMIT_VIEW
è|| !defšed (
SQLITE_OMIT_VIRTUALTABLE
)

108181 ifÐ
	gpTab
->
	gpS–eù
 || 
IsVœtu®
(
pTab
) ){

108183 ifÐ
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
èè 
	gWRC_AbÜt
;

108184 
as£¹
Ð
pFrom
->
pS–eù
==0 );

108185 
	gpFrom
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pTab
->
pS–eù
, 0);

108186 
sql™e3S–eùS‘Name
(
pFrom
->
pS–eù
, 
pTab
->
zName
);

108187 
sql™e3W®kS–eù
(
pW®k”
, 
pFrom
->
pS–eù
);

108193 ifÐ
sql™e3IndexedByLookup
(
pP¬£
, 
pFrom
) ){

108194  
	gWRC_AbÜt
;

108200 ifÐ
	gdb
->
	gm®locFažed
 || 
sql™eProûssJoš
(
pP¬£
, 
p
) ){

108201  
	gWRC_AbÜt
;

108214 
	gk
=0; k<
	gpELi¡
->
	gnEx´
; k++){

108215 
	gpE
 = 
pELi¡
->
a
[
k
].
pEx´
;

108216 ifÐ
	gpE
->
	gÝ
==
TK_ALL
 ) ;

108217 
as£¹
Ð
pE
->
Ý
!=
TK_DOT
 ||…E->
pRight
!=0 );

108218 
as£¹
Ð
pE
->
Ý
!=
TK_DOT
 || (pE->
pLeá
!=0 &&…E->pLeá->Ý==
TK_ID
) );

108219 ifÐ
	gpE
->
	gÝ
==
TK_DOT
 && 
pE
->
pRight
->
Ý
==
TK_ALL
 ) ;

108221 ifÐ
	gk
<
	gpELi¡
->
	gnEx´
 ){

108227 
Ex´Li¡_™em
 *
	ga
 = 
pELi¡
->
a
;

108228 
Ex´Li¡
 *
	gpNew
 = 0;

108229 
	gæags
 = 
pP¬£
->
db
->
æags
;

108230 
	glÚgNames
 = (
æags
 & 
SQLITE_FuÎCÞNames
)!=0

108231 && (
æags
 & 
SQLITE_ShÜtCÞNames
)==0;

108236 
as£¹
Ð(
p
->
£lFÏgs
 & 
SF_Ne¡edFrom
)==0

108237 || ((
æags
 & 
SQLITE_FuÎCÞNames
)==0 &&

108238 (
æags
 & 
SQLITE_ShÜtCÞNames
)!=0) );

108240 
	gk
=0; k<
	gpELi¡
->
	gnEx´
; k++){

108241 
	gpE
 = 
a
[
k
].
pEx´
;

108242 
	gpRight
 = 
pE
->
pRight
;

108243 
as£¹
Ð
pE
->
Ý
!=
TK_DOT
 || 
pRight
!=0 );

108244 ifÐ
	gpE
->
	gÝ
!=
TK_ALL
 && (
pE
->
Ý
!=
TK_DOT
 || 
pRight
->op!=TK_ALL) ){

108247 
pNew
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,…New, 
a
[
k
].
pEx´
);

108248 ifÐ
	gpNew
 ){

108249 
	gpNew
->
	ga
[
pNew
->
nEx´
-1].
	gzName
 = 
a
[
k
].
zName
;

108250 
	gpNew
->
	ga
[
pNew
->
nEx´
-1].
	gzS·n
 = 
a
[
k
].
zS·n
;

108251 
	ga
[
k
].
	gzName
 = 0;

108252 
	ga
[
k
].
	gzS·n
 = 0;

108254 
	ga
[
k
].
	gpEx´
 = 0;

108258 
	gbËS“n
 = 0;

108259 *
	gzTName
 = 0;

108260 ifÐ
	gpE
->
	gÝ
==
TK_DOT
 ){

108261 
as£¹
Ð
pE
->
pLeá
!=0 );

108262 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pE
->
pLeá
, 
EP_IÁV®ue
) );

108263 
	gzTName
 = 
pE
->
pLeá
->
u
.
zTok’
;

108265 
	gi
=0, 
	gpFrom
=
pTabLi¡
->
a
; i<
	gpTabLi¡
->
	gnSrc
; i++,…From++){

108266 
TabË
 *
	gpTab
 = 
pFrom
->
pTab
;

108267 
S–eù
 *
	gpSub
 = 
pFrom
->
pS–eù
;

108268 *
	gzTabName
 = 
pFrom
->
zAlŸs
;

108269 cÚ¡ *
	gzSchemaName
 = 0;

108270 
	giDb
;

108271 ifÐ
	gzTabName
==0 ){

108272 
zTabName
 = 
pTab
->
zName
;

108274 ifÐ
	gdb
->
	gm®locFažed
 ) ;

108275 ifÐ
	gpSub
==0 || (
pSub
->
£lFÏgs
 & 
SF_Ne¡edFrom
)==0 ){

108276 
pSub
 = 0;

108277 ifÐ
	gzTName
 && 
sql™e3SŒICmp
(
zTName
, 
zTabName
)!=0 ){

108280 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

108281 
	gzSchemaName
 = 
iDb
>=0 ? 
db
->
aDb
[iDb].
zName
 : "*";

108283 
	gj
=0; j<
	gpTab
->
	gnCÞ
; j++){

108284 *
	gzName
 = 
pTab
->
aCÞ
[
j
].
zName
;

108285 *
	gzCÞÇme
;

108286 *
	gzToF»e
;

108287 
Tok’
 
	gsCÞÇme
;

108289 
as£¹
Ð
zName
 );

108290 ifÐ
	gzTName
 && 
	gpSub


108291 && 
sql™e3M©chS·nName
(
pSub
->
pELi¡
->
a
[
j
].
zS·n
, 0, 
zTName
, 0)==0

108300 ifÐ
IsHidd’CÞumn
(&
pTab
->
aCÞ
[
j
]) ){

108301 
as£¹
(
IsVœtu®
(
pTab
));

108304 
	gbËS“n
 = 1;

108306 ifÐ
	gi
>0 && 
	gzTName
==0 ){

108307 ifÐ(
pFrom
->
jošty³
 & 
JT_NATURAL
)!=0

108308 && 
bËAndCÞumnIndex
(
pTabLi¡
, 
i
, 
zName
, 0, 0)

108314 ifÐ
sql™e3IdLi¡Index
(
pFrom
->
pUsšg
, 
zName
)>=0 ){

108320 
	gpRight
 = 
sql™e3Ex´
(
db
, 
TK_ID
, 
zName
);

108321 
	gzCÞÇme
 = 
zName
;

108322 
	gzToF»e
 = 0;

108323 ifÐ
	glÚgNames
 || 
	gpTabLi¡
->
	gnSrc
>1 ){

108324 
Ex´
 *
	gpLeá
;

108325 
	gpLeá
 = 
sql™e3Ex´
(
db
, 
TK_ID
, 
zTabName
);

108326 
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
pLeá
, 
pRight
, 0);

108327 ifÐ
	gzSchemaName
 ){

108328 
	gpLeá
 = 
sql™e3Ex´
(
db
, 
TK_ID
, 
zSchemaName
);

108329 
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
pLeá
, 
pEx´
, 0);

108331 ifÐ
	glÚgNames
 ){

108332 
	gzCÞÇme
 = 
sql™e3MPrštf
(
db
, "%s.%s", 
zTabName
, 
zName
);

108333 
	gzToF»e
 = 
zCÞÇme
;

108336 
	gpEx´
 = 
pRight
;

108338 
	gpNew
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pNew
, 
pEx´
);

108339 
	gsCÞÇme
.
	gz
 = 
zCÞÇme
;

108340 
	gsCÞÇme
.
	gn
 = 
sql™e3SŒËn30
(
zCÞÇme
);

108341 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
pNew
, &
sCÞÇme
, 0);

108342 ifÐ
	gpNew
 && (
	gp
->
	g£lFÏgs
 & 
	gSF_Ne¡edFrom
)!=0 ){

108343 
Ex´Li¡_™em
 *
pX
 = &
pNew
->
a
[pNew->
nEx´
-1];

108344 ifÐ
	gpSub
 ){

108345 
	gpX
->
	gzS·n
 = 
sql™e3DbSŒDup
(
db
, 
pSub
->
pELi¡
->
a
[
j
].
zS·n
);

108346 
‹¡ÿ£
Ð
pX
->
zS·n
==0 );

108348 
	gpX
->
	gzS·n
 = 
sql™e3MPrštf
(
db
, "%s.%s.%s",

108349 
zSchemaName
, 
zTabName
, 
zCÞÇme
);

108350 
‹¡ÿ£
Ð
pX
->
zS·n
==0 );

108352 
	gpX
->
	gbS·nIsTab
 = 1;

108354 
sql™e3DbF»e
(
db
, 
zToF»e
);

108357 ifÐ!
	gbËS“n
 ){

108358 ifÐ
	gzTName
 ){

108359 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuchabË: %s", 
zTName
);

108361 
sql™e3E¼ÜMsg
(
pP¬£
, "noables specified");

108366 
sql™e3Ex´Li¡D–‘e
(
db
, 
pELi¡
);

108367 
	gp
->
	gpELi¡
 = 
pNew
;

108369 #ià
SQLITE_MAX_COLUMN


108370 ifÐ
	gp
->
	gpELi¡
 &&…->pELi¡->
	gnEx´
>
	gdb
->
	gaLim™
[
SQLITE_LIMIT_COLUMN
] ){

108371 
sql™e3E¼ÜMsg
(
pP¬£
, "too many columns in„esult set");

108374  
	gWRC_CÚtšue
;

108386 
ex´W®kNoÝ
(
W®k”
 *
NÙU£d
, 
Ex´
 *
NÙU£d2
){

108387 
UNUSED_PARAMETER2
(
NÙU£d
, 
NÙU£d2
);

108388  
	gWRC_CÚtšue
;

108404 
sql™e3S–eùEx·nd
(
P¬£
 *
pP¬£
, 
S–eù
 *
pS–eù
){

108405 
W®k”
 
	gw
;

108406 
mem£t
(&
w
, 0, (w));

108407 
	gw
.
	gxEx´C®lback
 = 
ex´W®kNoÝ
;

108408 
	gw
.
	gpP¬£
 = 
pP¬£
;

108409 ifÐ
	gpP¬£
->
	ghasCompound
 ){

108410 
	gw
.
	gxS–eùC®lback
 = 
cÚv”tCompoundS–eùToSubqu”y
;

108411 
sql™e3W®kS–eù
(&
w
, 
pS–eù
);

108413 
	gw
.
	gxS–eùC®lback
 = 
£ËùEx·nd”
;

108414 
	gw
.
	gxS–eùC®lback2
 = 
£ËùPÝW™h
;

108415 
sql™e3W®kS–eù
(&
w
, 
pS–eù
);

108419 #iâdeà
SQLITE_OMIT_SUBQUERY


108433 
£ËùAddSubqu”yTy³Info
(
W®k”
 *
pW®k”
, 
S–eù
 *
p
){

108434 
P¬£
 *
	gpP¬£
;

108435 
	gi
;

108436 
SrcLi¡
 *
	gpTabLi¡
;

108437 
SrcLi¡_™em
 *
	gpFrom
;

108439 
as£¹
Ð
p
->
£lFÏgs
 & 
SF_ResÞved
 );

108440 ifÐ(
	gp
->
	g£lFÏgs
 & 
	gSF_HasTy³Info
)==0 ){

108441 
p
->
£lFÏgs
 |ð
SF_HasTy³Info
;

108442 
	gpP¬£
 = 
pW®k”
->
pP¬£
;

108443 
	gpTabLi¡
 = 
p
->
pSrc
;

108444 
	gi
=0, 
	gpFrom
=
pTabLi¡
->
a
; i<
	gpTabLi¡
->
	gnSrc
; i++,…From++){

108445 
TabË
 *
	gpTab
 = 
pFrom
->
pTab
;

108446 ifÐ
ALWAYS
(
pTab
!=0è&& (pTab->
bFÏgs
 & 
TF_Ephem”®
)!=0 ){

108448 
S–eù
 *
pS–
 = 
pFrom
->
pS–eù
;

108449 ifÐ
	gpS–
 ){

108450  
	gpS–
->
	gpPriÜ
 )…S– = 
pS–
->
pPriÜ
;

108451 
£ËùAddCÞumnTy³AndCÞÏtiÚ
(
pP¬£
, 
pTab
, 
pS–
);

108467 
sql™e3S–eùAddTy³Info
(
P¬£
 *
pP¬£
, 
S–eù
 *
pS–eù
){

108468 #iâdeà
SQLITE_OMIT_SUBQUERY


108469 
W®k”
 
	gw
;

108470 
mem£t
(&
w
, 0, (w));

108471 
	gw
.
	gxS–eùC®lback2
 = 
£ËùAddSubqu”yTy³Info
;

108472 
	gw
.
	gxEx´C®lback
 = 
ex´W®kNoÝ
;

108473 
	gw
.
	gpP¬£
 = 
pP¬£
;

108474 
sql™e3W®kS–eù
(&
w
, 
pS–eù
);

108491 
SQLITE_PRIVATE
 
sql™e3S–eùP»p
(

108492 
P¬£
 *
pP¬£
,

108493 
S–eù
 *
p
,

108494 
NameCÚ‹xt
 *
pOu‹rNC


108496 
sql™e3
 *
	gdb
;

108497 ifÐ
NEVER
(
p
==0) ) ;

108498 
	gdb
 = 
pP¬£
->
db
;

108499 ifÐ
	gdb
->
	gm®locFažed
 ) ;

108500 ifÐ
	gp
->
	g£lFÏgs
 & 
	gSF_HasTy³Info
 ) ;

108501 
sql™e3S–eùEx·nd
(
pP¬£
, 
p
);

108502 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ) ;

108503 
sql™e3ResÞveS–eùNames
(
pP¬£
, 
p
, 
pOu‹rNC
);

108504 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ) ;

108505 
sql™e3S–eùAddTy³Info
(
pP¬£
, 
p
);

108516 
»£tAccumuÏtÜ
(
P¬£
 *
pP¬£
, 
AggInfo
 *
pAggInfo
){

108517 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

108518 
	gi
;

108519 
AggInfo_func
 *
	gpFunc
;

108520 
	gnReg
 = 
pAggInfo
->
nFunc
 +…AggInfo->
nCÞumn
;

108521 ifÐ
	gnReg
==0 ) ;

108522 #ifdeà
SQLITE_DEBUG


108525 
as£¹
Ð
nReg
==
pAggInfo
->
mxReg
-pAggInfo->
mnReg
+1 );

108526 
	gi
=0; i<
	gpAggInfo
->
	gnCÞumn
; i++){

108527 
as£¹
Ð
pAggInfo
->
aCÞ
[
i
].
iMem
>õAggInfo->
mnReg


108528 && 
pAggInfo
->
aCÞ
[
i
].
iMem
<õAggInfo->
mxReg
 );

108530 
	gi
=0; i<
	gpAggInfo
->
	gnFunc
; i++){

108531 
as£¹
Ð
pAggInfo
->
aFunc
[
i
].
iMem
>õAggInfo->
mnReg


108532 && 
pAggInfo
->
aFunc
[
i
].
iMem
<õAggInfo->
mxReg
 );

108535 
sql™e3VdbeAddOp3
(
v
, 
OP_NuÎ
, 0, 
pAggInfo
->
mnReg
,…AggInfo->
mxReg
);

108536 
	gpFunc
=
pAggInfo
->
aFunc
, 
	gi
=0; i<
	gpAggInfo
->
	gnFunc
; i++,…Func++){

108537 ifÐ
	gpFunc
->
	giDi¡šù
>=0 ){

108538 
Ex´
 *
pE
 = 
pFunc
->
pEx´
;

108539 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pE
, 
EP_xIsS–eù
) );

108540 ifÐ
	gpE
->
	gx
.
	gpLi¡
==0 || 
pE
->
x
.
pLi¡
->
nEx´
!=1 ){

108541 
sql™e3E¼ÜMsg
(
pP¬£
, "DISTINCT‡ggregates must haveƒxactly one "

108543 
	gpFunc
->
	giDi¡šù
 = -1;

108545 
KeyInfo
 *
	gpKeyInfo
 = 
keyInfoFromEx´Li¡
(
pP¬£
, 
pE
->
x
.
pLi¡
, 0, 0);

108546 
sql™e3VdbeAddOp4
(
v
, 
OP_O³nEphem”®
, 
pFunc
->
iDi¡šù
, 0, 0,

108547 (*)
pKeyInfo
, 
P4_KEYINFO
);

108557 
fš®izeAggFunùiÚs
(
P¬£
 *
pP¬£
, 
AggInfo
 *
pAggInfo
){

108558 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

108559 
	gi
;

108560 
AggInfo_func
 *
	gpF
;

108561 
	gi
=0, 
	gpF
=
pAggInfo
->
aFunc
; i<
	gpAggInfo
->
	gnFunc
; i++,…F++){

108562 
Ex´Li¡
 *
	gpLi¡
 = 
pF
->
pEx´
->
x
.
pLi¡
;

108563 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pF
->
pEx´
, 
EP_xIsS–eù
) );

108564 
sql™e3VdbeAddOp4
(
v
, 
OP_AggFš®
, 
pF
->
iMem
, 
pLi¡
 ?…Li¡->
nEx´
 : 0, 0,

108565 (*)
pF
->
pFunc
, 
P4_FUNCDEF
);

108573 
upd©eAccumuÏtÜ
(
P¬£
 *
pP¬£
, 
AggInfo
 *
pAggInfo
){

108574 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

108575 
	gi
;

108576 
	g»gH™
 = 0;

108577 
	gaddrH™Te¡
 = 0;

108578 
AggInfo_func
 *
	gpF
;

108579 
AggInfo_cÞ
 *
	gpC
;

108581 
	gpAggInfo
->
	gdœeùMode
 = 1;

108582 
	gi
=0, 
	gpF
=
pAggInfo
->
aFunc
; i<
	gpAggInfo
->
	gnFunc
; i++,…F++){

108583 
	gnArg
;

108584 
	gaddrNext
 = 0;

108585 
	g»gAgg
;

108586 
Ex´Li¡
 *
	gpLi¡
 = 
pF
->
pEx´
->
x
.
pLi¡
;

108587 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pF
->
pEx´
, 
EP_xIsS–eù
) );

108588 ifÐ
	gpLi¡
 ){

108589 
	gnArg
 = 
pLi¡
->
nEx´
;

108590 
	g»gAgg
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nArg
);

108591 
sql™e3Ex´CodeEx´Li¡
(
pP¬£
, 
pLi¡
, 
»gAgg
, 
SQLITE_ECEL_DUP
);

108593 
	gnArg
 = 0;

108594 
	g»gAgg
 = 0;

108596 ifÐ
	gpF
->
	giDi¡šù
>=0 ){

108597 
addrNext
 = 
sql™e3VdbeMakeLab–
(
v
);

108598 
as£¹
Ð
nArg
==1 );

108599 
codeDi¡šù
(
pP¬£
, 
pF
->
iDi¡šù
, 
addrNext
, 1, 
»gAgg
);

108601 ifÐ
	gpF
->
	gpFunc
->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_NEEDCOLL
 ){

108602 
CÞlSeq
 *
	gpCÞl
 = 0;

108603 
Ex´Li¡_™em
 *
	gpI‹m
;

108604 
	gj
;

108605 
as£¹
Ð
pLi¡
!=0 );

108606 
	gj
=0, 
	gpI‹m
=
pLi¡
->
a
; !
	gpCÞl
 && j<
	gnArg
; j++,…Item++){

108607 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pI‹m
->
pEx´
);

108609 ifÐ!
	gpCÞl
 ){

108610 
	gpCÞl
 = 
pP¬£
->
db
->
pDætCÞl
;

108612 ifÐ
	g»gH™
==0 && 
pAggInfo
->
nAccumuÏtÜ
 ) 
»gH™
 = ++
pP¬£
->
nMem
;

108613 
sql™e3VdbeAddOp4
(
v
, 
OP_CÞlSeq
, 
»gH™
, 0, 0, (*)
pCÞl
, 
P4_COLLSEQ
);

108615 
sql™e3VdbeAddOp4
(
v
, 
OP_AggS‹p
, 0, 
»gAgg
, 
pF
->
iMem
,

108616 (*)
pF
->
pFunc
, 
P4_FUNCDEF
);

108617 
sql™e3VdbeChªgeP5
(
v
, (
u8
)
nArg
);

108618 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
»gAgg
, 
nArg
);

108619 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gAgg
, 
nArg
);

108620 ifÐ
	gaddrNext
 ){

108621 
sql™e3VdbeResÞveLab–
(
v
, 
addrNext
);

108622 
sql™e3Ex´CacheCË¬
(
pP¬£
);

108636 ifÐ
	g»gH™
 ){

108637 
	gaddrH™Te¡
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_If
, 
»gH™
); 
VdbeCov”age
(v);

108639 
sql™e3Ex´CacheCË¬
(
pP¬£
);

108640 
	gi
=0, 
	gpC
=
pAggInfo
->
aCÞ
; i<
	gpAggInfo
->
	gnAccumuÏtÜ
; i++,…C++){

108641 
sql™e3Ex´Code
(
pP¬£
, 
pC
->
pEx´
,…C->
iMem
);

108643 
	gpAggInfo
->
	gdœeùMode
 = 0;

108644 
sql™e3Ex´CacheCË¬
(
pP¬£
);

108645 ifÐ
	gaddrH™Te¡
 ){

108646 
sql™e3VdbeJumpH”e
(
v
, 
addrH™Te¡
);

108654 #iâdeà
SQLITE_OMIT_EXPLAIN


108655 
ex¶ašSim¶eCouÁ
(

108656 
P¬£
 *
pP¬£
,

108657 
TabË
 *
pTab
,

108658 
Index
 *
pIdx


108660 ifÐ
	gpP¬£
->
	gex¶aš
==2 ){

108661 
bCov”
 = (
pIdx
!=0 && (
HasRowid
(
pTab
è|| !
IsPrim¬yKeyIndex
(pIdx)));

108662 *
	gzEqp
 = 
sql™e3MPrštf
(
pP¬£
->
db
, "SCAN TABLE %s%s%s",

108663 
pTab
->
zName
,

108664 
bCov”
 ? " USING COVERING INDEX " : "",

108665 
bCov”
 ? 
pIdx
->
zName
 : ""

108667 
sql™e3VdbeAddOp4
(

108668 
pP¬£
->
pVdbe
, 
OP_Ex¶aš
,…P¬£->
iS–eùId
, 0, 0, 
zEqp
, 
P4_DYNAMIC


108673 
	#ex¶ašSim¶eCouÁ
(
a
,
b
,
c
)

	)

108689 
SQLITE_PRIVATE
 
sql™e3S–eù
(

108690 
P¬£
 *
pP¬£
,

108691 
S–eù
 *
p
,

108692 
S–eùDe¡
 *
pDe¡


108694 
	gi
, 
	gj
;

108695 
Wh”eInfo
 *
	gpWInfo
;

108696 
Vdbe
 *
	gv
;

108697 
	gisAgg
;

108698 
Ex´Li¡
 *
	gpELi¡
;

108699 
SrcLi¡
 *
	gpTabLi¡
;

108700 
Ex´
 *
	gpWh”e
;

108701 
Ex´Li¡
 *
	gpGroupBy
;

108702 
Ex´
 *
	gpHavšg
;

108703 
	grc
 = 1;

108704 
Di¡šùCtx
 
	gsDi¡šù
;

108705 
SÜtCtx
 
	gsSÜt
;

108706 
AggInfo
 
	gsAggInfo
;

108707 
	giEnd
;

108708 
sql™e3
 *
	gdb
;

108710 #iâdeà
SQLITE_OMIT_EXPLAIN


108711 
	giRe¡ÜeS–eùId
 = 
pP¬£
->
iS–eùId
;

108712 
	gpP¬£
->
	giS–eùId
 = 
pP¬£
->
iNextS–eùId
++;

108715 
	gdb
 = 
pP¬£
->
db
;

108716 ifÐ
	gp
==0 || 
db
->
m®locFažed
 || 
pP¬£
->
nE¼
 ){

108719 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_SELECT
, 0, 0, 0) )  1;

108720 
mem£t
(&
sAggInfo
, 0, (sAggInfo));

108721 #ià
SELECTTRACE_ENABLED


108722 
	gpP¬£
->
	gnS–eùInd’t
++;

108723 
SELECTTRACE
(1,
pP¬£
,
p
, ("begin…rocessing:\n"));

108724 ifÐ
	gsql™e3S–eùT¿û
 & 0x100 ){

108725 
sql™e3T»eV›wS–eù
(0, 
p
, 0);

108729 
as£¹
Ð
p
->
pOrd”By
==0 || 
pDe¡
->
eDe¡
!=
SRT_Di¡Fifo
 );

108730 
as£¹
Ð
p
->
pOrd”By
==0 || 
pDe¡
->
eDe¡
!=
SRT_Fifo
 );

108731 
as£¹
Ð
p
->
pOrd”By
==0 || 
pDe¡
->
eDe¡
!=
SRT_Di¡Queue
 );

108732 
as£¹
Ð
p
->
pOrd”By
==0 || 
pDe¡
->
eDe¡
!=
SRT_Queue
 );

108733 ifÐ
IgnÜabËOrd”by
(
pDe¡
) ){

108734 
as£¹
(
pDe¡
->
eDe¡
==
SRT_Exi¡s
 ||…De¡->eDe¡==
SRT_UniÚ
 ||

108735 
pDe¡
->
eDe¡
==
SRT_Exû±
 ||…De¡->eDe¡==
SRT_Disÿrd
 ||

108736 
pDe¡
->
eDe¡
==
SRT_Queue
 ||…De¡->eDe¡==
SRT_Di¡Fifo
 ||

108737 
pDe¡
->
eDe¡
==
SRT_Di¡Queue
 ||…De¡->eDe¡==
SRT_Fifo
);

108740 
sql™e3Ex´Li¡D–‘e
(
db
, 
p
->
pOrd”By
);

108741 
	gp
->
	gpOrd”By
 = 0;

108742 
	gp
->
	g£lFÏgs
 &ð~
SF_Di¡šù
;

108744 
sql™e3S–eùP»p
(
pP¬£
, 
p
, 0);

108745 
mem£t
(&
sSÜt
, 0, (sSort));

108746 
	gsSÜt
.
	gpOrd”By
 = 
p
->
pOrd”By
;

108747 
	gpTabLi¡
 = 
p
->
pSrc
;

108748 
	gpELi¡
 = 
p
->
pELi¡
;

108749 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ){

108750 
	g£Ëù_’d
;

108752 
	gisAgg
 = (
p
->
£lFÏgs
 & 
SF_Agg»g©e
)!=0;

108753 
as£¹
Ð
pELi¡
!=0 );

108757 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

108758 ifÐ
	gv
==0 ) 
£Ëù_’d
;

108763 #iâdeà
SQLITE_OMIT_SUBQUERY


108764 ifÐ
checkFÜMuÉiCÞumnS–eùE¼Ü
(
pP¬£
, 
pDe¡
, 
pELi¡
->
nEx´
) ){

108765 
	g£Ëù_’d
;

108771 #ià!
defšed
(
SQLITE_OMIT_SUBQUERY
è|| !defšed(
SQLITE_OMIT_VIEW
)

108772 
	gi
=0; !
	gp
->
	gpPriÜ
 && i<
	gpTabLi¡
->
	gnSrc
; i++){

108773 
SrcLi¡_™em
 *
	gpI‹m
 = &
pTabLi¡
->
a
[
i
];

108774 
S–eùDe¡
 
	gde¡
;

108775 
S–eù
 *
	gpSub
 = 
pI‹m
->
pS–eù
;

108776 
	gisAggSub
;

108778 ifÐ
	gpSub
==0 ) ;

108786 ifÐ
	gpI‹m
->
	gaddrFžlSub
 ){

108787 ifÐ
	gpI‹m
->
	gvŸCÜoutše
==0 ){

108788 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
pI‹m
->
»gR‘uº
,…I‹m->
addrFžlSub
);

108800 
	gpP¬£
->
	gnHeight
 +ð
sql™e3S–eùEx´Height
(
p
);

108802 
	gisAggSub
 = (
pSub
->
£lFÏgs
 & 
SF_Agg»g©e
)!=0;

108803 ifÐ
æ©‹nSubqu”y
(
pP¬£
, 
p
, 
i
, 
isAgg
, 
isAggSub
) ){

108805 ifÐ
	gisAggSub
 ){

108806 
	gisAgg
 = 1;

108807 
	gp
->
	g£lFÏgs
 |ð
SF_Agg»g©e
;

108809 
	gi
 = -1;

108810 }ifÐ
	gpTabLi¡
->
	gnSrc
==1

108811 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_SubqCÜoutše
)

108816 
	gaddrTÝ
 = 
sql™e3VdbeCu¼’tAddr
(
v
)+1;

108817 
	gpI‹m
->
	g»gR‘uº
 = ++
pP¬£
->
nMem
;

108818 
sql™e3VdbeAddOp3
(
v
, 
OP_In™CÜoutše
, 
pI‹m
->
»gR‘uº
, 0, 
addrTÝ
);

108819 
VdbeComm’t
((
v
, "%s", 
pI‹m
->
pTab
->
zName
));

108820 
	gpI‹m
->
	gaddrFžlSub
 = 
addrTÝ
;

108821 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_CÜoutše
, 
pI‹m
->
»gR‘uº
);

108822 
ex¶ašS‘IÁeg”
(
pI‹m
->
iS–eùId
, (
u8
)
pP¬£
->
iNextS–eùId
);

108823 
sql™e3S–eù
(
pP¬£
, 
pSub
, &
de¡
);

108824 
	gpI‹m
->
	gpTab
->
	gnRowLogE¡
 = 
sql™e3LogE¡
(
pSub
->
nS–eùRow
);

108825 
	gpI‹m
->
	gvŸCÜoutše
 = 1;

108826 
	gpI‹m
->
	g»gResuÉ
 = 
de¡
.
iSd¡
;

108827 
sql™e3VdbeAddOp1
(
v
, 
OP_EndCÜoutše
, 
pI‹m
->
»gR‘uº
);

108828 
sql™e3VdbeJumpH”e
(
v
, 
addrTÝ
-1);

108829 
sql™e3CË¬TempRegCache
(
pP¬£
);

108836 
	gtÝAddr
;

108837 
	gÚûAddr
 = 0;

108838 
	g»tAddr
;

108839 
as£¹
Ð
pI‹m
->
addrFžlSub
==0 );

108840 
	gpI‹m
->
	g»gR‘uº
 = ++
pP¬£
->
nMem
;

108841 
	gtÝAddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
pI‹m
->
»gR‘uº
);

108842 
	gpI‹m
->
	gaddrFžlSub
 = 
tÝAddr
+1;

108843 ifÐ
	gpI‹m
->
	gisCÜ»Ï‹d
==0 ){

108847 
ÚûAddr
 = 
sql™e3CodeOnû
(
pP¬£
); 
VdbeCov”age
(
v
);

108848 
VdbeComm’t
((
v
, "m©”Ÿliz\"%s\"", 
pI‹m
->
pTab
->
zName
));

108850 
VdbeNoÝComm’t
((
v
, "m©”Ÿliz\"%s\"", 
pI‹m
->
pTab
->
zName
));

108852 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_EphemTab
, 
pI‹m
->
iCursÜ
);

108853 
ex¶ašS‘IÁeg”
(
pI‹m
->
iS–eùId
, (
u8
)
pP¬£
->
iNextS–eùId
);

108854 
sql™e3S–eù
(
pP¬£
, 
pSub
, &
de¡
);

108855 
	gpI‹m
->
	gpTab
->
	gnRowLogE¡
 = 
sql™e3LogE¡
(
pSub
->
nS–eùRow
);

108856 ifÐ
	gÚûAddr
 ) 
sql™e3VdbeJumpH”e
(
v
, 
ÚûAddr
);

108857 
	g»tAddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
pI‹m
->
»gR‘uº
);

108858 
VdbeComm’t
((
v
, "’d %s", 
pI‹m
->
pTab
->
zName
));

108859 
sql™e3VdbeChªgeP1
(
v
, 
tÝAddr
, 
»tAddr
);

108860 
sql™e3CË¬TempRegCache
(
pP¬£
);

108862 ifÐ 
	gdb
->
	gm®locFažed
 ){

108863 
	g£Ëù_’d
;

108865 
	gpP¬£
->
	gnHeight
 -ð
sql™e3S–eùEx´Height
(
p
);

108866 
	gpTabLi¡
 = 
p
->
pSrc
;

108867 ifÐ!
IgnÜabËOrd”by
(
pDe¡
) ){

108868 
	gsSÜt
.
	gpOrd”By
 = 
p
->
pOrd”By
;

108871 
	gpELi¡
 = 
p
->
pELi¡
;

108873 
	gpWh”e
 = 
p
->
pWh”e
;

108874 
	gpGroupBy
 = 
p
->
pGroupBy
;

108875 
	gpHavšg
 = 
p
->
pHavšg
;

108876 
	gsDi¡šù
.
	gisTnù
 = (
p
->
£lFÏgs
 & 
SF_Di¡šù
)!=0;

108878 #iâdeà
SQLITE_OMIT_COMPOUND_SELECT


108881 ifÐ
	gp
->
	gpPriÜ
 ){

108882 
	grc
 = 
muÉiS–eù
(
pP¬£
, 
p
, 
pDe¡
);

108883 
ex¶ašS‘IÁeg”
(
pP¬£
->
iS–eùId
, 
iRe¡ÜeS–eùId
);

108884 #ià
SELECTTRACE_ENABLED


108885 
SELECTTRACE
(1,
pP¬£
,
p
,("end compound-select…rocessing\n"));

108886 
	gpP¬£
->
	gnS–eùInd’t
--;

108888  
	grc
;

108907 ifÐ(
	gp
->
	g£lFÏgs
 & (
	gSF_Di¡šù
|
	gSF_Agg»g©e
))==
SF_Di¡šù


108908 && 
sql™e3Ex´Li¡Com·»
(
sSÜt
.
pOrd”By
, 
p
->
pELi¡
, -1)==0

108910 
p
->
£lFÏgs
 &ð~
SF_Di¡šù
;

108911 
	gp
->
	gpGroupBy
 = 
sql™e3Ex´Li¡Dup
(
db
, 
p
->
pELi¡
, 0);

108912 
	gpGroupBy
 = 
p
->
pGroupBy
;

108913 
	gsSÜt
.
	gpOrd”By
 = 0;

108917 
as£¹
Ð
sDi¡šù
.
isTnù
 );

108927 ifÐ
	gsSÜt
.
	gpOrd”By
 ){

108928 
KeyInfo
 *
	gpKeyInfo
;

108929 
	gpKeyInfo
 = 
keyInfoFromEx´Li¡
(
pP¬£
, 
sSÜt
.
pOrd”By
, 0, 0);

108930 
	gsSÜt
.
	giECursÜ
 = 
pP¬£
->
nTab
++;

108931 
	gsSÜt
.
	gaddrSÜtIndex
 =

108932 
sql™e3VdbeAddOp4
(
v
, 
OP_O³nEphem”®
,

108933 
sSÜt
.
iECursÜ
, sSÜt.
pOrd”By
->
nEx´
+1+
pELi¡
->nExpr, 0,

108934 (*)
pKeyInfo
, 
P4_KEYINFO


108937 
	gsSÜt
.
	gaddrSÜtIndex
 = -1;

108942 ifÐ
	gpDe¡
->
	geDe¡
==
SRT_EphemTab
 ){

108943 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
pDe¡
->
iSDP¬m
, 
pELi¡
->
nEx´
);

108948 
	giEnd
 = 
sql™e3VdbeMakeLab–
(
v
);

108949 
	gp
->
	gnS–eùRow
 = 
LARGEST_INT64
;

108950 
compu‹Lim™Regi¡”s
(
pP¬£
, 
p
, 
iEnd
);

108951 ifÐ
	gp
->
	giLim™
==0 && 
sSÜt
.
addrSÜtIndex
>=0 ){

108952 
sql™e3VdbeG‘Op
(
v
, 
sSÜt
.
addrSÜtIndex
)->
Ýcode
 = 
OP_SÜ‹rO³n
;

108953 
	gsSÜt
.
	gsÜtFÏgs
 |ð
SORTFLAG_U£SÜ‹r
;

108958 ifÐ
	gp
->
	g£lFÏgs
 & 
	gSF_Di¡šù
 ){

108959 
	gsDi¡šù
.
	gbTnù
 = 
pP¬£
->
nTab
++;

108960 
	gsDi¡šù
.
	gaddrTnù
 = 
sql™e3VdbeAddOp4
(
v
, 
OP_O³nEphem”®
,

108961 
sDi¡šù
.
bTnù
, 0, 0,

108962 (*)
keyInfoFromEx´Li¡
(
pP¬£
, 
p
->
pELi¡
,0,0),

108963 
P4_KEYINFO
);

108964 
sql™e3VdbeChªgeP5
(
v
, 
BTREE_UNORDERED
);

108965 
	gsDi¡šù
.
	geTnùTy³
 = 
WHERE_DISTINCT_UNORDERED
;

108967 
	gsDi¡šù
.
	geTnùTy³
 = 
WHERE_DISTINCT_NOOP
;

108970 ifÐ!
	gisAgg
 && 
	gpGroupBy
==0 ){

108972 
u16
 
wù¾FÏgs
 = (
sDi¡šù
.
isTnù
 ? 
WHERE_WANT_DISTINCT
 : 0);

108975 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pTabLi¡
, 
pWh”e
, 
sSÜt
.
pOrd”By
,

108976 
p
->
pELi¡
, 
wù¾FÏgs
, 0);

108977 ifÐ
	gpWInfo
==0 ) 
£Ëù_’d
;

108978 ifÐ
sql™e3Wh”eOuutRowCouÁ
(
pWInfo
è< 
	gp
->
	gnS–eùRow
 ){

108979 
	gp
->
	gnS–eùRow
 = 
sql™e3Wh”eOuutRowCouÁ
(
pWInfo
);

108981 ifÐ
	gsDi¡šù
.
	gisTnù
 && 
sql™e3Wh”eIsDi¡šù
(
pWInfo
) ){

108982 
	gsDi¡šù
.
	geTnùTy³
 = 
sql™e3Wh”eIsDi¡šù
(
pWInfo
);

108984 ifÐ
	gsSÜt
.
	gpOrd”By
 ){

108985 
	gsSÜt
.
	gnOBS©
 = 
sql™e3Wh”eIsOrd”ed
(
pWInfo
);

108986 ifÐ
	gsSÜt
.
	gnOBS©
==
sSÜt
.
pOrd”By
->
nEx´
 ){

108987 
sSÜt
.
pOrd”By
 = 0;

108995 ifÐ
	gsSÜt
.
	gaddrSÜtIndex
>=0 && 
sSÜt
.
pOrd”By
==0 ){

108996 
sql™e3VdbeChªgeToNoÝ
(
v
, 
sSÜt
.
addrSÜtIndex
);

109000 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
, 
pELi¡
, -1, &
sSÜt
, &
sDi¡šù
, 
pDe¡
,

109001 
sql™e3Wh”eCÚtšueLab–
(
pWInfo
),

109002 
sql™e3Wh”eB»akLab–
(
pWInfo
));

109006 
sql™e3Wh”eEnd
(
pWInfo
);

109010 
NameCÚ‹xt
 
	gsNC
;

109011 
	giAMem
;

109012 
	giBMem
;

109013 
	giU£FÏg
;

109016 
	giAbÜtFÏg
;

109017 
	ggroupBySÜt
;

109018 
	gaddrEnd
;

109019 
	gsÜtPTab
 = 0;

109020 
	gsÜtOut
 = 0;

109021 
	gÜd”ByG½
 = 0;

109026 ifÐ
	gpGroupBy
 ){

109027 
	gk
;

109028 
Ex´Li¡_™em
 *
	gpI‹m
;

109030 
	gk
=
p
->
pELi¡
->
nEx´
, 
	gpI‹m
õ->pELi¡->
a
; k>0; k--,…Item++){

109031 
	gpI‹m
->
	gu
.
	gx
.
	giAlŸs
 = 0;

109033 
	gk
=
pGroupBy
->
nEx´
, 
	gpI‹m
õGroupBy->
a
; k>0; k--,…Item++){

109034 
	gpI‹m
->
	gu
.
	gx
.
	giAlŸs
 = 0;

109036 ifÐ
	gp
->
	gnS–eùRow
>100 )…->nSelectRow = 100;

109038 
	gp
->
	gnS–eùRow
 = 1;

109050 ifÐ
sql™e3Ex´Li¡Com·»
(
pGroupBy
, 
sSÜt
.
pOrd”By
, -1)==0 ){

109051 
Üd”ByG½
 = 1;

109055 
	gaddrEnd
 = 
sql™e3VdbeMakeLab–
(
v
);

109061 
mem£t
(&
sNC
, 0, (sNC));

109062 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

109063 
	gsNC
.
	gpSrcLi¡
 = 
pTabLi¡
;

109064 
	gsNC
.
	gpAggInfo
 = &
sAggInfo
;

109065 
	gsAggInfo
.
	gmnReg
 = 
pP¬£
->
nMem
+1;

109066 
	gsAggInfo
.
	gnSÜtšgCÞumn
 = 
pGroupBy
 ?…GroupBy->
nEx´
 : 0;

109067 
	gsAggInfo
.
	gpGroupBy
 = 
pGroupBy
;

109068 
sql™e3Ex´AÇlyzeAggLi¡
(&
sNC
, 
pELi¡
);

109069 
sql™e3Ex´AÇlyzeAggLi¡
(&
sNC
, 
sSÜt
.
pOrd”By
);

109070 ifÐ
	gpHavšg
 ){

109071 
sql™e3Ex´AÇlyzeAgg»g©es
(&
sNC
, 
pHavšg
);

109073 
	gsAggInfo
.
	gnAccumuÏtÜ
 = 
sAggInfo
.
nCÞumn
;

109074 
	gi
=0; i<
	gsAggInfo
.
	gnFunc
; i++){

109075 
as£¹
Ð!
Ex´HasPrÝ”ty
(
sAggInfo
.
aFunc
[
i
].
pEx´
, 
EP_xIsS–eù
) );

109076 
	gsNC
.
	gncFÏgs
 |ð
NC_InAggFunc
;

109077 
sql™e3Ex´AÇlyzeAggLi¡
(&
sNC
, 
sAggInfo
.
aFunc
[
i
].
pEx´
->
x
.
pLi¡
);

109078 
	gsNC
.
	gncFÏgs
 &ð~
NC_InAggFunc
;

109080 
	gsAggInfo
.
	gmxReg
 = 
pP¬£
->
nMem
;

109081 ifÐ
	gdb
->
	gm®locFažed
 ) 
	g£Ëù_’d
;

109086 ifÐ
	gpGroupBy
 ){

109087 
KeyInfo
 *
	gpKeyInfo
;

109088 
	gj1
;

109089 
	gaddrOuutRow
;

109090 
	g»gOuutRow
;

109091 
	gaddrS‘AbÜt
;

109092 
	gaddrTÝOfLoÝ
;

109093 
	gaddrSÜtšgIdx
;

109094 
	gaddrRe£t
;

109095 
	g»gRe£t
;

109102 
	gsAggInfo
.
	gsÜtšgIdx
 = 
pP¬£
->
nTab
++;

109103 
	gpKeyInfo
 = 
keyInfoFromEx´Li¡
(
pP¬£
, 
pGroupBy
, 0, 0);

109104 
	gaddrSÜtšgIdx
 = 
sql™e3VdbeAddOp4
(
v
, 
OP_SÜ‹rO³n
,

109105 
sAggInfo
.
sÜtšgIdx
, sAggInfo.
nSÜtšgCÞumn
,

109106 0, (*)
pKeyInfo
, 
P4_KEYINFO
);

109110 
	giU£FÏg
 = ++
pP¬£
->
nMem
;

109111 
	giAbÜtFÏg
 = ++
pP¬£
->
nMem
;

109112 
	g»gOuutRow
 = ++
pP¬£
->
nMem
;

109113 
	gaddrOuutRow
 = 
sql™e3VdbeMakeLab–
(
v
);

109114 
	g»gRe£t
 = ++
pP¬£
->
nMem
;

109115 
	gaddrRe£t
 = 
sql™e3VdbeMakeLab–
(
v
);

109116 
	giAMem
 = 
pP¬£
->
nMem
 + 1;

109117 
	gpP¬£
->
	gnMem
 +ð
pGroupBy
->
nEx´
;

109118 
	giBMem
 = 
pP¬£
->
nMem
 + 1;

109119 
	gpP¬£
->
	gnMem
 +ð
pGroupBy
->
nEx´
;

109120 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
iAbÜtFÏg
);

109121 
VdbeComm’t
((
v
, "clear‡bort flag"));

109122 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
iU£FÏg
);

109123 
VdbeComm’t
((
v
, "indicate‡ccumulatorƒmpty"));

109124 
sql™e3VdbeAddOp3
(
v
, 
OP_NuÎ
, 0, 
iAMem
, iAMem+
pGroupBy
->
nEx´
-1);

109131 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gRe£t
, 
addrRe£t
);

109132 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pTabLi¡
, 
pWh”e
, 
pGroupBy
, 0,

109133 
WHERE_GROUPBY
 | (
Üd”ByG½
 ? 
WHERE_SORTBYGROUP
 : 0), 0

109135 ifÐ
	gpWInfo
==0 ) 
£Ëù_’d
;

109136 ifÐ
sql™e3Wh”eIsOrd”ed
(
pWInfo
)==
pGroupBy
->
nEx´
 ){

109141 
groupBySÜt
 = 0;

109148 
	g»gBa£
;

109149 
	g»gRecÜd
;

109150 
	gnCÞ
;

109151 
	gnGroupBy
;

109153 
ex¶ašTempTabË
(
pP¬£
,

109154 (
sDi¡šù
.
isTnù
 && (
p
->
£lFÏgs
&
SF_Di¡šù
)==0) ?

109157 
	ggroupBySÜt
 = 1;

109158 
	gnGroupBy
 = 
pGroupBy
->
nEx´
;

109159 
	gnCÞ
 = 
nGroupBy
;

109160 
	gj
 = 
nGroupBy
;

109161 
	gi
=0; i<
	gsAggInfo
.
	gnCÞumn
; i++){

109162 ifÐ
	gsAggInfo
.
	gaCÞ
[
i
].
	giSÜ‹rCÞumn
>=
j
 ){

109163 
nCÞ
++;

109164 
	gj
++;

109167 
	g»gBa£
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nCÞ
);

109168 
sql™e3Ex´CacheCË¬
(
pP¬£
);

109169 
sql™e3Ex´CodeEx´Li¡
(
pP¬£
, 
pGroupBy
, 
»gBa£
, 0);

109170 
	gj
 = 
nGroupBy
;

109171 
	gi
=0; i<
	gsAggInfo
.
	gnCÞumn
; i++){

109172 
AggInfo_cÞ
 *
	gpCÞ
 = &
sAggInfo
.
aCÞ
[
i
];

109173 ifÐ
	gpCÞ
->
	giSÜ‹rCÞumn
>=
j
 ){

109174 
r1
 = 
j
 + 
»gBa£
;

109175 
	gr2
;

109177 
	gr2
 = 
sql™e3Ex´CodeG‘CÞumn
(
pP¬£
,

109178 
pCÞ
->
pTab
,…CÞ->
iCÞumn
,…CÞ->
iTabË
, 
r1
, 0);

109179 ifÐ
	gr1
!=
r2
 ){

109180 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
r2
, 
r1
);

109182 
	gj
++;

109185 
	g»gRecÜd
 = 
sql™e3G‘TempReg
(
pP¬£
);

109186 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
»gBa£
, 
nCÞ
, 
»gRecÜd
);

109187 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rIn£¹
, 
sAggInfo
.
sÜtšgIdx
, 
»gRecÜd
);

109188 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRecÜd
);

109189 
sql™e3R–—£TempRªge
(
pP¬£
, 
»gBa£
, 
nCÞ
);

109190 
sql™e3Wh”eEnd
(
pWInfo
);

109191 
	gsAggInfo
.
	gsÜtšgIdxPTab
 = 
sÜtPTab
 = 
pP¬£
->
nTab
++;

109192 
	gsÜtOut
 = 
sql™e3G‘TempReg
(
pP¬£
);

109193 
sql™e3VdbeAddOp3
(
v
, 
OP_O³nP£udo
, 
sÜtPTab
, 
sÜtOut
, 
nCÞ
);

109194 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rSÜt
, 
sAggInfo
.
sÜtšgIdx
, 
addrEnd
);

109195 
VdbeComm’t
((
v
, "GROUP BY sÜt")); 
VdbeCov”age
(v);

109196 
	gsAggInfo
.
	gu£SÜtšgIdx
 = 1;

109197 
sql™e3Ex´CacheCË¬
(
pP¬£
);

109208 ifÐ
	gÜd”ByG½
 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_GroupByOrd”
)

109209 && (
	ggroupBySÜt
 || 
sql™e3Wh”eIsSÜ‹d
(
pWInfo
))

109211 
	gsSÜt
.
	gpOrd”By
 = 0;

109212 
sql™e3VdbeChªgeToNoÝ
(
v
, 
sSÜt
.
addrSÜtIndex
);

109220 
	gaddrTÝOfLoÝ
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

109221 
sql™e3Ex´CacheCË¬
(
pP¬£
);

109222 ifÐ
	ggroupBySÜt
 ){

109223 
sql™e3VdbeAddOp3
(
v
, 
OP_SÜ‹rD©a
, 
sAggInfo
.
sÜtšgIdx
, 
sÜtOut
,
sÜtPTab
);

109225 
	gj
=0; j<
	gpGroupBy
->
	gnEx´
; j++){

109226 ifÐ
	ggroupBySÜt
 ){

109227 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
sÜtPTab
, 
j
, 
iBMem
+j);

109229 
	gsAggInfo
.
	gdœeùMode
 = 1;

109230 
sql™e3Ex´Code
(
pP¬£
, 
pGroupBy
->
a
[
j
].
pEx´
, 
iBMem
+j);

109233 
sql™e3VdbeAddOp4
(
v
, 
OP_Com·»
, 
iAMem
, 
iBMem
, 
pGroupBy
->
nEx´
,

109234 (*)
sql™e3KeyInfoRef
(
pKeyInfo
), 
P4_KEYINFO
);

109235 
	gj1
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

109236 
sql™e3VdbeAddOp3
(
v
, 
OP_Jump
, 
j1
+1, 0, j1+1); 
VdbeCov”age
(v);

109247 
sql™e3Ex´CodeMove
(
pP¬£
, 
iBMem
, 
iAMem
, 
pGroupBy
->
nEx´
);

109248 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOuutRow
, 
addrOuutRow
);

109249 
VdbeComm’t
((
v
, "output one„ow"));

109250 
sql™e3VdbeAddOp2
(
v
, 
OP_IfPos
, 
iAbÜtFÏg
, 
addrEnd
); 
VdbeCov”age
(v);

109251 
VdbeComm’t
((
v
, "check‡bort flag"));

109252 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gRe£t
, 
addrRe£t
);

109253 
VdbeComm’t
((
v
, "reset‡ccumulator"));

109258 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

109259 
upd©eAccumuÏtÜ
(
pP¬£
, &
sAggInfo
);

109260 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
iU£FÏg
);

109261 
VdbeComm’t
((
v
, "indicate data in‡ccumulator"));

109265 ifÐ
	ggroupBySÜt
 ){

109266 
sql™e3VdbeAddOp2
(
v
, 
OP_SÜ‹rNext
, 
sAggInfo
.
sÜtšgIdx
, 
addrTÝOfLoÝ
);

109267 
VdbeCov”age
(
v
);

109269 
sql™e3Wh”eEnd
(
pWInfo
);

109270 
sql™e3VdbeChªgeToNoÝ
(
v
, 
addrSÜtšgIdx
);

109275 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gOuutRow
, 
addrOuutRow
);

109276 
VdbeComm’t
((
v
, "output final„ow"));

109280 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
addrEnd
);

109289 
	gaddrS‘AbÜt
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

109290 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
iAbÜtFÏg
);

109291 
VdbeComm’t
((
v
, "set‡bort flag"));

109292 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
»gOuutRow
);

109293 
sql™e3VdbeResÞveLab–
(
v
, 
addrOuutRow
);

109294 
	gaddrOuutRow
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

109295 
sql™e3VdbeAddOp2
(
v
, 
OP_IfPos
, 
iU£FÏg
, 
addrOuutRow
+2); 
VdbeCov”age
(v);

109296 
VdbeComm’t
((
v
, "Groupby„esult generatorƒntry…oint"));

109297 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
»gOuutRow
);

109298 
fš®izeAggFunùiÚs
(
pP¬£
, &
sAggInfo
);

109299 
sql™e3Ex´IfF®£
(
pP¬£
, 
pHavšg
, 
addrOuutRow
+1, 
SQLITE_JUMPIFNULL
);

109300 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
,…->
pELi¡
, -1, &
sSÜt
,

109301 &
sDi¡šù
, 
pDe¡
,

109302 
addrOuutRow
+1, 
addrS‘AbÜt
);

109303 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
»gOuutRow
);

109304 
VdbeComm’t
((
v
, "end groupby„esult generator"));

109308 
sql™e3VdbeResÞveLab–
(
v
, 
addrRe£t
);

109309 
»£tAccumuÏtÜ
(
pP¬£
, &
sAggInfo
);

109310 
sql™e3VdbeAddOp1
(
v
, 
OP_R‘uº
, 
»gRe£t
);

109314 
Ex´Li¡
 *
	gpD–
 = 0;

109315 #iâdeà
SQLITE_OMIT_BTREECOUNT


109316 
TabË
 *
	gpTab
;

109317 ifÐ(
	gpTab
 = 
isSim¶eCouÁ
(
p
, &
sAggInfo
))!=0 ){

109331 cÚ¡ 
iDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

109332 cÚ¡ 
	giC¤
 = 
pP¬£
->
nTab
++;

109333 
Index
 *
	gpIdx
;

109334 
KeyInfo
 *
	gpKeyInfo
 = 0;

109335 
Index
 *
	gpBe¡
 = 0;

109336 
	giRoÙ
 = 
pTab
->
Šum
;

109338 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

109339 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 0,…Tab->
zName
);

109350 ifÐ!
HasRowid
(
pTab
èè
	gpBe¡
 = 
sql™e3Prim¬yKeyIndex
(pTab);

109351 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

109352 ifÐ
pIdx
->
bUnÜd”ed
==0

109353 && 
pIdx
->
szIdxRow
<
pTab
->
szTabRow


109354 && 
pIdx
->
pP¬tIdxWh”e
==0

109355 && (!
pBe¡
 || 
pIdx
->
szIdxRow
<pBest->szIdxRow)

109357 
pBe¡
 = 
pIdx
;

109360 ifÐ
	gpBe¡
 ){

109361 
	giRoÙ
 = 
pBe¡
->
Šum
;

109362 
	gpKeyInfo
 = 
sql™e3KeyInfoOfIndex
(
pP¬£
, 
pBe¡
);

109366 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_O³nR—d
, 
iC¤
, 
iRoÙ
, 
iDb
, 1);

109367 ifÐ
	gpKeyInfo
 ){

109368 
sql™e3VdbeChªgeP4
(
v
, -1, (*)
pKeyInfo
, 
P4_KEYINFO
);

109370 
sql™e3VdbeAddOp2
(
v
, 
OP_CouÁ
, 
iC¤
, 
sAggInfo
.
aFunc
[0].
iMem
);

109371 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
iC¤
);

109372 
ex¶ašSim¶eCouÁ
(
pP¬£
, 
pTab
, 
pBe¡
);

109401 
Ex´Li¡
 *
	gpMšMax
 = 0;

109402 
u8
 
	gæag
 = 
WHERE_ORDERBY_NORMAL
;

109404 
as£¹
Ð
p
->
pGroupBy
==0 );

109405 
as£¹
Ð
æag
==0 );

109406 ifÐ
	gp
->
	gpHavšg
==0 ){

109407 
æag
 = 
mšMaxQu”y
(&
sAggInfo
, &
pMšMax
);

109409 
as£¹
Ð
æag
==0 || (
pMšMax
!=0 &&…MšMax->
nEx´
==1) );

109411 ifÐ
	gæag
 ){

109412 
	gpMšMax
 = 
sql™e3Ex´Li¡Dup
(
db
, 
pMšMax
, 0);

109413 
	gpD–
 = 
pMšMax
;

109414 ifÐ
	gpMšMax
 && !
	gdb
->
	gm®locFažed
 ){

109415 
	gpMšMax
->
	ga
[0].
	gsÜtOrd”
 = 
æag
!=
WHERE_ORDERBY_MIN
 ?1:0;

109416 
	gpMšMax
->
	ga
[0].
	gpEx´
->
	gÝ
 = 
TK_COLUMN
;

109424 
»£tAccumuÏtÜ
(
pP¬£
, &
sAggInfo
);

109425 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pTabLi¡
, 
pWh”e
, 
pMšMax
,0,
æag
,0);

109426 ifÐ
	gpWInfo
==0 ){

109427 
sql™e3Ex´Li¡D–‘e
(
db
, 
pD–
);

109428 
	g£Ëù_’d
;

109430 
upd©eAccumuÏtÜ
(
pP¬£
, &
sAggInfo
);

109431 
as£¹
Ð
pMšMax
==0 ||…MšMax->
nEx´
==1 );

109432 ifÐ
sql™e3Wh”eIsOrd”ed
(
pWInfo
)>0 ){

109433 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
sql™e3Wh”eB»akLab–
(
pWInfo
));

109434 
VdbeComm’t
((
v
, "%s() by index",

109435 (
æag
==
WHERE_ORDERBY_MIN
?"min":"max")));

109437 
sql™e3Wh”eEnd
(
pWInfo
);

109438 
fš®izeAggFunùiÚs
(
pP¬£
, &
sAggInfo
);

109441 
	gsSÜt
.
	gpOrd”By
 = 0;

109442 
sql™e3Ex´IfF®£
(
pP¬£
, 
pHavšg
, 
addrEnd
, 
SQLITE_JUMPIFNULL
);

109443 
£ËùIÂ”LoÝ
(
pP¬£
, 
p
,…->
pELi¡
, -1, 0, 0,

109444 
pDe¡
, 
addrEnd
,‡ddrEnd);

109445 
sql™e3Ex´Li¡D–‘e
(
db
, 
pD–
);

109447 
sql™e3VdbeResÞveLab–
(
v
, 
addrEnd
);

109451 ifÐ
	gsDi¡šù
.
	geTnùTy³
==
WHERE_DISTINCT_UNORDERED
 ){

109452 
ex¶ašTempTabË
(
pP¬£
, "DISTINCT");

109458 ifÐ
	gsSÜt
.
	gpOrd”By
 ){

109459 
ex¶ašTempTabË
(
pP¬£
, 
sSÜt
.
nOBS©
>0 ? "RIGHT PART OF ORDER BY":"ORDER BY");

109460 
g’”©eSÜtTaž
(
pP¬£
, 
p
, &
sSÜt
, 
pELi¡
->
nEx´
, 
pDe¡
);

109465 
sql™e3VdbeResÞveLab–
(
v
, 
iEnd
);

109470 
	grc
 = 0;

109475 
	g£Ëù_’d
:

109476 
ex¶ašS‘IÁeg”
(
pP¬£
->
iS–eùId
, 
iRe¡ÜeS–eùId
);

109480 ifÐ
	grc
==
SQLITE_OK
 && 
pDe¡
->
eDe¡
==
SRT_Ouut
 ){

109481 
g’”©eCÞumnNames
(
pP¬£
, 
pTabLi¡
, 
pELi¡
);

109484 
sql™e3DbF»e
(
db
, 
sAggInfo
.
aCÞ
);

109485 
sql™e3DbF»e
(
db
, 
sAggInfo
.
aFunc
);

109486 #ià
SELECTTRACE_ENABLED


109487 
SELECTTRACE
(1,
pP¬£
,
p
,("end…rocessing\n"));

109488 
	gpP¬£
->
	gnS–eùInd’t
--;

109490  
	grc
;

109493 #ifdeà
SQLITE_DEBUG


109497 
SQLITE_PRIVATE
 
sql™e3T»eV›wS–eù
(
T»eV›w
 *
pV›w
, cÚ¡ 
S–eù
 *
p
, 
u8
 
mÜeToFÞlow
){

109498 
	gn
 = 0;

109499 
	gpV›w
 = 
sql™e3T»eV›wPush
(
pV›w
, 
mÜeToFÞlow
);

109500 
sql™e3T»eV›wLše
(
pV›w
, "SELECT%s%s",

109501 ((
p
->
£lFÏgs
 & 
SF_Di¡šù
) ? " DISTINCT" : ""),

109502 ((
p
->
£lFÏgs
 & 
SF_Agg»g©e
) ? "‡gg_flag" : "")

109504 ifÐ
	gp
->
	gpSrc
 &&…->pSrc->
	gnSrc
 ) 
	gn
++;

109505 ifÐ
	gp
->
	gpWh”e
 ) 
	gn
++;

109506 ifÐ
	gp
->
	gpGroupBy
 ) 
	gn
++;

109507 ifÐ
	gp
->
	gpHavšg
 ) 
	gn
++;

109508 ifÐ
	gp
->
	gpOrd”By
 ) 
	gn
++;

109509 ifÐ
	gp
->
	gpLim™
 ) 
	gn
++;

109510 ifÐ
	gp
->
	gpOff£t
 ) 
	gn
++;

109511 ifÐ
	gp
->
	gpPriÜ
 ) 
	gn
++;

109512 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
p
->
pELi¡
, (
n
--)>0, "result-set");

109513 ifÐ
	gp
->
	gpSrc
 &&…->pSrc->
	gnSrc
 ){

109514 
	gi
;

109515 
	gpV›w
 = 
sql™e3T»eV›wPush
(
pV›w
, (
n
--)>0);

109516 
sql™e3T»eV›wLše
(
pV›w
, "FROM");

109517 
	gi
=0; i<
	gp
->
	gpSrc
->
	gnSrc
; i++){

109518 
SrcLi¡_™em
 *
	gpI‹m
 = &
p
->
pSrc
->
a
[
i
];

109519 
SŒAccum
 
	gx
;

109520 
	gzLše
[100];

109521 
sql™e3SŒAccumIn™
(&
x
, 
zLše
, (zLine), 0);

109522 
sql™e3XPrštf
(&
x
, 0, "{%d,*}", 
pI‹m
->
iCursÜ
);

109523 ifÐ
	gpI‹m
->
	gzD©aba£
 ){

109524 
sql™e3XPrštf
(&
x
, 0, " %s.%s", 
pI‹m
->
zD©aba£
,…I‹m->
zName
);

109525 }ifÐ
	gpI‹m
->
	gzName
 ){

109526 
sql™e3XPrštf
(&
x
, 0, " %s", 
pI‹m
->
zName
);

109528 ifÐ
	gpI‹m
->
	gpTab
 ){

109529 
sql™e3XPrštf
(&
x
, 0, "abÇme=%Q", 
pI‹m
->
pTab
->
zName
);

109531 ifÐ
	gpI‹m
->
	gzAlŸs
 ){

109532 
sql™e3XPrštf
(&
x
, 0, " (AS %s)", 
pI‹m
->
zAlŸs
);

109534 ifÐ
	gpI‹m
->
	gjošty³
 & 
	gJT_LEFT
 ){

109535 
sql™e3XPrštf
(&
x
, 0, " LEFT-JOIN");

109537 
sql™e3SŒAccumFšish
(&
x
);

109538 
sql™e3T»eV›wI‹m
(
pV›w
, 
zLše
, 
i
<
p
->
pSrc
->
nSrc
-1);

109539 ifÐ
	gpI‹m
->
	gpS–eù
 ){

109540 
sql™e3T»eV›wS–eù
(
pV›w
, 
pI‹m
->
pS–eù
, 0);

109542 
sql™e3T»eV›wPÝ
(
pV›w
);

109544 
sql™e3T»eV›wPÝ
(
pV›w
);

109546 ifÐ
	gp
->
	gpWh”e
 ){

109547 
sql™e3T»eV›wI‹m
(
pV›w
, "WHERE", (
n
--)>0);

109548 
sql™e3T»eV›wEx´
(
pV›w
, 
p
->
pWh”e
, 0);

109549 
sql™e3T»eV›wPÝ
(
pV›w
);

109551 ifÐ
	gp
->
	gpGroupBy
 ){

109552 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
p
->
pGroupBy
, (
n
--)>0, "GROUPBY");

109554 ifÐ
	gp
->
	gpHavšg
 ){

109555 
sql™e3T»eV›wI‹m
(
pV›w
, "HAVING", (
n
--)>0);

109556 
sql™e3T»eV›wEx´
(
pV›w
, 
p
->
pHavšg
, 0);

109557 
sql™e3T»eV›wPÝ
(
pV›w
);

109559 ifÐ
	gp
->
	gpOrd”By
 ){

109560 
sql™e3T»eV›wEx´Li¡
(
pV›w
, 
p
->
pOrd”By
, (
n
--)>0, "ORDERBY");

109562 ifÐ
	gp
->
	gpLim™
 ){

109563 
sql™e3T»eV›wI‹m
(
pV›w
, "LIMIT", (
n
--)>0);

109564 
sql™e3T»eV›wEx´
(
pV›w
, 
p
->
pLim™
, 0);

109565 
sql™e3T»eV›wPÝ
(
pV›w
);

109567 ifÐ
	gp
->
	gpOff£t
 ){

109568 
sql™e3T»eV›wI‹m
(
pV›w
, "OFFSET", (
n
--)>0);

109569 
sql™e3T»eV›wEx´
(
pV›w
, 
p
->
pOff£t
, 0);

109570 
sql™e3T»eV›wPÝ
(
pV›w
);

109572 ifÐ
	gp
->
	gpPriÜ
 ){

109573 cÚ¡ *
	gzOp
 = "UNION";

109574  
	gp
->
	gÝ
 ){

109575 
	gTK_ALL
: 
zOp
 = "UNION ALL"; ;

109576 
	gTK_INTERSECT
: 
zOp
 = "INTERSECT"; ;

109577 
	gTK_EXCEPT
: 
zOp
 = "EXCEPT"; ;

109579 
sql™e3T»eV›wI‹m
(
pV›w
, 
zOp
, (
n
--)>0);

109580 
sql™e3T»eV›wS–eù
(
pV›w
, 
p
->
pPriÜ
, 0);

109581 
sql™e3T»eV›wPÝ
(
pV›w
);

109583 
sql™e3T»eV›wPÝ
(
pV›w
);

109610 #iâdeà
SQLITE_OMIT_GET_TABLE


109616 
	sTabResuÉ
 {

109617 **
	gazResuÉ
;

109618 *
	gzE¼Msg
;

109619 
u32
 
	gnAÎoc
;

109620 
u32
 
	gnRow
;

109621 
u32
 
	gnCÞumn
;

109622 
u32
 
	gnD©a
;

109623 
	grc
;

109624 } 
	tTabResuÉ
;

109631 
sql™e3_g‘_bË_cb
(*
pArg
, 
nCÞ
, **
¬gv
, **
cÞv
){

109632 
TabResuÉ
 *
	gp
 = (TabResuÉ*)
pArg
;

109633 
	gÃed
;

109634 
	gi
;

109635 *
	gz
;

109640 ifÐ
	gp
->
	gnRow
==0 && 
¬gv
!=0 ){

109641 
Ãed
 = 
nCÞ
*2;

109643 
	gÃed
 = 
nCÞ
;

109645 ifÐ
	gp
->
	gnD©a
 + 
	gÃed
 >…->
	gnAÎoc
 ){

109646 **
	gazNew
;

109647 
	gp
->
	gnAÎoc
 = 
p
->
nAÎoc
*2 + 
Ãed
;

109648 
	gazNew
 = 
sql™e3_»®loc64
Ð
p
->
azResuÉ
, (*)*p->
nAÎoc
 );

109649 ifÐ
	gazNew
==0 ) 
m®loc_çžed
;

109650 
	gp
->
	gazResuÉ
 = 
azNew
;

109656 ifÐ
	gp
->
	gnRow
==0 ){

109657 
p
->
nCÞumn
 = 
nCÞ
;

109658 
	gi
=0; i<
	gnCÞ
; i++){

109659 
	gz
 = 
sql™e3_m´štf
("%s", 
cÞv
[
i
]);

109660 ifÐ
	gz
==0 ) 
m®loc_çžed
;

109661 
	gp
->
	gazResuÉ
[
p
->
nD©a
++] = 
z
;

109663 }ifÐ()
	gp
->
	gnCÞumn
!=
nCÞ
 ){

109664 
sql™e3_ä“
(
p
->
zE¼Msg
);

109665 
	gp
->
	gzE¼Msg
 = 
sql™e3_m´štf
(

109668 
	gp
->
	grc
 = 
SQLITE_ERROR
;

109674 ifÐ
	g¬gv
!=0 ){

109675 
i
=0; 
	gi
<
	gnCÞ
; i++){

109676 ifÐ
	g¬gv
[
i
]==0 ){

109677 
z
 = 0;

109679 
	gn
 = 
sql™e3SŒËn30
(
¬gv
[
i
])+1;

109680 
	gz
 = 
sql™e3_m®loc
Ð
n
 );

109681 ifÐ
	gz
==0 ) 
m®loc_çžed
;

109682 
memýy
(
z
, 
¬gv
[
i
], 
n
);

109684 
	gp
->
	gazResuÉ
[
p
->
nD©a
++] = 
z
;

109686 
	gp
->
	gnRow
++;

109690 
	gm®loc_çžed
:

109691 
p
->
rc
 = 
SQLITE_NOMEM
;

109705 
SQLITE_API
 
sql™e3_g‘_bË
(

109706 
sql™e3
 *
db
,

109707 cÚ¡ *
zSql
,

109708 ***
·zResuÉ
,

109709 *
²Row
,

109710 *
²CÞumn
,

109711 **
pzE¼Msg


109713 
	grc
;

109714 
TabResuÉ
 
	g»s
;

109716 *
	g·zResuÉ
 = 0;

109717 ifÐ
	g²CÞumn
 ) *pnColumn = 0;

109718 ifÐ
	g²Row
 ) *pnRow = 0;

109719 ifÐ
	gpzE¼Msg
 ) *pzErrMsg = 0;

109720 
	g»s
.
	gzE¼Msg
 = 0;

109721 
	g»s
.
	gnRow
 = 0;

109722 
	g»s
.
	gnCÞumn
 = 0;

109723 
	g»s
.
	gnD©a
 = 1;

109724 
	g»s
.
	gnAÎoc
 = 20;

109725 
	g»s
.
	grc
 = 
SQLITE_OK
;

109726 
	g»s
.
	gazResuÉ
 = 
sql™e3_m®loc
((*)*
»s
.
nAÎoc
 );

109727 ifÐ
	g»s
.
	gazResuÉ
==0 ){

109728 
db
->
”rCode
 = 
SQLITE_NOMEM
;

109729  
	gSQLITE_NOMEM
;

109731 
	g»s
.
	gazResuÉ
[0] = 0;

109732 
	grc
 = 
sql™e3_exec
(
db
, 
zSql
, 
sql™e3_g‘_bË_cb
, &
»s
, 
pzE¼Msg
);

109733 
as£¹
Ð(
»s
.
azResuÉ
[0])>ðÔes.
nD©a
) );

109734 
	g»s
.
	gazResuÉ
[0] = 
SQLITE_INT_TO_PTR
(
»s
.
nD©a
);

109735 ifÐ(
	grc
&0xff)==
SQLITE_ABORT
 ){

109736 
sql™e3_ä“_bË
(&
»s
.
azResuÉ
[1]);

109737 ifÐ
	g»s
.
	gzE¼Msg
 ){

109738 ifÐ
	gpzE¼Msg
 ){

109739 
sql™e3_ä“
(*
pzE¼Msg
);

109740 *
	gpzE¼Msg
 = 
sql™e3_m´štf
("%s",
»s
.
zE¼Msg
);

109742 
sql™e3_ä“
(
»s
.
zE¼Msg
);

109744 
	gdb
->
	g”rCode
 = 
»s
.
rc
;

109745  
	g»s
.
	grc
;

109747 
sql™e3_ä“
(
»s
.
zE¼Msg
);

109748 ifÐ
	grc
!=
SQLITE_OK
 ){

109749 
sql™e3_ä“_bË
(&
»s
.
azResuÉ
[1]);

109750  
	grc
;

109752 ifÐ
	g»s
.
	gnAÎoc
>»s.
	gnD©a
 ){

109753 **
	gazNew
;

109754 
	gazNew
 = 
sql™e3_»®loc
Ð
»s
.
azResuÉ
, (*)*»s.
nD©a
 );

109755 ifÐ
	gazNew
==0 ){

109756 
sql™e3_ä“_bË
(&
»s
.
azResuÉ
[1]);

109757 
	gdb
->
	g”rCode
 = 
SQLITE_NOMEM
;

109758  
	gSQLITE_NOMEM
;

109760 
	g»s
.
	gazResuÉ
 = 
azNew
;

109762 *
	g·zResuÉ
 = &
»s
.
azResuÉ
[1];

109763 ifÐ
	g²CÞumn
 ) *²CÞumÀð
»s
.
nCÞumn
;

109764 ifÐ
	g²Row
 ) *²Row = 
»s
.
nRow
;

109765  
	grc
;

109771 
SQLITE_API
 
sql™e3_ä“_bË
(

109772 **
azResuÉ


109774 ifÐ
	gazResuÉ
 ){

109775 
	gi
, 
	gn
;

109776 
	gazResuÉ
--;

109777 
as£¹
Ð
azResuÉ
!=0 );

109778 
	gn
 = 
SQLITE_PTR_TO_INT
(
azResuÉ
[0]);

109779 
	gi
=1; i<
	gn
; i++){ ifÐ
	gazResuÉ
[
i
] ) 
sql™e3_ä“
(
azResuÉ
[i]); }

109780 
sql™e3_ä“
(
azResuÉ
);

109801 #iâdeà
SQLITE_OMIT_TRIGGER


109805 
SQLITE_PRIVATE
 
sql™e3D–‘eTrigg”S‹p
(
sql™e3
 *
db
, 
Trigg”S‹p
 *
pTrigg”S‹p
){

109806  
	gpTrigg”S‹p
 ){

109807 
Trigg”S‹p
 * 
	gpTmp
 = 
pTrigg”S‹p
;

109808 
	gpTrigg”S‹p
 = 
pTrigg”S‹p
->
pNext
;

109810 
sql™e3Ex´D–‘e
(
db
, 
pTmp
->
pWh”e
);

109811 
sql™e3Ex´Li¡D–‘e
(
db
, 
pTmp
->
pEx´Li¡
);

109812 
sql™e3S–eùD–‘e
(
db
, 
pTmp
->
pS–eù
);

109813 
sql™e3IdLi¡D–‘e
(
db
, 
pTmp
->
pIdLi¡
);

109815 
sql™e3DbF»e
(
db
, 
pTmp
);

109833 
SQLITE_PRIVATE
 
Trigg”
 *
sql™e3Trigg”Li¡
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

109834 
Schema
 * cÚ¡ 
	gpTmpSchema
 = 
pP¬£
->
db
->
aDb
[1].
pSchema
;

109835 
Trigg”
 *
	gpLi¡
 = 0;

109837 ifÐ
	gpP¬£
->
	gdi§bËTrigg”s
 ){

109841 ifÐ
	gpTmpSchema
!=
pTab
->
pSchema
 ){

109842 
HashEËm
 *
p
;

109843 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
pP¬£
->
db
, 0, 
pTmpSchema
) );

109844 
	gp
=
sql™eHashFœ¡
(&
pTmpSchema
->
ŒigHash
);…;…=
sql™eHashNext
(
p
)){

109845 
Trigg”
 *
pTrig
 = (Trigg” *)
sql™eHashD©a
(
p
);

109846 ifÐ
	gpTrig
->
	gpTabSchema
==
pTab
->
pSchema


109847 && 0==
sql™e3SŒICmp
(
pTrig
->
bË
, 
pTab
->
zName
)

109849 
	gpTrig
->
	gpNext
 = (
pLi¡
 ?…Li¡ : 
pTab
->
pTrigg”
);

109850 
	gpLi¡
 = 
pTrig
;

109855  (
	gpLi¡
 ?…Li¡ : 
pTab
->
pTrigg”
);

109866 
SQLITE_PRIVATE
 
sql™e3BegšTrigg”
(

109867 
P¬£
 *
pP¬£
,

109868 
Tok’
 *
pName1
,

109869 
Tok’
 *
pName2
,

109870 
Œ_tm
,

109871 
Ý
,

109872 
IdLi¡
 *
pCÞumns
,

109873 
SrcLi¡
 *
pTabËName
,

109874 
Ex´
 *
pWh’
,

109875 
isTemp
,

109876 
noE¼


109878 
Trigg”
 *
	gpTrigg”
 = 0;

109879 
TabË
 *
	gpTab
;

109880 *
	gzName
 = 0;

109881 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

109882 
	giDb
;

109883 
Tok’
 *
	gpName
;

109884 
DbFix”
 
	gsFix
;

109885 
	giTabDb
;

109887 
as£¹
Ð
pName1
!=0 );

109888 
as£¹
Ð
pName2
!=0 );

109889 
as£¹
Ð
Ý
==
TK_INSERT
 || op==
TK_UPDATE
 || op==
TK_DELETE
 );

109890 
as£¹
Ð
Ý
>0 && op<0xff );

109891 ifÐ
	gisTemp
 ){

109893 ifÐ
	gpName2
->
	gn
>0 ){

109894 
sql™e3E¼ÜMsg
(
pP¬£
, "temporaryrigger may‚ot have qualified‚ame");

109895 
	gŒigg”_þ—nup
;

109897 
	giDb
 = 1;

109898 
	gpName
 = 
pName1
;

109901 
	giDb
 = 
sql™e3TwoP¬tName
(
pP¬£
, 
pName1
, 
pName2
, &
pName
);

109902 ifÐ
	giDb
<0 ){

109903 
	gŒigg”_þ—nup
;

109906 ifÐ!
	gpTabËName
 || 
	gdb
->
	gm®locFažed
 ){

109907 
	gŒigg”_þ—nup
;

109918 ifÐ
	gdb
->
	gš™
.
	gbusy
 && 
	giDb
!=1 ){

109919 
sql™e3DbF»e
(
db
, 
pTabËName
->
a
[0].
zD©aba£
);

109920 
	gpTabËName
->
	ga
[0].
	gzD©aba£
 = 0;

109928 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTabËName
);

109929 ifÐ
	gdb
->
	gš™
.
	gbusy
==0 && 
pName2
->
n
==0 && 
pTab


109930 && 
pTab
->
pSchema
==
db
->
aDb
[1].pSchema ){

109931 
iDb
 = 1;

109935 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gŒigg”_þ—nup
;

109936 
as£¹
Ð
pTabËName
->
nSrc
==1 );

109937 
sql™e3FixIn™
(&
sFix
, 
pP¬£
, 
iDb
, "Œigg”", 
pName
);

109938 ifÐ
sql™e3FixSrcLi¡
(&
sFix
, 
pTabËName
) ){

109939 
	gŒigg”_þ—nup
;

109941 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTabËName
);

109942 ifÐ!
	gpTab
 ){

109944 ifÐ
	gdb
->
	gš™
.
	giDb
==1 ){

109953 
db
->
š™
.
ÜphªTrigg”
 = 1;

109955 
	gŒigg”_þ—nup
;

109957 ifÐ
IsVœtu®
(
pTab
) ){

109958 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot createriggers on virtualables");

109959 
	gŒigg”_þ—nup
;

109964 
	gzName
 = 
sql™e3NameFromTok’
(
db
, 
pName
);

109965 ifÐ!
	gzName
 || 
	gSQLITE_OK
!=
sql™e3CheckObjeùName
(
pP¬£
, 
zName
) ){

109966 
	gŒigg”_þ—nup
;

109968 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

109969 ifÐ
sql™e3HashFšd
(&(
db
->
aDb
[
iDb
].
pSchema
->
ŒigHash
),
zName
) ){

109970 ifÐ!
	gnoE¼
 ){

109971 
sql™e3E¼ÜMsg
(
pP¬£
, "Œigg” %T‡Ì—dyƒxi¡s", 
pName
);

109973 
as£¹
Ð!
db
->
š™
.
busy
 );

109974 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

109976 
	gŒigg”_þ—nup
;

109980 ifÐ
sql™e3SŒNICmp
(
pTab
->
zName
, "sqlite_", 7)==0 ){

109981 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot createrigger on systemable");

109982 
	gpP¬£
->
	gnE¼
++;

109983 
	gŒigg”_þ—nup
;

109989 ifÐ
	gpTab
->
	gpS–eù
 && 
	gŒ_tm
!=
TK_INSTEAD
 ){

109990 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot create %srigger on view: %S",

109991 (
Œ_tm
 =ð
TK_BEFORE
)?"BEFORE":"AFTER", 
pTabËName
, 0);

109992 
	gŒigg”_þ—nup
;

109994 ifÐ!
	gpTab
->
	gpS–eù
 && 
	gŒ_tm
==
TK_INSTEAD
 ){

109995 
sql™e3E¼ÜMsg
(
pP¬£
, "cannot create INSTEAD OF"

109996 "rigg” oÀbË: %S", 
pTabËName
, 0);

109997 
	gŒigg”_þ—nup
;

109999 
	giTabDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

110001 #iâdeà
SQLITE_OMIT_AUTHORIZATION


110003 
	gcode
 = 
SQLITE_CREATE_TRIGGER
;

110004 cÚ¡ *
	gzDb
 = 
db
->
aDb
[
iTabDb
].
zName
;

110005 cÚ¡ *
	gzDbTrig
 = 
isTemp
 ? 
db
->
aDb
[1].
zName
 : 
zDb
;

110006 ifÐ
	giTabDb
==1 || 
isTemp
 ) 
code
 = 
SQLITE_CREATE_TEMP_TRIGGER
;

110007 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
code
, 
zName
, 
pTab
->zName, 
zDbTrig
) ){

110008 
	gŒigg”_þ—nup
;

110010 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_INSERT
, 
SCHEMA_TABLE
(
iTabDb
),0,
zDb
)){

110011 
	gŒigg”_þ—nup
;

110021 ià(
	gŒ_tm
 =ð
TK_INSTEAD
){

110022 
Œ_tm
 = 
TK_BEFORE
;

110026 
	gpTrigg”
 = (
Trigg”
*)
sql™e3DbM®locZ”o
(
db
, (Trigger));

110027 ifÐ
	gpTrigg”
==0 ) 
Œigg”_þ—nup
;

110028 
	gpTrigg”
->
	gzName
 = 
zName
;

110029 
	gzName
 = 0;

110030 
	gpTrigg”
->
	gbË
 = 
sql™e3DbSŒDup
(
db
, 
pTabËName
->
a
[0].
zName
);

110031 
	gpTrigg”
->
	gpSchema
 = 
db
->
aDb
[
iDb
].
pSchema
;

110032 
	gpTrigg”
->
	gpTabSchema
 = 
pTab
->
pSchema
;

110033 
	gpTrigg”
->
	gÝ
 = (
u8
)
Ý
;

110034 
	gpTrigg”
->
	gŒ_tm
 = 
Œ_tm
==
TK_BEFORE
 ? 
TRIGGER_BEFORE
 : 
TRIGGER_AFTER
;

110035 
	gpTrigg”
->
	gpWh’
 = 
sql™e3Ex´Dup
(
db
, 
pWh’
, 
EXPRDUP_REDUCE
);

110036 
	gpTrigg”
->
	gpCÞumns
 = 
sql™e3IdLi¡Dup
(
db
, 
pCÞumns
);

110037 
as£¹
Ð
pP¬£
->
pNewTrigg”
==0 );

110038 
	gpP¬£
->
	gpNewTrigg”
 = 
pTrigg”
;

110040 
	gŒigg”_þ—nup
:

110041 
sql™e3DbF»e
(
db
, 
zName
);

110042 
sql™e3SrcLi¡D–‘e
(
db
, 
pTabËName
);

110043 
sql™e3IdLi¡D–‘e
(
db
, 
pCÞumns
);

110044 
sql™e3Ex´D–‘e
(
db
, 
pWh’
);

110045 ifÐ!
	gpP¬£
->
	gpNewTrigg”
 ){

110046 
sql™e3D–‘eTrigg”
(
db
, 
pTrigg”
);

110048 
as£¹
Ð
pP¬£
->
pNewTrigg”
==
pTrigg”
 );

110056 
SQLITE_PRIVATE
 
sql™e3FšishTrigg”
(

110057 
P¬£
 *
pP¬£
,

110058 
Trigg”S‹p
 *
pS‹pLi¡
,

110059 
Tok’
 *
pAÎ


110061 
Trigg”
 *
	gpTrig
 = 
pP¬£
->
pNewTrigg”
;

110062 *
	gzName
;

110063 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

110064 
DbFix”
 
	gsFix
;

110065 
	giDb
;

110066 
Tok’
 
	gÇmeTok’
;

110068 
	gpP¬£
->
	gpNewTrigg”
 = 0;

110069 ifÐ
NEVER
(
pP¬£
->
nE¼
è|| !
	gpTrig
 ) 
	gŒigg”fšish_þ—nup
;

110070 
	gzName
 = 
pTrig
->
zName
;

110071 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTrig
->
pSchema
);

110072 
	gpTrig
->
	g¡•_li¡
 = 
pS‹pLi¡
;

110073  
	gpS‹pLi¡
 ){

110074 
	gpS‹pLi¡
->
	gpTrig
 = 
pTrig
;

110075 
	gpS‹pLi¡
 = 
pS‹pLi¡
->
pNext
;

110077 
	gÇmeTok’
.
	gz
 = 
pTrig
->
zName
;

110078 
	gÇmeTok’
.
	gn
 = 
sql™e3SŒËn30
(
ÇmeTok’
.
z
);

110079 
sql™e3FixIn™
(&
sFix
, 
pP¬£
, 
iDb
, "Œigg”", &
ÇmeTok’
);

110080 ifÐ
sql™e3FixTrigg”S‹p
(&
sFix
, 
pTrig
->
¡•_li¡
)

110081 || 
sql™e3FixEx´
(&
sFix
, 
pTrig
->
pWh’
)

110083 
	gŒigg”fšish_þ—nup
;

110089 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

110090 
Vdbe
 *
	gv
;

110091 *
	gz
;

110094 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

110095 ifÐ
	gv
==0 ) 
Œigg”fšish_þ—nup
;

110096 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

110097 
	gz
 = 
sql™e3DbSŒNDup
(
db
, (*)
pAÎ
->
z
,…AÎ->
n
);

110098 
sql™e3Ne¡edP¬£
(
pP¬£
,

110100 
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb), zName,

110101 
pTrig
->
bË
, 
z
);

110102 
sql™e3DbF»e
(
db
, 
z
);

110103 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

110104 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 
iDb
,

110105 
sql™e3MPrštf
(
db
, "ty³='Œigg”' AND‚ame='%q'", 
zName
));

110108 ifÐ
	gdb
->
	gš™
.
	gbusy
 ){

110109 
Trigg”
 *
	gpLšk
 = 
pTrig
;

110110 
Hash
 *
	gpHash
 = &
db
->
aDb
[
iDb
].
pSchema
->
ŒigHash
;

110111 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

110112 
	gpTrig
 = 
sql™e3HashIn£¹
(
pHash
, 
zName
, 
pTrig
);

110113 ifÐ
	gpTrig
 ){

110114 
	gdb
->
	gm®locFažed
 = 1;

110115 }ifÐ
	gpLšk
->
	gpSchema
==
pLšk
->
pTabSchema
 ){

110116 
TabË
 *
pTab
;

110117 
	gpTab
 = 
sql™e3HashFšd
(&
pLšk
->
pTabSchema
->
tblHash
,…Lšk->
bË
);

110118 
as£¹
Ð
pTab
!=0 );

110119 
	gpLšk
->
	gpNext
 = 
pTab
->
pTrigg”
;

110120 
	gpTab
->
	gpTrigg”
 = 
pLšk
;

110124 
	gŒigg”fšish_þ—nup
:

110125 
sql™e3D–‘eTrigg”
(
db
, 
pTrig
);

110126 
as£¹
Ð!
pP¬£
->
pNewTrigg”
 );

110127 
sql™e3D–‘eTrigg”S‹p
(
db
, 
pS‹pLi¡
);

110137 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”S–eùS‹p
(
sql™e3
 *
db
, 
S–eù
 *
pS–eù
){

110138 
Trigg”S‹p
 *
	gpTrigg”S‹p
 = 
sql™e3DbM®locZ”o
(
db
, (TriggerStep));

110139 ifÐ
	gpTrigg”S‹p
==0 ) {

110140 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

110143 
	gpTrigg”S‹p
->
	gÝ
 = 
TK_SELECT
;

110144 
	gpTrigg”S‹p
->
	gpS–eù
 = 
pS–eù
;

110145 
	gpTrigg”S‹p
->
	gÜcÚf
 = 
OE_DeçuÉ
;

110146  
	gpTrigg”S‹p
;

110155 
Trigg”S‹p
 *
Œigg”S‹pAÎoÿ‹
(

110156 
sql™e3
 *
db
,

110157 
u8
 
Ý
,

110158 
Tok’
 *
pName


110160 
Trigg”S‹p
 *
	gpTrigg”S‹p
;

110162 
	gpTrigg”S‹p
 = 
sql™e3DbM®locZ”o
(
db
, (
Trigg”S‹p
è+ 
pName
->
n
);

110163 ifÐ
	gpTrigg”S‹p
 ){

110164 *
	gz
 = (*)&
pTrigg”S‹p
[1];

110165 
memýy
(
z
, 
pName
->z,…Name->
n
);

110166 
	gpTrigg”S‹p
->
	grg‘
.
	gz
 = 
z
;

110167 
	gpTrigg”S‹p
->
	grg‘
.
	gn
 = 
pName
->
n
;

110168 
	gpTrigg”S‹p
->
	gÝ
 = 
Ý
;

110170  
	gpTrigg”S‹p
;

110180 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”In£¹S‹p
(

110181 
sql™e3
 *
db
,

110182 
Tok’
 *
pTabËName
,

110183 
IdLi¡
 *
pCÞumn
,

110184 
S–eù
 *
pS–eù
,

110185 
u8
 
ÜcÚf


110187 
Trigg”S‹p
 *
	gpTrigg”S‹p
;

110189 
as£¹
(
pS–eù
 !ð0 || 
db
->
m®locFažed
);

110191 
	gpTrigg”S‹p
 = 
Œigg”S‹pAÎoÿ‹
(
db
, 
TK_INSERT
, 
pTabËName
);

110192 ifÐ
	gpTrigg”S‹p
 ){

110193 
	gpTrigg”S‹p
->
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pS–eù
, 
EXPRDUP_REDUCE
);

110194 
	gpTrigg”S‹p
->
	gpIdLi¡
 = 
pCÞumn
;

110195 
	gpTrigg”S‹p
->
	gÜcÚf
 = 
ÜcÚf
;

110197 
sql™e3IdLi¡D–‘e
(
db
, 
pCÞumn
);

110199 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

110201  
	gpTrigg”S‹p
;

110209 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”Upd©eS‹p
(

110210 
sql™e3
 *
db
,

110211 
Tok’
 *
pTabËName
,

110212 
Ex´Li¡
 *
pELi¡
,

110213 
Ex´
 *
pWh”e
,

110214 
u8
 
ÜcÚf


110216 
Trigg”S‹p
 *
	gpTrigg”S‹p
;

110218 
	gpTrigg”S‹p
 = 
Œigg”S‹pAÎoÿ‹
(
db
, 
TK_UPDATE
, 
pTabËName
);

110219 ifÐ
	gpTrigg”S‹p
 ){

110220 
	gpTrigg”S‹p
->
	gpEx´Li¡
 = 
sql™e3Ex´Li¡Dup
(
db
, 
pELi¡
, 
EXPRDUP_REDUCE
);

110221 
	gpTrigg”S‹p
->
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
pWh”e
, 
EXPRDUP_REDUCE
);

110222 
	gpTrigg”S‹p
->
	gÜcÚf
 = 
ÜcÚf
;

110224 
sql™e3Ex´Li¡D–‘e
(
db
, 
pELi¡
);

110225 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

110226  
	gpTrigg”S‹p
;

110234 
SQLITE_PRIVATE
 
Trigg”S‹p
 *
sql™e3Trigg”D–‘eS‹p
(

110235 
sql™e3
 *
db
,

110236 
Tok’
 *
pTabËName
,

110237 
Ex´
 *
pWh”e


110239 
Trigg”S‹p
 *
	gpTrigg”S‹p
;

110241 
	gpTrigg”S‹p
 = 
Œigg”S‹pAÎoÿ‹
(
db
, 
TK_DELETE
, 
pTabËName
);

110242 ifÐ
	gpTrigg”S‹p
 ){

110243 
	gpTrigg”S‹p
->
	gpWh”e
 = 
sql™e3Ex´Dup
(
db
, 
pWh”e
, 
EXPRDUP_REDUCE
);

110244 
	gpTrigg”S‹p
->
	gÜcÚf
 = 
OE_DeçuÉ
;

110246 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

110247  
	gpTrigg”S‹p
;

110253 
SQLITE_PRIVATE
 
sql™e3D–‘eTrigg”
(
sql™e3
 *
db
, 
Trigg”
 *
pTrigg”
){

110254 ifÐ
	gpTrigg”
==0 ) ;

110255 
sql™e3D–‘eTrigg”S‹p
(
db
, 
pTrigg”
->
¡•_li¡
);

110256 
sql™e3DbF»e
(
db
, 
pTrigg”
->
zName
);

110257 
sql™e3DbF»e
(
db
, 
pTrigg”
->
bË
);

110258 
sql™e3Ex´D–‘e
(
db
, 
pTrigg”
->
pWh’
);

110259 
sql™e3IdLi¡D–‘e
(
db
, 
pTrigg”
->
pCÞumns
);

110260 
sql™e3DbF»e
(
db
, 
pTrigg”
);

110271 
SQLITE_PRIVATE
 
sql™e3DrÝTrigg”
(
P¬£
 *
pP¬£
, 
SrcLi¡
 *
pName
, 
noE¼
){

110272 
Trigg”
 *
	gpTrigg”
 = 0;

110273 
	gi
;

110274 cÚ¡ *
	gzDb
;

110275 cÚ¡ *
	gzName
;

110276 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

110278 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gdrÝ_Œigg”_þ—nup
;

110279 ifÐ
	gSQLITE_OK
!=
sql™e3R—dSchema
(
pP¬£
) ){

110280 
drÝ_Œigg”_þ—nup
;

110283 
as£¹
Ð
pName
->
nSrc
==1 );

110284 
	gzDb
 = 
pName
->
a
[0].
zD©aba£
;

110285 
	gzName
 = 
pName
->
a
[0].
zName
;

110286 
as£¹
Ð
zDb
!=0 || 
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

110287 
	gi
=
OMIT_TEMPDB
; i<
	gdb
->
	gnDb
; i++){

110288 
	gj
 = (
i
<2) ? i^1 : i;

110289 ifÐ
	gzDb
 && 
sql™e3SŒICmp
(
db
->
aDb
[
j
].
zName
, 
zDb
) ) ;

110290 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
j
, 0) );

110291 
	gpTrigg”
 = 
sql™e3HashFšd
(&(
db
->
aDb
[
j
].
pSchema
->
ŒigHash
), 
zName
);

110292 ifÐ
	gpTrigg”
 ) ;

110294 ifÐ!
	gpTrigg”
 ){

110295 ifÐ!
	gnoE¼
 ){

110296 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuchrigg”: %S", 
pName
, 0);

110298 
sql™e3CodeV”ifyNamedSchema
(
pP¬£
, 
zDb
);

110300 
	gpP¬£
->
	gcheckSchema
 = 1;

110301 
	gdrÝ_Œigg”_þ—nup
;

110303 
sql™e3DrÝTrigg”PŒ
(
pP¬£
, 
pTrigg”
);

110305 
	gdrÝ_Œigg”_þ—nup
:

110306 
sql™e3SrcLi¡D–‘e
(
db
, 
pName
);

110313 
TabË
 *
bËOfTrigg”
(
Trigg”
 *
pTrigg”
){

110314  
sql™e3HashFšd
(&
pTrigg”
->
pTabSchema
->
tblHash
,…Trigg”->
bË
);

110321 
SQLITE_PRIVATE
 
sql™e3DrÝTrigg”PŒ
(
P¬£
 *
pP¬£
, 
Trigg”
 *
pTrigg”
){

110322 
TabË
 *
	gpTabË
;

110323 
Vdbe
 *
	gv
;

110324 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

110325 
	giDb
;

110327 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTrigg”
->
pSchema
);

110328 
as£¹
Ð
iDb
>=0 && iDb<
db
->
nDb
 );

110329 
	gpTabË
 = 
bËOfTrigg”
(
pTrigg”
);

110330 
as£¹
Ð
pTabË
 );

110331 
as£¹
Ð
pTabË
->
pSchema
==
pTrigg”
->pSchem¨|| 
iDb
==1 );

110332 #iâdeà
SQLITE_OMIT_AUTHORIZATION


110334 
	gcode
 = 
SQLITE_DROP_TRIGGER
;

110335 cÚ¡ *
	gzDb
 = 
db
->
aDb
[
iDb
].
zName
;

110336 cÚ¡ *
	gzTab
 = 
SCHEMA_TABLE
(
iDb
);

110337 ifÐ
	giDb
==1 ) 
code
 = 
SQLITE_DROP_TEMP_TRIGGER
;

110338 ifÐ
sql™e3AuthCheck
(
pP¬£
, 
code
, 
pTrigg”
->
zName
, 
pTabË
->zName, 
zDb
) ||

110339 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_DELETE
, 
zTab
, 0, 
zDb
) ){

110347 
as£¹
Ð
pTabË
!=0 );

110348 ifÐ(
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
))!=0 ){

110349 
ba£
;

110350 cÚ¡ 
	giLn
 = 
VDBE_OFFSET_LINENO
(2);

110351 cÚ¡ 
VdbeOpLi¡
 
	gdrÝTrigg”
[] = {

110352 { 
OP_Rewšd
, 0, 
ADDR
(9), 0},

110353 { 
OP_SŒšg8
, 0, 1, 0},

110354 { 
OP_CÞumn
, 0, 1, 2},

110355 { 
OP_Ne
, 2, 
ADDR
(8), 1},

110356 { 
OP_SŒšg8
, 0, 1, 0},

110357 { 
OP_CÞumn
, 0, 0, 2},

110358 { 
OP_Ne
, 2, 
ADDR
(8), 1},

110359 { 
OP_D–‘e
, 0, 0, 0},

110360 { 
OP_Next
, 0, 
ADDR
(1), 0},

110363 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 0, 
iDb
);

110364 
sql™e3O³nMa¡”TabË
(
pP¬£
, 
iDb
);

110365 
	gba£
 = 
sql™e3VdbeAddOpLi¡
(
v
, 
A¼aySize
(
drÝTrigg”
), drÝTrigg”, 
iLn
);

110366 
sql™e3VdbeChªgeP4
(
v
, 
ba£
+1, 
pTrigg”
->
zName
, 
P4_TRANSIENT
);

110367 
sql™e3VdbeChªgeP4
(
v
, 
ba£
+4, "Œigg”", 
P4_STATIC
);

110368 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

110369 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 0, 0);

110370 
sql™e3VdbeAddOp4
(
v
, 
OP_DrÝTrigg”
, 
iDb
, 0, 0, 
pTrigg”
->
zName
, 0);

110371 ifÐ
	gpP¬£
->
	gnMem
<3 ){

110372 
	gpP¬£
->
	gnMem
 = 3;

110380 
SQLITE_PRIVATE
 
sql™e3UÆškAndD–‘eTrigg”
(
sql™e3
 *
db
, 
iDb
, cÚ¡ *
zName
){

110381 
Trigg”
 *
	gpTrigg”
;

110382 
Hash
 *
	gpHash
;

110384 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 
iDb
, 0) );

110385 
	gpHash
 = &(
db
->
aDb
[
iDb
].
pSchema
->
ŒigHash
);

110386 
	gpTrigg”
 = 
sql™e3HashIn£¹
(
pHash
, 
zName
, 0);

110387 ifÐ
ALWAYS
(
pTrigg”
) ){

110388 ifÐ
	gpTrigg”
->
	gpSchema
==
pTrigg”
->
pTabSchema
 ){

110389 
TabË
 *
pTab
 = 
bËOfTrigg”
(
pTrigg”
);

110390 
Trigg”
 **
	gµ
;

110391 
	gµ
=&
pTab
->
pTrigg”
; *µ!õTrigg”;…p=&((*
µ
)->
pNext
));

110392 *
	gµ
 = (*
µ
)->
pNext
;

110394 
sql™e3D–‘eTrigg”
(
db
, 
pTrigg”
);

110395 
	gdb
->
	gæags
 |ð
SQLITE_IÁ”nChªges
;

110408 
checkCÞumnOv”Ïp
(
IdLi¡
 *
pIdLi¡
, 
Ex´Li¡
 *
pELi¡
){

110409 
	ge
;

110410 ifÐ
	gpIdLi¡
==0 || 
NEVER
(
pELi¡
==0) )  1;

110411 
	ge
=0;ƒ<
	gpELi¡
->
	gnEx´
;ƒ++){

110412 ifÐ
sql™e3IdLi¡Index
(
pIdLi¡
, 
pELi¡
->
a
[
e
].
zName
)>=0 )  1;

110423 
SQLITE_PRIVATE
 
Trigg”
 *
sql™e3Trigg”sExi¡
(

110424 
P¬£
 *
pP¬£
,

110425 
TabË
 *
pTab
,

110426 
Ý
,

110427 
Ex´Li¡
 *
pChªges
,

110428 *
pMask


110430 
	gmask
 = 0;

110431 
Trigg”
 *
	gpLi¡
 = 0;

110432 
Trigg”
 *
	gp
;

110434 ifÐ(
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_EÇbËTrigg”
)!=0 ){

110435 
pLi¡
 = 
sql™e3Trigg”Li¡
(
pP¬£
, 
pTab
);

110437 
as£¹
Ð
pLi¡
==0 || 
IsVœtu®
(
pTab
)==0 );

110438 
	gp
=
pLi¡
;…;…=
p
->
pNext
){

110439 ifÐ
p
->
Ý
==Ý && 
checkCÞumnOv”Ïp
Õ->
pCÞumns
, 
pChªges
) ){

110440 
	gmask
 |ð
p
->
Œ_tm
;

110443 ifÐ
	gpMask
 ){

110444 *
	gpMask
 = 
mask
;

110446  (
	gmask
 ? 
	gpLi¡
 : 0);

110459 
SrcLi¡
 *
rg‘SrcLi¡
(

110460 
P¬£
 *
pP¬£
,

110461 
Trigg”S‹p
 *
pS‹p


110463 
	giDb
;

110464 
SrcLi¡
 *
	gpSrc
;

110466 
	gpSrc
 = 
sql™e3SrcLi¡Aµ’d
(
pP¬£
->
db
, 0, &
pS‹p
->
rg‘
, 0);

110467 ifÐ
	gpSrc
 ){

110468 
as£¹
Ð
pSrc
->
nSrc
>0 );

110469 
as£¹
Ð
pSrc
->
a
!=0 );

110470 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pS‹p
->
pTrig
->
pSchema
);

110471 ifÐ
	giDb
==0 || 
iDb
>=2 ){

110472 
sql™e3
 *
db
 = 
pP¬£
->db;

110473 
as£¹
Ð
iDb
<
pP¬£
->
db
->
nDb
 );

110474 
	gpSrc
->
	ga
[
pSrc
->
nSrc
-1].
	gzD©aba£
 = 
sql™e3DbSŒDup
(
db
, db->
aDb
[
iDb
].
zName
);

110477  
	gpSrc
;

110484 
codeTrigg”Prog¿m
(

110485 
P¬£
 *
pP¬£
,

110486 
Trigg”S‹p
 *
pS‹pLi¡
,

110487 
ÜcÚf


110489 
Trigg”S‹p
 *
	gpS‹p
;

110490 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

110491 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

110493 
as£¹
Ð
pP¬£
->
pTrigg”Tab
 &&…P¬£->
pTÝËv–
 );

110494 
as£¹
Ð
pS‹pLi¡
 );

110495 
as£¹
Ð
v
!=0 );

110496 
	gpS‹p
=
pS‹pLi¡
;…S‹p;…S‹p=
pS‹p
->
pNext
){

110510 
pP¬£
->
eOrcÚf
 = (
ÜcÚf
==
OE_DeçuÉ
)?
pS‹p
->ÜcÚf:(
u8
)orconf;

110511 
as£¹
Ð
pP¬£
->
okCÚ¡FaùÜ
==0 );

110513  
	gpS‹p
->
	gÝ
 ){

110514 
	gTK_UPDATE
: {

110515 
sql™e3Upd©e
(
pP¬£
,

110516 
rg‘SrcLi¡
(
pP¬£
, 
pS‹p
),

110517 
sql™e3Ex´Li¡Dup
(
db
, 
pS‹p
->
pEx´Li¡
, 0),

110518 
sql™e3Ex´Dup
(
db
, 
pS‹p
->
pWh”e
, 0),

110519 
pP¬£
->
eOrcÚf


110523 
	gTK_INSERT
: {

110524 
sql™e3In£¹
(
pP¬£
,

110525 
rg‘SrcLi¡
(
pP¬£
, 
pS‹p
),

110526 
sql™e3S–eùDup
(
db
, 
pS‹p
->
pS–eù
, 0),

110527 
sql™e3IdLi¡Dup
(
db
, 
pS‹p
->
pIdLi¡
),

110528 
pP¬£
->
eOrcÚf


110532 
	gTK_DELETE
: {

110533 
sql™e3D–‘eFrom
(
pP¬£
,

110534 
rg‘SrcLi¡
(
pP¬£
, 
pS‹p
),

110535 
sql™e3Ex´Dup
(
db
, 
pS‹p
->
pWh”e
, 0)

110539 : 
as£¹
Ð
pS‹p
->
Ý
==
TK_SELECT
 ); {

110540 
S–eùDe¡
 
	gsDe¡
;

110541 
S–eù
 *
	gpS–eù
 = 
sql™e3S–eùDup
(
db
, 
pS‹p
->
pS–eù
, 0);

110542 
sql™e3S–eùDe¡In™
(&
sDe¡
, 
SRT_Disÿrd
, 0);

110543 
sql™e3S–eù
(
pP¬£
, 
pS–eù
, &
sDe¡
);

110544 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

110548 ifÐ
	gpS‹p
->
	gÝ
!=
TK_SELECT
 ){

110549 
sql™e3VdbeAddOp0
(
v
, 
OP_Re£tCouÁ
);

110556 #ifdeà
SQLITE_ENABLE_EXPLAIN_COMMENTS


110561 cÚ¡ *
ÚE¼ÜText
(
ÚE¼Ü
){

110562  
	gÚE¼Ü
 ){

110563 
	gOE_AbÜt
:  "abort";

110564 
	gOE_RÞlback
:  "rollback";

110565 
	gOE_Faž
:  "fail";

110566 
	gOE_R•Ïû
:  "replace";

110567 
	gOE_IgnÜe
:  "ignore";

110568 
	gOE_DeçuÉ
:  "default";

110579 
ŒªsãrP¬£E¼Ü
(
P¬£
 *
pTo
, P¬£ *
pFrom
){

110580 
as£¹
Ð
pFrom
->
zE¼Msg
==0 ||…From->
nE¼
 );

110581 
as£¹
Ð
pTo
->
zE¼Msg
==0 ||…To->
nE¼
 );

110582 ifÐ
	gpTo
->
	gnE¼
==0 ){

110583 
pTo
->
zE¼Msg
 = 
pFrom
->zErrMsg;

110584 
	gpTo
->
	gnE¼
 = 
pFrom
->
nE¼
;

110586 
sql™e3DbF»e
(
pFrom
->
db
,…From->
zE¼Msg
);

110594 
Trigg”Prg
 *
codeRowTrigg”
(

110595 
P¬£
 *
pP¬£
,

110596 
Trigg”
 *
pTrigg”
,

110597 
TabË
 *
pTab
,

110598 
ÜcÚf


110600 
P¬£
 *
	gpTÝ
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

110601 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

110602 
Trigg”Prg
 *
	gpPrg
;

110603 
Ex´
 *
	gpWh’
 = 0;

110604 
Vdbe
 *
	gv
;

110605 
NameCÚ‹xt
 
	gsNC
;

110606 
SubProg¿m
 *
	gpProg¿m
 = 0;

110607 
P¬£
 *
	gpSubP¬£
;

110608 
	giEndTrigg”
 = 0;

110610 
as£¹
Ð
pTrigg”
->
zName
==0 || 
pTab
==
bËOfTrigg”
(pTrigger) );

110611 
as£¹
Ð
pTÝ
->
pVdbe
 );

110616 
	gpPrg
 = 
sql™e3DbM®locZ”o
(
db
, (
Trigg”Prg
));

110617 ifÐ!
	gpPrg
 )  0;

110618 
	gpPrg
->
	gpNext
 = 
pTÝ
->
pTrigg”Prg
;

110619 
	gpTÝ
->
	gpTrigg”Prg
 = 
pPrg
;

110620 
	gpPrg
->
	gpProg¿m
 = 
pProg¿m
 = 
sql™e3DbM®locZ”o
(
db
, (
SubProg¿m
));

110621 ifÐ!
	gpProg¿m
 )  0;

110622 
sql™e3VdbeLškSubProg¿m
(
pTÝ
->
pVdbe
, 
pProg¿m
);

110623 
	gpPrg
->
	gpTrigg”
 = 
pTrigg”
;

110624 
	gpPrg
->
	gÜcÚf
 = 
ÜcÚf
;

110625 
	gpPrg
->
	gaCÞmask
[0] = 0xffffffff;

110626 
	gpPrg
->
	gaCÞmask
[1] = 0xffffffff;

110630 
	gpSubP¬£
 = 
sql™e3SckAÎocZ”o
(
db
, (
P¬£
));

110631 ifÐ!
	gpSubP¬£
 )  0;

110632 
mem£t
(&
sNC
, 0, (sNC));

110633 
	gsNC
.
	gpP¬£
 = 
pSubP¬£
;

110634 
	gpSubP¬£
->
	gdb
 = 
db
;

110635 
	gpSubP¬£
->
	gpTrigg”Tab
 = 
pTab
;

110636 
	gpSubP¬£
->
	gpTÝËv–
 = 
pTÝ
;

110637 
	gpSubP¬£
->
	gzAuthCÚ‹xt
 = 
pTrigg”
->
zName
;

110638 
	gpSubP¬£
->
	geTrigg”Op
 = 
pTrigg”
->
Ý
;

110639 
	gpSubP¬£
->
	gnQu”yLoÝ
 = 
pP¬£
->
nQu”yLoÝ
;

110641 
	gv
 = 
sql™e3G‘Vdbe
(
pSubP¬£
);

110642 ifÐ
	gv
 ){

110643 
VdbeComm’t
((
v
, "Start: %s.%s (%s %s%s%s ON %s)",

110644 
pTrigg”
->
zName
, 
ÚE¼ÜText
(
ÜcÚf
),

110645 (
pTrigg”
->
Œ_tm
==
TRIGGER_BEFORE
 ? "BEFORE" : "AFTER"),

110646 (
pTrigg”
->
Ý
==
TK_UPDATE
 ? "UPDATE" : ""),

110647 (
pTrigg”
->
Ý
==
TK_INSERT
 ? "INSERT" : ""),

110648 (
pTrigg”
->
Ý
==
TK_DELETE
 ? "DELETE" : ""),

110649 
pTab
->
zName


110651 #iâdeà
SQLITE_OMIT_TRACE


110652 
sql™e3VdbeChªgeP4
(
v
, -1,

110653 
sql™e3MPrštf
(
db
, "-- TRIGGER %s", 
pTrigg”
->
zName
), 
P4_DYNAMIC


110660 ifÐ
	gpTrigg”
->
	gpWh’
 ){

110661 
	gpWh’
 = 
sql™e3Ex´Dup
(
db
, 
pTrigg”
->
pWh’
, 0);

110662 ifÐ
	gSQLITE_OK
==
sql™e3ResÞveEx´Names
(&
sNC
, 
pWh’
)

110663 && 
	gdb
->
	gm®locFažed
==0

110665 
iEndTrigg”
 = 
sql™e3VdbeMakeLab–
(
v
);

110666 
sql™e3Ex´IfF®£
(
pSubP¬£
, 
pWh’
, 
iEndTrigg”
, 
SQLITE_JUMPIFNULL
);

110668 
sql™e3Ex´D–‘e
(
db
, 
pWh’
);

110672 
codeTrigg”Prog¿m
(
pSubP¬£
, 
pTrigg”
->
¡•_li¡
, 
ÜcÚf
);

110675 ifÐ
	giEndTrigg”
 ){

110676 
sql™e3VdbeResÞveLab–
(
v
, 
iEndTrigg”
);

110678 
sql™e3VdbeAddOp0
(
v
, 
OP_H®t
);

110679 
VdbeComm’t
((
v
, "End: %s.%s", 
pTrigg”
->
zName
, 
ÚE¼ÜText
(
ÜcÚf
)));

110681 
ŒªsãrP¬£E¼Ü
(
pP¬£
, 
pSubP¬£
);

110682 ifÐ
	gdb
->
	gm®locFažed
==0 ){

110683 
pProg¿m
->
aOp
 = 
sql™e3VdbeTakeOpA¼ay
(
v
, &pProg¿m->
nOp
, &
pTÝ
->
nMaxArg
);

110685 
	gpProg¿m
->
	gnMem
 = 
pSubP¬£
->
nMem
;

110686 
	gpProg¿m
->
	gnC¤
 = 
pSubP¬£
->
nTab
;

110687 
	gpProg¿m
->
	gnOnû
 = 
pSubP¬£
->
nOnû
;

110688 
	gpProg¿m
->
	gtok’
 = (*)
pTrigg”
;

110689 
	gpPrg
->
	gaCÞmask
[0] = 
pSubP¬£
->
Þdmask
;

110690 
	gpPrg
->
	gaCÞmask
[1] = 
pSubP¬£
->
Ãwmask
;

110691 
sql™e3VdbeD–‘e
(
v
);

110694 
as£¹
Ð!
pSubP¬£
->
pAšc
 && !pSubP¬£->
pZomb›Tab
 );

110695 
as£¹
Ð!
pSubP¬£
->
pTrigg”Prg
 && !pSubP¬£->
nMaxArg
 );

110696 
sql™e3P¬£rRe£t
(
pSubP¬£
);

110697 
sql™e3SckF»e
(
db
, 
pSubP¬£
);

110699  
	gpPrg
;

110708 
Trigg”Prg
 *
g‘RowTrigg”
(

110709 
P¬£
 *
pP¬£
,

110710 
Trigg”
 *
pTrigg”
,

110711 
TabË
 *
pTab
,

110712 
ÜcÚf


110714 
P¬£
 *
	gpRoÙ
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

110715 
Trigg”Prg
 *
	gpPrg
;

110717 
as£¹
Ð
pTrigg”
->
zName
==0 || 
pTab
==
bËOfTrigg”
(pTrigger) );

110723 
	gpPrg
=
pRoÙ
->
pTrigg”Prg
;

110724 
	gpPrg
 && (pPrg->
	gpTrigg”
!=
pTrigg”
 || 
pPrg
->
ÜcÚf
!=orconf);

110725 
	gpPrg
=
pPrg
->
pNext


110729 ifÐ!
	gpPrg
 ){

110730 
	gpPrg
 = 
codeRowTrigg”
(
pP¬£
, 
pTrigg”
, 
pTab
, 
ÜcÚf
);

110733  
	gpPrg
;

110742 
SQLITE_PRIVATE
 
sql™e3CodeRowTrigg”Dœeù
(

110743 
P¬£
 *
pP¬£
,

110744 
Trigg”
 *
p
,

110745 
TabË
 *
pTab
,

110746 
»g
,

110747 
ÜcÚf
,

110748 
ignÜeJump


110750 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

110751 
Trigg”Prg
 *
	gpPrg
;

110752 
	gpPrg
 = 
g‘RowTrigg”
(
pP¬£
, 
p
, 
pTab
, 
ÜcÚf
);

110753 
as£¹
Ð
pPrg
 || 
pP¬£
->
nE¼
 ||…P¬£->
db
->
m®locFažed
 );

110757 ifÐ
	gpPrg
 ){

110758 
	gbRecursive
 = (
p
->
zName
 && 0==(
pP¬£
->
db
->
æags
&
SQLITE_RecTrigg”s
));

110760 
sql™e3VdbeAddOp3
(
v
, 
OP_Prog¿m
, 
»g
, 
ignÜeJump
, ++
pP¬£
->
nMem
);

110761 
sql™e3VdbeChªgeP4
(
v
, -1, (cÚ¡ *)
pPrg
->
pProg¿m
, 
P4_SUBPROGRAM
);

110762 
VdbeComm’t
(

110763 (
v
, "C®l: %s.%s", (
p
->
zName
?p->zName:"fkey"), 
ÚE¼ÜText
(
ÜcÚf
)));

110770 
sql™e3VdbeChªgeP5
(
v
, (
u8
)
bRecursive
);

110814 
SQLITE_PRIVATE
 
sql™e3CodeRowTrigg”
(

110815 
P¬£
 *
pP¬£
,

110816 
Trigg”
 *
pTrigg”
,

110817 
Ý
,

110818 
Ex´Li¡
 *
pChªges
,

110819 
Œ_tm
,

110820 
TabË
 *
pTab
,

110821 
»g
,

110822 
ÜcÚf
,

110823 
ignÜeJump


110825 
Trigg”
 *
	gp
;

110827 
as£¹
Ð
Ý
==
TK_UPDATE
 || op==
TK_INSERT
 || op==
TK_DELETE
 );

110828 
as£¹
Ð
Œ_tm
==
TRIGGER_BEFORE
 ||r_tm==
TRIGGER_AFTER
 );

110829 
as£¹
Ð(
Ý
==
TK_UPDATE
)==(
pChªges
!=0) );

110831 
	gp
=
pTrigg”
;…;…=
p
->
pNext
){

110836 
as£¹
Ð
p
->
pSchema
!=0 );

110837 
as£¹
Ð
p
->
pTabSchema
!=0 );

110838 
as£¹
Ð
p
->
pSchema
=õ->
pTabSchema


110839 || 
p
->
pSchema
==
pP¬£
->
db
->
aDb
[1].pSchema );

110842 ifÐ
	gp
->
	gÝ
==
Ý


110843 && 
p
->
Œ_tm
==tr_tm

110844 && 
checkCÞumnOv”Ïp
(
p
->
pCÞumns
, 
pChªges
)

110846 
sql™e3CodeRowTrigg”Dœeù
(
pP¬£
, 
p
, 
pTab
, 
»g
, 
ÜcÚf
, 
ignÜeJump
);

110876 
SQLITE_PRIVATE
 
u32
 
sql™e3Trigg”CÞmask
(

110877 
P¬£
 *
pP¬£
,

110878 
Trigg”
 *
pTrigg”
,

110879 
Ex´Li¡
 *
pChªges
,

110880 
isNew
,

110881 
Œ_tm
,

110882 
TabË
 *
pTab
,

110883 
ÜcÚf


110885 cÚ¡ 
	gÝ
 = 
pChªges
 ? 
TK_UPDATE
 : 
TK_DELETE
;

110886 
u32
 
	gmask
 = 0;

110887 
Trigg”
 *
	gp
;

110889 
as£¹
Ð
isNew
==1 || isNew==0 );

110890 
	gp
=
pTrigg”
;…;…=
p
->
pNext
){

110891 ifÐ
p
->
Ý
==Ý && (
Œ_tm
&p->tr_tm)

110892 && 
checkCÞumnOv”Ïp
(
p
->
pCÞumns
,
pChªges
)

110894 
Trigg”Prg
 *
	gpPrg
;

110895 
	gpPrg
 = 
g‘RowTrigg”
(
pP¬£
, 
p
, 
pTab
, 
ÜcÚf
);

110896 ifÐ
	gpPrg
 ){

110897 
	gmask
 |ð
pPrg
->
aCÞmask
[
isNew
];

110902  
	gmask
;

110924 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


110926 
upd©eVœtu®TabË
(

110927 
P¬£
 *
pP¬£
,

110928 
SrcLi¡
 *
pSrc
,

110929 
TabË
 *
pTab
,

110930 
Ex´Li¡
 *
pChªges
,

110931 
Ex´
 *
pRowidEx´
,

110932 *
aXRef
,

110933 
Ex´
 *
pWh”e
,

110934 
ÚE¼Ü


110968 
SQLITE_PRIVATE
 
sql™e3CÞumnDeçuÉ
(
Vdbe
 *
v
, 
TabË
 *
pTab
, 
i
, 
iReg
){

110969 
as£¹
Ð
pTab
!=0 );

110970 ifÐ!
	gpTab
->
	gpS–eù
 ){

110971 
sql™e3_v®ue
 *
	gpV®ue
 = 0;

110972 
u8
 
	g’c
 = 
ENC
(
sql™e3VdbeDb
(
v
));

110973 
CÞumn
 *
	gpCÞ
 = &
pTab
->
aCÞ
[
i
];

110974 
VdbeComm’t
((
v
, "%s.%s", 
pTab
->
zName
, 
pCÞ
->zName));

110975 
as£¹
Ð
i
<
pTab
->
nCÞ
 );

110976 
sql™e3V®ueFromEx´
(
sql™e3VdbeDb
(
v
), 
pCÞ
->
pDæt
, 
’c
,

110977 
pCÞ
->
affš™y
, &
pV®ue
);

110978 ifÐ
	gpV®ue
 ){

110979 
sql™e3VdbeChªgeP4
(
v
, -1, (cÚ¡ *)
pV®ue
, 
P4_MEM
);

110981 #iâdeà
SQLITE_OMIT_FLOATING_POINT


110982 ifÐ
	gpTab
->
	gaCÞ
[
i
].
	gaffš™y
==
SQLITE_AFF_REAL
 ){

110983 
sql™e3VdbeAddOp1
(
v
, 
OP_R—lAffš™y
, 
iReg
);

110996 
SQLITE_PRIVATE
 
sql™e3Upd©e
(

110997 
P¬£
 *
pP¬£
,

110998 
SrcLi¡
 *
pTabLi¡
,

110999 
Ex´Li¡
 *
pChªges
,

111000 
Ex´
 *
pWh”e
,

111001 
ÚE¼Ü


111003 
	gi
, 
	gj
;

111004 
TabË
 *
	gpTab
;

111005 
	gaddrTÝ
 = 0;

111006 
Wh”eInfo
 *
	gpWInfo
;

111007 
Vdbe
 *
	gv
;

111008 
Index
 *
	gpIdx
;

111009 
Index
 *
	gpPk
;

111010 
	gnIdx
;

111011 
	giBa£Cur
;

111012 
	giD©aCur
;

111013 
	giIdxCur
;

111014 
sql™e3
 *
	gdb
;

111015 *
	gaRegIdx
 = 0;

111016 *
	gaXRef
 = 0;

111019 
u8
 *
	gaToO³n
;

111020 
u8
 
	gchngPk
;

111021 
u8
 
	gchngRowid
;

111022 
u8
 
	gchngKey
;

111023 
Ex´
 *
	gpRowidEx´
 = 0;

111024 
AuthCÚ‹xt
 
	gsCÚ‹xt
;

111025 
NameCÚ‹xt
 
	gsNC
;

111026 
	giDb
;

111027 
	gokOÃPass
;

111028 
	ghasFK
;

111029 
	gÏb–B»ak
;

111030 
	gÏb–CÚtšue
;

111032 #iâdeà
SQLITE_OMIT_TRIGGER


111033 
	gisV›w
;

111034 
Trigg”
 *
	gpTrigg”
;

111035 
	gtmask
;

111037 
	gÃwmask
;

111038 
	giEph
 = 0;

111039 
	gnKey
 = 0;

111040 
	gaiCurOÃPass
[2];

111043 
	g»gRowCouÁ
 = 0;

111044 
	g»gOldRowid
;

111045 
	g»gNewRowid
;

111046 
	g»gNew
;

111047 
	g»gOld
 = 0;

111048 
	g»gRowS‘
 = 0;

111049 
	g»gKey
 = 0;

111051 
mem£t
(&
sCÚ‹xt
, 0, (sContext));

111052 
	gdb
 = 
pP¬£
->
db
;

111053 ifÐ
	gpP¬£
->
	gnE¼
 || 
	gdb
->
	gm®locFažed
 ){

111054 
	gupd©e_þ—nup
;

111056 
as£¹
Ð
pTabLi¡
->
nSrc
==1 );

111060 
	gpTab
 = 
sql™e3SrcLi¡Lookup
(
pP¬£
, 
pTabLi¡
);

111061 ifÐ
	gpTab
==0 ) 
upd©e_þ—nup
;

111062 
	giDb
 = 
sql™e3SchemaToIndex
(
pP¬£
->
db
, 
pTab
->
pSchema
);

111067 #iâdeà
SQLITE_OMIT_TRIGGER


111068 
	gpTrigg”
 = 
sql™e3Trigg”sExi¡
(
pP¬£
, 
pTab
, 
TK_UPDATE
, 
pChªges
, &
tmask
);

111069 
	gisV›w
 = 
pTab
->
pS–eù
!=0;

111070 
as£¹
Ð
pTrigg”
 || 
tmask
==0 );

111072 
	#pTrigg”
 0

	)

111073 
	#isV›w
 0

	)

111074 
	#tmask
 0

	)

111076 #ifdeà
SQLITE_OMIT_VIEW


111077 #undeà
isV›w


111078 
	#isV›w
 0

	)

111081 ifÐ
sql™e3V›wG‘CÞumnNames
(
pP¬£
, 
pTab
) ){

111082 
	gupd©e_þ—nup
;

111084 ifÐ
sql™e3IsR—dOÆy
(
pP¬£
, 
pTab
, 
tmask
) ){

111085 
	gupd©e_þ—nup
;

111093 
	gpTabLi¡
->
	ga
[0].
	giCursÜ
 = 
iBa£Cur
 = 
iD©aCur
 = 
pP¬£
->
nTab
++;

111094 
	giIdxCur
 = 
iD©aCur
+1;

111095 
	gpPk
 = 
HasRowid
(
pTab
è? 0 : 
sql™e3Prim¬yKeyIndex
(pTab);

111096 
	gnIdx
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
,‚Idx++){

111097 ifÐ
IsPrim¬yKeyIndex
(
pIdx
è&& 
	gpPk
!=0 ){

111098 
iD©aCur
 = 
pP¬£
->
nTab
;

111099 
	gpTabLi¡
->
	ga
[0].
	giCursÜ
 = 
iD©aCur
;

111101 
	gpP¬£
->
	gnTab
++;

111107 
	gaXRef
 = 
sql™e3DbM®locRaw
(
db
, (è* (
pTab
->
nCÞ
+
nIdx
) +‚Idx+2 );

111108 ifÐ
	gaXRef
==0 ) 
upd©e_þ—nup
;

111109 
	gaRegIdx
 = 
aXRef
+
pTab
->
nCÞ
;

111110 
	gaToO³n
 = (
u8
*)(
aRegIdx
+
nIdx
);

111111 
mem£t
(
aToO³n
, 1, 
nIdx
+1);

111112 
	gaToO³n
[
nIdx
+1] = 0;

111113 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++è
	gaXRef
[
i
] = -1;

111116 
mem£t
(&
sNC
, 0, (sNC));

111117 
	gsNC
.
	gpP¬£
 = 
pP¬£
;

111118 
	gsNC
.
	gpSrcLi¡
 = 
pTabLi¡
;

111126 
	gchngRowid
 = 
chngPk
 = 0;

111127 
	gi
=0; i<
	gpChªges
->
	gnEx´
; i++){

111128 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pChªges
->
a
[
i
].
pEx´
) ){

111129 
	gupd©e_þ—nup
;

111131 
	gj
=0; j<
	gpTab
->
	gnCÞ
; j++){

111132 ifÐ
sql™e3SŒICmp
(
pTab
->
aCÞ
[
j
].
zName
, 
pChªges
->
a
[
i
].zName)==0 ){

111133 ifÐ
j
==
pTab
->
iPKey
 ){

111134 
chngRowid
 = 1;

111135 
	gpRowidEx´
 = 
pChªges
->
a
[
i
].
pEx´
;

111136 }ifÐ
	gpPk
 && (
	gpTab
->
	gaCÞ
[
j
].
	gcÞFÏgs
 & 
	gCOLFLAG_PRIMKEY
)!=0 ){

111137 
chngPk
 = 1;

111139 
	gaXRef
[
j
] = 
i
;

111143 ifÐ
	gj
>=
pTab
->
nCÞ
 ){

111144 ifÐ
pPk
==0 && 
sql™e3IsRowid
(
pChªges
->
a
[
i
].
zName
) ){

111145 
j
 = -1;

111146 
	gchngRowid
 = 1;

111147 
	gpRowidEx´
 = 
pChªges
->
a
[
i
].
pEx´
;

111149 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch cÞumn: %s", 
pChªges
->
a
[
i
].
zName
);

111150 
	gpP¬£
->
	gcheckSchema
 = 1;

111151 
	gupd©e_þ—nup
;

111154 #iâdeà
SQLITE_OMIT_AUTHORIZATION


111156 
	grc
;

111157 
	grc
 = 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_UPDATE
, 
pTab
->
zName
,

111158 
j
<0 ? "ROWID" : 
pTab
->
aCÞ
[j].
zName
,

111159 
db
->
aDb
[
iDb
].
zName
);

111160 ifÐ
	grc
==
SQLITE_DENY
 ){

111161 
upd©e_þ—nup
;

111162 }ifÐ
	grc
==
SQLITE_IGNORE
 ){

111163 
aXRef
[
j
] = -1;

111168 
as£¹
Ð(
chngRowid
 & 
chngPk
)==0 );

111169 
as£¹
Ð
chngRowid
==0 || chngRowid==1 );

111170 
as£¹
Ð
chngPk
==0 || chngPk==1 );

111171 
	gchngKey
 = 
chngRowid
 + 
chngPk
;

111176 
	gpTabLi¡
->
	ga
[0].
	gcÞU£d
 = 0;

111178 
	ghasFK
 = 
sql™e3FkRequœed
(
pP¬£
, 
pTab
, 
aXRef
, 
chngKey
);

111184 
	gj
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, j++){

111185 
	g»g
;

111186 ifÐ
	gchngKey
 || 
	ghasFK
 || 
	gpIdx
->
	gpP¬tIdxWh”e
 ||…Idx==
pPk
 ){

111187 
»g
 = ++
pP¬£
->
nMem
;

111189 
	g»g
 = 0;

111190 
	gi
=0; i<
	gpIdx
->
	gnKeyCÞ
; i++){

111191 ifÐ
	gaXRef
[
pIdx
->
aiCÞumn
[
i
]]>=0 ){

111192 
»g
 = ++
pP¬£
->
nMem
;

111197 ifÐ
	g»g
==0 ) 
aToO³n
[
j
+1] = 0;

111198 
	gaRegIdx
[
j
] = 
»g
;

111202 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

111203 ifÐ
	gv
==0 ) 
upd©e_þ—nup
;

111204 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 ) 
sql™e3VdbeCouÁChªges
(
v
);

111205 
sql™e3BegšWr™eO³¿tiÚ
(
pP¬£
, 1, 
iDb
);

111207 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


111209 ifÐ
IsVœtu®
(
pTab
) ){

111210 
upd©eVœtu®TabË
(
pP¬£
, 
pTabLi¡
, 
pTab
, 
pChªges
, 
pRowidEx´
, 
aXRef
,

111211 
pWh”e
, 
ÚE¼Ü
);

111212 
	gpWh”e
 = 0;

111213 
	gpTabLi¡
 = 0;

111214 
	gupd©e_þ—nup
;

111219 
	g»gRowS‘
 = ++
pP¬£
->
nMem
;

111220 
	g»gOldRowid
 = 
»gNewRowid
 = ++
pP¬£
->
nMem
;

111221 ifÐ
	gchngPk
 || 
	gpTrigg”
 || 
	ghasFK
 ){

111222 
	g»gOld
 = 
pP¬£
->
nMem
 + 1;

111223 
	gpP¬£
->
	gnMem
 +ð
pTab
->
nCÞ
;

111225 ifÐ
	gchngKey
 || 
	gpTrigg”
 || 
	ghasFK
 ){

111226 
	g»gNewRowid
 = ++
pP¬£
->
nMem
;

111228 
	g»gNew
 = 
pP¬£
->
nMem
 + 1;

111229 
	gpP¬£
->
	gnMem
 +ð
pTab
->
nCÞ
;

111232 ifÐ
	gisV›w
 ){

111233 
sql™e3AuthCÚ‹xtPush
(
pP¬£
, &
sCÚ‹xt
, 
pTab
->
zName
);

111239 #ià!
defšed
(
SQLITE_OMIT_VIEW
è&& !defšed(
SQLITE_OMIT_TRIGGER
)

111240 ifÐ
	gisV›w
 ){

111241 
sql™e3M©”ŸlizeV›w
(
pP¬£
, 
pTab
, 
pWh”e
, 
iD©aCur
);

111248 ifÐ
sql™e3ResÞveEx´Names
(&
sNC
, 
pWh”e
) ){

111249 
	gupd©e_þ—nup
;

111254 ifÐ
HasRowid
(
pTab
) ){

111255 
sql™e3VdbeAddOp3
(
v
, 
OP_NuÎ
, 0, 
»gRowS‘
, 
»gOldRowid
);

111256 
	gpWInfo
 = 
sql™e3Wh”eBegš
(

111257 
pP¬£
, 
pTabLi¡
, 
pWh”e
, 0, 0, 
WHERE_ONEPASS_DESIRED
, 
iIdxCur


111259 ifÐ
	gpWInfo
==0 ) 
upd©e_þ—nup
;

111260 
	gokOÃPass
 = 
sql™e3Wh”eOkOÃPass
(
pWInfo
, 
aiCurOÃPass
);

111264 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iD©aCur
, 
»gOldRowid
);

111265 ifÐ!
	gokOÃPass
 ){

111266 
sql™e3VdbeAddOp2
(
v
, 
OP_RowS‘Add
, 
»gRowS‘
, 
»gOldRowid
);

111271 
sql™e3Wh”eEnd
(
pWInfo
);

111273 
	giPk
;

111274 
i16
 
	gnPk
;

111275 
	gaddrO³n
;

111277 
as£¹
Ð
pPk
!=0 );

111278 
	gnPk
 = 
pPk
->
nKeyCÞ
;

111279 
	giPk
 = 
pP¬£
->
nMem
+1;

111280 
	gpP¬£
->
	gnMem
 +ð
nPk
;

111281 
	g»gKey
 = ++
pP¬£
->
nMem
;

111282 
	giEph
 = 
pP¬£
->
nTab
++;

111283 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
iPk
);

111284 
	gaddrO³n
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
iEph
, 
nPk
);

111285 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pPk
);

111286 
	gpWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pTabLi¡
, 
pWh”e
, 0, 0,

111287 
WHERE_ONEPASS_DESIRED
, 
iIdxCur
);

111288 ifÐ
	gpWInfo
==0 ) 
upd©e_þ—nup
;

111289 
	gokOÃPass
 = 
sql™e3Wh”eOkOÃPass
(
pWInfo
, 
aiCurOÃPass
);

111290 
	gi
=0; i<
	gnPk
; i++){

111291 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
pPk
->
aiCÞumn
[
i
],

111292 
iPk
+
i
);

111294 ifÐ
	gokOÃPass
 ){

111295 
sql™e3VdbeChªgeToNoÝ
(
v
, 
addrO³n
);

111296 
	gnKey
 = 
nPk
;

111297 
	g»gKey
 = 
iPk
;

111299 
sql™e3VdbeAddOp4
(
v
, 
OP_MakeRecÜd
, 
iPk
, 
nPk
, 
»gKey
,

111300 
sql™e3IndexAffš™ySŒ
(
v
, 
pPk
), 
nPk
);

111301 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
iEph
, 
»gKey
);

111303 
sql™e3Wh”eEnd
(
pWInfo
);

111308 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
è&& !
	gpP¬£
->
	gpTrigg”Tab
 ){

111309 
	g»gRowCouÁ
 = ++
pP¬£
->
nMem
;

111310 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gRowCouÁ
);

111313 
	gÏb–B»ak
 = 
sql™e3VdbeMakeLab–
(
v
);

111314 ifÐ!
	gisV›w
 ){

111321 ifÐ
	gÚE¼Ü
==
OE_R•Ïû
 ){

111322 
mem£t
(
aToO³n
, 1, 
nIdx
+1);

111324 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

111325 ifÐ
pIdx
->
ÚE¼Ü
==
OE_R•Ïû
 ){

111326 
mem£t
(
aToO³n
, 1, 
nIdx
+1);

111331 ifÐ
	gokOÃPass
 ){

111332 ifÐ
	gaiCurOÃPass
[0]>=0 ) 
aToO³n
[
aiCurOÃPass
[0]-
iBa£Cur
] = 0;

111333 ifÐ
	gaiCurOÃPass
[1]>=0 ) 
aToO³n
[
aiCurOÃPass
[1]-
iBa£Cur
] = 0;

111335 
sql™e3O³nTabËAndIndiûs
(
pP¬£
, 
pTab
, 
OP_O³nWr™e
, 
iBa£Cur
, 
aToO³n
,

111340 ifÐ
	gokOÃPass
 ){

111341 ifÐ
	gaToO³n
[
iD©aCur
-
iBa£Cur
] && !
	gisV›w
 ){

111342 
as£¹
Ð
pPk
 );

111343 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iD©aCur
, 
Ïb–B»ak
, 
»gKey
, 
nKey
);

111344 
VdbeCov”ageNev”Tak’
(
v
);

111346 
	gÏb–CÚtšue
 = 
Ïb–B»ak
;

111347 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
pPk
 ? 
»gKey
 : 
»gOldRowid
, 
Ïb–B»ak
);

111348 
VdbeCov”ageIf
(
v
, 
pPk
==0);

111349 
VdbeCov”ageIf
(
v
, 
pPk
!=0);

111350 }ifÐ
	gpPk
 ){

111351 
	gÏb–CÚtšue
 = 
sql™e3VdbeMakeLab–
(
v
);

111352 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
iEph
, 
Ïb–B»ak
); 
VdbeCov”age
(v);

111353 
	gaddrTÝ
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_RowKey
, 
iEph
, 
»gKey
);

111354 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iD©aCur
, 
Ïb–CÚtšue
, 
»gKey
, 0);

111355 
VdbeCov”age
(
v
);

111357 
	gÏb–CÚtšue
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_RowS‘R—d
, 
»gRowS‘
, 
Ïb–B»ak
,

111358 
»gOldRowid
);

111359 
VdbeCov”age
(
v
);

111360 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iD©aCur
, 
Ïb–CÚtšue
, 
»gOldRowid
);

111361 
VdbeCov”age
(
v
);

111368 
as£¹
Ð
chngKey
 || 
pTrigg”
 || 
hasFK
 || 
»gOldRowid
==
»gNewRowid
 );

111369 ifÐ
	gchngRowid
 ){

111370 
sql™e3Ex´Code
(
pP¬£
, 
pRowidEx´
, 
»gNewRowid
);

111371 
sql™e3VdbeAddOp1
(
v
, 
OP_Mu¡BeIÁ
, 
»gNewRowid
); 
VdbeCov”age
(v);

111376 ifÐ
	gchngPk
 || 
	ghasFK
 || 
	gpTrigg”
 ){

111377 
u32
 
	gÞdmask
 = (
hasFK
 ? 
sql™e3FkOldmask
(
pP¬£
, 
pTab
) : 0);

111378 
	gÞdmask
 |ð
sql™e3Trigg”CÞmask
(
pP¬£
,

111379 
pTrigg”
, 
pChªges
, 0, 
TRIGGER_BEFORE
|
TRIGGER_AFTER
, 
pTab
, 
ÚE¼Ü


111381 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

111382 ifÐ
	gÞdmask
==0xffffffff

111383 || (
i
<32 && (
Þdmask
 & 
MASKBIT32
(i))!=0)

111384 || (
pTab
->
aCÞ
[
i
].
cÞFÏgs
 & 
COLFLAG_PRIMKEY
)!=0

111386 
‹¡ÿ£
Ð
Þdmask
!=0xfffffffà&& 
i
==31 );

111387 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
i
, 
»gOld
+i);

111389 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gOld
+
i
);

111392 ifÐ
	gchngRowid
==0 && 
pPk
==0 ){

111393 
sql™e3VdbeAddOp2
(
v
, 
OP_CÝy
, 
»gOldRowid
, 
»gNewRowid
);

111410 
	gÃwmask
 = 
sql™e3Trigg”CÞmask
(

111411 
pP¬£
, 
pTrigg”
, 
pChªges
, 1, 
TRIGGER_BEFORE
, 
pTab
, 
ÚE¼Ü


111414 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

111415 ifÐ
	gi
==
pTab
->
iPKey
 ){

111416 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gNew
+
i
);

111418 
	gj
 = 
aXRef
[
i
];

111419 ifÐ
	gj
>=0 ){

111420 
sql™e3Ex´Code
(
pP¬£
, 
pChªges
->
a
[
j
].
pEx´
, 
»gNew
+
i
);

111421 }ifÐ0==(
tmask
&
TRIGGER_BEFORE
è|| 
i
>31 || (
Ãwmask
 & 
MASKBIT32
(i)) ){

111427 
‹¡ÿ£
Ð
i
==31 );

111428 
‹¡ÿ£
Ð
i
==32 );

111429 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
i
, 
»gNew
+i);

111431 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gNew
+
i
);

111439 ifÐ
	gtmask
&
	gTRIGGER_BEFORE
 ){

111440 
sql™e3TabËAffš™y
(
v
, 
pTab
, 
»gNew
);

111441 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
, 
TK_UPDATE
, 
pChªges
,

111442 
TRIGGER_BEFORE
, 
pTab
, 
»gOldRowid
, 
ÚE¼Ü
, 
Ïb–CÚtšue
);

111450 ifÐ
	gpPk
 ){

111451 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iD©aCur
, 
Ïb–CÚtšue
,
»gKey
,
nKey
);

111452 
VdbeCov”age
(
v
);

111454 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iD©aCur
, 
Ïb–CÚtšue
, 
»gOldRowid
);

111455 
VdbeCov”age
(
v
);

111463 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

111464 ifÐ
	gaXRef
[
i
]<0 && 
	gi
!=
pTab
->
iPKey
 ){

111465 
sql™e3Ex´CodeG‘CÞumnOfTabË
(
v
, 
pTab
, 
iD©aCur
, 
i
, 
»gNew
+i);

111470 ifÐ!
	gisV›w
 ){

111471 
	gj1
 = 0;

111472 
	gbR•Ïû
 = 0;

111475 
as£¹
Ð
»gOldRowid
>0 );

111476 
sql™e3G’”©eCÚ¡¿štChecks
(
pP¬£
, 
pTab
, 
aRegIdx
, 
iD©aCur
, 
iIdxCur
,

111477 
»gNewRowid
, 
»gOldRowid
, 
chngKey
, 
ÚE¼Ü
, 
Ïb–CÚtšue
, &
bR•Ïû
);

111480 ifÐ
	ghasFK
 ){

111481 
sql™e3FkCheck
(
pP¬£
, 
pTab
, 
»gOldRowid
, 0, 
aXRef
, 
chngKey
);

111485 ifÐ
	gbR•Ïû
 || 
	gchngKey
 ){

111486 ifÐ
	gpPk
 ){

111487 
	gj1
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iD©aCur
, 0, 
»gKey
, 
nKey
);

111489 
	gj1
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iD©aCur
, 0, 
»gOldRowid
);

111491 
VdbeCov”ageNev”Tak’
(
v
);

111493 
sql™e3G’”©eRowIndexD–‘e
(
pP¬£
, 
pTab
, 
iD©aCur
, 
iIdxCur
, 
aRegIdx
);

111496 ifÐ
	ghasFK
 || 
	gchngKey
 || 
	gpPk
!=0 ){

111497 
sql™e3VdbeAddOp2
(
v
, 
OP_D–‘e
, 
iD©aCur
, 0);

111499 ifÐ
	gbR•Ïû
 || 
	gchngKey
 ){

111500 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

111503 ifÐ
	ghasFK
 ){

111504 
sql™e3FkCheck
(
pP¬£
, 
pTab
, 0, 
»gNewRowid
, 
aXRef
, 
chngKey
);

111508 
sql™e3Com¶‘eIn£¹iÚ
(
pP¬£
, 
pTab
, 
iD©aCur
, 
iIdxCur
,

111509 
»gNewRowid
, 
aRegIdx
, 1, 0, 0);

111514 ifÐ
	ghasFK
 ){

111515 
sql™e3FkAùiÚs
(
pP¬£
, 
pTab
, 
pChªges
, 
»gOldRowid
, 
aXRef
, 
chngKey
);

111521 ifÐ(
	gdb
->
	gæags
 & 
	gSQLITE_CouÁRows
è&& !
	gpP¬£
->
	gpTrigg”Tab
){

111522 
sql™e3VdbeAddOp2
(
v
, 
OP_AddImm
, 
»gRowCouÁ
, 1);

111525 
sql™e3CodeRowTrigg”
(
pP¬£
, 
pTrigg”
, 
TK_UPDATE
, 
pChªges
,

111526 
TRIGGER_AFTER
, 
pTab
, 
»gOldRowid
, 
ÚE¼Ü
, 
Ïb–CÚtšue
);

111531 ifÐ
	gokOÃPass
 ){

111533 }ifÐ
	gpPk
 ){

111534 
sql™e3VdbeResÞveLab–
(
v
, 
Ïb–CÚtšue
);

111535 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
iEph
, 
addrTÝ
); 
VdbeCov”age
(v);

111537 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
Ïb–CÚtšue
);

111539 
sql™e3VdbeResÞveLab–
(
v
, 
Ïb–B»ak
);

111542 
	gi
=0, 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
, i++){

111543 
as£¹
Ð
aRegIdx
 );

111544 ifÐ
	gaToO³n
[
i
+1] ){

111545 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iIdxCur
+
i
, 0);

111548 ifÐ
	giD©aCur
<
	giIdxCur
 ) 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
iD©aCur
, 0);

111554 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 && 
pP¬£
->
pTrigg”Tab
==0 ){

111555 
sql™e3Autošüem’tEnd
(
pP¬£
);

111563 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_CouÁRows
è&& !
	gpP¬£
->
	gpTrigg”Tab
 && !pP¬£->
	gÃ¡ed
 ){

111564 
sql™e3VdbeAddOp2
(
v
, 
OP_ResuÉRow
, 
»gRowCouÁ
, 1);

111565 
sql™e3VdbeS‘NumCÞs
(
v
, 1);

111566 
sql™e3VdbeS‘CÞName
(
v
, 0, 
COLNAME_NAME
, "row upd©ed", 
SQLITE_STATIC
);

111569 
	gupd©e_þ—nup
:

111570 
sql™e3AuthCÚ‹xtPÝ
(&
sCÚ‹xt
);

111571 
sql™e3DbF»e
(
db
, 
aXRef
);

111572 
sql™e3SrcLi¡D–‘e
(
db
, 
pTabLi¡
);

111573 
sql™e3Ex´Li¡D–‘e
(
db
, 
pChªges
);

111574 
sql™e3Ex´D–‘e
(
db
, 
pWh”e
);

111580 #ifdeà
isV›w


111581 #undeà
isV›w


111583 #ifdeà
pTrigg”


111584 #undeà
pTrigg”


111587 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


111607 
upd©eVœtu®TabË
(

111608 
P¬£
 *
pP¬£
,

111609 
SrcLi¡
 *
pSrc
,

111610 
TabË
 *
pTab
,

111611 
Ex´Li¡
 *
pChªges
,

111612 
Ex´
 *
pRowid
,

111613 *
aXRef
,

111614 
Ex´
 *
pWh”e
,

111615 
ÚE¼Ü


111617 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

111618 
Ex´Li¡
 *
	gpELi¡
 = 0;

111619 
S–eù
 *
	gpS–eù
 = 0;

111620 
Ex´
 *
	gpEx´
;

111621 
	g•hemTab
;

111622 
	gi
;

111623 
	gaddr
;

111624 
	giReg
;

111625 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

111626 cÚ¡ *
	gpVTab
 = (cÚ¡ *)
sql™e3G‘VTabË
(
db
, 
pTab
);

111627 
S–eùDe¡
 
	gde¡
;

111632 
	gpELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
sql™e3Ex´
(
db
, 
TK_ID
, "_rowid_"));

111633 ifÐ
	gpRowid
 ){

111634 
	gpELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pELi¡
,

111635 
sql™e3Ex´Dup
(
db
, 
pRowid
, 0));

111637 
as£¹
Ð
pTab
->
iPKey
<0 );

111638 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

111639 ifÐ
	gaXRef
[
i
]>=0 ){

111640 
pEx´
 = 
sql™e3Ex´Dup
(
db
, 
pChªges
->
a
[
aXRef
[
i
]].pExpr, 0);

111642 
	gpEx´
 = 
sql™e3Ex´
(
db
, 
TK_ID
, 
pTab
->
aCÞ
[
i
].
zName
);

111644 
	gpELi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
pELi¡
, 
pEx´
);

111646 
	gpS–eù
 = 
sql™e3S–eùNew
(
pP¬£
, 
pELi¡
, 
pSrc
, 
pWh”e
, 0, 0, 0, 0, 0, 0);

111651 
as£¹
Ð
v
 );

111652 
	g•hemTab
 = 
pP¬£
->
nTab
++;

111653 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
•hemTab
, 
pTab
->
nCÞ
+1+(
pRowid
!=0));

111654 
sql™e3VdbeChªgeP5
(
v
, 
BTREE_UNORDERED
);

111658 
sql™e3S–eùDe¡In™
(&
de¡
, 
SRT_TabË
, 
•hemTab
);

111659 
sql™e3S–eù
(
pP¬£
, 
pS–eù
, &
de¡
);

111662 
	giReg
 = ++
pP¬£
->
nMem
;

111663 
	gpP¬£
->
	gnMem
 +ð
pTab
->
nCÞ
+1;

111664 
	gaddr
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rewšd
, 
•hemTab
, 0); 
VdbeCov”age
(v);

111665 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
•hemTab
, 0, 
iReg
);

111666 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
•hemTab
, (
pRowid
?1:0), 
iReg
+1);

111667 
	gi
=0; i<
	gpTab
->
	gnCÞ
; i++){

111668 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
•hemTab
, 
i
+1+(
pRowid
!=0), 
iReg
+2+i);

111670 
sql™e3VbMakeWr™abË
(
pP¬£
, 
pTab
);

111671 
sql™e3VdbeAddOp4
(
v
, 
OP_VUpd©e
, 0, 
pTab
->
nCÞ
+2, 
iReg
, 
pVTab
, 
P4_VTAB
);

111672 
sql™e3VdbeChªgeP5
(
v
, 
ÚE¼Ü
==
OE_DeçuÉ
 ? 
OE_AbÜt
 : onError);

111673 
sql™e3MayAbÜt
(
pP¬£
);

111674 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
•hemTab
, 
addr
+1); 
VdbeCov”age
(v);

111675 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

111676 
sql™e3VdbeAddOp2
(
v
, 
OP_Clo£
, 
•hemTab
, 0);

111679 
sql™e3S–eùD–‘e
(
db
, 
pS–eù
);

111702 #ià!
defšed
(
SQLITE_OMIT_VACUUM
è&& !defšed(
SQLITE_OMIT_ATTACH
)

111707 
vacuumFš®ize
(
sql™e3
 *
db
, 
sql™e3_¡mt
 *
pStmt
, **
pzE¼Msg
){

111708 
	grc
;

111709 
	grc
 = 
sql™e3VdbeFš®ize
((
Vdbe
*)
pStmt
);

111710 ifÐ
	grc
 ){

111711 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, 
sql™e3_”rmsg
(db));

111713  
	grc
;

111719 
execSql
(
sql™e3
 *
db
, **
pzE¼Msg
, cÚ¡ *
zSql
){

111720 
sql™e3_¡mt
 *
	gpStmt
;

111721 
VVA_ONLY
Ð
rc
; )

111722 ifÐ!
	gzSql
 ){

111723  
	gSQLITE_NOMEM
;

111725 ifÐ
	gSQLITE_OK
!=
sql™e3_´•¬e
(
db
, 
zSql
, -1, &
pStmt
, 0) ){

111726 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, 
sql™e3_”rmsg
(db));

111727  
sql™e3_”rcode
(
db
);

111729 
VVA_ONLY
Ð
rc
 = ) 
sql™e3_¡•
(
pStmt
);

111730 
as£¹
Ð
rc
!=
SQLITE_ROW
 || (
db
->
æags
&
SQLITE_CouÁRows
) );

111731  
vacuumFš®ize
(
db
, 
pStmt
, 
pzE¼Msg
);

111738 
execExecSql
(
sql™e3
 *
db
, **
pzE¼Msg
, cÚ¡ *
zSql
){

111739 
sql™e3_¡mt
 *
	gpStmt
;

111740 
	grc
;

111742 
	grc
 = 
sql™e3_´•¬e
(
db
, 
zSql
, -1, &
pStmt
, 0);

111743 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

111745  
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

111746 
rc
 = 
execSql
(
db
, 
pzE¼Msg
, (*)
sql™e3_cÞumn_‹xt
(
pStmt
, 0));

111747 ifÐ
	grc
!=
SQLITE_OK
 ){

111748 
vacuumFš®ize
(
db
, 
pStmt
, 
pzE¼Msg
);

111749  
	grc
;

111753  
vacuumFš®ize
(
db
, 
pStmt
, 
pzE¼Msg
);

111786 
SQLITE_PRIVATE
 
sql™e3Vacuum
(
P¬£
 *
pP¬£
){

111787 
Vdbe
 *
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

111788 ifÐ
	gv
 ){

111789 
sql™e3VdbeAddOp2
(
v
, 
OP_Vacuum
, 0, 0);

111790 
sql™e3VdbeU£sBŒ“
(
v
, 0);

111798 
SQLITE_PRIVATE
 
sql™e3RunVacuum
(**
pzE¼Msg
, 
sql™e3
 *
db
){

111799 
	grc
 = 
SQLITE_OK
;

111800 
BŒ“
 *
	gpMaš
;

111801 
BŒ“
 *
	gpTemp
;

111802 *
	gzSql
 = 0;

111803 
	g§ved_æags
;

111804 
	g§ved_nChªge
;

111805 
	g§ved_nTÙ®Chªge
;

111806 (*
	g§ved_xT¿û
)(*,const *);

111807 
Db
 *
	gpDb
 = 0;

111808 
	gisMemDb
;

111809 
	gnRes
;

111810 
	gnDb
;

111812 ifÐ!
	gdb
->
	gautoComm™
 ){

111813 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
, "cannot VACUUM from within‡ransaction");

111814  
	gSQLITE_ERROR
;

111816 ifÐ
	gdb
->
	gnVdbeAùive
>1 ){

111817 
sql™e3S‘SŒšg
(
pzE¼Msg
, 
db
,"cannot VACUUM - SQL statements in…rogress");

111818  
	gSQLITE_ERROR
;

111824 
	g§ved_æags
 = 
db
->
æags
;

111825 
	g§ved_nChªge
 = 
db
->
nChªge
;

111826 
	g§ved_nTÙ®Chªge
 = 
db
->
nTÙ®Chªge
;

111827 
	g§ved_xT¿û
 = 
db
->
xT¿û
;

111828 
	gdb
->
	gæags
 |ð
SQLITE_Wr™eSchema
 | 
SQLITE_IgnÜeChecks
 | 
SQLITE_P»ãrBužtš
;

111829 
	gdb
->
	gæags
 &ð~(
SQLITE_FÜeignKeys
 | 
SQLITE_Rev”£Ord”
);

111830 
	gdb
->
	gxT¿û
 = 0;

111832 
	gpMaš
 = 
db
->
aDb
[0].
pBt
;

111833 
	gisMemDb
 = 
sql™e3Pag”IsMemdb
(
sql™e3BŒ“Pag”
(
pMaš
));

111849 
	gnDb
 = 
db
->
nDb
;

111850 ifÐ
sql™e3TempInMemÜy
(
db
) ){

111851 
	gzSql
 = "ATTACH ':memory:' AS vacuum_db;";

111853 
	gzSql
 = "ATTACH '' AS vacuum_db;";

111855 
	grc
 = 
execSql
(
db
, 
pzE¼Msg
, 
zSql
);

111856 ifÐ
	gdb
->
	gnDb
>nDb ){

111857 
	gpDb
 = &
db
->
aDb
[db->
nDb
-1];

111858 
as£¹
Ð
¡rcmp
(
pDb
->
zName
,"vacuum_db")==0 );

111860 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111861 
	gpTemp
 = 
db
->
aDb
[db->
nDb
-1].
pBt
;

111867 
sql™e3BŒ“Comm™
(
pTemp
);

111869 
	gnRes
 = 
sql™e3BŒ“G‘Re£rve
(
pMaš
);

111872 #ifdeà
SQLITE_HAS_CODEC


111873 ifÐ
	gdb
->
	gÃxtPagesize
 ){

111874 
sql™e3CodecG‘Key
(
sql™e3
*, , **, *);

111875 
	gnKey
;

111876 *
	gzKey
;

111877 
sql™e3CodecG‘Key
(
db
, 0, (**)&
zKey
, &
nKey
);

111878 ifÐ
	gnKey
 ) 
	gdb
->
	gÃxtPagesize
 = 0;

111882 
	grc
 = 
execSql
(
db
, 
pzE¼Msg
, "PRAGMA vacuum_db.synchronous=OFF");

111883 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111889 
	grc
 = 
execSql
(
db
, 
pzE¼Msg
, "BEGIN;");

111890 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111891 
	grc
 = 
sql™e3BŒ“BegšT¿ns
(
pMaš
, 2);

111892 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111895 ifÐ
sql™e3Pag”G‘Jouº®Mode
(
sql™e3BŒ“Pag”
(
pMaš
))

111896 ==
PAGER_JOURNALMODE_WAL
 ){

111897 
db
->
ÃxtPagesize
 = 0;

111900 ifÐ
sql™e3BŒ“S‘PageSize
(
pTemp
, 
sql™e3BŒ“G‘PageSize
(
pMaš
), 
nRes
, 0)

111901 || (!
	gisMemDb
 && 
sql™e3BŒ“S‘PageSize
(
pTemp
, 
db
->
ÃxtPagesize
, 
nRes
, 0))

111902 || 
NEVER
(
db
->
m®locFažed
)

111904 
	grc
 = 
SQLITE_NOMEM
;

111905 
	g’d_of_vacuum
;

111908 #iâdeà
SQLITE_OMIT_AUTOVACUUM


111909 
sql™e3BŒ“S‘AutoVacuum
(
pTemp
, 
db
->
ÃxtAutovac
>=0 ? db->nextAutovac :

111910 
sql™e3BŒ“G‘AutoVacuum
(
pMaš
));

111916 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111921 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111922 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111925 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111926 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111929 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111935 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111942 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111946 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111950 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111951 
	grc
 = 
execExecSql
(
db
, 
pzE¼Msg
,

111956 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

111964 
	grc
 = 
execSql
(
db
, 
pzE¼Msg
,

111971 ifÐ
	grc
 ) 
	g’d_of_vacuum
;

111980 
u32
 
	gm‘a
;

111981 
	gi
;

111989 cÚ¡ 
	gaCÝy
[] = {

111990 
BTREE_SCHEMA_VERSION
, 1,

111991 
BTREE_DEFAULT_CACHE_SIZE
, 0,

111992 
BTREE_TEXT_ENCODING
, 0,

111993 
BTREE_USER_VERSION
, 0,

111994 
BTREE_APPLICATION_ID
, 0,

111997 
as£¹
Ð1==
sql™e3BŒ“IsInT¿ns
(
pTemp
) );

111998 
as£¹
Ð1==
sql™e3BŒ“IsInT¿ns
(
pMaš
) );

112001 
	gi
=0; i<
A¼aySize
(
aCÝy
); i+=2){

112004 
sql™e3BŒ“G‘M‘a
(
pMaš
, 
aCÝy
[
i
], &
m‘a
);

112005 
	grc
 = 
sql™e3BŒ“Upd©eM‘a
(
pTemp
, 
aCÝy
[
i
], 
m‘a
+aCopy[i+1]);

112006 ifÐ
NEVER
(
rc
!=
SQLITE_OK
èè
’d_of_vacuum
;

112009 
	grc
 = 
sql™e3BŒ“CÝyFže
(
pMaš
, 
pTemp
);

112010 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

112011 
	grc
 = 
sql™e3BŒ“Comm™
(
pTemp
);

112012 ifÐ
	grc
!=
SQLITE_OK
 ) 
’d_of_vacuum
;

112013 #iâdeà
SQLITE_OMIT_AUTOVACUUM


112014 
sql™e3BŒ“S‘AutoVacuum
(
pMaš
, 
sql™e3BŒ“G‘AutoVacuum
(
pTemp
));

112018 
as£¹
Ð
rc
==
SQLITE_OK
 );

112019 
	grc
 = 
sql™e3BŒ“S‘PageSize
(
pMaš
, 
sql™e3BŒ“G‘PageSize
(
pTemp
), 
nRes
,1);

112021 
	g’d_of_vacuum
:

112023 
db
->
æags
 = 
§ved_æags
;

112024 
	gdb
->
	gnChªge
 = 
§ved_nChªge
;

112025 
	gdb
->
	gnTÙ®Chªge
 = 
§ved_nTÙ®Chªge
;

112026 
	gdb
->
	gxT¿û
 = 
§ved_xT¿û
;

112027 
sql™e3BŒ“S‘PageSize
(
pMaš
, -1, -1, 1);

112036 
	gdb
->
	gautoComm™
 = 1;

112038 ifÐ
	gpDb
 ){

112039 
sql™e3BŒ“Clo£
(
pDb
->
pBt
);

112040 
	gpDb
->
	gpBt
 = 0;

112041 
	gpDb
->
	gpSchema
 = 0;

112046 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

112048  
	grc
;

112068 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


112077 
	sVbCtx
 {

112078 
VTabË
 *
	gpVTabË
;

112079 
TabË
 *
	gpTab
;

112087 
ü—‹ModuË
(

112088 
sql™e3
 *
db
,

112089 cÚ¡ *
zName
,

112090 cÚ¡ 
sql™e3_moduË
 *
pModuË
,

112091 *
pAux
,

112092 (*
xDe¡roy
)(*)

112094 
	grc
 = 
SQLITE_OK
;

112095 
	gnName
;

112097 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

112098 
	gnName
 = 
sql™e3SŒËn30
(
zName
);

112099 ifÐ
sql™e3HashFšd
(&
db
->
aModuË
, 
zName
) ){

112100 
	grc
 = 
SQLITE_MISUSE_BKPT
;

112102 
ModuË
 *
	gpMod
;

112103 
	gpMod
 = (
ModuË
 *)
sql™e3DbM®locRaw
(
db
, (ModuËè+ 
nName
 + 1);

112104 ifÐ
	gpMod
 ){

112105 
ModuË
 *
	gpD–
;

112106 *
	gzCÝy
 = (*)(&
pMod
[1]);

112107 
memýy
(
zCÝy
, 
zName
, 
nName
+1);

112108 
	gpMod
->
	gzName
 = 
zCÝy
;

112109 
	gpMod
->
	gpModuË
 = 
pModuË
;

112110 
	gpMod
->
	gpAux
 = 
pAux
;

112111 
	gpMod
->
	gxDe¡roy
 = 
xDe¡roy
;

112112 
	gpD–
 = (
ModuË
 *)
sql™e3HashIn£¹
(&
db
->
aModuË
,
zCÝy
,(*)
pMod
);

112113 
as£¹
Ð
pD–
==0 ||…D–==
pMod
 );

112114 ifÐ
	gpD–
 ){

112115 
	gdb
->
	gm®locFažed
 = 1;

112116 
sql™e3DbF»e
(
db
, 
pD–
);

112120 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

112121 ifÐ
	grc
!=
SQLITE_OK
 && 
xDe¡roy
 ) xDe¡roy(
pAux
);

112123 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

112124  
	grc
;

112131 
SQLITE_API
 
sql™e3_ü—‹_moduË
(

112132 
sql™e3
 *
db
,

112133 cÚ¡ *
zName
,

112134 cÚ¡ 
sql™e3_moduË
 *
pModuË
,

112135 *
pAux


112137  
ü—‹ModuË
(
db
, 
zName
, 
pModuË
, 
pAux
, 0);

112143 
SQLITE_API
 
sql™e3_ü—‹_moduË_v2
(

112144 
sql™e3
 *
db
,

112145 cÚ¡ *
zName
,

112146 cÚ¡ 
sql™e3_moduË
 *
pModuË
,

112147 *
pAux
,

112148 (*
xDe¡roy
)(*)

112150  
ü—‹ModuË
(
db
, 
zName
, 
pModuË
, 
pAux
, 
xDe¡roy
);

112161 
SQLITE_PRIVATE
 
sql™e3VbLock
(
VTabË
 *
pVTab
){

112162 
	gpVTab
->
	gnRef
++;

112171 
SQLITE_PRIVATE
 
VTabË
 *
sql™e3G‘VTabË
(
sql™e3
 *
db
, 
TabË
 *
pTab
){

112172 
VTabË
 *
	gpVb
;

112173 
as£¹
Ð
IsVœtu®
(
pTab
) );

112174 
	gpVb
=
pTab
->
pVTabË
;…Vb &&…Vb->
	gdb
!=
db
;…Vb=
pVb
->
pNext
);

112175  
	gpVb
;

112182 
SQLITE_PRIVATE
 
sql™e3VbUÆock
(
VTabË
 *
pVTab
){

112183 
sql™e3
 *
	gdb
 = 
pVTab
->
db
;

112185 
as£¹
Ð
db
 );

112186 
as£¹
Ð
pVTab
->
nRef
>0 );

112187 
as£¹
Ð
db
->
magic
==
SQLITE_MAGIC_OPEN
 || db->magic==
SQLITE_MAGIC_ZOMBIE
 );

112189 
	gpVTab
->
	gnRef
--;

112190 ifÐ
	gpVTab
->
	gnRef
==0 ){

112191 
sql™e3_vb
 *
p
 = 
pVTab
->
pVb
;

112192 ifÐ
	gp
 ){

112193 
	gp
->
	gpModuË
->
xDiscÚÃù
(
p
);

112195 
sql™e3DbF»e
(
db
, 
pVTab
);

112206 
VTabË
 *
vbDiscÚÃùAÎ
(
sql™e3
 *
db
, 
TabË
 *
p
){

112207 
VTabË
 *
	gpR‘
 = 0;

112208 
VTabË
 *
	gpVTabË
 = 
p
->
pVTabË
;

112209 
	gp
->
	gpVTabË
 = 0;

112217 
as£¹
Ð
db
==0 || 
sql™e3SchemaMu‹xH–d
(db, 0, 
p
->
pSchema
) );

112219  
	gpVTabË
 ){

112220 
sql™e3
 *
	gdb2
 = 
pVTabË
->
db
;

112221 
VTabË
 *
	gpNext
 = 
pVTabË
->
pNext
;

112222 
as£¹
Ð
db2
 );

112223 ifÐ
	gdb2
==
db
 ){

112224 
pR‘
 = 
pVTabË
;

112225 
	gp
->
	gpVTabË
 = 
pR‘
;

112226 
	gpR‘
->
	gpNext
 = 0;

112228 
	gpVTabË
->
	gpNext
 = 
db2
->
pDiscÚÃù
;

112229 
	gdb2
->
	gpDiscÚÃù
 = 
pVTabË
;

112231 
	gpVTabË
 = 
pNext
;

112234 
as£¹
Ð!
db
 || 
pR‘
 );

112235  
	gpR‘
;

112246 
SQLITE_PRIVATE
 
sql™e3VbDiscÚÃù
(
sql™e3
 *
db
, 
TabË
 *
p
){

112247 
VTabË
 **
	gµVTab
;

112249 
as£¹
Ð
IsVœtu®
(
p
) );

112250 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

112251 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

112253 
	gµVTab
=&
p
->
pVTabË
; *µVTab;…pVTab=&(*
µVTab
)->
pNext
){

112254 ifÐ(*
µVTab
)->
db
==db ){

112255 
VTabË
 *
pVTab
 = *
µVTab
;

112256 *
	gµVTab
 = 
pVTab
->
pNext
;

112257 
sql™e3VbUÆock
(
pVTab
);

112284 
SQLITE_PRIVATE
 
sql™e3VbUÆockLi¡
(
sql™e3
 *
db
){

112285 
VTabË
 *
	gp
 = 
db
->
pDiscÚÃù
;

112286 
	gdb
->
	gpDiscÚÃù
 = 0;

112288 
as£¹
Ð
sql™e3BŒ“HÞdsAÎMu‹xes
(
db
) );

112289 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

112291 ifÐ
	gp
 ){

112292 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

112294 
VTabË
 *
	gpNext
 = 
p
->
pNext
;

112295 
sql™e3VbUÆock
(
p
);

112296 
	gp
 = 
pNext
;

112297 } 
	gp
 );

112315 
SQLITE_PRIVATE
 
sql™e3VbCË¬
(
sql™e3
 *
db
, 
TabË
 *
p
){

112316 ifÐ!
	gdb
 || db->
	g²By‹sF»ed
==0 ) 
vbDiscÚÃùAÎ
(0, 
p
);

112317 ifÐ
	gp
->
	gazModuËArg
 ){

112318 
	gi
;

112319 
	gi
=0; i<
	gp
->
	gnModuËArg
; i++){

112320 ifÐ
	gi
!=1 ) 
sql™e3DbF»e
(
db
, 
p
->
azModuËArg
[
i
]);

112322 
sql™e3DbF»e
(
db
, 
p
->
azModuËArg
);

112332 
addModuËArgum’t
(
sql™e3
 *
db
, 
TabË
 *
pTabË
, *
zArg
){

112333 
	gi
 = 
pTabË
->
nModuËArg
++;

112334 
	gnBy‹s
 = (*)*(1+
pTabË
->
nModuËArg
);

112335 **
	gazModuËArg
;

112336 
	gazModuËArg
 = 
sql™e3DbR—Îoc
(
db
, 
pTabË
->
azModuËArg
, 
nBy‹s
);

112337 ifÐ
	gazModuËArg
==0 ){

112338 
j
;

112339 
	gj
=0; j<
	gi
; j++){

112340 
sql™e3DbF»e
(
db
, 
pTabË
->
azModuËArg
[
j
]);

112342 
sql™e3DbF»e
(
db
, 
zArg
);

112343 
sql™e3DbF»e
(
db
, 
pTabË
->
azModuËArg
);

112344 
	gpTabË
->
	gnModuËArg
 = 0;

112346 
	gazModuËArg
[
i
] = 
zArg
;

112347 
	gazModuËArg
[
i
+1] = 0;

112349 
	gpTabË
->
	gazModuËArg
 = 
azModuËArg
;

112357 
SQLITE_PRIVATE
 
sql™e3VbBegšP¬£
(

112358 
P¬£
 *
pP¬£
,

112359 
Tok’
 *
pName1
,

112360 
Tok’
 *
pName2
,

112361 
Tok’
 *
pModuËName
,

112362 
ifNÙExi¡s


112364 
	giDb
;

112365 
TabË
 *
	gpTabË
;

112366 
sql™e3
 *
	gdb
;

112368 
sql™e3S¹TabË
(
pP¬£
, 
pName1
, 
pName2
, 0, 0, 1, 
ifNÙExi¡s
);

112369 
	gpTabË
 = 
pP¬£
->
pNewTabË
;

112370 ifÐ
	gpTabË
==0 ) ;

112371 
as£¹
Ð0==
pTabË
->
pIndex
 );

112373 
	gdb
 = 
pP¬£
->
db
;

112374 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTabË
->
pSchema
);

112375 
as£¹
Ð
iDb
>=0 );

112377 
	gpTabË
->
	gbFÏgs
 |ð
TF_Vœtu®
;

112378 
	gpTabË
->
	gnModuËArg
 = 0;

112379 
addModuËArgum’t
(
db
, 
pTabË
, 
sql™e3NameFromTok’
(db, 
pModuËName
));

112380 
addModuËArgum’t
(
db
, 
pTabË
, 0);

112381 
addModuËArgum’t
(
db
, 
pTabË
, 
sql™e3DbSŒDup
(db,…TabË->
zName
));

112382 
	gpP¬£
->
	gsNameTok’
.
	gn
 = ()(&
pModuËName
->
z
[pModuËName->
n
] - 
pName1
->z);

112384 #iâdeà
SQLITE_OMIT_AUTHORIZATION


112390 ifÐ
	gpTabË
->
	gazModuËArg
 ){

112391 
sql™e3AuthCheck
(
pP¬£
, 
SQLITE_CREATE_VTABLE
, 
pTabË
->
zName
,

112392 
pTabË
->
azModuËArg
[0], 
pP¬£
->
db
->
aDb
[
iDb
].
zName
);

112402 
addArgum’tToVb
(
P¬£
 *
pP¬£
){

112403 ifÐ
	gpP¬£
->
	gsArg
.
	gz
 &&…P¬£->
	gpNewTabË
 ){

112404 cÚ¡ *
	gz
 = (cÚ¡ *)
pP¬£
->
sArg
.
z
;

112405 
	gn
 = 
pP¬£
->
sArg
.
n
;

112406 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

112407 
addModuËArgum’t
(
db
, 
pP¬£
->
pNewTabË
, 
sql™e3DbSŒNDup
(db, 
z
, 
n
));

112415 
SQLITE_PRIVATE
 
sql™e3VbFšishP¬£
(
P¬£
 *
pP¬£
, 
Tok’
 *
pEnd
){

112416 
TabË
 *
	gpTab
 = 
pP¬£
->
pNewTabË
;

112417 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

112419 ifÐ
	gpTab
==0 ) ;

112420 
addArgum’tToVb
(
pP¬£
);

112421 
	gpP¬£
->
	gsArg
.
	gz
 = 0;

112422 ifÐ
	gpTab
->
	gnModuËArg
<1 ) ;

112430 ifÐ!
	gdb
->
	gš™
.
	gbusy
 ){

112431 *
	gzStmt
;

112432 *
	gzWh”e
;

112433 
	giDb
;

112434 
Vdbe
 *
	gv
;

112437 ifÐ
	gpEnd
 ){

112438 
	gpP¬£
->
	gsNameTok’
.
	gn
 = ()(
pEnd
->
z
 - 
pP¬£
->
sNameTok’
.zè+…End->
n
;

112440 
	gzStmt
 = 
sql™e3MPrštf
(
db
, "CREATE VIRTUAL TABLE %T", &
pP¬£
->
sNameTok’
);

112450 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

112451 
sql™e3Ne¡edP¬£
(
pP¬£
,

112455 
db
->
aDb
[
iDb
].
zName
, 
SCHEMA_TABLE
(iDb),

112456 
pTab
->
zName
,

112457 
pTab
->
zName
,

112458 
zStmt
,

112459 
pP¬£
->
»gRowid


112461 
sql™e3DbF»e
(
db
, 
zStmt
);

112462 
	gv
 = 
sql™e3G‘Vdbe
(
pP¬£
);

112463 
sql™e3ChªgeCook›
(
pP¬£
, 
iDb
);

112465 
sql™e3VdbeAddOp2
(
v
, 
OP_Expœe
, 0, 0);

112466 
	gzWh”e
 = 
sql™e3MPrštf
(
db
, "Çme='%q' ANDy³='bË'", 
pTab
->
zName
);

112467 
sql™e3VdbeAddP¬£SchemaOp
(
v
, 
iDb
, 
zWh”e
);

112468 
sql™e3VdbeAddOp4
(
v
, 
OP_VC»©e
, 
iDb
, 0, 0,

112469 
pTab
->
zName
, 
sql™e3SŒËn30
(pTab->zName) + 1);

112478 
TabË
 *
	gpOld
;

112479 
Schema
 *
	gpSchema
 = 
pTab
->
pSchema
;

112480 cÚ¡ *
	gzName
 = 
pTab
->
zName
;

112481 
as£¹
Ð
sql™e3SchemaMu‹xH–d
(
db
, 0, 
pSchema
) );

112482 
	gpOld
 = 
sql™e3HashIn£¹
(&
pSchema
->
tblHash
, 
zName
, 
pTab
);

112483 ifÐ
	gpOld
 ){

112484 
	gdb
->
	gm®locFažed
 = 1;

112485 
as£¹
Ð
pTab
==
pOld
 );

112488 
	gpP¬£
->
	gpNewTabË
 = 0;

112496 
SQLITE_PRIVATE
 
sql™e3VbArgIn™
(
P¬£
 *
pP¬£
){

112497 
addArgum’tToVb
(
pP¬£
);

112498 
	gpP¬£
->
	gsArg
.
	gz
 = 0;

112499 
	gpP¬£
->
	gsArg
.
	gn
 = 0;

112506 
SQLITE_PRIVATE
 
sql™e3VbArgEx‹nd
(
P¬£
 *
pP¬£
, 
Tok’
 *
p
){

112507 
Tok’
 *
	gpArg
 = &
pP¬£
->
sArg
;

112508 ifÐ
	gpArg
->
	gz
==0 ){

112509 
pArg
->
z
 = 
p
->z;

112510 
	gpArg
->
	gn
 = 
p
->
n
;

112512 
as£¹
(
pArg
->
z
 < 
p
->z);

112513 
	gpArg
->
	gn
 = ()(&
p
->
z
[p->
n
] - 
pArg
->z);

112522 
vbC®lCÚ¡ruùÜ
(

112523 
sql™e3
 *
db
,

112524 
TabË
 *
pTab
,

112525 
ModuË
 *
pMod
,

112526 (*
xCÚ¡ruù
)(
sql™e3
*,*,,cÚ¡ *cÚ¡*,
sql™e3_vb
**,**),

112527 **
pzE¼


112529 
VbCtx
 
	gsCtx
, *
	gpPriÜCtx
;

112530 
VTabË
 *
	gpVTabË
;

112531 
	grc
;

112532 cÚ¡ *cÚ¡*
	gazArg
 = (cÚ¡ *cÚ¡*)
pTab
->
azModuËArg
;

112533 
	gnArg
 = 
pTab
->
nModuËArg
;

112534 *
	gzE¼
 = 0;

112535 *
	gzModuËName
 = 
sql™e3MPrštf
(
db
, "%s", 
pTab
->
zName
);

112536 
	giDb
;

112538 ifÐ!
	gzModuËName
 ){

112539  
	gSQLITE_NOMEM
;

112542 
	gpVTabË
 = 
sql™e3DbM®locZ”o
(
db
, (
VTabË
));

112543 ifÐ!
	gpVTabË
 ){

112544 
sql™e3DbF»e
(
db
, 
zModuËName
);

112545  
	gSQLITE_NOMEM
;

112547 
	gpVTabË
->
	gdb
 = 
db
;

112548 
	gpVTabË
->
	gpMod
 = 
pMod
;

112550 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

112551 
	gpTab
->
	gazModuËArg
[1] = 
db
->
aDb
[
iDb
].
zName
;

112554 
as£¹
Ð&
db
->
pVbCtx
 );

112555 
as£¹
Ð
xCÚ¡ruù
 );

112556 
	gsCtx
.
	gpTab
 = 
pTab
;

112557 
	gsCtx
.
	gpVTabË
 = 
pVTabË
;

112558 
	gpPriÜCtx
 = 
db
->
pVbCtx
;

112559 
	gdb
->
	gpVbCtx
 = &
sCtx
;

112560 
	grc
 = 
xCÚ¡ruù
(
db
, 
pMod
->
pAux
, 
nArg
, 
azArg
, &
pVTabË
->
pVb
, &
zE¼
);

112561 
	gdb
->
	gpVbCtx
 = 
pPriÜCtx
;

112562 ifÐ
	grc
==
SQLITE_NOMEM
 ) 
db
->
m®locFažed
 = 1;

112564 ifÐ
	gSQLITE_OK
!=
rc
 ){

112565 ifÐ
zE¼
==0 ){

112566 *
pzE¼
 = 
sql™e3MPrštf
(
db
, "vbË cÚ¡ruùÜ fažed: %s", 
zModuËName
);

112568 *
	gpzE¼
 = 
sql™e3MPrštf
(
db
, "%s", 
zE¼
);

112569 
sql™e3_ä“
(
zE¼
);

112571 
sql™e3DbF»e
(
db
, 
pVTabË
);

112572 }ifÐ
ALWAYS
(
pVTabË
->
pVb
) ){

112575 
mem£t
(
pVTabË
->
pVb
, 0, (pVTable->pVtab[0]));

112576 
	gpVTabË
->
	gpVb
->
	gpModuË
 = 
pMod
->
pModuË
;

112577 
	gpVTabË
->
	gnRef
 = 1;

112578 ifÐ
	gsCtx
.
	gpTab
 ){

112579 cÚ¡ *
	gzFÜm©
 = "vtable constructor did‚ot declare schema: %s";

112580 *
	gpzE¼
 = 
sql™e3MPrštf
(
db
, 
zFÜm©
, 
pTab
->
zName
);

112581 
sql™e3VbUÆock
(
pVTabË
);

112582 
	grc
 = 
SQLITE_ERROR
;

112584 
	giCÞ
;

112590 
	gpVTabË
->
	gpNext
 = 
pTab
->
pVTabË
;

112591 
	gpTab
->
	gpVTabË
 = 
pVTabË
;

112593 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞ
; iCol++){

112594 *
	gzTy³
 = 
pTab
->
aCÞ
[
iCÞ
].
zTy³
;

112595 
	gnTy³
;

112596 
	gi
 = 0;

112597 ifÐ!
	gzTy³
 ) ;

112598 
	gnTy³
 = 
sql™e3SŒËn30
(
zTy³
);

112599 ifÐ
sql™e3SŒNICmp
("hidd’", 
zTy³
, 6)||(
	gzTy³
[6] && zType[6]!=' ') ){

112600 
i
=0; 
	gi
<
	gnTy³
; i++){

112601 ifÐ(0==
sql™e3SŒNICmp
(" hidd’", &
zTy³
[
i
], 7))

112602 && (
	gzTy³
[
i
+7]=='\0' || 
zTy³
[i+7]==' ')

112604 
i
++;

112609 ifÐ
	gi
<
	gnTy³
 ){

112610 
	gj
;

112611 
	gnD–
 = 6 + (
zTy³
[
i
+6] ? 1 : 0);

112612 
	gj
=
i
; (j+
	gnD–
)<=
nTy³
; j++){

112613 
	gzTy³
[
j
] = 
zTy³
[j+
nD–
];

112615 ifÐ
	gzTy³
[
i
]=='\0' && i>0 ){

112616 
as£¹
(
zTy³
[
i
-1]==' ');

112617 
	gzTy³
[
i
-1] = '\0';

112619 
	gpTab
->
	gaCÞ
[
iCÞ
].
	gcÞFÏgs
 |ð
COLFLAG_HIDDEN
;

112625 
sql™e3DbF»e
(
db
, 
zModuËName
);

112626  
	grc
;

112636 
SQLITE_PRIVATE
 
sql™e3VbC®lCÚÃù
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

112637 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

112638 cÚ¡ *
	gzMod
;

112639 
ModuË
 *
	gpMod
;

112640 
	grc
;

112642 
as£¹
Ð
pTab
 );

112643 ifÐ(
	gpTab
->
	gbFÏgs
 & 
	gTF_Vœtu®
)==0 || 
sql™e3G‘VTabË
(
db
, 
pTab
) ){

112644  
	gSQLITE_OK
;

112648 
	gzMod
 = 
pTab
->
azModuËArg
[0];

112649 
	gpMod
 = (
ModuË
*)
sql™e3HashFšd
(&
db
->
aModuË
, 
zMod
);

112651 ifÐ!
	gpMod
 ){

112652 cÚ¡ *
	gzModuË
 = 
pTab
->
azModuËArg
[0];

112653 
sql™e3E¼ÜMsg
(
pP¬£
, "nØsuch moduË: %s", 
zModuË
);

112654 
	grc
 = 
SQLITE_ERROR
;

112656 *
	gzE¼
 = 0;

112657 
	grc
 = 
vbC®lCÚ¡ruùÜ
(
db
, 
pTab
, 
pMod
,…Mod->
pModuË
->
xCÚÃù
, &
zE¼
);

112658 ifÐ
	grc
!=
SQLITE_OK
 ){

112659 
sql™e3E¼ÜMsg
(
pP¬£
, "%s", 
zE¼
);

112661 
sql™e3DbF»e
(
db
, 
zE¼
);

112664  
	grc
;

112670 
growVT¿ns
(
sql™e3
 *
db
){

112671 cÚ¡ 
	gARRAY_INCR
 = 5;

112674 ifÐ(
	gdb
->
	gnVT¿ns
%
	gARRAY_INCR
)==0 ){

112675 
VTabË
 **
aVT¿ns
;

112676 
	gnBy‹s
 = (
sql™e3_vb
 *è* (
db
->
nVT¿ns
 + 
ARRAY_INCR
);

112677 
	gaVT¿ns
 = 
sql™e3DbR—Îoc
(
db
, (*)db->
aVT¿ns
, 
nBy‹s
);

112678 ifÐ!
	gaVT¿ns
 ){

112679  
	gSQLITE_NOMEM
;

112681 
mem£t
(&
aVT¿ns
[
db
->
nVT¿ns
], 0, (
sql™e3_vb
 *)*
ARRAY_INCR
);

112682 
	gdb
->
	gaVT¿ns
 = 
aVT¿ns
;

112685  
	gSQLITE_OK
;

112692 
addToVT¿ns
(
sql™e3
 *
db
, 
VTabË
 *
pVTab
){

112694 
	gdb
->
	gaVT¿ns
[
db
->
nVT¿ns
++] = 
pVTab
;

112695 
sql™e3VbLock
(
pVTab
);

112706 
SQLITE_PRIVATE
 
sql™e3VbC®lC»©e
(
sql™e3
 *
db
, 
iDb
, cÚ¡ *
zTab
, **
pzE¼
){

112707 
	grc
 = 
SQLITE_OK
;

112708 
TabË
 *
	gpTab
;

112709 
ModuË
 *
	gpMod
;

112710 cÚ¡ *
	gzMod
;

112712 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zTab
, db->
aDb
[
iDb
].
zName
);

112713 
as£¹
Ð
pTab
 && (pTab->
bFÏgs
 & 
TF_Vœtu®
)!=0 && !pTab->
pVTabË
 );

112716 
	gzMod
 = 
pTab
->
azModuËArg
[0];

112717 
	gpMod
 = (
ModuË
*)
sql™e3HashFšd
(&
db
->
aModuË
, 
zMod
);

112723 ifÐ!
	gpMod
 ){

112724 *
	gpzE¼
 = 
sql™e3MPrštf
(
db
, "nØsuch moduË: %s", 
zMod
);

112725 
	grc
 = 
SQLITE_ERROR
;

112727 
	grc
 = 
vbC®lCÚ¡ruùÜ
(
db
, 
pTab
, 
pMod
,…Mod->
pModuË
->
xC»©e
, 
pzE¼
);

112732 ifÐ
	grc
==
SQLITE_OK
 && 
ALWAYS
(
sql™e3G‘VTabË
(
db
, 
pTab
)) ){

112733 
	grc
 = 
growVT¿ns
(
db
);

112734 ifÐ
	grc
==
SQLITE_OK
 ){

112735 
addToVT¿ns
(
db
, 
sql™e3G‘VTabË
(db, 
pTab
));

112739  
	grc
;

112747 
SQLITE_API
 
sql™e3_deþ¬e_vb
(
sql™e3
 *
db
, cÚ¡ *
zC»©eTabË
){

112748 
P¬£
 *
	gpP¬£
;

112750 
	grc
 = 
SQLITE_OK
;

112751 
TabË
 *
	gpTab
;

112752 *
	gzE¼
 = 0;

112754 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

112755 ifÐ!
	gdb
->
	gpVbCtx
 || !(
	gpTab
 = 
db
->
pVbCtx
->
pTab
) ){

112756 
sql™e3E¼Ü
(
db
, 
SQLITE_MISUSE
);

112757 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

112758  
	gSQLITE_MISUSE_BKPT
;

112760 
as£¹
Ð(
pTab
->
bFÏgs
 & 
TF_Vœtu®
)!=0 );

112762 
	gpP¬£
 = 
sql™e3SckAÎocZ”o
(
db
, (*
pP¬£
));

112763 ifÐ
	gpP¬£
==0 ){

112764 
rc
 = 
SQLITE_NOMEM
;

112766 
	gpP¬£
->
	gdeþ¬eVb
 = 1;

112767 
	gpP¬£
->
	gdb
 = 
db
;

112768 
	gpP¬£
->
	gnQu”yLoÝ
 = 1;

112770 ifÐ
	gSQLITE_OK
==
sql™e3RunP¬£r
(
pP¬£
, 
zC»©eTabË
, &
zE¼
)

112771 && 
	gpP¬£
->
	gpNewTabË


112772 && !
	gdb
->
	gm®locFažed


112773 && !
	gpP¬£
->
	gpNewTabË
->
	gpS–eù


112774 && (
	gpP¬£
->
	gpNewTabË
->
	gbFÏgs
 & 
	gTF_Vœtu®
)==0

112776 ifÐ!
pTab
->
aCÞ
 ){

112777 
pTab
->
aCÞ
 = 
pP¬£
->
pNewTabË
->aCol;

112778 
	gpTab
->
	gnCÞ
 = 
pP¬£
->
pNewTabË
->
nCÞ
;

112779 
	gpP¬£
->
	gpNewTabË
->
	gnCÞ
 = 0;

112780 
	gpP¬£
->
	gpNewTabË
->
	gaCÞ
 = 0;

112782 
	gdb
->
	gpVbCtx
->
	gpTab
 = 0;

112784 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_ERROR
, (
zE¼
 ? "%s" : 0), zErr);

112785 
sql™e3DbF»e
(
db
, 
zE¼
);

112786 
	grc
 = 
SQLITE_ERROR
;

112788 
	gpP¬£
->
	gdeþ¬eVb
 = 0;

112790 ifÐ
	gpP¬£
->
	gpVdbe
 ){

112791 
sql™e3VdbeFš®ize
(
pP¬£
->
pVdbe
);

112793 
sql™e3D–‘eTabË
(
db
, 
pP¬£
->
pNewTabË
);

112794 
sql™e3P¬£rRe£t
(
pP¬£
);

112795 
sql™e3SckF»e
(
db
, 
pP¬£
);

112798 
as£¹
Ð(
rc
&0xff)==rc );

112799 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

112800 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

112801  
	grc
;

112811 
SQLITE_PRIVATE
 
sql™e3VbC®lDe¡roy
(
sql™e3
 *
db
, 
iDb
, cÚ¡ *
zTab
){

112812 
	grc
 = 
SQLITE_OK
;

112813 
TabË
 *
	gpTab
;

112815 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zTab
, db->
aDb
[
iDb
].
zName
);

112816 ifÐ
ALWAYS
(
pTab
!=0 &&…Tab->
pVTabË
!=0) ){

112817 
VTabË
 *
p
 = 
vbDiscÚÃùAÎ
(
db
, 
pTab
);

112819 
as£¹
Ð
rc
==
SQLITE_OK
 );

112820 
	grc
 = 
p
->
pMod
->
pModuË
->
xDe¡roy
Õ->
pVb
);

112823 ifÐ
	grc
==
SQLITE_OK
 ){

112824 
as£¹
Ð
pTab
->
pVTabË
==
p
 &&…->
pNext
==0 );

112825 
	gp
->
	gpVb
 = 0;

112826 
	gpTab
->
	gpVTabË
 = 0;

112827 
sql™e3VbUÆock
(
p
);

112831  
	grc
;

112842 
ÿÎFš®i£r
(
sql™e3
 *
db
, 
off£t
){

112843 
	gi
;

112844 ifÐ
	gdb
->
	gaVT¿ns
 ){

112845 
	gi
=0; i<
	gdb
->
	gnVT¿ns
; i++){

112846 
VTabË
 *
	gpVTab
 = 
db
->
aVT¿ns
[
i
];

112847 
sql™e3_vb
 *
	gp
 = 
pVTab
->
pVb
;

112848 ifÐ
	gp
 ){

112849 (*
	gx
)(
	gsql™e3_vb
 *);

112850 
	gx
 = *((**)(
sql™e3_vb
 *))((*)
p
->
pModuË
 + 
off£t
);

112851 ifÐ
	gx
 ) 
x
(
p
);

112853 
	gpVTab
->
	giSav•ošt
 = 0;

112854 
sql™e3VbUÆock
(
pVTab
);

112856 
sql™e3DbF»e
(
db
, db->
aVT¿ns
);

112857 
	gdb
->
	gnVT¿ns
 = 0;

112858 
	gdb
->
	gaVT¿ns
 = 0;

112869 
SQLITE_PRIVATE
 
sql™e3VbSync
(
sql™e3
 *
db
, 
Vdbe
 *
p
){

112870 
	gi
;

112871 
	grc
 = 
SQLITE_OK
;

112872 
VTabË
 **
	gaVT¿ns
 = 
db
->
aVT¿ns
;

112874 
	gdb
->
	gaVT¿ns
 = 0;

112875 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nVT¿ns
; i++){

112876 (*
	gx
)(
	gsql™e3_vb
 *);

112877 
sql™e3_vb
 *
	gpVb
 = 
aVT¿ns
[
i
]->
pVb
;

112878 ifÐ
	gpVb
 && (
	gx
 = 
pVb
->
pModuË
->
xSync
)!=0 ){

112879 
rc
 = 
x
(
pVb
);

112880 
sql™e3VbImpÜtE¼msg
(
p
, 
pVb
);

112883 
	gdb
->
	gaVT¿ns
 = 
aVT¿ns
;

112884  
	grc
;

112891 
SQLITE_PRIVATE
 
sql™e3VbRÞlback
(
sql™e3
 *
db
){

112892 
ÿÎFš®i£r
(
db
, 
off£tof
(
sql™e3_moduË
,
xRÞlback
));

112893  
	gSQLITE_OK
;

112900 
SQLITE_PRIVATE
 
sql™e3VbComm™
(
sql™e3
 *
db
){

112901 
ÿÎFš®i£r
(
db
, 
off£tof
(
sql™e3_moduË
,
xComm™
));

112902  
	gSQLITE_OK
;

112913 
SQLITE_PRIVATE
 
sql™e3VbBegš
(
sql™e3
 *
db
, 
VTabË
 *
pVTab
){

112914 
	grc
 = 
SQLITE_OK
;

112915 cÚ¡ 
sql™e3_moduË
 *
	gpModuË
;

112922 ifÐ
sql™e3VbInSync
(
db
) ){

112923  
	gSQLITE_LOCKED
;

112925 ifÐ!
	gpVTab
 ){

112926  
	gSQLITE_OK
;

112928 
	gpModuË
 = 
pVTab
->
pVb
->
pModuË
;

112930 ifÐ
	gpModuË
->
	gxBegš
 ){

112931 
	gi
;

112934 
	gi
=0; i<
	gdb
->
	gnVT¿ns
; i++){

112935 ifÐ
	gdb
->
	gaVT¿ns
[
i
]==
pVTab
 ){

112936  
SQLITE_OK
;

112942 
	grc
 = 
growVT¿ns
(
db
);

112943 ifÐ
	grc
==
SQLITE_OK
 ){

112944 
rc
 = 
pModuË
->
xBegš
(
pVTab
->
pVb
);

112945 ifÐ
	grc
==
SQLITE_OK
 ){

112946 
addToVT¿ns
(
db
, 
pVTab
);

112950  
	grc
;

112968 
SQLITE_PRIVATE
 
sql™e3VbSav•ošt
(
sql™e3
 *
db
, 
Ý
, 
iSav•ošt
){

112969 
	grc
 = 
SQLITE_OK
;

112971 
as£¹
Ð
Ý
==
SAVEPOINT_RELEASE
||Ý==
SAVEPOINT_ROLLBACK
||Ý==
SAVEPOINT_BEGIN
 );

112972 
as£¹
Ð
iSav•ošt
>=0 );

112973 ifÐ
	gdb
->
	gaVT¿ns
 ){

112974 
	gi
;

112975 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
db
->
nVT¿ns
; i++){

112976 
VTabË
 *
	gpVTab
 = 
db
->
aVT¿ns
[
i
];

112977 cÚ¡ 
sql™e3_moduË
 *
	gpMod
 = 
pVTab
->
pMod
->
pModuË
;

112978 ifÐ
	gpVTab
->
	gpVb
 && 
	gpMod
->
	giV”siÚ
>=2 ){

112979 (*
xM‘hod
)(
sql™e3_vb
 *, );

112980  
	gÝ
 ){

112981 
	gSAVEPOINT_BEGIN
:

112982 
xM‘hod
 = 
pMod
->
xSav•ošt
;

112983 
	gpVTab
->
	giSav•ošt
 = 
iSav•ošt
+1;

112985 
	gSAVEPOINT_ROLLBACK
:

112986 
xM‘hod
 = 
pMod
->
xRÞlbackTo
;

112989 
xM‘hod
 = 
pMod
->
xR–—£
;

112992 ifÐ
	gxM‘hod
 && 
	gpVTab
->
	giSav•ošt
>iSavepoint ){

112993 
	grc
 = 
xM‘hod
(
pVTab
->
pVb
, 
iSav•ošt
);

112998  
	grc
;

113014 
SQLITE_PRIVATE
 
FuncDef
 *
sql™e3VbOv”lßdFunùiÚ
(

113015 
sql™e3
 *
db
,

113016 
FuncDef
 *
pDef
,

113017 
nArg
,

113018 
Ex´
 *
pEx´


113020 
TabË
 *
	gpTab
;

113021 
sql™e3_vb
 *
	gpVb
;

113022 
sql™e3_moduË
 *
	gpMod
;

113023 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**) = 0;

113024 *
	gpArg
 = 0;

113025 
FuncDef
 *
	gpNew
;

113026 
	grc
 = 0;

113027 *
	gzLow”Name
;

113028 *
	gz
;

113032 ifÐ
NEVER
(
pEx´
==0èè 
pDef
;

113033 ifÐ
	gpEx´
->
	gÝ
!=
TK_COLUMN
 )  
pDef
;

113034 
	gpTab
 = 
pEx´
->
pTab
;

113035 ifÐ
NEVER
(
pTab
==0èè 
pDef
;

113036 ifÐ(
	gpTab
->
	gbFÏgs
 & 
	gTF_Vœtu®
)==0 )  
pDef
;

113037 
	gpVb
 = 
sql™e3G‘VTabË
(
db
, 
pTab
)->pVtab;

113038 
as£¹
Ð
pVb
!=0 );

113039 
as£¹
Ð
pVb
->
pModuË
!=0 );

113040 
	gpMod
 = (
sql™e3_moduË
 *)
pVb
->
pModuË
;

113041 ifÐ
	gpMod
->
	gxFšdFunùiÚ
==0 )  
pDef
;

113046 
	gzLow”Name
 = 
sql™e3DbSŒDup
(
db
, 
pDef
->
zName
);

113047 ifÐ
	gzLow”Name
 ){

113048 
	gz
=(*)
zLow”Name
; *z; z++){

113049 *
	gz
 = 
sql™e3Uµ”ToLow”
[*
z
];

113051 
	grc
 = 
pMod
->
xFšdFunùiÚ
(
pVb
, 
nArg
, 
zLow”Name
, &
xFunc
, &
pArg
);

113052 
sql™e3DbF»e
(
db
, 
zLow”Name
);

113054 ifÐ
	grc
==0 ){

113055  
pDef
;

113060 
	gpNew
 = 
sql™e3DbM®locZ”o
(
db
, (*
pNew
)

113061 + 
sql™e3SŒËn30
(
pDef
->
zName
) + 1);

113062 ifÐ
	gpNew
==0 ){

113063  
pDef
;

113065 *
	gpNew
 = *
pDef
;

113066 
	gpNew
->
	gzName
 = (*)&
pNew
[1];

113067 
memýy
(
pNew
->
zName
, 
pDef
->zName, 
sql™e3SŒËn30
(pDef->zName)+1);

113068 
	gpNew
->
	gxFunc
 = 
xFunc
;

113069 
	gpNew
->
	gpU£rD©a
 = 
pArg
;

113070 
	gpNew
->
	gfuncFÏgs
 |ð
SQLITE_FUNC_EPHEM
;

113071  
	gpNew
;

113080 
SQLITE_PRIVATE
 
sql™e3VbMakeWr™abË
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
){

113081 
P¬£
 *
	gpTÝËv–
 = 
sql™e3P¬£TÝËv–
(
pP¬£
);

113082 
	gi
, 
	gn
;

113083 
TabË
 **
	g­VbLock
;

113085 
as£¹
Ð
IsVœtu®
(
pTab
) );

113086 
	gi
=0; i<
	gpTÝËv–
->
	gnVbLock
; i++){

113087 ifÐ
	gpTab
==
pTÝËv–
->
­VbLock
[
i
] ) ;

113089 
	gn
 = (
pTÝËv–
->
nVbLock
+1)*ÕTÝËv–->
­VbLock
[0]);

113090 
	g­VbLock
 = 
sql™e3_»®loc
(
pTÝËv–
->
­VbLock
, 
n
);

113091 ifÐ
	g­VbLock
 ){

113092 
	gpTÝËv–
->
	g­VbLock
 = 
­VbLock
;

113093 
	gpTÝËv–
->
	g­VbLock
[
pTÝËv–
->
nVbLock
++] = 
pTab
;

113095 
	gpTÝËv–
->
	gdb
->
	gm®locFažed
 = 1;

113106 
SQLITE_API
 
sql™e3_vb_Ú_cÚæiù
(
sql™e3
 *
db
){

113107 cÚ¡ 
	gaM­
[] = {

113108 
SQLITE_ROLLBACK
, 
SQLITE_ABORT
, 
SQLITE_FAIL
, 
SQLITE_IGNORE
, 
SQLITE_REPLACE


113110 
as£¹
Ð
OE_RÞlback
==1 && 
OE_AbÜt
==2 && 
OE_Faž
==3 );

113111 
as£¹
Ð
OE_IgnÜe
==4 && 
OE_R•Ïû
==5 );

113112 
as£¹
Ð
db
->
vbOnCÚæiù
>=1 && db->vtabOnConflict<=5 );

113113  ()
	gaM­
[
db
->
vbOnCÚæiù
-1];

113121 
SQLITE_API
 
sql™e3_vb_cÚfig
(
sql™e3
 *
db
, 
Ý
, ...){

113122 
va_li¡
 
	g­
;

113123 
	grc
 = 
SQLITE_OK
;

113125 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

113127 
va_¡¬t
(
­
, 
Ý
);

113128  
	gÝ
 ){

113129 
	gSQLITE_VTAB_CONSTRAINT_SUPPORT
: {

113130 
VbCtx
 *
p
 = 
db
->
pVbCtx
;

113131 ifÐ!
	gp
 ){

113132 
	grc
 = 
SQLITE_MISUSE_BKPT
;

113134 
as£¹
Ð
p
->
pTab
==0 || (p->pTab->
bFÏgs
 & 
TF_Vœtu®
)!=0 );

113135 
	gp
->
	gpVTabË
->
	gbCÚ¡¿št
 = (
u8
)
va_¬g
(
­
, );

113140 
rc
 = 
SQLITE_MISUSE_BKPT
;

113143 
va_’d
(
­
);

113145 ifÐ
	grc
!=
SQLITE_OK
 ) 
sql™e3E¼Ü
(
db
, 
rc
);

113146 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

113147  
	grc
;

113194 #ià
defšed
(
SQLITE_TEST
è|| defšed(
SQLITE_DEBUG
)

113195  
	gsql™e3Wh”eT¿û
 = 0;

113197 #ià
defšed
(
SQLITE_DEBUG
) \

113198 && (
defšed
(
SQLITE_TEST
è|| defšed(
SQLITE_ENABLE_WHERETRACE
))

113199 
	#WHERETRACE
(
K
,
X
èif(
sql™e3Wh”eT¿û
&(K)è
sql™e3DebugPrštf
 
	)
X

113200 
	#WHERETRACE_ENABLED
 1

	)

113202 
	#WHERETRACE
(
K
,
X
)

	)

113207 
Wh”eCÏu£
 
	tWh”eCÏu£
;

113208 
Wh”eMaskS‘
 
	tWh”eMaskS‘
;

113209 
Wh”eOrInfo
 
	tWh”eOrInfo
;

113210 
Wh”eAndInfo
 
	tWh”eAndInfo
;

113211 
Wh”eLev–
 
	tWh”eLev–
;

113212 
Wh”eLoÝ
 
	tWh”eLoÝ
;

113213 
Wh”eP©h
 
	tWh”eP©h
;

113214 
Wh”eT”m
 
	tWh”eT”m
;

113215 
Wh”eLoÝBužd”
 
	tWh”eLoÝBužd”
;

113216 
Wh”eSÿn
 
	tWh”eSÿn
;

113217 
Wh”eOrCo¡
 
	tWh”eOrCo¡
;

113218 
Wh”eOrS‘
 
	tWh”eOrS‘
;

113235 
	sWh”eLev–
 {

113236 
	giLeáJoš
;

113237 
	giTabCur
;

113238 
	giIdxCur
;

113239 
	gaddrBrk
;

113240 
	gaddrNxt
;

113241 
	gaddrSk
;

113242 
	gaddrCÚt
;

113243 
	gaddrFœ¡
;

113244 
	gaddrBody
;

113245 
u8
 
	giFrom
;

113246 
u8
 
	gÝ
, 
	gp3
, 
	gp5
;

113247 
	gp1
, 
	gp2
;

113250 
	gnIn
;

113251 
	sInLoÝ
 {

113252 
	giCur
;

113253 
	gaddrInTÝ
;

113254 
u8
 
	geEndLoÝOp
;

113255 } *
	gaInLoÝ
;

113256 } 
	gš
;

113257 
Index
 *
	gpCovidx
;

113258 } 
	gu
;

113259 
Wh”eLoÝ
 *
	gpWLoÝ
;

113260 
B™mask
 
	gnÙR—dy
;

113277 
	sWh”eLoÝ
 {

113278 
B™mask
 
	g´”eq
;

113279 
B™mask
 
	gmaskS–f
;

113280 #ifdeà
SQLITE_DEBUG


113281 
	gcId
;

113283 
u8
 
	giTab
;

113284 
u8
 
	giSÜtIdx
;

113285 
LogE¡
 
	grS‘up
;

113286 
LogE¡
 
	grRun
;

113287 
LogE¡
 
	gnOut
;

113290 
u16
 
	gnEq
;

113291 
u16
 
	gnSk
;

113292 
Index
 *
	gpIndex
;

113293 } 
	gbŒ“
;

113295 
	gidxNum
;

113296 
u8
 
	gÃedF»e
;

113297 
i8
 
	gisOrd”ed
;

113298 
u16
 
	gom™Mask
;

113299 *
	gidxSŒ
;

113300 } 
	gvb
;

113301 } 
	gu
;

113302 
u32
 
	gwsFÏgs
;

113303 
u16
 
	gnLT”m
;

113305 
	#WHERE_LOOP_XFER_SZ
 
	`off£tof
(
Wh”eLoÝ
,
nLSlÙ
)

	)

113306 
u16
 
	gnLSlÙ
;

113307 
Wh”eT”m
 **
	gaLT”m
;

113308 
Wh”eLoÝ
 *
	gpNextLoÝ
;

113309 
Wh”eT”m
 *
	gaLT”mS·û
[4];

113316 
	sWh”eOrCo¡
 {

113317 
B™mask
 
	g´”eq
;

113318 
LogE¡
 
	grRun
;

113319 
LogE¡
 
	gnOut
;

113326 
	#N_OR_COST
 3

	)

113327 
	sWh”eOrS‘
 {

113328 
u16
 
	gn
;

113329 
Wh”eOrCo¡
 
	ga
[
N_OR_COST
];

113334 
wh”eLoÝResize
(
sql™e3
*, 
Wh”eLoÝ
*, );

113354 
	sWh”eP©h
 {

113355 
B™mask
 
	gmaskLoÝ
;

113356 
B™mask
 
	g»vLoÝ
;

113357 
LogE¡
 
	gnRow
;

113358 
LogE¡
 
	grCo¡
;

113359 
LogE¡
 
	grUnsÜ‹d
;

113360 
i8
 
	gisOrd”ed
;

113361 
Wh”eLoÝ
 **
	gaLoÝ
;

113415 
	sWh”eT”m
 {

113416 
Ex´
 *
	gpEx´
;

113417 
	giP¬’t
;

113418 
	gËáCursÜ
;

113420 
	gËáCÞumn
;

113421 
Wh”eOrInfo
 *
	gpOrInfo
;

113422 
Wh”eAndInfo
 *
	gpAndInfo
;

113423 } 
	gu
;

113424 
LogE¡
 
	gŒuthProb
;

113425 
u16
 
	geO³¿tÜ
;

113426 
u8
 
	gwtFÏgs
;

113427 
u8
 
	gnChžd
;

113428 
Wh”eCÏu£
 *
	gpWC
;

113429 
B™mask
 
	g´”eqRight
;

113430 
B™mask
 
	g´”eqAÎ
;

113436 
	#TERM_DYNAMIC
 0x01

	)

113437 
	#TERM_VIRTUAL
 0x02

	)

113438 
	#TERM_CODED
 0x04

	)

113439 
	#TERM_COPIED
 0x08

	)

113440 
	#TERM_ORINFO
 0x10

	)

113441 
	#TERM_ANDINFO
 0x20

	)

113442 
	#TERM_OR_OK
 0x40

	)

113443 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


113444 
	#TERM_VNULL
 0x80

	)

113446 
	#TERM_VNULL
 0x00

	)

113453 
	sWh”eSÿn
 {

113454 
Wh”eCÏu£
 *
	gpOrigWC
;

113455 
Wh”eCÏu£
 *
	gpWC
;

113456 *
	gzCÞlName
;

113457 
	gidxaff
;

113458 
	gnEquiv
;

113459 
	giEquiv
;

113460 
u32
 
	gÝMask
;

113461 
	gk
;

113462 
	gaEquiv
[22];

113477 
	sWh”eCÏu£
 {

113478 
Wh”eInfo
 *
	gpWInfo
;

113479 
Wh”eCÏu£
 *
	gpOu‹r
;

113480 
u8
 
	gÝ
;

113481 
	gnT”m
;

113482 
	gnSlÙ
;

113483 
Wh”eT”m
 *
	ga
;

113484 #ià
defšed
(
SQLITE_SMALL_STACK
)

113485 
Wh”eT”m
 
	gaStic
[1];

113487 
Wh”eT”m
 
	gaStic
[8];

113495 
	sWh”eOrInfo
 {

113496 
Wh”eCÏu£
 
	gwc
;

113497 
B™mask
 
	gšdexabË
;

113504 
	sWh”eAndInfo
 {

113505 
Wh”eCÏu£
 
	gwc
;

113534 
	sWh”eMaskS‘
 {

113535 
	gn
;

113536 
	gix
[
BMS
];

113543 
	sWh”eLoÝBužd”
 {

113544 
Wh”eInfo
 *
	gpWInfo
;

113545 
Wh”eCÏu£
 *
	gpWC
;

113546 
Ex´Li¡
 *
	gpOrd”By
;

113547 
Wh”eLoÝ
 *
	gpNew
;

113548 
Wh”eOrS‘
 *
	gpOrS‘
;

113549 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


113550 
UÅackedRecÜd
 *
	gpRec
;

113551 
	gnRecV®id
;

113565 
	sWh”eInfo
 {

113566 
P¬£
 *
	gpP¬£
;

113567 
SrcLi¡
 *
	gpTabLi¡
;

113568 
Ex´Li¡
 *
	gpOrd”By
;

113569 
Ex´Li¡
 *
	gpResuÉS‘
;

113570 
Wh”eLoÝ
 *
	gpLoÝs
;

113571 
B™mask
 
	g»vMask
;

113572 
LogE¡
 
	gnRowOut
;

113573 
u16
 
	gwù¾FÏgs
;

113574 
i8
 
	gnOBS©
;

113575 
u8
 
	gsÜ‹d
;

113576 
u8
 
	gokOÃPass
;

113577 
u8
 
	guÁe¡edT”ms
;

113578 
u8
 
	geDi¡šù
;

113579 
u8
 
	gnLev–
;

113580 
	giTÝ
;

113581 
	giCÚtšue
;

113582 
	giB»ak
;

113583 
	g§vedNQu”yLoÝ
;

113584 
	gaiCurOÃPass
[2];

113585 
Wh”eMaskS‘
 
	gsMaskS‘
;

113586 
Wh”eCÏu£
 
	gsWC
;

113587 
Wh”eLev–
 
	ga
[1];

113596 
	#WO_IN
 0x001

	)

113597 
	#WO_EQ
 0x002

	)

113598 
	#WO_LT
 (
WO_EQ
<<(
TK_LT
-
TK_EQ
))

	)

113599 
	#WO_LE
 (
WO_EQ
<<(
TK_LE
-
TK_EQ
))

	)

113600 
	#WO_GT
 (
WO_EQ
<<(
TK_GT
-
TK_EQ
))

	)

113601 
	#WO_GE
 (
WO_EQ
<<(
TK_GE
-
TK_EQ
))

	)

113602 
	#WO_MATCH
 0x040

	)

113603 
	#WO_ISNULL
 0x080

	)

113604 
	#WO_OR
 0x100

	)

113605 
	#WO_AND
 0x200

	)

113606 
	#WO_EQUIV
 0x400

	)

113607 
	#WO_NOOP
 0x800

	)

113609 
	#WO_ALL
 0xffà

	)

113610 
	#WO_SINGLE
 0x0fà

	)

113617 
	#WHERE_COLUMN_EQ
 0x00000001

	)

113618 
	#WHERE_COLUMN_RANGE
 0x00000002

	)

113619 
	#WHERE_COLUMN_IN
 0x00000004

	)

113620 
	#WHERE_COLUMN_NULL
 0x00000008

	)

113621 
	#WHERE_CONSTRAINT
 0x0000000à

	)

113622 
	#WHERE_TOP_LIMIT
 0x00000010

	)

113623 
	#WHERE_BTM_LIMIT
 0x00000020

	)

113624 
	#WHERE_BOTH_LIMIT
 0x00000030

	)

113625 
	#WHERE_IDX_ONLY
 0x00000040

	)

113626 
	#WHERE_IPK
 0x00000100

	)

113627 
	#WHERE_INDEXED
 0x00000200

	)

113628 
	#WHERE_VIRTUALTABLE
 0x00000400

	)

113629 
	#WHERE_IN_ABLE
 0x00000800

	)

113630 
	#WHERE_ONEROW
 0x00001000

	)

113631 
	#WHERE_MULTI_OR
 0x00002000

	)

113632 
	#WHERE_AUTO_INDEX
 0x00004000

	)

113633 
	#WHERE_SKIPSCAN
 0x00008000

	)

113634 
	#WHERE_UNQ_WANTED
 0x00010000

	)

113642 
SQLITE_PRIVATE
 
u64
 
sql™e3Wh”eOuutRowCouÁ
(
Wh”eInfo
 *
pWInfo
){

113643  
sql™e3LogE¡ToIÁ
(
pWInfo
->
nRowOut
);

113650 
SQLITE_PRIVATE
 
sql™e3Wh”eIsDi¡šù
(
Wh”eInfo
 *
pWInfo
){

113651  
	gpWInfo
->
	geDi¡šù
;

113658 
SQLITE_PRIVATE
 
sql™e3Wh”eIsOrd”ed
(
Wh”eInfo
 *
pWInfo
){

113659  
	gpWInfo
->
	gnOBS©
;

113666 
SQLITE_PRIVATE
 
sql™e3Wh”eCÚtšueLab–
(
Wh”eInfo
 *
pWInfo
){

113667 
as£¹
Ð
pWInfo
->
iCÚtšue
!=0 );

113668  
	gpWInfo
->
	giCÚtšue
;

113675 
SQLITE_PRIVATE
 
sql™e3Wh”eB»akLab–
(
Wh”eInfo
 *
pWInfo
){

113676  
	gpWInfo
->
	giB»ak
;

113694 
SQLITE_PRIVATE
 
sql™e3Wh”eOkOÃPass
(
Wh”eInfo
 *
pWInfo
, *
aiCur
){

113695 
memýy
(
aiCur
, 
pWInfo
->
aiCurOÃPass
, ()*2);

113696  
	gpWInfo
->
	gokOÃPass
;

113702 
wh”eOrMove
(
Wh”eOrS‘
 *
pDe¡
, Wh”eOrS‘ *
pSrc
){

113703 
	gpDe¡
->
	gn
 = 
pSrc
->
n
;

113704 
memýy
(
pDe¡
->
a
, 
pSrc
->a,…De¡->
n
*(pDest->a[0]));

113714 
wh”eOrIn£¹
(

113715 
Wh”eOrS‘
 *
pS‘
,

113716 
B™mask
 
´”eq
,

113717 
LogE¡
 
rRun
,

113718 
LogE¡
 
nOut


113720 
u16
 
	gi
;

113721 
Wh”eOrCo¡
 *
	gp
;

113722 
	gi
=
pS‘
->
n
, 
	gp
õS‘->
a
; i>0; i--,…++){

113723 ifÐ
	grRun
<=
p
->
rRun
 && (
´”eq
 &…->prereq)==prereq ){

113724 
wh”eOrIn£¹_dÚe
;

113726 ifÐ
	gp
->
	grRun
<=
rRun
 && (
p
->
´”eq
 &…rereq)==p->prereq ){

113730 ifÐ
	gpS‘
->
	gn
<
	gN_OR_COST
 ){

113731 
	gp
 = &
pS‘
->
a
[pS‘->
n
++];

113732 
	gp
->
	gnOut
 = 
nOut
;

113734 
	gp
 = 
pS‘
->
a
;

113735 
	gi
=1; i<
	gpS‘
->
	gn
; i++){

113736 ifÐ
	gp
->
	grRun
>
	gpS‘
->
	ga
[
i
].rRuÀè°ð
pS‘
->
a
 + i;

113738 ifÐ
	gp
->
	grRun
<=
rRun
 )  0;

113740 
	gwh”eOrIn£¹_dÚe
:

113741 
p
->
´”eq
 =…rereq;

113742 
	gp
->
	grRun
 = 
rRun
;

113743 ifÐ
	gp
->
	gnOut
>nOuˆèp->nOuˆð
nOut
;

113750 
wh”eCÏu£In™
(

113751 
Wh”eCÏu£
 *
pWC
,

113752 
Wh”eInfo
 *
pWInfo


113754 
	gpWC
->
	gpWInfo
 = 
pWInfo
;

113755 
	gpWC
->
	gpOu‹r
 = 0;

113756 
	gpWC
->
	gnT”m
 = 0;

113757 
	gpWC
->
	gnSlÙ
 = 
A¼aySize
(
pWC
->
aStic
);

113758 
	gpWC
->
	ga
 = 
pWC
->
aStic
;

113762 
wh”eCÏu£CË¬
(
Wh”eCÏu£
*);

113767 
wh”eOrInfoD–‘e
(
sql™e3
 *
db
, 
Wh”eOrInfo
 *
p
){

113768 
wh”eCÏu£CË¬
(&
p
->
wc
);

113769 
sql™e3DbF»e
(
db
, 
p
);

113775 
wh”eAndInfoD–‘e
(
sql™e3
 *
db
, 
Wh”eAndInfo
 *
p
){

113776 
wh”eCÏu£CË¬
(&
p
->
wc
);

113777 
sql™e3DbF»e
(
db
, 
p
);

113784 
wh”eCÏu£CË¬
(
Wh”eCÏu£
 *
pWC
){

113785 
	gi
;

113786 
Wh”eT”m
 *
	ga
;

113787 
sql™e3
 *
	gdb
 = 
pWC
->
pWInfo
->
pP¬£
->
db
;

113788 
	gi
=
pWC
->
nT”m
-1, 
	ga
õWC->
a
; i>=0; i--,‡++){

113789 ifÐ
	ga
->
	gwtFÏgs
 & 
	gTERM_DYNAMIC
 ){

113790 
sql™e3Ex´D–‘e
(
db
, 
a
->
pEx´
);

113792 ifÐ
	ga
->
	gwtFÏgs
 & 
	gTERM_ORINFO
 ){

113793 
wh”eOrInfoD–‘e
(
db
, 
a
->
u
.
pOrInfo
);

113794 }ifÐ
	ga
->
	gwtFÏgs
 & 
	gTERM_ANDINFO
 ){

113795 
wh”eAndInfoD–‘e
(
db
, 
a
->
u
.
pAndInfo
);

113798 ifÐ
	gpWC
->
	ga
!=
pWC
->
aStic
 ){

113799 
sql™e3DbF»e
(
db
, 
pWC
->
a
);

113822 
wh”eCÏu£In£¹
(
Wh”eCÏu£
 *
pWC
, 
Ex´
 *
p
, 
u8
 
wtFÏgs
){

113823 
Wh”eT”m
 *
	gpT”m
;

113824 
	gidx
;

113825 
‹¡ÿ£
Ð
wtFÏgs
 & 
TERM_VIRTUAL
 );

113826 ifÐ
	gpWC
->
	gnT”m
>=
pWC
->
nSlÙ
 ){

113827 
Wh”eT”m
 *
pOld
 = 
pWC
->
a
;

113828 
sql™e3
 *
	gdb
 = 
pWC
->
pWInfo
->
pP¬£
->
db
;

113829 
	gpWC
->
	ga
 = 
sql™e3DbM®locRaw
(
db
, (
pWC
->
a
[0])*pWC->
nSlÙ
*2 );

113830 ifÐ
	gpWC
->
	ga
==0 ){

113831 ifÐ
wtFÏgs
 & 
TERM_DYNAMIC
 ){

113832 
sql™e3Ex´D–‘e
(
db
, 
p
);

113834 
	gpWC
->
	ga
 = 
pOld
;

113837 
memýy
(
pWC
->
a
, 
pOld
, ÕWC->a[0])*pWC->
nT”m
);

113838 ifÐ
	gpOld
!=
pWC
->
aStic
 ){

113839 
sql™e3DbF»e
(
db
, 
pOld
);

113841 
	gpWC
->
	gnSlÙ
 = 
sql™e3DbM®locSize
(
db
, 
pWC
->
a
)/ÕWC->
	ga
[0]);

113843 
	gpT”m
 = &
pWC
->
a
[
idx
 =…WC->
nT”m
++];

113844 ifÐ
	gp
 && 
Ex´HasPrÝ”ty
(
p
, 
EP_UÆik–y
) ){

113845 
	gpT”m
->
	gŒuthProb
 = 
sql™e3LogE¡
(
p
->
iTabË
) - 99;

113847 
	gpT”m
->
	gŒuthProb
 = 1;

113849 
	gpT”m
->
	gpEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
p
);

113850 
	gpT”m
->
	gwtFÏgs
 = 
wtFÏgs
;

113851 
	gpT”m
->
	gpWC
 = 
pWC
;

113852 
	gpT”m
->
	giP¬’t
 = -1;

113853  
	gidx
;

113873 
wh”eS¶™
(
Wh”eCÏu£
 *
pWC
, 
Ex´
 *
pEx´
, 
u8
 
Ý
){

113874 
	gpWC
->
	gÝ
 = 
Ý
;

113875 ifÐ
	gpEx´
==0 ) ;

113876 ifÐ
	gpEx´
->
	gÝ
!=
Ý
 ){

113877 
wh”eCÏu£In£¹
(
pWC
, 
pEx´
, 0);

113879 
wh”eS¶™
(
pWC
, 
pEx´
->
pLeá
, 
Ý
);

113880 
wh”eS¶™
(
pWC
, 
pEx´
->
pRight
, 
Ý
);

113887 
	#š™MaskS‘
(
P
è(P)->
n
=0

	)

113893 
B™mask
 
g‘Mask
(
Wh”eMaskS‘
 *
pMaskS‘
, 
iCursÜ
){

113894 
	gi
;

113895 
as£¹
Ð
pMaskS‘
->
n
<=()(
B™mask
)*8 );

113896 
	gi
=0; i<
	gpMaskS‘
->
	gn
; i++){

113897 ifÐ
	gpMaskS‘
->
	gix
[
i
]==
iCursÜ
 ){

113898  
MASKBIT
(
i
);

113912 
ü—‹Mask
(
Wh”eMaskS‘
 *
pMaskS‘
, 
iCursÜ
){

113913 
as£¹
Ð
pMaskS‘
->
n
 < 
A¼aySize
ÕMaskS‘->
ix
) );

113914 
	gpMaskS‘
->
	gix
[
pMaskS‘
->
n
++] = 
iCursÜ
;

113922 
B™mask
 
ex´Li¡TabËU§ge
(
Wh”eMaskS‘
*, 
Ex´Li¡
*);

113923 
B™mask
 
ex´S–eùTabËU§ge
(
Wh”eMaskS‘
*, 
S–eù
*);

113924 
B™mask
 
ex´TabËU§ge
(
Wh”eMaskS‘
 *
pMaskS‘
, 
Ex´
 *
p
){

113925 
B™mask
 
	gmask
 = 0;

113926 ifÐ
	gp
==0 )  0;

113927 ifÐ
	gp
->
	gÝ
==
TK_COLUMN
 ){

113928 
mask
 = 
g‘Mask
(
pMaskS‘
, 
p
->
iTabË
);

113929  
	gmask
;

113931 
	gmask
 = 
ex´TabËU§ge
(
pMaskS‘
, 
p
->
pRight
);

113932 
	gmask
 |ð
ex´TabËU§ge
(
pMaskS‘
, 
p
->
pLeá
);

113933 ifÐ
Ex´HasPrÝ”ty
(
p
, 
EP_xIsS–eù
) ){

113934 
	gmask
 |ð
ex´S–eùTabËU§ge
(
pMaskS‘
, 
p
->
x
.
pS–eù
);

113936 
	gmask
 |ð
ex´Li¡TabËU§ge
(
pMaskS‘
, 
p
->
x
.
pLi¡
);

113938  
	gmask
;

113940 
B™mask
 
ex´Li¡TabËU§ge
(
Wh”eMaskS‘
 *
pMaskS‘
, 
Ex´Li¡
 *
pLi¡
){

113941 
	gi
;

113942 
B™mask
 
	gmask
 = 0;

113943 ifÐ
	gpLi¡
 ){

113944 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

113945 
	gmask
 |ð
ex´TabËU§ge
(
pMaskS‘
, 
pLi¡
->
a
[
i
].
pEx´
);

113948  
	gmask
;

113950 
B™mask
 
ex´S–eùTabËU§ge
(
Wh”eMaskS‘
 *
pMaskS‘
, 
S–eù
 *
pS
){

113951 
B™mask
 
	gmask
 = 0;

113952  
	gpS
 ){

113953 
SrcLi¡
 *
	gpSrc
 = 
pS
->
pSrc
;

113954 
	gmask
 |ð
ex´Li¡TabËU§ge
(
pMaskS‘
, 
pS
->
pELi¡
);

113955 
	gmask
 |ð
ex´Li¡TabËU§ge
(
pMaskS‘
, 
pS
->
pGroupBy
);

113956 
	gmask
 |ð
ex´Li¡TabËU§ge
(
pMaskS‘
, 
pS
->
pOrd”By
);

113957 
	gmask
 |ð
ex´TabËU§ge
(
pMaskS‘
, 
pS
->
pWh”e
);

113958 
	gmask
 |ð
ex´TabËU§ge
(
pMaskS‘
, 
pS
->
pHavšg
);

113959 ifÐ
ALWAYS
(
pSrc
!=0) ){

113960 
i
;

113961 
	gi
=0; i<
	gpSrc
->
	gnSrc
; i++){

113962 
	gmask
 |ð
ex´S–eùTabËU§ge
(
pMaskS‘
, 
pSrc
->
a
[
i
].
pS–eù
);

113963 
	gmask
 |ð
ex´TabËU§ge
(
pMaskS‘
, 
pSrc
->
a
[
i
].
pOn
);

113966 
	gpS
 = 
pS
->
pPriÜ
;

113968  
	gmask
;

113976 
®lowedOp
(
Ý
){

113977 
as£¹
Ð
TK_GT
>
TK_EQ
 && TK_GT<
TK_GE
 );

113978 
as£¹
Ð
TK_LT
>
TK_EQ
 && TK_LT<
TK_GE
 );

113979 
as£¹
Ð
TK_LE
>
TK_EQ
 && TK_LE<
TK_GE
 );

113980 
as£¹
Ð
TK_GE
==
TK_EQ
+4 );

113981  
	gÝ
==
TK_IN
 || (
Ý
>=
TK_EQ
 && op<=
TK_GE
è|| op==
TK_ISNULL
;

113996 
ex´Commu‹
(
P¬£
 *
pP¬£
, 
Ex´
 *
pEx´
){

113997 
u16
 
	gexpRight
 = (
pEx´
->
pRight
->
æags
 & 
EP_CÞÏ‹
);

113998 
u16
 
	gexpLeá
 = (
pEx´
->
pLeá
->
æags
 & 
EP_CÞÏ‹
);

113999 
as£¹
Ð
®lowedOp
(
pEx´
->
Ý
è&&…Ex´->Ý!=
TK_IN
 );

114000 ifÐ
	gexpRight
==
expLeá
 ){

114002 ifÐ
expRight
 ){

114005 
pEx´
->
pRight
->
æags
 &ð~
EP_CÞÏ‹
;

114006 }ifÐ
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pEx´
->
pLeá
)!=0 ){

114010 
pEx´
->
pLeá
->
æags
 |ð
EP_CÞÏ‹
;

114013 
SWAP
(
Ex´
*,
pEx´
->
pRight
,pEx´->
pLeá
);

114014 ifÐ
	gpEx´
->
	gÝ
>=
TK_GT
 ){

114015 
as£¹
Ð
TK_LT
==
TK_GT
+2 );

114016 
as£¹
Ð
TK_GE
==
TK_LE
+2 );

114017 
as£¹
Ð
TK_GT
>
TK_EQ
 );

114018 
as£¹
Ð
TK_GT
<
TK_LE
 );

114019 
as£¹
Ð
pEx´
->
Ý
>=
TK_GT
 &&…Ex´->Ý<=
TK_GE
 );

114020 
	gpEx´
->
	gÝ
 = ((
pEx´
->
Ý
-
TK_GT
)^2)+TK_GT;

114027 
u16
 
Ý”©ÜMask
(
Ý
){

114028 
u16
 
	gc
;

114029 
as£¹
Ð
®lowedOp
(
Ý
) );

114030 ifÐ
	gÝ
==
TK_IN
 ){

114031 
c
 = 
WO_IN
;

114032 }ifÐ
	gÝ
==
TK_ISNULL
 ){

114033 
c
 = 
WO_ISNULL
;

114035 
as£¹
Ð(
WO_EQ
<<(
Ý
-
TK_EQ
)) < 0x7fff );

114036 
	gc
 = (
u16
)(
WO_EQ
<<(
Ý
-
TK_EQ
));

114038 
as£¹
Ð
Ý
!=
TK_ISNULL
 || 
c
==
WO_ISNULL
 );

114039 
as£¹
Ð
Ý
!=
TK_IN
 || 
c
==
WO_IN
 );

114040 
as£¹
Ð
Ý
!=
TK_EQ
 || 
c
==
WO_EQ
 );

114041 
as£¹
Ð
Ý
!=
TK_LT
 || 
c
==
WO_LT
 );

114042 
as£¹
Ð
Ý
!=
TK_LE
 || 
c
==
WO_LE
 );

114043 
as£¹
Ð
Ý
!=
TK_GT
 || 
c
==
WO_GT
 );

114044 
as£¹
Ð
Ý
!=
TK_GE
 || 
c
==
WO_GE
 );

114045  
	gc
;

114053 
Wh”eT”m
 *
wh”eSÿnNext
(
Wh”eSÿn
 *
pSÿn
){

114054 
	giCur
;

114055 
	giCÞumn
;

114056 
Ex´
 *
	gpX
;

114057 
Wh”eCÏu£
 *
	gpWC
;

114058 
Wh”eT”m
 *
	gpT”m
;

114059 
	gk
 = 
pSÿn
->
k
;

114061  
	gpSÿn
->
	giEquiv
<=
pSÿn
->
nEquiv
 ){

114062 
iCur
 = 
pSÿn
->
aEquiv
[pSÿn->
iEquiv
-2];

114063 
	giCÞumn
 = 
pSÿn
->
aEquiv
[pSÿn->
iEquiv
-1];

114064  (
	gpWC
 = 
pSÿn
->
pWC
)!=0 ){

114065 
pT”m
=
pWC
->
a
+
k
; 
	gk
<
	gpWC
->
	gnT”m
; k++, 
	gpT”m
++){

114066 ifÐ
	gpT”m
->
	gËáCursÜ
==
iCur


114067 && 
pT”m
->
u
.
ËáCÞumn
==
iCÞumn


114068 && (
pSÿn
->
iEquiv
<=2 || !
Ex´HasPrÝ”ty
(
pT”m
->
pEx´
, 
EP_FromJoš
))

114070 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_EQUIV
)!=0

114071 && 
pSÿn
->
nEquiv
<
A¼aySize
ÕSÿn->
aEquiv
)

114073 
j
;

114074 
	gpX
 = 
sql™e3Ex´SkCÞÏ‹
(
pT”m
->
pEx´
->
pRight
);

114075 
as£¹
Ð
pX
->
Ý
==
TK_COLUMN
 );

114076 
	gj
=0; j<
	gpSÿn
->
	gnEquiv
; j+=2){

114077 ifÐ
pSÿn
->
aEquiv
[
j
]==
pX
->
iTabË


114078 && 
pSÿn
->
aEquiv
[
j
+1]==
pX
->
iCÞumn
 ){

114082 ifÐ
	gj
==
pSÿn
->
nEquiv
 ){

114083 
pSÿn
->
aEquiv
[
j
] = 
pX
->
iTabË
;

114084 
	gpSÿn
->
	gaEquiv
[
j
+1] = 
pX
->
iCÞumn
;

114085 
	gpSÿn
->
	gnEquiv
 += 2;

114088 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gpSÿn
->
	gÝMask
)!=0 ){

114090 ifÐ
pSÿn
->
zCÞlName
 && (
pT”m
->
eO³¿tÜ
 & 
WO_ISNULL
)==0 ){

114091 
CÞlSeq
 *
pCÞl
;

114092 
P¬£
 *
	gpP¬£
 = 
pWC
->
pWInfo
->
pP¬£
;

114093 
	gpX
 = 
pT”m
->
pEx´
;

114094 ifÐ!
sql™e3IndexAffš™yOk
(
pX
, 
pSÿn
->
idxaff
) ){

114097 
as£¹
(
pX
->
pLeá
);

114098 
	gpCÞl
 = 
sql™e3Bš¬yCom·»CÞlSeq
(
pP¬£
,

114099 
pX
->
pLeá
,…X->
pRight
);

114100 ifÐ
	gpCÞl
==0 ) 
pCÞl
 = 
pP¬£
->
db
->
pDætCÞl
;

114101 ifÐ
sql™e3SŒICmp
(
pCÞl
->
zName
, 
pSÿn
->
zCÞlName
) ){

114105 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_EQ
)!=0

114106 && (
pX
 = 
pT”m
->
pEx´
->
pRight
)->
Ý
==
TK_COLUMN


114107 && 
pX
->
iTabË
==
pSÿn
->
aEquiv
[0]

114108 && 
pX
->
iCÞumn
==
pSÿn
->
aEquiv
[1]

114112 
	gpSÿn
->
	gk
 = 
k
+1;

114113  
	gpT”m
;

114117 
	gpSÿn
->
	gpWC
 = 
pSÿn
->
pWC
->
pOu‹r
;

114118 
	gk
 = 0;

114120 
	gpSÿn
->
	gpWC
 = 
pSÿn
->
pOrigWC
;

114121 
	gk
 = 0;

114122 
	gpSÿn
->
	giEquiv
 += 2;

114143 
Wh”eT”m
 *
wh”eSÿnIn™
(

114144 
Wh”eSÿn
 *
pSÿn
,

114145 
Wh”eCÏu£
 *
pWC
,

114146 
iCur
,

114147 
iCÞumn
,

114148 
u32
 
ÝMask
,

114149 
Index
 *
pIdx


114151 
	gj
;

114154 
	gpSÿn
->
	gpOrigWC
 = 
pWC
;

114155 
	gpSÿn
->
	gpWC
 = 
pWC
;

114156 ifÐ
	gpIdx
 && 
	giCÞumn
>=0 ){

114157 
pSÿn
->
idxaff
 = 
pIdx
->
pTabË
->
aCÞ
[
iCÞumn
].
affš™y
;

114158 
	gj
=0; 
	gpIdx
->
	gaiCÞumn
[
j
]!=
iCÞumn
; j++){

114159 ifÐ
NEVER
(
j
>
pIdx
->
nCÞumn
) )  0;

114161 
	gpSÿn
->
	gzCÞlName
 = 
pIdx
->
azCÞl
[
j
];

114163 
	gpSÿn
->
	gidxaff
 = 0;

114164 
	gpSÿn
->
	gzCÞlName
 = 0;

114166 
	gpSÿn
->
	gÝMask
 = 
ÝMask
;

114167 
	gpSÿn
->
	gk
 = 0;

114168 
	gpSÿn
->
	gaEquiv
[0] = 
iCur
;

114169 
	gpSÿn
->
	gaEquiv
[1] = 
iCÞumn
;

114170 
	gpSÿn
->
	gnEquiv
 = 2;

114171 
	gpSÿn
->
	giEquiv
 = 2;

114172  
wh”eSÿnNext
(
pSÿn
);

114198 
Wh”eT”m
 *
fšdT”m
(

114199 
Wh”eCÏu£
 *
pWC
,

114200 
iCur
,

114201 
iCÞumn
,

114202 
B™mask
 
nÙR—dy
,

114203 
u32
 
Ý
,

114204 
Index
 *
pIdx


114206 
Wh”eT”m
 *
	gpResuÉ
 = 0;

114207 
Wh”eT”m
 *
	gp
;

114208 
Wh”eSÿn
 
	gsÿn
;

114210 
	gp
 = 
wh”eSÿnIn™
(&
sÿn
, 
pWC
, 
iCur
, 
iCÞumn
, 
Ý
, 
pIdx
);

114211  
	gp
 ){

114212 ifÐ(
	gp
->
	g´”eqRight
 & 
	gnÙR—dy
)==0 ){

114213 ifÐ
p
->
´”eqRight
==0 && (p->
eO³¿tÜ
&
WO_EQ
)!=0 ){

114214  
p
;

114216 ifÐ
	gpResuÉ
==0 ) 
pResuÉ
 = 
p
;

114218 
	gp
 = 
wh”eSÿnNext
(&
sÿn
);

114220  
	gpResuÉ
;

114224 
ex´AÇlyze
(
SrcLi¡
*, 
Wh”eCÏu£
*, );

114229 
ex´AÇlyzeAÎ
(

114230 
SrcLi¡
 *
pTabLi¡
,

114231 
Wh”eCÏu£
 *
pWC


114233 
	gi
;

114234 
	gi
=
pWC
->
nT”m
-1; i>=0; i--){

114235 
ex´AÇlyze
(
pTabLi¡
, 
pWC
, 
i
);

114239 #iâdeà
SQLITE_OMIT_LIKE_OPTIMIZATION


114248 
isLikeOrGlob
(

114249 
P¬£
 *
pP¬£
,

114250 
Ex´
 *
pEx´
,

114251 
Ex´
 **
µP»fix
,

114252 *
pisCom¶‘e
,

114253 *
²oCa£


114255 cÚ¡ *
	gz
 = 0;

114256 
Ex´
 *
	gpRight
, *
	gpLeá
;

114257 
Ex´Li¡
 *
	gpLi¡
;

114258 
	gc
;

114259 
	gút
;

114260 
	gwc
[3];

114261 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

114262 
sql™e3_v®ue
 *
	gpV®
 = 0;

114263 
	gÝ
;

114265 ifÐ!
sql™e3IsLikeFunùiÚ
(
db
, 
pEx´
, 
²oCa£
, 
wc
) ){

114268 #ifdeà
SQLITE_EBCDIC


114269 ifÐ*
	g²oCa£
 )  0;

114271 
	gpLi¡
 = 
pEx´
->
x
.
pLi¡
;

114272 
	gpLeá
 = 
pLi¡
->
a
[1].
pEx´
;

114273 ifÐ
	gpLeá
->
	gÝ
!=
TK_COLUMN


114274 || 
sql™e3Ex´Affš™y
(
pLeá
)!=
SQLITE_AFF_TEXT


114275 || 
IsVœtu®
(
pLeá
->
pTab
)

114281 
as£¹
Ð
pLeá
->
iCÞumn
!=(-1) );

114283 
	gpRight
 = 
sql™e3Ex´SkCÞÏ‹
(
pLi¡
->
a
[0].
pEx´
);

114284 
	gÝ
 = 
pRight
->
Ý
;

114285 ifÐ
	gÝ
==
TK_VARIABLE
 ){

114286 
Vdbe
 *
pR•»·»
 = 
pP¬£
->pReprepare;

114287 
	giCÞ
 = 
pRight
->
iCÞumn
;

114288 
	gpV®
 = 
sql™e3VdbeG‘BoundV®ue
(
pR•»·»
, 
iCÞ
, 
SQLITE_AFF_NONE
);

114289 ifÐ
	gpV®
 && 
sql™e3_v®ue_ty³
(
pV®
)==
SQLITE_TEXT
 ){

114290 
z
 = (*)
sql™e3_v®ue_‹xt
(
pV®
);

114292 
sql™e3VdbeS‘V¬mask
(
pP¬£
->
pVdbe
, 
iCÞ
);

114293 
as£¹
Ð
pRight
->
Ý
==
TK_VARIABLE
 ||…Right->Ý==
TK_REGISTER
 );

114294 }ifÐ
	gÝ
==
TK_STRING
 ){

114295 
z
 = 
pRight
->
u
.
zTok’
;

114297 ifÐ
	gz
 ){

114298 
	gút
 = 0;

114299  (
	gc
=
z
[
út
])!=0 && 
c
!=
wc
[0] && c!=wc[1] && c!=wc[2] ){

114300 
út
++;

114302 ifÐ
	gút
!=0 && 255!=(
u8
)
z
[
út
-1] ){

114303 
Ex´
 *
pP»fix
;

114304 *
	gpisCom¶‘e
 = 
c
==
wc
[0] && 
z
[
út
+1]==0;

114305 
	gpP»fix
 = 
sql™e3Ex´
(
db
, 
TK_STRING
, 
z
);

114306 ifÐ
	gpP»fix
 )…P»fix->
	gu
.
	gzTok’
[
út
] = 0;

114307 *
	gµP»fix
 = 
pP»fix
;

114308 ifÐ
	gÝ
==
TK_VARIABLE
 ){

114309 
Vdbe
 *
v
 = 
pP¬£
->
pVdbe
;

114310 
sql™e3VdbeS‘V¬mask
(
v
, 
pRight
->
iCÞumn
);

114311 ifÐ*
	gpisCom¶‘e
 && 
	gpRight
->
	gu
.
	gzTok’
[1] ){

114318 
	gr1
 = 
sql™e3G‘TempReg
(
pP¬£
);

114319 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pRight
, 
r1
);

114320 
sql™e3VdbeChªgeP3
(
v
, 
sql™e3VdbeCu¼’tAddr
(v)-1, 0);

114321 
sql™e3R–—£TempReg
(
pP¬£
, 
r1
);

114325 
	gz
 = 0;

114329 
sql™e3V®ueF»e
(
pV®
);

114330  (
	gz
!=0);

114335 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


114343 
isM©chOfCÞumn
(

114344 
Ex´
 *
pEx´


114346 
Ex´Li¡
 *
	gpLi¡
;

114348 ifÐ
	gpEx´
->
	gÝ
!=
TK_FUNCTION
 ){

114351 ifÐ
sql™e3SŒICmp
(
pEx´
->
u
.
zTok’
,"match")!=0 ){

114354 
	gpLi¡
 = 
pEx´
->
x
.
pLi¡
;

114355 ifÐ
	gpLi¡
->
	gnEx´
!=2 ){

114358 ifÐ
	gpLi¡
->
	ga
[1].
	gpEx´
->
	gÝ
 !ð
TK_COLUMN
 ){

114369 
ŒªsãrJošM¬kšgs
(
Ex´
 *
pD”ived
, Ex´ *
pBa£
){

114370 ifÐ
	gpD”ived
 ){

114371 
	gpD”ived
->
	gæags
 |ð
pBa£
->
æags
 & 
EP_FromJoš
;

114372 
	gpD”ived
->
	giRightJošTabË
 = 
pBa£
->
iRightJošTabË
;

114376 #ià!
defšed
(
SQLITE_OMIT_OR_OPTIMIZATION
è&& !defšed(
SQLITE_OMIT_SUBQUERY
)

114453 
ex´AÇlyzeOrT”m
(

114454 
SrcLi¡
 *
pSrc
,

114455 
Wh”eCÏu£
 *
pWC
,

114456 
idxT”m


114458 
Wh”eInfo
 *
	gpWInfo
 = 
pWC
->
pWInfo
;

114459 
P¬£
 *
	gpP¬£
 = 
pWInfo
->
pP¬£
;

114460 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

114461 
Wh”eT”m
 *
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114462 
Ex´
 *
	gpEx´
 = 
pT”m
->
pEx´
;

114463 
	gi
;

114464 
Wh”eCÏu£
 *
	gpOrWc
;

114465 
Wh”eT”m
 *
	gpOrT”m
;

114466 
Wh”eOrInfo
 *
	gpOrInfo
;

114467 
B™mask
 
	gchngToIN
;

114468 
B™mask
 
	gšdexabË
;

114475 
as£¹
Ð(
pT”m
->
wtFÏgs
 & (
TERM_DYNAMIC
|
TERM_ORINFO
|
TERM_ANDINFO
))==0 );

114476 
as£¹
Ð
pEx´
->
Ý
==
TK_OR
 );

114477 
	gpT”m
->
	gu
.
	gpOrInfo
 = 
pOrInfo
 = 
sql™e3DbM®locZ”o
(
db
, (*pOrInfo));

114478 ifÐ
	gpOrInfo
==0 ) ;

114479 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_ORINFO
;

114480 
	gpOrWc
 = &
pOrInfo
->
wc
;

114481 
wh”eCÏu£In™
(
pOrWc
, 
pWInfo
);

114482 
wh”eS¶™
(
pOrWc
, 
pEx´
, 
TK_OR
);

114483 
ex´AÇlyzeAÎ
(
pSrc
, 
pOrWc
);

114484 ifÐ
	gdb
->
	gm®locFažed
 ) ;

114485 
as£¹
Ð
pOrWc
->
nT”m
>=2 );

114490 
	gšdexabË
 = ~(
B™mask
)0;

114491 
	gchngToIN
 = ~(
B™mask
)0;

114492 
	gi
=
pOrWc
->
nT”m
-1, 
	gpOrT”m
õOrWc->
a
; i>=0 && 
šdexabË
; i--,…OrTerm++){

114493 ifÐ(
	gpOrT”m
->
	geO³¿tÜ
 & 
	gWO_SINGLE
)==0 ){

114494 
Wh”eAndInfo
 *
pAndInfo
;

114495 
as£¹
Ð(
pOrT”m
->
wtFÏgs
 & (
TERM_ANDINFO
|
TERM_ORINFO
))==0 );

114496 
	gchngToIN
 = 0;

114497 
	gpAndInfo
 = 
sql™e3DbM®locRaw
(
db
, (*
pAndInfo
));

114498 ifÐ
	gpAndInfo
 ){

114499 
Wh”eCÏu£
 *
	gpAndWC
;

114500 
Wh”eT”m
 *
	gpAndT”m
;

114501 
	gj
;

114502 
B™mask
 
	gb
 = 0;

114503 
	gpOrT”m
->
	gu
.
	gpAndInfo
 = 
pAndInfo
;

114504 
	gpOrT”m
->
	gwtFÏgs
 |ð
TERM_ANDINFO
;

114505 
	gpOrT”m
->
	geO³¿tÜ
 = 
WO_AND
;

114506 
	gpAndWC
 = &
pAndInfo
->
wc
;

114507 
wh”eCÏu£In™
(
pAndWC
, 
pWC
->
pWInfo
);

114508 
wh”eS¶™
(
pAndWC
, 
pOrT”m
->
pEx´
, 
TK_AND
);

114509 
ex´AÇlyzeAÎ
(
pSrc
, 
pAndWC
);

114510 
	gpAndWC
->
	gpOu‹r
 = 
pWC
;

114511 
‹¡ÿ£
Ð
db
->
m®locFažed
 );

114512 ifÐ!
	gdb
->
	gm®locFažed
 ){

114513 
	gj
=0, 
	gpAndT”m
=
pAndWC
->
a
; j<
	gpAndWC
->
	gnT”m
; j++,…AndTerm++){

114514 
as£¹
Ð
pAndT”m
->
pEx´
 );

114515 ifÐ
®lowedOp
(
pAndT”m
->
pEx´
->
Ý
) ){

114516 
	gb
 |ð
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pAndT”m
->
ËáCursÜ
);

114520 
	gšdexabË
 &ð
b
;

114522 }ifÐ
	gpOrT”m
->
	gwtFÏgs
 & 
	gTERM_COPIED
 ){

114526 
B™mask
 
	gb
;

114527 
	gb
 = 
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pOrT”m
->
ËáCursÜ
);

114528 ifÐ
	gpOrT”m
->
	gwtFÏgs
 & 
	gTERM_VIRTUAL
 ){

114529 
Wh”eT”m
 *
	gpOth”
 = &
pOrWc
->
a
[
pOrT”m
->
iP¬’t
];

114530 
	gb
 |ð
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pOth”
->
ËáCursÜ
);

114532 
	gšdexabË
 &ð
b
;

114533 ifÐ(
	gpOrT”m
->
	geO³¿tÜ
 & 
	gWO_EQ
)==0 ){

114534 
chngToIN
 = 0;

114536 
	gchngToIN
 &ð
b
;

114545 
	gpOrInfo
->
	gšdexabË
 = 
šdexabË
;

114546 
	gpT”m
->
	geO³¿tÜ
 = 
šdexabË
==0 ? 0 : 
WO_OR
;

114569 ifÐ
	gchngToIN
 ){

114570 
	gokToChngToIN
 = 0;

114571 
	giCÞumn
 = -1;

114572 
	giCursÜ
 = -1;

114573 
	gj
 = 0;

114581 
	gj
=0; j<2 && !
	gokToChngToIN
; j++){

114582 
	gpOrT”m
 = 
pOrWc
->
a
;

114583 
	gi
=
pOrWc
->
nT”m
-1; i>=0; i--, 
	gpOrT”m
++){

114584 
as£¹
Ð
pOrT”m
->
eO³¿tÜ
 & 
WO_EQ
 );

114585 
	gpOrT”m
->
	gwtFÏgs
 &ð~
TERM_OR_OK
;

114586 ifÐ
	gpOrT”m
->
	gËáCursÜ
==
iCursÜ
 ){

114589 
as£¹
Ð
j
==1 );

114592 ifÐ(
	gchngToIN
 & 
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pOrT”m
->
ËáCursÜ
))==0 ){

114597 
‹¡ÿ£
Ð
pOrT”m
->
wtFÏgs
 & 
TERM_COPIED
 );

114598 
‹¡ÿ£
Ð
pOrT”m
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

114599 
as£¹
Ð
pOrT”m
->
wtFÏgs
 & (
TERM_COPIED
|
TERM_VIRTUAL
) );

114602 
	giCÞumn
 = 
pOrT”m
->
u
.
ËáCÞumn
;

114603 
	giCursÜ
 = 
pOrT”m
->
ËáCursÜ
;

114606 ifÐ
	gi
<0 ){

114609 
as£¹
Ð
j
==1 );

114610 
as£¹
Ð
IsPow”OfTwo
(
chngToIN
) );

114611 
as£¹
Ð
chngToIN
==
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
iCursÜ
) );

114614 
‹¡ÿ£
Ð
j
==1 );

114618 
	gokToChngToIN
 = 1;

114619 ; 
	gi
>=0 && 
okToChngToIN
; i--, 
	gpOrT”m
++){

114620 
as£¹
Ð
pOrT”m
->
eO³¿tÜ
 & 
WO_EQ
 );

114621 ifÐ
	gpOrT”m
->
	gËáCursÜ
!=
iCursÜ
 ){

114622 
pOrT”m
->
wtFÏgs
 &ð~
TERM_OR_OK
;

114623 }ifÐ
	gpOrT”m
->
	gu
.
	gËáCÞumn
!=
iCÞumn
 ){

114624 
okToChngToIN
 = 0;

114626 
	gaffLeá
, 
	gaffRight
;

114631 
	gaffRight
 = 
sql™e3Ex´Affš™y
(
pOrT”m
->
pEx´
->
pRight
);

114632 
	gaffLeá
 = 
sql™e3Ex´Affš™y
(
pOrT”m
->
pEx´
->
pLeá
);

114633 ifÐ
	gaffRight
!=0 && 
affRight
!=
affLeá
 ){

114634 
okToChngToIN
 = 0;

114636 
	gpOrT”m
->
	gwtFÏgs
 |ð
TERM_OR_OK
;

114646 ifÐ
	gokToChngToIN
 ){

114647 
Ex´
 *
	gpDup
;

114648 
Ex´Li¡
 *
	gpLi¡
 = 0;

114649 
Ex´
 *
	gpLeá
 = 0;

114650 
Ex´
 *
	gpNew
;

114652 
	gi
=
pOrWc
->
nT”m
-1, 
	gpOrT”m
õOrWc->
a
; i>=0; i--,…OrTerm++){

114653 ifÐ(
	gpOrT”m
->
	gwtFÏgs
 & 
	gTERM_OR_OK
)==0 ) ;

114654 
as£¹
Ð
pOrT”m
->
eO³¿tÜ
 & 
WO_EQ
 );

114655 
as£¹
Ð
pOrT”m
->
ËáCursÜ
==
iCursÜ
 );

114656 
as£¹
Ð
pOrT”m
->
u
.
ËáCÞumn
==
iCÞumn
 );

114657 
	gpDup
 = 
sql™e3Ex´Dup
(
db
, 
pOrT”m
->
pEx´
->
pRight
, 0);

114658 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pWInfo
->
pP¬£
, 
pLi¡
, 
pDup
);

114659 
	gpLeá
 = 
pOrT”m
->
pEx´
->
pLeá
;

114661 
as£¹
Ð
pLeá
!=0 );

114662 
	gpDup
 = 
sql™e3Ex´Dup
(
db
, 
pLeá
, 0);

114663 
	gpNew
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IN
, 
pDup
, 0, 0);

114664 ifÐ
	gpNew
 ){

114665 
	gidxNew
;

114666 
ŒªsãrJošM¬kšgs
(
pNew
, 
pEx´
);

114667 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pNew
, 
EP_xIsS–eù
) );

114668 
	gpNew
->
	gx
.
	gpLi¡
 = 
pLi¡
;

114669 
	gidxNew
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNew
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114670 
‹¡ÿ£
Ð
idxNew
==0 );

114671 
ex´AÇlyze
(
pSrc
, 
pWC
, 
idxNew
);

114672 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114673 
	gpWC
->
	ga
[
idxNew
].
	giP¬’t
 = 
idxT”m
;

114674 
	gpT”m
->
	gnChžd
 = 1;

114676 
sql™e3Ex´Li¡D–‘e
(
db
, 
pLi¡
);

114678 
	gpT”m
->
	geO³¿tÜ
 = 
WO_NOOP
;

114702 
ex´AÇlyze
(

114703 
SrcLi¡
 *
pSrc
,

114704 
Wh”eCÏu£
 *
pWC
,

114705 
idxT”m


114707 
Wh”eInfo
 *
	gpWInfo
 = 
pWC
->
pWInfo
;

114708 
Wh”eT”m
 *
	gpT”m
;

114709 
Wh”eMaskS‘
 *
	gpMaskS‘
;

114710 
Ex´
 *
	gpEx´
;

114711 
B™mask
 
	g´”eqLeá
;

114712 
B™mask
 
	g´”eqAÎ
;

114713 
B™mask
 
	gexŒaRight
 = 0;

114714 
Ex´
 *
	gpSŒ1
 = 0;

114715 
	gisCom¶‘e
 = 0;

114716 
	gnoCa£
 = 0;

114717 
	gÝ
;

114718 
P¬£
 *
	gpP¬£
 = 
pWInfo
->
pP¬£
;

114719 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

114721 ifÐ
	gdb
->
	gm®locFažed
 ){

114724 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114725 
	gpMaskS‘
 = &
pWInfo
->
sMaskS‘
;

114726 
	gpEx´
 = 
pT”m
->
pEx´
;

114727 
as£¹
Ð
pEx´
->
Ý
!=
TK_AS
 &&…Ex´->Ý!=
TK_COLLATE
 );

114728 
	g´”eqLeá
 = 
ex´TabËU§ge
(
pMaskS‘
, 
pEx´
->
pLeá
);

114729 
	gÝ
 = 
pEx´
->
Ý
;

114730 ifÐ
	gÝ
==
TK_IN
 ){

114731 
as£¹
Ð
pEx´
->
pRight
==0 );

114732 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

114733 
	gpT”m
->
	g´”eqRight
 = 
ex´S–eùTabËU§ge
(
pMaskS‘
, 
pEx´
->
x
.
pS–eù
);

114735 
	gpT”m
->
	g´”eqRight
 = 
ex´Li¡TabËU§ge
(
pMaskS‘
, 
pEx´
->
x
.
pLi¡
);

114737 }ifÐ
	gÝ
==
TK_ISNULL
 ){

114738 
pT”m
->
´”eqRight
 = 0;

114740 
	gpT”m
->
	g´”eqRight
 = 
ex´TabËU§ge
(
pMaskS‘
, 
pEx´
->
pRight
);

114742 
	g´”eqAÎ
 = 
ex´TabËU§ge
(
pMaskS‘
, 
pEx´
);

114743 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_FromJoš
) ){

114744 
B™mask
 
	gx
 = 
g‘Mask
(
pMaskS‘
, 
pEx´
->
iRightJošTabË
);

114745 
	g´”eqAÎ
 |ð
x
;

114746 
	gexŒaRight
 = 
x
-1;

114749 
	gpT”m
->
	g´”eqAÎ
 = 
´”eqAÎ
;

114750 
	gpT”m
->
	gËáCursÜ
 = -1;

114751 
	gpT”m
->
	giP¬’t
 = -1;

114752 
	gpT”m
->
	geO³¿tÜ
 = 0;

114753 ifÐ
®lowedOp
(
Ý
) ){

114754 
Ex´
 *
	gpLeá
 = 
sql™e3Ex´SkCÞÏ‹
(
pEx´
->
pLeá
);

114755 
Ex´
 *
	gpRight
 = 
sql™e3Ex´SkCÞÏ‹
(
pEx´
->
pRight
);

114756 
u16
 
	gÝMask
 = (
pT”m
->
´”eqRight
 & 
´”eqLeá
)==0 ? 
WO_ALL
 : 
WO_EQUIV
;

114757 ifÐ
	gpLeá
->
	gÝ
==
TK_COLUMN
 ){

114758 
pT”m
->
ËáCursÜ
 = 
pLeá
->
iTabË
;

114759 
	gpT”m
->
	gu
.
	gËáCÞumn
 = 
pLeá
->
iCÞumn
;

114760 
	gpT”m
->
	geO³¿tÜ
 = 
Ý”©ÜMask
(
Ý
è& 
ÝMask
;

114762 ifÐ
	gpRight
 &&…Right->
	gÝ
==
TK_COLUMN
 ){

114763 
Wh”eT”m
 *
pNew
;

114764 
Ex´
 *
	gpDup
;

114765 
u16
 
	geExŒaOp
 = 0;

114766 ifÐ
	gpT”m
->
	gËáCursÜ
>=0 ){

114767 
idxNew
;

114768 
	gpDup
 = 
sql™e3Ex´Dup
(
db
, 
pEx´
, 0);

114769 ifÐ
	gdb
->
	gm®locFažed
 ){

114770 
sql™e3Ex´D–‘e
(
db
, 
pDup
);

114773 
	gidxNew
 = 
wh”eCÏu£In£¹
(
pWC
, 
pDup
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114774 ifÐ
	gidxNew
==0 ) ;

114775 
	gpNew
 = &
pWC
->
a
[
idxNew
];

114776 
	gpNew
->
	giP¬’t
 = 
idxT”m
;

114777 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114778 
	gpT”m
->
	gnChžd
 = 1;

114779 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_COPIED
;

114780 ifÐ
	gpEx´
->
	gÝ
==
TK_EQ


114781 && !
Ex´HasPrÝ”ty
(
pEx´
, 
EP_FromJoš
)

114782 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_T¿ns™ive
)

114784 
	gpT”m
->
	geO³¿tÜ
 |ð
WO_EQUIV
;

114785 
	geExŒaOp
 = 
WO_EQUIV
;

114788 
	gpDup
 = 
pEx´
;

114789 
	gpNew
 = 
pT”m
;

114791 
ex´Commu‹
(
pP¬£
, 
pDup
);

114792 
	gpLeá
 = 
sql™e3Ex´SkCÞÏ‹
(
pDup
->
pLeá
);

114793 
	gpNew
->
	gËáCursÜ
 = 
pLeá
->
iTabË
;

114794 
	gpNew
->
	gu
.
	gËáCÞumn
 = 
pLeá
->
iCÞumn
;

114795 
‹¡ÿ£
Ð(
´”eqLeá
 | 
exŒaRight
) !=…rereqLeft );

114796 
	gpNew
->
	g´”eqRight
 = 
´”eqLeá
 | 
exŒaRight
;

114797 
	gpNew
->
	g´”eqAÎ
 = 
´”eqAÎ
;

114798 
	gpNew
->
	geO³¿tÜ
 = (
Ý”©ÜMask
(
pDup
->
Ý
è+ 
eExŒaOp
è& 
ÝMask
;

114802 #iâdeà
SQLITE_OMIT_BETWEEN_OPTIMIZATION


114818 ifÐ
	gpEx´
->
	gÝ
==
TK_BETWEEN
 && 
pWC
->
Ý
==
TK_AND
 ){

114819 
Ex´Li¡
 *
pLi¡
 = 
pEx´
->
x
.pList;

114820 
	gi
;

114821 cÚ¡ 
u8
 
	gÝs
[] = {
TK_GE
, 
TK_LE
};

114822 
as£¹
Ð
pLi¡
!=0 );

114823 
as£¹
Ð
pLi¡
->
nEx´
==2 );

114824 
	gi
=0; i<2; i++){

114825 
Ex´
 *
	gpNewEx´
;

114826 
	gidxNew
;

114827 
	gpNewEx´
 = 
sql™e3PEx´
(
pP¬£
, 
Ýs
[
i
],

114828 
sql™e3Ex´Dup
(
db
, 
pEx´
->
pLeá
, 0),

114829 
sql™e3Ex´Dup
(
db
, 
pLi¡
->
a
[
i
].
pEx´
, 0), 0);

114830 
ŒªsãrJošM¬kšgs
(
pNewEx´
, 
pEx´
);

114831 
	gidxNew
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNewEx´
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114832 
‹¡ÿ£
Ð
idxNew
==0 );

114833 
ex´AÇlyze
(
pSrc
, 
pWC
, 
idxNew
);

114834 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114835 
	gpWC
->
	ga
[
idxNew
].
	giP¬’t
 = 
idxT”m
;

114837 
	gpT”m
->
	gnChžd
 = 2;

114841 #ià!
defšed
(
SQLITE_OMIT_OR_OPTIMIZATION
è&& !defšed(
SQLITE_OMIT_SUBQUERY
)

114845 ifÐ
	gpEx´
->
	gÝ
==
TK_OR
 ){

114846 
as£¹
Ð
pWC
->
Ý
==
TK_AND
 );

114847 
ex´AÇlyzeOrT”m
(
pSrc
, 
pWC
, 
idxT”m
);

114848 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114852 #iâdeà
SQLITE_OMIT_LIKE_OPTIMIZATION


114863 ifÐ
	gpWC
->
	gÝ
==
TK_AND


114864 && 
isLikeOrGlob
(
pP¬£
, 
pEx´
, &
pSŒ1
, &
isCom¶‘e
, &
noCa£
)

114866 
Ex´
 *
	gpLeá
;

114867 
Ex´
 *
	gpSŒ2
;

114868 
Ex´
 *
	gpNewEx´1
;

114869 
Ex´
 *
	gpNewEx´2
;

114870 
	gidxNew1
;

114871 
	gidxNew2
;

114872 
Tok’
 
	gsCÞlSeqName
;

114874 
	gpLeá
 = 
pEx´
->
x
.
pLi¡
->
a
[1].pExpr;

114875 
	gpSŒ2
 = 
sql™e3Ex´Dup
(
db
, 
pSŒ1
, 0);

114876 ifÐ!
	gdb
->
	gm®locFažed
 ){

114877 
u8
 
	gc
, *
	gpC
;

114878 
	gpC
 = (
u8
*)&
pSŒ2
->
u
.
zTok’
[
sql™e3SŒËn30
(pStr2->u.zToken)-1];

114879 
	gc
 = *
pC
;

114880 ifÐ
	gnoCa£
 ){

114887 ifÐ
	gc
=='A'-1 ) 
isCom¶‘e
 = 0;

114888 
	gc
 = 
sql™e3Uµ”ToLow”
[
c
];

114890 *
	gpC
 = 
c
 + 1;

114892 
	gsCÞlSeqName
.
	gz
 = 
noCa£
 ? "NOCASE" : "BINARY";

114893 
	gsCÞlSeqName
.
	gn
 = 6;

114894 
	gpNewEx´1
 = 
sql™e3Ex´Dup
(
db
, 
pLeá
, 0);

114895 
	gpNewEx´1
 = 
sql™e3PEx´
(
pP¬£
, 
TK_GE
,

114896 
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
,
pNewEx´1
,&
sCÞlSeqName
),

114897 
pSŒ1
, 0);

114898 
ŒªsãrJošM¬kšgs
(
pNewEx´1
, 
pEx´
);

114899 
	gidxNew1
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNewEx´1
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114900 
‹¡ÿ£
Ð
idxNew1
==0 );

114901 
ex´AÇlyze
(
pSrc
, 
pWC
, 
idxNew1
);

114902 
	gpNewEx´2
 = 
sql™e3Ex´Dup
(
db
, 
pLeá
, 0);

114903 
	gpNewEx´2
 = 
sql™e3PEx´
(
pP¬£
, 
TK_LT
,

114904 
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
,
pNewEx´2
,&
sCÞlSeqName
),

114905 
pSŒ2
, 0);

114906 
ŒªsãrJošM¬kšgs
(
pNewEx´2
, 
pEx´
);

114907 
	gidxNew2
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNewEx´2
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114908 
‹¡ÿ£
Ð
idxNew2
==0 );

114909 
ex´AÇlyze
(
pSrc
, 
pWC
, 
idxNew2
);

114910 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114911 ifÐ
	gisCom¶‘e
 ){

114912 
	gpWC
->
	ga
[
idxNew1
].
	giP¬’t
 = 
idxT”m
;

114913 
	gpWC
->
	ga
[
idxNew2
].
	giP¬’t
 = 
idxT”m
;

114914 
	gpT”m
->
	gnChžd
 = 2;

114919 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


114926 ifÐ
isM©chOfCÞumn
(
pEx´
) ){

114927 
	gidxNew
;

114928 
Ex´
 *
	gpRight
, *
	gpLeá
;

114929 
Wh”eT”m
 *
	gpNewT”m
;

114930 
B™mask
 
	g´”eqCÞumn
, 
	g´”eqEx´
;

114932 
	gpRight
 = 
pEx´
->
x
.
pLi¡
->
a
[0].pExpr;

114933 
	gpLeá
 = 
pEx´
->
x
.
pLi¡
->
a
[1].pExpr;

114934 
	g´”eqEx´
 = 
ex´TabËU§ge
(
pMaskS‘
, 
pRight
);

114935 
	g´”eqCÞumn
 = 
ex´TabËU§ge
(
pMaskS‘
, 
pLeá
);

114936 ifÐ(
	g´”eqEx´
 & 
	g´”eqCÞumn
)==0 ){

114937 
Ex´
 *
pNewEx´
;

114938 
	gpNewEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_MATCH
,

114939 0, 
sql™e3Ex´Dup
(
db
, 
pRight
, 0), 0);

114940 
	gidxNew
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNewEx´
, 
TERM_VIRTUAL
|
TERM_DYNAMIC
);

114941 
‹¡ÿ£
Ð
idxNew
==0 );

114942 
	gpNewT”m
 = &
pWC
->
a
[
idxNew
];

114943 
	gpNewT”m
->
	g´”eqRight
 = 
´”eqEx´
;

114944 
	gpNewT”m
->
	gËáCursÜ
 = 
pLeá
->
iTabË
;

114945 
	gpNewT”m
->
	gu
.
	gËáCÞumn
 = 
pLeá
->
iCÞumn
;

114946 
	gpNewT”m
->
	geO³¿tÜ
 = 
WO_MATCH
;

114947 
	gpNewT”m
->
	giP¬’t
 = 
idxT”m
;

114948 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114949 
	gpT”m
->
	gnChžd
 = 1;

114950 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_COPIED
;

114951 
	gpNewT”m
->
	g´”eqAÎ
 = 
pT”m
->
´”eqAÎ
;

114956 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


114967 ifÐ
	gpEx´
->
	gÝ
==
TK_NOTNULL


114968 && 
pEx´
->
pLeá
->
Ý
==
TK_COLUMN


114969 && 
pEx´
->
pLeá
->
iCÞumn
>=0

114970 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_St3
)

114972 
Ex´
 *
	gpNewEx´
;

114973 
Ex´
 *
	gpLeá
 = 
pEx´
->
pLeá
;

114974 
	gidxNew
;

114975 
Wh”eT”m
 *
	gpNewT”m
;

114977 
	gpNewEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_GT
,

114978 
sql™e3Ex´Dup
(
db
, 
pLeá
, 0),

114979 
sql™e3PEx´
(
pP¬£
, 
TK_NULL
, 0, 0, 0), 0);

114981 
	gidxNew
 = 
wh”eCÏu£In£¹
(
pWC
, 
pNewEx´
,

114982 
TERM_VIRTUAL
|
TERM_DYNAMIC
|
TERM_VNULL
);

114983 ifÐ
	gidxNew
 ){

114984 
	gpNewT”m
 = &
pWC
->
a
[
idxNew
];

114985 
	gpNewT”m
->
	g´”eqRight
 = 0;

114986 
	gpNewT”m
->
	gËáCursÜ
 = 
pLeá
->
iTabË
;

114987 
	gpNewT”m
->
	gu
.
	gËáCÞumn
 = 
pLeá
->
iCÞumn
;

114988 
	gpNewT”m
->
	geO³¿tÜ
 = 
WO_GT
;

114989 
	gpNewT”m
->
	giP¬’t
 = 
idxT”m
;

114990 
	gpT”m
 = &
pWC
->
a
[
idxT”m
];

114991 
	gpT”m
->
	gnChžd
 = 1;

114992 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_COPIED
;

114993 
	gpNewT”m
->
	g´”eqAÎ
 = 
pT”m
->
´”eqAÎ
;

115001 
	gpT”m
->
	g´”eqRight
 |ð
exŒaRight
;

115011 
fšdIndexCÞ
(

115012 
P¬£
 *
pP¬£
,

115013 
Ex´Li¡
 *
pLi¡
,

115014 
iBa£
,

115015 
Index
 *
pIdx
,

115016 
iCÞ


115018 
	gi
;

115019 cÚ¡ *
	gzCÞl
 = 
pIdx
->
azCÞl
[
iCÞ
];

115021 
	gi
=0; i<
	gpLi¡
->
	gnEx´
; i++){

115022 
Ex´
 *
	gp
 = 
sql™e3Ex´SkCÞÏ‹
(
pLi¡
->
a
[
i
].
pEx´
);

115023 ifÐ
	gp
->
	gÝ
==
TK_COLUMN


115024 && 
p
->
iCÞumn
==
pIdx
->
aiCÞumn
[
iCÞ
]

115025 && 
p
->
iTabË
==
iBa£


115027 
CÞlSeq
 *
pCÞl
 = 
sql™e3Ex´CÞlSeq
(
pP¬£
, 
pLi¡
->
a
[
i
].
pEx´
);

115028 ifÐ
ALWAYS
(
pCÞl
è&& 0==
sql™e3SŒICmp
ÕCÞl->
zName
, 
zCÞl
) ){

115029  
	gi
;

115044 
isDi¡šùRedundªt
(

115045 
P¬£
 *
pP¬£
,

115046 
SrcLi¡
 *
pTabLi¡
,

115047 
Wh”eCÏu£
 *
pWC
,

115048 
Ex´Li¡
 *
pDi¡šù


115050 
TabË
 *
	gpTab
;

115051 
Index
 *
	gpIdx
;

115052 
	gi
;

115053 
	giBa£
;

115058 ifÐ
	gpTabLi¡
->
	gnSrc
!=1 )  0;

115059 
	giBa£
 = 
pTabLi¡
->
a
[0].
iCursÜ
;

115060 
	gpTab
 = 
pTabLi¡
->
a
[0].
pTab
;

115066 
	gi
=0; i<
	gpDi¡šù
->
	gnEx´
; i++){

115067 
Ex´
 *
	gp
 = 
sql™e3Ex´SkCÞÏ‹
(
pDi¡šù
->
a
[
i
].
pEx´
);

115068 ifÐ
	gp
->
	gÝ
==
TK_COLUMN
 && 
p
->
iTabË
==
iBa£
 &&…->
iCÞumn
<0 )  1;

115084 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

115085 ifÐ!
IsUniqueIndex
(
pIdx
) ) ;

115086 
	gi
=0; i<
	gpIdx
->
	gnKeyCÞ
; i++){

115087 
i16
 
	giCÞ
 = 
pIdx
->
aiCÞumn
[
i
];

115088 ifÐ0==
fšdT”m
(
pWC
, 
iBa£
, 
iCÞ
, ~(
B™mask
)0, 
WO_EQ
, 
pIdx
) ){

115089 
	giIdxCÞ
 = 
fšdIndexCÞ
(
pP¬£
, 
pDi¡šù
, 
iBa£
, 
pIdx
, 
i
);

115090 ifÐ
	giIdxCÞ
<0 || 
	gpTab
->
	gaCÞ
[
iCÞ
].
	gnÙNuÎ
==0 ){

115095 ifÐ
	gi
==
pIdx
->
nKeyCÞ
 ){

115108 
LogE¡
 
e¡Log
(LogE¡ 
N
){

115109  
	gN
<=10 ? 0 : 
sql™e3LogE¡
(
N
) - 33;

115118 #ià!
defšed
(
SQLITE_OMIT_VIRTUALTABLE
è&& defšed(
WHERETRACE_ENABLED
)

115119 
TRACE_IDX_INPUTS
(
sql™e3_šdex_šfo
 *
p
){

115120 
	gi
;

115121 ifÐ!
	gsql™e3Wh”eT¿û
 ) ;

115122 
	gi
=0; i<
	gp
->
	gnCÚ¡¿št
; i++){

115123 
sql™e3DebugPrštf
(" constraint[%d]: col=%dermid=%d op=%d usabled=%d\n",

115124 
i
,

115125 
p
->
aCÚ¡¿št
[
i
].
iCÞumn
,

115126 
p
->
aCÚ¡¿št
[
i
].
iT”mOff£t
,

115127 
p
->
aCÚ¡¿št
[
i
].
Ý
,

115128 
p
->
aCÚ¡¿št
[
i
].
u§bË
);

115130 
	gi
=0; i<
	gp
->
	gnOrd”By
; i++){

115131 
sql™e3DebugPrštf
(" orderby[%d]: col=%d desc=%d\n",

115132 
i
,

115133 
p
->
aOrd”By
[
i
].
iCÞumn
,

115134 
p
->
aOrd”By
[
i
].
desc
);

115137 
TRACE_IDX_OUTPUTS
(
sql™e3_šdex_šfo
 *
p
){

115138 
	gi
;

115139 ifÐ!
	gsql™e3Wh”eT¿û
 ) ;

115140 
	gi
=0; i<
	gp
->
	gnCÚ¡¿št
; i++){

115141 
sql™e3DebugPrštf
(" usage[%d]:‡rgvIdx=%d omit=%d\n",

115142 
i
,

115143 
p
->
aCÚ¡¿štU§ge
[
i
].
¬gvIndex
,

115144 
p
->
aCÚ¡¿štU§ge
[
i
].
om™
);

115146 
sql™e3DebugPrštf
(" idxNum=%d\n", 
p
->
idxNum
);

115147 
sql™e3DebugPrštf
(" idxSŒ=%s\n", 
p
->
idxSŒ
);

115148 
sql™e3DebugPrštf
(" ord”ByCÚsumed=%d\n", 
p
->
Üd”ByCÚsumed
);

115149 
sql™e3DebugPrštf
("ƒ¡im©edCo¡=%g\n", 
p
->
e¡im©edCo¡
);

115150 
sql™e3DebugPrštf
("ƒ¡im©edRows=%Îd\n", 
p
->
e¡im©edRows
);

115153 
	#TRACE_IDX_INPUTS
(
A
)

	)

115154 
	#TRACE_IDX_OUTPUTS
(
A
)

	)

115157 #iâdeà
SQLITE_OMIT_AUTOMATIC_INDEX


115163 
‹rmCªDriveIndex
(

115164 
Wh”eT”m
 *
pT”m
,

115165 
SrcLi¡_™em
 *
pSrc
,

115166 
B™mask
 
nÙR—dy


115168 
	gaff
;

115169 ifÐ
	gpT”m
->
	gËáCursÜ
!=
pSrc
->
iCursÜ
 )  0;

115170 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_EQ
)==0 )  0;

115171 ifÐ(
	gpT”m
->
	g´”eqRight
 & 
	gnÙR—dy
)!=0 )  0;

115172 ifÐ
	gpT”m
->
	gu
.
	gËáCÞumn
<0 )  0;

115173 
	gaff
 = 
pSrc
->
pTab
->
aCÞ
[
pT”m
->
u
.
ËáCÞumn
].
affš™y
;

115174 ifÐ!
sql™e3IndexAffš™yOk
(
pT”m
->
pEx´
, 
aff
) )  0;

115180 #iâdeà
SQLITE_OMIT_AUTOMATIC_INDEX


115186 
cÚ¡ruùAutom©icIndex
(

115187 
P¬£
 *
pP¬£
,

115188 
Wh”eCÏu£
 *
pWC
,

115189 
SrcLi¡_™em
 *
pSrc
,

115190 
B™mask
 
nÙR—dy
,

115191 
Wh”eLev–
 *
pLev–


115193 
	gnKeyCÞ
;

115194 
Wh”eT”m
 *
	gpT”m
;

115195 
Wh”eT”m
 *
	gpWCEnd
;

115196 
Index
 *
	gpIdx
;

115197 
Vdbe
 *
	gv
;

115198 
	gaddrIn™
;

115199 
TabË
 *
	gpTabË
;

115200 
	gaddrTÝ
;

115201 
	g»gRecÜd
;

115202 
	gn
;

115203 
	gi
;

115204 
	gmxB™CÞ
;

115205 
CÞlSeq
 *
	gpCÞl
;

115206 
Wh”eLoÝ
 *
	gpLoÝ
;

115207 *
	gzNÙU£d
;

115208 
B™mask
 
	gidxCÞs
;

115209 
B™mask
 
	gexŒaCÞs
;

115210 
u8
 
	g£ÁW¬nšg
 = 0;

115214 
	gv
 = 
pP¬£
->
pVdbe
;

115215 
as£¹
Ð
v
!=0 );

115216 
	gaddrIn™
 = 
sql™e3CodeOnû
(
pP¬£
); 
VdbeCov”age
(
v
);

115220 
	gnKeyCÞ
 = 0;

115221 
	gpTabË
 = 
pSrc
->
pTab
;

115222 
	gpWCEnd
 = &
pWC
->
a
[pWC->
nT”m
];

115223 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

115224 
	gidxCÞs
 = 0;

115225 
	gpT”m
=
pWC
->
a
;…T”m<
	gpWCEnd
;…Term++){

115226 ifÐ
‹rmCªDriveIndex
(
pT”m
, 
pSrc
, 
nÙR—dy
) ){

115227 
	giCÞ
 = 
pT”m
->
u
.
ËáCÞumn
;

115228 
B™mask
 
	gcMask
 = 
iCÞ
>=
BMS
 ? 
MASKBIT
(BMS-1) : MASKBIT(iCol);

115229 
‹¡ÿ£
Ð
iCÞ
==
BMS
 );

115230 
‹¡ÿ£
Ð
iCÞ
==
BMS
-1 );

115231 ifÐ!
	g£ÁW¬nšg
 ){

115232 
sql™e3_log
(
SQLITE_WARNING_AUTOINDEX
,

115233 "autom©iøšdex oÀ%s(%s)", 
pTabË
->
zName
,

115234 
pTabË
->
aCÞ
[
iCÞ
].
zName
);

115235 
	g£ÁW¬nšg
 = 1;

115237 ifÐ(
	gidxCÞs
 & 
	gcMask
)==0 ){

115238 ifÐ
wh”eLoÝResize
(
pP¬£
->
db
, 
pLoÝ
, 
nKeyCÞ
+1) ) ;

115239 
	gpLoÝ
->
	gaLT”m
[
nKeyCÞ
++] = 
pT”m
;

115240 
	gidxCÞs
 |ð
cMask
;

115244 
as£¹
Ð
nKeyCÞ
>0 );

115245 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnEq
 = 
pLoÝ
->
nLT”m
 = 
nKeyCÞ
;

115246 
	gpLoÝ
->
	gwsFÏgs
 = 
WHERE_COLUMN_EQ
 | 
WHERE_IDX_ONLY
 | 
WHERE_INDEXED


115247 | 
WHERE_AUTO_INDEX
;

115257 
	gexŒaCÞs
 = 
pSrc
->
cÞU£d
 & (~
idxCÞs
 | 
MASKBIT
(
BMS
-1));

115258 
	gmxB™CÞ
 = (
pTabË
->
nCÞ
 >ð
BMS
-1) ? BMS-1 :…Table->nCol;

115259 
‹¡ÿ£
Ð
pTabË
->
nCÞ
==
BMS
-1 );

115260 
‹¡ÿ£
Ð
pTabË
->
nCÞ
==
BMS
-2 );

115261 
	gi
=0; i<
	gmxB™CÞ
; i++){

115262 ifÐ
	gexŒaCÞs
 & 
MASKBIT
(
i
èè
	gnKeyCÞ
++;

115264 ifÐ
	gpSrc
->
	gcÞU£d
 & 
MASKBIT
(
BMS
-1) ){

115265 
	gnKeyCÞ
 +ð
pTabË
->
nCÞ
 - 
BMS
 + 1;

115267 
	gpLoÝ
->
	gwsFÏgs
 |ð
WHERE_COLUMN_EQ
 | 
WHERE_IDX_ONLY
;

115270 
	gpIdx
 = 
sql™e3AÎoÿ‹IndexObjeù
(
pP¬£
->
db
, 
nKeyCÞ
+1, 0, &
zNÙU£d
);

115271 ifÐ
	gpIdx
==0 ) ;

115272 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gpIndex
 = 
pIdx
;

115273 
	gpIdx
->
	gzName
 = "auto-index";

115274 
	gpIdx
->
	gpTabË
 = 
pTabË
;

115275 
	gn
 = 0;

115276 
	gidxCÞs
 = 0;

115277 
	gpT”m
=
pWC
->
a
;…T”m<
	gpWCEnd
;…Term++){

115278 ifÐ
‹rmCªDriveIndex
(
pT”m
, 
pSrc
, 
nÙR—dy
) ){

115279 
	giCÞ
 = 
pT”m
->
u
.
ËáCÞumn
;

115280 
B™mask
 
	gcMask
 = 
iCÞ
>=
BMS
 ? 
MASKBIT
(BMS-1) : MASKBIT(iCol);

115281 
‹¡ÿ£
Ð
iCÞ
==
BMS
-1 );

115282 
‹¡ÿ£
Ð
iCÞ
==
BMS
 );

115283 ifÐ(
	gidxCÞs
 & 
	gcMask
)==0 ){

115284 
Ex´
 *
pX
 = 
pT”m
->
pEx´
;

115285 
	gidxCÞs
 |ð
cMask
;

115286 
	gpIdx
->
	gaiCÞumn
[
n
] = 
pT”m
->
u
.
ËáCÞumn
;

115287 
	gpCÞl
 = 
sql™e3Bš¬yCom·»CÞlSeq
(
pP¬£
, 
pX
->
pLeá
,…X->
pRight
);

115288 
	gpIdx
->
	gazCÞl
[
n
] = 
ALWAYS
(
pCÞl
è?…CÞl->
zName
 : "BINARY";

115289 
	gn
++;

115293 
as£¹
Ð(
u32
)
n
==
pLoÝ
->
u
.
bŒ“
.
nEq
 );

115297 
	gi
=0; i<
	gmxB™CÞ
; i++){

115298 ifÐ
	gexŒaCÞs
 & 
MASKBIT
(
i
) ){

115299 
	gpIdx
->
	gaiCÞumn
[
n
] = 
i
;

115300 
	gpIdx
->
	gazCÞl
[
n
] = "BINARY";

115301 
	gn
++;

115304 ifÐ
	gpSrc
->
	gcÞU£d
 & 
MASKBIT
(
BMS
-1) ){

115305 
	gi
=
BMS
-1; i<
	gpTabË
->
	gnCÞ
; i++){

115306 
	gpIdx
->
	gaiCÞumn
[
n
] = 
i
;

115307 
	gpIdx
->
	gazCÞl
[
n
] = "BINARY";

115308 
	gn
++;

115311 
as£¹
Ð
n
==
nKeyCÞ
 );

115312 
	gpIdx
->
	gaiCÞumn
[
n
] = -1;

115313 
	gpIdx
->
	gazCÞl
[
n
] = "BINARY";

115316 
as£¹
Ð
pLev–
->
iIdxCur
>=0 );

115317 
	gpLev–
->
	giIdxCur
 = 
pP¬£
->
nTab
++;

115318 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nAutošdex
, 
pLev–
->
iIdxCur
, 
nKeyCÞ
+1);

115319 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIdx
);

115320 
VdbeComm’t
((
v
, "fÜ %s", 
pTabË
->
zName
));

115323 
	gaddrTÝ
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_Rewšd
, 
pLev–
->
iTabCur
); 
VdbeCov”age
(v);

115324 
	g»gRecÜd
 = 
sql™e3G‘TempReg
(
pP¬£
);

115325 
sql™e3G’”©eIndexKey
(
pP¬£
, 
pIdx
, 
pLev–
->
iTabCur
, 
»gRecÜd
, 0, 0, 0, 0);

115326 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxIn£¹
, 
pLev–
->
iIdxCur
, 
»gRecÜd
);

115327 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_USESEEKRESULT
);

115328 
sql™e3VdbeAddOp2
(
v
, 
OP_Next
, 
pLev–
->
iTabCur
, 
addrTÝ
+1); 
VdbeCov”age
(v);

115329 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_STMTSTATUS_AUTOINDEX
);

115330 
sql™e3VdbeJumpH”e
(
v
, 
addrTÝ
);

115331 
sql™e3R–—£TempReg
(
pP¬£
, 
»gRecÜd
);

115334 
sql™e3VdbeJumpH”e
(
v
, 
addrIn™
);

115338 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


115344 
sql™e3_šdex_šfo
 *
®loÿ‹IndexInfo
(

115345 
P¬£
 *
pP¬£
,

115346 
Wh”eCÏu£
 *
pWC
,

115347 
SrcLi¡_™em
 *
pSrc
,

115348 
Ex´Li¡
 *
pOrd”By


115350 
	gi
, 
	gj
;

115351 
	gnT”m
;

115352 
sql™e3_šdex_cÚ¡¿št
 *
	gpIdxCÚs
;

115353 
sql™e3_šdex_Üd”by
 *
	gpIdxOrd”By
;

115354 
sql™e3_šdex_cÚ¡¿št_u§ge
 *
	gpU§ge
;

115355 
Wh”eT”m
 *
	gpT”m
;

115356 
	gnOrd”By
;

115357 
sql™e3_šdex_šfo
 *
	gpIdxInfo
;

115361 
	gi
=
nT”m
=0, 
	gpT”m
=
pWC
->
a
; i<
	gpWC
->
	gnT”m
; i++,…Term++){

115362 ifÐ
	gpT”m
->
	gËáCursÜ
 !ð
pSrc
->
iCursÜ
 ) ;

115363 
as£¹
Ð
IsPow”OfTwo
(
pT”m
->
eO³¿tÜ
 & ~
WO_EQUIV
) );

115364 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_IN
 );

115365 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_ISNULL
 );

115366 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_ALL
 );

115367 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & ~(
	gWO_ISNULL
|
	gWO_EQUIV
))==0 ) ;

115368 ifÐ
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_VNULL
 ) ;

115369 
	gnT”m
++;

115376 
	gnOrd”By
 = 0;

115377 ifÐ
	gpOrd”By
 ){

115378 
	gn
 = 
pOrd”By
->
nEx´
;

115379 
	gi
=0; i<
	gn
; i++){

115380 
Ex´
 *
	gpEx´
 = 
pOrd”By
->
a
[
i
].
pEx´
;

115381 ifÐ
	gpEx´
->
	gÝ
!=
TK_COLUMN
 || 
pEx´
->
iTabË
!=
pSrc
->
iCursÜ
 ) ;

115383 ifÐ
	gi
==
n
){

115384 
nOrd”By
 = 
n
;

115390 
	gpIdxInfo
 = 
sql™e3DbM®locZ”o
(
pP¬£
->
db
, (*
pIdxInfo
)

115391 + ((*
pIdxCÚs
è+ (*
pU§ge
))*
nT”m


115392 + (*
pIdxOrd”By
)*
nOrd”By
 );

115393 ifÐ
	gpIdxInfo
==0 ){

115394 
sql™e3E¼ÜMsg
(
pP¬£
, "out of memory");

115403 
	gpIdxCÚs
 = (
sql™e3_šdex_cÚ¡¿št
*)&
pIdxInfo
[1];

115404 
	gpIdxOrd”By
 = (
sql™e3_šdex_Üd”by
*)&
pIdxCÚs
[
nT”m
];

115405 
	gpU§ge
 = (
sql™e3_šdex_cÚ¡¿št_u§ge
*)&
pIdxOrd”By
[
nOrd”By
];

115406 *(*)&
	gpIdxInfo
->
	gnCÚ¡¿št
 = 
nT”m
;

115407 *(*)&
	gpIdxInfo
->
	gnOrd”By
 = 
nOrd”By
;

115408 *(
	gsql™e3_šdex_cÚ¡¿št
**)&
	gpIdxInfo
->
	gaCÚ¡¿št
 = 
pIdxCÚs
;

115409 *(
	gsql™e3_šdex_Üd”by
**)&
	gpIdxInfo
->
	gaOrd”By
 = 
pIdxOrd”By
;

115410 *(
	gsql™e3_šdex_cÚ¡¿št_u§ge
**)&
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
 =

115411 
pU§ge
;

115413 
	gi
=
j
=0, 
	gpT”m
=
pWC
->
a
; i<
	gpWC
->
	gnT”m
; i++,…Term++){

115414 
u8
 
	gÝ
;

115415 ifÐ
	gpT”m
->
	gËáCursÜ
 !ð
pSrc
->
iCursÜ
 ) ;

115416 
as£¹
Ð
IsPow”OfTwo
(
pT”m
->
eO³¿tÜ
 & ~
WO_EQUIV
) );

115417 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_IN
 );

115418 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_ISNULL
 );

115419 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_ALL
 );

115420 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & ~(
	gWO_ISNULL
|
	gWO_EQUIV
))==0 ) ;

115421 ifÐ
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_VNULL
 ) ;

115422 
	gpIdxCÚs
[
j
].
	giCÞumn
 = 
pT”m
->
u
.
ËáCÞumn
;

115423 
	gpIdxCÚs
[
j
].
	giT”mOff£t
 = 
i
;

115424 
	gÝ
 = (
u8
)
pT”m
->
eO³¿tÜ
 & 
WO_ALL
;

115425 ifÐ
	gÝ
==
WO_IN
 ) 
Ý
 = 
WO_EQ
;

115426 
	gpIdxCÚs
[
j
].
	gÝ
 = 
Ý
;

115430 
as£¹
Ð
WO_EQ
==
SQLITE_INDEX_CONSTRAINT_EQ
 );

115431 
as£¹
Ð
WO_LT
==
SQLITE_INDEX_CONSTRAINT_LT
 );

115432 
as£¹
Ð
WO_LE
==
SQLITE_INDEX_CONSTRAINT_LE
 );

115433 
as£¹
Ð
WO_GT
==
SQLITE_INDEX_CONSTRAINT_GT
 );

115434 
as£¹
Ð
WO_GE
==
SQLITE_INDEX_CONSTRAINT_GE
 );

115435 
as£¹
Ð
WO_MATCH
==
SQLITE_INDEX_CONSTRAINT_MATCH
 );

115436 
as£¹
Ð
pT”m
->
eO³¿tÜ
 & (
WO_IN
|
WO_EQ
|
WO_LT
|
WO_LE
|
WO_GT
|
WO_GE
|
WO_MATCH
) );

115437 
	gj
++;

115439 
	gi
=0; i<
	gnOrd”By
; i++){

115440 
Ex´
 *
	gpEx´
 = 
pOrd”By
->
a
[
i
].
pEx´
;

115441 
	gpIdxOrd”By
[
i
].
	giCÞumn
 = 
pEx´
->
iCÞumn
;

115442 
	gpIdxOrd”By
[
i
].
	gdesc
 = 
pOrd”By
->
a
[i].
sÜtOrd”
;

115445  
	gpIdxInfo
;

115462 
vbBe¡Index
(
P¬£
 *
pP¬£
, 
TabË
 *
pTab
, 
sql™e3_šdex_šfo
 *
p
){

115463 
sql™e3_vb
 *
	gpVb
 = 
sql™e3G‘VTabË
(
pP¬£
->
db
, 
pTab
)->pVtab;

115464 
	gi
;

115465 
	grc
;

115467 
TRACE_IDX_INPUTS
(
p
);

115468 
	grc
 = 
pVb
->
pModuË
->
xBe¡Index
ÕVb, 
p
);

115469 
TRACE_IDX_OUTPUTS
(
p
);

115471 ifÐ
	grc
!=
SQLITE_OK
 ){

115472 ifÐ
rc
==
SQLITE_NOMEM
 ){

115473 
pP¬£
->
db
->
m®locFažed
 = 1;

115474 }ifÐ!
	gpVb
->
	gzE¼Msg
 ){

115475 
sql™e3E¼ÜMsg
(
pP¬£
, "%s", 
sql™e3E¼SŒ
(
rc
));

115477 
sql™e3E¼ÜMsg
(
pP¬£
, "%s", 
pVb
->
zE¼Msg
);

115480 
sql™e3_ä“
(
pVb
->
zE¼Msg
);

115481 
	gpVb
->
	gzE¼Msg
 = 0;

115483 
	gi
=0; i<
	gp
->
	gnCÚ¡¿št
; i++){

115484 ifÐ!
	gp
->
	gaCÚ¡¿št
[
i
].
	gu§bË
 &&…->
	gaCÚ¡¿štU§ge
[i].
	g¬gvIndex
>0 ){

115485 
sql™e3E¼ÜMsg
(
pP¬£
,

115486 "bË %s: xBe¡Index„‘uºed‡Àšv®id…Ïn", 
pTab
->
zName
);

115490  
	gpP¬£
->
	gnE¼
;

115495 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


115505 
wh”eKeySts
(

115506 
P¬£
 *
pP¬£
,

115507 
Index
 *
pIdx
,

115508 
UÅackedRecÜd
 *
pRec
,

115509 
roundUp
,

115510 
tRowút
 *
aSt


115512 
IndexSam¶e
 *
	gaSam¶e
 = 
pIdx
->
aSam¶e
;

115513 
	giCÞ
;

115514 
	giMš
 = 0;

115515 
	gi
 = 
pIdx
->
nSam¶e
;

115516 
	giTe¡
;

115517 
	g»s
;

115519 #iâdeà
SQLITE_DEBUG


115520 
UNUSED_PARAMETER
Ð
pP¬£
 );

115522 
as£¹
Ð
pRec
!=0 );

115523 
	giCÞ
 = 
pRec
->
nF›ld
 - 1;

115524 
as£¹
Ð
pIdx
->
nSam¶e
>0 );

115525 
as£¹
Ð
pRec
->
nF›ld
>0 && 
iCÞ
<
pIdx
->
nSam¶eCÞ
 );

115527 
	giTe¡
 = (
iMš
+
i
)/2;

115528 
	g»s
 = 
sql™e3VdbeRecÜdCom·»
(
aSam¶e
[
iTe¡
].
n
,‡Sam¶e[iTe¡].
p
, 
pRec
);

115529 ifÐ
	g»s
<0 ){

115530 
	giMš
 = 
iTe¡
+1;

115532 
	gi
 = 
iTe¡
;

115534 } 
	g»s
 && 
	giMš
<
	gi
 );

115536 #ifdeà
SQLITE_DEBUG


115540 ifÐ
	g»s
==0 ){

115542 
as£¹
Ð
i
<
pIdx
->
nSam¶e
 );

115543 
as£¹
Ð0==
sql™e3VdbeRecÜdCom·»
(
aSam¶e
[
i
].
n
,‡Sam¶e[i].
p
, 
pRec
)

115544 || 
pP¬£
->
db
->
m®locFažed
 );

115548 
as£¹
Ð
i
==
pIdx
->
nSam¶e


115549 || 
sql™e3VdbeRecÜdCom·»
(
aSam¶e
[
i
].
n
,‡Sam¶e[i].
p
, 
pRec
)>0

115550 || 
pP¬£
->
db
->
m®locFažed
 );

115551 
as£¹
Ð
i
==0

115552 || 
sql™e3VdbeRecÜdCom·»
(
aSam¶e
[
i
-1].
n
,‡Sam¶e[i-1].
p
, 
pRec
)<0

115553 || 
pP¬£
->
db
->
m®locFažed
 );

115561 ifÐ
	g»s
==0 ){

115562 
aSt
[0] = 
aSam¶e
[
i
].
ªLt
[
iCÞ
];

115563 
	gaSt
[1] = 
aSam¶e
[
i
].
ªEq
[
iCÞ
];

115565 
tRowút
 
	giLow”
, 
	giUµ”
, 
	giG­
;

115566 ifÐ
	gi
==0 ){

115567 
iLow”
 = 0;

115568 
	giUµ”
 = 
aSam¶e
[0].
ªLt
[
iCÞ
];

115570 
i64
 
	gnRow0
 = 
sql™e3LogE¡ToIÁ
(
pIdx
->
aiRowLogE¡
[0]);

115571 
	giUµ”
 = 
i
>=
pIdx
->
nSam¶e
 ? 
nRow0
 : 
aSam¶e
[i].
ªLt
[
iCÞ
];

115572 
	giLow”
 = 
aSam¶e
[
i
-1].
ªEq
[
iCÞ
] +‡Sam¶e[i-1].
ªLt
[iCol];

115574 
	gaSt
[1] = 
pIdx
->
aAvgEq
[
iCÞ
];

115575 ifÐ
	giLow”
>=
iUµ”
 ){

115576 
iG­
 = 0;

115578 
	giG­
 = 
iUµ”
 - 
iLow”
;

115580 ifÐ
	groundUp
 ){

115581 
	giG­
 = (
iG­
*2)/3;

115583 
	giG­
 = 
iG­
/3;

115585 
	gaSt
[0] = 
iLow”
 + 
iG­
;

115601 
LogE¡
 
wh”eRªgeAdju¡
(
Wh”eT”m
 *
pT”m
, LogE¡ 
nNew
){

115602 
LogE¡
 
	gnR‘
 = 
nNew
;

115603 ifÐ
	gpT”m
 ){

115604 ifÐ
	gpT”m
->
	gŒuthProb
<=0 ){

115605 
nR‘
 +ð
pT”m
->
ŒuthProb
;

115606 }ifÐ(
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_VNULL
)==0 ){

115607 
nR‘
 -ð20; 
as£¹
Ð20==
sql™e3LogE¡
(4) );

115610  
	gnR‘
;

115613 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


115649 
wh”eRªgeSkSÿnE¡
(

115650 
P¬£
 *
pP¬£
,

115651 
Wh”eT”m
 *
pLow”
,

115652 
Wh”eT”m
 *
pUµ”
,

115653 
Wh”eLoÝ
 *
pLoÝ
,

115654 *
pbDÚe


115656 
Index
 *
	gp
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

115657 
	gnEq
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
;

115658 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

115659 
	gnLow”
 = -1;

115660 
	gnUµ”
 = 
p
->
nSam¶e
+1;

115661 
	grc
 = 
SQLITE_OK
;

115662 
	giCÞ
 = 
p
->
aiCÞumn
[
nEq
];

115663 
u8
 
	gaff
 = 
iCÞ
>=0 ? 
p
->
pTabË
->
aCÞ
[iCÞ].
affš™y
 : 
SQLITE_AFF_INTEGER
;

115664 
CÞlSeq
 *
	gpCÞl
;

115666 
sql™e3_v®ue
 *
	gp1
 = 0;

115667 
sql™e3_v®ue
 *
	gp2
 = 0;

115668 
sql™e3_v®ue
 *
	gpV®
 = 0;

115670 
	gpCÞl
 = 
sql™e3Loÿ‹CÞlSeq
(
pP¬£
, 
p
->
azCÞl
[
nEq
]);

115671 ifÐ
	gpLow”
 ){

115672 
	grc
 = 
sql™e3St4V®ueFromEx´
(
pP¬£
, 
pLow”
->
pEx´
->
pRight
, 
aff
, &
p1
);

115673 
	gnLow”
 = 0;

115675 ifÐ
	gpUµ”
 && 
	grc
==
SQLITE_OK
 ){

115676 
rc
 = 
sql™e3St4V®ueFromEx´
(
pP¬£
, 
pUµ”
->
pEx´
->
pRight
, 
aff
, &
p2
);

115677 
	gnUµ”
 = 
p2
 ? 0 : 
p
->
nSam¶e
;

115680 ifÐ
	gp1
 || 
	gp2
 ){

115681 
	gi
;

115682 
	gnDiff
;

115683 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nSam¶e
; i++){

115684 
	grc
 = 
sql™e3St4CÞumn
(
db
, 
p
->
aSam¶e
[
i
].p,…->aSam¶e[i].
n
, 
nEq
, &
pV®
);

115685 ifÐ
	grc
==
SQLITE_OK
 && 
p1
 ){

115686 
»s
 = 
sql™e3MemCom·»
(
p1
, 
pV®
, 
pCÞl
);

115687 ifÐ
	g»s
>=0 ) 
nLow”
++;

115689 ifÐ
	grc
==
SQLITE_OK
 && 
p2
 ){

115690 
»s
 = 
sql™e3MemCom·»
(
p2
, 
pV®
, 
pCÞl
);

115691 ifÐ
	g»s
>=0 ) 
nUµ”
++;

115694 
	gnDiff
 = (
nUµ”
 - 
nLow”
);

115695 ifÐ
	gnDiff
<=0 ) 
nDiff
 = 1;

115702 ifÐ
	gnDiff
!=1 || 
pUµ”
==0 || 
pLow”
==0 ){

115703 
nAdju¡
 = (
sql™e3LogE¡
(
p
->
nSam¶e
è- sql™e3LogE¡(
nDiff
));

115704 
	gpLoÝ
->
	gnOut
 -ð
nAdju¡
;

115705 *
	gpbDÚe
 = 1;

115706 
WHERETRACE
(0x10, ("range skip-scan„egions: %u..%u‡djust=%dƒst=%d\n",

115707 
nLow”
, 
nUµ”
, 
nAdju¡
*-1, 
pLoÝ
->
nOut
));

115711 
as£¹
Ð*
pbDÚe
==0 );

115714 
sql™e3V®ueF»e
(
p1
);

115715 
sql™e3V®ueF»e
(
p2
);

115716 
sql™e3V®ueF»e
(
pV®
);

115718  
	grc
;

115762 
wh”eRªgeSÿnE¡
(

115763 
P¬£
 *
pP¬£
,

115764 
Wh”eLoÝBužd”
 *
pBužd”
,

115765 
Wh”eT”m
 *
pLow”
,

115766 
Wh”eT”m
 *
pUµ”
,

115767 
Wh”eLoÝ
 *
pLoÝ


115769 
	grc
 = 
SQLITE_OK
;

115770 
	gnOut
 = 
pLoÝ
->
nOut
;

115771 
LogE¡
 
	gnNew
;

115773 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


115774 
Index
 *
	gp
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

115775 
	gnEq
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
;

115777 ifÐ
	gp
->
	gnSam¶e
>0

115778 && 
	gnEq
<
	gp
->
	gnSam¶eCÞ


115779 && 
O±imiz©iÚEÇbËd
(
pP¬£
->
db
, 
SQLITE_St3
)

115781 ifÐ
	gnEq
==
pBužd”
->
nRecV®id
 ){

115782 
UÅackedRecÜd
 *
pRec
 = 
pBužd”
->pRec;

115783 
tRowút
 
	ga
[2];

115784 
u8
 
	gaff
;

115803 
tRowút
 
	giLow”
;

115804 
tRowút
 
	giUµ”
;

115806 ifÐ
	gpRec
 ){

115807 
‹¡ÿ£
Ð
pRec
->
nF›ld
!=
pBužd”
->
nRecV®id
 );

115808 
	gpRec
->
	gnF›ld
 = 
pBužd”
->
nRecV®id
;

115810 ifÐ
	gnEq
==
p
->
nKeyCÞ
 ){

115811 
aff
 = 
SQLITE_AFF_INTEGER
;

115813 
	gaff
 = 
p
->
pTabË
->
aCÞ
[p->
aiCÞumn
[
nEq
]].
affš™y
;

115816 ifÐ
	gnEq
==0 ){

115817 
iLow”
 = 0;

115818 
	giUµ”
 = 
sql™e3LogE¡ToIÁ
(
p
->
aiRowLogE¡
[0]);

115822 
wh”eKeySts
(
pP¬£
, 
p
, 
pRec
, 0, 
a
);

115823 
	giLow”
 = 
a
[0];

115824 
	giUµ”
 = 
a
[0] +‡[1];

115827 
as£¹
Ð
pLow”
==0 || (pLow”->
eO³¿tÜ
 & (
WO_GT
|
WO_GE
))!=0 );

115828 
as£¹
Ð
pUµ”
==0 || (pUµ”->
eO³¿tÜ
 & (
WO_LT
|
WO_LE
))!=0 );

115829 
as£¹
Ð
p
->
aSÜtOrd”
!=0 );

115830 ifÐ
	gp
->
	gaSÜtOrd”
[
nEq
] ){

115832 
SWAP
(
Wh”eT”m
*, 
pLow”
, 
pUµ”
);

115836 ifÐ
	gpLow”
 ){

115837 
	gbOk
;

115838 
Ex´
 *
	gpEx´
 = 
pLow”
->
pEx´
->
pRight
;

115839 
	grc
 = 
sql™e3St4ProbeS‘V®ue
(
pP¬£
, 
p
, &
pRec
, 
pEx´
, 
aff
, 
nEq
, &
bOk
);

115840 ifÐ
	grc
==
SQLITE_OK
 && 
bOk
 ){

115841 
tRowút
 
iNew
;

115842 
wh”eKeySts
(
pP¬£
, 
p
, 
pRec
, 0, 
a
);

115843 
	giNew
 = 
a
[0] + ((
pLow”
->
eO³¿tÜ
 & (
WO_GT
|
WO_LE
)) ?‡[1] : 0);

115844 ifÐ
	giNew
>
	giLow”
 ) iLow” = 
iNew
;

115845 
	gnOut
--;

115846 
	gpLow”
 = 0;

115851 ifÐ
	gpUµ”
 ){

115852 
	gbOk
;

115853 
Ex´
 *
	gpEx´
 = 
pUµ”
->
pEx´
->
pRight
;

115854 
	grc
 = 
sql™e3St4ProbeS‘V®ue
(
pP¬£
, 
p
, &
pRec
, 
pEx´
, 
aff
, 
nEq
, &
bOk
);

115855 ifÐ
	grc
==
SQLITE_OK
 && 
bOk
 ){

115856 
tRowút
 
iNew
;

115857 
wh”eKeySts
(
pP¬£
, 
p
, 
pRec
, 1, 
a
);

115858 
	giNew
 = 
a
[0] + ((
pUµ”
->
eO³¿tÜ
 & (
WO_GT
|
WO_LE
)) ?‡[1] : 0);

115859 ifÐ
	giNew
<
	giUµ”
 ) iUµ” = 
iNew
;

115860 
	gnOut
--;

115861 
	gpUµ”
 = 0;

115865 
	gpBužd”
->
	gpRec
 = 
pRec
;

115866 ifÐ
	grc
==
SQLITE_OK
 ){

115867 ifÐ
iUµ”
>
iLow”
 ){

115868 
nNew
 = 
sql™e3LogE¡
(
iUµ”
 - 
iLow”
);

115870 
	gnNew
 = 10; 
as£¹
Ð10==
sql™e3LogE¡
(2) );

115872 ifÐ
	gnNew
<
	gnOut
 ){

115873 
	gnOut
 = 
nNew
;

115875 
WHERETRACE
(0x10, ("STAT4„ange scan: %u..%uƒst=%d\n",

115876 (
u32
)
iLow”
, (u32)
iUµ”
, 
nOut
));

115879 
	gbDÚe
 = 0;

115880 
	grc
 = 
wh”eRªgeSkSÿnE¡
(
pP¬£
, 
pLow”
, 
pUµ”
, 
pLoÝ
, &
bDÚe
);

115881 ifÐ
	gbDÚe
 )  
	grc
;

115885 
UNUSED_PARAMETER
(
pP¬£
);

115886 
UNUSED_PARAMETER
(
pBužd”
);

115887 
as£¹
Ð
pLow”
 || 
pUµ”
 );

115889 
as£¹
Ð
pUµ”
==0 || (pUµ”->
wtFÏgs
 & 
TERM_VNULL
)==0 );

115890 
	gnNew
 = 
wh”eRªgeAdju¡
(
pLow”
, 
nOut
);

115891 
	gnNew
 = 
wh”eRªgeAdju¡
(
pUµ”
, 
nNew
);

115898 ifÐ
	gpLow”
 && 
	gpUµ”
 ) 
	gnNew
 -= 20;

115900 
	gnOut
 -ð(
pLow”
!=0è+ (
pUµ”
!=0);

115901 ifÐ
	gnNew
<10 )‚New = 10;

115902 ifÐ
	gnNew
<
	gnOut
 )‚Ouˆð
nNew
;

115903 #ià
defšed
(
WHERETRACE_ENABLED
)

115904 ifÐ
	gpLoÝ
->
	gnOut
>nOut ){

115905 
WHERETRACE
(0x10,("Range scan†owers‚Out from %do %d\n",

115906 
pLoÝ
->
nOut
,‚Out));

115909 
	gpLoÝ
->
	gnOut
 = (
LogE¡
)
nOut
;

115910  
	grc
;

115913 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


115931 
wh”eEqu®SÿnE¡
(

115932 
P¬£
 *
pP¬£
,

115933 
Wh”eLoÝBužd”
 *
pBužd”
,

115934 
Ex´
 *
pEx´
,

115935 
tRowút
 *
²Row


115937 
Index
 *
	gp
 = 
pBužd”
->
pNew
->
u
.
bŒ“
.
pIndex
;

115938 
	gnEq
 = 
pBužd”
->
pNew
->
u
.
bŒ“
.
nEq
;

115939 
UÅackedRecÜd
 *
	gpRec
 = 
pBužd”
->
pRec
;

115940 
u8
 
	gaff
;

115941 
	grc
;

115942 
tRowút
 
	ga
[2];

115943 
	gbOk
;

115945 
as£¹
Ð
nEq
>=1 );

115946 
as£¹
Ð
nEq
<=
p
->
nCÞumn
 );

115947 
as£¹
Ð
p
->
aSam¶e
!=0 );

115948 
as£¹
Ð
p
->
nSam¶e
>0 );

115949 
as£¹
Ð
pBužd”
->
nRecV®id
<
nEq
 );

115953 ifÐ
	gpBužd”
->
	gnRecV®id
<(
	gnEq
-1) ){

115954  
	gSQLITE_NOTFOUND
;

115959 ifÐ
	gnEq
>=
p
->
nCÞumn
 ){

115960 *
²Row
 = 1;

115961  
	gSQLITE_OK
;

115964 
	gaff
 = 
p
->
pTabË
->
aCÞ
[p->
aiCÞumn
[
nEq
-1]].
affš™y
;

115965 
	grc
 = 
sql™e3St4ProbeS‘V®ue
(
pP¬£
, 
p
, &
pRec
, 
pEx´
, 
aff
, 
nEq
-1, &
bOk
);

115966 
	gpBužd”
->
	gpRec
 = 
pRec
;

115967 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

115968 ifÐ
	gbOk
==0 )  
SQLITE_NOTFOUND
;

115969 
	gpBužd”
->
	gnRecV®id
 = 
nEq
;

115971 
wh”eKeySts
(
pP¬£
, 
p
, 
pRec
, 0, 
a
);

115972 
WHERETRACE
(0x10,("equ®™y sÿÀ»giÚs: %d\n", ()
a
[1]));

115973 *
	g²Row
 = 
a
[1];

115975  
	grc
;

115979 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


115996 
wh”eInSÿnE¡
(

115997 
P¬£
 *
pP¬£
,

115998 
Wh”eLoÝBužd”
 *
pBužd”
,

115999 
Ex´Li¡
 *
pLi¡
,

116000 
tRowút
 *
²Row


116002 
Index
 *
	gp
 = 
pBužd”
->
pNew
->
u
.
bŒ“
.
pIndex
;

116003 
i64
 
	gnRow0
 = 
sql™e3LogE¡ToIÁ
(
p
->
aiRowLogE¡
[0]);

116004 
	gnRecV®id
 = 
pBužd”
->
nRecV®id
;

116005 
	grc
 = 
SQLITE_OK
;

116006 
tRowút
 
	gnE¡
;

116007 
tRowút
 
	gnRowE¡
 = 0;

116008 
	gi
;

116010 
as£¹
Ð
p
->
aSam¶e
!=0 );

116011 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
pLi¡
->
nEx´
; i++){

116012 
	gnE¡
 = 
nRow0
;

116013 
	grc
 = 
wh”eEqu®SÿnE¡
(
pP¬£
, 
pBužd”
, 
pLi¡
->
a
[
i
].
pEx´
, &
nE¡
);

116014 
	gnRowE¡
 +ð
nE¡
;

116015 
	gpBužd”
->
	gnRecV®id
 = 
nRecV®id
;

116018 ifÐ
	grc
==
SQLITE_OK
 ){

116019 ifÐ
nRowE¡
 > 
nRow0
 )‚RowEst =‚Row0;

116020 *
	g²Row
 = 
nRowE¡
;

116021 
WHERETRACE
(0x10,("IN„owƒ¡im©e:ƒ¡=%d\n", 
nRowE¡
));

116023 
as£¹
Ð
pBužd”
->
nRecV®id
==nRecValid );

116024  
	grc
;

116051 
di§bËT”m
(
Wh”eLev–
 *
pLev–
, 
Wh”eT”m
 *
pT”m
){

116052 ifÐ
	gpT”m


116053 && (
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_CODED
)==0

116054 && (
pLev–
->
iLeáJoš
==0 || 
Ex´HasPrÝ”ty
(
pT”m
->
pEx´
, 
EP_FromJoš
))

116055 && (
	gpLev–
->
	gnÙR—dy
 & 
	gpT”m
->
	g´”eqAÎ
)==0

116057 
pT”m
->
wtFÏgs
 |ð
TERM_CODED
;

116058 ifÐ
	gpT”m
->
	giP¬’t
>=0 ){

116059 
Wh”eT”m
 *
pOth”
 = &
pT”m
->
pWC
->
a
[pT”m->
iP¬’t
];

116060 ifÐ(--
	gpOth”
->
	gnChžd
)==0 ){

116061 
di§bËT”m
(
pLev–
, 
pOth”
);

116078 
codeAµlyAffš™y
(
P¬£
 *
pP¬£
, 
ba£
, 
n
, *
zAff
){

116079 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

116080 ifÐ
	gzAff
==0 ){

116081 
as£¹
Ð
pP¬£
->
db
->
m®locFažed
 );

116084 
as£¹
Ð
v
!=0 );

116089  
	gn
>0 && 
	gzAff
[0]==
SQLITE_AFF_NONE
 ){

116090 
n
--;

116091 
	gba£
++;

116092 
	gzAff
++;

116094  
	gn
>1 && 
	gzAff
[
n
-1]==
SQLITE_AFF_NONE
 ){

116095 
n
--;

116099 ifÐ
	gn
>0 ){

116100 
sql™e3VdbeAddOp2
(
v
, 
OP_Affš™y
, 
ba£
, 
n
);

116101 
sql™e3VdbeChªgeP4
(
v
, -1, 
zAff
, 
n
);

116102 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
ba£
, 
n
);

116118 
codeEqu®™yT”m
(

116119 
P¬£
 *
pP¬£
,

116120 
Wh”eT”m
 *
pT”m
,

116121 
Wh”eLev–
 *
pLev–
,

116122 
iEq
,

116123 
bRev
,

116124 
iT¬g‘


116126 
Ex´
 *
	gpX
 = 
pT”m
->
pEx´
;

116127 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

116128 
	giReg
;

116130 
as£¹
Ð
iT¬g‘
>0 );

116131 ifÐ
	gpX
->
	gÝ
==
TK_EQ
 ){

116132 
iReg
 = 
sql™e3Ex´CodeT¬g‘
(
pP¬£
, 
pX
->
pRight
, 
iT¬g‘
);

116133 }ifÐ
	gpX
->
	gÝ
==
TK_ISNULL
 ){

116134 
iReg
 = 
iT¬g‘
;

116135 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
iReg
);

116136 #iâdeà
SQLITE_OMIT_SUBQUERY


116138 
	geTy³
;

116139 
	giTab
;

116140 
InLoÝ
 *
	gpIn
;

116141 
Wh”eLoÝ
 *
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

116143 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
)==0

116144 && 
pLoÝ
->
u
.
bŒ“
.
pIndex
!=0

116145 && 
pLoÝ
->
u
.
bŒ“
.
pIndex
->
aSÜtOrd”
[
iEq
]

116147 
‹¡ÿ£
Ð
iEq
==0 );

116148 
‹¡ÿ£
Ð
bRev
 );

116149 
	gbRev
 = !
bRev
;

116151 
as£¹
Ð
pX
->
Ý
==
TK_IN
 );

116152 
	giReg
 = 
iT¬g‘
;

116153 
	geTy³
 = 
sql™e3FšdInIndex
(
pP¬£
, 
pX
, 
IN_INDEX_LOOP
, 0);

116154 ifÐ
	geTy³
==
IN_INDEX_INDEX_DESC
 ){

116155 
‹¡ÿ£
Ð
bRev
 );

116156 
	gbRev
 = !
bRev
;

116158 
	giTab
 = 
pX
->
iTabË
;

116159 
sql™e3VdbeAddOp2
(
v
, 
bRev
 ? 
OP_La¡
 : 
OP_Rewšd
, 
iTab
, 0);

116160 
VdbeCov”ageIf
(
v
, 
bRev
);

116161 
VdbeCov”ageIf
(
v
, !
bRev
);

116162 
as£¹
Ð(
pLoÝ
->
wsFÏgs
 & 
WHERE_MULTI_OR
)==0 );

116163 
	gpLoÝ
->
	gwsFÏgs
 |ð
WHERE_IN_ABLE
;

116164 ifÐ
	gpLev–
->
	gu
.
	gš
.
	gnIn
==0 ){

116165 
pLev–
->
addrNxt
 = 
sql™e3VdbeMakeLab–
(
v
);

116167 
	gpLev–
->
	gu
.
	gš
.
	gnIn
++;

116168 
	gpLev–
->
	gu
.
	gš
.
	gaInLoÝ
 =

116169 
sql™e3DbR—ÎocOrF»e
(
pP¬£
->
db
, 
pLev–
->
u
.
š
.
aInLoÝ
,

116170 (
pLev–
->
u
.
š
.
aInLoÝ
[0])*pLev–->u.š.
nIn
);

116171 
	gpIn
 = 
pLev–
->
u
.
š
.
aInLoÝ
;

116172 ifÐ
	gpIn
 ){

116173 
	gpIn
 +ð
pLev–
->
u
.
š
.
nIn
 - 1;

116174 
	gpIn
->
	giCur
 = 
iTab
;

116175 ifÐ
	geTy³
==
IN_INDEX_ROWID
 ){

116176 
pIn
->
addrInTÝ
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iTab
, 
iReg
);

116178 
	gpIn
->
	gaddrInTÝ
 = 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iTab
, 0, 
iReg
);

116180 
	gpIn
->
	geEndLoÝOp
 = 
bRev
 ? 
OP_P»vIfO³n
 : 
OP_NextIfO³n
;

116181 
sql™e3VdbeAddOp1
(
v
, 
OP_IsNuÎ
, 
iReg
); 
VdbeCov”age
(v);

116183 
	gpLev–
->
	gu
.
	gš
.
	gnIn
 = 0;

116187 
di§bËT”m
(
pLev–
, 
pT”m
);

116188  
	giReg
;

116236 
codeAÎEqu®™yT”ms
(

116237 
P¬£
 *
pP¬£
,

116238 
Wh”eLev–
 *
pLev–
,

116239 
bRev
,

116240 
nExŒaReg
,

116241 **
pzAff


116243 
u16
 
	gnEq
;

116244 
u16
 
	gnSk
;

116245 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

116246 
Index
 *
	gpIdx
;

116247 
Wh”eT”m
 *
	gpT”m
;

116248 
Wh”eLoÝ
 *
	gpLoÝ
;

116249 
	gj
;

116250 
	g»gBa£
;

116251 
	gnReg
;

116252 *
	gzAff
;

116255 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

116256 
as£¹
Ð(
pLoÝ
->
wsFÏgs
 & 
WHERE_VIRTUALTABLE
)==0 );

116257 
	gnEq
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
;

116258 
	gnSk
 = 
pLoÝ
->
u
.
bŒ“
.
nSk
;

116259 
	gpIdx
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

116260 
as£¹
Ð
pIdx
!=0 );

116264 
	g»gBa£
 = 
pP¬£
->
nMem
 + 1;

116265 
	gnReg
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
 + 
nExŒaReg
;

116266 
	gpP¬£
->
	gnMem
 +ð
nReg
;

116268 
	gzAff
 = 
sql™e3DbSŒDup
(
pP¬£
->
db
, 
sql™e3IndexAffš™ySŒ
(
v
, 
pIdx
));

116269 ifÐ!
	gzAff
 ){

116270 
	gpP¬£
->
	gdb
->
	gm®locFažed
 = 1;

116273 ifÐ
	gnSk
 ){

116274 
	giIdxCur
 = 
pLev–
->
iIdxCur
;

116275 
sql™e3VdbeAddOp1
(
v
, (
bRev
?
OP_La¡
:
OP_Rewšd
), 
iIdxCur
);

116276 
VdbeCov”ageIf
(
v
, 
bRev
==0);

116277 
VdbeCov”ageIf
(
v
, 
bRev
!=0);

116278 
VdbeComm’t
((
v
, "begš sk-sÿÀÚ %s", 
pIdx
->
zName
));

116279 
	gj
 = 
sql™e3VdbeAddOp0
(
v
, 
OP_GÙo
);

116280 
	gpLev–
->
	gaddrSk
 = 
sql™e3VdbeAddOp4IÁ
(
v
, (
bRev
?
OP_S“kLT
:
OP_S“kGT
),

116281 
iIdxCur
, 0, 
»gBa£
, 
nSk
);

116282 
VdbeCov”ageIf
(
v
, 
bRev
==0);

116283 
VdbeCov”ageIf
(
v
, 
bRev
!=0);

116284 
sql™e3VdbeJumpH”e
(
v
, 
j
);

116285 
	gj
=0; j<
	gnSk
; j++){

116286 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iIdxCur
, 
j
, 
»gBa£
+j);

116287 
as£¹
Ð
pIdx
->
aiCÞumn
[
j
]>=0 );

116288 
VdbeComm’t
((
v
, "%s", 
pIdx
->
pTabË
->
aCÞ
[pIdx->
aiCÞumn
[
j
]].
zName
));

116294 
as£¹
Ð
zAff
==0 || ()
¡¾’
(zAff)>=
nEq
 );

116295 
	gj
=
nSk
; j<
	gnEq
; j++){

116296 
	gr1
;

116297 
	gpT”m
 = 
pLoÝ
->
aLT”m
[
j
];

116298 
as£¹
Ð
pT”m
!=0 );

116301 
‹¡ÿ£
Ð(
pT”m
->
wtFÏgs
 & 
TERM_CODED
)!=0 );

116302 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116303 
	gr1
 = 
codeEqu®™yT”m
(
pP¬£
, 
pT”m
, 
pLev–
, 
j
, 
bRev
, 
»gBa£
+j);

116304 ifÐ
	gr1
!=
»gBa£
+
j
 ){

116305 ifÐ
nReg
==1 ){

116306 
sql™e3R–—£TempReg
(
pP¬£
, 
»gBa£
);

116307 
	g»gBa£
 = 
r1
;

116309 
sql™e3VdbeAddOp2
(
v
, 
OP_SCÝy
, 
r1
, 
»gBa£
+
j
);

116312 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_ISNULL
 );

116313 
‹¡ÿ£
Ð
pT”m
->
eO³¿tÜ
 & 
WO_IN
 );

116314 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & (
	gWO_ISNULL
|
	gWO_IN
))==0 ){

116315 
Ex´
 *
pRight
 = 
pT”m
->
pEx´
->pRight;

116316 ifÐ
sql™e3Ex´CªBeNuÎ
(
pRight
) ){

116317 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gBa£
+
j
, 
pLev–
->
addrBrk
);

116318 
VdbeCov”age
(
v
);

116320 ifÐ
	gzAff
 ){

116321 ifÐ
sql™e3Com·»Affš™y
(
pRight
, 
zAff
[
j
])==
SQLITE_AFF_NONE
 ){

116322 
zAff
[
j
] = 
SQLITE_AFF_NONE
;

116324 ifÐ
sql™e3Ex´N“dsNoAffš™yChªge
(
pRight
, 
zAff
[
j
]) ){

116325 
	gzAff
[
j
] = 
SQLITE_AFF_NONE
;

116330 *
	gpzAff
 = 
zAff
;

116331  
	g»gBa£
;

116334 #iâdeà
SQLITE_OMIT_EXPLAIN


116343 
ex¶ašAµ’dT”m
(

116344 
SŒAccum
 *
pSŒ
,

116345 
iT”m
,

116346 cÚ¡ *
zCÞumn
,

116347 cÚ¡ *
zOp


116349 ifÐ
	giT”m
 ) 
sql™e3SŒAccumAµ’d
(
pSŒ
, " AND ", 5);

116350 
sql™e3SŒAccumAµ’dAÎ
(
pSŒ
, 
zCÞumn
);

116351 
sql™e3SŒAccumAµ’d
(
pSŒ
, 
zOp
, 1);

116352 
sql™e3SŒAccumAµ’d
(
pSŒ
, "?", 1);

116369 
ex¶ašIndexRªge
(
SŒAccum
 *
pSŒ
, 
Wh”eLoÝ
 *
pLoÝ
, 
TabË
 *
pTab
){

116370 
Index
 *
	gpIndex
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

116371 
u16
 
	gnEq
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
;

116372 
u16
 
	gnSk
 = 
pLoÝ
->
u
.
bŒ“
.
nSk
;

116373 
	gi
, 
	gj
;

116374 
CÞumn
 *
	gaCÞ
 = 
pTab
->
aCÞ
;

116375 
i16
 *
	gaiCÞumn
 = 
pIndex
->
aiCÞumn
;

116377 ifÐ
	gnEq
==0 && (
pLoÝ
->
wsFÏgs
&(
WHERE_BTM_LIMIT
|
WHERE_TOP_LIMIT
))==0 ) ;

116378 
sql™e3SŒAccumAµ’d
(
pSŒ
, " (", 2);

116379 
	gi
=0; i<
	gnEq
; i++){

116380 *
	gz
 = 
aiCÞumn
[
i
] < 0 ? "rowid" : 
aCÞ
[aiCÞumn[i]].
zName
;

116381 ifÐ
	gi
>=
nSk
 ){

116382 
ex¶ašAµ’dT”m
(
pSŒ
, 
i
, 
z
, "=");

116384 ifÐ
	gi
 ) 
sql™e3SŒAccumAµ’d
(
pSŒ
, " AND ", 5);

116385 
sql™e3XPrštf
(
pSŒ
, 0, "ANY(%s)", 
z
);

116389 
	gj
 = 
i
;

116390 ifÐ
	gpLoÝ
->
	gwsFÏgs
&
	gWHERE_BTM_LIMIT
 ){

116391 *
	gz
 = 
aiCÞumn
[
j
] < 0 ? "rowid" : 
aCÞ
[aiCÞumn[j]].
zName
;

116392 
ex¶ašAµ’dT”m
(
pSŒ
, 
i
++, 
z
, ">");

116394 ifÐ
	gpLoÝ
->
	gwsFÏgs
&
	gWHERE_TOP_LIMIT
 ){

116395 *
	gz
 = 
aiCÞumn
[
j
] < 0 ? "rowid" : 
aCÞ
[aiCÞumn[j]].
zName
;

116396 
ex¶ašAµ’dT”m
(
pSŒ
, 
i
, 
z
, "<");

116398 
sql™e3SŒAccumAµ’d
(
pSŒ
, ")", 1);

116407 
ex¶ašOÃSÿn
(

116408 
P¬£
 *
pP¬£
,

116409 
SrcLi¡
 *
pTabLi¡
,

116410 
Wh”eLev–
 *
pLev–
,

116411 
iLev–
,

116412 
iFrom
,

116413 
u16
 
wù¾FÏgs


116415 #iâdeà
SQLITE_DEBUG


116416 ifÐ
	gpP¬£
->
	gex¶aš
==2 )

116419 
SrcLi¡_™em
 *
pI‹m
 = &
pTabLi¡
->
a
[
pLev–
->
iFrom
];

116420 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

116421 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

116422 
	giId
 = 
pP¬£
->
iS–eùId
;

116423 
	gisS—rch
;

116424 
Wh”eLoÝ
 *
	gpLoÝ
;

116425 
u32
 
	gæags
;

116426 *
	gzMsg
;

116427 
SŒAccum
 
	g¡r
;

116428 
	gzBuf
[100];

116430 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

116431 
	gæags
 = 
pLoÝ
->
wsFÏgs
;

116432 ifÐ(
	gæags
&
	gWHERE_MULTI_OR
è|| (
	gwù¾FÏgs
&
	gWHERE_ONETABLE_ONLY
) ) ;

116434 
	gisS—rch
 = (
æags
&(
WHERE_BTM_LIMIT
|
WHERE_TOP_LIMIT
))!=0

116435 || ((
æags
&
WHERE_VIRTUALTABLE
)==0 && (
pLoÝ
->
u
.
bŒ“
.
nEq
>0))

116436 || (
wù¾FÏgs
&(
WHERE_ORDERBY_MIN
|
WHERE_ORDERBY_MAX
));

116438 
sql™e3SŒAccumIn™
(&
¡r
, 
zBuf
, (zBuf), 
SQLITE_MAX_LENGTH
);

116439 
	g¡r
.
	gdb
 = 
db
;

116440 
sql™e3SŒAccumAµ’dAÎ
(&
¡r
, 
isS—rch
 ? "SEARCH" : "SCAN");

116441 ifÐ
	gpI‹m
->
	gpS–eù
 ){

116442 
sql™e3XPrštf
(&
¡r
, 0, " SUBQUERY %d", 
pI‹m
->
iS–eùId
);

116444 
sql™e3XPrštf
(&
¡r
, 0, " TABLE %s", 
pI‹m
->
zName
);

116447 ifÐ
	gpI‹m
->
	gzAlŸs
 ){

116448 
sql™e3XPrštf
(&
¡r
, 0, " AS %s", 
pI‹m
->
zAlŸs
);

116450 ifÐ(
	gæags
 & (
	gWHERE_IPK
|
	gWHERE_VIRTUALTABLE
))==0 ){

116451 cÚ¡ *
zFmt
 = 0;

116452 
Index
 *
	gpIdx
;

116454 
as£¹
Ð
pLoÝ
->
u
.
bŒ“
.
pIndex
!=0 );

116455 
	gpIdx
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

116456 
as£¹
Ð!(
æags
&
WHERE_AUTO_INDEX
è|| (æags&
WHERE_IDX_ONLY
) );

116457 ifÐ!
HasRowid
(
pI‹m
->
pTab
è&& 
IsPrim¬yKeyIndex
(
pIdx
) ){

116458 ifÐ
	gisS—rch
 ){

116459 
	gzFmt
 = "PRIMARY KEY";

116461 }ifÐ
	gæags
 & 
	gWHERE_AUTO_INDEX
 ){

116462 
	gzFmt
 = "AUTOMATIC COVERING INDEX";

116463 }ifÐ
	gæags
 & 
	gWHERE_IDX_ONLY
 ){

116464 
	gzFmt
 = "COVERING INDEX %s";

116466 
	gzFmt
 = "INDEX %s";

116468 ifÐ
	gzFmt
 ){

116469 
sql™e3SŒAccumAµ’d
(&
¡r
, " USING ", 7);

116470 
sql™e3XPrštf
(&
¡r
, 0, 
zFmt
, 
pIdx
->
zName
);

116471 
ex¶ašIndexRªge
(&
¡r
, 
pLoÝ
, 
pI‹m
->
pTab
);

116473 }ifÐ(
	gæags
 & 
	gWHERE_IPK
)!=0 && (
æags
 & 
WHERE_CONSTRAINT
)!=0 ){

116474 cÚ¡ *
zRªge
;

116475 ifÐ
	gæags
&(
	gWHERE_COLUMN_EQ
|
	gWHERE_COLUMN_IN
) ){

116476 
	gzRªge
 = "(rowid=?)";

116477 }ifÐ(
	gæags
&
	gWHERE_BOTH_LIMIT
)==
WHERE_BOTH_LIMIT
 ){

116478 
zRªge
 = "(rowid>? AND„owid<?)";

116479 }ifÐ
	gæags
&
	gWHERE_BTM_LIMIT
 ){

116480 
	gzRªge
 = "(rowid>?)";

116482 
as£¹
Ð
æags
&
WHERE_TOP_LIMIT
);

116483 
	gzRªge
 = "(rowid<?)";

116485 
sql™e3SŒAccumAµ’dAÎ
(&
¡r
, " USING INTEGER PRIMARY KEY ");

116486 
sql™e3SŒAccumAµ’dAÎ
(&
¡r
, 
zRªge
);

116488 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


116489 ifÐ(
	gæags
 & 
	gWHERE_VIRTUALTABLE
)!=0 ){

116490 
sql™e3XPrštf
(&
¡r
, 0, " VIRTUAL TABLE INDEX %d:%s",

116491 
pLoÝ
->
u
.
vb
.
idxNum
,…LoÝ->u.vb.
idxSŒ
);

116494 #ifdeà
SQLITE_EXPLAIN_ESTIMATED_ROWS


116495 ifÐ
	gpLoÝ
->
	gnOut
>=10 ){

116496 
sql™e3XPrštf
(&
¡r
, 0, " (~%Îu„ows)", 
sql™e3LogE¡ToIÁ
(
pLoÝ
->
nOut
));

116498 
sql™e3SŒAccumAµ’d
(&
¡r
, " (~1„ow)", 9);

116501 
	gzMsg
 = 
sql™e3SŒAccumFšish
(&
¡r
);

116502 
sql™e3VdbeAddOp4
(
v
, 
OP_Ex¶aš
, 
iId
, 
iLev–
, 
iFrom
, 
zMsg
, 
P4_DYNAMIC
);

116506 
	#ex¶ašOÃSÿn
(
u
,
v
,
w
,
x
,
y
,
z
)

	)

116514 
B™mask
 
codeOÃLoÝS¹
(

116515 
Wh”eInfo
 *
pWInfo
,

116516 
iLev–
,

116517 
B™mask
 
nÙR—dy


116519 
	gj
, 
	gk
;

116520 
	giCur
;

116521 
	gaddrNxt
;

116522 
	gom™TabË
;

116523 
	gbRev
;

116524 
Wh”eLev–
 *
	gpLev–
;

116525 
Wh”eLoÝ
 *
	gpLoÝ
;

116526 
Wh”eCÏu£
 *
	gpWC
;

116527 
Wh”eT”m
 *
	gpT”m
;

116528 
P¬£
 *
	gpP¬£
;

116529 
sql™e3
 *
	gdb
;

116530 
Vdbe
 *
	gv
;

116531 
SrcLi¡_™em
 *
	gpTabI‹m
;

116532 
	gaddrBrk
;

116533 
	gaddrCÚt
;

116534 
	giRowidReg
 = 0;

116535 
	giR–—£Reg
 = 0;

116537 
	gpP¬£
 = 
pWInfo
->
pP¬£
;

116538 
	gv
 = 
pP¬£
->
pVdbe
;

116539 
	gpWC
 = &
pWInfo
->
sWC
;

116540 
	gdb
 = 
pP¬£
->
db
;

116541 
	gpLev–
 = &
pWInfo
->
a
[
iLev–
];

116542 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

116543 
	gpTabI‹m
 = &
pWInfo
->
pTabLi¡
->
a
[
pLev–
->
iFrom
];

116544 
	giCur
 = 
pTabI‹m
->
iCursÜ
;

116545 
	gpLev–
->
	gnÙR—dy
 = 
nÙR—dy
 & ~
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
iCur
);

116546 
	gbRev
 = (
pWInfo
->
»vMask
>>
iLev–
)&1;

116547 
	gom™TabË
 = (
pLoÝ
->
wsFÏgs
 & 
WHERE_IDX_ONLY
)!=0

116548 && (
pWInfo
->
wù¾FÏgs
 & 
WHERE_FORCE_TABLE
)==0;

116549 
VdbeModuËComm’t
((
v
, "Begš WHERE-loÝ%d: %s",
iLev–
,
pTabI‹m
->
pTab
->
zName
));

116561 
	gaddrBrk
 = 
pLev–
->
addrBrk
 =…Lev–->
addrNxt
 = 
sql™e3VdbeMakeLab–
(
v
);

116562 
	gaddrCÚt
 = 
pLev–
->
addrCÚt
 = 
sql™e3VdbeMakeLab–
(
v
);

116568 ifÐ
	gpLev–
->
	giFrom
>0 && (
	gpTabI‹m
[0].
	gjošty³
 & 
	gJT_LEFT
)!=0 ){

116569 
pLev–
->
iLeáJoš
 = ++
pP¬£
->
nMem
;

116570 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
pLev–
->
iLeáJoš
);

116571 
VdbeComm’t
((
v
, "init LEFT JOIN‚o-match flag"));

116575 ifÐ
	gpTabI‹m
->
	gvŸCÜoutše
 ){

116576 
	g»gY›ld
 = 
pTabI‹m
->
»gR‘uº
;

116577 
sql™e3VdbeAddOp3
(
v
, 
OP_In™CÜoutše
, 
»gY›ld
, 0, 
pTabI‹m
->
addrFžlSub
);

116578 
	gpLev–
->
	gp2
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_Y›ld
, 
»gY›ld
, 
addrBrk
);

116579 
VdbeCov”age
(
v
);

116580 
VdbeComm’t
((
v
, "Ãxˆrow oà\"%s\"", 
pTabI‹m
->
pTab
->
zName
));

116581 
	gpLev–
->
	gÝ
 = 
OP_GÙo
;

116584 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


116585 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
)!=0 ){

116589 
iReg
;

116590 
	gaddrNÙFound
;

116591 
	gnCÚ¡¿št
 = 
pLoÝ
->
nLT”m
;

116593 
sql™e3Ex´CachePush
(
pP¬£
);

116594 
	giReg
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nCÚ¡¿št
+2);

116595 
	gaddrNÙFound
 = 
pLev–
->
addrBrk
;

116596 
	gj
=0; j<
	gnCÚ¡¿št
; j++){

116597 
	giT¬g‘
 = 
iReg
+
j
+2;

116598 
	gpT”m
 = 
pLoÝ
->
aLT”m
[
j
];

116599 ifÐ
	gpT”m
==0 ) ;

116600 ifÐ
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_IN
 ){

116601 
codeEqu®™yT”m
(
pP¬£
, 
pT”m
, 
pLev–
, 
j
, 
bRev
, 
iT¬g‘
);

116602 
	gaddrNÙFound
 = 
pLev–
->
addrNxt
;

116604 
sql™e3Ex´Code
(
pP¬£
, 
pT”m
->
pEx´
->
pRight
, 
iT¬g‘
);

116607 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
pLoÝ
->
u
.
vb
.
idxNum
, 
iReg
);

116608 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 
nCÚ¡¿št
, 
iReg
+1);

116609 
sql™e3VdbeAddOp4
(
v
, 
OP_VFž‹r
, 
iCur
, 
addrNÙFound
, 
iReg
,

116610 
pLoÝ
->
u
.
vb
.
idxSŒ
,

116611 
pLoÝ
->
u
.
vb
.
ÃedF»e
 ? 
P4_MPRINTF
 : 
P4_STATIC
);

116612 
VdbeCov”age
(
v
);

116613 
	gpLoÝ
->
	gu
.
	gvb
.
	gÃedF»e
 = 0;

116614 
	gj
=0; j<
	gnCÚ¡¿št
 && j<16; j++){

116615 ifÐ(
	gpLoÝ
->
	gu
.
	gvb
.
	gom™Mask
>>
	gj
)&1 ){

116616 
di§bËT”m
(
pLev–
, 
pLoÝ
->
aLT”m
[
j
]);

116619 
	gpLev–
->
	gÝ
 = 
OP_VNext
;

116620 
	gpLev–
->
	gp1
 = 
iCur
;

116621 
	gpLev–
->
	gp2
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

116622 
sql™e3R–—£TempRªge
(
pP¬£
, 
iReg
, 
nCÚ¡¿št
+2);

116623 
sql™e3Ex´CachePÝ
(
pP¬£
);

116627 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_IPK
)!=0

116628 && (
pLoÝ
->
wsFÏgs
 & (
WHERE_COLUMN_IN
|
WHERE_COLUMN_EQ
))!=0

116635 
as£¹
Ð
pLoÝ
->
u
.
bŒ“
.
nEq
==1 );

116636 
	gpT”m
 = 
pLoÝ
->
aLT”m
[0];

116637 
as£¹
Ð
pT”m
!=0 );

116638 
as£¹
Ð
pT”m
->
pEx´
!=0 );

116639 
as£¹
Ð
om™TabË
==0 );

116640 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116641 
	giR–—£Reg
 = ++
pP¬£
->
nMem
;

116642 
	giRowidReg
 = 
codeEqu®™yT”m
(
pP¬£
, 
pT”m
, 
pLev–
, 0, 
bRev
, 
iR–—£Reg
);

116643 ifÐ
	giRowidReg
!=
iR–—£Reg
 ) 
sql™e3R–—£TempReg
(
pP¬£
, iReleaseReg);

116644 
	gaddrNxt
 = 
pLev–
->
addrNxt
;

116645 
sql™e3VdbeAddOp2
(
v
, 
OP_Mu¡BeIÁ
, 
iRowidReg
, 
addrNxt
); 
VdbeCov”age
(v);

116646 
sql™e3VdbeAddOp3
(
v
, 
OP_NÙExi¡s
, 
iCur
, 
addrNxt
, 
iRowidReg
);

116647 
VdbeCov”age
(
v
);

116648 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
iRowidReg
, 1);

116649 
sql™e3Ex´CacheStÜe
(
pP¬£
, 
iCur
, -1, 
iRowidReg
);

116650 
VdbeComm’t
((
v
, "pk"));

116651 
	gpLev–
->
	gÝ
 = 
OP_NoÝ
;

116652 }ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_IPK
)!=0

116653 && (
pLoÝ
->
wsFÏgs
 & 
WHERE_COLUMN_RANGE
)!=0

116657 
‹¡Op
 = 
OP_NoÝ
;

116658 
	g¡¬t
;

116659 
	gmemEndV®ue
 = 0;

116660 
Wh”eT”m
 *
	gpS¹
, *
	gpEnd
;

116662 
as£¹
Ð
om™TabË
==0 );

116663 
	gj
 = 0;

116664 
	gpS¹
 = 
pEnd
 = 0;

116665 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_BTM_LIMIT
 ) 
	gpS¹
 = 
pLoÝ
->
aLT”m
[
j
++];

116666 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_TOP_LIMIT
 ) 
	gpEnd
 = 
pLoÝ
->
aLT”m
[
j
++];

116667 
as£¹
Ð
pS¹
!=0 || 
pEnd
!=0 );

116668 ifÐ
	gbRev
 ){

116669 
	gpT”m
 = 
pS¹
;

116670 
	gpS¹
 = 
pEnd
;

116671 
	gpEnd
 = 
pT”m
;

116673 ifÐ
	gpS¹
 ){

116674 
Ex´
 *
	gpX
;

116675 
	gr1
, 
	grTemp
;

116680 cÚ¡ 
u8
 
	gaMoveOp
[] = {

116681  
OP_S“kGT
,

116682  
OP_S“kLE
,

116683  
OP_S“kLT
,

116684  
OP_S“kGE


116686 
as£¹
Ð
TK_LE
==
TK_GT
+1 );

116687 
as£¹
Ð
TK_LT
==
TK_GT
+2 );

116688 
as£¹
Ð
TK_GE
==
TK_GT
+3 );

116690 
as£¹
Ð(
pS¹
->
wtFÏgs
 & 
TERM_VNULL
)==0 );

116691 
‹¡ÿ£
Ð
pS¹
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116692 
	gpX
 = 
pS¹
->
pEx´
;

116693 
as£¹
Ð
pX
!=0 );

116694 
‹¡ÿ£
Ð
pS¹
->
ËáCursÜ
!=
iCur
 );

116695 
	gr1
 = 
sql™e3Ex´CodeTemp
(
pP¬£
, 
pX
->
pRight
, &
rTemp
);

116696 
sql™e3VdbeAddOp3
(
v
, 
aMoveOp
[
pX
->
Ý
-
TK_GT
], 
iCur
, 
addrBrk
, 
r1
);

116697 
VdbeComm’t
((
v
, "pk"));

116698 
VdbeCov”ageIf
(
v
, 
pX
->
Ý
==
TK_GT
);

116699 
VdbeCov”ageIf
(
v
, 
pX
->
Ý
==
TK_LE
);

116700 
VdbeCov”ageIf
(
v
, 
pX
->
Ý
==
TK_LT
);

116701 
VdbeCov”ageIf
(
v
, 
pX
->
Ý
==
TK_GE
);

116702 
sql™e3Ex´CacheAffš™yChªge
(
pP¬£
, 
r1
, 1);

116703 
sql™e3R–—£TempReg
(
pP¬£
, 
rTemp
);

116704 
di§bËT”m
(
pLev–
, 
pS¹
);

116706 
sql™e3VdbeAddOp2
(
v
, 
bRev
 ? 
OP_La¡
 : 
OP_Rewšd
, 
iCur
, 
addrBrk
);

116707 
VdbeCov”ageIf
(
v
, 
bRev
==0);

116708 
VdbeCov”ageIf
(
v
, 
bRev
!=0);

116710 ifÐ
	gpEnd
 ){

116711 
Ex´
 *
	gpX
;

116712 
	gpX
 = 
pEnd
->
pEx´
;

116713 
as£¹
Ð
pX
!=0 );

116714 
as£¹
Ð(
pEnd
->
wtFÏgs
 & 
TERM_VNULL
)==0 );

116715 
‹¡ÿ£
Ð
pEnd
->
ËáCursÜ
!=
iCur
 );

116716 
‹¡ÿ£
Ð
pEnd
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116717 
	gmemEndV®ue
 = ++
pP¬£
->
nMem
;

116718 
sql™e3Ex´Code
(
pP¬£
, 
pX
->
pRight
, 
memEndV®ue
);

116719 ifÐ
	gpX
->
	gÝ
==
TK_LT
 || 
pX
->
Ý
==
TK_GT
 ){

116720 
‹¡Op
 = 
bRev
 ? 
OP_Le
 : 
OP_Ge
;

116722 
	g‹¡Op
 = 
bRev
 ? 
OP_Lt
 : 
OP_Gt
;

116724 
di§bËT”m
(
pLev–
, 
pEnd
);

116726 
	g¡¬t
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

116727 
	gpLev–
->
	gÝ
 = 
bRev
 ? 
OP_P»v
 : 
OP_Next
;

116728 
	gpLev–
->
	gp1
 = 
iCur
;

116729 
	gpLev–
->
	gp2
 = 
¡¬t
;

116730 
as£¹
Ð
pLev–
->
p5
==0 );

116731 ifÐ
	g‹¡Op
!=
OP_NoÝ
 ){

116732 
iRowidReg
 = ++
pP¬£
->
nMem
;

116733 
sql™e3VdbeAddOp2
(
v
, 
OP_Rowid
, 
iCur
, 
iRowidReg
);

116734 
sql™e3Ex´CacheStÜe
(
pP¬£
, 
iCur
, -1, 
iRowidReg
);

116735 
sql™e3VdbeAddOp3
(
v
, 
‹¡Op
, 
memEndV®ue
, 
addrBrk
, 
iRowidReg
);

116736 
VdbeCov”ageIf
(
v
, 
‹¡Op
==
OP_Le
);

116737 
VdbeCov”ageIf
(
v
, 
‹¡Op
==
OP_Lt
);

116738 
VdbeCov”ageIf
(
v
, 
‹¡Op
==
OP_Ge
);

116739 
VdbeCov”ageIf
(
v
, 
‹¡Op
==
OP_Gt
);

116740 
sql™e3VdbeChªgeP5
(
v
, 
SQLITE_AFF_NUMERIC
 | 
SQLITE_JUMPIFNULL
);

116742 }ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
 ){

116774 cÚ¡ 
u8
 
	gaS¹Op
[] = {

116777 
OP_Rewšd
,

116778 
OP_La¡
,

116779 
OP_S“kGT
,

116780 
OP_S“kLT
,

116781 
OP_S“kGE
,

116782 
OP_S“kLE


116784 cÚ¡ 
u8
 
	gaEndOp
[] = {

116785 
OP_IdxGE
,

116786 
OP_IdxGT
,

116787 
OP_IdxLE
,

116788 
OP_IdxLT
,

116790 
u16
 
	gnEq
 = 
pLoÝ
->
u
.
bŒ“
.
nEq
;

116791 
	g»gBa£
;

116792 
Wh”eT”m
 *
	gpRªgeS¹
 = 0;

116793 
Wh”eT”m
 *
	gpRªgeEnd
 = 0;

116794 
	g¡¬tEq
;

116795 
	g’dEq
;

116796 
	g¡¬t_cÚ¡¿šts
;

116797 
	gnCÚ¡¿št
;

116798 
Index
 *
	gpIdx
;

116799 
	giIdxCur
;

116800 
	gnExŒaReg
 = 0;

116801 
	gÝ
;

116802 *
	gzS¹Aff
;

116803 
	gcEndAff
 = 0;

116804 
u8
 
	gbS“kPa¡NuÎ
 = 0;

116805 
u8
 
	gbStÝAtNuÎ
 = 0;

116807 
	gpIdx
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

116808 
	giIdxCur
 = 
pLev–
->
iIdxCur
;

116809 
as£¹
Ð
nEq
>=
pLoÝ
->
u
.
bŒ“
.
nSk
 );

116819 
as£¹
Ð
pWInfo
->
pOrd”By
==0

116820 || 
pWInfo
->
pOrd”By
->
nEx´
==1

116821 || (
pWInfo
->
wù¾FÏgs
&
WHERE_ORDERBY_MIN
)==0 );

116822 ifÐ(
	gpWInfo
->
	gwù¾FÏgs
&
	gWHERE_ORDERBY_MIN
)!=0

116823 && 
pWInfo
->
nOBS©
>0

116824 && (
pIdx
->
nKeyCÞ
>
nEq
)

116826 
as£¹
Ð
pLoÝ
->
u
.
bŒ“
.
nSk
==0 );

116827 
	gbS“kPa¡NuÎ
 = 1;

116828 
	gnExŒaReg
 = 1;

116834 
	gj
 = 
nEq
;

116835 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_BTM_LIMIT
 ){

116836 
	gpRªgeS¹
 = 
pLoÝ
->
aLT”m
[
j
++];

116837 
	gnExŒaReg
 = 1;

116839 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_TOP_LIMIT
 ){

116840 
	gpRªgeEnd
 = 
pLoÝ
->
aLT”m
[
j
++];

116841 
	gnExŒaReg
 = 1;

116842 ifÐ
	gpRªgeS¹
==0

116843 && (
j
 = 
pIdx
->
aiCÞumn
[
nEq
])>=0

116844 && 
pIdx
->
pTabË
->
aCÞ
[
j
].
nÙNuÎ
==0

116846 
bS“kPa¡NuÎ
 = 1;

116849 
as£¹
Ð
pRªgeEnd
==0 || (pRªgeEnd->
wtFÏgs
 & 
TERM_VNULL
)==0 );

116855 
	g»gBa£
 = 
codeAÎEqu®™yT”ms
(
pP¬£
,
pLev–
,
bRev
,
nExŒaReg
,&
zS¹Aff
);

116856 
as£¹
Ð
zS¹Aff
==0 || 
sql™e3SŒËn30
(zS¹Aff)>=
nEq
 );

116857 ifÐ
	gzS¹Aff
 ) 
	gcEndAff
 = 
zS¹Aff
[
nEq
];

116858 
	gaddrNxt
 = 
pLev–
->
addrNxt
;

116864 ifÐ(
	gnEq
<
	gpIdx
->
	gnKeyCÞ
 && 
	gbRev
==(
pIdx
->
aSÜtOrd”
[
nEq
]==
SQLITE_SO_ASC
))

116865 || (
bRev
 && 
pIdx
->
nKeyCÞ
==
nEq
)

116867 
SWAP
(
Wh”eT”m
 *, 
pRªgeEnd
, 
pRªgeS¹
);

116868 
SWAP
(
u8
, 
bS“kPa¡NuÎ
, 
bStÝAtNuÎ
);

116871 
‹¡ÿ£
Ð
pRªgeS¹
 && (pRªgeS¹->
eO³¿tÜ
 & 
WO_LE
)!=0 );

116872 
‹¡ÿ£
Ð
pRªgeS¹
 && (pRªgeS¹->
eO³¿tÜ
 & 
WO_GE
)!=0 );

116873 
‹¡ÿ£
Ð
pRªgeEnd
 && (pRªgeEnd->
eO³¿tÜ
 & 
WO_LE
)!=0 );

116874 
‹¡ÿ£
Ð
pRªgeEnd
 && (pRªgeEnd->
eO³¿tÜ
 & 
WO_GE
)!=0 );

116875 
	g¡¬tEq
 = !
pRªgeS¹
 ||…RªgeS¹->
eO³¿tÜ
 & (
WO_LE
|
WO_GE
);

116876 
	g’dEq
 = !
pRªgeEnd
 ||…RªgeEnd->
eO³¿tÜ
 & (
WO_LE
|
WO_GE
);

116877 
	g¡¬t_cÚ¡¿šts
 = 
pRªgeS¹
 || 
nEq
>0;

116880 
	gnCÚ¡¿št
 = 
nEq
;

116881 ifÐ
	gpRªgeS¹
 ){

116882 
Ex´
 *
	gpRight
 = 
pRªgeS¹
->
pEx´
->
pRight
;

116883 
sql™e3Ex´Code
(
pP¬£
, 
pRight
, 
»gBa£
+
nEq
);

116884 ifÐ(
	gpRªgeS¹
->
	gwtFÏgs
 & 
	gTERM_VNULL
)==0

116885 && 
sql™e3Ex´CªBeNuÎ
(
pRight
)

116887 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gBa£
+
nEq
, 
addrNxt
);

116888 
VdbeCov”age
(
v
);

116890 ifÐ
	gzS¹Aff
 ){

116891 ifÐ
sql™e3Com·»Affš™y
(
pRight
, 
zS¹Aff
[
nEq
])==
SQLITE_AFF_NONE
){

116895 
zS¹Aff
[
nEq
] = 
SQLITE_AFF_NONE
;

116897 ifÐ
sql™e3Ex´N“dsNoAffš™yChªge
(
pRight
, 
zS¹Aff
[
nEq
]) ){

116898 
	gzS¹Aff
[
nEq
] = 
SQLITE_AFF_NONE
;

116901 
	gnCÚ¡¿št
++;

116902 
‹¡ÿ£
Ð
pRªgeS¹
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116903 }ifÐ
	gbS“kPa¡NuÎ
 ){

116904 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gBa£
+
nEq
);

116905 
	gnCÚ¡¿št
++;

116906 
	g¡¬tEq
 = 0;

116907 
	g¡¬t_cÚ¡¿šts
 = 1;

116909 
codeAµlyAffš™y
(
pP¬£
, 
»gBa£
, 
nCÚ¡¿št
 - 
bS“kPa¡NuÎ
, 
zS¹Aff
);

116910 
	gÝ
 = 
aS¹Op
[(
¡¬t_cÚ¡¿šts
<<2è+ (
¡¬tEq
<<1è+ 
bRev
];

116911 
as£¹
Ð
Ý
!=0 );

116912 
sql™e3VdbeAddOp4IÁ
(
v
, 
Ý
, 
iIdxCur
, 
addrNxt
, 
»gBa£
, 
nCÚ¡¿št
);

116913 
VdbeCov”age
(
v
);

116914 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_Rewšd
); 
‹¡ÿ£
( op==OP_Rewind );

116915 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_La¡
); 
‹¡ÿ£
( op==OP_Last );

116916 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_S“kGT
); 
‹¡ÿ£
( op==OP_SeekGT );

116917 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_S“kGE
); 
‹¡ÿ£
( op==OP_SeekGE );

116918 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_S“kLE
); 
‹¡ÿ£
( op==OP_SeekLE );

116919 
VdbeCov”ageIf
(
v
, 
Ý
==
OP_S“kLT
); 
‹¡ÿ£
( op==OP_SeekLT );

116924 
	gnCÚ¡¿št
 = 
nEq
;

116925 ifÐ
	gpRªgeEnd
 ){

116926 
Ex´
 *
	gpRight
 = 
pRªgeEnd
->
pEx´
->
pRight
;

116927 
sql™e3Ex´CacheRemove
(
pP¬£
, 
»gBa£
+
nEq
, 1);

116928 
sql™e3Ex´Code
(
pP¬£
, 
pRight
, 
»gBa£
+
nEq
);

116929 ifÐ(
	gpRªgeEnd
->
	gwtFÏgs
 & 
	gTERM_VNULL
)==0

116930 && 
sql™e3Ex´CªBeNuÎ
(
pRight
)

116932 
sql™e3VdbeAddOp2
(
v
, 
OP_IsNuÎ
, 
»gBa£
+
nEq
, 
addrNxt
);

116933 
VdbeCov”age
(
v
);

116935 ifÐ
sql™e3Com·»Affš™y
(
pRight
, 
cEndAff
)!=
SQLITE_AFF_NONE


116936 && !
sql™e3Ex´N“dsNoAffš™yChªge
(
pRight
, 
cEndAff
)

116938 
codeAµlyAffš™y
(
pP¬£
, 
»gBa£
+
nEq
, 1, &
cEndAff
);

116940 
	gnCÚ¡¿št
++;

116941 
‹¡ÿ£
Ð
pRªgeEnd
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

116942 }ifÐ
	gbStÝAtNuÎ
 ){

116943 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gBa£
+
nEq
);

116944 
	g’dEq
 = 0;

116945 
	gnCÚ¡¿št
++;

116947 
sql™e3DbF»e
(
db
, 
zS¹Aff
);

116950 
	gpLev–
->
	gp2
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

116953 ifÐ
	gnCÚ¡¿št
 ){

116954 
	gÝ
 = 
aEndOp
[
bRev
*2 + 
’dEq
];

116955 
sql™e3VdbeAddOp4IÁ
(
v
, 
Ý
, 
iIdxCur
, 
addrNxt
, 
»gBa£
, 
nCÚ¡¿št
);

116956 
‹¡ÿ£
Ð
Ý
==
OP_IdxGT
 ); 
VdbeCov”ageIf
(
v
, op==OP_IdxGT );

116957 
‹¡ÿ£
Ð
Ý
==
OP_IdxGE
 ); 
VdbeCov”ageIf
(
v
, op==OP_IdxGE );

116958 
‹¡ÿ£
Ð
Ý
==
OP_IdxLT
 ); 
VdbeCov”ageIf
(
v
, op==OP_IdxLT );

116959 
‹¡ÿ£
Ð
Ý
==
OP_IdxLE
 ); 
VdbeCov”ageIf
(
v
, op==OP_IdxLE );

116963 
di§bËT”m
(
pLev–
, 
pRªgeS¹
);

116964 
di§bËT”m
(
pLev–
, 
pRªgeEnd
);

116965 ifÐ
	gom™TabË
 ){

116967 }ifÐ
HasRowid
(
pIdx
->
pTabË
) ){

116968 
	giRowidReg
 = ++
pP¬£
->
nMem
;

116969 
sql™e3VdbeAddOp2
(
v
, 
OP_IdxRowid
, 
iIdxCur
, 
iRowidReg
);

116970 
sql™e3Ex´CacheStÜe
(
pP¬£
, 
iCur
, -1, 
iRowidReg
);

116971 
sql™e3VdbeAddOp2
(
v
, 
OP_S“k
, 
iCur
, 
iRowidReg
);

116972 }ifÐ
	giCur
!=
iIdxCur
 ){

116973 
Index
 *
pPk
 = 
sql™e3Prim¬yKeyIndex
(
pIdx
->
pTabË
);

116974 
	giRowidReg
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
pPk
->
nKeyCÞ
);

116975 
	gj
=0; j<
	gpPk
->
	gnKeyCÞ
; j++){

116976 
	gk
 = 
sql™e3CÞumnOfIndex
(
pIdx
, 
pPk
->
aiCÞumn
[
j
]);

116977 
sql™e3VdbeAddOp3
(
v
, 
OP_CÞumn
, 
iIdxCur
, 
k
, 
iRowidReg
+
j
);

116979 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_NÙFound
, 
iCur
, 
addrCÚt
,

116980 
iRowidReg
, 
pPk
->
nKeyCÞ
); 
VdbeCov”age
(
v
);

116986 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_ONEROW
 ){

116987 
	gpLev–
->
	gÝ
 = 
OP_NoÝ
;

116988 }ifÐ
	gbRev
 ){

116989 
	gpLev–
->
	gÝ
 = 
OP_P»v
;

116991 
	gpLev–
->
	gÝ
 = 
OP_Next
;

116993 
	gpLev–
->
	gp1
 = 
iIdxCur
;

116994 
	gpLev–
->
	gp3
 = (
pLoÝ
->
wsFÏgs
&
WHERE_UNQ_WANTED
)!=0 ? 1:0;

116995 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_CONSTRAINT
)==0 ){

116996 
pLev–
->
p5
 = 
SQLITE_STMTSTATUS_FULLSCAN_STEP
;

116998 
as£¹
Ð
pLev–
->
p5
==0 );

117002 #iâdeà
SQLITE_OMIT_OR_OPTIMIZATION


117003 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_MULTI_OR
 ){

117047 
Wh”eCÏu£
 *
	gpOrWc
;

117048 
SrcLi¡
 *
	gpOrTab
;

117049 
Index
 *
	gpCov
 = 0;

117050 
	giCovCur
 = 
pP¬£
->
nTab
++;

117052 
	g»gR‘uº
 = ++
pP¬£
->
nMem
;

117053 
	g»gRow£t
 = 0;

117054 
	g»gRowid
 = 0;

117055 
	giLoÝBody
 = 
sql™e3VdbeMakeLab–
(
v
);

117056 
	giR‘In™
;

117057 
	guÁe¡edT”ms
 = 0;

117058 
	gii
;

117059 
u16
 
	gwù¾FÏgs
;

117060 
Ex´
 *
	gpAndEx´
 = 0;

117061 
TabË
 *
	gpTab
 = 
pTabI‹m
->
pTab
;

117063 
	gpT”m
 = 
pLoÝ
->
aLT”m
[0];

117064 
as£¹
Ð
pT”m
!=0 );

117065 
as£¹
Ð
pT”m
->
eO³¿tÜ
 & 
WO_OR
 );

117066 
as£¹
Ð(
pT”m
->
wtFÏgs
 & 
TERM_ORINFO
)!=0 );

117067 
	gpOrWc
 = &
pT”m
->
u
.
pOrInfo
->
wc
;

117068 
	gpLev–
->
	gÝ
 = 
OP_R‘uº
;

117069 
	gpLev–
->
	gp1
 = 
»gR‘uº
;

117075 ifÐ
	gpWInfo
->
	gnLev–
>1 ){

117076 
	gnNÙR—dy
;

117077 
SrcLi¡_™em
 *
	gÜigSrc
;

117078 
	gnNÙR—dy
 = 
pWInfo
->
nLev–
 - 
iLev–
 - 1;

117079 
	gpOrTab
 = 
sql™e3SckAÎocRaw
(
db
,

117080 (*
pOrTab
)+ 
nNÙR—dy
*ÕOrTab->
a
[0]));

117081 ifÐ
	gpOrTab
==0 )  
nÙR—dy
;

117082 
	gpOrTab
->
	gnAÎoc
 = (
u8
)(
nNÙR—dy
 + 1);

117083 
	gpOrTab
->
	gnSrc
 = 
pOrTab
->
nAÎoc
;

117084 
memýy
(
pOrTab
->
a
, 
pTabI‹m
, (*pTabItem));

117085 
	gÜigSrc
 = 
pWInfo
->
pTabLi¡
->
a
;

117086 
	gk
=1; k<=
nNÙR—dy
; k++){

117087 
memýy
(&
pOrTab
->
a
[
k
], &
ÜigSrc
[
pLev–
[k].
iFrom
], (pOrTab->a[k]));

117090 
	gpOrTab
 = 
pWInfo
->
pTabLi¡
;

117105 ifÐ(
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_DUPLICATES_OK
)==0 ){

117106 ifÐ
HasRowid
(
pTab
) ){

117107 
»gRow£t
 = ++
pP¬£
->
nMem
;

117108 
sql™e3VdbeAddOp2
(
v
, 
OP_NuÎ
, 0, 
»gRow£t
);

117110 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

117111 
	g»gRow£t
 = 
pP¬£
->
nTab
++;

117112 
sql™e3VdbeAddOp2
(
v
, 
OP_O³nEphem”®
, 
»gRow£t
, 
pPk
->
nKeyCÞ
);

117113 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pPk
);

117115 
	g»gRowid
 = ++
pP¬£
->
nMem
;

117117 
	giR‘In™
 = 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 0, 
»gR‘uº
);

117133 ifÐ
	gpWC
->
	gnT”m
>1 ){

117134 
	giT”m
;

117135 
	giT”m
=0; iT”m<
	gpWC
->
	gnT”m
; iTerm++){

117136 
Ex´
 *
	gpEx´
 = 
pWC
->
a
[
iT”m
].
pEx´
;

117137 ifÐ&
	gpWC
->
	ga
[
iT”m
] =ð
pT”m
 ) ;

117138 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_FromJoš
) ) ;

117139 
‹¡ÿ£
Ð
pWC
->
a
[
iT”m
].
wtFÏgs
 & 
TERM_ORINFO
 );

117140 
‹¡ÿ£
Ð
pWC
->
a
[
iT”m
].
wtFÏgs
 & 
TERM_VIRTUAL
 );

117141 ifÐ
	gpWC
->
	ga
[
iT”m
].
	gwtFÏgs
 & (
	gTERM_ORINFO
|
	gTERM_VIRTUAL
) ) ;

117142 ifÐ(
	gpWC
->
	ga
[
iT”m
].
	geO³¿tÜ
 & 
	gWO_ALL
)==0 ) ;

117143 
	gpEx´
 = 
sql™e3Ex´Dup
(
db
, 
pEx´
, 0);

117144 
	gpAndEx´
 = 
sql™e3Ex´And
(
db
, 
pAndEx´
, 
pEx´
);

117146 ifÐ
	gpAndEx´
 ){

117147 
	gpAndEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_AND
, 0, 
pAndEx´
, 0);

117155 
	gwù¾FÏgs
 = 
WHERE_OMIT_OPEN_CLOSE


117156 | 
WHERE_FORCE_TABLE


117157 | 
WHERE_ONETABLE_ONLY
;

117158 
	gii
=0; ii<
	gpOrWc
->
	gnT”m
; ii++){

117159 
Wh”eT”m
 *
	gpOrT”m
 = &
pOrWc
->
a
[
ii
];

117160 ifÐ
	gpOrT”m
->
	gËáCursÜ
==
iCur
 || (
pOrT”m
->
eO³¿tÜ
 & 
WO_AND
)!=0 ){

117161 
Wh”eInfo
 *
pSubWInfo
;

117162 
Ex´
 *
	gpOrEx´
 = 
pOrT”m
->
pEx´
;

117163 
	gj1
 = 0;

117164 ifÐ
	gpAndEx´
 && !
Ex´HasPrÝ”ty
(
pOrEx´
, 
EP_FromJoš
) ){

117165 
	gpAndEx´
->
	gpLeá
 = 
pOrEx´
;

117166 
	gpOrEx´
 = 
pAndEx´
;

117169 
WHERETRACE
(0xffff, ("Subplan for OR-clause:\n"));

117170 
	gpSubWInfo
 = 
sql™e3Wh”eBegš
(
pP¬£
, 
pOrTab
, 
pOrEx´
, 0, 0,

117171 
wù¾FÏgs
, 
iCovCur
);

117172 
as£¹
Ð
pSubWInfo
 || 
pP¬£
->
nE¼
 || 
db
->
m®locFažed
 );

117173 ifÐ
	gpSubWInfo
 ){

117174 
Wh”eLoÝ
 *
	gpSubLoÝ
;

117175 
ex¶ašOÃSÿn
(

117176 
pP¬£
, 
pOrTab
, &
pSubWInfo
->
a
[0], 
iLev–
, 
pLev–
->
iFrom
, 0

117183 ifÐ(
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_DUPLICATES_OK
)==0 ){

117184 
r
;

117185 
	giS‘
 = ((
ii
==
pOrWc
->
nT”m
-1)?-1:ii);

117186 ifÐ
HasRowid
(
pTab
) ){

117187 
	gr
 = 
sql™e3Ex´CodeG‘CÞumn
(
pP¬£
, 
pTab
, -1, 
iCur
, 
»gRowid
, 0);

117188 
	gj1
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_RowS‘Te¡
, 
»gRow£t
, 0, 
r
,
iS‘
);

117189 
VdbeCov”age
(
v
);

117191 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

117192 
	gnPk
 = 
pPk
->
nKeyCÞ
;

117193 
	giPk
;

117196 
	gr
 = 
sql™e3G‘TempRªge
(
pP¬£
, 
nPk
);

117197 
	giPk
=0; iPk<
	gnPk
; iPk++){

117198 
	giCÞ
 = 
pPk
->
aiCÞumn
[
iPk
];

117199 
sql™e3Ex´CodeG‘CÞumn
(
pP¬£
, 
pTab
, 
iCÞ
, 
iCur
, 
r
+
iPk
, 0);

117213 ifÐ
	giS‘
 ){

117214 
	gj1
 = 
sql™e3VdbeAddOp4IÁ
(
v
, 
OP_Found
, 
»gRow£t
, 0, 
r
, 
nPk
);

117215 
VdbeCov”age
(
v
);

117217 ifÐ
	giS‘
>=0 ){

117218 
sql™e3VdbeAddOp3
(
v
, 
OP_MakeRecÜd
, 
r
, 
nPk
, 
»gRowid
);

117219 
sql™e3VdbeAddOp3
(
v
, 
OP_IdxIn£¹
, 
»gRow£t
, 
»gRowid
, 0);

117220 ifÐ
	giS‘
 ) 
sql™e3VdbeChªgeP5
(
v
, 
OPFLAG_USESEEKRESULT
);

117224 
sql™e3R–—£TempRªge
(
pP¬£
, 
r
, 
nPk
);

117229 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
»gR‘uº
, 
iLoÝBody
);

117233 ifÐ
	gj1
 ) 
sql™e3VdbeJumpH”e
(
v
, 
j1
);

117240 ifÐ
	gpSubWInfo
->
	guÁe¡edT”ms
 ) untestedTerms = 1;

117254 
	gpSubLoÝ
 = 
pSubWInfo
->
a
[0].
pWLoÝ
;

117255 
as£¹
Ð(
pSubLoÝ
->
wsFÏgs
 & 
WHERE_AUTO_INDEX
)==0 );

117256 ifÐ(
	gpSubLoÝ
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
)!=0

117257 && (
ii
==0 || 
pSubLoÝ
->
u
.
bŒ“
.
pIndex
==
pCov
)

117258 && (
HasRowid
(
pTab
è|| !
IsPrim¬yKeyIndex
(
pSubLoÝ
->
u
.
bŒ“
.
pIndex
))

117260 
as£¹
Ð
pSubWInfo
->
a
[0].
iIdxCur
==
iCovCur
 );

117261 
	gpCov
 = 
pSubLoÝ
->
u
.
bŒ“
.
pIndex
;

117262 
	gwù¾FÏgs
 |ð
WHERE_REOPEN_IDX
;

117264 
	gpCov
 = 0;

117268 
sql™e3Wh”eEnd
(
pSubWInfo
);

117272 
	gpLev–
->
	gu
.
	gpCovidx
 = 
pCov
;

117273 ifÐ
	gpCov
 ) 
	gpLev–
->
	giIdxCur
 = 
iCovCur
;

117274 ifÐ
	gpAndEx´
 ){

117275 
	gpAndEx´
->
	gpLeá
 = 0;

117276 
sql™e3Ex´D–‘e
(
db
, 
pAndEx´
);

117278 
sql™e3VdbeChªgeP1
(
v
, 
iR‘In™
, 
sql™e3VdbeCu¼’tAddr
(v));

117279 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
pLev–
->
addrBrk
);

117280 
sql™e3VdbeResÞveLab–
(
v
, 
iLoÝBody
);

117282 ifÐ
	gpWInfo
->
	gnLev–
>1 ) 
sql™e3SckF»e
(
db
, 
pOrTab
);

117283 ifÐ!
	guÁe¡edT”ms
 ) 
di§bËT”m
(
pLev–
, 
pT”m
);

117291 cÚ¡ 
u8
 
	gaS‹p
[] = { 
OP_Next
, 
OP_P»v
 };

117292 cÚ¡ 
u8
 
	gaS¹
[] = { 
OP_Rewšd
, 
OP_La¡
 };

117293 
as£¹
Ð
bRev
==0 || bRev==1 );

117294 ifÐ
	gpTabI‹m
->
	gisRecursive
 ){

117297 
	gpLev–
->
	gÝ
 = 
OP_NoÝ
;

117299 
	gpLev–
->
	gÝ
 = 
aS‹p
[
bRev
];

117300 
	gpLev–
->
	gp1
 = 
iCur
;

117301 
	gpLev–
->
	gp2
 = 1 + 
sql™e3VdbeAddOp2
(
v
, 
aS¹
[
bRev
], 
iCur
, 
addrBrk
);

117302 
VdbeCov”ageIf
(
v
, 
bRev
==0);

117303 
VdbeCov”ageIf
(
v
, 
bRev
!=0);

117304 
	gpLev–
->
	gp5
 = 
SQLITE_STMTSTATUS_FULLSCAN_STEP
;

117311 
	gpT”m
=
pWC
->
a
, 
	gj
õWC->
nT”m
; j>0; j--,…Term++){

117312 
Ex´
 *
	gpE
;

117313 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

117314 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_CODED
 );

117315 ifÐ
	gpT”m
->
	gwtFÏgs
 & (
	gTERM_VIRTUAL
|
	gTERM_CODED
) ) ;

117316 ifÐ(
	gpT”m
->
	g´”eqAÎ
 & 
	gpLev–
->
	gnÙR—dy
)!=0 ){

117317 
‹¡ÿ£
Ð
pWInfo
->
uÁe¡edT”ms
==0

117318 && (
pWInfo
->
wù¾FÏgs
 & 
WHERE_ONETABLE_ONLY
)!=0 );

117319 
	gpWInfo
->
	guÁe¡edT”ms
 = 1;

117322 
	gpE
 = 
pT”m
->
pEx´
;

117323 
as£¹
Ð
pE
!=0 );

117324 ifÐ
	gpLev–
->
	giLeáJoš
 && !
Ex´HasPrÝ”ty
(
pE
, 
EP_FromJoš
) ){

117327 
sql™e3Ex´IfF®£
(
pP¬£
, 
pE
, 
addrCÚt
, 
SQLITE_JUMPIFNULL
);

117328 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_CODED
;

117339 
	gpT”m
=
pWC
->
a
, 
	gj
õWC->
nT”m
; j>0; j--,…Term++){

117340 
Ex´
 *
	gpE
, *
	gpEAÉ
;

117341 
Wh”eT”m
 *
	gpAÉ
;

117342 ifÐ
	gpT”m
->
	gwtFÏgs
 & (
	gTERM_VIRTUAL
|
	gTERM_CODED
) ) ;

117343 ifÐ
	gpT”m
->
	geO³¿tÜ
!=(
WO_EQUIV
|
WO_EQ
) ) ;

117344 ifÐ
	gpT”m
->
	gËáCursÜ
!=
iCur
 ) ;

117345 ifÐ
	gpLev–
->
	giLeáJoš
 ) ;

117346 
	gpE
 = 
pT”m
->
pEx´
;

117347 
as£¹
Ð!
Ex´HasPrÝ”ty
(
pE
, 
EP_FromJoš
) );

117348 
as£¹
Ð(
pT”m
->
´”eqRight
 & 
pLev–
->
nÙR—dy
)!=0 );

117349 
	gpAÉ
 = 
fšdT”m
(
pWC
, 
iCur
, 
pT”m
->
u
.
ËáCÞumn
, 
nÙR—dy
, 
WO_EQ
|
WO_IN
, 0);

117350 ifÐ
	gpAÉ
==0 ) ;

117351 ifÐ
	gpAÉ
->
	gwtFÏgs
 & (
	gTERM_CODED
) ) ;

117352 
‹¡ÿ£
Ð
pAÉ
->
eO³¿tÜ
 & 
WO_EQ
 );

117353 
‹¡ÿ£
Ð
pAÉ
->
eO³¿tÜ
 & 
WO_IN
 );

117354 
VdbeModuËComm’t
((
v
, "beginransitive constraint"));

117355 
	gpEAÉ
 = 
sql™e3SckAÎocRaw
(
db
, (*
pEAÉ
));

117356 ifÐ
	gpEAÉ
 ){

117357 *
	gpEAÉ
 = *
pAÉ
->
pEx´
;

117358 
	gpEAÉ
->
	gpLeá
 = 
pE
->
pLeá
;

117359 
sql™e3Ex´IfF®£
(
pP¬£
, 
pEAÉ
, 
addrCÚt
, 
SQLITE_JUMPIFNULL
);

117360 
sql™e3SckF»e
(
db
, 
pEAÉ
);

117367 ifÐ
	gpLev–
->
	giLeáJoš
 ){

117368 
	gpLev–
->
	gaddrFœ¡
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

117369 
sql™e3VdbeAddOp2
(
v
, 
OP_IÁeg”
, 1, 
pLev–
->
iLeáJoš
);

117370 
VdbeComm’t
((
v
, "record LEFT JOIN hit"));

117371 
sql™e3Ex´CacheCË¬
(
pP¬£
);

117372 
	gpT”m
=
pWC
->
a
, 
	gj
=0; j<
	gpWC
->
	gnT”m
; j++,…Term++){

117373 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_VIRTUAL
 );

117374 
‹¡ÿ£
Ð
pT”m
->
wtFÏgs
 & 
TERM_CODED
 );

117375 ifÐ
	gpT”m
->
	gwtFÏgs
 & (
	gTERM_VIRTUAL
|
	gTERM_CODED
) ) ;

117376 ifÐ(
	gpT”m
->
	g´”eqAÎ
 & 
	gpLev–
->
	gnÙR—dy
)!=0 ){

117377 
as£¹
Ð
pWInfo
->
uÁe¡edT”ms
 );

117380 
as£¹
Ð
pT”m
->
pEx´
 );

117381 
sql™e3Ex´IfF®£
(
pP¬£
, 
pT”m
->
pEx´
, 
addrCÚt
, 
SQLITE_JUMPIFNULL
);

117382 
	gpT”m
->
	gwtFÏgs
 |ð
TERM_CODED
;

117386  
	gpLev–
->
	gnÙR—dy
;

117389 #ifdeà
WHERETRACE_ENABLED


117393 
wh”eT”mPršt
(
Wh”eT”m
 *
pT”m
, 
iT”m
){

117394 ifÐ
	gpT”m
==0 ){

117395 
sql™e3DebugPrštf
("TERM-%-3d NULL\n", 
iT”m
);

117397 
	gzTy³
[4];

117398 
memýy
(
zTy³
, "...", 4);

117399 ifÐ
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_VIRTUAL
 ) 
	gzTy³
[0] = 'V';

117400 ifÐ
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_EQUIV
 ) 
	gzTy³
[1] = 'E';

117401 ifÐ
Ex´HasPrÝ”ty
(
pT”m
->
pEx´
, 
EP_FromJoš
èè
	gzTy³
[2] = 'L';

117402 
sql™e3DebugPrštf
("TERM-%-3d %p %s cursor=%-3d…rob=%-3d op=0x%03x\n",

117403 
iT”m
, 
pT”m
, 
zTy³
,…T”m->
ËáCursÜ
,…T”m->
ŒuthProb
,

117404 
pT”m
->
eO³¿tÜ
);

117405 
sql™e3T»eV›wEx´
(0, 
pT”m
->
pEx´
, 0);

117410 #ifdeà
WHERETRACE_ENABLED


117414 
wh”eLoÝPršt
(
Wh”eLoÝ
 *
p
, 
Wh”eCÏu£
 *
pWC
){

117415 
Wh”eInfo
 *
	gpWInfo
 = 
pWC
->
pWInfo
;

117416 
	gnb
 = 1+(
pWInfo
->
pTabLi¡
->
nSrc
+7)/8;

117417 
SrcLi¡_™em
 *
	gpI‹m
 = 
pWInfo
->
pTabLi¡
->
a
 + 
p
->
iTab
;

117418 
TabË
 *
	gpTab
 = 
pI‹m
->
pTab
;

117419 
sql™e3DebugPrštf
("%c%2d.%0*Îx.%0*Îx", 
p
->
cId
,

117420 
p
->
iTab
, 
nb
,…->
maskS–f
,‚b,…->
´”eq
);

117421 
sql™e3DebugPrštf
(" %12s",

117422 
pI‹m
->
zAlŸs
 ?…I‹m->zAlŸ : 
pTab
->
zName
);

117423 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
)==0 ){

117424 cÚ¡ *
zName
;

117425 ifÐ
	gp
->
	gu
.
	gbŒ“
.
	gpIndex
 && (
	gzName
 = 
p
->
u
.
bŒ“
.
pIndex
->
zName
)!=0 ){

117426 ifÐ
¡ºcmp
(
zName
, "sqlite_autoindex_", 17)==0 ){

117427 
i
 = 
sql™e3SŒËn30
(
zName
) - 1;

117428  
	gzName
[
i
]!='_' ) i--;

117429 
	gzName
 +ð
i
;

117431 
sql™e3DebugPrštf
(".%-16 %2d", 
zName
, 
p
->
u
.
bŒ“
.
nEq
);

117433 
sql™e3DebugPrštf
("%20s","");

117436 *
	gz
;

117437 ifÐ
	gp
->
	gu
.
	gvb
.
	gidxSŒ
 ){

117438 
	gz
 = 
sql™e3_m´štf
("(%d,\"%s\",%x)",

117439 
p
->
u
.
vb
.
idxNum
,…->u.vb.
idxSŒ
,…->u.vb.
om™Mask
);

117441 
	gz
 = 
sql™e3_m´štf
("(%d,%x)", 
p
->
u
.
vb
.
idxNum
,…->u.vb.
om™Mask
);

117443 
sql™e3DebugPrštf
(" %-19s", 
z
);

117444 
sql™e3_ä“
(
z
);

117446 ifÐ
	gp
->
	gwsFÏgs
 & 
	gWHERE_SKIPSCAN
 ){

117447 
sql™e3DebugPrštf
(" f %05x %d-%d", 
p
->
wsFÏgs
,…->
nLT”m
,p->
u
.
bŒ“
.
nSk
);

117449 
sql™e3DebugPrštf
(" f %05x N %d", 
p
->
wsFÏgs
,…->
nLT”m
);

117451 
sql™e3DebugPrštf
(" co¡ %d,%d,%d\n", 
p
->
rS‘up
,…->
rRun
,…->
nOut
);

117452 ifÐ
	gp
->
	gnLT”m
 && (
	gsql™e3Wh”eT¿û
 & 0x100)!=0 ){

117453 
i
;

117454 
	gi
=0; i<
	gp
->
	gnLT”m
; i++){

117455 
wh”eT”mPršt
(
p
->
aLT”m
[
i
], i);

117465 
wh”eLoÝIn™
(
Wh”eLoÝ
 *
p
){

117466 
	gp
->
	gaLT”m
 = 
p
->
aLT”mS·û
;

117467 
	gp
->
	gnLT”m
 = 0;

117468 
	gp
->
	gnLSlÙ
 = 
A¼aySize
(
p
->
aLT”mS·û
);

117469 
	gp
->
	gwsFÏgs
 = 0;

117475 
wh”eLoÝCË¬UniÚ
(
sql™e3
 *
db
, 
Wh”eLoÝ
 *
p
){

117476 ifÐ
	gp
->
	gwsFÏgs
 & (
	gWHERE_VIRTUALTABLE
|
	gWHERE_AUTO_INDEX
) ){

117477 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
)!=0 && 
p
->
u
.
vb
.
ÃedF»e
 ){

117478 
sql™e3_ä“
(
p
->
u
.
vb
.
idxSŒ
);

117479 
	gp
->
	gu
.
	gvb
.
	gÃedF»e
 = 0;

117480 
	gp
->
	gu
.
	gvb
.
	gidxSŒ
 = 0;

117481 }ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_AUTO_INDEX
)!=0 && 
p
->
u
.
bŒ“
.
pIndex
!=0 ){

117482 
sql™e3DbF»e
(
db
, 
p
->
u
.
bŒ“
.
pIndex
->
zCÞAff
);

117483 
sql™e3KeyInfoUÄef
(
p
->
u
.
bŒ“
.
pIndex
->
pKeyInfo
);

117484 
sql™e3DbF»e
(
db
, 
p
->
u
.
bŒ“
.
pIndex
);

117485 
	gp
->
	gu
.
	gbŒ“
.
	gpIndex
 = 0;

117493 
wh”eLoÝCË¬
(
sql™e3
 *
db
, 
Wh”eLoÝ
 *
p
){

117494 ifÐ
	gp
->
	gaLT”m
!=
p
->
aLT”mS·û
 ) 
sql™e3DbF»e
(
db
,…->
aLT”m
);

117495 
wh”eLoÝCË¬UniÚ
(
db
, 
p
);

117496 
wh”eLoÝIn™
(
p
);

117502 
wh”eLoÝResize
(
sql™e3
 *
db
, 
Wh”eLoÝ
 *
p
, 
n
){

117503 
Wh”eT”m
 **
	g·New
;

117504 ifÐ
	gp
->
	gnLSlÙ
>=
n
 )  
SQLITE_OK
;

117505 
	gn
 = (
n
+7)&~7;

117506 
	g·New
 = 
sql™e3DbM®locRaw
(
db
, (
p
->
aLT”m
[0])*
n
);

117507 ifÐ
	g·New
==0 )  
SQLITE_NOMEM
;

117508 
memýy
(
·New
, 
p
->
aLT”m
, Õ->aLT”m[0])*p->
nLSlÙ
);

117509 ifÐ
	gp
->
	gaLT”m
!=
p
->
aLT”mS·û
 ) 
sql™e3DbF»e
(
db
,…->
aLT”m
);

117510 
	gp
->
	gaLT”m
 = 
·New
;

117511 
	gp
->
	gnLSlÙ
 = 
n
;

117512  
	gSQLITE_OK
;

117518 
wh”eLoÝXãr
(
sql™e3
 *
db
, 
Wh”eLoÝ
 *
pTo
, Wh”eLoÝ *
pFrom
){

117519 
wh”eLoÝCË¬UniÚ
(
db
, 
pTo
);

117520 ifÐ
wh”eLoÝResize
(
db
, 
pTo
, 
pFrom
->
nLT”m
) ){

117521 
mem£t
(&
pTo
->
u
, 0, (pTo->u));

117522  
	gSQLITE_NOMEM
;

117524 
memýy
(
pTo
, 
pFrom
, 
WHERE_LOOP_XFER_SZ
);

117525 
memýy
(
pTo
->
aLT”m
, 
pFrom
->aLT”m,…To->
nLT”m
*(pTo->aLTerm[0]));

117526 ifÐ
	gpFrom
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
 ){

117527 
	gpFrom
->
	gu
.
	gvb
.
	gÃedF»e
 = 0;

117528 }ifÐ(
	gpFrom
->
	gwsFÏgs
 & 
	gWHERE_AUTO_INDEX
)!=0 ){

117529 
pFrom
->
u
.
bŒ“
.
pIndex
 = 0;

117531  
	gSQLITE_OK
;

117537 
wh”eLoÝD–‘e
(
sql™e3
 *
db
, 
Wh”eLoÝ
 *
p
){

117538 
wh”eLoÝCË¬
(
db
, 
p
);

117539 
sql™e3DbF»e
(
db
, 
p
);

117545 
wh”eInfoF»e
(
sql™e3
 *
db
, 
Wh”eInfo
 *
pWInfo
){

117546 ifÐ
ALWAYS
(
pWInfo
) ){

117547 
wh”eCÏu£CË¬
(&
pWInfo
->
sWC
);

117548  
	gpWInfo
->
	gpLoÝs
 ){

117549 
Wh”eLoÝ
 *
	gp
 = 
pWInfo
->
pLoÝs
;

117550 
	gpWInfo
->
	gpLoÝs
 = 
p
->
pNextLoÝ
;

117551 
wh”eLoÝD–‘e
(
db
, 
p
);

117553 
sql™e3DbF»e
(
db
, 
pWInfo
);

117571 
wh”eLoÝCh—³rPrÝ”Sub£t
(

117572 cÚ¡ 
Wh”eLoÝ
 *
pX
,

117573 cÚ¡ 
Wh”eLoÝ
 *
pY


117575 
	gi
, 
	gj
;

117576 ifÐ
	gpX
->
	gnLT”m
 >ð
pY
->
nLT”m
 )  0;

117577 ifÐ
	gpX
->
	grRun
 >ð
pY
->
rRun
 ){

117578 ifÐ
pX
->
rRun
 > 
pY
->rRun )  0;

117579 ifÐ
	gpX
->
	gnOut
 > 
	gpY
->nOut )  0;

117581 
	gi
=
pX
->
nLT”m
-1; i>=0; i--){

117582 
	gj
=
pY
->
nLT”m
-1; j>=0; j--){

117583 ifÐ
	gpY
->
	gaLT”m
[
j
]==
pX
->
aLT”m
[
i
] ) ;

117585 ifÐ
	gj
<0 )  0;

117615 
wh”eLoÝAdju¡Co¡
(cÚ¡ 
Wh”eLoÝ
 *
p
, Wh”eLoÝ *
pTem¶©e
){

117616 ifÐ(
	gpTem¶©e
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
)==0 ) ;

117617 ifÐ(
	gpTem¶©e
->
	gwsFÏgs
 & 
	gWHERE_SKIPSCAN
)!=0 ) ;

117618 ; 
	gp
;…=
p
->
pNextLoÝ
){

117619 ifÐ
p
->
iTab
!=
pTem¶©e
->iTab ) ;

117620 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
)==0 ) ;

117621 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_SKIPSCAN
)!=0 ) ;

117622 ifÐ
wh”eLoÝCh—³rPrÝ”Sub£t
(
p
, 
pTem¶©e
) ){

117625 
	gpTem¶©e
->
	grRun
 = 
p
->
rRun
;

117626 
	gpTem¶©e
->
	gnOut
 = 
p
->
nOut
 - 1;

117627 }ifÐ
wh”eLoÝCh—³rPrÝ”Sub£t
(
pTem¶©e
, 
p
) ){

117630 
	gpTem¶©e
->
	grRun
 = 
p
->
rRun
;

117631 
	gpTem¶©e
->
	gnOut
 = 
p
->
nOut
 + 1;

117649 
Wh”eLoÝ
 **
wh”eLoÝFšdLes£r
(

117650 
Wh”eLoÝ
 **
µP»v
,

117651 cÚ¡ 
Wh”eLoÝ
 *
pTem¶©e


117653 
Wh”eLoÝ
 *
	gp
;

117654 
	gp
=(*
µP»v
);…; 
	gµP»v
=&
p
->
pNextLoÝ
,…=*ppPrev){

117655 ifÐ
p
->
iTab
!=
pTem¶©e
->iTab ||…->
iSÜtIdx
!=pTemplate->iSortIdx ){

117664 
as£¹
Ð
p
->
rS‘up
==0 || 
pTem¶©e
->rSetup==0

117665 || 
p
->
rS‘up
==
pTem¶©e
->rSetup );

117670 
as£¹
Ð
p
->
rS‘up
>=
pTem¶©e
->rSetup );

117675 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_AUTO_INDEX
)!=0

117676 && (
pTem¶©e
->
wsFÏgs
 & 
WHERE_INDEXED
)!=0

117677 && (
pTem¶©e
->
wsFÏgs
 & 
WHERE_COLUMN_EQ
)!=0

117678 && (
p
->
´”eq
 & 
pTem¶©e
->prereq)==pTemplate->prereq

117688 ifÐ(
	gp
->
	g´”eq
 & 
	gpTem¶©e
->´”eq)==
p
->
´”eq


117689 && 
p
->
rS‘up
<=
pTem¶©e
->rSetup

117690 && 
p
->
rRun
<=
pTem¶©e
->rRun

117691 && 
p
->
nOut
<=
pTem¶©e
->nOut

117701 ifÐ(
	gp
->
	g´”eq
 & 
	gpTem¶©e
->´”eq)==
pTem¶©e
->
´”eq


117702 && 
p
->
rRun
>=
pTem¶©e
->rRun

117703 && 
p
->
nOut
>=
pTem¶©e
->nOut

117705 
as£¹
Ð
p
->
rS‘up
>=
pTem¶©e
->rSetup );

117709  
	gµP»v
;

117736 
wh”eLoÝIn£¹
(
Wh”eLoÝBužd”
 *
pBužd”
, 
Wh”eLoÝ
 *
pTem¶©e
){

117737 
Wh”eLoÝ
 **
	gµP»v
, *
	gp
;

117738 
Wh”eInfo
 *
	gpWInfo
 = 
pBužd”
->
pWInfo
;

117739 
sql™e3
 *
	gdb
 = 
pWInfo
->
pP¬£
->
db
;

117744 ifÐ
	gpBužd”
->
	gpOrS‘
!=0 ){

117745 #ià
WHERETRACE_ENABLED


117746 
u16
 
n
 = 
pBužd”
->
pOrS‘
->n;

117747 
	gx
 =

117749 
wh”eOrIn£¹
(
pBužd”
->
pOrS‘
, 
pTem¶©e
->
´”eq
,…Tem¶©e->
rRun
,

117750 
pTem¶©e
->
nOut
);

117751 #ià
WHERETRACE_ENABLED


117752 ifÐ
	gsql™e3Wh”eT¿û
 & 0x8 ){

117753 
sql™e3DebugPrštf
(
x
?" or-%d: ":" or-X: ", 
n
);

117754 
wh”eLoÝPršt
(
pTem¶©e
, 
pBužd”
->
pWC
);

117757  
	gSQLITE_OK
;

117762 
wh”eLoÝAdju¡Co¡
(
pWInfo
->
pLoÝs
, 
pTem¶©e
);

117763 
	gµP»v
 = 
wh”eLoÝFšdLes£r
(&
pWInfo
->
pLoÝs
, 
pTem¶©e
);

117765 ifÐ
	gµP»v
==0 ){

117768 #ià
WHERETRACE_ENABLED


117769 ifÐ
sql™e3Wh”eT¿û
 & 0x8 ){

117770 
sql™e3DebugPrštf
(" skip: ");

117771 
wh”eLoÝPršt
(
pTem¶©e
, 
pBužd”
->
pWC
);

117774  
	gSQLITE_OK
;

117776 
	gp
 = *
µP»v
;

117783 #ià
WHERETRACE_ENABLED


117784 ifÐ
	gsql™e3Wh”eT¿û
 & 0x8 ){

117785 ifÐ
	gp
!=0 ){

117786 
sql™e3DebugPrštf
("replace: ");

117787 
wh”eLoÝPršt
(
p
, 
pBužd”
->
pWC
);

117789 
sql™e3DebugPrštf
("‡dd: ");

117790 
wh”eLoÝPršt
(
pTem¶©e
, 
pBužd”
->
pWC
);

117793 ifÐ
	gp
==0 ){

117795 *
µP»v
 = 
p
 = 
sql™e3DbM®locRaw
(
db
, (
Wh”eLoÝ
));

117796 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

117797 
wh”eLoÝIn™
(
p
);

117798 
	gp
->
	gpNextLoÝ
 = 0;

117803 
Wh”eLoÝ
 **
	gµTaž
 = &
p
->
pNextLoÝ
;

117804 
Wh”eLoÝ
 *
	gpToD–
;

117805  *
	gµTaž
 ){

117806 
	gµTaž
 = 
wh”eLoÝFšdLes£r
(
µTaž
, 
pTem¶©e
);

117807 ifÐ
	gµTaž
==0 ) ;

117808 
	gpToD–
 = *
µTaž
;

117809 ifÐ
	gpToD–
==0 ) ;

117810 *
	gµTaž
 = 
pToD–
->
pNextLoÝ
;

117811 #ià
WHERETRACE_ENABLED


117812 ifÐ
	gsql™e3Wh”eT¿û
 & 0x8 ){

117813 
sql™e3DebugPrštf
(" delete: ");

117814 
wh”eLoÝPršt
(
pToD–
, 
pBužd”
->
pWC
);

117817 
wh”eLoÝD–‘e
(
db
, 
pToD–
);

117820 
wh”eLoÝXãr
(
db
, 
p
, 
pTem¶©e
);

117821 ifÐ(
	gp
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
)==0 ){

117822 
Index
 *
pIndex
 = 
p
->
u
.
bŒ“
.pIndex;

117823 ifÐ
	gpIndex
 &&…Index->
	gŠum
==0 ){

117824 
p
->
u
.
bŒ“
.
pIndex
 = 0;

117827  
	gSQLITE_OK
;

117839 
wh”eLoÝOuutAdju¡
(

117840 
Wh”eCÏu£
 *
pWC
,

117841 
Wh”eLoÝ
 *
pLoÝ
,

117842 
LogE¡
 
nRow


117844 
Wh”eT”m
 *
	gpT”m
, *
	gpX
;

117845 
B™mask
 
	gnÙAÎowed
 = ~(
pLoÝ
->
´”eq
|pLoÝ->
maskS–f
);

117846 
	gi
, 
	gj
;

117847 
	gnEq
 = 0;

117849 
	gi
=
pWC
->
nT”m
, 
	gpT”m
õWC->
a
; i>0; i--,…Term++){

117850 ifÐ(
	gpT”m
->
	gwtFÏgs
 & 
	gTERM_VIRTUAL
)!=0 ) ;

117851 ifÐ(
	gpT”m
->
	g´”eqAÎ
 & 
	gpLoÝ
->
	gmaskS–f
)==0 ) ;

117852 ifÐ(
	gpT”m
->
	g´”eqAÎ
 & 
	gnÙAÎowed
)!=0 ) ;

117853 
	gj
=
pLoÝ
->
nLT”m
-1; j>=0; j--){

117854 
	gpX
 = 
pLoÝ
->
aLT”m
[
j
];

117855 ifÐ
	gpX
==0 ) ;

117856 ifÐ
	gpX
==
pT”m
 ) ;

117857 ifÐ
	gpX
->
	giP¬’t
>=0 && (&
pWC
->
a
[
pX
->
iP¬’t
])==
pT”m
 ) ;

117859 ifÐ
	gj
<0 ){

117860 ifÐ
	gpT”m
->
	gŒuthProb
<=0 ){

117861 
pLoÝ
->
nOut
 +ð
pT”m
->
ŒuthProb
;

117863 
	gpLoÝ
->
	gnOut
--;

117864 ifÐ
	gpT”m
->
	geO³¿tÜ
&
	gWO_EQ
 ) 
	gnEq
++;

117872 ifÐ
	gnEq
 && 
	gpLoÝ
->
	gnOut
>
	gnRow
-10 ){

117873 
	gpLoÝ
->
	gnOut
 = 
nRow
 - 10;

117881 #ifdeà
SQLITE_ENABLE_COSTMULT


117882 
	#AµlyCo¡MuÉl›r
(
C
,
T
èC +ð
	)
T

117884 
	#AµlyCo¡MuÉl›r
(
C
,
T
)

	)

117899 
wh”eLoÝAddBŒ“Index
(

117900 
Wh”eLoÝBužd”
 *
pBužd”
,

117901 
SrcLi¡_™em
 *
pSrc
,

117902 
Index
 *
pProbe
,

117903 
LogE¡
 
nInMul


117905 
Wh”eInfo
 *
	gpWInfo
 = 
pBužd”
->
pWInfo
;

117906 
P¬£
 *
	gpP¬£
 = 
pWInfo
->
pP¬£
;

117907 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

117908 
Wh”eLoÝ
 *
	gpNew
;

117909 
Wh”eT”m
 *
	gpT”m
;

117910 
	gÝMask
;

117911 
Wh”eSÿn
 
	gsÿn
;

117912 
B™mask
 
	g§ved_´”eq
;

117913 
u16
 
	g§ved_nLT”m
;

117914 
u16
 
	g§ved_nEq
;

117915 
u16
 
	g§ved_nSk
;

117916 
u32
 
	g§ved_wsFÏgs
;

117917 
LogE¡
 
	g§ved_nOut
;

117918 
	giCÞ
;

117919 
	grc
 = 
SQLITE_OK
;

117920 
LogE¡
 
	grSize
;

117921 
LogE¡
 
	grLogSize
;

117922 
Wh”eT”m
 *
	gpTÝ
 = 0, *
	gpBtm
 = 0;

117924 
	gpNew
 = 
pBužd”
->
pNew
;

117925 ifÐ
	gdb
->
	gm®locFažed
 )  
	gSQLITE_NOMEM
;

117927 
as£¹
Ð(
pNew
->
wsFÏgs
 & 
WHERE_VIRTUALTABLE
)==0 );

117928 
as£¹
Ð(
pNew
->
wsFÏgs
 & 
WHERE_TOP_LIMIT
)==0 );

117929 ifÐ
	gpNew
->
	gwsFÏgs
 & 
	gWHERE_BTM_LIMIT
 ){

117930 
	gÝMask
 = 
WO_LT
|
WO_LE
;

117931 }ifÐ
	gpProbe
->
	gŠum
<=0 || (
pSrc
->
jošty³
 & 
JT_LEFT
)!=0 ){

117932 
ÝMask
 = 
WO_EQ
|
WO_IN
|
WO_GT
|
WO_GE
|
WO_LT
|
WO_LE
;

117934 
	gÝMask
 = 
WO_EQ
|
WO_IN
|
WO_ISNULL
|
WO_GT
|
WO_GE
|
WO_LT
|
WO_LE
;

117936 ifÐ
	gpProbe
->
	gbUnÜd”ed
 ) 
	gÝMask
 &ð~(
WO_GT
|
WO_GE
|
WO_LT
|
WO_LE
);

117938 
as£¹
Ð
pNew
->
u
.
bŒ“
.
nEq
<
pProbe
->
nCÞumn
 );

117939 
	giCÞ
 = 
pProbe
->
aiCÞumn
[
pNew
->
u
.
bŒ“
.
nEq
];

117941 
	gpT”m
 = 
wh”eSÿnIn™
(&
sÿn
, 
pBužd”
->
pWC
, 
pSrc
->
iCursÜ
, 
iCÞ
,

117942 
ÝMask
, 
pProbe
);

117943 
	g§ved_nEq
 = 
pNew
->
u
.
bŒ“
.
nEq
;

117944 
	g§ved_nSk
 = 
pNew
->
u
.
bŒ“
.
nSk
;

117945 
	g§ved_nLT”m
 = 
pNew
->
nLT”m
;

117946 
	g§ved_wsFÏgs
 = 
pNew
->
wsFÏgs
;

117947 
	g§ved_´”eq
 = 
pNew
->
´”eq
;

117948 
	g§ved_nOut
 = 
pNew
->
nOut
;

117949 
	gpNew
->
	grS‘up
 = 0;

117950 
	grSize
 = 
pProbe
->
aiRowLogE¡
[0];

117951 
	grLogSize
 = 
e¡Log
(
rSize
);

117963 
as£¹
Ð42==
sql™e3LogE¡
(18) );

117964 ifÐ
	g§ved_nEq
==
§ved_nSk


117965 && 
§ved_nEq
+1<
pProbe
->
nKeyCÞ


117966 && 
pProbe
->
aiRowLogE¡
[
§ved_nEq
+1]>=42

117967 && (
rc
 = 
wh”eLoÝResize
(
db
, 
pNew
,…New->
nLT”m
+1))==
SQLITE_OK


117969 
LogE¡
 
nI‹r
;

117970 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
++;

117971 
	gpNew
->
	gu
.
	gbŒ“
.
	gnSk
++;

117972 
	gpNew
->
	gaLT”m
[
pNew
->
nLT”m
++] = 0;

117973 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_SKIPSCAN
;

117974 
	gnI‹r
 = 
pProbe
->
aiRowLogE¡
[
§ved_nEq
] -…Probe->aiRowLogEst[saved_nEq+1];

117975 ifÐ
	gpT”m
 ){

117979 
	gnI‹r
 +ð10; 
as£¹
Ð10==
sql™e3LogE¡
(2) );

117981 
	gpNew
->
	gnOut
 -ð
nI‹r
;

117984 
	gnI‹r
 += 5;

117985 
wh”eLoÝAddBŒ“Index
(
pBužd”
, 
pSrc
, 
pProbe
, 
nI‹r
 + 
nInMul
);

117986 
	gpNew
->
	gnOut
 = 
§ved_nOut
;

117987 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
 = 
§ved_nEq
;

117988 
	gpNew
->
	gu
.
	gbŒ“
.
	gnSk
 = 
§ved_nSk
;

117990 ; 
	grc
==
SQLITE_OK
 && 
pT”m
!=0; 
	gpT”m
 = 
wh”eSÿnNext
(&
sÿn
)){

117991 
u16
 
eOp
 = 
pT”m
->
eO³¿tÜ
;

117992 
LogE¡
 
	grCo¡Idx
;

117993 
LogE¡
 
	gnOutUÇdju¡ed
;

117994 
	gnIn
 = 0;

117995 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


117996 
	gnRecV®id
 = 
pBužd”
->
nRecV®id
;

117998 ifÐ(
	geOp
==
WO_ISNULL
 || (
pT”m
->
wtFÏgs
&
TERM_VNULL
)!=0)

117999 && (
iCÞ
<0 || 
pSrc
->
pTab
->
aCÞ
[iCÞ].
nÙNuÎ
)

118003 ifÐ
	gpT”m
->
	g´”eqRight
 & 
	gpNew
->
	gmaskS–f
 ) ;

118005 
	gpNew
->
	gwsFÏgs
 = 
§ved_wsFÏgs
;

118006 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
 = 
§ved_nEq
;

118007 
	gpNew
->
	gnLT”m
 = 
§ved_nLT”m
;

118008 ifÐ
wh”eLoÝResize
(
db
, 
pNew
,…New->
nLT”m
+1) ) ;

118009 
	gpNew
->
	gaLT”m
[
pNew
->
nLT”m
++] = 
pT”m
;

118010 
	gpNew
->
	g´”eq
 = (
§ved_´”eq
 | 
pT”m
->
´”eqRight
è& ~
pNew
->
maskS–f
;

118012 
as£¹
Ð
nInMul
==0

118013 || (
pNew
->
wsFÏgs
 & 
WHERE_COLUMN_NULL
)!=0

118014 || (
pNew
->
wsFÏgs
 & 
WHERE_COLUMN_IN
)!=0

118015 || (
pNew
->
wsFÏgs
 & 
WHERE_SKIPSCAN
)!=0

118018 ifÐ
	geOp
 & 
	gWO_IN
 ){

118019 
Ex´
 *
	gpEx´
 = 
pT”m
->
pEx´
;

118020 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_COLUMN_IN
;

118021 ifÐ
Ex´HasPrÝ”ty
(
pEx´
, 
EP_xIsS–eù
) ){

118023 
	gnIn
 = 46; 
as£¹
Ð46==
sql™e3LogE¡
(25) );

118024 }ifÐ
ALWAYS
(
pEx´
->
x
.
pLi¡
 &&…Ex´->x.pLi¡->
nEx´
) ){

118026 
	gnIn
 = 
sql™e3LogE¡
(
pEx´
->
x
.
pLi¡
->
nEx´
);

118028 
as£¹
Ð
nIn
>0 );

118031 }ifÐ
	geOp
 & (
	gWO_EQ
) ){

118032 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_COLUMN_EQ
;

118033 ifÐ
	giCÞ
<0 || (
	gnInMul
==0 && 
pNew
->
u
.
bŒ“
.
nEq
==
pProbe
->
nKeyCÞ
-1) ){

118034 ifÐ
iCÞ
>=0 && !
IsUniqueIndex
(
pProbe
) ){

118035 
pNew
->
wsFÏgs
 |ð
WHERE_UNQ_WANTED
;

118037 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_ONEROW
;

118040 }ifÐ
	geOp
 & 
	gWO_ISNULL
 ){

118041 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_COLUMN_NULL
;

118042 }ifÐ
	geOp
 & (
	gWO_GT
|
	gWO_GE
) ){

118043 
‹¡ÿ£
Ð
eOp
 & 
WO_GT
 );

118044 
‹¡ÿ£
Ð
eOp
 & 
WO_GE
 );

118045 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_COLUMN_RANGE
|
WHERE_BTM_LIMIT
;

118046 
	gpBtm
 = 
pT”m
;

118047 
	gpTÝ
 = 0;

118049 
as£¹
Ð
eOp
 & (
WO_LT
|
WO_LE
) );

118050 
‹¡ÿ£
Ð
eOp
 & 
WO_LT
 );

118051 
‹¡ÿ£
Ð
eOp
 & 
WO_LE
 );

118052 
	gpNew
->
	gwsFÏgs
 |ð
WHERE_COLUMN_RANGE
|
WHERE_TOP_LIMIT
;

118053 
	gpTÝ
 = 
pT”m
;

118054 
	gpBtm
 = (
pNew
->
wsFÏgs
 & 
WHERE_BTM_LIMIT
)!=0 ?

118055 
pNew
->
aLT”m
[pNew->
nLT”m
-2] : 0;

118063 
as£¹
Ð
pNew
->
nOut
==
§ved_nOut
 );

118064 ifÐ
	gpNew
->
	gwsFÏgs
 & 
	gWHERE_COLUMN_RANGE
 ){

118067 
wh”eRªgeSÿnE¡
(
pP¬£
, 
pBužd”
, 
pBtm
, 
pTÝ
, 
pNew
);

118069 
	gnEq
 = ++
pNew
->
u
.
bŒ“
.
nEq
;

118070 
as£¹
Ð
eOp
 & (
WO_ISNULL
|
WO_EQ
|
WO_IN
) );

118072 
as£¹
Ð
pNew
->
nOut
==
§ved_nOut
 );

118073 ifÐ
	gpT”m
->
	gŒuthProb
<=0 && 
iCÞ
>=0 ){

118074 
as£¹
Ð(
eOp
 & 
WO_IN
è|| 
nIn
==0 );

118075 
‹¡ÿ£
Ð
eOp
 & 
WO_IN
 );

118076 
	gpNew
->
	gnOut
 +ð
pT”m
->
ŒuthProb
;

118077 
	gpNew
->
	gnOut
 -ð
nIn
;

118079 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


118080 
tRowút
 
	gnOut
 = 0;

118081 ifÐ
	gnInMul
==0

118082 && 
pProbe
->
nSam¶e


118083 && 
pNew
->
u
.
bŒ“
.
nEq
<=
pProbe
->
nSam¶eCÞ


118084 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_St3
)

118085 && ((
	geOp
 & 
	gWO_IN
)==0 || !
Ex´HasPrÝ”ty
(
pT”m
->
pEx´
, 
EP_xIsS–eù
))

118087 
Ex´
 *
	gpEx´
 = 
pT”m
->
pEx´
;

118088 ifÐ(
	geOp
 & (
	gWO_EQ
|
	gWO_ISNULL
))!=0 ){

118089 
‹¡ÿ£
Ð
eOp
 & 
WO_EQ
 );

118090 
‹¡ÿ£
Ð
eOp
 & 
WO_ISNULL
 );

118091 
	grc
 = 
wh”eEqu®SÿnE¡
(
pP¬£
, 
pBužd”
, 
pEx´
->
pRight
, &
nOut
);

118093 
	grc
 = 
wh”eInSÿnE¡
(
pP¬£
, 
pBužd”
, 
pEx´
->
x
.
pLi¡
, &
nOut
);

118095 ifÐ
	grc
==
SQLITE_NOTFOUND
 ) 
rc
 = 
SQLITE_OK
;

118096 ifÐ
	grc
!=
SQLITE_OK
 ) ;

118097 ifÐ
	gnOut
 ){

118098 
	gpNew
->
	gnOut
 = 
sql™e3LogE¡
(
nOut
);

118099 ifÐ
	gpNew
->
	gnOut
>
	g§ved_nOut
 )…New->nOuˆð
§ved_nOut
;

118100 
	gpNew
->
	gnOut
 -ð
nIn
;

118103 ifÐ
	gnOut
==0 )

118106 
pNew
->
nOut
 +ð(
pProbe
->
aiRowLogE¡
[
nEq
] -…Probe->aiRowLogEst[nEq-1]);

118107 ifÐ
	geOp
 & 
	gWO_ISNULL
 ){

118111 
	gpNew
->
	gnOut
 += 10;

118121 
	grCo¡Idx
 = 
pNew
->
nOut
 + 1 + (15*
pProbe
->
szIdxRow
)/
pSrc
->
pTab
->
szTabRow
;

118122 
	gpNew
->
	grRun
 = 
sql™e3LogE¡Add
(
rLogSize
, 
rCo¡Idx
);

118123 ifÐ(
	gpNew
->
	gwsFÏgs
 & (
	gWHERE_IDX_ONLY
|
	gWHERE_IPK
))==0 ){

118124 
pNew
->
rRun
 = 
sql™e3LogE¡Add
ÕNew->rRun,…New->
nOut
 + 16);

118126 
AµlyCo¡MuÉl›r
(
pNew
->
rRun
, 
pProbe
->
pTabË
->
co¡MuÉ
);

118128 
	gnOutUÇdju¡ed
 = 
pNew
->
nOut
;

118129 
	gpNew
->
	grRun
 +ð
nInMul
 + 
nIn
;

118130 
	gpNew
->
	gnOut
 +ð
nInMul
 + 
nIn
;

118131 
wh”eLoÝOuutAdju¡
(
pBužd”
->
pWC
, 
pNew
, 
rSize
);

118132 
	grc
 = 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118134 ifÐ
	gpNew
->
	gwsFÏgs
 & 
	gWHERE_COLUMN_RANGE
 ){

118135 
	gpNew
->
	gnOut
 = 
§ved_nOut
;

118137 
	gpNew
->
	gnOut
 = 
nOutUÇdju¡ed
;

118140 ifÐ(
	gpNew
->
	gwsFÏgs
 & 
	gWHERE_TOP_LIMIT
)==0

118141 && 
pNew
->
u
.
bŒ“
.
nEq
<
pProbe
->
nCÞumn


118143 
wh”eLoÝAddBŒ“Index
(
pBužd”
, 
pSrc
, 
pProbe
, 
nInMul
+
nIn
);

118145 
	gpNew
->
	gnOut
 = 
§ved_nOut
;

118146 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


118147 
	gpBužd”
->
	gnRecV®id
 = 
nRecV®id
;

118150 
	gpNew
->
	g´”eq
 = 
§ved_´”eq
;

118151 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
 = 
§ved_nEq
;

118152 
	gpNew
->
	gu
.
	gbŒ“
.
	gnSk
 = 
§ved_nSk
;

118153 
	gpNew
->
	gwsFÏgs
 = 
§ved_wsFÏgs
;

118154 
	gpNew
->
	gnOut
 = 
§ved_nOut
;

118155 
	gpNew
->
	gnLT”m
 = 
§ved_nLT”m
;

118156  
	grc
;

118167 
šdexMightH–pW™hOrd”By
(

118168 
Wh”eLoÝBužd”
 *
pBužd”
,

118169 
Index
 *
pIndex
,

118170 
iCursÜ


118172 
Ex´Li¡
 *
	gpOB
;

118173 
	gii
, 
	gjj
;

118175 ifÐ
	gpIndex
->
	gbUnÜd”ed
 )  0;

118176 ifÐ(
	gpOB
 = 
pBužd”
->
pWInfo
->
pOrd”By
)==0 )  0;

118177 
	gii
=0; ii<
	gpOB
->
	gnEx´
; ii++){

118178 
Ex´
 *
	gpEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pOB
->
a
[
ii
].
pEx´
);

118179 ifÐ
	gpEx´
->
	gÝ
!=
TK_COLUMN
 )  0;

118180 ifÐ
	gpEx´
->
	giTabË
==
iCursÜ
 ){

118181 ifÐ
pEx´
->
iCÞumn
<0 )  1;

118182 
	gjj
=0; jj<
	gpIndex
->
	gnKeyCÞ
; jj++){

118183 ifÐ
	gpEx´
->
	giCÞumn
==
pIndex
->
aiCÞumn
[
jj
] )  1;

118194 
B™mask
 
cÞumnsInIndex
(
Index
 *
pIdx
){

118195 
B™mask
 
	gm
 = 0;

118196 
	gj
;

118197 
	gj
=
pIdx
->
nCÞumn
-1; j>=0; j--){

118198 
	gx
 = 
pIdx
->
aiCÞumn
[
j
];

118199 ifÐ
	gx
>=0 ){

118200 
‹¡ÿ£
Ð
x
==
BMS
-1 );

118201 
‹¡ÿ£
Ð
x
==
BMS
-2 );

118202 ifÐ
	gx
<
	gBMS
-1 ) 
	gm
 |ð
MASKBIT
(
x
);

118205  
	gm
;

118211 
wh”eU§bËP¬tŸlIndex
(
iTab
, 
Wh”eCÏu£
 *
pWC
, 
Ex´
 *
pWh”e
){

118212 
	gi
;

118213 
Wh”eT”m
 *
	gpT”m
;

118214 
	gi
=0, 
	gpT”m
=
pWC
->
a
; i<
	gpWC
->
	gnT”m
; i++,…Term++){

118215 ifÐ
sql™e3Ex´Im¶›sEx´
(
pT”m
->
pEx´
, 
pWh”e
, 
iTab
) )  1;

118256 
wh”eLoÝAddBŒ“
(

118257 
Wh”eLoÝBužd”
 *
pBužd”
,

118258 
B™mask
 
mExŒa


118260 
Wh”eInfo
 *
	gpWInfo
;

118261 
Index
 *
	gpProbe
;

118262 
Index
 
	gsPk
;

118263 
LogE¡
 
	gaiRowE¡Pk
[2];

118264 
i16
 
	gaiCÞumnPk
 = -1;

118265 
SrcLi¡
 *
	gpTabLi¡
;

118266 
SrcLi¡_™em
 *
	gpSrc
;

118267 
Wh”eLoÝ
 *
	gpNew
;

118268 
	grc
 = 
SQLITE_OK
;

118269 
	giSÜtIdx
 = 1;

118270 
	gb
;

118271 
LogE¡
 
	grSize
;

118272 
LogE¡
 
	grLogSize
;

118273 
Wh”eCÏu£
 *
	gpWC
;

118274 
TabË
 *
	gpTab
;

118276 
	gpNew
 = 
pBužd”
->
pNew
;

118277 
	gpWInfo
 = 
pBužd”
->
pWInfo
;

118278 
	gpTabLi¡
 = 
pWInfo
->
pTabLi¡
;

118279 
	gpSrc
 = 
pTabLi¡
->
a
 + 
pNew
->
iTab
;

118280 
	gpTab
 = 
pSrc
->
pTab
;

118281 
	gpWC
 = 
pBužd”
->
pWC
;

118282 
as£¹
Ð!
IsVœtu®
(
pSrc
->
pTab
) );

118284 ifÐ
	gpSrc
->
	gpIndex
 ){

118286 
	gpProbe
 = 
pSrc
->
pIndex
;

118287 }ifÐ!
HasRowid
(
pTab
) ){

118288 
	gpProbe
 = 
pTab
->
pIndex
;

118294 
Index
 *
	gpFœ¡
;

118295 
mem£t
(&
sPk
, 0, (
Index
));

118296 
	gsPk
.
	gnKeyCÞ
 = 1;

118297 
	gsPk
.
	gnCÞumn
 = 1;

118298 
	gsPk
.
	gaiCÞumn
 = &
aiCÞumnPk
;

118299 
	gsPk
.
	gaiRowLogE¡
 = 
aiRowE¡Pk
;

118300 
	gsPk
.
	gÚE¼Ü
 = 
OE_R•Ïû
;

118301 
	gsPk
.
	gpTabË
 = 
pTab
;

118302 
	gsPk
.
	gszIdxRow
 = 
pTab
->
szTabRow
;

118303 
	gaiRowE¡Pk
[0] = 
pTab
->
nRowLogE¡
;

118304 
	gaiRowE¡Pk
[1] = 0;

118305 
	gpFœ¡
 = 
pSrc
->
pTab
->
pIndex
;

118306 ifÐ
	gpSrc
->
	gnÙIndexed
==0 ){

118309 
sPk
.
pNext
 = 
pFœ¡
;

118311 
	gpProbe
 = &
sPk
;

118313 
	grSize
 = 
pTab
->
nRowLogE¡
;

118314 
	grLogSize
 = 
e¡Log
(
rSize
);

118316 #iâdeà
SQLITE_OMIT_AUTOMATIC_INDEX


118318 ifÐ!
	gpBužd”
->
	gpOrS‘


118319 && (
	gpWInfo
->
	gpP¬£
->
	gdb
->
	gæags
 & 
	gSQLITE_AutoIndex
)!=0

118320 && 
pSrc
->
pIndex
==0

118321 && !
pSrc
->
vŸCÜoutše


118322 && !
pSrc
->
nÙIndexed


118323 && 
HasRowid
(
pTab
)

118324 && !
pSrc
->
isCÜ»Ï‹d


118325 && !
pSrc
->
isRecursive


118328 
Wh”eT”m
 *
pT”m
;

118329 
Wh”eT”m
 *
	gpWCEnd
 = 
pWC
->
a
 +…WC->
nT”m
;

118330 
	gpT”m
=
pWC
->
a
; 
	grc
==
SQLITE_OK
 && 
pT”m
<
pWCEnd
;…Term++){

118331 ifÐ
	gpT”m
->
	g´”eqRight
 & 
	gpNew
->
	gmaskS–f
 ) ;

118332 ifÐ
‹rmCªDriveIndex
(
pT”m
, 
pSrc
, 0) ){

118333 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
 = 1;

118334 
	gpNew
->
	gu
.
	gbŒ“
.
	gnSk
 = 0;

118335 
	gpNew
->
	gu
.
	gbŒ“
.
	gpIndex
 = 0;

118336 
	gpNew
->
	gnLT”m
 = 1;

118337 
	gpNew
->
	gaLT”m
[0] = 
pT”m
;

118346 
	gpNew
->
	grS‘up
 = 
rLogSize
 + 
rSize
 + 4;

118347 ifÐ
	gpTab
->
	gpS–eù
==0 && (
pTab
->
bFÏgs
 & 
TF_Ephem”®
)==0 ){

118348 
pNew
->
rS‘up
 += 24;

118350 
AµlyCo¡MuÉl›r
(
pNew
->
rS‘up
, 
pTab
->
co¡MuÉ
);

118355 
	gpNew
->
	gnOut
 = 43; 
as£¹
Ð43==
sql™e3LogE¡
(20) );

118356 
	gpNew
->
	grRun
 = 
sql™e3LogE¡Add
(
rLogSize
,
pNew
->
nOut
);

118357 
	gpNew
->
	gwsFÏgs
 = 
WHERE_AUTO_INDEX
;

118358 
	gpNew
->
	g´”eq
 = 
mExŒa
 | 
pT”m
->
´”eqRight
;

118359 
	grc
 = 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118367 ; 
	grc
==
SQLITE_OK
 && 
pProbe
; 
	gpProbe
õProbe->
pNext
, 
	giSÜtIdx
++){

118368 ifÐ
	gpProbe
->
	gpP¬tIdxWh”e
!=0

118369 && !
wh”eU§bËP¬tŸlIndex
(
pSrc
->
iCursÜ
, 
pWC
, 
pProbe
->
pP¬tIdxWh”e
) ){

118370 
‹¡ÿ£
Ð
pNew
->
iTab
!=
pSrc
->
iCursÜ
 );

118373 
	grSize
 = 
pProbe
->
aiRowLogE¡
[0];

118374 
	gpNew
->
	gu
.
	gbŒ“
.
	gnEq
 = 0;

118375 
	gpNew
->
	gu
.
	gbŒ“
.
	gnSk
 = 0;

118376 
	gpNew
->
	gnLT”m
 = 0;

118377 
	gpNew
->
	giSÜtIdx
 = 0;

118378 
	gpNew
->
	grS‘up
 = 0;

118379 
	gpNew
->
	g´”eq
 = 
mExŒa
;

118380 
	gpNew
->
	gnOut
 = 
rSize
;

118381 
	gpNew
->
	gu
.
	gbŒ“
.
	gpIndex
 = 
pProbe
;

118382 
	gb
 = 
šdexMightH–pW™hOrd”By
(
pBužd”
, 
pProbe
, 
pSrc
->
iCursÜ
);

118384 
as£¹
Ð(
pWInfo
->
wù¾FÏgs
 & 
WHERE_ONEPASS_DESIRED
)==0 || 
b
==0 );

118385 ifÐ
	gpProbe
->
	gŠum
<=0 ){

118387 
pNew
->
wsFÏgs
 = 
WHERE_IPK
;

118390 
	gpNew
->
	giSÜtIdx
 = 
b
 ? 
iSÜtIdx
 : 0;

118392 
	gpNew
->
	grRun
 = 
rSize
 + 16;

118393 
AµlyCo¡MuÉl›r
(
pNew
->
rRun
, 
pTab
->
co¡MuÉ
);

118394 
wh”eLoÝOuutAdju¡
(
pWC
, 
pNew
, 
rSize
);

118395 
	grc
 = 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118396 
	gpNew
->
	gnOut
 = 
rSize
;

118397 ifÐ
	grc
 ) ;

118399 
B™mask
 
	gm
;

118400 ifÐ
	gpProbe
->
	gisCov”šg
 ){

118401 
	gpNew
->
	gwsFÏgs
 = 
WHERE_IDX_ONLY
 | 
WHERE_INDEXED
;

118402 
	gm
 = 0;

118404 
	gm
 = 
pSrc
->
cÞU£d
 & ~
cÞumnsInIndex
(
pProbe
);

118405 
	gpNew
->
	gwsFÏgs
 = (
m
==0è? (
WHERE_IDX_ONLY
|
WHERE_INDEXED
) : WHERE_INDEXED;

118409 ifÐ
	gb


118410 || !
HasRowid
(
pTab
)

118411 || ( 
	gm
==0

118412 && 
pProbe
->
bUnÜd”ed
==0

118413 && (
pProbe
->
szIdxRow
<
pTab
->
szTabRow
)

118414 && (
pWInfo
->
wù¾FÏgs
 & 
WHERE_ONEPASS_DESIRED
)==0

118415 && 
sql™e3Glob®CÚfig
.
bU£Cis


118416 && 
O±imiz©iÚEÇbËd
(
pWInfo
->
pP¬£
->
db
, 
SQLITE_Cov”IdxSÿn
)

118419 
	gpNew
->
	giSÜtIdx
 = 
b
 ? 
iSÜtIdx
 : 0;

118425 
	gpNew
->
	grRun
 = 
rSize
 + 1 + (15*
pProbe
->
szIdxRow
)/
pTab
->
szTabRow
;

118426 ifÐ
	gm
!=0 ){

118427 
pNew
->
rRun
 = 
sql™e3LogE¡Add
ÕNew->rRun, 
rSize
+16);

118429 
AµlyCo¡MuÉl›r
(
pNew
->
rRun
, 
pTab
->
co¡MuÉ
);

118430 
wh”eLoÝOuutAdju¡
(
pWC
, 
pNew
, 
rSize
);

118431 
	grc
 = 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118432 
	gpNew
->
	gnOut
 = 
rSize
;

118433 ifÐ
	grc
 ) ;

118437 
	grc
 = 
wh”eLoÝAddBŒ“Index
(
pBužd”
, 
pSrc
, 
pProbe
, 0);

118438 #ifdeà
SQLITE_ENABLE_STAT3_OR_STAT4


118439 
sql™e3St4ProbeF»e
(
pBužd”
->
pRec
);

118440 
	gpBužd”
->
	gnRecV®id
 = 0;

118441 
	gpBužd”
->
	gpRec
 = 0;

118446 ifÐ
	gpSrc
->
	gpIndex
 ) ;

118448  
	grc
;

118451 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


118456 
wh”eLoÝAddVœtu®
(

118457 
Wh”eLoÝBužd”
 *
pBužd”
,

118458 
B™mask
 
mExŒa


118460 
Wh”eInfo
 *
	gpWInfo
;

118461 
P¬£
 *
	gpP¬£
;

118462 
Wh”eCÏu£
 *
	gpWC
;

118463 
SrcLi¡_™em
 *
	gpSrc
;

118464 
TabË
 *
	gpTab
;

118465 
sql™e3
 *
	gdb
;

118466 
sql™e3_šdex_šfo
 *
	gpIdxInfo
;

118467 
sql™e3_šdex_cÚ¡¿št
 *
	gpIdxCÚs
;

118468 
sql™e3_šdex_cÚ¡¿št_u§ge
 *
	gpU§ge
;

118469 
Wh”eT”m
 *
	gpT”m
;

118470 
	gi
, 
	gj
;

118471 
	giT”m
, 
	gmxT”m
;

118472 
	gnCÚ¡¿št
;

118473 
	g£’In
 = 0;

118474 
	g£’V¬
 = 0;

118475 
	giPha£
;

118476 
Wh”eLoÝ
 *
	gpNew
;

118477 
	grc
 = 
SQLITE_OK
;

118479 
	gpWInfo
 = 
pBužd”
->
pWInfo
;

118480 
	gpP¬£
 = 
pWInfo
->
pP¬£
;

118481 
	gdb
 = 
pP¬£
->
db
;

118482 
	gpWC
 = 
pBužd”
->
pWC
;

118483 
	gpNew
 = 
pBužd”
->
pNew
;

118484 
	gpSrc
 = &
pWInfo
->
pTabLi¡
->
a
[
pNew
->
iTab
];

118485 
	gpTab
 = 
pSrc
->
pTab
;

118486 
as£¹
Ð
IsVœtu®
(
pTab
) );

118487 
	gpIdxInfo
 = 
®loÿ‹IndexInfo
(
pP¬£
, 
pWC
, 
pSrc
, 
pBužd”
->
pOrd”By
);

118488 ifÐ
	gpIdxInfo
==0 )  
SQLITE_NOMEM
;

118489 
	gpNew
->
	g´”eq
 = 0;

118490 
	gpNew
->
	grS‘up
 = 0;

118491 
	gpNew
->
	gwsFÏgs
 = 
WHERE_VIRTUALTABLE
;

118492 
	gpNew
->
	gnLT”m
 = 0;

118493 
	gpNew
->
	gu
.
	gvb
.
	gÃedF»e
 = 0;

118494 
	gpU§ge
 = 
pIdxInfo
->
aCÚ¡¿štU§ge
;

118495 
	gnCÚ¡¿št
 = 
pIdxInfo
->
nCÚ¡¿št
;

118496 ifÐ
wh”eLoÝResize
(
db
, 
pNew
, 
nCÚ¡¿št
) ){

118497 
sql™e3DbF»e
(
db
, 
pIdxInfo
);

118498  
	gSQLITE_NOMEM
;

118501 
	giPha£
=0; iPhase<=3; iPhase++){

118502 ifÐ!
	g£’In
 && (
	giPha£
&1)!=0 ){

118503 
iPha£
++;

118504 ifÐ
	giPha£
>3 ) ;

118506 ifÐ!
	g£’V¬
 && 
	giPha£
>1 ) ;

118507 
	gpIdxCÚs
 = *(
sql™e3_šdex_cÚ¡¿št
**)&
pIdxInfo
->
aCÚ¡¿št
;

118508 
	gi
=0; i<
	gpIdxInfo
->
	gnCÚ¡¿št
; i++, 
	gpIdxCÚs
++){

118509 
	gj
 = 
pIdxCÚs
->
iT”mOff£t
;

118510 
	gpT”m
 = &
pWC
->
a
[
j
];

118511  
	giPha£
 ){

118513 
pIdxCÚs
->
u§bË
 = 0;

118514 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_IN
)!=0 ){

118515 
£’In
 = 1;

118517 ifÐ
	gpT”m
->
	g´”eqRight
!=0 ){

118518 
£’V¬
 = 1;

118519 }ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_IN
)==0 ){

118520 
pIdxCÚs
->
u§bË
 = 1;

118524 
as£¹
Ð
£’In
 );

118525 
	gpIdxCÚs
->
	gu§bË
 = (
pT”m
->
´”eqRight
==0);

118528 
as£¹
Ð
£’V¬
 );

118529 
	gpIdxCÚs
->
	gu§bË
 = (
pT”m
->
eO³¿tÜ
 & 
WO_IN
)==0;

118532 
as£¹
Ð
£’V¬
 && 
£’In
 );

118533 
	gpIdxCÚs
->
	gu§bË
 = 1;

118537 
mem£t
(
pU§ge
, 0, ÕU§ge[0])*
pIdxInfo
->
nCÚ¡¿št
);

118538 ifÐ
	gpIdxInfo
->
	gÃedToF»eIdxSŒ
 ) 
sql™e3_ä“
(
pIdxInfo
->
idxSŒ
);

118539 
	gpIdxInfo
->
	gidxSŒ
 = 0;

118540 
	gpIdxInfo
->
	gidxNum
 = 0;

118541 
	gpIdxInfo
->
	gÃedToF»eIdxSŒ
 = 0;

118542 
	gpIdxInfo
->
	gÜd”ByCÚsumed
 = 0;

118543 
	gpIdxInfo
->
	ge¡im©edCo¡
 = 
SQLITE_BIG_DBL
 / ()2;

118544 
	gpIdxInfo
->
	ge¡im©edRows
 = 25;

118545 
	grc
 = 
vbBe¡Index
(
pP¬£
, 
pTab
, 
pIdxInfo
);

118546 ifÐ
	grc
 ) 
	gwh”eLoÝAddVb_ex™
;

118547 
	gpIdxCÚs
 = *(
sql™e3_šdex_cÚ¡¿št
**)&
pIdxInfo
->
aCÚ¡¿št
;

118548 
	gpNew
->
	g´”eq
 = 
mExŒa
;

118549 
	gmxT”m
 = -1;

118550 
as£¹
Ð
pNew
->
nLSlÙ
>=
nCÚ¡¿št
 );

118551 
	gi
=0; i<
	gnCÚ¡¿št
; i++è
	gpNew
->
	gaLT”m
[
i
] = 0;

118552 
	gpNew
->
	gu
.
	gvb
.
	gom™Mask
 = 0;

118553 
	gi
=0; i<
	gnCÚ¡¿št
; i++, 
	gpIdxCÚs
++){

118554 ifÐ(
	giT”m
 = 
pU§ge
[
i
].
¬gvIndex
 - 1)>=0 ){

118555 
j
 = 
pIdxCÚs
->
iT”mOff£t
;

118556 ifÐ
	giT”m
>=
nCÚ¡¿št


118557 || 
j
<0

118558 || 
j
>=
pWC
->
nT”m


118559 || 
pNew
->
aLT”m
[
iT”m
]!=0

118561 
rc
 = 
SQLITE_ERROR
;

118562 
sql™e3E¼ÜMsg
(
pP¬£
, "%s.xBe¡Index(èm®funùiÚ", 
pTab
->
zName
);

118563 
	gwh”eLoÝAddVb_ex™
;

118565 
‹¡ÿ£
Ð
iT”m
==
nCÚ¡¿št
-1 );

118566 
‹¡ÿ£
Ð
j
==0 );

118567 
‹¡ÿ£
Ð
j
==
pWC
->
nT”m
-1 );

118568 
	gpT”m
 = &
pWC
->
a
[
j
];

118569 
	gpNew
->
	g´”eq
 |ð
pT”m
->
´”eqRight
;

118570 
as£¹
Ð
iT”m
<
pNew
->
nLSlÙ
 );

118571 
	gpNew
->
	gaLT”m
[
iT”m
] = 
pT”m
;

118572 ifÐ
	giT”m
>
	gmxT”m
 ) mxT”m = 
iT”m
;

118573 
‹¡ÿ£
Ð
iT”m
==15 );

118574 
‹¡ÿ£
Ð
iT”m
==16 );

118575 ifÐ
	giT”m
<16 && 
	gpU§ge
[
i
].
	gom™
 ) 
	gpNew
->
	gu
.
	gvb
.
	gom™Mask
 |ð1<<
iT”m
;

118576 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_IN
)!=0 ){

118577 ifÐ
pU§ge
[
i
].
om™
==0 ){

118589 
	gpIdxInfo
->
	gÜd”ByCÚsumed
 = 0;

118593 ifÐ
	gi
>=
nCÚ¡¿št
 ){

118594 
pNew
->
nLT”m
 = 
mxT”m
+1;

118595 
as£¹
Ð
pNew
->
nLT”m
<õNew->
nLSlÙ
 );

118596 
	gpNew
->
	gu
.
	gvb
.
	gidxNum
 = 
pIdxInfo
->
idxNum
;

118597 
	gpNew
->
	gu
.
	gvb
.
	gÃedF»e
 = 
pIdxInfo
->
ÃedToF»eIdxSŒ
;

118598 
	gpIdxInfo
->
	gÃedToF»eIdxSŒ
 = 0;

118599 
	gpNew
->
	gu
.
	gvb
.
	gidxSŒ
 = 
pIdxInfo
->
idxSŒ
;

118600 
	gpNew
->
	gu
.
	gvb
.
	gisOrd”ed
 = (
i8
)(
pIdxInfo
->
Üd”ByCÚsumed
 ?

118601 
pIdxInfo
->
nOrd”By
 : 0);

118602 
	gpNew
->
	grS‘up
 = 0;

118603 
	gpNew
->
	grRun
 = 
sql™e3LogE¡FromDoubË
(
pIdxInfo
->
e¡im©edCo¡
);

118604 
	gpNew
->
	gnOut
 = 
sql™e3LogE¡
(
pIdxInfo
->
e¡im©edRows
);

118605 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118606 ifÐ
	gpNew
->
	gu
.
	gvb
.
	gÃedF»e
 ){

118607 
sql™e3_ä“
(
pNew
->
u
.
vb
.
idxSŒ
);

118608 
	gpNew
->
	gu
.
	gvb
.
	gÃedF»e
 = 0;

118613 
	gwh”eLoÝAddVb_ex™
:

118614 ifÐ
pIdxInfo
->
ÃedToF»eIdxSŒ
 ) 
sql™e3_ä“
ÕIdxInfo->
idxSŒ
);

118615 
sql™e3DbF»e
(
db
, 
pIdxInfo
);

118616  
	grc
;

118624 
wh”eLoÝAddOr
(
Wh”eLoÝBužd”
 *
pBužd”
, 
B™mask
 
mExŒa
){

118625 
Wh”eInfo
 *
	gpWInfo
 = 
pBužd”
->
pWInfo
;

118626 
Wh”eCÏu£
 *
	gpWC
;

118627 
Wh”eLoÝ
 *
	gpNew
;

118628 
Wh”eT”m
 *
	gpT”m
, *
	gpWCEnd
;

118629 
	grc
 = 
SQLITE_OK
;

118630 
	giCur
;

118631 
Wh”eCÏu£
 
	g‹mpWC
;

118632 
Wh”eLoÝBužd”
 
	gsSubBužd
;

118633 
Wh”eOrS‘
 
	gsSum
, 
	gsCur
;

118634 
SrcLi¡_™em
 *
	gpI‹m
;

118636 
	gpWC
 = 
pBužd”
->
pWC
;

118637 
	gpWCEnd
 = 
pWC
->
a
 +…WC->
nT”m
;

118638 
	gpNew
 = 
pBužd”
->
pNew
;

118639 
mem£t
(&
sSum
, 0, (sSum));

118640 
	gpI‹m
 = 
pWInfo
->
pTabLi¡
->
a
 + 
pNew
->
iTab
;

118641 
	giCur
 = 
pI‹m
->
iCursÜ
;

118643 
	gpT”m
=
pWC
->
a
;…T”m<
	gpWCEnd
 && 
	grc
==
SQLITE_OK
;…Term++){

118644 ifÐ(
	gpT”m
->
	geO³¿tÜ
 & 
	gWO_OR
)!=0

118645 && (
pT”m
->
u
.
pOrInfo
->
šdexabË
 & 
pNew
->
maskS–f
)!=0

118647 
Wh”eCÏu£
 * cÚ¡ 
pOrWC
 = &
pT”m
->
u
.
pOrInfo
->
wc
;

118648 
Wh”eT”m
 * cÚ¡ 
	gpOrWCEnd
 = &
pOrWC
->
a
[pOrWC->
nT”m
];

118649 
Wh”eT”m
 *
	gpOrT”m
;

118650 
	gÚû
 = 1;

118651 
	gi
, 
	gj
;

118653 
	gsSubBužd
 = *
pBužd”
;

118654 
	gsSubBužd
.
	gpOrd”By
 = 0;

118655 
	gsSubBužd
.
	gpOrS‘
 = &
sCur
;

118657 
WHERETRACE
(0x200, ("Begš…roûssšg OR-þau£ %p\n", 
pT”m
));

118658 
	gpOrT”m
=
pOrWC
->
a
;…OrT”m<
	gpOrWCEnd
;…OrTerm++){

118659 ifÐ(
	gpOrT”m
->
	geO³¿tÜ
 & 
	gWO_AND
)!=0 ){

118660 
sSubBužd
.
pWC
 = &
pOrT”m
->
u
.
pAndInfo
->
wc
;

118661 }ifÐ
	gpOrT”m
->
	gËáCursÜ
==
iCur
 ){

118662 
‹mpWC
.
pWInfo
 = 
pWC
->pWInfo;

118663 
	g‹mpWC
.
	gpOu‹r
 = 
pWC
;

118664 
	g‹mpWC
.
	gÝ
 = 
TK_AND
;

118665 
	g‹mpWC
.
	gnT”m
 = 1;

118666 
	g‹mpWC
.
	ga
 = 
pOrT”m
;

118667 
	gsSubBužd
.
	gpWC
 = &
‹mpWC
;

118671 
	gsCur
.
	gn
 = 0;

118672 #ifdeà
WHERETRACE_ENABLED


118673 
WHERETRACE
(0x200, ("OR-term %d of %p has %d subterms:\n",

118674 ()(
pOrT”m
-
pOrWC
->
a
), 
pT”m
, 
sSubBužd
.
pWC
->
nT”m
));

118675 ifÐ
	gsql™e3Wh”eT¿û
 & 0x400 ){

118676 
	gi
=0; i<
	gsSubBužd
.
	gpWC
->
	gnT”m
; i++){

118677 
wh”eT”mPršt
(&
sSubBužd
.
pWC
->
a
[
i
], i);

118681 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


118682 ifÐ
IsVœtu®
(
pI‹m
->
pTab
) ){

118683 
	grc
 = 
wh”eLoÝAddVœtu®
(&
sSubBužd
, 
mExŒa
);

118687 
	grc
 = 
wh”eLoÝAddBŒ“
(&
sSubBužd
, 
mExŒa
);

118689 ifÐ
	grc
==
SQLITE_OK
 ){

118690 
rc
 = 
wh”eLoÝAddOr
(&
sSubBužd
, 
mExŒa
);

118692 
as£¹
Ð
rc
==
SQLITE_OK
 || 
sCur
.
n
==0 );

118693 ifÐ
	gsCur
.
	gn
==0 ){

118694 
sSum
.
n
 = 0;

118696 }ifÐ
	gÚû
 ){

118697 
wh”eOrMove
(&
sSum
, &
sCur
);

118698 
	gÚû
 = 0;

118700 
Wh”eOrS‘
 
	gsP»v
;

118701 
wh”eOrMove
(&
sP»v
, &
sSum
);

118702 
	gsSum
.
	gn
 = 0;

118703 
	gi
=0; i<
	gsP»v
.
	gn
; i++){

118704 
	gj
=0; j<
	gsCur
.
	gn
; j++){

118705 
wh”eOrIn£¹
(&
sSum
, 
sP»v
.
a
[
i
].
´”eq
 | 
sCur
.a[
j
].prereq,

118706 
sql™e3LogE¡Add
(
sP»v
.
a
[
i
].
rRun
, 
sCur
.a[
j
].rRun),

118707 
sql™e3LogE¡Add
(
sP»v
.
a
[
i
].
nOut
, 
sCur
.a[
j
].nOut));

118712 
	gpNew
->
	gnLT”m
 = 1;

118713 
	gpNew
->
	gaLT”m
[0] = 
pT”m
;

118714 
	gpNew
->
	gwsFÏgs
 = 
WHERE_MULTI_OR
;

118715 
	gpNew
->
	grS‘up
 = 0;

118716 
	gpNew
->
	giSÜtIdx
 = 0;

118717 
mem£t
(&
pNew
->
u
, 0, (pNew->u));

118718 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
sSum
.
n
; i++){

118731 
	gpNew
->
	grRun
 = 
sSum
.
a
[
i
].
rRun
 + 1;

118732 
	gpNew
->
	gnOut
 = 
sSum
.
a
[
i
].
nOut
;

118733 
	gpNew
->
	g´”eq
 = 
sSum
.
a
[
i
].
´”eq
;

118734 
	grc
 = 
wh”eLoÝIn£¹
(
pBužd”
, 
pNew
);

118736 
WHERETRACE
(0x200, ("End…roûssšg OR-þau£ %p\n", 
pT”m
));

118739  
	grc
;

118745 
wh”eLoÝAddAÎ
(
Wh”eLoÝBužd”
 *
pBužd”
){

118746 
Wh”eInfo
 *
	gpWInfo
 = 
pBužd”
->
pWInfo
;

118747 
B™mask
 
	gmExŒa
 = 0;

118748 
B™mask
 
	gmPriÜ
 = 0;

118749 
	giTab
;

118750 
SrcLi¡
 *
	gpTabLi¡
 = 
pWInfo
->
pTabLi¡
;

118751 
SrcLi¡_™em
 *
	gpI‹m
;

118752 
sql™e3
 *
	gdb
 = 
pWInfo
->
pP¬£
->
db
;

118753 
	gnTabLi¡
 = 
pWInfo
->
nLev–
;

118754 
	grc
 = 
SQLITE_OK
;

118755 
u8
 
	g´iÜJošTy³
 = 0;

118756 
Wh”eLoÝ
 *
	gpNew
;

118759 
	gpNew
 = 
pBužd”
->
pNew
;

118760 
wh”eLoÝIn™
(
pNew
);

118761 
	giTab
=0, 
	gpI‹m
=
pTabLi¡
->
a
; iTab<
	gnTabLi¡
; iTab++,…Item++){

118762 
	gpNew
->
	giTab
 = 
iTab
;

118763 
	gpNew
->
	gmaskS–f
 = 
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pI‹m
->
iCursÜ
);

118764 ifÐ((
	gpI‹m
->
	gjošty³
|
	g´iÜJošTy³
è& (
	gJT_LEFT
|
	gJT_CROSS
))!=0 ){

118765 
mExŒa
 = 
mPriÜ
;

118767 
	g´iÜJošTy³
 = 
pI‹m
->
jošty³
;

118768 ifÐ
IsVœtu®
(
pI‹m
->
pTab
) ){

118769 
	grc
 = 
wh”eLoÝAddVœtu®
(
pBužd”
, 
mExŒa
);

118771 
	grc
 = 
wh”eLoÝAddBŒ“
(
pBužd”
, 
mExŒa
);

118773 ifÐ
	grc
==
SQLITE_OK
 ){

118774 
rc
 = 
wh”eLoÝAddOr
(
pBužd”
, 
mExŒa
);

118776 
	gmPriÜ
 |ð
pNew
->
maskS–f
;

118777 ifÐ
	grc
 || 
	gdb
->
	gm®locFažed
 ) ;

118779 
wh”eLoÝCË¬
(
db
, 
pNew
);

118780  
	grc
;

118800 
i8
 
wh”eP©hS©isf›sOrd”By
(

118801 
Wh”eInfo
 *
pWInfo
,

118802 
Ex´Li¡
 *
pOrd”By
,

118803 
Wh”eP©h
 *
pP©h
,

118804 
u16
 
wù¾FÏgs
,

118805 
u16
 
nLoÝ
,

118806 
Wh”eLoÝ
 *
pLa¡
,

118807 
B™mask
 *
pRevMask


118809 
u8
 
	g»vS‘
;

118810 
u8
 
	g»v
;

118811 
u8
 
	g»vIdx
;

118812 
u8
 
	gisOrd”Di¡šù
;

118813 
u8
 
	gdi¡šùCÞumns
;

118814 
u8
 
	gisM©ch
;

118815 
u16
 
	gnKeyCÞ
;

118816 
u16
 
	gnCÞumn
;

118817 
u16
 
	gnOrd”By
;

118818 
	giLoÝ
;

118819 
	gi
, 
	gj
;

118820 
	giCur
;

118821 
	giCÞumn
;

118822 
Wh”eLoÝ
 *
	gpLoÝ
 = 0;

118823 
Wh”eT”m
 *
	gpT”m
;

118824 
Ex´
 *
	gpOBEx´
;

118825 
CÞlSeq
 *
	gpCÞl
;

118826 
Index
 *
	gpIndex
;

118827 
sql™e3
 *
	gdb
 = 
pWInfo
->
pP¬£
->
db
;

118828 
B™mask
 
	gobS©
 = 0;

118829 
B™mask
 
	gobDÚe
;

118830 
B™mask
 
	gÜd”Di¡šùMask
;

118831 
B™mask
 
	g»ady
;

118855 
as£¹
Ð
pOrd”By
!=0 );

118856 ifÐ
	gnLoÝ
 && 
O±imiz©iÚDi§bËd
(
db
, 
SQLITE_Ord”ByIdxJoš
) )  0;

118858 
	gnOrd”By
 = 
pOrd”By
->
nEx´
;

118859 
‹¡ÿ£
Ð
nOrd”By
==
BMS
-1 );

118860 ifÐ
	gnOrd”By
>
	gBMS
-1 )  0;

118861 
	gisOrd”Di¡šù
 = 1;

118862 
	gobDÚe
 = 
MASKBIT
(
nOrd”By
)-1;

118863 
	gÜd”Di¡šùMask
 = 0;

118864 
	g»ady
 = 0;

118865 
	giLoÝ
=0; 
	gisOrd”Di¡šù
 && 
	gobS©
<
	gobDÚe
 && iLoÝ<=
nLoÝ
; iLoop++){

118866 ifÐ
	giLoÝ
>0 ) 
	g»ady
 |ð
pLoÝ
->
maskS–f
;

118867 
	gpLoÝ
 = 
iLoÝ
<
nLoÝ
 ? 
pP©h
->
aLoÝ
[iLoÝ] : 
pLa¡
;

118868 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_VIRTUALTABLE
 ){

118869 ifÐ
	gpLoÝ
->
	gu
.
	gvb
.
	gisOrd”ed
 ) 
	gobS©
 = 
obDÚe
;

118872 
	giCur
 = 
pWInfo
->
pTabLi¡
->
a
[
pLoÝ
->
iTab
].
iCursÜ
;

118879 
	gi
=0; i<
	gnOrd”By
; i++){

118880 ifÐ
MASKBIT
(
i
è& 
	gobS©
 ) ;

118881 
	gpOBEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pOrd”By
->
a
[
i
].
pEx´
);

118882 ifÐ
	gpOBEx´
->
	gÝ
!=
TK_COLUMN
 ) ;

118883 ifÐ
	gpOBEx´
->
	giTabË
!=
iCur
 ) ;

118884 
	gpT”m
 = 
fšdT”m
(&
pWInfo
->
sWC
, 
iCur
, 
pOBEx´
->
iCÞumn
,

118885 ~
»ady
, 
WO_EQ
|
WO_ISNULL
, 0);

118886 ifÐ
	gpT”m
==0 ) ;

118887 ifÐ(
	gpT”m
->
	geO³¿tÜ
&
	gWO_EQ
)!=0 && 
pOBEx´
->
iCÞumn
>=0 ){

118888 cÚ¡ *
z1
, *
z2
;

118889 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pWInfo
->
pP¬£
, 
pOrd”By
->
a
[
i
].
pEx´
);

118890 ifÐ!
	gpCÞl
 )…CÞÈð
db
->
pDætCÞl
;

118891 
	gz1
 = 
pCÞl
->
zName
;

118892 
	gpCÞl
 = 
sql™e3Ex´CÞlSeq
(
pWInfo
->
pP¬£
, 
pT”m
->
pEx´
);

118893 ifÐ!
	gpCÞl
 )…CÞÈð
db
->
pDætCÞl
;

118894 
	gz2
 = 
pCÞl
->
zName
;

118895 ifÐ
sql™e3SŒICmp
(
z1
, 
z2
)!=0 ) ;

118897 
	gobS©
 |ð
MASKBIT
(
i
);

118900 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_ONEROW
)==0 ){

118901 ifÐ
pLoÝ
->
wsFÏgs
 & 
WHERE_IPK
 ){

118902 
pIndex
 = 0;

118903 
	gnKeyCÞ
 = 0;

118904 
	gnCÞumn
 = 1;

118905 }ifÐ(
	gpIndex
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
)==0 ||…Index->
bUnÜd”ed
 ){

118908 
	gnKeyCÞ
 = 
pIndex
->
nKeyCÞ
;

118909 
	gnCÞumn
 = 
pIndex
->
nCÞumn
;

118910 
as£¹
Ð
nCÞumn
==
nKeyCÞ
+1 || !
HasRowid
(
pIndex
->
pTabË
) );

118911 
as£¹
Ð
pIndex
->
aiCÞumn
[
nCÞumn
-1]==(-1è|| !
HasRowid
ÕIndex->
pTabË
));

118912 
	gisOrd”Di¡šù
 = 
IsUniqueIndex
(
pIndex
);

118918 
	g»v
 = 
»vS‘
 = 0;

118919 
	gdi¡šùCÞumns
 = 0;

118920 
	gj
=0; j<
	gnCÞumn
; j++){

118921 
u8
 
	gbOnû
;

118924 ifÐ
	gj
<
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnEq


118925 && 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnSk
==0

118926 && ((
i
 = 
pLoÝ
->
aLT”m
[
j
]->
eO³¿tÜ
è& (
WO_EQ
|
WO_ISNULL
))!=0

118928 ifÐ
i
 & 
WO_ISNULL
 ){

118929 
‹¡ÿ£
Ð
isOrd”Di¡šù
 );

118930 
	gisOrd”Di¡šù
 = 0;

118938 ifÐ
	gpIndex
 ){

118939 
	giCÞumn
 = 
pIndex
->
aiCÞumn
[
j
];

118940 
	g»vIdx
 = 
pIndex
->
aSÜtOrd”
[
j
];

118941 ifÐ
	giCÞumn
==
pIndex
->
pTabË
->
iPKey
 ) 
iCÞumn
 = -1;

118943 
	giCÞumn
 = -1;

118944 
	g»vIdx
 = 0;

118950 ifÐ
	gisOrd”Di¡šù


118951 && 
	giCÞumn
>=0

118952 && 
j
>=
pLoÝ
->
u
.
bŒ“
.
nEq


118953 && 
pIndex
->
pTabË
->
aCÞ
[
iCÞumn
].
nÙNuÎ
==0

118955 
isOrd”Di¡šù
 = 0;

118961 
	gbOnû
 = 1;

118962 
	gisM©ch
 = 0;

118963 
	gi
=0; 
	gbOnû
 && i<
	gnOrd”By
; i++){

118964 ifÐ
MASKBIT
(
i
è& 
	gobS©
 ) ;

118965 
	gpOBEx´
 = 
sql™e3Ex´SkCÞÏ‹
(
pOrd”By
->
a
[
i
].
pEx´
);

118966 
‹¡ÿ£
Ð
wù¾FÏgs
 & 
WHERE_GROUPBY
 );

118967 
‹¡ÿ£
Ð
wù¾FÏgs
 & 
WHERE_DISTINCTBY
 );

118968 ifÐ(
	gwù¾FÏgs
 & (
	gWHERE_GROUPBY
|
	gWHERE_DISTINCTBY
))==0 ) 
bOnû
 = 0;

118969 ifÐ
	gpOBEx´
->
	gÝ
!=
TK_COLUMN
 ) ;

118970 ifÐ
	gpOBEx´
->
	giTabË
!=
iCur
 ) ;

118971 ifÐ
	gpOBEx´
->
	giCÞumn
!=
iCÞumn
 ) ;

118972 ifÐ
	giCÞumn
>=0 ){

118973 
pCÞl
 = 
sql™e3Ex´CÞlSeq
(
pWInfo
->
pP¬£
, 
pOrd”By
->
a
[
i
].
pEx´
);

118974 ifÐ!
	gpCÞl
 )…CÞÈð
db
->
pDætCÞl
;

118975 ifÐ
sql™e3SŒICmp
(
pCÞl
->
zName
, 
pIndex
->
azCÞl
[
j
])!=0 ) ;

118977 
	gisM©ch
 = 1;

118980 ifÐ
	gisM©ch
 && (
	gwù¾FÏgs
 & 
	gWHERE_GROUPBY
)==0 ){

118983 ifÐ
»vS‘
 ){

118984 ifÐ(
»v
 ^ 
»vIdx
)!=
pOrd”By
->
a
[
i
].
sÜtOrd”
 ) 
isM©ch
 = 0;

118986 
	g»v
 = 
»vIdx
 ^ 
pOrd”By
->
a
[
i
].
sÜtOrd”
;

118987 ifÐ
	g»v
 ) *
	gpRevMask
 |ð
MASKBIT
(
iLoÝ
);

118988 
	g»vS‘
 = 1;

118991 ifÐ
	gisM©ch
 ){

118992 ifÐ
	giCÞumn
<0 ){

118993 
‹¡ÿ£
Ð
di¡šùCÞumns
==0 );

118994 
	gdi¡šùCÞumns
 = 1;

118996 
	gobS©
 |ð
MASKBIT
(
i
);

118999 ifÐ
	gj
==0 || 
j
<
nKeyCÞ
 ){

119000 
‹¡ÿ£
Ð
isOrd”Di¡šù
!=0 );

119001 
	gisOrd”Di¡šù
 = 0;

119006 ifÐ
	gdi¡šùCÞumns
 ){

119007 
‹¡ÿ£
Ð
isOrd”Di¡šù
==0 );

119008 
	gisOrd”Di¡šù
 = 1;

119013 ifÐ
	gisOrd”Di¡šù
 ){

119014 
	gÜd”Di¡šùMask
 |ð
pLoÝ
->
maskS–f
;

119015 
	gi
=0; i<
	gnOrd”By
; i++){

119016 
Ex´
 *
	gp
;

119017 
B™mask
 
	gmT”m
;

119018 ifÐ
MASKBIT
(
i
è& 
	gobS©
 ) ;

119019 
	gp
 = 
pOrd”By
->
a
[
i
].
pEx´
;

119020 
	gmT”m
 = 
ex´TabËU§ge
(&
pWInfo
->
sMaskS‘
,
p
);

119021 ifÐ
	gmT”m
==0 && !
sql™e3Ex´IsCÚ¡ªt
(
p
) ) ;

119022 ifÐ(
	gmT”m
&~
	gÜd”Di¡šùMask
)==0 ){

119023 
obS©
 |ð
MASKBIT
(
i
);

119028 ifÐ
	gobS©
==
obDÚe
 )  (
i8
)
nOrd”By
;

119029 ifÐ!
	gisOrd”Di¡šù
 ){

119030 
	gi
=
nOrd”By
-1; i>0; i--){

119031 
B™mask
 
	gm
 = 
MASKBIT
(
i
) - 1;

119032 ifÐ(
	gobS©
&
	gm
)==
m
 )  
i
;

119063 
SQLITE_PRIVATE
 
sql™e3Wh”eIsSÜ‹d
(
Wh”eInfo
 *
pWInfo
){

119064 
as£¹
Ð
pWInfo
->
wù¾FÏgs
 & 
WHERE_GROUPBY
 );

119065 
as£¹
Ð
pWInfo
->
wù¾FÏgs
 & 
WHERE_SORTBYGROUP
 );

119066  
	gpWInfo
->
	gsÜ‹d
;

119069 #ifdeà
WHERETRACE_ENABLED


119071 cÚ¡ *
wh”eP©hName
(
Wh”eP©h
 *
pP©h
, 
nLoÝ
, 
Wh”eLoÝ
 *
pLa¡
){

119072 
	gzName
[65];

119073 
	gi
;

119074 
	gi
=0; i<
	gnLoÝ
; i++){ 
	gzName
[
i
] = 
pP©h
->
aLoÝ
[i]->
cId
; }

119075 ifÐ
	gpLa¡
 ) 
	gzName
[
i
++] = 
pLa¡
->
cId
;

119076 
	gzName
[
i
] = 0;

119077  
	gzName
;

119086 
LogE¡
 
wh”eSÜtšgCo¡
(

119087 
Wh”eInfo
 *
pWInfo
,

119088 
LogE¡
 
nRow
,

119089 
nOrd”By
,

119090 
nSÜ‹d


119105 
LogE¡
 
	grSÿË
, 
	grSÜtCo¡
;

119106 
as£¹
Ð
nOrd”By
>0 && 66==
sql™e3LogE¡
(100) );

119107 
	grSÿË
 = 
sql™e3LogE¡
((
nOrd”By
-
nSÜ‹d
)*100/nOrderBy) - 66;

119108 
	grSÜtCo¡
 = 
nRow
 + 
e¡Log
ÒRowè+ 
rSÿË
 + 16;

119113 ifÐ
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
 ){

119114 
	grSÜtCo¡
 += 16;

119117  
	grSÜtCo¡
;

119132 
wh”eP©hSÞv”
(
Wh”eInfo
 *
pWInfo
, 
LogE¡
 
nRowE¡
){

119133 
	gmxChoiû
;

119134 
	gnLoÝ
;

119135 
P¬£
 *
	gpP¬£
;

119136 
sql™e3
 *
	gdb
;

119137 
	giLoÝ
;

119138 
	gii
, 
	gjj
;

119139 
	gmxI
 = 0;

119140 
	gnOrd”By
;

119141 
LogE¡
 
	gmxCo¡
 = 0;

119142 
LogE¡
 
	gmxUnsÜ‹d
 = 0;

119143 
	gnTo
, 
	gnFrom
;

119144 
Wh”eP©h
 *
	gaFrom
;

119145 
Wh”eP©h
 *
	gaTo
;

119146 
Wh”eP©h
 *
	gpFrom
;

119147 
Wh”eP©h
 *
	gpTo
;

119148 
Wh”eLoÝ
 *
	gpWLoÝ
;

119149 
Wh”eLoÝ
 **
	gpX
;

119150 
LogE¡
 *
	gaSÜtCo¡
 = 0;

119151 *
	gpS·û
;

119152 
	gnS·û
;

119154 
	gpP¬£
 = 
pWInfo
->
pP¬£
;

119155 
	gdb
 = 
pP¬£
->
db
;

119156 
	gnLoÝ
 = 
pWInfo
->
nLev–
;

119160 
	gmxChoiû
 = (
nLoÝ
<=1) ? 1 : (nLoop==2 ? 5 : 10);

119161 
as£¹
Ð
nLoÝ
<=
pWInfo
->
pTabLi¡
->
nSrc
 );

119162 
WHERETRACE
(0x002, ("---- begš sÞv”. (nRowE¡=%d)\n", 
nRowE¡
));

119169 ifÐ
	gpWInfo
->
	gpOrd”By
==0 || 
nRowE¡
==0 ){

119170 
nOrd”By
 = 0;

119172 
	gnOrd”By
 = 
pWInfo
->
pOrd”By
->
nEx´
;

119176 
	gnS·û
 = ((
Wh”eP©h
)+(
Wh”eLoÝ
*)*
nLoÝ
)*
mxChoiû
*2;

119177 
	gnS·û
 +ð(
LogE¡
è* 
nOrd”By
;

119178 
	gpS·û
 = 
sql™e3DbM®locRaw
(
db
, 
nS·û
);

119179 ifÐ
	gpS·û
==0 )  
SQLITE_NOMEM
;

119180 
	gaTo
 = (
Wh”eP©h
*)
pS·û
;

119181 
	gaFrom
 = 
aTo
+
mxChoiû
;

119182 
mem£t
(
aFrom
, 0, (aFrom[0]));

119183 
	gpX
 = (
Wh”eLoÝ
**)(
aFrom
+
mxChoiû
);

119184 
	gii
=
mxChoiû
*2, 
	gpFrom
=
aTo
; ii>0; ii--,…From++, 
	gpX
 +ð
nLoÝ
){

119185 
pFrom
->
aLoÝ
 = 
pX
;

119187 ifÐ
	gnOrd”By
 ){

119194 
	gaSÜtCo¡
 = (
LogE¡
*)
pX
;

119195 
mem£t
(
aSÜtCo¡
, 0, (
LogE¡
è* 
nOrd”By
);

119197 
as£¹
Ð
aSÜtCo¡
==0 || &
pS·û
[
nS·û
]==(*)&aSÜtCo¡[
nOrd”By
] );

119198 
as£¹
Ð
aSÜtCo¡
!=0 || &
pS·û
[
nS·û
]==(*)
pX
 );

119205 
	gaFrom
[0].
	gnRow
 = 
MIN
(
pP¬£
->
nQu”yLoÝ
, 46); 
as£¹
Ð46==
sql™e3LogE¡
(25) );

119206 
	gnFrom
 = 1;

119207 
as£¹
Ð
aFrom
[0].
isOrd”ed
==0 );

119208 ifÐ
	gnOrd”By
 ){

119215 
	gaFrom
[0].
	gisOrd”ed
 = 
nLoÝ
>0 ? -1 : 
nOrd”By
;

119221 
	giLoÝ
=0; iLoÝ<
	gnLoÝ
; iLoop++){

119222 
	gnTo
 = 0;

119223 
	gii
=0, 
	gpFrom
=
aFrom
; ii<
	gnFrom
; ii++,…From++){

119224 
	gpWLoÝ
=
pWInfo
->
pLoÝs
;…WLoÝ;…WLoÝ=
pWLoÝ
->
pNextLoÝ
){

119225 
LogE¡
 
nOut
;

119226 
LogE¡
 
	grCo¡
;

119227 
LogE¡
 
	grUnsÜ‹d
;

119228 
i8
 
	gisOrd”ed
 = 
pFrom
->
isOrd”ed
;

119229 
B™mask
 
	gmaskNew
;

119230 
B™mask
 
	g»vMask
 = 0;

119232 ifÐ(
	gpWLoÝ
->
	g´”eq
 & ~
	gpFrom
->
	gmaskLoÝ
)!=0 ) ;

119233 ifÐ(
	gpWLoÝ
->
	gmaskS–f
 & 
	gpFrom
->
	gmaskLoÝ
)!=0 ) ;

119236 
	grUnsÜ‹d
 = 
sql™e3LogE¡Add
(
pWLoÝ
->
rS‘up
,pWLoÝ->
rRun
 + 
pFrom
->
nRow
);

119237 
	grUnsÜ‹d
 = 
sql™e3LogE¡Add
(
rUnsÜ‹d
, 
pFrom
->rUnsorted);

119238 
	gnOut
 = 
pFrom
->
nRow
 + 
pWLoÝ
->
nOut
;

119239 
	gmaskNew
 = 
pFrom
->
maskLoÝ
 | 
pWLoÝ
->
maskS–f
;

119240 ifÐ
	gisOrd”ed
<0 ){

119241 
	gisOrd”ed
 = 
wh”eP©hS©isf›sOrd”By
(
pWInfo
,

119242 
pWInfo
->
pOrd”By
, 
pFrom
,…WInfo->
wù¾FÏgs
,

119243 
iLoÝ
, 
pWLoÝ
, &
»vMask
);

119245 
	g»vMask
 = 
pFrom
->
»vLoÝ
;

119247 ifÐ
	gisOrd”ed
>=0 && 
isOrd”ed
<
nOrd”By
 ){

119248 ifÐ
aSÜtCo¡
[
isOrd”ed
]==0 ){

119249 
aSÜtCo¡
[
isOrd”ed
] = 
wh”eSÜtšgCo¡
(

119250 
pWInfo
, 
nRowE¡
, 
nOrd”By
, 
isOrd”ed


119253 
	grCo¡
 = 
sql™e3LogE¡Add
(
rUnsÜ‹d
, 
aSÜtCo¡
[
isOrd”ed
]);

119255 
WHERETRACE
(0x002,

119257 
aSÜtCo¡
[
isOrd”ed
], (
nOrd”By
-isOrdered),‚OrderBy,

119258 
rUnsÜ‹d
, 
rCo¡
));

119260 
	grCo¡
 = 
rUnsÜ‹d
;

119274 
	gjj
=0, 
	gpTo
=
aTo
; jj<
	gnTo
; jj++,…To++){

119275 ifÐ
	gpTo
->
	gmaskLoÝ
==
maskNew


119276 && ((
pTo
->
isOrd”ed
^isOrdered)&0x80)==0

119278 
‹¡ÿ£
Ð
jj
==
nTo
-1 );

119282 ifÐ
	gjj
>=
nTo
 ){

119284 ifÐ
nTo
>=
mxChoiû


119285 && (
rCo¡
>
mxCo¡
 || (rCo¡==mxCo¡ && 
rUnsÜ‹d
>=
mxUnsÜ‹d
))

119290 #ifdeà
WHERETRACE_ENABLED


119291 ifÐ
sql™e3Wh”eT¿û
&0x4 ){

119292 
sql™e3DebugPrštf
("Skip %s cost=%-3d,%3d order=%c\n",

119293 
wh”eP©hName
(
pFrom
, 
iLoÝ
, 
pWLoÝ
), 
rCo¡
, 
nOut
,

119294 
isOrd”ed
>=0 ? isOrdered+'0' : '?');

119301 ifÐ
	gnTo
<
	gmxChoiû
 ){

119303 
	gjj
 = 
nTo
++;

119306 
	gjj
 = 
mxI
;

119308 
	gpTo
 = &
aTo
[
jj
];

119309 #ifdeà
WHERETRACE_ENABLED


119310 ifÐ
	gsql™e3Wh”eT¿û
&0x4 ){

119311 
sql™e3DebugPrštf
("New %s cost=%-3d,%3d order=%c\n",

119312 
wh”eP©hName
(
pFrom
, 
iLoÝ
, 
pWLoÝ
), 
rCo¡
, 
nOut
,

119313 
isOrd”ed
>=0 ? isOrdered+'0' : '?');

119321 ifÐ
	gpTo
->
	grCo¡
<rCo¡ || (pTo->rCo¡==
rCo¡
 && 
pTo
->
nRow
<=
nOut
) ){

119322 #ifdeà
WHERETRACE_ENABLED


119323 ifÐ
sql™e3Wh”eT¿û
&0x4 ){

119324 
sql™e3DebugPrštf
(

119326 
wh”eP©hName
(
pFrom
, 
iLoÝ
, 
pWLoÝ
), 
rCo¡
, 
nOut
,

119327 
isOrd”ed
>=0 ? isOrdered+'0' : '?');

119328 
sql™e3DebugPrštf
(" vs %s cost=%-3d,%d order=%c\n",

119329 
wh”eP©hName
(
pTo
, 
iLoÝ
+1, 0),…To->
rCo¡
,…To->
nRow
,

119330 
pTo
->
isOrd”ed
>=0 ?…To->isOrdered+'0' : '?');

119334 
‹¡ÿ£
Ð
pTo
->
rCo¡
==rCost );

119337 
‹¡ÿ£
Ð
pTo
->
rCo¡
==rCost+1 );

119340 #ifdeà
WHERETRACE_ENABLED


119341 ifÐ
	gsql™e3Wh”eT¿û
&0x4 ){

119342 
sql™e3DebugPrštf
(

119344 
wh”eP©hName
(
pFrom
, 
iLoÝ
, 
pWLoÝ
), 
rCo¡
, 
nOut
,

119345 
isOrd”ed
>=0 ? isOrdered+'0' : '?');

119346 
sql™e3DebugPrštf
(" was %s cost=%-3d,%3d order=%c\n",

119347 
wh”eP©hName
(
pTo
, 
iLoÝ
+1, 0),…To->
rCo¡
,…To->
nRow
,

119348 
pTo
->
isOrd”ed
>=0 ?…To->isOrdered+'0' : '?');

119353 
	gpTo
->
	gmaskLoÝ
 = 
pFrom
->
maskLoÝ
 | 
pWLoÝ
->
maskS–f
;

119354 
	gpTo
->
	g»vLoÝ
 = 
»vMask
;

119355 
	gpTo
->
	gnRow
 = 
nOut
;

119356 
	gpTo
->
	grCo¡
 = 
rCo¡
;

119357 
	gpTo
->
	grUnsÜ‹d
 = 
rUnsÜ‹d
;

119358 
	gpTo
->
	gisOrd”ed
 = 
isOrd”ed
;

119359 
memýy
(
pTo
->
aLoÝ
, 
pFrom
->aLoÝ, (
Wh”eLoÝ
*)*
iLoÝ
);

119360 
	gpTo
->
	gaLoÝ
[
iLoÝ
] = 
pWLoÝ
;

119361 ifÐ
	gnTo
>=
mxChoiû
 ){

119362 
mxI
 = 0;

119363 
	gmxCo¡
 = 
aTo
[0].
rCo¡
;

119364 
	gmxUnsÜ‹d
 = 
aTo
[0].
nRow
;

119365 
	gjj
=1, 
	gpTo
=&
aTo
[1]; jj<
	gmxChoiû
; jj++,…To++){

119366 ifÐ
	gpTo
->
	grCo¡
>
	gmxCo¡


119367 || (
	gpTo
->
	grCo¡
==
mxCo¡
 && 
pTo
->
rUnsÜ‹d
>
mxUnsÜ‹d
)

119369 
mxCo¡
 = 
pTo
->
rCo¡
;

119370 
	gmxUnsÜ‹d
 = 
pTo
->
rUnsÜ‹d
;

119371 
	gmxI
 = 
jj
;

119378 #ifdeà
WHERETRACE_ENABLED


119379 ifÐ
	gsql™e3Wh”eT¿û
>=2 ){

119380 
sql™e3DebugPrštf
("----‡á”„ound %d ----\n", 
iLoÝ
);

119381 
	gii
=0, 
	gpTo
=
aTo
; ii<
	gnTo
; ii++,…To++){

119382 
sql™e3DebugPrštf
(" %s cost=%-3d‚row=%-3d order=%c",

119383 
wh”eP©hName
(
pTo
, 
iLoÝ
+1, 0),…To->
rCo¡
,…To->
nRow
,

119384 
pTo
->
isOrd”ed
>=0 ? (pTo->isOrdered+'0') : '?');

119385 ifÐ
	gpTo
->
	gisOrd”ed
>0 ){

119386 
sql™e3DebugPrštf
("„ev=0x%Îx\n", 
pTo
->
»vLoÝ
);

119388 
sql™e3DebugPrštf
("\n");

119395 
	gpFrom
 = 
aTo
;

119396 
	gaTo
 = 
aFrom
;

119397 
	gaFrom
 = 
pFrom
;

119398 
	gnFrom
 = 
nTo
;

119401 ifÐ
	gnFrom
==0 ){

119402 
sql™e3E¼ÜMsg
(
pP¬£
, "no query solution");

119403 
sql™e3DbF»e
(
db
, 
pS·û
);

119404  
	gSQLITE_ERROR
;

119408 
	gpFrom
 = 
aFrom
;

119409 
	gii
=1; ii<
	gnFrom
; ii++){

119410 ifÐ
	gpFrom
->
	grCo¡
>
	gaFrom
[
ii
].rCo¡ )…From = &
aFrom
[ii];

119412 
as£¹
Ð
pWInfo
->
nLev–
==
nLoÝ
 );

119414 
	giLoÝ
=0; iLoÝ<
	gnLoÝ
; iLoop++){

119415 
Wh”eLev–
 *
	gpLev–
 = 
pWInfo
->
a
 + 
iLoÝ
;

119416 
	gpLev–
->
	gpWLoÝ
 = 
pWLoÝ
 = 
pFrom
->
aLoÝ
[
iLoÝ
];

119417 
	gpLev–
->
	giFrom
 = 
pWLoÝ
->
iTab
;

119418 
	gpLev–
->
	giTabCur
 = 
pWInfo
->
pTabLi¡
->
a
[
pLev–
->
iFrom
].
iCursÜ
;

119420 ifÐ(
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
)!=0

119421 && (
pWInfo
->
wù¾FÏgs
 & 
WHERE_DISTINCTBY
)==0

119422 && 
pWInfo
->
eDi¡šù
==
WHERE_DISTINCT_NOOP


119423 && 
nRowE¡


119425 
B™mask
 
nÙU£d
;

119426 
	grc
 = 
wh”eP©hS©isf›sOrd”By
(
pWInfo
,…WInfo->
pResuÉS‘
, 
pFrom
,

119427 
WHERE_DISTINCTBY
, 
nLoÝ
-1, 
pFrom
->
aLoÝ
[nLoÝ-1], &
nÙU£d
);

119428 ifÐ
	grc
==
pWInfo
->
pResuÉS‘
->
nEx´
 ){

119429 
pWInfo
->
eDi¡šù
 = 
WHERE_DISTINCT_ORDERED
;

119432 ifÐ
	gpWInfo
->
	gpOrd”By
 ){

119433 ifÐ
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_DISTINCTBY
 ){

119434 ifÐ
	gpFrom
->
	gisOrd”ed
==
pWInfo
->
pOrd”By
->
nEx´
 ){

119435 
pWInfo
->
eDi¡šù
 = 
WHERE_DISTINCT_ORDERED
;

119438 
	gpWInfo
->
	gnOBS©
 = 
pFrom
->
isOrd”ed
;

119439 ifÐ
	gpWInfo
->
	gnOBS©
<0 )…WInfo->nOBSat = 0;

119440 
	gpWInfo
->
	g»vMask
 = 
pFrom
->
»vLoÝ
;

119442 ifÐ(
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_SORTBYGROUP
)

119443 && 
	gpWInfo
->
	gnOBS©
==
pWInfo
->
pOrd”By
->
nEx´


119445 
B™mask
 
»vMask
 = 0;

119446 
	gnOrd”
 = 
wh”eP©hS©isf›sOrd”By
(
pWInfo
,…WInfo->
pOrd”By
,

119447 
pFrom
, 0, 
nLoÝ
-1,…From->
aLoÝ
[nLoÝ-1], &
»vMask


119449 
as£¹
Ð
pWInfo
->
sÜ‹d
==0 );

119450 ifÐ
	gnOrd”
==
pWInfo
->
pOrd”By
->
nEx´
 ){

119451 
pWInfo
->
sÜ‹d
 = 1;

119452 
	gpWInfo
->
	g»vMask
 = 
»vMask
;

119458 
	gpWInfo
->
	gnRowOut
 = 
pFrom
->
nRow
;

119461 
sql™e3DbF»e
(
db
, 
pS·û
);

119462  
	gSQLITE_OK
;

119476 
wh”eShÜtCut
(
Wh”eLoÝBužd”
 *
pBužd”
){

119477 
Wh”eInfo
 *
	gpWInfo
;

119478 
SrcLi¡_™em
 *
	gpI‹m
;

119479 
Wh”eCÏu£
 *
	gpWC
;

119480 
Wh”eT”m
 *
	gpT”m
;

119481 
Wh”eLoÝ
 *
	gpLoÝ
;

119482 
	giCur
;

119483 
	gj
;

119484 
TabË
 *
	gpTab
;

119485 
Index
 *
	gpIdx
;

119487 
	gpWInfo
 = 
pBužd”
->
pWInfo
;

119488 ifÐ
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_FORCE_TABLE
 )  0;

119489 
as£¹
Ð
pWInfo
->
pTabLi¡
->
nSrc
>=1 );

119490 
	gpI‹m
 = 
pWInfo
->
pTabLi¡
->
a
;

119491 
	gpTab
 = 
pI‹m
->
pTab
;

119492 ifÐ
IsVœtu®
(
pTab
) )  0;

119493 ifÐ
	gpI‹m
->
	gzIndex
 )  0;

119494 
	giCur
 = 
pI‹m
->
iCursÜ
;

119495 
	gpWC
 = &
pWInfo
->
sWC
;

119496 
	gpLoÝ
 = 
pBužd”
->
pNew
;

119497 
	gpLoÝ
->
	gwsFÏgs
 = 0;

119498 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnSk
 = 0;

119499 
	gpT”m
 = 
fšdT”m
(
pWC
, 
iCur
, -1, 0, 
WO_EQ
, 0);

119500 ifÐ
	gpT”m
 ){

119501 
	gpLoÝ
->
	gwsFÏgs
 = 
WHERE_COLUMN_EQ
|
WHERE_IPK
|
WHERE_ONEROW
;

119502 
	gpLoÝ
->
	gaLT”m
[0] = 
pT”m
;

119503 
	gpLoÝ
->
	gnLT”m
 = 1;

119504 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnEq
 = 1;

119506 
	gpLoÝ
->
	grRun
 = 33;

119508 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

119509 
as£¹
Ð
pLoÝ
->
aLT”mS·û
=õLoÝ->
aLT”m
 );

119510 
as£¹
Ð
A¼aySize
(
pLoÝ
->
aLT”mS·û
)==4 );

119511 ifÐ!
IsUniqueIndex
(
pIdx
)

119512 || 
	gpIdx
->
	gpP¬tIdxWh”e
!=0

119513 || 
pIdx
->
nKeyCÞ
>
A¼aySize
(
pLoÝ
->
aLT”mS·û
)

119515 
	gj
=0; j<
	gpIdx
->
	gnKeyCÞ
; j++){

119516 
	gpT”m
 = 
fšdT”m
(
pWC
, 
iCur
, 
pIdx
->
aiCÞumn
[
j
], 0, 
WO_EQ
,…Idx);

119517 ifÐ
	gpT”m
==0 ) ;

119518 
	gpLoÝ
->
	gaLT”m
[
j
] = 
pT”m
;

119520 ifÐ
	gj
!=
pIdx
->
nKeyCÞ
 ) ;

119521 
	gpLoÝ
->
	gwsFÏgs
 = 
WHERE_COLUMN_EQ
|
WHERE_ONEROW
|
WHERE_INDEXED
;

119522 ifÐ
	gpIdx
->
	gisCov”šg
 || (
	gpI‹m
->
	gcÞU£d
 & ~
cÞumnsInIndex
(
pIdx
))==0 ){

119523 
pLoÝ
->
wsFÏgs
 |ð
WHERE_IDX_ONLY
;

119525 
	gpLoÝ
->
	gnLT”m
 = 
j
;

119526 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gnEq
 = 
j
;

119527 
	gpLoÝ
->
	gu
.
	gbŒ“
.
	gpIndex
 = 
pIdx
;

119529 
	gpLoÝ
->
	grRun
 = 39;

119533 ifÐ
	gpLoÝ
->
	gwsFÏgs
 ){

119534 
	gpLoÝ
->
	gnOut
 = (
LogE¡
)1;

119535 
	gpWInfo
->
	ga
[0].
	gpWLoÝ
 = 
pLoÝ
;

119536 
	gpLoÝ
->
	gmaskS–f
 = 
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
iCur
);

119537 
	gpWInfo
->
	ga
[0].
	giTabCur
 = 
iCur
;

119538 
	gpWInfo
->
	gnRowOut
 = 1;

119539 ifÐ
	gpWInfo
->
	gpOrd”By
 )…WInfo->
	gnOBS©
 = 
pWInfo
->
pOrd”By
->
nEx´
;

119540 ifÐ
	gpWInfo
->
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
 ){

119541 
	gpWInfo
->
	geDi¡šù
 = 
WHERE_DISTINCT_UNIQUE
;

119543 #ifdeà
SQLITE_DEBUG


119544 
	gpLoÝ
->
	gcId
 = '0';

119639 
SQLITE_PRIVATE
 
Wh”eInfo
 *
sql™e3Wh”eBegš
(

119640 
P¬£
 *
pP¬£
,

119641 
SrcLi¡
 *
pTabLi¡
,

119642 
Ex´
 *
pWh”e
,

119643 
Ex´Li¡
 *
pOrd”By
,

119644 
Ex´Li¡
 *
pResuÉS‘
,

119645 
u16
 
wù¾FÏgs
,

119646 
iIdxCur


119648 
	gnBy‹WInfo
;

119649 
	gnTabLi¡
;

119650 
Wh”eInfo
 *
	gpWInfo
;

119651 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

119652 
B™mask
 
	gnÙR—dy
;

119653 
Wh”eLoÝBužd”
 
	gsWLB
;

119654 
Wh”eMaskS‘
 *
	gpMaskS‘
;

119655 
Wh”eLev–
 *
	gpLev–
;

119656 
Wh”eLoÝ
 *
	gpLoÝ
;

119657 
	gii
;

119658 
sql™e3
 *
	gdb
;

119659 
	grc
;

119663 
	gdb
 = 
pP¬£
->
db
;

119664 
mem£t
(&
sWLB
, 0, (sWLB));

119667 
‹¡ÿ£
Ð
pOrd”By
 &&…Ord”By->
nEx´
==
BMS
-1 );

119668 ifÐ
	gpOrd”By
 &&…Ord”By->
	gnEx´
>=
BMS
 ) 
pOrd”By
 = 0;

119669 
	gsWLB
.
	gpOrd”By
 = 
pOrd”By
;

119673 ifÐ
O±imiz©iÚDi§bËd
(
db
, 
SQLITE_Di¡šùO±
) ){

119674 
	gwù¾FÏgs
 &ð~
WHERE_WANT_DISTINCT
;

119680 
‹¡ÿ£
Ð
pTabLi¡
->
nSrc
==
BMS
 );

119681 ifÐ
	gpTabLi¡
->
	gnSrc
>
	gBMS
 ){

119682 
sql™e3E¼ÜMsg
(
pP¬£
, "© mo¡ %dabË š‡ još", 
BMS
);

119691 
	gnTabLi¡
 = (
wù¾FÏgs
 & 
WHERE_ONETABLE_ONLY
è? 1 : 
pTabLi¡
->
nSrc
;

119700 
	gnBy‹WInfo
 = 
ROUND8
((
Wh”eInfo
)+(
nTabLi¡
-1)*(
Wh”eLev–
));

119701 
	gpWInfo
 = 
sql™e3DbM®locZ”o
(
db
, 
nBy‹WInfo
 + (
Wh”eLoÝ
));

119702 ifÐ
	gdb
->
	gm®locFažed
 ){

119703 
sql™e3DbF»e
(
db
, 
pWInfo
);

119704 
	gpWInfo
 = 0;

119705 
	gwh”eBegšE¼Ü
;

119707 
	gpWInfo
->
	gaiCurOÃPass
[0] = 
pWInfo
->
aiCurOÃPass
[1] = -1;

119708 
	gpWInfo
->
	gnLev–
 = 
nTabLi¡
;

119709 
	gpWInfo
->
	gpP¬£
 = 
pP¬£
;

119710 
	gpWInfo
->
	gpTabLi¡
 = 
pTabLi¡
;

119711 
	gpWInfo
->
	gpOrd”By
 = 
pOrd”By
;

119712 
	gpWInfo
->
	gpResuÉS‘
 = 
pResuÉS‘
;

119713 
	gpWInfo
->
	giB»ak
 = 
pWInfo
->
iCÚtšue
 = 
sql™e3VdbeMakeLab–
(
v
);

119714 
	gpWInfo
->
	gwù¾FÏgs
 = 
wù¾FÏgs
;

119715 
	gpWInfo
->
	g§vedNQu”yLoÝ
 = 
pP¬£
->
nQu”yLoÝ
;

119716 
	gpMaskS‘
 = &
pWInfo
->
sMaskS‘
;

119717 
	gsWLB
.
	gpWInfo
 = 
pWInfo
;

119718 
	gsWLB
.
	gpWC
 = &
pWInfo
->
sWC
;

119719 
	gsWLB
.
	gpNew
 = (
Wh”eLoÝ
*)(((*)
pWInfo
)+
nBy‹WInfo
);

119720 
as£¹
Ð
EIGHT_BYTE_ALIGNMENT
(
sWLB
.
pNew
) );

119721 
wh”eLoÝIn™
(
sWLB
.
pNew
);

119722 #ifdeà
SQLITE_DEBUG


119723 
	gsWLB
.
	gpNew
->
	gcId
 = '*';

119729 
š™MaskS‘
(
pMaskS‘
);

119730 
wh”eCÏu£In™
(&
pWInfo
->
sWC
,…WInfo);

119731 
wh”eS¶™
(&
pWInfo
->
sWC
, 
pWh”e
, 
TK_AND
);

119736 
	gii
=0; ii<
	gsWLB
.
	gpWC
->
	gnT”m
; ii++){

119737 ifÐ
	gnTabLi¡
==0 || 
sql™e3Ex´IsCÚ¡ªtNÙJoš
(
sWLB
.
pWC
->
a
[
ii
].
pEx´
) ){

119738 
sql™e3Ex´IfF®£
(
pP¬£
, 
sWLB
.
pWC
->
a
[
ii
].
pEx´
, 
pWInfo
->
iB»ak
,

119739 
SQLITE_JUMPIFNULL
);

119740 
	gsWLB
.
	gpWC
->
	ga
[
ii
].
	gwtFÏgs
 |ð
TERM_CODED
;

119746 ifÐ
	gnTabLi¡
==0 ){

119747 ifÐ
pOrd”By
 ) 
pWInfo
->
nOBS©
 =…Ord”By->
nEx´
;

119748 ifÐ
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
 ){

119749 
	gpWInfo
->
	geDi¡šù
 = 
WHERE_DISTINCT_UNIQUE
;

119769 
	gii
=0; ii<
	gpTabLi¡
->
	gnSrc
; ii++){

119770 
ü—‹Mask
(
pMaskS‘
, 
pTabLi¡
->
a
[
ii
].
iCursÜ
);

119772 #iâdeà
NDEBUG


119774 
B™mask
 
	gtoTheLeá
 = 0;

119775 
	gii
=0; ii<
	gpTabLi¡
->
	gnSrc
; ii++){

119776 
B™mask
 
	gm
 = 
g‘Mask
(
pMaskS‘
, 
pTabLi¡
->
a
[
ii
].
iCursÜ
);

119777 
as£¹
Ð(
m
-1)==
toTheLeá
 );

119778 
	gtoTheLeá
 |ð
m
;

119788 
ex´AÇlyzeAÎ
(
pTabLi¡
, &
pWInfo
->
sWC
);

119789 ifÐ
	gdb
->
	gm®locFažed
 ){

119790 
	gwh”eBegšE¼Ü
;

119793 ifÐ
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
 ){

119794 ifÐ
isDi¡šùRedundªt
(
pP¬£
, 
pTabLi¡
, &
pWInfo
->
sWC
, 
pResuÉS‘
) ){

119796 
	gpWInfo
->
	geDi¡šù
 = 
WHERE_DISTINCT_UNIQUE
;

119797 }ifÐ
	gpOrd”By
==0 ){

119799 
pWInfo
->
wù¾FÏgs
 |ð
WHERE_DISTINCTBY
;

119800 
	gpWInfo
->
	gpOrd”By
 = 
pResuÉS‘
;

119805 
WHERETRACE
(0xffff,("*** Optimizer Start ***\n"));

119806 #ià
defšed
(
WHERETRACE_ENABLED
)

119808 ifÐ
	gsql™e3Wh”eT¿û
 & 0x100 ){

119809 
	gi
;

119810 
	gi
=0; i<
	gsWLB
.
	gpWC
->
	gnT”m
; i++){

119811 
wh”eT”mPršt
(&
sWLB
.
pWC
->
a
[
i
], i);

119816 ifÐ
	gnTabLi¡
!=1 || 
wh”eShÜtCut
(&
sWLB
)==0 ){

119817 
rc
 = 
wh”eLoÝAddAÎ
(&
sWLB
);

119818 ifÐ
	grc
 ) 
	gwh”eBegšE¼Ü
;

119821 #ifdeà
WHERETRACE_ENABLED


119822 ifÐ
	gsql™e3Wh”eT¿û
 ){

119823 
Wh”eLoÝ
 *
	gp
;

119824 
	gi
;

119825 
	gzLab–
[] = "0123456789abcdefghijklmnopqrstuvwyxz"

119827 
	gp
=
pWInfo
->
pLoÝs
, 
	gi
=0;…;…=
p
->
pNextLoÝ
, i++){

119828 
	gp
->
	gcId
 = 
zLab–
[
i
%(zLabel)];

119829 
wh”eLoÝPršt
(
p
, 
sWLB
.
pWC
);

119834 
wh”eP©hSÞv”
(
pWInfo
, 0);

119835 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gwh”eBegšE¼Ü
;

119836 ifÐ
	gpWInfo
->
	gpOrd”By
 ){

119837 
wh”eP©hSÞv”
(
pWInfo
,…WInfo->
nRowOut
+1);

119838 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gwh”eBegšE¼Ü
;

119841 ifÐ
	gpWInfo
->
	gpOrd”By
==0 && (
db
->
æags
 & 
SQLITE_Rev”£Ord”
)!=0 ){

119842 
pWInfo
->
»vMask
 = (
B™mask
)(-1);

119844 ifÐ
	gpP¬£
->
	gnE¼
 || 
NEVER
(
db
->
m®locFažed
) ){

119845 
	gwh”eBegšE¼Ü
;

119847 #ifdeà
WHERETRACE_ENABLED


119848 ifÐ
	gsql™e3Wh”eT¿û
 ){

119849 
	gii
;

119850 
sql™e3DebugPrštf
("---- SÞutiÚ‚Row=%d", 
pWInfo
->
nRowOut
);

119851 ifÐ
	gpWInfo
->
	gnOBS©
>0 ){

119852 
sql™e3DebugPrštf
(" ORDERBY=%d,0x%Îx", 
pWInfo
->
nOBS©
,…WInfo->
»vMask
);

119854  
	gpWInfo
->
	geDi¡šù
 ){

119855 
	gWHERE_DISTINCT_UNIQUE
: {

119856 
sql™e3DebugPrštf
(" DISTINCT=unique");

119859 
	gWHERE_DISTINCT_ORDERED
: {

119860 
sql™e3DebugPrštf
(" DISTINCT=ordered");

119863 
	gWHERE_DISTINCT_UNORDERED
: {

119864 
sql™e3DebugPrštf
(" DISTINCT=unordered");

119868 
sql™e3DebugPrštf
("\n");

119869 
	gii
=0; ii<
	gpWInfo
->
	gnLev–
; ii++){

119870 
wh”eLoÝPršt
(
pWInfo
->
a
[
ii
].
pWLoÝ
, 
sWLB
.
pWC
);

119875 ifÐ
	gpWInfo
->
	gnLev–
>=2

119876 && 
pResuÉS‘
!=0

119877 && 
O±imiz©iÚEÇbËd
(
db
, 
SQLITE_Om™NoÝJoš
)

119879 
B™mask
 
	gbU£d
 = 
ex´Li¡TabËU§ge
(
pMaskS‘
, 
pResuÉS‘
);

119880 ifÐ
	gsWLB
.
	gpOrd”By
 ) 
	gbU£d
 |ð
ex´Li¡TabËU§ge
(
pMaskS‘
, 
sWLB
.
pOrd”By
);

119881  
	gpWInfo
->
	gnLev–
>=2 ){

119882 
Wh”eT”m
 *
pT”m
, *
pEnd
;

119883 
	gpLoÝ
 = 
pWInfo
->
a
[pWInfo->
nLev–
-1].
pWLoÝ
;

119884 ifÐ(
	gpWInfo
->
	gpTabLi¡
->
	ga
[
pLoÝ
->
iTab
].
	gjošty³
 & 
	gJT_LEFT
)==0 ) ;

119885 ifÐ(
	gwù¾FÏgs
 & 
	gWHERE_WANT_DISTINCT
)==0

119886 && (
pLoÝ
->
wsFÏgs
 & 
WHERE_ONEROW
)==0

119890 ifÐ(
	gbU£d
 & 
	gpLoÝ
->
	gmaskS–f
)!=0 ) ;

119891 
	gpEnd
 = 
sWLB
.
pWC
->
a
 + sWLB.pWC->
nT”m
;

119892 
	gpT”m
=
sWLB
.
pWC
->
a
;…T”m<
	gpEnd
;…Term++){

119893 ifÐ(
	gpT”m
->
	g´”eqAÎ
 & 
	gpLoÝ
->
	gmaskS–f
)!=0

119894 && !
Ex´HasPrÝ”ty
(
pT”m
->
pEx´
, 
EP_FromJoš
)

119899 ifÐ
	gpT”m
<
	gpEnd
 ) ;

119900 
WHERETRACE
(0xffff, ("-> drÝ†oÝ %ønÙ u£d\n", 
pLoÝ
->
cId
));

119901 
	gpWInfo
->
	gnLev–
--;

119902 
	gnTabLi¡
--;

119905 
WHERETRACE
(0xffff,("*** Optimizer Finished ***\n"));

119906 
	gpWInfo
->
	gpP¬£
->
	gnQu”yLoÝ
 +ð
pWInfo
->
nRowOut
;

119913 
as£¹
Ð(
wù¾FÏgs
 & 
WHERE_ONEPASS_DESIRED
)==0 || 
pWInfo
->
nLev–
==1 );

119914 ifÐ(
	gwù¾FÏgs
 & 
	gWHERE_ONEPASS_DESIRED
)!=0

119915 && (
pWInfo
->
a
[0].
pWLoÝ
->
wsFÏgs
 & 
WHERE_ONEROW
)!=0 ){

119916 
pWInfo
->
okOÃPass
 = 1;

119917 ifÐ
HasRowid
(
pTabLi¡
->
a
[0].
pTab
) ){

119918 
	gpWInfo
->
	ga
[0].
	gpWLoÝ
->
	gwsFÏgs
 &ð~
WHERE_IDX_ONLY
;

119925 
	gnÙR—dy
 = ~(
B™mask
)0;

119926 
	gii
=0, 
	gpLev–
=
pWInfo
->
a
; ii<
	gnTabLi¡
; ii++,…Level++){

119927 
TabË
 *
	gpTab
;

119928 
	giDb
;

119929 
SrcLi¡_™em
 *
	gpTabI‹m
;

119931 
	gpTabI‹m
 = &
pTabLi¡
->
a
[
pLev–
->
iFrom
];

119932 
	gpTab
 = 
pTabI‹m
->
pTab
;

119933 
	giDb
 = 
sql™e3SchemaToIndex
(
db
, 
pTab
->
pSchema
);

119934 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

119935 ifÐ(
	gpTab
->
	gbFÏgs
 & 
	gTF_Ephem”®
)!=0 || 
pTab
->
pS–eù
 ){

119938 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


119939 ifÐ(
pLoÝ
->
wsFÏgs
 & 
WHERE_VIRTUALTABLE
)!=0 ){

119940 cÚ¡ *
pVTab
 = (cÚ¡ *)
sql™e3G‘VTabË
(
db
, 
pTab
);

119941 
	giCur
 = 
pTabI‹m
->
iCursÜ
;

119942 
sql™e3VdbeAddOp4
(
v
, 
OP_VO³n
, 
iCur
, 0, 0, 
pVTab
, 
P4_VTAB
);

119943 }ifÐ
IsVœtu®
(
pTab
) ){

119947 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_IDX_ONLY
)==0

119948 && (
wù¾FÏgs
 & 
WHERE_OMIT_OPEN_CLOSE
)==0 ){

119949 
Ý
 = 
OP_O³nR—d
;

119950 ifÐ
	gpWInfo
->
	gokOÃPass
 ){

119951 
	gÝ
 = 
OP_O³nWr™e
;

119952 
	gpWInfo
->
	gaiCurOÃPass
[0] = 
pTabI‹m
->
iCursÜ
;

119954 
sql™e3O³nTabË
(
pP¬£
, 
pTabI‹m
->
iCursÜ
, 
iDb
, 
pTab
, 
Ý
);

119955 
as£¹
Ð
pTabI‹m
->
iCursÜ
==
pLev–
->
iTabCur
 );

119956 
‹¡ÿ£
Ð!
pWInfo
->
okOÃPass
 && 
pTab
->
nCÞ
==
BMS
-1 );

119957 
‹¡ÿ£
Ð!
pWInfo
->
okOÃPass
 && 
pTab
->
nCÞ
==
BMS
 );

119958 ifÐ!
	gpWInfo
->
	gokOÃPass
 && 
	gpTab
->
	gnCÞ
<
	gBMS
 && 
HasRowid
(
pTab
) ){

119959 
B™mask
 
	gb
 = 
pTabI‹m
->
cÞU£d
;

119960 
	gn
 = 0;

119961 ; 
	gb
; b=
b
>>1, 
	gn
++){}

119962 
sql™e3VdbeChªgeP4
(
v
, 
sql™e3VdbeCu¼’tAddr
(v)-1,

119963 
SQLITE_INT_TO_PTR
(
n
), 
P4_INT32
);

119964 
as£¹
Ð
n
<=
pTab
->
nCÞ
 );

119967 
sql™e3TabËLock
(
pP¬£
, 
iDb
, 
pTab
->
Šum
, 0,…Tab->
zName
);

119969 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
 ){

119970 
Index
 *
	gpIx
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

119971 
	giIndexCur
;

119972 
	gÝ
 = 
OP_O³nR—d
;

119974 
as£¹
Ð
iIdxCur
!=0 || (
pWInfo
->
wù¾FÏgs
 & 
WHERE_ONEPASS_DESIRED
)==0 );

119975 ifÐ!
HasRowid
(
pTab
è&& 
IsPrim¬yKeyIndex
(
pIx
)

119976 && (
	gwù¾FÏgs
 & 
	gWHERE_ONETABLE_ONLY
)!=0

119980 
iIndexCur
 = 
pLev–
->
iTabCur
;

119981 
	gÝ
 = 0;

119982 }ifÐ
	gpWInfo
->
	gokOÃPass
 ){

119983 
Index
 *
	gpJ
 = 
pTabI‹m
->
pTab
->
pIndex
;

119984 
	giIndexCur
 = 
iIdxCur
;

119985 
as£¹
Ð
wù¾FÏgs
 & 
WHERE_ONEPASS_DESIRED
 );

119986  
ALWAYS
(
pJ
è&& 
	gpJ
!=
pIx
 ){

119987 
iIndexCur
++;

119988 
	gpJ
 = 
pJ
->
pNext
;

119990 
	gÝ
 = 
OP_O³nWr™e
;

119991 
	gpWInfo
->
	gaiCurOÃPass
[1] = 
iIndexCur
;

119992 }ifÐ
	giIdxCur
 && (
	gwù¾FÏgs
 & 
	gWHERE_ONETABLE_ONLY
)!=0 ){

119993 
iIndexCur
 = 
iIdxCur
;

119994 ifÐ
	gwù¾FÏgs
 & 
	gWHERE_REOPEN_IDX
 ) 
	gÝ
 = 
OP_ReÝ’Idx
;

119996 
	giIndexCur
 = 
pP¬£
->
nTab
++;

119998 
	gpLev–
->
	giIdxCur
 = 
iIndexCur
;

119999 
as£¹
Ð
pIx
->
pSchema
==
pTab
->pSchema );

120000 
as£¹
Ð
iIndexCur
>=0 );

120001 ifÐ
	gÝ
 ){

120002 
sql™e3VdbeAddOp3
(
v
, 
Ý
, 
iIndexCur
, 
pIx
->
Šum
, 
iDb
);

120003 
sql™e3VdbeS‘P4KeyInfo
(
pP¬£
, 
pIx
);

120004 
VdbeComm’t
((
v
, "%s", 
pIx
->
zName
));

120007 ifÐ
	giDb
>=0 ) 
sql™e3CodeV”ifySchema
(
pP¬£
, 
iDb
);

120008 
	gnÙR—dy
 &ð~
g‘Mask
(&
pWInfo
->
sMaskS‘
, 
pTabI‹m
->
iCursÜ
);

120010 
	gpWInfo
->
	giTÝ
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

120011 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gwh”eBegšE¼Ü
;

120017 
	gnÙR—dy
 = ~(
B™mask
)0;

120018 
	gii
=0; ii<
	gnTabLi¡
; ii++){

120019 
	gpLev–
 = &
pWInfo
->
a
[
ii
];

120020 #iâdeà
SQLITE_OMIT_AUTOMATIC_INDEX


120021 ifÐ(
	gpLev–
->
	gpWLoÝ
->
	gwsFÏgs
 & 
	gWHERE_AUTO_INDEX
)!=0 ){

120022 
cÚ¡ruùAutom©icIndex
(
pP¬£
, &
pWInfo
->
sWC
,

120023 &
pTabLi¡
->
a
[
pLev–
->
iFrom
], 
nÙR—dy
,…Level);

120024 ifÐ
	gdb
->
	gm®locFažed
 ) 
	gwh”eBegšE¼Ü
;

120027 
ex¶ašOÃSÿn
(
pP¬£
, 
pTabLi¡
, 
pLev–
, 
ii
,…Lev–->
iFrom
, 
wù¾FÏgs
);

120028 
	gpLev–
->
	gaddrBody
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

120029 
	gnÙR—dy
 = 
codeOÃLoÝS¹
(
pWInfo
, 
ii
, 
nÙR—dy
);

120030 
	gpWInfo
->
	giCÚtšue
 = 
pLev–
->
addrCÚt
;

120034 
VdbeModuËComm’t
((
v
, "Begin WHERE-core"));

120035  
	gpWInfo
;

120038 
	gwh”eBegšE¼Ü
:

120039 ifÐ
pWInfo
 ){

120040 
pP¬£
->
nQu”yLoÝ
 = 
pWInfo
->
§vedNQu”yLoÝ
;

120041 
wh”eInfoF»e
(
db
, 
pWInfo
);

120050 
SQLITE_PRIVATE
 
sql™e3Wh”eEnd
(
Wh”eInfo
 *
pWInfo
){

120051 
P¬£
 *
	gpP¬£
 = 
pWInfo
->
pP¬£
;

120052 
Vdbe
 *
	gv
 = 
pP¬£
->
pVdbe
;

120053 
	gi
;

120054 
Wh”eLev–
 *
	gpLev–
;

120055 
Wh”eLoÝ
 *
	gpLoÝ
;

120056 
SrcLi¡
 *
	gpTabLi¡
 = 
pWInfo
->
pTabLi¡
;

120057 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

120061 
VdbeModuËComm’t
((
v
, "End WHERE-core"));

120062 
sql™e3Ex´CacheCË¬
(
pP¬£
);

120063 
	gi
=
pWInfo
->
nLev–
-1; i>=0; i--){

120064 
	gaddr
;

120065 
	gpLev–
 = &
pWInfo
->
a
[
i
];

120066 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

120067 
sql™e3VdbeResÞveLab–
(
v
, 
pLev–
->
addrCÚt
);

120068 ifÐ
	gpLev–
->
	gÝ
!=
OP_NoÝ
 ){

120069 
sql™e3VdbeAddOp3
(
v
, 
pLev–
->
Ý
,…Lev–->
p1
,…Lev–->
p2
,…Lev–->
p3
);

120070 
sql™e3VdbeChªgeP5
(
v
, 
pLev–
->
p5
);

120071 
VdbeCov”age
(
v
);

120072 
VdbeCov”ageIf
(
v
, 
pLev–
->
Ý
==
OP_Next
);

120073 
VdbeCov”ageIf
(
v
, 
pLev–
->
Ý
==
OP_P»v
);

120074 
VdbeCov”ageIf
(
v
, 
pLev–
->
Ý
==
OP_VNext
);

120076 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_IN_ABLE
 && 
	gpLev–
->
	gu
.
	gš
.
	gnIn
>0 ){

120077 
InLoÝ
 *
	gpIn
;

120078 
	gj
;

120079 
sql™e3VdbeResÞveLab–
(
v
, 
pLev–
->
addrNxt
);

120080 
	gj
=
pLev–
->
u
.
š
.
nIn
, 
	gpIn
=&pLev–->u.š.
aInLoÝ
[
j
-1]; j>0; j--,…In--){

120081 
sql™e3VdbeJumpH”e
(
v
, 
pIn
->
addrInTÝ
+1);

120082 
sql™e3VdbeAddOp2
(
v
, 
pIn
->
eEndLoÝOp
,…In->
iCur
,…In->
addrInTÝ
);

120083 
VdbeCov”age
(
v
);

120084 
VdbeCov”ageIf
(
v
, 
pIn
->
eEndLoÝOp
==
OP_P»vIfO³n
);

120085 
VdbeCov”ageIf
(
v
, 
pIn
->
eEndLoÝOp
==
OP_NextIfO³n
);

120086 
sql™e3VdbeJumpH”e
(
v
, 
pIn
->
addrInTÝ
-1);

120088 
sql™e3DbF»e
(
db
, 
pLev–
->
u
.
š
.
aInLoÝ
);

120090 
sql™e3VdbeResÞveLab–
(
v
, 
pLev–
->
addrBrk
);

120091 ifÐ
	gpLev–
->
	gaddrSk
 ){

120092 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
pLev–
->
addrSk
);

120093 
VdbeComm’t
((
v
, "Ãxˆsk-sÿÀÚ %s", 
pLoÝ
->
u
.
bŒ“
.
pIndex
->
zName
));

120094 
sql™e3VdbeJumpH”e
(
v
, 
pLev–
->
addrSk
);

120095 
sql™e3VdbeJumpH”e
(
v
, 
pLev–
->
addrSk
-2);

120097 ifÐ
	gpLev–
->
	giLeáJoš
 ){

120098 
	gaddr
 = 
sql™e3VdbeAddOp1
(
v
, 
OP_IfPos
, 
pLev–
->
iLeáJoš
); 
VdbeCov”age
(v);

120099 
as£¹
Ð(
pLoÝ
->
wsFÏgs
 & 
WHERE_IDX_ONLY
)==0

120100 || (
pLoÝ
->
wsFÏgs
 & 
WHERE_INDEXED
)!=0 );

120101 ifÐ(
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_IDX_ONLY
)==0 ){

120102 
sql™e3VdbeAddOp1
(
v
, 
OP_NuÎRow
, 
pTabLi¡
->
a
[
i
].
iCursÜ
);

120104 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_INDEXED
 ){

120105 
sql™e3VdbeAddOp1
(
v
, 
OP_NuÎRow
, 
pLev–
->
iIdxCur
);

120107 ifÐ
	gpLev–
->
	gÝ
==
OP_R‘uº
 ){

120108 
sql™e3VdbeAddOp2
(
v
, 
OP_Gosub
, 
pLev–
->
p1
,…Lev–->
addrFœ¡
);

120110 
sql™e3VdbeAddOp2
(
v
, 
OP_GÙo
, 0, 
pLev–
->
addrFœ¡
);

120112 
sql™e3VdbeJumpH”e
(
v
, 
addr
);

120114 
VdbeModuËComm’t
((
v
, "End WHERE-loÝ%d: %s", 
i
,

120115 
pWInfo
->
pTabLi¡
->
a
[
pLev–
->
iFrom
].
pTab
->
zName
));

120121 
sql™e3VdbeResÞveLab–
(
v
, 
pWInfo
->
iB»ak
);

120123 
as£¹
Ð
pWInfo
->
nLev–
<=
pTabLi¡
->
nSrc
 );

120124 
	gi
=0, 
	gpLev–
=
pWInfo
->
a
; i<
	gpWInfo
->
	gnLev–
; i++,…Level++){

120125 
	gk
, 
	gÏ¡
;

120126 
VdbeOp
 *
	gpOp
;

120127 
Index
 *
	gpIdx
 = 0;

120128 
SrcLi¡_™em
 *
	gpTabI‹m
 = &
pTabLi¡
->
a
[
pLev–
->
iFrom
];

120129 
TabË
 *
	gpTab
 = 
pTabI‹m
->
pTab
;

120130 
as£¹
Ð
pTab
!=0 );

120131 
	gpLoÝ
 = 
pLev–
->
pWLoÝ
;

120137 ifÐ
	gpTabI‹m
->
	gvŸCÜoutše
 && !
	gdb
->
	gm®locFažed
 ){

120138 
	gÏ¡
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

120139 
	gk
 = 
pLev–
->
addrBody
;

120140 
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, 
k
);

120141 ; 
	gk
<
	gÏ¡
; k++, 
	gpOp
++){

120142 ifÐ
	gpOp
->
	gp1
!=
pLev–
->
iTabCur
 ) ;

120143 ifÐ
	gpOp
->
	gÝcode
==
OP_CÞumn
 ){

120144 
pOp
->
Ýcode
 = 
OP_CÝy
;

120145 
	gpOp
->
	gp1
 = 
pOp
->
p2
 + 
pTabI‹m
->
»gResuÉ
;

120146 
	gpOp
->
	gp2
 = 
pOp
->
p3
;

120147 
	gpOp
->
	gp3
 = 0;

120148 }ifÐ
	gpOp
->
	gÝcode
==
OP_Rowid
 ){

120149 
pOp
->
Ýcode
 = 
OP_NuÎ
;

120150 
	gpOp
->
	gp1
 = 0;

120151 
	gpOp
->
	gp3
 = 0;

120162 ifÐ(
	gpTab
->
	gbFÏgs
 & 
	gTF_Ephem”®
)==0

120163 && 
pTab
->
pS–eù
==0

120164 && (
pWInfo
->
wù¾FÏgs
 & 
WHERE_OMIT_OPEN_CLOSE
)==0

120166 
ws
 = 
pLoÝ
->
wsFÏgs
;

120167 ifÐ!
	gpWInfo
->
	gokOÃPass
 && (
	gws
 & 
	gWHERE_IDX_ONLY
)==0 ){

120168 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
pTabI‹m
->
iCursÜ
);

120170 ifÐ(
	gws
 & 
	gWHERE_INDEXED
)!=0

120171 && (
ws
 & (
WHERE_IPK
|
WHERE_AUTO_INDEX
))==0

120172 && 
pLev–
->
iIdxCur
!=
pWInfo
->
aiCurOÃPass
[1]

120174 
sql™e3VdbeAddOp1
(
v
, 
OP_Clo£
, 
pLev–
->
iIdxCur
);

120189 ifÐ
	gpLoÝ
->
	gwsFÏgs
 & (
	gWHERE_INDEXED
|
	gWHERE_IDX_ONLY
) ){

120190 
	gpIdx
 = 
pLoÝ
->
u
.
bŒ“
.
pIndex
;

120191 }ifÐ
	gpLoÝ
->
	gwsFÏgs
 & 
	gWHERE_MULTI_OR
 ){

120192 
	gpIdx
 = 
pLev–
->
u
.
pCovidx
;

120194 ifÐ
	gpIdx
 && !
	gdb
->
	gm®locFažed
 ){

120195 
	gÏ¡
 = 
sql™e3VdbeCu¼’tAddr
(
v
);

120196 
	gk
 = 
pLev–
->
addrBody
;

120197 
	gpOp
 = 
sql™e3VdbeG‘Op
(
v
, 
k
);

120198 ; 
	gk
<
	gÏ¡
; k++, 
	gpOp
++){

120199 ifÐ
	gpOp
->
	gp1
!=
pLev–
->
iTabCur
 ) ;

120200 ifÐ
	gpOp
->
	gÝcode
==
OP_CÞumn
 ){

120201 
x
 = 
pOp
->
p2
;

120202 
as£¹
Ð
pIdx
->
pTabË
==
pTab
 );

120203 ifÐ!
HasRowid
(
pTab
) ){

120204 
Index
 *
	gpPk
 = 
sql™e3Prim¬yKeyIndex
(
pTab
);

120205 
	gx
 = 
pPk
->
aiCÞumn
[
x
];

120207 
	gx
 = 
sql™e3CÞumnOfIndex
(
pIdx
, 
x
);

120208 ifÐ
	gx
>=0 ){

120209 
pOp
->
p2
 = 
x
;

120210 
	gpOp
->
	gp1
 = 
pLev–
->
iIdxCur
;

120212 
as£¹
Ð(
pLoÝ
->
wsFÏgs
 & 
WHERE_IDX_ONLY
)==0 || 
x
>=0 );

120213 }ifÐ
	gpOp
->
	gÝcode
==
OP_Rowid
 ){

120214 
pOp
->
p1
 = 
pLev–
->
iIdxCur
;

120215 
	gpOp
->
	gÝcode
 = 
OP_IdxRowid
;

120223 
	gpP¬£
->
	gnQu”yLoÝ
 = 
pWInfo
->
§vedNQu”yLoÝ
;

120224 
wh”eInfoF»e
(
db
, 
pWInfo
);

120248 
	#YYNOERRORRECOVERY
 1

	)

120253 
	#yy‹¡ÿ£
(
X
è
	`‹¡ÿ£
(X)

	)

120259 
	sLim™V®
 {

120260 
Ex´
 *
	gpLim™
;

120261 
Ex´
 *
	gpOff£t
;

120268 
	sLikeOp
 {

120269 
Tok’
 
	geO³¿tÜ
;

120270 
	gbNÙ
;

120282 
	sTrigEv’t
 { 
	ga
; 
IdLi¡
 * 
	gb
; };

120287 
	sA‰achKey
 { 
	gty³
; 
Tok’
 
	gkey
; };

120294 
¥ªS‘
(
Ex´S·n
 *
pOut
, 
Tok’
 *
pS¹
, Tok’ *
pEnd
){

120295 
	gpOut
->
	gzS¹
 = 
pS¹
->
z
;

120296 
	gpOut
->
	gzEnd
 = &
pEnd
->
z
[pEnd->
n
];

120303 
¥ªEx´
(
Ex´S·n
 *
pOut
, 
P¬£
 *
pP¬£
, 
Ý
, 
Tok’
 *
pV®ue
){

120304 
	gpOut
->
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
Ý
, 0, 0, 
pV®ue
);

120305 
	gpOut
->
	gzS¹
 = 
pV®ue
->
z
;

120306 
	gpOut
->
	gzEnd
 = &
pV®ue
->
z
[pV®ue->
n
];

120312 
¥ªBš¬yEx´
(

120313 
Ex´S·n
 *
pOut
,

120314 
P¬£
 *
pP¬£
,

120315 
Ý
,

120316 
Ex´S·n
 *
pLeá
,

120317 
Ex´S·n
 *
pRight


120319 
	gpOut
->
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
Ý
, 
pLeá
->
pEx´
, 
pRight
->pExpr, 0);

120320 
	gpOut
->
	gzS¹
 = 
pLeá
->
zS¹
;

120321 
	gpOut
->
	gzEnd
 = 
pRight
->
zEnd
;

120326 
¥ªUÇryPo¡fix
(

120327 
Ex´S·n
 *
pOut
,

120328 
P¬£
 *
pP¬£
,

120329 
Ý
,

120330 
Ex´S·n
 *
pO³¿nd
,

120331 
Tok’
 *
pPo¡Op


120333 
	gpOut
->
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
Ý
, 
pO³¿nd
->
pEx´
, 0, 0);

120334 
	gpOut
->
	gzS¹
 = 
pO³¿nd
->
zS¹
;

120335 
	gpOut
->
	gzEnd
 = &
pPo¡Op
->
z
[pPo¡Op->
n
];

120340 
bš¬yToUÇryIfNuÎ
(
P¬£
 *
pP¬£
, 
Ex´
 *
pY
, Ex´ *
pA
, 
Ý
){

120341 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

120342 ifÐ
	gpY
 && 
	gpA
 &&…Y->
	gÝ
==
TK_NULL
 ){

120343 
pA
->
Ý
 = (
u8
)op;

120344 
sql™e3Ex´D–‘e
(
db
, 
pA
->
pRight
);

120345 
	gpA
->
	gpRight
 = 0;

120351 
¥ªUÇryP»fix
(

120352 
Ex´S·n
 *
pOut
,

120353 
P¬£
 *
pP¬£
,

120354 
Ý
,

120355 
Ex´S·n
 *
pO³¿nd
,

120356 
Tok’
 *
pP»Op


120358 
	gpOut
->
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
Ý
, 
pO³¿nd
->
pEx´
, 0, 0);

120359 
	gpOut
->
	gzS¹
 = 
pP»Op
->
z
;

120360 
	gpOut
->
	gzEnd
 = 
pO³¿nd
->
zEnd
;

120374 #iâdeà
INTERFACE


120375 
	#INTERFACE
 1

	)

120411 
	#YYCODETYPE
 

	)

120412 
	#YYNOCODE
 254

	)

120413 
	#YYACTIONTYPE
 

	)

120414 
	#YYWILDCARD
 70

	)

120415 
	#sql™e3P¬£rTOKENTYPE
 
Tok’


	)

120417 
	gyyš™
;

120418 
sql™e3P¬£rTOKENTYPE
 
	gyy0
;

120419 
S–eù
* 
	gyy3
;

120420 
Ex´Li¡
* 
	gyy14
;

120421 
W™h
* 
	gyy59
;

120422 
SrcLi¡
* 
	gyy65
;

120423 
LikeOp
 
	gyy96
;

120424 
Ex´
* 
	gyy132
;

120425 
u8
 
	gyy186
;

120426 
	gyy328
;

120427 
Ex´S·n
 
	gyy346
;

120428 
TrigEv’t
 
	gyy378
;

120429 
u16
 
	gyy381
;

120430 
IdLi¡
* 
	gyy408
;

120431 ¡ruù {
	gv®ue
; 
	gmask
;} 
	gyy429
;

120432 
Trigg”S‹p
* 
	gyy473
;

120433 
Lim™V®
 
	gyy476
;

120434 } 
	tYYMINORTYPE
;

120435 #iâdeà
YYSTACKDEPTH


120436 
	#YYSTACKDEPTH
 100

	)

120438 
	#sql™e3P¬£rARG_SDECL
 
P¬£
 *
pP¬£
;

	)

120439 
	#sql™e3P¬£rARG_PDECL
 ,
P¬£
 *
pP¬£


	)

120440 
	#sql™e3P¬£rARG_FETCH
 
P¬£
 *
pP¬£
 = 
yypP¬£r
->
	)
pParse

120441 
	#sql™e3P¬£rARG_STORE
 
yypP¬£r
->
pP¬£
 = 
	)
pParse

120442 
	#YYNSTATE
 642

	)

120443 
	#YYNRULE
 327

	)

120444 
	#YYFALLBACK
 1

	)

120445 
	#YY_NO_ACTION
 (
YYNSTATE
+
YYNRULE
+2)

	)

120446 
	#YY_ACCEPT_ACTION
 (
YYNSTATE
+
YYNRULE
+1)

	)

120447 
	#YY_ERROR_ACTION
 (
YYNSTATE
+
YYNRULE
)

	)

120451 cÚ¡ 
YYMINORTYPE
 
	gyyz”omšÜ
 = { 0 };

120461 #iâdeà
yy‹¡ÿ£


120462 
	#yy‹¡ÿ£
(
X
)

	)

120513 
	#YY_ACTTAB_COUNT
 (1497)

	)

120514 cÚ¡ 
YYACTIONTYPE
 
	gyy_aùiÚ
[] = {

120666 cÚ¡ 
YYCODETYPE
 
	gyy_lookah—d
[] = {

120818 
	#YY_SHIFT_USE_DFLT
 (-86)

	)

120819 
	#YY_SHIFT_COUNT
 (429)

	)

120820 
	#YY_SHIFT_MIN
 (-85)

	)

120821 
	#YY_SHIFT_MAX
 (1383)

	)

120822 cÚ¡ 
	gyy_shiá_of¡
[] = {

120867 
	#YY_REDUCE_USE_DFLT
 (-110)

	)

120868 
	#YY_REDUCE_COUNT
 (305)

	)

120869 
	#YY_REDUCE_MIN
 (-109)

	)

120870 
	#YY_REDUCE_MAX
 (1323)

	)

120871 cÚ¡ 
	gyy_»duû_of¡
[] = {

120904 cÚ¡ 
YYACTIONTYPE
 
	gyy_deçuÉ
[] = {

120982 #ifdeà
YYFALLBACK


120983 cÚ¡ 
YYCODETYPE
 
	gyyF®lback
[] = {

121069 
	syySckEÁry
 {

121070 
YYACTIONTYPE
 
	g¡©’o
;

121071 
YYCODETYPE
 
	gmajÜ
;

121073 
YYMINORTYPE
 
	gmšÜ
;

121076 
yySckEÁry
 
	tyySckEÁry
;

121080 
	syyP¬£r
 {

121081 
	gyyidx
;

121082 #ifdeà
YYTRACKMAXSTACKDEPTH


121083 
	gyyidxMax
;

121085 
	gyy”rút
;

121086 
	gsql™e3P¬£rARG_SDECL


121087 #ià
YYSTACKDEPTH
<=0

121088 
	gyy¡ksz
;

121089 
yySckEÁry
 *
	gyy¡ack
;

121091 
yySckEÁry
 
	gyy¡ack
[
YYSTACKDEPTH
];

121094 
yyP¬£r
 
	tyyP¬£r
;

121096 #iâdeà
NDEBUG


121098 
FILE
 *
	gyyT¿ûFILE
 = 0;

121099 *
	gyyT¿ûProm±
 = 0;

121102 #iâdeà
NDEBUG


121120 
SQLITE_PRIVATE
 
sql™e3P¬£rT¿û
(
FILE
 *
T¿ûFILE
, *
zT¿ûProm±
){

121121 
	gyyT¿ûFILE
 = 
T¿ûFILE
;

121122 
	gyyT¿ûProm±
 = 
zT¿ûProm±
;

121123 ifÐ
	gyyT¿ûFILE
==0 ) 
yyT¿ûProm±
 = 0;

121124 ifÐ
	gyyT¿ûProm±
==0 ) 
yyT¿ûFILE
 = 0;

121128 #iâdeà
NDEBUG


121131 cÚ¡ *cÚ¡ 
	gyyTok’Name
[] = {

121199 #iâdeà
NDEBUG


121202 cÚ¡ *cÚ¡ 
	gyyRuËName
[] = {

121534 #ià
YYSTACKDEPTH
<=0

121538 
yyGrowSck
(
yyP¬£r
 *
p
){

121539 
	gÃwSize
;

121540 
yySckEÁry
 *
	gpNew
;

121542 
	gÃwSize
 = 
p
->
yy¡ksz
*2 + 100;

121543 
	gpNew
 = 
»®loc
(
p
->
yy¡ack
, 
ÃwSize
*(
pNew
[0]));

121544 ifÐ
	gpNew
 ){

121545 
	gp
->
	gyy¡ack
 = 
pNew
;

121546 
	gp
->
	gyy¡ksz
 = 
ÃwSize
;

121547 #iâdeà
NDEBUG


121548 ifÐ
	gyyT¿ûFILE
 ){

121549 
årštf
(
yyT¿ûFILE
,"%sStack growso %dƒntries!\n",

121550 
yyT¿ûProm±
, 
p
->
yy¡ksz
);

121569 
SQLITE_PRIVATE
 *
sql™e3P¬£rAÎoc
(*(*
m®locProc
)(
u64
)){

121570 
yyP¬£r
 *
	gpP¬£r
;

121571 
	gpP¬£r
 = (
yyP¬£r
*)(*
m®locProc
)Ð(
u64
)(yyParser) );

121572 ifÐ
	gpP¬£r
 ){

121573 
	gpP¬£r
->
	gyyidx
 = -1;

121574 #ifdeà
YYTRACKMAXSTACKDEPTH


121575 
	gpP¬£r
->
	gyyidxMax
 = 0;

121577 #ià
YYSTACKDEPTH
<=0

121578 
	gpP¬£r
->
	gyy¡ack
 = 
NULL
;

121579 
	gpP¬£r
->
	gyy¡ksz
 = 0;

121580 
yyGrowSck
(
pP¬£r
);

121583  
	gpP¬£r
;

121591 
yy_de¡ruùÜ
(

121592 
yyP¬£r
 *
yypP¬£r
,

121593 
YYCODETYPE
 
yymajÜ
,

121594 
YYMINORTYPE
 *
yypmšÜ


121596 
	gsql™e3P¬£rARG_FETCH
;

121597  
	gyymajÜ
 ){

121613 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy3
));

121619 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy346
).
pEx´
);

121634 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy14
));

121642 
sql™e3SrcLi¡D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy65
));

121648 
sql™e3W™hD–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy59
));

121659 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy132
));

121666 
sql™e3IdLi¡D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy408
));

121672 
sql™e3D–‘eTrigg”S‹p
(
pP¬£
->
db
, (
yypmšÜ
->
yy473
));

121677 
sql™e3IdLi¡D–‘e
(
pP¬£
->
db
, (
yypmšÜ
->
yy378
).
b
);

121692 
yy_pÝ_·r£r_¡ack
(
yyP¬£r
 *
pP¬£r
){

121693 
YYCODETYPE
 
	gyymajÜ
;

121694 
yySckEÁry
 *
	gyytos
 = &
pP¬£r
->
yy¡ack
[pP¬£r->
yyidx
];

121698 ifÐ
NEVER
(
pP¬£r
->
yyidx
<0) )  0;

121699 #iâdeà
NDEBUG


121700 ifÐ
	gyyT¿ûFILE
 && 
	gpP¬£r
->
	gyyidx
>=0 ){

121701 
årštf
(
yyT¿ûFILE
,"%sPopping %s\n",

121702 
yyT¿ûProm±
,

121703 
yyTok’Name
[
yytos
->
majÜ
]);

121706 
	gyymajÜ
 = 
yytos
->
majÜ
;

121707 
yy_de¡ruùÜ
(
pP¬£r
, 
yymajÜ
, &
yytos
->
mšÜ
);

121708 
	gpP¬£r
->
	gyyidx
--;

121709  
	gyymajÜ
;

121724 
SQLITE_PRIVATE
 
sql™e3P¬£rF»e
(

121725 *
p
,

121726 (*
ä“Proc
)(*)

121728 
yyP¬£r
 *
	gpP¬£r
 = (yyP¬£r*)
p
;

121731 ifÐ
NEVER
(
pP¬£r
==0) ) ;

121732  
	gpP¬£r
->
	gyyidx
>=0 ) 
yy_pÝ_·r£r_¡ack
(
pP¬£r
);

121733 #ià
YYSTACKDEPTH
<=0

121734 
ä“
(
pP¬£r
->
yy¡ack
);

121736 (*
	gä“Proc
)((*)
	gpP¬£r
);

121742 #ifdeà
YYTRACKMAXSTACKDEPTH


121743 
SQLITE_PRIVATE
 
sql™e3P¬£rSckP—k
(*
p
){

121744 
yyP¬£r
 *
	gpP¬£r
 = (yyP¬£r*)
p
;

121745  
	gpP¬£r
->
	gyyidxMax
;

121757 
yy_fšd_shiá_aùiÚ
(

121758 
yyP¬£r
 *
pP¬£r
,

121759 
YYCODETYPE
 
iLookAh—d


121761 
	gi
;

121762 
	g¡©’o
 = 
pP¬£r
->
yy¡ack
[pP¬£r->
yyidx
].
¡©’o
;

121764 ifÐ
	g¡©’o
>
	gYY_SHIFT_COUNT


121765 || (
	gi
 = 
yy_shiá_of¡
[
¡©’o
])==
YY_SHIFT_USE_DFLT
 ){

121766  
yy_deçuÉ
[
¡©’o
];

121768 
as£¹
Ð
iLookAh—d
!=
YYNOCODE
 );

121769 
	gi
 +ð
iLookAh—d
;

121770 ifÐ
	gi
<0 || i>=
YY_ACTTAB_COUNT
 || 
yy_lookah—d
[
i
]!=
iLookAh—d
 ){

121771 ifÐ
iLookAh—d
>0 ){

121772 #ifdeà
YYFALLBACK


121773 
YYCODETYPE
 
iF®lback
;

121774 ifÐ
	giLookAh—d
<(
	gyyF®lback
)/(yyFallback[0])

121775 && (
	giF®lback
 = 
yyF®lback
[
iLookAh—d
])!=0 ){

121776 #iâdeà
NDEBUG


121777 ifÐ
yyT¿ûFILE
 ){

121778 
årštf
(
yyT¿ûFILE
, "%sFALLBACK %s => %s\n",

121779 
yyT¿ûProm±
, 
yyTok’Name
[
iLookAh—d
], yyTok’Name[
iF®lback
]);

121782  
yy_fšd_shiá_aùiÚ
(
pP¬£r
, 
iF®lback
);

121785 #ifdeà
YYWILDCARD


121787 
	gj
 = 
i
 - 
iLookAh—d
 + 
YYWILDCARD
;

121789 #ià
YY_SHIFT_MIN
+
YYWILDCARD
<0

121790 
	gj
>=0 &&

121792 #ià
YY_SHIFT_MAX
+
YYWILDCARD
>=
YY_ACTTAB_COUNT


121793 
j
<
YY_ACTTAB_COUNT
 &&

121795 
yy_lookah—d
[
j
]==
YYWILDCARD


121797 #iâdeà
NDEBUG


121798 ifÐ
yyT¿ûFILE
 ){

121799 
årštf
(
yyT¿ûFILE
, "%sWILDCARD %s => %s\n",

121800 
yyT¿ûProm±
, 
yyTok’Name
[
iLookAh—d
], yyTok’Name[
YYWILDCARD
]);

121803  
	gyy_aùiÚ
[
j
];

121808  
	gyy_deçuÉ
[
¡©’o
];

121810  
	gyy_aùiÚ
[
i
];

121822 
yy_fšd_»duû_aùiÚ
(

121823 
¡©’o
,

121824 
YYCODETYPE
 
iLookAh—d


121826 
	gi
;

121827 #ifdeà
YYERRORSYMBOL


121828 ifÐ
	g¡©’o
>
	gYY_REDUCE_COUNT
 ){

121829  
	gyy_deçuÉ
[
¡©’o
];

121832 
as£¹
Ð
¡©’o
<=
YY_REDUCE_COUNT
 );

121834 
	gi
 = 
yy_»duû_of¡
[
¡©’o
];

121835 
as£¹
Ð
i
!=
YY_REDUCE_USE_DFLT
 );

121836 
as£¹
Ð
iLookAh—d
!=
YYNOCODE
 );

121837 
	gi
 +ð
iLookAh—d
;

121838 #ifdeà
YYERRORSYMBOL


121839 ifÐ
	gi
<0 || i>=
YY_ACTTAB_COUNT
 || 
yy_lookah—d
[
i
]!=
iLookAh—d
 ){

121840  
yy_deçuÉ
[
¡©’o
];

121843 
as£¹
Ð
i
>=0 && i<
YY_ACTTAB_COUNT
 );

121844 
as£¹
Ð
yy_lookah—d
[
i
]==
iLookAh—d
 );

121846  
	gyy_aùiÚ
[
i
];

121852 
yySckOv”æow
(
yyP¬£r
 *
yypP¬£r
, 
YYMINORTYPE
 *
yypMšÜ
){

121853 
	gsql™e3P¬£rARG_FETCH
;

121854 
	gyypP¬£r
->
	gyyidx
--;

121855 #iâdeà
NDEBUG


121856 ifÐ
	gyyT¿ûFILE
 ){

121857 
årštf
(
yyT¿ûFILE
,"%sSck Ov”æow!\n",
yyT¿ûProm±
);

121860  
	gyypP¬£r
->
	gyyidx
>=0 ) 
yy_pÝ_·r£r_¡ack
(
yypP¬£r
);

121864 
UNUSED_PARAMETER
(
yypMšÜ
);

121865 
sql™e3E¼ÜMsg
(
pP¬£
, "parser stack overflow");

121866 
	gsql™e3P¬£rARG_STORE
;

121872 
yy_shiá
(

121873 
yyP¬£r
 *
yypP¬£r
,

121874 
yyNewS‹
,

121875 
yyMajÜ
,

121876 
YYMINORTYPE
 *
yypMšÜ


121878 
yySckEÁry
 *
	gyytos
;

121879 
	gyypP¬£r
->
	gyyidx
++;

121880 #ifdeà
YYTRACKMAXSTACKDEPTH


121881 ifÐ
	gyypP¬£r
->
	gyyidx
>yypP¬£r->
	gyyidxMax
 ){

121882 
	gyypP¬£r
->
	gyyidxMax
 = 
yypP¬£r
->
yyidx
;

121885 #ià
YYSTACKDEPTH
>0

121886 ifÐ
	gyypP¬£r
->
	gyyidx
>=
YYSTACKDEPTH
 ){

121887 
yySckOv”æow
(
yypP¬£r
, 
yypMšÜ
);

121891 ifÐ
	gyypP¬£r
->
	gyyidx
>=
yypP¬£r
->
yy¡ksz
 ){

121892 
yyGrowSck
(
yypP¬£r
);

121893 ifÐ
	gyypP¬£r
->
	gyyidx
>=
yypP¬£r
->
yy¡ksz
 ){

121894 
yySckOv”æow
(
yypP¬£r
, 
yypMšÜ
);

121899 
	gyytos
 = &
yypP¬£r
->
yy¡ack
[yypP¬£r->
yyidx
];

121900 
	gyytos
->
	g¡©’o
 = (
YYACTIONTYPE
)
yyNewS‹
;

121901 
	gyytos
->
	gmajÜ
 = (
YYCODETYPE
)
yyMajÜ
;

121902 
	gyytos
->
	gmšÜ
 = *
yypMšÜ
;

121903 #iâdeà
NDEBUG


121904 ifÐ
	gyyT¿ûFILE
 && 
	gyypP¬£r
->
	gyyidx
>0 ){

121905 
	gi
;

121906 
årštf
(
yyT¿ûFILE
,"%sShiá %d\n",
yyT¿ûProm±
,
yyNewS‹
);

121907 
årštf
(
yyT¿ûFILE
,"%sSck:",
yyT¿ûProm±
);

121908 
	gi
=1; i<=
yypP¬£r
->
yyidx
; i++)

121909 
årštf
(
yyT¿ûFILE
," %s",
yyTok’Name
[
yypP¬£r
->
yy¡ack
[
i
].
majÜ
]);

121910 
årštf
(
yyT¿ûFILE
,"\n");

121919 
YYCODETYPE
 
	glhs
;

121920 
	gÄhs
;

121921 } 
	gyyRuËInfo
[] = {

122251 
yy_acû±
(
yyP¬£r
*);

122257 
yy_»duû
(

122258 
yyP¬£r
 *
yypP¬£r
,

122259 
yyruËno


122261 
	gyygÙo
;

122262 
	gyyaù
;

122263 
YYMINORTYPE
 
	gyygÙomšÜ
;

122264 
yySckEÁry
 *
	gyym¥
;

122265 
	gyysize
;

122266 
	gsql™e3P¬£rARG_FETCH
;

122267 
	gyym¥
 = &
yypP¬£r
->
yy¡ack
[yypP¬£r->
yyidx
];

122268 #iâdeà
NDEBUG


122269 ifÐ
	gyyT¿ûFILE
 && 
	gyyruËno
>=0

122270 && 
yyruËno
<()((
yyRuËName
)/(yyRuleName[0])) ){

122271 
årštf
(
yyT¿ûFILE
, "%sReduû [%s].\n", 
yyT¿ûProm±
,

122272 
yyRuËName
[
yyruËno
]);

122291 
	gyygÙomšÜ
 = 
yyz”omšÜ
;

122294  
	gyyruËno
 ){

122304 { 
sql™e3BegšP¬£
(
pP¬£
, 0); }

122307 { 
sql™e3BegšP¬£
(
pP¬£
, 1); }

122310 { 
sql™e3BegšP¬£
(
pP¬£
, 2); }

122313 { 
sql™e3FšishCodšg
(
pP¬£
); }

122316 {
sql™e3BegšT¿n§ùiÚ
(
pP¬£
, 
yym¥
[-1].
mšÜ
.
yy328
);}

122319 {
yygÙomšÜ
.
yy328
 = 
TK_DEFERRED
;}

122322 15: 
yy‹¡ÿ£
(
yyruËno
==15);

122323 16: 
yy‹¡ÿ£
(
yyruËno
==16);

122324 115: 
yy‹¡ÿ£
(
yyruËno
==115);

122325 117: 
yy‹¡ÿ£
(
yyruËno
==117);

122326 {
	gyygÙomšÜ
.
	gyy328
 = 
yym¥
[0].
majÜ
;}

122329 18: 
yy‹¡ÿ£
(
yyruËno
==18);

122330 {
sql™e3Comm™T¿n§ùiÚ
(
pP¬£
);}

122333 {
sql™e3RÞlbackT¿n§ùiÚ
(
pP¬£
);}

122337 
sql™e3Sav•ošt
(
pP¬£
, 
SAVEPOINT_BEGIN
, &
yym¥
[0].
mšÜ
.
yy0
);

122342 
sql™e3Sav•ošt
(
pP¬£
, 
SAVEPOINT_RELEASE
, &
yym¥
[0].
mšÜ
.
yy0
);

122347 
sql™e3Sav•ošt
(
pP¬£
, 
SAVEPOINT_ROLLBACK
, &
yym¥
[0].
mšÜ
.
yy0
);

122352 
sql™e3S¹TabË
(
pP¬£
,&
yym¥
[-1].
mšÜ
.
yy0
,&yym¥[0].mšÜ.yy0,yym¥[-4].mšÜ.
yy328
,0,0,yymsp[-2].minor.yy328);

122357 
pP¬£
->
db
->
lookaside
.
bEÇbËd
 = 0;

122358 
	gyygÙomšÜ
.
	gyy0
 = 
yym¥
[0].
mšÜ
.
yy0
;

122362 31: 
yy‹¡ÿ£
(
yyruËno
==31);

122363 68: 
yy‹¡ÿ£
(
yyruËno
==68);

122364 81: 
yy‹¡ÿ£
(
yyruËno
==81);

122365 83: 
yy‹¡ÿ£
(
yyruËno
==83);

122366 85: 
yy‹¡ÿ£
(
yyruËno
==85);

122367 97: 
yy‹¡ÿ£
(
yyruËno
==97);

122368 108: 
yy‹¡ÿ£
(
yyruËno
==108);

122369 218: 
yy‹¡ÿ£
(
yyruËno
==218);

122370 221: 
yy‹¡ÿ£
(
yyruËno
==221);

122371 {
	gyygÙomšÜ
.
	gyy328
 = 0;}

122374 30: 
yy‹¡ÿ£
(
yyruËno
==30);

122375 69: 
yy‹¡ÿ£
(
yyruËno
==69);

122376 84: 
yy‹¡ÿ£
(
yyruËno
==84);

122377 107: 
yy‹¡ÿ£
(
yyruËno
==107);

122378 219: 
yy‹¡ÿ£
(
yyruËno
==219);

122379 222: 
yy‹¡ÿ£
(
yyruËno
==222);

122380 {
	gyygÙomšÜ
.
	gyy328
 = 1;}

122384 
sql™e3EndTabË
(
pP¬£
,&
yym¥
[-2].
mšÜ
.
yy0
,&yym¥[-1].mšÜ.yy0,yym¥[0].mšÜ.
yy186
,0);

122389 
sql™e3EndTabË
(
pP¬£
,0,0,0,
yym¥
[0].
mšÜ
.
yy3
);

122390 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[0].
mšÜ
.
yy3
);

122394 {
yygÙomšÜ
.
yy186
 = 0;}

122398 ifÐ
yym¥
[0].
mšÜ
.
yy0
.
n
==5 && 
sql™e3_¡ºicmp
(yym¥[0].mšÜ.yy0.
z
,"rowid",5)==0 ){

122399 
yygÙomšÜ
.
yy186
 = 
TF_W™houtRowid
;

122401 
	gyygÙomšÜ
.
	gyy186
 = 0;

122402 
sql™e3E¼ÜMsg
(
pP¬£
, "unknowÀbË o±iÚ: %.*s", 
yym¥
[0].
mšÜ
.
yy0
.
n
, yym¥[0].mšÜ.yy0.
z
);

122408 
yygÙomšÜ
.
yy0
.
z
 = 
yym¥
[-2].
mšÜ
.yy0.z;

122409 
	gyygÙomšÜ
.
	gyy0
.
	gn
 = ()(
pP¬£
->
sLa¡Tok’
.
z
-
yym¥
[-2].
mšÜ
.
yy0
.zè+…P¬£->sLa¡Tok’.
n
;

122414 
sql™e3AddCÞumn
(
pP¬£
,&
yym¥
[0].
mšÜ
.
yy0
);

122415 
	gyygÙomšÜ
.
	gyy0
 = 
yym¥
[0].
mšÜ
.
yy0
;

122416 
	gpP¬£
->
	gcÚ¡¿štName
.
	gn
 = 0;

122420 41: 
yy‹¡ÿ£
(
yyruËno
==41);

122421 42: 
yy‹¡ÿ£
(
yyruËno
==42);

122422 45: 
yy‹¡ÿ£
(
yyruËno
==45);

122423 48: 
yy‹¡ÿ£
(
yyruËno
==48);

122424 130: 
yy‹¡ÿ£
(
yyruËno
==130);

122425 131: 
yy‹¡ÿ£
(
yyruËno
==131);

122426 141: 
yy‹¡ÿ£
(
yyruËno
==141);

122427 150: 
yy‹¡ÿ£
(
yyruËno
==150);

122428 247: 
yy‹¡ÿ£
(
yyruËno
==247);

122429 256: 
yy‹¡ÿ£
(
yyruËno
==256);

122430 257: 
yy‹¡ÿ£
(
yyruËno
==257);

122431 258: 
yy‹¡ÿ£
(
yyruËno
==258);

122432 259: 
yy‹¡ÿ£
(
yyruËno
==259);

122433 260: 
yy‹¡ÿ£
(
yyruËno
==260);

122434 261: 
yy‹¡ÿ£
(
yyruËno
==261);

122435 262: 
yy‹¡ÿ£
(
yyruËno
==262);

122436 263: 
yy‹¡ÿ£
(
yyruËno
==263);

122437 279: 
yy‹¡ÿ£
(
yyruËno
==279);

122438 {
	gyygÙomšÜ
.
	gyy0
 = 
yym¥
[0].
mšÜ
.
yy0
;}

122441 {
sql™e3AddCÞumnTy³
(
pP¬£
,&
yym¥
[0].
mšÜ
.
yy0
);}

122445 
yygÙomšÜ
.
yy0
.
z
 = 
yym¥
[-3].
mšÜ
.yy0.z;

122446 
	gyygÙomšÜ
.
	gyy0
.
	gn
 = ()(&
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
] - yymsp[-3].minor.yy0.z);

122451 
yygÙomšÜ
.
yy0
.
z
 = 
yym¥
[-5].
mšÜ
.yy0.z;

122452 
	gyygÙomšÜ
.
	gyy0
.
	gn
 = ()(&
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
] - yymsp[-5].minor.yy0.z);

122456 {
yygÙomšÜ
.
yy0
.
z
=
yym¥
[-1].
mšÜ
.yy0.z; 
	gyygÙomšÜ
.
	gyy0
.
	gn
=yym¥[0].mšÜ.yy0.
n
+()(yymsp[0].minor.yy0.z-yymsp[-1].minor.yy0.z);}

122459 92: 
yy‹¡ÿ£
(
yyruËno
==92);

122460 {
	gpP¬£
->
	gcÚ¡¿štName
 = 
yym¥
[0].
mšÜ
.
yy0
;}

122463 57: 
yy‹¡ÿ£
(
yyruËno
==57);

122464 {
sql™e3AddDeçuÉV®ue
(
pP¬£
,&
yym¥
[0].
mšÜ
.
yy346
);}

122467 {
sql™e3AddDeçuÉV®ue
(
pP¬£
,&
yym¥
[-1].
mšÜ
.
yy346
);}

122471 
Ex´S·n
 
v
;

122472 
	gv
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_UMINUS
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
, 0, 0);

122473 
	gv
.
	gzS¹
 = 
yym¥
[-1].
mšÜ
.
yy0
.
z
;

122474 
	gv
.
	gzEnd
 = 
yym¥
[0].
mšÜ
.
yy346
.
zEnd
;

122475 
sql™e3AddDeçuÉV®ue
(
pP¬£
,&
v
);

122480 
Ex´S·n
 
v
;

122481 
¥ªEx´
(&
v
, 
pP¬£
, 
TK_STRING
, &
yym¥
[0].
mšÜ
.
yy0
);

122482 
sql™e3AddDeçuÉV®ue
(
pP¬£
,&
v
);

122486 {
sql™e3AddNÙNuÎ
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy328
);}

122489 {
sql™e3AddPrim¬yKey
(
pP¬£
,0,
yym¥
[-1].
mšÜ
.
yy328
,yymsp[0].minor.yy328,yymsp[-2].minor.yy328);}

122492 {
sql™e3C»©eIndex
(
pP¬£
,0,0,0,0,
yym¥
[0].
mšÜ
.
yy328
,0,0,0,0);}

122495 {
sql™e3AddCheckCÚ¡¿št
(
pP¬£
,
yym¥
[-1].
mšÜ
.
yy346
.
pEx´
);}

122498 {
sql™e3C»©eFÜeignKey
(
pP¬£
,0,&
yym¥
[-2].
mšÜ
.
yy0
,yym¥[-1].mšÜ.
yy14
,yym¥[0].mšÜ.
yy328
);}

122501 {
sql™e3DeãrFÜeignKey
(
pP¬£
,
yym¥
[0].
mšÜ
.
yy328
);}

122504 {
sql™e3AddCÞÏ‹Ty³
(
pP¬£
, &
yym¥
[0].
mšÜ
.
yy0
);}

122507 { 
yygÙomšÜ
.
yy328
 = 
OE_NÚe
*0x0101; }

122510 { 
yygÙomšÜ
.
yy328
 = (
yym¥
[-1].
mšÜ
.yy328 & ~yym¥[0].mšÜ.
yy429
.
mask
è| yym¥[0].mšÜ.yy429.
v®ue
; }

122513 73: 
yy‹¡ÿ£
(
yyruËno
==73);

122514 { 
	gyygÙomšÜ
.
	gyy429
.
	gv®ue
 = 0; yygÙomšÜ.yy429.
	gmask
 = 0x000000; }

122517 { 
yygÙomšÜ
.
yy429
.
v®ue
 = 
yym¥
[0].
mšÜ
.
yy328
; 
	gyygÙomšÜ
.
	gyy429
.
	gmask
 = 0x0000ff; }

122520 { 
yygÙomšÜ
.
yy429
.
v®ue
 = 
yym¥
[0].
mšÜ
.
yy328
<<8; 
	gyygÙomšÜ
.
	gyy429
.
	gmask
 = 0x00ff00; }

122523 { 
yygÙomšÜ
.
yy328
 = 
OE_S‘NuÎ
; }

122526 { 
yygÙomšÜ
.
yy328
 = 
OE_S‘Dæt
; }

122529 { 
yygÙomšÜ
.
yy328
 = 
OE_Casÿde
; }

122532 { 
yygÙomšÜ
.
yy328
 = 
OE_Re¡riù
; }

122535 { 
yygÙomšÜ
.
yy328
 = 
OE_NÚe
; }

122538 98: 
yy‹¡ÿ£
(
yyruËno
==98);

122539 100: 
yy‹¡ÿ£
(
yyruËno
==100);

122540 103: 
yy‹¡ÿ£
(
yyruËno
==103);

122541 {
	gyygÙomšÜ
.
	gyy328
 = 
yym¥
[0].
mšÜ
.
yy328
;}

122544 {
yygÙomšÜ
.
yy0
.
n
 = 0; 
	gyygÙomšÜ
.
	gyy0
.
	gz
 = 0;}

122547 {
yygÙomšÜ
.
yy0
 = 
yym¥
[-1].
mšÜ
.yy0;}

122550 {
pP¬£
->
cÚ¡¿štName
.
n
 = 0;}

122553 {
sql™e3AddPrim¬yKey
(
pP¬£
,
yym¥
[-3].
mšÜ
.
yy14
,yym¥[0].mšÜ.
yy328
,yymsp[-2].minor.yy328,0);}

122556 {
sql™e3C»©eIndex
(
pP¬£
,0,0,0,
yym¥
[-2].
mšÜ
.
yy14
,yym¥[0].mšÜ.
yy328
,0,0,0,0);}

122559 {
sql™e3AddCheckCÚ¡¿št
(
pP¬£
,
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
);}

122563 
sql™e3C»©eFÜeignKey
(
pP¬£
, 
yym¥
[-6].
mšÜ
.
yy14
, &yym¥[-3].mšÜ.
yy0
, yym¥[-2].mšÜ.yy14, yym¥[-1].mšÜ.
yy328
);

122564 
sql™e3DeãrFÜeignKey
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy328
);

122568 {
yygÙomšÜ
.
yy328
 = 
OE_DeçuÉ
;}

122571 {
yygÙomšÜ
.
yy186
 = 
OE_DeçuÉ
;}

122574 {
yygÙomšÜ
.
yy186
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;}

122577 {
yygÙomšÜ
.
yy328
 = 
OE_IgnÜe
;}

122580 {
yygÙomšÜ
.
yy328
 = 
OE_R•Ïû
;}

122584 
sql™e3DrÝTabË
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy65
, 0, yym¥[-1].mšÜ.
yy328
);

122589 
sql™e3C»©eV›w
(
pP¬£
, &
yym¥
[-7].
mšÜ
.
yy0
, &yym¥[-3].mšÜ.yy0, &yym¥[-2].mšÜ.yy0, yym¥[0].mšÜ.
yy3
, yym¥[-6].mšÜ.
yy328
, yymsp[-4].minor.yy328);

122594 
sql™e3DrÝTabË
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy65
, 1, yym¥[-1].mšÜ.
yy328
);

122599 
S–eùDe¡
 
de¡
 = {
SRT_Ouut
, 0, 0, 0, 0, 0};

122600 
sql™e3S–eù
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy3
, &
de¡
);

122601 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[0].
mšÜ
.
yy3
);

122606 
S–eù
 *
p
 = 
yym¥
[0].
mšÜ
.
yy3
, *
	gpNext
, *
	gpLoÝ
;

122607 ifÐ
	gp
 ){

122608 
	gút
 = 0, 
	gmxS–eù
;

122609 
	gp
->
	gpW™h
 = 
yym¥
[-1].
mšÜ
.
yy59
;

122610 ifÐ
	gp
->
	gpPriÜ
 ){

122611 
	gpNext
 = 0;

122612 
	gpLoÝ
=
p
;…LoÝ; 
	gpNext
=
pLoÝ
,…LoÝõLoÝ->
pPriÜ
, 
	gút
++){

122613 
	gpLoÝ
->
	gpNext
 = 
pNext
;

122614 
	gpLoÝ
->
	g£lFÏgs
 |ð
SF_Compound
;

122616 
	gmxS–eù
 = 
pP¬£
->
db
->
aLim™
[
SQLITE_LIMIT_COMPOUND_SELECT
];

122617 ifÐ
	gmxS–eù
 && 
	gút
>mxSelect ){

122618 
sql™e3E¼ÜMsg
(
pP¬£
, "too manyerms in compound SELECT");

122622 
sql™e3W™hD–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy59
);

122624 
	gyygÙomšÜ
.
	gyy3
 = 
p
;

122628 119: 
yy‹¡ÿ£
(
yyruËno
==119);

122629 {
	gyygÙomšÜ
.
	gyy3
 = 
yym¥
[0].
mšÜ
.
yy3
;}

122633 
S–eù
 *
pRhs
 = 
yym¥
[0].
mšÜ
.
yy3
;

122634 ifÐ
	gpRhs
 &&…Rhs->
	gpPriÜ
 ){

122635 
SrcLi¡
 *
	gpFrom
;

122636 
Tok’
 
	gx
;

122637 
	gx
.
	gn
 = 0;

122638 
	gpFrom
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,0,0,0,&
x
,
pRhs
,0,0);

122639 
	gpRhs
 = 
sql™e3S–eùNew
(
pP¬£
,0,
pFrom
,0,0,0,0,0,0,0);

122641 ifÐ
	gpRhs
 ){

122642 
	gpRhs
->
	gÝ
 = (
u8
)
yym¥
[-1].
mšÜ
.
yy328
;

122643 
	gpRhs
->
	gpPriÜ
 = 
yym¥
[-2].
mšÜ
.
yy3
;

122644 ifÐ
	gyym¥
[-1].
	gmšÜ
.
	gyy328
!=
TK_ALL
 ) 
pP¬£
->
hasCompound
 = 1;

122646 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[-2].
mšÜ
.
yy3
);

122648 
	gyygÙomšÜ
.
	gyy3
 = 
pRhs
;

122652 {
yygÙomšÜ
.
yy328
 = 
TK_ALL
;}

122656 
yygÙomšÜ
.
yy3
 = 
sql™e3S–eùNew
(
pP¬£
,
yym¥
[-6].
mšÜ
.
yy14
,yym¥[-5].mšÜ.
yy65
,yym¥[-4].mšÜ.
yy132
,yym¥[-3].mšÜ.yy14,yym¥[-2].mšÜ.yy132,yym¥[-1].mšÜ.yy14,yym¥[-7].mšÜ.
yy381
,yym¥[0].mšÜ.
yy476
.
pLim™
,yym¥[0].mšÜ.yy476.
pOff£t
);

122657 #ià
SELECTTRACE_ENABLED


122667 ifÐ
	gyygÙomšÜ
.
	gyy3
!=0 ){

122668 cÚ¡ *
z
 = 
yym¥
[-8].
mšÜ
.
yy0
.z+6;

122669 
	gi
;

122670 
sql™e3_¢´štf
((
yygÙomšÜ
.
yy3
->
zS–Name
), yygotominor.yy3->zSelName, "#%d",

122671 ++
pP¬£
->
nS–eù
);

122672  
	gz
[0]==' ' ) 
z
++;

122673 ifÐ
	gz
[0]=='/' && 
z
[1]=='*' ){

122674 
z
 += 2;

122675  
	gz
[0]==' ' ) 
z
++;

122676 
	gi
=0; 
sql™e3I§Êum
(
z
[
i
]); i++){}

122677 
sql™e3_¢´štf
((
yygÙomšÜ
.
yy3
->
zS–Name
), yygÙomšÜ.yy3->zS–Name, "%.*s", 
i
, 
z
);

122685 
yygÙomšÜ
.
yy3
 = 
sql™e3S–eùNew
(
pP¬£
,
yym¥
[-1].
mšÜ
.
yy14
,0,0,0,0,0,
SF_V®ues
,0,0);

122690 
S–eù
 *
pRight
 = 
sql™e3S–eùNew
(
pP¬£
,
yym¥
[-1].
mšÜ
.
yy14
,0,0,0,0,0,
SF_V®ues
,0,0);

122691 ifÐ
	gpRight
 ){

122692 
	gpRight
->
	gÝ
 = 
TK_ALL
;

122693 
	gpRight
->
	gpPriÜ
 = 
yym¥
[-4].
mšÜ
.
yy3
;

122694 
	gyygÙomšÜ
.
	gyy3
 = 
pRight
;

122696 
	gyygÙomšÜ
.
	gyy3
 = 
yym¥
[-4].
mšÜ
.
yy3
;

122701 {
yygÙomšÜ
.
yy381
 = 
SF_Di¡šù
;}

122704 124: 
yy‹¡ÿ£
(
yyruËno
==124);

122705 {
	gyygÙomšÜ
.
	gyy381
 = 0;}

122708 243: 
yy‹¡ÿ£
(
yyruËno
==243);

122709 {
	gyygÙomšÜ
.
	gyy14
 = 
yym¥
[-1].
mšÜ
.
yy14
;}

122712 154: 
yy‹¡ÿ£
(
yyruËno
==154);

122713 161: 
yy‹¡ÿ£
(
yyruËno
==161);

122714 236: 
yy‹¡ÿ£
(
yyruËno
==236);

122715 242: 
yy‹¡ÿ£
(
yyruËno
==242);

122716 {
	gyygÙomšÜ
.
	gyy14
 = 0;}

122720 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
yym¥
[-2].
mšÜ
.yy14, yym¥[-1].mšÜ.
yy346
.
pEx´
);

122721 ifÐ
	gyym¥
[0].
	gmšÜ
.
	gyy0
.
	gn
>0 ) 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
yygÙomšÜ
.
yy14
, &
yym¥
[0].
mšÜ
.
yy0
, 1);

122722 
sql™e3Ex´Li¡S‘S·n
(
pP¬£
,
yygÙomšÜ
.
yy14
,&
yym¥
[-1].
mšÜ
.
yy346
);

122727 
Ex´
 *
p
 = 
sql™e3Ex´
(
pP¬£
->
db
, 
TK_ALL
, 0);

122728 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
yym¥
[-1].
mšÜ
.
yy14
, 
p
);

122733 
Ex´
 *
pRight
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ALL
, 0, 0, &
yym¥
[0].
mšÜ
.
yy0
);

122734 
Ex´
 *
	gpLeá
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[-2].
mšÜ
.
yy0
);

122735 
Ex´
 *
	gpDÙ
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
pLeá
, 
pRight
, 0);

122736 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yym¥
[-3].
mšÜ
.
yy14
, 
pDÙ
);

122740 {
yygÙomšÜ
.
yy0
.
n
 = 0;}

122743 {
yygÙomšÜ
.
yy65
 = 
sql™e3DbM®locZ”o
(
pP¬£
->
db
, (*yygotominor.yy65));}

122747 
yygÙomšÜ
.
yy65
 = 
yym¥
[0].
mšÜ
.yy65;

122748 
sql™e3SrcLi¡ShiáJošTy³
(
yygÙomšÜ
.
yy65
);

122753 
yygÙomšÜ
.
yy65
 = 
yym¥
[-1].
mšÜ
.yy65;

122754 ifÐ
ALWAYS
(
yygÙomšÜ
.
yy65
 && yygÙomšÜ.yy65->
nSrc
>0èè
	gyygÙomšÜ
.
	gyy65
->
	ga
[yygÙomšÜ.yy65->nSrc-1].
	gjošty³
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;

122758 {
yygÙomšÜ
.
yy65
 = 0;}

122762 
yygÙomšÜ
.
yy65
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,
yym¥
[-6].
mšÜ
.yy65,&yym¥[-5].mšÜ.
yy0
,&yym¥[-4].mšÜ.yy0,&yym¥[-3].mšÜ.yy0,0,yym¥[-1].mšÜ.
yy132
,yym¥[0].mšÜ.
yy408
);

122763 
sql™e3SrcLi¡IndexedBy
(
pP¬£
, 
yygÙomšÜ
.
yy65
, &
yym¥
[-2].
mšÜ
.
yy0
);

122768 
yygÙomšÜ
.
yy65
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,
yym¥
[-6].
mšÜ
.yy65,0,0,&yym¥[-2].mšÜ.
yy0
,yym¥[-4].mšÜ.
yy3
,yym¥[-1].mšÜ.
yy132
,yym¥[0].mšÜ.
yy408
);

122773 ifÐ
yym¥
[-6].
mšÜ
.
yy65
==0 && yym¥[-2].mšÜ.
yy0
.
n
==0 && yym¥[-1].mšÜ.
yy132
==0 && yym¥[0].mšÜ.
yy408
==0 ){

122774 
yygÙomšÜ
.
yy65
 = 
yym¥
[-4].
mšÜ
.yy65;

122775 }ifÐ
	gyym¥
[-4].
	gmšÜ
.
	gyy65
->
	gnSrc
==1 ){

122776 
yygÙomšÜ
.
yy65
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,
yym¥
[-6].
mšÜ
.yy65,0,0,&yym¥[-2].mšÜ.
yy0
,0,yym¥[-1].mšÜ.
yy132
,yym¥[0].mšÜ.
yy408
);

122777 ifÐ
	gyygÙomšÜ
.
	gyy65
 ){

122778 
SrcLi¡_™em
 *
	gpNew
 = &
yygÙomšÜ
.
yy65
->
a
[yygÙomšÜ.yy65->
nSrc
-1];

122779 
SrcLi¡_™em
 *
	gpOld
 = 
yym¥
[-4].
mšÜ
.
yy65
->
a
;

122780 
	gpNew
->
	gzName
 = 
pOld
->
zName
;

122781 
	gpNew
->
	gzD©aba£
 = 
pOld
->
zD©aba£
;

122782 
	gpNew
->
	gpS–eù
 = 
pOld
->
pS–eù
;

122783 
	gpOld
->
	gzName
 = 
pOld
->
zD©aba£
 = 0;

122784 
	gpOld
->
	gpS–eù
 = 0;

122786 
sql™e3SrcLi¡D–‘e
(
pP¬£
->
db
, 
yym¥
[-4].
mšÜ
.
yy65
);

122788 
S–eù
 *
	gpSubqu”y
;

122789 
sql™e3SrcLi¡ShiáJošTy³
(
yym¥
[-4].
mšÜ
.
yy65
);

122790 
	gpSubqu”y
 = 
sql™e3S–eùNew
(
pP¬£
,0,
yym¥
[-4].
mšÜ
.
yy65
,0,0,0,0,
SF_Ne¡edFrom
,0,0);

122791 
	gyygÙomšÜ
.
	gyy65
 = 
sql™e3SrcLi¡Aµ’dFromT”m
(
pP¬£
,
yym¥
[-6].
mšÜ
.
yy65
,0,0,&yym¥[-2].mšÜ.
yy0
,
pSubqu”y
,yym¥[-1].mšÜ.
yy132
,yym¥[0].mšÜ.
yy408
);

122796 149: 
yy‹¡ÿ£
(
yyruËno
==149);

122797 {
	gyygÙomšÜ
.
	gyy0
.
	gz
=0; yygÙomšÜ.yy0.
	gn
=0;}

122800 {
yygÙomšÜ
.
yy65
 = 
sql™e3SrcLi¡Aµ’d
(
pP¬£
->
db
,0,&
yym¥
[-1].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);}

122803 { 
yygÙomšÜ
.
yy328
 = 
JT_INNER
; }

122806 { 
yygÙomšÜ
.
yy328
 = 
sql™e3JošTy³
(
pP¬£
,&
yym¥
[-1].
mšÜ
.
yy0
,0,0); }

122809 { 
yygÙomšÜ
.
yy328
 = 
sql™e3JošTy³
(
pP¬£
,&
yym¥
[-2].
mšÜ
.
yy0
,&yymsp[-1].minor.yy0,0); }

122812 { 
yygÙomšÜ
.
yy328
 = 
sql™e3JošTy³
(
pP¬£
,&
yym¥
[-3].
mšÜ
.
yy0
,&yymsp[-2].minor.yy0,&yymsp[-1].minor.yy0); }

122815 164: 
yy‹¡ÿ£
(
yyruËno
==164);

122816 171: 
yy‹¡ÿ£
(
yyruËno
==171);

122817 231: 
yy‹¡ÿ£
(
yyruËno
==231);

122818 233: 
yy‹¡ÿ£
(
yyruËno
==233);

122819 {
	gyygÙomšÜ
.
	gyy132
 = 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
;}

122822 163: 
yy‹¡ÿ£
(
yyruËno
==163);

122823 170: 
yy‹¡ÿ£
(
yyruËno
==170);

122824 232: 
yy‹¡ÿ£
(
yyruËno
==232);

122825 234: 
yy‹¡ÿ£
(
yyruËno
==234);

122826 {
	gyygÙomšÜ
.
	gyy132
 = 0;}

122829 {
yygÙomšÜ
.
yy0
.
z
=0; 
	gyygÙomšÜ
.
	gyy0
.
	gn
=1;}

122832 180: 
yy‹¡ÿ£
(
yyruËno
==180);

122833 {
	gyygÙomšÜ
.
	gyy408
 = 
yym¥
[-1].
mšÜ
.
yy408
;}

122836 179: 
yy‹¡ÿ£
(
yyruËno
==179);

122837 {
	gyygÙomšÜ
.
	gyy408
 = 0;}

122840 162: 
yy‹¡ÿ£
(
yyruËno
==162);

122841 235: 
yy‹¡ÿ£
(
yyruËno
==235);

122842 {
	gyygÙomšÜ
.
	gyy14
 = 
yym¥
[0].
mšÜ
.
yy14
;}

122846 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yym¥
[-3].
mšÜ
.yy14,yym¥[-1].mšÜ.
yy346
.
pEx´
);

122847 ifÐ
	gyygÙomšÜ
.
	gyy14
 ) yygÙomšÜ.yy14->
	ga
[
yygÙomšÜ
.
yy14
->
nEx´
-1].
	gsÜtOrd”
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;

122852 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0,
yym¥
[-1].
mšÜ
.
yy346
.
pEx´
);

122853 ifÐ
	gyygÙomšÜ
.
	gyy14
 && 
ALWAYS
(
yygÙomšÜ
.
yy14
->
a
èèyygÙomšÜ.yy14->
	ga
[0].
	gsÜtOrd”
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;

122857 160: 
yy‹¡ÿ£
(
yyruËno
==160);

122858 {
	gyygÙomšÜ
.
	gyy328
 = 
SQLITE_SO_ASC
;}

122861 {
yygÙomšÜ
.
yy328
 = 
SQLITE_SO_DESC
;}

122864 {
yygÙomšÜ
.
yy476
.
pLim™
 = 0; 
	gyygÙomšÜ
.
	gyy476
.
	gpOff£t
 = 0;}

122867 {
yygÙomšÜ
.
yy476
.
pLim™
 = 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
; 
	gyygÙomšÜ
.
	gyy476
.
	gpOff£t
 = 0;}

122870 {
yygÙomšÜ
.
yy476
.
pLim™
 = 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
; 
	gyygÙomšÜ
.
	gyy476
.
	gpOff£t
 = yymsp[0].minor.yy346.pExpr;}

122873 {
yygÙomšÜ
.
yy476
.
pOff£t
 = 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
; 
	gyygÙomšÜ
.
	gyy476
.
	gpLim™
 = yymsp[0].minor.yy346.pExpr;}

122877 
sql™e3W™hPush
(
pP¬£
, 
yym¥
[-5].
mšÜ
.
yy59
, 1);

122878 
sql™e3SrcLi¡IndexedBy
(
pP¬£
, 
yym¥
[-2].
mšÜ
.
yy65
, &yym¥[-1].mšÜ.
yy0
);

122879 
sql™e3D–‘eFrom
(
pP¬£
,
yym¥
[-2].
mšÜ
.
yy65
,yym¥[0].mšÜ.
yy132
);

122884 
sql™e3W™hPush
(
pP¬£
, 
yym¥
[-7].
mšÜ
.
yy59
, 1);

122885 
sql™e3SrcLi¡IndexedBy
(
pP¬£
, 
yym¥
[-4].
mšÜ
.
yy65
, &yym¥[-3].mšÜ.
yy0
);

122886 
sql™e3Ex´Li¡CheckL’gth
(
pP¬£
,
yym¥
[-1].
mšÜ
.
yy14
,"set†ist");

122887 
sql™e3Upd©e
(
pP¬£
,
yym¥
[-4].
mšÜ
.
yy65
,yym¥[-1].mšÜ.
yy14
,yym¥[0].mšÜ.
yy132
,yym¥[-5].mšÜ.
yy186
);

122892 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 
yym¥
[-4].
mšÜ
.yy14, yym¥[0].mšÜ.
yy346
.
pEx´
);

122893 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
yygÙomšÜ
.
yy14
, &
yym¥
[-2].
mšÜ
.
yy0
, 1);

122898 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
, 0, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

122899 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
yygÙomšÜ
.
yy14
, &
yym¥
[-2].
mšÜ
.
yy0
, 1);

122904 
sql™e3W™hPush
(
pP¬£
, 
yym¥
[-5].
mšÜ
.
yy59
, 1);

122905 
sql™e3In£¹
(
pP¬£
, 
yym¥
[-2].
mšÜ
.
yy65
, yym¥[0].mšÜ.
yy3
, yym¥[-1].mšÜ.
yy408
, yym¥[-4].mšÜ.
yy186
);

122910 
sql™e3W™hPush
(
pP¬£
, 
yym¥
[-6].
mšÜ
.
yy59
, 1);

122911 
sql™e3In£¹
(
pP¬£
, 
yym¥
[-3].
mšÜ
.
yy65
, 0, yym¥[-2].mšÜ.
yy408
, yym¥[-5].mšÜ.
yy186
);

122915 {
yygÙomšÜ
.
yy186
 = 
yym¥
[0].
mšÜ
.yy186;}

122918 {
yygÙomšÜ
.
yy186
 = 
OE_R•Ïû
;}

122921 {
yygÙomšÜ
.
yy408
 = 
sql™e3IdLi¡Aµ’d
(
pP¬£
->
db
,
yym¥
[-2].
mšÜ
.yy408,&yym¥[0].mšÜ.
yy0
);}

122924 {
yygÙomšÜ
.
yy408
 = 
sql™e3IdLi¡Aµ’d
(
pP¬£
->
db
,0,&
yym¥
[0].
mšÜ
.
yy0
);}

122927 {
yygÙomšÜ
.
yy346
 = 
yym¥
[0].
mšÜ
.yy346;}

122930 {
yygÙomšÜ
.
yy346
.
pEx´
 = 
yym¥
[-1].
mšÜ
.yy346.pEx´; 
¥ªS‘
(&yygÙomšÜ.yy346,&yym¥[-2].mšÜ.
yy0
,&yymsp[0].minor.yy0);}

122933 190: 
yy‹¡ÿ£
(
yyruËno
==190);

122934 191: 
yy‹¡ÿ£
(
yyruËno
==191);

122935 {
¥ªEx´
(&
yygÙomšÜ
.
yy346
, 
pP¬£
, 
yym¥
[0].
majÜ
, &yym¥[0].
mšÜ
.
yy0
);}

122938 187: 
yy‹¡ÿ£
(
yyruËno
==187);

122939 {
¥ªEx´
(&
yygÙomšÜ
.
yy346
, 
pP¬£
, 
TK_ID
, &
yym¥
[0].
mšÜ
.
yy0
);}

122943 
Ex´
 *
‹mp1
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[-2].
mšÜ
.
yy0
);

122944 
Ex´
 *
	g‹mp2
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[0].
mšÜ
.
yy0
);

122945 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
‹mp1
, 
‹mp2
, 0);

122946 
¥ªS‘
(&
yygÙomšÜ
.
yy346
,&
yym¥
[-2].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

122951 
Ex´
 *
‹mp1
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[-4].
mšÜ
.
yy0
);

122952 
Ex´
 *
	g‹mp2
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[-2].
mšÜ
.
yy0
);

122953 
Ex´
 *
	g‹mp3
 = 
sql™e3PEx´
(
pP¬£
, 
TK_ID
, 0, 0, &
yym¥
[0].
mšÜ
.
yy0
);

122954 
Ex´
 *
	g‹mp4
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
‹mp2
, 
‹mp3
, 0);

122955 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_DOT
, 
‹mp1
, 
‹mp4
, 0);

122956 
¥ªS‘
(&
yygÙomšÜ
.
yy346
,&
yym¥
[-4].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

122961 ifÐ
yym¥
[0].
mšÜ
.
yy0
.
n
>=2 && yym¥[0].mšÜ.yy0.
z
[0]=='#' && 
sql™e3Isdig™
(yymsp[0].minor.yy0.z[1]) ){

122965 ifÐ
pP¬£
->
Ã¡ed
==0 ){

122966 
sql™e3E¼ÜMsg
(
pP¬£
, "Ã¬ \"%T\": syÁaxƒ¼Ü", &
yym¥
[0].
mšÜ
.
yy0
);

122967 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 0;

122969 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_REGISTER
, 0, 0, &
yym¥
[0].
mšÜ
.
yy0
);

122970 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ) 
sql™e3G‘IÁ32
(&
yym¥
[0].
mšÜ
.
yy0
.
z
[1], &
yygÙomšÜ
.
yy346
.
pEx´
->
iTabË
);

122973 
¥ªEx´
(&
yygÙomšÜ
.
yy346
, 
pP¬£
, 
TK_VARIABLE
, &
yym¥
[0].
mšÜ
.
yy0
);

122974 
sql™e3Ex´AssignV¬Numb”
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

122976 
¥ªS‘
(&
yygÙomšÜ
.
yy346
, &
yym¥
[0].
mšÜ
.
yy0
, &yymsp[0].minor.yy0);

122981 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
, 
yym¥
[-2].
mšÜ
.yy346.pEx´, &yym¥[0].mšÜ.
yy0
);

122982 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-2].
mšÜ
.
yy346
.
zS¹
;

122983 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

122988 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_CAST
, 
yym¥
[-3].
mšÜ
.yy346.pEx´, 0, &yym¥[-1].mšÜ.
yy0
);

122989 
¥ªS‘
(&
yygÙomšÜ
.
yy346
,&
yym¥
[-5].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

122994 ifÐ
yym¥
[-1].
mšÜ
.
yy14
 && yym¥[-1].mšÜ.yy14->
nEx´
>
pP¬£
->
db
->
aLim™
[
SQLITE_LIMIT_FUNCTION_ARG
] ){

122995 
sql™e3E¼ÜMsg
(
pP¬£
, "toØmªy‡rgum’t Ú funùiÚ %T", &
yym¥
[-4].
mšÜ
.
yy0
);

122997 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3Ex´FunùiÚ
(
pP¬£
, 
yym¥
[-1].
mšÜ
.
yy14
, &yym¥[-4].mšÜ.
yy0
);

122998 
¥ªS‘
(&
yygÙomšÜ
.
yy346
,&
yym¥
[-4].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

122999 ifÐ
	gyym¥
[-2].
	gmšÜ
.
	gyy381
 && 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123000 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gæags
 |ð
EP_Di¡šù
;

123006 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3Ex´FunùiÚ
(
pP¬£
, 0, &
yym¥
[-3].
mšÜ
.
yy0
);

123007 
¥ªS‘
(&
yygÙomšÜ
.
yy346
,&
yym¥
[-3].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

123012 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3Ex´FunùiÚ
(
pP¬£
, 0, &
yym¥
[0].
mšÜ
.
yy0
);

123013 
¥ªS‘
(&
yygÙomšÜ
.
yy346
, &
yym¥
[0].
mšÜ
.
yy0
, &yymsp[0].minor.yy0);

123017 199: 
yy‹¡ÿ£
(
yyruËno
==199);

123018 200: 
yy‹¡ÿ£
(
yyruËno
==200);

123019 201: 
yy‹¡ÿ£
(
yyruËno
==201);

123020 202: 
yy‹¡ÿ£
(
yyruËno
==202);

123021 203: 
yy‹¡ÿ£
(
yyruËno
==203);

123022 204: 
yy‹¡ÿ£
(
yyruËno
==204);

123023 205: 
yy‹¡ÿ£
(
yyruËno
==205);

123024 {
¥ªBš¬yEx´
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
yym¥
[-1].
majÜ
,&yym¥[-2].
mšÜ
.yy346,&yymsp[0].minor.yy346);}

123027 {
yygÙomšÜ
.
yy96
.
eO³¿tÜ
 = 
yym¥
[0].
mšÜ
.
yy0
; 
	gyygÙomšÜ
.
	gyy96
.
	gbNÙ
 = 0;}

123030 {
yygÙomšÜ
.
yy96
.
eO³¿tÜ
 = 
yym¥
[0].
mšÜ
.
yy0
; 
	gyygÙomšÜ
.
	gyy96
.
	gbNÙ
 = 1;}

123034 
Ex´Li¡
 *
pLi¡
;

123035 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123036 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
pLi¡
, 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
);

123037 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3Ex´FunùiÚ
(
pP¬£
, 
pLi¡
, &
yym¥
[-1].
mšÜ
.
yy96
.
eO³¿tÜ
);

123038 ifÐ
	gyym¥
[-1].
	gmšÜ
.
	gyy96
.
	gbNÙ
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123039 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-2].
mšÜ
.
yy346
.
zS¹
;

123040 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = 
yym¥
[0].
mšÜ
.
yy346
.
zEnd
;

123041 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ) yygÙomšÜ.yy346.pEx´->
	gæags
 |ð
EP_InfixFunc
;

123046 
Ex´Li¡
 *
pLi¡
;

123047 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0, 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
);

123048 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
pLi¡
, 
yym¥
[-4].
mšÜ
.
yy346
.
pEx´
);

123049 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
pLi¡
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123050 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3Ex´FunùiÚ
(
pP¬£
, 
pLi¡
, &
yym¥
[-3].
mšÜ
.
yy96
.
eO³¿tÜ
);

123051 ifÐ
	gyym¥
[-3].
	gmšÜ
.
	gyy96
.
	gbNÙ
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123052 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-4].
mšÜ
.
yy346
.
zS¹
;

123053 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = 
yym¥
[0].
mšÜ
.
yy346
.
zEnd
;

123054 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ) yygÙomšÜ.yy346.pEx´->
	gæags
 |ð
EP_InfixFunc
;

123058 {
¥ªUÇryPo¡fix
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
yym¥
[0].
majÜ
,&yym¥[-1].
mšÜ
.yy346,&yym¥[0].mšÜ.
yy0
);}

123061 {
¥ªUÇryPo¡fix
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
TK_NOTNULL
,&
yym¥
[-2].
mšÜ
.yy346,&yym¥[0].mšÜ.
yy0
);}

123065 
¥ªBš¬yEx´
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
TK_IS
,&
yym¥
[-2].
mšÜ
.yy346,&yymsp[0].minor.yy346);

123066 
bš¬yToUÇryIfNuÎ
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
, 
yygÙomšÜ
.yy346.pEx´, 
TK_ISNULL
);

123071 
¥ªBš¬yEx´
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
TK_ISNOT
,&
yym¥
[-3].
mšÜ
.yy346,&yymsp[0].minor.yy346);

123072 
bš¬yToUÇryIfNuÎ
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
, 
yygÙomšÜ
.yy346.pEx´, 
TK_NOTNULL
);

123076 215: 
yy‹¡ÿ£
(
yyruËno
==215);

123077 {
¥ªUÇryP»fix
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
yym¥
[-1].
majÜ
,&yym¥[0].
mšÜ
.yy346,&yym¥[-1].mšÜ.
yy0
);}

123080 {
¥ªUÇryP»fix
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
TK_UMINUS
,&
yym¥
[0].
mšÜ
.yy346,&yym¥[-1].mšÜ.
yy0
);}

123083 {
¥ªUÇryP»fix
(&
yygÙomšÜ
.
yy346
,
pP¬£
,
TK_UPLUS
,&
yym¥
[0].
mšÜ
.yy346,&yym¥[-1].mšÜ.
yy0
);}

123087 
Ex´Li¡
 *
pLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0, 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
);

123088 
	gpLi¡
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
pLi¡
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123089 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_BETWEEN
, 
yym¥
[-4].
mšÜ
.
yy346
.
pEx´
, 0, 0);

123090 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123091 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpLi¡
 = 
pLi¡
;

123093 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
pLi¡
);

123095 ifÐ
	gyym¥
[-3].
	gmšÜ
.
	gyy328
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123096 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-4].
mšÜ
.
yy346
.
zS¹
;

123097 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = 
yym¥
[0].
mšÜ
.
yy346
.
zEnd
;

123102 ifÐ
yym¥
[-1].
mšÜ
.
yy14
==0 ){

123111 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_INTEGER
, 0, 0, &
sql™e3IÁTok’s
[
yym¥
[-3].
mšÜ
.
yy328
]);

123112 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
yym¥
[-4].
mšÜ
.
yy346
.
pEx´
);

123113 }ifÐ
	gyym¥
[-1].
	gmšÜ
.
	gyy14
->
	gnEx´
==1 ){

123130 
Ex´
 *
pRHS
 = 
yym¥
[-1].
mšÜ
.
yy14
->
a
[0].
pEx´
;

123131 
	gyym¥
[-1].
	gmšÜ
.
	gyy14
->
	ga
[0].
	gpEx´
 = 0;

123132 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy14
);

123135 ifÐ
ALWAYS
(
pRHS
) ){

123136 
	gpRHS
->
	gæags
 &ð~
EP_CÞÏ‹
;

123137 
	gpRHS
->
	gæags
 |ð
EP_G’”ic
;

123139 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
yym¥
[-3].
mšÜ
.
yy328
 ? 
TK_NE
 : 
TK_EQ
, yym¥[-4].mšÜ.
yy346
.
pEx´
, 
pRHS
, 0);

123141 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IN
, 
yym¥
[-4].
mšÜ
.
yy346
.
pEx´
, 0, 0);

123142 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123143 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpLi¡
 = 
yym¥
[-1].
mšÜ
.
yy14
;

123144 
sql™e3Ex´S‘Height
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

123146 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy14
);

123148 ifÐ
	gyym¥
[-3].
	gmšÜ
.
	gyy328
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123150 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-4].
mšÜ
.
yy346
.
zS¹
;

123151 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123156 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_SELECT
, 0, 0, 0);

123157 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123158 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpS–eù
 = 
yym¥
[-1].
mšÜ
.
yy3
;

123159 
Ex´S‘PrÝ”ty
(
yygÙomšÜ
.
yy346
.
pEx´
, 
EP_xIsS–eù
);

123160 
sql™e3Ex´S‘Height
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

123162 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy3
);

123164 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-2].
mšÜ
.
yy0
.
z
;

123165 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123170 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IN
, 
yym¥
[-4].
mšÜ
.yy346.pExpr, 0, 0);

123171 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123172 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpS–eù
 = 
yym¥
[-1].
mšÜ
.
yy3
;

123173 
Ex´S‘PrÝ”ty
(
yygÙomšÜ
.
yy346
.
pEx´
, 
EP_xIsS–eù
);

123174 
sql™e3Ex´S‘Height
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

123176 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy3
);

123178 ifÐ
	gyym¥
[-3].
	gmšÜ
.
	gyy328
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123179 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-4].
mšÜ
.
yy346
.
zS¹
;

123180 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123185 
SrcLi¡
 *
pSrc
 = 
sql™e3SrcLi¡Aµ’d
(
pP¬£
->
db
, 0,&
yym¥
[-1].
mšÜ
.
yy0
,&yymsp[0].minor.yy0);

123186 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_IN
, 
yym¥
[-3].
mšÜ
.
yy346
.
pEx´
, 0, 0);

123187 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123188 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpS–eù
 = 
sql™e3S–eùNew
(
pP¬£
, 0,
pSrc
,0,0,0,0,0,0,0);

123189 
Ex´S‘PrÝ”ty
(
yygÙomšÜ
.
yy346
.
pEx´
, 
EP_xIsS–eù
);

123190 
sql™e3Ex´S‘Height
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

123192 
sql™e3SrcLi¡D–‘e
(
pP¬£
->
db
, 
pSrc
);

123194 ifÐ
	gyym¥
[-2].
	gmšÜ
.
	gyy328
 ) 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_NOT
, 
yygÙomšÜ
.
yy346
.
pEx´
, 0, 0);

123195 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-3].
mšÜ
.
yy346
.
zS¹
;

123196 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = 
yym¥
[0].
mšÜ
.
yy0
.
z
 ? &yym¥[0].mšÜ.yy0.z[yym¥[0].mšÜ.yy0.
n
] : &yymsp[-1].minor.yy0.z[yymsp[-1].minor.yy0.n];

123201 
Ex´
 *
p
 = 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_EXISTS
, 0, 0, 0);

123202 ifÐ
	gp
 ){

123203 
	gp
->
	gx
.
	gpS–eù
 = 
yym¥
[-1].
mšÜ
.
yy3
;

123204 
Ex´S‘PrÝ”ty
(
p
, 
EP_xIsS–eù
);

123205 
sql™e3Ex´S‘Height
(
pP¬£
, 
p
);

123207 
sql™e3S–eùD–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy3
);

123209 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-3].
mšÜ
.
yy0
.
z
;

123210 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123215 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_CASE
, 
yym¥
[-3].
mšÜ
.
yy132
, 0, 0);

123216 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123217 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gx
.
	gpLi¡
 = 
yym¥
[-1].
mšÜ
.
yy132
 ? 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,yym¥[-2].mšÜ.
yy14
,yymsp[-1].minor.yy132) : yymsp[-2].minor.yy14;

123218 
sql™e3Ex´S‘Height
(
pP¬£
, 
yygÙomšÜ
.
yy346
.
pEx´
);

123220 
sql™e3Ex´Li¡D–‘e
(
pP¬£
->
db
, 
yym¥
[-2].
mšÜ
.
yy14
);

123221 
sql™e3Ex´D–‘e
(
pP¬£
->
db
, 
yym¥
[-1].
mšÜ
.
yy132
);

123223 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-4].
mšÜ
.
yy0
.
z
;

123224 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123229 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yym¥
[-4].
mšÜ
.yy14, yym¥[-2].mšÜ.
yy346
.
pEx´
);

123230 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yygÙomšÜ
.
yy14
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123235 
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0, 
yym¥
[-2].
mšÜ
.
yy346
.
pEx´
);

123236 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yygÙomšÜ
.
yy14
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123240 {
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yym¥
[-2].
mšÜ
.yy14,yym¥[0].mšÜ.
yy346
.
pEx´
);}

123243 {
yygÙomšÜ
.
yy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0,
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);}

123247 
sql™e3C»©eIndex
(
pP¬£
, &
yym¥
[-7].
mšÜ
.
yy0
, &yymsp[-6].minor.yy0,

123248 
sql™e3SrcLi¡Aµ’d
(
pP¬£
->
db
,0,&
yym¥
[-4].
mšÜ
.
yy0
,0), yym¥[-2].mšÜ.
yy14
, yym¥[-10].mšÜ.
yy328
,

123249 &
yym¥
[-11].
mšÜ
.
yy0
, yym¥[0].mšÜ.
yy132
, 
SQLITE_SO_ASC
, yym¥[-8].mšÜ.
yy328
);

123253 291: 
yy‹¡ÿ£
(
yyruËno
==291);

123254 {
	gyygÙomšÜ
.
	gyy328
 = 
OE_AbÜt
;}

123257 {
yygÙomšÜ
.
yy328
 = 
OE_NÚe
;}

123261 
Ex´
 *
p
 = 
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
, 0, &
yym¥
[-1].
mšÜ
.
yy0
);

123262 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,
yym¥
[-4].
mšÜ
.
yy14
, 
p
);

123263 
sql™e3Ex´Li¡S‘Name
(
pP¬£
,
yygÙomšÜ
.
yy14
,&
yym¥
[-2].
mšÜ
.
yy0
,1);

123264 
sql™e3Ex´Li¡CheckL’gth
(
pP¬£
, 
yygÙomšÜ
.
yy14
, "index");

123265 ifÐ
	gyygÙomšÜ
.
	gyy14
 ) yygÙomšÜ.yy14->
	ga
[
yygÙomšÜ
.
yy14
->
nEx´
-1].
	gsÜtOrd”
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;

123270 
Ex´
 *
p
 = 
sql™e3Ex´AddCÞÏ‹Tok’
(
pP¬£
, 0, &
yym¥
[-1].
mšÜ
.
yy0
);

123271 
	gyygÙomšÜ
.
	gyy14
 = 
sql™e3Ex´Li¡Aµ’d
(
pP¬£
,0, 
p
);

123272 
sql™e3Ex´Li¡S‘Name
(
pP¬£
, 
yygÙomšÜ
.
yy14
, &
yym¥
[-2].
mšÜ
.
yy0
, 1);

123273 
sql™e3Ex´Li¡CheckL’gth
(
pP¬£
, 
yygÙomšÜ
.
yy14
, "index");

123274 ifÐ
	gyygÙomšÜ
.
	gyy14
 ) yygÙomšÜ.yy14->
	ga
[
yygÙomšÜ
.
yy14
->
nEx´
-1].
	gsÜtOrd”
 = (
u8
)
yym¥
[0].
mšÜ
.
yy328
;

123278 {
yygÙomšÜ
.
yy0
.
z
 = 0; 
	gyygÙomšÜ
.
	gyy0
.
	gn
 = 0;}

123281 {
sql™e3DrÝIndex
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy65
, yym¥[-1].mšÜ.
yy328
);}

123284 250: 
yy‹¡ÿ£
(
yyruËno
==250);

123285 {
sql™e3Vacuum
(
pP¬£
);}

123288 {
sql™e3P¿gma
(
pP¬£
,&
yym¥
[-1].
mšÜ
.
yy0
,&yymsp[0].minor.yy0,0,0);}

123291 {
sql™e3P¿gma
(
pP¬£
,&
yym¥
[-3].
mšÜ
.
yy0
,&yymsp[-2].minor.yy0,&yymsp[0].minor.yy0,0);}

123294 {
sql™e3P¿gma
(
pP¬£
,&
yym¥
[-4].
mšÜ
.
yy0
,&yymsp[-3].minor.yy0,&yymsp[-1].minor.yy0,0);}

123297 {
sql™e3P¿gma
(
pP¬£
,&
yym¥
[-3].
mšÜ
.
yy0
,&yymsp[-2].minor.yy0,&yymsp[0].minor.yy0,1);}

123300 {
sql™e3P¿gma
(
pP¬£
,&
yym¥
[-4].
mšÜ
.
yy0
,&yymsp[-3].minor.yy0,&yymsp[-1].minor.yy0,1);}

123304 
Tok’
 
®l
;

123305 
	g®l
.
	gz
 = 
yym¥
[-3].
mšÜ
.
yy0
.
z
;

123306 
	g®l
.
	gn
 = ()(
yym¥
[0].
mšÜ
.
yy0
.
z
 - yym¥[-3].mšÜ.yy0.zè+ yym¥[0].mšÜ.yy0.
n
;

123307 
sql™e3FšishTrigg”
(
pP¬£
, 
yym¥
[-1].
mšÜ
.
yy473
, &
®l
);

123312 
sql™e3BegšTrigg”
(
pP¬£
, &
yym¥
[-7].
mšÜ
.
yy0
, &yym¥[-6].mšÜ.yy0, yym¥[-5].mšÜ.
yy328
, yym¥[-4].mšÜ.
yy378
.
a
, yym¥[-4].mšÜ.yy378.
b
, yym¥[-2].mšÜ.
yy65
, yym¥[0].mšÜ.
yy132
, yymsp[-10].minor.yy328, yymsp[-8].minor.yy328);

123313 
	gyygÙomšÜ
.
	gyy0
 = (
yym¥
[-6].
mšÜ
.
yy0
.
n
==0?yymsp[-7].minor.yy0:yymsp[-6].minor.yy0);

123317 269: 
yy‹¡ÿ£
(
yyruËno
==269);

123318 { 
	gyygÙomšÜ
.
	gyy328
 = 
TK_BEFORE
; }

123321 { 
yygÙomšÜ
.
yy328
 = 
TK_AFTER
; }

123324 { 
yygÙomšÜ
.
yy328
 = 
TK_INSTEAD
;}

123327 271: 
yy‹¡ÿ£
(
yyruËno
==271);

123328 {
	gyygÙomšÜ
.
	gyy378
.
	ga
 = 
yym¥
[0].
majÜ
; yygÙomšÜ.yy378.
	gb
 = 0;}

123331 {
yygÙomšÜ
.
yy378
.
a
 = 
TK_UPDATE
; 
	gyygÙomšÜ
.
	gyy378
.
	gb
 = 
yym¥
[0].
mšÜ
.
yy408
;}

123334 296: 
yy‹¡ÿ£
(
yyruËno
==296);

123335 { 
	gyygÙomšÜ
.
	gyy132
 = 0; }

123338 297: 
yy‹¡ÿ£
(
yyruËno
==297);

123339 { 
	gyygÙomšÜ
.
	gyy132
 = 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
; }

123343 
as£¹
Ð
yym¥
[-2].
mšÜ
.
yy473
!=0 );

123344 
	gyym¥
[-2].
	gmšÜ
.
	gyy473
->
	gpLa¡
->
	gpNext
 = 
yym¥
[-1].
mšÜ
.
yy473
;

123345 
	gyym¥
[-2].
	gmšÜ
.
	gyy473
->
	gpLa¡
 = 
yym¥
[-1].
mšÜ
.
yy473
;

123346 
	gyygÙomšÜ
.
	gyy473
 = 
yym¥
[-2].
mšÜ
.
yy473
;

123351 
as£¹
Ð
yym¥
[-1].
mšÜ
.
yy473
!=0 );

123352 
	gyym¥
[-1].
	gmšÜ
.
	gyy473
->
	gpLa¡
 = 
yym¥
[-1].
mšÜ
.
yy473
;

123353 
	gyygÙomšÜ
.
	gyy473
 = 
yym¥
[-1].
mšÜ
.
yy473
;

123358 
yygÙomšÜ
.
yy0
 = 
yym¥
[0].
mšÜ
.yy0;

123359 
sql™e3E¼ÜMsg
(
pP¬£
,

123366 
sql™e3E¼ÜMsg
(
pP¬£
,

123373 
sql™e3E¼ÜMsg
(
pP¬£
,

123379 { 
yygÙomšÜ
.
yy473
 = 
sql™e3Trigg”Upd©eS‹p
(
pP¬£
->
db
, &
yym¥
[-4].
mšÜ
.
yy0
, yym¥[-1].mšÜ.
yy14
, yym¥[0].mšÜ.
yy132
, yym¥[-5].mšÜ.
yy186
); }

123382 {
yygÙomšÜ
.
yy473
 = 
sql™e3Trigg”In£¹S‹p
(
pP¬£
->
db
, &
yym¥
[-2].
mšÜ
.
yy0
, yym¥[-1].mšÜ.
yy408
, yym¥[0].mšÜ.
yy3
, yym¥[-4].mšÜ.
yy186
);}

123385 {
yygÙomšÜ
.
yy473
 = 
sql™e3Trigg”D–‘eS‹p
(
pP¬£
->
db
, &
yym¥
[-2].
mšÜ
.
yy0
, yym¥[0].mšÜ.
yy132
);}

123388 {
yygÙomšÜ
.
yy473
 = 
sql™e3Trigg”S–eùS‹p
(
pP¬£
->
db
, 
yym¥
[0].
mšÜ
.
yy3
); }

123392 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_RAISE
, 0, 0, 0);

123393 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ){

123394 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gaffš™y
 = 
OE_IgnÜe
;

123396 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-3].
mšÜ
.
yy0
.
z
;

123397 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123402 
yygÙomšÜ
.
yy346
.
pEx´
 = 
sql™e3PEx´
(
pP¬£
, 
TK_RAISE
, 0, 0, &
yym¥
[-1].
mšÜ
.
yy0
);

123403 ifÐ
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
 ) {

123404 
	gyygÙomšÜ
.
	gyy346
.
	gpEx´
->
	gaffš™y
 = ()
yym¥
[-3].
mšÜ
.
yy328
;

123406 
	gyygÙomšÜ
.
	gyy346
.
	gzS¹
 = 
yym¥
[-5].
mšÜ
.
yy0
.
z
;

123407 
	gyygÙomšÜ
.
	gyy346
.
	gzEnd
 = &
yym¥
[0].
mšÜ
.
yy0
.
z
[yym¥[0].mšÜ.yy0.
n
];

123411 {
yygÙomšÜ
.
yy328
 = 
OE_RÞlback
;}

123414 {
yygÙomšÜ
.
yy328
 = 
OE_Faž
;}

123418 
sql™e3DrÝTrigg”
(
pP¬£
,
yym¥
[0].
mšÜ
.
yy65
,yym¥[-1].mšÜ.
yy328
);

123423 
sql™e3A‰ach
(
pP¬£
, 
yym¥
[-3].
mšÜ
.
yy346
.
pEx´
, yym¥[-1].mšÜ.yy346.pEx´, yym¥[0].mšÜ.
yy132
);

123428 
sql™e3D‘ach
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy346
.
pEx´
);

123432 {
sql™e3Rešdex
(
pP¬£
, 0, 0);}

123435 {
sql™e3Rešdex
(
pP¬£
, &
yym¥
[-1].
mšÜ
.
yy0
, &yymsp[0].minor.yy0);}

123438 {
sql™e3AÇlyze
(
pP¬£
, 0, 0);}

123441 {
sql™e3AÇlyze
(
pP¬£
, &
yym¥
[-1].
mšÜ
.
yy0
, &yymsp[0].minor.yy0);}

123445 
sql™e3AÉ”R’ameTabË
(
pP¬£
,
yym¥
[-3].
mšÜ
.
yy65
,&yym¥[0].mšÜ.
yy0
);

123450 
sql™e3AÉ”FšishAddCÞumn
(
pP¬£
, &
yym¥
[0].
mšÜ
.
yy0
);

123455 
pP¬£
->
db
->
lookaside
.
bEÇbËd
 = 0;

123456 
sql™e3AÉ”BegšAddCÞumn
(
pP¬£
, 
yym¥
[0].
mšÜ
.
yy65
);

123460 {
sql™e3VbFšishP¬£
(
pP¬£
,0);}

123463 {
sql™e3VbFšishP¬£
(
pP¬£
,&
yym¥
[0].
mšÜ
.
yy0
);}

123467 
sql™e3VbBegšP¬£
(
pP¬£
, &
yym¥
[-3].
mšÜ
.
yy0
, &yym¥[-2].mšÜ.yy0, &yym¥[0].mšÜ.yy0, yym¥[-4].mšÜ.
yy328
);

123471 {
sql™e3VbArgIn™
(
pP¬£
);}

123474 317: 
yy‹¡ÿ£
(
yyruËno
==317);

123475 318: 
yy‹¡ÿ£
(
yyruËno
==318);

123476 {
sql™e3VbArgEx‹nd
(
pP¬£
,&
yym¥
[0].
mšÜ
.
yy0
);}

123479 {
yygÙomšÜ
.
yy59
 = 0;}

123482 324: 
yy‹¡ÿ£
(
yyruËno
==324);

123483 { 
	gyygÙomšÜ
.
	gyy59
 = 
yym¥
[0].
mšÜ
.
yy59
; }

123487 
yygÙomšÜ
.
yy59
 = 
sql™e3W™hAdd
(
pP¬£
, 0, &
yym¥
[-5].
mšÜ
.
yy0
, yym¥[-4].mšÜ.
yy14
, yym¥[-1].mšÜ.
yy3
);

123492 
yygÙomšÜ
.
yy59
 = 
sql™e3W™hAdd
(
pP¬£
, 
yym¥
[-7].
mšÜ
.yy59, &yym¥[-5].mšÜ.
yy0
, yym¥[-4].mšÜ.
yy14
, yym¥[-1].mšÜ.
yy3
);

123496  
yy‹¡ÿ£
(
yyruËno
==0);

123497  
yy‹¡ÿ£
(
yyruËno
==1);

123498  
yy‹¡ÿ£
(
yyruËno
==2);

123499  
yy‹¡ÿ£
(
yyruËno
==3);

123500  
yy‹¡ÿ£
(
yyruËno
==4);

123501  
yy‹¡ÿ£
(
yyruËno
==10);

123502  
yy‹¡ÿ£
(
yyruËno
==11);

123503  
yy‹¡ÿ£
(
yyruËno
==12);

123504  
yy‹¡ÿ£
(
yyruËno
==20);

123505  
yy‹¡ÿ£
(
yyruËno
==21);

123506  
yy‹¡ÿ£
(
yyruËno
==25);

123507  
yy‹¡ÿ£
(
yyruËno
==36);

123508  
yy‹¡ÿ£
(
yyruËno
==37);

123509  
yy‹¡ÿ£
(
yyruËno
==43);

123510  
yy‹¡ÿ£
(
yyruËno
==50);

123511  
yy‹¡ÿ£
(
yyruËno
==51);

123512  
yy‹¡ÿ£
(
yyruËno
==52);

123513  
yy‹¡ÿ£
(
yyruËno
==53);

123514  
yy‹¡ÿ£
(
yyruËno
==60);

123515  
yy‹¡ÿ£
(
yyruËno
==88);

123516  
yy‹¡ÿ£
(
yyruËno
==89);

123517  
yy‹¡ÿ£
(
yyruËno
==91);

123518  
yy‹¡ÿ£
(
yyruËno
==273);

123519  
yy‹¡ÿ£
(
yyruËno
==274);

123520  
yy‹¡ÿ£
(
yyruËno
==281);

123521  
yy‹¡ÿ£
(
yyruËno
==298);

123522  
yy‹¡ÿ£
(
yyruËno
==299);

123523  
yy‹¡ÿ£
(
yyruËno
==307);

123524  
yy‹¡ÿ£
(
yyruËno
==308);

123525  
yy‹¡ÿ£
(
yyruËno
==312);

123526  
yy‹¡ÿ£
(
yyruËno
==313);

123527  
yy‹¡ÿ£
(
yyruËno
==315);

123528  
yy‹¡ÿ£
(
yyruËno
==319);

123529  
yy‹¡ÿ£
(
yyruËno
==320);

123530  
yy‹¡ÿ£
(
yyruËno
==321);

123533 
as£¹
Ð
yyruËno
>=0 && yyruËno<(
yyRuËInfo
)/(yyRuleInfo[0]) );

123534 
	gyygÙo
 = 
yyRuËInfo
[
yyruËno
].
lhs
;

123535 
	gyysize
 = 
yyRuËInfo
[
yyruËno
].
Ähs
;

123536 
	gyypP¬£r
->
	gyyidx
 -ð
yysize
;

123537 
	gyyaù
 = 
yy_fšd_»duû_aùiÚ
(
yym¥
[-
yysize
].
¡©’o
,(
YYCODETYPE
)
yygÙo
);

123538 ifÐ
	gyyaù
 < 
	gYYNSTATE
 ){

123539 #ifdeà
NDEBUG


123544 ifÐ
	gyysize
 ){

123545 
	gyypP¬£r
->
	gyyidx
++;

123546 
	gyym¥
 -ð
yysize
-1;

123547 
	gyym¥
->
	g¡©’o
 = (
YYACTIONTYPE
)
yyaù
;

123548 
	gyym¥
->
	gmajÜ
 = (
YYCODETYPE
)
yygÙo
;

123549 
	gyym¥
->
	gmšÜ
 = 
yygÙomšÜ
;

123553 
yy_shiá
(
yypP¬£r
,
yyaù
,
yygÙo
,&
yygÙomšÜ
);

123556 
as£¹
Ð
yyaù
 =ð
YYNSTATE
 + 
YYNRULE
 + 1 );

123557 
yy_acû±
(
yypP¬£r
);

123564 #iâdeà
YYNOERRORRECOVERY


123565 
yy_·r£_çžed
(

123566 
yyP¬£r
 *
yypP¬£r


123568 
	gsql™e3P¬£rARG_FETCH
;

123569 #iâdeà
NDEBUG


123570 ifÐ
	gyyT¿ûFILE
 ){

123571 
årštf
(
yyT¿ûFILE
,"%sFaž!\n",
yyT¿ûProm±
);

123574  
	gyypP¬£r
->
	gyyidx
>=0 ) 
yy_pÝ_·r£r_¡ack
(
yypP¬£r
);

123577 
	gsql™e3P¬£rARG_STORE
;

123584 
yy_syÁax_”rÜ
(

123585 
yyP¬£r
 *
yypP¬£r
,

123586 
yymajÜ
,

123587 
YYMINORTYPE
 
yymšÜ


123589 
	gsql™e3P¬£rARG_FETCH
;

123590 
	#TOKEN
 (
yymšÜ
.
yy0
)

	)

123592 
UNUSED_PARAMETER
(
yymajÜ
);

123593 
as£¹
Ð
TOKEN
.
z
[0] );

123594 
sql™e3E¼ÜMsg
(
pP¬£
, "Ã¬ \"%T\": syÁaxƒ¼Ü", &
TOKEN
);

123595 
	gsql™e3P¬£rARG_STORE
;

123601 
yy_acû±
(

123602 
yyP¬£r
 *
yypP¬£r


123604 
	gsql™e3P¬£rARG_FETCH
;

123605 #iâdeà
NDEBUG


123606 ifÐ
	gyyT¿ûFILE
 ){

123607 
årštf
(
yyT¿ûFILE
,"%sAcû±!\n",
yyT¿ûProm±
);

123610  
	gyypP¬£r
->
	gyyidx
>=0 ) 
yy_pÝ_·r£r_¡ack
(
yypP¬£r
);

123613 
	gsql™e3P¬£rARG_STORE
;

123635 
SQLITE_PRIVATE
 
sql™e3P¬£r
(

123636 *
yyp
,

123637 
yymajÜ
,

123638 
sql™e3P¬£rTOKENTYPE
 
yymšÜ


123639 
sql™e3P¬£rARG_PDECL


123641 
YYMINORTYPE
 
	gyymšÜuniÚ
;

123642 
	gyyaù
;

123643 #ià!
defšed
(
YYERRORSYMBOL
è&& !defšed(
YYNOERRORRECOVERY
)

123644 
	gyy’dofšput
;

123646 #ifdeà
YYERRORSYMBOL


123647 
	gyy”rÜh™
 = 0;

123649 
yyP¬£r
 *
	gyypP¬£r
;

123652 
	gyypP¬£r
 = (
yyP¬£r
*)
yyp
;

123653 ifÐ
	gyypP¬£r
->
	gyyidx
<0 ){

123654 #ià
YYSTACKDEPTH
<=0

123655 ifÐ
	gyypP¬£r
->
	gyy¡ksz
 <=0 ){

123657 
yymšÜuniÚ
 = 
yyz”omšÜ
;

123658 
yySckOv”æow
(
yypP¬£r
, &
yymšÜuniÚ
);

123662 
	gyypP¬£r
->
	gyyidx
 = 0;

123663 
	gyypP¬£r
->
	gyy”rút
 = -1;

123664 
	gyypP¬£r
->
	gyy¡ack
[0].
	g¡©’o
 = 0;

123665 
	gyypP¬£r
->
	gyy¡ack
[0].
	gmajÜ
 = 0;

123667 
	gyymšÜuniÚ
.
	gyy0
 = 
yymšÜ
;

123668 #ià!
defšed
(
YYERRORSYMBOL
è&& !defšed(
YYNOERRORRECOVERY
)

123669 
	gyy’dofšput
 = (
yymajÜ
==0);

123671 
	gsql™e3P¬£rARG_STORE
;

123673 #iâdeà
NDEBUG


123674 ifÐ
	gyyT¿ûFILE
 ){

123675 
årštf
(
yyT¿ûFILE
,"%sIÅuˆ%s\n",
yyT¿ûProm±
,
yyTok’Name
[
yymajÜ
]);

123680 
	gyyaù
 = 
yy_fšd_shiá_aùiÚ
(
yypP¬£r
,(
YYCODETYPE
)
yymajÜ
);

123681 ifÐ
	gyyaù
<
	gYYNSTATE
 ){

123682 
yy_shiá
(
yypP¬£r
,
yyaù
,
yymajÜ
,&
yymšÜuniÚ
);

123683 
	gyypP¬£r
->
	gyy”rút
--;

123684 
	gyymajÜ
 = 
YYNOCODE
;

123685 }ifÐ
	gyyaù
 < 
	gYYNSTATE
 + 
	gYYNRULE
 ){

123686 
yy_»duû
(
yypP¬£r
,
yyaù
-
YYNSTATE
);

123688 
as£¹
Ð
yyaù
 =ð
YY_ERROR_ACTION
 );

123689 #ifdeà
YYERRORSYMBOL


123690 
	gyymx
;

123692 #iâdeà
NDEBUG


123693 ifÐ
	gyyT¿ûFILE
 ){

123694 
årštf
(
yyT¿ûFILE
,"%sSyÁax E¼Ü!\n",
yyT¿ûProm±
);

123697 #ifdeà
YYERRORSYMBOL


123717 ifÐ
	gyypP¬£r
->
	gyy”rút
<0 ){

123718 
yy_syÁax_”rÜ
(
yypP¬£r
,
yymajÜ
,
yymšÜuniÚ
);

123720 
	gyymx
 = 
yypP¬£r
->
yy¡ack
[yypP¬£r->
yyidx
].
majÜ
;

123721 ifÐ
	gyymx
==
YYERRORSYMBOL
 || 
yy”rÜh™
 ){

123722 #iâdeà
NDEBUG


123723 ifÐ
yyT¿ûFILE
 ){

123724 
årštf
(
yyT¿ûFILE
,"%sDiscard inputoken %s\n",

123725 
yyT¿ûProm±
,
yyTok’Name
[
yymajÜ
]);

123728 
yy_de¡ruùÜ
(
yypP¬£r
, (
YYCODETYPE
)
yymajÜ
,&
yymšÜuniÚ
);

123729 
	gyymajÜ
 = 
YYNOCODE
;

123732 
	gyypP¬£r
->
	gyyidx
 >= 0 &&

123733 
yymx
 !ð
YYERRORSYMBOL
 &&

123734 (
yyaù
 = 
yy_fšd_»duû_aùiÚ
(

123735 
yypP¬£r
->
yy¡ack
[yypP¬£r->
yyidx
].
¡©’o
,

123736 
YYERRORSYMBOL
)è>ð
YYNSTATE


123738 
yy_pÝ_·r£r_¡ack
(
yypP¬£r
);

123740 ifÐ
	gyypP¬£r
->
	gyyidx
 < 0 || 
	gyymajÜ
==0 ){

123741 
yy_de¡ruùÜ
(
yypP¬£r
,(
YYCODETYPE
)
yymajÜ
,&
yymšÜuniÚ
);

123742 
yy_·r£_çžed
(
yypP¬£r
);

123743 
	gyymajÜ
 = 
YYNOCODE
;

123744 }ifÐ
	gyymx
!=
YYERRORSYMBOL
 ){

123745 
YYMINORTYPE
 
u2
;

123746 
	gu2
.
	gYYERRSYMDT
 = 0;

123747 
yy_shiá
(
yypP¬£r
,
yyaù
,
YYERRORSYMBOL
,&
u2
);

123750 
	gyypP¬£r
->
	gyy”rút
 = 3;

123751 
	gyy”rÜh™
 = 1;

123752 #–ià
defšed
(
YYNOERRORRECOVERY
)

123760 
yy_syÁax_”rÜ
(
yypP¬£r
,
yymajÜ
,
yymšÜuniÚ
);

123761 
yy_de¡ruùÜ
(
yypP¬£r
,(
YYCODETYPE
)
yymajÜ
,&
yymšÜuniÚ
);

123762 
	gyymajÜ
 = 
YYNOCODE
;

123774 ifÐ
	gyypP¬£r
->
	gyy”rút
<=0 ){

123775 
yy_syÁax_”rÜ
(
yypP¬£r
,
yymajÜ
,
yymšÜuniÚ
);

123777 
	gyypP¬£r
->
	gyy”rút
 = 3;

123778 
yy_de¡ruùÜ
(
yypP¬£r
,(
YYCODETYPE
)
yymajÜ
,&
yymšÜuniÚ
);

123779 ifÐ
	gyy’dofšput
 ){

123780 
yy_·r£_çžed
(
yypP¬£r
);

123782 
	gyymajÜ
 = 
YYNOCODE
;

123785 } 
	gyymajÜ
!=
YYNOCODE
 && 
yypP¬£r
->
yyidx
>=0 );

123817 #ifdeà
SQLITE_ASCII


123818 
	#ch¬M­
(
X
è
sql™e3Uµ”ToLow”
[()X]

	)

123820 #ifdeà
SQLITE_EBCDIC


123821 
	#ch¬M­
(
X
è
ebcdicToAscii
[()X]

	)

123822 cÚ¡ 
	gebcdicToAscii
[] = {

123870 
keywÜdCode
(cÚ¡ *
z
, 
n
){

123882 cÚ¡ 
	gzText
[553] = {

123915 cÚ¡ 
	gaHash
[127] = {

123927 cÚ¡ 
	gaNext
[124] = {

123939 cÚ¡ 
	gaL’
[124] = {

123951 cÚ¡ 
	gaOff£t
[124] = {

123963 cÚ¡ 
	gaCode
[124] = {

123964 
TK_REINDEX
, 
TK_INDEXED
, 
TK_INDEX
, 
TK_DESC
, 
TK_ESCAPE
,

123965 
TK_EACH
, 
TK_CHECK
, 
TK_KEY
, 
TK_BEFORE
, 
TK_FOREIGN
,

123966 
TK_FOR
, 
TK_IGNORE
, 
TK_LIKE_KW
, 
TK_EXPLAIN
, 
TK_INSTEAD
,

123967 
TK_ADD
, 
TK_DATABASE
, 
TK_AS
, 
TK_SELECT
, 
TK_TABLE
,

123968 
TK_JOIN_KW
, 
TK_THEN
, 
TK_END
, 
TK_DEFERRABLE
, 
TK_ELSE
,

123969 
TK_EXCEPT
, 
TK_TRANSACTION
,
TK_ACTION
, 
TK_ON
, 
TK_JOIN_KW
,

123970 
TK_ALTER
, 
TK_RAISE
, 
TK_EXCLUSIVE
, 
TK_EXISTS
, 
TK_SAVEPOINT
,

123971 
TK_INTERSECT
, 
TK_TRIGGER
, 
TK_REFERENCES
, 
TK_CONSTRAINT
, 
TK_INTO
,

123972 
TK_OFFSET
, 
TK_OF
, 
TK_SET
, 
TK_TEMP
, TK_TEMP,

123973 
TK_OR
, 
TK_UNIQUE
, 
TK_QUERY
, 
TK_WITHOUT
, 
TK_WITH
,

123974 
TK_JOIN_KW
, 
TK_RELEASE
, 
TK_ATTACH
, 
TK_HAVING
, 
TK_GROUP
,

123975 
TK_UPDATE
, 
TK_BEGIN
, 
TK_JOIN_KW
, 
TK_RECURSIVE
, 
TK_BETWEEN
,

123976 
TK_NOTNULL
, 
TK_NOT
, 
TK_NO
, 
TK_NULL
, 
TK_LIKE_KW
,

123977 
TK_CASCADE
, 
TK_ASC
, 
TK_DELETE
, 
TK_CASE
, 
TK_COLLATE
,

123978 
TK_CREATE
, 
TK_CTIME_KW
, 
TK_DETACH
, 
TK_IMMEDIATE
, 
TK_JOIN
,

123979 
TK_INSERT
, 
TK_MATCH
, 
TK_PLAN
, 
TK_ANALYZE
, 
TK_PRAGMA
,

123980 
TK_ABORT
, 
TK_VALUES
, 
TK_VIRTUAL
, 
TK_LIMIT
, 
TK_WHEN
,

123981 
TK_WHERE
, 
TK_RENAME
, 
TK_AFTER
, 
TK_REPLACE
, 
TK_AND
,

123982 
TK_DEFAULT
, 
TK_AUTOINCR
, 
TK_TO
, 
TK_IN
, 
TK_CAST
,

123983 
TK_COLUMNKW
, 
TK_COMMIT
, 
TK_CONFLICT
, 
TK_JOIN_KW
, 
TK_CTIME_KW
,

123984 
TK_CTIME_KW
, 
TK_PRIMARY
, 
TK_DEFERRED
, 
TK_DISTINCT
, 
TK_IS
,

123985 
TK_DROP
, 
TK_FAIL
, 
TK_FROM
, 
TK_JOIN_KW
, 
TK_LIKE_KW
,

123986 
TK_BY
, 
TK_IF
, 
TK_ISNULL
, 
TK_ORDER
, 
TK_RESTRICT
,

123987 
TK_JOIN_KW
, 
TK_ROLLBACK
, 
TK_ROW
, 
TK_UNION
, 
TK_USING
,

123988 
TK_VACUUM
, 
TK_VIEW
, 
TK_INITIALLY
, 
TK_ALL
,

123990 
	gh
, 
	gi
;

123991 ifÐ
	gn
<2 )  
	gTK_ID
;

123992 
	gh
 = ((
ch¬M­
(
z
[0])*4) ^

123993 (
ch¬M­
(
z
[
n
-1])*3) ^

123994 
n
) % 127;

123995 
	gi
=(()
aHash
[
h
])-1; i>=0; i=(()
aNext
[
i
])-1){

123996 ifÐ
aL’
[
i
]==
n
 && 
sql™e3SŒNICmp
(&
zText
[
aOff£t
[i]],
z
,n)==0 ){

123997 
‹¡ÿ£
Ð
i
==0 );

123998 
‹¡ÿ£
Ð
i
==1 );

123999 
‹¡ÿ£
Ð
i
==2 );

124000 
‹¡ÿ£
Ð
i
==3 );

124001 
‹¡ÿ£
Ð
i
==4 );

124002 
‹¡ÿ£
Ð
i
==5 );

124003 
‹¡ÿ£
Ð
i
==6 );

124004 
‹¡ÿ£
Ð
i
==7 );

124005 
‹¡ÿ£
Ð
i
==8 );

124006 
‹¡ÿ£
Ð
i
==9 );

124007 
‹¡ÿ£
Ð
i
==10 );

124008 
‹¡ÿ£
Ð
i
==11 );

124009 
‹¡ÿ£
Ð
i
==12 );

124010 
‹¡ÿ£
Ð
i
==13 );

124011 
‹¡ÿ£
Ð
i
==14 );

124012 
‹¡ÿ£
Ð
i
==15 );

124013 
‹¡ÿ£
Ð
i
==16 );

124014 
‹¡ÿ£
Ð
i
==17 );

124015 
‹¡ÿ£
Ð
i
==18 );

124016 
‹¡ÿ£
Ð
i
==19 );

124017 
‹¡ÿ£
Ð
i
==20 );

124018 
‹¡ÿ£
Ð
i
==21 );

124019 
‹¡ÿ£
Ð
i
==22 );

124020 
‹¡ÿ£
Ð
i
==23 );

124021 
‹¡ÿ£
Ð
i
==24 );

124022 
‹¡ÿ£
Ð
i
==25 );

124023 
‹¡ÿ£
Ð
i
==26 );

124024 
‹¡ÿ£
Ð
i
==27 );

124025 
‹¡ÿ£
Ð
i
==28 );

124026 
‹¡ÿ£
Ð
i
==29 );

124027 
‹¡ÿ£
Ð
i
==30 );

124028 
‹¡ÿ£
Ð
i
==31 );

124029 
‹¡ÿ£
Ð
i
==32 );

124030 
‹¡ÿ£
Ð
i
==33 );

124031 
‹¡ÿ£
Ð
i
==34 );

124032 
‹¡ÿ£
Ð
i
==35 );

124033 
‹¡ÿ£
Ð
i
==36 );

124034 
‹¡ÿ£
Ð
i
==37 );

124035 
‹¡ÿ£
Ð
i
==38 );

124036 
‹¡ÿ£
Ð
i
==39 );

124037 
‹¡ÿ£
Ð
i
==40 );

124038 
‹¡ÿ£
Ð
i
==41 );

124039 
‹¡ÿ£
Ð
i
==42 );

124040 
‹¡ÿ£
Ð
i
==43 );

124041 
‹¡ÿ£
Ð
i
==44 );

124042 
‹¡ÿ£
Ð
i
==45 );

124043 
‹¡ÿ£
Ð
i
==46 );

124044 
‹¡ÿ£
Ð
i
==47 );

124045 
‹¡ÿ£
Ð
i
==48 );

124046 
‹¡ÿ£
Ð
i
==49 );

124047 
‹¡ÿ£
Ð
i
==50 );

124048 
‹¡ÿ£
Ð
i
==51 );

124049 
‹¡ÿ£
Ð
i
==52 );

124050 
‹¡ÿ£
Ð
i
==53 );

124051 
‹¡ÿ£
Ð
i
==54 );

124052 
‹¡ÿ£
Ð
i
==55 );

124053 
‹¡ÿ£
Ð
i
==56 );

124054 
‹¡ÿ£
Ð
i
==57 );

124055 
‹¡ÿ£
Ð
i
==58 );

124056 
‹¡ÿ£
Ð
i
==59 );

124057 
‹¡ÿ£
Ð
i
==60 );

124058 
‹¡ÿ£
Ð
i
==61 );

124059 
‹¡ÿ£
Ð
i
==62 );

124060 
‹¡ÿ£
Ð
i
==63 );

124061 
‹¡ÿ£
Ð
i
==64 );

124062 
‹¡ÿ£
Ð
i
==65 );

124063 
‹¡ÿ£
Ð
i
==66 );

124064 
‹¡ÿ£
Ð
i
==67 );

124065 
‹¡ÿ£
Ð
i
==68 );

124066 
‹¡ÿ£
Ð
i
==69 );

124067 
‹¡ÿ£
Ð
i
==70 );

124068 
‹¡ÿ£
Ð
i
==71 );

124069 
‹¡ÿ£
Ð
i
==72 );

124070 
‹¡ÿ£
Ð
i
==73 );

124071 
‹¡ÿ£
Ð
i
==74 );

124072 
‹¡ÿ£
Ð
i
==75 );

124073 
‹¡ÿ£
Ð
i
==76 );

124074 
‹¡ÿ£
Ð
i
==77 );

124075 
‹¡ÿ£
Ð
i
==78 );

124076 
‹¡ÿ£
Ð
i
==79 );

124077 
‹¡ÿ£
Ð
i
==80 );

124078 
‹¡ÿ£
Ð
i
==81 );

124079 
‹¡ÿ£
Ð
i
==82 );

124080 
‹¡ÿ£
Ð
i
==83 );

124081 
‹¡ÿ£
Ð
i
==84 );

124082 
‹¡ÿ£
Ð
i
==85 );

124083 
‹¡ÿ£
Ð
i
==86 );

124084 
‹¡ÿ£
Ð
i
==87 );

124085 
‹¡ÿ£
Ð
i
==88 );

124086 
‹¡ÿ£
Ð
i
==89 );

124087 
‹¡ÿ£
Ð
i
==90 );

124088 
‹¡ÿ£
Ð
i
==91 );

124089 
‹¡ÿ£
Ð
i
==92 );

124090 
‹¡ÿ£
Ð
i
==93 );

124091 
‹¡ÿ£
Ð
i
==94 );

124092 
‹¡ÿ£
Ð
i
==95 );

124093 
‹¡ÿ£
Ð
i
==96 );

124094 
‹¡ÿ£
Ð
i
==97 );

124095 
‹¡ÿ£
Ð
i
==98 );

124096 
‹¡ÿ£
Ð
i
==99 );

124097 
‹¡ÿ£
Ð
i
==100 );

124098 
‹¡ÿ£
Ð
i
==101 );

124099 
‹¡ÿ£
Ð
i
==102 );

124100 
‹¡ÿ£
Ð
i
==103 );

124101 
‹¡ÿ£
Ð
i
==104 );

124102 
‹¡ÿ£
Ð
i
==105 );

124103 
‹¡ÿ£
Ð
i
==106 );

124104 
‹¡ÿ£
Ð
i
==107 );

124105 
‹¡ÿ£
Ð
i
==108 );

124106 
‹¡ÿ£
Ð
i
==109 );

124107 
‹¡ÿ£
Ð
i
==110 );

124108 
‹¡ÿ£
Ð
i
==111 );

124109 
‹¡ÿ£
Ð
i
==112 );

124110 
‹¡ÿ£
Ð
i
==113 );

124111 
‹¡ÿ£
Ð
i
==114 );

124112 
‹¡ÿ£
Ð
i
==115 );

124113 
‹¡ÿ£
Ð
i
==116 );

124114 
‹¡ÿ£
Ð
i
==117 );

124115 
‹¡ÿ£
Ð
i
==118 );

124116 
‹¡ÿ£
Ð
i
==119 );

124117 
‹¡ÿ£
Ð
i
==120 );

124118 
‹¡ÿ£
Ð
i
==121 );

124119 
‹¡ÿ£
Ð
i
==122 );

124120 
‹¡ÿ£
Ð
i
==123 );

124121  
	gaCode
[
i
];

124124  
	gTK_ID
;

124126 
SQLITE_PRIVATE
 
sql™e3KeywÜdCode
(cÚ¡ *
z
, 
n
){

124127  
keywÜdCode
((*)
z
, 
n
);

124129 
	#SQLITE_N_KEYWORD
 124

	)

124151 #ifdeà
SQLITE_ASCII


124152 
	#IdCh¬
(
C
è((
sql™e3Cty³M­
[()C]&0x46)!=0)

	)

124154 #ifdeà
SQLITE_EBCDIC


124155 
SQLITE_PRIVATE
 cÚ¡ 
	gsql™e3IsEbcdicIdCh¬
[] = {

124170 
	#IdCh¬
(
C
è(((
c
=C)>=0x42 && 
sql™e3IsEbcdicIdCh¬
[c-0x40]))

	)

124172 
SQLITE_PRIVATE
 
sql™e3IsIdCh¬
(
u8
 
c
){  
IdCh¬
(c); }

124179 
SQLITE_PRIVATE
 
sql™e3G‘Tok’
(cÚ¡ *
z
, *
tok’Ty³
){

124180 
	gi
, 
	gc
;

124181  *
	gz
 ){

124183 
‹¡ÿ£
Ð
z
[0]==' ' );

124184 
‹¡ÿ£
Ð
z
[0]=='\t' );

124185 
‹¡ÿ£
Ð
z
[0]=='\n' );

124186 
‹¡ÿ£
Ð
z
[0]=='\f' );

124187 
‹¡ÿ£
Ð
z
[0]=='\r' );

124188 
	gi
=1; 
sql™e3Is¥aû
(
z
[
i
]); i++){}

124189 *
	gtok’Ty³
 = 
TK_SPACE
;

124190  
	gi
;

124193 ifÐ
z
[1]=='-' ){

124194 
i
=2; (
	gc
=
z
[i])!=0 && 
c
!='\n'; 
	gi
++){}

124195 *
	gtok’Ty³
 = 
TK_SPACE
;

124196  
	gi
;

124198 *
	gtok’Ty³
 = 
TK_MINUS
;

124202 *
tok’Ty³
 = 
TK_LP
;

124206 *
tok’Ty³
 = 
TK_RP
;

124210 *
tok’Ty³
 = 
TK_SEMI
;

124214 *
tok’Ty³
 = 
TK_PLUS
;

124218 *
tok’Ty³
 = 
TK_STAR
;

124222 ifÐ
z
[1]!='*' || z[2]==0 ){

124223 *
tok’Ty³
 = 
TK_SLASH
;

124226 
	gi
=3, 
	gc
=
z
[2]; (c!='*' || z[
i
]!='/'è&& (
c
=z[i])!=0; i++){}

124227 ifÐ
	gc
 ) 
	gi
++;

124228 *
	gtok’Ty³
 = 
TK_SPACE
;

124229  
	gi
;

124232 *
tok’Ty³
 = 
TK_REM
;

124236 *
tok’Ty³
 = 
TK_EQ
;

124237  1 + (
	gz
[1]=='=');

124240 ifÐ(
c
=
z
[1])=='=' ){

124241 *
tok’Ty³
 = 
TK_LE
;

124243 }ifÐ
	gc
=='>' ){

124244 *
tok’Ty³
 = 
TK_NE
;

124246 }ifÐ
	gc
=='<' ){

124247 *
tok’Ty³
 = 
TK_LSHIFT
;

124250 *
	gtok’Ty³
 = 
TK_LT
;

124255 ifÐ(
c
=
z
[1])=='=' ){

124256 *
tok’Ty³
 = 
TK_GE
;

124258 }ifÐ
	gc
=='>' ){

124259 *
tok’Ty³
 = 
TK_RSHIFT
;

124262 *
	gtok’Ty³
 = 
TK_GT
;

124267 ifÐ
z
[1]!='=' ){

124268 *
tok’Ty³
 = 
TK_ILLEGAL
;

124271 *
	gtok’Ty³
 = 
TK_NE
;

124276 ifÐ
z
[1]!='|' ){

124277 *
tok’Ty³
 = 
TK_BITOR
;

124280 *
	gtok’Ty³
 = 
TK_CONCAT
;

124285 *
tok’Ty³
 = 
TK_COMMA
;

124289 *
tok’Ty³
 = 
TK_BITAND
;

124293 *
tok’Ty³
 = 
TK_BITNOT
;

124299 
d–im
 = 
z
[0];

124300 
‹¡ÿ£
Ð
d–im
=='`' );

124301 
‹¡ÿ£
Ð
d–im
=='\'' );

124302 
‹¡ÿ£
Ð
d–im
=='"' );

124303 
	gi
=1; (
	gc
=
z
[
i
])!=0; i++){

124304 ifÐ
	gc
==
d–im
 ){

124305 ifÐ
z
[
i
+1]==
d–im
 ){

124306 
i
++;

124312 ifÐ
	gc
=='\'' ){

124313 *
tok’Ty³
 = 
TK_STRING
;

124314  
	gi
+1;

124315 }ifÐ
	gc
!=0 ){

124316 *
tok’Ty³
 = 
TK_ID
;

124317  
	gi
+1;

124319 *
	gtok’Ty³
 = 
TK_ILLEGAL
;

124320  
	gi
;

124324 #iâdeà
SQLITE_OMIT_FLOATING_POINT


124325 ifÐ!
sql™e3Isdig™
(
z
[1]) )

124328 *
tok’Ty³
 = 
TK_DOT
;

124336 
‹¡ÿ£
Ð
z
[0]=='0' );estcase( z[0]=='1' );estcase( z[0]=='2' );

124337 
‹¡ÿ£
Ð
z
[0]=='3' );estcase( z[0]=='4' );estcase( z[0]=='5' );

124338 
‹¡ÿ£
Ð
z
[0]=='6' );estcase( z[0]=='7' );estcase( z[0]=='8' );

124339 
‹¡ÿ£
Ð
z
[0]=='9' );

124340 *
	gtok’Ty³
 = 
TK_INTEGER
;

124341 #iâdeà
SQLITE_OMIT_HEX_INTEGER


124342 ifÐ
	gz
[0]=='0' && (
z
[1]=='x' || z[1]=='X'è&& 
sql™e3Isxdig™
(z[2]) ){

124343 
i
=3; 
sql™e3Isxdig™
(
z
[i]); 
	gi
++){}

124344  
	gi
;

124347 
	gi
=0; 
sql™e3Isdig™
(
z
[
i
]); i++){}

124348 #iâdeà
SQLITE_OMIT_FLOATING_POINT


124349 ifÐ
	gz
[
i
]=='.' ){

124350 
i
++;

124351  
sql™e3Isdig™
(
z
[
i
]è){ 
	gi
++; }

124352 *
	gtok’Ty³
 = 
TK_FLOAT
;

124354 ifÐ(
	gz
[
i
]=='e' || 
z
[i]=='E') &&

124355 Ð
sql™e3Isdig™
(
z
[
i
+1])

124356 || ((
z
[
i
+1]=='+' || z[i+1]=='-'è&& 
sql™e3Isdig™
(z[i+2]))

124359 
i
 += 2;

124360  
sql™e3Isdig™
(
z
[
i
]è){ 
	gi
++; }

124361 *
	gtok’Ty³
 = 
TK_FLOAT
;

124364  
IdCh¬
(
z
[
i
]) ){

124365 *
	gtok’Ty³
 = 
TK_ILLEGAL
;

124366 
	gi
++;

124368  
	gi
;

124371 
i
=1, 
	gc
=
z
[0]; c!=']' && (
c
=z[i])!=0; 
	gi
++){}

124372 *
	gtok’Ty³
 = 
c
==']' ? 
TK_ID
 : 
TK_ILLEGAL
;

124373  
	gi
;

124376 *
tok’Ty³
 = 
TK_VARIABLE
;

124377 
	gi
=1; 
sql™e3Isdig™
(
z
[
i
]); i++){}

124378  
	gi
;

124380 #iâdeà
SQLITE_OMIT_TCL_VARIABLE


124386 
n
 = 0;

124387 
‹¡ÿ£
Ð
z
[0]=='$' );estcase( z[0]=='@' );

124388 
‹¡ÿ£
Ð
z
[0]==':' );estcase( z[0]=='#' );

124389 *
	gtok’Ty³
 = 
TK_VARIABLE
;

124390 
	gi
=1; (
	gc
=
z
[
i
])!=0; i++){

124391 ifÐ
IdCh¬
(
c
) ){

124392 
	gn
++;

124393 #iâdeà
SQLITE_OMIT_TCL_VARIABLE


124394 }ifÐ
	gc
=='(' && 
n
>0 ){

124396 
i
++;

124397 } (
	gc
=
z
[
i
])!=0 && !
sql™e3Is¥aû
(
c
) && c!=')' );

124398 ifÐ
	gc
==')' ){

124399 
i
++;

124401 *
	gtok’Ty³
 = 
TK_ILLEGAL
;

124404 }ifÐ
	gc
==':' && 
z
[
i
+1]==':' ){

124405 
i
++;

124411 ifÐ
	gn
==0 ) *
tok’Ty³
 = 
TK_ILLEGAL
;

124412  
	gi
;

124414 #iâdeà
SQLITE_OMIT_BLOB_LITERAL


124416 
‹¡ÿ£
Ð
z
[0]=='x' );estcase( z[0]=='X' );

124417 ifÐ
	gz
[1]=='\'' ){

124418 *
tok’Ty³
 = 
TK_BLOB
;

124419 
	gi
=2; 
sql™e3Isxdig™
(
z
[
i
]); i++){}

124420 ifÐ
	gz
[
i
]!='\'' || i%2 ){

124421 *
tok’Ty³
 = 
TK_ILLEGAL
;

124422  
	gz
[
i
] && z[i]!='\'' ){ i++; }

124424 ifÐ
	gz
[
i
] ) 
	gi
++;

124425  
	gi
;

124431 ifÐ!
IdCh¬
(*
z
) ){

124434 
	gi
=1; 
IdCh¬
(
z
[
i
]); i++){}

124435 *
	gtok’Ty³
 = 
keywÜdCode
((*)
z
, 
i
);

124436  
	gi
;

124439 *
	gtok’Ty³
 = 
TK_ILLEGAL
;

124450 
SQLITE_PRIVATE
 
sql™e3RunP¬£r
(
P¬£
 *
pP¬£
, cÚ¡ *
zSql
, **
pzE¼Msg
){

124451 
	gnE¼
 = 0;

124452 
	gi
;

124453 *
	gpEngše
;

124454 
	gtok’Ty³
;

124455 
	gÏ¡Tok’P¬£d
 = -1;

124456 
u8
 
	g’abËLookaside
;

124457 
sql™e3
 *
	gdb
 = 
pP¬£
->
db
;

124458 
	gmxSqlL’
;

124461 
	gmxSqlL’
 = 
db
->
aLim™
[
SQLITE_LIMIT_SQL_LENGTH
];

124462 ifÐ
	gdb
->
	gnVdbeAùive
==0 ){

124463 
db
->
u1
.
isIÁ”ru±ed
 = 0;

124465 
	gpP¬£
->
	grc
 = 
SQLITE_OK
;

124466 
	gpP¬£
->
	gzTaž
 = 
zSql
;

124467 
	gi
 = 0;

124468 
as£¹
Ð
pzE¼Msg
!=0 );

124469 
	gpEngše
 = 
sql™e3P¬£rAÎoc
(
sql™e3M®loc
);

124470 ifÐ
	gpEngše
==0 ){

124471 
db
->
m®locFažed
 = 1;

124472  
	gSQLITE_NOMEM
;

124474 
as£¹
Ð
pP¬£
->
pNewTabË
==0 );

124475 
as£¹
Ð
pP¬£
->
pNewTrigg”
==0 );

124476 
as£¹
Ð
pP¬£
->
nV¬
==0 );

124477 
as£¹
Ð
pP¬£
->
nzV¬
==0 );

124478 
as£¹
Ð
pP¬£
->
azV¬
==0 );

124479 
	g’abËLookaside
 = 
db
->
lookaside
.
bEÇbËd
;

124480 ifÐ
	gdb
->
	glookaside
.
	gpS¹
 ) db->lookaside.
	gbEÇbËd
 = 1;

124481  !
	gdb
->
	gm®locFažed
 && 
	gzSql
[
i
]!=0 ){

124482 
as£¹
Ð
i
>=0 );

124483 
	gpP¬£
->
	gsLa¡Tok’
.
	gz
 = &
zSql
[
i
];

124484 
	gpP¬£
->
	gsLa¡Tok’
.
	gn
 = 
sql™e3G‘Tok’
((*)&
zSql
[
i
],&
tok’Ty³
);

124485 
	gi
 +ð
pP¬£
->
sLa¡Tok’
.
n
;

124486 ifÐ
	gi
>
	gmxSqlL’
 ){

124487 
	gpP¬£
->
	grc
 = 
SQLITE_TOOBIG
;

124490  
	gtok’Ty³
 ){

124491 
	gTK_SPACE
: {

124492 ifÐ
db
->
u1
.
isIÁ”ru±ed
 ){

124493 
sql™e3E¼ÜMsg
(
pP¬£
, "interrupt");

124494 
	gpP¬£
->
	grc
 = 
SQLITE_INTERRUPT
;

124495 
	gabÜt_·r£
;

124499 
	gTK_ILLEGAL
: {

124500 
sql™e3DbF»e
(
db
, *
pzE¼Msg
);

124501 *
	gpzE¼Msg
 = 
sql™e3MPrštf
(
db
, "unrecognizedoken: \"%T\"",

124502 &
pP¬£
->
sLa¡Tok’
);

124503 
	gnE¼
++;

124504 
	gabÜt_·r£
;

124506 
	gTK_SEMI
: {

124507 
pP¬£
->
zTaž
 = &
zSql
[
i
];

124511 
sql™e3P¬£r
(
pEngše
, 
tok’Ty³
, 
pP¬£
->
sLa¡Tok’
,…Parse);

124512 
	gÏ¡Tok’P¬£d
 = 
tok’Ty³
;

124513 ifÐ
	gpP¬£
->
	grc
!=
SQLITE_OK
 ){

124514 
abÜt_·r£
;

124520 
	gabÜt_·r£
:

124521 ifÐ
zSql
[
i
]==0 && 
nE¼
==0 && 
pP¬£
->
rc
==
SQLITE_OK
 ){

124522 ifÐ
Ï¡Tok’P¬£d
!=
TK_SEMI
 ){

124523 
sql™e3P¬£r
(
pEngše
, 
TK_SEMI
, 
pP¬£
->
sLa¡Tok’
,…Parse);

124524 
	gpP¬£
->
	gzTaž
 = &
zSql
[
i
];

124526 
sql™e3P¬£r
(
pEngše
, 0, 
pP¬£
->
sLa¡Tok’
,…Parse);

124528 #ifdeà
YYTRACKMAXSTACKDEPTH


124529 
sql™e3StusS‘
(
SQLITE_STATUS_PARSER_STACK
,

124530 
sql™e3P¬£rSckP—k
(
pEngše
)

124533 
sql™e3P¬£rF»e
(
pEngše
, 
sql™e3_ä“
);

124534 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 
’abËLookaside
;

124535 ifÐ
	gdb
->
	gm®locFažed
 ){

124536 
	gpP¬£
->
	grc
 = 
SQLITE_NOMEM
;

124538 ifÐ
	gpP¬£
->
	grc
!=
SQLITE_OK
 && 
pP¬£
->
rc
!=
SQLITE_DONE
 &&…P¬£->
zE¼Msg
==0 ){

124539 
sql™e3S‘SŒšg
(&
pP¬£
->
zE¼Msg
, 
db
, "%s", 
sql™e3E¼SŒ
ÕP¬£->
rc
));

124541 
as£¹
Ð
pzE¼Msg
!=0 );

124542 ifÐ
	gpP¬£
->
	gzE¼Msg
 ){

124543 *
	gpzE¼Msg
 = 
pP¬£
->
zE¼Msg
;

124544 
sql™e3_log
(
pP¬£
->
rc
, "%s", *
pzE¼Msg
);

124545 
	gpP¬£
->
	gzE¼Msg
 = 0;

124546 
	gnE¼
++;

124548 ifÐ
	gpP¬£
->
	gpVdbe
 &&…P¬£->
	gnE¼
>0 &&…P¬£->
	gÃ¡ed
==0 ){

124549 
sql™e3VdbeD–‘e
(
pP¬£
->
pVdbe
);

124550 
	gpP¬£
->
	gpVdbe
 = 0;

124552 #iâdeà
SQLITE_OMIT_SHARED_CACHE


124553 ifÐ
	gpP¬£
->
	gÃ¡ed
==0 ){

124554 
sql™e3DbF»e
(
db
, 
pP¬£
->
aTabËLock
);

124555 
	gpP¬£
->
	gaTabËLock
 = 0;

124556 
	gpP¬£
->
	gnTabËLock
 = 0;

124559 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


124560 
sql™e3_ä“
(
pP¬£
->
­VbLock
);

124563 ifÐ!
	gIN_DECLARE_VTAB
 ){

124568 
sql™e3D–‘eTabË
(
db
, 
pP¬£
->
pNewTabË
);

124571 ifÐ
	gpP¬£
->
	gbF»eW™h
 ) 
sql™e3W™hD–‘e
(
db
, 
pP¬£
->
pW™h
);

124572 
sql™e3D–‘eTrigg”
(
db
, 
pP¬£
->
pNewTrigg”
);

124573 
	gi
=
pP¬£
->
nzV¬
-1; i>=0; i--è
sql™e3DbF»e
(
db
,…P¬£->
azV¬
[
i
]);

124574 
sql™e3DbF»e
(
db
, 
pP¬£
->
azV¬
);

124575  
	gpP¬£
->
	gpAšc
 ){

124576 
AutošcInfo
 *
	gp
 = 
pP¬£
->
pAšc
;

124577 
	gpP¬£
->
	gpAšc
 = 
p
->
pNext
;

124578 
sql™e3DbF»e
(
db
, 
p
);

124580  
	gpP¬£
->
	gpZomb›Tab
 ){

124581 
TabË
 *
	gp
 = 
pP¬£
->
pZomb›Tab
;

124582 
	gpP¬£
->
	gpZomb›Tab
 = 
p
->
pNextZomb›
;

124583 
sql™e3D–‘eTabË
(
db
, 
p
);

124585 ifÐ
	gnE¼
>0 && 
	gpP¬£
->
	grc
==
SQLITE_OK
 ){

124586 
pP¬£
->
rc
 = 
SQLITE_ERROR
;

124588  
	gnE¼
;

124611 #iâdeà
SQLITE_OMIT_COMPLETE


124616 #iâdeà
SQLITE_AMALGAMATION


124617 #ifdeà
SQLITE_ASCII


124618 
	#IdCh¬
(
C
è((
sql™e3Cty³M­
[()C]&0x46)!=0)

	)

124620 #ifdeà
SQLITE_EBCDIC


124621 
SQLITE_PRIVATE
 cÚ¡ 
	gsql™e3IsEbcdicIdCh¬
[];

124622 
	#IdCh¬
(
C
è(((
c
=C)>=0x42 && 
sql™e3IsEbcdicIdCh¬
[c-0x40]))

	)

124631 
	#tkSEMI
 0

	)

124632 
	#tkWS
 1

	)

124633 
	#tkOTHER
 2

	)

124634 #iâdeà
SQLITE_OMIT_TRIGGER


124635 
	#tkEXPLAIN
 3

	)

124636 
	#tkCREATE
 4

	)

124637 
	#tkTEMP
 5

	)

124638 
	#tkTRIGGER
 6

	)

124639 
	#tkEND
 7

	)

124695 
SQLITE_API
 
sql™e3_com¶‘e
(cÚ¡ *
zSql
){

124696 
u8
 
	g¡©e
 = 0;

124697 
u8
 
	gtok’
;

124699 #iâdeà
SQLITE_OMIT_TRIGGER


124703 cÚ¡ 
u8
 
	gŒªs
[8][8] = {

124719 cÚ¡ 
u8
 
	gŒªs
[3][3] = {

124728  *
	gzSql
 ){

124729  *
	gzSql
 ){

124731 
tok’
 = 
tkSEMI
;

124739 
tok’
 = 
tkWS
;

124743 ifÐ
zSql
[1]!='*' ){

124744 
tok’
 = 
tkOTHER
;

124747 
	gzSql
 += 2;

124748  
	gzSql
[0] && (zSql[0]!='*' || 
zSql
[1]!='/') ){ zSql++; }

124749 ifÐ
	gzSql
[0]==0 )  0;

124750 
	gzSql
++;

124751 
	gtok’
 = 
tkWS
;

124755 ifÐ
zSql
[1]!='-' ){

124756 
tok’
 = 
tkOTHER
;

124759  *
	gzSql
 && *zSql!='\n' ){ 
zSql
++; }

124760 ifÐ*
	gzSql
==0 )  
¡©e
==1;

124761 
	gtok’
 = 
tkWS
;

124765 
zSql
++;

124766  *
	gzSql
 && *zSql!=']' ){ 
zSql
++; }

124767 ifÐ*
	gzSql
==0 )  0;

124768 
	gtok’
 = 
tkOTHER
;

124774 
c
 = *
zSql
;

124775 
	gzSql
++;

124776  *
	gzSql
 && *zSql!=
c
 ){ 
zSql
++; }

124777 ifÐ*
	gzSql
==0 )  0;

124778 
	gtok’
 = 
tkOTHER
;

124782 #ifdeà
SQLITE_EBCDIC


124783 
c
;

124785 ifÐ
IdCh¬
((
u8
)*
zSql
) ){

124787 
	gnId
;

124788 
	gnId
=1; 
IdCh¬
(
zSql
[
nId
]);‚Id++){}

124789 #ifdeà
SQLITE_OMIT_TRIGGER


124790 
	gtok’
 = 
tkOTHER
;

124792  *
	gzSql
 ){

124794 ifÐ
nId
==6 && 
sql™e3SŒNICmp
(
zSql
, "create", 6)==0 ){

124795 
tok’
 = 
tkCREATE
;

124797 
	gtok’
 = 
tkOTHER
;

124802 ifÐ
nId
==7 && 
sql™e3SŒNICmp
(
zSql
, "trigger", 7)==0 ){

124803 
tok’
 = 
tkTRIGGER
;

124804 }ifÐ
	gnId
==4 && 
sql™e3SŒNICmp
(
zSql
, "temp", 4)==0 ){

124805 
tok’
 = 
tkTEMP
;

124806 }ifÐ
	gnId
==9 && 
sql™e3SŒNICmp
(
zSql
, "temporary", 9)==0 ){

124807 
tok’
 = 
tkTEMP
;

124809 
	gtok’
 = 
tkOTHER
;

124814 ifÐ
nId
==3 && 
sql™e3SŒNICmp
(
zSql
, "end", 3)==0 ){

124815 
tok’
 = 
tkEND
;

124817 #iâdeà
SQLITE_OMIT_EXPLAIN


124818 ifÐ
	gnId
==7 && 
sql™e3SŒNICmp
(
zSql
, "explain", 7)==0 ){

124819 
tok’
 = 
tkEXPLAIN
;

124823 
	gtok’
 = 
tkOTHER
;

124828 
tok’
 = 
tkOTHER
;

124833 
	gzSql
 +ð
nId
-1;

124836 
	gtok’
 = 
tkOTHER
;

124841 
	g¡©e
 = 
Œªs
[
¡©e
][
tok’
];

124842 
	gzSql
++;

124844  
	g¡©e
==1;

124847 #iâdeà
SQLITE_OMIT_UTF16


124853 
SQLITE_API
 
sql™e3_com¶‘e16
(cÚ¡ *
zSql
){

124854 
sql™e3_v®ue
 *
	gpV®
;

124855 cÚ¡ *
	gzSql8
;

124856 
	grc
 = 
SQLITE_NOMEM
;

124858 #iâdeà
SQLITE_OMIT_AUTOINIT


124859 
	grc
 = 
sql™e3_š™Ÿlize
();

124860 ifÐ
	grc
 ) „c;

124862 
	gpV®
 = 
sql™e3V®ueNew
(0);

124863 
sql™e3V®ueS‘SŒ
(
pV®
, -1, 
zSql
, 
SQLITE_UTF16NATIVE
, 
SQLITE_STATIC
);

124864 
	gzSql8
 = 
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF8
);

124865 ifÐ
	gzSql8
 ){

124866 
	grc
 = 
sql™e3_com¶‘e
(
zSql8
);

124868 
	grc
 = 
SQLITE_NOMEM
;

124870 
sql™e3V®ueF»e
(
pV®
);

124871  
sql™e3ApiEx™
(0, 
rc
);

124895 #ifdeà
SQLITE_ENABLE_FTS3


124918 
SQLITE_PRIVATE
 
sql™e3Fts3In™
(
sql™e3
 *
db
);

124927 #ifdeà
SQLITE_ENABLE_RTREE


124950 
SQLITE_PRIVATE
 
sql™e3RŒ“In™
(
sql™e3
 *
db
);

124959 #ifdeà
SQLITE_ENABLE_ICU


124982 
SQLITE_PRIVATE
 
sql™e3IcuIn™
(
sql™e3
 *
db
);

124993 #iâdeà
SQLITE_AMALGAMATION


124997 
SQLITE_API
 cÚ¡ 
sql™e3_v”siÚ
[] = 
SQLITE_VERSION
;

125003 
SQLITE_API
 cÚ¡ *
sql™e3_libv”siÚ
(){  
	gsql™e3_v”siÚ
; }

125009 
SQLITE_API
 cÚ¡ *
sql™e3_sourûid
(){  
	gSQLITE_SOURCE_ID
; }

125014 
SQLITE_API
 
sql™e3_libv”siÚ_numb”
(){  
	gSQLITE_VERSION_NUMBER
; }

125020 
SQLITE_API
 
sql™e3_th»ad§ã
(){  
	gSQLITE_THREADSAFE
; }

125022 #ià!
defšed
(
SQLITE_OMIT_TRACE
è&& defšed(
SQLITE_ENABLE_IOTRACE
)

125029 
SQLITE_PRIVATE
 (*
	gsql™e3IoT¿û
)(const *, ...) = 0;

125039 
SQLITE_API
 *
	gsql™e3_‹mp_dœeùÜy
 = 0;

125048 
SQLITE_API
 *
	gsql™e3_d©a_dœeùÜy
 = 0;

125081 
SQLITE_API
 
sql™e3_š™Ÿlize
(){

125082 
MUTEX_LOGIC
Ð
sql™e3_mu‹x
 *
pMa¡”
; )

125083 
	grc
;

125084 #ifdeà
SQLITE_EXTRA_INIT


125085 
	gbRunExŒaIn™
 = 0;

125088 #ifdeà
SQLITE_OMIT_WSD


125089 
	grc
 = 
sql™e3_wsd_š™
(4096, 24);

125090 ifÐ
	grc
!=
SQLITE_OK
 ){

125091  
rc
;

125100 ifÐ
	gsql™e3Glob®CÚfig
.
	gisIn™
 )  
	gSQLITE_OK
;

125110 
	grc
 = 
sql™e3Mu‹xIn™
();

125111 ifÐ
	grc
 ) „c;

125119 
MUTEX_LOGIC
Ð
pMa¡”
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
); )

125120 
sql™e3_mu‹x_’‹r
(
pMa¡”
);

125121 
	gsql™e3Glob®CÚfig
.
	gisMu‹xIn™
 = 1;

125122 ifÐ!
	gsql™e3Glob®CÚfig
.
	gisM®locIn™
 ){

125123 
	grc
 = 
sql™e3M®locIn™
();

125125 ifÐ
	grc
==
SQLITE_OK
 ){

125126 
sql™e3Glob®CÚfig
.
isM®locIn™
 = 1;

125127 ifÐ!
	gsql™e3Glob®CÚfig
.
	gpIn™Mu‹x
 ){

125128 
	gsql™e3Glob®CÚfig
.
	gpIn™Mu‹x
 =

125129 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_RECURSIVE
);

125130 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
 && !sql™e3Glob®CÚfig.
	gpIn™Mu‹x
 ){

125131 
	grc
 = 
SQLITE_NOMEM
;

125135 ifÐ
	grc
==
SQLITE_OK
 ){

125136 
sql™e3Glob®CÚfig
.
nRefIn™Mu‹x
++;

125138 
sql™e3_mu‹x_Ëave
(
pMa¡”
);

125143 ifÐ
	grc
!=
SQLITE_OK
 ){

125144  
rc
;

125160 
sql™e3_mu‹x_’‹r
(
sql™e3Glob®CÚfig
.
pIn™Mu‹x
);

125161 ifÐ
	gsql™e3Glob®CÚfig
.
	gisIn™
==0 && 
sql™e3Glob®CÚfig
.
šProg»ss
==0 ){

125162 
FuncDefHash
 *
pHash
 = &
GLOBAL
(FuncDefHash, 
sql™e3Glob®FunùiÚs
);

125163 
	gsql™e3Glob®CÚfig
.
	gšProg»ss
 = 1;

125164 
mem£t
(
pHash
, 0, (
sql™e3Glob®FunùiÚs
));

125165 
sql™e3Regi¡”Glob®FunùiÚs
();

125166 ifÐ
	gsql™e3Glob®CÚfig
.
	gisPCacheIn™
==0 ){

125167 
rc
 = 
sql™e3PÿcheIn™Ÿlize
();

125169 ifÐ
	grc
==
SQLITE_OK
 ){

125170 
sql™e3Glob®CÚfig
.
isPCacheIn™
 = 1;

125171 
	grc
 = 
sql™e3OsIn™
();

125173 ifÐ
	grc
==
SQLITE_OK
 ){

125174 
sql™e3PCacheBufãrS‘up
Ð
sql™e3Glob®CÚfig
.
pPage
,

125175 
sql™e3Glob®CÚfig
.
szPage
, sql™e3Glob®CÚfig.
nPage
);

125176 
	gsql™e3Glob®CÚfig
.
	gisIn™
 = 1;

125177 #ifdeà
SQLITE_EXTRA_INIT


125178 
	gbRunExŒaIn™
 = 1;

125181 
	gsql™e3Glob®CÚfig
.
	gšProg»ss
 = 0;

125183 
sql™e3_mu‹x_Ëave
(
sql™e3Glob®CÚfig
.
pIn™Mu‹x
);

125188 
sql™e3_mu‹x_’‹r
(
pMa¡”
);

125189 
	gsql™e3Glob®CÚfig
.
	gnRefIn™Mu‹x
--;

125190 ifÐ
	gsql™e3Glob®CÚfig
.
	gnRefIn™Mu‹x
<=0 ){

125191 
as£¹
Ð
sql™e3Glob®CÚfig
.
nRefIn™Mu‹x
==0 );

125192 
sql™e3_mu‹x_ä“
(
sql™e3Glob®CÚfig
.
pIn™Mu‹x
);

125193 
	gsql™e3Glob®CÚfig
.
	gpIn™Mu‹x
 = 0;

125195 
sql™e3_mu‹x_Ëave
(
pMa¡”
);

125202 #iâdeà
NDEBUG


125203 #iâdeà
SQLITE_OMIT_FLOATING_POINT


125205 iàÐ
	grc
==
SQLITE_OK
 ){

125206 
u64
 
x
 = (((u64)1)<<63)-1;

125207 
	gy
;

125208 
as£¹
((
x
)==8);

125209 
as£¹
((
x
)==(
y
));

125210 
memýy
(&
y
, &
x
, 8);

125211 
as£¹
Ð
sql™e3IsNaN
(
y
) );

125219 #ifdeà
SQLITE_EXTRA_INIT


125220 ifÐ
	gbRunExŒaIn™
 ){

125221 
SQLITE_EXTRA_INIT
(const *);

125222 
	grc
 = 
SQLITE_EXTRA_INIT
(0);

125226  
	grc
;

125237 
SQLITE_API
 
sql™e3_shutdown
(){

125238 ifÐ
	gsql™e3Glob®CÚfig
.
	gisIn™
 ){

125239 #ifdeà
SQLITE_EXTRA_SHUTDOWN


125240 
SQLITE_EXTRA_SHUTDOWN
();

125241 
SQLITE_EXTRA_SHUTDOWN
();

125243 
sql™e3_os_’d
();

125244 
sql™e3_»£t_auto_ex‹nsiÚ
();

125245 
	gsql™e3Glob®CÚfig
.
	gisIn™
 = 0;

125247 ifÐ
	gsql™e3Glob®CÚfig
.
	gisPCacheIn™
 ){

125248 
sql™e3PÿcheShutdown
();

125249 
	gsql™e3Glob®CÚfig
.
	gisPCacheIn™
 = 0;

125251 ifÐ
	gsql™e3Glob®CÚfig
.
	gisM®locIn™
 ){

125252 
sql™e3M®locEnd
();

125253 
	gsql™e3Glob®CÚfig
.
	gisM®locIn™
 = 0;

125255 #iâdeà
SQLITE_OMIT_SHUTDOWN_DIRECTORIES


125263 
	gsql™e3_d©a_dœeùÜy
 = 0;

125264 
	gsql™e3_‹mp_dœeùÜy
 = 0;

125267 ifÐ
	gsql™e3Glob®CÚfig
.
	gisMu‹xIn™
 ){

125268 
sql™e3Mu‹xEnd
();

125269 
	gsql™e3Glob®CÚfig
.
	gisMu‹xIn™
 = 0;

125272  
	gSQLITE_OK
;

125284 
SQLITE_API
 
sql™e3_cÚfig
(
Ý
, ...){

125285 
va_li¡
 
	g­
;

125286 
	grc
 = 
SQLITE_OK
;

125290 ifÐ
	gsql™e3Glob®CÚfig
.
	gisIn™
 )  
	gSQLITE_MISUSE_BKPT
;

125292 
va_¡¬t
(
­
, 
Ý
);

125293  
	gÝ
 ){

125298 #ià
defšed
(
SQLITE_THREADSAFE
) && SQLITE_THREADSAFE>0

125299 
	gSQLITE_CONFIG_SINGLETHREAD
: {

125301 
sql™e3Glob®CÚfig
.
bCÜeMu‹x
 = 0;

125302 
	gsql™e3Glob®CÚfig
.
	gbFuÎMu‹x
 = 0;

125305 
	gSQLITE_CONFIG_MULTITHREAD
: {

125308 
sql™e3Glob®CÚfig
.
bCÜeMu‹x
 = 1;

125309 
	gsql™e3Glob®CÚfig
.
	gbFuÎMu‹x
 = 0;

125312 
	gSQLITE_CONFIG_SERIALIZED
: {

125314 
sql™e3Glob®CÚfig
.
bCÜeMu‹x
 = 1;

125315 
	gsql™e3Glob®CÚfig
.
	gbFuÎMu‹x
 = 1;

125318 
	gSQLITE_CONFIG_MUTEX
: {

125320 
sql™e3Glob®CÚfig
.
mu‹x
 = *
va_¬g
(
­
, 
sql™e3_mu‹x_m‘hods
*);

125323 
	gSQLITE_CONFIG_GETMUTEX
: {

125325 *
va_¬g
(
­
, 
sql™e3_mu‹x_m‘hods
*èð
sql™e3Glob®CÚfig
.
mu‹x
;

125331 
	gSQLITE_CONFIG_MALLOC
: {

125333 
sql™e3Glob®CÚfig
.
m
 = *
va_¬g
(
­
, 
sql™e3_mem_m‘hods
*);

125336 
	gSQLITE_CONFIG_GETMALLOC
: {

125338 ifÐ
sql™e3Glob®CÚfig
.
m
.
xM®loc
==0 ) 
sql™e3MemS‘DeçuÉ
();

125339 *
va_¬g
(
­
, 
sql™e3_mem_m‘hods
*èð
sql™e3Glob®CÚfig
.
m
;

125342 
	gSQLITE_CONFIG_MEMSTATUS
: {

125344 
sql™e3Glob®CÚfig
.
bMem¡©
 = 
va_¬g
(
­
, );

125347 
	gSQLITE_CONFIG_SCRATCH
: {

125349 
sql™e3Glob®CÚfig
.
pSü©ch
 = 
va_¬g
(
­
, *);

125350 
	gsql™e3Glob®CÚfig
.
	gszSü©ch
 = 
va_¬g
(
­
, );

125351 
	gsql™e3Glob®CÚfig
.
	gnSü©ch
 = 
va_¬g
(
­
, );

125354 
	gSQLITE_CONFIG_PAGECACHE
: {

125356 
sql™e3Glob®CÚfig
.
pPage
 = 
va_¬g
(
­
, *);

125357 
	gsql™e3Glob®CÚfig
.
	gszPage
 = 
va_¬g
(
­
, );

125358 
	gsql™e3Glob®CÚfig
.
	gnPage
 = 
va_¬g
(
­
, );

125362 
	gSQLITE_CONFIG_PCACHE
: {

125366 
	gSQLITE_CONFIG_GETPCACHE
: {

125368 
rc
 = 
SQLITE_ERROR
;

125372 
	gSQLITE_CONFIG_PCACHE2
: {

125374 
sql™e3Glob®CÚfig
.
pÿche2
 = *
va_¬g
(
­
, 
sql™e3_pÿche_m‘hods2
*);

125377 
	gSQLITE_CONFIG_GETPCACHE2
: {

125378 ifÐ
sql™e3Glob®CÚfig
.
pÿche2
.
xIn™
==0 ){

125379 
sql™e3PCacheS‘DeçuÉ
();

125381 *
va_¬g
(
­
, 
sql™e3_pÿche_m‘hods2
*èð
sql™e3Glob®CÚfig
.
pÿche2
;

125385 #ià
defšed
(
SQLITE_ENABLE_MEMSYS3
è|| defšed(
SQLITE_ENABLE_MEMSYS5
)

125386 
	gSQLITE_CONFIG_HEAP
: {

125388 
sql™e3Glob®CÚfig
.
pH—p
 = 
va_¬g
(
­
, *);

125389 
	gsql™e3Glob®CÚfig
.
	gnH—p
 = 
va_¬g
(
­
, );

125390 
	gsql™e3Glob®CÚfig
.
	gmnReq
 = 
va_¬g
(
­
, );

125392 ifÐ
	gsql™e3Glob®CÚfig
.
	gmnReq
<1 ){

125393 
	gsql™e3Glob®CÚfig
.
	gmnReq
 = 1;

125394 }ifÐ
	gsql™e3Glob®CÚfig
.
	gmnReq
>(1<<12) ){

125396 
	gsql™e3Glob®CÚfig
.
	gmnReq
 = (1<<12);

125399 ifÐ
	gsql™e3Glob®CÚfig
.
	gpH—p
==0 ){

125405 
mem£t
(&
sql™e3Glob®CÚfig
.
m
, 0, (sqlite3GlobalConfig.m));

125411 #ifdeà
SQLITE_ENABLE_MEMSYS3


125412 
	gsql™e3Glob®CÚfig
.
	gm
 = *
sql™e3MemG‘Memsys3
();

125414 #ifdeà
SQLITE_ENABLE_MEMSYS5


125415 
	gsql™e3Glob®CÚfig
.
	gm
 = *
sql™e3MemG‘Memsys5
();

125422 
	gSQLITE_CONFIG_LOOKASIDE
: {

125423 
sql™e3Glob®CÚfig
.
szLookaside
 = 
va_¬g
(
­
, );

125424 
	gsql™e3Glob®CÚfig
.
	gnLookaside
 = 
va_¬g
(
­
, );

125432 
	gSQLITE_CONFIG_LOG
: {

125437 (*
LOGFUNC_t
)(*,,const *);

125438 
	gsql™e3Glob®CÚfig
.
	gxLog
 = 
va_¬g
(
­
, 
LOGFUNC_t
);

125439 
	gsql™e3Glob®CÚfig
.
	gpLogArg
 = 
va_¬g
(
­
, *);

125448 
	gSQLITE_CONFIG_URI
: {

125449 
sql™e3Glob®CÚfig
.
bO³nUri
 = 
va_¬g
(
­
, );

125453 
	gSQLITE_CONFIG_COVERING_INDEX_SCAN
: {

125454 
sql™e3Glob®CÚfig
.
bU£Cis
 = 
va_¬g
(
­
, );

125458 #ifdeà
SQLITE_ENABLE_SQLLOG


125459 
	gSQLITE_CONFIG_SQLLOG
: {

125460 (*
SQLLOGFUNC_t
)(*, 
	tsql™e3
*, const *, );

125461 
	gsql™e3Glob®CÚfig
.
	gxSqÎog
 = 
va_¬g
(
­
, 
SQLLOGFUNC_t
);

125462 
	gsql™e3Glob®CÚfig
.
	gpSqÎogArg
 = 
va_¬g
(
­
, *);

125467 
	gSQLITE_CONFIG_MMAP_SIZE
: {

125468 
sql™e3_št64
 
szMm­
 = 
va_¬g
(
­
, sqlite3_int64);

125469 
sql™e3_št64
 
	gmxMm­
 = 
va_¬g
(
­
, sqlite3_int64);

125470 ifÐ
	gmxMm­
<0 || mxMm­>
	gSQLITE_MAX_MMAP_SIZE
 ){

125471 
	gmxMm­
 = 
SQLITE_MAX_MMAP_SIZE
;

125473 
	gsql™e3Glob®CÚfig
.
	gmxMm­
 = 
mxMm­
;

125474 ifÐ
	gszMm­
<0 ) szMm­ = 
SQLITE_DEFAULT_MMAP_SIZE
;

125475 ifÐ
	gszMm­
>
	gmxMm­
èszMm­ = 
mxMm­
;

125476 
	gsql™e3Glob®CÚfig
.
	gszMm­
 = 
szMm­
;

125480 #ià
SQLITE_OS_WIN
 && 
defšed
(
SQLITE_WIN32_MALLOC
)

125481 
	gSQLITE_CONFIG_WIN32_HEAPSIZE
: {

125482 
sql™e3Glob®CÚfig
.
nH—p
 = 
va_¬g
(
­
, );

125488 
rc
 = 
SQLITE_ERROR
;

125492 
va_’d
(
­
);

125493  
	grc
;

125507 
£tupLookaside
(
sql™e3
 *
db
, *
pBuf
, 
sz
, 
út
){

125508 *
	gpS¹
;

125509 ifÐ
	gdb
->
	glookaside
.
	gnOut
 ){

125510  
	gSQLITE_BUSY
;

125516 ifÐ
	gdb
->
	glookaside
.
	gbM®loûd
 ){

125517 
sql™e3_ä“
(
db
->
lookaside
.
pS¹
);

125522 
	gsz
 = 
ROUNDDOWN8
(
sz
);

125523 ifÐ
	gsz
<=()(
LookasideSlÙ
*èè
sz
 = 0;

125524 ifÐ
	gút
<0 ) cnt = 0;

125525 ifÐ
	gsz
==0 || 
út
==0 ){

125526 
sz
 = 0;

125527 
	gpS¹
 = 0;

125528 }ifÐ
	gpBuf
==0 ){

125529 
sql™e3BegšB’ignM®loc
();

125530 
	gpS¹
 = 
sql™e3M®loc
Ð
sz
*
út
 );

125531 
sql™e3EndB’ignM®loc
();

125532 ifÐ
	gpS¹
 ) 
	gút
 = 
sql™e3M®locSize
(
pS¹
)/
sz
;

125534 
	gpS¹
 = 
pBuf
;

125536 
	gdb
->
	glookaside
.
	gpS¹
 = 
pS¹
;

125537 
	gdb
->
	glookaside
.
	gpF»e
 = 0;

125538 
	gdb
->
	glookaside
.
	gsz
 = (
u16
)
sz
;

125539 ifÐ
	gpS¹
 ){

125540 
	gi
;

125541 
LookasideSlÙ
 *
	gp
;

125542 
as£¹
Ð
sz
 > ()(
LookasideSlÙ
*) );

125543 
	gp
 = (
LookasideSlÙ
*)
pS¹
;

125544 
	gi
=
út
-1; i>=0; i--){

125545 
	gp
->
	gpNext
 = 
db
->
lookaside
.
pF»e
;

125546 
	gdb
->
	glookaside
.
	gpF»e
 = 
p
;

125547 
	gp
 = (
LookasideSlÙ
*)&((
u8
*)
p
)[
sz
];

125549 
	gdb
->
	glookaside
.
	gpEnd
 = 
p
;

125550 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 1;

125551 
	gdb
->
	glookaside
.
	gbM®loûd
 = 
pBuf
==0 ?1:0;

125553 
	gdb
->
	glookaside
.
	gpS¹
 = 
db
;

125554 
	gdb
->
	glookaside
.
	gpEnd
 = 
db
;

125555 
	gdb
->
	glookaside
.
	gbEÇbËd
 = 0;

125556 
	gdb
->
	glookaside
.
	gbM®loûd
 = 0;

125558  
	gSQLITE_OK
;

125564 
SQLITE_API
 
sql™e3_mu‹x
 *
sql™e3_db_mu‹x
(
sql™e3
 *
db
){

125565  
	gdb
->
	gmu‹x
;

125572 
SQLITE_API
 
sql™e3_db_»Ëa£_memÜy
(
sql™e3
 *
db
){

125573 
	gi
;

125574 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

125575 
sql™e3BŒ“EÁ”AÎ
(
db
);

125576 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

125577 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
i
].
pBt
;

125578 ifÐ
	gpBt
 ){

125579 
Pag”
 *
	gpPag”
 = 
sql™e3BŒ“Pag”
(
pBt
);

125580 
sql™e3Pag”Shršk
(
pPag”
);

125583 
sql™e3BŒ“L—veAÎ
(
db
);

125584 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

125585  
	gSQLITE_OK
;

125591 
SQLITE_API
 
sql™e3_db_cÚfig
(
sql™e3
 *
db
, 
Ý
, ...){

125592 
va_li¡
 
	g­
;

125593 
	grc
;

125594 
va_¡¬t
(
­
, 
Ý
);

125595  
	gÝ
 ){

125596 
	gSQLITE_DBCONFIG_LOOKASIDE
: {

125597 *
pBuf
 = 
va_¬g
(
­
, *);

125598 
	gsz
 = 
va_¬g
(
­
, );

125599 
	gút
 = 
va_¬g
(
­
, );

125600 
	grc
 = 
£tupLookaside
(
db
, 
pBuf
, 
sz
, 
út
);

125605 
Ý
;

125606 
u32
 
	gmask
;

125607 } 
	gaFÏgOp
[] = {

125608 { 
SQLITE_DBCONFIG_ENABLE_FKEY
, 
SQLITE_FÜeignKeys
 },

125609 { 
SQLITE_DBCONFIG_ENABLE_TRIGGER
, 
SQLITE_EÇbËTrigg”
 },

125611 
	gi
;

125612 
	grc
 = 
SQLITE_ERROR
;

125613 
	gi
=0; i<
A¼aySize
(
aFÏgOp
); i++){

125614 ifÐ
	gaFÏgOp
[
i
].
	gÝ
==
Ý
 ){

125615 
Úoff
 = 
va_¬g
(
­
, );

125616 *
	gpRes
 = 
va_¬g
(
­
, *);

125617 
	gÞdFÏgs
 = 
db
->
æags
;

125618 ifÐ
	gÚoff
>0 ){

125619 
	gdb
->
	gæags
 |ð
aFÏgOp
[
i
].
mask
;

125620 }ifÐ
	gÚoff
==0 ){

125621 
db
->
æags
 &ð~
aFÏgOp
[
i
].
mask
;

125623 ifÐ
	gÞdFÏgs
!=
db
->
æags
 ){

125624 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

125626 ifÐ
	gpRes
 ){

125627 *
	gpRes
 = (
db
->
æags
 & 
aFÏgOp
[
i
].
mask
)!=0;

125629 
	grc
 = 
SQLITE_OK
;

125636 
va_’d
(
­
);

125637  
	grc
;

125644 
®lS·ûs
(cÚ¡ *
z
, 
n
){

125645  
	gn
>0 && 
	gz
[
n
-1]==' ' ){‚--; }

125646  
	gn
==0;

125656 
bšCÞlFunc
(

125657 *
·dFÏg
,

125658 
nKey1
, cÚ¡ *
pKey1
,

125659 
nKey2
, cÚ¡ *
pKey2


125661 
	grc
, 
	gn
;

125662 
	gn
 = 
nKey1
<
nKey2
 ?‚Key1 :‚Key2;

125663 
	grc
 = 
memcmp
(
pKey1
, 
pKey2
, 
n
);

125664 ifÐ
	grc
==0 ){

125665 ifÐ
·dFÏg


125666 && 
®lS·ûs
(((*)
pKey1
)+
n
, 
nKey1
-n)

125667 && 
®lS·ûs
(((*)
pKey2
)+
n
, 
nKey2
-n)

125671 
rc
 = 
nKey1
 - 
nKey2
;

125674  
	grc
;

125686 
noÿ£CÞÏtšgFunc
(

125687 *
NÙU£d
,

125688 
nKey1
, cÚ¡ *
pKey1
,

125689 
nKey2
, cÚ¡ *
pKey2


125691 
	gr
 = 
sql™e3SŒNICmp
(

125692 (cÚ¡ *)
pKey1
, (cÚ¡ *)
pKey2
, (
nKey1
<
nKey2
)?nKey1:nKey2);

125693 
UNUSED_PARAMETER
(
NÙU£d
);

125694 ifÐ0==
r
 ){

125695 
r
 = 
nKey1
-
nKey2
;

125697  
	gr
;

125703 
SQLITE_API
 
sql™e_št64
 
sql™e3_Ï¡_š£¹_rowid
(
sql™e3
 *
db
){

125704  
	gdb
->
	gÏ¡Rowid
;

125710 
SQLITE_API
 
sql™e3_chªges
(
sql™e3
 *
db
){

125711  
	gdb
->
	gnChªge
;

125717 
SQLITE_API
 
sql™e3_tÙ®_chªges
(
sql™e3
 *
db
){

125718  
	gdb
->
	gnTÙ®Chªge
;

125726 
SQLITE_PRIVATE
 
sql™e3Clo£Sav•ošts
(
sql™e3
 *
db
){

125727  
	gdb
->
	gpSav•ošt
 ){

125728 
Sav•ošt
 *
	gpTmp
 = 
db
->
pSav•ošt
;

125729 
	gdb
->
	gpSav•ošt
 = 
pTmp
->
pNext
;

125730 
sql™e3DbF»e
(
db
, 
pTmp
);

125732 
	gdb
->
	gnSav•ošt
 = 0;

125733 
	gdb
->
	gnS‹m’t
 = 0;

125734 
	gdb
->
	gisT¿n§ùiÚSav•ošt
 = 0;

125743 
funùiÚDe¡roy
(
sql™e3
 *
db
, 
FuncDef
 *
p
){

125744 
FuncDe¡ruùÜ
 *
	gpDe¡ruùÜ
 = 
p
->
pDe¡ruùÜ
;

125745 ifÐ
	gpDe¡ruùÜ
 ){

125746 
	gpDe¡ruùÜ
->
	gnRef
--;

125747 ifÐ
	gpDe¡ruùÜ
->
	gnRef
==0 ){

125748 
pDe¡ruùÜ
->
xDe¡roy
ÕDe¡ruùÜ->
pU£rD©a
);

125749 
sql™e3DbF»e
(
db
, 
pDe¡ruùÜ
);

125758 
discÚÃùAÎVb
(
sql™e3
 *
db
){

125759 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


125760 
	gi
;

125761 
sql™e3BŒ“EÁ”AÎ
(
db
);

125762 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

125763 
Schema
 *
	gpSchema
 = 
db
->
aDb
[
i
].
pSchema
;

125764 ifÐ
	gdb
->
	gaDb
[
i
].
	gpSchema
 ){

125765 
HashEËm
 *
	gp
;

125766 
	gp
=
sql™eHashFœ¡
(&
pSchema
->
tblHash
);…;…=
sql™eHashNext
(
p
)){

125767 
TabË
 *
pTab
 = (TabË *)
sql™eHashD©a
(
p
);

125768 ifÐ
IsVœtu®
(
pTab
èè
sql™e3VbDiscÚÃù
(
db
,…Tab);

125772 
sql™e3VbUÆockLi¡
(
db
);

125773 
sql™e3BŒ“L—veAÎ
(
db
);

125775 
UNUSED_PARAMETER
(
db
);

125783 
cÚÃùiÚIsBusy
(
sql™e3
 *
db
){

125784 
	gj
;

125785 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

125786 ifÐ
	gdb
->
	gpVdbe
 )  1;

125787 
	gj
=0; j<
	gdb
->
	gnDb
; j++){

125788 
BŒ“
 *
	gpBt
 = 
db
->
aDb
[
j
].
pBt
;

125789 ifÐ
	gpBt
 && 
sql™e3BŒ“IsInBackup
(
pBt
) )  1;

125797 
sql™e3Clo£
(
sql™e3
 *
db
, 
fÜûZomb›
){

125798 ifÐ!
	gdb
 ){

125801  
	gSQLITE_OK
;

125803 ifÐ!
sql™e3SaãtyCheckSickOrOk
(
db
) ){

125804  
	gSQLITE_MISUSE_BKPT
;

125806 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

125809 
discÚÃùAÎVb
(
db
);

125818 
sql™e3VbRÞlback
(
db
);

125823 ifÐ!
	gfÜûZomb›
 && 
cÚÃùiÚIsBusy
(
db
) ){

125824 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_BUSY
, "unableo close dueo unfinalized "

125826 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

125827  
	gSQLITE_BUSY
;

125830 #ifdeà
SQLITE_ENABLE_SQLLOG


125831 ifÐ
	gsql™e3Glob®CÚfig
.
	gxSqÎog
 ){

125833 
	gsql™e3Glob®CÚfig
.
xSqÎog
(
sql™e3Glob®CÚfig
.
pSqÎogArg
, 
db
, 0, 2);

125839 
	gdb
->
	gmagic
 = 
SQLITE_MAGIC_ZOMBIE
;

125840 
sql™e3L—veMu‹xAndClo£Zomb›
(
db
);

125841  
	gSQLITE_OK
;

125853 
SQLITE_API
 
sql™e3_þo£
(
sql™e3
 *
db
){  
sql™e3Clo£
(db,0); }

125854 
SQLITE_API
 
sql™e3_þo£_v2
(
sql™e3
 *
db
){  
sql™e3Clo£
(db,1); }

125865 
SQLITE_PRIVATE
 
sql™e3L—veMu‹xAndClo£Zomb›
(
sql™e3
 *
db
){

125866 
HashEËm
 *
	gi
;

125867 
	gj
;

125873 ifÐ
	gdb
->
	gmagic
!=
SQLITE_MAGIC_ZOMBIE
 || 
cÚÃùiÚIsBusy
(
db
) ){

125874 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

125888 
sql™e3RÞlbackAÎ
(
db
, 
SQLITE_OK
);

125891 
sql™e3Clo£Sav•ošts
(
db
);

125894 
	gj
=0; j<
	gdb
->
	gnDb
; j++){

125895 
Db
 *
	gpDb
 = &
db
->
aDb
[
j
];

125896 ifÐ
	gpDb
->
	gpBt
 ){

125897 ifÐ
	gpDb
->
	gpSchema
 ){

125899 
sql™e3BŒ“EÁ”
(
pDb
->
pBt
);

125900 
	gi
=
sql™eHashFœ¡
(&
pDb
->
pSchema
->
idxHash
); i; i=
sql™eHashNext
(
i
)){

125901 
Index
 *
pIdx
 = 
sql™eHashD©a
(
i
);

125902 
sql™e3KeyInfoUÄef
(
pIdx
->
pKeyInfo
);

125903 
	gpIdx
->
	gpKeyInfo
 = 0;

125905 
sql™e3BŒ“L—ve
(
pDb
->
pBt
);

125907 
sql™e3BŒ“Clo£
(
pDb
->
pBt
);

125908 
	gpDb
->
	gpBt
 = 0;

125909 ifÐ
	gj
!=1 ){

125910 
pDb
->
pSchema
 = 0;

125915 ifÐ
	gdb
->
	gaDb
[1].
	gpSchema
 ){

125916 
sql™e3SchemaCË¬
(
db
->
aDb
[1].
pSchema
);

125918 
sql™e3VbUÆockLi¡
(
db
);

125921 
sql™e3CÞÏp£D©aba£A¼ay
(
db
);

125922 
as£¹
Ð
db
->
nDb
<=2 );

125923 
as£¹
Ð
db
->
aDb
==db->
aDbStic
 );

125928 
sql™e3CÚÃùiÚClo£d
(
db
);

125930 
	gj
=0; j<
A¼aySize
(
db
->
aFunc
.
a
); j++){

125931 
FuncDef
 *
	gpNext
, *
	gpHash
, *
	gp
;

125932 
	gp
=
db
->
aFunc
.
a
[
j
];…;…=
pHash
){

125933 
pHash
 = 
p
->pHash;

125934  
	gp
 ){

125935 
funùiÚDe¡roy
(
db
, 
p
);

125936 
	gpNext
 = 
p
->
pNext
;

125937 
sql™e3DbF»e
(
db
, 
p
);

125938 
	gp
 = 
pNext
;

125942 
	gi
=
sql™eHashFœ¡
(&
db
->
aCÞlSeq
); i; i=
sql™eHashNext
(
i
)){

125943 
CÞlSeq
 *
pCÞl
 = (CÞlSeq *)
sql™eHashD©a
(
i
);

125945 
	gj
=0; j<3; j++){

125946 ifÐ
	gpCÞl
[
j
].
	gxD–
 ){

125947 
	gpCÞl
[
j
].
xD–
(
pCÞl
[j].
pU£r
);

125950 
sql™e3DbF»e
(
db
, 
pCÞl
);

125952 
sql™e3HashCË¬
(&
db
->
aCÞlSeq
);

125953 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


125954 
	gi
=
sql™eHashFœ¡
(&
db
->
aModuË
); i; i=
sql™eHashNext
(
i
)){

125955 
ModuË
 *
pMod
 = (ModuË *)
sql™eHashD©a
(
i
);

125956 ifÐ
	gpMod
->
	gxDe¡roy
 ){

125957 
	gpMod
->
xDe¡roy
(
pMod
->
pAux
);

125959 
sql™e3DbF»e
(
db
, 
pMod
);

125961 
sql™e3HashCË¬
(&
db
->
aModuË
);

125964 
sql™e3E¼Ü
(
db
, 
SQLITE_OK
);

125965 
sql™e3V®ueF»e
(
db
->
pE¼
);

125966 
sql™e3Clo£Ex‹nsiÚs
(
db
);

125967 #ià
SQLITE_USER_AUTHENTICATION


125968 
sql™e3_ä“
(
db
->
auth
.
zAuthU£r
);

125969 
sql™e3_ä“
(
db
->
auth
.
zAuthPW
);

125972 
	gdb
->
	gmagic
 = 
SQLITE_MAGIC_ERROR
;

125980 
sql™e3DbF»e
(
db
, db->
aDb
[1].
pSchema
);

125981 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

125982 
	gdb
->
	gmagic
 = 
SQLITE_MAGIC_CLOSED
;

125983 
sql™e3_mu‹x_ä“
(
db
->
mu‹x
);

125984 
as£¹
Ð
db
->
lookaside
.
nOut
==0 );

125985 ifÐ
	gdb
->
	glookaside
.
	gbM®loûd
 ){

125986 
sql™e3_ä“
(
db
->
lookaside
.
pS¹
);

125988 
sql™e3_ä“
(
db
);

125998 
SQLITE_PRIVATE
 
sql™e3RÞlbackAÎ
(
sql™e3
 *
db
, 
ŒCode
){

125999 
	gi
;

126000 
	gšT¿ns
 = 0;

126001 
	gschemaChªge
;

126002 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

126003 
sql™e3BegšB’ignM®loc
();

126011 
sql™e3BŒ“EÁ”AÎ
(
db
);

126012 
	gschemaChªge
 = (
db
->
æags
 & 
SQLITE_IÁ”nChªges
)!=0 && db->
š™
.
busy
==0;

126014 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

126015 
BŒ“
 *
	gp
 = 
db
->
aDb
[
i
].
pBt
;

126016 ifÐ
	gp
 ){

126017 ifÐ
sql™e3BŒ“IsInT¿ns
(
p
) ){

126018 
	gšT¿ns
 = 1;

126020 
sql™e3BŒ“RÞlback
(
p
, 
ŒCode
, !
schemaChªge
);

126023 
sql™e3VbRÞlback
(
db
);

126024 
sql™e3EndB’ignM®loc
();

126026 ifÐ(
	gdb
->
	gæags
&
	gSQLITE_IÁ”nChªges
)!=0 && 
db
->
š™
.
busy
==0 ){

126027 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

126028 
sql™e3Re£tAÎSchemasOfCÚÃùiÚ
(
db
);

126030 
sql™e3BŒ“L—veAÎ
(
db
);

126033 
	gdb
->
	gnDeã¼edCÚs
 = 0;

126034 
	gdb
->
	gnDeã¼edImmCÚs
 = 0;

126035 
	gdb
->
	gæags
 &ð~
SQLITE_DeãrFKs
;

126038 ifÐ
	gdb
->
	gxRÞlbackC®lback
 && (
	gšT¿ns
 || !db->
	gautoComm™
) ){

126039 
	gdb
->
xRÞlbackC®lback
(
db
->
pRÞlbackArg
);

126047 #ià(
defšed
(
SQLITE_DEBUG
è&& 
SQLITE_OS_WIN
è|| defšed(
SQLITE_TEST
)

126048 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3E¼Name
(
rc
){

126049 cÚ¡ *
	gzName
 = 0;

126050 
	gi
, 
	gÜigRc
 = 
rc
;

126051 
	gi
=0; i<2 && 
	gzName
==0; i++, 
	grc
 &= 0xff){

126052  
rc
 ){

126053 
SQLITE_OK
: 
zName
 = "SQLITE_OK"; ;

126054 
	gSQLITE_ERROR
: 
zName
 = "SQLITE_ERROR"; ;

126055 
	gSQLITE_INTERNAL
: 
zName
 = "SQLITE_INTERNAL"; ;

126056 
	gSQLITE_PERM
: 
zName
 = "SQLITE_PERM"; ;

126057 
	gSQLITE_ABORT
: 
zName
 = "SQLITE_ABORT"; ;

126058 
	gSQLITE_ABORT_ROLLBACK
: 
zName
 = "SQLITE_ABORT_ROLLBACK"; ;

126059 
	gSQLITE_BUSY
: 
zName
 = "SQLITE_BUSY"; ;

126060 
	gSQLITE_BUSY_RECOVERY
: 
zName
 = "SQLITE_BUSY_RECOVERY"; ;

126061 
	gSQLITE_BUSY_SNAPSHOT
: 
zName
 = "SQLITE_BUSY_SNAPSHOT"; ;

126062 
	gSQLITE_LOCKED
: 
zName
 = "SQLITE_LOCKED"; ;

126063 
	gSQLITE_LOCKED_SHAREDCACHE
: 
zName
 = "SQLITE_LOCKED_SHAREDCACHE";;

126064 
	gSQLITE_NOMEM
: 
zName
 = "SQLITE_NOMEM"; ;

126065 
	gSQLITE_READONLY
: 
zName
 = "SQLITE_READONLY"; ;

126066 
	gSQLITE_READONLY_RECOVERY
: 
zName
 = "SQLITE_READONLY_RECOVERY"; ;

126067 
	gSQLITE_READONLY_CANTLOCK
: 
zName
 = "SQLITE_READONLY_CANTLOCK"; ;

126068 
	gSQLITE_READONLY_ROLLBACK
: 
zName
 = "SQLITE_READONLY_ROLLBACK"; ;

126069 
	gSQLITE_READONLY_DBMOVED
: 
zName
 = "SQLITE_READONLY_DBMOVED"; ;

126070 
	gSQLITE_INTERRUPT
: 
zName
 = "SQLITE_INTERRUPT"; ;

126071 
	gSQLITE_IOERR
: 
zName
 = "SQLITE_IOERR"; ;

126072 
	gSQLITE_IOERR_READ
: 
zName
 = "SQLITE_IOERR_READ"; ;

126073 
	gSQLITE_IOERR_SHORT_READ
: 
zName
 = "SQLITE_IOERR_SHORT_READ"; ;

126074 
	gSQLITE_IOERR_WRITE
: 
zName
 = "SQLITE_IOERR_WRITE"; ;

126075 
	gSQLITE_IOERR_FSYNC
: 
zName
 = "SQLITE_IOERR_FSYNC"; ;

126076 
	gSQLITE_IOERR_DIR_FSYNC
: 
zName
 = "SQLITE_IOERR_DIR_FSYNC"; ;

126077 
	gSQLITE_IOERR_TRUNCATE
: 
zName
 = "SQLITE_IOERR_TRUNCATE"; ;

126078 
	gSQLITE_IOERR_FSTAT
: 
zName
 = "SQLITE_IOERR_FSTAT"; ;

126079 
	gSQLITE_IOERR_UNLOCK
: 
zName
 = "SQLITE_IOERR_UNLOCK"; ;

126080 
	gSQLITE_IOERR_RDLOCK
: 
zName
 = "SQLITE_IOERR_RDLOCK"; ;

126081 
	gSQLITE_IOERR_DELETE
: 
zName
 = "SQLITE_IOERR_DELETE"; ;

126082 
	gSQLITE_IOERR_NOMEM
: 
zName
 = "SQLITE_IOERR_NOMEM"; ;

126083 
	gSQLITE_IOERR_ACCESS
: 
zName
 = "SQLITE_IOERR_ACCESS"; ;

126084 
	gSQLITE_IOERR_CHECKRESERVEDLOCK
:

126085 
zName
 = "SQLITE_IOERR_CHECKRESERVEDLOCK"; ;

126086 
	gSQLITE_IOERR_LOCK
: 
zName
 = "SQLITE_IOERR_LOCK"; ;

126087 
	gSQLITE_IOERR_CLOSE
: 
zName
 = "SQLITE_IOERR_CLOSE"; ;

126088 
	gSQLITE_IOERR_DIR_CLOSE
: 
zName
 = "SQLITE_IOERR_DIR_CLOSE"; ;

126089 
	gSQLITE_IOERR_SHMOPEN
: 
zName
 = "SQLITE_IOERR_SHMOPEN"; ;

126090 
	gSQLITE_IOERR_SHMSIZE
: 
zName
 = "SQLITE_IOERR_SHMSIZE"; ;

126091 
	gSQLITE_IOERR_SHMLOCK
: 
zName
 = "SQLITE_IOERR_SHMLOCK"; ;

126092 
	gSQLITE_IOERR_SHMMAP
: 
zName
 = "SQLITE_IOERR_SHMMAP"; ;

126093 
	gSQLITE_IOERR_SEEK
: 
zName
 = "SQLITE_IOERR_SEEK"; ;

126094 
	gSQLITE_IOERR_DELETE_NOENT
: 
zName
 = "SQLITE_IOERR_DELETE_NOENT";;

126095 
	gSQLITE_IOERR_MMAP
: 
zName
 = "SQLITE_IOERR_MMAP"; ;

126096 
	gSQLITE_IOERR_GETTEMPPATH
: 
zName
 = "SQLITE_IOERR_GETTEMPPATH"; ;

126097 
	gSQLITE_IOERR_CONVPATH
: 
zName
 = "SQLITE_IOERR_CONVPATH"; ;

126098 
	gSQLITE_CORRUPT
: 
zName
 = "SQLITE_CORRUPT"; ;

126099 
	gSQLITE_CORRUPT_VTAB
: 
zName
 = "SQLITE_CORRUPT_VTAB"; ;

126100 
	gSQLITE_NOTFOUND
: 
zName
 = "SQLITE_NOTFOUND"; ;

126101 
	gSQLITE_FULL
: 
zName
 = "SQLITE_FULL"; ;

126102 
	gSQLITE_CANTOPEN
: 
zName
 = "SQLITE_CANTOPEN"; ;

126103 
	gSQLITE_CANTOPEN_NOTEMPDIR
: 
zName
 = "SQLITE_CANTOPEN_NOTEMPDIR";;

126104 
	gSQLITE_CANTOPEN_ISDIR
: 
zName
 = "SQLITE_CANTOPEN_ISDIR"; ;

126105 
	gSQLITE_CANTOPEN_FULLPATH
: 
zName
 = "SQLITE_CANTOPEN_FULLPATH"; ;

126106 
	gSQLITE_CANTOPEN_CONVPATH
: 
zName
 = "SQLITE_CANTOPEN_CONVPATH"; ;

126107 
	gSQLITE_PROTOCOL
: 
zName
 = "SQLITE_PROTOCOL"; ;

126108 
	gSQLITE_EMPTY
: 
zName
 = "SQLITE_EMPTY"; ;

126109 
	gSQLITE_SCHEMA
: 
zName
 = "SQLITE_SCHEMA"; ;

126110 
	gSQLITE_TOOBIG
: 
zName
 = "SQLITE_TOOBIG"; ;

126111 
	gSQLITE_CONSTRAINT
: 
zName
 = "SQLITE_CONSTRAINT"; ;

126112 
	gSQLITE_CONSTRAINT_UNIQUE
: 
zName
 = "SQLITE_CONSTRAINT_UNIQUE"; ;

126113 
	gSQLITE_CONSTRAINT_TRIGGER
: 
zName
 = "SQLITE_CONSTRAINT_TRIGGER";;

126114 
	gSQLITE_CONSTRAINT_FOREIGNKEY
:

126115 
zName
 = "SQLITE_CONSTRAINT_FOREIGNKEY"; ;

126116 
	gSQLITE_CONSTRAINT_CHECK
: 
zName
 = "SQLITE_CONSTRAINT_CHECK"; ;

126117 
	gSQLITE_CONSTRAINT_PRIMARYKEY
:

126118 
zName
 = "SQLITE_CONSTRAINT_PRIMARYKEY"; ;

126119 
	gSQLITE_CONSTRAINT_NOTNULL
: 
zName
 = "SQLITE_CONSTRAINT_NOTNULL";;

126120 
	gSQLITE_CONSTRAINT_COMMITHOOK
:

126121 
zName
 = "SQLITE_CONSTRAINT_COMMITHOOK"; ;

126122 
	gSQLITE_CONSTRAINT_VTAB
: 
zName
 = "SQLITE_CONSTRAINT_VTAB"; ;

126123 
	gSQLITE_CONSTRAINT_FUNCTION
:

126124 
zName
 = "SQLITE_CONSTRAINT_FUNCTION"; ;

126125 
	gSQLITE_CONSTRAINT_ROWID
: 
zName
 = "SQLITE_CONSTRAINT_ROWID"; ;

126126 
	gSQLITE_MISMATCH
: 
zName
 = "SQLITE_MISMATCH"; ;

126127 
	gSQLITE_MISUSE
: 
zName
 = "SQLITE_MISUSE"; ;

126128 
	gSQLITE_NOLFS
: 
zName
 = "SQLITE_NOLFS"; ;

126129 
	gSQLITE_AUTH
: 
zName
 = "SQLITE_AUTH"; ;

126130 
	gSQLITE_FORMAT
: 
zName
 = "SQLITE_FORMAT"; ;

126131 
	gSQLITE_RANGE
: 
zName
 = "SQLITE_RANGE"; ;

126132 
	gSQLITE_NOTADB
: 
zName
 = "SQLITE_NOTADB"; ;

126133 
	gSQLITE_ROW
: 
zName
 = "SQLITE_ROW"; ;

126134 
	gSQLITE_NOTICE
: 
zName
 = "SQLITE_NOTICE"; ;

126135 
	gSQLITE_NOTICE_RECOVER_WAL
: 
zName
 = "SQLITE_NOTICE_RECOVER_WAL";;

126136 
	gSQLITE_NOTICE_RECOVER_ROLLBACK
:

126137 
zName
 = "SQLITE_NOTICE_RECOVER_ROLLBACK"; ;

126138 
	gSQLITE_WARNING
: 
zName
 = "SQLITE_WARNING"; ;

126139 
	gSQLITE_WARNING_AUTOINDEX
: 
zName
 = "SQLITE_WARNING_AUTOINDEX"; ;

126140 
	gSQLITE_DONE
: 
zName
 = "SQLITE_DONE"; ;

126143 ifÐ
	gzName
==0 ){

126144 
zBuf
[50];

126145 
sql™e3_¢´štf
((
zBuf
), zBuf, "SQLITE_UNKNOWN(%d)", 
ÜigRc
);

126146 
	gzName
 = 
zBuf
;

126148  
	gzName
;

126156 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3E¼SŒ
(
rc
){

126157 cÚ¡ * cÚ¡ 
	gaMsg
[] = {

126186 cÚ¡ *
	gzE¼
 = "unknownƒrror";

126187  
	grc
 ){

126188 
	gSQLITE_ABORT_ROLLBACK
: {

126189 
zE¼
 = "abort dueo ROLLBACK";

126193 
rc
 &= 0xff;

126194 ifÐ
ALWAYS
(
rc
>=0è&&„c<
A¼aySize
(
aMsg
) &&‡Msg[rc]!=0 ){

126195 
zE¼
 = 
aMsg
[
rc
];

126200  
	gzE¼
;

126209 
sql™eDeçuÉBusyC®lback
(

126210 *
±r
,

126211 
couÁ


126213 #ià
SQLITE_OS_WIN
 || (
defšed
(
HAVE_USLEEP
) && HAVE_USLEEP)

126214 cÚ¡ 
u8
 
	gd–ays
[] =

126216 cÚ¡ 
u8
 
	gtÙ®s
[] =

126218 
	#NDELAY
 
	`A¼aySize
(
d–ays
)

	)

126219 
sql™e3
 *
	gdb
 = (sql™e3 *)
±r
;

126220 
	gtimeout
 = 
db
->
busyTimeout
;

126221 
	gd–ay
, 
	g´iÜ
;

126223 
as£¹
Ð
couÁ
>=0 );

126224 ifÐ
	gcouÁ
 < 
	gNDELAY
 ){

126225 
	gd–ay
 = 
d–ays
[
couÁ
];

126226 
	g´iÜ
 = 
tÙ®s
[
couÁ
];

126228 
	gd–ay
 = 
d–ays
[
NDELAY
-1];

126229 
	g´iÜ
 = 
tÙ®s
[
NDELAY
-1] + 
d–ay
*(
couÁ
-(NDELAY-1));

126231 ifÐ
	g´iÜ
 + 
	gd–ay
 > 
	gtimeout
 ){

126232 
	gd–ay
 = 
timeout
 - 
´iÜ
;

126233 ifÐ
	gd–ay
<=0 )  0;

126235 
sql™e3OsSË•
(
db
->
pVfs
, 
d–ay
*1000);

126238 
sql™e3
 *
	gdb
 = (sql™e3 *)
±r
;

126239 
	gtimeout
 = ((
sql™e3
 *)
±r
)->
busyTimeout
;

126240 ifÐ(
	gcouÁ
+1)*1000 > 
	gtimeout
 ){

126243 
sql™e3OsSË•
(
db
->
pVfs
, 1000000);

126255 
SQLITE_PRIVATE
 
sql™e3InvokeBusyHªdËr
(
BusyHªdËr
 *
p
){

126256 
	grc
;

126257 ifÐ
NEVER
(
p
==0è||…->
xFunc
==0 ||…->
nBusy
<0 )  0;

126258 
	grc
 = 
p
->
xFunc
Õ->
pArg
,…->
nBusy
);

126259 ifÐ
	grc
==0 ){

126260 
p
->
nBusy
 = -1;

126262 
	gp
->
	gnBusy
++;

126264  
	grc
;

126271 
SQLITE_API
 
sql™e3_busy_hªdËr
(

126272 
sql™e3
 *
db
,

126273 (*
xBusy
)(*,),

126274 *
pArg


126276 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126277 
	gdb
->
	gbusyHªdËr
.
	gxFunc
 = 
xBusy
;

126278 
	gdb
->
	gbusyHªdËr
.
	gpArg
 = 
pArg
;

126279 
	gdb
->
	gbusyHªdËr
.
	gnBusy
 = 0;

126280 
	gdb
->
	gbusyTimeout
 = 0;

126281 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126282  
	gSQLITE_OK
;

126285 #iâdeà
SQLITE_OMIT_PROGRESS_CALLBACK


126291 
SQLITE_API
 
sql™e3_´og»ss_hªdËr
(

126292 
sql™e3
 *
db
,

126293 
nOps
,

126294 (*
xProg»ss
)(*),

126295 *
pArg


126297 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126298 ifÐ
	gnOps
>0 ){

126299 
	gdb
->
	gxProg»ss
 = 
xProg»ss
;

126300 
	gdb
->
	gnProg»ssOps
 = ()
nOps
;

126301 
	gdb
->
	gpProg»ssArg
 = 
pArg
;

126303 
	gdb
->
	gxProg»ss
 = 0;

126304 
	gdb
->
	gnProg»ssOps
 = 0;

126305 
	gdb
->
	gpProg»ssArg
 = 0;

126307 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126316 
SQLITE_API
 
sql™e3_busy_timeout
(
sql™e3
 *
db
, 
ms
){

126317 ifÐ
	gms
>0 ){

126318 
sql™e3_busy_hªdËr
(
db
, 
sql™eDeçuÉBusyC®lback
, (*)db);

126319 
	gdb
->
	gbusyTimeout
 = 
ms
;

126321 
sql™e3_busy_hªdËr
(
db
, 0, 0);

126323  
	gSQLITE_OK
;

126329 
SQLITE_API
 
sql™e3_š‹¼u±
(
sql™e3
 *
db
){

126330 
	gdb
->
	gu1
.
	gisIÁ”ru±ed
 = 1;

126340 
SQLITE_PRIVATE
 
sql™e3C»©eFunc
(

126341 
sql™e3
 *
db
,

126342 cÚ¡ *
zFunùiÚName
,

126343 
nArg
,

126344 
’c
,

126345 *
pU£rD©a
,

126346 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126347 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126348 (*
xFš®
)(
sql™e3_cÚ‹xt
*),

126349 
FuncDe¡ruùÜ
 *
pDe¡ruùÜ


126351 
FuncDef
 *
	gp
;

126352 
	gnName
;

126353 
	gexŒaFÏgs
;

126355 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

126356 ifÐ
	gzFunùiÚName
==0 ||

126357 (
xFunc
 && (
xFš®
 || 
xS‹p
)) ||

126358 (!
xFunc
 && (
xFš®
 && !
xS‹p
)) ||

126359 (!
xFunc
 && (!
xFš®
 && 
xS‹p
)) ||

126360 (
nArg
<-1 ||‚Arg>
SQLITE_MAX_FUNCTION_ARG
) ||

126361 (255<(
nName
 = 
sql™e3SŒËn30
Ð
zFunùiÚName
))) ){

126362  
SQLITE_MISUSE_BKPT
;

126365 
as£¹
Ð
SQLITE_FUNC_CONSTANT
==
SQLITE_DETERMINISTIC
 );

126366 
	gexŒaFÏgs
 = 
’c
 & 
SQLITE_DETERMINISTIC
;

126367 
	g’c
 &ð(
SQLITE_FUNC_ENCMASK
|
SQLITE_ANY
);

126369 #iâdeà
SQLITE_OMIT_UTF16


126377 ifÐ
	g’c
==
SQLITE_UTF16
 ){

126378 
’c
 = 
SQLITE_UTF16NATIVE
;

126379 }ifÐ
	g’c
==
SQLITE_ANY
 ){

126380 
rc
;

126381 
	grc
 = 
sql™e3C»©eFunc
(
db
, 
zFunùiÚName
, 
nArg
, 
SQLITE_UTF8
|
exŒaFÏgs
,

126382 
pU£rD©a
, 
xFunc
, 
xS‹p
, 
xFš®
, 
pDe¡ruùÜ
);

126383 ifÐ
	grc
==
SQLITE_OK
 ){

126384 
rc
 = 
sql™e3C»©eFunc
(
db
, 
zFunùiÚName
, 
nArg
, 
SQLITE_UTF16LE
|
exŒaFÏgs
,

126385 
pU£rD©a
, 
xFunc
, 
xS‹p
, 
xFš®
, 
pDe¡ruùÜ
);

126387 ifÐ
	grc
!=
SQLITE_OK
 ){

126388  
rc
;

126390 
	g’c
 = 
SQLITE_UTF16BE
;

126393 
	g’c
 = 
SQLITE_UTF8
;

126401 
	gp
 = 
sql™e3FšdFunùiÚ
(
db
, 
zFunùiÚName
, 
nName
, 
nArg
, (
u8
)
’c
, 0);

126402 ifÐ
	gp
 && (p->
	gfuncFÏgs
 & 
	gSQLITE_FUNC_ENCMASK
)==
’c
 && 
p
->
nArg
==nArg ){

126403 ifÐ
db
->
nVdbeAùive
 ){

126404 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_BUSY
,

126406 
as£¹
Ð!
db
->
m®locFažed
 );

126407  
	gSQLITE_BUSY
;

126409 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

126413 
	gp
 = 
sql™e3FšdFunùiÚ
(
db
, 
zFunùiÚName
, 
nName
, 
nArg
, (
u8
)
’c
, 1);

126414 
as£¹
(
p
 || 
db
->
m®locFažed
);

126415 ifÐ!
	gp
 ){

126416  
	gSQLITE_NOMEM
;

126421 
funùiÚDe¡roy
(
db
, 
p
);

126423 ifÐ
	gpDe¡ruùÜ
 ){

126424 
	gpDe¡ruùÜ
->
	gnRef
++;

126426 
	gp
->
	gpDe¡ruùÜ
 = 
pDe¡ruùÜ
;

126427 
	gp
->
	gfuncFÏgs
 = (
p
->
funcFÏgs
 & 
SQLITE_FUNC_ENCMASK
è| 
exŒaFÏgs
;

126428 
‹¡ÿ£
Ð
p
->
funcFÏgs
 & 
SQLITE_DETERMINISTIC
 );

126429 
	gp
->
	gxFunc
 = 
xFunc
;

126430 
	gp
->
	gxS‹p
 = 
xS‹p
;

126431 
	gp
->
	gxFš®ize
 = 
xFš®
;

126432 
	gp
->
	gpU£rD©a
 = 
pU£rD©a
;

126433 
	gp
->
	gnArg
 = (
u16
)
nArg
;

126434  
	gSQLITE_OK
;

126440 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ
(

126441 
sql™e3
 *
db
,

126442 cÚ¡ *
zFunc
,

126443 
nArg
,

126444 
’c
,

126445 *
p
,

126446 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126447 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126448 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

126450  
sql™e3_ü—‹_funùiÚ_v2
(
db
, 
zFunc
, 
nArg
, 
’c
, 
p
, 
xFunc
, 
xS‹p
,

126451 
xFš®
, 0);

126454 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ_v2
(

126455 
sql™e3
 *
db
,

126456 cÚ¡ *
zFunc
,

126457 
nArg
,

126458 
’c
,

126459 *
p
,

126460 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126461 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
 **),

126462 (*
xFš®
)(
sql™e3_cÚ‹xt
*),

126463 (*
xDe¡roy
)(*)

126465 
	grc
 = 
SQLITE_ERROR
;

126466 
FuncDe¡ruùÜ
 *
	gpArg
 = 0;

126467 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126468 ifÐ
	gxDe¡roy
 ){

126469 
	gpArg
 = (
FuncDe¡ruùÜ
 *)
sql™e3DbM®locZ”o
(
db
, (FuncDestructor));

126470 ifÐ!
	gpArg
 ){

126471 
xDe¡roy
(
p
);

126472 
	gout
;

126474 
	gpArg
->
	gxDe¡roy
 = 
xDe¡roy
;

126475 
	gpArg
->
	gpU£rD©a
 = 
p
;

126477 
	grc
 = 
sql™e3C»©eFunc
(
db
, 
zFunc
, 
nArg
, 
’c
, 
p
, 
xFunc
, 
xS‹p
, 
xFš®
, 
pArg
);

126478 ifÐ
	gpArg
 &&…Arg->
	gnRef
==0 ){

126479 
as£¹
Ð
rc
!=
SQLITE_OK
 );

126480 
xDe¡roy
(
p
);

126481 
sql™e3DbF»e
(
db
, 
pArg
);

126484 
	gout
:

126485 
rc
 = 
sql™e3ApiEx™
(
db
,„c);

126486 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126487  
	grc
;

126490 #iâdeà
SQLITE_OMIT_UTF16


126491 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ16
(

126492 
sql™e3
 *
db
,

126493 cÚ¡ *
zFunùiÚName
,

126494 
nArg
,

126495 
eTextR•
,

126496 *
p
,

126497 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

126498 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

126499 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

126501 
	grc
;

126502 *
	gzFunc8
;

126503 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126504 
as£¹
Ð!
db
->
m®locFažed
 );

126505 
	gzFunc8
 = 
sql™e3Utf16to8
(
db
, 
zFunùiÚName
, -1, 
SQLITE_UTF16NATIVE
);

126506 
	grc
 = 
sql™e3C»©eFunc
(
db
, 
zFunc8
, 
nArg
, 
eTextR•
, 
p
, 
xFunc
, 
xS‹p
, 
xFš®
,0);

126507 
sql™e3DbF»e
(
db
, 
zFunc8
);

126508 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

126509 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126510  
	grc
;

126527 
SQLITE_API
 
sql™e3_ov”lßd_funùiÚ
(

126528 
sql™e3
 *
db
,

126529 cÚ¡ *
zName
,

126530 
nArg


126532 
	gnName
 = 
sql™e3SŒËn30
(
zName
);

126533 
	grc
 = 
SQLITE_OK
;

126534 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126535 ifÐ
sql™e3FšdFunùiÚ
(
db
, 
zName
, 
nName
, 
nArg
, 
SQLITE_UTF8
, 0)==0 ){

126536 
rc
 = 
sql™e3C»©eFunc
(
db
, 
zName
, 
nArg
, 
SQLITE_UTF8
,

126537 0, 
sql™e3Inv®idFunùiÚ
, 0, 0, 0);

126539 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

126540 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126541  
	grc
;

126544 #iâdeà
SQLITE_OMIT_TRACE


126553 
SQLITE_API
 *
sql™e3_Œaû
(
sql™e3
 *
db
, (*
xT¿û
)(*,cÚ¡ *), *
pArg
){

126554 *
	gpOld
;

126555 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126556 
	gpOld
 = 
db
->
pT¿ûArg
;

126557 
	gdb
->
	gxT¿û
 = 
xT¿û
;

126558 
	gdb
->
	gpT¿ûArg
 = 
pArg
;

126559 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126560  
	gpOld
;

126570 
SQLITE_API
 *
sql™e3_´ofže
(

126571 
sql™e3
 *
db
,

126572 (*
xProfže
)(*,cÚ¡ *,
sql™e_ušt64
),

126573 *
pArg


126575 *
	gpOld
;

126576 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126577 
	gpOld
 = 
db
->
pProfžeArg
;

126578 
	gdb
->
	gxProfže
 = 
xProfže
;

126579 
	gdb
->
	gpProfžeArg
 = 
pArg
;

126580 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126581  
	gpOld
;

126590 
SQLITE_API
 *
sql™e3_comm™_hook
(

126591 
sql™e3
 *
db
,

126592 (*
xC®lback
)(*),

126593 *
pArg


126595 *
	gpOld
;

126596 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126597 
	gpOld
 = 
db
->
pComm™Arg
;

126598 
	gdb
->
	gxComm™C®lback
 = 
xC®lback
;

126599 
	gdb
->
	gpComm™Arg
 = 
pArg
;

126600 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126601  
	gpOld
;

126608 
SQLITE_API
 *
sql™e3_upd©e_hook
(

126609 
sql™e3
 *
db
,

126610 (*
xC®lback
)(*,,cÚ¡ *,cÚ¡ *,
sql™e_št64
),

126611 *
pArg


126613 *
	gpR‘
;

126614 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126615 
	gpR‘
 = 
db
->
pUpd©eArg
;

126616 
	gdb
->
	gxUpd©eC®lback
 = 
xC®lback
;

126617 
	gdb
->
	gpUpd©eArg
 = 
pArg
;

126618 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126619  
	gpR‘
;

126626 
SQLITE_API
 *
sql™e3_rÞlback_hook
(

126627 
sql™e3
 *
db
,

126628 (*
xC®lback
)(*),

126629 *
pArg


126631 *
	gpR‘
;

126632 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126633 
	gpR‘
 = 
db
->
pRÞlbackArg
;

126634 
	gdb
->
	gxRÞlbackC®lback
 = 
xC®lback
;

126635 
	gdb
->
	gpRÞlbackArg
 = 
pArg
;

126636 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126637  
	gpR‘
;

126640 #iâdeà
SQLITE_OMIT_WAL


126647 
SQLITE_PRIVATE
 
sql™e3W®DeçuÉHook
(

126648 *
pCl›ÁD©a
,

126649 
sql™e3
 *
db
,

126650 cÚ¡ *
zDb
,

126651 
nF¿me


126653 ifÐ
	gnF¿me
>=
SQLITE_PTR_TO_INT
(
pCl›ÁD©a
) ){

126654 
sql™e3BegšB’ignM®loc
();

126655 
sql™e3_w®_checkpošt
(
db
, 
zDb
);

126656 
sql™e3EndB’ignM®loc
();

126658  
	gSQLITE_OK
;

126673 
SQLITE_API
 
sql™e3_w®_autocheckpošt
(
sql™e3
 *
db
, 
nF¿me
){

126674 #ifdeà
SQLITE_OMIT_WAL


126675 
UNUSED_PARAMETER
(
db
);

126676 
UNUSED_PARAMETER
(
nF¿me
);

126678 ifÐ
	gnF¿me
>0 ){

126679 
sql™e3_w®_hook
(
db
, 
sql™e3W®DeçuÉHook
, 
SQLITE_INT_TO_PTR
(
nF¿me
));

126681 
sql™e3_w®_hook
(
db
, 0, 0);

126684  
	gSQLITE_OK
;

126691 
SQLITE_API
 *
sql™e3_w®_hook
(

126692 
sql™e3
 *
db
,

126693 (*
xC®lback
)(*, 
sql™e3
*, const *, ),

126694 *
pArg


126696 #iâdeà
SQLITE_OMIT_WAL


126697 *
	gpR‘
;

126698 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126699 
	gpR‘
 = 
db
->
pW®Arg
;

126700 
	gdb
->
	gxW®C®lback
 = 
xC®lback
;

126701 
	gdb
->
	gpW®Arg
 = 
pArg
;

126702 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126703  
	gpR‘
;

126712 
SQLITE_API
 
sql™e3_w®_checkpošt_v2
(

126713 
sql™e3
 *
db
,

126714 cÚ¡ *
zDb
,

126715 
eMode
,

126716 *
²Log
,

126717 *
²Ck±


126719 #ifdeà
SQLITE_OMIT_WAL


126720  
	gSQLITE_OK
;

126722 
	grc
;

126723 
	giDb
 = 
SQLITE_MAX_ATTACHED
;

126726 ifÐ
	g²Log
 ) *pnLog = -1;

126727 ifÐ
	g²Ck±
 ) *pnCkpt = -1;

126729 
as£¹
Ð
SQLITE_CHECKPOINT_FULL
>
SQLITE_CHECKPOINT_PASSIVE
 );

126730 
as£¹
Ð
SQLITE_CHECKPOINT_FULL
<
SQLITE_CHECKPOINT_RESTART
 );

126731 
as£¹
Ð
SQLITE_CHECKPOINT_PASSIVE
+2==
SQLITE_CHECKPOINT_RESTART
 );

126732 ifÐ
	geMode
<
	gSQLITE_CHECKPOINT_PASSIVE
 ||ƒMode>
	gSQLITE_CHECKPOINT_RESTART
 ){

126733  
	gSQLITE_MISUSE
;

126736 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126737 ifÐ
	gzDb
 && zDb[0] ){

126738 
	giDb
 = 
sql™e3FšdDbName
(
db
, 
zDb
);

126740 ifÐ
	giDb
<0 ){

126741 
	grc
 = 
SQLITE_ERROR
;

126742 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_ERROR
, "unknowÀd©aba£: %s", 
zDb
);

126744 
	grc
 = 
sql™e3Checkpošt
(
db
, 
iDb
, 
eMode
, 
²Log
, 
²Ck±
);

126745 
sql™e3E¼Ü
(
db
, 
rc
);

126747 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

126748 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126749  
	grc
;

126759 
SQLITE_API
 
sql™e3_w®_checkpošt
(
sql™e3
 *
db
, cÚ¡ *
zDb
){

126760  
sql™e3_w®_checkpošt_v2
(
db
, 
zDb
, 
SQLITE_CHECKPOINT_PASSIVE
, 0, 0);

126763 #iâdeà
SQLITE_OMIT_WAL


126783 
SQLITE_PRIVATE
 
sql™e3Checkpošt
(
sql™e3
 *
db
, 
iDb
, 
eMode
, *
²Log
, *
²Ck±
){

126784 
	grc
 = 
SQLITE_OK
;

126785 
	gi
;

126786 
	gbBusy
 = 0;

126788 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

126789 
as£¹
Ð!
²Log
 || *pnLog==-1 );

126790 
as£¹
Ð!
²Ck±
 || *pnCkpt==-1 );

126792 
	gi
=0; i<
	gdb
->
	gnDb
 && 
	grc
==
SQLITE_OK
; i++){

126793 ifÐ
	gi
==
iDb
 || iDb==
SQLITE_MAX_ATTACHED
 ){

126794 
rc
 = 
sql™e3BŒ“Checkpošt
(
db
->
aDb
[
i
].
pBt
, 
eMode
, 
²Log
, 
²Ck±
);

126795 
	g²Log
 = 0;

126796 
	g²Ck±
 = 0;

126797 ifÐ
	grc
==
SQLITE_BUSY
 ){

126798 
bBusy
 = 1;

126799 
	grc
 = 
SQLITE_OK
;

126804  (
	grc
==
SQLITE_OK
 && 
bBusy
è? 
SQLITE_BUSY
 : 
rc
;

126827 
SQLITE_PRIVATE
 
sql™e3TempInMemÜy
(cÚ¡ 
sql™e3
 *
db
){

126828 #ià
SQLITE_TEMP_STORE
==1

126829  ( 
	gdb
->
	g‹mp_¡Üe
==2 );

126831 #ià
SQLITE_TEMP_STORE
==2

126832  ( 
	gdb
->
	g‹mp_¡Üe
!=1 );

126834 #ià
SQLITE_TEMP_STORE
==3

126837 #ià
SQLITE_TEMP_STORE
<1 || SQLITE_TEMP_STORE>3

126846 
SQLITE_API
 cÚ¡ *
sql™e3_”rmsg
(
sql™e3
 *
db
){

126847 cÚ¡ *
	gz
;

126848 ifÐ!
	gdb
 ){

126849  
sql™e3E¼SŒ
(
SQLITE_NOMEM
);

126851 ifÐ!
sql™e3SaãtyCheckSickOrOk
(
db
) ){

126852  
sql™e3E¼SŒ
(
SQLITE_MISUSE_BKPT
);

126854 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126855 ifÐ
	gdb
->
	gm®locFažed
 ){

126856 
	gz
 = 
sql™e3E¼SŒ
(
SQLITE_NOMEM
);

126858 
‹¡ÿ£
Ð
db
->
pE¼
==0 );

126859 
	gz
 = (*)
sql™e3_v®ue_‹xt
(
db
->
pE¼
);

126860 
as£¹
Ð!
db
->
m®locFažed
 );

126861 ifÐ
	gz
==0 ){

126862 
z
 = 
sql™e3E¼SŒ
(
db
->
”rCode
);

126865 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126866  
	gz
;

126869 #iâdeà
SQLITE_OMIT_UTF16


126874 
SQLITE_API
 cÚ¡ *
sql™e3_”rmsg16
(
sql™e3
 *
db
){

126875 cÚ¡ 
u16
 
	goutOfMem
[] = {

126878 cÚ¡ 
u16
 
	gmisu£
[] = {

126887 cÚ¡ *
	gz
;

126888 ifÐ!
	gdb
 ){

126889  (*)
	goutOfMem
;

126891 ifÐ!
sql™e3SaãtyCheckSickOrOk
(
db
) ){

126892  (*)
	gmisu£
;

126894 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

126895 ifÐ
	gdb
->
	gm®locFažed
 ){

126896 
	gz
 = (*)
outOfMem
;

126898 
	gz
 = 
sql™e3_v®ue_‹xt16
(
db
->
pE¼
);

126899 ifÐ
	gz
==0 ){

126900 
sql™e3E¼ÜW™hMsg
(
db
, db->
”rCode
, 
sql™e3E¼SŒ
(db->errCode));

126901 
	gz
 = 
sql™e3_v®ue_‹xt16
(
db
->
pE¼
);

126908 
	gdb
->
	gm®locFažed
 = 0;

126910 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

126911  
	gz
;

126919 
SQLITE_API
 
sql™e3_”rcode
(
sql™e3
 *
db
){

126920 ifÐ
	gdb
 && !
sql™e3SaãtyCheckSickOrOk
(
db
) ){

126921  
	gSQLITE_MISUSE_BKPT
;

126923 ifÐ!
	gdb
 || db->
	gm®locFažed
 ){

126924  
	gSQLITE_NOMEM
;

126926  
	gdb
->
	g”rCode
 & db->
	g”rMask
;

126928 
SQLITE_API
 
sql™e3_ex‹nded_”rcode
(
sql™e3
 *
db
){

126929 ifÐ
	gdb
 && !
sql™e3SaãtyCheckSickOrOk
(
db
) ){

126930  
	gSQLITE_MISUSE_BKPT
;

126932 ifÐ!
	gdb
 || db->
	gm®locFažed
 ){

126933  
	gSQLITE_NOMEM
;

126935  
	gdb
->
	g”rCode
;

126943 
SQLITE_API
 cÚ¡ *
sql™e3_”r¡r
(
rc
){

126944  
sql™e3E¼SŒ
(
rc
);

126950 
šv®id©eCachedKeyInfo
(
sql™e3
 *
db
){

126951 
Db
 *
	gpDb
;

126952 
	giDb
;

126953 
HashEËm
 *
	gk
;

126954 
TabË
 *
	gpTab
;

126955 
Index
 *
	gpIdx
;

126957 
	giDb
=0, 
	gpDb
=
db
->
aDb
; iDb<
	gdb
->
	gnDb
; iDb++,…Db++){

126958 ifÐ
	gpDb
->
	gpBt
==0 ) ;

126959 
sql™e3BŒ“EÁ”
(
pDb
->
pBt
);

126960 
	gk
=
sql™eHashFœ¡
(&
pDb
->
pSchema
->
tblHash
); k; k=
sql™eHashNext
(
k
)){

126961 
pTab
 = (
TabË
*)
sql™eHashD©a
(
k
);

126962 
	gpIdx
=
pTab
->
pIndex
;…Idx;…Idx=
pIdx
->
pNext
){

126963 ifÐ
pIdx
->
pKeyInfo
 &&…Idx->pKeyInfo->
db
==db ){

126964 
sql™e3KeyInfoUÄef
(
pIdx
->
pKeyInfo
);

126965 
	gpIdx
->
	gpKeyInfo
 = 0;

126969 
sql™e3BŒ“L—ve
(
pDb
->
pBt
);

126977 
ü—‹CÞÏtiÚ
(

126978 
sql™e3
* 
db
,

126979 cÚ¡ *
zName
,

126980 
u8
 
’c
,

126981 * 
pCtx
,

126982 (*
xCom·»
)(*,,const *,,const *),

126983 (*
xD–
)(*)

126985 
CÞlSeq
 *
	gpCÞl
;

126986 
	g’c2
;

126988 
as£¹
Ð
sql™e3_mu‹x_h–d
(
db
->
mu‹x
) );

126994 
	g’c2
 = 
’c
;

126995 
‹¡ÿ£
Ð
’c2
==
SQLITE_UTF16
 );

126996 
‹¡ÿ£
Ð
’c2
==
SQLITE_UTF16_ALIGNED
 );

126997 ifÐ
	g’c2
==
SQLITE_UTF16
 || 
’c2
==
SQLITE_UTF16_ALIGNED
 ){

126998 
’c2
 = 
SQLITE_UTF16NATIVE
;

127000 ifÐ
	g’c2
<
	gSQLITE_UTF8
 ||ƒnc2>
	gSQLITE_UTF16BE
 ){

127001  
	gSQLITE_MISUSE_BKPT
;

127008 
	gpCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, (
u8
)
’c2
, 
zName
, 0);

127009 ifÐ
	gpCÞl
 &&…CÞl->
	gxCmp
 ){

127010 ifÐ
	gdb
->
	gnVdbeAùive
 ){

127011 
sql™e3E¼ÜW™hMsg
(
db
, 
SQLITE_BUSY
,

127013  
	gSQLITE_BUSY
;

127015 
sql™e3ExpœeP»·»dS‹m’ts
(
db
);

127016 
šv®id©eCachedKeyInfo
(
db
);

127024 ifÐ(
	gpCÞl
->
	g’c
 & ~
	gSQLITE_UTF16_ALIGNED
)==
’c2
 ){

127025 
CÞlSeq
 *
aCÞl
 = 
sql™e3HashFšd
(&
db
->
aCÞlSeq
, 
zName
);

127026 
	gj
;

127027 
	gj
=0; j<3; j++){

127028 
CÞlSeq
 *
	gp
 = &
aCÞl
[
j
];

127029 ifÐ
	gp
->
	g’c
==
pCÞl
->
’c
 ){

127030 ifÐ
p
->
xD–
 ){

127031 
p
->
xD–
Õ->
pU£r
);

127033 
	gp
->
	gxCmp
 = 0;

127039 
	gpCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, (
u8
)
’c2
, 
zName
, 1);

127040 ifÐ
	gpCÞl
==0 )  
SQLITE_NOMEM
;

127041 
	gpCÞl
->
	gxCmp
 = 
xCom·»
;

127042 
	gpCÞl
->
	gpU£r
 = 
pCtx
;

127043 
	gpCÞl
->
	gxD–
 = 
xD–
;

127044 
	gpCÞl
->
	g’c
 = (
u8
)(
’c2
 | (
’c
 & 
SQLITE_UTF16_ALIGNED
));

127045 
sql™e3E¼Ü
(
db
, 
SQLITE_OK
);

127046  
	gSQLITE_OK
;

127055 cÚ¡ 
	gaH¬dLim™
[] = {

127056 
SQLITE_MAX_LENGTH
,

127057 
SQLITE_MAX_SQL_LENGTH
,

127058 
SQLITE_MAX_COLUMN
,

127059 
SQLITE_MAX_EXPR_DEPTH
,

127060 
SQLITE_MAX_COMPOUND_SELECT
,

127061 
SQLITE_MAX_VDBE_OP
,

127062 
SQLITE_MAX_FUNCTION_ARG
,

127063 
SQLITE_MAX_ATTACHED
,

127064 
SQLITE_MAX_LIKE_PATTERN_LENGTH
,

127065 
SQLITE_MAX_VARIABLE_NUMBER
,

127066 
SQLITE_MAX_TRIGGER_DEPTH
,

127067 
SQLITE_MAX_WORKER_THREADS
,

127073 #ià
SQLITE_MAX_LENGTH
<100

127074 #”rÜ 
SQLITE_MAX_LENGTH
 
mu¡
 
be
 
©
 
Ëa¡
 100

127076 #ià
SQLITE_MAX_SQL_LENGTH
<100

127077 #”rÜ 
SQLITE_MAX_SQL_LENGTH
 
mu¡
 
be
 
©
 
Ëa¡
 100

127079 #ià
SQLITE_MAX_SQL_LENGTH
>
SQLITE_MAX_LENGTH


127080 #”rÜ 
SQLITE_MAX_SQL_LENGTH
 
mu¡
 
nÙ
 
be
 
g»©”
 
thª
 
SQLITE_MAX_LENGTH


127082 #ià
SQLITE_MAX_COMPOUND_SELECT
<2

127083 #”rÜ 
SQLITE_MAX_COMPOUND_SELECT
 
mu¡
 
be
 
©
 
Ëa¡
 2

127085 #ià
SQLITE_MAX_VDBE_OP
<40

127086 #”rÜ 
SQLITE_MAX_VDBE_OP
 
mu¡
 
be
 
©
 
Ëa¡
 40

127088 #ià
SQLITE_MAX_FUNCTION_ARG
<0 || SQLITE_MAX_FUNCTION_ARG>1000

127089 #”rÜ 
SQLITE_MAX_FUNCTION_ARG
 
mu¡
 
be
 
b‘w“n
 0 
ªd
 1000

127091 #ià
SQLITE_MAX_ATTACHED
<0 || SQLITE_MAX_ATTACHED>125

127092 #”rÜ 
SQLITE_MAX_ATTACHED
 
mu¡
 
be
 
b‘w“n
 0 
ªd
 125

127094 #ià
SQLITE_MAX_LIKE_PATTERN_LENGTH
<1

127095 #”rÜ 
SQLITE_MAX_LIKE_PATTERN_LENGTH
 
mu¡
 
be
 
©
 
Ëa¡
 1

127097 #ià
SQLITE_MAX_COLUMN
>32767

127098 #”rÜ 
SQLITE_MAX_COLUMN
 
mu¡
 
nÙ
 
exûed
 32767

127100 #ià
SQLITE_MAX_TRIGGER_DEPTH
<1

127101 #”rÜ 
SQLITE_MAX_TRIGGER_DEPTH
 
mu¡
 
be
 
©
 
Ëa¡
 1

127103 #ià
SQLITE_MAX_WORKER_THREADS
<0 || SQLITE_MAX_WORKER_THREADS>50

127104 #”rÜ 
SQLITE_MAX_WORKER_THREADS
 
mu¡
 
be
 
b‘w“n
 0 
ªd
 50

127118 
SQLITE_API
 
sql™e3_lim™
(
sql™e3
 *
db
, 
lim™Id
, 
ÃwLim™
){

127119 
	gÞdLim™
;

127127 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_LENGTH
]==
SQLITE_MAX_LENGTH
 );

127128 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_SQL_LENGTH
]==
SQLITE_MAX_SQL_LENGTH
 );

127129 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_COLUMN
]==
SQLITE_MAX_COLUMN
 );

127130 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_EXPR_DEPTH
]==
SQLITE_MAX_EXPR_DEPTH
 );

127131 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_COMPOUND_SELECT
]==
SQLITE_MAX_COMPOUND_SELECT
);

127132 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_VDBE_OP
]==
SQLITE_MAX_VDBE_OP
 );

127133 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_FUNCTION_ARG
]==
SQLITE_MAX_FUNCTION_ARG
 );

127134 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_ATTACHED
]==
SQLITE_MAX_ATTACHED
 );

127135 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_LIKE_PATTERN_LENGTH
]==

127136 
SQLITE_MAX_LIKE_PATTERN_LENGTH
 );

127137 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_VARIABLE_NUMBER
]==
SQLITE_MAX_VARIABLE_NUMBER
);

127138 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_TRIGGER_DEPTH
]==
SQLITE_MAX_TRIGGER_DEPTH
 );

127139 
as£¹
Ð
aH¬dLim™
[
SQLITE_LIMIT_WORKER_THREADS
]==
SQLITE_MAX_WORKER_THREADS
 );

127140 
as£¹
Ð
SQLITE_LIMIT_WORKER_THREADS
==(
SQLITE_N_LIMIT
-1) );

127143 ifÐ
	glim™Id
<0 ||†im™Id>=
SQLITE_N_LIMIT
 ){

127146 
	gÞdLim™
 = 
db
->
aLim™
[
lim™Id
];

127147 ifÐ
	gÃwLim™
>=0 ){

127148 ifÐ
ÃwLim™
>
aH¬dLim™
[
lim™Id
] ){

127149 
ÃwLim™
 = 
aH¬dLim™
[
lim™Id
];

127151 
	gdb
->
	gaLim™
[
lim™Id
] = 
ÃwLim™
;

127153  
	gÞdLim™
;

127180 
SQLITE_PRIVATE
 
sql™e3P¬£Uri
(

127181 cÚ¡ *
zDeçuÉVfs
,

127182 cÚ¡ *
zUri
,

127183 *
pFÏgs
,

127184 
sql™e3_vfs
 **
µVfs
,

127185 **
pzFže
,

127186 **
pzE¼Msg


127188 
	grc
 = 
SQLITE_OK
;

127189 
	gæags
 = *
pFÏgs
;

127190 cÚ¡ *
	gzVfs
 = 
zDeçuÉVfs
;

127191 *
	gzFže
;

127192 
	gc
;

127193 
	gnUri
 = 
sql™e3SŒËn30
(
zUri
);

127195 
as£¹
Ð*
pzE¼Msg
==0 );

127197 ifÐ((
	gæags
 & 
	gSQLITE_OPEN_URI
è|| 
	gsql™e3Glob®CÚfig
.
	gbO³nUri
)

127198 && 
	gnUri
>=5 && 
memcmp
(
zUri
, "file:", 5)==0

127200 *
zO±
;

127201 
	geS‹
;

127202 
	giIn
;

127203 
	giOut
 = 0;

127204 
	gnBy‹
 = 
nUri
+2;

127208 
	gæags
 |ð
SQLITE_OPEN_URI
;

127210 
	giIn
=0; iIn<
	gnUri
; iIn++è
	gnBy‹
 +ð(
zUri
[
iIn
]=='&');

127211 
	gzFže
 = 
sql™e3_m®loc
(
nBy‹
);

127212 ifÐ!
	gzFže
 )  
	gSQLITE_NOMEM
;

127214 
	giIn
 = 5;

127215 #iâdeà
SQLITE_ALLOW_URI_AUTHORITY


127217 ifÐ
	gzUri
[5]=='/' && 
zUri
[6]=='/' ){

127218 
iIn
 = 7;

127219  
	gzUri
[
iIn
] && zUri[iIn]!='/' ) iIn++;

127220 ifÐ
	giIn
!=7 && (
iIn
!=16 || 
memcmp
("loÿlho¡", &
zUri
[7], 9)) ){

127221 *
	gpzE¼Msg
 = 
sql™e3_m´štf
("invalid uri‡uthority: %.*s",

127222 
iIn
-7, &
zUri
[7]);

127223 
	grc
 = 
SQLITE_ERROR
;

127224 
	g·r£_uri_out
;

127239 
	geS‹
 = 0;

127240  (
	gc
 = 
zUri
[
iIn
])!=0 && 
c
!='#' ){

127241 
iIn
++;

127242 ifÐ
	gc
=='%'

127243 && 
sql™e3Isxdig™
(
zUri
[
iIn
])

127244 && 
sql™e3Isxdig™
(
zUri
[
iIn
+1])

127246 
où‘
 = (
sql™e3HexToIÁ
(
zUri
[
iIn
++]) << 4);

127247 
	goù‘
 +ð
sql™e3HexToIÁ
(
zUri
[
iIn
++]);

127249 
as£¹
Ð
où‘
>=0 && octet<256 );

127250 ifÐ
	goù‘
==0 ){

127255  (
c
 = 
zUri
[
iIn
])!=0 && c!='#'

127256 && (
eS‹
!=0 || 
c
!='?')

127257 && (
eS‹
!=1 || (
c
!='=' && c!='&'))

127258 && (
eS‹
!=2 || 
c
!='&')

127260 
iIn
++;

127264 
	gc
 = 
où‘
;

127265 }ifÐ
	geS‹
==1 && (
c
=='&' || c=='=') ){

127266 ifÐ
zFže
[
iOut
-1]==0 ){

127268  
zUri
[
iIn
] && zUri[iIn]!='#' && zUri[iIn-1]!='&' ) iIn++;

127271 ifÐ
	gc
=='&' ){

127272 
zFže
[
iOut
++] = '\0';

127274 
	geS‹
 = 2;

127276 
	gc
 = 0;

127277 }ifÐ(
	geS‹
==0 && 
c
=='?'è|| (
eS‹
==2 && c=='&') ){

127278 
c
 = 0;

127279 
	geS‹
 = 1;

127281 
	gzFže
[
iOut
++] = 
c
;

127283 ifÐ
	geS‹
==1 ) 
zFže
[
iOut
++] = '\0';

127284 
	gzFže
[
iOut
++] = '\0';

127285 
	gzFže
[
iOut
++] = '\0';

127291 
	gzO±
 = &
zFže
[
sql™e3SŒËn30
(zFile)+1];

127292  
	gzO±
[0] ){

127293 
	gnO±
 = 
sql™e3SŒËn30
(
zO±
);

127294 *
	gzV®
 = &
zO±
[
nO±
+1];

127295 
	gnV®
 = 
sql™e3SŒËn30
(
zV®
);

127297 ifÐ
	gnO±
==3 && 
memcmp
("vfs", 
zO±
, 3)==0 ){

127298 
zVfs
 = 
zV®
;

127300 
	sO³nMode
 {

127301 cÚ¡ *
	gz
;

127302 
	gmode
;

127303 } *
	gaMode
 = 0;

127304 *
	gzModeTy³
 = 0;

127305 
	gmask
 = 0;

127306 
	glim™
 = 0;

127308 ifÐ
	gnO±
==5 && 
memcmp
("ÿche", 
zO±
, 5)==0 ){

127309 
O³nMode
 
aCacheMode
[] = {

127310 { "sh¬ed", 
SQLITE_OPEN_SHAREDCACHE
 },

127311 { "´iv©e", 
SQLITE_OPEN_PRIVATECACHE
 },

127315 
	gmask
 = 
SQLITE_OPEN_SHAREDCACHE
|
SQLITE_OPEN_PRIVATECACHE
;

127316 
	gaMode
 = 
aCacheMode
;

127317 
	glim™
 = 
mask
;

127318 
	gzModeTy³
 = "cache";

127320 ifÐ
	gnO±
==4 && 
memcmp
("mode", 
zO±
, 4)==0 ){

127321 
O³nMode
 
aO³nMode
[] = {

127322 { "ro", 
SQLITE_OPEN_READONLY
 },

127323 { "rw", 
SQLITE_OPEN_READWRITE
 },

127324 { "rwc", 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
 },

127325 { "memÜy", 
SQLITE_OPEN_MEMORY
 },

127329 
	gmask
 = 
SQLITE_OPEN_READONLY
 | 
SQLITE_OPEN_READWRITE


127330 | 
SQLITE_OPEN_CREATE
 | 
SQLITE_OPEN_MEMORY
;

127331 
	gaMode
 = 
aO³nMode
;

127332 
	glim™
 = 
mask
 & 
æags
;

127333 
	gzModeTy³
 = "access";

127336 ifÐ
	gaMode
 ){

127337 
	gi
;

127338 
	gmode
 = 0;

127339 
	gi
=0; 
	gaMode
[
i
].
	gz
; i++){

127340 cÚ¡ *
	gz
 = 
aMode
[
i
].
z
;

127341 ifÐ
	gnV®
==
sql™e3SŒËn30
(
z
è&& 0==
memcmp
(
zV®
, z, 
nV®
) ){

127342 
	gmode
 = 
aMode
[
i
].
mode
;

127346 ifÐ
	gmode
==0 ){

127347 *
pzE¼Msg
 = 
sql™e3_m´štf
("nØsuch % mode: %s", 
zModeTy³
, 
zV®
);

127348 
	grc
 = 
SQLITE_ERROR
;

127349 
	g·r£_uri_out
;

127351 ifÐ(
	gmode
 & ~
	gSQLITE_OPEN_MEMORY
)>
	glim™
 ){

127352 *
	gpzE¼Msg
 = 
sql™e3_m´štf
("%s mode‚ot‡llowed: %s",

127353 
zModeTy³
, 
zV®
);

127354 
	grc
 = 
SQLITE_PERM
;

127355 
	g·r£_uri_out
;

127357 
	gæags
 = (
æags
 & ~
mask
è| 
mode
;

127361 
	gzO±
 = &
zV®
[
nV®
+1];

127365 
	gzFže
 = 
sql™e3_m®loc
(
nUri
+2);

127366 ifÐ!
	gzFže
 )  
	gSQLITE_NOMEM
;

127367 
memýy
(
zFže
, 
zUri
, 
nUri
);

127368 
	gzFže
[
nUri
] = '\0';

127369 
	gzFže
[
nUri
+1] = '\0';

127370 
	gæags
 &ð~
SQLITE_OPEN_URI
;

127373 *
	gµVfs
 = 
sql™e3_vfs_fšd
(
zVfs
);

127374 ifÐ*
	gµVfs
==0 ){

127375 *
pzE¼Msg
 = 
sql™e3_m´štf
("nØsuch vfs: %s", 
zVfs
);

127376 
	grc
 = 
SQLITE_ERROR
;

127378 
	g·r£_uri_out
:

127379 ifÐ
rc
!=
SQLITE_OK
 ){

127380 
sql™e3_ä“
(
zFže
);

127381 
	gzFže
 = 0;

127383 *
	gpFÏgs
 = 
æags
;

127384 *
	gpzFže
 = 
zFže
;

127385  
	grc
;

127394 
Ý’D©aba£
(

127395 cÚ¡ *
zFž’ame
,

127396 
sql™e3
 **
µDb
,

127397 
æags
,

127398 cÚ¡ *
zVfs


127400 
sql™e3
 *
	gdb
;

127401 
	grc
;

127402 
	gisTh»ad§ã
;

127403 *
	gzO³n
 = 0;

127404 *
	gzE¼Msg
 = 0;

127406 *
	gµDb
 = 0;

127407 #iâdeà
SQLITE_OMIT_AUTOINIT


127408 
	grc
 = 
sql™e3_š™Ÿlize
();

127409 ifÐ
	grc
 ) „c;

127422 
as£¹
Ð
SQLITE_OPEN_READONLY
 == 0x01 );

127423 
as£¹
Ð
SQLITE_OPEN_READWRITE
 == 0x02 );

127424 
as£¹
Ð
SQLITE_OPEN_CREATE
 == 0x04 );

127425 
‹¡ÿ£
Ð(1<<(
æags
&7))==0x02 );

127426 
‹¡ÿ£
Ð(1<<(
æags
&7))==0x04 );

127427 
‹¡ÿ£
Ð(1<<(
æags
&7))==0x40 );

127428 ifÐ((1<<(
	gæags
&7)) & 0x46)==0 ){

127429  
SQLITE_MISUSE_BKPT
;

127432 ifÐ
	gsql™e3Glob®CÚfig
.
	gbCÜeMu‹x
==0 ){

127433 
isTh»ad§ã
 = 0;

127434 }ifÐ
	gæags
 & 
	gSQLITE_OPEN_NOMUTEX
 ){

127435 
	gisTh»ad§ã
 = 0;

127436 }ifÐ
	gæags
 & 
	gSQLITE_OPEN_FULLMUTEX
 ){

127437 
	gisTh»ad§ã
 = 1;

127439 
	gisTh»ad§ã
 = 
sql™e3Glob®CÚfig
.
bFuÎMu‹x
;

127441 ifÐ
	gæags
 & 
	gSQLITE_OPEN_PRIVATECACHE
 ){

127442 
	gæags
 &ð~
SQLITE_OPEN_SHAREDCACHE
;

127443 }ifÐ
	gsql™e3Glob®CÚfig
.
	gsh¬edCacheEÇbËd
 ){

127444 
	gæags
 |ð
SQLITE_OPEN_SHAREDCACHE
;

127456 
	gæags
 &ð~Ð
SQLITE_OPEN_DELETEONCLOSE
 |

127457 
SQLITE_OPEN_EXCLUSIVE
 |

127458 
SQLITE_OPEN_MAIN_DB
 |

127459 
SQLITE_OPEN_TEMP_DB
 |

127460 
SQLITE_OPEN_TRANSIENT_DB
 |

127461 
SQLITE_OPEN_MAIN_JOURNAL
 |

127462 
SQLITE_OPEN_TEMP_JOURNAL
 |

127463 
SQLITE_OPEN_SUBJOURNAL
 |

127464 
SQLITE_OPEN_MASTER_JOURNAL
 |

127465 
SQLITE_OPEN_NOMUTEX
 |

127466 
SQLITE_OPEN_FULLMUTEX
 |

127467 
SQLITE_OPEN_WAL


127471 
	gdb
 = 
sql™e3M®locZ”o
Ð(
sql™e3
) );

127472 ifÐ
	gdb
==0 ) 
Ý’db_out
;

127473 ifÐ
	gisTh»ad§ã
 ){

127474 
	gdb
->
	gmu‹x
 = 
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_RECURSIVE
);

127475 ifÐ
	gdb
->
	gmu‹x
==0 ){

127476 
sql™e3_ä“
(
db
);

127477 
	gdb
 = 0;

127478 
	gÝ’db_out
;

127481 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127482 
	gdb
->
	g”rMask
 = 0xff;

127483 
	gdb
->
	gnDb
 = 2;

127484 
	gdb
->
	gmagic
 = 
SQLITE_MAGIC_BUSY
;

127485 
	gdb
->
	gaDb
 = 
db
->
aDbStic
;

127487 
as£¹
Ð(
db
->
aLim™
)==(
aH¬dLim™
) );

127488 
memýy
(
db
->
aLim™
, 
aH¬dLim™
, (db->aLimit));

127489 
	gdb
->
	gaLim™
[
SQLITE_LIMIT_WORKER_THREADS
] = 
SQLITE_DEFAULT_WORKER_THREADS
;

127490 
	gdb
->
	gautoComm™
 = 1;

127491 
	gdb
->
	gÃxtAutovac
 = -1;

127492 
	gdb
->
	gszMm­
 = 
sql™e3Glob®CÚfig
.
szMm­
;

127493 
	gdb
->
	gÃxtPagesize
 = 0;

127494 
	gdb
->
	gnMaxSÜ‹rMm­
 = 0x7FFFFFFF;

127495 
	gdb
->
	gæags
 |ð
SQLITE_ShÜtCÞNames
 | 
SQLITE_EÇbËTrigg”
 | 
SQLITE_CacheSpžl


127496 #ià!
defšed
(
SQLITE_DEFAULT_AUTOMATIC_INDEX
) || SQLITE_DEFAULT_AUTOMATIC_INDEX

127497 | 
SQLITE_AutoIndex


127499 #ià
SQLITE_DEFAULT_FILE_FORMAT
<4

127500 | 
SQLITE_LegacyFžeFmt


127502 #ifdeà
SQLITE_ENABLE_LOAD_EXTENSION


127503 | 
SQLITE_LßdEx‹nsiÚ


127505 #ià
SQLITE_DEFAULT_RECURSIVE_TRIGGERS


127506 | 
SQLITE_RecTrigg”s


127508 #ià
defšed
(
SQLITE_DEFAULT_FOREIGN_KEYS
) && SQLITE_DEFAULT_FOREIGN_KEYS

127509 | 
SQLITE_FÜeignKeys


127512 
sql™e3HashIn™
(&
db
->
aCÞlSeq
);

127513 #iâdeà
SQLITE_OMIT_VIRTUALTABLE


127514 
sql™e3HashIn™
(&
db
->
aModuË
);

127521 
ü—‹CÞÏtiÚ
(
db
, "BINARY", 
SQLITE_UTF8
, 0, 
bšCÞlFunc
, 0);

127522 
ü—‹CÞÏtiÚ
(
db
, "BINARY", 
SQLITE_UTF16BE
, 0, 
bšCÞlFunc
, 0);

127523 
ü—‹CÞÏtiÚ
(
db
, "BINARY", 
SQLITE_UTF16LE
, 0, 
bšCÞlFunc
, 0);

127524 
ü—‹CÞÏtiÚ
(
db
, "RTRIM", 
SQLITE_UTF8
, (*)1, 
bšCÞlFunc
, 0);

127525 ifÐ
	gdb
->
	gm®locFažed
 ){

127526 
	gÝ’db_out
;

127528 
	gdb
->
	gpDætCÞl
 = 
sql™e3FšdCÞlSeq
(
db
, 
SQLITE_UTF8
, "BINARY", 0);

127529 
as£¹
Ð
db
->
pDætCÞl
!=0 );

127532 
ü—‹CÞÏtiÚ
(
db
, "NOCASE", 
SQLITE_UTF8
, 0, 
noÿ£CÞÏtšgFunc
, 0);

127535 
	gdb
->
	gÝ’FÏgs
 = 
æags
;

127536 
	grc
 = 
sql™e3P¬£Uri
(
zVfs
, 
zFž’ame
, &
æags
, &
db
->
pVfs
, &
zO³n
, &
zE¼Msg
);

127537 ifÐ
	grc
!=
SQLITE_OK
 ){

127538 ifÐ
rc
==
SQLITE_NOMEM
 ) 
db
->
m®locFažed
 = 1;

127539 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, 
zE¼Msg
 ? "%s" : 0, zErrMsg);

127540 
sql™e3_ä“
(
zE¼Msg
);

127541 
	gÝ’db_out
;

127545 
	grc
 = 
sql™e3BŒ“O³n
(
db
->
pVfs
, 
zO³n
, db, &db->
aDb
[0].
pBt
, 0,

127546 
æags
 | 
SQLITE_OPEN_MAIN_DB
);

127547 ifÐ
	grc
!=
SQLITE_OK
 ){

127548 ifÐ
rc
==
SQLITE_IOERR_NOMEM
 ){

127549 
rc
 = 
SQLITE_NOMEM
;

127551 
sql™e3E¼Ü
(
db
, 
rc
);

127552 
	gÝ’db_out
;

127554 
sql™e3BŒ“EÁ”
(
db
->
aDb
[0].
pBt
);

127555 
	gdb
->
	gaDb
[0].
	gpSchema
 = 
sql™e3SchemaG‘
(
db
, db->
aDb
[0].
pBt
);

127556 
sql™e3BŒ“L—ve
(
db
->
aDb
[0].
pBt
);

127557 
	gdb
->
	gaDb
[1].
	gpSchema
 = 
sql™e3SchemaG‘
(
db
, 0);

127562 
	gdb
->
	gaDb
[0].
	gzName
 = "main";

127563 
	gdb
->
	gaDb
[0].
	g§ãty_Ëv–
 = 3;

127564 
	gdb
->
	gaDb
[1].
	gzName
 = "temp";

127565 
	gdb
->
	gaDb
[1].
	g§ãty_Ëv–
 = 1;

127567 
	gdb
->
	gmagic
 = 
SQLITE_MAGIC_OPEN
;

127568 ifÐ
	gdb
->
	gm®locFažed
 ){

127569 
	gÝ’db_out
;

127576 
sql™e3E¼Ü
(
db
, 
SQLITE_OK
);

127577 
sql™e3Regi¡”BužtšFunùiÚs
(
db
);

127582 
	grc
 = 
sql™e3_”rcode
(
db
);

127583 ifÐ
	grc
==
SQLITE_OK
 ){

127584 
sql™e3AutoLßdEx‹nsiÚs
(
db
);

127585 
	grc
 = 
sql™e3_”rcode
(
db
);

127586 ifÐ
	grc
!=
SQLITE_OK
 ){

127587 
Ý’db_out
;

127591 #ifdeà
SQLITE_ENABLE_FTS1


127592 ifÐ!
	gdb
->
	gm®locFažed
 ){

127593 
sql™e3Fts1In™
(
sql™e3
*);

127594 
	grc
 = 
sql™e3Fts1In™
(
db
);

127598 #ifdeà
SQLITE_ENABLE_FTS2


127599 ifÐ!
	gdb
->
	gm®locFažed
 && 
	grc
==
SQLITE_OK
 ){

127600 
sql™e3Fts2In™
(
sql™e3
*);

127601 
	grc
 = 
sql™e3Fts2In™
(
db
);

127605 #ifdeà
SQLITE_ENABLE_FTS3


127606 ifÐ!
	gdb
->
	gm®locFažed
 && 
	grc
==
SQLITE_OK
 ){

127607 
rc
 = 
sql™e3Fts3In™
(
db
);

127611 #ifdeà
SQLITE_ENABLE_ICU


127612 ifÐ!
	gdb
->
	gm®locFažed
 && 
	grc
==
SQLITE_OK
 ){

127613 
rc
 = 
sql™e3IcuIn™
(
db
);

127617 #ifdeà
SQLITE_ENABLE_RTREE


127618 ifÐ!
	gdb
->
	gm®locFažed
 && 
	grc
==
SQLITE_OK
){

127619 
rc
 = 
sql™e3RŒ“In™
(
db
);

127627 #ifdeà
SQLITE_DEFAULT_LOCKING_MODE


127628 
	gdb
->
	gdætLockMode
 = 
SQLITE_DEFAULT_LOCKING_MODE
;

127629 
sql™e3Pag”LockšgMode
(
sql™e3BŒ“Pag”
(
db
->
aDb
[0].
pBt
),

127630 
SQLITE_DEFAULT_LOCKING_MODE
);

127633 ifÐ
	grc
 ) 
sql™e3E¼Ü
(
db
, 
rc
);

127636 
£tupLookaside
(
db
, 0, 
sql™e3Glob®CÚfig
.
szLookaside
,

127637 
sql™e3Glob®CÚfig
.
nLookaside
);

127639 
sql™e3_w®_autocheckpošt
(
db
, 
SQLITE_DEFAULT_WAL_AUTOCHECKPOINT
);

127641 
	gÝ’db_out
:

127642 
sql™e3_ä“
(
zO³n
);

127643 ifÐ
	gdb
 ){

127644 
as£¹
Ð
db
->
mu‹x
!=0 || 
isTh»ad§ã
==0 || 
sql™e3Glob®CÚfig
.
bFuÎMu‹x
==0 );

127645 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127647 
	grc
 = 
sql™e3_”rcode
(
db
);

127648 
as£¹
Ð
db
!=0 || 
rc
==
SQLITE_NOMEM
 );

127649 ifÐ
	grc
==
SQLITE_NOMEM
 ){

127650 
sql™e3_þo£
(
db
);

127651 
	gdb
 = 0;

127652 }ifÐ
	grc
!=
SQLITE_OK
 ){

127653 
db
->
magic
 = 
SQLITE_MAGIC_SICK
;

127655 *
	gµDb
 = 
db
;

127656 #ifdeà
SQLITE_ENABLE_SQLLOG


127657 ifÐ
	gsql™e3Glob®CÚfig
.
	gxSqÎog
 ){

127659 *
	gpArg
 = 
sql™e3Glob®CÚfig
.
pSqÎogArg
;

127660 
	gsql™e3Glob®CÚfig
.
xSqÎog
(
pArg
, 
db
, 
zFž’ame
, 0);

127663  
sql™e3ApiEx™
(0, 
rc
);

127669 
SQLITE_API
 
sql™e3_Ý’
(

127670 cÚ¡ *
zFž’ame
,

127671 
sql™e3
 **
µDb


127673  
Ý’D©aba£
(
zFž’ame
, 
µDb
,

127674 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
, 0);

127676 
SQLITE_API
 
sql™e3_Ý’_v2
(

127677 cÚ¡ *
fž’ame
,

127678 
sql™e3
 **
µDb
,

127679 
æags
,

127680 cÚ¡ *
zVfs


127682  
Ý’D©aba£
(
fž’ame
, 
µDb
, ()
æags
, 
zVfs
);

127685 #iâdeà
SQLITE_OMIT_UTF16


127689 
SQLITE_API
 
sql™e3_Ý’16
(

127690 cÚ¡ *
zFž’ame
,

127691 
sql™e3
 **
µDb


127693 cÚ¡ *
	gzFž’ame8
;

127694 
sql™e3_v®ue
 *
	gpV®
;

127695 
	grc
;

127697 
as£¹
Ð
zFž’ame
 );

127698 
as£¹
Ð
µDb
 );

127699 *
	gµDb
 = 0;

127700 #iâdeà
SQLITE_OMIT_AUTOINIT


127701 
	grc
 = 
sql™e3_š™Ÿlize
();

127702 ifÐ
	grc
 ) „c;

127704 
	gpV®
 = 
sql™e3V®ueNew
(0);

127705 
sql™e3V®ueS‘SŒ
(
pV®
, -1, 
zFž’ame
, 
SQLITE_UTF16NATIVE
, 
SQLITE_STATIC
);

127706 
	gzFž’ame8
 = 
sql™e3V®ueText
(
pV®
, 
SQLITE_UTF8
);

127707 ifÐ
	gzFž’ame8
 ){

127708 
	grc
 = 
Ý’D©aba£
(
zFž’ame8
, 
µDb
,

127709 
SQLITE_OPEN_READWRITE
 | 
SQLITE_OPEN_CREATE
, 0);

127710 
as£¹
Ð*
µDb
 || 
rc
==
SQLITE_NOMEM
 );

127711 ifÐ
	grc
==
SQLITE_OK
 && !
DbHasPrÝ”ty
(*
µDb
, 0, 
DB_SchemaLßded
) ){

127712 
ENC
(*
µDb
èð
SQLITE_UTF16NATIVE
;

127715 
	grc
 = 
SQLITE_NOMEM
;

127717 
sql™e3V®ueF»e
(
pV®
);

127719  
sql™e3ApiEx™
(0, 
rc
);

127726 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ
(

127727 
sql™e3
* 
db
,

127728 cÚ¡ *
zName
,

127729 
’c
,

127730 * 
pCtx
,

127731 (*
xCom·»
)(*,,const *,,const *)

127733 
	grc
;

127734 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127735 
as£¹
Ð!
db
->
m®locFažed
 );

127736 
	grc
 = 
ü—‹CÞÏtiÚ
(
db
, 
zName
, (
u8
)
’c
, 
pCtx
, 
xCom·»
, 0);

127737 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

127738 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127739  
	grc
;

127745 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ_v2
(

127746 
sql™e3
* 
db
,

127747 cÚ¡ *
zName
,

127748 
’c
,

127749 * 
pCtx
,

127750 (*
xCom·»
)(*,,const *,,const *),

127751 (*
xD–
)(*)

127753 
	grc
;

127754 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127755 
as£¹
Ð!
db
->
m®locFažed
 );

127756 
	grc
 = 
ü—‹CÞÏtiÚ
(
db
, 
zName
, (
u8
)
’c
, 
pCtx
, 
xCom·»
, 
xD–
);

127757 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

127758 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127759  
	grc
;

127762 #iâdeà
SQLITE_OMIT_UTF16


127766 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ16
(

127767 
sql™e3
* 
db
,

127768 cÚ¡ *
zName
,

127769 
’c
,

127770 * 
pCtx
,

127771 (*
xCom·»
)(*,,const *,,const *)

127773 
	grc
 = 
SQLITE_OK
;

127774 *
	gzName8
;

127775 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127776 
as£¹
Ð!
db
->
m®locFažed
 );

127777 
	gzName8
 = 
sql™e3Utf16to8
(
db
, 
zName
, -1, 
SQLITE_UTF16NATIVE
);

127778 ifÐ
	gzName8
 ){

127779 
	grc
 = 
ü—‹CÞÏtiÚ
(
db
, 
zName8
, (
u8
)
’c
, 
pCtx
, 
xCom·»
, 0);

127780 
sql™e3DbF»e
(
db
, 
zName8
);

127782 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

127783 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127784  
	grc
;

127792 
SQLITE_API
 
sql™e3_cÞÏtiÚ_Ãeded
(

127793 
sql™e3
 *
db
,

127794 *
pCÞlN“dedArg
,

127795 (*
xCÞlN“ded
)(*,
sql™e3
*,
eTextR•
,const *)

127797 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127798 
	gdb
->
	gxCÞlN“ded
 = 
xCÞlN“ded
;

127799 
	gdb
->
	gxCÞlN“ded16
 = 0;

127800 
	gdb
->
	gpCÞlN“dedArg
 = 
pCÞlN“dedArg
;

127801 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127802  
	gSQLITE_OK
;

127805 #iâdeà
SQLITE_OMIT_UTF16


127810 
SQLITE_API
 
sql™e3_cÞÏtiÚ_Ãeded16
(

127811 
sql™e3
 *
db
,

127812 *
pCÞlN“dedArg
,

127813 (*
xCÞlN“ded16
)(*,
sql™e3
*,
eTextR•
,const *)

127815 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127816 
	gdb
->
	gxCÞlN“ded
 = 0;

127817 
	gdb
->
	gxCÞlN“ded16
 = 
xCÞlN“ded16
;

127818 
	gdb
->
	gpCÞlN“dedArg
 = 
pCÞlN“dedArg
;

127819 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127820  
	gSQLITE_OK
;

127824 #iâdeà
SQLITE_OMIT_DEPRECATED


127829 
SQLITE_API
 
sql™e3_glob®_»cov”
(){

127830  
	gSQLITE_OK
;

127840 
SQLITE_API
 
sql™e3_g‘_autocomm™
(
sql™e3
 *
db
){

127841  
	gdb
->
	gautoComm™
;

127855 
SQLITE_PRIVATE
 
sql™e3CÜru±E¼Ü
(
lš’o
){

127856 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

127857 
sql™e3_log
(
SQLITE_CORRUPT
,

127859 
lš’o
, 20+
sql™e3_sourûid
());

127860  
	gSQLITE_CORRUPT
;

127862 
SQLITE_PRIVATE
 
sql™e3Misu£E¼Ü
(
lš’o
){

127863 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

127864 
sql™e3_log
(
SQLITE_MISUSE
,

127866 
lš’o
, 20+
sql™e3_sourûid
());

127867  
	gSQLITE_MISUSE
;

127869 
SQLITE_PRIVATE
 
sql™e3CªtÝ’E¼Ü
(
lš’o
){

127870 
‹¡ÿ£
Ð
sql™e3Glob®CÚfig
.
xLog
!=0 );

127871 
sql™e3_log
(
SQLITE_CANTOPEN
,

127873 
lš’o
, 20+
sql™e3_sourûid
());

127874  
	gSQLITE_CANTOPEN
;

127878 #iâdeà
SQLITE_OMIT_DEPRECATED


127886 
SQLITE_API
 
sql™e3_th»ad_þ—nup
(){

127894 #ifdeà
SQLITE_ENABLE_COLUMN_METADATA


127895 
SQLITE_API
 
sql™e3_bË_cÞumn_m‘ad©a
(

127896 
sql™e3
 *
db
,

127897 cÚ¡ *
zDbName
,

127898 cÚ¡ *
zTabËName
,

127899 cÚ¡ *
zCÞumnName
,

127900 cÚ¡ **
pzD©aTy³
,

127901 cÚ¡ **
pzCÞlSeq
,

127902 *
pNÙNuÎ
,

127903 *
pPrim¬yKey
,

127904 *
pAutošc


127906 
	grc
;

127907 *
	gzE¼Msg
 = 0;

127908 
TabË
 *
	gpTab
 = 0;

127909 
CÞumn
 *
	gpCÞ
 = 0;

127910 
	giCÞ
;

127912 cÚ¡ *
	gzD©aTy³
 = 0;

127913 cÚ¡ *
	gzCÞlSeq
 = 0;

127914 
	gnÙnuÎ
 = 0;

127915 
	g´im¬ykey
 = 0;

127916 
	gautošc
 = 0;

127919 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

127920 
sql™e3BŒ“EÁ”AÎ
(
db
);

127921 
	grc
 = 
sql™e3In™
(
db
, &
zE¼Msg
);

127922 ifÐ
	gSQLITE_OK
!=
rc
 ){

127923 
”rÜ_out
;

127927 
	gpTab
 = 
sql™e3FšdTabË
(
db
, 
zTabËName
, 
zDbName
);

127928 ifÐ!
	gpTab
 ||…Tab->
	gpS–eù
 ){

127929 
	gpTab
 = 0;

127930 
	g”rÜ_out
;

127934 ifÐ
sql™e3IsRowid
(
zCÞumnName
) ){

127935 
	giCÞ
 = 
pTab
->
iPKey
;

127936 ifÐ
	giCÞ
>=0 ){

127937 
pCÞ
 = &
pTab
->
aCÞ
[
iCÞ
];

127940 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞ
; iCol++){

127941 
	gpCÞ
 = &
pTab
->
aCÞ
[
iCÞ
];

127942 ifÐ0==
sql™e3SŒICmp
(
pCÞ
->
zName
, 
zCÞumnName
) ){

127946 ifÐ
	giCÞ
==
pTab
->
nCÞ
 ){

127947 
pTab
 = 0;

127948 
	g”rÜ_out
;

127962 ifÐ
	gpCÞ
 ){

127963 
	gzD©aTy³
 = 
pCÞ
->
zTy³
;

127964 
	gzCÞlSeq
 = 
pCÞ
->
zCÞl
;

127965 
	gnÙnuÎ
 = 
pCÞ
->
nÙNuÎ
!=0;

127966 
	g´im¬ykey
 = (
pCÞ
->
cÞFÏgs
 & 
COLFLAG_PRIMKEY
)!=0;

127967 
	gautošc
 = 
pTab
->
iPKey
==
iCÞ
 && (pTab->
bFÏgs
 & 
TF_Autošüem’t
)!=0;

127969 
	gzD©aTy³
 = "INTEGER";

127970 
	g´im¬ykey
 = 1;

127972 ifÐ!
	gzCÞlSeq
 ){

127973 
	gzCÞlSeq
 = "BINARY";

127976 
	g”rÜ_out
:

127977 
sql™e3BŒ“L—veAÎ
(
db
);

127983 ifÐ
	gpzD©aTy³
 ) *pzD©aTy³ = 
zD©aTy³
;

127984 ifÐ
	gpzCÞlSeq
 ) *pzCÞlSeq = 
zCÞlSeq
;

127985 ifÐ
	gpNÙNuÎ
 ) *pNÙNuÎ = 
nÙnuÎ
;

127986 ifÐ
	gpPrim¬yKey
 ) *pPrim¬yKey = 
´im¬ykey
;

127987 ifÐ
	gpAutošc
 ) *pAutošøð
autošc
;

127989 ifÐ
	gSQLITE_OK
==
rc
 && !
pTab
 ){

127990 
sql™e3DbF»e
(
db
, 
zE¼Msg
);

127991 
	gzE¼Msg
 = 
sql™e3MPrštf
(
db
, "nØsuchabË cÞumn: %s.%s", 
zTabËName
,

127992 
zCÞumnName
);

127993 
	grc
 = 
SQLITE_ERROR
;

127995 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, (
zE¼Msg
?"%s":0), zErrMsg);

127996 
sql™e3DbF»e
(
db
, 
zE¼Msg
);

127997 
	grc
 = 
sql™e3ApiEx™
(
db
, 
rc
);

127998 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

127999  
	grc
;

128006 
SQLITE_API
 
sql™e3_¦“p
(
ms
){

128007 
sql™e3_vfs
 *
	gpVfs
;

128008 
	grc
;

128009 
	gpVfs
 = 
sql™e3_vfs_fšd
(0);

128010 ifÐ
	gpVfs
==0 )  0;

128015 
	grc
 = (
sql™e3OsSË•
(
pVfs
, 1000*
ms
)/1000);

128016  
	grc
;

128022 
SQLITE_API
 
sql™e3_ex‹nded_»suÉ_codes
(
sql™e3
 *
db
, 
Úoff
){

128023 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

128024 
	gdb
->
	g”rMask
 = 
Úoff
 ? 0xffffffff : 0xff;

128025 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

128026  
	gSQLITE_OK
;

128032 
SQLITE_API
 
sql™e3_fže_cÚŒÞ
(
sql™e3
 *
db
, cÚ¡ *
zDbName
, 
Ý
, *
pArg
){

128033 
	grc
 = 
SQLITE_ERROR
;

128034 
BŒ“
 *
	gpBŒ“
;

128036 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

128037 
	gpBŒ“
 = 
sql™e3DbNameToBŒ“
(
db
, 
zDbName
);

128038 ifÐ
	gpBŒ“
 ){

128039 
Pag”
 *
	gpPag”
;

128040 
sql™e3_fže
 *
	gfd
;

128041 
sql™e3BŒ“EÁ”
(
pBŒ“
);

128042 
	gpPag”
 = 
sql™e3BŒ“Pag”
(
pBŒ“
);

128043 
as£¹
Ð
pPag”
!=0 );

128044 
	gfd
 = 
sql™e3Pag”Fže
(
pPag”
);

128045 
as£¹
Ð
fd
!=0 );

128046 ifÐ
	gÝ
==
SQLITE_FCNTL_FILE_POINTER
 ){

128047 *(
sql™e3_fže
**)
pArg
 = 
fd
;

128048 
	grc
 = 
SQLITE_OK
;

128049 }ifÐ
	gfd
->
	gpM‘hods
 ){

128050 
	grc
 = 
sql™e3OsFžeCÚŒÞ
(
fd
, 
Ý
, 
pArg
);

128052 
	grc
 = 
SQLITE_NOTFOUND
;

128054 
sql™e3BŒ“L—ve
(
pBŒ“
);

128056 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

128057  
	grc
;

128063 
SQLITE_API
 
sql™e3_‹¡_cÚŒÞ
(
Ý
, ...){

128064 
	grc
 = 0;

128065 #iâdeà
SQLITE_OMIT_BUILTIN_TEST


128066 
va_li¡
 
	g­
;

128067 
va_¡¬t
(
­
, 
Ý
);

128068  
	gÝ
 ){

128073 
	gSQLITE_TESTCTRL_PRNG_SAVE
: {

128074 
sql™e3PºgSaveS‹
();

128083 
	gSQLITE_TESTCTRL_PRNG_RESTORE
: {

128084 
sql™e3PºgRe¡ÜeS‹
();

128093 
	gSQLITE_TESTCTRL_PRNG_RESET
: {

128094 
sql™e3_¿ndomÃss
(0,0);

128106 
	gSQLITE_TESTCTRL_BITVEC_TEST
: {

128107 
sz
 = 
va_¬g
(
­
, );

128108 *
	gaProg
 = 
va_¬g
(
­
, *);

128109 
	grc
 = 
sql™e3B™vecBužtšTe¡
(
sz
, 
aProg
);

128124 
	gSQLITE_TESTCTRL_FAULT_INSTALL
: {

128129 (*
TESTCALLBACKFUNC_t
)();

128130 
	gsql™e3Glob®CÚfig
.
	gxTe¡C®lback
 = 
va_¬g
(
­
, 
TESTCALLBACKFUNC_t
);

128131 
	grc
 = 
sql™e3FauÉSim
(0);

128141 
	gSQLITE_TESTCTRL_BENIGN_MALLOC_HOOKS
: {

128142 (*
void_funùiÚ
)();

128143 
void_funùiÚ
 
	gxB’ignBegš
;

128144 
void_funùiÚ
 
	gxB’ignEnd
;

128145 
	gxB’ignBegš
 = 
va_¬g
(
­
, 
void_funùiÚ
);

128146 
	gxB’ignEnd
 = 
va_¬g
(
­
, 
void_funùiÚ
);

128147 
sql™e3B’ignM®locHooks
(
xB’ignBegš
, 
xB’ignEnd
);

128163 
	gSQLITE_TESTCTRL_PENDING_BYTE
: {

128164 
rc
 = 
PENDING_BYTE
;

128165 #iâdeà
SQLITE_OMIT_WSD


128167 
	gÃwV®
 = 
va_¬g
(
­
, );

128168 ifÐ
	gÃwV®
 ) 
	gsql™e3P’dšgBy‹
 = 
ÃwV®
;

128185 
	gSQLITE_TESTCTRL_ASSERT
: {

128186 vÞ©ž
x
 = 0;

128187 
as£¹
Ð(
x
 = 
va_¬g
(
­
,))!=0 );

128188 
	grc
 = 
x
;

128220 
	gSQLITE_TESTCTRL_ALWAYS
: {

128221 
x
 = 
va_¬g
(
­
,);

128222 
	grc
 = 
ALWAYS
(
x
);

128237 
	gSQLITE_TESTCTRL_BYTEORDER
: {

128238 
rc
 = 
SQLITE_BYTEORDER
*100 + 
SQLITE_LITTLEENDIAN
*10 + 
SQLITE_BIGENDIAN
;

128247 
	gSQLITE_TESTCTRL_RESERVE
: {

128248 
sql™e3
 *
db
 = 
va_¬g
(
­
, sqlite3*);

128249 
	gx
 = 
va_¬g
(
­
,);

128250 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

128251 
sql™e3BŒ“S‘PageSize
(
db
->
aDb
[0].
pBt
, 0, 
x
, 0);

128252 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

128265 
	gSQLITE_TESTCTRL_OPTIMIZATIONS
: {

128266 
sql™e3
 *
db
 = 
va_¬g
(
­
, sqlite3*);

128267 
	gdb
->
	gdbO±FÏgs
 = (
u16
)(
va_¬g
(
­
, ) & 0xffff);

128271 #ifdeà
SQLITE_N_KEYWORD


128281 
	gSQLITE_TESTCTRL_ISKEYWORD
: {

128282 cÚ¡ *
zWÜd
 = 
va_¬g
(
­
, const *);

128283 
	gn
 = 
sql™e3SŒËn30
(
zWÜd
);

128284 
	grc
 = (
sql™e3KeywÜdCode
((
u8
*)
zWÜd
, 
n
)!=
TK_ID
è? 
SQLITE_N_KEYWORD
 : 0;

128294 
	gSQLITE_TESTCTRL_SCRATCHMALLOC
: {

128295 *
pF»e
, **
	gµNew
;

128296 
	gsz
;

128297 
	gsz
 = 
va_¬g
(
­
, );

128298 
	gµNew
 = 
va_¬g
(
­
, **);

128299 
	gpF»e
 = 
va_¬g
(
­
, *);

128300 ifÐ
	gsz
 ) *
	gµNew
 = 
sql™e3Sü©chM®loc
(
sz
);

128301 
sql™e3Sü©chF»e
(
pF»e
);

128311 
	gSQLITE_TESTCTRL_LOCALTIME_FAULT
: {

128312 
sql™e3Glob®CÚfig
.
bLoÿÉimeFauÉ
 = 
va_¬g
(
­
, );

128324 
	gSQLITE_TESTCTRL_NEVER_CORRUPT
: {

128325 
sql™e3Glob®CÚfig
.
Ãv”CÜru±
 = 
va_¬g
(
­
, );

128335 
	gSQLITE_TESTCTRL_VDBE_COVERAGE
: {

128336 #ifdeà
SQLITE_VDBE_COVERAGE


128337 (*
b¿nch_ÿÎback
)(*,,
	tu8
,u8);

128338 
	gsql™e3Glob®CÚfig
.
	gxVdbeB¿nch
 = 
va_¬g
(
­
,
b¿nch_ÿÎback
);

128339 
	gsql™e3Glob®CÚfig
.
	gpVdbeB¿nchArg
 = 
va_¬g
(
­
,*);

128345 
	gSQLITE_TESTCTRL_SORTER_MMAP
: {

128346 
sql™e3
 *
db
 = 
va_¬g
(
­
, sqlite3*);

128347 
	gdb
->
	gnMaxSÜ‹rMm­
 = 
va_¬g
(
­
, );

128356 
	gSQLITE_TESTCTRL_ISINIT
: {

128357 ifÐ
sql™e3Glob®CÚfig
.
isIn™
==0 ) 
rc
 = 
SQLITE_ERROR
;

128361 
va_’d
(
­
);

128363  
	grc
;

128377 
SQLITE_API
 cÚ¡ *
sql™e3_uri_·¿m‘”
(cÚ¡ *
zFž’ame
, cÚ¡ *
zP¬am
){

128378 ifÐ
	gzFž’ame
==0 )  0;

128379 
	gzFž’ame
 +ð
sql™e3SŒËn30
(
zFž’ame
) + 1;

128380  
	gzFž’ame
[0] ){

128381 
	gx
 = 
¡rcmp
(
zFž’ame
, 
zP¬am
);

128382 
	gzFž’ame
 +ð
sql™e3SŒËn30
(
zFž’ame
) + 1;

128383 ifÐ
	gx
==0 )  
zFž’ame
;

128384 
	gzFž’ame
 +ð
sql™e3SŒËn30
(
zFž’ame
) + 1;

128392 
SQLITE_API
 
sql™e3_uri_boÞ—n
(cÚ¡ *
zFž’ame
, cÚ¡ *
zP¬am
, 
bDæt
){

128393 cÚ¡ *
	gz
 = 
sql™e3_uri_·¿m‘”
(
zFž’ame
, 
zP¬am
);

128394 
	gbDæt
 = 
bDæt
!=0;

128395  
	gz
 ? 
sql™e3G‘BoÞ—n
(
z
, 
bDæt
) : bDflt;

128401 
SQLITE_API
 
sql™e3_št64
 
sql™e3_uri_št64
(

128402 cÚ¡ *
zFž’ame
,

128403 cÚ¡ *
zP¬am
,

128404 
sql™e3_št64
 
bDæt


128406 cÚ¡ *
	gz
 = 
sql™e3_uri_·¿m‘”
(
zFž’ame
, 
zP¬am
);

128407 
sql™e3_št64
 
	gv
;

128408 ifÐ
	gz
 && 
sql™e3DecOrHexToI64
(
z
, &
v
)==
SQLITE_OK
 ){

128409 
bDæt
 = 
v
;

128411  
	gbDæt
;

128417 
SQLITE_PRIVATE
 
BŒ“
 *
sql™e3DbNameToBŒ“
(
sql™e3
 *
db
, cÚ¡ *
zDbName
){

128418 
	gi
;

128419 
	gi
=0; i<
	gdb
->
	gnDb
; i++){

128420 ifÐ
	gdb
->
	gaDb
[
i
].
	gpBt


128421 && (
	gzDbName
==0 || 
sql™e3SŒICmp
(
zDbName
, 
db
->
aDb
[
i
].
zName
)==0)

128423  
db
->
aDb
[
i
].
pBt
;

128433 
SQLITE_API
 cÚ¡ *
sql™e3_db_fž’ame
(
sql™e3
 *
db
, cÚ¡ *
zDbName
){

128434 
BŒ“
 *
	gpBt
 = 
sql™e3DbNameToBŒ“
(
db
, 
zDbName
);

128435  
	gpBt
 ? 
sql™e3BŒ“G‘Fž’ame
(
pBt
) : 0;

128442 
SQLITE_API
 
sql™e3_db_»adÚly
(
sql™e3
 *
db
, cÚ¡ *
zDbName
){

128443 
BŒ“
 *
	gpBt
 = 
sql™e3DbNameToBŒ“
(
db
, 
zDbName
);

128444  
	gpBt
 ? 
sql™e3BŒ“IsR—dÚly
(
pBt
) : -1;

128466 #ifdeà
SQLITE_ENABLE_UNLOCK_NOTIFY


128477 
	#as£¹Mu‹xH–d
() \

128478 
	`as£¹
Ð
	`sql™e3_mu‹x_h–d
(
	`sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
)è)

	)

128486 
sql™e3
 *
SQLITE_WSD
 
	gsql™e3BlockedLi¡
 = 0;

128488 #iâdeà
NDEBUG


128503 
checkLi¡PrÝ”t›s
(
sql™e3
 *
db
){

128504 
sql™e3
 *
	gp
;

128505 
	gp
=
sql™e3BlockedLi¡
;…;…=
p
->
pNextBlocked
){

128506 
£’
 = 0;

128507 
sql™e3
 *
	gp2
;

128510 
as£¹
Ð
p
->
pUÆockCÚÃùiÚ
 ||…->
pBlockšgCÚÃùiÚ
 );

128513 
	gp2
=
sql™e3BlockedLi¡
;…2!=
p
;…2=
p2
->
pNextBlocked
){

128514 ifÐ
p2
->
xUÆockNÙify
==
p
->xUÆockNÙify ) 
£’
 = 1;

128515 
as£¹
Ð
p2
->
xUÆockNÙify
==
p
->xUÆockNÙify || !
£’
 );

128516 
as£¹
Ð
db
==0 || 
p
->
pUÆockCÚÃùiÚ
!=db );

128517 
as£¹
Ð
db
==0 || 
p
->
pBlockšgCÚÃùiÚ
!=db );

128522 
	#checkLi¡PrÝ”t›s
(
x
)

	)

128529 
»moveFromBlockedLi¡
(
sql™e3
 *
db
){

128530 
sql™e3
 **
	gµ
;

128531 
as£¹Mu‹xH–d
();

128532 
	gµ
=&
sql™e3BlockedLi¡
; *µ;…°ð&(*
µ
)->
pNextBlocked
){

128533 ifÐ*
µ
==
db
 ){

128534 *
µ
 = (*µ)->
pNextBlocked
;

128544 
addToBlockedLi¡
(
sql™e3
 *
db
){

128545 
sql™e3
 **
	gµ
;

128546 
as£¹Mu‹xH–d
();

128548 
	gµ
=&
sql™e3BlockedLi¡
;

128549 *
	gµ
 && (*µ)->
	gxUÆockNÙify
!=
db
->
xUÆockNÙify
;

128550 
	gµ
=&(*
µ
)->
pNextBlocked


128552 
	gdb
->
	gpNextBlocked
 = *
µ
;

128553 *
	gµ
 = 
db
;

128559 
’‹rMu‹x
(){

128560 
sql™e3_mu‹x_’‹r
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

128561 
checkLi¡PrÝ”t›s
(0);

128567 
ËaveMu‹x
(){

128568 
as£¹Mu‹xH–d
();

128569 
checkLi¡PrÝ”t›s
(0);

128570 
sql™e3_mu‹x_Ëave
(
sql™e3Mu‹xAÎoc
(
SQLITE_MUTEX_STATIC_MASTER
));

128594 
SQLITE_API
 
sql™e3_uÆock_nÙify
(

128595 
sql™e3
 *
db
,

128596 (*
xNÙify
)(**, ),

128597 *
pArg


128599 
	grc
 = 
SQLITE_OK
;

128601 
sql™e3_mu‹x_’‹r
(
db
->
mu‹x
);

128602 
’‹rMu‹x
();

128604 ifÐ
	gxNÙify
==0 ){

128605 
»moveFromBlockedLi¡
(
db
);

128606 
	gdb
->
	gpBlockšgCÚÃùiÚ
 = 0;

128607 
	gdb
->
	gpUÆockCÚÃùiÚ
 = 0;

128608 
	gdb
->
	gxUÆockNÙify
 = 0;

128609 
	gdb
->
	gpUÆockArg
 = 0;

128610 }ifÐ0==
db
->
pBlockšgCÚÃùiÚ
 ){

128615 
xNÙify
(&
pArg
, 1);

128617 
sql™e3
 *
	gp
;

128619 
	gp
=
db
->
pBlockšgCÚÃùiÚ
;… &&…!=db;…=
p
->
pUÆockCÚÃùiÚ
){}

128620 ifÐ
p
 ){

128621 
rc
 = 
SQLITE_LOCKED
;

128623 
	gdb
->
	gpUÆockCÚÃùiÚ
 = 
db
->
pBlockšgCÚÃùiÚ
;

128624 
	gdb
->
	gxUÆockNÙify
 = 
xNÙify
;

128625 
	gdb
->
	gpUÆockArg
 = 
pArg
;

128626 
»moveFromBlockedLi¡
(
db
);

128627 
addToBlockedLi¡
(
db
);

128631 
ËaveMu‹x
();

128632 
as£¹
Ð!
db
->
m®locFažed
 );

128633 
sql™e3E¼ÜW™hMsg
(
db
, 
rc
, (rc?"database is deadlocked":0));

128634 
sql™e3_mu‹x_Ëave
(
db
->
mu‹x
);

128635  
	grc
;

128644 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚBlocked
(
sql™e3
 *
db
, sql™e3 *
pBlock”
){

128645 
’‹rMu‹x
();

128646 ifÐ
	gdb
->
	gpBlockšgCÚÃùiÚ
==0 && 
db
->
pUÆockCÚÃùiÚ
==0 ){

128647 
addToBlockedLi¡
(
db
);

128649 
	gdb
->
	gpBlockšgCÚÃùiÚ
 = 
pBlock”
;

128650 
ËaveMu‹x
();

128672 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚUÆocked
(
sql™e3
 *
db
){

128673 (*
	gxUÆockNÙify
)(**, ) = 0;

128674 
	gnArg
 = 0;

128675 
sql™e3
 **
	gµ
;

128676 **
	gaArg
;

128677 **
	gaDyn
 = 0;

128678 *
	gaStic
[16];

128680 
	gaArg
 = 
aStic
;

128681 
’‹rMu‹x
();

128684 
	gµ
=&
sql™e3BlockedLi¡
; *pp; ){

128685 
sql™e3
 *
	gp
 = *
µ
;

128688 ifÐ
	gp
->
	gpBlockšgCÚÃùiÚ
==
db
 ){

128689 
p
->
pBlockšgCÚÃùiÚ
 = 0;

128693 ifÐ
	gp
->
	gpUÆockCÚÃùiÚ
==
db
 ){

128694 
as£¹
Ð
p
->
xUÆockNÙify
 );

128695 ifÐ
	gp
->
	gxUÆockNÙify
!=
xUÆockNÙify
 && 
nArg
!=0 ){

128696 
xUÆockNÙify
(
aArg
, 
nArg
);

128697 
	gnArg
 = 0;

128700 
sql™e3BegšB’ignM®loc
();

128701 
as£¹
Ð
aArg
==
aDyn
 || (aDyn==0 &&‡Arg==
aStic
) );

128702 
as£¹
Ð
nArg
<=()
A¼aySize
(
aStic
è|| 
aArg
==
aDyn
 );

128703 ifÐ(!
	gaDyn
 && 
	gnArg
==()
A¼aySize
(
aStic
))

128704 || (
aDyn
 && 
nArg
==()(
sql™e3M®locSize
(aDyn)/(*)))

128707 **
pNew
 = (**)
sql™e3M®loc
(
nArg
*(*)*2);

128708 ifÐ
	gpNew
 ){

128709 
memýy
(
pNew
, 
aArg
, 
nArg
*(*));

128710 
sql™e3_ä“
(
aDyn
);

128711 
	gaDyn
 = 
aArg
 = 
pNew
;

128737 
xUÆockNÙify
(
aArg
, 
nArg
);

128738 
	gnArg
 = 0;

128741 
sql™e3EndB’ignM®loc
();

128743 
	gaArg
[
nArg
++] = 
p
->
pUÆockArg
;

128744 
	gxUÆockNÙify
 = 
p
->
xUÆockNÙify
;

128745 
	gp
->
	gpUÆockCÚÃùiÚ
 = 0;

128746 
	gp
->
	gxUÆockNÙify
 = 0;

128747 
	gp
->
	gpUÆockArg
 = 0;

128751 ifÐ
	gp
->
	gpBlockšgCÚÃùiÚ
==0 && 
p
->
pUÆockCÚÃùiÚ
==0 ){

128753 *
µ
 = 
p
->
pNextBlocked
;

128754 
	gp
->
	gpNextBlocked
 = 0;

128756 
	gµ
 = &
p
->
pNextBlocked
;

128760 ifÐ
	gnArg
!=0 ){

128761 
xUÆockNÙify
(
aArg
, 
nArg
);

128763 
sql™e3_ä“
(
aDyn
);

128764 
ËaveMu‹x
();

128771 
SQLITE_PRIVATE
 
sql™e3CÚÃùiÚClo£d
(
sql™e3
 *
db
){

128772 
sql™e3CÚÃùiÚUÆocked
(
db
);

128773 
’‹rMu‹x
();

128774 
»moveFromBlockedLi¡
(
db
);

128775 
checkLi¡PrÝ”t›s
(
db
);

128776 
ËaveMu‹x
();

129087 #iâdeà
_FTSINT_H


129088 
	#_FTSINT_H


	)

129090 #ià!
defšed
(
NDEBUG
è&& !defšed(
SQLITE_DEBUG
)

129091 
	#NDEBUG
 1

	)

129099 #ià
defšed
(
SQLITE_ENABLE_FTS4
è&& !defšed(
SQLITE_ENABLE_FTS3
)

129100 
	#SQLITE_ENABLE_FTS3


	)

129103 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

129106 #iâdeà
SQLITE_CORE


129107 
	gSQLITE_EXTENSION_INIT3


129131 #iâdeà
_FTS3_TOKENIZER_H_


129132 
	#_FTS3_TOKENIZER_H_


	)

129158 
sql™e3_tok’iz”_moduË
 
	tsql™e3_tok’iz”_moduË
;

129159 
sql™e3_tok’iz”
 
	tsql™e3_tok’iz”
;

129160 
sql™e3_tok’iz”_cursÜ
 
	tsql™e3_tok’iz”_cursÜ
;

129162 
	ssql™e3_tok’iz”_moduË
 {

129167 
	giV”siÚ
;

129186 (*
	gxC»©e
)(

129187 
	g¬gc
,

129188 cÚ¡ *cÚ¡*
	g¬gv
,

129189 
sql™e3_tok’iz”
 **
	gµTok’iz”


129196 (*
	gxDe¡roy
)(
sql™e3_tok’iz”
 *
	gpTok’iz”
);

129203 (*
	gxO³n
)(

129204 
sql™e3_tok’iz”
 *
	gpTok’iz”
,

129205 cÚ¡ *
	gpIÅut
, 
	gnBy‹s
,

129206 
sql™e3_tok’iz”_cursÜ
 **
	gµCursÜ


129213 (*
	gxClo£
)(
sql™e3_tok’iz”_cursÜ
 *
	gpCursÜ
);

129239 (*
	gxNext
)(

129240 
sql™e3_tok’iz”_cursÜ
 *
	gpCursÜ
,

129241 cÚ¡ **
	gµTok’
, *
	g²By‹s
,

129242 *
	gpiS¹Off£t
,

129243 *
	gpiEndOff£t
,

129244 *
	gpiPos™iÚ


129254 (*
	gxLªguageid
)(
sql™e3_tok’iz”_cursÜ
 *
	gpC¤
, 
	giLªgid
);

129257 
	ssql™e3_tok’iz”
 {

129258 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpModuË
;

129262 
	ssql™e3_tok’iz”_cursÜ
 {

129263 
sql™e3_tok’iz”
 *
	gpTok’iz”
;

129267 
ás3_glob®_‹rm_út
(
iT”m
, 
iCÞ
);

129268 
ás3_‹rm_út
(
iT”m
, 
iCÞ
);

129293 #iâdeà
_FTS3_HASH_H_


129294 
	#_FTS3_HASH_H_


	)

129297 
Fts3Hash
 
	tFts3Hash
;

129298 
Fts3HashEËm
 
	tFts3HashEËm
;

129308 
	sFts3Hash
 {

129309 
	gkeyCÏss
;

129310 
	gcÝyKey
;

129311 
	gcouÁ
;

129312 
Fts3HashEËm
 *
	gfœ¡
;

129313 
	ghtsize
;

129314 
	s_ás3ht
 {

129315 
	gcouÁ
;

129316 
Fts3HashEËm
 *
	gchaš
;

129317 } *
	ght
;

129326 
	sFts3HashEËm
 {

129327 
Fts3HashEËm
 *
	gÃxt
, *
	g´ev
;

129328 *
	gd©a
;

129329 *
	gpKey
; 
	gnKey
;

129344 
	#FTS3_HASH_STRING
 1

	)

129345 
	#FTS3_HASH_BINARY
 2

	)

129350 
SQLITE_PRIVATE
 
sql™e3Fts3HashIn™
(
Fts3Hash
 *
pNew
, 
keyCÏss
, 
cÝyKey
);

129351 
SQLITE_PRIVATE
 *
sql™e3Fts3HashIn£¹
(
Fts3Hash
*, cÚ¡ *
pKey
, 
nKey
, *
pD©a
);

129352 
SQLITE_PRIVATE
 *
sql™e3Fts3HashFšd
(cÚ¡ 
Fts3Hash
*, cÚ¡ *
pKey
, 
nKey
);

129353 
SQLITE_PRIVATE
 
sql™e3Fts3HashCË¬
(
Fts3Hash
*);

129354 
SQLITE_PRIVATE
 
Fts3HashEËm
 *
sql™e3Fts3HashFšdEËm
(cÚ¡ 
Fts3Hash
 *, const *, );

129359 
	#ás3HashIn™
 
sql™e3Fts3HashIn™


	)

129360 
	#ás3HashIn£¹
 
sql™e3Fts3HashIn£¹


	)

129361 
	#ás3HashFšd
 
sql™e3Fts3HashFšd


	)

129362 
	#ás3HashCË¬
 
sql™e3Fts3HashCË¬


	)

129363 
	#ás3HashFšdEËm
 
sql™e3Fts3HashFšdEËm


	)

129377 
	#ás3HashFœ¡
(
H
è((H)->
fœ¡
)

	)

129378 
	#ás3HashNext
(
E
è((E)->
Ãxt
)

	)

129379 
	#ás3HashD©a
(
E
è((E)->
d©a
)

	)

129380 
	#ás3HashKey
(
E
è((E)->
pKey
)

	)

129381 
	#ás3HashKeysize
(
E
è((E)->
nKey
)

	)

129386 
	#ás3HashCouÁ
(
H
è((H)->
couÁ
)

	)

129400 #iâdeà
SQLITE_FTS3_MAX_EXPR_DEPTH


129401 
	#SQLITE_FTS3_MAX_EXPR_DEPTH
 12

	)

129410 
	#FTS3_MERGE_COUNT
 16

	)

129420 
	#FTS3_MAX_PENDING_DATA
 (1*1024*1024)

	)

129427 
	#SizeofA¼ay
(
X
è(()((X)/(X[0])))

	)

129430 #iâdeà
MIN


129431 
	#MIN
(
x
,
y
è((x)<(y)?(x):(y))

	)

129433 #iâdeà
MAX


129434 
	#MAX
(
x
,
y
è((x)>(y)?(x):(y))

	)

129441 
	#FTS3_VARINT_MAX
 10

	)

129458 
	#FTS3_SEGDIR_MAXLEVEL
 1024

	)

129459 
	#FTS3_SEGDIR_MAXLEVEL_STR
 "1024"

	)

129465 #iâdeà
‹¡ÿ£


129466 
	#‹¡ÿ£
(
X
)

	)

129472 
	#POS_COLUMN
 (1è

	)

129473 
	#POS_END
 (0è

	)

129480 #iâdeà
SQLITE_AMALGAMATION


129485 #ifdeà
SQLITE_COVERAGE_TEST


129486 
	#ALWAYS
(
x
è(1)

	)

129487 
	#NEVER
(
X
è(0)

	)

129489 
	#ALWAYS
(
x
è(x)

	)

129490 
	#NEVER
(
x
è(x)

	)

129496 
	tu8
;

129497 
	ti16
;

129498 
	tu32
;

129499 
sql™e3_ušt64
 
	tu64
;

129500 
sql™e3_št64
 
	ti64
;

129505 
	#UNUSED_PARAMETER
(
x
è()(x)

	)

129510 #ià!
defšed
(
NDEBUG
è&& !defšed(
SQLITE_DEBUG
)

129511 
	#NDEBUG
 1

	)

129519 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_COVERAGE_TEST
)

129520 
	#TESTONLY
(
X
è
	)
X

129522 
	#TESTONLY
(
X
)

	)

129527 #ifdeà
SQLITE_DEBUG


129528 
SQLITE_PRIVATE
 
sql™e3Fts3CÜru±
();

129529 
	#FTS_CORRUPT_VTAB
 
	`sql™e3Fts3CÜru±
()

	)

129531 
	#FTS_CORRUPT_VTAB
 
SQLITE_CORRUPT_VTAB


	)

129534 
Fts3TabË
 
	tFts3TabË
;

129535 
Fts3CursÜ
 
	tFts3CursÜ
;

129536 
Fts3Ex´
 
	tFts3Ex´
;

129537 
Fts3Ph¿£
 
	tFts3Ph¿£
;

129538 
Fts3Ph¿£Tok’
 
	tFts3Ph¿£Tok’
;

129540 
Fts3Doþi¡
 
	tFts3Doþi¡
;

129541 
Fts3SegFž‹r
 
	tFts3SegFž‹r
;

129542 
Fts3Deã¼edTok’
 
	tFts3Deã¼edTok’
;

129543 
Fts3SegR—d”
 
	tFts3SegR—d”
;

129544 
Fts3MuÉiSegR—d”
 
	tFts3MuÉiSegR—d”
;

129553 
	sFts3TabË
 {

129554 
sql™e3_vb
 
	gba£
;

129555 
sql™e3
 *
	gdb
;

129556 cÚ¡ *
	gzDb
;

129557 cÚ¡ *
	gzName
;

129558 
	gnCÞumn
;

129559 **
	gazCÞumn
;

129560 
u8
 *
	gabNÙšdexed
;

129561 
sql™e3_tok’iz”
 *
	gpTok’iz”
;

129562 *
	gzCÚ‹ÁTbl
;

129563 *
	gzLªguageid
;

129564 
	gnAutošüm”ge
;

129565 
u32
 
	gnL—fAdd
;

129570 
sql™e3_¡mt
 *
	gaStmt
[40];

129572 *
	gzR—dEx´li¡
;

129573 *
	gzWr™eEx´li¡
;

129575 
	gnNodeSize
;

129576 
u8
 
	gbFts4
;

129577 
u8
 
	gbHasSt
;

129578 
u8
 
	gbHasDocsize
;

129579 
u8
 
	gbDescIdx
;

129580 
u8
 
	gbIgnÜeSav•ošt
;

129581 
	gnPgsz
;

129582 *
	gzSegm’tsTbl
;

129583 
sql™e3_blob
 *
	gpSegm’ts
;

129602 
	gnIndex
;

129603 
	sFts3Index
 {

129604 
	gnP»fix
;

129605 
Fts3Hash
 
	ghP’dšg
;

129606 } *
	gaIndex
;

129607 
	gnMaxP’dšgD©a
;

129608 
	gnP’dšgD©a
;

129609 
sql™e_št64
 
	giP»vDocid
;

129610 
	giP»vLªgid
;

129612 #ià
defšed
(
SQLITE_DEBUG
è|| defšed(
SQLITE_COVERAGE_TEST
)

129618 
	gšT¿n§ùiÚ
;

129619 
	gmxSav•ošt
;

129622 #ifdeà
SQLITE_TEST


129625 
	gbNoInüDoþi¡
;

129634 
	sFts3CursÜ
 {

129635 
sql™e3_vb_cursÜ
 
	gba£
;

129636 
i16
 
	geS—rch
;

129637 
u8
 
	gisEof
;

129638 
u8
 
	gisRequœeS“k
;

129639 
sql™e3_¡mt
 *
	gpStmt
;

129640 
Fts3Ex´
 *
	gpEx´
;

129641 
	giLªgid
;

129642 
	gnPh¿£
;

129643 
Fts3Deã¼edTok’
 *
	gpDeã¼ed
;

129644 
sql™e3_št64
 
	giP»vId
;

129645 *
	gpNextId
;

129646 *
	gaDoþi¡
;

129647 
	gnDoþi¡
;

129648 
u8
 
	gbDesc
;

129649 
	geEv®mode
;

129650 
	gnRowAvg
;

129651 
sql™e3_št64
 
	gnDoc
;

129652 
i64
 
	giMšDocid
;

129653 
i64
 
	giMaxDocid
;

129654 
	gisM©chšfoN“ded
;

129655 
u32
 *
	gaM©chšfo
;

129656 
	gnM©chšfo
;

129657 *
	gzM©chšfo
;

129660 
	#FTS3_EVAL_FILTER
 0

	)

129661 
	#FTS3_EVAL_NEXT
 1

	)

129662 
	#FTS3_EVAL_MATCHINFO
 2

	)

129679 
	#FTS3_FULLSCAN_SEARCH
 0

	)

129680 
	#FTS3_DOCID_SEARCH
 1

	)

129681 
	#FTS3_FULLTEXT_SEARCH
 2

	)

129689 
	#FTS3_HAVE_LANGID
 0x00010000

	)

129690 
	#FTS3_HAVE_DOCID_GE
 0x00020000

	)

129691 
	#FTS3_HAVE_DOCID_LE
 0x00040000

	)

129693 
	sFts3Doþi¡
 {

129694 *
	gaAÎ
;

129695 
	gnAÎ
;

129696 *
	gpNextDocid
;

129698 
sql™e3_št64
 
	giDocid
;

129699 
	gbF»eLi¡
;

129700 *
	gpLi¡
;

129701 
	gnLi¡
;

129710 
	sFts3Ph¿£Tok’
 {

129711 *
	gz
;

129712 
	gn
;

129713 
	gisP»fix
;

129714 
	gbFœ¡
;

129719 
Fts3Deã¼edTok’
 *
	gpDeã¼ed
;

129720 
Fts3MuÉiSegR—d”
 *
	gpSegc¤
;

129723 
	sFts3Ph¿£
 {

129725 
Fts3Doþi¡
 
	gdoþi¡
;

129726 
	gbInü
;

129727 
	giDoþi¡Tok’
;

129732 
	gnTok’
;

129733 
	giCÞumn
;

129734 
Fts3Ph¿£Tok’
 
	gaTok’
[1];

129758 
	sFts3Ex´
 {

129759 
	geTy³
;

129760 
	gnN—r
;

129761 
Fts3Ex´
 *
	gpP¬’t
;

129762 
Fts3Ex´
 *
	gpLeá
;

129763 
Fts3Ex´
 *
	gpRight
;

129764 
Fts3Ph¿£
 *
	gpPh¿£
;

129767 
sql™e3_št64
 
	giDocid
;

129768 
u8
 
	gbEof
;

129769 
u8
 
	gbS¹
;

129770 
u8
 
	gbDeã¼ed
;

129772 
u32
 *
	gaMI
;

129786 
	#FTSQUERY_NEAR
 1

	)

129787 
	#FTSQUERY_NOT
 2

	)

129788 
	#FTSQUERY_AND
 3

	)

129789 
	#FTSQUERY_OR
 4

	)

129790 
	#FTSQUERY_PHRASE
 5

	)

129794 
SQLITE_PRIVATE
 
sql™e3Fts3Upd©eM‘hod
(
sql™e3_vb
*,,
sql™e3_v®ue
**,
sql™e3_št64
*);

129795 
SQLITE_PRIVATE
 
sql™e3Fts3P’dšgT”msFlush
(
Fts3TabË
 *);

129796 
SQLITE_PRIVATE
 
sql™e3Fts3P’dšgT”msCË¬
(
Fts3TabË
 *);

129797 
SQLITE_PRIVATE
 
sql™e3Fts3O±imize
(
Fts3TabË
 *);

129798 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”New
(, , 
sql™e3_št64
,

129799 
sql™e3_št64
, sql™e3_št64, cÚ¡ *, , 
Fts3SegR—d”
**);

129800 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”P’dšg
(

129801 
Fts3TabË
*,,cÚ¡ *,,,
Fts3SegR—d”
**);

129802 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”F»e
(
Fts3SegR—d”
 *);

129803 
SQLITE_PRIVATE
 
sql™e3Fts3AÎSegdœs
(
Fts3TabË
*, , , , 
sql™e3_¡mt
 **);

129804 
SQLITE_PRIVATE
 
sql™e3Fts3R—dBlock
(
Fts3TabË
*, 
sql™e3_št64
, **, *, *);

129806 
SQLITE_PRIVATE
 
sql™e3Fts3S–eùDoùÙ®
(
Fts3TabË
 *, 
sql™e3_¡mt
 **);

129807 
SQLITE_PRIVATE
 
sql™e3Fts3S–eùDocsize
(
Fts3TabË
 *, 
sql™e3_št64
, 
sql™e3_¡mt
 **);

129809 #iâdeà
SQLITE_DISABLE_FTS4_DEFERRED


129810 
SQLITE_PRIVATE
 
sql™e3Fts3F»eDeã¼edTok’s
(
Fts3CursÜ
 *);

129811 
SQLITE_PRIVATE
 
sql™e3Fts3DeãrTok’
(
Fts3CursÜ
 *, 
Fts3Ph¿£Tok’
 *, );

129812 
SQLITE_PRIVATE
 
sql™e3Fts3CacheDeã¼edDoþi¡s
(
Fts3CursÜ
 *);

129813 
SQLITE_PRIVATE
 
sql™e3Fts3F»eDeã¼edDoþi¡s
(
Fts3CursÜ
 *);

129814 
SQLITE_PRIVATE
 
sql™e3Fts3Deã¼edTok’Li¡
(
Fts3Deã¼edTok’
 *, **, *);

129816 
	#sql™e3Fts3F»eDeã¼edTok’s
(
x
)

	)

129817 
	#sql™e3Fts3DeãrTok’
(
x
,
y
,
z
è
SQLITE_OK


	)

129818 
	#sql™e3Fts3CacheDeã¼edDoþi¡s
(
x
è
SQLITE_OK


	)

129819 
	#sql™e3Fts3F»eDeã¼edDoþi¡s
(
x
)

	)

129820 
	#sql™e3Fts3Deã¼edTok’Li¡
(
x
,
y
,
z
è
SQLITE_OK


	)

129823 
SQLITE_PRIVATE
 
sql™e3Fts3Segm’tsClo£
(
Fts3TabË
 *);

129824 
SQLITE_PRIVATE
 
sql™e3Fts3MaxLev–
(
Fts3TabË
 *, *);

129827 
	#FTS3_SEGCURSOR_PENDING
 -1

	)

129828 
	#FTS3_SEGCURSOR_ALL
 -2

	)

129830 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”S¹
(
Fts3TabË
*, 
Fts3MuÉiSegR—d”
*, 
Fts3SegFž‹r
*);

129831 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”S‹p
(
Fts3TabË
 *, 
Fts3MuÉiSegR—d”
 *);

129832 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”Fšish
(
Fts3MuÉiSegR—d”
 *);

129834 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”CursÜ
(
Fts3TabË
 *,

129835 , , , cÚ¡ *, , , , 
Fts3MuÉiSegR—d”
 *);

129838 
	#FTS3_SEGMENT_REQUIRE_POS
 0x00000001

	)

129839 
	#FTS3_SEGMENT_IGNORE_EMPTY
 0x00000002

	)

129840 
	#FTS3_SEGMENT_COLUMN_FILTER
 0x00000004

	)

129841 
	#FTS3_SEGMENT_PREFIX
 0x00000008

	)

129842 
	#FTS3_SEGMENT_SCAN
 0x00000010

	)

129843 
	#FTS3_SEGMENT_FIRST
 0x00000020

	)

129846 
	sFts3SegFž‹r
 {

129847 cÚ¡ *
	gzT”m
;

129848 
	gnT”m
;

129849 
	giCÞ
;

129850 
	gæags
;

129853 
	sFts3MuÉiSegR—d”
 {

129855 
Fts3SegR—d”
 **
	g­Segm’t
;

129856 
	gnSegm’t
;

129857 
	gnAdvªû
;

129858 
Fts3SegFž‹r
 *
	gpFž‹r
;

129859 *
	gaBufãr
;

129860 
	gnBufãr
;

129862 
	giCÞFž‹r
;

129863 
	gbRe¡¬t
;

129866 
	gnCo¡
;

129867 
	gbLookup
;

129870 *
	gzT”m
;

129871 
	gnT”m
;

129872 *
	gaDoþi¡
;

129873 
	gnDoþi¡
;

129876 
SQLITE_PRIVATE
 
sql™e3Fts3Inüm”ge
(
Fts3TabË
*,,);

129878 
	#ás3G‘V¬št32
(
p
, 
piV®
) ( \

129879 (*(
u8
*)(
p
)&0x80è? 
	`sql™e3Fts3G‘V¬št32
Õ, 
piV®
) : (*piVal=*(u8*)(p), 1) \

129880 )

	)

129883 
SQLITE_PRIVATE
 
sql™e3Fts3PutV¬št
(*, 
sql™e3_št64
);

129884 
SQLITE_PRIVATE
 
sql™e3Fts3G‘V¬št
(cÚ¡ *, 
sql™e_št64
 *);

129885 
SQLITE_PRIVATE
 
sql™e3Fts3G‘V¬št32
(const *, *);

129886 
SQLITE_PRIVATE
 
sql™e3Fts3V¬štL’
(
sql™e3_ušt64
);

129887 
SQLITE_PRIVATE
 
sql™e3Fts3DequÙe
(*);

129888 
SQLITE_PRIVATE
 
sql™e3Fts3Doþi¡P»v
(,*,,**,
sql™e3_št64
*,*,
u8
*);

129889 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£Sts
(
Fts3CursÜ
 *, 
Fts3Ex´
 *, 
u32
 *);

129890 
SQLITE_PRIVATE
 
sql™e3Fts3Fœ¡Fž‹r
(
sql™e3_št64
, *, , *);

129891 
SQLITE_PRIVATE
 
sql™e3Fts3C»©eStTabË
(*, 
Fts3TabË
*);

129894 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Fts3NextTok’
(const *, *);

129895 
SQLITE_PRIVATE
 
sql™e3Fts3In™HashTabË
(
sql™e3
 *, 
Fts3Hash
 *, const *);

129896 
SQLITE_PRIVATE
 
sql™e3Fts3In™Tok’iz”
(
Fts3Hash
 *
pHash
, const *,

129897 
sql™e3_tok’iz”
 **, **

129899 
SQLITE_PRIVATE
 
sql™e3Fts3IsIdCh¬
();

129902 
SQLITE_PRIVATE
 
sql™e3Fts3Off£ts
(
sql™e3_cÚ‹xt
*, 
Fts3CursÜ
*);

129903 
SQLITE_PRIVATE
 
sql™e3Fts3Sn³t
(
sql™e3_cÚ‹xt
 *, 
Fts3CursÜ
 *, const *,

129906 
SQLITE_PRIVATE
 
sql™e3Fts3M©chšfo
(
sql™e3_cÚ‹xt
 *, 
Fts3CursÜ
 *, const *);

129909 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´P¬£
(
sql™e3_tok’iz”
 *, ,

129910 **, , , , cÚ¡ *, , 
Fts3Ex´
 **, **

129912 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´F»e
(
Fts3Ex´
 *);

129913 #ifdeà
SQLITE_TEST


129914 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´In™Te¡IÁ”çû
(
sql™e3
 *
db
);

129915 
SQLITE_PRIVATE
 
sql™e3Fts3In™T”m
(
sql™e3
 *
db
);

129918 
SQLITE_PRIVATE
 
sql™e3Fts3O³nTok’iz”
(
sql™e3_tok’iz”
 *, , const *, ,

129919 
sql™e3_tok’iz”_cursÜ
 **

129923 
SQLITE_PRIVATE
 
sql™e3Fts3In™Aux
(
sql™e3
 *
db
);

129925 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£CËªup
(
Fts3Ph¿£
 *);

129927 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüS¹
(

129928 
Fts3TabË
*, 
Fts3MuÉiSegR—d”
*, , const *, );

129929 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüNext
(

129930 
Fts3TabË
 *, 
Fts3MuÉiSegR—d”
 *, 
sql™e3_št64
 *, **, *);

129931 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(
Fts3CursÜ
 *, 
Fts3Ex´
 *, 
iCÞ
, **);

129932 
SQLITE_PRIVATE
 
sql™e3Fts3M¤Ovæ
(
Fts3CursÜ
 *, 
Fts3MuÉiSegR—d”
 *, *);

129933 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüRe¡¬t
(
Fts3MuÉiSegR—d”
 *
pC¤
);

129936 
SQLITE_PRIVATE
 
sql™e3Fts3In™Tok
(
sql™e3
*, 
Fts3Hash
 *);

129939 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


129940 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeFÞd
(, );

129941 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeI§Êum
();

129942 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeIsdŸü™ic
();

129950 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

129952 #ià
defšed
(
SQLITE_ENABLE_FTS3
è&& !defšed(
SQLITE_CORE
)

129953 
	#SQLITE_CORE
 1

	)

129963 #iâdeà
SQLITE_CORE


129964 
	gSQLITE_EXTENSION_INIT1


129967 
ás3Ev®Next
(
Fts3CursÜ
 *
pC¤
);

129968 
ás3Ev®S¹
(
Fts3CursÜ
 *
pC¤
);

129969 
ás3T”mSegR—d”CursÜ
(

129970 
Fts3CursÜ
 *, cÚ¡ *, , , 
Fts3MuÉiSegR—d”
 **);

129977 
SQLITE_PRIVATE
 
sql™e3Fts3PutV¬št
(*
p
, 
sql™e_št64
 
v
){

129978 *
	gq
 = (*è
p
;

129979 
sql™e_ušt64
 
	gvu
 = 
v
;

129981 *
	gq
++ = (è((
vu
 & 0x7f) | 0x80);

129982 
	gvu
 >>= 7;

129983 } 
	gvu
!=0 );

129984 
	gq
[-1] &= 0x7f;

129985 
as£¹
Ð
q
 - (*)
p
 <ð
FTS3_VARINT_MAX
 );

129986  (è(
	gq
 - (*)
	gp
);

129989 
	#GETVARINT_STEP
(
v
, 
±r
, 
shiá
, 
mask1
, 
mask2
, 
v¬
, 
»t
) \

129990 
v
 = (v & 
mask1
è| ( (*
±r
++è<< 
shiá
 ); \

129991 ifÐ(
v
 & 
mask2
)==0 ){ 
v¬
 = v;  
»t
; }

	)

129992 
	#GETVARINT_INIT
(
v
, 
±r
, 
shiá
, 
mask1
, 
mask2
, 
v¬
, 
»t
) \

129993 
v
 = (*
±r
++); \

129994 ifÐ(
v
 & 
mask2
)==0 ){ 
v¬
 = v;  
»t
; }

	)

130001 
SQLITE_PRIVATE
 
sql™e3Fts3G‘V¬št
(cÚ¡ *
p
, 
sql™e_št64
 *
v
){

130002 cÚ¡ *
	gpS¹
 = 
p
;

130003 
u32
 
	ga
;

130004 
u64
 
	gb
;

130005 
	gshiá
;

130007 
GETVARINT_INIT
(
a
, 
p
, 0, 0x00, 0x80, *
v
, 1);

130008 
GETVARINT_STEP
(
a
, 
p
, 7, 0x7F, 0x4000, *
v
, 2);

130009 
GETVARINT_STEP
(
a
, 
p
, 14, 0x3FFF, 0x200000, *
v
, 3);

130010 
GETVARINT_STEP
(
a
, 
p
, 21, 0x1FFFFF, 0x10000000, *
v
, 4);

130011 
	gb
 = (
a
 & 0x0FFFFFFF );

130013 
	gshiá
=28; shift<=63; shift+=7){

130014 
u64
 
c
 = *
p
++;

130015 
	gb
 +ð(
c
&0x7Fè<< 
shiá
;

130016 ifÐ(
	gc
 & 0x80)==0 ) ;

130018 *
	gv
 = 
b
;

130019  ()(
	gp
 - 
	gpS¹
);

130026 
SQLITE_PRIVATE
 
sql™e3Fts3G‘V¬št32
(cÚ¡ *
p
, *
pi
){

130027 
u32
 
	ga
;

130029 #iâdeà
ás3G‘V¬št32


130030 
GETVARINT_INIT
(
a
, 
p
, 0, 0x00, 0x80, *
pi
, 1);

130032 
	ga
 = (*
p
++);

130033 
as£¹
Ð
a
 & 0x80 );

130036 
GETVARINT_STEP
(
a
, 
p
, 7, 0x7F, 0x4000, *
pi
, 2);

130037 
GETVARINT_STEP
(
a
, 
p
, 14, 0x3FFF, 0x200000, *
pi
, 3);

130038 
GETVARINT_STEP
(
a
, 
p
, 21, 0x1FFFFF, 0x10000000, *
pi
, 4);

130039 
	ga
 = (
a
 & 0x0FFFFFFF );

130040 *
	gpi
 = ()(
a
 | ((
u32
)(*
p
 & 0x0F) << 28));

130047 
SQLITE_PRIVATE
 
sql™e3Fts3V¬štL’
(
sql™e3_ušt64
 
v
){

130048 
	gi
 = 0;

130050 
	gi
++;

130051 
	gv
 >>= 7;

130052 } 
	gv
!=0 );

130053  
	gi
;

130070 
SQLITE_PRIVATE
 
sql™e3Fts3DequÙe
(*
z
){

130071 
	gquÙe
;

130073 
	gquÙe
 = 
z
[0];

130074 ifÐ
	gquÙe
=='[' || 
quÙe
=='\'' || quote=='"' || quote=='`' ){

130075 
iIn
 = 1;

130076 
	giOut
 = 0;

130079 ifÐ
	gquÙe
=='[' ) 
quÙe
 = ']';

130081  
ALWAYS
(
z
[
iIn
]) ){

130082 ifÐ
	gz
[
iIn
]==
quÙe
 ){

130083 ifÐ
z
[
iIn
+1]!=
quÙe
 ) ;

130084 
	gz
[
iOut
++] = 
quÙe
;

130085 
	giIn
 += 2;

130087 
	gz
[
iOut
++] = 
z
[
iIn
++];

130090 
	gz
[
iOut
] = '\0';

130099 
ás3G‘D–V¬št
(**
µ
, 
sql™e3_št64
 *
pV®
){

130100 
sql™e3_št64
 
	giV®
;

130101 *
	gµ
 +ð
sql™e3Fts3G‘V¬št
(*
µ
, &
iV®
);

130102 *
	gpV®
 +ð
iV®
;

130114 
ás3G‘Rev”£V¬št
(

130115 **
µ
,

130116 *
pS¹
,

130117 
sql™e3_št64
 *
pV®


130119 
sql™e3_št64
 
	giV®
;

130120 *
	gp
;

130125 
	gp
 = (*
µ
)-2;…>=
pS¹
 && *
p
&0x80;…--);

130126 
	gp
++;

130127 *
	gµ
 = 
p
;

130129 
sql™e3Fts3G‘V¬št
(
p
, &
iV®
);

130130 *
	gpV®
 = 
iV®
;

130136 
ás3DiscÚÃùM‘hod
(
sql™e3_vb
 *
pVb
){

130137 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pVb
;

130138 
	gi
;

130140 
as£¹
Ð
p
->
nP’dšgD©a
==0 );

130141 
as£¹
Ð
p
->
pSegm’ts
==0 );

130144 
	gi
=0; i<
SizeofA¼ay
(
p
->
aStmt
); i++){

130145 
sql™e3_fš®ize
(
p
->
aStmt
[
i
]);

130147 
sql™e3_ä“
(
p
->
zSegm’tsTbl
);

130148 
sql™e3_ä“
(
p
->
zR—dEx´li¡
);

130149 
sql™e3_ä“
(
p
->
zWr™eEx´li¡
);

130150 
sql™e3_ä“
(
p
->
zCÚ‹ÁTbl
);

130151 
sql™e3_ä“
(
p
->
zLªguageid
);

130154 
	gp
->
	gpTok’iz”
->
	gpModuË
->
xDe¡roy
(
p
->
pTok’iz”
);

130156 
sql™e3_ä“
(
p
);

130157  
	gSQLITE_OK
;

130167 
ás3DbExec
(

130168 *
pRc
,

130169 
sql™e3
 *
db
,

130170 cÚ¡ *
zFÜm©
,

130173 
va_li¡
 
	g­
;

130174 *
	gzSql
;

130175 ifÐ*
	gpRc
 ) ;

130176 
va_¡¬t
(
­
, 
zFÜm©
);

130177 
	gzSql
 = 
sql™e3_vm´štf
(
zFÜm©
, 
­
);

130178 
va_’d
(
­
);

130179 ifÐ
	gzSql
==0 ){

130180 *
pRc
 = 
SQLITE_NOMEM
;

130182 *
	gpRc
 = 
sql™e3_exec
(
db
, 
zSql
, 0, 0, 0);

130183 
sql™e3_ä“
(
zSql
);

130190 
ás3De¡royM‘hod
(
sql™e3_vb
 *
pVb
){

130191 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pVb
;

130192 
	grc
 = 
SQLITE_OK
;

130193 cÚ¡ *
	gzDb
 = 
p
->
zDb
;

130194 
sql™e3
 *
	gdb
 = 
p
->
db
;

130197 ifÐ
	gp
->
	gzCÚ‹ÁTbl
==0 ){

130198 
ás3DbExec
(&
rc
, 
db
, "DROP TABLE IF EXISTS %Q.'%q_cÚ‹Á'", 
zDb
, 
p
->
zName
);

130200 
ás3DbExec
(&
rc
, 
db
, "DROP TABLE IF EXISTS %Q.'%q_£gm’ts'", 
zDb
,
p
->
zName
);

130201 
ás3DbExec
(&
rc
, 
db
, "DROP TABLE IF EXISTS %Q.'%q_£gdœ'", 
zDb
, 
p
->
zName
);

130202 
ás3DbExec
(&
rc
, 
db
, "DROP TABLE IF EXISTS %Q.'%q_docsize'", 
zDb
, 
p
->
zName
);

130203 
ás3DbExec
(&
rc
, 
db
, "DROP TABLE IF EXISTS %Q.'%q_¡©'", 
zDb
, 
p
->
zName
);

130209  (
	grc
==
SQLITE_OK
 ? 
ás3DiscÚÃùM‘hod
(
pVb
è: 
rc
);

130222 
ás3Deþ¬eVb
(*
pRc
, 
Fts3TabË
 *
p
){

130223 ifÐ*
	gpRc
==
SQLITE_OK
 ){

130224 
i
;

130225 
	grc
;

130226 *
	gzSql
;

130227 *
	gzCÞs
;

130228 cÚ¡ *
	gzLªguageid
;

130230 
	gzLªguageid
 = (
p
->
zLªguageid
 ?…->zLanguageid : "__langid");

130231 
sql™e3_vb_cÚfig
(
p
->
db
, 
SQLITE_VTAB_CONSTRAINT_SUPPORT
, 1);

130234 
	gzCÞs
 = 
sql™e3_m´štf
("%Q, ", 
p
->
azCÞumn
[0]);

130235 
	gi
=1; 
	gzCÞs
 && i<
	gp
->
	gnCÞumn
; i++){

130236 
	gzCÞs
 = 
sql™e3_m´štf
("%z%Q, ", 
zCÞs
, 
p
->
azCÞumn
[
i
]);

130240 
	gzSql
 = 
sql™e3_m´štf
(

130242 
zCÞs
, 
p
->
zName
, 
zLªguageid


130244 ifÐ!
	gzCÞs
 || !
	gzSql
 ){

130245 
	grc
 = 
SQLITE_NOMEM
;

130247 
	grc
 = 
sql™e3_deþ¬e_vb
(
p
->
db
, 
zSql
);

130250 
sql™e3_ä“
(
zSql
);

130251 
sql™e3_ä“
(
zCÞs
);

130252 *
	gpRc
 = 
rc
;

130259 
SQLITE_PRIVATE
 
sql™e3Fts3C»©eStTabË
(*
pRc
, 
Fts3TabË
 *
p
){

130260 
ás3DbExec
(
pRc
, 
p
->
db
,

130263 
p
->
zDb
,…->
zName


130265 ifÐ(*
	gpRc
)==
SQLITE_OK
 ) 
p
->
bHasSt
 = 1;

130277 
ás3C»©eTabËs
(
Fts3TabË
 *
p
){

130278 
	grc
 = 
SQLITE_OK
;

130279 
	gi
;

130280 
sql™e3
 *
	gdb
 = 
p
->
db
;

130282 ifÐ
	gp
->
	gzCÚ‹ÁTbl
==0 ){

130283 cÚ¡ *
zLªguageid
 = 
p
->zLanguageid;

130284 *
	gzCÚ‹ÁCÞs
;

130287 
	gzCÚ‹ÁCÞs
 = 
sql™e3_m´štf
("docid INTEGER PRIMARY KEY");

130288 
	gi
=0; 
	gzCÚ‹ÁCÞs
 && i<
	gp
->
	gnCÞumn
; i++){

130289 *
	gz
 = 
p
->
azCÞumn
[
i
];

130290 
	gzCÚ‹ÁCÞs
 = 
sql™e3_m´štf
("%z, 'c%d%q'", 
zCÚ‹ÁCÞs
, 
i
, 
z
);

130292 ifÐ
	gzLªguageid
 && 
	gzCÚ‹ÁCÞs
 ){

130293 
	gzCÚ‹ÁCÞs
 = 
sql™e3_m´štf
("%z,†ªgid", 
zCÚ‹ÁCÞs
, 
zLªguageid
);

130295 ifÐ
	gzCÚ‹ÁCÞs
==0 ) 
rc
 = 
SQLITE_NOMEM
;

130298 
ás3DbExec
(&
rc
, 
db
,

130300 
p
->
zDb
,…->
zName
, 
zCÚ‹ÁCÞs


130302 
sql™e3_ä“
(
zCÚ‹ÁCÞs
);

130306 
ás3DbExec
(&
rc
, 
db
,

130308 
p
->
zDb
,…->
zName


130310 
ás3DbExec
(&
rc
, 
db
,

130320 
p
->
zDb
,…->
zName


130322 ifÐ
	gp
->
	gbHasDocsize
 ){

130323 
ás3DbExec
(&
rc
, 
db
,

130325 
p
->
zDb
,…->
zName


130328 
as£¹
Ð
p
->
bHasSt
=õ->
bFts4
 );

130329 ifÐ
	gp
->
	gbHasSt
 ){

130330 
sql™e3Fts3C»©eStTabË
(&
rc
, 
p
);

130332  
	grc
;

130342 
ás3D©aba£PageSize
(*
pRc
, 
Fts3TabË
 *
p
){

130343 ifÐ*
	gpRc
==
SQLITE_OK
 ){

130344 
rc
;

130345 *
	gzSql
;

130346 
sql™e3_¡mt
 *
	gpStmt
;

130348 
	gzSql
 = 
sql™e3_m´štf
("PRAGMA %Q.·ge_size", 
p
->
zDb
);

130349 ifÐ!
	gzSql
 ){

130350 
	grc
 = 
SQLITE_NOMEM
;

130352 
	grc
 = 
sql™e3_´•¬e
(
p
->
db
, 
zSql
, -1, &
pStmt
, 0);

130353 ifÐ
	grc
==
SQLITE_OK
 ){

130354 
sql™e3_¡•
(
pStmt
);

130355 
	gp
->
	gnPgsz
 = 
sql™e3_cÞumn_št
(
pStmt
, 0);

130356 
	grc
 = 
sql™e3_fš®ize
(
pStmt
);

130357 }ifÐ
	grc
==
SQLITE_AUTH
 ){

130358 
p
->
nPgsz
 = 1024;

130359 
	grc
 = 
SQLITE_OK
;

130362 
as£¹
Ð
p
->
nPgsz
>0 || 
rc
!=
SQLITE_OK
 );

130363 
sql™e3_ä“
(
zSql
);

130364 *
	gpRc
 = 
rc
;

130376 
ás3IsS³cŸlCÞumn
(

130377 cÚ¡ *
z
,

130378 *
²Key
,

130379 **
pzV®ue


130381 *
	gzV®ue
;

130382 cÚ¡ *
	gzC¤
 = 
z
;

130384  *
	gzC¤
!='=' ){

130385 ifÐ*
zC¤
=='\0' )  0;

130386 
	gzC¤
++;

130389 *
	g²Key
 = ()(
zC¤
-
z
);

130390 
	gzV®ue
 = 
sql™e3_m´štf
("%s", &
zC¤
[1]);

130391 ifÐ
	gzV®ue
 ){

130392 
sql™e3Fts3DequÙe
(
zV®ue
);

130394 *
	gpzV®ue
 = 
zV®ue
;

130401 
ás3Aµ’df
(

130402 *
pRc
,

130403 **
pz
,

130404 cÚ¡ *
zFÜm©
,

130407 ifÐ*
	gpRc
==
SQLITE_OK
 ){

130408 
va_li¡
 
­
;

130409 *
	gz
;

130410 
va_¡¬t
(
­
, 
zFÜm©
);

130411 
	gz
 = 
sql™e3_vm´štf
(
zFÜm©
, 
­
);

130412 
va_’d
(
­
);

130413 ifÐ
	gz
 && *
	gpz
 ){

130414 *
	gz2
 = 
sql™e3_m´štf
("%s%s", *
pz
, 
z
);

130415 
sql™e3_ä“
(
z
);

130416 
	gz
 = 
z2
;

130418 ifÐ
	gz
==0 ) *
pRc
 = 
SQLITE_NOMEM
;

130419 
sql™e3_ä“
(*
pz
);

130420 *
	gpz
 = 
z
;

130434 *
ás3QuÙeId
(cÚ¡ *
zIÅut
){

130435 
	gnR‘
;

130436 *
	gzR‘
;

130437 
	gnR‘
 = 2 + ()
¡¾’
(
zIÅut
)*2 + 1;

130438 
	gzR‘
 = 
sql™e3_m®loc
(
nR‘
);

130439 ifÐ
	gzR‘
 ){

130440 
	gi
;

130441 *
	gz
 = 
zR‘
;

130442 *(
	gz
++) = '"';

130443 
	gi
=0; 
	gzIÅut
[
i
]; i++){

130444 ifÐ
	gzIÅut
[
i
]=='"' ) *(
z
++) = '"';

130445 *(
	gz
++èð
zIÅut
[
i
];

130447 *(
	gz
++) = '"';

130448 *(
	gz
++) = '\0';

130450  
	gzR‘
;

130476 *
ás3R—dEx´Li¡
(
Fts3TabË
 *
p
, cÚ¡ *
zFunc
, *
pRc
){

130477 *
	gzR‘
 = 0;

130478 *
	gzF»e
 = 0;

130479 *
	gzFunùiÚ
;

130480 
	gi
;

130482 ifÐ
	gp
->
	gzCÚ‹ÁTbl
==0 ){

130483 ifÐ!
zFunc
 ){

130484 
zFunùiÚ
 = "";

130486 
	gzF»e
 = 
zFunùiÚ
 = 
ás3QuÙeId
(
zFunc
);

130488 
ás3Aµ’df
(
pRc
, &
zR‘
, "docid");

130489 
	gi
=0; i<
	gp
->
	gnCÞumn
; i++){

130490 
ás3Aµ’df
(
pRc
, &
zR‘
, ",%s(x.'c%d%q')", 
zFunùiÚ
, 
i
, 
p
->
azCÞumn
[i]);

130492 ifÐ
	gp
->
	gzLªguageid
 ){

130493 
ás3Aµ’df
(
pRc
, &
zR‘
, ", x.%Q", "langid");

130495 
sql™e3_ä“
(
zF»e
);

130497 
ás3Aµ’df
(
pRc
, &
zR‘
, "rowid");

130498 
	gi
=0; i<
	gp
->
	gnCÞumn
; i++){

130499 
ás3Aµ’df
(
pRc
, &
zR‘
, ", x.'%q'", 
p
->
azCÞumn
[
i
]);

130501 ifÐ
	gp
->
	gzLªguageid
 ){

130502 
ás3Aµ’df
(
pRc
, &
zR‘
, ", x.%Q", 
p
->
zLªguageid
);

130505 
ás3Aµ’df
(
pRc
, &
zR‘
, " FROM '%q'.'%q%s' AS x",

130506 
p
->
zDb
,

130507 (
p
->
zCÚ‹ÁTbl
 ?…->zCÚ‹ÁTbÈ:…->
zName
),

130508 (
p
->
zCÚ‹ÁTbl
 ? "" : "_content")

130510  
	gzR‘
;

130533 *
ás3Wr™eEx´Li¡
(
Fts3TabË
 *
p
, cÚ¡ *
zFunc
, *
pRc
){

130534 *
	gzR‘
 = 0;

130535 *
	gzF»e
 = 0;

130536 *
	gzFunùiÚ
;

130537 
	gi
;

130539 ifÐ!
	gzFunc
 ){

130540 
	gzFunùiÚ
 = "";

130542 
	gzF»e
 = 
zFunùiÚ
 = 
ás3QuÙeId
(
zFunc
);

130544 
ás3Aµ’df
(
pRc
, &
zR‘
, "?");

130545 
	gi
=0; i<
	gp
->
	gnCÞumn
; i++){

130546 
ás3Aµ’df
(
pRc
, &
zR‘
, ",%s(?)", 
zFunùiÚ
);

130548 ifÐ
	gp
->
	gzLªguageid
 ){

130549 
ás3Aµ’df
(
pRc
, &
zR‘
, ", ?");

130551 
sql™e3_ä“
(
zF»e
);

130552  
	gzR‘
;

130568 
ás3GobbËIÁ
(cÚ¡ **
µ
, *
²Out
){

130569 cÚ¡ *
	gp
;

130570 
	gnIÁ
 = 0;

130572 
	gp
=*
µ
;…[0]>='0' && 
p
[0]<='9';…++){

130573 
	gnIÁ
 = 
nIÁ
 * 10 + (
p
[0] - '0');

130575 ifÐ
	gp
==*
µ
 )  
SQLITE_ERROR
;

130576 *
	g²Out
 = 
nIÁ
;

130577 *
	gµ
 = 
p
;

130578  
	gSQLITE_OK
;

130598 
ás3P»fixP¬am‘”
(

130599 cÚ¡ *
zP¬am
,

130600 *
²Index
,

130601 
Fts3Index
 **
­Index


130603 
Fts3Index
 *
	gaIndex
;

130604 
	gnIndex
 = 1;

130606 ifÐ
	gzP¬am
 && zParam[0] ){

130607 cÚ¡ *
	gp
;

130608 
	gnIndex
++;

130609 
	gp
=
zP¬am
; *p;…++){

130610 ifÐ*
	gp
==',' ) 
nIndex
++;

130614 
	gaIndex
 = 
sql™e3_m®loc
((
Fts3Index
è* 
nIndex
);

130615 *
	g­Index
 = 
aIndex
;

130616 *
	g²Index
 = 
nIndex
;

130617 ifÐ!
	gaIndex
 ){

130618  
	gSQLITE_NOMEM
;

130621 
mem£t
(
aIndex
, 0, (
Fts3Index
è* 
nIndex
);

130622 ifÐ
	gzP¬am
 ){

130623 cÚ¡ *
	gp
 = 
zP¬am
;

130624 
	gi
;

130625 
	gi
=1; i<
	gnIndex
; i++){

130626 
	gnP»fix
;

130627 ifÐ
ás3GobbËIÁ
(&
p
, &
nP»fix
èè 
	gSQLITE_ERROR
;

130628 
	gaIndex
[
i
].
	gnP»fix
 = 
nP»fix
;

130629 
	gp
++;

130633  
	gSQLITE_OK
;

130661 
ás3CÚ‹ÁCÞumns
(

130662 
sql™e3
 *
db
,

130663 cÚ¡ *
zDb
,

130664 cÚ¡ *
zTbl
,

130665 cÚ¡ ***
·zCÞ
,

130666 *
²CÞ
,

130667 *
²SŒ


130669 
	grc
 = 
SQLITE_OK
;

130670 *
	gzSql
;

130671 
sql™e3_¡mt
 *
	gpStmt
 = 0;

130673 
	gzSql
 = 
sql™e3_m´štf
("SELECT * FROM %Q.%Q", 
zDb
, 
zTbl
);

130674 ifÐ!
	gzSql
 ){

130675 
	grc
 = 
SQLITE_NOMEM
;

130677 
	grc
 = 
sql™e3_´•¬e
(
db
, 
zSql
, -1, &
pStmt
, 0);

130679 
sql™e3_ä“
(
zSql
);

130681 ifÐ
	grc
==
SQLITE_OK
 ){

130682 cÚ¡ **
azCÞ
;

130683 
	gnSŒ
 = 0;

130684 
	gnCÞ
;

130685 
	gi
;

130690 
	gnCÞ
 = 
sql™e3_cÞumn_couÁ
(
pStmt
);

130691 
	gi
=0; i<
	gnCÞ
; i++){

130692 cÚ¡ *
	gzCÞ
 = 
sql™e3_cÞumn_Çme
(
pStmt
, 
i
);

130693 
	gnSŒ
 +ð()
¡¾’
(
zCÞ
) + 1;

130697 
	gazCÞ
 = (cÚ¡ **)
sql™e3_m®loc
((*è* 
nCÞ
 + 
nSŒ
);

130698 ifÐ
	gazCÞ
==0 ){

130699 
rc
 = 
SQLITE_NOMEM
;

130701 *
	gp
 = (*)&
azCÞ
[
nCÞ
];

130702 
	gi
=0; i<
	gnCÞ
; i++){

130703 cÚ¡ *
	gzCÞ
 = 
sql™e3_cÞumn_Çme
(
pStmt
, 
i
);

130704 
	gn
 = ()
¡¾’
(
zCÞ
)+1;

130705 
memýy
(
p
, 
zCÞ
, 
n
);

130706 
	gazCÞ
[
i
] = 
p
;

130707 
	gp
 +ð
n
;

130710 
sql™e3_fš®ize
(
pStmt
);

130713 *
	g²CÞ
 = 
nCÞ
;

130714 *
	g²SŒ
 = 
nSŒ
;

130715 *
	g·zCÞ
 = 
azCÞ
;

130718  
	grc
;

130732 
ás3In™Vb
(

130733 
isC»©e
,

130734 
sql™e3
 *
db
,

130735 *
pAux
,

130736 
¬gc
,

130737 cÚ¡ * cÚ¡ *
¬gv
,

130738 
sql™e3_vb
 **
µVTab
,

130739 **
pzE¼


130741 
Fts3Hash
 *
	gpHash
 = (Fts3Hash *)
pAux
;

130742 
Fts3TabË
 *
	gp
 = 0;

130743 
	grc
 = 
SQLITE_OK
;

130744 
	gi
;

130745 
	gnBy‹
;

130746 
	giCÞ
;

130747 
	gnSŒšg
 = 0;

130748 
	gnCÞ
 = 0;

130749 *
	gzC¤
;

130750 
	gnDb
;

130751 
	gnName
;

130752 
	gisFts4
 = (
¬gv
[0][3]=='4');

130753 cÚ¡ **
	gaCÞ
;

130754 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 0;

130756 
	gnIndex
;

130757 
Fts3Index
 *
	gaIndex
 = 0;

130760 
	gbNoDocsize
 = 0;

130761 
	gbDescIdx
 = 0;

130762 *
	gzP»fix
 = 0;

130763 *
	gzCom´ess
 = 0;

130764 *
	gzUncom´ess
 = 0;

130765 *
	gzCÚ‹Á
 = 0;

130766 *
	gzLªguageid
 = 0;

130767 **
	gazNÙšdexed
 = 0;

130768 
	gnNÙšdexed
 = 0;

130770 
as£¹
Ð
¡¾’
(
¬gv
[0])==4 );

130771 
as£¹
Ð(
sql™e3_¡ºicmp
(
¬gv
[0], "ás4", 4)==0 && 
isFts4
)

130772 || (
sql™e3_¡ºicmp
(
¬gv
[0], "ás3", 4)==0 && !
isFts4
)

130775 
	gnDb
 = ()
¡¾’
(
¬gv
[1]) + 1;

130776 
	gnName
 = ()
¡¾’
(
¬gv
[2]) + 1;

130778 
	gnBy‹
 = (cÚ¡ *è* (
¬gc
-2);

130779 
	gaCÞ
 = (cÚ¡ **)
sql™e3_m®loc
(
nBy‹
);

130780 ifÐ
	gaCÞ
 ){

130781 
mem£t
((*)
aCÞ
, 0, 
nBy‹
);

130782 
	gazNÙšdexed
 = (**)
sql™e3_m®loc
(
nBy‹
);

130784 ifÐ
	gazNÙšdexed
 ){

130785 
mem£t
(
azNÙšdexed
, 0, 
nBy‹
);

130787 ifÐ!
	gaCÞ
 || !
	gazNÙšdexed
 ){

130788 
	grc
 = 
SQLITE_NOMEM
;

130789 
	gás3_š™_out
;

130803 
	gi
=3; 
	grc
==
SQLITE_OK
 && 
i
<
¬gc
; i++){

130804 cÚ¡ *
	gz
 = 
¬gv
[
i
];

130805 
	gnKey
;

130806 *
	gzV®
;

130809 ifÐ!
	gpTok’iz”


130810 && 
¡¾’
(
z
)>8

130811 && 0==
sql™e3_¡ºicmp
(
z
, "tokenize", 8)

130812 && 0==
sql™e3Fts3IsIdCh¬
(
z
[8])

130814 
rc
 = 
sql™e3Fts3In™Tok’iz”
(
pHash
, &
z
[9], &
pTok’iz”
, 
pzE¼
);

130818 ifÐ
	gisFts4
 && 
ás3IsS³cŸlCÞumn
(
z
, &
nKey
, &
zV®
) ){

130819 
	sFts4O±iÚ
 {

130820 cÚ¡ *
	gzO±
;

130821 
	gnO±
;

130822 } 
	gaFts4O±
[] = {

130833 
	giO±
;

130834 ifÐ!
	gzV®
 ){

130835 
	grc
 = 
SQLITE_NOMEM
;

130837 
	giO±
=0; iO±<
SizeofA¼ay
(
aFts4O±
); iOpt++){

130838 
Fts4O±iÚ
 *
	gpOp
 = &
aFts4O±
[
iO±
];

130839 ifÐ
	gnKey
==
pOp
->
nO±
 && !
sql™e3_¡ºicmp
(
z
,…Op->
zO±
,…Op->nOpt) ){

130843 ifÐ
	giO±
==
SizeofA¼ay
(
aFts4O±
) ){

130844 *
pzE¼
 = 
sql™e3_m´štf
("uÄecognized…¬am‘”: %s", 
z
);

130845 
	grc
 = 
SQLITE_ERROR
;

130847  
	giO±
 ){

130849 ifÐ
¡¾’
(
zV®
)!=4 || 
sql™e3_¡ºicmp
(zVal, "fts3", 4) ){

130850 *
	gpzE¼
 = 
sql™e3_m´štf
("uÄecognized m©chšfo: %s", 
zV®
);

130851 
	grc
 = 
SQLITE_ERROR
;

130853 
	gbNoDocsize
 = 1;

130857 
sql™e3_ä“
(
zP»fix
);

130858 
	gzP»fix
 = 
zV®
;

130859 
	gzV®
 = 0;

130863 
sql™e3_ä“
(
zCom´ess
);

130864 
	gzCom´ess
 = 
zV®
;

130865 
	gzV®
 = 0;

130869 
sql™e3_ä“
(
zUncom´ess
);

130870 
	gzUncom´ess
 = 
zV®
;

130871 
	gzV®
 = 0;

130875 ifÐ(
¡¾’
(
zV®
)!=3 || 
sql™e3_¡ºicmp
(zVal, "asc", 3))

130876 && (
¡¾’
(
zV®
)!=4 || 
sql™e3_¡ºicmp
(zVal, "desc", 4))

130878 *
	gpzE¼
 = 
sql™e3_m´štf
("uÄecognized ord”: %s", 
zV®
);

130879 
	grc
 = 
SQLITE_ERROR
;

130881 
	gbDescIdx
 = (
zV®
[0]=='d' || zVal[0]=='D');

130885 
sql™e3_ä“
(
zCÚ‹Á
);

130886 
	gzCÚ‹Á
 = 
zV®
;

130887 
	gzV®
 = 0;

130891 
as£¹
Ð
iO±
==6 );

130892 
sql™e3_ä“
(
zLªguageid
);

130893 
	gzLªguageid
 = 
zV®
;

130894 
	gzV®
 = 0;

130898 
azNÙšdexed
[
nNÙšdexed
++] = 
zV®
;

130899 
	gzV®
 = 0;

130903 
sql™e3_ä“
(
zV®
);

130909 
	gnSŒšg
 +ð()(
¡¾’
(
z
) + 1);

130910 
	gaCÞ
[
nCÞ
++] = 
z
;

130921 ifÐ
	grc
==
SQLITE_OK
 && 
zCÚ‹Á
 ){

130922 
sql™e3_ä“
(
zCom´ess
);

130923 
sql™e3_ä“
(
zUncom´ess
);

130924 
	gzCom´ess
 = 0;

130925 
	gzUncom´ess
 = 0;

130926 ifÐ
	gnCÞ
==0 ){

130927 
sql™e3_ä“
((*)
aCÞ
);

130928 
	gaCÞ
 = 0;

130929 
	grc
 = 
ás3CÚ‹ÁCÞumns
(
db
, 
¬gv
[1], 
zCÚ‹Á
, &
aCÞ
, &
nCÞ
, &
nSŒšg
);

130933 ifÐ
	grc
==
SQLITE_OK
 && 
zLªguageid
 ){

130934 
j
;

130935 
	gj
=0; j<
	gnCÞ
; j++){

130936 ifÐ
sql™e3_¡ricmp
(
zLªguageid
, 
aCÞ
[
j
])==0 ){

130937 
k
;

130938 
	gk
=
j
; k<
	gnCÞ
; k++è
	gaCÞ
[
k
] = 
aCÞ
[k+1];

130939 
	gnCÞ
--;

130946 ifÐ
	grc
!=
SQLITE_OK
 ) 
ás3_š™_out
;

130948 ifÐ
	gnCÞ
==0 ){

130949 
as£¹
Ð
nSŒšg
==0 );

130950 
	gaCÞ
[0] = "content";

130951 
	gnSŒšg
 = 8;

130952 
	gnCÞ
 = 1;

130955 ifÐ
	gpTok’iz”
==0 ){

130956 
rc
 = 
sql™e3Fts3In™Tok’iz”
(
pHash
, "sim¶e", &
pTok’iz”
, 
pzE¼
);

130957 ifÐ
	grc
!=
SQLITE_OK
 ) 
ás3_š™_out
;

130959 
as£¹
Ð
pTok’iz”
 );

130961 
	grc
 = 
ás3P»fixP¬am‘”
(
zP»fix
, &
nIndex
, &
aIndex
);

130962 ifÐ
	grc
==
SQLITE_ERROR
 ){

130963 
as£¹
Ð
zP»fix
 );

130964 *
	gpzE¼
 = 
sql™e3_m´štf
("”rÜ…¬sšg…»fix…¬am‘”: %s", 
zP»fix
);

130966 ifÐ
	grc
!=
SQLITE_OK
 ) 
ás3_š™_out
;

130969 
	gnBy‹
 = (
Fts3TabË
) +

130970 
nCÞ
 * (*) +

130971 
nIndex
 * (
Fts3Index
) +

130972 
nCÞ
 * (
u8
) +

130973 
nName
 +

130974 
nDb
 +

130975 
nSŒšg
;

130976 
	gp
 = (
Fts3TabË
*)
sql™e3_m®loc
(
nBy‹
);

130977 ifÐ
	gp
==0 ){

130978 
rc
 = 
SQLITE_NOMEM
;

130979 
	gás3_š™_out
;

130981 
mem£t
(
p
, 0, 
nBy‹
);

130982 
	gp
->
	gdb
 = 
db
;

130983 
	gp
->
	gnCÞumn
 = 
nCÞ
;

130984 
	gp
->
	gnP’dšgD©a
 = 0;

130985 
	gp
->
	gazCÞumn
 = (**)&
p
[1];

130986 
	gp
->
	gpTok’iz”
 = 
pTok’iz”
;

130987 
	gp
->
	gnMaxP’dšgD©a
 = 
FTS3_MAX_PENDING_DATA
;

130988 
	gp
->
	gbHasDocsize
 = (
isFts4
 && 
bNoDocsize
==0);

130989 
	gp
->
	gbHasSt
 = 
isFts4
;

130990 
	gp
->
	gbFts4
 = 
isFts4
;

130991 
	gp
->
	gbDescIdx
 = 
bDescIdx
;

130992 
	gp
->
	gnAutošüm”ge
 = 0xff;

130993 
	gp
->
	gzCÚ‹ÁTbl
 = 
zCÚ‹Á
;

130994 
	gp
->
	gzLªguageid
 = 
zLªguageid
;

130995 
	gzCÚ‹Á
 = 0;

130996 
	gzLªguageid
 = 0;

130997 
TESTONLY
Ð
p
->
šT¿n§ùiÚ
 = -1 );

130998 
TESTONLY
Ð
p
->
mxSav•ošt
 = -1 );

131000 
	gp
->
	gaIndex
 = (
Fts3Index
 *)&
p
->
azCÞumn
[
nCÞ
];

131001 
memýy
(
p
->
aIndex
,‡Index, (
Fts3Index
è* 
nIndex
);

131002 
	gp
->
	gnIndex
 = 
nIndex
;

131003 
	gi
=0; i<
	gnIndex
; i++){

131004 
ás3HashIn™
(&
p
->
aIndex
[
i
].
hP’dšg
, 
FTS3_HASH_STRING
, 1);

131006 
	gp
->
	gabNÙšdexed
 = (
u8
 *)&
p
->
aIndex
[
nIndex
];

131009 
	gzC¤
 = (*)&
p
->
abNÙšdexed
[
nCÞ
];

131010 
	gp
->
	gzName
 = 
zC¤
;

131011 
memýy
(
zC¤
, 
¬gv
[2], 
nName
);

131012 
	gzC¤
 +ð
nName
;

131013 
	gp
->
	gzDb
 = 
zC¤
;

131014 
memýy
(
zC¤
, 
¬gv
[1], 
nDb
);

131015 
	gzC¤
 +ð
nDb
;

131018 
	giCÞ
=0; iCÞ<
	gnCÞ
; iCol++){

131019 *
	gz
;

131020 
	gn
 = 0;

131021 
	gz
 = (*)
sql™e3Fts3NextTok’
(
aCÞ
[
iCÞ
], &
n
);

131022 
memýy
(
zC¤
, 
z
, 
n
);

131023 
	gzC¤
[
n
] = '\0';

131024 
sql™e3Fts3DequÙe
(
zC¤
);

131025 
	gp
->
	gazCÞumn
[
iCÞ
] = 
zC¤
;

131026 
	gzC¤
 +ð
n
+1;

131027 
as£¹
Ð
zC¤
 <ð&((*)
p
)[
nBy‹
] );

131031 
	giCÞ
=0; iCÞ<
	gnCÞ
; iCol++){

131032 
	gn
 = ()
¡¾’
(
p
->
azCÞumn
[
iCÞ
]);

131033 
	gi
=0; i<
	gnNÙšdexed
; i++){

131034 *
	gzNÙ
 = 
azNÙšdexed
[
i
];

131035 ifÐ
	gzNÙ
 && 
	gn
==()
¡¾’
(
zNÙ
)

131036 && 0==
sql™e3_¡ºicmp
(
p
->
azCÞumn
[
iCÞ
], 
zNÙ
, 
n
)

131038 
	gp
->
	gabNÙšdexed
[
iCÞ
] = 1;

131039 
sql™e3_ä“
(
zNÙ
);

131040 
	gazNÙšdexed
[
i
] = 0;

131044 
	gi
=0; i<
	gnNÙšdexed
; i++){

131045 ifÐ
	gazNÙšdexed
[
i
] ){

131046 *
	gpzE¼
 = 
sql™e3_m´štf
("nØsuch cÞumn: %s", 
azNÙšdexed
[
i
]);

131047 
	grc
 = 
SQLITE_ERROR
;

131051 ifÐ
	grc
==
SQLITE_OK
 && (
zCom´ess
==0)!=(
zUncom´ess
==0) ){

131052 cÚ¡ *
zMiss
 = (
zCom´ess
==0 ? "compress" : "uncompress");

131053 
	grc
 = 
SQLITE_ERROR
;

131054 *
	gpzE¼
 = 
sql™e3_m´štf
("missšg % ·¿m‘” iÀás4 cÚ¡ruùÜ", 
zMiss
);

131056 
	gp
->
	gzR—dEx´li¡
 = 
ás3R—dEx´Li¡
(
p
, 
zUncom´ess
, &
rc
);

131057 
	gp
->
	gzWr™eEx´li¡
 = 
ás3Wr™eEx´Li¡
(
p
, 
zCom´ess
, &
rc
);

131058 ifÐ
	grc
!=
SQLITE_OK
 ) 
ás3_š™_out
;

131063 ifÐ
	gisC»©e
 ){

131064 
	grc
 = 
ás3C»©eTabËs
(
p
);

131070 ifÐ!
	gisFts4
 && !
	gisC»©e
 ){

131071 
	gp
->
	gbHasSt
 = 2;

131076 
ás3D©aba£PageSize
(&
rc
, 
p
);

131077 
	gp
->
	gnNodeSize
 = 
p
->
nPgsz
-35;

131080 
ás3Deþ¬eVb
(&
rc
, 
p
);

131082 
	gás3_š™_out
:

131083 
sql™e3_ä“
(
zP»fix
);

131084 
sql™e3_ä“
(
aIndex
);

131085 
sql™e3_ä“
(
zCom´ess
);

131086 
sql™e3_ä“
(
zUncom´ess
);

131087 
sql™e3_ä“
(
zCÚ‹Á
);

131088 
sql™e3_ä“
(
zLªguageid
);

131089 
	gi
=0; i<
	gnNÙšdexed
; i++è
sql™e3_ä“
(
azNÙšdexed
[
i
]);

131090 
sql™e3_ä“
((*)
aCÞ
);

131091 
sql™e3_ä“
((*)
azNÙšdexed
);

131092 ifÐ
	grc
!=
SQLITE_OK
 ){

131093 ifÐ
p
 ){

131094 
ás3DiscÚÃùM‘hod
((
sql™e3_vb
 *)
p
);

131095 }ifÐ
	gpTok’iz”
 ){

131096 
	gpTok’iz”
->
	gpModuË
->
xDe¡roy
(
pTok’iz”
);

131099 
as£¹
Ð
p
->
pSegm’ts
==0 );

131100 *
	gµVTab
 = &
p
->
ba£
;

131102  
	grc
;

131109 
ás3CÚÃùM‘hod
(

131110 
sql™e3
 *
db
,

131111 *
pAux
,

131112 
¬gc
,

131113 cÚ¡ * cÚ¡ *
¬gv
,

131114 
sql™e3_vb
 **
µVb
,

131115 **
pzE¼


131117  
ás3In™Vb
(0, 
db
, 
pAux
, 
¬gc
, 
¬gv
, 
µVb
, 
pzE¼
);

131119 
ás3C»©eM‘hod
(

131120 
sql™e3
 *
db
,

131121 *
pAux
,

131122 
¬gc
,

131123 cÚ¡ * cÚ¡ *
¬gv
,

131124 
sql™e3_vb
 **
µVb
,

131125 **
pzE¼


131127  
ás3In™Vb
(1, 
db
, 
pAux
, 
¬gc
, 
¬gv
, 
µVb
, 
pzE¼
);

131135 
ás3S‘E¡im©edRows
(
sql™e3_šdex_šfo
 *
pIdxInfo
, 
i64
 
nRow
){

131136 #ià
SQLITE_VERSION_NUMBER
>=3008002

131137 ifÐ
sql™e3_libv”siÚ_numb”
()>=3008002 ){

131138 
pIdxInfo
->
e¡im©edRows
 = 
nRow
;

131151 
ás3Be¡IndexM‘hod
(
sql™e3_vb
 *
pVTab
, 
sql™e3_šdex_šfo
 *
pInfo
){

131152 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pVTab
;

131153 
	gi
;

131154 
	giCÚs
 = -1;

131156 
	giLªgidCÚs
 = -1;

131157 
	giDocidGe
 = -1;

131158 
	giDocidLe
 = -1;

131159 
	giIdx
;

131165 
	gpInfo
->
	gidxNum
 = 
FTS3_FULLSCAN_SEARCH
;

131166 
	gpInfo
->
	ge¡im©edCo¡
 = 5000000;

131167 
	gi
=0; i<
	gpInfo
->
	gnCÚ¡¿št
; i++){

131168 
	gbDocid
;

131169 
sql™e3_šdex_cÚ¡¿št
 *
	gpCÚs
 = &
pInfo
->
aCÚ¡¿št
[
i
];

131170 ifÐ
	gpCÚs
->
	gu§bË
==0 ){

131171 ifÐ
pCÚs
->
Ý
==
SQLITE_INDEX_CONSTRAINT_MATCH
 ){

131177 
pInfo
->
idxNum
 = 
FTS3_FULLSCAN_SEARCH
;

131178 
	gpInfo
->
	ge¡im©edCo¡
 = 1e50;

131179 
ás3S‘E¡im©edRows
(
pInfo
, ((
sql™e3_št64
)1) << 50);

131180  
	gSQLITE_OK
;

131185 
	gbDocid
 = (
pCÚs
->
iCÞumn
<0 ||…CÚs->iCÞumn==
p
->
nCÞumn
+1);

131188 ifÐ
	giCÚs
<0 && 
	gpCÚs
->
	gÝ
==
SQLITE_INDEX_CONSTRAINT_EQ
 && 
bDocid
 ){

131189 
pInfo
->
idxNum
 = 
FTS3_DOCID_SEARCH
;

131190 
	gpInfo
->
	ge¡im©edCo¡
 = 1.0;

131191 
	giCÚs
 = 
i
;

131203 ifÐ
	gpCÚs
->
	gÝ
==
SQLITE_INDEX_CONSTRAINT_MATCH


131204 && 
pCÚs
->
iCÞumn
>=0 &&…CÚs->iCÞumn<=
p
->
nCÞumn


131206 
pInfo
->
idxNum
 = 
FTS3_FULLTEXT_SEARCH
 + 
pCÚs
->
iCÞumn
;

131207 
	gpInfo
->
	ge¡im©edCo¡
 = 2.0;

131208 
	giCÚs
 = 
i
;

131212 ifÐ
	gpCÚs
->
	gÝ
==
SQLITE_INDEX_CONSTRAINT_EQ


131213 && 
pCÚs
->
iCÞumn
==
p
->
nCÞumn
 + 2

131215 
iLªgidCÚs
 = 
i
;

131218 ifÐ
	gbDocid
 ){

131219  
	gpCÚs
->
	gÝ
 ){

131220 
	gSQLITE_INDEX_CONSTRAINT_GE
:

131221 
SQLITE_INDEX_CONSTRAINT_GT
:

131222 
iDocidGe
 = 
i
;

131225 
	gSQLITE_INDEX_CONSTRAINT_LE
:

131226 
SQLITE_INDEX_CONSTRAINT_LT
:

131227 
iDocidLe
 = 
i
;

131233 
	giIdx
 = 1;

131234 ifÐ
	giCÚs
>=0 ){

131235 
pInfo
->
aCÚ¡¿štU§ge
[
iCÚs
].
¬gvIndex
 = 
iIdx
++;

131236 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iCÚs
].
	gom™
 = 1;

131238 ifÐ
	giLªgidCÚs
>=0 ){

131239 
pInfo
->
idxNum
 |ð
FTS3_HAVE_LANGID
;

131240 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iLªgidCÚs
].
	g¬gvIndex
 = 
iIdx
++;

131242 ifÐ
	giDocidGe
>=0 ){

131243 
pInfo
->
idxNum
 |ð
FTS3_HAVE_DOCID_GE
;

131244 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iDocidGe
].
	g¬gvIndex
 = 
iIdx
++;

131246 ifÐ
	giDocidLe
>=0 ){

131247 
pInfo
->
idxNum
 |ð
FTS3_HAVE_DOCID_LE
;

131248 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iDocidLe
].
	g¬gvIndex
 = 
iIdx
++;

131254 ifÐ
	gpInfo
->
	gnOrd”By
==1 ){

131255 
sql™e3_šdex_Üd”by
 *
pOrd”
 = &
pInfo
->
aOrd”By
[0];

131256 ifÐ
	gpOrd”
->
	giCÞumn
<0 ||…Ord”->iCÞumn==
p
->
nCÞumn
+1 ){

131257 ifÐ
pOrd”
->
desc
 ){

131258 
pInfo
->
idxSŒ
 = "DESC";

131260 
	gpInfo
->
	gidxSŒ
 = "ASC";

131262 
	gpInfo
->
	gÜd”ByCÚsumed
 = 1;

131266 
as£¹
Ð
p
->
pSegm’ts
==0 );

131267  
	gSQLITE_OK
;

131273 
ás3O³nM‘hod
(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µC¤
){

131274 
sql™e3_vb_cursÜ
 *
	gpC¤
;

131276 
UNUSED_PARAMETER
(
pVTab
);

131282 *
	gµC¤
 = 
pC¤
 = (
sql™e3_vb_cursÜ
 *)
sql™e3_m®loc
((
Fts3CursÜ
));

131283 ifÐ!
	gpC¤
 ){

131284  
	gSQLITE_NOMEM
;

131286 
mem£t
(
pC¤
, 0, (
Fts3CursÜ
));

131287  
	gSQLITE_OK
;

131294 
ás3Clo£M‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

131295 
Fts3CursÜ
 *
	gpC¤
 = (Fts3CursÜ *)
pCursÜ
;

131296 
as£¹
Ð((
Fts3TabË
 *)
pC¤
->
ba£
.
pVb
)->
pSegm’ts
==0 );

131297 
sql™e3_fš®ize
(
pC¤
->
pStmt
);

131298 
sql™e3Fts3Ex´F»e
(
pC¤
->
pEx´
);

131299 
sql™e3Fts3F»eDeã¼edTok’s
(
pC¤
);

131300 
sql™e3_ä“
(
pC¤
->
aDoþi¡
);

131301 
sql™e3_ä“
(
pC¤
->
aM©chšfo
);

131302 
as£¹
Ð((
Fts3TabË
 *)
pC¤
->
ba£
.
pVb
)->
pSegm’ts
==0 );

131303 
sql™e3_ä“
(
pC¤
);

131304  
	gSQLITE_OK
;

131318 
ás3CursÜS“kStmt
(
Fts3CursÜ
 *
pC¤
, 
sql™e3_¡mt
 **
µStmt
){

131319 
	grc
 = 
SQLITE_OK
;

131320 ifÐ
	gpC¤
->
	gpStmt
==0 ){

131321 
Fts3TabË
 *
p
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

131322 *
	gzSql
;

131323 
	gzSql
 = 
sql™e3_m´štf
("SELECT % WHERE„owid = ?", 
p
->
zR—dEx´li¡
);

131324 ifÐ!
	gzSql
 )  
	gSQLITE_NOMEM
;

131325 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pC¤
->
pStmt
, 0);

131326 
sql™e3_ä“
(
zSql
);

131328 *
	gµStmt
 = 
pC¤
->
pStmt
;

131329  
	grc
;

131337 
ás3CursÜS“k
(
sql™e3_cÚ‹xt
 *
pCÚ‹xt
, 
Fts3CursÜ
 *
pC¤
){

131338 
	grc
 = 
SQLITE_OK
;

131339 ifÐ
	gpC¤
->
	gisRequœeS“k
 ){

131340 
sql™e3_¡mt
 *
	gpStmt
 = 0;

131342 
	grc
 = 
ás3CursÜS“kStmt
(
pC¤
, &
pStmt
);

131343 ifÐ
	grc
==
SQLITE_OK
 ){

131344 
sql™e3_bšd_št64
(
pC¤
->
pStmt
, 1,…C¤->
iP»vId
);

131345 
	gpC¤
->
	gisRequœeS“k
 = 0;

131346 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pC¤
->
pStmt
) ){

131347  
SQLITE_OK
;

131349 
	grc
 = 
sql™e3_»£t
(
pC¤
->
pStmt
);

131350 ifÐ
	grc
==
SQLITE_OK
 && ((
Fts3TabË
 *)
pC¤
->
ba£
.
pVb
)->
zCÚ‹ÁTbl
==0 ){

131354 
rc
 = 
FTS_CORRUPT_VTAB
;

131355 
	gpC¤
->
	gisEof
 = 1;

131361 ifÐ
	grc
!=
SQLITE_OK
 && 
pCÚ‹xt
 ){

131362 
sql™e3_»suÉ_”rÜ_code
(
pCÚ‹xt
, 
rc
);

131364  
	grc
;

131382 
ás3SÿnIÁ”iÜNode
(

131383 cÚ¡ *
zT”m
,

131384 
nT”m
,

131385 cÚ¡ *
zNode
,

131386 
nNode
,

131387 
sql™e3_št64
 *
piFœ¡
,

131388 
sql™e3_št64
 *
piLa¡


131390 
	grc
 = 
SQLITE_OK
;

131391 cÚ¡ *
	gzC¤
 = 
zNode
;

131392 cÚ¡ *
	gzEnd
 = &
zC¤
[
nNode
];

131393 *
	gzBufãr
 = 0;

131394 
	gnAÎoc
 = 0;

131395 
	gisFœ¡T”m
 = 1;

131396 
sql™e3_št64
 
	giChžd
;

131411 
	gzC¤
 +ð
sql™e3Fts3G‘V¬št
(
zC¤
, &
iChžd
);

131412 
	gzC¤
 +ð
sql™e3Fts3G‘V¬št
(
zC¤
, &
iChžd
);

131413 ifÐ
	gzC¤
>
	gzEnd
 ){

131414  
	gFTS_CORRUPT_VTAB
;

131417  
	gzC¤
<
	gzEnd
 && (
	gpiFœ¡
 || 
	gpiLa¡
) ){

131418 
	gcmp
;

131419 
	gnSuffix
;

131420 
	gnP»fix
 = 0;

131421 
	gnBufãr
;

131425 ifÐ!
	gisFœ¡T”m
 ){

131426 
	gzC¤
 +ð
ás3G‘V¬št32
(
zC¤
, &
nP»fix
);

131428 
	gisFœ¡T”m
 = 0;

131429 
	gzC¤
 +ð
ás3G‘V¬št32
(
zC¤
, &
nSuffix
);

131431 ifÐ
	gnP»fix
<0 || 
	gnSuffix
<0 || &
	gzC¤
[
nSuffix
]>
	gzEnd
 ){

131432 
	grc
 = 
FTS_CORRUPT_VTAB
;

131433 
	gfšish_sÿn
;

131435 ifÐ
	gnP»fix
+
	gnSuffix
>
	gnAÎoc
 ){

131436 *
	gzNew
;

131437 
	gnAÎoc
 = (
nP»fix
+
nSuffix
) * 2;

131438 
	gzNew
 = (*)
sql™e3_»®loc
(
zBufãr
, 
nAÎoc
);

131439 ifÐ!
	gzNew
 ){

131440 
	grc
 = 
SQLITE_NOMEM
;

131441 
	gfšish_sÿn
;

131443 
	gzBufãr
 = 
zNew
;

131445 
as£¹
Ð
zBufãr
 );

131446 
memýy
(&
zBufãr
[
nP»fix
], 
zC¤
, 
nSuffix
);

131447 
	gnBufãr
 = 
nP»fix
 + 
nSuffix
;

131448 
	gzC¤
 +ð
nSuffix
;

131459 
	gcmp
 = 
memcmp
(
zT”m
, 
zBufãr
, (
nBufãr
>
nT”m
 ?‚Term :‚Buffer));

131460 ifÐ
	gpiFœ¡
 && (
	gcmp
<0 || (cmp==0 && 
nBufãr
>
nT”m
)) ){

131461 *
piFœ¡
 = 
iChžd
;

131462 
	gpiFœ¡
 = 0;

131465 ifÐ
	gpiLa¡
 && 
	gcmp
<0 ){

131466 *
	gpiLa¡
 = 
iChžd
;

131467 
	gpiLa¡
 = 0;

131470 
	giChžd
++;

131473 ifÐ
	gpiFœ¡
 ) *piFœ¡ = 
iChžd
;

131474 ifÐ
	gpiLa¡
 ) *piLa¡ = 
iChžd
;

131476 
	gfšish_sÿn
:

131477 
sql™e3_ä“
(
zBufãr
);

131478  
	grc
;

131503 
ás3S–eùL—f
(

131504 
Fts3TabË
 *
p
,

131505 cÚ¡ *
zT”m
,

131506 
nT”m
,

131507 cÚ¡ *
zNode
,

131508 
nNode
,

131509 
sql™e3_št64
 *
piL—f
,

131510 
sql™e3_št64
 *
piL—f2


131512 
	grc
;

131513 
	giHeight
;

131515 
as£¹
Ð
piL—f
 || 
piL—f2
 );

131517 
ás3G‘V¬št32
(
zNode
, &
iHeight
);

131518 
	grc
 = 
ás3SÿnIÁ”iÜNode
(
zT”m
, 
nT”m
, 
zNode
, 
nNode
, 
piL—f
, 
piL—f2
);

131519 
as£¹
Ð!
piL—f2
 || !
piL—f
 || 
rc
!=
SQLITE_OK
 || (*piLeaf<=*piLeaf2) );

131521 ifÐ
	grc
==
SQLITE_OK
 && 
iHeight
>1 ){

131522 *
zBlob
 = 0;

131523 
	gnBlob
;

131525 ifÐ
	gpiL—f
 && 
	gpiL—f2
 && (*piL—f!=*
piL—f2
) ){

131526 
rc
 = 
sql™e3Fts3R—dBlock
(
p
, *
piL—f
, &
zBlob
, &
nBlob
, 0);

131527 ifÐ
	grc
==
SQLITE_OK
 ){

131528 
rc
 = 
ás3S–eùL—f
(
p
, 
zT”m
, 
nT”m
, 
zBlob
, 
nBlob
, 
piL—f
, 0);

131530 
sql™e3_ä“
(
zBlob
);

131531 
	gpiL—f
 = 0;

131532 
	gzBlob
 = 0;

131535 ifÐ
	grc
==
SQLITE_OK
 ){

131536 
rc
 = 
sql™e3Fts3R—dBlock
(
p
, 
piL—f
?*piL—f:*
piL—f2
, &
zBlob
, &
nBlob
, 0);

131538 ifÐ
	grc
==
SQLITE_OK
 ){

131539 
rc
 = 
ás3S–eùL—f
(
p
, 
zT”m
, 
nT”m
, 
zBlob
, 
nBlob
, 
piL—f
, 
piL—f2
);

131541 
sql™e3_ä“
(
zBlob
);

131544  
	grc
;

131551 
ás3PutD–V¬št
(

131552 **
µ
,

131553 
sql™e3_št64
 *
piP»v
,

131554 
sql™e3_št64
 
iV®


131556 
as£¹
Ð
iV®
-*
piP»v
 > 0 || (*piPrev==0 && iVal==0) );

131557 *
	gµ
 +ð
sql™e3Fts3PutV¬št
(*
µ
, 
iV®
-*
piP»v
);

131558 *
	gpiP»v
 = 
iV®
;

131575 
ás3Po¦i¡CÝy
(**
µ
, **
µPo¦i¡
){

131576 *
	gpEnd
 = *
µPo¦i¡
;

131577 
	gc
 = 0;

131589  *
	gpEnd
 | 
	gc
 ){

131590 
	gc
 = *
pEnd
++ & 0x80;

131591 
‹¡ÿ£
Ð
c
!=0 && (*
pEnd
)==0 );

131593 
	gpEnd
++;

131595 ifÐ
	gµ
 ){

131596 
	gn
 = ()(
pEnd
 - *
µPo¦i¡
);

131597 *
	gp
 = *
µ
;

131598 
memýy
(
p
, *
µPo¦i¡
, 
n
);

131599 
	gp
 +ð
n
;

131600 *
	gµ
 = 
p
;

131602 *
	gµPo¦i¡
 = 
pEnd
;

131622 
ás3CÞumÆi¡CÝy
(**
µ
, **
µPo¦i¡
){

131623 *
	gpEnd
 = *
µPo¦i¡
;

131624 
	gc
 = 0;

131629  0xFE & (*
	gpEnd
 | 
	gc
) ){

131630 
	gc
 = *
pEnd
++ & 0x80;

131631 
‹¡ÿ£
Ð
c
!=0 && ((*
pEnd
)&0xfe)==0 );

131633 ifÐ
	gµ
 ){

131634 
	gn
 = ()(
pEnd
 - *
µPo¦i¡
);

131635 *
	gp
 = *
µ
;

131636 
memýy
(
p
, *
µPo¦i¡
, 
n
);

131637 
	gp
 +ð
n
;

131638 *
	gµ
 = 
p
;

131640 *
	gµPo¦i¡
 = 
pEnd
;

131647 
	#POSITION_LIST_END
 0x7fffffff

	)

131667 
ás3R—dNextPos
(

131668 **
µ
,

131669 
sql™e3_št64
 *
pi


131671 ifÐ(**
	gµ
)&0xFE ){

131672 
ás3G‘D–V¬št
(
µ
, 
pi
);

131673 *
	gpi
 -= 2;

131675 *
	gpi
 = 
POSITION_LIST_END
;

131688 
ás3PutCÞNumb”
(**
µ
, 
iCÞ
){

131689 
	gn
 = 0;

131690 ifÐ
	giCÞ
 ){

131691 *
	gp
 = *
µ
;

131692 
	gn
 = 1 + 
sql™e3Fts3PutV¬št
(&
p
[1], 
iCÞ
);

131693 *
	gp
 = 0x01;

131694 *
	gµ
 = &
p
[
n
];

131696  
	gn
;

131706 
ás3Po¦i¡M”ge
(

131707 **
µ
,

131708 **
µ1
,

131709 **
µ2


131711 *
	gp
 = *
µ
;

131712 *
	gp1
 = *
µ1
;

131713 *
	gp2
 = *
µ2
;

131715  *
	gp1
 || *
	gp2
 ){

131716 
	giCÞ1
;

131717 
	giCÞ2
;

131719 ifÐ*
	gp1
==
POS_COLUMN
 ) 
ás3G‘V¬št32
(&
p1
[1], &
iCÞ1
);

131720 ifÐ*
	gp1
==
POS_END
 ) 
iCÞ1
 = 
POSITION_LIST_END
;

131721 
	giCÞ1
 = 0;

131723 ifÐ*
	gp2
==
POS_COLUMN
 ) 
ás3G‘V¬št32
(&
p2
[1], &
iCÞ2
);

131724 ifÐ*
	gp2
==
POS_END
 ) 
iCÞ2
 = 
POSITION_LIST_END
;

131725 
	giCÞ2
 = 0;

131727 ifÐ
	giCÞ1
==
iCÞ2
 ){

131728 
sql™e3_št64
 
i1
 = 0;

131729 
sql™e3_št64
 
	gi2
 = 0;

131730 
sql™e3_št64
 
	giP»v
 = 0;

131731 
	gn
 = 
ás3PutCÞNumb”
(&
p
, 
iCÞ1
);

131732 
	gp1
 +ð
n
;

131733 
	gp2
 +ð
n
;

131744 
ás3G‘D–V¬št
(&
p1
, &
i1
);

131745 
ás3G‘D–V¬št
(&
p2
, &
i2
);

131747 
ás3PutD–V¬št
(&
p
, &
iP»v
, (
i1
<
i2
) ? i1 : i2);

131748 
	giP»v
 -= 2;

131749 ifÐ
	gi1
==
i2
 ){

131750 
ás3R—dNextPos
(&
p1
, &
i1
);

131751 
ás3R—dNextPos
(&
p2
, &
i2
);

131752 }ifÐ
	gi1
<
	gi2
 ){

131753 
ás3R—dNextPos
(&
p1
, &
i1
);

131755 
ás3R—dNextPos
(&
p2
, &
i2
);

131757 } 
	gi1
!=
POSITION_LIST_END
 || 
i2
!=POSITION_LIST_END );

131758 }ifÐ
	giCÞ1
<
	giCÞ2
 ){

131759 
	gp1
 +ð
ás3PutCÞNumb”
(&
p
, 
iCÞ1
);

131760 
ás3CÞumÆi¡CÝy
(&
p
, &
p1
);

131762 
	gp2
 +ð
ás3PutCÞNumb”
(&
p
, 
iCÞ2
);

131763 
ás3CÞumÆi¡CÝy
(&
p
, &
p2
);

131767 *
	gp
++ = 
POS_END
;

131768 *
	gµ
 = 
p
;

131769 *
	gµ1
 = 
p1
 + 1;

131770 *
	gµ2
 = 
p2
 + 1;

131796 
ás3Po¦i¡Ph¿£M”ge
(

131797 **
µ
,

131798 
nTok’
,

131799 
isSaveLeá
,

131800 
isExaù
,

131801 **
µ1
,

131802 **
µ2


131804 *
	gp
 = *
µ
;

131805 *
	gp1
 = *
µ1
;

131806 *
	gp2
 = *
µ2
;

131807 
	giCÞ1
 = 0;

131808 
	giCÞ2
 = 0;

131811 
as£¹
Ð
isSaveLeá
==0 || 
isExaù
==0 );

131813 
as£¹
Ð
p
!=0 && *
p1
!=0 && *
p2
!=0 );

131814 ifÐ*
	gp1
==
POS_COLUMN
 ){

131815 
p1
++;

131816 
	gp1
 +ð
ás3G‘V¬št32
(
p1
, &
iCÞ1
);

131818 ifÐ*
	gp2
==
POS_COLUMN
 ){

131819 
p2
++;

131820 
	gp2
 +ð
ás3G‘V¬št32
(
p2
, &
iCÞ2
);

131824 ifÐ
	giCÞ1
==
iCÞ2
 ){

131825 *
pSave
 = 
p
;

131826 
sql™e3_št64
 
	giP»v
 = 0;

131827 
sql™e3_št64
 
	giPos1
 = 0;

131828 
sql™e3_št64
 
	giPos2
 = 0;

131830 ifÐ
	giCÞ1
 ){

131831 *
	gp
++ = 
POS_COLUMN
;

131832 
	gp
 +ð
sql™e3Fts3PutV¬št
(
p
, 
iCÞ1
);

131835 
as£¹
Ð*
p1
!=
POS_END
 && *p1!=
POS_COLUMN
 );

131836 
as£¹
Ð*
p2
!=
POS_END
 && *p2!=
POS_COLUMN
 );

131837 
ás3G‘D–V¬št
(&
p1
, &
iPos1
); 
	giPos1
 -= 2;

131838 
ás3G‘D–V¬št
(&
p2
, &
iPos2
); 
	giPos2
 -= 2;

131841 ifÐ
	giPos2
==
iPos1
+
nTok’


131842 || (
isExaù
==0 && 
iPos2
>
iPos1
 && iPos2<=iPos1+
nTok’
)

131844 
sql™e3_št64
 
iSave
;

131845 
	giSave
 = 
isSaveLeá
 ? 
iPos1
 : 
iPos2
;

131846 
ás3PutD–V¬št
(&
p
, &
iP»v
, 
iSave
+2); 
	giP»v
 -= 2;

131847 
	gpSave
 = 0;

131848 
as£¹
Ð
p
 );

131850 ifÐ(!
	gisSaveLeá
 && 
	giPos2
<=(
iPos1
+
nTok’
)è|| 
iPos2
<=iPos1 ){

131851 ifÐ(*
p2
&0xFE)==0 ) ;

131852 
ás3G‘D–V¬št
(&
p2
, &
iPos2
); 
	giPos2
 -= 2;

131854 ifÐ(*
	gp1
&0xFE)==0 ) ;

131855 
ás3G‘D–V¬št
(&
p1
, &
iPos1
); 
	giPos1
 -= 2;

131859 ifÐ
	gpSave
 ){

131860 
as£¹
Ð
µ
 && 
p
 );

131861 
	gp
 = 
pSave
;

131864 
ás3CÞumÆi¡CÝy
(0, &
p1
);

131865 
ás3CÞumÆi¡CÝy
(0, &
p2
);

131866 
as£¹
Ð(*
p1
&0xFE)==0 && (*
p2
&0xFE)==0 );

131867 ifÐ0==*
p1
 || 0==*
p2
 ) ;

131869 
	gp1
++;

131870 
	gp1
 +ð
ás3G‘V¬št32
(
p1
, &
iCÞ1
);

131871 
	gp2
++;

131872 
	gp2
 +ð
ás3G‘V¬št32
(
p2
, &
iCÞ2
);

131880 ifÐ
	giCÞ1
<
	giCÞ2
 ){

131881 
ás3CÞumÆi¡CÝy
(0, &
p1
);

131882 ifÐ0==*
p1
 ) ;

131883 
	gp1
++;

131884 
	gp1
 +ð
ás3G‘V¬št32
(
p1
, &
iCÞ1
);

131886 
ás3CÞumÆi¡CÝy
(0, &
p2
);

131887 ifÐ0==*
p2
 ) ;

131888 
	gp2
++;

131889 
	gp2
 +ð
ás3G‘V¬št32
(
p2
, &
iCÞ2
);

131893 
ás3Po¦i¡CÝy
(0, &
p2
);

131894 
ás3Po¦i¡CÝy
(0, &
p1
);

131895 *
	gµ1
 = 
p1
;

131896 *
	gµ2
 = 
p2
;

131897 ifÐ*
	gµ
==
p
 ){

131900 *
	gp
++ = 0x00;

131901 *
	gµ
 = 
p
;

131920 
ás3Po¦i¡N—rM”ge
(

131921 **
µ
,

131922 *
aTmp
,

131923 
nRight
,

131924 
nLeá
,

131925 **
µ1
,

131926 **
µ2


131928 *
	gp1
 = *
µ1
;

131929 *
	gp2
 = *
µ2
;

131931 *
	gpTmp1
 = 
aTmp
;

131932 *
	gpTmp2
;

131933 *
	gaTmp2
;

131934 
	g»s
 = 1;

131936 
ás3Po¦i¡Ph¿£M”ge
(&
pTmp1
, 
nRight
, 0, 0, 
µ1
, 
µ2
);

131937 
	gaTmp2
 = 
pTmp2
 = 
pTmp1
;

131938 *
	gµ1
 = 
p1
;

131939 *
	gµ2
 = 
p2
;

131940 
ás3Po¦i¡Ph¿£M”ge
(&
pTmp2
, 
nLeá
, 1, 0, 
µ2
, 
µ1
);

131941 ifÐ
	gpTmp1
!=
aTmp
 && 
pTmp2
!=
aTmp2
 ){

131942 
ás3Po¦i¡M”ge
(
µ
, &
aTmp
, &
aTmp2
);

131943 }ifÐ
	gpTmp1
!=
aTmp
 ){

131944 
ás3Po¦i¡CÝy
(
µ
, &
aTmp
);

131945 }ifÐ
	gpTmp2
!=
aTmp2
 ){

131946 
ás3Po¦i¡CÝy
(
µ
, &
aTmp2
);

131948 
	g»s
 = 0;

131951  
	g»s
;

131959 
T”mS–eù
 
	tT”mS–eù
;

131960 
	sT”mS–eù
 {

131961 *
	g¯Ouut
[16];

131962 
	gªOuut
[16];

131978 
ás3G‘D–V¬št3
(

131979 **
µ
,

131980 *
pEnd
,

131981 
bDescIdx
,

131982 
sql™e3_št64
 *
pV®


131984 ifÐ*
	gµ
>=
pEnd
 ){

131985 *
µ
 = 0;

131987 
sql™e3_št64
 
	giV®
;

131988 *
	gµ
 +ð
sql™e3Fts3G‘V¬št
(*
µ
, &
iV®
);

131989 ifÐ
	gbDescIdx
 ){

131990 *
	gpV®
 -ð
iV®
;

131992 *
	gpV®
 +ð
iV®
;

132012 
ás3PutD–V¬št3
(

132013 **
µ
,

132014 
bDescIdx
,

132015 
sql™e3_št64
 *
piP»v
,

132016 *
pbFœ¡
,

132017 
sql™e3_št64
 
iV®


132019 
sql™e3_št64
 
	giWr™e
;

132020 ifÐ
	gbDescIdx
==0 || *
pbFœ¡
==0 ){

132021 
iWr™e
 = 
iV®
 - *
piP»v
;

132023 
	giWr™e
 = *
piP»v
 - 
iV®
;

132025 
as£¹
Ð*
pbFœ¡
 || *
piP»v
==0 );

132026 
as£¹
Ð*
pbFœ¡
==0 || 
iWr™e
>0 );

132027 *
	gµ
 +ð
sql™e3Fts3PutV¬št
(*
µ
, 
iWr™e
);

132028 *
	gpiP»v
 = 
iV®
;

132029 *
	gpbFœ¡
 = 1;

132042 
	#DOCID_CMP
(
i1
, 
i2
è((
bDescDoþi¡
?-1:1è* (i1-i2))

	)

132058 
ás3Doþi¡OrM”ge
(

132059 
bDescDoþi¡
,

132060 *
a1
, 
n1
,

132061 *
a2
, 
n2
,

132062 **
·Out
, *
²Out


132064 
sql™e3_št64
 
	gi1
 = 0;

132065 
sql™e3_št64
 
	gi2
 = 0;

132066 
sql™e3_št64
 
	giP»v
 = 0;

132067 *
	gpEnd1
 = &
a1
[
n1
];

132068 *
	gpEnd2
 = &
a2
[
n2
];

132069 *
	gp1
 = 
a1
;

132070 *
	gp2
 = 
a2
;

132071 *
	gp
;

132072 *
	gaOut
;

132073 
	gbFœ¡Out
 = 0;

132075 *
	g·Out
 = 0;

132076 *
	g²Out
 = 0;

132107 
	gaOut
 = 
sql™e3_m®loc
(
n1
+
n2
+
FTS3_VARINT_MAX
-1);

132108 ifÐ!
	gaOut
 )  
	gSQLITE_NOMEM
;

132110 
	gp
 = 
aOut
;

132111 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 0, &
i1
);

132112 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 0, &
i2
);

132113  
	gp1
 || 
	gp2
 ){

132114 
sql™e3_št64
 
	giDiff
 = 
DOCID_CMP
(
i1
, 
i2
);

132116 ifÐ
	gp2
 && 
	gp1
 && 
	giDiff
==0 ){

132117 
ás3PutD–V¬št3
(&
p
, 
bDescDoþi¡
, &
iP»v
, &
bFœ¡Out
, 
i1
);

132118 
ás3Po¦i¡M”ge
(&
p
, &
p1
, &
p2
);

132119 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 
bDescDoþi¡
, &
i1
);

132120 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 
bDescDoþi¡
, &
i2
);

132121 }ifÐ!
	gp2
 || (
	gp1
 && 
	giDiff
<0) ){

132122 
ás3PutD–V¬št3
(&
p
, 
bDescDoþi¡
, &
iP»v
, &
bFœ¡Out
, 
i1
);

132123 
ás3Po¦i¡CÝy
(&
p
, &
p1
);

132124 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 
bDescDoþi¡
, &
i1
);

132126 
ás3PutD–V¬št3
(&
p
, 
bDescDoþi¡
, &
iP»v
, &
bFœ¡Out
, 
i2
);

132127 
ás3Po¦i¡CÝy
(&
p
, &
p2
);

132128 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 
bDescDoþi¡
, &
i2
);

132132 *
	g·Out
 = 
aOut
;

132133 *
	g²Out
 = ()(
p
-
aOut
);

132134 
as£¹
Ð*
²Out
<=
n1
+
n2
+
FTS3_VARINT_MAX
-1 );

132135  
	gSQLITE_OK
;

132150 
ás3Doþi¡Ph¿£M”ge
(

132151 
bDescDoþi¡
,

132152 
nDi¡
,

132153 *
aLeá
, 
nLeá
,

132154 *
aRight
, *
²Right


132156 
sql™e3_št64
 
	gi1
 = 0;

132157 
sql™e3_št64
 
	gi2
 = 0;

132158 
sql™e3_št64
 
	giP»v
 = 0;

132159 *
	gpEnd1
 = &
aLeá
[
nLeá
];

132160 *
	gpEnd2
 = &
aRight
[*
²Right
];

132161 *
	gp1
 = 
aLeá
;

132162 *
	gp2
 = 
aRight
;

132163 *
	gp
;

132164 
	gbFœ¡Out
 = 0;

132165 *
	gaOut
 = 
aRight
;

132167 
as£¹
Ð
nDi¡
>0 );

132169 
	gp
 = 
aOut
;

132170 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 0, &
i1
);

132171 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 0, &
i2
);

132173  
	gp1
 && 
	gp2
 ){

132174 
sql™e3_št64
 
	giDiff
 = 
DOCID_CMP
(
i1
, 
i2
);

132175 ifÐ
	giDiff
==0 ){

132176 *
pSave
 = 
p
;

132177 
sql™e3_št64
 
	giP»vSave
 = 
iP»v
;

132178 
	gbFœ¡OutSave
 = 
bFœ¡Out
;

132180 
ás3PutD–V¬št3
(&
p
, 
bDescDoþi¡
, &
iP»v
, &
bFœ¡Out
, 
i1
);

132181 ifÐ0==
ás3Po¦i¡Ph¿£M”ge
(&
p
, 
nDi¡
, 0, 1, &
p1
, &
p2
) ){

132182 
	gp
 = 
pSave
;

132183 
	giP»v
 = 
iP»vSave
;

132184 
	gbFœ¡Out
 = 
bFœ¡OutSave
;

132186 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 
bDescDoþi¡
, &
i1
);

132187 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 
bDescDoþi¡
, &
i2
);

132188 }ifÐ
	giDiff
<0 ){

132189 
ás3Po¦i¡CÝy
(0, &
p1
);

132190 
ás3G‘D–V¬št3
(&
p1
, 
pEnd1
, 
bDescDoþi¡
, &
i1
);

132192 
ás3Po¦i¡CÝy
(0, &
p2
);

132193 
ás3G‘D–V¬št3
(&
p2
, 
pEnd2
, 
bDescDoþi¡
, &
i2
);

132197 *
	g²Right
 = ()(
p
 - 
aOut
);

132208 
SQLITE_PRIVATE
 
sql™e3Fts3Fœ¡Fž‹r
(

132209 
sql™e3_št64
 
iD–
,

132210 *
pLi¡
,

132211 
nLi¡
,

132212 *
pOut


132214 
	gnOut
 = 0;

132215 
	gbWr™‹n
 = 0;

132216 *
	gp
 = 
pLi¡
;

132217 *
	gpEnd
 = &
pLi¡
[
nLi¡
];

132219 ifÐ*
	gp
!=0x01 ){

132220 ifÐ*
p
==0x02 ){

132221 
nOut
 +ð
sql™e3Fts3PutV¬št
(&
pOut
[nOut], 
iD–
);

132222 
	gpOut
[
nOut
++] = 0x02;

132223 
	gbWr™‹n
 = 1;

132225 
ás3CÞumÆi¡CÝy
(0, &
p
);

132228  
	gp
<
	gpEnd
 && *p==0x01 ){

132229 
sql™e3_št64
 
iCÞ
;

132230 
	gp
++;

132231 
	gp
 +ð
sql™e3Fts3G‘V¬št
(
p
, &
iCÞ
);

132232 ifÐ*
	gp
==0x02 ){

132233 ifÐ
bWr™‹n
==0 ){

132234 
nOut
 +ð
sql™e3Fts3PutV¬št
(&
pOut
[nOut], 
iD–
);

132235 
	gbWr™‹n
 = 1;

132237 
	gpOut
[
nOut
++] = 0x01;

132238 
	gnOut
 +ð
sql™e3Fts3PutV¬št
(&
pOut
[
nOut
], 
iCÞ
);

132239 
	gpOut
[
nOut
++] = 0x02;

132241 
ás3CÞumÆi¡CÝy
(0, &
p
);

132243 ifÐ
	gbWr™‹n
 ){

132244 
	gpOut
[
nOut
++] = 0x00;

132247  
	gnOut
;

132260 
ás3T”mS–eùFšishM”ge
(
Fts3TabË
 *
p
, 
T”mS–eù
 *
pTS
){

132261 *
	gaOut
 = 0;

132262 
	gnOut
 = 0;

132263 
	gi
;

132268 
	gi
=0; i<
SizeofA¼ay
(
pTS
->
¯Ouut
); i++){

132269 ifÐ
	gpTS
->
	g¯Ouut
[
i
] ){

132270 ifÐ!
	gaOut
 ){

132271 
	gaOut
 = 
pTS
->
¯Ouut
[
i
];

132272 
	gnOut
 = 
pTS
->
ªOuut
[
i
];

132273 
	gpTS
->
	g¯Ouut
[
i
] = 0;

132275 
	gnNew
;

132276 *
	gaNew
;

132278 
	grc
 = 
ás3Doþi¡OrM”ge
(
p
->
bDescIdx
,

132279 
pTS
->
¯Ouut
[
i
],…TS->
ªOuut
[i], 
aOut
, 
nOut
, &
aNew
, &
nNew


132281 ifÐ
	grc
!=
SQLITE_OK
 ){

132282 
sql™e3_ä“
(
aOut
);

132283  
	grc
;

132286 
sql™e3_ä“
(
pTS
->
¯Ouut
[
i
]);

132287 
sql™e3_ä“
(
aOut
);

132288 
	gpTS
->
	g¯Ouut
[
i
] = 0;

132289 
	gaOut
 = 
aNew
;

132290 
	gnOut
 = 
nNew
;

132295 
	gpTS
->
	g¯Ouut
[0] = 
aOut
;

132296 
	gpTS
->
	gªOuut
[0] = 
nOut
;

132297  
	gSQLITE_OK
;

132314 
ás3T”mS–eùM”ge
(

132315 
Fts3TabË
 *
p
,

132316 
T”mS–eù
 *
pTS
,

132317 *
aDoþi¡
,

132318 
nDoþi¡


132320 ifÐ
	gpTS
->
	g¯Ouut
[0]==0 ){

132323 
pTS
->
¯Ouut
[0] = 
sql™e3_m®loc
(
nDoþi¡
);

132324 
	gpTS
->
	gªOuut
[0] = 
nDoþi¡
;

132325 ifÐ
	gpTS
->
	g¯Ouut
[0] ){

132326 
memýy
(
pTS
->
¯Ouut
[0], 
aDoþi¡
, 
nDoþi¡
);

132328  
	gSQLITE_NOMEM
;

132331 *
	gaM”ge
 = 
aDoþi¡
;

132332 
	gnM”ge
 = 
nDoþi¡
;

132333 
	giOut
;

132335 
	giOut
=0; iOut<
SizeofA¼ay
(
pTS
->
¯Ouut
); iOut++){

132336 ifÐ
	gpTS
->
	g¯Ouut
[
iOut
]==0 ){

132337 
as£¹
Ð
iOut
>0 );

132338 
	gpTS
->
	g¯Ouut
[
iOut
] = 
aM”ge
;

132339 
	gpTS
->
	gªOuut
[
iOut
] = 
nM”ge
;

132342 *
	gaNew
;

132343 
	gnNew
;

132345 
	grc
 = 
ás3Doþi¡OrM”ge
(
p
->
bDescIdx
, 
aM”ge
, 
nM”ge
,

132346 
pTS
->
¯Ouut
[
iOut
],…TS->
ªOuut
[iOut], &
aNew
, &
nNew


132348 ifÐ
	grc
!=
SQLITE_OK
 ){

132349 ifÐ
aM”ge
!=
aDoþi¡
 ) 
sql™e3_ä“
(aMerge);

132350  
	grc
;

132353 ifÐ
	gaM”ge
!=
aDoþi¡
 ) 
sql™e3_ä“
(
aM”ge
);

132354 
sql™e3_ä“
(
pTS
->
¯Ouut
[
iOut
]);

132355 
	gpTS
->
	g¯Ouut
[
iOut
] = 0;

132357 
	gaM”ge
 = 
aNew
;

132358 
	gnM”ge
 = 
nNew
;

132359 ifÐ(
	giOut
+1)==
SizeofA¼ay
(
pTS
->
¯Ouut
) ){

132360 
pTS
->
¯Ouut
[
iOut
] = 
aM”ge
;

132361 
	gpTS
->
	gªOuut
[
iOut
] = 
nM”ge
;

132366  
	gSQLITE_OK
;

132372 
ás3SegR—d”CursÜAµ’d
(

132373 
Fts3MuÉiSegR—d”
 *
pC¤
,

132374 
Fts3SegR—d”
 *
pNew


132376 ifÐ(
	gpC¤
->
	gnSegm’t
%16)==0 ){

132377 
Fts3SegR—d”
 **
­New
;

132378 
	gnBy‹
 = (
pC¤
->
nSegm’t
 + 16)*(
Fts3SegR—d”
*);

132379 
	g­New
 = (
Fts3SegR—d”
 **)
sql™e3_»®loc
(
pC¤
->
­Segm’t
, 
nBy‹
);

132380 ifÐ!
	g­New
 ){

132381 
sql™e3Fts3SegR—d”F»e
(
pNew
);

132382  
	gSQLITE_NOMEM
;

132384 
	gpC¤
->
	g­Segm’t
 = 
­New
;

132386 
	gpC¤
->
	g­Segm’t
[
pC¤
->
nSegm’t
++] = 
pNew
;

132387  
	gSQLITE_OK
;

132397 
ás3SegR—d”CursÜ
(

132398 
Fts3TabË
 *
p
,

132399 
iLªgid
,

132400 
iIndex
,

132401 
iLev–
,

132402 cÚ¡ *
zT”m
,

132403 
nT”m
,

132404 
isP»fix
,

132405 
isSÿn
,

132406 
Fts3MuÉiSegR—d”
 *
pC¤


132408 
	grc
 = 
SQLITE_OK
;

132409 
sql™e3_¡mt
 *
	gpStmt
 = 0;

132410 
	grc2
;

132418 ifÐ
	giLev–
<0 && 
	gp
->
	gaIndex
 ){

132419 
Fts3SegR—d”
 *
	gpSeg
 = 0;

132420 
	grc
 = 
sql™e3Fts3SegR—d”P’dšg
(
p
, 
iIndex
, 
zT”m
, 
nT”m
, 
isP»fix
, &
pSeg
);

132421 ifÐ
	grc
==
SQLITE_OK
 && 
pSeg
 ){

132422 
rc
 = 
ás3SegR—d”CursÜAµ’d
(
pC¤
, 
pSeg
);

132426 ifÐ
	giLev–
!=
FTS3_SEGCURSOR_PENDING
 ){

132427 ifÐ
rc
==
SQLITE_OK
 ){

132428 
rc
 = 
sql™e3Fts3AÎSegdœs
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
, &
pStmt
);

132431  
	grc
==
SQLITE_OK
 && 
SQLITE_ROW
==(
rc
 = 
sql™e3_¡•
(
pStmt
)) ){

132432 
Fts3SegR—d”
 *
pSeg
 = 0;

132435 
sql™e3_št64
 
	giS¹Block
 = 
sql™e3_cÞumn_št64
(
pStmt
, 1);

132436 
sql™e3_št64
 
	giL—vesEndBlock
 = 
sql™e3_cÞumn_št64
(
pStmt
, 2);

132437 
sql™e3_št64
 
	giEndBlock
 = 
sql™e3_cÞumn_št64
(
pStmt
, 3);

132438 
	gnRoÙ
 = 
sql™e3_cÞumn_by‹s
(
pStmt
, 4);

132439 cÚ¡ *
	gzRoÙ
 = 
sql™e3_cÞumn_blob
(
pStmt
, 4);

132443 ifÐ
	giS¹Block
 && 
	gzT”m
 ){

132444 
sql™e3_št64
 *
	gpi
 = (
isP»fix
 ? &
iL—vesEndBlock
 : 0);

132445 
	grc
 = 
ás3S–eùL—f
(
p
, 
zT”m
, 
nT”m
, 
zRoÙ
, 
nRoÙ
, &
iS¹Block
, 
pi
);

132446 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

132447 ifÐ
	gisP»fix
==0 && 
isSÿn
==0 ) 
iL—vesEndBlock
 = 
iS¹Block
;

132450 
	grc
 = 
sql™e3Fts3SegR—d”New
(
pC¤
->
nSegm’t
+1,

132451 (
isP»fix
==0 && 
isSÿn
==0),

132452 
iS¹Block
, 
iL—vesEndBlock
,

132453 
iEndBlock
, 
zRoÙ
, 
nRoÙ
, &
pSeg


132455 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

132456 
	grc
 = 
ás3SegR—d”CursÜAµ’d
(
pC¤
, 
pSeg
);

132460 
	gfšished
:

132461 
rc2
 = 
sql™e3_»£t
(
pStmt
);

132462 ifÐ
	grc
==
SQLITE_DONE
 ) 
rc
 = 
rc2
;

132464  
	grc
;

132471 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”CursÜ
(

132472 
Fts3TabË
 *
p
,

132473 
iLªgid
,

132474 
iIndex
,

132475 
iLev–
,

132476 cÚ¡ *
zT”m
,

132477 
nT”m
,

132478 
isP»fix
,

132479 
isSÿn
,

132480 
Fts3MuÉiSegR—d”
 *
pC¤


132482 
as£¹
Ð
iIndex
>=0 && iIndex<
p
->
nIndex
 );

132483 
as£¹
Ð
iLev–
==
FTS3_SEGCURSOR_ALL


132484 || 
iLev–
==
FTS3_SEGCURSOR_PENDING


132485 || 
iLev–
>=0

132487 
as£¹
Ð
iLev–
<
FTS3_SEGDIR_MAXLEVEL
 );

132488 
as£¹
Ð
FTS3_SEGCURSOR_ALL
<0 && 
FTS3_SEGCURSOR_PENDING
<0 );

132489 
as£¹
Ð
isP»fix
==0 || 
isSÿn
==0 );

132491 
mem£t
(
pC¤
, 0, (
Fts3MuÉiSegR—d”
));

132492  
ás3SegR—d”CursÜ
(

132493 
p
, 
iLªgid
, 
iIndex
, 
iLev–
, 
zT”m
, 
nT”m
, 
isP»fix
, 
isSÿn
, 
pC¤


132503 
ás3SegR—d”CursÜAddZ”o
(

132504 
Fts3TabË
 *
p
,

132505 
iLªgid
,

132506 cÚ¡ *
zT”m
,

132507 
nT”m
,

132508 
Fts3MuÉiSegR—d”
 *
pC¤


132510  
ás3SegR—d”CursÜ
(
p
,

132511 
iLªgid
, 0, 
FTS3_SEGCURSOR_ALL
, 
zT”m
, 
nT”m
, 0, 0,
pC¤


132528 
ás3T”mSegR—d”CursÜ
(

132529 
Fts3CursÜ
 *
pC¤
,

132530 cÚ¡ *
zT”m
,

132531 
nT”m
,

132532 
isP»fix
,

132533 
Fts3MuÉiSegR—d”
 **
µSegc¤


132535 
Fts3MuÉiSegR—d”
 *
	gpSegc¤
;

132536 
	grc
 = 
SQLITE_NOMEM
;

132538 
	gpSegc¤
 = 
sql™e3_m®loc
((
Fts3MuÉiSegR—d”
));

132539 ifÐ
	gpSegc¤
 ){

132540 
	gi
;

132541 
	gbFound
 = 0;

132542 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

132544 ifÐ
	gisP»fix
 ){

132545 
	gi
=1; 
	gbFound
==0 && 
i
<
p
->
nIndex
; i++){

132546 ifÐ
	gp
->
	gaIndex
[
i
].
	gnP»fix
==
nT”m
 ){

132547 
bFound
 = 1;

132548 
	grc
 = 
sql™e3Fts3SegR—d”CursÜ
(
p
, 
pC¤
->
iLªgid
,

132549 
i
, 
FTS3_SEGCURSOR_ALL
, 
zT”m
, 
nT”m
, 0, 0, 
pSegc¤


132551 
	gpSegc¤
->
	gbLookup
 = 1;

132555 
	gi
=1; 
	gbFound
==0 && 
i
<
p
->
nIndex
; i++){

132556 ifÐ
	gp
->
	gaIndex
[
i
].
	gnP»fix
==
nT”m
+1 ){

132557 
bFound
 = 1;

132558 
	grc
 = 
sql™e3Fts3SegR—d”CursÜ
(
p
, 
pC¤
->
iLªgid
,

132559 
i
, 
FTS3_SEGCURSOR_ALL
, 
zT”m
, 
nT”m
, 1, 0, 
pSegc¤


132561 ifÐ
	grc
==
SQLITE_OK
 ){

132562 
rc
 = 
ás3SegR—d”CursÜAddZ”o
(

132563 
p
, 
pC¤
->
iLªgid
, 
zT”m
, 
nT”m
, 
pSegc¤


132570 ifÐ
	gbFound
==0 ){

132571 
rc
 = 
sql™e3Fts3SegR—d”CursÜ
(
p
, 
pC¤
->
iLªgid
,

132572 0, 
FTS3_SEGCURSOR_ALL
, 
zT”m
, 
nT”m
, 
isP»fix
, 0, 
pSegc¤


132574 
	gpSegc¤
->
	gbLookup
 = !
isP»fix
;

132578 *
	gµSegc¤
 = 
pSegc¤
;

132579  
	grc
;

132585 
ás3SegR—d”CursÜF»e
(
Fts3MuÉiSegR—d”
 *
pSegc¤
){

132586 
sql™e3Fts3SegR—d”Fšish
(
pSegc¤
);

132587 
sql™e3_ä“
(
pSegc¤
);

132594 
ás3T”mS–eù
(

132595 
Fts3TabË
 *
p
,

132596 
Fts3Ph¿£Tok’
 *
pTok
,

132597 
iCÞumn
,

132598 *
²Out
,

132599 **
µOut


132601 
	grc
;

132602 
Fts3MuÉiSegR—d”
 *
	gpSegc¤
;

132603 
T”mS–eù
 
	gtsc
;

132604 
Fts3SegFž‹r
 
	gfž‹r
;

132606 
	gpSegc¤
 = 
pTok
->
pSegc¤
;

132607 
mem£t
(&
tsc
, 0, (
T”mS–eù
));

132609 
	gfž‹r
.
	gæags
 = 
FTS3_SEGMENT_IGNORE_EMPTY
 | 
FTS3_SEGMENT_REQUIRE_POS


132610 | (
pTok
->
isP»fix
 ? 
FTS3_SEGMENT_PREFIX
 : 0)

132611 | (
pTok
->
bFœ¡
 ? 
FTS3_SEGMENT_FIRST
 : 0)

132612 | (
iCÞumn
<
p
->
nCÞumn
 ? 
FTS3_SEGMENT_COLUMN_FILTER
 : 0);

132613 
	gfž‹r
.
	giCÞ
 = 
iCÞumn
;

132614 
	gfž‹r
.
	gzT”m
 = 
pTok
->
z
;

132615 
	gfž‹r
.
	gnT”m
 = 
pTok
->
n
;

132617 
	grc
 = 
sql™e3Fts3SegR—d”S¹
(
p
, 
pSegc¤
, &
fž‹r
);

132618  
	gSQLITE_OK
==
rc


132619 && 
SQLITE_ROW
==(
rc
 = 
sql™e3Fts3SegR—d”S‹p
(
p
, 
pSegc¤
))

132621 
	grc
 = 
ás3T”mS–eùM”ge
(
p
, &
tsc
, 
pSegc¤
->
aDoþi¡
,…Segc¤->
nDoþi¡
);

132624 ifÐ
	grc
==
SQLITE_OK
 ){

132625 
rc
 = 
ás3T”mS–eùFšishM”ge
(
p
, &
tsc
);

132627 ifÐ
	grc
==
SQLITE_OK
 ){

132628 *
µOut
 = 
tsc
.
¯Ouut
[0];

132629 *
	g²Out
 = 
tsc
.
ªOuut
[0];

132631 
	gi
;

132632 
	gi
=0; i<
SizeofA¼ay
(
tsc
.
¯Ouut
); i++){

132633 
sql™e3_ä“
(
tsc
.
¯Ouut
[
i
]);

132637 
ás3SegR—d”CursÜF»e
(
pSegc¤
);

132638 
	gpTok
->
	gpSegc¤
 = 0;

132639  
	grc
;

132651 
ás3Doþi¡CouÁDocids
(*
aLi¡
, 
nLi¡
){

132652 
	gnDoc
 = 0;

132653 ifÐ
	gaLi¡
 ){

132654 *
	gaEnd
 = &
aLi¡
[
nLi¡
];

132655 *
	gp
 = 
aLi¡
;

132656  
	gp
<
	gaEnd
 ){

132657 
	gnDoc
++;

132658  (*
	gp
++)&0x80 );

132659 
ás3Po¦i¡CÝy
(0, &
p
);

132663  
	gnDoc
;

132677 
ás3NextM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

132678 
	grc
;

132679 
Fts3CursÜ
 *
	gpC¤
 = (Fts3CursÜ *)
pCursÜ
;

132680 ifÐ
	gpC¤
->
	geS—rch
==
FTS3_DOCID_SEARCH
 || 
pC¤
->
eS—rch
==
FTS3_FULLSCAN_SEARCH
 ){

132681 ifÐ
SQLITE_ROW
!=
sql™e3_¡•
(
pC¤
->
pStmt
) ){

132682 
pC¤
->
isEof
 = 1;

132683 
	grc
 = 
sql™e3_»£t
(
pC¤
->
pStmt
);

132685 
	gpC¤
->
	giP»vId
 = 
sql™e3_cÞumn_št64
(
pC¤
->
pStmt
, 0);

132686 
	grc
 = 
SQLITE_OK
;

132689 
	grc
 = 
ás3Ev®Next
((
Fts3CursÜ
 *)
pCursÜ
);

132691 
as£¹
Ð((
Fts3TabË
 *)
pC¤
->
ba£
.
pVb
)->
pSegm’ts
==0 );

132692  
	grc
;

132702 #iâdeà
SQLITE_AMALGAMATION


132703 
	#LARGEST_INT64
 (0xffffffff|(((
sql™e3_št64
)0x7fffffff)<<32))

	)

132704 
	#SMALLEST_INT64
 (((
sql™e3_št64
)-1è- 
LARGEST_INT64
)

	)

132712 
sql™e3_št64
 
ás3DocidRªge
(
sql™e3_v®ue
 *
pV®
, 
i64
 
iDeçuÉ
){

132713 ifÐ
	gpV®
 ){

132714 
	geTy³
 = 
sql™e3_v®ue_num”ic_ty³
(
pV®
);

132715 ifÐ
	geTy³
==
SQLITE_INTEGER
 ){

132716  
sql™e3_v®ue_št64
(
pV®
);

132719  
	giDeçuÉ
;

132738 
ás3Fž‹rM‘hod
(

132739 
sql™e3_vb_cursÜ
 *
pCursÜ
,

132740 
idxNum
,

132741 cÚ¡ *
idxSŒ
,

132742 
nV®
,

132743 
sql™e3_v®ue
 **
­V®


132745 
	grc
;

132746 *
	gzSql
;

132747 
	geS—rch
;

132748 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pCursÜ
->
pVb
;

132749 
Fts3CursÜ
 *
	gpC¤
 = (Fts3CursÜ *)
pCursÜ
;

132751 
sql™e3_v®ue
 *
	gpCÚs
 = 0;

132752 
sql™e3_v®ue
 *
	gpLªgid
 = 0;

132753 
sql™e3_v®ue
 *
	gpDocidGe
 = 0;

132754 
sql™e3_v®ue
 *
	gpDocidLe
 = 0;

132755 
	giIdx
;

132757 
UNUSED_PARAMETER
(
idxSŒ
);

132758 
UNUSED_PARAMETER
(
nV®
);

132760 
	geS—rch
 = (
idxNum
 & 0x0000FFFF);

132761 
as£¹
Ð
eS—rch
>=0 &&ƒS—rch<=(
FTS3_FULLTEXT_SEARCH
+
p
->
nCÞumn
) );

132762 
as£¹
Ð
p
->
pSegm’ts
==0 );

132765 
	giIdx
 = 0;

132766 ifÐ
	geS—rch
!=
FTS3_FULLSCAN_SEARCH
 ) 
pCÚs
 = 
­V®
[
iIdx
++];

132767 ifÐ
	gidxNum
 & 
	gFTS3_HAVE_LANGID
 ) 
	gpLªgid
 = 
­V®
[
iIdx
++];

132768 ifÐ
	gidxNum
 & 
	gFTS3_HAVE_DOCID_GE
 ) 
	gpDocidGe
 = 
­V®
[
iIdx
++];

132769 ifÐ
	gidxNum
 & 
	gFTS3_HAVE_DOCID_LE
 ) 
	gpDocidLe
 = 
­V®
[
iIdx
++];

132770 
as£¹
Ð
iIdx
==
nV®
 );

132773 
sql™e3_fš®ize
(
pC¤
->
pStmt
);

132774 
sql™e3_ä“
(
pC¤
->
aDoþi¡
);

132775 
sql™e3_ä“
(
pC¤
->
aM©chšfo
);

132776 
sql™e3Fts3Ex´F»e
(
pC¤
->
pEx´
);

132777 
mem£t
(&
pCursÜ
[1], 0, (
Fts3CursÜ
)-(
sql™e3_vb_cursÜ
));

132780 
	gpC¤
->
	giMšDocid
 = 
ás3DocidRªge
(
pDocidGe
, 
SMALLEST_INT64
);

132781 
	gpC¤
->
	giMaxDocid
 = 
ás3DocidRªge
(
pDocidLe
, 
LARGEST_INT64
);

132783 ifÐ
	gidxSŒ
 ){

132784 
	gpC¤
->
	gbDesc
 = (
idxSŒ
[0]=='D');

132786 
	gpC¤
->
	gbDesc
 = 
p
->
bDescIdx
;

132788 
	gpC¤
->
	geS—rch
 = (
i16
)
eS—rch
;

132790 ifÐ
	geS—rch
!=
FTS3_DOCID_SEARCH
 && 
eS—rch
!=
FTS3_FULLSCAN_SEARCH
 ){

132791 
iCÞ
 = 
eS—rch
-
FTS3_FULLTEXT_SEARCH
;

132792 cÚ¡ *
	gzQu”y
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
pCÚs
);

132794 ifÐ
	gzQu”y
==0 && 
sql™e3_v®ue_ty³
(
pCÚs
)!=
SQLITE_NULL
 ){

132795  
SQLITE_NOMEM
;

132798 
	gpC¤
->
	giLªgid
 = 0;

132799 ifÐ
	gpLªgid
 ) 
	gpC¤
->
	giLªgid
 = 
sql™e3_v®ue_št
(
pLªgid
);

132801 
as£¹
Ð
p
->
ba£
.
zE¼Msg
==0 );

132802 
	grc
 = 
sql™e3Fts3Ex´P¬£
(
p
->
pTok’iz”
, 
pC¤
->
iLªgid
,

132803 
p
->
azCÞumn
,…->
bFts4
,…->
nCÞumn
, 
iCÞ
, 
zQu”y
, -1, &
pC¤
->
pEx´
,

132804 &
p
->
ba£
.
zE¼Msg


132806 ifÐ
	grc
!=
SQLITE_OK
 ){

132807  
rc
;

132810 
	grc
 = 
ás3Ev®S¹
(
pC¤
);

132811 
sql™e3Fts3Segm’tsClo£
(
p
);

132812 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

132813 
	gpC¤
->
	gpNextId
 = 
pC¤
->
aDoþi¡
;

132814 
	gpC¤
->
	giP»vId
 = 0;

132822 ifÐ
	geS—rch
==
FTS3_FULLSCAN_SEARCH
 ){

132823 
zSql
 = 
sql™e3_m´štf
(

132825 
p
->
zR—dEx´li¡
, (
pC¤
->
bDesc
 ? "DESC" : "ASC")

132827 ifÐ
	gzSql
 ){

132828 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pC¤
->
pStmt
, 0);

132829 
sql™e3_ä“
(
zSql
);

132831 
	grc
 = 
SQLITE_NOMEM
;

132833 }ifÐ
	geS—rch
==
FTS3_DOCID_SEARCH
 ){

132834 
rc
 = 
ás3CursÜS“kStmt
(
pC¤
, &pC¤->
pStmt
);

132835 ifÐ
	grc
==
SQLITE_OK
 ){

132836 
rc
 = 
sql™e3_bšd_v®ue
(
pC¤
->
pStmt
, 1, 
pCÚs
);

132839 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

132841  
ás3NextM‘hod
(
pCursÜ
);

132848 
ás3EofM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

132849  ((
	gFts3CursÜ
 *)
	gpCursÜ
)->
	gisEof
;

132858 
ás3RowidM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
, 
sql™e_št64
 *
pRowid
){

132859 
Fts3CursÜ
 *
	gpC¤
 = (Fts3CursÜ *è
pCursÜ
;

132860 *
	gpRowid
 = 
pC¤
->
iP»vId
;

132861  
	gSQLITE_OK
;

132875 
ás3CÞumnM‘hod
(

132876 
sql™e3_vb_cursÜ
 *
pCursÜ
,

132877 
sql™e3_cÚ‹xt
 *
pCtx
,

132878 
iCÞ


132880 
	grc
 = 
SQLITE_OK
;

132881 
Fts3CursÜ
 *
	gpC¤
 = (Fts3CursÜ *è
pCursÜ
;

132882 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pCursÜ
->
pVb
;

132885 
as£¹
Ð
iCÞ
>=0 && iCÞ<=
p
->
nCÞumn
+2 );

132887 ifÐ
	giCÞ
==
p
->
nCÞumn
+1 ){

132891 
sql™e3_»suÉ_št64
(
pCtx
, 
pC¤
->
iP»vId
);

132892 }ifÐ
	giCÞ
==
p
->
nCÞumn
 ){

132895 
sql™e3_»suÉ_blob
(
pCtx
, &
pC¤
, ÕC¤), 
SQLITE_TRANSIENT
);

132896 }ifÐ
	giCÞ
==
p
->
nCÞumn
+2 && 
pC¤
->
pEx´
 ){

132897 
sql™e3_»suÉ_št64
(
pCtx
, 
pC¤
->
iLªgid
);

132901 
	grc
 = 
ás3CursÜS“k
(0, 
pC¤
);

132903 ifÐ
	grc
==
SQLITE_OK
 ){

132904 ifÐ
iCÞ
==
p
->
nCÞumn
+2 ){

132905 
iLªgid
 = 0;

132906 ifÐ
	gp
->
	gzLªguageid
 ){

132907 
	giLªgid
 = 
sql™e3_cÞumn_št
(
pC¤
->
pStmt
, 
p
->
nCÞumn
+1);

132909 
sql™e3_»suÉ_št
(
pCtx
, 
iLªgid
);

132910 }ifÐ
sql™e3_d©a_couÁ
(
pC¤
->
pStmt
)>(
	giCÞ
+1) ){

132911 
sql™e3_»suÉ_v®ue
(
pCtx
, 
sql™e3_cÞumn_v®ue
(
pC¤
->
pStmt
, 
iCÞ
+1));

132916 
as£¹
Ð((
Fts3TabË
 *)
pC¤
->
ba£
.
pVb
)->
pSegm’ts
==0 );

132917  
	grc
;

132925 
ás3Upd©eM‘hod
(

132926 
sql™e3_vb
 *
pVb
,

132927 
nArg
,

132928 
sql™e3_v®ue
 **
­V®
,

132929 
sql™e_št64
 *
pRowid


132931  
sql™e3Fts3Upd©eM‘hod
(
pVb
, 
nArg
, 
­V®
, 
pRowid
);

132938 
ás3SyncM‘hod
(
sql™e3_vb
 *
pVb
){

132959 cÚ¡ 
u32
 
	gnMšM”ge
 = 64;

132961 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pVb
;

132962 
	grc
 = 
sql™e3Fts3P’dšgT”msFlush
(
p
);

132964 ifÐ
	grc
==
SQLITE_OK


132965 && 
p
->
nL—fAdd
>(
nMšM”ge
/16)

132966 && 
p
->
nAutošüm”ge
 &&…->nAutoincrmerge!=0xff

132968 
mxLev–
 = 0;

132969 
	gA
;

132971 
	grc
 = 
sql™e3Fts3MaxLev–
(
p
, &
mxLev–
);

132972 
as£¹
Ð
rc
==
SQLITE_OK
 || 
mxLev–
==0 );

132973 
	gA
 = 
p
->
nL—fAdd
 * 
mxLev–
;

132974 
	gA
 +ð(
A
/2);

132975 ifÐ
	gA
>()
	gnMšM”ge
 ) 
	grc
 = 
sql™e3Fts3Inüm”ge
(
p
, 
A
,…->
nAutošüm”ge
);

132977 
sql™e3Fts3Segm’tsClo£
(
p
);

132978  
	grc
;

132987 
ás3S‘HasSt
(
Fts3TabË
 *
p
){

132988 
	grc
 = 
SQLITE_OK
;

132989 ifÐ
	gp
->
	gbHasSt
==2 ){

132990 cÚ¡ *
zFmt
 ="SELECT 1 FROM %Q.sqlite_master WHEREbl_name='%q_stat'";

132991 *
	gzSql
 = 
sql™e3_m´štf
(
zFmt
, 
p
->
zDb
,…->
zName
);

132992 ifÐ
	gzSql
 ){

132993 
sql™e3_¡mt
 *
	gpStmt
 = 0;

132994 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pStmt
, 0);

132995 ifÐ
	grc
==
SQLITE_OK
 ){

132996 
bHasSt
 = (
sql™e3_¡•
(
pStmt
)==
SQLITE_ROW
);

132997 
	grc
 = 
sql™e3_fš®ize
(
pStmt
);

132998 ifÐ
	grc
==
SQLITE_OK
 ) 
p
->
bHasSt
 = bHasStat;

133000 
sql™e3_ä“
(
zSql
);

133002 
	grc
 = 
SQLITE_NOMEM
;

133005  
	grc
;

133011 
ás3BegšM‘hod
(
sql™e3_vb
 *
pVb
){

133012 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pVb
;

133013 
UNUSED_PARAMETER
(
pVb
);

133014 
as£¹
Ð
p
->
pSegm’ts
==0 );

133015 
as£¹
Ð
p
->
nP’dšgD©a
==0 );

133016 
as£¹
Ð
p
->
šT¿n§ùiÚ
!=1 );

133017 
TESTONLY
Ð
p
->
šT¿n§ùiÚ
 = 1 );

133018 
TESTONLY
Ð
p
->
mxSav•ošt
 = -1; );

133019 
	gp
->
	gnL—fAdd
 = 0;

133020  
ás3S‘HasSt
(
p
);

133028 
ás3Comm™M‘hod
(
sql™e3_vb
 *
pVb
){

133029 
TESTONLY
Ð
Fts3TabË
 *
p
 = (Fts3TabË*)
pVb
 );

133030 
UNUSED_PARAMETER
(
pVb
);

133031 
as£¹
Ð
p
->
nP’dšgD©a
==0 );

133032 
as£¹
Ð
p
->
šT¿n§ùiÚ
!=0 );

133033 
as£¹
Ð
p
->
pSegm’ts
==0 );

133034 
TESTONLY
Ð
p
->
šT¿n§ùiÚ
 = 0 );

133035 
TESTONLY
Ð
p
->
mxSav•ošt
 = -1; );

133036  
	gSQLITE_OK
;

133043 
ás3RÞlbackM‘hod
(
sql™e3_vb
 *
pVb
){

133044 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pVb
;

133045 
sql™e3Fts3P’dšgT”msCË¬
(
p
);

133046 
as£¹
Ð
p
->
šT¿n§ùiÚ
!=0 );

133047 
TESTONLY
Ð
p
->
šT¿n§ùiÚ
 = 0 );

133048 
TESTONLY
Ð
p
->
mxSav•ošt
 = -1; );

133049  
	gSQLITE_OK
;

133058 
ás3Rev”£Po¦i¡
(*
pS¹
, **
µPo¦i¡
){

133059 *
	gp
 = &(*
µPo¦i¡
)[-2];

133060 
	gc
 = 0;

133062  
	gp
>
	gpS¹
 && (
	gc
=*
p
--)==0 );

133063  
	gp
>
	gpS¹
 && (*°& 0x80è| 
	gc
 ){

133064 
	gc
 = *
p
--;

133066 ifÐ
	gp
>
	gpS¹
 ){… = &
p
[2]; }

133067  *
	gp
++&0x80 );

133068 *
	gµPo¦i¡
 = 
p
;

133081 
ás3FunùiÚArg
(

133082 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

133083 cÚ¡ *
zFunc
,

133084 
sql™e3_v®ue
 *
pV®
,

133085 
Fts3CursÜ
 **
µC¤


133087 
Fts3CursÜ
 *
	gpR‘
;

133088 ifÐ
sql™e3_v®ue_ty³
(
pV®
)!=
SQLITE_BLOB


133089 || 
sql™e3_v®ue_by‹s
(
pV®
)!=(
Fts3CursÜ
 *)

133091 *
zE¼
 = 
sql™e3_m´štf
("žËg® fœ¡‡rgum’ˆtØ%s", 
zFunc
);

133092 
sql™e3_»suÉ_”rÜ
(
pCÚ‹xt
, 
zE¼
, -1);

133093 
sql™e3_ä“
(
zE¼
);

133094  
	gSQLITE_ERROR
;

133096 
memýy
(&
pR‘
, 
sql™e3_v®ue_blob
(
pV®
), (
Fts3CursÜ
 *));

133097 *
	gµC¤
 = 
pR‘
;

133098  
	gSQLITE_OK
;

133104 
ás3Sn³tFunc
(

133105 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

133106 
nV®
,

133107 
sql™e3_v®ue
 **
­V®


133109 
Fts3CursÜ
 *
	gpC¤
;

133110 cÚ¡ *
	gzS¹
 = "<b>";

133111 cÚ¡ *
	gzEnd
 = "</b>";

133112 cÚ¡ *
	gzEÎsis
 = "<b>...</b>";

133113 
	giCÞ
 = -1;

133114 
	gnTok’
 = 15;

133119 
as£¹
Ð
nV®
>=1 );

133121 ifÐ
	gnV®
>6 ){

133122 
sql™e3_»suÉ_”rÜ
(
pCÚ‹xt
,

133126 ifÐ
ás3FunùiÚArg
(
pCÚ‹xt
, "¢³t", 
­V®
[0], &
pC¤
) ) ;

133128  
	gnV®
 ){

133129 6: 
nTok’
 = 
sql™e3_v®ue_št
(
­V®
[5]);

133130 5: 
iCÞ
 = 
sql™e3_v®ue_št
(
­V®
[4]);

133131 4: 
zEÎsis
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[3]);

133132 3: 
zEnd
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[2]);

133133 2: 
zS¹
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[1]);

133135 ifÐ!
	gzEÎsis
 || !
	gzEnd
 || !
	gzS¹
 ){

133136 
sql™e3_»suÉ_”rÜ_nomem
(
pCÚ‹xt
);

133137 }ifÐ
	gSQLITE_OK
==
ás3CursÜS“k
(
pCÚ‹xt
, 
pC¤
) ){

133138 
sql™e3Fts3Sn³t
(
pCÚ‹xt
, 
pC¤
, 
zS¹
, 
zEnd
, 
zEÎsis
, 
iCÞ
, 
nTok’
);

133145 
ás3Off£tsFunc
(

133146 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

133147 
nV®
,

133148 
sql™e3_v®ue
 **
­V®


133150 
Fts3CursÜ
 *
	gpC¤
;

133152 
UNUSED_PARAMETER
(
nV®
);

133154 
as£¹
Ð
nV®
==1 );

133155 ifÐ
ás3FunùiÚArg
(
pCÚ‹xt
, "off£ts", 
­V®
[0], &
pC¤
) ) ;

133156 
as£¹
Ð
pC¤
 );

133157 ifÐ
	gSQLITE_OK
==
ás3CursÜS“k
(
pCÚ‹xt
, 
pC¤
) ){

133158 
sql™e3Fts3Off£ts
(
pCÚ‹xt
, 
pC¤
);

133171 
ás3O±imizeFunc
(

133172 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

133173 
nV®
,

133174 
sql™e3_v®ue
 **
­V®


133176 
	grc
;

133177 
Fts3TabË
 *
	gp
;

133178 
Fts3CursÜ
 *
	gpCursÜ
;

133180 
UNUSED_PARAMETER
(
nV®
);

133182 
as£¹
Ð
nV®
==1 );

133183 ifÐ
ás3FunùiÚArg
(
pCÚ‹xt
, "Ýtimize", 
­V®
[0], &
pCursÜ
) ) ;

133184 
	gp
 = (
Fts3TabË
 *)
pCursÜ
->
ba£
.
pVb
;

133185 
as£¹
Ð
p
 );

133187 
	grc
 = 
sql™e3Fts3O±imize
(
p
);

133189  
	grc
 ){

133190 
	gSQLITE_OK
:

133191 
sql™e3_»suÉ_‹xt
(
pCÚ‹xt
, "Index o±imized", -1, 
SQLITE_STATIC
);

133193 
	gSQLITE_DONE
:

133194 
sql™e3_»suÉ_‹xt
(
pCÚ‹xt
, "Index‡Ì—dy o±im®", -1, 
SQLITE_STATIC
);

133197 
sql™e3_»suÉ_”rÜ_code
(
pCÚ‹xt
, 
rc
);

133205 
ás3M©chšfoFunc
(

133206 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

133207 
nV®
,

133208 
sql™e3_v®ue
 **
­V®


133210 
Fts3CursÜ
 *
	gpC¤
;

133211 
as£¹
Ð
nV®
==1 ||‚Val==2 );

133212 ifÐ
	gSQLITE_OK
==
ás3FunùiÚArg
(
pCÚ‹xt
, "m©chšfo", 
­V®
[0], &
pC¤
) ){

133213 cÚ¡ *
	gzArg
 = 0;

133214 ifÐ
	gnV®
>1 ){

133215 
	gzArg
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[1]);

133217 
sql™e3Fts3M©chšfo
(
pCÚ‹xt
, 
pC¤
, 
zArg
);

133225 
ás3FšdFunùiÚM‘hod
(

133226 
sql™e3_vb
 *
pVb
,

133227 
nArg
,

133228 cÚ¡ *
zName
,

133229 (**
pxFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

133230 **
µArg


133232 
	sOv”lßded
 {

133233 cÚ¡ *
	gzName
;

133234 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**);

133235 } 
	gaOv”lßd
[] = {

133236 { "¢³t", 
ás3Sn³tFunc
 },

133237 { "off£ts", 
ás3Off£tsFunc
 },

133238 { "Ýtimize", 
ás3O±imizeFunc
 },

133239 { "m©chšfo", 
ás3M©chšfoFunc
 },

133241 
	gi
;

133243 
UNUSED_PARAMETER
(
pVb
);

133244 
UNUSED_PARAMETER
(
nArg
);

133245 
UNUSED_PARAMETER
(
µArg
);

133247 
	gi
=0; i<
SizeofA¼ay
(
aOv”lßd
); i++){

133248 ifÐ
¡rcmp
(
zName
, 
aOv”lßd
[
i
].zName)==0 ){

133249 *
pxFunc
 = 
aOv”lßd
[
i
].
xFunc
;

133261 
ás3R’ameM‘hod
(

133262 
sql™e3_vb
 *
pVb
,

133263 cÚ¡ *
zName


133265 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pVb
;

133266 
sql™e3
 *
	gdb
 = 
p
->
db
;

133267 
	grc
;

133271 
	grc
 = 
ás3S‘HasSt
(
p
);

133279 
as£¹
Ð
p
->
nP’dšgD©a
==0 );

133280 ifÐ
	grc
==
SQLITE_OK
 ){

133281 
rc
 = 
sql™e3Fts3P’dšgT”msFlush
(
p
);

133284 ifÐ
	gp
->
	gzCÚ‹ÁTbl
==0 ){

133285 
ás3DbExec
(&
rc
, 
db
,

133287 
p
->
zDb
,…->
zName
, zName

133291 ifÐ
	gp
->
	gbHasDocsize
 ){

133292 
ás3DbExec
(&
rc
, 
db
,

133294 
p
->
zDb
,…->
zName
, zName

133297 ifÐ
	gp
->
	gbHasSt
 ){

133298 
ás3DbExec
(&
rc
, 
db
,

133300 
p
->
zDb
,…->
zName
, zName

133303 
ás3DbExec
(&
rc
, 
db
,

133305 
p
->
zDb
,…->
zName
, zName

133307 
ás3DbExec
(&
rc
, 
db
,

133309 
p
->
zDb
,…->
zName
, zName

133311  
	grc
;

133319 
ás3Sav•oštM‘hod
(
sql™e3_vb
 *
pVb
, 
iSav•ošt
){

133320 
	grc
 = 
SQLITE_OK
;

133321 
UNUSED_PARAMETER
(
iSav•ošt
);

133322 
as£¹
Ð((
Fts3TabË
 *)
pVb
)->
šT¿n§ùiÚ
 );

133323 
as£¹
Ð((
Fts3TabË
 *)
pVb
)->
mxSav•ošt
 < 
iSav•ošt
 );

133324 
TESTONLY
Ð((
Fts3TabË
 *)
pVb
)->
mxSav•ošt
 = 
iSav•ošt
 );

133325 ifÐ((
	gFts3TabË
 *)
	gpVb
)->
	gbIgnÜeSav•ošt
==0 ){

133326 
rc
 = 
ás3SyncM‘hod
(
pVb
);

133328  
	grc
;

133336 
ás3R–—£M‘hod
(
sql™e3_vb
 *
pVb
, 
iSav•ošt
){

133337 
TESTONLY
Ð
Fts3TabË
 *
p
 = (Fts3TabË*)
pVb
 );

133338 
UNUSED_PARAMETER
(
iSav•ošt
);

133339 
UNUSED_PARAMETER
(
pVb
);

133340 
as£¹
Ð
p
->
šT¿n§ùiÚ
 );

133341 
as£¹
Ð
p
->
mxSav•ošt
 >ð
iSav•ošt
 );

133342 
TESTONLY
Ð
p
->
mxSav•ošt
 = 
iSav•ošt
-1 );

133343  
	gSQLITE_OK
;

133351 
ás3RÞlbackToM‘hod
(
sql™e3_vb
 *
pVb
, 
iSav•ošt
){

133352 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pVb
;

133353 
UNUSED_PARAMETER
(
iSav•ošt
);

133354 
as£¹
Ð
p
->
šT¿n§ùiÚ
 );

133355 
as£¹
Ð
p
->
mxSav•ošt
 >ð
iSav•ošt
 );

133356 
TESTONLY
Ð
p
->
mxSav•ošt
 = 
iSav•ošt
 );

133357 
sql™e3Fts3P’dšgT”msCË¬
(
p
);

133358  
	gSQLITE_OK
;

133361 cÚ¡ 
sql™e3_moduË
 
	gás3ModuË
 = {

133363  
ás3C»©eM‘hod
,

133364  
ás3CÚÃùM‘hod
,

133365  
ás3Be¡IndexM‘hod
,

133366  
ás3DiscÚÃùM‘hod
,

133367  
ás3De¡royM‘hod
,

133368  
ás3O³nM‘hod
,

133369  
ás3Clo£M‘hod
,

133370  
ás3Fž‹rM‘hod
,

133371  
ás3NextM‘hod
,

133372  
ás3EofM‘hod
,

133373  
ás3CÞumnM‘hod
,

133374  
ás3RowidM‘hod
,

133375  
ás3Upd©eM‘hod
,

133376  
ás3BegšM‘hod
,

133377  
ás3SyncM‘hod
,

133378  
ás3Comm™M‘hod
,

133379  
ás3RÞlbackM‘hod
,

133380  
ás3FšdFunùiÚM‘hod
,

133381  
ás3R’ameM‘hod
,

133382  
ás3Sav•oštM‘hod
,

133383  
ás3R–—£M‘hod
,

133384  
ás3RÞlbackToM‘hod
,

133392 
hashDe¡roy
(*
p
){

133393 
Fts3Hash
 *
	gpHash
 = (Fts3Hash *)
p
;

133394 
sql™e3Fts3HashCË¬
(
pHash
);

133395 
sql™e3_ä“
(
pHash
);

133408 
SQLITE_PRIVATE
 
sql™e3Fts3Sim¶eTok’iz”ModuË
(
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË
);

133409 
SQLITE_PRIVATE
 
sql™e3Fts3PÜ‹rTok’iz”ModuË
(
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË
);

133410 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


133411 
SQLITE_PRIVATE
 
sql™e3Fts3UnicodeTok’iz”
(
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË
);

133413 #ifdeà
SQLITE_ENABLE_ICU


133414 
SQLITE_PRIVATE
 
sql™e3Fts3IcuTok’iz”ModuË
(
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË
);

133423 
SQLITE_PRIVATE
 
sql™e3Fts3In™
(
sql™e3
 *
db
){

133424 
	grc
 = 
SQLITE_OK
;

133425 
Fts3Hash
 *
	gpHash
 = 0;

133426 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpSim¶e
 = 0;

133427 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpPÜ‹r
 = 0;

133428 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


133429 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpUnicode
 = 0;

133432 #ifdeà
SQLITE_ENABLE_ICU


133433 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpIcu
 = 0;

133434 
sql™e3Fts3IcuTok’iz”ModuË
(&
pIcu
);

133437 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


133438 
sql™e3Fts3UnicodeTok’iz”
(&
pUnicode
);

133441 #ifdeà
SQLITE_TEST


133442 
	grc
 = 
sql™e3Fts3In™T”m
(
db
);

133443 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

133446 
	grc
 = 
sql™e3Fts3In™Aux
(
db
);

133447 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

133449 
sql™e3Fts3Sim¶eTok’iz”ModuË
(&
pSim¶e
);

133450 
sql™e3Fts3PÜ‹rTok’iz”ModuË
(&
pPÜ‹r
);

133453 
	gpHash
 = 
sql™e3_m®loc
((
Fts3Hash
));

133454 ifÐ!
	gpHash
 ){

133455 
	grc
 = 
SQLITE_NOMEM
;

133457 
sql™e3Fts3HashIn™
(
pHash
, 
FTS3_HASH_STRING
, 1);

133461 ifÐ
	grc
==
SQLITE_OK
 ){

133462 ifÐ
sql™e3Fts3HashIn£¹
(
pHash
, "sim¶e", 7, (*)
pSim¶e
)

133463 || 
sql™e3Fts3HashIn£¹
(
pHash
, "pÜ‹r", 7, (*)
pPÜ‹r
)

133465 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


133466 || 
sql™e3Fts3HashIn£¹
(
pHash
, "unicode61", 10, (*)
pUnicode
)

133468 #ifdeà
SQLITE_ENABLE_ICU


133469 || (
pIcu
 && 
sql™e3Fts3HashIn£¹
(
pHash
, "icu", 4, (*)pIcu))

133472 
rc
 = 
SQLITE_NOMEM
;

133476 #ifdeà
SQLITE_TEST


133477 ifÐ
	grc
==
SQLITE_OK
 ){

133478 
rc
 = 
sql™e3Fts3Ex´In™Te¡IÁ”çû
(
db
);

133486 ifÐ
	gSQLITE_OK
==
rc


133487 && 
SQLITE_OK
==(
rc
 = 
sql™e3Fts3In™HashTabË
(
db
, 
pHash
, "fts3_tokenizer"))

133488 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "snippet", -1))

133489 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "offsets", 1))

133490 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "matchinfo", 1))

133491 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "matchinfo", 2))

133492 && 
	gSQLITE_OK
==(
rc
 = 
sql™e3_ov”lßd_funùiÚ
(
db
, "optimize", 1))

133494 
	grc
 = 
sql™e3_ü—‹_moduË_v2
(

133495 
db
, "ás3", &
ás3ModuË
, (*)
pHash
, 
hashDe¡roy


133497 ifÐ
	grc
==
SQLITE_OK
 ){

133498 
rc
 = 
sql™e3_ü—‹_moduË_v2
(

133499 
db
, "ás4", &
ás3ModuË
, (*)
pHash
, 0

133502 ifÐ
	grc
==
SQLITE_OK
 ){

133503 
rc
 = 
sql™e3Fts3In™Tok
(
db
, (*)
pHash
);

133505  
	grc
;

133510 
as£¹
Ð
rc
!=
SQLITE_OK
 );

133511 ifÐ
	gpHash
 ){

133512 
sql™e3Fts3HashCË¬
(
pHash
);

133513 
sql™e3_ä“
(
pHash
);

133515  
	grc
;

133533 
ás3Ev®AÎoÿ‹R—d”s
(

133534 
Fts3CursÜ
 *
pC¤
,

133535 
Fts3Ex´
 *
pEx´
,

133536 *
²Tok’
,

133537 *
²Or
,

133538 *
pRc


133540 ifÐ
	gpEx´
 && 
	gSQLITE_OK
==*
pRc
 ){

133541 ifÐ
pEx´
->
eTy³
==
FTSQUERY_PHRASE
 ){

133542 
i
;

133543 
	gnTok’
 = 
pEx´
->
pPh¿£
->
nTok’
;

133544 *
	g²Tok’
 +ð
nTok’
;

133545 
	gi
=0; i<
	gnTok’
; i++){

133546 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
pEx´
->
pPh¿£
->
aTok’
[
i
];

133547 
	grc
 = 
ás3T”mSegR—d”CursÜ
(
pC¤
,

133548 
pTok’
->
z
,…Tok’->
n
,…Tok’->
isP»fix
, &pTok’->
pSegc¤


133550 ifÐ
	grc
!=
SQLITE_OK
 ){

133551 *
pRc
 = 
rc
;

133555 
as£¹
Ð
pEx´
->
pPh¿£
->
iDoþi¡Tok’
==0 );

133556 
	gpEx´
->
	gpPh¿£
->
	giDoþi¡Tok’
 = -1;

133558 *
	g²Or
 +ð(
pEx´
->
eTy³
==
FTSQUERY_OR
);

133559 
ás3Ev®AÎoÿ‹R—d”s
(
pC¤
, 
pEx´
->
pLeá
, 
²Tok’
, 
²Or
, 
pRc
);

133560 
ás3Ev®AÎoÿ‹R—d”s
(
pC¤
, 
pEx´
->
pRight
, 
²Tok’
, 
²Or
, 
pRc
);

133573 
ás3Ev®Ph¿£M”geTok’
(

133574 
Fts3TabË
 *
pTab
,

133575 
Fts3Ph¿£
 *
p
,

133576 
iTok’
,

133577 *
pLi¡
,

133578 
nLi¡


133580 
as£¹
Ð
iTok’
!=
p
->
iDoþi¡Tok’
 );

133582 ifÐ
	gpLi¡
==0 ){

133583 
sql™e3_ä“
(
p
->
doþi¡
.
aAÎ
);

133584 
	gp
->
	gdoþi¡
.
	gaAÎ
 = 0;

133585 
	gp
->
	gdoþi¡
.
	gnAÎ
 = 0;

133588 ifÐ
	gp
->
	giDoþi¡Tok’
<0 ){

133589 
	gp
->
	gdoþi¡
.
	gaAÎ
 = 
pLi¡
;

133590 
	gp
->
	gdoþi¡
.
	gnAÎ
 = 
nLi¡
;

133593 ifÐ
	gp
->
	gdoþi¡
.
	gaAÎ
==0 ){

133594 
sql™e3_ä“
(
pLi¡
);

133598 *
	gpLeá
;

133599 *
	gpRight
;

133600 
	gnLeá
;

133601 
	gnRight
;

133602 
	gnDiff
;

133604 ifÐ
	gp
->
	giDoþi¡Tok’
<
	giTok’
 ){

133605 
	gpLeá
 = 
p
->
doþi¡
.
aAÎ
;

133606 
	gnLeá
 = 
p
->
doþi¡
.
nAÎ
;

133607 
	gpRight
 = 
pLi¡
;

133608 
	gnRight
 = 
nLi¡
;

133609 
	gnDiff
 = 
iTok’
 - 
p
->
iDoþi¡Tok’
;

133611 
	gpRight
 = 
p
->
doþi¡
.
aAÎ
;

133612 
	gnRight
 = 
p
->
doþi¡
.
nAÎ
;

133613 
	gpLeá
 = 
pLi¡
;

133614 
	gnLeá
 = 
nLi¡
;

133615 
	gnDiff
 = 
p
->
iDoþi¡Tok’
 - 
iTok’
;

133618 
ás3Doþi¡Ph¿£M”ge
(
pTab
->
bDescIdx
, 
nDiff
, 
pLeá
, 
nLeá
, 
pRight
,&
nRight
);

133619 
sql™e3_ä“
(
pLeá
);

133620 
	gp
->
	gdoþi¡
.
	gaAÎ
 = 
pRight
;

133621 
	gp
->
	gdoþi¡
.
	gnAÎ
 = 
nRight
;

133624 ifÐ
	giTok’
>
	gp
->
	giDoþi¡Tok’
 )…->iDoþi¡Tok’ = 
iTok’
;

133633 
ás3Ev®Ph¿£Lßd
(

133634 
Fts3CursÜ
 *
pC¤
,

133635 
Fts3Ph¿£
 *
p


133637 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

133638 
	giTok’
;

133639 
	grc
 = 
SQLITE_OK
;

133641 
	giTok’
=0; 
	grc
==
SQLITE_OK
 && 
iTok’
<
p
->
nTok’
; iToken++){

133642 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
p
->
aTok’
[
iTok’
];

133643 
as£¹
Ð
pTok’
->
pDeã¼ed
==0 ||…Tok’->
pSegc¤
==0 );

133645 ifÐ
	gpTok’
->
	gpSegc¤
 ){

133646 
	gnThis
 = 0;

133647 *
	gpThis
 = 0;

133648 
	grc
 = 
ás3T”mS–eù
(
pTab
, 
pTok’
, 
p
->
iCÞumn
, &
nThis
, &
pThis
);

133649 ifÐ
	grc
==
SQLITE_OK
 ){

133650 
ás3Ev®Ph¿£M”geTok’
(
pTab
, 
p
, 
iTok’
, 
pThis
, 
nThis
);

133653 
as£¹
Ð
pTok’
->
pSegc¤
==0 );

133656  
	grc
;

133669 
ás3Ev®Deã¼edPh¿£
(
Fts3CursÜ
 *
pC¤
, 
Fts3Ph¿£
 *
pPh¿£
){

133670 
	giTok’
;

133671 *
	gaPo¦i¡
 = 0;

133672 
	gnPo¦i¡
 = 0;

133673 
	giP»v
 = -1;

133675 
as£¹
Ð
pPh¿£
->
doþi¡
.
bF»eLi¡
==0 );

133677 
	giTok’
=0; iTok’<
	gpPh¿£
->
	gnTok’
; iToken++){

133678 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
pPh¿£
->
aTok’
[
iTok’
];

133679 
Fts3Deã¼edTok’
 *
	gpDeã¼ed
 = 
pTok’
->
pDeã¼ed
;

133681 ifÐ
	gpDeã¼ed
 ){

133682 *
	gpLi¡
;

133683 
	gnLi¡
;

133684 
	grc
 = 
sql™e3Fts3Deã¼edTok’Li¡
(
pDeã¼ed
, &
pLi¡
, &
nLi¡
);

133685 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

133687 ifÐ
	gpLi¡
==0 ){

133688 
sql™e3_ä“
(
aPo¦i¡
);

133689 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 0;

133690 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 0;

133691  
	gSQLITE_OK
;

133693 }ifÐ
	gaPo¦i¡
==0 ){

133694 
aPo¦i¡
 = 
pLi¡
;

133695 
	gnPo¦i¡
 = 
nLi¡
;

133698 *
	gaOut
 = 
pLi¡
;

133699 *
	gp1
 = 
aPo¦i¡
;

133700 *
	gp2
 = 
aOut
;

133702 
as£¹
Ð
iP»v
>=0 );

133703 
ás3Po¦i¡Ph¿£M”ge
(&
aOut
, 
iTok’
-
iP»v
, 0, 1, &
p1
, &
p2
);

133704 
sql™e3_ä“
(
aPo¦i¡
);

133705 
	gaPo¦i¡
 = 
pLi¡
;

133706 
	gnPo¦i¡
 = ()(
aOut
 - 
aPo¦i¡
);

133707 ifÐ
	gnPo¦i¡
==0 ){

133708 
sql™e3_ä“
(
aPo¦i¡
);

133709 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 0;

133710 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 0;

133711  
	gSQLITE_OK
;

133714 
	giP»v
 = 
iTok’
;

133718 ifÐ
	giP»v
>=0 ){

133719 
nMaxUndeã¼ed
 = 
pPh¿£
->
iDoþi¡Tok’
;

133720 ifÐ
	gnMaxUndeã¼ed
<0 ){

133721 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 
aPo¦i¡
;

133722 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 
nPo¦i¡
;

133723 
	gpPh¿£
->
	gdoþi¡
.
	giDocid
 = 
pC¤
->
iP»vId
;

133724 
	gpPh¿£
->
	gdoþi¡
.
	gbF»eLi¡
 = 1;

133726 
	gnDi¡ªû
;

133727 *
	gp1
;

133728 *
	gp2
;

133729 *
	gaOut
;

133731 ifÐ
	gnMaxUndeã¼ed
>
	giP»v
 ){

133732 
	gp1
 = 
aPo¦i¡
;

133733 
	gp2
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

133734 
	gnDi¡ªû
 = 
nMaxUndeã¼ed
 - 
iP»v
;

133736 
	gp1
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

133737 
	gp2
 = 
aPo¦i¡
;

133738 
	gnDi¡ªû
 = 
iP»v
 - 
nMaxUndeã¼ed
;

133741 
	gaOut
 = (*)
sql™e3_m®loc
(
nPo¦i¡
+8);

133742 ifÐ!
	gaOut
 ){

133743 
sql™e3_ä“
(
aPo¦i¡
);

133744  
	gSQLITE_NOMEM
;

133747 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 
aOut
;

133748 ifÐ
ás3Po¦i¡Ph¿£M”ge
(&
aOut
, 
nDi¡ªû
, 0, 1, &
p1
, &
p2
) ){

133749 
	gpPh¿£
->
	gdoþi¡
.
	gbF»eLi¡
 = 1;

133750 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = ()(
aOut
 - 
pPh¿£
->
doþi¡
.
pLi¡
);

133752 
sql™e3_ä“
(
aOut
);

133753 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 0;

133754 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 0;

133756 
sql™e3_ä“
(
aPo¦i¡
);

133760  
	gSQLITE_OK
;

133767 
	#MAX_INCR_PHRASE_TOKENS
 4

	)

133781 
ás3Ev®Ph¿£S¹
(
Fts3CursÜ
 *
pC¤
, 
bO±Ok
, 
Fts3Ph¿£
 *
p
){

133782 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

133783 
	grc
 = 
SQLITE_OK
;

133784 
	gi
;

133791 
	gbHaveInü
 = 0;

133792 
	gbInüOk
 = (
bO±Ok


133793 && 
pC¤
->
bDesc
==
pTab
->
bDescIdx


133794 && 
p
->
nTok’
<=
MAX_INCR_PHRASE_TOKENS
 &&…->nToken>0

133795 && 
p
->
nTok’
<=
MAX_INCR_PHRASE_TOKENS
 &&…->nToken>0

133796 #ifdeà
SQLITE_TEST


133797 && 
pTab
->
bNoInüDoþi¡
==0

133800 
	gi
=0; 
	gbInüOk
==1 && 
i
<
p
->
nTok’
; i++){

133801 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
p
->
aTok’
[
i
];

133802 ifÐ
	gpTok’
->
	gbFœ¡
 || (pTok’->
	gpSegc¤
!=0 && !
pTok’
->
pSegc¤
->
bLookup
) ){

133803 
bInüOk
 = 0;

133805 ifÐ
	gpTok’
->
	gpSegc¤
 ) 
	gbHaveInü
 = 1;

133808 ifÐ
	gbInüOk
 && 
	gbHaveInü
 ){

133810 
	giCÞ
 = (
p
->
iCÞumn
 >ð
pTab
->
nCÞumn
 ? -1 :…->iColumn);

133811 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nTok’
; i++){

133812 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
p
->
aTok’
[
i
];

133813 
Fts3MuÉiSegR—d”
 *
	gpSegc¤
 = 
pTok’
->
pSegc¤
;

133814 ifÐ
	gpSegc¤
 ){

133815 
	grc
 = 
sql™e3Fts3M¤InüS¹
(
pTab
, 
pSegc¤
, 
iCÞ
, 
pTok’
->
z
,…Tok’->
n
);

133818 
	gp
->
	gbInü
 = 1;

133821 
	grc
 = 
ás3Ev®Ph¿£Lßd
(
pC¤
, 
p
);

133822 
	gp
->
	gbInü
 = 0;

133825 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
p
->
nTok’
<1 ||…->
aTok’
[0].
pSegc¤
==0 ||…->
bInü
 );

133826  
	grc
;

133839 
SQLITE_PRIVATE
 
sql™e3Fts3Doþi¡P»v
(

133840 
bDescIdx
,

133841 *
aDoþi¡
,

133842 
nDoþi¡
,

133843 **
µI‹r
,

133844 
sql™e3_št64
 *
piDocid
,

133845 *
²Li¡
,

133846 
u8
 *
pbEof


133848 *
	gp
 = *
µI‹r
;

133850 
as£¹
Ð
nDoþi¡
>0 );

133851 
as£¹
Ð*
pbEof
==0 );

133852 
as£¹
Ð
p
 || *
piDocid
==0 );

133853 
as£¹
Ð!
p
 || (p>
aDoþi¡
 &&…<&aDoþi¡[
nDoþi¡
]) );

133855 ifÐ
	gp
==0 ){

133856 
sql™e3_št64
 
iDocid
 = 0;

133857 *
	gpNext
 = 0;

133858 *
	gpDocid
 = 
aDoþi¡
;

133859 *
	gpEnd
 = &
aDoþi¡
[
nDoþi¡
];

133860 
	giMul
 = 1;

133862  
	gpDocid
<
	gpEnd
 ){

133863 
sql™e3_št64
 
	giD–
;

133864 
	gpDocid
 +ð
sql™e3Fts3G‘V¬št
(
pDocid
, &
iD–
);

133865 
	giDocid
 +ð(
iMul
 * 
iD–
);

133866 
	gpNext
 = 
pDocid
;

133867 
ás3Po¦i¡CÝy
(0, &
pDocid
);

133868  
	gpDocid
<
	gpEnd
 && *pDocid==0 ) 
pDocid
++;

133869 
	giMul
 = (
bDescIdx
 ? -1 : 1);

133872 *
	g²Li¡
 = ()(
pEnd
 - 
pNext
);

133873 *
	gµI‹r
 = 
pNext
;

133874 *
	gpiDocid
 = 
iDocid
;

133876 
	giMul
 = (
bDescIdx
 ? -1 : 1);

133877 
sql™e3_št64
 
	giD–
;

133878 
ás3G‘Rev”£V¬št
(&
p
, 
aDoþi¡
, &
iD–
);

133879 *
	gpiDocid
 -ð(
iMul
 * 
iD–
);

133881 ifÐ
	gp
==
aDoþi¡
 ){

133882 *
pbEof
 = 1;

133884 *
	gpSave
 = 
p
;

133885 
ás3Rev”£Po¦i¡
(
aDoþi¡
, &
p
);

133886 *
	g²Li¡
 = ()(
pSave
 - 
p
);

133888 *
	gµI‹r
 = 
p
;

133895 
SQLITE_PRIVATE
 
sql™e3Fts3Doþi¡Next
(

133896 
bDescIdx
,

133897 *
aDoþi¡
,

133898 
nDoþi¡
,

133899 **
µI‹r
,

133900 
sql™e3_št64
 *
piDocid
,

133901 
u8
 *
pbEof


133903 *
	gp
 = *
µI‹r
;

133905 
as£¹
Ð
nDoþi¡
>0 );

133906 
as£¹
Ð*
pbEof
==0 );

133907 
as£¹
Ð
p
 || *
piDocid
==0 );

133908 
as£¹
Ð!
p
 || (p>=
aDoþi¡
 &&…<=&aDoþi¡[
nDoþi¡
]) );

133910 ifÐ
	gp
==0 ){

133911 
p
 = 
aDoþi¡
;

133912 
	gp
 +ð
sql™e3Fts3G‘V¬št
(
p
, 
piDocid
);

133914 
ás3Po¦i¡CÝy
(0, &
p
);

133915 ifÐ
	gp
>=&
aDoþi¡
[
nDoþi¡
] ){

133916 *
pbEof
 = 1;

133918 
sql™e3_št64
 
	giV¬
;

133919 
	gp
 +ð
sql™e3Fts3G‘V¬št
(
p
, &
iV¬
);

133920 *
	gpiDocid
 +ð((
bDescIdx
 ? -1 : 1è* 
iV¬
);

133924 *
	gµI‹r
 = 
p
;

133931 
ás3Ev®DlPh¿£Next
(

133932 
Fts3TabË
 *
pTab
,

133933 
Fts3Doþi¡
 *
pDL
,

133934 
u8
 *
pbEof


133936 *
	gpI‹r
;

133937 *
	gpEnd
 = &
pDL
->
aAÎ
[pDL->
nAÎ
];

133939 ifÐ
	gpDL
->
	gpNextDocid
 ){

133940 
	gpI‹r
 = 
pDL
->
pNextDocid
;

133942 
	gpI‹r
 = 
pDL
->
aAÎ
;

133945 ifÐ
	gpI‹r
>=
pEnd
 ){

133947 *
pbEof
 = 1;

133949 
sql™e3_št64
 
	giD–
;

133950 
	gpI‹r
 +ð
sql™e3Fts3G‘V¬št
(
pI‹r
, &
iD–
);

133951 ifÐ
	gpTab
->
	gbDescIdx
==0 || 
pDL
->
pNextDocid
==0 ){

133952 
pDL
->
iDocid
 +ð
iD–
;

133954 
	gpDL
->
	giDocid
 -ð
iD–
;

133956 
	gpDL
->
	gpLi¡
 = 
pI‹r
;

133957 
ás3Po¦i¡CÝy
(0, &
pI‹r
);

133958 
	gpDL
->
	gnLi¡
 = ()(
pI‹r
 - 
pDL
->
pLi¡
);

133966  
	gpI‹r
<
	gpEnd
 && *pI‹r==0 ) 
pI‹r
++;

133968 
	gpDL
->
	gpNextDocid
 = 
pI‹r
;

133969 
as£¹
Ð
pI‹r
>=&
pDL
->
aAÎ
[pDL->
nAÎ
] || *pIter );

133970 *
	gpbEof
 = 0;

133977 
Tok’Doþi¡
 
	tTok’Doþi¡
;

133978 
	sTok’Doþi¡
 {

133979 
	gbIgnÜe
;

133980 
sql™e3_št64
 
	giDocid
;

133981 *
	gpLi¡
;

133982 
	gnLi¡
;

133994 
šüPh¿£Tok’Next
(

133995 
Fts3TabË
 *
pTab
,

133996 
Fts3Ph¿£
 *
pPh¿£
,

133997 
iTok’
,

133998 
Tok’Doþi¡
 *
p
,

133999 
u8
 *
pbEof


134001 
	grc
 = 
SQLITE_OK
;

134003 ifÐ
	gpPh¿£
->
	giDoþi¡Tok’
==
iTok’
 ){

134004 
as£¹
Ð
p
->
bIgnÜe
==0 );

134005 
as£¹
Ð
pPh¿£
->
aTok’
[
iTok’
].
pSegc¤
==0 );

134006 
ás3Ev®DlPh¿£Next
(
pTab
, &
pPh¿£
->
doþi¡
, 
pbEof
);

134007 
	gp
->
	gpLi¡
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

134008 
	gp
->
	gnLi¡
 = 
pPh¿£
->
doþi¡
.
nLi¡
;

134009 
	gp
->
	giDocid
 = 
pPh¿£
->
doþi¡
.
iDocid
;

134011 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
pPh¿£
->
aTok’
[
iTok’
];

134012 
as£¹
Ð
pTok’
->
pDeã¼ed
==0 );

134013 
as£¹
Ð
pTok’
->
pSegc¤
 || 
pPh¿£
->
iDoþi¡Tok’
>=0 );

134014 ifÐ
	gpTok’
->
	gpSegc¤
 ){

134015 
as£¹
Ð
p
->
bIgnÜe
==0 );

134016 
	grc
 = 
sql™e3Fts3M¤InüNext
(

134017 
pTab
, 
pTok’
->
pSegc¤
, &
p
->
iDocid
, &p->
pLi¡
, &p->
nLi¡


134019 ifÐ
	gp
->
	gpLi¡
==0 ) *
pbEof
 = 1;

134021 
	gp
->
	gbIgnÜe
 = 1;

134025  
	grc
;

134046 
ás3Ev®InüPh¿£Next
(

134047 
Fts3CursÜ
 *
pC¤
,

134048 
Fts3Ph¿£
 *
p
,

134049 
u8
 *
pbEof


134051 
	grc
 = 
SQLITE_OK
;

134052 
Fts3Doþi¡
 *
	gpDL
 = &
p
->
doþi¡
;

134053 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

134054 
u8
 
	gbEof
 = 0;

134058 
as£¹
Ð
p
->
bInü
==1 );

134060 ifÐ
	gp
->
	gnTok’
==1 && 
p
->
bInü
 ){

134061 
rc
 = 
sql™e3Fts3M¤InüNext
(
pTab
, 
p
->
aTok’
[0].
pSegc¤
,

134062 &
pDL
->
iDocid
, &pDL->
pLi¡
, &pDL->
nLi¡


134064 ifÐ
	gpDL
->
	gpLi¡
==0 ) 
bEof
 = 1;

134066 
	gbDescDoþi¡
 = 
pC¤
->
bDesc
;

134067 
Tok’Doþi¡
 
	ga
[
MAX_INCR_PHRASE_TOKENS
];

134069 
mem£t
(
a
, 0, (a));

134070 
as£¹
Ð
p
->
nTok’
<=
MAX_INCR_PHRASE_TOKENS
 );

134071 
as£¹
Ð
p
->
iDoþi¡Tok’
<
MAX_INCR_PHRASE_TOKENS
 );

134073  
	gbEof
==0 ){

134074 
bMaxS‘
 = 0;

134075 
sql™e3_št64
 
	giMax
 = 0;

134076 
	gi
;

134079 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nTok’
 && 
bEof
==0; i++){

134080 
	grc
 = 
šüPh¿£Tok’Next
(
pTab
, 
p
, 
i
, &
a
[i], &
bEof
);

134081 ifÐ
	ga
[
i
].
	gbIgnÜe
==0 && (
bMaxS‘
==0 || 
DOCID_CMP
(
iMax
, 
a
[i].
iDocid
)<0) ){

134082 
	giMax
 = 
a
[
i
].
iDocid
;

134083 
	gbMaxS‘
 = 1;

134086 
as£¹
Ð
rc
!=
SQLITE_OK
 || (
p
->
nTok’
>=1 && 
a
[p->nTok’-1].
bIgnÜe
==0) );

134087 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
bMaxS‘
 );

134090 
	gi
=0; i<
	gp
->
	gnTok’
; i++){

134091  
	grc
==
SQLITE_OK
 && 
bEof
==0

134092 && 
a
[
i
].
bIgnÜe
==0 && 
DOCID_CMP
×[i].
iDocid
, 
iMax
)<0

134094 
	grc
 = 
šüPh¿£Tok’Next
(
pTab
, 
p
, 
i
, &
a
[i], &
bEof
);

134095 ifÐ
DOCID_CMP
(
a
[
i
].
iDocid
, 
iMax
)>0 ){

134096 
	giMax
 = 
a
[
i
].
iDocid
;

134097 
	gi
 = 0;

134103 ifÐ
	gbEof
==0 ){

134104 
nLi¡
 = 0;

134105 
	gnBy‹
 = 
a
[
p
->
nTok’
-1].
nLi¡
;

134106 *
	gaDoþi¡
 = 
sql™e3_m®loc
(
nBy‹
+1);

134107 ifÐ!
	gaDoþi¡
 )  
	gSQLITE_NOMEM
;

134108 
memýy
(
aDoþi¡
, 
a
[
p
->
nTok’
-1].
pLi¡
, 
nBy‹
+1);

134110 
	gi
=0; i<(
	gp
->
	gnTok’
-1); i++){

134111 ifÐ
	ga
[
i
].
	gbIgnÜe
==0 ){

134112 *
pL
 = 
a
[
i
].
pLi¡
;

134113 *
	gpR
 = 
aDoþi¡
;

134114 *
	gpOut
 = 
aDoþi¡
;

134115 
	gnDi¡
 = 
p
->
nTok’
-1-
i
;

134116 
	g»s
 = 
ás3Po¦i¡Ph¿£M”ge
(&
pOut
, 
nDi¡
, 0, 1, &
pL
, &
pR
);

134117 ifÐ
	g»s
==0 ) ;

134118 
	gnLi¡
 = ()(
pOut
 - 
aDoþi¡
);

134121 ifÐ
	gi
==(
p
->
nTok’
-1) ){

134122 
pDL
->
iDocid
 = 
iMax
;

134123 
	gpDL
->
	gpLi¡
 = 
aDoþi¡
;

134124 
	gpDL
->
	gnLi¡
 = 
nLi¡
;

134125 
	gpDL
->
	gbF»eLi¡
 = 1;

134128 
sql™e3_ä“
(
aDoþi¡
);

134133 *
	gpbEof
 = 
bEof
;

134134  
	grc
;

134146 
ás3Ev®Ph¿£Next
(

134147 
Fts3CursÜ
 *
pC¤
,

134148 
Fts3Ph¿£
 *
p
,

134149 
u8
 *
pbEof


134151 
	grc
 = 
SQLITE_OK
;

134152 
Fts3Doþi¡
 *
	gpDL
 = &
p
->
doþi¡
;

134153 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

134155 ifÐ
	gp
->
	gbInü
 ){

134156 
	grc
 = 
ás3Ev®InüPh¿£Next
(
pC¤
, 
p
, 
pbEof
);

134157 }ifÐ
	gpC¤
->
	gbDesc
!=
pTab
->
bDescIdx
 && 
pDL
->
nAÎ
 ){

134158 
sql™e3Fts3Doþi¡P»v
(
pTab
->
bDescIdx
, 
pDL
->
aAÎ
,…DL->
nAÎ
,

134159 &
pDL
->
pNextDocid
, &pDL->
iDocid
, &pDL->
nLi¡
, 
pbEof


134161 
	gpDL
->
	gpLi¡
 = 
pDL
->
pNextDocid
;

134163 
ás3Ev®DlPh¿£Next
(
pTab
, 
pDL
, 
pbEof
);

134166  
	grc
;

134185 
ás3Ev®S¹R—d”s
(

134186 
Fts3CursÜ
 *
pC¤
,

134187 
Fts3Ex´
 *
pEx´
,

134188 *
pRc


134190 ifÐ
	gpEx´
 && 
	gSQLITE_OK
==*
pRc
 ){

134191 ifÐ
pEx´
->
eTy³
==
FTSQUERY_PHRASE
 ){

134192 
i
;

134193 
	gnTok’
 = 
pEx´
->
pPh¿£
->
nTok’
;

134194 
	gi
=0; i<
	gnTok’
; i++){

134195 ifÐ
	gpEx´
->
	gpPh¿£
->
	gaTok’
[
i
].
	gpDeã¼ed
==0 ) ;

134197 
	gpEx´
->
	gbDeã¼ed
 = (
i
==
nTok’
);

134198 *
	gpRc
 = 
ás3Ev®Ph¿£S¹
(
pC¤
, 1, 
pEx´
->
pPh¿£
);

134200 
ás3Ev®S¹R—d”s
(
pC¤
, 
pEx´
->
pLeá
, 
pRc
);

134201 
ás3Ev®S¹R—d”s
(
pC¤
, 
pEx´
->
pRight
, 
pRc
);

134202 
	gpEx´
->
	gbDeã¼ed
 = (
pEx´
->
pLeá
->
bDeã¼ed
 &&…Ex´->
pRight
->bDeferred);

134219 
Fts3Tok’AndCo¡
 
	tFts3Tok’AndCo¡
;

134220 
	sFts3Tok’AndCo¡
 {

134221 
Fts3Ph¿£
 *
	gpPh¿£
;

134222 
	giTok’
;

134223 
Fts3Ph¿£Tok’
 *
	gpTok’
;

134224 
Fts3Ex´
 *
	gpRoÙ
;

134225 
	gnOvæ
;

134226 
	giCÞ
;

134236 
ás3Ev®Tok’Co¡s
(

134237 
Fts3CursÜ
 *
pC¤
,

134238 
Fts3Ex´
 *
pRoÙ
,

134239 
Fts3Ex´
 *
pEx´
,

134240 
Fts3Tok’AndCo¡
 **
µTC
,

134241 
Fts3Ex´
 ***
µOr
,

134242 *
pRc


134244 ifÐ*
	gpRc
==
SQLITE_OK
 ){

134245 ifÐ
pEx´
->
eTy³
==
FTSQUERY_PHRASE
 ){

134246 
Fts3Ph¿£
 *
pPh¿£
 = 
pEx´
->pPhrase;

134247 
	gi
;

134248 
	gi
=0; *
	gpRc
==
SQLITE_OK
 && 
i
<
pPh¿£
->
nTok’
; i++){

134249 
Fts3Tok’AndCo¡
 *
	gpTC
 = (*
µTC
)++;

134250 
	gpTC
->
	gpPh¿£
 = 
pPh¿£
;

134251 
	gpTC
->
	giTok’
 = 
i
;

134252 
	gpTC
->
	gpRoÙ
 = 
pRoÙ
;

134253 
	gpTC
->
	gpTok’
 = &
pPh¿£
->
aTok’
[
i
];

134254 
	gpTC
->
	giCÞ
 = 
pPh¿£
->
iCÞumn
;

134255 *
	gpRc
 = 
sql™e3Fts3M¤Ovæ
(
pC¤
, 
pTC
->
pTok’
->
pSegc¤
, &pTC->
nOvæ
);

134257 }ifÐ
	gpEx´
->
	geTy³
!=
FTSQUERY_NOT
 ){

134258 
as£¹
Ð
pEx´
->
eTy³
==
FTSQUERY_OR


134259 || 
pEx´
->
eTy³
==
FTSQUERY_AND


134260 || 
pEx´
->
eTy³
==
FTSQUERY_NEAR


134262 
as£¹
Ð
pEx´
->
pLeá
 &&…Ex´->
pRight
 );

134263 ifÐ
	gpEx´
->
	geTy³
==
FTSQUERY_OR
 ){

134264 
pRoÙ
 = 
pEx´
->
pLeá
;

134265 **
	gµOr
 = 
pRoÙ
;

134266 (*
	gµOr
)++;

134268 
ás3Ev®Tok’Co¡s
(
pC¤
, 
pRoÙ
, 
pEx´
->
pLeá
, 
µTC
, 
µOr
, 
pRc
);

134269 ifÐ
	gpEx´
->
	geTy³
==
FTSQUERY_OR
 ){

134270 
pRoÙ
 = 
pEx´
->
pRight
;

134271 **
	gµOr
 = 
pRoÙ
;

134272 (*
	gµOr
)++;

134274 
ás3Ev®Tok’Co¡s
(
pC¤
, 
pRoÙ
, 
pEx´
->
pRight
, 
µTC
, 
µOr
, 
pRc
);

134290 
ás3Ev®Av”ageDocsize
(
Fts3CursÜ
 *
pC¤
, *
²Page
){

134291 ifÐ
	gpC¤
->
	gnRowAvg
==0 ){

134303 
rc
;

134304 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pC¤
->
ba£
.
pVb
;

134305 
sql™e3_¡mt
 *
	gpStmt
;

134306 
sql™e3_št64
 
	gnDoc
 = 0;

134307 
sql™e3_št64
 
	gnBy‹
 = 0;

134308 cÚ¡ *
	gpEnd
;

134309 cÚ¡ *
	ga
;

134311 
	grc
 = 
sql™e3Fts3S–eùDoùÙ®
(
p
, &
pStmt
);

134312 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

134313 
	ga
 = 
sql™e3_cÞumn_blob
(
pStmt
, 0);

134314 
as£¹
Ð
a
 );

134316 
	gpEnd
 = &
a
[
sql™e3_cÞumn_by‹s
(
pStmt
, 0)];

134317 
	ga
 +ð
sql™e3Fts3G‘V¬št
(
a
, &
nDoc
);

134318  
	ga
<
	gpEnd
 ){

134319 
	ga
 +ð
sql™e3Fts3G‘V¬št
(
a
, &
nBy‹
);

134321 ifÐ
	gnDoc
==0 || 
nBy‹
==0 ){

134322 
sql™e3_»£t
(
pStmt
);

134323  
	gFTS_CORRUPT_VTAB
;

134326 
	gpC¤
->
	gnDoc
 = 
nDoc
;

134327 
	gpC¤
->
	gnRowAvg
 = ()(((
nBy‹
 / 
nDoc
è+ 
p
->
nPgsz
) /…->nPgsz);

134328 
as£¹
Ð
pC¤
->
nRowAvg
>0 );

134329 
	grc
 = 
sql™e3_»£t
(
pStmt
);

134330 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

134333 *
	g²Page
 = 
pC¤
->
nRowAvg
;

134334  
	gSQLITE_OK
;

134351 
ás3Ev®S–eùDeã¼ed
(

134352 
Fts3CursÜ
 *
pC¤
,

134353 
Fts3Ex´
 *
pRoÙ
,

134354 
Fts3Tok’AndCo¡
 *
aTC
,

134355 
nTC


134357 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

134358 
	gnDocSize
 = 0;

134359 
	grc
 = 
SQLITE_OK
;

134360 
	gii
;

134361 
	gnOvæ
 = 0;

134362 
	gnTok’
 = 0;

134364 
	gnMšE¡
 = 0;

134365 
	gnLßd4
 = 1;

134372 ifÐ
	gpTab
->
	gzCÚ‹ÁTbl
 ){

134373  
	gSQLITE_OK
;

134379 
	gii
=0; ii<
	gnTC
; ii++){

134380 ifÐ
	gaTC
[
ii
].
	gpRoÙ
==
pRoÙ
 ){

134381 
nOvæ
 +ð
aTC
[
ii
].nOvfl;

134382 
	gnTok’
++;

134385 ifÐ
	gnOvæ
==0 || 
nTok’
<2 )  
SQLITE_OK
;

134388 
	grc
 = 
ás3Ev®Av”ageDocsize
(
pC¤
, &
nDocSize
);

134389 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
nDocSize
>0 );

134414 
	gii
=0; ii<
	gnTok’
 && 
	grc
==
SQLITE_OK
; ii++){

134415 
	giTC
;

134416 
Fts3Tok’AndCo¡
 *
	gpTC
 = 0;

134419 
	giTC
=0; iTC<
	gnTC
; iTC++){

134420 ifÐ
	gaTC
[
iTC
].
	gpTok’
 &&‡TC[iTC].
	gpRoÙ
==
pRoÙ


134421 && (!
pTC
 || 
aTC
[
iTC
].
nOvæ
<pTC->nOvfl)

134423 
pTC
 = &
aTC
[
iTC
];

134426 
as£¹
Ð
pTC
 );

134428 ifÐ
	gii
 && 
	gpTC
->
	gnOvæ
>=((
nMšE¡
+(
nLßd4
/4)-1)/ÒLßd4/4))*
nDocSize
 ){

134433 
Fts3Ph¿£Tok’
 *
pTok’
 = 
pTC
->pToken;

134434 
	grc
 = 
sql™e3Fts3DeãrTok’
(
pC¤
, 
pTok’
, 
pTC
->
iCÞ
);

134435 
ás3SegR—d”CursÜF»e
(
pTok’
->
pSegc¤
);

134436 
	gpTok’
->
	gpSegc¤
 = 0;

134441 ifÐ
	gii
<12 ) 
	gnLßd4
 = 
nLßd4
*4;

134443 ifÐ
	gii
==0 || (
pTC
->
pPh¿£
->
nTok’
>1 && 
ii
!=nToken-1) ){

134447 
Fts3Ph¿£Tok’
 *
pTok’
 = 
pTC
->pToken;

134448 
	gnLi¡
 = 0;

134449 *
	gpLi¡
 = 0;

134450 
	grc
 = 
ás3T”mS–eù
(
pTab
, 
pTok’
, 
pTC
->
iCÞ
, &
nLi¡
, &
pLi¡
);

134451 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pLi¡
==0 );

134452 ifÐ
	grc
==
SQLITE_OK
 ){

134453 
nCouÁ
;

134454 
ás3Ev®Ph¿£M”geTok’
(
pTab
, 
pTC
->
pPh¿£
,…TC->
iTok’
,
pLi¡
,
nLi¡
);

134455 
	gnCouÁ
 = 
ás3Doþi¡CouÁDocids
(

134456 
pTC
->
pPh¿£
->
doþi¡
.
aAÎ
,…TC->pPh¿£->doþi¡.
nAÎ


134458 ifÐ
	gii
==0 || 
nCouÁ
<
nMšE¡
 )‚MinEst =‚Count;

134462 
	gpTC
->
	gpTok’
 = 0;

134465  
	grc
;

134480 
ás3Ev®S¹
(
Fts3CursÜ
 *
pC¤
){

134481 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

134482 
	grc
 = 
SQLITE_OK
;

134483 
	gnTok’
 = 0;

134484 
	gnOr
 = 0;

134487 
ás3Ev®AÎoÿ‹R—d”s
(
pC¤
,…C¤->
pEx´
, &
nTok’
, &
nOr
, &
rc
);

134490 #iâdeà
SQLITE_DISABLE_FTS4_DEFERRED


134491 ifÐ
	grc
==
SQLITE_OK
 && 
nTok’
>1 && 
pTab
->
bFts4
 ){

134492 
Fts3Tok’AndCo¡
 *
aTC
;

134493 
Fts3Ex´
 **
	g­Or
;

134494 
	gaTC
 = (
Fts3Tok’AndCo¡
 *)
sql™e3_m®loc
(

134495 (
Fts3Tok’AndCo¡
è* 
nTok’


134496 + (
Fts3Ex´
 *è* 
nOr
 * 2

134498 
	g­Or
 = (
Fts3Ex´
 **)&
aTC
[
nTok’
];

134500 ifÐ!
	gaTC
 ){

134501 
	grc
 = 
SQLITE_NOMEM
;

134503 
	gii
;

134504 
Fts3Tok’AndCo¡
 *
	gpTC
 = 
aTC
;

134505 
Fts3Ex´
 **
	gµOr
 = 
­Or
;

134507 
ás3Ev®Tok’Co¡s
(
pC¤
, 0,…C¤->
pEx´
, &
pTC
, &
µOr
, &
rc
);

134508 
	gnTok’
 = ()(
pTC
-
aTC
);

134509 
	gnOr
 = ()(
µOr
-
­Or
);

134511 ifÐ
	grc
==
SQLITE_OK
 ){

134512 
rc
 = 
ás3Ev®S–eùDeã¼ed
(
pC¤
, 0, 
aTC
, 
nTok’
);

134513 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<
nOr
; ii++){

134514 
	grc
 = 
ás3Ev®S–eùDeã¼ed
(
pC¤
, 
­Or
[
ii
], 
aTC
, 
nTok’
);

134518 
sql™e3_ä“
(
aTC
);

134523 
ás3Ev®S¹R—d”s
(
pC¤
,…C¤->
pEx´
, &
rc
);

134524  
	grc
;

134530 
ás3Ev®Inv®id©ePo¦i¡
(
Fts3Ph¿£
 *
pPh¿£
){

134531 ifÐ
	gpPh¿£
->
	gdoþi¡
.
	gbF»eLi¡
 ){

134532 
sql™e3_ä“
(
pPh¿£
->
doþi¡
.
pLi¡
);

134534 
	gpPh¿£
->
	gdoþi¡
.
	gpLi¡
 = 0;

134535 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 0;

134536 
	gpPh¿£
->
	gdoþi¡
.
	gbF»eLi¡
 = 0;

134561 
ás3Ev®N—rTrim
(

134562 
nN—r
,

134563 *
aTmp
,

134564 **
·Po¦i¡
,

134565 *
²Tok’
,

134566 
Fts3Ph¿£
 *
pPh¿£


134568 
	gnP¬am1
 = 
nN—r
 + 
pPh¿£
->
nTok’
;

134569 
	gnP¬am2
 = 
nN—r
 + *
²Tok’
;

134570 
	gnNew
;

134571 *
	gp2
;

134572 *
	gpOut
;

134573 
	g»s
;

134575 
as£¹
Ð
pPh¿£
->
doþi¡
.
pLi¡
 );

134577 
	gp2
 = 
pOut
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

134578 
	g»s
 = 
ás3Po¦i¡N—rM”ge
(

134579 &
pOut
, 
aTmp
, 
nP¬am1
, 
nP¬am2
, 
·Po¦i¡
, &
p2


134581 ifÐ
	g»s
 ){

134582 
	gnNew
 = ()(
pOut
 - 
pPh¿£
->
doþi¡
.
pLi¡
) - 1;

134583 
as£¹
Ð
pPh¿£
->
doþi¡
.
pLi¡
[
nNew
]=='\0' );

134584 
as£¹
Ð
nNew
<=
pPh¿£
->
doþi¡
.
nLi¡
 &&‚New>0 );

134585 
mem£t
(&
pPh¿£
->
doþi¡
.
pLi¡
[
nNew
], 0,…Ph¿£->doþi¡.
nLi¡
 -‚New);

134586 
	gpPh¿£
->
	gdoþi¡
.
	gnLi¡
 = 
nNew
;

134587 *
	g·Po¦i¡
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

134588 *
	g²Tok’
 = 
pPh¿£
->
nTok’
;

134591  
	g»s
;

134635 
ás3Ev®NextRow
(

134636 
Fts3CursÜ
 *
pC¤
,

134637 
Fts3Ex´
 *
pEx´
,

134638 *
pRc


134640 ifÐ*
	gpRc
==
SQLITE_OK
 ){

134641 
bDescDoþi¡
 = 
pC¤
->
bDesc
;

134642 
as£¹
Ð
pEx´
->
bEof
==0 );

134643 
	gpEx´
->
	gbS¹
 = 1;

134645  
	gpEx´
->
	geTy³
 ){

134646 
	gFTSQUERY_NEAR
:

134647 
FTSQUERY_AND
: {

134648 
Fts3Ex´
 *
pLeá
 = 
pEx´
->pLeft;

134649 
Fts3Ex´
 *
	gpRight
 = 
pEx´
->
pRight
;

134650 
as£¹
Ð!
pLeá
->
bDeã¼ed
 || !
pRight
->bDeferred );

134652 ifÐ
	gpLeá
->
	gbDeã¼ed
 ){

134655 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134656 
	gpEx´
->
	giDocid
 = 
pRight
->
iDocid
;

134657 
	gpEx´
->
	gbEof
 = 
pRight
->
bEof
;

134658 }ifÐ
	gpRight
->
	gbDeã¼ed
 ){

134661 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134662 
	gpEx´
->
	giDocid
 = 
pLeá
->
iDocid
;

134663 
	gpEx´
->
	gbEof
 = 
pLeá
->
bEof
;

134666 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134667 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134668  !
	gpLeá
->
	gbEof
 && !
	gpRight
->bEoà&& *
	gpRc
==
SQLITE_OK
 ){

134669 
sql™e3_št64
 
iDiff
 = 
DOCID_CMP
(
pLeá
->
iDocid
, 
pRight
->iDocid);

134670 ifÐ
	giDiff
==0 ) ;

134671 ifÐ
	giDiff
<0 ){

134672 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134674 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134677 
	gpEx´
->
	giDocid
 = 
pLeá
->
iDocid
;

134678 
	gpEx´
->
	gbEof
 = (
pLeá
->
bEof
 || 
pRight
->bEof);

134683 
	gFTSQUERY_OR
: {

134684 
Fts3Ex´
 *
pLeá
 = 
pEx´
->pLeft;

134685 
Fts3Ex´
 *
	gpRight
 = 
pEx´
->
pRight
;

134686 
sql™e3_št64
 
	giCmp
 = 
DOCID_CMP
(
pLeá
->
iDocid
, 
pRight
->iDocid);

134688 
as£¹
Ð
pLeá
->
bS¹
 ||…Leá->
iDocid
==
pRight
->iDocid );

134689 
as£¹
Ð
pRight
->
bS¹
 || 
pLeá
->
iDocid
==pRight->iDocid );

134691 ifÐ
	gpRight
->
	gbEof
 || (
	gpLeá
->bEof==0 && 
iCmp
<0) ){

134692 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134693 }ifÐ
	gpLeá
->
	gbEof
 || (
	gpRight
->bEof==0 && 
iCmp
>0) ){

134694 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134696 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134697 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134700 
	gpEx´
->
	gbEof
 = (
pLeá
->
bEof
 && 
pRight
->bEof);

134701 
	giCmp
 = 
DOCID_CMP
(
pLeá
->
iDocid
, 
pRight
->iDocid);

134702 ifÐ
	gpRight
->
	gbEof
 || (
	gpLeá
->bEof==0 && 
iCmp
<0) ){

134703 
pEx´
->
iDocid
 = 
pLeá
->iDocid;

134705 
	gpEx´
->
	giDocid
 = 
pRight
->
iDocid
;

134711 
	gFTSQUERY_NOT
: {

134712 
Fts3Ex´
 *
pLeá
 = 
pEx´
->pLeft;

134713 
Fts3Ex´
 *
	gpRight
 = 
pEx´
->
pRight
;

134715 ifÐ
	gpRight
->
	gbS¹
==0 ){

134716 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134717 
as£¹
Ð*
pRc
!=
SQLITE_OK
 || 
pRight
->
bS¹
 );

134720 
ás3Ev®NextRow
(
pC¤
, 
pLeá
, 
pRc
);

134721 ifÐ
	gpLeá
->
	gbEof
==0 ){

134722  !*
pRc


134723 && !
pRight
->
bEof


134724 && 
DOCID_CMP
(
pLeá
->
iDocid
, 
pRight
->iDocid)>0

134726 
ás3Ev®NextRow
(
pC¤
, 
pRight
, 
pRc
);

134729 
	gpEx´
->
	giDocid
 = 
pLeá
->
iDocid
;

134730 
	gpEx´
->
	gbEof
 = 
pLeá
->
bEof
;

134735 
Fts3Ph¿£
 *
pPh¿£
 = 
pEx´
->pPhrase;

134736 
ás3Ev®Inv®id©ePo¦i¡
(
pPh¿£
);

134737 *
	gpRc
 = 
ás3Ev®Ph¿£Next
(
pC¤
, 
pPh¿£
, &
pEx´
->
bEof
);

134738 
	gpEx´
->
	giDocid
 = 
pPh¿£
->
doþi¡
.
iDocid
;

134760 
ás3Ev®N—rTe¡
(
Fts3Ex´
 *
pEx´
, *
pRc
){

134761 
	g»s
 = 1;

134783 ifÐ*
	gpRc
==
SQLITE_OK


134784 && 
pEx´
->
eTy³
==
FTSQUERY_NEAR


134785 && 
pEx´
->
bEof
==0

134786 && (
pEx´
->
pP¬’t
==0 ||…Ex´->pP¬’t->
eTy³
!=
FTSQUERY_NEAR
)

134788 
Fts3Ex´
 *
p
;

134789 
	gnTmp
 = 0;

134790 *
	gaTmp
;

134793 
	gp
=
pEx´
;…->
	gpLeá
;…=
p
->
pLeá
){

134794 
nTmp
 +ð
p
->
pRight
->
pPh¿£
->
doþi¡
.
nLi¡
;

134796 
	gnTmp
 +ð
p
->
pPh¿£
->
doþi¡
.
nLi¡
;

134797 ifÐ
	gnTmp
==0 ){

134798 
»s
 = 0;

134800 
	gaTmp
 = 
sql™e3_m®loc
(
nTmp
*2);

134801 ifÐ!
	gaTmp
 ){

134802 *
	gpRc
 = 
SQLITE_NOMEM
;

134803 
	g»s
 = 0;

134805 *
	gaPo¦i¡
 = 
p
->
pPh¿£
->
doþi¡
.
pLi¡
;

134806 
	gnTok’
 = 
p
->
pPh¿£
->
nTok’
;

134808 
	gp
=
p
->
pP¬’t
;
	g»s
 &&… &&…->
	geTy³
==
FTSQUERY_NEAR
;…=p->pParent){

134809 
Fts3Ph¿£
 *
pPh¿£
 = 
p
->
pRight
->pPhrase;

134810 
	gnN—r
 = 
p
->
nN—r
;

134811 
	g»s
 = 
ás3Ev®N—rTrim
(
nN—r
, 
aTmp
, &
aPo¦i¡
, &
nTok’
, 
pPh¿£
);

134814 
	gaPo¦i¡
 = 
pEx´
->
pRight
->
pPh¿£
->
doþi¡
.
pLi¡
;

134815 
	gnTok’
 = 
pEx´
->
pRight
->
pPh¿£
->
nTok’
;

134816 
	gp
=
pEx´
->
pLeá
;… && 
	g»s
;…=
p
->pLeft){

134817 
nN—r
;

134818 
Fts3Ph¿£
 *
	gpPh¿£
;

134819 
as£¹
Ð
p
->
pP¬’t
 &&…->pP¬’t->
pLeá
==p );

134820 
	gnN—r
 = 
p
->
pP¬’t
->
nN—r
;

134821 
	gpPh¿£
 = (

134822 
p
->
eTy³
==
FTSQUERY_NEAR
 ?…->
pRight
->
pPh¿£
 :…->pPhrase

134824 
	g»s
 = 
ás3Ev®N—rTrim
(
nN—r
, 
aTmp
, &
aPo¦i¡
, &
nTok’
, 
pPh¿£
);

134828 
sql™e3_ä“
(
aTmp
);

134832  
	g»s
;

134846 
ás3Ev®Te¡Ex´
(

134847 
Fts3CursÜ
 *
pC¤
,

134848 
Fts3Ex´
 *
pEx´
,

134849 *
pRc


134851 
	gbH™
 = 1;

134852 ifÐ*
	gpRc
==
SQLITE_OK
 ){

134853  
pEx´
->
eTy³
 ){

134854 
FTSQUERY_NEAR
:

134855 
FTSQUERY_AND
:

134856 
bH™
 = (

134857 
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pLeá
, 
pRc
)

134858 && 
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pRight
, 
pRc
)

134859 && 
ás3Ev®N—rTe¡
(
pEx´
, 
pRc
)

134877 ifÐ
	gbH™
==0

134878 && 
pEx´
->
eTy³
==
FTSQUERY_NEAR


134879 && (
pEx´
->
pP¬’t
==0 ||…Ex´->pP¬’t->
eTy³
!=
FTSQUERY_NEAR
)

134881 
Fts3Ex´
 *
p
;

134882 
	gp
=
pEx´
;…->
	gpPh¿£
==0;…=
p
->
pLeá
){

134883 ifÐ
p
->
pRight
->
iDocid
==
pC¤
->
iP»vId
 ){

134884 
ás3Ev®Inv®id©ePo¦i¡
(
p
->
pRight
->
pPh¿£
);

134887 ifÐ
	gp
->
	giDocid
==
pC¤
->
iP»vId
 ){

134888 
ás3Ev®Inv®id©ePo¦i¡
(
p
->
pPh¿£
);

134894 
	gFTSQUERY_OR
: {

134895 
bH™1
 = 
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pLeá
, 
pRc
);

134896 
	gbH™2
 = 
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pRight
, 
pRc
);

134897 
	gbH™
 = 
bH™1
 || 
bH™2
;

134901 
	gFTSQUERY_NOT
:

134902 
bH™
 = (

134903 
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pLeá
, 
pRc
)

134904 && !
ás3Ev®Te¡Ex´
(
pC¤
, 
pEx´
->
pRight
, 
pRc
)

134909 #iâdeà
SQLITE_DISABLE_FTS4_DEFERRED


134910 ifÐ
pC¤
->
pDeã¼ed


134911 && (
pEx´
->
iDocid
==
pC¤
->
iP»vId
 ||…Ex´->
bDeã¼ed
)

134913 
Fts3Ph¿£
 *
pPh¿£
 = 
pEx´
->pPhrase;

134914 
as£¹
Ð
pEx´
->
bDeã¼ed
 || 
pPh¿£
->
doþi¡
.
bF»eLi¡
==0 );

134915 ifÐ
	gpEx´
->
	gbDeã¼ed
 ){

134916 
ás3Ev®Inv®id©ePo¦i¡
(
pPh¿£
);

134918 *
	gpRc
 = 
ás3Ev®Deã¼edPh¿£
(
pC¤
, 
pPh¿£
);

134919 
	gbH™
 = (
pPh¿£
->
doþi¡
.
pLi¡
!=0);

134920 
	gpEx´
->
	giDocid
 = 
pC¤
->
iP»vId
;

134924 
	gbH™
 = (
pEx´
->
bEof
==0 &&…Ex´->
iDocid
==
pC¤
->
iP»vId
);

134930  
	gbH™
;

134957 
ás3Ev®Te¡Deã¼edAndN—r
(
Fts3CursÜ
 *
pC¤
, *
pRc
){

134958 
	grc
 = *
pRc
;

134959 
	gbMiss
 = 0;

134960 ifÐ
	grc
==
SQLITE_OK
 ){

134968 ifÐ
pC¤
->
pDeã¼ed
 ){

134969 
rc
 = 
ás3CursÜS“k
(0, 
pC¤
);

134970 ifÐ
	grc
==
SQLITE_OK
 ){

134971 
rc
 = 
sql™e3Fts3CacheDeã¼edDoþi¡s
(
pC¤
);

134974 
	gbMiss
 = (0==
ás3Ev®Te¡Ex´
(
pC¤
,…C¤->
pEx´
, &
rc
));

134977 
sql™e3Fts3F»eDeã¼edDoþi¡s
(
pC¤
);

134978 *
	gpRc
 = 
rc
;

134980  (
	grc
==
SQLITE_OK
 && 
bMiss
);

134987 
ás3Ev®Next
(
Fts3CursÜ
 *
pC¤
){

134988 
	grc
 = 
SQLITE_OK
;

134989 
Fts3Ex´
 *
	gpEx´
 = 
pC¤
->
pEx´
;

134990 
as£¹
Ð
pC¤
->
isEof
==0 );

134991 ifÐ
	gpEx´
==0 ){

134992 
pC¤
->
isEof
 = 1;

134995 ifÐ
	gpC¤
->
	gisRequœeS“k
==0 ){

134996 
sql™e3_»£t
(
pC¤
->
pStmt
);

134998 
as£¹
Ð
sql™e3_d©a_couÁ
(
pC¤
->
pStmt
)==0 );

134999 
ás3Ev®NextRow
(
pC¤
, 
pEx´
, &
rc
);

135000 
	gpC¤
->
	gisEof
 = 
pEx´
->
bEof
;

135001 
	gpC¤
->
	gisRequœeS“k
 = 1;

135002 
	gpC¤
->
	gisM©chšfoN“ded
 = 1;

135003 
	gpC¤
->
	giP»vId
 = 
pEx´
->
iDocid
;

135004 } 
	gpC¤
->
	gisEof
==0 && 
ás3Ev®Te¡Deã¼edAndN—r
(
pC¤
, &
rc
) );

135009 ifÐ
	grc
==
SQLITE_OK
 && (

135010 (
pC¤
->
bDesc
==0 &&…C¤->
iP»vId
>pC¤->
iMaxDocid
)

135011 || (
pC¤
->
bDesc
!=0 &&…C¤->
iP»vId
<pC¤->
iMšDocid
)

135013 
pC¤
->
isEof
 = 1;

135016  
	grc
;

135028 
ás3Ev®Re¡¬t
(

135029 
Fts3CursÜ
 *
pC¤
,

135030 
Fts3Ex´
 *
pEx´
,

135031 *
pRc


135033 ifÐ
	gpEx´
 && *
	gpRc
==
SQLITE_OK
 ){

135034 
Fts3Ph¿£
 *
pPh¿£
 = 
pEx´
->pPhrase;

135036 ifÐ
	gpPh¿£
 ){

135037 
ás3Ev®Inv®id©ePo¦i¡
(
pPh¿£
);

135038 ifÐ
	gpPh¿£
->
	gbInü
 ){

135039 
	gi
;

135040 
	gi
=0; i<
	gpPh¿£
->
	gnTok’
; i++){

135041 
Fts3Ph¿£Tok’
 *
	gpTok’
 = &
pPh¿£
->
aTok’
[
i
];

135042 
as£¹
Ð
pTok’
->
pDeã¼ed
==0 );

135043 ifÐ
	gpTok’
->
	gpSegc¤
 ){

135044 
sql™e3Fts3M¤InüRe¡¬t
(
pTok’
->
pSegc¤
);

135047 *
	gpRc
 = 
ás3Ev®Ph¿£S¹
(
pC¤
, 0, 
pPh¿£
);

135049 
	gpPh¿£
->
	gdoþi¡
.
	gpNextDocid
 = 0;

135050 
	gpPh¿£
->
	gdoþi¡
.
	giDocid
 = 0;

135053 
	gpEx´
->
	giDocid
 = 0;

135054 
	gpEx´
->
	gbEof
 = 0;

135055 
	gpEx´
->
	gbS¹
 = 0;

135057 
ás3Ev®Re¡¬t
(
pC¤
, 
pEx´
->
pLeá
, 
pRc
);

135058 
ás3Ev®Re¡¬t
(
pC¤
, 
pEx´
->
pRight
, 
pRc
);

135070 
ás3Ev®Upd©eCouÁs
(
Fts3Ex´
 *
pEx´
){

135071 ifÐ
	gpEx´
 ){

135072 
Fts3Ph¿£
 *
	gpPh¿£
 = 
pEx´
->
pPh¿£
;

135073 ifÐ
	gpPh¿£
 &&…Ph¿£->
	gdoþi¡
.
	gpLi¡
 ){

135074 
	giCÞ
 = 0;

135075 *
	gp
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

135077 
as£¹
Ð*
p
 );

135079 
u8
 
	gc
 = 0;

135080 
	giCÁ
 = 0;

135081  0xFE & (*
	gp
 | 
	gc
) ){

135082 ifÐ(
	gc
&0x80)==0 ) 
iCÁ
++;

135083 
	gc
 = *
p
++ & 0x80;

135089 
	gpEx´
->
	gaMI
[
iCÞ
*3 + 1] +ð
iCÁ
;

135090 
	gpEx´
->
	gaMI
[
iCÞ
*3 + 2] +ð(
iCÁ
>0);

135091 ifÐ*
	gp
==0x00 ) ;

135092 
	gp
++;

135093 
	gp
 +ð
ás3G‘V¬št32
(
p
, &
iCÞ
);

135097 
ás3Ev®Upd©eCouÁs
(
pEx´
->
pLeá
);

135098 
ás3Ev®Upd©eCouÁs
(
pEx´
->
pRight
);

135113 
ás3Ev®G©h”Sts
(

135114 
Fts3CursÜ
 *
pC¤
,

135115 
Fts3Ex´
 *
pEx´


135117 
	grc
 = 
SQLITE_OK
;

135119 
as£¹
Ð
pEx´
->
eTy³
==
FTSQUERY_PHRASE
 );

135120 ifÐ
	gpEx´
->
	gaMI
==0 ){

135121 
Fts3TabË
 *
pTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

135122 
Fts3Ex´
 *
	gpRoÙ
;

135123 
Fts3Ex´
 *
	gp
;

135125 
sql™e3_št64
 
	giP»vId
 = 
pC¤
->
iP»vId
;

135126 
sql™e3_št64
 
	giDocid
;

135127 
u8
 
	gbEof
;

135130 
	gpRoÙ
 = 
pEx´
;

135131  
	gpRoÙ
->
	gpP¬’t
 &&…RoÙ->pP¬’t->
	geTy³
==
FTSQUERY_NEAR
 ){

135132 
pRoÙ
 =…RoÙ->
pP¬’t
;

135134 
	giDocid
 = 
pRoÙ
->
iDocid
;

135135 
	gbEof
 = 
pRoÙ
->
bEof
;

135136 
as£¹
Ð
pRoÙ
->
bS¹
 );

135139 
	gp
=
pRoÙ
;…;…=
p
->
pLeá
){

135140 
Fts3Ex´
 *
pE
 = (
p
->
eTy³
==
FTSQUERY_PHRASE
?p:p->
pRight
);

135141 
as£¹
Ð
pE
->
aMI
==0 );

135142 
	gpE
->
	gaMI
 = (
u32
 *)
sql™e3_m®loc
(
pTab
->
nCÞumn
 * 3 * (u32));

135143 ifÐ!
	gpE
->
	gaMI
 )  
	gSQLITE_NOMEM
;

135144 
mem£t
(
pE
->
aMI
, 0, 
pTab
->
nCÞumn
 * 3 * (
u32
));

135147 
ás3Ev®Re¡¬t
(
pC¤
, 
pRoÙ
, &
rc
);

135149  
	gpC¤
->
	gisEof
==0 && 
rc
==
SQLITE_OK
 ){

135153 ifÐ
pC¤
->
isRequœeS“k
==0 ) 
sql™e3_»£t
ÕC¤->
pStmt
);

135154 
as£¹
Ð
sql™e3_d©a_couÁ
(
pC¤
->
pStmt
)==0 );

135157 
ás3Ev®NextRow
(
pC¤
, 
pRoÙ
, &
rc
);

135158 
	gpC¤
->
	gisEof
 = 
pRoÙ
->
bEof
;

135159 
	gpC¤
->
	gisRequœeS“k
 = 1;

135160 
	gpC¤
->
	gisM©chšfoN“ded
 = 1;

135161 
	gpC¤
->
	giP»vId
 = 
pRoÙ
->
iDocid
;

135162 } 
	gpC¤
->
	gisEof
==0

135163 && 
pRoÙ
->
eTy³
==
FTSQUERY_NEAR


135164 && 
ás3Ev®Te¡Deã¼edAndN—r
(
pC¤
, &
rc
)

135167 ifÐ
	grc
==
SQLITE_OK
 && 
pC¤
->
isEof
==0 ){

135168 
ás3Ev®Upd©eCouÁs
(
pRoÙ
);

135172 
	gpC¤
->
	gisEof
 = 0;

135173 
	gpC¤
->
	giP»vId
 = 
iP»vId
;

135175 ifÐ
	gbEof
 ){

135176 
	gpRoÙ
->
	gbEof
 = 
bEof
;

135184 
ás3Ev®Re¡¬t
(
pC¤
, 
pRoÙ
, &
rc
);

135186 
ás3Ev®NextRow
(
pC¤
, 
pRoÙ
, &
rc
);

135187 
as£¹
Ð
pRoÙ
->
bEof
==0 );

135188 } 
	gpRoÙ
->
	giDocid
!=
iDocid
 && 
rc
==
SQLITE_OK
 );

135189 
ás3Ev®Te¡Deã¼edAndN—r
(
pC¤
, &
rc
);

135192  
	grc
;

135225 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£Sts
(

135226 
Fts3CursÜ
 *
pC¤
,

135227 
Fts3Ex´
 *
pEx´
,

135228 
u32
 *
aiOut


135230 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

135231 
	grc
 = 
SQLITE_OK
;

135232 
	giCÞ
;

135234 ifÐ
	gpEx´
->
	gbDeã¼ed
 &&…Ex´->
	gpP¬’t
->
	geTy³
!=
FTSQUERY_NEAR
 ){

135235 
as£¹
Ð
pC¤
->
nDoc
>0 );

135236 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞumn
; iCol++){

135237 
	gaiOut
[
iCÞ
*3 + 1] = (
u32
)
pC¤
->
nDoc
;

135238 
	gaiOut
[
iCÞ
*3 + 2] = (
u32
)
pC¤
->
nDoc
;

135241 
	grc
 = 
ás3Ev®G©h”Sts
(
pC¤
, 
pEx´
);

135242 ifÐ
	grc
==
SQLITE_OK
 ){

135243 
as£¹
Ð
pEx´
->
aMI
 );

135244 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞumn
; iCol++){

135245 
	gaiOut
[
iCÞ
*3 + 1] = 
pEx´
->
aMI
[iCol*3 + 1];

135246 
	gaiOut
[
iCÞ
*3 + 2] = 
pEx´
->
aMI
[iCol*3 + 2];

135251  
	grc
;

135273 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(

135274 
Fts3CursÜ
 *
pC¤
,

135275 
Fts3Ex´
 *
pEx´
,

135276 
iCÞ
,

135277 **
µOut


135279 
Fts3Ph¿£
 *
	gpPh¿£
 = 
pEx´
->
pPh¿£
;

135280 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

135281 *
	gpI‹r
;

135282 
	giThis
;

135283 
sql™e3_št64
 
	giDocid
;

135287 *
	gµOut
 = 0;

135288 
as£¹
Ð
iCÞ
>=0 && iCÞ<
pTab
->
nCÞumn
 );

135289 ifÐ(
	gpPh¿£
->
	giCÞumn
<
	gpTab
->
	gnCÞumn
 &&…Ph¿£->iCÞumn!=
iCÞ
) ){

135290  
SQLITE_OK
;

135293 
	giDocid
 = 
pEx´
->
iDocid
;

135294 
	gpI‹r
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

135295 ifÐ
	giDocid
!=
pC¤
->
iP»vId
 || 
pEx´
->
bEof
 ){

135296 
bDescDoþi¡
 = 
pTab
->
bDescIdx
;

135297 
	giMul
;

135298 
	gbOr
 = 0;

135299 
u8
 
	gbEof
 = 0;

135300 
u8
 
	gbT»eEof
 = 0;

135301 
Fts3Ex´
 *
	gp
;

135302 
Fts3Ex´
 *
	gpN—r
;

135309 
	gpN—r
 = 
pEx´
;

135310 
	gp
=
pEx´
->
pP¬’t
;…;…=
p
->pParent){

135311 ifÐ
p
->
eTy³
==
FTSQUERY_OR
 ) 
bOr
 = 1;

135312 ifÐ
	gp
->
	geTy³
==
FTSQUERY_NEAR
 ) 
pN—r
 = 
p
;

135313 ifÐ
	gp
->
	gbEof
 ) 
	gbT»eEof
 = 1;

135315 ifÐ
	gbOr
==0 )  
SQLITE_OK
;

135320 ifÐ
	gpPh¿£
->
	gbInü
 ){

135321 
	grc
 = 
SQLITE_OK
;

135322 
	gbEofSave
 = 
pEx´
->
bEof
;

135323 
ás3Ev®Re¡¬t
(
pC¤
, 
pEx´
, &
rc
);

135324  
	grc
==
SQLITE_OK
 && !
pEx´
->
bEof
 ){

135325 
ás3Ev®NextRow
(
pC¤
, 
pEx´
, &
rc
);

135326 ifÐ
	gbEofSave
==0 && 
pEx´
->
iDocid
==iDocid ) ;

135328 
	gpI‹r
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

135329 
as£¹
Ð
rc
!=
SQLITE_OK
 || 
pPh¿£
->
bInü
==0 );

135330 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

135333 
	giMul
 = ((
pC¤
->
bDesc
==
bDescDoþi¡
) ? 1 : -1);

135334  
	gbT»eEof
==1

135335 && 
pN—r
->
bEof
==0

135336 && (
DOCID_CMP
(
pN—r
->
iDocid
, 
pC¤
->
iP»vId
è* 
	giMul
)<0

135338 
	grc
 = 
SQLITE_OK
;

135339 
ás3Ev®NextRow
(
pC¤
, 
pEx´
, &
rc
);

135340 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

135341 
	giDocid
 = 
pEx´
->
iDocid
;

135342 
	gpI‹r
 = 
pPh¿£
->
doþi¡
.
pLi¡
;

135345 
	gbEof
 = (
pPh¿£
->
doþi¡
.
nAÎ
==0);

135346 
as£¹
Ð
bDescDoþi¡
==0 || bDescDoclist==1 );

135347 
as£¹
Ð
pC¤
->
bDesc
==0 ||…Csr->bDesc==1 );

135349 ifÐ
	gbEof
==0 ){

135350 ifÐ
pC¤
->
bDesc
==
bDescDoþi¡
 ){

135351 
dummy
;

135352 ifÐ
	gpN—r
->
	gbEof
 ){

135365 
	gpI‹r
 = &
pPh¿£
->
doþi¡
.
aAÎ
[pPh¿£->doþi¡.
nAÎ
-1];

135366 
ás3Rev”£Po¦i¡
(
pPh¿£
->
doþi¡
.
aAÎ
, &
pI‹r
);

135368  (
	gpI‹r
==0 || 
DOCID_CMP
(
iDocid
, 
pC¤
->
iP»vId
)>0 ) && 
	gbEof
==0 ){

135369 
sql™e3Fts3Doþi¡P»v
(

135370 
bDescDoþi¡
, 
pPh¿£
->
doþi¡
.
aAÎ
,…Ph¿£->doþi¡.
nAÎ
,

135371 &
pI‹r
, &
iDocid
, &
dummy
, &
bEof


135375 ifÐ
	gpN—r
->
	gbEof
 ){

135376 
	gpI‹r
 = 0;

135377 
	giDocid
 = 0;

135379  (
	gpI‹r
==0 || 
DOCID_CMP
(
iDocid
, 
pC¤
->
iP»vId
)<0 ) && 
	gbEof
==0 ){

135380 
sql™e3Fts3Doþi¡Next
(

135381 
bDescDoþi¡
, 
pPh¿£
->
doþi¡
.
aAÎ
,…Ph¿£->doþi¡.
nAÎ
,

135382 &
pI‹r
, &
iDocid
, &
bEof


135388 ifÐ
	gbEof
 || 
	giDocid
!=
pC¤
->
iP»vId
 ) 
pI‹r
 = 0;

135390 ifÐ
	gpI‹r
==0 )  
SQLITE_OK
;

135392 ifÐ*
	gpI‹r
==0x01 ){

135393 
pI‹r
++;

135394 
	gpI‹r
 +ð
ás3G‘V¬št32
(
pI‹r
, &
iThis
);

135396 
	giThis
 = 0;

135398  
	giThis
<
	giCÞ
 ){

135399 
ás3CÞumÆi¡CÝy
(0, &
pI‹r
);

135400 ifÐ*
	gpI‹r
==0x00 )  0;

135401 
	gpI‹r
++;

135402 
	gpI‹r
 +ð
ás3G‘V¬št32
(
pI‹r
, &
iThis
);

135405 *
	gµOut
 = ((
iCÞ
==
iThis
)?
pI‹r
:0);

135406  
	gSQLITE_OK
;

135416 
SQLITE_PRIVATE
 
sql™e3Fts3Ev®Ph¿£CËªup
(
Fts3Ph¿£
 *
pPh¿£
){

135417 ifÐ
	gpPh¿£
 ){

135418 
	gi
;

135419 
sql™e3_ä“
(
pPh¿£
->
doþi¡
.
aAÎ
);

135420 
ás3Ev®Inv®id©ePo¦i¡
(
pPh¿£
);

135421 
mem£t
(&
pPh¿£
->
doþi¡
, 0, (
Fts3Doþi¡
));

135422 
	gi
=0; i<
	gpPh¿£
->
	gnTok’
; i++){

135423 
ás3SegR—d”CursÜF»e
(
pPh¿£
->
aTok’
[
i
].
pSegc¤
);

135424 
	gpPh¿£
->
	gaTok’
[
i
].
	gpSegc¤
 = 0;

135433 #ifdeà
SQLITE_DEBUG


135434 
SQLITE_PRIVATE
 
sql™e3Fts3CÜru±
(){

135435  
	gSQLITE_CORRUPT_VTAB
;

135439 #ià!
SQLITE_CORE


135443 #ifdeà
_WIN32


135444 
__deþ¥ec
(
dÎexpÜt
)

135446 
SQLITE_API
 
sql™e3_ás3_š™
(

135447 
sql™e3
 *
db
,

135448 **
pzE¼Msg
,

135449 cÚ¡ 
sql™e3_­i_routšes
 *
pApi


135451 
SQLITE_EXTENSION_INIT2
(
pApi
)

135452  
sql™e3Fts3In™
(
db
);

135473 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

135478 
Fts3auxTabË
 
	tFts3auxTabË
;

135479 
Fts3auxCursÜ
 
	tFts3auxCursÜ
;

135481 
	sFts3auxTabË
 {

135482 
sql™e3_vb
 
	gba£
;

135483 
Fts3TabË
 *
	gpFts3Tab
;

135486 
	sFts3auxCursÜ
 {

135487 
sql™e3_vb_cursÜ
 
	gba£
;

135488 
Fts3MuÉiSegR—d”
 
	gc¤
;

135489 
Fts3SegFž‹r
 
	gfž‹r
;

135490 *
	gzStÝ
;

135491 
	gnStÝ
;

135492 
	giLªgid
;

135493 
	gisEof
;

135494 
sql™e3_št64
 
	giRowid
;

135496 
	giCÞ
;

135497 
	gnSt
;

135498 
	sFts3auxCÞ¡©s
 {

135499 
sql™e3_št64
 
	gnDoc
;

135500 
sql™e3_št64
 
	gnOcc
;

135501 } *
	gaSt
;

135507 
	#FTS3_AUX_SCHEMA
 \

135508 "CREATE TABLE xÑ”m, cÞ, docum’ts, occu¼’ûs,†ªguageid HIDDEN)"

	)

135515 
ás3auxCÚÃùM‘hod
(

135516 
sql™e3
 *
db
,

135517 *
pUnu£d
,

135518 
¬gc
,

135519 cÚ¡ * cÚ¡ *
¬gv
,

135520 
sql™e3_vb
 **
µVb
,

135521 **
pzE¼


135523 cÚ¡ *
	gzDb
;

135524 cÚ¡ *
	gzFts3
;

135525 
	gnDb
;

135526 
	gnFts3
;

135527 
	gnBy‹
;

135528 
	grc
;

135529 
Fts3auxTabË
 *
	gp
;

135531 
UNUSED_PARAMETER
(
pUnu£d
);

135538 ifÐ
	g¬gc
!=4 && 
¬gc
!=5 ) 
bad_¬gs
;

135540 
	gzDb
 = 
¬gv
[1];

135541 
	gnDb
 = ()
¡¾’
(
zDb
);

135542 ifÐ
	g¬gc
==5 ){

135543 ifÐ
nDb
==4 && 0==
sql™e3_¡ºicmp
("‹mp", 
zDb
, 4) ){

135544 
	gzDb
 = 
¬gv
[3];

135545 
	gnDb
 = ()
¡¾’
(
zDb
);

135546 
	gzFts3
 = 
¬gv
[4];

135548 
	gbad_¬gs
;

135551 
	gzFts3
 = 
¬gv
[3];

135553 
	gnFts3
 = ()
¡¾’
(
zFts3
);

135555 
	grc
 = 
sql™e3_deþ¬e_vb
(
db
, 
FTS3_AUX_SCHEMA
);

135556 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

135558 
	gnBy‹
 = (
Fts3auxTabË
è+ (
Fts3TabË
è+ 
nDb
 + 
nFts3
 + 2;

135559 
	gp
 = (
Fts3auxTabË
 *)
sql™e3_m®loc
(
nBy‹
);

135560 ifÐ!
	gp
 )  
	gSQLITE_NOMEM
;

135561 
mem£t
(
p
, 0, 
nBy‹
);

135563 
	gp
->
	gpFts3Tab
 = (
Fts3TabË
 *)&
p
[1];

135564 
	gp
->
	gpFts3Tab
->
	gzDb
 = (*)&
p
->
pFts3Tab
[1];

135565 
	gp
->
	gpFts3Tab
->
	gzName
 = &
p
->
pFts3Tab
->
zDb
[
nDb
+1];

135566 
	gp
->
	gpFts3Tab
->
	gdb
 = 
db
;

135567 
	gp
->
	gpFts3Tab
->
	gnIndex
 = 1;

135569 
memýy
((*)
p
->
pFts3Tab
->
zDb
, zDb, 
nDb
);

135570 
memýy
((*)
p
->
pFts3Tab
->
zName
, 
zFts3
, 
nFts3
);

135571 
sql™e3Fts3DequÙe
((*)
p
->
pFts3Tab
->
zName
);

135573 *
	gµVb
 = (
sql™e3_vb
 *)
p
;

135574  
	gSQLITE_OK
;

135576 
	gbad_¬gs
:

135577 *
pzE¼
 = 
sql™e3_m´štf
("invalid‡rgumentso fts4aux constructor");

135578  
	gSQLITE_ERROR
;

135586 
ás3auxDiscÚÃùM‘hod
(
sql™e3_vb
 *
pVb
){

135587 
Fts3auxTabË
 *
	gp
 = (Fts3auxTabË *)
pVb
;

135588 
Fts3TabË
 *
	gpFts3
 = 
p
->
pFts3Tab
;

135589 
	gi
;

135592 
	gi
=0; i<
SizeofA¼ay
(
pFts3
->
aStmt
); i++){

135593 
sql™e3_fš®ize
(
pFts3
->
aStmt
[
i
]);

135595 
sql™e3_ä“
(
pFts3
->
zSegm’tsTbl
);

135596 
sql™e3_ä“
(
p
);

135597  
	gSQLITE_OK
;

135600 
	#FTS4AUX_EQ_CONSTRAINT
 1

	)

135601 
	#FTS4AUX_GE_CONSTRAINT
 2

	)

135602 
	#FTS4AUX_LE_CONSTRAINT
 4

	)

135607 
ás3auxBe¡IndexM‘hod
(

135608 
sql™e3_vb
 *
pVTab
,

135609 
sql™e3_šdex_šfo
 *
pInfo


135611 
	gi
;

135612 
	giEq
 = -1;

135613 
	giGe
 = -1;

135614 
	giLe
 = -1;

135615 
	giLªgid
 = -1;

135616 
	giNext
 = 1;

135618 
UNUSED_PARAMETER
(
pVTab
);

135621 ifÐ
	gpInfo
->
	gnOrd”By
==1

135622 && 
pInfo
->
aOrd”By
[0].
iCÞumn
==0

135623 && 
pInfo
->
aOrd”By
[0].
desc
==0

135625 
pInfo
->
Üd”ByCÚsumed
 = 1;

135630 
	gi
=0; i<
	gpInfo
->
	gnCÚ¡¿št
; i++){

135631 ifÐ
	gpInfo
->
	gaCÚ¡¿št
[
i
].
	gu§bË
 ){

135632 
	gÝ
 = 
pInfo
->
aCÚ¡¿št
[
i
].
Ý
;

135633 
	giCÞ
 = 
pInfo
->
aCÚ¡¿št
[
i
].
iCÞumn
;

135635 ifÐ
	giCÞ
==0 ){

135636 ifÐ
Ý
==
SQLITE_INDEX_CONSTRAINT_EQ
 ) 
iEq
 = 
i
;

135637 ifÐ
	gÝ
==
SQLITE_INDEX_CONSTRAINT_LT
 ) 
iLe
 = 
i
;

135638 ifÐ
	gÝ
==
SQLITE_INDEX_CONSTRAINT_LE
 ) 
iLe
 = 
i
;

135639 ifÐ
	gÝ
==
SQLITE_INDEX_CONSTRAINT_GT
 ) 
iGe
 = 
i
;

135640 ifÐ
	gÝ
==
SQLITE_INDEX_CONSTRAINT_GE
 ) 
iGe
 = 
i
;

135642 ifÐ
	giCÞ
==4 ){

135643 ifÐ
Ý
==
SQLITE_INDEX_CONSTRAINT_EQ
 ) 
iLªgid
 = 
i
;

135648 ifÐ
	giEq
>=0 ){

135649 
pInfo
->
idxNum
 = 
FTS4AUX_EQ_CONSTRAINT
;

135650 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iEq
].
	g¬gvIndex
 = 
iNext
++;

135651 
	gpInfo
->
	ge¡im©edCo¡
 = 5;

135653 
	gpInfo
->
	gidxNum
 = 0;

135654 
	gpInfo
->
	ge¡im©edCo¡
 = 20000;

135655 ifÐ
	giGe
>=0 ){

135656 
pInfo
->
idxNum
 +ð
FTS4AUX_GE_CONSTRAINT
;

135657 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iGe
].
	g¬gvIndex
 = 
iNext
++;

135658 
	gpInfo
->
	ge¡im©edCo¡
 /= 2;

135660 ifÐ
	giLe
>=0 ){

135661 
pInfo
->
idxNum
 +ð
FTS4AUX_LE_CONSTRAINT
;

135662 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
iLe
].
	g¬gvIndex
 = 
iNext
++;

135663 
	gpInfo
->
	ge¡im©edCo¡
 /= 2;

135666 ifÐ
	giLªgid
>=0 ){

135667 
pInfo
->
aCÚ¡¿štU§ge
[
iLªgid
].
¬gvIndex
 = 
iNext
++;

135668 
	gpInfo
->
	ge¡im©edCo¡
--;

135671  
	gSQLITE_OK
;

135677 
ás3auxO³nM‘hod
(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µC¤
){

135678 
Fts3auxCursÜ
 *
	gpC¤
;

135680 
UNUSED_PARAMETER
(
pVTab
);

135682 
	gpC¤
 = (
Fts3auxCursÜ
 *)
sql™e3_m®loc
((Fts3auxCursor));

135683 ifÐ!
	gpC¤
 )  
	gSQLITE_NOMEM
;

135684 
mem£t
(
pC¤
, 0, (
Fts3auxCursÜ
));

135686 *
	gµC¤
 = (
sql™e3_vb_cursÜ
 *)
pC¤
;

135687  
	gSQLITE_OK
;

135693 
ás3auxClo£M‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

135694 
Fts3TabË
 *
	gpFts3
 = ((
Fts3auxTabË
 *)
pCursÜ
->
pVb
)->
pFts3Tab
;

135695 
Fts3auxCursÜ
 *
	gpC¤
 = (Fts3auxCursÜ *)
pCursÜ
;

135697 
sql™e3Fts3Segm’tsClo£
(
pFts3
);

135698 
sql™e3Fts3SegR—d”Fšish
(&
pC¤
->
c¤
);

135699 
sql™e3_ä“
((*)
pC¤
->
fž‹r
.
zT”m
);

135700 
sql™e3_ä“
(
pC¤
->
zStÝ
);

135701 
sql™e3_ä“
(
pC¤
->
aSt
);

135702 
sql™e3_ä“
(
pC¤
);

135703  
	gSQLITE_OK
;

135706 
ás3auxGrowStA¼ay
(
Fts3auxCursÜ
 *
pC¤
, 
nSize
){

135707 ifÐ
	gnSize
>
	gpC¤
->
	gnSt
 ){

135708 
Fts3auxCÞ¡©s
 *
	gaNew
;

135709 
	gaNew
 = (
Fts3auxCÞ¡©s
 *)
sql™e3_»®loc
(
pC¤
->
aSt
,

135710 (
Fts3auxCÞ¡©s
è* 
nSize


135712 ifÐ
	gaNew
==0 )  
SQLITE_NOMEM
;

135713 
mem£t
(&
aNew
[
pC¤
->
nSt
], 0,

135714 (
Fts3auxCÞ¡©s
è* (
nSize
 - 
pC¤
->
nSt
)

135716 
	gpC¤
->
	gaSt
 = 
aNew
;

135717 
	gpC¤
->
	gnSt
 = 
nSize
;

135719  
	gSQLITE_OK
;

135725 
ás3auxNextM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

135726 
Fts3auxCursÜ
 *
	gpC¤
 = (Fts3auxCursÜ *)
pCursÜ
;

135727 
Fts3TabË
 *
	gpFts3
 = ((
Fts3auxTabË
 *)
pCursÜ
->
pVb
)->
pFts3Tab
;

135728 
	grc
;

135731 
	gpC¤
->
	giRowid
++;

135733 
	gpC¤
->
	giCÞ
++;…C¤->iCÞ<pC¤->
	gnSt
;…Csr->iCol++){

135734 ifÐ
	gpC¤
->
	gaSt
[
pC¤
->
iCÞ
].
	gnDoc
>0 )  
	gSQLITE_OK
;

135737 
	grc
 = 
sql™e3Fts3SegR—d”S‹p
(
pFts3
, &
pC¤
->
c¤
);

135738 ifÐ
	grc
==
SQLITE_ROW
 ){

135739 
i
 = 0;

135740 
	gnDoþi¡
 = 
pC¤
->
c¤
.
nDoþi¡
;

135741 *
	gaDoþi¡
 = 
pC¤
->
c¤
.
aDoþi¡
;

135742 
	giCÞ
;

135744 
	geS‹
 = 0;

135746 ifÐ
	gpC¤
->
	gzStÝ
 ){

135747 
	gn
 = (
pC¤
->
nStÝ
<pC¤->
c¤
.
nT”m
) ?…Csr->nStop :…Csr->csr.nTerm;

135748 
	gmc
 = 
memcmp
(
pC¤
->
zStÝ
,…C¤->
c¤
.
zT”m
, 
n
);

135749 ifÐ
	gmc
<0 || (mc==0 && 
pC¤
->
c¤
.
nT”m
>pC¤->
nStÝ
) ){

135750 
pC¤
->
isEof
 = 1;

135751  
	gSQLITE_OK
;

135755 ifÐ
ás3auxGrowStA¼ay
(
pC¤
, 2èè 
	gSQLITE_NOMEM
;

135756 
mem£t
(
pC¤
->
aSt
, 0, (
Fts3auxCÞ¡©s
è*…C¤->
nSt
);

135757 
	giCÞ
 = 0;

135759  
	gi
<
	gnDoþi¡
 ){

135760 
sql™e3_št64
 
	gv
 = 0;

135762 
	gi
 +ð
sql™e3Fts3G‘V¬št
(&
aDoþi¡
[
i
], &
v
);

135763  
	geS‹
 ){

135766 
pC¤
->
aSt
[0].
nDoc
++;

135767 
	geS‹
 = 1;

135768 
	giCÞ
 = 0;

135780 
as£¹
Ð
iCÞ
==0 );

135781 ifÐ
	gv
>1 ){

135782 
	gpC¤
->
	gaSt
[1].
	gnDoc
++;

135784 
	geS‹
 = 2;

135788 ifÐ
v
==0 ){

135789 
eS‹
 = 0;

135790 }ifÐ
	gv
==1 ){

135791 
eS‹
 = 3;

135793 
	gpC¤
->
	gaSt
[
iCÞ
+1].
	gnOcc
++;

135794 
	gpC¤
->
	gaSt
[0].
	gnOcc
++;

135799 : 
as£¹
Ð
eS‹
==3 );

135800 
	giCÞ
 = ()
v
;

135801 ifÐ
ás3auxGrowStA¼ay
(
pC¤
, 
iCÞ
+2èè 
	gSQLITE_NOMEM
;

135802 
	gpC¤
->
	gaSt
[
iCÞ
+1].
	gnDoc
++;

135803 
	geS‹
 = 2;

135808 
	gpC¤
->
	giCÞ
 = 0;

135809 
	grc
 = 
SQLITE_OK
;

135811 
	gpC¤
->
	gisEof
 = 1;

135813  
	grc
;

135819 
ás3auxFž‹rM‘hod
(

135820 
sql™e3_vb_cursÜ
 *
pCursÜ
,

135821 
idxNum
,

135822 cÚ¡ *
idxSŒ
,

135823 
nV®
,

135824 
sql™e3_v®ue
 **
­V®


135826 
Fts3auxCursÜ
 *
	gpC¤
 = (Fts3auxCursÜ *)
pCursÜ
;

135827 
Fts3TabË
 *
	gpFts3
 = ((
Fts3auxTabË
 *)
pCursÜ
->
pVb
)->
pFts3Tab
;

135828 
	grc
;

135829 
	gisSÿn
 = 0;

135830 
	giLªgV®
 = 0;

135832 
	giEq
 = -1;

135833 
	giGe
 = -1;

135834 
	giLe
 = -1;

135835 
	giLªgid
 = -1;

135836 
	giNext
 = 0;

135838 
UNUSED_PARAMETER
(
nV®
);

135839 
UNUSED_PARAMETER
(
idxSŒ
);

135841 
as£¹
Ð
idxSŒ
==0 );

135842 
as£¹
Ð
idxNum
==
FTS4AUX_EQ_CONSTRAINT
 || idxNum==0

135843 || 
idxNum
==
FTS4AUX_LE_CONSTRAINT
 || idxNum==
FTS4AUX_GE_CONSTRAINT


135844 || 
idxNum
==(
FTS4AUX_LE_CONSTRAINT
|
FTS4AUX_GE_CONSTRAINT
)

135847 ifÐ
	gidxNum
==
FTS4AUX_EQ_CONSTRAINT
 ){

135848 
iEq
 = 
iNext
++;

135850 
	gisSÿn
 = 1;

135851 ifÐ
	gidxNum
 & 
	gFTS4AUX_GE_CONSTRAINT
 ){

135852 
	giGe
 = 
iNext
++;

135854 ifÐ
	gidxNum
 & 
	gFTS4AUX_LE_CONSTRAINT
 ){

135855 
	giLe
 = 
iNext
++;

135858 ifÐ
	giNext
<
	gnV®
 ){

135859 
	giLªgid
 = 
iNext
++;

135863 
‹¡ÿ£
(
pC¤
->
fž‹r
.
zT”m
);

135864 
sql™e3Fts3SegR—d”Fšish
(&
pC¤
->
c¤
);

135865 
sql™e3_ä“
((*)
pC¤
->
fž‹r
.
zT”m
);

135866 
sql™e3_ä“
(
pC¤
->
aSt
);

135867 
mem£t
(&
pC¤
->
c¤
, 0, ((
u8
*)&pCsr[1]) - (u8*)&pCsr->csr);

135869 
	gpC¤
->
	gfž‹r
.
	gæags
 = 
FTS3_SEGMENT_REQUIRE_POS
|
FTS3_SEGMENT_IGNORE_EMPTY
;

135870 ifÐ
	gisSÿn
 ) 
	gpC¤
->
	gfž‹r
.
	gæags
 |ð
FTS3_SEGMENT_SCAN
;

135872 ifÐ
	giEq
>=0 || 
iGe
>=0 ){

135873 cÚ¡ *
zSŒ
 = 
sql™e3_v®ue_‹xt
(
­V®
[0]);

135874 
as£¹
Ð(
iEq
==0 && 
iGe
==-1) || (iEq==-1 && iGe==0) );

135875 ifÐ
	gzSŒ
 ){

135876 
	gpC¤
->
	gfž‹r
.
	gzT”m
 = 
sql™e3_m´štf
("%s", 
zSŒ
);

135877 
	gpC¤
->
	gfž‹r
.
	gnT”m
 = 
sql™e3_v®ue_by‹s
(
­V®
[0]);

135878 ifÐ
	gpC¤
->
	gfž‹r
.
	gzT”m
==0 )  
SQLITE_NOMEM
;

135882 ifÐ
	giLe
>=0 ){

135883 
pC¤
->
zStÝ
 = 
sql™e3_m´štf
("%s", 
sql™e3_v®ue_‹xt
(
­V®
[
iLe
]));

135884 
	gpC¤
->
	gnStÝ
 = 
sql™e3_v®ue_by‹s
(
­V®
[
iLe
]);

135885 ifÐ
	gpC¤
->
	gzStÝ
==0 )  
SQLITE_NOMEM
;

135888 ifÐ
	giLªgid
>=0 ){

135889 
iLªgV®
 = 
sql™e3_v®ue_št
(
­V®
[
iLªgid
]);

135896 ifÐ
	giLªgV®
<0 ) iLangVal = 0;

135898 
	gpC¤
->
	giLªgid
 = 
iLªgV®
;

135900 
	grc
 = 
sql™e3Fts3SegR—d”CursÜ
(
pFts3
, 
iLªgV®
, 0, 
FTS3_SEGCURSOR_ALL
,

135901 
pC¤
->
fž‹r
.
zT”m
,…C¤->fž‹r.
nT”m
, 0, 
isSÿn
, &pC¤->
c¤


135903 ifÐ
	grc
==
SQLITE_OK
 ){

135904 
rc
 = 
sql™e3Fts3SegR—d”S¹
(
pFts3
, &
pC¤
->
c¤
, &pC¤->
fž‹r
);

135907 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
ás3auxNextM‘hod
(
pCursÜ
);

135908  
	grc
;

135914 
ás3auxEofM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

135915 
Fts3auxCursÜ
 *
	gpC¤
 = (Fts3auxCursÜ *)
pCursÜ
;

135916  
	gpC¤
->
	gisEof
;

135922 
ás3auxCÞumnM‘hod
(

135923 
sql™e3_vb_cursÜ
 *
pCursÜ
,

135924 
sql™e3_cÚ‹xt
 *
pCtx
,

135925 
iCÞ


135927 
Fts3auxCursÜ
 *
	gp
 = (Fts3auxCursÜ *)
pCursÜ
;

135929 
as£¹
Ð
p
->
isEof
==0 );

135930  
	giCÞ
 ){

135932 
sql™e3_»suÉ_‹xt
(
pCtx
, 
p
->
c¤
.
zT”m
,…->c¤.
nT”m
, 
SQLITE_TRANSIENT
);

135936 ifÐ
p
->
iCÞ
 ){

135937 
sql™e3_»suÉ_št
(
pCtx
, 
p
->
iCÞ
-1);

135939 
sql™e3_»suÉ_‹xt
(
pCtx
, "*", -1, 
SQLITE_STATIC
);

135944 
sql™e3_»suÉ_št64
(
pCtx
, 
p
->
aSt
[p->
iCÞ
].
nDoc
);

135948 
sql™e3_»suÉ_št64
(
pCtx
, 
p
->
aSt
[p->
iCÞ
].
nOcc
);

135952 
as£¹
Ð
iCÞ
==4 );

135953 
sql™e3_»suÉ_št
(
pCtx
, 
p
->
iLªgid
);

135957  
	gSQLITE_OK
;

135963 
ás3auxRowidM‘hod
(

135964 
sql™e3_vb_cursÜ
 *
pCursÜ
,

135965 
sql™e_št64
 *
pRowid


135967 
Fts3auxCursÜ
 *
	gpC¤
 = (Fts3auxCursÜ *)
pCursÜ
;

135968 *
	gpRowid
 = 
pC¤
->
iRowid
;

135969  
	gSQLITE_OK
;

135976 
SQLITE_PRIVATE
 
sql™e3Fts3In™Aux
(
sql™e3
 *
db
){

135977 cÚ¡ 
sql™e3_moduË
 
	gás3aux_moduË
 = {

135979 
ás3auxCÚÃùM‘hod
,

135980 
ás3auxCÚÃùM‘hod
,

135981 
ás3auxBe¡IndexM‘hod
,

135982 
ás3auxDiscÚÃùM‘hod
,

135983 
ás3auxDiscÚÃùM‘hod
,

135984 
ás3auxO³nM‘hod
,

135985 
ás3auxClo£M‘hod
,

135986 
ás3auxFž‹rM‘hod
,

135987 
ás3auxNextM‘hod
,

135988 
ás3auxEofM‘hod
,

135989 
ás3auxCÞumnM‘hod
,

135990 
ás3auxRowidM‘hod
,

136002 
	grc
;

136004 
	grc
 = 
sql™e3_ü—‹_moduË
(
db
, "ás4aux", &
ás3aux_moduË
, 0);

136005  
	grc
;

136029 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

136076 #ifdeà
SQLITE_TEST


136077 
SQLITE_API
 
	gsql™e3_ás3_’abË_·»Áhe£s
 = 0;

136079 #ifdeà
SQLITE_ENABLE_FTS3_PARENTHESIS


136080 
	#sql™e3_ás3_’abË_·»Áhe£s
 1

	)

136082 
	#sql™e3_ás3_’abË_·»Áhe£s
 0

	)

136089 
	#SQLITE_FTS3_DEFAULT_NEAR_PARAM
 10

	)

136102 
P¬£CÚ‹xt
 
	tP¬£CÚ‹xt
;

136103 
	sP¬£CÚ‹xt
 {

136104 
sql™e3_tok’iz”
 *
	gpTok’iz”
;

136105 
	giLªgid
;

136106 cÚ¡ **
	gazCÞ
;

136107 
	gbFts4
;

136108 
	gnCÞ
;

136109 
	giDeçuÉCÞ
;

136110 
	gisNÙ
;

136111 
sql™e3_cÚ‹xt
 *
	gpCtx
;

136112 
	gnNe¡
;

136126 
ás3is¥aû
(
c
){

136127  
	gc
==' ' || 
c
=='\t' || c=='\n' || c=='\r' || c=='\v' || c=='\f';

136135 *
ás3M®locZ”o
(
nBy‹
){

136136 *
	gpR‘
 = 
sql™e3_m®loc
(
nBy‹
);

136137 ifÐ
	gpR‘
 ) 
mem£t
(
pR‘
, 0, 
nBy‹
);

136138  
	gpR‘
;

136141 
SQLITE_PRIVATE
 
sql™e3Fts3O³nTok’iz”
(

136142 
sql™e3_tok’iz”
 *
pTok’iz”
,

136143 
iLªgid
,

136144 cÚ¡ *
z
,

136145 
n
,

136146 
sql™e3_tok’iz”_cursÜ
 **
µC¤


136148 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 
pTok’iz”
->
pModuË
;

136149 
sql™e3_tok’iz”_cursÜ
 *
	gpC¤
 = 0;

136150 
	grc
;

136152 
	grc
 = 
pModuË
->
xO³n
(
pTok’iz”
, 
z
, 
n
, &
pC¤
);

136153 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pC¤
==0 );

136154 ifÐ
	grc
==
SQLITE_OK
 ){

136155 
pC¤
->
pTok’iz”
 =…Tokenizer;

136156 ifÐ
	gpModuË
->
	giV”siÚ
>=1 ){

136157 
rc
 = 
pModuË
->
xLªguageid
(
pC¤
, 
iLªgid
);

136158 ifÐ
	grc
!=
SQLITE_OK
 ){

136159 
pModuË
->
xClo£
(
pC¤
);

136160 
	gpC¤
 = 0;

136164 *
	gµC¤
 = 
pC¤
;

136165  
	grc
;

136172 
ás3Ex´P¬£
(
P¬£CÚ‹xt
 *, cÚ¡ *, , 
Fts3Ex´
 **, *);

136186 
g‘NextTok’
(

136187 
P¬£CÚ‹xt
 *
pP¬£
,

136188 
iCÞ
,

136189 cÚ¡ *
z
, 
n
,

136190 
Fts3Ex´
 **
µEx´
,

136191 *
²CÚsumed


136193 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 
pP¬£
->
pTok’iz”
;

136194 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 
pTok’iz”
->
pModuË
;

136195 
	grc
;

136196 
sql™e3_tok’iz”_cursÜ
 *
	gpCursÜ
;

136197 
Fts3Ex´
 *
	gpR‘
 = 0;

136198 
	gi
 = 0;

136201 
	gi
=0; i<
	gn
; i++){

136202 ifÐ
	gsql™e3_ás3_’abË_·»Áhe£s
 && (
	gz
[
i
]=='(' || 
z
[i]==')') ) ;

136203 ifÐ
	gz
[
i
]=='"' ) ;

136206 *
	g²CÚsumed
 = 
i
;

136207 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pTok’iz”
, 
pP¬£
->
iLªgid
, 
z
, 
i
, &
pCursÜ
);

136208 ifÐ
	grc
==
SQLITE_OK
 ){

136209 cÚ¡ *
zTok’
;

136210 
	gnTok’
 = 0, 
	giS¹
 = 0, 
	giEnd
 = 0, 
	giPos™iÚ
 = 0;

136211 
	gnBy‹
;

136213 
	grc
 = 
pModuË
->
xNext
(
pCursÜ
, &
zTok’
, &
nTok’
, &
iS¹
, &
iEnd
, &
iPos™iÚ
);

136214 ifÐ
	grc
==
SQLITE_OK
 ){

136215 
nBy‹
 = (
Fts3Ex´
è+ (
Fts3Ph¿£
è+ 
nTok’
;

136216 
	gpR‘
 = (
Fts3Ex´
 *)
ás3M®locZ”o
(
nBy‹
);

136217 ifÐ!
	gpR‘
 ){

136218 
	grc
 = 
SQLITE_NOMEM
;

136220 
	gpR‘
->
	geTy³
 = 
FTSQUERY_PHRASE
;

136221 
	gpR‘
->
	gpPh¿£
 = (
Fts3Ph¿£
 *)&
pR‘
[1];

136222 
	gpR‘
->
	gpPh¿£
->
	gnTok’
 = 1;

136223 
	gpR‘
->
	gpPh¿£
->
	giCÞumn
 = 
iCÞ
;

136224 
	gpR‘
->
	gpPh¿£
->
	gaTok’
[0].
	gn
 = 
nTok’
;

136225 
	gpR‘
->
	gpPh¿£
->
	gaTok’
[0].
	gz
 = (*)&
pR‘
->
pPh¿£
[1];

136226 
memýy
(
pR‘
->
pPh¿£
->
aTok’
[0].
z
, 
zTok’
, 
nTok’
);

136228 ifÐ
	giEnd
<
	gn
 && 
	gz
[
iEnd
]=='*' ){

136229 
pR‘
->
pPh¿£
->
aTok’
[0].
isP»fix
 = 1;

136230 
	giEnd
++;

136234 ifÐ!
	gsql™e3_ás3_’abË_·»Áhe£s


136235 && 
	giS¹
>0 && 
	gz
[
iS¹
-1]=='-'

136237 
pP¬£
->
isNÙ
 = 1;

136238 
	giS¹
--;

136239 }ifÐ
	gpP¬£
->
	gbFts4
 && 
	giS¹
>0 && 
	gz
[
iS¹
-1]=='^' ){

136240 
pR‘
->
pPh¿£
->
aTok’
[0].
bFœ¡
 = 1;

136241 
	giS¹
--;

136248 *
	g²CÚsumed
 = 
iEnd
;

136249 }ifÐ
	gi
 && 
	grc
==
SQLITE_DONE
 ){

136250 
rc
 = 
SQLITE_OK
;

136253 
	gpModuË
->
xClo£
(
pCursÜ
);

136256 *
	gµEx´
 = 
pR‘
;

136257  
	grc
;

136265 *
ás3R—ÎocOrF»e
(*
pOrig
, 
nNew
){

136266 *
	gpR‘
 = 
sql™e3_»®loc
(
pOrig
, 
nNew
);

136267 ifÐ!
	gpR‘
 ){

136268 
sql™e3_ä“
(
pOrig
);

136270  
	gpR‘
;

136285 
g‘NextSŒšg
(

136286 
P¬£CÚ‹xt
 *
pP¬£
,

136287 cÚ¡ *
zIÅut
, 
nIÅut
,

136288 
Fts3Ex´
 **
µEx´


136290 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 
pP¬£
->
pTok’iz”
;

136291 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 
pTok’iz”
->
pModuË
;

136292 
	grc
;

136293 
Fts3Ex´
 *
	gp
 = 0;

136294 
sql™e3_tok’iz”_cursÜ
 *
	gpCursÜ
 = 0;

136295 *
	gzTemp
 = 0;

136296 
	gnTemp
 = 0;

136298 cÚ¡ 
	gnS·û
 = (
Fts3Ex´
è+ (
Fts3Ph¿£
);

136299 
	gnTok’
 = 0;

136320 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(

136321 
pTok’iz”
, 
pP¬£
->
iLªgid
, 
zIÅut
, 
nIÅut
, &
pCursÜ
);

136322 ifÐ
	grc
==
SQLITE_OK
 ){

136323 
ii
;

136324 
	gii
=0; 
	grc
==
SQLITE_OK
; ii++){

136325 cÚ¡ *
	gzBy‹
;

136326 
	gnBy‹
 = 0, 
	giBegš
 = 0, 
	giEnd
 = 0, 
	giPos
 = 0;

136327 
	grc
 = 
pModuË
->
xNext
(
pCursÜ
, &
zBy‹
, &
nBy‹
, &
iBegš
, &
iEnd
, &
iPos
);

136328 ifÐ
	grc
==
SQLITE_OK
 ){

136329 
Fts3Ph¿£Tok’
 *
pTok’
;

136331 
	gp
 = 
ás3R—ÎocOrF»e
(
p
, 
nS·û
 + 
ii
*(
Fts3Ph¿£Tok’
));

136332 ifÐ!
	gp
 ) 
	gno_mem
;

136334 
	gzTemp
 = 
ás3R—ÎocOrF»e
(
zTemp
, 
nTemp
 + 
nBy‹
);

136335 ifÐ!
	gzTemp
 ) 
	gno_mem
;

136337 
as£¹
Ð
nTok’
==
ii
 );

136338 
	gpTok’
 = &((
Fts3Ph¿£
 *)(&
p
[1]))->
aTok’
[
ii
];

136339 
mem£t
(
pTok’
, 0, (
Fts3Ph¿£Tok’
));

136341 
memýy
(&
zTemp
[
nTemp
], 
zBy‹
, 
nBy‹
);

136342 
	gnTemp
 +ð
nBy‹
;

136344 
	gpTok’
->
	gn
 = 
nBy‹
;

136345 
	gpTok’
->
	gisP»fix
 = (
iEnd
<
nIÅut
 && 
zIÅut
[iEnd]=='*');

136346 
	gpTok’
->
	gbFœ¡
 = (
iBegš
>0 && 
zIÅut
[iBegin-1]=='^');

136347 
	gnTok’
 = 
ii
+1;

136351 
	gpModuË
->
xClo£
(
pCursÜ
);

136352 
	gpCursÜ
 = 0;

136355 ifÐ
	grc
==
SQLITE_DONE
 ){

136356 
jj
;

136357 *
	gzBuf
 = 0;

136359 
	gp
 = 
ás3R—ÎocOrF»e
(
p
, 
nS·û
 + 
nTok’
*(
Fts3Ph¿£Tok’
è+ 
nTemp
);

136360 ifÐ!
	gp
 ) 
	gno_mem
;

136361 
mem£t
(
p
, 0, (*)&(((
Fts3Ph¿£
 *)&p[1])->
aTok’
[0])-(*)p);

136362 
	gp
->
	geTy³
 = 
FTSQUERY_PHRASE
;

136363 
	gp
->
	gpPh¿£
 = (
Fts3Ph¿£
 *)&
p
[1];

136364 
	gp
->
	gpPh¿£
->
	giCÞumn
 = 
pP¬£
->
iDeçuÉCÞ
;

136365 
	gp
->
	gpPh¿£
->
	gnTok’
 = 
nTok’
;

136367 
	gzBuf
 = (*)&
p
->
pPh¿£
->
aTok’
[
nTok’
];

136368 ifÐ
	gzTemp
 ){

136369 
memýy
(
zBuf
, 
zTemp
, 
nTemp
);

136370 
sql™e3_ä“
(
zTemp
);

136372 
as£¹
Ð
nTemp
==0 );

136375 
	gjj
=0; jj<
	gp
->
	gpPh¿£
->
	gnTok’
; jj++){

136376 
	gp
->
	gpPh¿£
->
	gaTok’
[
jj
].
	gz
 = 
zBuf
;

136377 
	gzBuf
 +ð
p
->
pPh¿£
->
aTok’
[
jj
].
n
;

136379 
	grc
 = 
SQLITE_OK
;

136382 *
	gµEx´
 = 
p
;

136383  
	grc
;

136384 
	gno_mem
:

136386 ifÐ
pCursÜ
 ){

136387 
pModuË
->
xClo£
(
pCursÜ
);

136389 
sql™e3_ä“
(
zTemp
);

136390 
sql™e3_ä“
(
p
);

136391 *
	gµEx´
 = 0;

136392  
	gSQLITE_NOMEM
;

136403 
g‘NextNode
(

136404 
P¬£CÚ‹xt
 *
pP¬£
,

136405 cÚ¡ *
z
, 
n
,

136406 
Fts3Ex´
 **
µEx´
,

136407 *
²CÚsumed


136409 cÚ¡ 
	sFts3KeywÜd
 {

136410 *
	gz
;

136411 
	gn
;

136412 
	g·»nOÆy
;

136413 
	geTy³
;

136414 } 
	gaKeywÜd
[] = {

136415 { "OR" , 2, 0, 
FTSQUERY_OR
 },

136416 { "AND", 3, 1, 
FTSQUERY_AND
 },

136417 { "NOT", 3, 1, 
FTSQUERY_NOT
 },

136418 { "NEAR", 4, 0, 
FTSQUERY_NEAR
 }

136420 
	gii
;

136421 
	giCÞ
;

136422 
	giCÞL’
;

136423 
	grc
;

136424 
Fts3Ex´
 *
	gpR‘
 = 0;

136426 cÚ¡ *
	gzIÅut
 = 
z
;

136427 
	gnIÅut
 = 
n
;

136429 
	gpP¬£
->
	gisNÙ
 = 0;

136434  
	gnIÅut
>0 && 
ás3is¥aû
(*
zIÅut
) ){

136435 
	gnIÅut
--;

136436 
	gzIÅut
++;

136438 ifÐ
	gnIÅut
==0 ){

136439  
SQLITE_DONE
;

136443 
	gii
=0; ii<()((
	gaKeywÜd
)/(
	gFts3KeywÜd
)); ii++){

136444 cÚ¡ 
Fts3KeywÜd
 *
	gpKey
 = &
aKeywÜd
[
ii
];

136446 ifÐ(
	gpKey
->
	g·»nOÆy
 & ~
	gsql™e3_ás3_’abË_·»Áhe£s
)!=0 ){

136450 ifÐ
	gnIÅut
>=
pKey
->
n
 && 0==
memcmp
(
zIÅut
,…Key->
z
,…Key->n) ){

136451 
	gnN—r
 = 
SQLITE_FTS3_DEFAULT_NEAR_PARAM
;

136452 
	gnKey
 = 
pKey
->
n
;

136453 
	gcNext
;

136456 ifÐ
	gpKey
->
	geTy³
==
FTSQUERY_NEAR
 ){

136457 
as£¹
Ð
nKey
==4 );

136458 ifÐ
	gzIÅut
[4]=='/' && 
zIÅut
[5]>='0' && zInput[5]<='9' ){

136459 
nN—r
 = 0;

136460 
	gnKey
=5; 
	gzIÅut
[
nKey
]>='0' && 
zIÅut
[nKey]<='9';‚Key++){

136461 
	gnN—r
 = 
nN—r
 * 10 + (
zIÅut
[
nKey
] - '0');

136470 
	gcNext
 = 
zIÅut
[
nKey
];

136471 ifÐ
ás3is¥aû
(
cNext
)

136472 || 
	gcNext
=='"' || 
cNext
=='(' || cNext==')' || cNext==0

136474 
pR‘
 = (
Fts3Ex´
 *)
ás3M®locZ”o
((Fts3Expr));

136475 ifÐ!
	gpR‘
 ){

136476  
	gSQLITE_NOMEM
;

136478 
	gpR‘
->
	geTy³
 = 
pKey
->
eTy³
;

136479 
	gpR‘
->
	gnN—r
 = 
nN—r
;

136480 *
	gµEx´
 = 
pR‘
;

136481 *
	g²CÚsumed
 = ()((
zIÅut
 - 
z
è+ 
nKey
);

136482  
	gSQLITE_OK
;

136496 ifÐ*
	gzIÅut
=='"' ){

136497 
ii
=1; 
	gii
<
	gnIÅut
 && 
	gzIÅut
[ii]!='"'; ii++);

136498 *
	g²CÚsumed
 = ()((
zIÅut
 - 
z
è+ 
ii
 + 1);

136499 ifÐ
	gii
==
nIÅut
 ){

136500  
SQLITE_ERROR
;

136502  
g‘NextSŒšg
(
pP¬£
, &
zIÅut
[1], 
ii
-1, 
µEx´
);

136505 ifÐ
	gsql™e3_ás3_’abË_·»Áhe£s
 ){

136506 ifÐ*
	gzIÅut
=='(' ){

136507 
nCÚsumed
 = 0;

136508 
	gpP¬£
->
	gnNe¡
++;

136509 
	grc
 = 
ás3Ex´P¬£
(
pP¬£
, 
zIÅut
+1, 
nIÅut
-1, 
µEx´
, &
nCÚsumed
);

136510 ifÐ
	grc
==
SQLITE_OK
 && !*
µEx´
 ){ 
rc
 = 
SQLITE_DONE
; }

136511 *
	g²CÚsumed
 = ()(
zIÅut
 - 
z
è+ 1 + 
nCÚsumed
;

136512  
	grc
;

136513 }ifÐ*
	gzIÅut
==')' ){

136514 
pP¬£
->
nNe¡
--;

136515 *
	g²CÚsumed
 = ()((
zIÅut
 - 
z
) + 1);

136516 *
	gµEx´
 = 0;

136517  
	gSQLITE_DONE
;

136532 
	giCÞ
 = 
pP¬£
->
iDeçuÉCÞ
;

136533 
	giCÞL’
 = 0;

136534 
	gii
=0; ii<
	gpP¬£
->
	gnCÞ
; ii++){

136535 cÚ¡ *
	gzSŒ
 = 
pP¬£
->
azCÞ
[
ii
];

136536 
	gnSŒ
 = ()
¡¾’
(
zSŒ
);

136537 ifÐ
	gnIÅut
>
	gnSŒ
 && 
	gzIÅut
[
nSŒ
]==':'

136538 && 
sql™e3_¡ºicmp
(
zSŒ
, 
zIÅut
, 
nSŒ
)==0

136540 
iCÞ
 = 
ii
;

136541 
	giCÞL’
 = ()((
zIÅut
 - 
z
è+ 
nSŒ
 + 1);

136545 
	grc
 = 
g‘NextTok’
(
pP¬£
, 
iCÞ
, &
z
[
iCÞL’
], 
n
-iCÞL’, 
µEx´
, 
²CÚsumed
);

136546 *
	g²CÚsumed
 +ð
iCÞL’
;

136547  
	grc
;

136569 
ÝP»ûd’û
(
Fts3Ex´
 *
p
){

136570 
as£¹
Ð
p
->
eTy³
!=
FTSQUERY_PHRASE
 );

136571 ifÐ
	gsql™e3_ás3_’abË_·»Áhe£s
 ){

136572  
	gp
->
	geTy³
;

136573 }ifÐ
	gp
->
	geTy³
==
FTSQUERY_NEAR
 ){

136575 }ifÐ
	gp
->
	geTy³
==
FTSQUERY_OR
 ){

136578 
as£¹
Ð
p
->
eTy³
==
FTSQUERY_AND
 );

136590 
š£¹Bš¬yO³¿tÜ
(

136591 
Fts3Ex´
 **
µH—d
,

136592 
Fts3Ex´
 *
pP»v
,

136593 
Fts3Ex´
 *
pNew


136595 
Fts3Ex´
 *
	gpS¶™
 = 
pP»v
;

136596  
	gpS¶™
->
	gpP¬’t
 && 
ÝP»ûd’û
(
pS¶™
->
pP¬’t
)<=ÝP»ûd’û(
pNew
) ){

136597 
pS¶™
 =…S¶™->
pP¬’t
;

136600 ifÐ
	gpS¶™
->
	gpP¬’t
 ){

136601 
as£¹
Ð
pS¶™
->
pP¬’t
->
pRight
==pSplit );

136602 
	gpS¶™
->
	gpP¬’t
->
	gpRight
 = 
pNew
;

136603 
	gpNew
->
	gpP¬’t
 = 
pS¶™
->
pP¬’t
;

136605 *
	gµH—d
 = 
pNew
;

136607 
	gpNew
->
	gpLeá
 = 
pS¶™
;

136608 
	gpS¶™
->
	gpP¬’t
 = 
pNew
;

136621 
ás3Ex´P¬£
(

136622 
P¬£CÚ‹xt
 *
pP¬£
,

136623 cÚ¡ *
z
, 
n
,

136624 
Fts3Ex´
 **
µEx´
,

136625 *
²CÚsumed


136627 
Fts3Ex´
 *
	gpR‘
 = 0;

136628 
Fts3Ex´
 *
	gpP»v
 = 0;

136629 
Fts3Ex´
 *
	gpNÙB¿nch
 = 0;

136630 
	gnIn
 = 
n
;

136631 cÚ¡ *
	gzIn
 = 
z
;

136632 
	grc
 = 
SQLITE_OK
;

136633 
	gisRequœePh¿£
 = 1;

136635  
	grc
==
SQLITE_OK
 ){

136636 
Fts3Ex´
 *
p
 = 0;

136637 
	gnBy‹
 = 0;

136639 
	grc
 = 
g‘NextNode
(
pP¬£
, 
zIn
, 
nIn
, &
p
, &
nBy‹
);

136640 
as£¹
Ð
nBy‹
>0 || (
rc
!=
SQLITE_OK
 && 
p
==0) );

136641 ifÐ
	grc
==
SQLITE_OK
 ){

136642 ifÐ
p
 ){

136643 
isPh¿£
;

136645 ifÐ!
	gsql™e3_ás3_’abË_·»Áhe£s


136646 && 
	gp
->
	geTy³
==
FTSQUERY_PHRASE
 && 
pP¬£
->
isNÙ


136649 
Fts3Ex´
 *
pNÙ
 = 
ás3M®locZ”o
((Fts3Expr));

136650 ifÐ!
	gpNÙ
 ){

136651 
sql™e3Fts3Ex´F»e
(
p
);

136652 
	grc
 = 
SQLITE_NOMEM
;

136653 
	gex´·r£_out
;

136655 
	gpNÙ
->
	geTy³
 = 
FTSQUERY_NOT
;

136656 
	gpNÙ
->
	gpRight
 = 
p
;

136657 
	gp
->
	gpP¬’t
 = 
pNÙ
;

136658 ifÐ
	gpNÙB¿nch
 ){

136659 
	gpNÙ
->
	gpLeá
 = 
pNÙB¿nch
;

136660 
	gpNÙB¿nch
->
	gpP¬’t
 = 
pNÙ
;

136662 
	gpNÙB¿nch
 = 
pNÙ
;

136663 
	gp
 = 
pP»v
;

136665 
	geTy³
 = 
p
->
eTy³
;

136666 
	gisPh¿£
 = (
eTy³
==
FTSQUERY_PHRASE
 || 
p
->
pLeá
);

136673 ifÐ!
	gisPh¿£
 && 
	gisRequœePh¿£
 ){

136674 
sql™e3Fts3Ex´F»e
(
p
);

136675 
	grc
 = 
SQLITE_ERROR
;

136676 
	gex´·r£_out
;

136679 ifÐ
	gisPh¿£
 && !
	gisRequœePh¿£
 ){

136681 
Fts3Ex´
 *
	gpAnd
;

136682 
as£¹
Ð
pR‘
 && 
pP»v
 );

136683 
	gpAnd
 = 
ás3M®locZ”o
((
Fts3Ex´
));

136684 ifÐ!
	gpAnd
 ){

136685 
sql™e3Fts3Ex´F»e
(
p
);

136686 
	grc
 = 
SQLITE_NOMEM
;

136687 
	gex´·r£_out
;

136689 
	gpAnd
->
	geTy³
 = 
FTSQUERY_AND
;

136690 
š£¹Bš¬yO³¿tÜ
(&
pR‘
, 
pP»v
, 
pAnd
);

136691 
	gpP»v
 = 
pAnd
;

136703 ifÐ
	gpP»v
 && (

136704 (
	geTy³
==
FTSQUERY_NEAR
 && !
isPh¿£
 && 
pP»v
->
eTy³
!=
FTSQUERY_PHRASE
)

136705 || (
eTy³
!=
FTSQUERY_PHRASE
 && 
isPh¿£
 && 
pP»v
->eTy³==
FTSQUERY_NEAR
)

136707 
sql™e3Fts3Ex´F»e
(
p
);

136708 
	grc
 = 
SQLITE_ERROR
;

136709 
	gex´·r£_out
;

136712 ifÐ
	gisPh¿£
 ){

136713 ifÐ
	gpR‘
 ){

136714 
as£¹
Ð
pP»v
 &&…P»v->
pLeá
 &&…P»v->
pRight
==0 );

136715 
	gpP»v
->
	gpRight
 = 
p
;

136716 
	gp
->
	gpP¬’t
 = 
pP»v
;

136718 
	gpR‘
 = 
p
;

136721 
š£¹Bš¬yO³¿tÜ
(&
pR‘
, 
pP»v
, 
p
);

136723 
	gisRequœePh¿£
 = !
isPh¿£
;

136725 
	gpP»v
 = 
p
;

136727 
as£¹
Ð
nBy‹
>0 );

136729 
as£¹
Ð
rc
!=
SQLITE_OK
 || (
nBy‹
>0 &&‚By‹<=
nIn
) );

136730 
	gnIn
 -ð
nBy‹
;

136731 
	gzIn
 +ð
nBy‹
;

136734 ifÐ
	grc
==
SQLITE_DONE
 && 
pR‘
 && 
isRequœePh¿£
 ){

136735 
rc
 = 
SQLITE_ERROR
;

136738 ifÐ
	grc
==
SQLITE_DONE
 ){

136739 
rc
 = 
SQLITE_OK
;

136740 ifÐ!
	gsql™e3_ás3_’abË_·»Áhe£s
 && 
	gpNÙB¿nch
 ){

136741 ifÐ!
	gpR‘
 ){

136742 
	grc
 = 
SQLITE_ERROR
;

136744 
Fts3Ex´
 *
	gpI‹r
 = 
pNÙB¿nch
;

136745  
	gpI‹r
->
	gpLeá
 ){

136746 
	gpI‹r
 = 
pI‹r
->
pLeá
;

136748 
	gpI‹r
->
	gpLeá
 = 
pR‘
;

136749 
	gpR‘
->
	gpP¬’t
 = 
pI‹r
;

136750 
	gpR‘
 = 
pNÙB¿nch
;

136754 *
	g²CÚsumed
 = 
n
 - 
nIn
;

136756 
	gex´·r£_out
:

136757 ifÐ
rc
!=
SQLITE_OK
 ){

136758 
sql™e3Fts3Ex´F»e
(
pR‘
);

136759 
sql™e3Fts3Ex´F»e
(
pNÙB¿nch
);

136760 
	gpR‘
 = 0;

136762 *
	gµEx´
 = 
pR‘
;

136763  
	grc
;

136770 
ás3Ex´CheckD•th
(
Fts3Ex´
 *
p
, 
nMaxD•th
){

136771 
	grc
 = 
SQLITE_OK
;

136772 ifÐ
	gp
 ){

136773 ifÐ
	gnMaxD•th
<0 ){

136774 
	grc
 = 
SQLITE_TOOBIG
;

136776 
	grc
 = 
ás3Ex´CheckD•th
(
p
->
pLeá
, 
nMaxD•th
-1);

136777 ifÐ
	grc
==
SQLITE_OK
 ){

136778 
rc
 = 
ás3Ex´CheckD•th
(
p
->
pRight
, 
nMaxD•th
-1);

136782  
	grc
;

136796 
ás3Ex´B®ªû
(
Fts3Ex´
 **
µ
, 
nMaxD•th
){

136797 
	grc
 = 
SQLITE_OK
;

136798 
Fts3Ex´
 *
	gpRoÙ
 = *
µ
;

136799 
Fts3Ex´
 *
	gpF»e
 = 0;

136800 
	geTy³
 = 
pRoÙ
->
eTy³
;

136802 ifÐ
	gnMaxD•th
==0 ){

136803 
rc
 = 
SQLITE_ERROR
;

136806 ifÐ
	grc
==
SQLITE_OK
 && (
eTy³
==
FTSQUERY_AND
 ||ƒTy³==
FTSQUERY_OR
) ){

136807 
Fts3Ex´
 **
­L—f
;

136808 
	g­L—f
 = (
Fts3Ex´
 **)
sql™e3_m®loc
((Fts3Ex´ *è* 
nMaxD•th
);

136809 ifÐ0==
­L—f
 ){

136810 
rc
 = 
SQLITE_NOMEM
;

136812 
mem£t
(
­L—f
, 0, (
Fts3Ex´
 *è* 
nMaxD•th
);

136815 ifÐ
	grc
==
SQLITE_OK
 ){

136816 
i
;

136817 
Fts3Ex´
 *
	gp
;

136820 
	gp
=
pRoÙ
;…->
	geTy³
==
eTy³
;…=
p
->
pLeá
){

136821 
as£¹
Ð
p
->
pP¬’t
==0 ||…->pP¬’t->
pLeá
==p );

136822 
as£¹
Ð
p
->
pLeá
 &&…->
pRight
 );

136827 
	giLvl
;

136828 
Fts3Ex´
 *
	gpP¬’t
 = 
p
->
pP¬’t
;

136830 
as£¹
Ð
pP¬’t
==0 ||…P¬’t->
pLeá
==
p
 );

136831 
	gp
->
	gpP¬’t
 = 0;

136832 ifÐ
	gpP¬’t
 ){

136833 
	gpP¬’t
->
	gpLeá
 = 0;

136835 
	gpRoÙ
 = 0;

136837 
	grc
 = 
ás3Ex´B®ªû
(&
p
, 
nMaxD•th
-1);

136838 ifÐ
	grc
!=
SQLITE_OK
 ) ;

136840 
	giLvl
=0; 
	gp
 && iLvl<
	gnMaxD•th
; iLvl++){

136841 ifÐ
	g­L—f
[
iLvl
]==0 ){

136842 
­L—f
[
iLvl
] = 
p
;

136843 
	gp
 = 0;

136845 
as£¹
Ð
pF»e
 );

136846 
	gpF»e
->
	gpLeá
 = 
­L—f
[
iLvl
];

136847 
	gpF»e
->
	gpRight
 = 
p
;

136848 
	gpF»e
->
	gpLeá
->
	gpP¬’t
 = 
pF»e
;

136849 
	gpF»e
->
	gpRight
->
	gpP¬’t
 = 
pF»e
;

136851 
	gp
 = 
pF»e
;

136852 
	gpF»e
 = 
pF»e
->
pP¬’t
;

136853 
	gp
->
	gpP¬’t
 = 0;

136854 
	g­L—f
[
iLvl
] = 0;

136857 ifÐ
	gp
 ){

136858 
sql™e3Fts3Ex´F»e
(
p
);

136859 
	grc
 = 
SQLITE_TOOBIG
;

136864 ifÐ
	gpP¬’t
==0 ) ;

136867 
	gp
=
pP¬’t
->
pRight
;…->
	geTy³
==
eTy³
;…=
p
->
pLeá
);

136870 
as£¹
Ð
pP¬’t
->pP¬’t==0 ||…P¬’t->pP¬’t->
pLeá
==pParent );

136871 
	gpP¬’t
->
	gpRight
->pP¬’ˆð
pP¬’t
->pParent;

136872 ifÐ
	gpP¬’t
->pParent ){

136873 
	gpP¬’t
->pP¬’t->
	gpLeá
 = 
pP¬’t
->
pRight
;

136875 
as£¹
Ð
pP¬’t
==
pRoÙ
 );

136876 
	gpRoÙ
 = 
pP¬’t
->
pRight
;

136881 
	gpP¬’t
->pP¬’ˆð
pF»e
;

136882 
	gpF»e
 = 
pP¬’t
;

136885 ifÐ
	grc
==
SQLITE_OK
 ){

136886 
p
 = 0;

136887 
	gi
=0; i<
	gnMaxD•th
; i++){

136888 ifÐ
	g­L—f
[
i
] ){

136889 ifÐ
	gp
==0 ){

136890 
p
 = 
­L—f
[
i
];

136891 
	gp
->
	gpP¬’t
 = 0;

136893 
as£¹
Ð
pF»e
!=0 );

136894 
	gpF»e
->
	gpRight
 = 
p
;

136895 
	gpF»e
->
	gpLeá
 = 
­L—f
[
i
];

136896 
	gpF»e
->
	gpLeá
->
	gpP¬’t
 = 
pF»e
;

136897 
	gpF»e
->
	gpRight
->
	gpP¬’t
 = 
pF»e
;

136899 
	gp
 = 
pF»e
;

136900 
	gpF»e
 = 
pF»e
->
pP¬’t
;

136901 
	gp
->
	gpP¬’t
 = 0;

136905 
	gpRoÙ
 = 
p
;

136910 
Fts3Ex´
 *
	gpD–
;

136911 
	gi
=0; i<
	gnMaxD•th
; i++){

136912 
sql™e3Fts3Ex´F»e
(
­L—f
[
i
]);

136914  (
	gpD–
=
pF»e
)!=0 ){

136915 
pF»e
 = 
pD–
->
pP¬’t
;

136916 
sql™e3_ä“
(
pD–
);

136920 
as£¹
Ð
pF»e
==0 );

136921 
sql™e3_ä“
Ð
­L—f
 );

136925 ifÐ
	grc
!=
SQLITE_OK
 ){

136926 
sql™e3Fts3Ex´F»e
(
pRoÙ
);

136927 
	gpRoÙ
 = 0;

136929 *
	gµ
 = 
pRoÙ
;

136930  
	grc
;

136944 
ás3Ex´P¬£Unb®ªûd
(

136945 
sql™e3_tok’iz”
 *
pTok’iz”
,

136946 
iLªgid
,

136947 **
azCÞ
,

136948 
bFts4
,

136949 
nCÞ
,

136950 
iDeçuÉCÞ
,

136951 cÚ¡ *
z
, 
n
,

136952 
Fts3Ex´
 **
µEx´


136954 
	gnP¬£d
;

136955 
	grc
;

136956 
P¬£CÚ‹xt
 
	gsP¬£
;

136958 
mem£t
(&
sP¬£
, 0, (
P¬£CÚ‹xt
));

136959 
	gsP¬£
.
	gpTok’iz”
 = 
pTok’iz”
;

136960 
	gsP¬£
.
	giLªgid
 = 
iLªgid
;

136961 
	gsP¬£
.
	gazCÞ
 = (cÚ¡ **)
azCÞ
;

136962 
	gsP¬£
.
	gnCÞ
 = 
nCÞ
;

136963 
	gsP¬£
.
	giDeçuÉCÞ
 = 
iDeçuÉCÞ
;

136964 
	gsP¬£
.
	gbFts4
 = 
bFts4
;

136965 ifÐ
	gz
==0 ){

136966 *
µEx´
 = 0;

136967  
	gSQLITE_OK
;

136969 ifÐ
	gn
<0 ){

136970 
	gn
 = ()
¡¾’
(
z
);

136972 
	grc
 = 
ás3Ex´P¬£
(&
sP¬£
, 
z
, 
n
, 
µEx´
, &
nP¬£d
);

136973 
as£¹
Ð
rc
==
SQLITE_OK
 || *
µEx´
==0 );

136976 ifÐ
	grc
==
SQLITE_OK
 && 
sP¬£
.
nNe¡
 ){

136977 
rc
 = 
SQLITE_ERROR
;

136980  
	grc
;

137007 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´P¬£
(

137008 
sql™e3_tok’iz”
 *
pTok’iz”
,

137009 
iLªgid
,

137010 **
azCÞ
,

137011 
bFts4
,

137012 
nCÞ
,

137013 
iDeçuÉCÞ
,

137014 cÚ¡ *
z
, 
n
,

137015 
Fts3Ex´
 **
µEx´
,

137016 **
pzE¼


137018 
	grc
 = 
ás3Ex´P¬£Unb®ªûd
(

137019 
pTok’iz”
, 
iLªgid
, 
azCÞ
, 
bFts4
, 
nCÞ
, 
iDeçuÉCÞ
, 
z
, 
n
, 
µEx´


137024 ifÐ
	grc
==
SQLITE_OK
 && *
µEx´
 ){

137025 
rc
 = 
ás3Ex´B®ªû
(
µEx´
, 
SQLITE_FTS3_MAX_EXPR_DEPTH
);

137026 ifÐ
	grc
==
SQLITE_OK
 ){

137027 
rc
 = 
ás3Ex´CheckD•th
(*
µEx´
, 
SQLITE_FTS3_MAX_EXPR_DEPTH
);

137031 ifÐ
	grc
!=
SQLITE_OK
 ){

137032 
sql™e3Fts3Ex´F»e
(*
µEx´
);

137033 *
	gµEx´
 = 0;

137034 ifÐ
	grc
==
SQLITE_TOOBIG
 ){

137035 *
pzE¼
 = 
sql™e3_m´štf
(

137037 
SQLITE_FTS3_MAX_EXPR_DEPTH


137039 
	grc
 = 
SQLITE_ERROR
;

137040 }ifÐ
	grc
==
SQLITE_ERROR
 ){

137041 *
pzE¼
 = 
sql™e3_m´štf
("m®fÜmed MATCHƒx´essiÚ: [%s]", 
z
);

137045  
	grc
;

137051 
ás3F»eEx´Node
(
Fts3Ex´
 *
p
){

137052 
as£¹
Ð
p
->
eTy³
==
FTSQUERY_PHRASE
 ||…->
pPh¿£
==0 );

137053 
sql™e3Fts3Ev®Ph¿£CËªup
(
p
->
pPh¿£
);

137054 
sql™e3_ä“
(
p
->
aMI
);

137055 
sql™e3_ä“
(
p
);

137065 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´F»e
(
Fts3Ex´
 *
pD–
){

137066 
Fts3Ex´
 *
	gp
;

137067 
as£¹
Ð
pD–
==0 ||…D–->
pP¬’t
==0 );

137068 
	gp
=
pD–
;… && (p->
	gpLeá
||p->
	gpRight
);…=(
p
->
pLeá
 ?…->pLeá :…->
pRight
)){

137069 
as£¹
Ð
p
->
pP¬’t
==0 ||…=õ->pP¬’t->
pRight
 ||…=õ->pP¬’t->
pLeá
 );

137071  
	gp
 ){

137072 
Fts3Ex´
 *
	gpP¬’t
 = 
p
->
pP¬’t
;

137073 
ás3F»eEx´Node
(
p
);

137074 ifÐ
	gpP¬’t
 && 
	gp
==
pP¬’t
->
pLeá
 &&…P¬’t->
pRight
 ){

137075 
p
 = 
pP¬’t
->
pRight
;

137076  
	gp
 && (p->
	gpLeá
 ||…->
	gpRight
) ){

137077 
as£¹
Ð
p
=õ->
pP¬’t
->
pRight
 ||…=õ->pP¬’t->
pLeá
 );

137078 
	gp
 = (
p
->
pLeá
 ?…->pLeá :…->
pRight
);

137081 
	gp
 = 
pP¬’t
;

137091 #ifdeà
SQLITE_TEST


137098 
qu”yTe¡Tok’iz”
(

137099 
sql™e3
 *
db
,

137100 cÚ¡ *
zName
,

137101 cÚ¡ 
sql™e3_tok’iz”_moduË
 **
µ


137103 
	grc
;

137104 
sql™e3_¡mt
 *
	gpStmt
;

137105 cÚ¡ 
	gzSql
[] = "SELECT fts3_tokenizer(?)";

137107 *
	gµ
 = 0;

137108 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
pStmt
, 0);

137109 ifÐ
	grc
!=
SQLITE_OK
 ){

137110  
rc
;

137113 
sql™e3_bšd_‹xt
(
pStmt
, 1, 
zName
, -1, 
SQLITE_STATIC
);

137114 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

137115 ifÐ
sql™e3_cÞumn_ty³
(
pStmt
, 0)==
SQLITE_BLOB
 ){

137116 
memýy
((*)
µ
, 
sql™e3_cÞumn_blob
(
pStmt
, 0), (*pp));

137120  
sql™e3_fš®ize
(
pStmt
);

137133 *
ex´ToSŒšg
(
Fts3Ex´
 *
pEx´
, *
zBuf
){

137134 ifÐ
	gpEx´
==0 ){

137135  
sql™e3_m´štf
("");

137137  
	gpEx´
->
	geTy³
 ){

137138 
	gFTSQUERY_PHRASE
: {

137139 
Fts3Ph¿£
 *
pPh¿£
 = 
pEx´
->pPhrase;

137140 
	gi
;

137141 
	gzBuf
 = 
sql™e3_m´štf
(

137142 "%zPHRASE %d 0", 
zBuf
, 
pPh¿£
->
iCÞumn
);

137143 
	gi
=0; 
	gzBuf
 && i<
	gpPh¿£
->
	gnTok’
; i++){

137144 
	gzBuf
 = 
sql™e3_m´štf
("%z %.*s%s", 
zBuf
,

137145 
pPh¿£
->
aTok’
[
i
].
n
,…Ph¿£->aTok’[i].
z
,

137146 (
pPh¿£
->
aTok’
[
i
].
isP»fix
?"+":"")

137149  
	gzBuf
;

137152 
	gFTSQUERY_NEAR
:

137153 
zBuf
 = 
sql™e3_m´štf
("%zNEAR/%d ", zBuf, 
pEx´
->
nN—r
);

137155 
	gFTSQUERY_NOT
:

137156 
zBuf
 = 
sql™e3_m´štf
("%zNOT ", zBuf);

137158 
	gFTSQUERY_AND
:

137159 
zBuf
 = 
sql™e3_m´štf
("%zAND ", zBuf);

137161 
	gFTSQUERY_OR
:

137162 
zBuf
 = 
sql™e3_m´štf
("%zOR ", zBuf);

137166 ifÐ
	gzBuf
 ) zBuàð
sql™e3_m´štf
("%z{", 
zBuf
);

137167 ifÐ
	gzBuf
 ) zBuàð
ex´ToSŒšg
(
pEx´
->
pLeá
, 
zBuf
);

137168 ifÐ
	gzBuf
 ) zBuàð
sql™e3_m´štf
("%z} {", 
zBuf
);

137170 ifÐ
	gzBuf
 ) zBuàð
ex´ToSŒšg
(
pEx´
->
pRight
, 
zBuf
);

137171 ifÐ
	gzBuf
 ) zBuàð
sql™e3_m´štf
("%z}", 
zBuf
);

137173  
	gzBuf
;

137190 
ás3Ex´Te¡
(

137191 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

137192 
¬gc
,

137193 
sql™e3_v®ue
 **
¬gv


137195 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 0;

137196 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 0;

137197 
	grc
;

137198 **
	gazCÞ
 = 0;

137199 cÚ¡ *
	gzEx´
;

137200 
	gnEx´
;

137201 
	gnCÞ
;

137202 
	gii
;

137203 
Fts3Ex´
 *
	gpEx´
;

137204 *
	gzBuf
 = 0;

137205 
sql™e3
 *
	gdb
 = 
sql™e3_cÚ‹xt_db_hªdË
(
cÚ‹xt
);

137207 ifÐ
	g¬gc
<3 ){

137208 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
,

137214 
	grc
 = 
qu”yTe¡Tok’iz”
(
db
,

137215 (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]), &
pModuË
);

137216 ifÐ
	grc
==
SQLITE_NOMEM
 ){

137217 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

137218 
	gex´‹¡_out
;

137219 }ifÐ!
	gpModuË
 ){

137220 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "No suchokenizer module", -1);

137221 
	gex´‹¡_out
;

137224 
	grc
 = 
pModuË
->
xC»©e
(0, 0, &
pTok’iz”
);

137225 
as£¹
Ð
rc
==
SQLITE_NOMEM
 ||„c==
SQLITE_OK
 );

137226 ifÐ
	grc
==
SQLITE_NOMEM
 ){

137227 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

137228 
	gex´‹¡_out
;

137230 
	gpTok’iz”
->
	gpModuË
 = 
pModuË
;

137232 
	gzEx´
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[1]);

137233 
	gnEx´
 = 
sql™e3_v®ue_by‹s
(
¬gv
[1]);

137234 
	gnCÞ
 = 
¬gc
-2;

137235 
	gazCÞ
 = (**)
sql™e3_m®loc
(
nCÞ
*(*));

137236 ifÐ!
	gazCÞ
 ){

137237 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

137238 
	gex´‹¡_out
;

137240 
	gii
=0; ii<
	gnCÞ
; ii++){

137241 
	gazCÞ
[
ii
] = (*)
sql™e3_v®ue_‹xt
(
¬gv
[ii+2]);

137244 ifÐ
sql™e3_u£r_d©a
(
cÚ‹xt
) ){

137245 *
	gzDummy
 = 0;

137246 
	grc
 = 
sql™e3Fts3Ex´P¬£
(

137247 
pTok’iz”
, 0, 
azCÞ
, 0, 
nCÞ
,‚CÞ, 
zEx´
, 
nEx´
, &
pEx´
, &
zDummy


137249 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pEx´
==0 );

137250 
sql™e3_ä“
(
zDummy
);

137252 
	grc
 = 
ás3Ex´P¬£Unb®ªûd
(

137253 
pTok’iz”
, 0, 
azCÞ
, 0, 
nCÞ
,‚CÞ, 
zEx´
, 
nEx´
, &
pEx´


137257 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_NOMEM
 ){

137258 
sql™e3Fts3Ex´F»e
(
pEx´
);

137259 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "Error…arsingƒxpression", -1);

137260 }ifÐ
	grc
==
SQLITE_NOMEM
 || !(
zBuf
 = 
ex´ToSŒšg
(
pEx´
, 0)) ){

137261 
sql™e3_»suÉ_”rÜ_nomem
(
cÚ‹xt
);

137263 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
zBuf
, -1, 
SQLITE_TRANSIENT
);

137264 
sql™e3_ä“
(
zBuf
);

137267 
sql™e3Fts3Ex´F»e
(
pEx´
);

137269 
	gex´‹¡_out
:

137270 ifÐ
pModuË
 && 
pTok’iz”
 ){

137271 
rc
 = 
pModuË
->
xDe¡roy
(
pTok’iz”
);

137273 
sql™e3_ä“
(
azCÞ
);

137280 
SQLITE_PRIVATE
 
sql™e3Fts3Ex´In™Te¡IÁ”çû
(
sql™e3
* 
db
){

137281 
	grc
 = 
sql™e3_ü—‹_funùiÚ
(

137282 
db
, "ás3_ex´‹¡", -1, 
SQLITE_UTF8
, 0, 
ás3Ex´Te¡
, 0, 0

137284 ifÐ
	grc
==
SQLITE_OK
 ){

137285 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, "fts3_exprtest_rebalance",

137286 -1, 
SQLITE_UTF8
, (*)1, 
ás3Ex´Te¡
, 0, 0

137289  
	grc
;

137322 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

137332 *
ás3HashM®loc
(
n
){

137333 *
	gp
 = 
sql™e3_m®loc
(
n
);

137334 ifÐ
	gp
 ){

137335 
mem£t
(
p
, 0, 
n
);

137337  
	gp
;

137339 
ás3HashF»e
(*
p
){

137340 
sql™e3_ä“
(
p
);

137353 
SQLITE_PRIVATE
 
sql™e3Fts3HashIn™
(
Fts3Hash
 *
pNew
, 
keyCÏss
, 
cÝyKey
){

137354 
as£¹
Ð
pNew
!=0 );

137355 
as£¹
Ð
keyCÏss
>=
FTS3_HASH_STRING
 && keyCÏss<=
FTS3_HASH_BINARY
 );

137356 
	gpNew
->
	gkeyCÏss
 = 
keyCÏss
;

137357 
	gpNew
->
	gcÝyKey
 = 
cÝyKey
;

137358 
	gpNew
->
	gfœ¡
 = 0;

137359 
	gpNew
->
	gcouÁ
 = 0;

137360 
	gpNew
->
	ghtsize
 = 0;

137361 
	gpNew
->
	ght
 = 0;

137368 
SQLITE_PRIVATE
 
sql™e3Fts3HashCË¬
(
Fts3Hash
 *
pH
){

137369 
Fts3HashEËm
 *
	g–em
;

137371 
as£¹
Ð
pH
!=0 );

137372 
	g–em
 = 
pH
->
fœ¡
;

137373 
	gpH
->
	gfœ¡
 = 0;

137374 
ás3HashF»e
(
pH
->
ht
);

137375 
	gpH
->
	ght
 = 0;

137376 
	gpH
->
	ghtsize
 = 0;

137377  
	g–em
 ){

137378 
Fts3HashEËm
 *
	gÃxt_–em
 = 
–em
->
Ãxt
;

137379 ifÐ
	gpH
->
	gcÝyKey
 && 
	g–em
->
	gpKey
 ){

137380 
ás3HashF»e
(
–em
->
pKey
);

137382 
ás3HashF»e
(
–em
);

137383 
	g–em
 = 
Ãxt_–em
;

137385 
	gpH
->
	gcouÁ
 = 0;

137391 
ás3SŒHash
(cÚ¡ *
pKey
, 
nKey
){

137392 cÚ¡ *
	gz
 = (cÚ¡ *)
pKey
;

137393 
	gh
 = 0;

137394 ifÐ
	gnKey
<=0 ) 
nKey
 = (è
¡¾’
(
z
);

137395  
	gnKey
 > 0 ){

137396 
	gh
 = (
h
<<3è^ h ^ *
z
++;

137397 
	gnKey
--;

137399  ()(
	gh
 & 0x7fffffff);

137401 
ás3SŒCom·»
(cÚ¡ *
pKey1
, 
n1
, cÚ¡ *
pKey2
, 
n2
){

137402 ifÐ
	gn1
!=
n2
 )  1;

137403  
¡ºcmp
((cÚ¡ *)
pKey1
,(cÚ¡ *)
pKey2
,
n1
);

137409 
ás3BšHash
(cÚ¡ *
pKey
, 
nKey
){

137410 
	gh
 = 0;

137411 cÚ¡ *
	gz
 = (cÚ¡ *)
pKey
;

137412  
	gnKey
-- > 0 ){

137413 
	gh
 = (
h
<<3è^ h ^ *(
z
++);

137415  
	gh
 & 0x7fffffff;

137417 
ás3BšCom·»
(cÚ¡ *
pKey1
, 
n1
, cÚ¡ *
pKey2
, 
n2
){

137418 ifÐ
	gn1
!=
n2
 )  1;

137419  
memcmp
(
pKey1
,
pKey2
,
n1
);

137434 (*
ásHashFunùiÚ
(
keyCÏss
))(const *,){

137435 ifÐ
	gkeyCÏss
==
FTS3_HASH_STRING
 ){

137436  &
ás3SŒHash
;

137438 
as£¹
Ð
keyCÏss
==
FTS3_HASH_BINARY
 );

137439  &
	gás3BšHash
;

137449 (*
ásCom·»FunùiÚ
(
keyCÏss
))(const *,,const *,){

137450 ifÐ
	gkeyCÏss
==
FTS3_HASH_STRING
 ){

137451  &
ás3SŒCom·»
;

137453 
as£¹
Ð
keyCÏss
==
FTS3_HASH_BINARY
 );

137454  &
	gás3BšCom·»
;

137460 
ás3HashIn£¹EËm’t
(

137461 
Fts3Hash
 *
pH
,

137462 
_ás3ht
 *
pEÁry
,

137463 
Fts3HashEËm
 *
pNew


137465 
Fts3HashEËm
 *
	gpH—d
;

137466 
	gpH—d
 = 
pEÁry
->
chaš
;

137467 ifÐ
	gpH—d
 ){

137468 
	gpNew
->
	gÃxt
 = 
pH—d
;

137469 
	gpNew
->
	g´ev
 = 
pH—d
->
´ev
;

137470 ifÐ
	gpH—d
->
	g´ev
 ){…H—d->´ev->
	gÃxt
 = 
pNew
; }

137471 { 
	gpH
->
	gfœ¡
 = 
pNew
; }

137472 
	gpH—d
->
	g´ev
 = 
pNew
;

137474 
	gpNew
->
	gÃxt
 = 
pH
->
fœ¡
;

137475 ifÐ
	gpH
->
	gfœ¡
 ){…H->fœ¡->
	g´ev
 = 
pNew
; }

137476 
	gpNew
->
	g´ev
 = 0;

137477 
	gpH
->
	gfœ¡
 = 
pNew
;

137479 
	gpEÁry
->
	gcouÁ
++;

137480 
	gpEÁry
->
	gchaš
 = 
pNew
;

137490 
ás3Rehash
(
Fts3Hash
 *
pH
, 
Ãw_size
){

137491 
_ás3ht
 *
	gÃw_ht
;

137492 
Fts3HashEËm
 *
	g–em
, *
	gÃxt_–em
;

137493 (*
	gxHash
)(const *,);

137495 
as£¹
Ð(
Ãw_size
 & (new_size-1))==0 );

137496 
	gÃw_ht
 = (
_ás3ht
 *)
ás3HashM®loc
Ð
Ãw_size
*(_fts3ht) );

137497 ifÐ
	gÃw_ht
==0 )  1;

137498 
ás3HashF»e
(
pH
->
ht
);

137499 
	gpH
->
	ght
 = 
Ãw_ht
;

137500 
	gpH
->
	ghtsize
 = 
Ãw_size
;

137501 
	gxHash
 = 
ásHashFunùiÚ
(
pH
->
keyCÏss
);

137502 
	g–em
=
pH
->
fœ¡
, 
	gpH
->
	gfœ¡
=0;ƒËm;ƒËm = 
Ãxt_–em
){

137503 
h
 = (*
xHash
)(
–em
->
pKey
, 
	g–em
->
	gnKey
è& (
	gÃw_size
-1);

137504 
	gÃxt_–em
 = 
–em
->
Ãxt
;

137505 
ás3HashIn£¹EËm’t
(
pH
, &
Ãw_ht
[
h
], 
–em
);

137514 
Fts3HashEËm
 *
ás3FšdEËm’tByHash
(

137515 cÚ¡ 
Fts3Hash
 *
pH
,

137516 cÚ¡ *
pKey
,

137517 
nKey
,

137518 
h


137520 
Fts3HashEËm
 *
	g–em
;

137521 
	gcouÁ
;

137522 (*
	gxCom·»
)(const *,,const *,);

137524 ifÐ
	gpH
->
	ght
 ){

137525 
_ás3ht
 *
	gpEÁry
 = &
pH
->
ht
[
h
];

137526 
	g–em
 = 
pEÁry
->
chaš
;

137527 
	gcouÁ
 = 
pEÁry
->
couÁ
;

137528 
	gxCom·»
 = 
ásCom·»FunùiÚ
(
pH
->
keyCÏss
);

137529  
	gcouÁ
-- && 
	g–em
 ){

137530 ifÐ(*
	gxCom·»
)(
	g–em
->
	gpKey
,–em->
	gnKey
,pKey,nKey)==0 ){

137531  
–em
;

137533 
	g–em
 = 
–em
->
Ãxt
;

137542 
ás3RemoveEËm’tByHash
(

137543 
Fts3Hash
 *
pH
,

137544 
Fts3HashEËm
* 
–em
,

137545 
h


137547 
_ás3ht
 *
	gpEÁry
;

137548 ifÐ
	g–em
->
	g´ev
 ){

137549 
	g–em
->
	g´ev
->
	gÃxt
 = 
–em
->
Ãxt
;

137551 
	gpH
->
	gfœ¡
 = 
–em
->
Ãxt
;

137553 ifÐ
	g–em
->
	gÃxt
 ){

137554 
	g–em
->
	gÃxt
->
	g´ev
 = 
–em
->
´ev
;

137556 
	gpEÁry
 = &
pH
->
ht
[
h
];

137557 ifÐ
	gpEÁry
->
	gchaš
==
–em
 ){

137558 
pEÁry
->
chaš
 = 
–em
->
Ãxt
;

137560 
	gpEÁry
->
	gcouÁ
--;

137561 ifÐ
	gpEÁry
->
	gcouÁ
<=0 ){

137562 
pEÁry
->
chaš
 = 0;

137564 ifÐ
	gpH
->
	gcÝyKey
 && 
	g–em
->
	gpKey
 ){

137565 
ás3HashF»e
(
–em
->
pKey
);

137567 
ás3HashF»e
Ð
–em
 );

137568 
	gpH
->
	gcouÁ
--;

137569 ifÐ
	gpH
->
	gcouÁ
<=0 ){

137570 
as£¹
Ð
pH
->
fœ¡
==0 );

137571 
as£¹
Ð
pH
->
couÁ
==0 );

137572 
ás3HashCË¬
(
pH
);

137576 
SQLITE_PRIVATE
 
Fts3HashEËm
 *
sql™e3Fts3HashFšdEËm
(

137577 cÚ¡ 
Fts3Hash
 *
pH
,

137578 cÚ¡ *
pKey
,

137579 
nKey


137581 
	gh
;

137582 (*
	gxHash
)(const *,);

137584 ifÐ
	gpH
==0 || 
pH
->
ht
==0 )  0;

137585 
	gxHash
 = 
ásHashFunùiÚ
(
pH
->
keyCÏss
);

137586 
as£¹
Ð
xHash
!=0 );

137587 
	gh
 = (*
xHash
)(
pKey
,
	gnKey
);

137588 
as£¹
Ð(
pH
->
htsize
 & (pH->htsize-1))==0 );

137589  
ás3FšdEËm’tByHash
(
pH
,
pKey
,
nKey
, 
h
 & (pH->
htsize
-1));

137597 
SQLITE_PRIVATE
 *
sql™e3Fts3HashFšd
(cÚ¡ 
Fts3Hash
 *
pH
, cÚ¡ *
pKey
, 
nKey
){

137598 
Fts3HashEËm
 *
	gpEËm
;

137600 
	gpEËm
 = 
sql™e3Fts3HashFšdEËm
(
pH
, 
pKey
, 
nKey
);

137601  
	gpEËm
 ?…EËm->
	gd©a
 : 0;

137619 
SQLITE_PRIVATE
 *
sql™e3Fts3HashIn£¹
(

137620 
Fts3Hash
 *
pH
,

137621 cÚ¡ *
pKey
,

137622 
nKey
,

137623 *
d©a


137625 
	gh¿w
;

137626 
	gh
;

137627 
Fts3HashEËm
 *
	g–em
;

137628 
Fts3HashEËm
 *
	gÃw_–em
;

137629 (*
	gxHash
)(const *,);

137631 
as£¹
Ð
pH
!=0 );

137632 
	gxHash
 = 
ásHashFunùiÚ
(
pH
->
keyCÏss
);

137633 
as£¹
Ð
xHash
!=0 );

137634 
	gh¿w
 = (*
xHash
)(
pKey
, 
	gnKey
);

137635 
as£¹
Ð(
pH
->
htsize
 & (pH->htsize-1))==0 );

137636 
	gh
 = 
h¿w
 & (
pH
->
htsize
-1);

137637 
	g–em
 = 
ás3FšdEËm’tByHash
(
pH
,
pKey
,
nKey
,
h
);

137638 ifÐ
	g–em
 ){

137639 *
	gÞd_d©a
 = 
–em
->
d©a
;

137640 ifÐ
	gd©a
==0 ){

137641 
ás3RemoveEËm’tByHash
(
pH
,
–em
,
h
);

137643 
	g–em
->
	gd©a
 = 
d©a
;

137645  
	gÞd_d©a
;

137647 ifÐ
	gd©a
==0 )  0;

137648 ifÐ(
	gpH
->
	ghtsize
==0 && 
ás3Rehash
(
pH
,8))

137649 || (
	gpH
->
	gcouÁ
>=
pH
->
htsize
 && 
ás3Rehash
(pH,…H->htsize*2))

137651 
	gpH
->
	gcouÁ
 = 0;

137652  
	gd©a
;

137654 
as£¹
Ð
pH
->
htsize
>0 );

137655 
	gÃw_–em
 = (
Fts3HashEËm
*)
ás3HashM®loc
( (Fts3HashElem) );

137656 ifÐ
	gÃw_–em
==0 )  
d©a
;

137657 ifÐ
	gpH
->
	gcÝyKey
 && 
	gpKey
!=0 ){

137658 
Ãw_–em
->
pKey
 = 
ás3HashM®loc
Ð
nKey
 );

137659 ifÐ
	gÃw_–em
->
	gpKey
==0 ){

137660 
ás3HashF»e
(
Ãw_–em
);

137661  
	gd©a
;

137663 
memýy
((*)
Ãw_–em
->
pKey
,…Key, 
nKey
);

137665 
	gÃw_–em
->
	gpKey
 = (*)
pKey
;

137667 
	gÃw_–em
->
	gnKey
 = 
nKey
;

137668 
	gpH
->
	gcouÁ
++;

137669 
as£¹
Ð
pH
->
htsize
>0 );

137670 
as£¹
Ð(
pH
->
htsize
 & (pH->htsize-1))==0 );

137671 
	gh
 = 
h¿w
 & (
pH
->
htsize
-1);

137672 
ás3HashIn£¹EËm’t
(
pH
, &pH->
ht
[
h
], 
Ãw_–em
);

137673 
	gÃw_–em
->
	gd©a
 = 
d©a
;

137705 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

137716 
	spÜ‹r_tok’iz”
 {

137717 
sql™e3_tok’iz”
 
	gba£
;

137718 } 
	tpÜ‹r_tok’iz”
;

137723 
	spÜ‹r_tok’iz”_cursÜ
 {

137724 
sql™e3_tok’iz”_cursÜ
 
	gba£
;

137725 cÚ¡ *
	gzIÅut
;

137726 
	gnIÅut
;

137727 
	giOff£t
;

137728 
	giTok’
;

137729 *
	gzTok’
;

137730 
	gnAÎoÿ‹d
;

137731 } 
	tpÜ‹r_tok’iz”_cursÜ
;

137737 
pÜ‹rC»©e
(

137738 
¬gc
, cÚ¡ * cÚ¡ *
¬gv
,

137739 
sql™e3_tok’iz”
 **
µTok’iz”


137741 
pÜ‹r_tok’iz”
 *
	gt
;

137743 
UNUSED_PARAMETER
(
¬gc
);

137744 
UNUSED_PARAMETER
(
¬gv
);

137746 
	gt
 = (
pÜ‹r_tok’iz”
 *è
sql™e3_m®loc
((*
t
));

137747 ifÐ
	gt
==
NULL
 )  
SQLITE_NOMEM
;

137748 
mem£t
(
t
, 0, (*t));

137749 *
	gµTok’iz”
 = &
t
->
ba£
;

137750  
	gSQLITE_OK
;

137756 
pÜ‹rDe¡roy
(
sql™e3_tok’iz”
 *
pTok’iz”
){

137757 
sql™e3_ä“
(
pTok’iz”
);

137758  
	gSQLITE_OK
;

137767 
pÜ‹rO³n
(

137768 
sql™e3_tok’iz”
 *
pTok’iz”
,

137769 cÚ¡ *
zIÅut
, 
nIÅut
,

137770 
sql™e3_tok’iz”_cursÜ
 **
µCursÜ


137772 
pÜ‹r_tok’iz”_cursÜ
 *
	gc
;

137774 
UNUSED_PARAMETER
(
pTok’iz”
);

137776 
	gc
 = (
pÜ‹r_tok’iz”_cursÜ
 *è
sql™e3_m®loc
((*
c
));

137777 ifÐ
	gc
==
NULL
 )  
SQLITE_NOMEM
;

137779 
	gc
->
	gzIÅut
 = 
zIÅut
;

137780 ifÐ
	gzIÅut
==0 ){

137781 
c
->
nIÅut
 = 0;

137782 }ifÐ
	gnIÅut
<0 ){

137783 
	gc
->
	gnIÅut
 = ()
¡¾’
(
zIÅut
);

137785 
	gc
->
	gnIÅut
 = 
nIÅut
;

137787 
	gc
->
	giOff£t
 = 0;

137788 
	gc
->
	giTok’
 = 0;

137789 
	gc
->
	gzTok’
 = 
NULL
;

137790 
	gc
->
	gnAÎoÿ‹d
 = 0;

137792 *
	gµCursÜ
 = &
c
->
ba£
;

137793  
	gSQLITE_OK
;

137800 
pÜ‹rClo£
(
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
){

137801 
pÜ‹r_tok’iz”_cursÜ
 *
	gc
 = (pÜ‹r_tok’iz”_cursÜ *è
pCursÜ
;

137802 
sql™e3_ä“
(
c
->
zTok’
);

137803 
sql™e3_ä“
(
c
);

137804  
	gSQLITE_OK
;

137809 cÚ¡ 
	gcTy³
[] = {

137827 
isVow–
(const *);

137828 
isCÚsÚªt
(cÚ¡ *
z
){

137829 
	gj
;

137830 
	gx
 = *
z
;

137831 ifÐ
	gx
==0 )  0;

137832 
as£¹
Ð
x
>='a' && x<='z' );

137833 
	gj
 = 
cTy³
[
x
-'a'];

137834 ifÐ
	gj
<2 )  j;

137835  
	gz
[1]==0 || 
isVow–
(
z
 + 1);

137837 
isVow–
(cÚ¡ *
z
){

137838 
	gj
;

137839 
	gx
 = *
z
;

137840 ifÐ
	gx
==0 )  0;

137841 
as£¹
Ð
x
>='a' && x<='z' );

137842 
	gj
 = 
cTy³
[
x
-'a'];

137843 ifÐ
	gj
<2 )  1-j;

137844  
isCÚsÚªt
(
z
 + 1);

137866 
m_gt_0
(cÚ¡ *
z
){

137867  
isVow–
(
z
è){ 
	gz
++; }

137868 ifÐ*
	gz
==0 )  0;

137869  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137870  *
	gz
!=0;

137876 
m_eq_1
(cÚ¡ *
z
){

137877  
isVow–
(
z
è){ 
	gz
++; }

137878 ifÐ*
	gz
==0 )  0;

137879  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137880 ifÐ*
	gz
==0 )  0;

137881  
isVow–
(
z
è){ 
	gz
++; }

137882 ifÐ*
	gz
==0 )  1;

137883  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137884  *
	gz
==0;

137890 
m_gt_1
(cÚ¡ *
z
){

137891  
isVow–
(
z
è){ 
	gz
++; }

137892 ifÐ*
	gz
==0 )  0;

137893  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137894 ifÐ*
	gz
==0 )  0;

137895  
isVow–
(
z
è){ 
	gz
++; }

137896 ifÐ*
	gz
==0 )  0;

137897  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137898  *
	gz
!=0;

137904 
hasVow–
(cÚ¡ *
z
){

137905  
isCÚsÚªt
(
z
è){ 
	gz
++; }

137906  *
	gz
!=0;

137915 
doubËCÚsÚªt
(cÚ¡ *
z
){

137916  
isCÚsÚªt
(
z
è&& 
	gz
[0]==z[1];

137927 
¡¬_oh
(cÚ¡ *
z
){

137929 
isCÚsÚªt
(
z
) &&

137930 
	gz
[0]!='w' && 
z
[0]!='x' && z[0]!='y' &&

137931 
isVow–
(
z
+1) &&

137932 
isCÚsÚªt
(
z
+2);

137947 
¡em
(

137948 **
pz
,

137949 cÚ¡ *
zFrom
,

137950 cÚ¡ *
zTo
,

137951 (*
xCÚd
)(const *)

137953 *
	gz
 = *
pz
;

137954  *
	gzFrom
 && *zFrom==*
z
 ){ z++; zFrom++; }

137955 ifÐ*
	gzFrom
!=0 )  0;

137956 ifÐ
	gxCÚd
 && !
xCÚd
(
z
) )  1;

137957  *
	gzTo
 ){

137958 *(--
	gz
èð*(
zTo
++);

137960 *
	gpz
 = 
z
;

137972 
cÝy_¡emm”
(cÚ¡ *
zIn
, 
nIn
, *
zOut
, *
²Out
){

137973 
	gi
, 
	gmx
, 
	gj
;

137974 
	ghasDig™
 = 0;

137975 
	gi
=0; i<
	gnIn
; i++){

137976 
	gc
 = 
zIn
[
i
];

137977 ifÐ
	gc
>='A' && 
c
<='Z' ){

137978 
zOut
[
i
] = 
c
 - 'A' + 'a';

137980 ifÐ
	gc
>='0' && 
c
<='9' ) 
hasDig™
 = 1;

137981 
	gzOut
[
i
] = 
c
;

137984 
	gmx
 = 
hasDig™
 ? 3 : 10;

137985 ifÐ
	gnIn
>
	gmx
*2 ){

137986 
	gj
=
mx
, 
	gi
=
nIn
-mx; i<
	gnIn
; i++, j++){

137987 
	gzOut
[
j
] = 
zOut
[
i
];

137989 
	gi
 = 
j
;

137991 
	gzOut
[
i
] = 0;

137992 *
	g²Out
 = 
i
;

138019 
pÜ‹r_¡emm”
(cÚ¡ *
zIn
, 
nIn
, *
zOut
, *
²Out
){

138020 
	gi
, 
	gj
;

138021 
	gzRev”£
[28];

138022 *
	gz
, *
	gz2
;

138023 ifÐ
	gnIn
<3 ||‚In>=()(
zRev”£
)-7 ){

138026 
cÝy_¡emm”
(
zIn
, 
nIn
, 
zOut
, 
²Out
);

138029 
	gi
=0, 
	gj
=(
zRev”£
)-6; i<
	gnIn
; i++, j--){

138030 
	gc
 = 
zIn
[
i
];

138031 ifÐ
	gc
>='A' && 
c
<='Z' ){

138032 
zRev”£
[
j
] = 
c
 + 'a' - 'A';

138033 }ifÐ
	gc
>='a' && 
c
<='z' ){

138034 
zRev”£
[
j
] = 
c
;

138038 
cÝy_¡emm”
(
zIn
, 
nIn
, 
zOut
, 
²Out
);

138042 
mem£t
(&
zRev”£
[(zReverse)-5], 0, 5);

138043 
	gz
 = &
zRev”£
[
j
+1];

138047 ifÐ
	gz
[0]=='s' ){

138049 !
¡em
(&
z
, "sess", "ss", 0) &&

138050 !
¡em
(&
z
, "sei", "i", 0) &&

138051 !
¡em
(&
z
, "ss", "ss", 0)

138053 
z
++;

138058 
	gz2
 = 
z
;

138059 ifÐ
¡em
(&
z
, "d“", "“", 
m_gt_0
) ){

138062 (
¡em
(&
z
, "gni", "", 
hasVow–
) || stem(&z, "de", "", hasVowel))

138063 && 
	gz
!=
z2


138065 ifÐ
¡em
(&
z
, "ta", "ate", 0) ||

138066 
¡em
(&
z
, "lb", "ble", 0) ||

138067 
¡em
(&
z
, "zi", "ize", 0) ){

138069 }ifÐ
doubËCÚsÚªt
(
z
) && (*z!='l' && *z!='s' && *z!='z') ){

138070 
z
++;

138071 }ifÐ
m_eq_1
(
z
è&& 
¡¬_oh
(z) ){

138072 *(--
	gz
) = 'e';

138077 ifÐ
	gz
[0]=='y' && 
hasVow–
(
z
+1) ){

138078 
z
[0] = 'i';

138082  
	gz
[1] ){

138084 ifÐ!
¡em
(&
z
, "Ïno™a", "©e", 
m_gt_0
) ){

138085 
¡em
(&
z
, "Ïno™", "tiÚ", 
m_gt_0
);

138089 ifÐ!
¡em
(&
z
, "iúe", "’û", 
m_gt_0
) ){

138090 
¡em
(&
z
, "iúa", "ªû", 
m_gt_0
);

138094 
¡em
(&
z
, "»zi", "ize", 
m_gt_0
);

138097 
¡em
(&
z
, "igÞ", "log", 
m_gt_0
);

138100 ifÐ!
¡em
(&
z
, "žb", "bË", 
m_gt_0
)

138101 && !
¡em
(&
z
, "žÏ", "®", 
m_gt_0
)

138102 && !
¡em
(&
z
, "žŠe", "’t", 
m_gt_0
)

138103 && !
¡em
(&
z
, "že", "e", 
m_gt_0
)

138105 
¡em
(&
z
, "žsuo", "ous", 
m_gt_0
);

138109 ifÐ!
¡em
(&
z
, "no™azi", "ize", 
m_gt_0
)

138110 && !
¡em
(&
z
, "no™a", "©e", 
m_gt_0
)

138112 
¡em
(&
z
, "rÙa", "©e", 
m_gt_0
);

138116 ifÐ!
¡em
(&
z
, "msža", "®", 
m_gt_0
)

138117 && !
¡em
(&
z
, "s£Ãvi", "ive", 
m_gt_0
)

138118 && !
¡em
(&
z
, "s£Æuf", "ful", 
m_gt_0
)

138120 
¡em
(&
z
, "s£nsuo", "ous", 
m_gt_0
);

138124 ifÐ!
¡em
(&
z
, "™ža", "®", 
m_gt_0
)

138125 && !
¡em
(&
z
, "™ivi", "ive", 
m_gt_0
)

138127 
¡em
(&
z
, "™žib", "bË", 
m_gt_0
);

138133  
	gz
[0] ){

138135 ifÐ!
¡em
(&
z
, "‘aci", "ic", 
m_gt_0
)

138136 && !
¡em
(&
z
, "ev™a", "", 
m_gt_0
)

138138 
¡em
(&
z
, "ezža", "®", 
m_gt_0
);

138142 
¡em
(&
z
, "™ici", "ic", 
m_gt_0
);

138145 ifÐ!
¡em
(&
z
, "Ïci", "ic", 
m_gt_0
) ){

138146 
¡em
(&
z
, "luf", "", 
m_gt_0
);

138150 
¡em
(&
z
, "s£n", "", 
m_gt_0
);

138155  
	gz
[1] ){

138157 ifÐ
z
[0]=='l' && 
m_gt_1
(z+2) ){

138158 
z
 += 2;

138162 ifÐ
z
[0]=='e' && z[2]=='n' && (z[3]=='a' || z[3]=='e'è&& 
m_gt_1
(z+4) ){

138163 
z
 += 4;

138167 ifÐ
z
[0]=='r' && 
m_gt_1
(z+2) ){

138168 
z
 += 2;

138172 ifÐ
z
[0]=='c' && 
m_gt_1
(z+2) ){

138173 
z
 += 2;

138177 ifÐ
z
[0]=='e' && z[2]=='b' && (z[3]=='a' || z[3]=='i'è&& 
m_gt_1
(z+4) ){

138178 
z
 += 4;

138182 ifÐ
z
[0]=='t' ){

138183 ifÐ
z
[2]=='a' ){

138184 ifÐ
m_gt_1
(
z
+3) ){

138185 
z
 += 3;

138187 }ifÐ
	gz
[2]=='e' ){

138188 ifÐ!
¡em
(&
z
, "Šeme", "", 
m_gt_1
)

138189 && !
¡em
(&
z
, "Šem", "", 
m_gt_1
)

138191 
¡em
(&
z
, "Še", "", 
m_gt_1
);

138197 ifÐ
z
[0]=='u' ){

138198 ifÐ
m_gt_1
(
z
+2) ){

138199 
z
 += 2;

138201 }ifÐ
	gz
[3]=='s' || 
z
[3]=='t' ){

138202 
¡em
(&
z
, "noi", "", 
m_gt_1
);

138206 ifÐ
z
[0]=='m' && z[2]=='i' && 
m_gt_1
(z+3) ){

138207 
z
 += 3;

138211 ifÐ!
¡em
(&
z
, "‘a", "", 
m_gt_1
) ){

138212 
¡em
(&
z
, "™i", "", 
m_gt_1
);

138216 ifÐ
z
[0]=='s' && z[2]=='o' && 
m_gt_1
(z+3) ){

138217 
z
 += 3;

138222 ifÐ
z
[0]=='e' && z[2]=='i' && 
m_gt_1
(z+3) ){

138223 
z
 += 3;

138229 ifÐ
	gz
[0]=='e' ){

138230 ifÐ
m_gt_1
(
z
+1) ){

138231 
z
++;

138232 }ifÐ
m_eq_1
(
z
+1è&& !
¡¬_oh
(z+1) ){

138233 
	gz
++;

138238 ifÐ
m_gt_1
(
z
è&& 
	gz
[0]=='l' && z[1]=='l' ){

138239 
z
++;

138245 *
	g²Out
 = 
i
 = ()
¡¾’
(
z
);

138246 
	gzOut
[
i
] = 0;

138247  *
	gz
 ){

138248 
	gzOut
[--
i
] = *(
z
++);

138258 cÚ¡ 
	gpÜ‹rIdCh¬
[] = {

138266 
	#isD–im
(
C
è(((
ch
=C)&0x80)==0 && (ch<0x30 || !
pÜ‹rIdCh¬
[ch-0x30]))

	)

138272 
pÜ‹rNext
(

138273 
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
,

138274 cÚ¡ **
pzTok’
,

138275 *
²By‹s
,

138276 *
piS¹Off£t
,

138277 *
piEndOff£t
,

138278 *
piPos™iÚ


138280 
pÜ‹r_tok’iz”_cursÜ
 *
	gc
 = (pÜ‹r_tok’iz”_cursÜ *è
pCursÜ
;

138281 cÚ¡ *
	gz
 = 
c
->
zIÅut
;

138283  
	gc
->
	giOff£t
<c->
	gnIÅut
 ){

138284 
	giS¹Off£t
, 
	gch
;

138287  
	gc
->
	giOff£t
<c->
	gnIÅut
 && 
isD–im
(
z
[
c
->
iOff£t
]) ){

138288 
	gc
->
	giOff£t
++;

138292 
	giS¹Off£t
 = 
c
->
iOff£t
;

138293  
	gc
->
	giOff£t
<c->
	gnIÅut
 && !
isD–im
(
z
[
c
->
iOff£t
]) ){

138294 
	gc
->
	giOff£t
++;

138297 ifÐ
	gc
->
	giOff£t
>
	giS¹Off£t
 ){

138298 
	gn
 = 
c
->
iOff£t
-
iS¹Off£t
;

138299 ifÐ
	gn
>
	gc
->
	gnAÎoÿ‹d
 ){

138300 *
	gpNew
;

138301 
	gc
->
	gnAÎoÿ‹d
 = 
n
+20;

138302 
	gpNew
 = 
sql™e3_»®loc
(
c
->
zTok’
, c->
nAÎoÿ‹d
);

138303 ifÐ!
	gpNew
 )  
	gSQLITE_NOMEM
;

138304 
	gc
->
	gzTok’
 = 
pNew
;

138306 
pÜ‹r_¡emm”
(&
z
[
iS¹Off£t
], 
n
, 
c
->
zTok’
, 
²By‹s
);

138307 *
	gpzTok’
 = 
c
->
zTok’
;

138308 *
	gpiS¹Off£t
 = 
iS¹Off£t
;

138309 *
	gpiEndOff£t
 = 
c
->
iOff£t
;

138310 *
	gpiPos™iÚ
 = 
c
->
iTok’
++;

138311  
	gSQLITE_OK
;

138314  
	gSQLITE_DONE
;

138320 cÚ¡ 
sql™e3_tok’iz”_moduË
 
	gpÜ‹rTok’iz”ModuË
 = {

138322 
pÜ‹rC»©e
,

138323 
pÜ‹rDe¡roy
,

138324 
pÜ‹rO³n
,

138325 
pÜ‹rClo£
,

138326 
pÜ‹rNext
,

138334 
SQLITE_PRIVATE
 
sql™e3Fts3PÜ‹rTok’iz”ModuË
(

138335 
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË


138337 *
	gµModuË
 = &
pÜ‹rTok’iz”ModuË
;

138369 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

138394 
sÿÏrFunc
(

138395 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

138396 
¬gc
,

138397 
sql™e3_v®ue
 **
¬gv


138399 
Fts3Hash
 *
	gpHash
;

138400 *
	gpPŒ
 = 0;

138401 cÚ¡ *
	gzName
;

138402 
	gnName
;

138404 
as£¹
Ð
¬gc
==1 ||‡rgc==2 );

138406 
	gpHash
 = (
Fts3Hash
 *)
sql™e3_u£r_d©a
(
cÚ‹xt
);

138408 
	gzName
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

138409 
	gnName
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0])+1;

138411 ifÐ
	g¬gc
==2 ){

138412 *
pOld
;

138413 
	gn
 = 
sql™e3_v®ue_by‹s
(
¬gv
[1]);

138414 ifÐ
	gn
!=(
pPŒ
) ){

138415 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "argumentype mismatch", -1);

138418 
	gpPŒ
 = *(**)
sql™e3_v®ue_blob
(
¬gv
[1]);

138419 
	gpOld
 = 
sql™e3Fts3HashIn£¹
(
pHash
, (*)
zName
, 
nName
, 
pPŒ
);

138420 ifÐ
	gpOld
==
pPŒ
 ){

138421 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "out of memory", -1);

138425 
	gpPŒ
 = 
sql™e3Fts3HashFšd
(
pHash
, 
zName
, 
nName
);

138426 ifÐ!
	gpPŒ
 ){

138427 *
	gzE¼
 = 
sql™e3_m´štf
("unknowÀtok’iz”: %s", 
zName
);

138428 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

138429 
sql™e3_ä“
(
zE¼
);

138434 
sql™e3_»suÉ_blob
(
cÚ‹xt
, (*)&
pPŒ
, ÕPŒ), 
SQLITE_TRANSIENT
);

138437 
SQLITE_PRIVATE
 
sql™e3Fts3IsIdCh¬
(
c
){

138438 cÚ¡ 
	gisFtsIdCh¬
[] = {

138448  (
	gc
&0x80 || 
	gisFtsIdCh¬
[()(
c
)]);

138451 
SQLITE_PRIVATE
 cÚ¡ *
sql™e3Fts3NextTok’
(cÚ¡ *
zSŒ
, *
²
){

138452 cÚ¡ *
	gz1
;

138453 cÚ¡ *
	gz2
 = 0;

138456 
	gz1
 = 
zSŒ
;

138457  
	gz2
==0 ){

138458 
c
 = *
z1
;

138459  
	gc
 ){

138464 
z2
 = 
z1
;

138465  *++
	gz2
 && (*z2!=
c
 || *++
z2
==c) );

138469 
z2
 = &
z1
[1];

138470  *
	gz2
 && z2[0]!=']' ) 
z2
++;

138471 ifÐ*
	gz2
 ) z2++;

138475 ifÐ
sql™e3Fts3IsIdCh¬
(*
z1
) ){

138476 
z2
 = &
z1
[1];

138477  
sql™e3Fts3IsIdCh¬
(*
z2
èè
	gz2
++;

138479 
	gz1
++;

138484 *
	g²
 = ()(
z2
-
z1
);

138485  
	gz1
;

138488 
SQLITE_PRIVATE
 
sql™e3Fts3In™Tok’iz”
(

138489 
Fts3Hash
 *
pHash
,

138490 cÚ¡ *
zArg
,

138491 
sql™e3_tok’iz”
 **
µTok
,

138492 **
pzE¼


138494 
	grc
;

138495 *
	gz
 = (*)
zArg
;

138496 
	gn
 = 0;

138497 *
	gzCÝy
;

138498 *
	gzEnd
;

138499 
sql™e3_tok’iz”_moduË
 *
	gm
;

138501 
	gzCÝy
 = 
sql™e3_m´štf
("%s", 
zArg
);

138502 ifÐ!
	gzCÝy
 )  
	gSQLITE_NOMEM
;

138503 
	gzEnd
 = &
zCÝy
[
¡¾’
(zCopy)];

138505 
	gz
 = (*)
sql™e3Fts3NextTok’
(
zCÝy
, &
n
);

138506 
	gz
[
n
] = '\0';

138507 
sql™e3Fts3DequÙe
(
z
);

138509 
	gm
 = (
sql™e3_tok’iz”_moduË
 *)
sql™e3Fts3HashFšd
(
pHash
,
z
,()
¡¾’
(z)+1);

138510 ifÐ!
	gm
 ){

138511 *
	gpzE¼
 = 
sql™e3_m´štf
("unknowÀtok’iz”: %s", 
z
);

138512 
	grc
 = 
SQLITE_ERROR
;

138514 cÚ¡ **
	gaArg
 = 0;

138515 
	giArg
 = 0;

138516 
	gz
 = &
z
[
n
+1];

138517  
	gz
<
	gzEnd
 && (
	gNULL
!=(
z
 = (*)
sql™e3Fts3NextTok’
(z, &
n
))) ){

138518 
	gnNew
 = (*)*(
iArg
+1);

138519 cÚ¡ **
	gaNew
 = (cÚ¡ **)
sql™e3_»®loc
((*)
aArg
, 
nNew
);

138520 ifÐ!
	gaNew
 ){

138521 
sql™e3_ä“
(
zCÝy
);

138522 
sql™e3_ä“
((*)
aArg
);

138523  
	gSQLITE_NOMEM
;

138525 
	gaArg
 = 
aNew
;

138526 
	gaArg
[
iArg
++] = 
z
;

138527 
	gz
[
n
] = '\0';

138528 
sql™e3Fts3DequÙe
(
z
);

138529 
	gz
 = &
z
[
n
+1];

138531 
	grc
 = 
m
->
xC»©e
(
iArg
, 
aArg
, 
µTok
);

138532 
as£¹
Ð
rc
!=
SQLITE_OK
 || *
µTok
 );

138533 ifÐ
	grc
!=
SQLITE_OK
 ){

138534 *
pzE¼
 = 
sql™e3_m´štf
("unknownokenizer");

138536 (*
	gµTok
)->
	gpModuË
 = 
m
;

138538 
sql™e3_ä“
((*)
aArg
);

138541 
sql™e3_ä“
(
zCÝy
);

138542  
	grc
;

138546 #ifdeà
SQLITE_TEST


138548 
	~<tþ.h
>

138576 
‹¡Func
(

138577 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

138578 
¬gc
,

138579 
sql™e3_v®ue
 **
¬gv


138581 
Fts3Hash
 *
	gpHash
;

138582 
sql™e3_tok’iz”_moduË
 *
	gp
;

138583 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 0;

138584 
sql™e3_tok’iz”_cursÜ
 *
	gpC¤
 = 0;

138586 cÚ¡ *
	gzE¼
 = 0;

138588 cÚ¡ *
	gzName
;

138589 
	gnName
;

138590 cÚ¡ *
	gzIÅut
;

138591 
	gnIÅut
;

138593 cÚ¡ *
	gazArg
[64];

138595 cÚ¡ *
	gzTok’
;

138596 
	gnTok’
 = 0;

138597 
	giS¹
 = 0;

138598 
	giEnd
 = 0;

138599 
	giPos
 = 0;

138600 
	gi
;

138602 
Tþ_Obj
 *
	gpR‘
;

138604 ifÐ
	g¬gc
<2 ){

138605 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "insufficient‡rguments", -1);

138609 
	gnName
 = 
sql™e3_v®ue_by‹s
(
¬gv
[0]);

138610 
	gzName
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[0]);

138611 
	gnIÅut
 = 
sql™e3_v®ue_by‹s
(
¬gv
[
¬gc
-1]);

138612 
	gzIÅut
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[
¬gc
-1]);

138614 
	gpHash
 = (
Fts3Hash
 *)
sql™e3_u£r_d©a
(
cÚ‹xt
);

138615 
	gp
 = (
sql™e3_tok’iz”_moduË
 *)
sql™e3Fts3HashFšd
(
pHash
, 
zName
, 
nName
+1);

138617 ifÐ!
	gp
 ){

138618 *
	gzE¼
 = 
sql™e3_m´štf
("unknowÀtok’iz”: %s", 
zName
);

138619 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

138620 
sql™e3_ä“
(
zE¼
);

138624 
	gpR‘
 = 
Tþ_NewObj
();

138625 
Tþ_InüRefCouÁ
(
pR‘
);

138627 
	gi
=1; i<
	g¬gc
-1; i++){

138628 
	gazArg
[
i
-1] = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
¬gv
[i]);

138631 ifÐ
	gSQLITE_OK
!=
p
->
xC»©e
(
¬gc
-2, 
azArg
, &
pTok’iz”
) ){

138632 
	gzE¼
 = "error in xCreate()";

138633 
	gfšish
;

138635 
	gpTok’iz”
->
	gpModuË
 = 
p
;

138636 ifÐ
sql™e3Fts3O³nTok’iz”
(
pTok’iz”
, 0, 
zIÅut
, 
nIÅut
, &
pC¤
) ){

138637 
	gzE¼
 = "error in xOpen()";

138638 
	gfšish
;

138641  
	gSQLITE_OK
==
p
->
xNext
(
pC¤
, &
zTok’
, &
nTok’
, &
iS¹
, &
iEnd
, &
iPos
) ){

138642 
Tþ_Li¡ObjAµ’dEËm’t
(0, 
pR‘
, 
Tþ_NewIÁObj
(
iPos
));

138643 
Tþ_Li¡ObjAµ’dEËm’t
(0, 
pR‘
, 
Tþ_NewSŒšgObj
(
zTok’
, 
nTok’
));

138644 
	gzTok’
 = &
zIÅut
[
iS¹
];

138645 
	gnTok’
 = 
iEnd
-
iS¹
;

138646 
Tþ_Li¡ObjAµ’dEËm’t
(0, 
pR‘
, 
Tþ_NewSŒšgObj
(
zTok’
, 
nTok’
));

138649 ifÐ
	gSQLITE_OK
!=
p
->
xClo£
(
pC¤
) ){

138650 
zE¼
 = "error in xClose()";

138651 
	gfšish
;

138653 ifÐ
	gSQLITE_OK
!=
p
->
xDe¡roy
(
pTok’iz”
) ){

138654 
zE¼
 = "error in xDestroy()";

138655 
	gfšish
;

138658 
	gfšish
:

138659 ifÐ
zE¼
 ){

138660 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, 
zE¼
, -1);

138662 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, 
Tþ_G‘SŒšg
(
pR‘
), -1, 
SQLITE_TRANSIENT
);

138664 
Tþ_DeüRefCouÁ
(
pR‘
);

138668 
»gi¡”Tok’iz”
(

138669 
sql™e3
 *
db
,

138670 *
zName
,

138671 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
p


138673 
	grc
;

138674 
sql™e3_¡mt
 *
	gpStmt
;

138675 cÚ¡ 
	gzSql
[] = "SELECT fts3_tokenizer(?, ?)";

138677 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
pStmt
, 0);

138678 ifÐ
	grc
!=
SQLITE_OK
 ){

138679  
rc
;

138682 
sql™e3_bšd_‹xt
(
pStmt
, 1, 
zName
, -1, 
SQLITE_STATIC
);

138683 
sql™e3_bšd_blob
(
pStmt
, 2, &
p
, Õ), 
SQLITE_STATIC
);

138684 
sql™e3_¡•
(
pStmt
);

138686  
sql™e3_fš®ize
(
pStmt
);

138690 
qu”yTok’iz”
(

138691 
sql™e3
 *
db
,

138692 *
zName
,

138693 cÚ¡ 
sql™e3_tok’iz”_moduË
 **
µ


138695 
	grc
;

138696 
sql™e3_¡mt
 *
	gpStmt
;

138697 cÚ¡ 
	gzSql
[] = "SELECT fts3_tokenizer(?)";

138699 *
	gµ
 = 0;

138700 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
pStmt
, 0);

138701 ifÐ
	grc
!=
SQLITE_OK
 ){

138702  
rc
;

138705 
sql™e3_bšd_‹xt
(
pStmt
, 1, 
zName
, -1, 
SQLITE_STATIC
);

138706 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

138707 ifÐ
sql™e3_cÞumn_ty³
(
pStmt
, 0)==
SQLITE_BLOB
 ){

138708 
memýy
((*)
µ
, 
sql™e3_cÞumn_blob
(
pStmt
, 0), (*pp));

138712  
sql™e3_fš®ize
(
pStmt
);

138715 
SQLITE_PRIVATE
 
sql™e3Fts3Sim¶eTok’iz”ModuË
(
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË
);

138735 
štTe¡Func
(

138736 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

138737 
¬gc
,

138738 
sql™e3_v®ue
 **
¬gv


138740 
	grc
;

138741 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gp1
;

138742 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gp2
;

138743 
sql™e3
 *
	gdb
 = (sql™e3 *)
sql™e3_u£r_d©a
(
cÚ‹xt
);

138745 
UNUSED_PARAMETER
(
¬gc
);

138746 
UNUSED_PARAMETER
(
¬gv
);

138749 
sql™e3Fts3Sim¶eTok’iz”ModuË
(&
p1
);

138750 
	grc
 = 
qu”yTok’iz”
(
db
, "sim¶e", &
p2
);

138751 
as£¹
Ð
rc
==
SQLITE_OK
 );

138752 
as£¹
Ð
p1
==
p2
 );

138753 
	grc
 = 
qu”yTok’iz”
(
db
, "nosuchtok’iz”", &
p2
);

138754 
as£¹
Ð
rc
==
SQLITE_ERROR
 );

138755 
as£¹
Ð
p2
==0 );

138756 
as£¹
Ð0==
¡rcmp
(
sql™e3_”rmsg
(
db
), "unknownokenizer:‚osuchtokenizer") );

138759 
	grc
 = 
»gi¡”Tok’iz”
(
db
, "nosuchtok’iz”", 
p1
);

138760 
as£¹
Ð
rc
==
SQLITE_OK
 );

138761 
	grc
 = 
qu”yTok’iz”
(
db
, "nosuchtok’iz”", &
p2
);

138762 
as£¹
Ð
rc
==
SQLITE_OK
 );

138763 
as£¹
Ð
p2
==
p1
 );

138765 
sql™e3_»suÉ_‹xt
(
cÚ‹xt
, "ok", -1, 
SQLITE_STATIC
);

138787 
SQLITE_PRIVATE
 
sql™e3Fts3In™HashTabË
(

138788 
sql™e3
 *
db
,

138789 
Fts3Hash
 *
pHash
,

138790 cÚ¡ *
zName


138792 
	grc
 = 
SQLITE_OK
;

138793 *
	gp
 = (*)
pHash
;

138794 cÚ¡ 
	gªy
 = 
SQLITE_ANY
;

138796 #ifdeà
SQLITE_TEST


138797 *
	gzTe¡
 = 0;

138798 *
	gzTe¡2
 = 0;

138799 *
	gpdb
 = (*)
db
;

138800 
	gzTe¡
 = 
sql™e3_m´štf
("%s_‹¡", 
zName
);

138801 
	gzTe¡2
 = 
sql™e3_m´štf
("%s_š‹º®_‹¡", 
zName
);

138802 ifÐ!
	gzTe¡
 || !
	gzTe¡2
 ){

138803 
	grc
 = 
SQLITE_NOMEM
;

138807 ifÐ
	gSQLITE_OK
==
rc
 ){

138808 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, 
zName
, 1, 
ªy
, 
p
, 
sÿÏrFunc
, 0, 0);

138810 ifÐ
	gSQLITE_OK
==
rc
 ){

138811 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, 
zName
, 2, 
ªy
, 
p
, 
sÿÏrFunc
, 0, 0);

138813 #ifdeà
SQLITE_TEST


138814 ifÐ
	gSQLITE_OK
==
rc
 ){

138815 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, 
zTe¡
, -1, 
ªy
, 
p
, 
‹¡Func
, 0, 0);

138817 ifÐ
	gSQLITE_OK
==
rc
 ){

138818 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, 
zTe¡2
, 0, 
ªy
, 
pdb
, 
štTe¡Func
, 0, 0);

138822 #ifdeà
SQLITE_TEST


138823 
sql™e3_ä“
(
zTe¡
);

138824 
sql™e3_ä“
(
zTe¡2
);

138827  
	grc
;

138858 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

138866 
	ssim¶e_tok’iz”
 {

138867 
sql™e3_tok’iz”
 
	gba£
;

138868 
	gd–im
[128];

138869 } 
	tsim¶e_tok’iz”
;

138871 
	ssim¶e_tok’iz”_cursÜ
 {

138872 
sql™e3_tok’iz”_cursÜ
 
	gba£
;

138873 cÚ¡ *
	gpIÅut
;

138874 
	gnBy‹s
;

138875 
	giOff£t
;

138876 
	giTok’
;

138877 *
	gpTok’
;

138878 
	gnTok’AÎoÿ‹d
;

138879 } 
	tsim¶e_tok’iz”_cursÜ
;

138882 
sim¶eD–im
(
sim¶e_tok’iz”
 *
t
, 
c
){

138883  
	gc
<0x80 && 
	gt
->
	gd–im
[
c
];

138885 
ás3_i§Êum
(
x
){

138886  (
	gx
>='0' && 
x
<='9') || (x>='A' && x<='Z') || (x>='a' && x<='z');

138892 
sim¶eC»©e
(

138893 
¬gc
, cÚ¡ * cÚ¡ *
¬gv
,

138894 
sql™e3_tok’iz”
 **
µTok’iz”


138896 
sim¶e_tok’iz”
 *
	gt
;

138898 
	gt
 = (
sim¶e_tok’iz”
 *è
sql™e3_m®loc
((*
t
));

138899 ifÐ
	gt
==
NULL
 )  
SQLITE_NOMEM
;

138900 
mem£t
(
t
, 0, (*t));

138907 ifÐ
	g¬gc
>1 ){

138908 
	gi
, 
	gn
 = ()
¡¾’
(
¬gv
[1]);

138909 
	gi
=0; i<
	gn
; i++){

138910 
	gch
 = 
¬gv
[1][
i
];

138912 ifÐ
	gch
>=0x80 ){

138913 
sql™e3_ä“
(
t
);

138914  
	gSQLITE_ERROR
;

138916 
	gt
->
	gd–im
[
ch
] = 1;

138920 
	gi
;

138921 
	gi
=1; i<0x80; i++){

138922 
	gt
->
	gd–im
[
i
] = !
ás3_i§Êum
(i) ? -1 : 0;

138926 *
	gµTok’iz”
 = &
t
->
ba£
;

138927  
	gSQLITE_OK
;

138933 
sim¶eDe¡roy
(
sql™e3_tok’iz”
 *
pTok’iz”
){

138934 
sql™e3_ä“
(
pTok’iz”
);

138935  
	gSQLITE_OK
;

138944 
sim¶eO³n
(

138945 
sql™e3_tok’iz”
 *
pTok’iz”
,

138946 cÚ¡ *
pIÅut
, 
nBy‹s
,

138947 
sql™e3_tok’iz”_cursÜ
 **
µCursÜ


138949 
sim¶e_tok’iz”_cursÜ
 *
	gc
;

138951 
UNUSED_PARAMETER
(
pTok’iz”
);

138953 
	gc
 = (
sim¶e_tok’iz”_cursÜ
 *è
sql™e3_m®loc
((*
c
));

138954 ifÐ
	gc
==
NULL
 )  
SQLITE_NOMEM
;

138956 
	gc
->
	gpIÅut
 = 
pIÅut
;

138957 ifÐ
	gpIÅut
==0 ){

138958 
c
->
nBy‹s
 = 0;

138959 }ifÐ
	gnBy‹s
<0 ){

138960 
	gc
->
	gnBy‹s
 = ()
¡¾’
(
pIÅut
);

138962 
	gc
->
	gnBy‹s
 = 
nBy‹s
;

138964 
	gc
->
	giOff£t
 = 0;

138965 
	gc
->
	giTok’
 = 0;

138966 
	gc
->
	gpTok’
 = 
NULL
;

138967 
	gc
->
	gnTok’AÎoÿ‹d
 = 0;

138969 *
	gµCursÜ
 = &
c
->
ba£
;

138970  
	gSQLITE_OK
;

138977 
sim¶eClo£
(
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
){

138978 
sim¶e_tok’iz”_cursÜ
 *
	gc
 = (sim¶e_tok’iz”_cursÜ *è
pCursÜ
;

138979 
sql™e3_ä“
(
c
->
pTok’
);

138980 
sql™e3_ä“
(
c
);

138981  
	gSQLITE_OK
;

138988 
sim¶eNext
(

138989 
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
,

138990 cÚ¡ **
µTok’
,

138991 *
²By‹s
,

138992 *
piS¹Off£t
,

138993 *
piEndOff£t
,

138994 *
piPos™iÚ


138996 
sim¶e_tok’iz”_cursÜ
 *
	gc
 = (sim¶e_tok’iz”_cursÜ *è
pCursÜ
;

138997 
sim¶e_tok’iz”
 *
	gt
 = (sim¶e_tok’iz” *è
pCursÜ
->
pTok’iz”
;

138998 *
	gp
 = (*)
c
->
pIÅut
;

139000  
	gc
->
	giOff£t
<c->
	gnBy‹s
 ){

139001 
	giS¹Off£t
;

139004  
	gc
->
	giOff£t
<c->
	gnBy‹s
 && 
sim¶eD–im
(
t
, 
p
[
c
->
iOff£t
]) ){

139005 
	gc
->
	giOff£t
++;

139009 
	giS¹Off£t
 = 
c
->
iOff£t
;

139010  
	gc
->
	giOff£t
<c->
	gnBy‹s
 && !
sim¶eD–im
(
t
, 
p
[
c
->
iOff£t
]) ){

139011 
	gc
->
	giOff£t
++;

139014 ifÐ
	gc
->
	giOff£t
>
	giS¹Off£t
 ){

139015 
	gi
, 
	gn
 = 
c
->
iOff£t
-
iS¹Off£t
;

139016 ifÐ
	gn
>
	gc
->
	gnTok’AÎoÿ‹d
 ){

139017 *
	gpNew
;

139018 
	gc
->
	gnTok’AÎoÿ‹d
 = 
n
+20;

139019 
	gpNew
 = 
sql™e3_»®loc
(
c
->
pTok’
, c->
nTok’AÎoÿ‹d
);

139020 ifÐ!
	gpNew
 )  
	gSQLITE_NOMEM
;

139021 
	gc
->
	gpTok’
 = 
pNew
;

139023 
	gi
=0; i<
	gn
; i++){

139027 
	gch
 = 
p
[
iS¹Off£t
+
i
];

139028 
	gc
->
	gpTok’
[
i
] = ()((
ch
>='A' && ch<='Z') ? ch-'A'+'a' : ch);

139030 *
	gµTok’
 = 
c
->
pTok’
;

139031 *
	g²By‹s
 = 
n
;

139032 *
	gpiS¹Off£t
 = 
iS¹Off£t
;

139033 *
	gpiEndOff£t
 = 
c
->
iOff£t
;

139034 *
	gpiPos™iÚ
 = 
c
->
iTok’
++;

139036  
	gSQLITE_OK
;

139039  
	gSQLITE_DONE
;

139045 cÚ¡ 
sql™e3_tok’iz”_moduË
 
	gsim¶eTok’iz”ModuË
 = {

139047 
sim¶eC»©e
,

139048 
sim¶eDe¡roy
,

139049 
sim¶eO³n
,

139050 
sim¶eClo£
,

139051 
sim¶eNext
,

139059 
SQLITE_PRIVATE
 
sql™e3Fts3Sim¶eTok’iz”ModuË
(

139060 
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË


139062 *
	gµModuË
 = &
sim¶eTok’iz”ModuË
;

139109 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

139114 
Fts3tokTabË
 
	tFts3tokTabË
;

139115 
Fts3tokCursÜ
 
	tFts3tokCursÜ
;

139120 
	sFts3tokTabË
 {

139121 
sql™e3_vb
 
	gba£
;

139122 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpMod
;

139123 
sql™e3_tok’iz”
 *
	gpTok
;

139129 
	sFts3tokCursÜ
 {

139130 
sql™e3_vb_cursÜ
 
	gba£
;

139131 *
	gzIÅut
;

139132 
sql™e3_tok’iz”_cursÜ
 *
	gpC¤
;

139133 
	giRowid
;

139134 cÚ¡ *
	gzTok’
;

139135 
	gnTok’
;

139136 
	giS¹
;

139137 
	giEnd
;

139138 
	giPos
;

139144 
ás3tokQu”yTok’iz”
(

139145 
Fts3Hash
 *
pHash
,

139146 cÚ¡ *
zName
,

139147 cÚ¡ 
sql™e3_tok’iz”_moduË
 **
µ
,

139148 **
pzE¼


139150 
sql™e3_tok’iz”_moduË
 *
	gp
;

139151 
	gnName
 = ()
¡¾’
(
zName
);

139153 
	gp
 = (
sql™e3_tok’iz”_moduË
 *)
sql™e3Fts3HashFšd
(
pHash
, 
zName
, 
nName
+1);

139154 ifÐ!
	gp
 ){

139155 *
	gpzE¼
 = 
sql™e3_m´štf
("unknowÀtok’iz”: %s", 
zName
);

139156  
	gSQLITE_ERROR
;

139159 *
	gµ
 = 
p
;

139160  
	gSQLITE_OK
;

139175 
ás3tokDequÙeA¼ay
(

139176 
¬gc
,

139177 cÚ¡ * cÚ¡ *
¬gv
,

139178 ***
·zDequÙe


139180 
	grc
 = 
SQLITE_OK
;

139181 ifÐ
	g¬gc
==0 ){

139182 *
·zDequÙe
 = 0;

139184 
	gi
;

139185 
	gnBy‹
 = 0;

139186 **
	gazDequÙe
;

139188 
	gi
=0; i<
	g¬gc
; i++){

139189 
	gnBy‹
 +ð()(
¡¾’
(
¬gv
[
i
]) + 1);

139192 *
	g·zDequÙe
 = 
azDequÙe
 = 
sql™e3_m®loc
((*)*
¬gc
 + 
nBy‹
);

139193 ifÐ
	gazDequÙe
==0 ){

139194 
rc
 = 
SQLITE_NOMEM
;

139196 *
	gpS·û
 = (*)&
azDequÙe
[
¬gc
];

139197 
	gi
=0; i<
	g¬gc
; i++){

139198 
	gn
 = ()
¡¾’
(
¬gv
[
i
]);

139199 
	gazDequÙe
[
i
] = 
pS·û
;

139200 
memýy
(
pS·û
, 
¬gv
[
i
], 
n
+1);

139201 
sql™e3Fts3DequÙe
(
pS·û
);

139202 
	gpS·û
 +ð(
n
+1);

139207  
	grc
;

139213 
	#FTS3_TOK_SCHEMA
 "CREATE TABLE x(šput,ok’, s¹,ƒnd,…os™iÚ)"

	)

139225 
ás3tokCÚÃùM‘hod
(

139226 
sql™e3
 *
db
,

139227 *
pHash
,

139228 
¬gc
,

139229 cÚ¡ * cÚ¡ *
¬gv
,

139230 
sql™e3_vb
 **
µVb
,

139231 **
pzE¼


139233 
Fts3tokTabË
 *
	gpTab
;

139234 cÚ¡ 
sql™e3_tok’iz”_moduË
 *
	gpMod
 = 0;

139235 
sql™e3_tok’iz”
 *
	gpTok
 = 0;

139236 
	grc
;

139237 **
	gazDequÙe
 = 0;

139238 
	gnDequÙe
;

139240 
	grc
 = 
sql™e3_deþ¬e_vb
(
db
, 
FTS3_TOK_SCHEMA
);

139241 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

139243 
	gnDequÙe
 = 
¬gc
-3;

139244 
	grc
 = 
ás3tokDequÙeA¼ay
(
nDequÙe
, &
¬gv
[3], &
azDequÙe
);

139246 ifÐ
	grc
==
SQLITE_OK
 ){

139247 cÚ¡ *
zModuË
;

139248 ifÐ
	gnDequÙe
<1 ){

139249 
	gzModuË
 = "simple";

139251 
	gzModuË
 = 
azDequÙe
[0];

139253 
	grc
 = 
ás3tokQu”yTok’iz”
((
Fts3Hash
*)
pHash
, 
zModuË
, &
pMod
, 
pzE¼
);

139256 
as£¹
Ð(
rc
==
SQLITE_OK
)==(
pMod
!=0) );

139257 ifÐ
	grc
==
SQLITE_OK
 ){

139258 cÚ¡ * cÚ¡ *
azArg
 = (cÚ¡ * cÚ¡ *)&
azDequÙe
[1];

139259 
	grc
 = 
pMod
->
xC»©e
((
nDequÙe
>1 ?‚DequÙe-1 : 0), 
azArg
, &
pTok
);

139262 ifÐ
	grc
==
SQLITE_OK
 ){

139263 
pTab
 = (
Fts3tokTabË
 *)
sql™e3_m®loc
((Fts3tokTable));

139264 ifÐ
	gpTab
==0 ){

139265 
rc
 = 
SQLITE_NOMEM
;

139269 ifÐ
	grc
==
SQLITE_OK
 ){

139270 
mem£t
(
pTab
, 0, (
Fts3tokTabË
));

139271 
	gpTab
->
	gpMod
 = 
pMod
;

139272 
	gpTab
->
	gpTok
 = 
pTok
;

139273 *
	gµVb
 = &
pTab
->
ba£
;

139275 ifÐ
	gpTok
 ){

139276 
	gpMod
->
xDe¡roy
(
pTok
);

139280 
sql™e3_ä“
(
azDequÙe
);

139281  
	grc
;

139289 
ás3tokDiscÚÃùM‘hod
(
sql™e3_vb
 *
pVb
){

139290 
Fts3tokTabË
 *
	gpTab
 = (Fts3tokTabË *)
pVb
;

139292 
	gpTab
->
	gpMod
->
xDe¡roy
(
pTab
->
pTok
);

139293 
sql™e3_ä“
(
pTab
);

139294  
	gSQLITE_OK
;

139300 
ás3tokBe¡IndexM‘hod
(

139301 
sql™e3_vb
 *
pVTab
,

139302 
sql™e3_šdex_šfo
 *
pInfo


139304 
	gi
;

139305 
UNUSED_PARAMETER
(
pVTab
);

139307 
	gi
=0; i<
	gpInfo
->
	gnCÚ¡¿št
; i++){

139308 ifÐ
	gpInfo
->
	gaCÚ¡¿št
[
i
].
	gu§bË


139309 && 
	gpInfo
->
	gaCÚ¡¿št
[
i
].
	giCÞumn
==0

139310 && 
pInfo
->
aCÚ¡¿št
[
i
].
Ý
==
SQLITE_INDEX_CONSTRAINT_EQ


139312 
pInfo
->
idxNum
 = 1;

139313 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
i
].
	g¬gvIndex
 = 1;

139314 
	gpInfo
->
	gaCÚ¡¿štU§ge
[
i
].
	gom™
 = 1;

139315 
	gpInfo
->
	ge¡im©edCo¡
 = 1;

139316  
	gSQLITE_OK
;

139320 
	gpInfo
->
	gidxNum
 = 0;

139321 
as£¹
Ð
pInfo
->
e¡im©edCo¡
>1000000.0 );

139323  
	gSQLITE_OK
;

139329 
ás3tokO³nM‘hod
(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µC¤
){

139330 
Fts3tokCursÜ
 *
	gpC¤
;

139331 
UNUSED_PARAMETER
(
pVTab
);

139333 
	gpC¤
 = (
Fts3tokCursÜ
 *)
sql™e3_m®loc
((Fts3tokCursor));

139334 ifÐ
	gpC¤
==0 ){

139335  
SQLITE_NOMEM
;

139337 
mem£t
(
pC¤
, 0, (
Fts3tokCursÜ
));

139339 *
	gµC¤
 = (
sql™e3_vb_cursÜ
 *)
pC¤
;

139340  
	gSQLITE_OK
;

139347 
ás3tokRe£tCursÜ
(
Fts3tokCursÜ
 *
pC¤
){

139348 ifÐ
	gpC¤
->pCsr ){

139349 
Fts3tokTabË
 *
	gpTab
 = (Fts3tokTabË *)(
pC¤
->
ba£
.
pVb
);

139350 
	gpTab
->
	gpMod
->
xClo£
(
pC¤
->pCsr);

139351 
	gpC¤
->pCsr = 0;

139353 
sql™e3_ä“
(
pC¤
->
zIÅut
);

139354 
	gpC¤
->
	gzIÅut
 = 0;

139355 
	gpC¤
->
	gzTok’
 = 0;

139356 
	gpC¤
->
	gnTok’
 = 0;

139357 
	gpC¤
->
	giS¹
 = 0;

139358 
	gpC¤
->
	giEnd
 = 0;

139359 
	gpC¤
->
	giPos
 = 0;

139360 
	gpC¤
->
	giRowid
 = 0;

139366 
ás3tokClo£M‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

139367 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139369 
ás3tokRe£tCursÜ
(
pC¤
);

139370 
sql™e3_ä“
(
pC¤
);

139371  
	gSQLITE_OK
;

139377 
ás3tokNextM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

139378 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139379 
Fts3tokTabË
 *
	gpTab
 = (Fts3tokTabË *)(
pCursÜ
->
pVb
);

139380 
	grc
;

139382 
	gpC¤
->
	giRowid
++;

139383 
	grc
 = 
pTab
->
pMod
->
xNext
(
pC¤
->pCsr,

139384 &
pC¤
->
zTok’
, &pC¤->
nTok’
,

139385 &
pC¤
->
iS¹
, &pC¤->
iEnd
, &pC¤->
iPos


139388 ifÐ
	grc
!=
SQLITE_OK
 ){

139389 
ás3tokRe£tCursÜ
(
pC¤
);

139390 ifÐ
	grc
==
SQLITE_DONE
 ) 
rc
 = 
SQLITE_OK
;

139393  
	grc
;

139399 
ás3tokFž‹rM‘hod
(

139400 
sql™e3_vb_cursÜ
 *
pCursÜ
,

139401 
idxNum
,

139402 cÚ¡ *
idxSŒ
,

139403 
nV®
,

139404 
sql™e3_v®ue
 **
­V®


139406 
	grc
 = 
SQLITE_ERROR
;

139407 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139408 
Fts3tokTabË
 *
	gpTab
 = (Fts3tokTabË *)(
pCursÜ
->
pVb
);

139409 
UNUSED_PARAMETER
(
idxSŒ
);

139410 
UNUSED_PARAMETER
(
nV®
);

139412 
ás3tokRe£tCursÜ
(
pC¤
);

139413 ifÐ
	gidxNum
==1 ){

139414 cÚ¡ *
zBy‹
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[0]);

139415 
	gnBy‹
 = 
sql™e3_v®ue_by‹s
(
­V®
[0]);

139416 
	gpC¤
->
	gzIÅut
 = 
sql™e3_m®loc
(
nBy‹
+1);

139417 ifÐ
	gpC¤
->
	gzIÅut
==0 ){

139418 
rc
 = 
SQLITE_NOMEM
;

139420 
memýy
(
pC¤
->
zIÅut
, 
zBy‹
, 
nBy‹
);

139421 
	gpC¤
->
	gzIÅut
[
nBy‹
] = 0;

139422 
	grc
 = 
pTab
->
pMod
->
xO³n
ÕTab->
pTok
, 
pC¤
->
zIÅut
, 
nBy‹
, &pCsr->pCsr);

139423 ifÐ
	grc
==
SQLITE_OK
 ){

139424 
pC¤
->pC¤->
pTok’iz”
 = 
pTab
->
pTok
;

139429 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

139430  
ás3tokNextM‘hod
(
pCursÜ
);

139436 
ás3tokEofM‘hod
(
sql™e3_vb_cursÜ
 *
pCursÜ
){

139437 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139438  (
	gpC¤
->
	gzTok’
==0);

139444 
ás3tokCÞumnM‘hod
(

139445 
sql™e3_vb_cursÜ
 *
pCursÜ
,

139446 
sql™e3_cÚ‹xt
 *
pCtx
,

139447 
iCÞ


139449 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139452  
	giCÞ
 ){

139454 
sql™e3_»suÉ_‹xt
(
pCtx
, 
pC¤
->
zIÅut
, -1, 
SQLITE_TRANSIENT
);

139457 
sql™e3_»suÉ_‹xt
(
pCtx
, 
pC¤
->
zTok’
,…C¤->
nTok’
, 
SQLITE_TRANSIENT
);

139460 
sql™e3_»suÉ_št
(
pCtx
, 
pC¤
->
iS¹
);

139463 
sql™e3_»suÉ_št
(
pCtx
, 
pC¤
->
iEnd
);

139466 
as£¹
Ð
iCÞ
==4 );

139467 
sql™e3_»suÉ_št
(
pCtx
, 
pC¤
->
iPos
);

139470  
	gSQLITE_OK
;

139476 
ás3tokRowidM‘hod
(

139477 
sql™e3_vb_cursÜ
 *
pCursÜ
,

139478 
sql™e_št64
 *
pRowid


139480 
Fts3tokCursÜ
 *
	gpC¤
 = (Fts3tokCursÜ *)
pCursÜ
;

139481 *
	gpRowid
 = (
sql™e3_št64
)
pC¤
->
iRowid
;

139482  
	gSQLITE_OK
;

139489 
SQLITE_PRIVATE
 
sql™e3Fts3In™Tok
(
sql™e3
 *
db
, 
Fts3Hash
 *
pHash
){

139490 cÚ¡ 
sql™e3_moduË
 
	gás3tok_moduË
 = {

139492 
ás3tokCÚÃùM‘hod
,

139493 
ás3tokCÚÃùM‘hod
,

139494 
ás3tokBe¡IndexM‘hod
,

139495 
ás3tokDiscÚÃùM‘hod
,

139496 
ás3tokDiscÚÃùM‘hod
,

139497 
ás3tokO³nM‘hod
,

139498 
ás3tokClo£M‘hod
,

139499 
ás3tokFž‹rM‘hod
,

139500 
ás3tokNextM‘hod
,

139501 
ás3tokEofM‘hod
,

139502 
ás3tokCÞumnM‘hod
,

139503 
ás3tokRowidM‘hod
,

139515 
	grc
;

139517 
	grc
 = 
sql™e3_ü—‹_moduË
(
db
, "ás3tok’ize", &
ás3tok_moduË
, (*)
pHash
);

139518  
	grc
;

139544 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

139551 
	#FTS_MAX_APPENDABLE_HEIGHT
 16

	)

139563 
	#FTS3_NODE_PADDING
 (
FTS3_VARINT_MAX
*2)

	)

139582 #ifdeà
SQLITE_TEST


139583 
	g‹¡_ás3_node_chunksize
 = (4*1024);

139584 
	g‹¡_ás3_node_chunk_th»shÞd
 = (4*1024)*4;

139585 
	#FTS3_NODE_CHUNKSIZE
 
‹¡_ás3_node_chunksize


	)

139586 
	#FTS3_NODE_CHUNK_THRESHOLD
 
‹¡_ás3_node_chunk_th»shÞd


	)

139588 
	#FTS3_NODE_CHUNKSIZE
 (4*1024)

	)

139589 
	#FTS3_NODE_CHUNK_THRESHOLD
 (
FTS3_NODE_CHUNKSIZE
*4)

	)

139596 
	#FTS_STAT_DOCTOTAL
 0

	)

139597 
	#FTS_STAT_INCRMERGEHINT
 1

	)

139598 
	#FTS_STAT_AUTOINCRMERGE
 2

	)

139606 #ifdeà
FTS3_LOG_MERGES


139607 
ás3LogM”ge
(
nM”ge
, 
sql™e3_št64
 
iAbsLev–
){

139608 
sql™e3_log
(
SQLITE_OK
, "%d-way m”gäom†ev– %d", 
nM”ge
, ()
iAbsLev–
);

139611 
	#ás3LogM”ge
(
x
, 
y
)

	)

139615 
P’dšgLi¡
 
	tP’dšgLi¡
;

139616 
Segm’tNode
 
	tSegm’tNode
;

139617 
Segm’tWr™”
 
	tSegm’tWr™”
;

139623 
	sP’dšgLi¡
 {

139624 
	gnD©a
;

139625 *
	gaD©a
;

139626 
	gnS·û
;

139627 
sql™e3_št64
 
	giLa¡Docid
;

139628 
sql™e3_št64
 
	giLa¡CÞ
;

139629 
sql™e3_št64
 
	giLa¡Pos
;

139636 
	sFts3Deã¼edTok’
 {

139637 
Fts3Ph¿£Tok’
 *
	gpTok’
;

139638 
	giCÞ
;

139639 
Fts3Deã¼edTok’
 *
	gpNext
;

139640 
P’dšgLi¡
 *
	gpLi¡
;

139660 
	sFts3SegR—d”
 {

139661 
	giIdx
;

139662 
u8
 
	gbLookup
;

139663 
u8
 
	groÙOÆy
;

139665 
sql™e3_št64
 
	giS¹Block
;

139666 
sql™e3_št64
 
	giL—fEndBlock
;

139667 
sql™e3_št64
 
	giEndBlock
;

139668 
sql™e3_št64
 
	giCu¼’tBlock
;

139670 *
	gaNode
;

139671 
	gnNode
;

139672 
	gnPÝuÏ‹
;

139673 
sql™e3_blob
 *
	gpBlob
;

139675 
Fts3HashEËm
 **
	gµNextEËm
;

139682 
	gnT”m
;

139683 *
	gzT”m
;

139684 
	gnT”mAÎoc
;

139685 *
	gaDoþi¡
;

139686 
	gnDoþi¡
;

139691 *
	gpOff£tLi¡
;

139692 
	gnOff£tLi¡
;

139693 
sql™e3_št64
 
	giDocid
;

139696 
	#ás3SegR—d”IsP’dšg
(
p
è(Õ)->
µNextEËm
!=0)

	)

139697 
	#ás3SegR—d”IsRoÙOÆy
(
p
è(Õ)->
roÙOÆy
!=0)

	)

139708 
	sSegm’tWr™”
 {

139709 
Segm’tNode
 *
	gpT»e
;

139710 
sql™e3_št64
 
	giFœ¡
;

139711 
sql™e3_št64
 
	giF»e
;

139712 *
	gzT”m
;

139713 
	gnT”m
;

139714 
	gnM®loc
;

139715 *
	gzM®loc
;

139716 
	gnSize
;

139717 
	gnD©a
;

139718 *
	gaD©a
;

139719 
i64
 
	gnL—fD©a
;

139740 
	sSegm’tNode
 {

139741 
Segm’tNode
 *
	gpP¬’t
;

139742 
Segm’tNode
 *
	gpRight
;

139743 
Segm’tNode
 *
	gpLeámo¡
;

139744 
	gnEÁry
;

139745 *
	gzT”m
;

139746 
	gnT”m
;

139747 
	gnM®loc
;

139748 *
	gzM®loc
;

139749 
	gnD©a
;

139750 *
	gaD©a
;

139756 
	#SQL_DELETE_CONTENT
 0

	)

139757 
	#SQL_IS_EMPTY
 1

	)

139758 
	#SQL_DELETE_ALL_CONTENT
 2

	)

139759 
	#SQL_DELETE_ALL_SEGMENTS
 3

	)

139760 
	#SQL_DELETE_ALL_SEGDIR
 4

	)

139761 
	#SQL_DELETE_ALL_DOCSIZE
 5

	)

139762 
	#SQL_DELETE_ALL_STAT
 6

	)

139763 
	#SQL_SELECT_CONTENT_BY_ROWID
 7

	)

139764 
	#SQL_NEXT_SEGMENT_INDEX
 8

	)

139765 
	#SQL_INSERT_SEGMENTS
 9

	)

139766 
	#SQL_NEXT_SEGMENTS_ID
 10

	)

139767 
	#SQL_INSERT_SEGDIR
 11

	)

139768 
	#SQL_SELECT_LEVEL
 12

	)

139769 
	#SQL_SELECT_LEVEL_RANGE
 13

	)

139770 
	#SQL_SELECT_LEVEL_COUNT
 14

	)

139771 
	#SQL_SELECT_SEGDIR_MAX_LEVEL
 15

	)

139772 
	#SQL_DELETE_SEGDIR_LEVEL
 16

	)

139773 
	#SQL_DELETE_SEGMENTS_RANGE
 17

	)

139774 
	#SQL_CONTENT_INSERT
 18

	)

139775 
	#SQL_DELETE_DOCSIZE
 19

	)

139776 
	#SQL_REPLACE_DOCSIZE
 20

	)

139777 
	#SQL_SELECT_DOCSIZE
 21

	)

139778 
	#SQL_SELECT_STAT
 22

	)

139779 
	#SQL_REPLACE_STAT
 23

	)

139781 
	#SQL_SELECT_ALL_PREFIX_LEVEL
 24

	)

139782 
	#SQL_DELETE_ALL_TERMS_SEGDIR
 25

	)

139783 
	#SQL_DELETE_SEGDIR_RANGE
 26

	)

139784 
	#SQL_SELECT_ALL_LANGID
 27

	)

139785 
	#SQL_FIND_MERGE_LEVEL
 28

	)

139786 
	#SQL_MAX_LEAF_NODE_ESTIMATE
 29

	)

139787 
	#SQL_DELETE_SEGDIR_ENTRY
 30

	)

139788 
	#SQL_SHIFT_SEGDIR_ENTRY
 31

	)

139789 
	#SQL_SELECT_SEGDIR
 32

	)

139790 
	#SQL_CHOMP_SEGDIR
 33

	)

139791 
	#SQL_SEGMENT_IS_APPENDABLE
 34

	)

139792 
	#SQL_SELECT_INDEXES
 35

	)

139793 
	#SQL_SELECT_MXLEVEL
 36

	)

139795 
	#SQL_SELECT_LEVEL_RANGE2
 37

	)

139796 
	#SQL_UPDATE_LEVEL_IDX
 38

	)

139797 
	#SQL_UPDATE_LEVEL
 39

	)

139810 
ás3SqlStmt
(

139811 
Fts3TabË
 *
p
,

139812 
eStmt
,

139813 
sql™e3_¡mt
 **
µ
,

139814 
sql™e3_v®ue
 **
­V®


139816 cÚ¡ *
	gazSql
[] = {

139913 
	grc
 = 
SQLITE_OK
;

139914 
sql™e3_¡mt
 *
	gpStmt
;

139916 
as£¹
Ð
SizeofA¼ay
(
azSql
)==SizeofA¼ay(
p
->
aStmt
) );

139917 
as£¹
Ð
eStmt
<
SizeofA¼ay
(
azSql
) &&ƒStmt>=0 );

139919 
	gpStmt
 = 
p
->
aStmt
[
eStmt
];

139920 ifÐ!
	gpStmt
 ){

139921 *
	gzSql
;

139922 ifÐ
	geStmt
==
SQL_CONTENT_INSERT
 ){

139923 
zSql
 = 
sql™e3_m´štf
(
azSql
[
eStmt
], 
p
->
zDb
,…->
zName
,…->
zWr™eEx´li¡
);

139924 }ifÐ
	geStmt
==
SQL_SELECT_CONTENT_BY_ROWID
 ){

139925 
zSql
 = 
sql™e3_m´štf
(
azSql
[
eStmt
], 
p
->
zR—dEx´li¡
);

139927 
	gzSql
 = 
sql™e3_m´štf
(
azSql
[
eStmt
], 
p
->
zDb
,…->
zName
);

139929 ifÐ!
	gzSql
 ){

139930 
	grc
 = 
SQLITE_NOMEM
;

139932 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pStmt
, 
NULL
);

139933 
sql™e3_ä“
(
zSql
);

139934 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pStmt
==0 );

139935 
	gp
->
	gaStmt
[
eStmt
] = 
pStmt
;

139938 ifÐ
	g­V®
 ){

139939 
	gi
;

139940 
	gnP¬am
 = 
sql™e3_bšd_·¿m‘”_couÁ
(
pStmt
);

139941 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
nP¬am
; i++){

139942 
	grc
 = 
sql™e3_bšd_v®ue
(
pStmt
, 
i
+1, 
­V®
[i]);

139945 *
	gµ
 = 
pStmt
;

139946  
	grc
;

139950 
ás3S–eùDocsize
(

139951 
Fts3TabË
 *
pTab
,

139952 
sql™e3_št64
 
iDocid
,

139953 
sql™e3_¡mt
 **
µStmt


139955 
sql™e3_¡mt
 *
	gpStmt
 = 0;

139956 
	grc
;

139958 
	grc
 = 
ás3SqlStmt
(
pTab
, 
SQL_SELECT_DOCSIZE
, &
pStmt
, 0);

139959 ifÐ
	grc
==
SQLITE_OK
 ){

139960 
sql™e3_bšd_št64
(
pStmt
, 1, 
iDocid
);

139961 
	grc
 = 
sql™e3_¡•
(
pStmt
);

139962 ifÐ
	grc
!=
SQLITE_ROW
 || 
sql™e3_cÞumn_ty³
(
pStmt
, 0)!=
SQLITE_BLOB
 ){

139963 
rc
 = 
sql™e3_»£t
(
pStmt
);

139964 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
FTS_CORRUPT_VTAB
;

139965 
	gpStmt
 = 0;

139967 
	grc
 = 
SQLITE_OK
;

139971 *
	gµStmt
 = 
pStmt
;

139972  
	grc
;

139975 
SQLITE_PRIVATE
 
sql™e3Fts3S–eùDoùÙ®
(

139976 
Fts3TabË
 *
pTab
,

139977 
sql™e3_¡mt
 **
µStmt


139979 
sql™e3_¡mt
 *
	gpStmt
 = 0;

139980 
	grc
;

139981 
	grc
 = 
ás3SqlStmt
(
pTab
, 
SQL_SELECT_STAT
, &
pStmt
, 0);

139982 ifÐ
	grc
==
SQLITE_OK
 ){

139983 
sql™e3_bšd_št
(
pStmt
, 1, 
FTS_STAT_DOCTOTAL
);

139984 ifÐ
sql™e3_¡•
(
pStmt
)!=
SQLITE_ROW


139985 || 
sql™e3_cÞumn_ty³
(
pStmt
, 0)!=
SQLITE_BLOB


139987 
rc
 = 
sql™e3_»£t
(
pStmt
);

139988 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
FTS_CORRUPT_VTAB
;

139989 
	gpStmt
 = 0;

139992 *
	gµStmt
 = 
pStmt
;

139993  
	grc
;

139996 
SQLITE_PRIVATE
 
sql™e3Fts3S–eùDocsize
(

139997 
Fts3TabË
 *
pTab
,

139998 
sql™e3_št64
 
iDocid
,

139999 
sql™e3_¡mt
 **
µStmt


140001  
ás3S–eùDocsize
(
pTab
, 
iDocid
, 
µStmt
);

140012 
ás3SqlExec
(

140013 *
pRC
,

140014 
Fts3TabË
 *
p
,

140015 
eStmt
,

140016 
sql™e3_v®ue
 **
­V®


140018 
sql™e3_¡mt
 *
	gpStmt
;

140019 
	grc
;

140020 ifÐ*
	gpRC
 ) ;

140021 
	grc
 = 
ás3SqlStmt
(
p
, 
eStmt
, &
pStmt
, 
­V®
);

140022 ifÐ
	grc
==
SQLITE_OK
 ){

140023 
sql™e3_¡•
(
pStmt
);

140024 
	grc
 = 
sql™e3_»£t
(
pStmt
);

140026 *
	gpRC
 = 
rc
;

140044 
ás3Wr™–ock
(
Fts3TabË
 *
p
){

140045 
	grc
 = 
SQLITE_OK
;

140047 ifÐ
	gp
->
	gnP’dšgD©a
==0 ){

140048 
sql™e3_¡mt
 *
pStmt
;

140049 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGDIR_LEVEL
, &
pStmt
, 0);

140050 ifÐ
	grc
==
SQLITE_OK
 ){

140051 
sql™e3_bšd_nuÎ
(
pStmt
, 1);

140052 
sql™e3_¡•
(
pStmt
);

140053 
	grc
 = 
sql™e3_»£t
(
pStmt
);

140057  
	grc
;

140083 
sql™e3_št64
 
g‘AbsÞu‹Lev–
(

140084 
Fts3TabË
 *
p
,

140085 
iLªgid
,

140086 
iIndex
,

140087 
iLev–


140089 
sql™e3_št64
 
	giBa£
;

140090 
as£¹
Ð
iLªgid
>=0 );

140091 
as£¹
Ð
p
->
nIndex
>0 );

140092 
as£¹
Ð
iIndex
>=0 && iIndex<
p
->
nIndex
 );

140094 
	giBa£
 = ((
sql™e3_št64
)
iLªgid
 * 
p
->
nIndex
 + 
iIndex
è* 
FTS3_SEGDIR_MAXLEVEL
;

140095  
	giBa£
 + 
	giLev–
;

140115 
SQLITE_PRIVATE
 
sql™e3Fts3AÎSegdœs
(

140116 
Fts3TabË
 *
p
,

140117 
iLªgid
,

140118 
iIndex
,

140119 
iLev–
,

140120 
sql™e3_¡mt
 **
µStmt


140122 
	grc
;

140123 
sql™e3_¡mt
 *
	gpStmt
 = 0;

140125 
as£¹
Ð
iLev–
==
FTS3_SEGCURSOR_ALL
 || iLevel>=0 );

140126 
as£¹
Ð
iLev–
<
FTS3_SEGDIR_MAXLEVEL
 );

140127 
as£¹
Ð
iIndex
>=0 && iIndex<
p
->
nIndex
 );

140129 ifÐ
	giLev–
<0 ){

140131 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_LEVEL_RANGE
, &
pStmt
, 0);

140132 ifÐ
	grc
==
SQLITE_OK
 ){

140133 
sql™e3_bšd_št64
(
pStmt
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 0));

140134 
sql™e3_bšd_št64
(
pStmt
, 2,

140135 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
FTS3_SEGDIR_MAXLEVEL
-1)

140140 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_LEVEL
, &
pStmt
, 0);

140141 ifÐ
	grc
==
SQLITE_OK
 ){

140142 
sql™e3_bšd_št64
(
pStmt
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
,
iLev–
));

140145 *
	gµStmt
 = 
pStmt
;

140146  
	grc
;

140162 
ás3P’dšgLi¡Aµ’dV¬št
(

140163 
P’dšgLi¡
 **
µ
,

140164 
sql™e3_št64
 
i


140166 
P’dšgLi¡
 *
	gp
 = *
µ
;

140169 ifÐ!
	gp
 ){

140170 
	gp
 = 
sql™e3_m®loc
((*
p
) + 100);

140171 ifÐ!
	gp
 ){

140172  
	gSQLITE_NOMEM
;

140174 
	gp
->
	gnS·û
 = 100;

140175 
	gp
->
	gaD©a
 = (*)&
p
[1];

140176 
	gp
->
	gnD©a
 = 0;

140178 ifÐ
	gp
->
	gnD©a
+
	gFTS3_VARINT_MAX
+1>p->
	gnS·û
 ){

140179 
	gnNew
 = 
p
->
nS·û
 * 2;

140180 
	gp
 = 
sql™e3_»®loc
(
p
, (*pè+ 
nNew
);

140181 ifÐ!
	gp
 ){

140182 
sql™e3_ä“
(*
µ
);

140183 *
	gµ
 = 0;

140184  
	gSQLITE_NOMEM
;

140186 
	gp
->
	gnS·û
 = 
nNew
;

140187 
	gp
->
	gaD©a
 = (*)&
p
[1];

140191 
	gp
->
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
p
->
aD©a
[p->
nD©a
], 
i
);

140192 
	gp
->
	gaD©a
[
p
->
nD©a
] = '\0';

140193 *
	gµ
 = 
p
;

140194  
	gSQLITE_OK
;

140206 
ás3P’dšgLi¡Aµ’d
(

140207 
P’dšgLi¡
 **
µ
,

140208 
sql™e3_št64
 
iDocid
,

140209 
sql™e3_št64
 
iCÞ
,

140210 
sql™e3_št64
 
iPos
,

140211 *
pRc


140213 
P’dšgLi¡
 *
	gp
 = *
µ
;

140214 
	grc
 = 
SQLITE_OK
;

140216 
as£¹
Ð!
p
 ||…->
iLa¡Docid
<=
iDocid
 );

140218 ifÐ!
	gp
 ||…->
	giLa¡Docid
!=
iDocid
 ){

140219 
sql™e3_št64
 
iD–
 = 
iDocid
 - (
p
 ?…->
iLa¡Docid
 : 0);

140220 ifÐ
	gp
 ){

140221 
as£¹
Ð
p
->
nD©a
<p->
nS·û
 );

140222 
as£¹
Ð
p
->
aD©a
[p->
nD©a
]==0 );

140223 
	gp
->
	gnD©a
++;

140225 ifÐ
	gSQLITE_OK
!=(
rc
 = 
ás3P’dšgLi¡Aµ’dV¬št
(&
p
, 
iD–
)) ){

140226 
	g³ndšgli¡­³nd_out
;

140228 
	gp
->
	giLa¡CÞ
 = -1;

140229 
	gp
->
	giLa¡Pos
 = 0;

140230 
	gp
->
	giLa¡Docid
 = 
iDocid
;

140232 ifÐ
	giCÞ
>0 && 
	gp
->
	giLa¡CÞ
!=
iCÞ
 ){

140233 ifÐ
SQLITE_OK
!=(
rc
 = 
ás3P’dšgLi¡Aµ’dV¬št
(&
p
, 1))

140234 || 
	gSQLITE_OK
!=(
rc
 = 
ás3P’dšgLi¡Aµ’dV¬št
(&
p
, 
iCÞ
))

140236 
	g³ndšgli¡­³nd_out
;

140238 
	gp
->
	giLa¡CÞ
 = 
iCÞ
;

140239 
	gp
->
	giLa¡Pos
 = 0;

140241 ifÐ
	giCÞ
>=0 ){

140242 
as£¹
Ð
iPos
>
p
->
iLa¡Pos
 || (iPos==0 &&…->iLastPos==0) );

140243 
	grc
 = 
ás3P’dšgLi¡Aµ’dV¬št
(&
p
, 2+
iPos
-p->
iLa¡Pos
);

140244 ifÐ
	grc
==
SQLITE_OK
 ){

140245 
p
->
iLa¡Pos
 = 
iPos
;

140249 
	g³ndšgli¡­³nd_out
:

140250 *
pRc
 = 
rc
;

140251 ifÐ
	gp
!=*
µ
 ){

140252 *
µ
 = 
p
;

140261 
ás3P’dšgLi¡D–‘e
(
P’dšgLi¡
 *
pLi¡
){

140262 
sql™e3_ä“
(
pLi¡
);

140268 
ás3P’dšgT”msAddOÃ
(

140269 
Fts3TabË
 *
p
,

140270 
iCÞ
,

140271 
iPos
,

140272 
Fts3Hash
 *
pHash
,

140273 cÚ¡ *
zTok’
,

140274 
nTok’


140276 
P’dšgLi¡
 *
	gpLi¡
;

140277 
	grc
 = 
SQLITE_OK
;

140279 
	gpLi¡
 = (
P’dšgLi¡
 *)
ás3HashFšd
(
pHash
, 
zTok’
, 
nTok’
);

140280 ifÐ
	gpLi¡
 ){

140281 
	gp
->
	gnP’dšgD©a
 -ð(
pLi¡
->
nD©a
 + 
nTok’
 + (
Fts3HashEËm
));

140283 ifÐ
ás3P’dšgLi¡Aµ’d
(&
pLi¡
, 
p
->
iP»vDocid
, 
iCÞ
, 
iPos
, &
rc
) ){

140284 ifÐ
	gpLi¡
==
ás3HashIn£¹
(
pHash
, 
zTok’
, 
nTok’
, 
pLi¡
) ){

140288 
as£¹
Ð0==
ás3HashFšd
(
pHash
, 
zTok’
, 
nTok’
) );

140289 
sql™e3_ä“
(
pLi¡
);

140290 
	grc
 = 
SQLITE_NOMEM
;

140293 ifÐ
	grc
==
SQLITE_OK
 ){

140294 
p
->
nP’dšgD©a
 +ð(
pLi¡
->
nD©a
 + 
nTok’
 + (
Fts3HashEËm
));

140296  
	grc
;

140306 
ás3P’dšgT”msAdd
(

140307 
Fts3TabË
 *
p
,

140308 
iLªgid
,

140309 cÚ¡ *
zText
,

140310 
iCÞ
,

140311 
u32
 *
²WÜd


140313 
	grc
;

140314 
	giS¹
 = 0;

140315 
	giEnd
 = 0;

140316 
	giPos
 = 0;

140317 
	gnWÜd
 = 0;

140319 cÚ¡ *
	gzTok’
;

140320 
	gnTok’
 = 0;

140322 
sql™e3_tok’iz”
 *
	gpTok’iz”
 = 
p
->
pTok’iz”
;

140323 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 
pTok’iz”
->
pModuË
;

140324 
sql™e3_tok’iz”_cursÜ
 *
	gpC¤
;

140325 (*
	gxNext
)(
sql™e3_tok’iz”_cursÜ
 *
	gpCursÜ
,

140328 
as£¹
Ð
pTok’iz”
 && 
pModuË
 );

140333 ifÐ
	gzText
==0 ){

140334 *
²WÜd
 = 0;

140335  
	gSQLITE_OK
;

140338 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pTok’iz”
, 
iLªgid
, 
zText
, -1, &
pC¤
);

140339 ifÐ
	grc
!=
SQLITE_OK
 ){

140340  
rc
;

140343 
	gxNext
 = 
pModuË
->
xNext
;

140344  
	gSQLITE_OK
==
rc


140345 && 
SQLITE_OK
==(
rc
 = 
xNext
(
pC¤
, &
zTok’
, &
nTok’
, &
iS¹
, &
iEnd
, &
iPos
))

140347 
	gi
;

140348 ifÐ
	giPos
>=
nWÜd
 )‚WÜd = 
iPos
+1;

140353 ifÐ
	giPos
<0 || !
	gzTok’
 || 
	gnTok’
<=0 ){

140354 
rc
 = 
SQLITE_ERROR
;

140359 
	grc
 = 
ás3P’dšgT”msAddOÃ
(

140360 
p
, 
iCÞ
, 
iPos
, &p->
aIndex
[0].
hP’dšg
, 
zTok’
, 
nTok’


140365 
	gi
=1; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nIndex
; i++){

140366 
Fts3Index
 *
	gpIndex
 = &
p
->
aIndex
[
i
];

140367 ifÐ
	gnTok’
<
	gpIndex
->
	gnP»fix
 ) ;

140368 
	grc
 = 
ás3P’dšgT”msAddOÃ
(

140369 
p
, 
iCÞ
, 
iPos
, &
pIndex
->
hP’dšg
, 
zTok’
,…Index->
nP»fix


140374 
	gpModuË
->
xClo£
(
pC¤
);

140375 *
	g²WÜd
 +ð
nWÜd
;

140376  (
	grc
==
SQLITE_DONE
 ? 
SQLITE_OK
 : 
rc
);

140384 
ás3P’dšgT”msDocid
(

140385 
Fts3TabË
 *
p
,

140386 
iLªgid
,

140387 
sql™e_št64
 
iDocid


140389 
as£¹
Ð
iLªgid
>=0 );

140397 ifÐ
	giDocid
<=
p
->
iP»vDocid


140398 || 
p
->
iP»vLªgid
!=
iLªgid


140399 || 
p
->
nP’dšgD©a
>p->
nMaxP’dšgD©a


140401 
rc
 = 
sql™e3Fts3P’dšgT”msFlush
(
p
);

140402 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140404 
	gp
->
	giP»vDocid
 = 
iDocid
;

140405 
	gp
->
	giP»vLªgid
 = 
iLªgid
;

140406  
	gSQLITE_OK
;

140412 
SQLITE_PRIVATE
 
sql™e3Fts3P’dšgT”msCË¬
(
Fts3TabË
 *
p
){

140413 
	gi
;

140414 
	gi
=0; i<
	gp
->
	gnIndex
; i++){

140415 
Fts3HashEËm
 *
	gpEËm
;

140416 
Fts3Hash
 *
	gpHash
 = &
p
->
aIndex
[
i
].
hP’dšg
;

140417 
	gpEËm
=
ás3HashFœ¡
(
pHash
);…EËm;…EËm=
ás3HashNext
(
pEËm
)){

140418 
P’dšgLi¡
 *
pLi¡
 = (P’dšgLi¡ *)
ás3HashD©a
(
pEËm
);

140419 
ás3P’dšgLi¡D–‘e
(
pLi¡
);

140421 
ás3HashCË¬
(
pHash
);

140423 
	gp
->
	gnP’dšgD©a
 = 0;

140434 
ás3In£¹T”ms
(

140435 
Fts3TabË
 *
p
,

140436 
iLªgid
,

140437 
sql™e3_v®ue
 **
­V®
,

140438 
u32
 *
aSz


140440 
	gi
;

140441 
	gi
=2; i<
	gp
->
	gnCÞumn
+2; i++){

140442 
	giCÞ
 = 
i
-2;

140443 ifÐ
	gp
->
	gabNÙšdexed
[
iCÞ
]==0 ){

140444 cÚ¡ *
zText
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­V®
[
i
]);

140445 
	grc
 = 
ás3P’dšgT”msAdd
(
p
, 
iLªgid
, 
zText
, 
iCÞ
, &
aSz
[iCol]);

140446 ifÐ
	grc
!=
SQLITE_OK
 ){

140447  
rc
;

140449 
	gaSz
[
p
->
nCÞumn
] +ð
sql™e3_v®ue_by‹s
(
­V®
[
i
]);

140452  
	gSQLITE_OK
;

140469 
ás3In£¹D©a
(

140470 
Fts3TabË
 *
p
,

140471 
sql™e3_v®ue
 **
­V®
,

140472 
sql™e3_št64
 *
piDocid


140474 
	grc
;

140475 
sql™e3_¡mt
 *
	gpCÚ‹ÁIn£¹
;

140477 ifÐ
	gp
->
	gzCÚ‹ÁTbl
 ){

140478 
sql™e3_v®ue
 *
	gpRowid
 = 
­V®
[
p
->
nCÞumn
+3];

140479 ifÐ
sql™e3_v®ue_ty³
(
pRowid
)==
SQLITE_NULL
 ){

140480 
pRowid
 = 
­V®
[1];

140482 ifÐ
sql™e3_v®ue_ty³
(
pRowid
)!=
SQLITE_INTEGER
 ){

140483  
SQLITE_CONSTRAINT
;

140485 *
	gpiDocid
 = 
sql™e3_v®ue_št64
(
pRowid
);

140486  
	gSQLITE_OK
;

140497 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_CONTENT_INSERT
, &
pCÚ‹ÁIn£¹
, &
­V®
[1]);

140498 ifÐ
	grc
==
SQLITE_OK
 && 
p
->
zLªguageid
 ){

140499 
rc
 = 
sql™e3_bšd_št
(

140500 
pCÚ‹ÁIn£¹
, 
p
->
nCÞumn
+2,

140501 
sql™e3_v®ue_št
(
­V®
[
p
->
nCÞumn
+4])

140504 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140516 ifÐ
	gSQLITE_NULL
!=
sql™e3_v®ue_ty³
(
­V®
[3+
p
->
nCÞumn
]) ){

140517 ifÐ
SQLITE_NULL
==
sql™e3_v®ue_ty³
(
­V®
[0])

140518 && 
SQLITE_NULL
!=
sql™e3_v®ue_ty³
(
­V®
[1])

140521  
SQLITE_ERROR
;

140523 
	grc
 = 
sql™e3_bšd_v®ue
(
pCÚ‹ÁIn£¹
, 1, 
­V®
[3+
p
->
nCÞumn
]);

140524 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140530 
sql™e3_¡•
(
pCÚ‹ÁIn£¹
);

140531 
	grc
 = 
sql™e3_»£t
(
pCÚ‹ÁIn£¹
);

140533 *
	gpiDocid
 = 
sql™e3_Ï¡_š£¹_rowid
(
p
->
db
);

140534  
	grc
;

140543 
ás3D–‘eAÎ
(
Fts3TabË
 *
p
, 
bCÚ‹Á
){

140544 
	grc
 = 
SQLITE_OK
;

140547 
sql™e3Fts3P’dšgT”msCË¬
(
p
);

140551 
as£¹
Ð
p
->
zCÚ‹ÁTbl
==0 || 
bCÚ‹Á
==0 );

140552 ifÐ
	gbCÚ‹Á
 ) 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_ALL_CONTENT
, 0);

140553 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_ALL_SEGMENTS
, 0);

140554 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_ALL_SEGDIR
, 0);

140555 ifÐ
	gp
->
	gbHasDocsize
 ){

140556 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_ALL_DOCSIZE
, 0);

140558 ifÐ
	gp
->
	gbHasSt
 ){

140559 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_ALL_STAT
, 0);

140561  
	grc
;

140567 
ÏngidFromS–eù
(
Fts3TabË
 *
p
, 
sql™e3_¡mt
 *
pS–eù
){

140568 
	giLªgid
 = 0;

140569 ifÐ
	gp
->
	gzLªguageid
 ) 
	giLªgid
 = 
sql™e3_cÞumn_št
(
pS–eù
, 
p
->
nCÞumn
+1);

140570  
	giLªgid
;

140578 
ás3D–‘eT”ms
(

140579 *
pRC
,

140580 
Fts3TabË
 *
p
,

140581 
sql™e3_v®ue
 *
pRowid
,

140582 
u32
 *
aSz
,

140583 *
pbFound


140585 
	grc
;

140586 
sql™e3_¡mt
 *
	gpS–eù
;

140588 
as£¹
Ð*
pbFound
==0 );

140589 ifÐ*
	gpRC
 ) ;

140590 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_CONTENT_BY_ROWID
, &
pS–eù
, &
pRowid
);

140591 ifÐ
	grc
==
SQLITE_OK
 ){

140592 ifÐ
SQLITE_ROW
==
sql™e3_¡•
(
pS–eù
) ){

140593 
i
;

140594 
	giLªgid
 = 
ÏngidFromS–eù
(
p
, 
pS–eù
);

140595 
	grc
 = 
ás3P’dšgT”msDocid
(
p
, 
iLªgid
, 
sql™e3_cÞumn_št64
(
pS–eù
, 0));

140596 
	gi
=1; 
	grc
==
SQLITE_OK
 && 
i
<=
p
->
nCÞumn
; i++){

140597 
	giCÞ
 = 
i
-1;

140598 ifÐ
	gp
->
	gabNÙšdexed
[
iCÞ
]==0 ){

140599 cÚ¡ *
zText
 = (cÚ¡ *)
sql™e3_cÞumn_‹xt
(
pS–eù
, 
i
);

140600 
	grc
 = 
ás3P’dšgT”msAdd
(
p
, 
iLªgid
, 
zText
, -1, &
aSz
[
iCÞ
]);

140601 
	gaSz
[
p
->
nCÞumn
] +ð
sql™e3_cÞumn_by‹s
(
pS–eù
, 
i
);

140604 ifÐ
	grc
!=
SQLITE_OK
 ){

140605 
sql™e3_»£t
(
pS–eù
);

140606 *
	gpRC
 = 
rc
;

140609 *
	gpbFound
 = 1;

140611 
	grc
 = 
sql™e3_»£t
(
pS–eù
);

140613 
sql™e3_»£t
(
pS–eù
);

140615 *
	gpRC
 = 
rc
;

140622 
ás3Segm’tM”ge
(
Fts3TabË
 *, , , );

140639 
ás3AÎoÿ‹SegdœIdx
(

140640 
Fts3TabË
 *
p
,

140641 
iLªgid
,

140642 
iIndex
,

140643 
iLev–
,

140644 *
piIdx


140646 
	grc
;

140647 
sql™e3_¡mt
 *
	gpNextIdx
;

140648 
	giNext
 = 0;

140650 
as£¹
Ð
iLªgid
>=0 );

140651 
as£¹
Ð
p
->
nIndex
>=1 );

140654 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_NEXT_SEGMENT_INDEX
, &
pNextIdx
, 0);

140655 ifÐ
	grc
==
SQLITE_OK
 ){

140656 
sql™e3_bšd_št64
(

140657 
pNextIdx
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
)

140659 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pNextIdx
) ){

140660 
iNext
 = 
sql™e3_cÞumn_št
(
pNextIdx
, 0);

140662 
	grc
 = 
sql™e3_»£t
(
pNextIdx
);

140665 ifÐ
	grc
==
SQLITE_OK
 ){

140671 ifÐ
iNext
>=
FTS3_MERGE_COUNT
 ){

140672 
ás3LogM”ge
(16, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
));

140673 
	grc
 = 
ás3Segm’tM”ge
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
);

140674 *
	gpiIdx
 = 0;

140676 *
	gpiIdx
 = 
iNext
;

140680  
	grc
;

140710 
SQLITE_PRIVATE
 
sql™e3Fts3R—dBlock
(

140711 
Fts3TabË
 *
p
,

140712 
sql™e3_št64
 
iBlockid
,

140713 **
·Blob
,

140714 *
²Blob
,

140715 *
²Lßd


140717 
	grc
;

140720 
as£¹
Ð
²Blob
 );

140722 ifÐ
	gp
->
	gpSegm’ts
 ){

140723 
	grc
 = 
sql™e3_blob_»Ý’
(
p
->
pSegm’ts
, 
iBlockid
);

140725 ifÐ0==
p
->
zSegm’tsTbl
 ){

140726 
p
->
zSegm’tsTbl
 = 
sql™e3_m´štf
("%s_£gm’ts",…->
zName
);

140727 ifÐ0==
p
->
zSegm’tsTbl
 )  
SQLITE_NOMEM
;

140729 
	grc
 = 
sql™e3_blob_Ý’
(

140730 
p
->
db
,…->
zDb
,…->
zSegm’tsTbl
, "block", 
iBlockid
, 0, &p->
pSegm’ts


140734 ifÐ
	grc
==
SQLITE_OK
 ){

140735 
nBy‹
 = 
sql™e3_blob_by‹s
(
p
->
pSegm’ts
);

140736 *
	g²Blob
 = 
nBy‹
;

140737 ifÐ
	g·Blob
 ){

140738 *
	gaBy‹
 = 
sql™e3_m®loc
(
nBy‹
 + 
FTS3_NODE_PADDING
);

140739 ifÐ!
	gaBy‹
 ){

140740 
	grc
 = 
SQLITE_NOMEM
;

140742 ifÐ
	g²Lßd
 && 
	gnBy‹
>(
	gFTS3_NODE_CHUNK_THRESHOLD
) ){

140743 
	gnBy‹
 = 
FTS3_NODE_CHUNKSIZE
;

140744 *
	g²Lßd
 = 
nBy‹
;

140746 
	grc
 = 
sql™e3_blob_»ad
(
p
->
pSegm’ts
, 
aBy‹
, 
nBy‹
, 0);

140747 
mem£t
(&
aBy‹
[
nBy‹
], 0, 
FTS3_NODE_PADDING
);

140748 ifÐ
	grc
!=
SQLITE_OK
 ){

140749 
sql™e3_ä“
(
aBy‹
);

140750 
	gaBy‹
 = 0;

140753 *
	g·Blob
 = 
aBy‹
;

140757  
	grc
;

140764 
SQLITE_PRIVATE
 
sql™e3Fts3Segm’tsClo£
(
Fts3TabË
 *
p
){

140765 
sql™e3_blob_þo£
(
p
->
pSegm’ts
);

140766 
	gp
->
	gpSegm’ts
 = 0;

140769 
ás3SegR—d”InüR—d
(
Fts3SegR—d”
 *
pR—d”
){

140770 
	gnR—d
;

140771 
	grc
;

140773 
	gnR—d
 = 
MIN
(
pR—d”
->
nNode
 -…R—d”->
nPÝuÏ‹
, 
FTS3_NODE_CHUNKSIZE
);

140774 
	grc
 = 
sql™e3_blob_»ad
(

140775 
pR—d”
->
pBlob
,

140776 &
pR—d”
->
aNode
[pR—d”->
nPÝuÏ‹
],

140777 
nR—d
,

140778 
pR—d”
->
nPÝuÏ‹


140781 ifÐ
	grc
==
SQLITE_OK
 ){

140782 
pR—d”
->
nPÝuÏ‹
 +ð
nR—d
;

140783 
mem£t
(&
pR—d”
->
aNode
[pR—d”->
nPÝuÏ‹
], 0, 
FTS3_NODE_PADDING
);

140784 ifÐ
	gpR—d”
->
	gnPÝuÏ‹
==
pR—d”
->
nNode
 ){

140785 
sql™e3_blob_þo£
(
pR—d”
->
pBlob
);

140786 
	gpR—d”
->
	gpBlob
 = 0;

140787 
	gpR—d”
->
	gnPÝuÏ‹
 = 0;

140790  
	grc
;

140793 
ás3SegR—d”Requœe
(
Fts3SegR—d”
 *
pR—d”
, *
pFrom
, 
nBy‹
){

140794 
	grc
 = 
SQLITE_OK
;

140795 
as£¹
Ð!
pR—d”
->
pBlob


140796 || (
pFrom
>=
pR—d”
->
aNode
 &&…From<&pR—d”->aNode[pR—d”->
nNode
])

140798  
	gpR—d”
->
	gpBlob
 && 
	grc
==
SQLITE_OK


140799 && (
pFrom
 - 
pR—d”
->
aNode
 + 
nBy‹
)>pR—d”->
nPÝuÏ‹


140801 
rc
 = 
ás3SegR—d”InüR—d
(
pR—d”
);

140803  
	grc
;

140809 
ás3SegR—d”S‘Eof
(
Fts3SegR—d”
 *
pSeg
){

140810 ifÐ!
ás3SegR—d”IsRoÙOÆy
(
pSeg
) ){

140811 
sql™e3_ä“
(
pSeg
->
aNode
);

140812 
sql™e3_blob_þo£
(
pSeg
->
pBlob
);

140813 
	gpSeg
->
	gpBlob
 = 0;

140815 
	gpSeg
->
	gaNode
 = 0;

140823 
ás3SegR—d”Next
(

140824 
Fts3TabË
 *
p
,

140825 
Fts3SegR—d”
 *
pR—d”
,

140826 
bInü


140828 
	grc
;

140829 *
	gpNext
;

140830 
	gnP»fix
;

140831 
	gnSuffix
;

140833 ifÐ!
	gpR—d”
->
	gaDoþi¡
 ){

140834 
	gpNext
 = 
pR—d”
->
aNode
;

140836 
	gpNext
 = &
pR—d”
->
aDoþi¡
[pR—d”->
nDoþi¡
];

140839 ifÐ!
	gpNext
 ||…Next>=&
pR—d”
->
aNode
[pR—d”->
nNode
] ){

140841 ifÐ
ás3SegR—d”IsP’dšg
(
pR—d”
) ){

140842 
Fts3HashEËm
 *
pEËm
 = *(
pR—d”
->
µNextEËm
);

140843 ifÐ
	gpEËm
==0 ){

140844 
pR—d”
->
aNode
 = 0;

140846 
P’dšgLi¡
 *
	gpLi¡
 = (P’dšgLi¡ *)
ás3HashD©a
(
pEËm
);

140847 
	gpR—d”
->
	gzT”m
 = (*)
ás3HashKey
(
pEËm
);

140848 
	gpR—d”
->
	gnT”m
 = 
ás3HashKeysize
(
pEËm
);

140849 
	gpR—d”
->
	gnNode
 = 
pR—d”
->
nDoþi¡
 = 
pLi¡
->
nD©a
 + 1;

140850 
	gpR—d”
->
	gaNode
 = 
pR—d”
->
aDoþi¡
 = 
pLi¡
->
aD©a
;

140851 
	gpR—d”
->
	gµNextEËm
++;

140852 
as£¹
Ð
pR—d”
->
aNode
 );

140854  
	gSQLITE_OK
;

140857 
ás3SegR—d”S‘Eof
(
pR—d”
);

140861 
as£¹
Ð
pR—d”
->
iCu¼’tBlock
<õR—d”->
iL—fEndBlock
 );

140862 ifÐ
	gpR—d”
->
	giCu¼’tBlock
>=
pR—d”
->
iL—fEndBlock
 ){

140863  
SQLITE_OK
;

140866 
	grc
 = 
sql™e3Fts3R—dBlock
(

140867 
p
, ++
pR—d”
->
iCu¼’tBlock
, &pR—d”->
aNode
, &pR—d”->
nNode
,

140868 (
bInü
 ? &
pR—d”
->
nPÝuÏ‹
 : 0)

140870 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140871 
as£¹
Ð
pR—d”
->
pBlob
==0 );

140872 ifÐ
	gbInü
 && 
	gpR—d”
->
	gnPÝuÏ‹
<pR—d”->
	gnNode
 ){

140873 
	gpR—d”
->
	gpBlob
 = 
p
->
pSegm’ts
;

140874 
	gp
->
	gpSegm’ts
 = 0;

140876 
	gpNext
 = 
pR—d”
->
aNode
;

140879 
as£¹
Ð!
ás3SegR—d”IsP’dšg
(
pR—d”
) );

140881 
	grc
 = 
ás3SegR—d”Requœe
(
pR—d”
, 
pNext
, 
FTS3_VARINT_MAX
*2);

140882 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140886 
	gpNext
 +ð
ás3G‘V¬št32
(
pNext
, &
nP»fix
);

140887 
	gpNext
 +ð
ás3G‘V¬št32
(
pNext
, &
nSuffix
);

140888 ifÐ
	gnP»fix
<0 || 
	gnSuffix
<=0

140889 || &
pNext
[
nSuffix
]>&
pR—d”
->
aNode
[pR—d”->
nNode
]

140891  
FTS_CORRUPT_VTAB
;

140894 ifÐ
	gnP»fix
+
	gnSuffix
>
	gpR—d”
->
	gnT”mAÎoc
 ){

140895 
	gnNew
 = (
nP»fix
+
nSuffix
)*2;

140896 *
	gzNew
 = 
sql™e3_»®loc
(
pR—d”
->
zT”m
, 
nNew
);

140897 ifÐ!
	gzNew
 ){

140898  
	gSQLITE_NOMEM
;

140900 
	gpR—d”
->
	gzT”m
 = 
zNew
;

140901 
	gpR—d”
->
	gnT”mAÎoc
 = 
nNew
;

140904 
	grc
 = 
ás3SegR—d”Requœe
(
pR—d”
, 
pNext
, 
nSuffix
+
FTS3_VARINT_MAX
);

140905 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

140907 
memýy
(&
pR—d”
->
zT”m
[
nP»fix
], 
pNext
, 
nSuffix
);

140908 
	gpR—d”
->
	gnT”m
 = 
nP»fix
+
nSuffix
;

140909 
	gpNext
 +ð
nSuffix
;

140910 
	gpNext
 +ð
ás3G‘V¬št32
(
pNext
, &
pR—d”
->
nDoþi¡
);

140911 
	gpR—d”
->
	gaDoþi¡
 = 
pNext
;

140912 
	gpR—d”
->
	gpOff£tLi¡
 = 0;

140918 ifÐ&
	gpR—d”
->
	gaDoþi¡
[
pR—d”
->
nDoþi¡
]>&pR—d”->
	gaNode
[pR—d”->
nNode
]

140919 || (
	gpR—d”
->
	gnPÝuÏ‹
==0 && 
pR—d”
->
aDoþi¡
[pR—d”->
nDoþi¡
-1])

140921  
FTS_CORRUPT_VTAB
;

140923  
	gSQLITE_OK
;

140930 
ás3SegR—d”Fœ¡Docid
(
Fts3TabË
 *
pTab
, 
Fts3SegR—d”
 *
pR—d”
){

140931 
	grc
 = 
SQLITE_OK
;

140932 
as£¹
Ð
pR—d”
->
aDoþi¡
 );

140933 
as£¹
Ð!
pR—d”
->
pOff£tLi¡
 );

140934 ifÐ
	gpTab
->
	gbDescIdx
 && 
ás3SegR—d”IsP’dšg
(
pR—d”
) ){

140935 
u8
 
	gbEof
 = 0;

140936 
	gpR—d”
->
	giDocid
 = 0;

140937 
	gpR—d”
->
	gnOff£tLi¡
 = 0;

140938 
sql™e3Fts3Doþi¡P»v
(0,

140939 
pR—d”
->
aDoþi¡
,…R—d”->
nDoþi¡
, &pR—d”->
pOff£tLi¡
,

140940 &
pR—d”
->
iDocid
, &pR—d”->
nOff£tLi¡
, &
bEof


140943 
	grc
 = 
ás3SegR—d”Requœe
(
pR—d”
,…R—d”->
aDoþi¡
, 
FTS3_VARINT_MAX
);

140944 ifÐ
	grc
==
SQLITE_OK
 ){

140945 
n
 = 
sql™e3Fts3G‘V¬št
(
pR—d”
->
aDoþi¡
, &pR—d”->
iDocid
);

140946 
	gpR—d”
->
	gpOff£tLi¡
 = &
pR—d”
->
aDoþi¡
[
n
];

140949  
	grc
;

140962 
ás3SegR—d”NextDocid
(

140963 
Fts3TabË
 *
pTab
,

140964 
Fts3SegR—d”
 *
pR—d”
,

140965 **
µOff£tLi¡
,

140966 *
²Off£tLi¡


140968 
	grc
 = 
SQLITE_OK
;

140969 *
	gp
 = 
pR—d”
->
pOff£tLi¡
;

140970 
	gc
 = 0;

140972 
as£¹
Ð
p
 );

140974 ifÐ
	gpTab
->
	gbDescIdx
 && 
ás3SegR—d”IsP’dšg
(
pR—d”
) ){

140978 
u8
 
	gbEof
 = 0;

140979 ifÐ
	gµOff£tLi¡
 ){

140980 *
	gµOff£tLi¡
 = 
pR—d”
->
pOff£tLi¡
;

140981 *
	g²Off£tLi¡
 = 
pR—d”
->
nOff£tLi¡
 - 1;

140983 
sql™e3Fts3Doþi¡P»v
(0,

140984 
pR—d”
->
aDoþi¡
,…R—d”->
nDoþi¡
, &
p
, &pR—d”->
iDocid
,

140985 &
pR—d”
->
nOff£tLi¡
, &
bEof


140987 ifÐ
	gbEof
 ){

140988 
	gpR—d”
->
	gpOff£tLi¡
 = 0;

140990 
	gpR—d”
->
	gpOff£tLi¡
 = 
p
;

140993 *
	gpEnd
 = &
pR—d”
->
aDoþi¡
[pR—d”->
nDoþi¡
];

141006  *
	gp
 | 
	gc
 ) c = *
p
++ & 0x80;

141007 
as£¹
Ð*
p
==0 );

141009 ifÐ
	gpR—d”
->
	gpBlob
==0 || 
p
<&
pR—d”
->
aNode
[pR—d”->
nPÝuÏ‹
] ) ;

141010 
	grc
 = 
ás3SegR—d”InüR—d
(
pR—d”
);

141011 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141013 
	gp
++;

141018 ifÐ
	gµOff£tLi¡
 ){

141019 *
	gµOff£tLi¡
 = 
pR—d”
->
pOff£tLi¡
;

141020 *
	g²Off£tLi¡
 = ()(
p
 - 
pR—d”
->
pOff£tLi¡
 - 1);

141024  
	gp
<
	gpEnd
 && *p==0 ) 
p
++;

141031 ifÐ
	gp
>=
pEnd
 ){

141032 
pR—d”
->
pOff£tLi¡
 = 0;

141034 
	grc
 = 
ás3SegR—d”Requœe
(
pR—d”
, 
p
, 
FTS3_VARINT_MAX
);

141035 ifÐ
	grc
==
SQLITE_OK
 ){

141036 
sql™e3_št64
 
iD–
;

141037 
	gpR—d”
->
	gpOff£tLi¡
 = 
p
 + 
sql™e3Fts3G‘V¬št
Õ, &
iD–
);

141038 ifÐ
	gpTab
->
	gbDescIdx
 ){

141039 
	gpR—d”
->
	giDocid
 -ð
iD–
;

141041 
	gpR—d”
->
	giDocid
 +ð
iD–
;

141047  
	gSQLITE_OK
;

141051 
SQLITE_PRIVATE
 
sql™e3Fts3M¤Ovæ
(

141052 
Fts3CursÜ
 *
pC¤
,

141053 
Fts3MuÉiSegR—d”
 *
pM¤
,

141054 *
²Ovæ


141056 
Fts3TabË
 *
	gp
 = (Fts3TabË*)
pC¤
->
ba£
.
pVb
;

141057 
	gnOvæ
 = 0;

141058 
	gii
;

141059 
	grc
 = 
SQLITE_OK
;

141060 
	gpgsz
 = 
p
->
nPgsz
;

141062 
as£¹
Ð
p
->
bFts4
 );

141063 
as£¹
Ð
pgsz
>0 );

141065 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<
pM¤
->
nSegm’t
; ii++){

141066 
Fts3SegR—d”
 *
	gpR—d”
 = 
pM¤
->
­Segm’t
[
ii
];

141067 ifÐ!
ás3SegR—d”IsP’dšg
(
pR—d”
)

141068 && !
ás3SegR—d”IsRoÙOÆy
(
pR—d”
)

141070 
sql™e3_št64
 
	gjj
;

141071 
	gjj
=
pR—d”
->
iS¹Block
; jj<õR—d”->
iL—fEndBlock
; jj++){

141072 
	gnBlob
;

141073 
	grc
 = 
sql™e3Fts3R—dBlock
(
p
, 
jj
, 0, &
nBlob
, 0);

141074 ifÐ
	grc
!=
SQLITE_OK
 ) ;

141075 ifÐ(
	gnBlob
+35)>
	gpgsz
 ){

141076 
	gnOvæ
 +ð(
nBlob
 + 34)/
pgsz
;

141081 *
	g²Ovæ
 = 
nOvæ
;

141082  
	grc
;

141089 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”F»e
(
Fts3SegR—d”
 *
pR—d”
){

141090 ifÐ
	gpR—d”
 && !
ás3SegR—d”IsP’dšg
(
pR—d”
) ){

141091 
sql™e3_ä“
(
pR—d”
->
zT”m
);

141092 ifÐ!
ás3SegR—d”IsRoÙOÆy
(
pR—d”
) ){

141093 
sql™e3_ä“
(
pR—d”
->
aNode
);

141094 
sql™e3_blob_þo£
(
pR—d”
->
pBlob
);

141097 
sql™e3_ä“
(
pR—d”
);

141103 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”New
(

141104 
iAge
,

141105 
bLookup
,

141106 
sql™e3_št64
 
iS¹L—f
,

141107 
sql™e3_št64
 
iEndL—f
,

141108 
sql™e3_št64
 
iEndBlock
,

141109 cÚ¡ *
zRoÙ
,

141110 
nRoÙ
,

141111 
Fts3SegR—d”
 **
µR—d”


141113 
Fts3SegR—d”
 *
	gpR—d”
;

141114 
	gnExŒa
 = 0;

141116 
as£¹
Ð
iS¹L—f
<=
iEndL—f
 );

141117 ifÐ
	giS¹L—f
==0 ){

141118 
nExŒa
 = 
nRoÙ
 + 
FTS3_NODE_PADDING
;

141121 
	gpR—d”
 = (
Fts3SegR—d”
 *)
sql™e3_m®loc
((Fts3SegR—d”è+ 
nExŒa
);

141122 ifÐ!
	gpR—d”
 ){

141123  
	gSQLITE_NOMEM
;

141125 
mem£t
(
pR—d”
, 0, (
Fts3SegR—d”
));

141126 
	gpR—d”
->
	giIdx
 = 
iAge
;

141127 
	gpR—d”
->
	gbLookup
 = 
bLookup
!=0;

141128 
	gpR—d”
->
	giS¹Block
 = 
iS¹L—f
;

141129 
	gpR—d”
->
	giL—fEndBlock
 = 
iEndL—f
;

141130 
	gpR—d”
->
	giEndBlock
 = 
iEndBlock
;

141132 ifÐ
	gnExŒa
 ){

141134 
	gpR—d”
->
	gaNode
 = (*)&
pR—d”
[1];

141135 
	gpR—d”
->
	groÙOÆy
 = 1;

141136 
	gpR—d”
->
	gnNode
 = 
nRoÙ
;

141137 
memýy
(
pR—d”
->
aNode
, 
zRoÙ
, 
nRoÙ
);

141138 
mem£t
(&
pR—d”
->
aNode
[
nRoÙ
], 0, 
FTS3_NODE_PADDING
);

141140 
	gpR—d”
->
	giCu¼’tBlock
 = 
iS¹L—f
-1;

141142 *
	gµR—d”
 = 
pR—d”
;

141143  
	gSQLITE_OK
;

141151 
ás3Com·»EËmByT”m
(cÚ¡ *
lhs
, cÚ¡ *
rhs
){

141152 *
	gz1
 = 
ás3HashKey
(*(
Fts3HashEËm
 **)
lhs
);

141153 *
	gz2
 = 
ás3HashKey
(*(
Fts3HashEËm
 **)
rhs
);

141154 
	gn1
 = 
ás3HashKeysize
(*(
Fts3HashEËm
 **)
lhs
);

141155 
	gn2
 = 
ás3HashKeysize
(*(
Fts3HashEËm
 **)
rhs
);

141157 
	gn
 = (
n1
<
n2
 ?‚1 :‚2);

141158 
	gc
 = 
memcmp
(
z1
, 
z2
, 
n
);

141159 ifÐ
	gc
==0 ){

141160 
c
 = 
n1
 - 
n2
;

141162  
	gc
;

141184 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”P’dšg
(

141185 
Fts3TabË
 *
p
,

141186 
iIndex
,

141187 cÚ¡ *
zT”m
,

141188 
nT”m
,

141189 
bP»fix
,

141190 
Fts3SegR—d”
 **
µR—d”


141192 
Fts3SegR—d”
 *
	gpR—d”
 = 0;

141193 
Fts3HashEËm
 *
	gpE
;

141194 
Fts3HashEËm
 **
	gaEËm
 = 0;

141195 
	gnEËm
 = 0;

141196 
	grc
 = 
SQLITE_OK
;

141197 
Fts3Hash
 *
	gpHash
;

141199 
	gpHash
 = &
p
->
aIndex
[
iIndex
].
hP’dšg
;

141200 ifÐ
	gbP»fix
 ){

141201 
	gnAÎoc
 = 0;

141203 
	gpE
=
ás3HashFœ¡
(
pHash
);…E;…E=
ás3HashNext
(
pE
)){

141204 *
zKey
 = (*)
ás3HashKey
(
pE
);

141205 
	gnKey
 = 
ás3HashKeysize
(
pE
);

141206 ifÐ
	gnT”m
==0 || (
nKey
>=
nT”m
 && 0==
memcmp
(
zKey
, 
zT”m
,‚Term)) ){

141207 ifÐ
	gnEËm
==
nAÎoc
 ){

141208 
Fts3HashEËm
 **
aEËm2
;

141209 
	gnAÎoc
 += 16;

141210 
	gaEËm2
 = (
Fts3HashEËm
 **)
sql™e3_»®loc
(

141211 
aEËm
, 
nAÎoc
*(
Fts3HashEËm
 *)

141213 ifÐ!
	gaEËm2
 ){

141214 
	grc
 = 
SQLITE_NOMEM
;

141215 
	gnEËm
 = 0;

141218 
	gaEËm
 = 
aEËm2
;

141221 
	gaEËm
[
nEËm
++] = 
pE
;

141229 ifÐ
	gnEËm
>1 ){

141230 
qsÜt
(
aEËm
, 
nEËm
, (
Fts3HashEËm
 *), 
ás3Com·»EËmByT”m
);

141241 
	gpE
 = 
ás3HashFšdEËm
(
pHash
, 
zT”m
, 
nT”m
);

141242 ifÐ
	gpE
 ){

141243 
	gaEËm
 = &
pE
;

141244 
	gnEËm
 = 1;

141248 ifÐ
	gnEËm
>0 ){

141249 
	gnBy‹
 = (
Fts3SegR—d”
è+ (
nEËm
+1)*(
Fts3HashEËm
 *);

141250 
	gpR—d”
 = (
Fts3SegR—d”
 *)
sql™e3_m®loc
(
nBy‹
);

141251 ifÐ!
	gpR—d”
 ){

141252 
	grc
 = 
SQLITE_NOMEM
;

141254 
mem£t
(
pR—d”
, 0, 
nBy‹
);

141255 
	gpR—d”
->
	giIdx
 = 0x7FFFFFFF;

141256 
	gpR—d”
->
	gµNextEËm
 = (
Fts3HashEËm
 **)&
pR—d”
[1];

141257 
memýy
(
pR—d”
->
µNextEËm
, 
aEËm
, 
nEËm
*(
Fts3HashEËm
 *));

141261 ifÐ
	gbP»fix
 ){

141262 
sql™e3_ä“
(
aEËm
);

141264 *
	gµR—d”
 = 
pR—d”
;

141265  
	grc
;

141280 
ás3SegR—d”Cmp
(
Fts3SegR—d”
 *
pLhs
, Fts3SegR—d” *
pRhs
){

141281 
	grc
;

141282 ifÐ
	gpLhs
->
	gaNode
 && 
	gpRhs
->aNode ){

141283 
	grc2
 = 
pLhs
->
nT”m
 - 
pRhs
->nTerm;

141284 ifÐ
	grc2
<0 ){

141285 
	grc
 = 
memcmp
(
pLhs
->
zT”m
, 
pRhs
->zT”m,…Lhs->
nT”m
);

141287 
	grc
 = 
memcmp
(
pLhs
->
zT”m
, 
pRhs
->zT”m,…Rhs->
nT”m
);

141289 ifÐ
	grc
==0 ){

141290 
rc
 = 
rc2
;

141293 
	grc
 = (
pLhs
->
aNode
==0è- (
pRhs
->aNode==0);

141295 ifÐ
	grc
==0 ){

141296 
rc
 = 
pRhs
->
iIdx
 - 
pLhs
->iIdx;

141298 
as£¹
Ð
rc
!=0 );

141299  
	grc
;

141313 
ás3SegR—d”Doþi¡Cmp
(
Fts3SegR—d”
 *
pLhs
, Fts3SegR—d” *
pRhs
){

141314 
	grc
 = (
pLhs
->
pOff£tLi¡
==0)-(
pRhs
->pOffsetList==0);

141315 ifÐ
	grc
==0 ){

141316 ifÐ
pLhs
->
iDocid
==
pRhs
->iDocid ){

141317 
rc
 = 
pRhs
->
iIdx
 - 
pLhs
->iIdx;

141319 
	grc
 = (
pLhs
->
iDocid
 > 
pRhs
->iDocid) ? 1 : -1;

141322 
as£¹
Ð
pLhs
->
aNode
 && 
pRhs
->aNode );

141323  
	grc
;

141325 
ás3SegR—d”Doþi¡CmpRev
(
Fts3SegR—d”
 *
pLhs
, Fts3SegR—d” *
pRhs
){

141326 
	grc
 = (
pLhs
->
pOff£tLi¡
==0)-(
pRhs
->pOffsetList==0);

141327 ifÐ
	grc
==0 ){

141328 ifÐ
pLhs
->
iDocid
==
pRhs
->iDocid ){

141329 
rc
 = 
pRhs
->
iIdx
 - 
pLhs
->iIdx;

141331 
	grc
 = (
pLhs
->
iDocid
 < 
pRhs
->iDocid) ? 1 : -1;

141334 
as£¹
Ð
pLhs
->
aNode
 && 
pRhs
->aNode );

141335  
	grc
;

141346 
ás3SegR—d”T”mCmp
(

141347 
Fts3SegR—d”
 *
pSeg
,

141348 cÚ¡ *
zT”m
,

141349 
nT”m


141351 
	g»s
 = 0;

141352 ifÐ
	gpSeg
->
	gaNode
 ){

141353 ifÐ
	gpSeg
->
	gnT”m
>nTerm ){

141354 
	g»s
 = 
memcmp
(
pSeg
->
zT”m
, zT”m, 
nT”m
);

141356 
	g»s
 = 
memcmp
(
pSeg
->
zT”m
, zT”m,…Seg->
nT”m
);

141358 ifÐ
	g»s
==0 ){

141359 
»s
 = 
pSeg
->
nT”m
-nTerm;

141362  
	g»s
;

141371 
ás3SegR—d”SÜt
(

141372 
Fts3SegR—d”
 **
­Segm’t
,

141373 
nSegm’t
,

141374 
nSu¥eù
,

141375 (*
xCmp
)(
Fts3SegR—d”
 *, Fts3SegReader *)

141377 
	gi
;

141379 
as£¹
Ð
nSu¥eù
<=
nSegm’t
 );

141381 ifÐ
	gnSu¥eù
==
nSegm’t
 ) 
nSu¥eù
--;

141382 
	gi
=
nSu¥eù
-1; i>=0; i--){

141383 
	gj
;

141384 
	gj
=
i
; j<(
	gnSegm’t
-1); j++){

141385 
Fts3SegR—d”
 *
	gpTmp
;

141386 ifÐ
xCmp
(
­Segm’t
[
j
],‡pSegment[j+1])<0 ) ;

141387 
	gpTmp
 = 
­Segm’t
[
j
+1];

141388 
	g­Segm’t
[
j
+1] = 
­Segm’t
[j];

141389 
	g­Segm’t
[
j
] = 
pTmp
;

141393 #iâdeà
NDEBUG


141395 
	gi
=0; i<(
	gnSu¥eù
-1); i++){

141396 
as£¹
Ð
xCmp
(
­Segm’t
[
i
],‡pSegment[i+1])<0 );

141404 
ás3Wr™eSegm’t
(

141405 
Fts3TabË
 *
p
,

141406 
sql™e3_št64
 
iBlock
,

141407 *
z
,

141408 
n


141410 
sql™e3_¡mt
 *
	gpStmt
;

141411 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_INSERT_SEGMENTS
, &
pStmt
, 0);

141412 ifÐ
	grc
==
SQLITE_OK
 ){

141413 
sql™e3_bšd_št64
(
pStmt
, 1, 
iBlock
);

141414 
sql™e3_bšd_blob
(
pStmt
, 2, 
z
, 
n
, 
SQLITE_STATIC
);

141415 
sql™e3_¡•
(
pStmt
);

141416 
	grc
 = 
sql™e3_»£t
(
pStmt
);

141418  
	grc
;

141426 
SQLITE_PRIVATE
 
sql™e3Fts3MaxLev–
(
Fts3TabË
 *
p
, *
²Max
){

141427 
	grc
;

141428 
	gmxLev–
 = 0;

141429 
sql™e3_¡mt
 *
	gpStmt
 = 0;

141431 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_MXLEVEL
, &
pStmt
, 0);

141432 ifÐ
	grc
==
SQLITE_OK
 ){

141433 ifÐ
SQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

141434 
mxLev–
 = 
sql™e3_cÞumn_št
(
pStmt
, 0);

141436 
	grc
 = 
sql™e3_»£t
(
pStmt
);

141438 *
	g²Max
 = 
mxLev–
;

141439  
	grc
;

141445 
ás3Wr™eSegdœ
(

141446 
Fts3TabË
 *
p
,

141447 
sql™e3_št64
 
iLev–
,

141448 
iIdx
,

141449 
sql™e3_št64
 
iS¹Block
,

141450 
sql™e3_št64
 
iL—fEndBlock
,

141451 
sql™e3_št64
 
iEndBlock
,

141452 
sql™e3_št64
 
nL—fD©a
,

141453 *
zRoÙ
,

141454 
nRoÙ


141456 
sql™e3_¡mt
 *
	gpStmt
;

141457 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_INSERT_SEGDIR
, &
pStmt
, 0);

141458 ifÐ
	grc
==
SQLITE_OK
 ){

141459 
sql™e3_bšd_št64
(
pStmt
, 1, 
iLev–
);

141460 
sql™e3_bšd_št
(
pStmt
, 2, 
iIdx
);

141461 
sql™e3_bšd_št64
(
pStmt
, 3, 
iS¹Block
);

141462 
sql™e3_bšd_št64
(
pStmt
, 4, 
iL—fEndBlock
);

141463 ifÐ
	gnL—fD©a
==0 ){

141464 
sql™e3_bšd_št64
(
pStmt
, 5, 
iEndBlock
);

141466 *
	gzEnd
 = 
sql™e3_m´štf
("%Îd %Îd", 
iEndBlock
, 
nL—fD©a
);

141467 ifÐ!
	gzEnd
 )  
	gSQLITE_NOMEM
;

141468 
sql™e3_bšd_‹xt
(
pStmt
, 5, 
zEnd
, -1, 
sql™e3_ä“
);

141470 
sql™e3_bšd_blob
(
pStmt
, 6, 
zRoÙ
, 
nRoÙ
, 
SQLITE_STATIC
);

141471 
sql™e3_¡•
(
pStmt
);

141472 
	grc
 = 
sql™e3_»£t
(
pStmt
);

141474  
	grc
;

141485 
ás3P»fixCom´ess
(

141486 cÚ¡ *
zP»v
,

141487 
nP»v
,

141488 cÚ¡ *
zNext
,

141489 
nNext


141491 
	gn
;

141492 
UNUSED_PARAMETER
(
nNext
);

141493 
	gn
=0;‚<
	gnP»v
 && 
	gzP»v
[
n
]==
zNext
[n];‚++);

141494  
	gn
;

141501 
ás3NodeAddT”m
(

141502 
Fts3TabË
 *
p
,

141503 
Segm’tNode
 **
µT»e
,

141504 
isCÝyT”m
,

141505 cÚ¡ *
zT”m
,

141506 
nT”m


141508 
Segm’tNode
 *
	gpT»e
 = *
µT»e
;

141509 
	grc
;

141510 
Segm’tNode
 *
	gpNew
;

141515 ifÐ
	gpT»e
 ){

141516 
	gnD©a
 = 
pT»e
->
nD©a
;

141517 
	gnReq
 = 
nD©a
;

141518 
	gnP»fix
;

141519 
	gnSuffix
;

141521 
	gnP»fix
 = 
ás3P»fixCom´ess
(
pT»e
->
zT”m
,…T»e->
nT”m
, zTerm,‚Term);

141522 
	gnSuffix
 = 
nT”m
-
nP»fix
;

141524 
	gnReq
 +ð
sql™e3Fts3V¬štL’
(
nP»fix
)+sql™e3Fts3V¬štL’(
nSuffix
)+nSuffix;

141525 ifÐ
	gnReq
<=
p
->
nNodeSize
 || !
pT»e
->
zT”m
 ){

141527 ifÐ
nReq
>
p
->
nNodeSize
 ){

141535 
as£¹
Ð
pT»e
->
aD©a
==(*)&pTree[1] );

141536 
	gpT»e
->
	gaD©a
 = (*)
sql™e3_m®loc
(
nReq
);

141537 ifÐ!
	gpT»e
->
	gaD©a
 ){

141538  
	gSQLITE_NOMEM
;

141542 ifÐ
	gpT»e
->
	gzT”m
 ){

141544 
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
pT»e
->
aD©a
[
nD©a
], 
nP»fix
);

141547 
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
pT»e
->
aD©a
[
nD©a
], 
nSuffix
);

141548 
memýy
(&
pT»e
->
aD©a
[
nD©a
], &
zT”m
[
nP»fix
], 
nSuffix
);

141549 
	gpT»e
->
	gnD©a
 = 
nD©a
 + 
nSuffix
;

141550 
	gpT»e
->
	gnEÁry
++;

141552 ifÐ
	gisCÝyT”m
 ){

141553 ifÐ
	gpT»e
->
	gnM®loc
<
	gnT”m
 ){

141554 *
	gzNew
 = 
sql™e3_»®loc
(
pT»e
->
zM®loc
, 
nT”m
*2);

141555 ifÐ!
	gzNew
 ){

141556  
	gSQLITE_NOMEM
;

141558 
	gpT»e
->
	gnM®loc
 = 
nT”m
*2;

141559 
	gpT»e
->
	gzM®loc
 = 
zNew
;

141561 
	gpT»e
->
	gzT”m
 = 
pT»e
->
zM®loc
;

141562 
memýy
(
pT»e
->
zT”m
, zT”m, 
nT”m
);

141563 
	gpT»e
->
	gnT”m
 = 
nT”m
;

141565 
	gpT»e
->
	gzT”m
 = (*)
zT”m
;

141566 
	gpT»e
->
	gnT”m
 = 
nT”m
;

141568  
	gSQLITE_OK
;

141580 
	gpNew
 = (
Segm’tNode
 *)
sql™e3_m®loc
((Segm’tNodeè+ 
p
->
nNodeSize
);

141581 ifÐ!
	gpNew
 ){

141582  
	gSQLITE_NOMEM
;

141584 
mem£t
(
pNew
, 0, (
Segm’tNode
));

141585 
	gpNew
->
	gnD©a
 = 1 + 
FTS3_VARINT_MAX
;

141586 
	gpNew
->
	gaD©a
 = (*)&
pNew
[1];

141588 ifÐ
	gpT»e
 ){

141589 
Segm’tNode
 *
	gpP¬’t
 = 
pT»e
->
pP¬’t
;

141590 
	grc
 = 
ás3NodeAddT”m
(
p
, &
pP¬’t
, 
isCÝyT”m
, 
zT”m
, 
nT”m
);

141591 ifÐ
	gpT»e
->
	gpP¬’t
==0 ){

141592 
pT»e
->
pP¬’t
 =…Parent;

141594 
	gpT»e
->
	gpRight
 = 
pNew
;

141595 
	gpNew
->
	gpLeámo¡
 = 
pT»e
->
pLeámo¡
;

141596 
	gpNew
->
	gpP¬’t
 = 
pP¬’t
;

141597 
	gpNew
->
	gzM®loc
 = 
pT»e
->
zM®loc
;

141598 
	gpNew
->
	gnM®loc
 = 
pT»e
->
nM®loc
;

141599 
	gpT»e
->
	gzM®loc
 = 0;

141601 
	gpNew
->
	gpLeámo¡
 = 
pNew
;

141602 
	grc
 = 
ás3NodeAddT”m
(
p
, &
pNew
, 
isCÝyT”m
, 
zT”m
, 
nT”m
);

141605 *
	gµT»e
 = 
pNew
;

141606  
	grc
;

141612 
ás3T»eFšishNode
(

141613 
Segm’tNode
 *
pT»e
,

141614 
iHeight
,

141615 
sql™e3_št64
 
iLeáChžd


141617 
	gnS¹
;

141618 
as£¹
Ð
iHeight
>=1 && iHeight<128 );

141619 
	gnS¹
 = 
FTS3_VARINT_MAX
 - 
sql™e3Fts3V¬štL’
(
iLeáChžd
);

141620 
	gpT»e
->
	gaD©a
[
nS¹
] = ()
iHeight
;

141621 
sql™e3Fts3PutV¬št
(&
pT»e
->
aD©a
[
nS¹
+1], 
iLeáChžd
);

141622  
	gnS¹
;

141638 
ás3NodeWr™e
(

141639 
Fts3TabË
 *
p
,

141640 
Segm’tNode
 *
pT»e
,

141641 
iHeight
,

141642 
sql™e3_št64
 
iL—f
,

141643 
sql™e3_št64
 
iF»e
,

141644 
sql™e3_št64
 *
piLa¡
,

141645 **
·RoÙ
,

141646 *
²RoÙ


141648 
	grc
 = 
SQLITE_OK
;

141650 ifÐ!
	gpT»e
->
	gpP¬’t
 ){

141652 
	gnS¹
 = 
ás3T»eFšishNode
(
pT»e
, 
iHeight
, 
iL—f
);

141653 *
	gpiLa¡
 = 
iF»e
-1;

141654 *
	g²RoÙ
 = 
pT»e
->
nD©a
 - 
nS¹
;

141655 *
	g·RoÙ
 = &
pT»e
->
aD©a
[
nS¹
];

141657 
Segm’tNode
 *
	gpI‹r
;

141658 
sql™e3_št64
 
	giNextF»e
 = 
iF»e
;

141659 
sql™e3_št64
 
	giNextL—f
 = 
iL—f
;

141660 
	gpI‹r
=
pT»e
->
pLeámo¡
;…I‹¸&& 
	grc
==
SQLITE_OK
;…I‹r=
pI‹r
->
pRight
){

141661 
nS¹
 = 
ás3T»eFšishNode
(
pI‹r
, 
iHeight
, 
iNextL—f
);

141662 
	gnWr™e
 = 
pI‹r
->
nD©a
 - 
nS¹
;

141664 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
iNextF»e
, &
pI‹r
->
aD©a
[
nS¹
], 
nWr™e
);

141665 
	giNextF»e
++;

141666 
	giNextL—f
 +ð(
pI‹r
->
nEÁry
+1);

141668 ifÐ
	grc
==
SQLITE_OK
 ){

141669 
as£¹
Ð
iNextL—f
==
iF»e
 );

141670 
	grc
 = 
ás3NodeWr™e
(

141671 
p
, 
pT»e
->
pP¬’t
, 
iHeight
+1, 
iF»e
, 
iNextF»e
, 
piLa¡
, 
·RoÙ
, 
²RoÙ


141676  
	grc
;

141682 
ás3NodeF»e
(
Segm’tNode
 *
pT»e
){

141683 ifÐ
	gpT»e
 ){

141684 
Segm’tNode
 *
	gp
 = 
pT»e
->
pLeámo¡
;

141685 
ás3NodeF»e
(
p
->
pP¬’t
);

141686  
	gp
 ){

141687 
Segm’tNode
 *
	gpRight
 = 
p
->
pRight
;

141688 ifÐ
	gp
->
	gaD©a
!=(*)&
p
[1] ){

141689 
sql™e3_ä“
(
p
->
aD©a
);

141691 
as£¹
Ð
pRight
==0 || 
p
->
zM®loc
==0 );

141692 
sql™e3_ä“
(
p
->
zM®loc
);

141693 
sql™e3_ä“
(
p
);

141694 
	gp
 = 
pRight
;

141707 
ás3SegWr™”Add
(

141708 
Fts3TabË
 *
p
,

141709 
Segm’tWr™”
 **
µWr™”
,

141710 
isCÝyT”m
,

141711 cÚ¡ *
zT”m
,

141712 
nT”m
,

141713 cÚ¡ *
aDoþi¡
,

141714 
nDoþi¡


141716 
	gnP»fix
;

141717 
	gnSuffix
;

141718 
	gnReq
;

141719 
	gnD©a
;

141720 
Segm’tWr™”
 *
	gpWr™”
 = *
µWr™”
;

141722 ifÐ!
	gpWr™”
 ){

141723 
	grc
;

141724 
sql™e3_¡mt
 *
	gpStmt
;

141727 
	gpWr™”
 = (
Segm’tWr™”
 *)
sql™e3_m®loc
((SegmentWriter));

141728 ifÐ!
	gpWr™”
 )  
	gSQLITE_NOMEM
;

141729 
mem£t
(
pWr™”
, 0, (
Segm’tWr™”
));

141730 *
	gµWr™”
 = 
pWr™”
;

141733 
	gpWr™”
->
	gaD©a
 = (*)
sql™e3_m®loc
(
p
->
nNodeSize
);

141734 ifÐ!
	gpWr™”
->
	gaD©a
 )  
	gSQLITE_NOMEM
;

141735 
	gpWr™”
->
	gnSize
 = 
p
->
nNodeSize
;

141738 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_NEXT_SEGMENTS_ID
, &
pStmt
, 0);

141739 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141740 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

141741 
pWr™”
->
iF»e
 = 
sql™e3_cÞumn_št64
(
pStmt
, 0);

141742 
	gpWr™”
->
	giFœ¡
 = 
pWr™”
->
iF»e
;

141744 
	grc
 = 
sql™e3_»£t
(
pStmt
);

141745 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141747 
	gnD©a
 = 
pWr™”
->
nD©a
;

141749 
	gnP»fix
 = 
ás3P»fixCom´ess
(
pWr™”
->
zT”m
,…Wr™”->
nT”m
, zTerm,‚Term);

141750 
	gnSuffix
 = 
nT”m
-
nP»fix
;

141753 
	gnReq
 = 
sql™e3Fts3V¬štL’
(
nP»fix
) +

141754 
sql™e3Fts3V¬štL’
(
nSuffix
) +

141755 
nSuffix
 +

141756 
sql™e3Fts3V¬štL’
(
nDoþi¡
) +

141757 
nDoþi¡
;

141759 ifÐ
	gnD©a
>0 &&‚D©a+
	gnReq
>
	gp
->
	gnNodeSize
 ){

141760 
	grc
;

141763 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
pWr™”
->
iF»e
++,…Wr™”->
aD©a
, 
nD©a
);

141764 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141765 
	gp
->
	gnL—fAdd
++;

141779 
as£¹
Ð
nP»fix
<
nT”m
 );

141780 
	grc
 = 
ás3NodeAddT”m
(
p
, &
pWr™”
->
pT»e
, 
isCÝyT”m
, 
zT”m
, 
nP»fix
+1);

141781 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141783 
	gnD©a
 = 0;

141784 
	gpWr™”
->
	gnT”m
 = 0;

141786 
	gnP»fix
 = 0;

141787 
	gnSuffix
 = 
nT”m
;

141788 
	gnReq
 = 1 +

141789 
sql™e3Fts3V¬štL’
(
nT”m
) +

141790 
nT”m
 +

141791 
sql™e3Fts3V¬štL’
(
nDoþi¡
) +

141792 
nDoþi¡
;

141796 
	gpWr™”
->
	gnL—fD©a
 +ð
nReq
;

141801 ifÐ
	gnReq
>
	gpWr™”
->
	gnSize
 ){

141802 *
	gaNew
 = 
sql™e3_»®loc
(
pWr™”
->
aD©a
, 
nReq
);

141803 ifÐ!
	gaNew
 )  
	gSQLITE_NOMEM
;

141804 
	gpWr™”
->
	gaD©a
 = 
aNew
;

141805 
	gpWr™”
->
	gnSize
 = 
nReq
;

141807 
as£¹
Ð
nD©a
+
nReq
<=
pWr™”
->
nSize
 );

141810 
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
pWr™”
->
aD©a
[
nD©a
], 
nP»fix
);

141811 
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
pWr™”
->
aD©a
[
nD©a
], 
nSuffix
);

141812 
memýy
(&
pWr™”
->
aD©a
[
nD©a
], &
zT”m
[
nP»fix
], 
nSuffix
);

141813 
	gnD©a
 +ð
nSuffix
;

141814 
	gnD©a
 +ð
sql™e3Fts3PutV¬št
(&
pWr™”
->
aD©a
[
nD©a
], 
nDoþi¡
);

141815 
memýy
(&
pWr™”
->
aD©a
[
nD©a
], 
aDoþi¡
, 
nDoþi¡
);

141816 
	gpWr™”
->
	gnD©a
 = 
nD©a
 + 
nDoþi¡
;

141823 ifÐ
	gisCÝyT”m
 ){

141824 ifÐ
	gnT”m
>
	gpWr™”
->
	gnM®loc
 ){

141825 *
	gzNew
 = 
sql™e3_»®loc
(
pWr™”
->
zM®loc
, 
nT”m
*2);

141826 ifÐ!
	gzNew
 ){

141827  
	gSQLITE_NOMEM
;

141829 
	gpWr™”
->
	gnM®loc
 = 
nT”m
*2;

141830 
	gpWr™”
->
	gzM®loc
 = 
zNew
;

141831 
	gpWr™”
->
	gzT”m
 = 
zNew
;

141833 
as£¹
Ð
pWr™”
->
zT”m
=õWr™”->
zM®loc
 );

141834 
memýy
(
pWr™”
->
zT”m
, zT”m, 
nT”m
);

141836 
	gpWr™”
->
	gzT”m
 = (*)
zT”m
;

141838 
	gpWr™”
->
	gnT”m
 = 
nT”m
;

141840  
	gSQLITE_OK
;

141849 
ás3SegWr™”Flush
(

141850 
Fts3TabË
 *
p
,

141851 
Segm’tWr™”
 *
pWr™”
,

141852 
sql™e3_št64
 
iLev–
,

141853 
iIdx


141855 
	grc
;

141856 ifÐ
	gpWr™”
->
	gpT»e
 ){

141857 
sql™e3_št64
 
	giLa¡
 = 0;

141858 
sql™e3_št64
 
	giLa¡L—f
;

141859 *
	gzRoÙ
 = 
NULL
;

141860 
	gnRoÙ
 = 0;

141862 
	giLa¡L—f
 = 
pWr™”
->
iF»e
;

141863 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
pWr™”
->
iF»e
++,…Wr™”->
aD©a
,…Wr™”->
nD©a
);

141864 ifÐ
	grc
==
SQLITE_OK
 ){

141865 
rc
 = 
ás3NodeWr™e
(
p
, 
pWr™”
->
pT»e
, 1,

141866 
pWr™”
->
iFœ¡
,…Wr™”->
iF»e
, &
iLa¡
, &
zRoÙ
, &
nRoÙ
);

141868 ifÐ
	grc
==
SQLITE_OK
 ){

141869 
rc
 = 
ás3Wr™eSegdœ
(
p
, 
iLev–
, 
iIdx
,

141870 
pWr™”
->
iFœ¡
, 
iLa¡L—f
, 
iLa¡
,…Wr™”->
nL—fD©a
, 
zRoÙ
, 
nRoÙ
);

141874 
	grc
 = 
ás3Wr™eSegdœ
(
p
, 
iLev–
, 
iIdx
,

141875 0, 0, 0, 
pWr™”
->
nL—fD©a
,…Wr™”->
aD©a
,…Wr™”->
nD©a
);

141877 
	gp
->
	gnL—fAdd
++;

141878  
	grc
;

141885 
ás3SegWr™”F»e
(
Segm’tWr™”
 *
pWr™”
){

141886 ifÐ
	gpWr™”
 ){

141887 
sql™e3_ä“
(
pWr™”
->
aD©a
);

141888 
sql™e3_ä“
(
pWr™”
->
zM®loc
);

141889 
ás3NodeF»e
(
pWr™”
->
pT»e
);

141890 
sql™e3_ä“
(
pWr™”
);

141904 
ás3IsEm±y
(
Fts3TabË
 *
p
, 
sql™e3_v®ue
 *
pRowid
, *
pisEm±y
){

141905 
sql™e3_¡mt
 *
	gpStmt
;

141906 
	grc
;

141907 ifÐ
	gp
->
	gzCÚ‹ÁTbl
 ){

141909 *
	gpisEm±y
 = 0;

141910 
	grc
 = 
SQLITE_OK
;

141912 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_IS_EMPTY
, &
pStmt
, &
pRowid
);

141913 ifÐ
	grc
==
SQLITE_OK
 ){

141914 ifÐ
SQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

141915 *
pisEm±y
 = 
sql™e3_cÞumn_št
(
pStmt
, 0);

141917 
	grc
 = 
sql™e3_»£t
(
pStmt
);

141920  
	grc
;

141931 
ás3Segm’tMaxLev–
(

141932 
Fts3TabË
 *
p
,

141933 
iLªgid
,

141934 
iIndex
,

141935 
sql™e3_št64
 *
²Max


141937 
sql™e3_¡mt
 *
	gpStmt
;

141938 
	grc
;

141939 
as£¹
Ð
iIndex
>=0 && iIndex<
p
->
nIndex
 );

141947 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_SEGDIR_MAX_LEVEL
, &
pStmt
, 0);

141948 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141949 
sql™e3_bšd_št64
(
pStmt
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 0));

141950 
sql™e3_bšd_št64
(
pStmt
, 2,

141951 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
FTS3_SEGDIR_MAXLEVEL
-1)

141953 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

141954 *
²Max
 = 
sql™e3_cÞumn_št64
(
pStmt
, 0);

141956  
sql™e3_»£t
(
pStmt
);

141967 
ás3Segm’tIsMaxLev–
(
Fts3TabË
 *
p
, 
i64
 
iAbsLev–
, *
pbMax
){

141975 
sql™e3_¡mt
 *
	gpStmt
;

141976 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_SEGDIR_MAX_LEVEL
, &
pStmt
, 0);

141977 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

141978 
sql™e3_bšd_št64
(
pStmt
, 1, 
iAbsLev–
+1);

141979 
sql™e3_bšd_št64
(
pStmt
, 2,

141980 ((
iAbsLev–
/
FTS3_SEGDIR_MAXLEVEL
)+1) * FTS3_SEGDIR_MAXLEVEL

141983 *
	gpbMax
 = 0;

141984 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

141985 *
pbMax
 = 
sql™e3_cÞumn_ty³
(
pStmt
, 0)==
SQLITE_NULL
;

141987  
sql™e3_»£t
(
pStmt
);

141995 
ás3D–‘eSegm’t
(

141996 
Fts3TabË
 *
p
,

141997 
Fts3SegR—d”
 *
pSeg


141999 
	grc
 = 
SQLITE_OK
;

142000 ifÐ
	gpSeg
->
	giS¹Block
 ){

142001 
sql™e3_¡mt
 *
	gpD–‘e
;

142002 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGMENTS_RANGE
, &
pD–‘e
, 0);

142003 ifÐ
	grc
==
SQLITE_OK
 ){

142004 
sql™e3_bšd_št64
(
pD–‘e
, 1, 
pSeg
->
iS¹Block
);

142005 
sql™e3_bšd_št64
(
pD–‘e
, 2, 
pSeg
->
iEndBlock
);

142006 
sql™e3_¡•
(
pD–‘e
);

142007 
	grc
 = 
sql™e3_»£t
(
pD–‘e
);

142010  
	grc
;

142027 
ás3D–‘eSegdœ
(

142028 
Fts3TabË
 *
p
,

142029 
iLªgid
,

142030 
iIndex
,

142031 
iLev–
,

142032 
Fts3SegR—d”
 **
­Segm’t
,

142033 
nR—d”


142035 
	grc
 = 
SQLITE_OK
;

142036 
	gi
;

142037 
sql™e3_¡mt
 *
	gpD–‘e
 = 0;

142039 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
nR—d”
; i++){

142040 
	grc
 = 
ás3D–‘eSegm’t
(
p
, 
­Segm’t
[
i
]);

142042 ifÐ
	grc
!=
SQLITE_OK
 ){

142043  
rc
;

142046 
as£¹
Ð
iLev–
>=0 || iLev–==
FTS3_SEGCURSOR_ALL
 );

142047 ifÐ
	giLev–
==
FTS3_SEGCURSOR_ALL
 ){

142048 
rc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGDIR_RANGE
, &
pD–‘e
, 0);

142049 ifÐ
	grc
==
SQLITE_OK
 ){

142050 
sql™e3_bšd_št64
(
pD–‘e
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 0));

142051 
sql™e3_bšd_št64
(
pD–‘e
, 2,

142052 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
FTS3_SEGDIR_MAXLEVEL
-1)

142056 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGDIR_LEVEL
, &
pD–‘e
, 0);

142057 ifÐ
	grc
==
SQLITE_OK
 ){

142058 
sql™e3_bšd_št64
(

142059 
pD–‘e
, 1, 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
)

142064 ifÐ
	grc
==
SQLITE_OK
 ){

142065 
sql™e3_¡•
(
pD–‘e
);

142066 
	grc
 = 
sql™e3_»£t
(
pD–‘e
);

142069  
	grc
;

142084 
ás3CÞumnFž‹r
(

142085 
iCÞ
,

142086 
bZ”o
,

142087 **
µLi¡
,

142088 *
²Li¡


142090 *
	gpLi¡
 = *
µLi¡
;

142091 
	gnLi¡
 = *
²Li¡
;

142092 *
	gpEnd
 = &
pLi¡
[
nLi¡
];

142093 
	giCu¼’t
 = 0;

142094 *
	gp
 = 
pLi¡
;

142096 
as£¹
Ð
iCÞ
>=0 );

142098 
	gc
 = 0;

142099  
	gp
<
	gpEnd
 && (
	gc
 | *p)&0xFE ) c = *
p
++ & 0x80;

142101 ifÐ
	giCÞ
==
iCu¼’t
 ){

142102 
nLi¡
 = ()(
p
 - 
pLi¡
);

142106 
	gnLi¡
 -ð()(
p
 - 
pLi¡
);

142107 
	gpLi¡
 = 
p
;

142108 ifÐ
	gnLi¡
==0 ){

142111 
	gp
 = &
pLi¡
[1];

142112 
	gp
 +ð
ás3G‘V¬št32
(
p
, &
iCu¼’t
);

142115 ifÐ
	gbZ”o
 && &
	gpLi¡
[
nLi¡
]!=
pEnd
 ){

142116 
mem£t
(&
pLi¡
[
nLi¡
], 0, 
pEnd
 - &pList[nList]);

142118 *
	gµLi¡
 = 
pLi¡
;

142119 *
	g²Li¡
 = 
nLi¡
;

142129 
ás3M¤BufãrD©a
(

142130 
Fts3MuÉiSegR—d”
 *
pM¤
,

142131 *
pLi¡
,

142132 
nLi¡


142134 ifÐ
	gnLi¡
>
	gpM¤
->
	gnBufãr
 ){

142135 *
	gpNew
;

142136 
	gpM¤
->
	gnBufãr
 = 
nLi¡
*2;

142137 
	gpNew
 = (*)
sql™e3_»®loc
(
pM¤
->
aBufãr
,…M¤->
nBufãr
);

142138 ifÐ!
	gpNew
 )  
	gSQLITE_NOMEM
;

142139 
	gpM¤
->
	gaBufãr
 = 
pNew
;

142142 
memýy
(
pM¤
->
aBufãr
, 
pLi¡
, 
nLi¡
);

142143  
	gSQLITE_OK
;

142146 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüNext
(

142147 
Fts3TabË
 *
p
,

142148 
Fts3MuÉiSegR—d”
 *
pM¤
,

142149 
sql™e3_št64
 *
piDocid
,

142150 **
·Po¦i¡
,

142151 *
²Po¦i¡


142153 
	gnM”ge
 = 
pM¤
->
nAdvªû
;

142154 
Fts3SegR—d”
 **
	g­Segm’t
 = 
pM¤
->
­Segm’t
;

142155 (*
	gxCmp
)(
	gFts3SegR—d”
 *, Fts3SegReader *) = (

142156 
p
->
bDescIdx
 ? 
ás3SegR—d”Doþi¡CmpRev
 : 
ás3SegR—d”Doþi¡Cmp


142159 ifÐ
	gnM”ge
==0 ){

142160 *
·Po¦i¡
 = 0;

142161  
	gSQLITE_OK
;

142165 
Fts3SegR—d”
 *
	gpSeg
;

142166 
	gpSeg
 = 
pM¤
->
­Segm’t
[0];

142168 ifÐ
	gpSeg
->
	gpOff£tLi¡
==0 ){

142169 *
·Po¦i¡
 = 0;

142172 
	grc
;

142173 *
	gpLi¡
;

142174 
	gnLi¡
;

142175 
	gj
;

142176 
sql™e3_št64
 
	giDocid
 = 
­Segm’t
[0]->
iDocid
;

142178 
	grc
 = 
ás3SegR—d”NextDocid
(
p
, 
­Segm’t
[0], &
pLi¡
, &
nLi¡
);

142179 
	gj
 = 1;

142180  
	grc
==
SQLITE_OK


142181 && 
j
<
nM”ge


142182 && 
­Segm’t
[
j
]->
pOff£tLi¡


142183 && 
­Segm’t
[
j
]->
iDocid
==iDocid

142185 
rc
 = 
ás3SegR—d”NextDocid
(
p
, 
­Segm’t
[
j
], 0, 0);

142186 
	gj
++;

142188 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142189 
ás3SegR—d”SÜt
(
pM¤
->
­Segm’t
, 
nM”ge
, 
j
, 
xCmp
);

142191 ifÐ
	gnLi¡
>0 && 
ás3SegR—d”IsP’dšg
(
­Segm’t
[0]) ){

142192 
	grc
 = 
ás3M¤BufãrD©a
(
pM¤
, 
pLi¡
, 
nLi¡
+1);

142193 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142194 
as£¹
Ð(
pM¤
->
aBufãr
[
nLi¡
] & 0xFE)==0x00 );

142195 
	gpLi¡
 = 
pM¤
->
aBufãr
;

142198 ifÐ
	gpM¤
->
	giCÞFž‹r
>=0 ){

142199 
ás3CÞumnFž‹r
(
pM¤
->
iCÞFž‹r
, 1, &
pLi¡
, &
nLi¡
);

142202 ifÐ
	gnLi¡
>0 ){

142203 *
	g·Po¦i¡
 = 
pLi¡
;

142204 *
	gpiDocid
 = 
iDocid
;

142205 *
	g²Po¦i¡
 = 
nLi¡
;

142211  
	gSQLITE_OK
;

142214 
ás3SegR—d”S¹
(

142215 
Fts3TabË
 *
p
,

142216 
Fts3MuÉiSegR—d”
 *
pC¤
,

142217 cÚ¡ *
zT”m
,

142218 
nT”m


142220 
	gi
;

142221 
	gnSeg
 = 
pC¤
->
nSegm’t
;

142229 
	gi
=0; 
	gpC¤
->
	gbRe¡¬t
==0 && 
i
<
pC¤
->
nSegm’t
; i++){

142230 
	g»s
 = 0;

142231 
Fts3SegR—d”
 *
	gpSeg
 = 
pC¤
->
­Segm’t
[
i
];

142233 
	grc
 = 
ás3SegR—d”Next
(
p
, 
pSeg
, 0);

142234 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142235 } 
	gzT”m
 && (
	g»s
 = 
ás3SegR—d”T”mCmp
(
pSeg
, 
zT”m
, 
nT”m
))<0 );

142237 ifÐ
	gpSeg
->
	gbLookup
 && 
	g»s
!=0 ){

142238 
ás3SegR—d”S‘Eof
(
pSeg
);

142241 
ás3SegR—d”SÜt
(
pC¤
->
­Segm’t
, 
nSeg
,‚Seg, 
ás3SegR—d”Cmp
);

142243  
	gSQLITE_OK
;

142246 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”S¹
(

142247 
Fts3TabË
 *
p
,

142248 
Fts3MuÉiSegR—d”
 *
pC¤
,

142249 
Fts3SegFž‹r
 *
pFž‹r


142251 
	gpC¤
->
	gpFž‹r
 = 
pFž‹r
;

142252  
ás3SegR—d”S¹
(
p
, 
pC¤
, 
pFž‹r
->
zT”m
,…Fž‹r->
nT”m
);

142255 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüS¹
(

142256 
Fts3TabË
 *
p
,

142257 
Fts3MuÉiSegR—d”
 *
pC¤
,

142258 
iCÞ
,

142259 cÚ¡ *
zT”m
,

142260 
nT”m


142262 
	gi
;

142263 
	grc
;

142264 
	gnSegm’t
 = 
pC¤
->
nSegm’t
;

142265 (*
	gxCmp
)(
	gFts3SegR—d”
 *, Fts3SegReader *) = (

142266 
p
->
bDescIdx
 ? 
ás3SegR—d”Doþi¡CmpRev
 : 
ás3SegR—d”Doþi¡Cmp


142269 
as£¹
Ð
pC¤
->
pFž‹r
==0 );

142270 
as£¹
Ð
zT”m
 && 
nT”m
>0 );

142273 
	grc
 = 
ás3SegR—d”S¹
(
p
, 
pC¤
, 
zT”m
, 
nT”m
);

142274 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142277 
	gi
=0; i<
	gnSegm’t
; i++){

142278 
Fts3SegR—d”
 *
	gpSeg
 = 
pC¤
->
­Segm’t
[
i
];

142279 ifÐ!
	gpSeg
->
	gaNode
 || 
ás3SegR—d”T”mCmp
(
pSeg
, 
zT”m
, 
nT”m
) ){

142283 
	gpC¤
->
	gnAdvªû
 = 
i
;

142286 
	gi
=0; i<
	gpC¤
->
	gnAdvªû
; i++){

142287 
	grc
 = 
ás3SegR—d”Fœ¡Docid
(
p
, 
pC¤
->
­Segm’t
[
i
]);

142288 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142290 
ás3SegR—d”SÜt
(
pC¤
->
­Segm’t
, 
i
, i, 
xCmp
);

142292 
as£¹
Ð
iCÞ
<0 || iCÞ<
p
->
nCÞumn
 );

142293 
	gpC¤
->
	giCÞFž‹r
 = 
iCÞ
;

142295  
	gSQLITE_OK
;

142310 
SQLITE_PRIVATE
 
sql™e3Fts3M¤InüRe¡¬t
(
Fts3MuÉiSegR—d”
 *
pC¤
){

142311 
	gi
;

142313 
as£¹
Ð
pC¤
->
zT”m
==0 );

142314 
as£¹
Ð
pC¤
->
nT”m
==0 );

142315 
as£¹
Ð
pC¤
->
aDoþi¡
==0 );

142316 
as£¹
Ð
pC¤
->
nDoþi¡
==0 );

142318 
	gpC¤
->
	gnAdvªû
 = 0;

142319 
	gpC¤
->
	gbRe¡¬t
 = 1;

142320 
	gi
=0; i<
	gpC¤
->
	gnSegm’t
; i++){

142321 
	gpC¤
->
	g­Segm’t
[
i
]->
	gpOff£tLi¡
 = 0;

142322 
	gpC¤
->
	g­Segm’t
[
i
]->
	gnOff£tLi¡
 = 0;

142323 
	gpC¤
->
	g­Segm’t
[
i
]->
	giDocid
 = 0;

142326  
	gSQLITE_OK
;

142330 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”S‹p
(

142331 
Fts3TabË
 *
p
,

142332 
Fts3MuÉiSegR—d”
 *
pC¤


142334 
	grc
 = 
SQLITE_OK
;

142336 
	gisIgnÜeEm±y
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_IGNORE_EMPTY
);

142337 
	gisRequœePos
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_REQUIRE_POS
);

142338 
	gisCÞFž‹r
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_COLUMN_FILTER
);

142339 
	gisP»fix
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_PREFIX
);

142340 
	gisSÿn
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_SCAN
);

142341 
	gisFœ¡
 = (
pC¤
->
pFž‹r
->
æags
 & 
FTS3_SEGMENT_FIRST
);

142343 
Fts3SegR—d”
 **
	g­Segm’t
 = 
pC¤
->
­Segm’t
;

142344 
	gnSegm’t
 = 
pC¤
->
nSegm’t
;

142345 
Fts3SegFž‹r
 *
	gpFž‹r
 = 
pC¤
->
pFž‹r
;

142346 (*
	gxCmp
)(
	gFts3SegR—d”
 *, Fts3SegReader *) = (

142347 
p
->
bDescIdx
 ? 
ás3SegR—d”Doþi¡CmpRev
 : 
ás3SegR—d”Doþi¡Cmp


142350 ifÐ
	gpC¤
->
	gnSegm’t
==0 )  
SQLITE_OK
;

142353 
	gnM”ge
;

142354 
	gi
;

142359 
	gi
=0; i<
	gpC¤
->
	gnAdvªû
; i++){

142360 
Fts3SegR—d”
 *
	gpSeg
 = 
­Segm’t
[
i
];

142361 ifÐ
	gpSeg
->
	gbLookup
 ){

142362 
ás3SegR—d”S‘Eof
(
pSeg
);

142364 
	grc
 = 
ás3SegR—d”Next
(
p
, 
pSeg
, 0);

142366 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

142368 
ás3SegR—d”SÜt
(
­Segm’t
, 
nSegm’t
, 
pC¤
->
nAdvªû
, 
ás3SegR—d”Cmp
);

142369 
	gpC¤
->
	gnAdvªû
 = 0;

142372 
as£¹
Ð
rc
==
SQLITE_OK
 );

142373 ifÐ
	g­Segm’t
[0]->
	gaNode
==0 ) ;

142375 
	gpC¤
->
	gnT”m
 = 
­Segm’t
[0]->
nT”m
;

142376 
	gpC¤
->
	gzT”m
 = 
­Segm’t
[0]->
zT”m
;

142385 ifÐ
	gpFž‹r
->
	gzT”m
 && !
	gisSÿn
 ){

142386 ifÐ
	gpC¤
->
	gnT”m
<
	gpFž‹r
->nTerm

142387 || (!
	gisP»fix
 && 
	gpC¤
->
	gnT”m
>
	gpFž‹r
->nTerm)

142388 || 
memcmp
(
pC¤
->
zT”m
, 
pFž‹r
->zT”m,…Fž‹r->
nT”m
)

142394 
	gnM”ge
 = 1;

142395  
	gnM”ge
<
	gnSegm’t


142396 && 
	g­Segm’t
[
nM”ge
]->
	gaNode


142397 && 
	g­Segm’t
[
nM”ge
]->
	gnT”m
==
pC¤
->
nT”m


142398 && 0==
memcmp
(
pC¤
->
zT”m
, 
­Segm’t
[
nM”ge
]->zT”m,…C¤->
nT”m
)

142400 
	gnM”ge
++;

142403 
as£¹
Ð
isIgnÜeEm±y
 || (
isRequœePos
 && !
isCÞFž‹r
) );

142404 ifÐ
	gnM”ge
==1

142405 && !
isIgnÜeEm±y


142406 && !
isFœ¡


142407 && (
p
->
bDescIdx
==0 || 
ás3SegR—d”IsP’dšg
(
­Segm’t
[0])==0)

142409 
pC¤
->
nDoþi¡
 = 
­Segm’t
[0]->nDoclist;

142410 ifÐ
ás3SegR—d”IsP’dšg
(
­Segm’t
[0]) ){

142411 
	grc
 = 
ás3M¤BufãrD©a
(
pC¤
, 
­Segm’t
[0]->
aDoþi¡
,…C¤->
nDoþi¡
);

142412 
	gpC¤
->
	gaDoþi¡
 = 
pC¤
->
aBufãr
;

142414 
	gpC¤
->
	gaDoþi¡
 = 
­Segm’t
[0]->
aDoþi¡
;

142416 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
SQLITE_ROW
;

142418 
	gnDoþi¡
 = 0;

142419 
sql™e3_št64
 
	giP»v
 = 0;

142425 
	gi
=0; i<
	gnM”ge
; i++){

142426 
ás3SegR—d”Fœ¡Docid
(
p
, 
­Segm’t
[
i
]);

142428 
ás3SegR—d”SÜt
(
­Segm’t
, 
nM”ge
,‚M”ge, 
xCmp
);

142429  
	g­Segm’t
[0]->
	gpOff£tLi¡
 ){

142430 
	gj
;

142431 *
	gpLi¡
 = 0;

142432 
	gnLi¡
 = 0;

142433 
	gnBy‹
;

142434 
sql™e3_št64
 
	giDocid
 = 
­Segm’t
[0]->
iDocid
;

142435 
ás3SegR—d”NextDocid
(
p
, 
­Segm’t
[0], &
pLi¡
, &
nLi¡
);

142436 
	gj
 = 1;

142437  
	gj
<
	gnM”ge


142438 && 
	g­Segm’t
[
j
]->
	gpOff£tLi¡


142439 && 
	g­Segm’t
[
j
]->
	giDocid
==
iDocid


142441 
ás3SegR—d”NextDocid
(
p
, 
­Segm’t
[
j
], 0, 0);

142442 
	gj
++;

142445 ifÐ
	gisCÞFž‹r
 ){

142446 
ás3CÞumnFž‹r
(
pFž‹r
->
iCÞ
, 0, &
pLi¡
, &
nLi¡
);

142449 ifÐ!
	gisIgnÜeEm±y
 || 
	gnLi¡
>0 ){

142453 
sql™e3_št64
 
	giD–
;

142454 ifÐ
	gp
->
	gbDescIdx
 && 
	gnDoþi¡
>0 ){

142455 
	giD–
 = 
iP»v
 - 
iDocid
;

142457 
	giD–
 = 
iDocid
 - 
iP»v
;

142459 
as£¹
Ð
iD–
>0 || (
nDoþi¡
==0 && iD–==
iDocid
) );

142460 
as£¹
Ð
nDoþi¡
>0 || 
iD–
==
iDocid
 );

142462 
	gnBy‹
 = 
sql™e3Fts3V¬štL’
(
iD–
è+ (
isRequœePos
?
nLi¡
+1:0);

142463 ifÐ
	gnDoþi¡
+
	gnBy‹
>
	gpC¤
->
	gnBufãr
 ){

142464 *
	gaNew
;

142465 
	gpC¤
->
	gnBufãr
 = (
nDoþi¡
+
nBy‹
)*2;

142466 
	gaNew
 = 
sql™e3_»®loc
(
pC¤
->
aBufãr
,…C¤->
nBufãr
);

142467 ifÐ!
	gaNew
 ){

142468  
	gSQLITE_NOMEM
;

142470 
	gpC¤
->
	gaBufãr
 = 
aNew
;

142473 ifÐ
	gisFœ¡
 ){

142474 *
	ga
 = &
pC¤
->
aBufãr
[
nDoþi¡
];

142475 
	gnWr™e
;

142477 
	gnWr™e
 = 
sql™e3Fts3Fœ¡Fž‹r
(
iD–
, 
pLi¡
, 
nLi¡
, 
a
);

142478 ifÐ
	gnWr™e
 ){

142479 
	giP»v
 = 
iDocid
;

142480 
	gnDoþi¡
 +ð
nWr™e
;

142483 
	gnDoþi¡
 +ð
sql™e3Fts3PutV¬št
(&
pC¤
->
aBufãr
[
nDoþi¡
], 
iD–
);

142484 
	giP»v
 = 
iDocid
;

142485 ifÐ
	gisRequœePos
 ){

142486 
memýy
(&
pC¤
->
aBufãr
[
nDoþi¡
], 
pLi¡
, 
nLi¡
);

142487 
	gnDoþi¡
 +ð
nLi¡
;

142488 
	gpC¤
->
	gaBufãr
[
nDoþi¡
++] = '\0';

142493 
ás3SegR—d”SÜt
(
­Segm’t
, 
nM”ge
, 
j
, 
xCmp
);

142495 ifÐ
	gnDoþi¡
>0 ){

142496 
	gpC¤
->
	gaDoþi¡
 = 
pC¤
->
aBufãr
;

142497 
	gpC¤
->
	gnDoþi¡
 = 
nDoþi¡
;

142498 
	grc
 = 
SQLITE_ROW
;

142501 
	gpC¤
->
	gnAdvªû
 = 
nM”ge
;

142502 } 
	grc
==
SQLITE_OK
 );

142504  
	grc
;

142508 
SQLITE_PRIVATE
 
sql™e3Fts3SegR—d”Fšish
(

142509 
Fts3MuÉiSegR—d”
 *
pC¤


142511 ifÐ
	gpC¤
 ){

142512 
	gi
;

142513 
	gi
=0; i<
	gpC¤
->
	gnSegm’t
; i++){

142514 
sql™e3Fts3SegR—d”F»e
(
pC¤
->
­Segm’t
[
i
]);

142516 
sql™e3_ä“
(
pC¤
->
­Segm’t
);

142517 
sql™e3_ä“
(
pC¤
->
aBufãr
);

142519 
	gpC¤
->
	gnSegm’t
 = 0;

142520 
	gpC¤
->
	g­Segm’t
 = 0;

142521 
	gpC¤
->
	gaBufãr
 = 0;

142535 
ás3R—dEndBlockF›ld
(

142536 
sql™e3_¡mt
 *
pStmt
,

142537 
iCÞ
,

142538 
i64
 *
piEndBlock
,

142539 
i64
 *
²By‹


142541 cÚ¡ *
	gzText
 = 
sql™e3_cÞumn_‹xt
(
pStmt
, 
iCÞ
);

142542 ifÐ
	gzText
 ){

142543 
	gi
;

142544 
	giMul
 = 1;

142545 
i64
 
	giV®
 = 0;

142546 
	gi
=0; 
	gzText
[
i
]>='0' && 
zText
[i]<='9'; i++){

142547 
	giV®
 = 
iV®
*10 + (
zText
[
i
] - '0');

142549 *
	gpiEndBlock
 = 
iV®
;

142550  
	gzText
[
i
]==' ' ) i++;

142551 
	giV®
 = 0;

142552 ifÐ
	gzText
[
i
]=='-' ){

142553 
i
++;

142554 
	giMul
 = -1;

142556  ; 
	gzText
[
i
]>='0' && 
zText
[i]<='9'; 
	gi
++){

142557 
	giV®
 = 
iV®
*10 + (
zText
[
i
] - '0');

142559 *
	g²By‹
 = (
iV®
 * (
i64
)
iMul
);

142568 
ás3PromÙeSegm’ts
(

142569 
Fts3TabË
 *
p
,

142570 
sql™e3_št64
 
iAbsLev–
,

142571 
sql™e3_št64
 
nBy‹


142573 
	grc
 = 
SQLITE_OK
;

142574 
sql™e3_¡mt
 *
	gpRªge
;

142576 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_LEVEL_RANGE2
, &
pRªge
, 0);

142578 ifÐ
	grc
==
SQLITE_OK
 ){

142579 
bOk
 = 0;

142580 
i64
 
	giLa¡
 = (
iAbsLev–
/
FTS3_SEGDIR_MAXLEVEL
 + 1) * FTS3_SEGDIR_MAXLEVEL - 1;

142581 
i64
 
	gnLim™
 = (
nBy‹
*3)/2;

142588 
sql™e3_bšd_št64
(
pRªge
, 1, 
iAbsLev–
+1);

142589 
sql™e3_bšd_št64
(
pRªge
, 2, 
iLa¡
);

142590  
	gSQLITE_ROW
==
sql™e3_¡•
(
pRªge
) ){

142591 
i64
 
nSize
 = 0, 
	gdummy
;

142592 
ás3R—dEndBlockF›ld
(
pRªge
, 2, &
dummy
, &
nSize
);

142593 ifÐ
	gnSize
<=0 || 
nSize
>
nLim™
 ){

142599 
bOk
 = 0;

142602 
	gbOk
 = 1;

142604 
	grc
 = 
sql™e3_»£t
(
pRªge
);

142606 ifÐ
	gbOk
 ){

142607 
	giIdx
 = 0;

142608 
sql™e3_¡mt
 *
	gpUpd©e1
;

142609 
sql™e3_¡mt
 *
	gpUpd©e2
;

142611 ifÐ
	grc
==
SQLITE_OK
 ){

142612 
rc
 = 
ás3SqlStmt
(
p
, 
SQL_UPDATE_LEVEL_IDX
, &
pUpd©e1
, 0);

142614 ifÐ
	grc
==
SQLITE_OK
 ){

142615 
rc
 = 
ás3SqlStmt
(
p
, 
SQL_UPDATE_LEVEL
, &
pUpd©e2
, 0);

142618 ifÐ
	grc
==
SQLITE_OK
 ){

142629 
sql™e3_bšd_št64
(
pRªge
, 1, 
iAbsLev–
);

142630  
	gSQLITE_ROW
==
sql™e3_¡•
(
pRªge
) ){

142631 
sql™e3_bšd_št
(
pUpd©e1
, 1, 
iIdx
++);

142632 
sql™e3_bšd_št
(
pUpd©e1
, 2, 
sql™e3_cÞumn_št
(
pRªge
, 0));

142633 
sql™e3_bšd_št
(
pUpd©e1
, 3, 
sql™e3_cÞumn_št
(
pRªge
, 1));

142634 
sql™e3_¡•
(
pUpd©e1
);

142635 
	grc
 = 
sql™e3_»£t
(
pUpd©e1
);

142636 ifÐ
	grc
!=
SQLITE_OK
 ){

142637 
sql™e3_»£t
(
pRªge
);

142642 ifÐ
	grc
==
SQLITE_OK
 ){

142643 
rc
 = 
sql™e3_»£t
(
pRªge
);

142647 ifÐ
	grc
==
SQLITE_OK
 ){

142648 
sql™e3_bšd_št64
(
pUpd©e2
, 1, 
iAbsLev–
);

142649 
sql™e3_¡•
(
pUpd©e2
);

142650 
	grc
 = 
sql™e3_»£t
(
pUpd©e2
);

142656  
	grc
;

142670 
ás3Segm’tM”ge
(

142671 
Fts3TabË
 *
p
,

142672 
iLªgid
,

142673 
iIndex
,

142674 
iLev–


142676 
	grc
;

142677 
	giIdx
 = 0;

142678 
sql™e3_št64
 
	giNewLev–
 = 0;

142679 
Segm’tWr™”
 *
	gpWr™”
 = 0;

142680 
Fts3SegFž‹r
 
	gfž‹r
;

142681 
Fts3MuÉiSegR—d”
 
	gc¤
;

142682 
	gbIgnÜeEm±y
 = 0;

142683 
i64
 
	giMaxLev–
 = 0;

142685 
as£¹
Ð
iLev–
==
FTS3_SEGCURSOR_ALL


142686 || 
iLev–
==
FTS3_SEGCURSOR_PENDING


142687 || 
iLev–
>=0

142689 
as£¹
Ð
iLev–
<
FTS3_SEGDIR_MAXLEVEL
 );

142690 
as£¹
Ð
iIndex
>=0 && iIndex<
p
->
nIndex
 );

142692 
	grc
 = 
sql™e3Fts3SegR—d”CursÜ
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
, 0, 0, 1, 0, &
c¤
);

142693 ifÐ
	grc
!=
SQLITE_OK
 || 
c¤
.
nSegm’t
==0 ) 
fšished
;

142695 ifÐ
	giLev–
!=
FTS3_SEGCURSOR_PENDING
 ){

142696 
rc
 = 
ás3Segm’tMaxLev–
(
p
, 
iLªgid
, 
iIndex
, &
iMaxLev–
);

142697 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

142700 ifÐ
	giLev–
==
FTS3_SEGCURSOR_ALL
 ){

142705 ifÐ
c¤
.
nSegm’t
==1 ){

142706 
rc
 = 
SQLITE_DONE
;

142707 
	gfšished
;

142709 
	giNewLev–
 = 
iMaxLev–
;

142710 
	gbIgnÜeEm±y
 = 1;

142717 
as£¹
Ð
FTS3_SEGCURSOR_PENDING
==-1 );

142718 
	giNewLev–
 = 
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
+1);

142719 
	grc
 = 
ás3AÎoÿ‹SegdœIdx
(
p
, 
iLªgid
, 
iIndex
, 
iLev–
+1, &
iIdx
);

142720 
	gbIgnÜeEm±y
 = (
iLev–
!=
FTS3_SEGCURSOR_PENDING
è&& (
iNewLev–
>
iMaxLev–
);

142722 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

142724 
as£¹
Ð
c¤
.
nSegm’t
>0 );

142725 
as£¹
Ð
iNewLev–
>=
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
, 0) );

142726 
as£¹
Ð
iNewLev–
<
g‘AbsÞu‹Lev–
(
p
, 
iLªgid
, 
iIndex
,
FTS3_SEGDIR_MAXLEVEL
) );

142728 
mem£t
(&
fž‹r
, 0, (
Fts3SegFž‹r
));

142729 
	gfž‹r
.
	gæags
 = 
FTS3_SEGMENT_REQUIRE_POS
;

142730 
	gfž‹r
.
	gæags
 |ð(
bIgnÜeEm±y
 ? 
FTS3_SEGMENT_IGNORE_EMPTY
 : 0);

142732 
	grc
 = 
sql™e3Fts3SegR—d”S¹
(
p
, &
c¤
, &
fž‹r
);

142733  
	gSQLITE_OK
==
rc
 ){

142734 
rc
 = 
sql™e3Fts3SegR—d”S‹p
(
p
, &
c¤
);

142735 ifÐ
	grc
!=
SQLITE_ROW
 ) ;

142736 
	grc
 = 
ás3SegWr™”Add
(
p
, &
pWr™”
, 1,

142737 
c¤
.
zT”m
, c¤.
nT”m
, c¤.
aDoþi¡
, c¤.
nDoþi¡
);

142739 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

142740 
as£¹
Ð
pWr™”
 || 
bIgnÜeEm±y
 );

142742 ifÐ
	giLev–
!=
FTS3_SEGCURSOR_PENDING
 ){

142743 
rc
 = 
ás3D–‘eSegdœ
(

142744 
p
, 
iLªgid
, 
iIndex
, 
iLev–
, 
c¤
.
­Segm’t
, c¤.
nSegm’t


142746 ifÐ
	grc
!=
SQLITE_OK
 ) 
fšished
;

142748 ifÐ
	gpWr™”
 ){

142749 
	grc
 = 
ás3SegWr™”Flush
(
p
, 
pWr™”
, 
iNewLev–
, 
iIdx
);

142750 ifÐ
	grc
==
SQLITE_OK
 ){

142751 ifÐ
iLev–
==
FTS3_SEGCURSOR_PENDING
 || 
iNewLev–
<
iMaxLev–
 ){

142752 
rc
 = 
ás3PromÙeSegm’ts
(
p
, 
iNewLev–
, 
pWr™”
->
nL—fD©a
);

142757 
	gfšished
:

142758 
ás3SegWr™”F»e
(
pWr™”
);

142759 
sql™e3Fts3SegR—d”Fšish
(&
c¤
);

142760  
	grc
;

142767 
SQLITE_PRIVATE
 
sql™e3Fts3P’dšgT”msFlush
(
Fts3TabË
 *
p
){

142768 
	grc
 = 
SQLITE_OK
;

142769 
	gi
;

142771 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nIndex
; i++){

142772 
	grc
 = 
ás3Segm’tM”ge
(
p
,…->
iP»vLªgid
, 
i
, 
FTS3_SEGCURSOR_PENDING
);

142773 ifÐ
	grc
==
SQLITE_DONE
 ) 
rc
 = 
SQLITE_OK
;

142775 
sql™e3Fts3P’dšgT”msCË¬
(
p
);

142780 ifÐ
	grc
==
SQLITE_OK
 && 
p
->
bHasSt


142781 && 
p
->
nAutošüm”ge
==0xfà&&…->
nL—fAdd
>0

142783 
sql™e3_¡mt
 *
pStmt
 = 0;

142784 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_STAT
, &
pStmt
, 0);

142785 ifÐ
	grc
==
SQLITE_OK
 ){

142786 
sql™e3_bšd_št
(
pStmt
, 1, 
FTS_STAT_AUTOINCRMERGE
);

142787 
	grc
 = 
sql™e3_¡•
(
pStmt
);

142788 ifÐ
	grc
==
SQLITE_ROW
 ){

142789 
p
->
nAutošüm”ge
 = 
sql™e3_cÞumn_št
(
pStmt
, 0);

142790 ifÐ
	gp
->
	gnAutošüm”ge
==1 ) 
p
->
nAutošüm”ge
 = 8;

142791 }ifÐ
	grc
==
SQLITE_DONE
 ){

142792 
p
->
nAutošüm”ge
 = 0;

142794 
	grc
 = 
sql™e3_»£t
(
pStmt
);

142797  
	grc
;

142803 
ás3EncodeIÁA¼ay
(

142804 
N
,

142805 
u32
 *
a
,

142806 *
zBuf
,

142807 *
pNBuf


142809 
	gi
, 
	gj
;

142810 
	gi
=
j
=0; i<
	gN
; i++){

142811 
	gj
 +ð
sql™e3Fts3PutV¬št
(&
zBuf
[
j
], (
sql™e3_št64
)
a
[
i
]);

142813 *
	gpNBuf
 = 
j
;

142819 
ás3DecodeIÁA¼ay
(

142820 
N
,

142821 
u32
 *
a
,

142822 cÚ¡ *
zBuf
,

142823 
nBuf


142825 
	gi
, 
	gj
;

142826 
UNUSED_PARAMETER
(
nBuf
);

142827 
	gi
=
j
=0; i<
	gN
; i++){

142828 
sql™e3_št64
 
	gx
;

142829 
	gj
 +ð
sql™e3Fts3G‘V¬št
(&
zBuf
[
j
], &
x
);

142830 
as£¹
(
j
<=
nBuf
);

142831 
	ga
[
i
] = (
u32
)(
x
 & 0xffffffff);

142840 
ás3In£¹Docsize
(

142841 *
pRC
,

142842 
Fts3TabË
 *
p
,

142843 
u32
 *
aSz


142845 *
	gpBlob
;

142846 
	gnBlob
;

142847 
sql™e3_¡mt
 *
	gpStmt
;

142848 
	grc
;

142850 ifÐ*
	gpRC
 ) ;

142851 
	gpBlob
 = 
sql™e3_m®loc
Ð10*
p
->
nCÞumn
 );

142852 ifÐ
	gpBlob
==0 ){

142853 *
pRC
 = 
SQLITE_NOMEM
;

142856 
ás3EncodeIÁA¼ay
(
p
->
nCÞumn
, 
aSz
, 
pBlob
, &
nBlob
);

142857 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_REPLACE_DOCSIZE
, &
pStmt
, 0);

142858 ifÐ
	grc
 ){

142859 
sql™e3_ä“
(
pBlob
);

142860 *
	gpRC
 = 
rc
;

142863 
sql™e3_bšd_št64
(
pStmt
, 1, 
p
->
iP»vDocid
);

142864 
sql™e3_bšd_blob
(
pStmt
, 2, 
pBlob
, 
nBlob
, 
sql™e3_ä“
);

142865 
sql™e3_¡•
(
pStmt
);

142866 *
	gpRC
 = 
sql™e3_»£t
(
pStmt
);

142884 
ás3Upd©eDocTÙ®s
(

142885 *
pRC
,

142886 
Fts3TabË
 *
p
,

142887 
u32
 *
aSzIns
,

142888 
u32
 *
aSzD–
,

142889 
nChng


142891 *
	gpBlob
;

142892 
	gnBlob
;

142893 
u32
 *
	ga
;

142894 
sql™e3_¡mt
 *
	gpStmt
;

142895 
	gi
;

142896 
	grc
;

142898 cÚ¡ 
	gnSt
 = 
p
->
nCÞumn
+2;

142900 ifÐ*
	gpRC
 ) ;

142901 
	ga
 = 
sql™e3_m®loc
Ð((
u32
)+10)*
nSt
 );

142902 ifÐ
	ga
==0 ){

142903 *
pRC
 = 
SQLITE_NOMEM
;

142906 
	gpBlob
 = (*)&
a
[
nSt
];

142907 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_STAT
, &
pStmt
, 0);

142908 ifÐ
	grc
 ){

142909 
sql™e3_ä“
(
a
);

142910 *
	gpRC
 = 
rc
;

142913 
sql™e3_bšd_št
(
pStmt
, 1, 
FTS_STAT_DOCTOTAL
);

142914 ifÐ
sql™e3_¡•
(
pStmt
)==
SQLITE_ROW
 ){

142915 
ás3DecodeIÁA¼ay
(
nSt
, 
a
,

142916 
sql™e3_cÞumn_blob
(
pStmt
, 0),

142917 
sql™e3_cÞumn_by‹s
(
pStmt
, 0));

142919 
mem£t
(
a
, 0, (
u32
)*(
nSt
) );

142921 
	grc
 = 
sql™e3_»£t
(
pStmt
);

142922 ifÐ
	grc
!=
SQLITE_OK
 ){

142923 
sql™e3_ä“
(
a
);

142924 *
	gpRC
 = 
rc
;

142927 ifÐ
	gnChng
<0 && 
	ga
[0]<(
	gu32
)(-nChng) ){

142928 
	ga
[0] = 0;

142930 
	ga
[0] +ð
nChng
;

142932 
	gi
=0; i<
	gp
->
	gnCÞumn
+1; i++){

142933 
u32
 
	gx
 = 
a
[
i
+1];

142934 ifÐ
	gx
+
	gaSzIns
[
i
] < 
	gaSzD–
[i] ){

142935 
	gx
 = 0;

142937 
	gx
 = 
x
 + 
aSzIns
[
i
] - 
aSzD–
[i];

142939 
	ga
[
i
+1] = 
x
;

142941 
ás3EncodeIÁA¼ay
(
nSt
, 
a
, 
pBlob
, &
nBlob
);

142942 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_REPLACE_STAT
, &
pStmt
, 0);

142943 ifÐ
	grc
 ){

142944 
sql™e3_ä“
(
a
);

142945 *
	gpRC
 = 
rc
;

142948 
sql™e3_bšd_št
(
pStmt
, 1, 
FTS_STAT_DOCTOTAL
);

142949 
sql™e3_bšd_blob
(
pStmt
, 2, 
pBlob
, 
nBlob
, 
SQLITE_STATIC
);

142950 
sql™e3_¡•
(
pStmt
);

142951 *
	gpRC
 = 
sql™e3_»£t
(
pStmt
);

142952 
sql™e3_ä“
(
a
);

142959 
ás3DoO±imize
(
Fts3TabË
 *
p
, 
bR‘uºDÚe
){

142960 
	gbS“nDÚe
 = 0;

142961 
	grc
;

142962 
sql™e3_¡mt
 *
	gpAÎLªgid
 = 0;

142964 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_ALL_LANGID
, &
pAÎLªgid
, 0);

142965 ifÐ
	grc
==
SQLITE_OK
 ){

142966 
rc2
;

142967 
sql™e3_bšd_št
(
pAÎLªgid
, 1, 
p
->
nIndex
);

142968  
sql™e3_¡•
(
pAÎLªgid
)==
SQLITE_ROW
 ){

142969 
i
;

142970 
	giLªgid
 = 
sql™e3_cÞumn_št
(
pAÎLªgid
, 0);

142971 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
p
->
nIndex
; i++){

142972 
	grc
 = 
ás3Segm’tM”ge
(
p
, 
iLªgid
, 
i
, 
FTS3_SEGCURSOR_ALL
);

142973 ifÐ
	grc
==
SQLITE_DONE
 ){

142974 
bS“nDÚe
 = 1;

142975 
	grc
 = 
SQLITE_OK
;

142979 
	grc2
 = 
sql™e3_»£t
(
pAÎLªgid
);

142980 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

142983 
sql™e3Fts3Segm’tsClo£
(
p
);

142984 
sql™e3Fts3P’dšgT”msCË¬
(
p
);

142986  (
	grc
==
SQLITE_OK
 && 
bR‘uºDÚe
 && 
bS“nDÚe
è? 
SQLITE_DONE
 : 
rc
;

142999 
ás3DoRebužd
(
Fts3TabË
 *
p
){

143000 
	grc
;

143002 
	grc
 = 
ás3D–‘eAÎ
(
p
, 0);

143003 ifÐ
	grc
==
SQLITE_OK
 ){

143004 
u32
 *
aSz
 = 0;

143005 
u32
 *
	gaSzIns
 = 0;

143006 
u32
 *
	gaSzD–
 = 0;

143007 
sql™e3_¡mt
 *
	gpStmt
 = 0;

143008 
	gnEÁry
 = 0;

143011 *
	gzSql
 = 
sql™e3_m´štf
("SELECT %s" , 
p
->
zR—dEx´li¡
);

143012 ifÐ!
	gzSql
 ){

143013 
	grc
 = 
SQLITE_NOMEM
;

143015 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pStmt
, 0);

143016 
sql™e3_ä“
(
zSql
);

143019 ifÐ
	grc
==
SQLITE_OK
 ){

143020 
nBy‹
 = (
u32
è* (
p
->
nCÞumn
+1)*3;

143021 
	gaSz
 = (
u32
 *)
sql™e3_m®loc
(
nBy‹
);

143022 ifÐ
	gaSz
==0 ){

143023 
rc
 = 
SQLITE_NOMEM
;

143025 
mem£t
(
aSz
, 0, 
nBy‹
);

143026 
	gaSzIns
 = &
aSz
[
p
->
nCÞumn
+1];

143027 
	gaSzD–
 = &
aSzIns
[
p
->
nCÞumn
+1];

143031  
	grc
==
SQLITE_OK
 && 
SQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

143032 
iCÞ
;

143033 
	giLªgid
 = 
ÏngidFromS–eù
(
p
, 
pStmt
);

143034 
	grc
 = 
ás3P’dšgT”msDocid
(
p
, 
iLªgid
, 
sql™e3_cÞumn_št64
(
pStmt
, 0));

143035 
mem£t
(
aSz
, 0, ×Sz[0]è* (
p
->
nCÞumn
+1));

143036 
	giCÞ
=0; 
	grc
==
SQLITE_OK
 && 
iCÞ
<
p
->
nCÞumn
; iCol++){

143037 ifÐ
	gp
->
	gabNÙšdexed
[
iCÞ
]==0 ){

143038 cÚ¡ *
z
 = (cÚ¡ *è
sql™e3_cÞumn_‹xt
(
pStmt
, 
iCÞ
+1);

143039 
	grc
 = 
ás3P’dšgT”msAdd
(
p
, 
iLªgid
, 
z
, 
iCÞ
, &
aSz
[iCol]);

143040 
	gaSz
[
p
->
nCÞumn
] +ð
sql™e3_cÞumn_by‹s
(
pStmt
, 
iCÞ
+1);

143043 ifÐ
	gp
->
	gbHasDocsize
 ){

143044 
ás3In£¹Docsize
(&
rc
, 
p
, 
aSz
);

143046 ifÐ
	grc
!=
SQLITE_OK
 ){

143047 
sql™e3_fš®ize
(
pStmt
);

143048 
	gpStmt
 = 0;

143050 
	gnEÁry
++;

143051 
	giCÞ
=0; iCÞ<=
p
->
nCÞumn
; iCol++){

143052 
	gaSzIns
[
iCÞ
] +ð
aSz
[iCol];

143056 ifÐ
	gp
->
	gbFts4
 ){

143057 
ás3Upd©eDocTÙ®s
(&
rc
, 
p
, 
aSzIns
, 
aSzD–
, 
nEÁry
);

143059 
sql™e3_ä“
(
aSz
);

143061 ifÐ
	gpStmt
 ){

143062 
	grc2
 = 
sql™e3_fš®ize
(
pStmt
);

143063 ifÐ
	grc
==
SQLITE_OK
 ){

143064 
rc
 = 
rc2
;

143069  
	grc
;

143079 
ás3Inüm”geC¤
(

143080 
Fts3TabË
 *
p
,

143081 
sql™e3_št64
 
iAbsLev–
,

143082 
nSeg
,

143083 
Fts3MuÉiSegR—d”
 *
pC¤


143085 
	grc
;

143086 
sql™e3_¡mt
 *
	gpStmt
 = 0;

143087 
	gnBy‹
;

143090 
mem£t
(
pC¤
, 0, (*pCsr));

143091 
	gnBy‹
 = (
Fts3SegR—d”
 *è* 
nSeg
;

143092 
	gpC¤
->
	g­Segm’t
 = (
Fts3SegR—d”
 **)
sql™e3_m®loc
(
nBy‹
);

143094 ifÐ
	gpC¤
->
	g­Segm’t
==0 ){

143095 
rc
 = 
SQLITE_NOMEM
;

143097 
mem£t
(
pC¤
->
­Segm’t
, 0, 
nBy‹
);

143098 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_LEVEL
, &
pStmt
, 0);

143100 ifÐ
	grc
==
SQLITE_OK
 ){

143101 
i
;

143102 
	grc2
;

143103 
sql™e3_bšd_št64
(
pStmt
, 1, 
iAbsLev–
);

143104 
as£¹
Ð
pC¤
->
nSegm’t
==0 );

143105 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
sql™e3_¡•
(
pStmt
)==
SQLITE_ROW
 && 
i
<
nSeg
; i++){

143106 
	grc
 = 
sql™e3Fts3SegR—d”New
(
i
, 0,

143107 
sql™e3_cÞumn_št64
(
pStmt
, 1),

143108 
sql™e3_cÞumn_št64
(
pStmt
, 2),

143109 
sql™e3_cÞumn_št64
(
pStmt
, 3),

143110 
sql™e3_cÞumn_blob
(
pStmt
, 4),

143111 
sql™e3_cÞumn_by‹s
(
pStmt
, 4),

143112 &
pC¤
->
­Segm’t
[
i
]

143114 
	gpC¤
->
	gnSegm’t
++;

143116 
	grc2
 = 
sql™e3_»£t
(
pStmt
);

143117 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

143120  
	grc
;

143123 
Inüm”geWr™”
 
	tInüm”geWr™”
;

143124 
NodeWr™”
 
	tNodeWr™”
;

143125 
Blob
 
	tBlob
;

143126 
NodeR—d”
 
	tNodeR—d”
;

143134 
	sBlob
 {

143135 *
	ga
;

143136 
	gn
;

143137 
	gnAÎoc
;

143144 
	sNodeWr™”
 {

143145 
sql™e3_št64
 
	giBlock
;

143146 
Blob
 
	gkey
;

143147 
Blob
 
	gblock
;

143154 
	sInüm”geWr™”
 {

143155 
	gnL—fE¡
;

143156 
	gnWÜk
;

143157 
sql™e3_št64
 
	giAbsLev–
;

143158 
	giIdx
;

143159 
sql™e3_št64
 
	giS¹
;

143160 
sql™e3_št64
 
	giEnd
;

143161 
sql™e3_št64
 
	gnL—fD©a
;

143162 
u8
 
	gbNoL—fD©a
;

143163 
NodeWr™”
 
	gaNodeWr™”
[
FTS_MAX_APPENDABLE_HEIGHT
];

143174 
	sNodeR—d”
 {

143175 cÚ¡ *
	gaNode
;

143176 
	gnNode
;

143177 
	giOff
;

143180 
sql™e3_št64
 
	giChžd
;

143181 
Blob
 
	g‹rm
;

143182 cÚ¡ *
	gaDoþi¡
;

143183 
	gnDoþi¡
;

143195 
blobGrowBufãr
(
Blob
 *
pBlob
, 
nMš
, *
pRc
){

143196 ifÐ*
	gpRc
==
SQLITE_OK
 && 
nMš
>
pBlob
->
nAÎoc
 ){

143197 
nAÎoc
 = 
nMš
;

143198 *
	ga
 = (*)
sql™e3_»®loc
(
pBlob
->
a
, 
nAÎoc
);

143199 ifÐ
	ga
 ){

143200 
	gpBlob
->
	gnAÎoc
 = 
nAÎoc
;

143201 
	gpBlob
->
	ga
 = 
a
;

143203 *
	gpRc
 = 
SQLITE_NOMEM
;

143218 
nodeR—d”Next
(
NodeR—d”
 *
p
){

143219 
	gbFœ¡
 = (
p
->
‹rm
.
n
==0);

143220 
	gnP»fix
 = 0;

143221 
	gnSuffix
 = 0;

143222 
	grc
 = 
SQLITE_OK
;

143224 
as£¹
Ð
p
->
aNode
 );

143225 ifÐ
	gp
->
	giChžd
 && 
	gbFœ¡
==0 ) 
p
->
iChžd
++;

143226 ifÐ
	gp
->
	giOff
>=
p
->
nNode
 ){

143228 
p
->
aNode
 = 0;

143230 ifÐ
	gbFœ¡
==0 ){

143231 
p
->
iOff
 +ð
ás3G‘V¬št32
(&p->
aNode
[p->iOff], &
nP»fix
);

143233 
	gp
->
	giOff
 +ð
ás3G‘V¬št32
(&
p
->
aNode
[p->
iOff
], &
nSuffix
);

143235 
blobGrowBufãr
(&
p
->
‹rm
, 
nP»fix
+
nSuffix
, &
rc
);

143236 ifÐ
	grc
==
SQLITE_OK
 ){

143237 
memýy
(&
p
->
‹rm
.
a
[
nP»fix
], &p->
aNode
[p->
iOff
], 
nSuffix
);

143238 
	gp
->
	g‹rm
.
	gn
 = 
nP»fix
+
nSuffix
;

143239 
	gp
->
	giOff
 +ð
nSuffix
;

143240 ifÐ
	gp
->
	giChžd
==0 ){

143241 
p
->
iOff
 +ð
ás3G‘V¬št32
(&p->
aNode
[p->iOff], &p->
nDoþi¡
);

143242 
	gp
->
	gaDoþi¡
 = &
p
->
aNode
[p->
iOff
];

143243 
	gp
->
	giOff
 +ð
p
->
nDoþi¡
;

143248 
as£¹
Ð
p
->
iOff
<õ->
nNode
 );

143250  
	grc
;

143256 
nodeR—d”R–—£
(
NodeR—d”
 *
p
){

143257 
sql™e3_ä“
(
p
->
‹rm
.
a
);

143267 
nodeR—d”In™
(
NodeR—d”
 *
p
, cÚ¡ *
aNode
, 
nNode
){

143268 
mem£t
(
p
, 0, (
NodeR—d”
));

143269 
	gp
->
	gaNode
 = 
aNode
;

143270 
	gp
->
	gnNode
 = 
nNode
;

143273 ifÐ
	gp
->
	gaNode
[0] ){

143275 
	gp
->
	giOff
 = 1 + 
sql™e3Fts3G‘V¬št
(&
p
->
aNode
[1], &p->
iChžd
);

143277 
	gp
->
	giOff
 = 1;

143280  
nodeR—d”Next
(
p
);

143293 
ás3Inüm”gePush
(

143294 
Fts3TabË
 *
p
,

143295 
Inüm”geWr™”
 *
pWr™”
,

143296 cÚ¡ *
zT”m
,

143297 
nT”m


143299 
sql™e3_št64
 
	giPŒ
 = 
pWr™”
->
aNodeWr™”
[0].
iBlock
;

143300 
	giLay”
;

143302 
as£¹
Ð
nT”m
>0 );

143303 
	giLay”
=1; 
ALWAYS
(
iLay”
<
FTS_MAX_APPENDABLE_HEIGHT
); iLayer++){

143304 
sql™e3_št64
 
	giNextPŒ
 = 0;

143305 
NodeWr™”
 *
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
iLay”
];

143306 
	grc
 = 
SQLITE_OK
;

143307 
	gnP»fix
;

143308 
	gnSuffix
;

143309 
	gnS·û
;

143315 
	gnP»fix
 = 
ás3P»fixCom´ess
(
pNode
->
key
.
a
,…Node->key.
n
, 
zT”m
, 
nT”m
);

143316 
	gnSuffix
 = 
nT”m
 - 
nP»fix
;

143317 
	gnS·û
 = 
sql™e3Fts3V¬štL’
(
nP»fix
);

143318 
	gnS·û
 +ð
sql™e3Fts3V¬štL’
(
nSuffix
) +‚Suffix;

143320 ifÐ
	gpNode
->
	gkey
.
	gn
==0 || (
pNode
->
block
.
n
 + 
nS·û
)<=
p
->
nNodeSize
 ){

143325 
Blob
 *
pBlk
 = &
pNode
->
block
;

143326 ifÐ
	gpBlk
->
	gn
==0 ){

143327 
blobGrowBufãr
(
pBlk
, 
p
->
nNodeSize
, &
rc
);

143328 ifÐ
	grc
==
SQLITE_OK
 ){

143329 
pBlk
->
a
[0] = ()
iLay”
;

143330 
	gpBlk
->
	gn
 = 1 + 
sql™e3Fts3PutV¬št
(&
pBlk
->
a
[1], 
iPŒ
);

143333 
blobGrowBufãr
(
pBlk
,…Blk->
n
 + 
nS·û
, &
rc
);

143334 
blobGrowBufãr
(&
pNode
->
key
, 
nT”m
, &
rc
);

143336 ifÐ
	grc
==
SQLITE_OK
 ){

143337 ifÐ
pNode
->
key
.
n
 ){

143338 
pBlk
->
n
 +ð
sql™e3Fts3PutV¬št
(&pBlk->
a
[pBlk->n], 
nP»fix
);

143340 
	gpBlk
->
	gn
 +ð
sql™e3Fts3PutV¬št
(&
pBlk
->
a
[pBlk->
n
], 
nSuffix
);

143341 
memýy
(&
pBlk
->
a
[pBlk->
n
], &
zT”m
[
nP»fix
], 
nSuffix
);

143342 
	gpBlk
->
	gn
 +ð
nSuffix
;

143344 
memýy
(
pNode
->
key
.
a
, 
zT”m
, 
nT”m
);

143345 
	gpNode
->
	gkey
.
	gn
 = 
nT”m
;

143351 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
pNode
->
iBlock
,…Node->
block
.
a
,…Node->block.
n
);

143353 
as£¹
Ð
pNode
->
block
.
nAÎoc
>=
p
->
nNodeSize
 );

143354 
	gpNode
->
	gblock
.
	ga
[0] = ()
iLay”
;

143355 
	gpNode
->
	gblock
.
	gn
 = 1 + 
sql™e3Fts3PutV¬št
(&
pNode
->
block
.
a
[1], 
iPŒ
+1);

143357 
	giNextPŒ
 = 
pNode
->
iBlock
;

143358 
	gpNode
->
	giBlock
++;

143359 
	gpNode
->
	gkey
.
	gn
 = 0;

143362 ifÐ
	grc
!=
SQLITE_OK
 || 
iNextPŒ
==0 )  
rc
;

143363 
	giPŒ
 = 
iNextPŒ
;

143366 
as£¹
( 0 );

143394 
ás3Aµ’dToNode
(

143395 
Blob
 *
pNode
,

143396 
Blob
 *
pP»v
,

143397 cÚ¡ *
zT”m
,

143398 
nT”m
,

143399 cÚ¡ *
aDoþi¡
,

143400 
nDoþi¡


143402 
	grc
 = 
SQLITE_OK
;

143403 
	gbFœ¡
 = (
pP»v
->
n
==0);

143404 
	gnP»fix
;

143405 
	gnSuffix
;

143409 
as£¹
Ð
pNode
->
n
>0 );

143410 
as£¹
Ð(
pNode
->
a
[0]=='\0')==(
aDoþi¡
!=0) );

143412 
blobGrowBufãr
(
pP»v
, 
nT”m
, &
rc
);

143413 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

143415 
	gnP»fix
 = 
ás3P»fixCom´ess
(
pP»v
->
a
,…P»v->
n
, 
zT”m
, 
nT”m
);

143416 
	gnSuffix
 = 
nT”m
 - 
nP»fix
;

143417 
memýy
(
pP»v
->
a
, 
zT”m
, 
nT”m
);

143418 
	gpP»v
->
	gn
 = 
nT”m
;

143420 ifÐ
	gbFœ¡
==0 ){

143421 
pNode
->
n
 +ð
sql™e3Fts3PutV¬št
(&pNode->
a
[pNode->n], 
nP»fix
);

143423 
	gpNode
->
	gn
 +ð
sql™e3Fts3PutV¬št
(&
pNode
->
a
[pNode->
n
], 
nSuffix
);

143424 
memýy
(&
pNode
->
a
[pNode->
n
], &
zT”m
[
nP»fix
], 
nSuffix
);

143425 
	gpNode
->
	gn
 +ð
nSuffix
;

143427 ifÐ
	gaDoþi¡
 ){

143428 
	gpNode
->
	gn
 +ð
sql™e3Fts3PutV¬št
(&
pNode
->
a
[pNode->
n
], 
nDoþi¡
);

143429 
memýy
(&
pNode
->
a
[pNode->
n
], 
aDoþi¡
, 
nDoþi¡
);

143430 
	gpNode
->
	gn
 +ð
nDoþi¡
;

143433 
as£¹
Ð
pNode
->
n
<õNode->
nAÎoc
 );

143435  
	gSQLITE_OK
;

143444 
ás3Inüm”geAµ’d
(

143445 
Fts3TabË
 *
p
,

143446 
Inüm”geWr™”
 *
pWr™”
,

143447 
Fts3MuÉiSegR—d”
 *
pC¤


143449 cÚ¡ *
	gzT”m
 = 
pC¤
->
zT”m
;

143450 
	gnT”m
 = 
pC¤
->
nT”m
;

143451 cÚ¡ *
	gaDoþi¡
 = 
pC¤
->
aDoþi¡
;

143452 
	gnDoþi¡
 = 
pC¤
->
nDoþi¡
;

143453 
	grc
 = 
SQLITE_OK
;

143454 
	gnS·û
;

143455 
	gnP»fix
;

143456 
	gnSuffix
;

143457 
NodeWr™”
 *
	gpL—f
;

143459 
	gpL—f
 = &
pWr™”
->
aNodeWr™”
[0];

143460 
	gnP»fix
 = 
ás3P»fixCom´ess
(
pL—f
->
key
.
a
,…L—f->key.
n
, 
zT”m
, 
nT”m
);

143461 
	gnSuffix
 = 
nT”m
 - 
nP»fix
;

143463 
	gnS·û
 = 
sql™e3Fts3V¬štL’
(
nP»fix
);

143464 
	gnS·û
 +ð
sql™e3Fts3V¬štL’
(
nSuffix
) +‚Suffix;

143465 
	gnS·û
 +ð
sql™e3Fts3V¬štL’
(
nDoþi¡
) +‚Doclist;

143470 ifÐ
	gpL—f
->
	gblock
.
	gn
>0 && (pL—f->block.À+ 
	gnS·û
)>
	gp
->
	gnNodeSize
 ){

143471 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
pL—f
->
iBlock
,…L—f->
block
.
a
,…L—f->block.
n
);

143472 
	gpWr™”
->
	gnWÜk
++;

143486 ifÐ
	grc
==
SQLITE_OK
 ){

143487 
rc
 = 
ás3Inüm”gePush
(
p
, 
pWr™”
, 
zT”m
, 
nP»fix
+1);

143491 
	gpL—f
->
	giBlock
++;

143492 
	gpL—f
->
	gkey
.
	gn
 = 0;

143493 
	gpL—f
->
	gblock
.
	gn
 = 0;

143495 
	gnSuffix
 = 
nT”m
;

143496 
	gnS·û
 = 1;

143497 
	gnS·û
 +ð
sql™e3Fts3V¬štL’
(
nSuffix
) +‚Suffix;

143498 
	gnS·û
 +ð
sql™e3Fts3V¬štL’
(
nDoþi¡
) +‚Doclist;

143501 
	gpWr™”
->
	gnL—fD©a
 +ð
nS·û
;

143502 
blobGrowBufãr
(&
pL—f
->
block
,…L—f->block.
n
 + 
nS·û
, &
rc
);

143503 ifÐ
	grc
==
SQLITE_OK
 ){

143504 ifÐ
pL—f
->
block
.
n
==0 ){

143505 
pL—f
->
block
.
n
 = 1;

143506 
	gpL—f
->
	gblock
.
	ga
[0] = '\0';

143508 
	grc
 = 
ás3Aµ’dToNode
(

143509 &
pL—f
->
block
, &pL—f->
key
, 
zT”m
, 
nT”m
, 
aDoþi¡
, 
nDoþi¡


143513  
	grc
;

143529 
ás3Inüm”geR–—£
(

143530 
Fts3TabË
 *
p
,

143531 
Inüm”geWr™”
 *
pWr™”
,

143532 *
pRc


143534 
	gi
;

143535 
	giRoÙ
;

143536 
NodeWr™”
 *
	gpRoÙ
;

143537 
	grc
 = *
pRc
;

143543 
	giRoÙ
=
FTS_MAX_APPENDABLE_HEIGHT
-1; iRoot>=0; iRoot--){

143544 
NodeWr™”
 *
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
iRoÙ
];

143545 ifÐ
	gpNode
->
	gblock
.
	gn
>0 ) ;

143546 
as£¹
Ð*
pRc
 || 
pNode
->
block
.
nAÎoc
==0 );

143547 
as£¹
Ð*
pRc
 || 
pNode
->
key
.
nAÎoc
==0 );

143548 
sql™e3_ä“
(
pNode
->
block
.
a
);

143549 
sql™e3_ä“
(
pNode
->
key
.
a
);

143553 ifÐ
	giRoÙ
<0 ) ;

143570 ifÐ
	giRoÙ
==0 ){

143571 
Blob
 *
pBlock
 = &
pWr™”
->
aNodeWr™”
[1].
block
;

143572 
blobGrowBufãr
(
pBlock
, 1 + 
FTS3_VARINT_MAX
, &
rc
);

143573 ifÐ
	grc
==
SQLITE_OK
 ){

143574 
pBlock
->
a
[0] = 0x01;

143575 
	gpBlock
->
	gn
 = 1 + 
sql™e3Fts3PutV¬št
(

143576 &
pBlock
->
a
[1], 
pWr™”
->
aNodeWr™”
[0].
iBlock


143579 
	giRoÙ
 = 1;

143581 
	gpRoÙ
 = &
pWr™”
->
aNodeWr™”
[
iRoÙ
];

143584 
	gi
=0; i<
	giRoÙ
; i++){

143585 
NodeWr™”
 *
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
i
];

143586 ifÐ
	gpNode
->
	gblock
.
	gn
>0 && 
	grc
==
SQLITE_OK
 ){

143587 
rc
 = 
ás3Wr™eSegm’t
(
p
, 
pNode
->
iBlock
,…Node->
block
.
a
,…Node->block.
n
);

143589 
sql™e3_ä“
(
pNode
->
block
.
a
);

143590 
sql™e3_ä“
(
pNode
->
key
.
a
);

143594 ifÐ
	grc
==
SQLITE_OK
 ){

143595 
rc
 = 
ás3Wr™eSegdœ
(
p
,

143596 
pWr™”
->
iAbsLev–
+1,

143597 
pWr™”
->
iIdx
,

143598 
pWr™”
->
iS¹
,

143599 
pWr™”
->
aNodeWr™”
[0].
iBlock
,

143600 
pWr™”
->
iEnd
,

143601 (
pWr™”
->
bNoL—fD©a
==0 ?…Wr™”->
nL—fD©a
 : 0),

143602 
pRoÙ
->
block
.
a
,…RoÙ->block.
n


143605 
sql™e3_ä“
(
pRoÙ
->
block
.
a
);

143606 
sql™e3_ä“
(
pRoÙ
->
key
.
a
);

143608 *
	gpRc
 = 
rc
;

143619 
ás3T”mCmp
(

143620 cÚ¡ *
zLhs
, 
nLhs
,

143621 cÚ¡ *
zRhs
, 
nRhs


143623 
	gnCmp
 = 
MIN
(
nLhs
, 
nRhs
);

143624 
	g»s
;

143626 
	g»s
 = 
memcmp
(
zLhs
, 
zRhs
, 
nCmp
);

143627 ifÐ
	g»s
==0 ) 
»s
 = 
nLhs
 - 
nRhs
;

143629  
	g»s
;

143645 
ás3IsAµ’dabË
(
Fts3TabË
 *
p
, 
sql™e3_št64
 
iEnd
, *
pbRes
){

143646 
	gbRes
 = 0;

143647 
sql™e3_¡mt
 *
	gpCheck
 = 0;

143648 
	grc
;

143650 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SEGMENT_IS_APPENDABLE
, &
pCheck
, 0);

143651 ifÐ
	grc
==
SQLITE_OK
 ){

143652 
sql™e3_bšd_št64
(
pCheck
, 1, 
iEnd
);

143653 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pCheck
èè
bRes
 = 1;

143654 
	grc
 = 
sql™e3_»£t
(
pCheck
);

143657 *
	gpbRes
 = 
bRes
;

143658  
	grc
;

143676 
ás3Inüm”geLßd
(

143677 
Fts3TabË
 *
p
,

143678 
sql™e3_št64
 
iAbsLev–
,

143679 
iIdx
,

143680 cÚ¡ *
zKey
,

143681 
nKey
,

143682 
Inüm”geWr™”
 *
pWr™”


143684 
	grc
;

143685 
sql™e3_¡mt
 *
	gpS–eù
 = 0;

143687 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_SEGDIR
, &
pS–eù
, 0);

143688 ifÐ
	grc
==
SQLITE_OK
 ){

143689 
sql™e3_št64
 
iS¹
 = 0;

143690 
sql™e3_št64
 
	giL—fEnd
 = 0;

143691 
sql™e3_št64
 
	giEnd
 = 0;

143692 cÚ¡ *
	gaRoÙ
 = 0;

143693 
	gnRoÙ
 = 0;

143694 
	grc2
;

143695 
	gbAµ’dabË
 = 0;

143698 
sql™e3_bšd_št64
(
pS–eù
, 1, 
iAbsLev–
+1);

143699 
sql™e3_bšd_št
(
pS–eù
, 2, 
iIdx
);

143700 ifÐ
sql™e3_¡•
(
pS–eù
)==
SQLITE_ROW
 ){

143701 
iS¹
 = 
sql™e3_cÞumn_št64
(
pS–eù
, 1);

143702 
	giL—fEnd
 = 
sql™e3_cÞumn_št64
(
pS–eù
, 2);

143703 
ás3R—dEndBlockF›ld
(
pS–eù
, 3, &
iEnd
, &
pWr™”
->
nL—fD©a
);

143704 ifÐ
	gpWr™”
->
	gnL—fD©a
<0 ){

143705 
	gpWr™”
->
	gnL—fD©a
 = 
pWr™”
->
nL—fD©a
 * -1;

143707 
	gpWr™”
->
	gbNoL—fD©a
 = (
pWr™”
->
nL—fD©a
==0);

143708 
	gnRoÙ
 = 
sql™e3_cÞumn_by‹s
(
pS–eù
, 4);

143709 
	gaRoÙ
 = 
sql™e3_cÞumn_blob
(
pS–eù
, 4);

143711  
sql™e3_»£t
(
pS–eù
);

143715 
	grc
 = 
ás3IsAµ’dabË
(
p
, 
iEnd
, &
bAµ’dabË
);

143718 ifÐ
	grc
==
SQLITE_OK
 && 
bAµ’dabË
 ){

143719 *
aL—f
 = 0;

143720 
	gnL—f
 = 0;

143722 
	grc
 = 
sql™e3Fts3R—dBlock
(
p
, 
iL—fEnd
, &
aL—f
, &
nL—f
, 0);

143723 ifÐ
	grc
==
SQLITE_OK
 ){

143724 
NodeR—d”
 
»ad”
;

143725 
	grc
 = 
nodeR—d”In™
(&
»ad”
, 
aL—f
, 
nL—f
);

143726 
	grc
==
SQLITE_OK
 && 
»ad”
.
aNode
;

143727 
	grc
 = 
nodeR—d”Next
(&
»ad”
)

143729 
as£¹
Ð
»ad”
.
aNode
 );

143731 ifÐ
ás3T”mCmp
(
zKey
, 
nKey
, 
»ad”
.
‹rm
.
a
,„—d”.‹rm.
n
)<=0 ){

143732 
bAµ’dabË
 = 0;

143734 
nodeR—d”R–—£
(&
»ad”
);

143736 
sql™e3_ä“
(
aL—f
);

143739 ifÐ
	grc
==
SQLITE_OK
 && 
bAµ’dabË
 ){

143742 
i
;

143743 
	gnHeight
 = ()
aRoÙ
[0];

143744 
NodeWr™”
 *
	gpNode
;

143746 
	gpWr™”
->
	gnL—fE¡
 = ()((
iEnd
 - 
iS¹
è+ 1)/
FTS_MAX_APPENDABLE_HEIGHT
;

143747 
	gpWr™”
->
	giS¹
 = 
iS¹
;

143748 
	gpWr™”
->
	giEnd
 = 
iEnd
;

143749 
	gpWr™”
->
	giAbsLev–
 = 
iAbsLev–
;

143750 
	gpWr™”
->
	giIdx
 = 
iIdx
;

143752 
	gi
=
nHeight
+1; i<
	gFTS_MAX_APPENDABLE_HEIGHT
; i++){

143753 
	gpWr™”
->
	gaNodeWr™”
[
i
].
	giBlock
 = 
pWr™”
->
iS¹
 + i*pWr™”->
nL—fE¡
;

143756 
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
nHeight
];

143757 
	gpNode
->
	giBlock
 = 
pWr™”
->
iS¹
 +…Wr™”->
nL—fE¡
*
nHeight
;

143758 
blobGrowBufãr
(&
pNode
->
block
, 
MAX
(
nRoÙ
, 
p
->
nNodeSize
), &
rc
);

143759 ifÐ
	grc
==
SQLITE_OK
 ){

143760 
memýy
(
pNode
->
block
.
a
, 
aRoÙ
, 
nRoÙ
);

143761 
	gpNode
->
	gblock
.
	gn
 = 
nRoÙ
;

143764 
	gi
=
nHeight
; i>=0 && 
rc
==
SQLITE_OK
; i--){

143765 
NodeR—d”
 
	g»ad”
;

143766 
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
i
];

143768 
	grc
 = 
nodeR—d”In™
(&
»ad”
, 
pNode
->
block
.
a
,…Node->block.
n
);

143769  
	g»ad”
.
	gaNode
 && 
	grc
==
SQLITE_OK
 ) 
rc
 = 
nodeR—d”Next
(&
»ad”
);

143770 
blobGrowBufãr
(&
pNode
->
key
, 
»ad”
.
‹rm
.
n
, &
rc
);

143771 ifÐ
	grc
==
SQLITE_OK
 ){

143772 
memýy
(
pNode
->
key
.
a
, 
»ad”
.
‹rm
.a,„—d”.‹rm.
n
);

143773 
	gpNode
->
	gkey
.
	gn
 = 
»ad”
.
‹rm
.
n
;

143774 ifÐ
	gi
>0 ){

143775 *
	gaBlock
 = 0;

143776 
	gnBlock
 = 0;

143777 
	gpNode
 = &
pWr™”
->
aNodeWr™”
[
i
-1];

143778 
	gpNode
->
	giBlock
 = 
»ad”
.
iChžd
;

143779 
	grc
 = 
sql™e3Fts3R—dBlock
(
p
, 
»ad”
.
iChžd
, &
aBlock
, &
nBlock
, 0);

143780 
blobGrowBufãr
(&
pNode
->
block
, 
MAX
(
nBlock
, 
p
->
nNodeSize
), &
rc
);

143781 ifÐ
	grc
==
SQLITE_OK
 ){

143782 
memýy
(
pNode
->
block
.
a
, 
aBlock
, 
nBlock
);

143783 
	gpNode
->
	gblock
.
	gn
 = 
nBlock
;

143785 
sql™e3_ä“
(
aBlock
);

143788 
nodeR—d”R–—£
(&
»ad”
);

143792 
	grc2
 = 
sql™e3_»£t
(
pS–eù
);

143793 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

143796  
	grc
;

143808 
ás3Inüm”geOuutIdx
(

143809 
Fts3TabË
 *
p
,

143810 
sql™e3_št64
 
iAbsLev–
,

143811 *
piIdx


143813 
	grc
;

143814 
sql™e3_¡mt
 *
	gpOuutIdx
 = 0;

143816 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_NEXT_SEGMENT_INDEX
, &
pOuutIdx
, 0);

143817 ifÐ
	grc
==
SQLITE_OK
 ){

143818 
sql™e3_bšd_št64
(
pOuutIdx
, 1, 
iAbsLev–
+1);

143819 
sql™e3_¡•
(
pOuutIdx
);

143820 *
	gpiIdx
 = 
sql™e3_cÞumn_št
(
pOuutIdx
, 0);

143821 
	grc
 = 
sql™e3_»£t
(
pOuutIdx
);

143824  
	grc
;

143853 
ás3Inüm”geWr™”
(

143854 
Fts3TabË
 *
p
,

143855 
sql™e3_št64
 
iAbsLev–
,

143856 
iIdx
,

143857 
Fts3MuÉiSegR—d”
 *
pC¤
,

143858 
Inüm”geWr™”
 *
pWr™”


143860 
	grc
;

143861 
	gi
;

143862 
	gnL—fE¡
 = 0;

143863 
sql™e3_¡mt
 *
	gpL—fE¡
 = 0;

143864 
sql™e3_¡mt
 *
	gpFœ¡Block
 = 0;

143867 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_MAX_LEAF_NODE_ESTIMATE
, &
pL—fE¡
, 0);

143868 ifÐ
	grc
==
SQLITE_OK
 ){

143869 
sql™e3_bšd_št64
(
pL—fE¡
, 1, 
iAbsLev–
);

143870 
sql™e3_bšd_št64
(
pL—fE¡
, 2, 
pC¤
->
nSegm’t
);

143871 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pL—fE¡
) ){

143872 
nL—fE¡
 = 
sql™e3_cÞumn_št
(
pL—fE¡
, 0);

143874 
	grc
 = 
sql™e3_»£t
(
pL—fE¡
);

143876 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

143879 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_NEXT_SEGMENTS_ID
, &
pFœ¡Block
, 0);

143880 ifÐ
	grc
==
SQLITE_OK
 ){

143881 ifÐ
SQLITE_ROW
==
sql™e3_¡•
(
pFœ¡Block
) ){

143882 
pWr™”
->
iS¹
 = 
sql™e3_cÞumn_št64
(
pFœ¡Block
, 0);

143883 
	gpWr™”
->
	giEnd
 = 
pWr™”
->
iS¹
 - 1;

143884 
	gpWr™”
->
	giEnd
 +ð
nL—fE¡
 * 
FTS_MAX_APPENDABLE_HEIGHT
;

143886 
	grc
 = 
sql™e3_»£t
(
pFœ¡Block
);

143888 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

143893 
	grc
 = 
ás3Wr™eSegm’t
(
p
, 
pWr™”
->
iEnd
, 0, 0);

143894 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

143896 
	gpWr™”
->
	giAbsLev–
 = 
iAbsLev–
;

143897 
	gpWr™”
->
	gnL—fE¡
 = 
nL—fE¡
;

143898 
	gpWr™”
->
	giIdx
 = 
iIdx
;

143901 
	gi
=0; i<
	gFTS_MAX_APPENDABLE_HEIGHT
; i++){

143902 
	gpWr™”
->
	gaNodeWr™”
[
i
].
	giBlock
 = 
pWr™”
->
iS¹
 + i*pWr™”->
nL—fE¡
;

143904  
	gSQLITE_OK
;

143918 
ás3RemoveSegdœEÁry
(

143919 
Fts3TabË
 *
p
,

143920 
sql™e3_št64
 
iAbsLev–
,

143921 
iIdx


143923 
	grc
;

143924 
sql™e3_¡mt
 *
	gpD–‘e
 = 0;

143926 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGDIR_ENTRY
, &
pD–‘e
, 0);

143927 ifÐ
	grc
==
SQLITE_OK
 ){

143928 
sql™e3_bšd_št64
(
pD–‘e
, 1, 
iAbsLev–
);

143929 
sql™e3_bšd_št
(
pD–‘e
, 2, 
iIdx
);

143930 
sql™e3_¡•
(
pD–‘e
);

143931 
	grc
 = 
sql™e3_»£t
(
pD–‘e
);

143934  
	grc
;

143942 
ás3R•ackSegdœLev–
(

143943 
Fts3TabË
 *
p
,

143944 
sql™e3_št64
 
iAbsLev–


143946 
	grc
;

143947 *
	gaIdx
 = 0;

143948 
	gnIdx
 = 0;

143949 
	gnAÎoc
 = 0;

143950 
	gi
;

143951 
sql™e3_¡mt
 *
	gpS–eù
 = 0;

143952 
sql™e3_¡mt
 *
	gpUpd©e
 = 0;

143954 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_INDEXES
, &
pS–eù
, 0);

143955 ifÐ
	grc
==
SQLITE_OK
 ){

143956 
rc2
;

143957 
sql™e3_bšd_št64
(
pS–eù
, 1, 
iAbsLev–
);

143958  
	gSQLITE_ROW
==
sql™e3_¡•
(
pS–eù
) ){

143959 ifÐ
nIdx
>=
nAÎoc
 ){

143960 *
aNew
;

143961 
	gnAÎoc
 += 16;

143962 
	gaNew
 = 
sql™e3_»®loc
(
aIdx
, 
nAÎoc
*());

143963 ifÐ!
	gaNew
 ){

143964 
	grc
 = 
SQLITE_NOMEM
;

143967 
	gaIdx
 = 
aNew
;

143969 
	gaIdx
[
nIdx
++] = 
sql™e3_cÞumn_št
(
pS–eù
, 0);

143971 
	grc2
 = 
sql™e3_»£t
(
pS–eù
);

143972 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

143975 ifÐ
	grc
==
SQLITE_OK
 ){

143976 
rc
 = 
ás3SqlStmt
(
p
, 
SQL_SHIFT_SEGDIR_ENTRY
, &
pUpd©e
, 0);

143978 ifÐ
	grc
==
SQLITE_OK
 ){

143979 
sql™e3_bšd_št64
(
pUpd©e
, 2, 
iAbsLev–
);

143982 
as£¹
Ð
p
->
bIgnÜeSav•ošt
==0 );

143983 
	gp
->
	gbIgnÜeSav•ošt
 = 1;

143984 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
nIdx
; i++){

143985 ifÐ
	gaIdx
[
i
]!=i ){

143986 
sql™e3_bšd_št
(
pUpd©e
, 3, 
aIdx
[
i
]);

143987 
sql™e3_bšd_št
(
pUpd©e
, 1, 
i
);

143988 
sql™e3_¡•
(
pUpd©e
);

143989 
	grc
 = 
sql™e3_»£t
(
pUpd©e
);

143992 
	gp
->
	gbIgnÜeSav•ošt
 = 0;

143994 
sql™e3_ä“
(
aIdx
);

143995  
	grc
;

143998 
ás3S¹Node
(
Blob
 *
pNode
, 
iHeight
, 
sql™e3_št64
 
iChžd
){

143999 
	gpNode
->
	ga
[0] = ()
iHeight
;

144000 ifÐ
	giChžd
 ){

144001 
as£¹
Ð
pNode
->
nAÎoc
>=1+
sql™e3Fts3V¬štL’
(
iChžd
) );

144002 
	gpNode
->
	gn
 = 1 + 
sql™e3Fts3PutV¬št
(&
pNode
->
a
[1], 
iChžd
);

144004 
as£¹
Ð
pNode
->
nAÎoc
>=1 );

144005 
	gpNode
->
	gn
 = 1;

144017 
ás3Trunÿ‹Node
(

144018 cÚ¡ *
aNode
,

144019 
nNode
,

144020 
Blob
 *
pNew
,

144021 cÚ¡ *
zT”m
,

144022 
nT”m
,

144023 
sql™e3_št64
 *
piBlock


144025 
NodeR—d”
 
	g»ad”
;

144026 
Blob
 
	g´ev
 = {0, 0, 0};

144027 
	grc
 = 
SQLITE_OK
;

144028 
	gbL—f
 = 
aNode
[0]=='\0';

144031 
blobGrowBufãr
(
pNew
, 
nNode
, &
rc
);

144032 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

144033 
	gpNew
->
	gn
 = 0;

144036 
	grc
 = 
nodeR—d”In™
(&
»ad”
, 
aNode
, 
nNode
);

144037 
	grc
==
SQLITE_OK
 && 
»ad”
.
aNode
;

144038 
	grc
 = 
nodeR—d”Next
(&
»ad”
)

144040 ifÐ
pNew
->
n
==0 ){

144041 
»s
 = 
ás3T”mCmp
(
»ad”
.
‹rm
.
a
,„—d”.‹rm.
n
, 
zT”m
, 
nT”m
);

144042 ifÐ
	g»s
<0 || (
	gbL—f
==0 && 
»s
==0) ) ;

144043 
ás3S¹Node
(
pNew
, ()
aNode
[0], 
»ad”
.
iChžd
);

144044 *
	gpiBlock
 = 
»ad”
.
iChžd
;

144046 
	grc
 = 
ás3Aµ’dToNode
(

144047 
pNew
, &
´ev
, 
»ad”
.
‹rm
.
a
,„—d”.‹rm.
n
,

144048 
»ad”
.
aDoþi¡
,„—d”.
nDoþi¡


144050 ifÐ
	grc
!=
SQLITE_OK
 ) ;

144052 ifÐ
	gpNew
->
	gn
==0 ){

144053 
ás3S¹Node
(
pNew
, ()
aNode
[0], 
»ad”
.
iChžd
);

144054 *
	gpiBlock
 = 
»ad”
.
iChžd
;

144056 
as£¹
Ð
pNew
->
n
<õNew->
nAÎoc
 );

144058 
nodeR—d”R–—£
(&
»ad”
);

144059 
sql™e3_ä“
(
´ev
.
a
);

144060  
	grc
;

144072 
ás3Trunÿ‹Segm’t
(

144073 
Fts3TabË
 *
p
,

144074 
sql™e3_št64
 
iAbsLev–
,

144075 
iIdx
,

144076 cÚ¡ *
zT”m
,

144077 
nT”m


144079 
	grc
 = 
SQLITE_OK
;

144080 
Blob
 
	groÙ
 = {0,0,0};

144081 
Blob
 
	gblock
 = {0,0,0};

144082 
sql™e3_št64
 
	giBlock
 = 0;

144083 
sql™e3_št64
 
	giNewS¹
 = 0;

144084 
sql™e3_št64
 
	giOldS¹
 = 0;

144085 
sql™e3_¡mt
 *
	gpF‘ch
 = 0;

144087 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_SEGDIR
, &
pF‘ch
, 0);

144088 ifÐ
	grc
==
SQLITE_OK
 ){

144089 
rc2
;

144090 
sql™e3_bšd_št64
(
pF‘ch
, 1, 
iAbsLev–
);

144091 
sql™e3_bšd_št
(
pF‘ch
, 2, 
iIdx
);

144092 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pF‘ch
) ){

144093 cÚ¡ *
aRoÙ
 = 
sql™e3_cÞumn_blob
(
pF‘ch
, 4);

144094 
	gnRoÙ
 = 
sql™e3_cÞumn_by‹s
(
pF‘ch
, 4);

144095 
	giOldS¹
 = 
sql™e3_cÞumn_št64
(
pF‘ch
, 1);

144096 
	grc
 = 
ás3Trunÿ‹Node
(
aRoÙ
, 
nRoÙ
, &
roÙ
, 
zT”m
, 
nT”m
, &
iBlock
);

144098 
	grc2
 = 
sql™e3_»£t
(
pF‘ch
);

144099 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

144102  
	grc
==
SQLITE_OK
 && 
iBlock
 ){

144103 *
aBlock
 = 0;

144104 
	gnBlock
 = 0;

144105 
	giNewS¹
 = 
iBlock
;

144107 
	grc
 = 
sql™e3Fts3R—dBlock
(
p
, 
iBlock
, &
aBlock
, &
nBlock
, 0);

144108 ifÐ
	grc
==
SQLITE_OK
 ){

144109 
rc
 = 
ás3Trunÿ‹Node
(
aBlock
, 
nBlock
, &
block
, 
zT”m
, 
nT”m
, &
iBlock
);

144111 ifÐ
	grc
==
SQLITE_OK
 ){

144112 
rc
 = 
ás3Wr™eSegm’t
(
p
, 
iNewS¹
, 
block
.
a
, block.
n
);

144114 
sql™e3_ä“
(
aBlock
);

144118 ifÐ
	grc
==
SQLITE_OK
 && 
iNewS¹
 ){

144119 
sql™e3_¡mt
 *
pD–
 = 0;

144120 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_DELETE_SEGMENTS_RANGE
, &
pD–
, 0);

144121 ifÐ
	grc
==
SQLITE_OK
 ){

144122 
sql™e3_bšd_št64
(
pD–
, 1, 
iOldS¹
);

144123 
sql™e3_bšd_št64
(
pD–
, 2, 
iNewS¹
-1);

144124 
sql™e3_¡•
(
pD–
);

144125 
	grc
 = 
sql™e3_»£t
(
pD–
);

144129 ifÐ
	grc
==
SQLITE_OK
 ){

144130 
sql™e3_¡mt
 *
pChomp
 = 0;

144131 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_CHOMP_SEGDIR
, &
pChomp
, 0);

144132 ifÐ
	grc
==
SQLITE_OK
 ){

144133 
sql™e3_bšd_št64
(
pChomp
, 1, 
iNewS¹
);

144134 
sql™e3_bšd_blob
(
pChomp
, 2, 
roÙ
.
a
,„oÙ.
n
, 
SQLITE_STATIC
);

144135 
sql™e3_bšd_št64
(
pChomp
, 3, 
iAbsLev–
);

144136 
sql™e3_bšd_št
(
pChomp
, 4, 
iIdx
);

144137 
sql™e3_¡•
(
pChomp
);

144138 
	grc
 = 
sql™e3_»£t
(
pChomp
);

144142 
sql™e3_ä“
(
roÙ
.
a
);

144143 
sql™e3_ä“
(
block
.
a
);

144144  
	grc
;

144157 
ás3Inüm”geChomp
(

144158 
Fts3TabË
 *
p
,

144159 
sql™e3_št64
 
iAbsLev–
,

144160 
Fts3MuÉiSegR—d”
 *
pC¤
,

144161 *
²Rem


144163 
	gi
;

144164 
	gnRem
 = 0;

144165 
	grc
 = 
SQLITE_OK
;

144167 
	gi
=
pC¤
->
nSegm’t
-1; i>=0 && 
rc
==
SQLITE_OK
; i--){

144168 
Fts3SegR—d”
 *
	gpSeg
 = 0;

144169 
	gj
;

144173 
	gj
=0; 
ALWAYS
(
j
<
pC¤
->
nSegm’t
); j++){

144174 
	gpSeg
 = 
pC¤
->
­Segm’t
[
j
];

144175 ifÐ
	gpSeg
->
	giIdx
==
i
 ) ;

144177 
as£¹
Ð
j
<
pC¤
->
nSegm’t
 && 
pSeg
->
iIdx
==
i
 );

144179 ifÐ
	gpSeg
->
	gaNode
==0 ){

144181 
rc
 = 
ás3D–‘eSegm’t
(
p
, 
pSeg
);

144182 ifÐ
	grc
==
SQLITE_OK
 ){

144183 
rc
 = 
ás3RemoveSegdœEÁry
(
p
, 
iAbsLev–
, 
pSeg
->
iIdx
);

144185 *
	g²Rem
 = 0;

144190 cÚ¡ *
	gzT”m
 = 
pSeg
->
zT”m
;

144191 
	gnT”m
 = 
pSeg
->
nT”m
;

144192 
	grc
 = 
ás3Trunÿ‹Segm’t
(
p
, 
iAbsLev–
, 
pSeg
->
iIdx
, 
zT”m
, 
nT”m
);

144193 
	gnRem
++;

144197 ifÐ
	grc
==
SQLITE_OK
 && 
nRem
!=
pC¤
->
nSegm’t
 ){

144198 
rc
 = 
ás3R•ackSegdœLev–
(
p
, 
iAbsLev–
);

144201 *
	g²Rem
 = 
nRem
;

144202  
	grc
;

144208 
ás3Inüm”geHštStÜe
(
Fts3TabË
 *
p
, 
Blob
 *
pHšt
){

144209 
sql™e3_¡mt
 *
	gpR•Ïû
 = 0;

144210 
	grc
;

144212 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_REPLACE_STAT
, &
pR•Ïû
, 0);

144213 ifÐ
	grc
==
SQLITE_OK
 ){

144214 
sql™e3_bšd_št
(
pR•Ïû
, 1, 
FTS_STAT_INCRMERGEHINT
);

144215 
sql™e3_bšd_blob
(
pR•Ïû
, 2, 
pHšt
->
a
,…Hšt->
n
, 
SQLITE_STATIC
);

144216 
sql™e3_¡•
(
pR•Ïû
);

144217 
	grc
 = 
sql™e3_»£t
(
pR•Ïû
);

144220  
	grc
;

144231 
ás3Inüm”geHštLßd
(
Fts3TabË
 *
p
, 
Blob
 *
pHšt
){

144232 
sql™e3_¡mt
 *
	gpS–eù
 = 0;

144233 
	grc
;

144235 
	gpHšt
->
	gn
 = 0;

144236 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_STAT
, &
pS–eù
, 0);

144237 ifÐ
	grc
==
SQLITE_OK
 ){

144238 
rc2
;

144239 
sql™e3_bšd_št
(
pS–eù
, 1, 
FTS_STAT_INCRMERGEHINT
);

144240 ifÐ
	gSQLITE_ROW
==
sql™e3_¡•
(
pS–eù
) ){

144241 cÚ¡ *
aHšt
 = 
sql™e3_cÞumn_blob
(
pS–eù
, 0);

144242 
	gnHšt
 = 
sql™e3_cÞumn_by‹s
(
pS–eù
, 0);

144243 ifÐ
	gaHšt
 ){

144244 
blobGrowBufãr
(
pHšt
, 
nHšt
, &
rc
);

144245 ifÐ
	grc
==
SQLITE_OK
 ){

144246 
memýy
(
pHšt
->
a
, 
aHšt
, 
nHšt
);

144247 
	gpHšt
->
	gn
 = 
nHšt
;

144251 
	grc2
 = 
sql™e3_»£t
(
pS–eù
);

144252 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

144255  
	grc
;

144267 
ás3Inüm”geHštPush
(

144268 
Blob
 *
pHšt
,

144269 
i64
 
iAbsLev–
,

144270 
nIÅut
,

144271 *
pRc


144273 
blobGrowBufãr
(
pHšt
,…Hšt->
n
 + 2*
FTS3_VARINT_MAX
, 
pRc
);

144274 ifÐ*
	gpRc
==
SQLITE_OK
 ){

144275 
pHšt
->
n
 +ð
sql™e3Fts3PutV¬št
(&pHšt->
a
[pHšt->n], 
iAbsLev–
);

144276 
	gpHšt
->
	gn
 +ð
sql™e3Fts3PutV¬št
(&
pHšt
->
a
[pHšt->
n
], (
i64
)
nIÅut
);

144288 
ás3Inüm”geHštPÝ
(
Blob
 *
pHšt
, 
i64
 *
piAbsLev–
, *
²IÅut
){

144289 cÚ¡ 
	gnHšt
 = 
pHšt
->
n
;

144290 
	gi
;

144292 
	gi
 = 
pHšt
->
n
-2;

144293  
	gi
>0 && (
	gpHšt
->
	ga
[
i
-1] & 0x80) ) i--;

144294  
	gi
>0 && (
	gpHšt
->
	ga
[
i
-1] & 0x80) ) i--;

144296 
	gpHšt
->
	gn
 = 
i
;

144297 
	gi
 +ð
sql™e3Fts3G‘V¬št
(&
pHšt
->
a
[
i
], 
piAbsLev–
);

144298 
	gi
 +ð
ás3G‘V¬št32
(&
pHšt
->
a
[
i
], 
²IÅut
);

144299 ifÐ
	gi
!=
nHšt
 )  
SQLITE_CORRUPT_VTAB
;

144301  
	gSQLITE_OK
;

144314 
SQLITE_PRIVATE
 
sql™e3Fts3Inüm”ge
(
Fts3TabË
 *
p
, 
nM”ge
, 
nMš
){

144315 
	grc
;

144316 
	gnRem
 = 
nM”ge
;

144317 
Fts3MuÉiSegR—d”
 *
	gpC¤
;

144318 
Fts3SegFž‹r
 *
	gpFž‹r
;

144319 
Inüm”geWr™”
 *
	gpWr™”
;

144320 
	gnSeg
 = 0;

144321 
sql™e3_št64
 
	giAbsLev–
 = 0;

144322 
Blob
 
	ghšt
 = {0, 0, 0};

144323 
	gbDœtyHšt
 = 0;

144326 cÚ¡ 
	gnAÎoc
 = (*
pC¤
è+ (*
pFž‹r
è+ (*
pWr™”
);

144327 
	gpWr™”
 = (
Inüm”geWr™”
 *)
sql™e3_m®loc
(
nAÎoc
);

144328 ifÐ!
	gpWr™”
 )  
	gSQLITE_NOMEM
;

144329 
	gpFž‹r
 = (
Fts3SegFž‹r
 *)&
pWr™”
[1];

144330 
	gpC¤
 = (
Fts3MuÉiSegR—d”
 *)&
pFž‹r
[1];

144332 
	grc
 = 
ás3Inüm”geHštLßd
(
p
, &
hšt
);

144333  
	grc
==
SQLITE_OK
 && 
nRem
>0 ){

144334 cÚ¡ 
i64
 
nMod
 = 
FTS3_SEGDIR_MAXLEVEL
 * 
p
->
nIndex
;

144335 
sql™e3_¡mt
 *
	gpFšdLev–
 = 0;

144336 
	gbU£Hšt
 = 0;

144337 
	giIdx
 = 0;

144345 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_FIND_MERGE_LEVEL
, &
pFšdLev–
, 0);

144346 
sql™e3_bšd_št
(
pFšdLev–
, 1, 
nMš
);

144347 ifÐ
sql™e3_¡•
(
pFšdLev–
)==
SQLITE_ROW
 ){

144348 
iAbsLev–
 = 
sql™e3_cÞumn_št64
(
pFšdLev–
, 0);

144349 
	gnSeg
 = 
nMš
;

144351 
	gnSeg
 = -1;

144353 
	grc
 = 
sql™e3_»£t
(
pFšdLev–
);

144360 ifÐ
	grc
==
SQLITE_OK
 && 
hšt
.
n
 ){

144361 
nHšt
 = 
hšt
.
n
;

144362 
sql™e3_št64
 
	giHštAbsLev–
 = 0;

144363 
	gnHštSeg
 = 0;

144365 
	grc
 = 
ás3Inüm”geHštPÝ
(&
hšt
, &
iHštAbsLev–
, &
nHštSeg
);

144366 ifÐ
	gnSeg
<0 || (
	giAbsLev–
 % 
	gnMod
è>ð(
iHštAbsLev–
 % 
nMod
) ){

144367 
iAbsLev–
 = 
iHštAbsLev–
;

144368 
	gnSeg
 = 
nHštSeg
;

144369 
	gbU£Hšt
 = 1;

144370 
	gbDœtyHšt
 = 1;

144374 
	ghšt
.
	gn
 = 
nHšt
;

144381 ifÐ
	gnSeg
<0 ) ;

144389 
mem£t
(
pWr™”
, 0, 
nAÎoc
);

144390 
	gpFž‹r
->
	gæags
 = 
FTS3_SEGMENT_REQUIRE_POS
;

144392 ifÐ
	grc
==
SQLITE_OK
 ){

144393 
rc
 = 
ás3Inüm”geOuutIdx
(
p
, 
iAbsLev–
, &
iIdx
);

144394 
as£¹
Ð
bU£Hšt
==1 || bUseHint==0 );

144395 ifÐ
	giIdx
==0 || (
bU£Hšt
 && 
iIdx
==1) ){

144396 
bIgnÜe
 = 0;

144397 
	grc
 = 
ás3Segm’tIsMaxLev–
(
p
, 
iAbsLev–
+1, &
bIgnÜe
);

144398 ifÐ
	gbIgnÜe
 ){

144399 
	gpFž‹r
->
	gæags
 |ð
FTS3_SEGMENT_IGNORE_EMPTY
;

144404 ifÐ
	grc
==
SQLITE_OK
 ){

144405 
rc
 = 
ás3Inüm”geC¤
(
p
, 
iAbsLev–
, 
nSeg
, 
pC¤
);

144407 ifÐ
	gSQLITE_OK
==
rc
 && 
pC¤
->
nSegm’t
==
nSeg


144408 && 
SQLITE_OK
==(
rc
 = 
sql™e3Fts3SegR—d”S¹
(
p
, 
pC¤
, 
pFž‹r
))

144409 && 
	gSQLITE_ROW
==(
rc
 = 
sql™e3Fts3SegR—d”S‹p
(
p
, 
pC¤
))

144411 ifÐ
	gbU£Hšt
 && 
	giIdx
>0 ){

144412 cÚ¡ *
	gzKey
 = 
pC¤
->
zT”m
;

144413 
	gnKey
 = 
pC¤
->
nT”m
;

144414 
	grc
 = 
ás3Inüm”geLßd
(
p
, 
iAbsLev–
, 
iIdx
-1, 
zKey
, 
nKey
, 
pWr™”
);

144416 
	grc
 = 
ás3Inüm”geWr™”
(
p
, 
iAbsLev–
, 
iIdx
, 
pC¤
, 
pWr™”
);

144419 ifÐ
	grc
==
SQLITE_OK
 && 
pWr™”
->
nL—fE¡
 ){

144420 
ás3LogM”ge
(
nSeg
, 
iAbsLev–
);

144422 
	grc
 = 
ás3Inüm”geAµ’d
(
p
, 
pWr™”
, 
pC¤
);

144423 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
sql™e3Fts3SegR—d”S‹p
(
p
, 
pC¤
);

144424 ifÐ
	gpWr™”
->
	gnWÜk
>=
nRem
 && 
rc
==
SQLITE_ROW
 )„øð
SQLITE_OK
;

144425 } 
	grc
==
SQLITE_ROW
 );

144428 ifÐ
	grc
==
SQLITE_OK
 ){

144429 
nRem
 -ð(1 + 
pWr™”
->
nWÜk
);

144430 
	grc
 = 
ás3Inüm”geChomp
(
p
, 
iAbsLev–
, 
pC¤
, &
nSeg
);

144431 ifÐ
	gnSeg
!=0 ){

144432 
bDœtyHšt
 = 1;

144433 
ás3Inüm”geHštPush
(&
hšt
, 
iAbsLev–
, 
nSeg
, &
rc
);

144438 ifÐ
	gnSeg
!=0 ){

144439 
pWr™”
->
nL—fD©a
 =…Writer->nLeafData * -1;

144441 
ás3Inüm”geR–—£
(
p
, 
pWr™”
, &
rc
);

144442 ifÐ
	gnSeg
==0 && 
pWr™”
->
bNoL—fD©a
==0 ){

144443 
ás3PromÙeSegm’ts
(
p
, 
iAbsLev–
+1, 
pWr™”
->
nL—fD©a
);

144447 
sql™e3Fts3SegR—d”Fšish
(
pC¤
);

144451 ifÐ
	gbDœtyHšt
 && 
	grc
==
SQLITE_OK
 ){

144452 
rc
 = 
ás3Inüm”geHštStÜe
(
p
, &
hšt
);

144455 
sql™e3_ä“
(
pWr™”
);

144456 
sql™e3_ä“
(
hšt
.
a
);

144457  
	grc
;

144465 
ás3G‘št
(cÚ¡ **
pz
){

144466 cÚ¡ *
	gz
 = *
pz
;

144467 
	gi
 = 0;

144468  (*
	gz
)>='0' && (*
z
)<='9' ) 
i
 = 10*i + *(z++) - '0';

144469 *
	gpz
 = 
z
;

144470  
	gi
;

144482 
ás3DoInüm”ge
(

144483 
Fts3TabË
 *
p
,

144484 cÚ¡ *
zP¬am


144486 
	grc
;

144487 
	gnMš
 = (
FTS3_MERGE_COUNT
 / 2);

144488 
	gnM”ge
 = 0;

144489 cÚ¡ *
	gz
 = 
zP¬am
;

144492 
	gnM”ge
 = 
ás3G‘št
(&
z
);

144496 ifÐ
	gz
[0]==',' && 
z
[1]!='\0' ){

144497 
z
++;

144498 
	gnMš
 = 
ás3G‘št
(&
z
);

144501 ifÐ
	gz
[0]!='\0' || 
nMš
<2 ){

144502 
rc
 = 
SQLITE_ERROR
;

144504 
	grc
 = 
SQLITE_OK
;

144505 ifÐ!
	gp
->
	gbHasSt
 ){

144506 
as£¹
Ð
p
->
bFts4
==0 );

144507 
sql™e3Fts3C»©eStTabË
(&
rc
, 
p
);

144509 ifÐ
	grc
==
SQLITE_OK
 ){

144510 
rc
 = 
sql™e3Fts3Inüm”ge
(
p
, 
nM”ge
, 
nMš
);

144512 
sql™e3Fts3Segm’tsClo£
(
p
);

144514  
	grc
;

144525 
ás3DoAutošüm”ge
(

144526 
Fts3TabË
 *
p
,

144527 cÚ¡ *
zP¬am


144529 
	grc
 = 
SQLITE_OK
;

144530 
sql™e3_¡mt
 *
	gpStmt
 = 0;

144531 
	gp
->
	gnAutošüm”ge
 = 
ás3G‘št
(&
zP¬am
);

144532 ifÐ
	gp
->
	gnAutošüm”ge
==1 || 
p
->
nAutošüm”ge
>
FTS3_MERGE_COUNT
 ){

144533 
p
->
nAutošüm”ge
 = 8;

144535 ifÐ!
	gp
->
	gbHasSt
 ){

144536 
as£¹
Ð
p
->
bFts4
==0 );

144537 
sql™e3Fts3C»©eStTabË
(&
rc
, 
p
);

144538 ifÐ
	grc
 ) „c;

144540 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_REPLACE_STAT
, &
pStmt
, 0);

144541 ifÐ
	grc
 ) „c;

144542 
sql™e3_bšd_št
(
pStmt
, 1, 
FTS_STAT_AUTOINCRMERGE
);

144543 
sql™e3_bšd_št
(
pStmt
, 2, 
p
->
nAutošüm”ge
);

144544 
sql™e3_¡•
(
pStmt
);

144545 
	grc
 = 
sql™e3_»£t
(
pStmt
);

144546  
	grc
;

144553 
u64
 
ás3ChecksumEÁry
(

144554 cÚ¡ *
zT”m
,

144555 
nT”m
,

144556 
iLªgid
,

144557 
iIndex
,

144558 
i64
 
iDocid
,

144559 
iCÞ
,

144560 
iPos


144562 
	gi
;

144563 
u64
 
	g»t
 = (u64)
iDocid
;

144565 
	g»t
 +ð(
»t
<<3è+ 
iLªgid
;

144566 
	g»t
 +ð(
»t
<<3è+ 
iIndex
;

144567 
	g»t
 +ð(
»t
<<3è+ 
iCÞ
;

144568 
	g»t
 +ð(
»t
<<3è+ 
iPos
;

144569 
	gi
=0; i<
	gnT”m
; i++è
	g»t
 +ð(
»t
<<3è+ 
zT”m
[
i
];

144571  
	g»t
;

144583 
u64
 
ás3ChecksumIndex
(

144584 
Fts3TabË
 *
p
,

144585 
iLªgid
,

144586 
iIndex
,

144587 *
pRc


144589 
Fts3SegFž‹r
 
	gfž‹r
;

144590 
Fts3MuÉiSegR—d”
 
	gc¤
;

144591 
	grc
;

144592 
u64
 
	gcksum
 = 0;

144594 
as£¹
Ð*
pRc
==
SQLITE_OK
 );

144596 
mem£t
(&
fž‹r
, 0, (filter));

144597 
mem£t
(&
c¤
, 0, (csr));

144598 
	gfž‹r
.
	gæags
 = 
FTS3_SEGMENT_REQUIRE_POS
|
FTS3_SEGMENT_IGNORE_EMPTY
;

144599 
	gfž‹r
.
	gæags
 |ð
FTS3_SEGMENT_SCAN
;

144601 
	grc
 = 
sql™e3Fts3SegR—d”CursÜ
(

144602 
p
, 
iLªgid
, 
iIndex
, 
FTS3_SEGCURSOR_ALL
, 0, 0, 0, 1,&
c¤


144604 ifÐ
	grc
==
SQLITE_OK
 ){

144605 
rc
 = 
sql™e3Fts3SegR—d”S¹
(
p
, &
c¤
, &
fž‹r
);

144608 ifÐ
	grc
==
SQLITE_OK
 ){

144609  
SQLITE_ROW
==(
rc
 = 
sql™e3Fts3SegR—d”S‹p
(
p
, &
c¤
)) ){

144610 *
	gpC¤
 = 
c¤
.
aDoþi¡
;

144611 *
	gpEnd
 = &
pC¤
[
c¤
.
nDoþi¡
];

144613 
i64
 
	giDocid
 = 0;

144614 
i64
 
	giCÞ
 = 0;

144615 
i64
 
	giPos
 = 0;

144617 
	gpC¤
 +ð
sql™e3Fts3G‘V¬št
(
pC¤
, &
iDocid
);

144618  
	gpC¤
<
	gpEnd
 ){

144619 
i64
 
	giV®
 = 0;

144620 
	gpC¤
 +ð
sql™e3Fts3G‘V¬št
(
pC¤
, &
iV®
);

144621 ifÐ
	gpC¤
<
	gpEnd
 ){

144622 ifÐ
	giV®
==0 || 
iV®
==1 ){

144623 
iCÞ
 = 0;

144624 
	giPos
 = 0;

144625 ifÐ
	giV®
 ){

144626 
	gpC¤
 +ð
sql™e3Fts3G‘V¬št
(
pC¤
, &
iCÞ
);

144628 
	gpC¤
 +ð
sql™e3Fts3G‘V¬št
(
pC¤
, &
iV®
);

144629 
	giDocid
 +ð
iV®
;

144632 
	giPos
 +ð(
iV®
 - 2);

144633 
	gcksum
 = 
cksum
 ^ 
ás3ChecksumEÁry
(

144634 
c¤
.
zT”m
, c¤.
nT”m
, 
iLªgid
, 
iIndex
, 
iDocid
,

144635 ()
iCÞ
, ()
iPos


144642 
sql™e3Fts3SegR—d”Fšish
(&
c¤
);

144644 *
	gpRc
 = 
rc
;

144645  
	gcksum
;

144657 
ás3IÁegr™yCheck
(
Fts3TabË
 *
p
, *
pbOk
){

144658 
	grc
 = 
SQLITE_OK
;

144659 
u64
 
	gcksum1
 = 0;

144660 
u64
 
	gcksum2
 = 0;

144661 
sql™e3_¡mt
 *
	gpAÎLªgid
 = 0;

144664 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_ALL_LANGID
, &
pAÎLªgid
, 0);

144665 ifÐ
	grc
==
SQLITE_OK
 ){

144666 
rc2
;

144667 
sql™e3_bšd_št
(
pAÎLªgid
, 1, 
p
->
nIndex
);

144668  
	grc
==
SQLITE_OK
 && 
sql™e3_¡•
(
pAÎLªgid
)==
SQLITE_ROW
 ){

144669 
iLªgid
 = 
sql™e3_cÞumn_št
(
pAÎLªgid
, 0);

144670 
	gi
;

144671 
	gi
=0; i<
	gp
->
	gnIndex
; i++){

144672 
	gcksum1
 = 
cksum1
 ^ 
ás3ChecksumIndex
(
p
, 
iLªgid
, 
i
, &
rc
);

144675 
	grc2
 = 
sql™e3_»£t
(
pAÎLªgid
);

144676 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

144680 
	grc
 = 
ás3SqlStmt
(
p
, 
SQL_SELECT_ALL_LANGID
, &
pAÎLªgid
, 0);

144681 ifÐ
	grc
==
SQLITE_OK
 ){

144682 
sql™e3_tok’iz”_moduË
 cÚ¡ *
pModuË
 = 
p
->
pTok’iz”
->pModule;

144683 
sql™e3_¡mt
 *
	gpStmt
 = 0;

144684 *
	gzSql
;

144686 
	gzSql
 = 
sql™e3_m´štf
("SELECT %s" , 
p
->
zR—dEx´li¡
);

144687 ifÐ!
	gzSql
 ){

144688 
	grc
 = 
SQLITE_NOMEM
;

144690 
	grc
 = 
sql™e3_´•¬e_v2
(
p
->
db
, 
zSql
, -1, &
pStmt
, 0);

144691 
sql™e3_ä“
(
zSql
);

144694  
	grc
==
SQLITE_OK
 && 
SQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

144695 
i64
 
iDocid
 = 
sql™e3_cÞumn_št64
(
pStmt
, 0);

144696 
	giLªg
 = 
ÏngidFromS–eù
(
p
, 
pStmt
);

144697 
	giCÞ
;

144699 
	giCÞ
=0; 
	grc
==
SQLITE_OK
 && 
iCÞ
<
p
->
nCÞumn
; iCol++){

144700 ifÐ
	gp
->
	gabNÙšdexed
[
iCÞ
]==0 ){

144701 cÚ¡ *
zText
 = (cÚ¡ *)
sql™e3_cÞumn_‹xt
(
pStmt
, 
iCÞ
+1);

144702 
	gnText
 = 
sql™e3_cÞumn_by‹s
(
pStmt
, 
iCÞ
+1);

144703 
sql™e3_tok’iz”_cursÜ
 *
	gpT
 = 0;

144705 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
p
->
pTok’iz”
, 
iLªg
, 
zText
, 
nText
,&
pT
);

144706  
	grc
==
SQLITE_OK
 ){

144707 cÚ¡ *
zTok’
;

144708 
	gnTok’
 = 0;

144709 
	giDum1
 = 0, 
	giDum2
 = 0;

144710 
	giPos
 = 0;

144712 
	grc
 = 
pModuË
->
xNext
(
pT
, &
zTok’
, &
nTok’
, &
iDum1
, &
iDum2
, &
iPos
);

144713 ifÐ
	grc
==
SQLITE_OK
 ){

144714 
i
;

144715 
	gcksum2
 = 
cksum2
 ^ 
ás3ChecksumEÁry
(

144716 
zTok’
, 
nTok’
, 
iLªg
, 0, 
iDocid
, 
iCÞ
, 
iPos


144718 
	gi
=1; i<
	gp
->
	gnIndex
; i++){

144719 ifÐ
	gp
->
	gaIndex
[
i
].
	gnP»fix
<=
nTok’
 ){

144720 
cksum2
 = cksum2 ^ 
ás3ChecksumEÁry
(

144721 
zTok’
, 
p
->
aIndex
[
i
].
nP»fix
, 
iLªg
, i, 
iDocid
, 
iCÞ
, 
iPos


144727 ifÐ
	gpT
 ) 
	gpModuË
->
xClo£
(
pT
);

144728 ifÐ
	grc
==
SQLITE_DONE
 ) 
rc
 = 
SQLITE_OK
;

144733 
sql™e3_fš®ize
(
pStmt
);

144736 *
	gpbOk
 = (
cksum1
==
cksum2
);

144737  
	grc
;

144771 
ás3DoIÁegr™yCheck
(

144772 
Fts3TabË
 *
p


144774 
	grc
;

144775 
	gbOk
 = 0;

144776 
	grc
 = 
ás3IÁegr™yCheck
(
p
, &
bOk
);

144777 ifÐ
	grc
==
SQLITE_OK
 && 
bOk
==0 ) 
rc
 = 
SQLITE_CORRUPT_VTAB
;

144778  
	grc
;

144789 
ás3S³cŸlIn£¹
(
Fts3TabË
 *
p
, 
sql™e3_v®ue
 *
pV®
){

144790 
	grc
;

144791 cÚ¡ *
	gzV®
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
pV®
);

144792 
	gnV®
 = 
sql™e3_v®ue_by‹s
(
pV®
);

144794 ifÐ!
	gzV®
 ){

144795  
	gSQLITE_NOMEM
;

144796 }ifÐ
	gnV®
==8 && 0==
sql™e3_¡ºicmp
(
zV®
, "optimize", 8) ){

144797 
	grc
 = 
ás3DoO±imize
(
p
, 0);

144798 }ifÐ
	gnV®
==7 && 0==
sql™e3_¡ºicmp
(
zV®
, "rebuild", 7) ){

144799 
	grc
 = 
ás3DoRebužd
(
p
);

144800 }ifÐ
	gnV®
==15 && 0==
sql™e3_¡ºicmp
(
zV®
, "integrity-check", 15) ){

144801 
	grc
 = 
ás3DoIÁegr™yCheck
(
p
);

144802 }ifÐ
	gnV®
>6 && 0==
sql™e3_¡ºicmp
(
zV®
, "merge=", 6) ){

144803 
	grc
 = 
ás3DoInüm”ge
(
p
, &
zV®
[6]);

144804 }ifÐ
	gnV®
>10 && 0==
sql™e3_¡ºicmp
(
zV®
, "automerge=", 10) ){

144805 
	grc
 = 
ás3DoAutošüm”ge
(
p
, &
zV®
[10]);

144806 #ifdeà
SQLITE_TEST


144807 }ifÐ
	gnV®
>9 && 0==
sql™e3_¡ºicmp
(
zV®
, "nodesize=", 9) ){

144808 
	gp
->
	gnNodeSize
 = 
©oi
(&
zV®
[9]);

144809 
	grc
 = 
SQLITE_OK
;

144810 }ifÐ
	gnV®
>11 && 0==
sql™e3_¡ºicmp
(
zV®
, "maxpending=", 9) ){

144811 
	gp
->
	gnMaxP’dšgD©a
 = 
©oi
(&
zV®
[11]);

144812 
	grc
 = 
SQLITE_OK
;

144813 }ifÐ
	gnV®
>21 && 0==
sql™e3_¡ºicmp
(
zV®
, "test-no-incr-doclist=", 21) ){

144814 
	gp
->
	gbNoInüDoþi¡
 = 
©oi
(&
zV®
[21]);

144815 
	grc
 = 
SQLITE_OK
;

144818 
	grc
 = 
SQLITE_ERROR
;

144821  
	grc
;

144824 #iâdeà
SQLITE_DISABLE_FTS4_DEFERRED


144829 
SQLITE_PRIVATE
 
sql™e3Fts3F»eDeã¼edDoþi¡s
(
Fts3CursÜ
 *
pC¤
){

144830 
Fts3Deã¼edTok’
 *
	gpDef
;

144831 
	gpDef
=
pC¤
->
pDeã¼ed
;…Def;…Def=
pDef
->
pNext
){

144832 
ás3P’dšgLi¡D–‘e
(
pDef
->
pLi¡
);

144833 
	gpDef
->
	gpLi¡
 = 0;

144841 
SQLITE_PRIVATE
 
sql™e3Fts3F»eDeã¼edTok’s
(
Fts3CursÜ
 *
pC¤
){

144842 
Fts3Deã¼edTok’
 *
	gpDef
;

144843 
Fts3Deã¼edTok’
 *
	gpNext
;

144844 
	gpDef
=
pC¤
->
pDeã¼ed
;…Def;…Def=
pNext
){

144845 
pNext
 = 
pDef
->pNext;

144846 
ás3P’dšgLi¡D–‘e
(
pDef
->
pLi¡
);

144847 
sql™e3_ä“
(
pDef
);

144849 
	gpC¤
->
	gpDeã¼ed
 = 0;

144860 
SQLITE_PRIVATE
 
sql™e3Fts3CacheDeã¼edDoþi¡s
(
Fts3CursÜ
 *
pC¤
){

144861 
	grc
 = 
SQLITE_OK
;

144862 ifÐ
	gpC¤
->
	gpDeã¼ed
 ){

144863 
	gi
;

144864 
sql™e3_št64
 
	giDocid
;

144865 
Fts3Deã¼edTok’
 *
	gpDef
;

144867 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

144868 
sql™e3_tok’iz”
 *
	gpT
 = 
p
->
pTok’iz”
;

144869 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpModuË
 = 
pT
->
pModuË
;

144871 
as£¹
Ð
pC¤
->
isRequœeS“k
==0 );

144872 
	giDocid
 = 
sql™e3_cÞumn_št64
(
pC¤
->
pStmt
, 0);

144874 
	gi
=0; i<
	gp
->
	gnCÞumn
 && 
	grc
==
SQLITE_OK
; i++){

144875 ifÐ
	gp
->
	gabNÙšdexed
[
i
]==0 ){

144876 cÚ¡ *
zText
 = (cÚ¡ *)
sql™e3_cÞumn_‹xt
(
pC¤
->
pStmt
, 
i
+1);

144877 
sql™e3_tok’iz”_cursÜ
 *
	gpTC
 = 0;

144879 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pT
, 
pC¤
->
iLªgid
, 
zText
, -1, &
pTC
);

144880  
	grc
==
SQLITE_OK
 ){

144881 cÚ¡ *
zTok’
;

144882 
	gnTok’
 = 0;

144883 
	giDum1
 = 0, 
	giDum2
 = 0;

144884 
	giPos
 = 0;

144886 
	grc
 = 
pModuË
->
xNext
(
pTC
, &
zTok’
, &
nTok’
, &
iDum1
, &
iDum2
, &
iPos
);

144887 
	gpDef
=
pC¤
->
pDeã¼ed
;…Deà&& 
	grc
==
SQLITE_OK
;…Def=
pDef
->
pNext
){

144888 
Fts3Ph¿£Tok’
 *
pPT
 = 
pDef
->
pTok’
;

144889 ifÐ(
	gpDef
->
	giCÞ
>=
p
->
nCÞumn
 || 
pDef
->
iCÞ
==
i
)

144890 && (
pPT
->
bFœ¡
==0 || 
iPos
==0)

144891 && (
pPT
->
n
==
nTok’
 || (pPT->
isP»fix
 &&…PT->n<nToken))

144892 && (0==
memcmp
(
zTok’
, 
pPT
->
z
,…PT->
n
))

144894 
ás3P’dšgLi¡Aµ’d
(&
pDef
->
pLi¡
, 
iDocid
, 
i
, 
iPos
, &
rc
);

144898 ifÐ
	gpTC
 ) 
	gpModuË
->
xClo£
(
pTC
);

144899 ifÐ
	grc
==
SQLITE_DONE
 ) 
rc
 = 
SQLITE_OK
;

144903 
	gpDef
=
pC¤
->
pDeã¼ed
;…Deà&& 
	grc
==
SQLITE_OK
;…Def=
pDef
->
pNext
){

144904 ifÐ
pDef
->
pLi¡
 ){

144905 
rc
 = 
ás3P’dšgLi¡Aµ’dV¬št
(&
pDef
->
pLi¡
, 0);

144910  
	grc
;

144913 
SQLITE_PRIVATE
 
sql™e3Fts3Deã¼edTok’Li¡
(

144914 
Fts3Deã¼edTok’
 *
p
,

144915 **
µD©a
,

144916 *
²D©a


144918 *
	gpR‘
;

144919 
	gnSk
;

144920 
sql™e3_št64
 
	gdummy
;

144922 *
	gµD©a
 = 0;

144923 *
	g²D©a
 = 0;

144925 ifÐ
	gp
->
	gpLi¡
==0 ){

144926  
SQLITE_OK
;

144929 
	gpR‘
 = (*)
sql™e3_m®loc
(
p
->
pLi¡
->
nD©a
);

144930 ifÐ!
	gpR‘
 )  
	gSQLITE_NOMEM
;

144932 
	gnSk
 = 
sql™e3Fts3G‘V¬št
(
p
->
pLi¡
->
aD©a
, &
dummy
);

144933 *
	g²D©a
 = 
p
->
pLi¡
->
nD©a
 - 
nSk
;

144934 *
	gµD©a
 = 
pR‘
;

144936 
memýy
(
pR‘
, &
p
->
pLi¡
->
aD©a
[
nSk
], *
²D©a
);

144937  
	gSQLITE_OK
;

144943 
SQLITE_PRIVATE
 
sql™e3Fts3DeãrTok’
(

144944 
Fts3CursÜ
 *
pC¤
,

144945 
Fts3Ph¿£Tok’
 *
pTok’
,

144946 
iCÞ


144948 
Fts3Deã¼edTok’
 *
	gpDeã¼ed
;

144949 
	gpDeã¼ed
 = 
sql™e3_m®loc
((*
pDeã¼ed
));

144950 ifÐ!
	gpDeã¼ed
 ){

144951  
	gSQLITE_NOMEM
;

144953 
mem£t
(
pDeã¼ed
, 0, (*pDeferred));

144954 
	gpDeã¼ed
->
	gpTok’
 = 
pTok’
;

144955 
	gpDeã¼ed
->
	gpNext
 = 
pC¤
->
pDeã¼ed
;

144956 
	gpDeã¼ed
->
	giCÞ
 = 
iCÞ
;

144957 
	gpC¤
->
	gpDeã¼ed
 = 
pDeã¼ed
;

144959 
as£¹
Ð
pTok’
->
pDeã¼ed
==0 );

144960 
	gpTok’
->
	gpDeã¼ed
 = 
pDeã¼ed
;

144962  
	gSQLITE_OK
;

144971 
ás3D–‘eByRowid
(

144972 
Fts3TabË
 *
p
,

144973 
sql™e3_v®ue
 *
pRowid
,

144974 *
²Chng
,

144975 
u32
 *
aSzD–


144977 
	grc
 = 
SQLITE_OK
;

144978 
	gbFound
 = 0;

144980 
ás3D–‘eT”ms
(&
rc
, 
p
, 
pRowid
, 
aSzD–
, &
bFound
);

144981 ifÐ
	gbFound
 && 
	grc
==
SQLITE_OK
 ){

144982 
isEm±y
 = 0;

144983 
	grc
 = 
ás3IsEm±y
(
p
, 
pRowid
, &
isEm±y
);

144984 ifÐ
	grc
==
SQLITE_OK
 ){

144985 ifÐ
isEm±y
 ){

144989 
rc
 = 
ás3D–‘eAÎ
(
p
, 1);

144990 *
	g²Chng
 = 0;

144991 
mem£t
(
aSzD–
, 0, (
u32
è* (
p
->
nCÞumn
+1) * 2);

144993 *
	g²Chng
 = *
²Chng
 - 1;

144994 ifÐ
	gp
->
	gzCÚ‹ÁTbl
==0 ){

144995 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_CONTENT
, &
pRowid
);

144997 ifÐ
	gp
->
	gbHasDocsize
 ){

144998 
ás3SqlExec
(&
rc
, 
p
, 
SQL_DELETE_DOCSIZE
, &
pRowid
);

145004  
	grc
;

145020 
SQLITE_PRIVATE
 
sql™e3Fts3Upd©eM‘hod
(

145021 
sql™e3_vb
 *
pVb
,

145022 
nArg
,

145023 
sql™e3_v®ue
 **
­V®
,

145024 
sql™e_št64
 *
pRowid


145026 
Fts3TabË
 *
	gp
 = (Fts3TabË *)
pVb
;

145027 
	grc
 = 
SQLITE_OK
;

145028 
	gisRemove
 = 0;

145029 
u32
 *
	gaSzIns
 = 0;

145030 
u32
 *
	gaSzD–
 = 0;

145031 
	gnChng
 = 0;

145032 
	gbIn£¹DÚe
 = 0;

145036 
as£¹
Ð
p
->
bHasSt
==0 ||…->bHasStat==1 );

145038 
as£¹
Ð
p
->
pSegm’ts
==0 );

145039 
as£¹
(

145040 
nArg
==1

145041 || 
nArg
==(2 + 
p
->
nCÞumn
 + 3)

145048 ifÐ
	gnArg
>1

145049 && 
sql™e3_v®ue_ty³
(
­V®
[0])==
SQLITE_NULL


145050 && 
sql™e3_v®ue_ty³
(
­V®
[
p
->
nCÞumn
+2])!=
SQLITE_NULL


145052 
rc
 = 
ás3S³cŸlIn£¹
(
p
, 
­V®
[p->
nCÞumn
+2]);

145053 
	gupd©e_out
;

145056 ifÐ
	gnArg
>1 && 
sql™e3_v®ue_št
(
­V®
[2 + 
p
->
nCÞumn
 + 2])<0 ){

145057 
	grc
 = 
SQLITE_CONSTRAINT
;

145058 
	gupd©e_out
;

145062 
	gaSzD–
 = 
sql™e3_m®loc
Ð(
aSzD–
[0])*(
p
->
nCÞumn
+1)*2 );

145063 ifÐ
	gaSzD–
==0 ){

145064 
rc
 = 
SQLITE_NOMEM
;

145065 
	gupd©e_out
;

145067 
	gaSzIns
 = &
aSzD–
[
p
->
nCÞumn
+1];

145068 
mem£t
(
aSzD–
, 0, ×SzD–[0])*(
p
->
nCÞumn
+1)*2);

145070 
	grc
 = 
ás3Wr™–ock
(
p
);

145071 ifÐ
	grc
!=
SQLITE_OK
 ) 
upd©e_out
;

145082 ifÐ
	gnArg
>1 && 
	gp
->
	gzCÚ‹ÁTbl
==0 ){

145084 
sql™e3_v®ue
 *
pNewRowid
 = 
­V®
[3+
p
->
nCÞumn
];

145085 ifÐ
sql™e3_v®ue_ty³
(
pNewRowid
)==
SQLITE_NULL
 ){

145086 
pNewRowid
 = 
­V®
[1];

145089 ifÐ
sql™e3_v®ue_ty³
(
pNewRowid
)!=
SQLITE_NULL
 && (

145090 
sql™e3_v®ue_ty³
(
­V®
[0])==
SQLITE_NULL


145091 || 
sql™e3_v®ue_št64
(
­V®
[0])!=sql™e3_v®ue_št64(
pNewRowid
)

145110 ifÐ
sql™e3_vb_Ú_cÚæiù
(
p
->
db
)==
SQLITE_REPLACE
 ){

145111 
rc
 = 
ás3D–‘eByRowid
(
p
, 
pNewRowid
, &
nChng
, 
aSzD–
);

145113 
	grc
 = 
ás3In£¹D©a
(
p
, 
­V®
, 
pRowid
);

145114 
	gbIn£¹DÚe
 = 1;

145118 ifÐ
	grc
!=
SQLITE_OK
 ){

145119 
upd©e_out
;

145123 ifÐ
sql™e3_v®ue_ty³
(
­V®
[0])!=
SQLITE_NULL
 ){

145124 
as£¹
Ð
sql™e3_v®ue_ty³
(
­V®
[0])==
SQLITE_INTEGER
 );

145125 
	grc
 = 
ás3D–‘eByRowid
(
p
, 
­V®
[0], &
nChng
, 
aSzD–
);

145126 
	gisRemove
 = 1;

145130 ifÐ
	gnArg
>1 && 
	grc
==
SQLITE_OK
 ){

145131 
iLªgid
 = 
sql™e3_v®ue_št
(
­V®
[2 + 
p
->
nCÞumn
 + 2]);

145132 ifÐ
	gbIn£¹DÚe
==0 ){

145133 
rc
 = 
ás3In£¹D©a
(
p
, 
­V®
, 
pRowid
);

145134 ifÐ
	grc
==
SQLITE_CONSTRAINT
 && 
p
->
zCÚ‹ÁTbl
==0 ){

145135 
rc
 = 
FTS_CORRUPT_VTAB
;

145138 ifÐ
	grc
==
SQLITE_OK
 && (!
isRemove
 || *
pRowid
!=
p
->
iP»vDocid
 ) ){

145139 
rc
 = 
ás3P’dšgT”msDocid
(
p
, 
iLªgid
, *
pRowid
);

145141 ifÐ
	grc
==
SQLITE_OK
 ){

145142 
as£¹
Ð
p
->
iP»vDocid
==*
pRowid
 );

145143 
	grc
 = 
ás3In£¹T”ms
(
p
, 
iLªgid
, 
­V®
, 
aSzIns
);

145145 ifÐ
	gp
->
	gbHasDocsize
 ){

145146 
ás3In£¹Docsize
(&
rc
, 
p
, 
aSzIns
);

145148 
	gnChng
++;

145151 ifÐ
	gp
->
	gbFts4
 ){

145152 
ás3Upd©eDocTÙ®s
(&
rc
, 
p
, 
aSzIns
, 
aSzD–
, 
nChng
);

145155 
	gupd©e_out
:

145156 
sql™e3_ä“
(
aSzD–
);

145157 
sql™e3Fts3Segm’tsClo£
(
p
);

145158  
	grc
;

145166 
SQLITE_PRIVATE
 
sql™e3Fts3O±imize
(
Fts3TabË
 *
p
){

145167 
	grc
;

145168 
	grc
 = 
sql™e3_exec
(
p
->
db
, "SAVEPOINT fts3", 0, 0, 0);

145169 ifÐ
	grc
==
SQLITE_OK
 ){

145170 
rc
 = 
ás3DoO±imize
(
p
, 1);

145171 ifÐ
	grc
==
SQLITE_OK
 || 
rc
==
SQLITE_DONE
 ){

145172 
rc2
 = 
sql™e3_exec
(
p
->
db
, "RELEASE fts3", 0, 0, 0);

145173 ifÐ
	grc2
!=
SQLITE_OK
 ) 
rc
 = 
rc2
;

145175 
sql™e3_exec
(
p
->
db
, "ROLLBACK TO fts3", 0, 0, 0);

145176 
sql™e3_exec
(
p
->
db
, "RELEASE fts3", 0, 0, 0);

145179 
sql™e3Fts3Segm’tsClo£
(
p
);

145180  
	grc
;

145200 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

145208 
	#FTS3_MATCHINFO_NPHRASE
 'p'

	)

145209 
	#FTS3_MATCHINFO_NCOL
 'c'

	)

145210 
	#FTS3_MATCHINFO_NDOC
 'n'

	)

145211 
	#FTS3_MATCHINFO_AVGLENGTH
 'a'

	)

145212 
	#FTS3_MATCHINFO_LENGTH
 'l'

	)

145213 
	#FTS3_MATCHINFO_LCS
 's'

	)

145214 
	#FTS3_MATCHINFO_HITS
 'x'

	)

145219 
	#FTS3_MATCHINFO_DEFAULT
 "pcx"

	)

145226 
LßdDoþi¡Ctx
 
	tLßdDoþi¡Ctx
;

145227 
	sLßdDoþi¡Ctx
 {

145228 
Fts3CursÜ
 *
	gpC¤
;

145229 
	gnPh¿£
;

145230 
	gnTok’
;

145237 
Sn³tI‹r
 
	tSn³tI‹r
;

145238 
Sn³tPh¿£
 
	tSn³tPh¿£
;

145239 
Sn³tF¿gm’t
 
	tSn³tF¿gm’t
;

145241 
	sSn³tI‹r
 {

145242 
Fts3CursÜ
 *
	gpC¤
;

145243 
	giCÞ
;

145244 
	gnSn³t
;

145245 
	gnPh¿£
;

145246 
Sn³tPh¿£
 *
	gaPh¿£
;

145247 
	giCu¼’t
;

145250 
	sSn³tPh¿£
 {

145251 
	gnTok’
;

145252 *
	gpLi¡
;

145253 
	giH—d
;

145254 *
	gpH—d
;

145255 
	giTaž
;

145256 *
	gpTaž
;

145259 
	sSn³tF¿gm’t
 {

145260 
	giCÞ
;

145261 
	giPos
;

145262 
u64
 
	gcov”ed
;

145263 
u64
 
	ghlmask
;

145270 
M©chInfo
 
	tM©chInfo
;

145271 
	sM©chInfo
 {

145272 
Fts3CursÜ
 *
	gpCursÜ
;

145273 
	gnCÞ
;

145274 
	gnPh¿£
;

145275 
sql™e3_št64
 
	gnDoc
;

145276 
u32
 *
	gaM©chšfo
;

145286 
SŒBufãr
 
	tSŒBufãr
;

145287 
	sSŒBufãr
 {

145288 *
	gz
;

145289 
	gn
;

145290 
	gnAÎoc
;

145314 
ás3G‘D–Pos™iÚ
(**
µ
, *
piPos
){

145315 
	giV®
;

145316 *
	gµ
 +ð
ás3G‘V¬št32
(*
µ
, &
iV®
);

145317 *
	gpiPos
 +ð(
iV®
-2);

145323 
ás3Ex´I‹¿‹2
(

145324 
Fts3Ex´
 *
pEx´
,

145325 *
piPh¿£
,

145326 (*
x
)(
Fts3Ex´
*,,*),

145327 *
pCtx


145329 
	grc
;

145330 
	geTy³
 = 
pEx´
->
eTy³
;

145332 ifÐ
	geTy³
!=
FTSQUERY_PHRASE
 ){

145333 
as£¹
Ð
pEx´
->
pLeá
 &&…Ex´->
pRight
 );

145334 
	grc
 = 
ás3Ex´I‹¿‹2
(
pEx´
->
pLeá
, 
piPh¿£
, 
x
, 
pCtx
);

145335 ifÐ
	grc
==
SQLITE_OK
 && 
eTy³
!=
FTSQUERY_NOT
 ){

145336 
rc
 = 
ás3Ex´I‹¿‹2
(
pEx´
->
pRight
, 
piPh¿£
, 
x
, 
pCtx
);

145339 
	grc
 = 
x
(
pEx´
, *
piPh¿£
, 
pCtx
);

145340 (*
	gpiPh¿£
)++;

145342  
	grc
;

145355 
ás3Ex´I‹¿‹
(

145356 
Fts3Ex´
 *
pEx´
,

145357 (*
x
)(
Fts3Ex´
*,,*),

145358 *
pCtx


145360 
	giPh¿£
 = 0;

145361  
ás3Ex´I‹¿‹2
(
pEx´
, &
iPh¿£
, 
x
, 
pCtx
);

145369 
ás3Ex´LßdDoþi¡sCb
(
Fts3Ex´
 *
pEx´
, 
iPh¿£
, *
ùx
){

145370 
	grc
 = 
SQLITE_OK
;

145371 
Fts3Ph¿£
 *
	gpPh¿£
 = 
pEx´
->
pPh¿£
;

145372 
LßdDoþi¡Ctx
 *
	gp
 = (LßdDoþi¡Ctx *)
ùx
;

145374 
UNUSED_PARAMETER
(
iPh¿£
);

145376 
	gp
->
	gnPh¿£
++;

145377 
	gp
->
	gnTok’
 +ð
pPh¿£
->
nTok’
;

145379  
	grc
;

145392 
ás3Ex´LßdDoþi¡s
(

145393 
Fts3CursÜ
 *
pC¤
,

145394 *
²Ph¿£
,

145395 *
²Tok’


145397 
	grc
;

145398 
LßdDoþi¡Ctx
 
	gsCtx
 = {0,0,0};

145399 
	gsCtx
.
	gpC¤
 = 
pC¤
;

145400 
	grc
 = 
ás3Ex´I‹¿‹
(
pC¤
->
pEx´
, 
ás3Ex´LßdDoþi¡sCb
, (*)&
sCtx
);

145401 ifÐ
	g²Ph¿£
 ) *²Ph¿£ = 
sCtx
.
nPh¿£
;

145402 ifÐ
	g²Tok’
 ) *²Tok’ = 
sCtx
.
nTok’
;

145403  
	grc
;

145406 
ás3Ex´Ph¿£CouÁCb
(
Fts3Ex´
 *
pEx´
, 
iPh¿£
, *
ùx
){

145407 (*(*)
	gùx
)++;

145408 
UNUSED_PARAMETER
(
pEx´
);

145409 
UNUSED_PARAMETER
(
iPh¿£
);

145410  
	gSQLITE_OK
;

145412 
ás3Ex´Ph¿£CouÁ
(
Fts3Ex´
 *
pEx´
){

145413 
	gnPh¿£
 = 0;

145414 ()
ás3Ex´I‹¿‹
(
pEx´
, 
ás3Ex´Ph¿£CouÁCb
, (*)&
nPh¿£
);

145415  
	gnPh¿£
;

145423 
ás3Sn³tAdvªû
(**
µI‹r
, *
piI‹r
, 
iNext
){

145424 *
	gpI‹r
 = *
µI‹r
;

145425 ifÐ
	gpI‹r
 ){

145426 
	giI‹r
 = *
piI‹r
;

145428  
	giI‹r
<
	giNext
 ){

145429 ifÐ0==(*
pI‹r
 & 0xFE) ){

145430 
iI‹r
 = -1;

145431 
	gpI‹r
 = 0;

145434 
ás3G‘D–Pos™iÚ
(&
pI‹r
, &
iI‹r
);

145437 *
	gpiI‹r
 = 
iI‹r
;

145438 *
	gµI‹r
 = 
pI‹r
;

145445 
ás3Sn³tNextCªdid©e
(
Sn³tI‹r
 *
pI‹r
){

145446 
	gi
;

145448 ifÐ
	gpI‹r
->
	giCu¼’t
<0 ){

145453 
	gpI‹r
->
	giCu¼’t
 = 0;

145458 
	gi
=0; i<
	gpI‹r
->
	gnPh¿£
; i++){

145459 
Sn³tPh¿£
 *
	gpPh¿£
 = &
pI‹r
->
aPh¿£
[
i
];

145460 
ás3Sn³tAdvªû
(&
pPh¿£
->
pH—d
, &pPh¿£->
iH—d
, 
pI‹r
->
nSn³t
);

145463 
	giS¹
;

145464 
	giEnd
 = 0x7FFFFFFF;

145466 
	gi
=0; i<
	gpI‹r
->
	gnPh¿£
; i++){

145467 
Sn³tPh¿£
 *
	gpPh¿£
 = &
pI‹r
->
aPh¿£
[
i
];

145468 ifÐ
	gpPh¿£
->
	gpH—d
 &&…Ph¿£->
	giH—d
<
	giEnd
 ){

145469 
	giEnd
 = 
pPh¿£
->
iH—d
;

145472 ifÐ
	giEnd
==0x7FFFFFFF ){

145476 
	gpI‹r
->
	giCu¼’t
 = 
iS¹
 = 
iEnd
 - 
pI‹r
->
nSn³t
 + 1;

145477 
	gi
=0; i<
	gpI‹r
->
	gnPh¿£
; i++){

145478 
Sn³tPh¿£
 *
	gpPh¿£
 = &
pI‹r
->
aPh¿£
[
i
];

145479 
ás3Sn³tAdvªû
(&
pPh¿£
->
pH—d
, &pPh¿£->
iH—d
, 
iEnd
+1);

145480 
ás3Sn³tAdvªû
(&
pPh¿£
->
pTaž
, &pPh¿£->
iTaž
, 
iS¹
);

145491 
ás3Sn³tD‘ažs
(

145492 
Sn³tI‹r
 *
pI‹r
,

145493 
u64
 
mCov”ed
,

145494 *
piTok’
,

145495 *
piScÜe
,

145496 
u64
 *
pmCov”
,

145497 
u64
 *
pmHighlight


145499 
	giS¹
 = 
pI‹r
->
iCu¼’t
;

145500 
	giScÜe
 = 0;

145501 
	gi
;

145502 
u64
 
	gmCov”
 = 0;

145503 
u64
 
	gmHighlight
 = 0;

145505 
	gi
=0; i<
	gpI‹r
->
	gnPh¿£
; i++){

145506 
Sn³tPh¿£
 *
	gpPh¿£
 = &
pI‹r
->
aPh¿£
[
i
];

145507 ifÐ
	gpPh¿£
->
	gpTaž
 ){

145508 *
	gpC¤
 = 
pPh¿£
->
pTaž
;

145509 
	giC¤
 = 
pPh¿£
->
iTaž
;

145511  
	giC¤
<(
	giS¹
+
	gpI‹r
->
	gnSn³t
) ){

145512 
	gj
;

145513 
u64
 
	gmPh¿£
 = (u64)1 << 
i
;

145514 
u64
 
	gmPos
 = (u64)1 << (
iC¤
 - 
iS¹
);

145515 
as£¹
Ð
iC¤
>=
iS¹
 );

145516 ifÐ(
	gmCov”
|
	gmCov”ed
)&
	gmPh¿£
 ){

145517 
	giScÜe
++;

145519 
	giScÜe
 += 1000;

145521 
	gmCov”
 |ð
mPh¿£
;

145523 
	gj
=0; j<
	gpPh¿£
->
	gnTok’
; j++){

145524 
	gmHighlight
 |ð(
mPos
>>
j
);

145527 ifÐ0==(*
pC¤
 & 0x0FE) ) ;

145528 
ás3G‘D–Pos™iÚ
(&
pC¤
, &
iC¤
);

145534 *
	gpiTok’
 = 
iS¹
;

145535 *
	gpiScÜe
 = 
iScÜe
;

145536 *
	gpmCov”
 = 
mCov”
;

145537 *
	gpmHighlight
 = 
mHighlight
;

145544 
ás3Sn³tFšdPos™iÚs
(
Fts3Ex´
 *
pEx´
, 
iPh¿£
, *
ùx
){

145545 
Sn³tI‹r
 *
	gp
 = (Sn³tI‹¸*)
ùx
;

145546 
Sn³tPh¿£
 *
	gpPh¿£
 = &
p
->
aPh¿£
[
iPh¿£
];

145547 *
	gpC¤
;

145548 
	grc
;

145550 
	gpPh¿£
->
	gnTok’
 = 
pEx´
->
pPh¿£
->
nTok’
;

145551 
	grc
 = 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(
p
->
pC¤
, 
pEx´
,…->
iCÞ
, &pCsr);

145552 
as£¹
Ð
rc
==
SQLITE_OK
 || 
pC¤
==0 );

145553 ifÐ
	gpC¤
 ){

145554 
	giFœ¡
 = 0;

145555 
	gpPh¿£
->
	gpLi¡
 = 
pC¤
;

145556 
ás3G‘D–Pos™iÚ
(&
pC¤
, &
iFœ¡
);

145557 
as£¹
Ð
iFœ¡
>=0 );

145558 
	gpPh¿£
->
	gpH—d
 = 
pC¤
;

145559 
	gpPh¿£
->
	gpTaž
 = 
pC¤
;

145560 
	gpPh¿£
->
	giH—d
 = 
iFœ¡
;

145561 
	gpPh¿£
->
	giTaž
 = 
iFœ¡
;

145563 
as£¹
Ð
rc
!=
SQLITE_OK
 || (

145564 
pPh¿£
->
pLi¡
==0 &&…Ph¿£->
pH—d
==0 &&…Ph¿£->
pTaž
==0

145568  
	grc
;

145586 
ás3Be¡Sn³t
(

145587 
nSn³t
,

145588 
Fts3CursÜ
 *
pC¤
,

145589 
iCÞ
,

145590 
u64
 
mCov”ed
,

145591 
u64
 *
pmS“n
,

145592 
Sn³tF¿gm’t
 *
pF¿gm’t
,

145593 *
piScÜe


145595 
	grc
;

145596 
	gnLi¡
;

145597 
Sn³tI‹r
 
	gsI‹r
;

145598 
	gnBy‹
;

145599 
	giBe¡ScÜe
 = -1;

145600 
	gi
;

145602 
mem£t
(&
sI‹r
, 0, (sIter));

145607 
	grc
 = 
ás3Ex´LßdDoþi¡s
(
pC¤
, &
nLi¡
, 0);

145608 ifÐ
	grc
!=
SQLITE_OK
 ){

145609  
rc
;

145615 
	gnBy‹
 = (
Sn³tPh¿£
è* 
nLi¡
;

145616 
	gsI‹r
.
	gaPh¿£
 = (
Sn³tPh¿£
 *)
sql™e3_m®loc
(
nBy‹
);

145617 ifÐ!
	gsI‹r
.
	gaPh¿£
 ){

145618  
	gSQLITE_NOMEM
;

145620 
mem£t
(
sI‹r
.
aPh¿£
, 0, 
nBy‹
);

145625 
	gsI‹r
.
	gpC¤
 = 
pC¤
;

145626 
	gsI‹r
.
	giCÞ
 = 
iCÞ
;

145627 
	gsI‹r
.
	gnSn³t
 = 
nSn³t
;

145628 
	gsI‹r
.
	gnPh¿£
 = 
nLi¡
;

145629 
	gsI‹r
.
	giCu¼’t
 = -1;

145630 ()
ás3Ex´I‹¿‹
(
pC¤
->
pEx´
, 
ás3Sn³tFšdPos™iÚs
, (*)&
sI‹r
);

145633 
	gi
=0; i<
	gnLi¡
; i++){

145634 ifÐ
	gsI‹r
.
	gaPh¿£
[
i
].
	gpH—d
 ){

145635 *
	gpmS“n
 |ð(
u64
)1 << 
i
;

145642 
	gpF¿gm’t
->
	giCÞ
 = 
iCÞ
;

145643  !
ás3Sn³tNextCªdid©e
(&
sI‹r
) ){

145644 
	giPos
;

145645 
	giScÜe
;

145646 
u64
 
	gmCov”
;

145647 
u64
 
	gmHighlight
;

145648 
ás3Sn³tD‘ažs
(&
sI‹r
, 
mCov”ed
, &
iPos
, &
iScÜe
, &
mCov”
, &
mHighlight
);

145649 
as£¹
Ð
iScÜe
>=0 );

145650 ifÐ
	giScÜe
>
	giBe¡ScÜe
 ){

145651 
	gpF¿gm’t
->
	giPos
 = 
iPos
;

145652 
	gpF¿gm’t
->
	ghlmask
 = 
mHighlight
;

145653 
	gpF¿gm’t
->
	gcov”ed
 = 
mCov”
;

145654 
	giBe¡ScÜe
 = 
iScÜe
;

145658 
sql™e3_ä“
(
sI‹r
.
aPh¿£
);

145659 *
	gpiScÜe
 = 
iBe¡ScÜe
;

145660  
	gSQLITE_OK
;

145670 
ás3SŒšgAµ’d
(

145671 
SŒBufãr
 *
pSŒ
,

145672 cÚ¡ *
zAµ’d
,

145673 
nAµ’d


145675 ifÐ
	gnAµ’d
<0 ){

145676 
	gnAµ’d
 = ()
¡¾’
(
zAµ’d
);

145683 ifÐ
	gpSŒ
->
	gn
+
	gnAµ’d
+1>=
pSŒ
->
nAÎoc
 ){

145684 
nAÎoc
 = 
pSŒ
->nAÎoc+
nAµ’d
+100;

145685 *
	gzNew
 = 
sql™e3_»®loc
(
pSŒ
->
z
, 
nAÎoc
);

145686 ifÐ!
	gzNew
 ){

145687  
	gSQLITE_NOMEM
;

145689 
	gpSŒ
->
	gz
 = 
zNew
;

145690 
	gpSŒ
->
	gnAÎoc
 = 
nAÎoc
;

145692 
as£¹
Ð
pSŒ
->
z
!=0 && (pSŒ->
nAÎoc
 >ðpSŒ->
n
+
nAµ’d
+1) );

145695 
memýy
(&
pSŒ
->
z
[pSŒ->
n
], 
zAµ’d
, 
nAµ’d
);

145696 
	gpSŒ
->
	gn
 +ð
nAµ’d
;

145697 
	gpSŒ
->
	gz
[
pSŒ
->
n
] = '\0';

145699  
	gSQLITE_OK
;

145722 
ás3Sn³tShiá
(

145723 
Fts3TabË
 *
pTab
,

145724 
iLªgid
,

145725 
nSn³t
,

145726 cÚ¡ *
zDoc
,

145727 
nDoc
,

145728 *
piPos
,

145729 
u64
 *
pHlmask


145731 
u64
 
	ghlmask
 = *
pHlmask
;

145733 ifÐ
	ghlmask
 ){

145734 
	gnLeá
;

145735 
	gnRight
;

145736 
	gnDesœed
;

145738 
	gnLeá
=0; !(
	ghlmask
 & ((
	gu64
)1 <<‚Left));‚Left++);

145739 
	gnRight
=0; !(
	ghlmask
 & ((
	gu64
)1 << (
	gnSn³t
-1-nRight)));‚Right++);

145740 
	gnDesœed
 = (
nLeá
-
nRight
)/2;

145749 ifÐ
	gnDesœed
>0 ){

145750 
	gnShiá
;

145751 
	giCu¼’t
 = 0;

145752 
	grc
;

145753 
sql™e3_tok’iz”_moduË
 *
	gpMod
;

145754 
sql™e3_tok’iz”_cursÜ
 *
	gpC
;

145755 
	gpMod
 = (
sql™e3_tok’iz”_moduË
 *)
pTab
->
pTok’iz”
->
pModuË
;

145760 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pTab
->
pTok’iz”
, 
iLªgid
, 
zDoc
, 
nDoc
, &
pC
);

145761 ifÐ
	grc
!=
SQLITE_OK
 ){

145762  
rc
;

145764  
	grc
==
SQLITE_OK
 && 
iCu¼’t
<(
nSn³t
+
nDesœed
) ){

145765 cÚ¡ *
ZDUMMY
; 
	gDUMMY1
 = 0, 
	gDUMMY2
 = 0, 
	gDUMMY3
 = 0;

145766 
	grc
 = 
pMod
->
xNext
(
pC
, &
ZDUMMY
, &
DUMMY1
, &
DUMMY2
, &
DUMMY3
, &
iCu¼’t
);

145768 
	gpMod
->
xClo£
(
pC
);

145769 ifÐ
	grc
!=
SQLITE_OK
 && 
rc
!=
SQLITE_DONE
 ){ „c; }

145771 
	gnShiá
 = (
rc
==
SQLITE_DONE
)+
iCu¼’t
-
nSn³t
;

145772 
as£¹
Ð
nShiá
<=
nDesœed
 );

145773 ifÐ
	gnShiá
>0 ){

145774 *
	gpiPos
 +ð
nShiá
;

145775 *
	gpHlmask
 = 
hlmask
 >> 
nShiá
;

145779  
	gSQLITE_OK
;

145786 
ás3Sn³tText
(

145787 
Fts3CursÜ
 *
pC¤
,

145788 
Sn³tF¿gm’t
 *
pF¿gm’t
,

145789 
iF¿gm’t
,

145790 
isLa¡
,

145791 
nSn³t
,

145792 cÚ¡ *
zO³n
,

145793 cÚ¡ *
zClo£
,

145794 cÚ¡ *
zEÎsis
,

145795 
SŒBufãr
 *
pOut


145797 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

145798 
	grc
;

145799 cÚ¡ *
	gzDoc
;

145800 
	gnDoc
;

145801 
	giCu¼’t
 = 0;

145802 
	giEnd
 = 0;

145803 
	gisShiáDÚe
 = 0;

145804 
	giPos
 = 
pF¿gm’t
->
iPos
;

145805 
u64
 
	ghlmask
 = 
pF¿gm’t
->
hlmask
;

145806 
	giCÞ
 = 
pF¿gm’t
->
iCÞ
+1;

145807 
sql™e3_tok’iz”_moduË
 *
	gpMod
;

145808 
sql™e3_tok’iz”_cursÜ
 *
	gpC
;

145810 
	gzDoc
 = (cÚ¡ *)
sql™e3_cÞumn_‹xt
(
pC¤
->
pStmt
, 
iCÞ
);

145811 ifÐ
	gzDoc
==0 ){

145812 ifÐ
sql™e3_cÞumn_ty³
(
pC¤
->
pStmt
, 
iCÞ
)!=
SQLITE_NULL
 ){

145813  
SQLITE_NOMEM
;

145815  
	gSQLITE_OK
;

145817 
	gnDoc
 = 
sql™e3_cÞumn_by‹s
(
pC¤
->
pStmt
, 
iCÞ
);

145820 
	gpMod
 = (
sql™e3_tok’iz”_moduË
 *)
pTab
->
pTok’iz”
->
pModuË
;

145821 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pTab
->
pTok’iz”
, 
pC¤
->
iLªgid
, 
zDoc
,
nDoc
,&
pC
);

145822 ifÐ
	grc
!=
SQLITE_OK
 ){

145823  
rc
;

145826  
	grc
==
SQLITE_OK
 ){

145827 cÚ¡ *
ZDUMMY
;

145828 
	gDUMMY1
 = -1;

145829 
	giBegš
 = 0;

145830 
	giFš
 = 0;

145831 
	gisHighlight
 = 0;

145844 
	grc
 = 
pMod
->
xNext
(
pC
, &
ZDUMMY
, &
DUMMY1
, &
iBegš
, &
iFš
, &
iCu¼’t
);

145845 ifÐ
	grc
!=
SQLITE_OK
 ){

145846 ifÐ
rc
==
SQLITE_DONE
 ){

145851 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, &
zDoc
[
iEnd
], -1);

145855 ifÐ
	giCu¼’t
<
	giPos
 ){ ; }

145857 ifÐ!
	gisShiáDÚe
 ){

145858 
	gn
 = 
nDoc
 - 
iBegš
;

145859 
	grc
 = 
ás3Sn³tShiá
(

145860 
pTab
, 
pC¤
->
iLªgid
, 
nSn³t
, &
zDoc
[
iBegš
], 
n
, &
iPos
, &
hlmask


145862 
	gisShiáDÚe
 = 1;

145868 ifÐ
	grc
==
SQLITE_OK
 && (
iPos
>0 || 
iF¿gm’t
>0) ){

145869 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, 
zEÎsis
, -1);

145871 ifÐ
	grc
!=
SQLITE_OK
 || 
iCu¼’t
<
iPos
 ) ;

145874 ifÐ
	giCu¼’t
>=(
iPos
+
nSn³t
) ){

145875 ifÐ
isLa¡
 ){

145876 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, 
zEÎsis
, -1);

145882 
	gisHighlight
 = (
hlmask
 & ((
u64
)1 << (
iCu¼’t
-
iPos
)))!=0;

145884 ifÐ
	giCu¼’t
>
	giPos
 ) 
	grc
 = 
ás3SŒšgAµ’d
(
pOut
, &
zDoc
[
iEnd
], 
iBegš
-iEnd);

145885 ifÐ
	grc
==
SQLITE_OK
 && 
isHighlight
 ) 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, 
zO³n
, -1);

145886 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, &
zDoc
[
iBegš
], 
iFš
-iBegin);

145887 ifÐ
	grc
==
SQLITE_OK
 && 
isHighlight
 ) 
rc
 = 
ás3SŒšgAµ’d
(
pOut
, 
zClo£
, -1);

145889 
	giEnd
 = 
iFš
;

145892 
	gpMod
->
xClo£
(
pC
);

145893  
	grc
;

145910 
ás3CÞumÆi¡CouÁ
(**
µCÞli¡
){

145911 *
	gpEnd
 = *
µCÞli¡
;

145912 
	gc
 = 0;

145913 
	gnEÁry
 = 0;

145916  0xFE & (*
	gpEnd
 | 
	gc
) ){

145917 
	gc
 = *
pEnd
++ & 0x80;

145918 ifÐ!
	gc
 ) 
	gnEÁry
++;

145921 *
	gµCÞli¡
 = 
pEnd
;

145922  
	gnEÁry
;

145952 
ás3Ex´Glob®H™sCb
(

145953 
Fts3Ex´
 *
pEx´
,

145954 
iPh¿£
,

145955 *
pCtx


145957 
M©chInfo
 *
	gp
 = (M©chInfØ*)
pCtx
;

145958  
sql™e3Fts3Ev®Ph¿£Sts
(

145959 
p
->
pCursÜ
, 
pEx´
, &p->
aM©chšfo
[3*
iPh¿£
*p->
nCÞ
]

145968 
ás3Ex´LoÿlH™sCb
(

145969 
Fts3Ex´
 *
pEx´
,

145970 
iPh¿£
,

145971 *
pCtx


145973 
	grc
 = 
SQLITE_OK
;

145974 
M©chInfo
 *
	gp
 = (M©chInfØ*)
pCtx
;

145975 
	giS¹
 = 
iPh¿£
 * 
p
->
nCÞ
 * 3;

145976 
	gi
;

145978 
	gi
=0; i<
	gp
->
	gnCÞ
 && 
	grc
==
SQLITE_OK
; i++){

145979 *
	gpC¤
;

145980 
	grc
 = 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(
p
->
pCursÜ
, 
pEx´
, 
i
, &
pC¤
);

145981 ifÐ
	gpC¤
 ){

145982 
	gp
->
	gaM©chšfo
[
iS¹
+
i
*3] = 
ás3CÞumÆi¡CouÁ
(&
pC¤
);

145984 
	gp
->
	gaM©chšfo
[
iS¹
+
i
*3] = 0;

145988  
	grc
;

145991 
ás3M©chšfoCheck
(

145992 
Fts3TabË
 *
pTab
,

145993 
cArg
,

145994 **
pzE¼


145996 ifÐ(
	gcArg
==
FTS3_MATCHINFO_NPHRASE
)

145997 || (
cArg
==
FTS3_MATCHINFO_NCOL
)

145998 || (
cArg
==
FTS3_MATCHINFO_NDOC
 && 
pTab
->
bFts4
)

145999 || (
cArg
==
FTS3_MATCHINFO_AVGLENGTH
 && 
pTab
->
bFts4
)

146000 || (
cArg
==
FTS3_MATCHINFO_LENGTH
 && 
pTab
->
bHasDocsize
)

146001 || (
cArg
==
FTS3_MATCHINFO_LCS
)

146002 || (
cArg
==
FTS3_MATCHINFO_HITS
)

146004  
SQLITE_OK
;

146006 *
	gpzE¼
 = 
sql™e3_m´štf
("uÄecognized m©chšfØ»que¡: %c", 
cArg
);

146007  
	gSQLITE_ERROR
;

146010 
ás3M©chšfoSize
(
M©chInfo
 *
pInfo
, 
cArg
){

146011 
	gnV®
;

146013  
	gcArg
 ){

146014 
	gFTS3_MATCHINFO_NDOC
:

146015 
FTS3_MATCHINFO_NPHRASE
:

146016 
FTS3_MATCHINFO_NCOL
:

146017 
nV®
 = 1;

146020 
	gFTS3_MATCHINFO_AVGLENGTH
:

146021 
FTS3_MATCHINFO_LENGTH
:

146022 
FTS3_MATCHINFO_LCS
:

146023 
nV®
 = 
pInfo
->
nCÞ
;

146027 
as£¹
Ð
cArg
==
FTS3_MATCHINFO_HITS
 );

146028 
	gnV®
 = 
pInfo
->
nCÞ
 *…Info->
nPh¿£
 * 3;

146032  
	gnV®
;

146035 
ás3M©chšfoS–eùDoùÙ®
(

146036 
Fts3TabË
 *
pTab
,

146037 
sql™e3_¡mt
 **
µStmt
,

146038 
sql™e3_št64
 *
²Doc
,

146039 cÚ¡ **
·L’


146041 
sql™e3_¡mt
 *
	gpStmt
;

146042 cÚ¡ *
	ga
;

146043 
sql™e3_št64
 
	gnDoc
;

146045 ifÐ!*
	gµStmt
 ){

146046 
	grc
 = 
sql™e3Fts3S–eùDoùÙ®
(
pTab
, 
µStmt
);

146047 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

146049 
	gpStmt
 = *
µStmt
;

146050 
as£¹
Ð
sql™e3_d©a_couÁ
(
pStmt
)==1 );

146052 
	ga
 = 
sql™e3_cÞumn_blob
(
pStmt
, 0);

146053 
	ga
 +ð
sql™e3Fts3G‘V¬št
(
a
, &
nDoc
);

146054 ifÐ
	gnDoc
==0 )  
FTS_CORRUPT_VTAB
;

146055 *
	g²Doc
 = (
u32
)
nDoc
;

146057 ifÐ
	g·L’
 ) *·L’ = 
a
;

146058  
	gSQLITE_OK
;

146067 
LcsI‹¿tÜ
 
	tLcsI‹¿tÜ
;

146068 
	sLcsI‹¿tÜ
 {

146069 
Fts3Ex´
 *
	gpEx´
;

146070 
	giPosOff£t
;

146071 *
	gpR—d
;

146072 
	giPos
;

146079 
	#LCS_ITERATOR_FINISHED
 0x7FFFFFFF;

	)

146081 
ás3M©chšfoLcsCb
(

146082 
Fts3Ex´
 *
pEx´
,

146083 
iPh¿£
,

146084 *
pCtx


146086 
LcsI‹¿tÜ
 *
	gaI‹r
 = (LcsI‹¿tÜ *)
pCtx
;

146087 
	gaI‹r
[
iPh¿£
].
	gpEx´
 = 
pEx´
;

146088  
	gSQLITE_OK
;

146096 
ás3LcsI‹¿tÜAdvªû
(
LcsI‹¿tÜ
 *
pI‹r
){

146097 *
	gpR—d
 = 
pI‹r
->
pR—d
;

146098 
sql™e3_št64
 
	giR—d
;

146099 
	grc
 = 0;

146101 
	gpR—d
 +ð
sql™e3Fts3G‘V¬št
(
pR—d
, &
iR—d
);

146102 ifÐ
	giR—d
==0 || 
iR—d
==1 ){

146103 
pR—d
 = 0;

146104 
	grc
 = 1;

146106 
	gpI‹r
->
	giPos
 +ð()(
iR—d
-2);

146109 
	gpI‹r
->
	gpR—d
 = 
pR—d
;

146110  
	grc
;

146124 
ás3M©chšfoLcs
(
Fts3CursÜ
 *
pC¤
, 
M©chInfo
 *
pInfo
){

146125 
LcsI‹¿tÜ
 *
	gaI‹r
;

146126 
	gi
;

146127 
	giCÞ
;

146128 
	gnTok’
 = 0;

146133 
	gaI‹r
 = 
sql™e3_m®loc
((
LcsI‹¿tÜ
è* 
pC¤
->
nPh¿£
);

146134 ifÐ!
	gaI‹r
 )  
	gSQLITE_NOMEM
;

146135 
mem£t
(
aI‹r
, 0, (
LcsI‹¿tÜ
è* 
pC¤
->
nPh¿£
);

146136 ()
ás3Ex´I‹¿‹
(
pC¤
->
pEx´
, 
ás3M©chšfoLcsCb
, (*)
aI‹r
);

146138 
	gi
=0; i<
	gpInfo
->
	gnPh¿£
; i++){

146139 
LcsI‹¿tÜ
 *
	gpI‹r
 = &
aI‹r
[
i
];

146140 
	gnTok’
 -ð
pI‹r
->
pEx´
->
pPh¿£
->
nTok’
;

146141 
	gpI‹r
->
	giPosOff£t
 = 
nTok’
;

146144 
	giCÞ
=0; iCÞ<
	gpInfo
->
	gnCÞ
; iCol++){

146145 
	gnLcs
 = 0;

146146 
	gnLive
 = 0;

146148 
	gi
=0; i<
	gpInfo
->
	gnPh¿£
; i++){

146149 
	grc
;

146150 
LcsI‹¿tÜ
 *
	gpIt
 = &
aI‹r
[
i
];

146151 
	grc
 = 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(
pC¤
, 
pIt
->
pEx´
, 
iCÞ
, &pIt->
pR—d
);

146152 ifÐ
	grc
!=
SQLITE_OK
 )  
rc
;

146153 ifÐ
	gpIt
->
	gpR—d
 ){

146154 
	gpIt
->
	giPos
 = 
pIt
->
iPosOff£t
;

146155 
ás3LcsI‹¿tÜAdvªû
(&
aI‹r
[
i
]);

146156 
	gnLive
++;

146160  
	gnLive
>0 ){

146161 
LcsI‹¿tÜ
 *
	gpAdv
 = 0;

146162 
	gnThisLcs
 = 0;

146164 
	gi
=0; i<
	gpInfo
->
	gnPh¿£
; i++){

146165 
LcsI‹¿tÜ
 *
	gpI‹r
 = &
aI‹r
[
i
];

146166 ifÐ
	gpI‹r
->
	gpR—d
==0 ){

146168 
nThisLcs
 = 0;

146170 ifÐ
	gpAdv
==0 || 
pI‹r
->
iPos
<
pAdv
->iPos ){

146171 
pAdv
 = 
pI‹r
;

146173 ifÐ
	gnThisLcs
==0 || 
pI‹r
->
iPos
==pIter[-1].iPos ){

146174 
nThisLcs
++;

146176 
	gnThisLcs
 = 1;

146178 ifÐ
	gnThisLcs
>
	gnLcs
 )‚Lc ð
nThisLcs
;

146181 ifÐ
ás3LcsI‹¿tÜAdvªû
(
pAdv
èè
	gnLive
--;

146184 
	gpInfo
->
	gaM©chšfo
[
iCÞ
] = 
nLcs
;

146187 
sql™e3_ä“
(
aI‹r
);

146188  
	gSQLITE_OK
;

146208 
ás3M©chšfoV®ues
(

146209 
Fts3CursÜ
 *
pC¤
,

146210 
bGlob®
,

146211 
M©chInfo
 *
pInfo
,

146212 cÚ¡ *
zArg


146214 
	grc
 = 
SQLITE_OK
;

146215 
	gi
;

146216 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

146217 
sql™e3_¡mt
 *
	gpS–eù
 = 0;

146219 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
zArg
[
i
]; i++){

146221  
	gzArg
[
i
] ){

146222 
	gFTS3_MATCHINFO_NPHRASE
:

146223 ifÐ
bGlob®
 ) 
pInfo
->
aM©chšfo
[0] =…Info->
nPh¿£
;

146226 
	gFTS3_MATCHINFO_NCOL
:

146227 ifÐ
bGlob®
 ) 
pInfo
->
aM©chšfo
[0] =…Info->
nCÞ
;

146230 
	gFTS3_MATCHINFO_NDOC
:

146231 ifÐ
bGlob®
 ){

146232 
sql™e3_št64
 
nDoc
 = 0;

146233 
	grc
 = 
ás3M©chšfoS–eùDoùÙ®
(
pTab
, &
pS–eù
, &
nDoc
, 0);

146234 
	gpInfo
->
	gaM©chšfo
[0] = (
u32
)
nDoc
;

146238 
	gFTS3_MATCHINFO_AVGLENGTH
:

146239 ifÐ
bGlob®
 ){

146240 
sql™e3_št64
 
nDoc
;

146241 cÚ¡ *
	ga
;

146243 
	grc
 = 
ás3M©chšfoS–eùDoùÙ®
(
pTab
, &
pS–eù
, &
nDoc
, &
a
);

146244 ifÐ
	grc
==
SQLITE_OK
 ){

146245 
iCÞ
;

146246 
	giCÞ
=0; iCÞ<
	gpInfo
->
	gnCÞ
; iCol++){

146247 
u32
 
	giV®
;

146248 
sql™e3_št64
 
	gnTok’
;

146249 
	ga
 +ð
sql™e3Fts3G‘V¬št
(
a
, &
nTok’
);

146250 
	giV®
 = (
u32
)(((u32)(
nTok’
&0xffffffff)+
nDoc
/2)/nDoc);

146251 
	gpInfo
->
	gaM©chšfo
[
iCÞ
] = 
iV®
;

146257 
	gFTS3_MATCHINFO_LENGTH
: {

146258 
sql™e3_¡mt
 *
pS–eùDocsize
 = 0;

146259 
	grc
 = 
sql™e3Fts3S–eùDocsize
(
pTab
, 
pC¤
->
iP»vId
, &
pS–eùDocsize
);

146260 ifÐ
	grc
==
SQLITE_OK
 ){

146261 
iCÞ
;

146262 cÚ¡ *
	ga
 = 
sql™e3_cÞumn_blob
(
pS–eùDocsize
, 0);

146263 
	giCÞ
=0; iCÞ<
	gpInfo
->
	gnCÞ
; iCol++){

146264 
sql™e3_št64
 
	gnTok’
;

146265 
	ga
 +ð
sql™e3Fts3G‘V¬št
(
a
, &
nTok’
);

146266 
	gpInfo
->
	gaM©chšfo
[
iCÞ
] = (
u32
)
nTok’
;

146269 
sql™e3_»£t
(
pS–eùDocsize
);

146273 
	gFTS3_MATCHINFO_LCS
:

146274 
rc
 = 
ás3Ex´LßdDoþi¡s
(
pC¤
, 0, 0);

146275 ifÐ
	grc
==
SQLITE_OK
 ){

146276 
rc
 = 
ás3M©chšfoLcs
(
pC¤
, 
pInfo
);

146281 
Fts3Ex´
 *
pEx´
;

146282 
as£¹
Ð
zArg
[
i
]==
FTS3_MATCHINFO_HITS
 );

146283 
	gpEx´
 = 
pC¤
->
pEx´
;

146284 
	grc
 = 
ás3Ex´LßdDoþi¡s
(
pC¤
, 0, 0);

146285 ifÐ
	grc
!=
SQLITE_OK
 ) ;

146286 ifÐ
	gbGlob®
 ){

146287 ifÐ
	gpC¤
->
	gpDeã¼ed
 ){

146288 
	grc
 = 
ás3M©chšfoS–eùDoùÙ®
(
pTab
, &
pS–eù
, &
pInfo
->
nDoc
, 0);

146289 ifÐ
	grc
!=
SQLITE_OK
 ) ;

146291 
	grc
 = 
ás3Ex´I‹¿‹
(
pEx´
, 
ás3Ex´Glob®H™sCb
,(*)
pInfo
);

146292 ifÐ
	grc
!=
SQLITE_OK
 ) ;

146294 ()
ás3Ex´I‹¿‹
(
pEx´
, 
ás3Ex´LoÿlH™sCb
,(*)
pInfo
);

146299 
	gpInfo
->
	gaM©chšfo
 +ð
ás3M©chšfoSize
(
pInfo
, 
zArg
[
i
]);

146302 
sql™e3_»£t
(
pS–eù
);

146303  
	grc
;

146311 
ás3G‘M©chšfo
(

146312 
Fts3CursÜ
 *
pC¤
,

146313 cÚ¡ *
zArg


146315 
M©chInfo
 
	gsInfo
;

146316 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

146317 
	grc
 = 
SQLITE_OK
;

146318 
	gbGlob®
 = 0;

146320 
mem£t
(&
sInfo
, 0, (
M©chInfo
));

146321 
	gsInfo
.
	gpCursÜ
 = 
pC¤
;

146322 
	gsInfo
.
	gnCÞ
 = 
pTab
->
nCÞumn
;

146327 ifÐ
	gpC¤
->
	gzM©chšfo
 && 
¡rcmp
(
pC¤
->
zM©chšfo
, 
zArg
) ){

146328 
as£¹
Ð
pC¤
->
aM©chšfo
 );

146329 
sql™e3_ä“
(
pC¤
->
aM©chšfo
);

146330 
	gpC¤
->
	gzM©chšfo
 = 0;

146331 
	gpC¤
->
	gaM©chšfo
 = 0;

146339 ifÐ
	gpC¤
->
	gaM©chšfo
==0 ){

146340 
nM©chšfo
 = 0;

146341 
	gnArg
;

146342 
	gi
;

146345 
	gpC¤
->
	gnPh¿£
 = 
ás3Ex´Ph¿£CouÁ
(
pC¤
->
pEx´
);

146346 
	gsInfo
.
	gnPh¿£
 = 
pC¤
->
nPh¿£
;

146349 
	gi
=0; 
	gzArg
[
i
]; i++){

146350 
	gnM©chšfo
 +ð
ás3M©chšfoSize
(&
sInfo
, 
zArg
[
i
]);

146354 
	gnArg
 = ()
¡¾’
(
zArg
);

146355 
	gpC¤
->
	gaM©chšfo
 = (
u32
 *)
sql™e3_m®loc
((u32)*
nM©chšfo
 + 
nArg
 + 1);

146356 ifÐ!
	gpC¤
->
	gaM©chšfo
 )  
	gSQLITE_NOMEM
;

146358 
	gpC¤
->
	gzM©chšfo
 = (*)&
pC¤
->
aM©chšfo
[
nM©chšfo
];

146359 
	gpC¤
->
	gnM©chšfo
 = 
nM©chšfo
;

146360 
memýy
(
pC¤
->
zM©chšfo
, 
zArg
, 
nArg
+1);

146361 
mem£t
(
pC¤
->
aM©chšfo
, 0, (
u32
)*
nM©chšfo
);

146362 
	gpC¤
->
	gisM©chšfoN“ded
 = 1;

146363 
	gbGlob®
 = 1;

146366 
	gsInfo
.
	gaM©chšfo
 = 
pC¤
->
aM©chšfo
;

146367 
	gsInfo
.
	gnPh¿£
 = 
pC¤
->
nPh¿£
;

146368 ifÐ
	gpC¤
->
	gisM©chšfoN“ded
 ){

146369 
	grc
 = 
ás3M©chšfoV®ues
(
pC¤
, 
bGlob®
, &
sInfo
, 
zArg
);

146370 
	gpC¤
->
	gisM©chšfoN“ded
 = 0;

146373  
	grc
;

146379 
SQLITE_PRIVATE
 
sql™e3Fts3Sn³t
(

146380 
sql™e3_cÚ‹xt
 *
pCtx
,

146381 
Fts3CursÜ
 *
pC¤
,

146382 cÚ¡ *
zS¹
,

146383 cÚ¡ *
zEnd
,

146384 cÚ¡ *
zEÎsis
,

146385 
iCÞ
,

146386 
nTok’


146388 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

146389 
	grc
 = 
SQLITE_OK
;

146390 
	gi
;

146391 
SŒBufãr
 
	g»s
 = {0, 0, 0};

146401 
	gnSn³t
 = 0;

146402 
Sn³tF¿gm’t
 
	gaSn³t
[4];

146403 
	gnFTok’
 = -1;

146405 ifÐ!
	gpC¤
->
	gpEx´
 ){

146406 
sql™e3_»suÉ_‹xt
(
pCtx
, "", 0, 
SQLITE_STATIC
);

146410 
	gnSn³t
=1; 1;‚Snippet++){

146412 
	giSn
;

146413 
u64
 
	gmCov”ed
 = 0;

146414 
u64
 
	gmS“n
 = 0;

146416 ifÐ
	gnTok’
>=0 ){

146417 
nFTok’
 = (
nTok’
+
nSn³t
-1) /‚Snippet;

146419 
	gnFTok’
 = -1 * 
nTok’
;

146422 
	giSn
=0; iSn<
	gnSn³t
; iSnip++){

146423 
	giBe¡ScÜe
 = -1;

146424 
	giR—d
;

146425 
Sn³tF¿gm’t
 *
	gpF¿gm’t
 = &
aSn³t
[
iSn
];

146427 
mem£t
(
pF¿gm’t
, 0, (*pFragment));

146433 
	giR—d
=0; iR—d<
	gpTab
->
	gnCÞumn
; iRead++){

146434 
Sn³tF¿gm’t
 
	gsF
 = {0, 0, 0, 0};

146435 
	giS
;

146436 ifÐ
	giCÞ
>=0 && 
iR—d
!=
iCÞ
 ) ;

146439 
	grc
 = 
ás3Be¡Sn³t
(
nFTok’
, 
pC¤
, 
iR—d
, 
mCov”ed
, &
mS“n
, &
sF
, &
iS
);

146440 ifÐ
	grc
!=
SQLITE_OK
 ){

146441 
¢³t_out
;

146443 ifÐ
	giS
>
	giBe¡ScÜe
 ){

146444 *
	gpF¿gm’t
 = 
sF
;

146445 
	giBe¡ScÜe
 = 
iS
;

146449 
	gmCov”ed
 |ð
pF¿gm’t
->
cov”ed
;

146455 
as£¹
Ð(
mCov”ed
&
mS“n
)==mCovered );

146456 ifÐ
	gmS“n
==
mCov”ed
 || 
nSn³t
==
SizeofA¼ay
(
aSn³t
) ) ;

146459 
as£¹
Ð
nFTok’
>0 );

146461 
	gi
=0; i<
	gnSn³t
 && 
	grc
==
SQLITE_OK
; i++){

146462 
	grc
 = 
ás3Sn³tText
(
pC¤
, &
aSn³t
[
i
],

146463 
i
, (i==
nSn³t
-1), 
nFTok’
, 
zS¹
, 
zEnd
, 
zEÎsis
, &
»s


146467 
	g¢³t_out
:

146468 
sql™e3Fts3Segm’tsClo£
(
pTab
);

146469 ifÐ
	grc
!=
SQLITE_OK
 ){

146470 
sql™e3_»suÉ_”rÜ_code
(
pCtx
, 
rc
);

146471 
sql™e3_ä“
(
»s
.
z
);

146473 
sql™e3_»suÉ_‹xt
(
pCtx
, 
»s
.
z
, -1, 
sql™e3_ä“
);

146478 
T”mOff£t
 
	tT”mOff£t
;

146479 
T”mOff£tCtx
 
	tT”mOff£tCtx
;

146481 
	sT”mOff£t
 {

146482 *
	gpLi¡
;

146483 
	giPos
;

146484 
	giOff
;

146487 
	sT”mOff£tCtx
 {

146488 
Fts3CursÜ
 *
	gpC¤
;

146489 
	giCÞ
;

146490 
	giT”m
;

146491 
sql™e3_št64
 
	giDocid
;

146492 
T”mOff£t
 *
	gaT”m
;

146498 
ás3Ex´T”mOff£tIn™
(
Fts3Ex´
 *
pEx´
, 
iPh¿£
, *
ùx
){

146499 
T”mOff£tCtx
 *
	gp
 = (T”mOff£tCtx *)
ùx
;

146500 
	gnT”m
;

146501 
	giT”m
;

146502 *
	gpLi¡
;

146503 
	giPos
 = 0;

146504 
	grc
;

146506 
UNUSED_PARAMETER
(
iPh¿£
);

146507 
	grc
 = 
sql™e3Fts3Ev®Ph¿£Po¦i¡
(
p
->
pC¤
, 
pEx´
,…->
iCÞ
, &
pLi¡
);

146508 
	gnT”m
 = 
pEx´
->
pPh¿£
->
nTok’
;

146509 ifÐ
	gpLi¡
 ){

146510 
ás3G‘D–Pos™iÚ
(&
pLi¡
, &
iPos
);

146511 
as£¹
Ð
iPos
>=0 );

146514 
	giT”m
=0; iT”m<
	gnT”m
; iTerm++){

146515 
T”mOff£t
 *
	gpT
 = &
p
->
aT”m
[p->
iT”m
++];

146516 
	gpT
->
	giOff
 = 
nT”m
-
iT”m
-1;

146517 
	gpT
->
	gpLi¡
 = 
pLi¡
;

146518 
	gpT
->
	giPos
 = 
iPos
;

146521  
	grc
;

146527 
SQLITE_PRIVATE
 
sql™e3Fts3Off£ts
(

146528 
sql™e3_cÚ‹xt
 *
pCtx
,

146529 
Fts3CursÜ
 *
pC¤


146531 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

146532 
sql™e3_tok’iz”_moduË
 cÚ¡ *
	gpMod
 = 
pTab
->
pTok’iz”
->
pModuË
;

146533 
	grc
;

146534 
	gnTok’
;

146535 
	giCÞ
;

146536 
SŒBufãr
 
	g»s
 = {0, 0, 0};

146537 
T”mOff£tCtx
 
	gsCtx
;

146539 ifÐ!
	gpC¤
->
	gpEx´
 ){

146540 
sql™e3_»suÉ_‹xt
(
pCtx
, "", 0, 
SQLITE_STATIC
);

146544 
mem£t
(&
sCtx
, 0, (sCtx));

146545 
as£¹
Ð
pC¤
->
isRequœeS“k
==0 );

146548 
	grc
 = 
ás3Ex´LßdDoþi¡s
(
pC¤
, 0, &
nTok’
);

146549 ifÐ
	grc
!=
SQLITE_OK
 ) 
off£ts_out
;

146552 
	gsCtx
.
	gaT”m
 = (
T”mOff£t
 *)
sql™e3_m®loc
((T”mOff£t)*
nTok’
);

146553 ifÐ0==
sCtx
.
aT”m
 ){

146554 
rc
 = 
SQLITE_NOMEM
;

146555 
	goff£ts_out
;

146557 
	gsCtx
.
	giDocid
 = 
pC¤
->
iP»vId
;

146558 
	gsCtx
.
	gpC¤
 = 
pC¤
;

146563 
	giCÞ
=0; iCÞ<
	gpTab
->
	gnCÞumn
; iCol++){

146564 
sql™e3_tok’iz”_cursÜ
 *
	gpC
;

146565 cÚ¡ *
	gZDUMMY
;

146566 
	gNDUMMY
 = 0;

146567 
	giS¹
 = 0;

146568 
	giEnd
 = 0;

146569 
	giCu¼’t
 = 0;

146570 cÚ¡ *
	gzDoc
;

146571 
	gnDoc
;

146577 
	gsCtx
.
	giCÞ
 = 
iCÞ
;

146578 
	gsCtx
.
	giT”m
 = 0;

146579 ()
ás3Ex´I‹¿‹
(
pC¤
->
pEx´
, 
ás3Ex´T”mOff£tIn™
, (*)&
sCtx
);

146587 
	gzDoc
 = (cÚ¡ *)
sql™e3_cÞumn_‹xt
(
pC¤
->
pStmt
, 
iCÞ
+1);

146588 
	gnDoc
 = 
sql™e3_cÞumn_by‹s
(
pC¤
->
pStmt
, 
iCÞ
+1);

146589 ifÐ
	gzDoc
==0 ){

146590 ifÐ
sql™e3_cÞumn_ty³
(
pC¤
->
pStmt
, 
iCÞ
+1)==
SQLITE_NULL
 ){

146593 
	grc
 = 
SQLITE_NOMEM
;

146594 
	goff£ts_out
;

146598 
	grc
 = 
sql™e3Fts3O³nTok’iz”
(
pTab
->
pTok’iz”
, 
pC¤
->
iLªgid
,

146599 
zDoc
, 
nDoc
, &
pC


146601 ifÐ
	grc
!=
SQLITE_OK
 ) 
off£ts_out
;

146603 
	grc
 = 
pMod
->
xNext
(
pC
, &
ZDUMMY
, &
NDUMMY
, &
iS¹
, &
iEnd
, &
iCu¼’t
);

146604  
	grc
==
SQLITE_OK
 ){

146605 
i
;

146606 
	giMšPos
 = 0x7FFFFFFF;

146607 
T”mOff£t
 *
	gpT”m
 = 0;

146609 
	gi
=0; i<
	gnTok’
; i++){

146610 
T”mOff£t
 *
	gpT
 = &
sCtx
.
aT”m
[
i
];

146611 ifÐ
	gpT
->
	gpLi¡
 && (pT->
	giPos
-pT->
	giOff
)<
	giMšPos
 ){

146612 
	giMšPos
 = 
pT
->
iPos
-pT->
iOff
;

146613 
	gpT”m
 = 
pT
;

146617 ifÐ!
	gpT”m
 ){

146619 
	grc
 = 
SQLITE_DONE
;

146621 
as£¹
Ð
iCu¼’t
<=
iMšPos
 );

146622 ifÐ0==(0xFE&*
pT”m
->
pLi¡
) ){

146623 
pT”m
->
pLi¡
 = 0;

146625 
ás3G‘D–Pos™iÚ
(&
pT”m
->
pLi¡
, &pT”m->
iPos
);

146627  
	grc
==
SQLITE_OK
 && 
iCu¼’t
<
iMšPos
 ){

146628 
rc
 = 
pMod
->
xNext
(
pC
, &
ZDUMMY
, &
NDUMMY
, &
iS¹
, &
iEnd
, &
iCu¼’t
);

146630 ifÐ
	grc
==
SQLITE_OK
 ){

146631 
aBufãr
[64];

146632 
sql™e3_¢´štf
((
aBufãr
),‡Buffer,

146633 "%d %d %d %d ", 
iCÞ
, 
pT”m
-
sCtx
.
aT”m
, 
iS¹
, 
iEnd
-iStart

146635 
	grc
 = 
ás3SŒšgAµ’d
(&
»s
, 
aBufãr
, -1);

146636 }ifÐ
	grc
==
SQLITE_DONE
 && 
pTab
->
zCÚ‹ÁTbl
==0 ){

146637 
rc
 = 
FTS_CORRUPT_VTAB
;

146641 ifÐ
	grc
==
SQLITE_DONE
 ){

146642 
rc
 = 
SQLITE_OK
;

146645 
	gpMod
->
xClo£
(
pC
);

146646 ifÐ
	grc
!=
SQLITE_OK
 ) 
off£ts_out
;

146649 
	goff£ts_out
:

146650 
sql™e3_ä“
(
sCtx
.
aT”m
);

146651 
as£¹
Ð
rc
!=
SQLITE_DONE
 );

146652 
sql™e3Fts3Segm’tsClo£
(
pTab
);

146653 ifÐ
	grc
!=
SQLITE_OK
 ){

146654 
sql™e3_»suÉ_”rÜ_code
(
pCtx
, 
rc
);

146655 
sql™e3_ä“
(
»s
.
z
);

146657 
sql™e3_»suÉ_‹xt
(
pCtx
, 
»s
.
z
,„es.
n
-1, 
sql™e3_ä“
);

146665 
SQLITE_PRIVATE
 
sql™e3Fts3M©chšfo
(

146666 
sql™e3_cÚ‹xt
 *
pCÚ‹xt
,

146667 
Fts3CursÜ
 *
pC¤
,

146668 cÚ¡ *
zArg


146670 
Fts3TabË
 *
	gpTab
 = (Fts3TabË *)
pC¤
->
ba£
.
pVb
;

146671 
	grc
;

146672 
	gi
;

146673 cÚ¡ *
	gzFÜm©
;

146675 ifÐ
	gzArg
 ){

146676 
	gi
=0; 
	gzArg
[
i
]; i++){

146677 *
	gzE¼
 = 0;

146678 ifÐ
ás3M©chšfoCheck
(
pTab
, 
zArg
[
i
], &
zE¼
) ){

146679 
sql™e3_»suÉ_”rÜ
(
pCÚ‹xt
, 
zE¼
, -1);

146680 
sql™e3_ä“
(
zE¼
);

146684 
	gzFÜm©
 = 
zArg
;

146686 
	gzFÜm©
 = 
FTS3_MATCHINFO_DEFAULT
;

146689 ifÐ!
	gpC¤
->
	gpEx´
 ){

146690 
sql™e3_»suÉ_blob
(
pCÚ‹xt
, "", 0, 
SQLITE_STATIC
);

146695 
	grc
 = 
ás3G‘M©chšfo
(
pC¤
, 
zFÜm©
);

146696 
sql™e3Fts3Segm’tsClo£
(
pTab
);

146698 ifÐ
	grc
!=
SQLITE_OK
 ){

146699 
sql™e3_»suÉ_”rÜ_code
(
pCÚ‹xt
, 
rc
);

146701 
	gn
 = 
pC¤
->
nM©chšfo
 * (
u32
);

146702 
sql™e3_»suÉ_blob
(
pCÚ‹xt
, 
pC¤
->
aM©chšfo
, 
n
, 
SQLITE_TRANSIENT
);

146725 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


146727 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

146740 #iâdeà
SQLITE_AMALGAMATION


146742 cÚ¡ 
	gsql™e3Utf8T¿ns1
[] = {

146753 
	#READ_UTF8
(
zIn
, 
zT”m
, 
c
) \

146754 
c
 = *(
zIn
++); \

146755 ifÐ
c
>=0xc0 ){ \

146756 
c
 = 
sql™e3Utf8T¿ns1
[c-0xc0]; \

146757  
zIn
!=
zT”m
 && (*zIn & 0xc0)==0x80 ){ \

146758 
c
 = (c<<6è+ (0x3à& *(
zIn
++)); \

146760 ifÐ
c
<0x80 \

146761 || (
c
&0xFFFFF800)==0xD800 \

146762 || (
c
&0xFFFFFFFE)==0xFFFE ){ c = 0xFFFD; } \

146763 }

	)

146765 
	#WRITE_UTF8
(
zOut
, 
c
) { \

146766 ifÐ
c
<0x00080 ){ \

146767 *
zOut
++ = (
u8
)(
c
&0xFF); \

146769 ifÐ
c
<0x00800 ){ \

146770 *
zOut
++ = 0xC0 + (
u8
)((
c
>>6)&0x1F); \

146771 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

146773 ifÐ
c
<0x10000 ){ \

146774 *
zOut
++ = 0xE0 + (
u8
)((
c
>>12)&0x0F); \

146775 *
zOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F); \

146776 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

146778 *
zOut
++ = 0xF0 + (
u8
)((
c
>>18) & 0x07); \

146779 *
zOut
++ = 0x80 + (
u8
)((
c
>>12) & 0x3F); \

146780 *
zOut
++ = 0x80 + (
u8
)((
c
>>6) & 0x3F); \

146781 *
zOut
++ = 0x80 + (
u8
)(
c
 & 0x3F); \

146783 }

	)

146787 
unicode_tok’iz”
 
	tunicode_tok’iz”
;

146788 
unicode_cursÜ
 
	tunicode_cursÜ
;

146790 
	sunicode_tok’iz”
 {

146791 
sql™e3_tok’iz”
 
	gba£
;

146792 
	gbRemoveDŸü™ic
;

146793 
	gnExû±iÚ
;

146794 *
	gaiExû±iÚ
;

146797 
	sunicode_cursÜ
 {

146798 
sql™e3_tok’iz”_cursÜ
 
	gba£
;

146799 cÚ¡ *
	gaIÅut
;

146800 
	gnIÅut
;

146801 
	giOff
;

146802 
	giTok’
;

146803 *
	gzTok’
;

146804 
	gnAÎoc
;

146811 
unicodeDe¡roy
(
sql™e3_tok’iz”
 *
pTok’iz”
){

146812 ifÐ
	gpTok’iz”
 ){

146813 
unicode_tok’iz”
 *
	gp
 = (unicode_tok’iz” *)
pTok’iz”
;

146814 
sql™e3_ä“
(
p
->
aiExû±iÚ
);

146815 
sql™e3_ä“
(
p
);

146817  
	gSQLITE_OK
;

146838 
unicodeAddExû±iÚs
(

146839 
unicode_tok’iz”
 *
p
,

146840 
bAÊum
,

146841 cÚ¡ *
zIn
,

146842 
nIn


146844 cÚ¡ *
	gz
 = (cÚ¡ *)
zIn
;

146845 cÚ¡ *
	gzT”m
 = &
z
[
nIn
];

146846 
	giCode
;

146847 
	gnEÁry
 = 0;

146849 
as£¹
Ð
bAÊum
==0 || bAlnum==1 );

146851  
	gz
<
	gzT”m
 ){

146852 
READ_UTF8
(
z
, 
zT”m
, 
iCode
);

146853 
as£¹
Ð(
sql™e3FtsUnicodeI§Êum
(
iCode
) & 0xFFFFFFFE)==0 );

146854 ifÐ
sql™e3FtsUnicodeI§Êum
(
iCode
)!=
bAÊum


146855 && 
sql™e3FtsUnicodeIsdŸü™ic
(
iCode
)==0

146857 
nEÁry
++;

146861 ifÐ
	gnEÁry
 ){

146862 *
	gaNew
;

146863 
	gnNew
;

146865 
	gaNew
 = 
sql™e3_»®loc
(
p
->
aiExû±iÚ
, (p->
nExû±iÚ
+
nEÁry
)*());

146866 ifÐ
	gaNew
==0 )  
SQLITE_NOMEM
;

146867 
	gnNew
 = 
p
->
nExû±iÚ
;

146869 
	gz
 = (cÚ¡ *)
zIn
;

146870  
	gz
<
	gzT”m
 ){

146871 
READ_UTF8
(
z
, 
zT”m
, 
iCode
);

146872 ifÐ
sql™e3FtsUnicodeI§Êum
(
iCode
)!=
bAÊum


146873 && 
sql™e3FtsUnicodeIsdŸü™ic
(
iCode
)==0

146875 
i
, 
j
;

146876 
	gi
=0; i<
	gnNew
 && 
	gaNew
[
i
]<
	giCode
; i++);

146877 
	gj
=
nNew
; j>
	gi
; j--è
	gaNew
[
j
] = 
aNew
[j-1];

146878 
	gaNew
[
i
] = 
iCode
;

146879 
	gnNew
++;

146882 
	gp
->
	gaiExû±iÚ
 = 
aNew
;

146883 
	gp
->
	gnExû±iÚ
 = 
nNew
;

146886  
	gSQLITE_OK
;

146892 
unicodeIsExû±iÚ
(
unicode_tok’iz”
 *
p
, 
iCode
){

146893 ifÐ
	gp
->
	gnExû±iÚ
>0 ){

146894 *
	ga
 = 
p
->
aiExû±iÚ
;

146895 
	giLo
 = 0;

146896 
	giHi
 = 
p
->
nExû±iÚ
-1;

146898  
	giHi
>=
iLo
 ){

146899 
iTe¡
 = (
iHi
 + 
iLo
) / 2;

146900 ifÐ
	giCode
==
a
[
iTe¡
] ){

146902 }ifÐ
	giCode
>
	ga
[
iTe¡
] ){

146903 
	giLo
 = 
iTe¡
+1;

146905 
	giHi
 = 
iTe¡
-1;

146917 
unicodeIsAÊum
(
unicode_tok’iz”
 *
p
, 
iCode
){

146918 
as£¹
Ð(
sql™e3FtsUnicodeI§Êum
(
iCode
) & 0xFFFFFFFE)==0 );

146919  
sql™e3FtsUnicodeI§Êum
(
iCode
è^ 
unicodeIsExû±iÚ
(
p
, iCode);

146925 
unicodeC»©e
(

146926 
nArg
,

146927 cÚ¡ * cÚ¡ *
azArg
,

146928 
sql™e3_tok’iz”
 **
µ


146930 
unicode_tok’iz”
 *
	gpNew
;

146931 
	gi
;

146932 
	grc
 = 
SQLITE_OK
;

146934 
	gpNew
 = (
unicode_tok’iz”
 *è
sql™e3_m®loc
((unicode_tokenizer));

146935 ifÐ
	gpNew
==
NULL
 )  
SQLITE_NOMEM
;

146936 
mem£t
(
pNew
, 0, (
unicode_tok’iz”
));

146937 
	gpNew
->
	gbRemoveDŸü™ic
 = 1;

146939 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<
nArg
; i++){

146940 cÚ¡ *
	gz
 = 
azArg
[
i
];

146941 
	gn
 = ()
¡¾’
(
z
);

146943 ifÐ
	gn
==19 && 
memcmp
("»move_dŸü™ics=1", 
z
, 19)==0 ){

146944 
pNew
->
bRemoveDŸü™ic
 = 1;

146946 ifÐ
	gn
==19 && 
memcmp
("»move_dŸü™ics=0", 
z
, 19)==0 ){

146947 
pNew
->
bRemoveDŸü™ic
 = 0;

146949 ifÐ
	gn
>=11 && 
memcmp
("tok’ch¬s=", 
z
, 11)==0 ){

146950 
rc
 = 
unicodeAddExû±iÚs
(
pNew
, 1, &
z
[11], 
n
-11);

146952 ifÐ
	gn
>=11 && 
memcmp
("£·¿tÜs=", 
z
, 11)==0 ){

146953 
rc
 = 
unicodeAddExû±iÚs
(
pNew
, 0, &
z
[11], 
n
-11);

146957 
	grc
 = 
SQLITE_ERROR
;

146961 ifÐ
	grc
!=
SQLITE_OK
 ){

146962 
unicodeDe¡roy
((
sql™e3_tok’iz”
 *)
pNew
);

146963 
	gpNew
 = 0;

146965 *
	gµ
 = (
sql™e3_tok’iz”
 *)
pNew
;

146966  
	grc
;

146975 
unicodeO³n
(

146976 
sql™e3_tok’iz”
 *
p
,

146977 cÚ¡ *
aIÅut
,

146978 
nIÅut
,

146979 
sql™e3_tok’iz”_cursÜ
 **
µ


146981 
unicode_cursÜ
 *
	gpC¤
;

146983 
	gpC¤
 = (
unicode_cursÜ
 *)
sql™e3_m®loc
((unicode_cursor));

146984 ifÐ
	gpC¤
==0 ){

146985  
SQLITE_NOMEM
;

146987 
mem£t
(
pC¤
, 0, (
unicode_cursÜ
));

146989 
	gpC¤
->
	gaIÅut
 = (cÚ¡ *)
aIÅut
;

146990 ifÐ
	gaIÅut
==0 ){

146991 
pC¤
->
nIÅut
 = 0;

146992 }ifÐ
	gnIÅut
<0 ){

146993 
	gpC¤
->
	gnIÅut
 = ()
¡¾’
(
aIÅut
);

146995 
	gpC¤
->
	gnIÅut
 = 
nIÅut
;

146998 *
	gµ
 = &
pC¤
->
ba£
;

146999 
UNUSED_PARAMETER
(
p
);

147000  
	gSQLITE_OK
;

147007 
unicodeClo£
(
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
){

147008 
unicode_cursÜ
 *
	gpC¤
 = (unicode_cursÜ *è
pCursÜ
;

147009 
sql™e3_ä“
(
pC¤
->
zTok’
);

147010 
sql™e3_ä“
(
pC¤
);

147011  
	gSQLITE_OK
;

147018 
unicodeNext
(

147019 
sql™e3_tok’iz”_cursÜ
 *
pC
,

147020 cÚ¡ **
·Tok’
,

147021 *
²Tok’
,

147022 *
piS¹
,

147023 *
piEnd
,

147024 *
piPos


147026 
unicode_cursÜ
 *
	gpC¤
 = (unicode_cursÜ *)
pC
;

147027 
unicode_tok’iz”
 *
	gp
 = ((unicode_tok’iz” *)
pC¤
->
ba£
.
pTok’iz”
);

147028 
	giCode
 = 0;

147029 *
	gzOut
;

147030 cÚ¡ *
	gz
 = &
pC¤
->
aIÅut
[pC¤->
iOff
];

147031 cÚ¡ *
	gzS¹
 = 
z
;

147032 cÚ¡ *
	gzEnd
;

147033 cÚ¡ *
	gzT”m
 = &
pC¤
->
aIÅut
[pC¤->
nIÅut
];

147038  
	gz
<
	gzT”m
 ){

147039 
READ_UTF8
(
z
, 
zT”m
, 
iCode
);

147040 ifÐ
unicodeIsAÊum
(
p
, 
iCode
) ) ;

147041 
	gzS¹
 = 
z
;

147043 ifÐ
	gzS¹
>=
zT”m
 )  
SQLITE_DONE
;

147045 
	gzOut
 = 
pC¤
->
zTok’
;

147047 
	giOut
;

147050 ifÐ(
	gzOut
-
	gpC¤
->
	gzTok’
)>=(
pC¤
->
nAÎoc
-4) ){

147051 *
zNew
 = 
sql™e3_»®loc
(
pC¤
->
zTok’
,…C¤->
nAÎoc
+64);

147052 ifÐ!
	gzNew
 )  
	gSQLITE_NOMEM
;

147053 
	gzOut
 = &
zNew
[
zOut
 - 
pC¤
->
zTok’
];

147054 
	gpC¤
->
	gzTok’
 = 
zNew
;

147055 
	gpC¤
->
	gnAÎoc
 += 64;

147059 
	gzEnd
 = 
z
;

147060 
	giOut
 = 
sql™e3FtsUnicodeFÞd
(
iCode
, 
p
->
bRemoveDŸü™ic
);

147061 ifÐ
	giOut
 ){

147062 
WRITE_UTF8
(
zOut
, 
iOut
);

147066 ifÐ
	gz
>=
zT”m
 ) ;

147067 
READ_UTF8
(
z
, 
zT”m
, 
iCode
);

147068 } 
unicodeIsAÊum
(
p
, 
iCode
)

147069 || 
sql™e3FtsUnicodeIsdŸü™ic
(
iCode
)

147073 
	gpC¤
->
	giOff
 = ()(
z
 - 
pC¤
->
aIÅut
);

147074 *
	g·Tok’
 = 
pC¤
->
zTok’
;

147075 *
	g²Tok’
 = ()(
zOut
 - 
pC¤
->
zTok’
);

147076 *
	gpiS¹
 = ()(
zS¹
 - 
pC¤
->
aIÅut
);

147077 *
	gpiEnd
 = ()(
zEnd
 - 
pC¤
->
aIÅut
);

147078 *
	gpiPos
 = 
pC¤
->
iTok’
++;

147079  
	gSQLITE_OK
;

147086 
SQLITE_PRIVATE
 
sql™e3Fts3UnicodeTok’iz”
(
sql™e3_tok’iz”_moduË
 cÚ¡ **
µModuË
){

147087 cÚ¡ 
sql™e3_tok’iz”_moduË
 
	gmoduË
 = {

147089 
unicodeC»©e
,

147090 
unicodeDe¡roy
,

147091 
unicodeO³n
,

147092 
unicodeClo£
,

147093 
unicodeNext
,

147096 *
	gµModuË
 = &
moduË
;

147121 #iâdeà
SQLITE_DISABLE_FTS3_UNICODE


147122 #ià
defšed
(
SQLITE_ENABLE_FTS3
è|| defšed(
SQLITE_ENABLE_FTS4
)

147133 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeI§Êum
(
c
){

147145 cÚ¡ 
	gaEÁry
[] = {

147229 cÚ¡ 
	gaAscii
[4] = {

147233 ifÐ
	gc
<128 ){

147234  ( (
	gaAscii
[
c
 >> 5] & (1 << (
	gc
 & 0x001F)))==0 );

147235 }ifÐ
	gc
<(1<<22) ){

147236 
	gkey
 = ((()
c
)<<10) | 0x000003FF;

147237 
	giRes
 = 0;

147238 
	giHi
 = (
aEÁry
)/(aEntry[0]) - 1;

147239 
	giLo
 = 0;

147240  
	giHi
>=
iLo
 ){

147241 
iTe¡
 = (
iHi
 + 
iLo
) / 2;

147242 ifÐ
	gkey
 >ð
aEÁry
[
iTe¡
] ){

147243 
iRes
 = 
iTe¡
;

147244 
	giLo
 = 
iTe¡
+1;

147246 
	giHi
 = 
iTe¡
-1;

147249 
as£¹
Ð
aEÁry
[0]<
key
 );

147250 
as£¹
Ð
key
>=
aEÁry
[
iRes
] );

147251  ((()
	gc
è>ð((
aEÁry
[
iRes
]>>10) + (aEntry[iRes]&0x3FF)));

147265 
»move_dŸü™ic
(
c
){

147266 
	gaDŸ
[] = {

147281 
	gaCh¬
[] = {

147293 
	gkey
 = ((()
c
)<<3) | 0x00000007;

147294 
	giRes
 = 0;

147295 
	giHi
 = (
aDŸ
)/(aDia[0]) - 1;

147296 
	giLo
 = 0;

147297  
	giHi
>=
iLo
 ){

147298 
iTe¡
 = (
iHi
 + 
iLo
) / 2;

147299 ifÐ
	gkey
 >ð
aDŸ
[
iTe¡
] ){

147300 
iRes
 = 
iTe¡
;

147301 
	giLo
 = 
iTe¡
+1;

147303 
	giHi
 = 
iTe¡
-1;

147306 
as£¹
Ð
key
>=
aDŸ
[
iRes
] );

147307  ((
	gc
 > (
	gaDŸ
[
iRes
]>>3è+ (aDŸ[iRes]&0x07)è? c : ()
aCh¬
[iRes]);

147315 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeIsdŸü™ic
(
c
){

147316 
	gmask0
 = 0x08029FDF;

147317 
	gmask1
 = 0x000361F8;

147318 ifÐ
	gc
<768 || c>817 )  0;

147319  (
	gc
 < 768+32) ?

147320 (
	gmask0
 & (1 << (
	gc
-768))) :

147321 (
mask1
 & (1 << (
c
-768-32)));

147334 
SQLITE_PRIVATE
 
sql™e3FtsUnicodeFÞd
(
c
, 
bRemoveDŸü™ic
){

147352 cÚ¡ 
	sTabËEÁry
 {

147353 
	giCode
;

147354 
	gæags
;

147355 
	gnRªge
;

147356 } 
	gaEÁry
[] = {

147413 cÚ¡ 
	gaiOff
[] = {

147426 
	g»t
 = 
c
;

147428 
as£¹
Ð
c
>=0 );

147429 
as£¹
( ()==2 && ()==1 );

147431 ifÐ
	gc
<128 ){

147432 ifÐ
	gc
>='A' && 
c
<='Z' ) 
»t
 = c + ('a' - 'A');

147433 }ifÐ
	gc
<65536 ){

147434 
	giHi
 = (
aEÁry
)/(aEntry[0]) - 1;

147435 
	giLo
 = 0;

147436 
	giRes
 = -1;

147438  
	giHi
>=
iLo
 ){

147439 
iTe¡
 = (
iHi
 + 
iLo
) / 2;

147440 
	gcmp
 = (
c
 - 
aEÁry
[
iTe¡
].
iCode
);

147441 ifÐ
	gcmp
>=0 ){

147442 
iRes
 = 
iTe¡
;

147443 
	giLo
 = 
iTe¡
+1;

147445 
	giHi
 = 
iTe¡
-1;

147448 
as£¹
Ð
iRes
<0 || 
c
>=
aEÁry
[iRes].
iCode
 );

147450 ifÐ
	giRes
>=0 ){

147451 cÚ¡ 
TabËEÁry
 *
p
 = &
aEÁry
[
iRes
];

147452 ifÐ
	gc
<(
	gp
->
	giCode
 +…->
	gnRªge
è&& 0==(0x01 & 
p
->
æags
 & (p->
iCode
 ^ 
c
)) ){

147453 
»t
 = (
c
 + (
aiOff
[
p
->
æags
>>1])) & 0x0000FFFF;

147454 
as£¹
Ð
»t
>0 );

147458 ifÐ
	gbRemoveDŸü™ic
 ) 
	g»t
 = 
»move_dŸü™ic
(
»t
);

147461 ifÐ
	gc
>=66560 && 
c
<66600 ){

147462 
»t
 = 
c
 + 40;

147465  
	g»t
;

147526 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_RTREE
)

147528 #iâdeà
SQLITE_CORE


147529 
	gSQLITE_EXTENSION_INIT1


147537 #iâdeà
SQLITE_AMALGAMATION


147538 
	~"sql™e3¹»e.h
"

147539 
sql™e3_št64
 
	ti64
;

147540 
	tu8
;

147541 
	tu16
;

147542 
	tu32
;

147547 #iâdeà
UNUSED_PARAMETER


147548 
	#UNUSED_PARAMETER
(
x
è()(x)

	)

147551 
RŒ“
 
	tRŒ“
;

147552 
RŒ“CursÜ
 
	tRŒ“CursÜ
;

147553 
RŒ“Node
 
	tRŒ“Node
;

147554 
RŒ“C–l
 
	tRŒ“C–l
;

147555 
RŒ“CÚ¡¿št
 
	tRŒ“CÚ¡¿št
;

147556 
RŒ“M©chArg
 
	tRŒ“M©chArg
;

147557 
RŒ“GeomC®lback
 
	tRŒ“GeomC®lback
;

147558 
RŒ“CoÜd
 
	tRŒ“CoÜd
;

147559 
RŒ“S—rchPošt
 
	tRŒ“S—rchPošt
;

147562 
	#RTREE_MAX_DIMENSIONS
 5

	)

147568 
	#HASHSIZE
 97

	)

147577 
	#RTREE_DEFAULT_ROWEST
 1048576

	)

147578 
	#RTREE_MIN_ROWEST
 100

	)

147583 
	sRŒ“
 {

147584 
sql™e3_vb
 
	gba£
;

147585 
sql™e3
 *
	gdb
;

147586 
	giNodeSize
;

147587 
u8
 
	gnDim
;

147588 
u8
 
	geCoÜdTy³
;

147589 
u8
 
	gnBy‹sP”C–l
;

147590 
	giD•th
;

147591 *
	gzDb
;

147592 *
	gzName
;

147593 
	gnBusy
;

147594 
i64
 
	gnRowE¡
;

147601 
RŒ“Node
 *
	gpD–‘ed
;

147602 
	giReš£¹Height
;

147605 
sql™e3_¡mt
 *
	gpR—dNode
;

147606 
sql™e3_¡mt
 *
	gpWr™eNode
;

147607 
sql™e3_¡mt
 *
	gpD–‘eNode
;

147610 
sql™e3_¡mt
 *
	gpR—dRowid
;

147611 
sql™e3_¡mt
 *
	gpWr™eRowid
;

147612 
sql™e3_¡mt
 *
	gpD–‘eRowid
;

147615 
sql™e3_¡mt
 *
	gpR—dP¬’t
;

147616 
sql™e3_¡mt
 *
	gpWr™eP¬’t
;

147617 
sql™e3_¡mt
 *
	gpD–‘eP¬’t
;

147619 
RŒ“Node
 *
	gaHash
[
HASHSIZE
];

147623 
	#RTREE_COORD_REAL32
 0

	)

147624 
	#RTREE_COORD_INT32
 1

	)

147631 #ifdeà
SQLITE_RTREE_INT_ONLY


147632 
sql™e3_št64
 
	tRŒ“DV®ue
;

147633 
	tRŒ“V®ue
;

147634 
	#RTREE_ZERO
 0

	)

147636 
	tRŒ“DV®ue
;

147637 
	tRŒ“V®ue
;

147638 
	#RTREE_ZERO
 0.0

	)

147650 
	sRŒ“S—rchPošt
 {

147651 
RŒ“DV®ue
 
	grScÜe
;

147652 
sql™e3_št64
 
	gid
;

147653 
u8
 
	giLev–
;

147654 
u8
 
	geW™hš
;

147655 
u8
 
	giC–l
;

147667 
	#RTREE_MINCELLS
(
p
è(((Õ)->
iNodeSize
-4)/Õ)->
nBy‹sP”C–l
)/3)

	)

147668 
	#RTREE_REINSERT
(
p
è
	`RTREE_MINCELLS
Õ)

	)

147669 
	#RTREE_MAXCELLS
 51

	)

147678 
	#RTREE_MAX_DEPTH
 40

	)

147686 
	#RTREE_CACHE_SZ
 5

	)

147691 
	sRŒ“CursÜ
 {

147692 
sql™e3_vb_cursÜ
 
	gba£
;

147693 
u8
 
	g©EOF
;

147694 
u8
 
	gbPošt
;

147695 
	giSŒ©egy
;

147696 
	gnCÚ¡¿št
;

147697 
RŒ“CÚ¡¿št
 *
	gaCÚ¡¿št
;

147698 
	gnPoštAÎoc
;

147699 
	gnPošt
;

147700 
	gmxLev–
;

147701 
RŒ“S—rchPošt
 *
	gaPošt
;

147702 
RŒ“S—rchPošt
 
	gsPošt
;

147703 
RŒ“Node
 *
	gaNode
[
RTREE_CACHE_SZ
];

147704 
u32
 
	gªQueue
[
RTREE_MAX_DEPTH
+1];

147708 
	#RTREE_OF_CURSOR
(
X
è((
RŒ“
*)((X)->
ba£
.
pVb
))

	)

147714 
	uRŒ“CoÜd
 {

147715 
RŒ“V®ue
 
	gf
;

147716 
	gi
;

147717 
u32
 
	gu
;

147726 #ifdeà
SQLITE_RTREE_INT_ONLY


147727 
	#DCOORD
(
coÜd
è((
RŒ“DV®ue
)coÜd.
i
)

	)

147729 
	#DCOORD
(
coÜd
) ( \

147730 (
pRŒ“
->
eCoÜdTy³
==
RTREE_COORD_REAL32
) ? \

147731 (()
coÜd
.
f
) : \

147732 (()
coÜd
.
i
) \

147733 )

	)

147739 
	sRŒ“CÚ¡¿št
 {

147740 
	giCoÜd
;

147741 
	gÝ
;

147743 
RŒ“DV®ue
 
	grV®ue
;

147744 (*
	gxGeom
)(
	gsql™e3_¹»e_geom‘ry
*,,
	gRŒ“DV®ue
*,*);

147745 (*
	gxQu”yFunc
)(
	gsql™e3_¹»e_qu”y_šfo
*);

147746 } 
	gu
;

147747 
sql™e3_¹»e_qu”y_šfo
 *
	gpInfo
;

147751 
	#RTREE_EQ
 0x41

	)

147752 
	#RTREE_LE
 0x42

	)

147753 
	#RTREE_LT
 0x43

	)

147754 
	#RTREE_GE
 0x44

	)

147755 
	#RTREE_GT
 0x45

	)

147756 
	#RTREE_MATCH
 0x46

	)

147757 
	#RTREE_QUERY
 0x47

	)

147763 
	sRŒ“Node
 {

147764 
RŒ“Node
 *
	gpP¬’t
;

147765 
i64
 
	giNode
;

147766 
	gnRef
;

147767 
	gisDœty
;

147768 
u8
 *
	gzD©a
;

147769 
RŒ“Node
 *
	gpNext
;

147773 
	#NCELL
(
pNode
è
	`»adIÁ16
(&ÕNode)->
zD©a
[2])

	)

147778 
	sRŒ“C–l
 {

147779 
i64
 
	giRowid
;

147780 
RŒ“CoÜd
 
	gaCoÜd
[
RTREE_MAX_DIMENSIONS
*2];

147798 
	sRŒ“GeomC®lback
 {

147799 (*
	gxGeom
)(
	gsql™e3_¹»e_geom‘ry
*, , 
	gRŒ“DV®ue
*, *);

147800 (*
	gxQu”yFunc
)(
	gsql™e3_¹»e_qu”y_šfo
*);

147801 (*
	gxDe¡ruùÜ
)(*);

147802 *
	gpCÚ‹xt
;

147811 
	#RTREE_GEOMETRY_MAGIC
 0x891245AB

	)

147819 
	sRŒ“M©chArg
 {

147820 
u32
 
	gmagic
;

147821 
RŒ“GeomC®lback
 
	gcb
;

147822 
	gnP¬am
;

147823 
RŒ“DV®ue
 
	gaP¬am
[1];

147826 #iâdeà
MAX


147827 
	#MAX
(
x
,
y
è((xè< (yè? (yè: (x))

	)

147829 #iâdeà
MIN


147830 
	#MIN
(
x
,
y
è((xè> (yè? (yè: (x))

	)

147837 
»adIÁ16
(
u8
 *
p
){

147838  (
	gp
[0]<<8) +…[1];

147840 
»adCoÜd
(
u8
 *
p
, 
RŒ“CoÜd
 *
pCoÜd
){

147841 
u32
 
	gi
 = (

147842 (((
u32
)
p
[0]) << 24) +

147843 (((
u32
)
p
[1]) << 16) +

147844 (((
u32
)
p
[2]) << 8) +

147845 (((
u32
)
p
[3]) << 0)

147847 *(
	gu32
 *)
	gpCoÜd
 = 
i
;

147849 
i64
 
»adIÁ64
(
u8
 *
p
){

147851 (((
	gi64
)
	gp
[0]) << 56) +

147852 (((
	gi64
)
	gp
[1]) << 48) +

147853 (((
	gi64
)
	gp
[2]) << 40) +

147854 (((
	gi64
)
	gp
[3]) << 32) +

147855 (((
	gi64
)
	gp
[4]) << 24) +

147856 (((
	gi64
)
	gp
[5]) << 16) +

147857 (((
	gi64
)
	gp
[6]) << 8) +

147858 (((
	gi64
)
	gp
[7]) << 0)

147867 
wr™eIÁ16
(
u8
 *
p
, 
i
){

147868 
	gp
[0] = (
i
>> 8)&0xFF;

147869 
	gp
[1] = (
i
>> 0)&0xFF;

147872 
wr™eCoÜd
(
u8
 *
p
, 
RŒ“CoÜd
 *
pCoÜd
){

147873 
u32
 
	gi
;

147874 
as£¹
Ð(
RŒ“CoÜd
)==4 );

147875 
as£¹
Ð(
u32
)==4 );

147876 
	gi
 = *(
u32
 *)
pCoÜd
;

147877 
	gp
[0] = (
i
>>24)&0xFF;

147878 
	gp
[1] = (
i
>>16)&0xFF;

147879 
	gp
[2] = (
i
>> 8)&0xFF;

147880 
	gp
[3] = (
i
>> 0)&0xFF;

147883 
wr™eIÁ64
(
u8
 *
p
, 
i64
 
i
){

147884 
	gp
[0] = (
i
>>56)&0xFF;

147885 
	gp
[1] = (
i
>>48)&0xFF;

147886 
	gp
[2] = (
i
>>40)&0xFF;

147887 
	gp
[3] = (
i
>>32)&0xFF;

147888 
	gp
[4] = (
i
>>24)&0xFF;

147889 
	gp
[5] = (
i
>>16)&0xFF;

147890 
	gp
[6] = (
i
>> 8)&0xFF;

147891 
	gp
[7] = (
i
>> 0)&0xFF;

147898 
nodeReã»nû
(
RŒ“Node
 *
p
){

147899 ifÐ
	gp
 ){

147900 
	gp
->
	gnRef
++;

147907 
nodeZ”o
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
p
){

147908 
mem£t
(&
p
->
zD©a
[2], 0, 
pRŒ“
->
iNodeSize
-2);

147909 
	gp
->
	gisDœty
 = 1;

147916 
nodeHash
(
i64
 
iNode
){

147917  
	giNode
 % 
	gHASHSIZE
;

147924 
RŒ“Node
 *
nodeHashLookup
(
RŒ“
 *
pRŒ“
, 
i64
 
iNode
){

147925 
RŒ“Node
 *
	gp
;

147926 
	gp
=
pRŒ“
->
aHash
[
nodeHash
(
iNode
)];… &&…->
	giNode
!=iNode;…=
p
->
pNext
);

147927  
	gp
;

147933 
nodeHashIn£¹
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

147934 
	giHash
;

147935 
as£¹
Ð
pNode
->
pNext
==0 );

147936 
	giHash
 = 
nodeHash
(
pNode
->
iNode
);

147937 
	gpNode
->
	gpNext
 = 
pRŒ“
->
aHash
[
iHash
];

147938 
	gpRŒ“
->
	gaHash
[
iHash
] = 
pNode
;

147944 
nodeHashD–‘e
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

147945 
RŒ“Node
 **
	gµ
;

147946 ifÐ
	gpNode
->
	giNode
!=0 ){

147947 
µ
 = &
pRŒ“
->
aHash
[
nodeHash
(
pNode
->
iNode
)];

147948  ; (*
	gµ
)!=
pNode
;…°ð&(*
µ
)->
pNext
){ 
as£¹
(*pp); }

147949 *
	gµ
 = 
pNode
->
pNext
;

147950 
	gpNode
->
	gpNext
 = 0;

147960 
RŒ“Node
 *
nodeNew
(
RŒ“
 *
pRŒ“
, RŒ“Nod*
pP¬’t
){

147961 
RŒ“Node
 *
	gpNode
;

147962 
	gpNode
 = (
RŒ“Node
 *)
sql™e3_m®loc
((RŒ“Nodeè+ 
pRŒ“
->
iNodeSize
);

147963 ifÐ
	gpNode
 ){

147964 
mem£t
(
pNode
, 0, (
RŒ“Node
è+ 
pRŒ“
->
iNodeSize
);

147965 
	gpNode
->
	gzD©a
 = (
u8
 *)&
pNode
[1];

147966 
	gpNode
->
	gnRef
 = 1;

147967 
	gpNode
->
	gpP¬’t
 = 
pP¬’t
;

147968 
	gpNode
->
	gisDœty
 = 1;

147969 
nodeReã»nû
(
pP¬’t
);

147971  
	gpNode
;

147977 
nodeAcquœe
(

147978 
RŒ“
 *
pRŒ“
,

147979 
i64
 
iNode
,

147980 
RŒ“Node
 *
pP¬’t
,

147981 
RŒ“Node
 **
µNode


147983 
	grc
;

147984 
	grc2
 = 
SQLITE_OK
;

147985 
RŒ“Node
 *
	gpNode
;

147990 ifÐ(
	gpNode
 = 
nodeHashLookup
(
pRŒ“
, 
iNode
)) ){

147991 
as£¹
Ð!
pP¬’t
 || !
pNode
->pParent ||…Node->pParent==pParent );

147992 ifÐ
	gpP¬’t
 && !
	gpNode
->pParent ){

147993 
nodeReã»nû
(
pP¬’t
);

147994 
	gpNode
->
	gpP¬’t
 = 
pP¬’t
;

147996 
	gpNode
->
	gnRef
++;

147997 *
	gµNode
 = 
pNode
;

147998  
	gSQLITE_OK
;

148001 
sql™e3_bšd_št64
(
pRŒ“
->
pR—dNode
, 1, 
iNode
);

148002 
	grc
 = 
sql™e3_¡•
(
pRŒ“
->
pR—dNode
);

148003 ifÐ
	grc
==
SQLITE_ROW
 ){

148004 cÚ¡ 
u8
 *
zBlob
 = 
sql™e3_cÞumn_blob
(
pRŒ“
->
pR—dNode
, 0);

148005 ifÐ
	gpRŒ“
->
	giNodeSize
==
sql™e3_cÞumn_by‹s
(
pRŒ“
->
pR—dNode
, 0) ){

148006 
	gpNode
 = (
RŒ“Node
 *)
sql™e3_m®loc
((RŒ“Node)+
pRŒ“
->
iNodeSize
);

148007 ifÐ!
	gpNode
 ){

148008 
	grc2
 = 
SQLITE_NOMEM
;

148010 
	gpNode
->
	gpP¬’t
 = 
pP¬’t
;

148011 
	gpNode
->
	gzD©a
 = (
u8
 *)&
pNode
[1];

148012 
	gpNode
->
	gnRef
 = 1;

148013 
	gpNode
->
	giNode
 = 
iNode
;

148014 
	gpNode
->
	gisDœty
 = 0;

148015 
	gpNode
->
	gpNext
 = 0;

148016 
memýy
(
pNode
->
zD©a
, 
zBlob
, 
pRŒ“
->
iNodeSize
);

148017 
nodeReã»nû
(
pP¬’t
);

148021 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pR—dNode
);

148022 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

148030 ifÐ
	gpNode
 && 
	giNode
==1 ){

148031 
pRŒ“
->
iD•th
 = 
»adIÁ16
(
pNode
->
zD©a
);

148032 ifÐ
	gpRŒ“
->
	giD•th
>
	gRTREE_MAX_DEPTH
 ){

148033 
	grc
 = 
SQLITE_CORRUPT_VTAB
;

148041 ifÐ
	gpNode
 && 
	grc
==
SQLITE_OK
 ){

148042 ifÐ
NCELL
(
pNode
)>((
pRŒ“
->
iNodeSize
-4)/pRŒ“->
nBy‹sP”C–l
) ){

148043 
rc
 = 
SQLITE_CORRUPT_VTAB
;

148047 ifÐ
	grc
==
SQLITE_OK
 ){

148048 ifÐ
pNode
!=0 ){

148049 
nodeHashIn£¹
(
pRŒ“
, 
pNode
);

148051 
	grc
 = 
SQLITE_CORRUPT_VTAB
;

148053 *
	gµNode
 = 
pNode
;

148055 
sql™e3_ä“
(
pNode
);

148056 *
	gµNode
 = 0;

148059  
	grc
;

148065 
nodeOv”wr™eC–l
(

148066 
RŒ“
 *
pRŒ“
,

148067 
RŒ“Node
 *
pNode
,

148068 
RŒ“C–l
 *
pC–l
,

148069 
iC–l


148071 
	gii
;

148072 
u8
 *
	gp
 = &
pNode
->
zD©a
[4 + 
pRŒ“
->
nBy‹sP”C–l
*
iC–l
];

148073 
	gp
 +ð
wr™eIÁ64
(
p
, 
pC–l
->
iRowid
);

148074 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii++){

148075 
	gp
 +ð
wr™eCoÜd
(
p
, &
pC–l
->
aCoÜd
[
ii
]);

148077 
	gpNode
->
	gisDœty
 = 1;

148083 
nodeD–‘eC–l
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
, 
iC–l
){

148084 
u8
 *
	gpD¡
 = &
pNode
->
zD©a
[4 + 
pRŒ“
->
nBy‹sP”C–l
*
iC–l
];

148085 
u8
 *
	gpSrc
 = &
pD¡
[
pRŒ“
->
nBy‹sP”C–l
];

148086 
	gnBy‹
 = (
NCELL
(
pNode
è- 
iC–l
 - 1è* 
pRŒ“
->
nBy‹sP”C–l
;

148087 
memmove
(
pD¡
, 
pSrc
, 
nBy‹
);

148088 
wr™eIÁ16
(&
pNode
->
zD©a
[2], 
NCELL
(pNode)-1);

148089 
	gpNode
->
	gisDœty
 = 1;

148098 
nodeIn£¹C–l
(

148099 
RŒ“
 *
pRŒ“
,

148100 
RŒ“Node
 *
pNode
,

148101 
RŒ“C–l
 *
pC–l


148103 
	gnC–l
;

148104 
	gnMaxC–l
;

148106 
	gnMaxC–l
 = (
pRŒ“
->
iNodeSize
-4)/pRŒ“->
nBy‹sP”C–l
;

148107 
	gnC–l
 = 
NCELL
(
pNode
);

148109 
as£¹
Ð
nC–l
<=
nMaxC–l
 );

148110 ifÐ
	gnC–l
<
	gnMaxC–l
 ){

148111 
nodeOv”wr™eC–l
(
pRŒ“
, 
pNode
, 
pC–l
, 
nC–l
);

148112 
wr™eIÁ16
(&
pNode
->
zD©a
[2], 
nC–l
+1);

148113 
	gpNode
->
	gisDœty
 = 1;

148116  (
	gnC–l
==
nMaxC–l
);

148122 
nodeWr™e
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

148123 
	grc
 = 
SQLITE_OK
;

148124 ifÐ
	gpNode
->
	gisDœty
 ){

148125 
sql™e3_¡mt
 *
	gp
 = 
pRŒ“
->
pWr™eNode
;

148126 ifÐ
	gpNode
->
	giNode
 ){

148127 
sql™e3_bšd_št64
(
p
, 1, 
pNode
->
iNode
);

148129 
sql™e3_bšd_nuÎ
(
p
, 1);

148131 
sql™e3_bšd_blob
(
p
, 2, 
pNode
->
zD©a
, 
pRŒ“
->
iNodeSize
, 
SQLITE_STATIC
);

148132 
sql™e3_¡•
(
p
);

148133 
	gpNode
->
	gisDœty
 = 0;

148134 
	grc
 = 
sql™e3_»£t
(
p
);

148135 ifÐ
	gpNode
->
	giNode
==0 && 
rc
==
SQLITE_OK
 ){

148136 
pNode
->
iNode
 = 
sql™e3_Ï¡_š£¹_rowid
(
pRŒ“
->
db
);

148137 
nodeHashIn£¹
(
pRŒ“
, 
pNode
);

148140  
	grc
;

148147 
nodeR–—£
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

148148 
	grc
 = 
SQLITE_OK
;

148149 ifÐ
	gpNode
 ){

148150 
as£¹
Ð
pNode
->
nRef
>0 );

148151 
	gpNode
->
	gnRef
--;

148152 ifÐ
	gpNode
->
	gnRef
==0 ){

148153 ifÐ
pNode
->
iNode
==1 ){

148154 
pRŒ“
->
iD•th
 = -1;

148156 ifÐ
	gpNode
->
	gpP¬’t
 ){

148157 
	grc
 = 
nodeR–—£
(
pRŒ“
, 
pNode
->
pP¬’t
);

148159 ifÐ
	grc
==
SQLITE_OK
 ){

148160 
rc
 = 
nodeWr™e
(
pRŒ“
, 
pNode
);

148162 
nodeHashD–‘e
(
pRŒ“
, 
pNode
);

148163 
sql™e3_ä“
(
pNode
);

148166  
	grc
;

148174 
i64
 
nodeG‘Rowid
(

148175 
RŒ“
 *
pRŒ“
,

148176 
RŒ“Node
 *
pNode
,

148177 
iC–l


148179 
as£¹
Ð
iC–l
<
NCELL
(
pNode
) );

148180  
»adIÁ64
(&
pNode
->
zD©a
[4 + 
pRŒ“
->
nBy‹sP”C–l
*
iC–l
]);

148186 
nodeG‘CoÜd
(

148187 
RŒ“
 *
pRŒ“
,

148188 
RŒ“Node
 *
pNode
,

148189 
iC–l
,

148190 
iCoÜd
,

148191 
RŒ“CoÜd
 *
pCoÜd


148193 
»adCoÜd
(&
pNode
->
zD©a
[12 + 
pRŒ“
->
nBy‹sP”C–l
*
iC–l
 + 4*
iCoÜd
], 
pCoÜd
);

148200 
nodeG‘C–l
(

148201 
RŒ“
 *
pRŒ“
,

148202 
RŒ“Node
 *
pNode
,

148203 
iC–l
,

148204 
RŒ“C–l
 *
pC–l


148206 
u8
 *
	gpD©a
;

148207 
u8
 *
	gpEnd
;

148208 
RŒ“CoÜd
 *
	gpCoÜd
;

148209 
	gpC–l
->
	giRowid
 = 
nodeG‘Rowid
(
pRŒ“
, 
pNode
, 
iC–l
);

148210 
	gpD©a
 = 
pNode
->
zD©a
 + (12 + 
pRŒ“
->
nBy‹sP”C–l
*
iC–l
);

148211 
	gpEnd
 = 
pD©a
 + 
pRŒ“
->
nDim
*8;

148212 
	gpCoÜd
 = 
pC–l
->
aCoÜd
;

148213 ; 
	gpD©a
<
	gpEnd
;…D©a+=4, 
	gpCoÜd
++){

148214 
»adCoÜd
(
pD©a
, 
pCoÜd
);

148222 
¹»eIn™
(

148223 
sql™e3
 *, *, , cÚ¡ *cÚ¡*, 
sql™e3_vb
 **, **, 

148229 
¹»eC»©e
(

148230 
sql™e3
 *
db
,

148231 *
pAux
,

148232 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

148233 
sql™e3_vb
 **
µVb
,

148234 **
pzE¼


148236  
¹»eIn™
(
db
, 
pAux
, 
¬gc
, 
¬gv
, 
µVb
, 
pzE¼
, 1);

148242 
¹»eCÚÃù
(

148243 
sql™e3
 *
db
,

148244 *
pAux
,

148245 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

148246 
sql™e3_vb
 **
µVb
,

148247 **
pzE¼


148249  
¹»eIn™
(
db
, 
pAux
, 
¬gc
, 
¬gv
, 
µVb
, 
pzE¼
, 0);

148255 
¹»eReã»nû
(
RŒ“
 *
pRŒ“
){

148256 
	gpRŒ“
->
	gnBusy
++;

148263 
¹»eR–—£
(
RŒ“
 *
pRŒ“
){

148264 
	gpRŒ“
->
	gnBusy
--;

148265 ifÐ
	gpRŒ“
->
	gnBusy
==0 ){

148266 
sql™e3_fš®ize
(
pRŒ“
->
pR—dNode
);

148267 
sql™e3_fš®ize
(
pRŒ“
->
pWr™eNode
);

148268 
sql™e3_fš®ize
(
pRŒ“
->
pD–‘eNode
);

148269 
sql™e3_fš®ize
(
pRŒ“
->
pR—dRowid
);

148270 
sql™e3_fš®ize
(
pRŒ“
->
pWr™eRowid
);

148271 
sql™e3_fš®ize
(
pRŒ“
->
pD–‘eRowid
);

148272 
sql™e3_fš®ize
(
pRŒ“
->
pR—dP¬’t
);

148273 
sql™e3_fš®ize
(
pRŒ“
->
pWr™eP¬’t
);

148274 
sql™e3_fš®ize
(
pRŒ“
->
pD–‘eP¬’t
);

148275 
sql™e3_ä“
(
pRŒ“
);

148282 
¹»eDiscÚÃù
(
sql™e3_vb
 *
pVb
){

148283 
¹»eR–—£
((
RŒ“
 *)
pVb
);

148284  
	gSQLITE_OK
;

148290 
¹»eDe¡roy
(
sql™e3_vb
 *
pVb
){

148291 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)
pVb
;

148292 
	grc
;

148293 *
	gzC»©e
 = 
sql™e3_m´štf
(

148297 
pRŒ“
->
zDb
,…RŒ“->
zName
,

148298 
pRŒ“
->
zDb
,…RŒ“->
zName
,

148299 
pRŒ“
->
zDb
,…RŒ“->
zName


148301 ifÐ!
	gzC»©e
 ){

148302 
	grc
 = 
SQLITE_NOMEM
;

148304 
	grc
 = 
sql™e3_exec
(
pRŒ“
->
db
, 
zC»©e
, 0, 0, 0);

148305 
sql™e3_ä“
(
zC»©e
);

148307 ifÐ
	grc
==
SQLITE_OK
 ){

148308 
¹»eR–—£
(
pRŒ“
);

148311  
	grc
;

148317 
¹»eO³n
(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µCursÜ
){

148318 
	grc
 = 
SQLITE_NOMEM
;

148319 
RŒ“CursÜ
 *
	gpC¤
;

148321 
	gpC¤
 = (
RŒ“CursÜ
 *)
sql™e3_m®loc
((RtreeCursor));

148322 ifÐ
	gpC¤
 ){

148323 
mem£t
(
pC¤
, 0, (
RŒ“CursÜ
));

148324 
	gpC¤
->
	gba£
.
	gpVb
 = 
pVTab
;

148325 
	grc
 = 
SQLITE_OK
;

148327 *
	gµCursÜ
 = (
sql™e3_vb_cursÜ
 *)
pC¤
;

148329  
	grc
;

148336 
ä“CursÜCÚ¡¿šts
(
RŒ“CursÜ
 *
pC¤
){

148337 ifÐ
	gpC¤
->
	gaCÚ¡¿št
 ){

148338 
	gi
;

148339 
	gi
=0; i<
	gpC¤
->
	gnCÚ¡¿št
; i++){

148340 
sql™e3_¹»e_qu”y_šfo
 *
	gpInfo
 = 
pC¤
->
aCÚ¡¿št
[
i
].
pInfo
;

148341 ifÐ
	gpInfo
 ){

148342 ifÐ
	gpInfo
->
	gxD–U£r
 )…Info->
xD–U£r
(
pInfo
->
pU£r
);

148343 
sql™e3_ä“
(
pInfo
);

148346 
sql™e3_ä“
(
pC¤
->
aCÚ¡¿št
);

148347 
	gpC¤
->
	gaCÚ¡¿št
 = 0;

148354 
¹»eClo£
(
sql™e3_vb_cursÜ
 *
cur
){

148355 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)(
cur
->
pVb
);

148356 
	gii
;

148357 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
cur
;

148358 
ä“CursÜCÚ¡¿šts
(
pC¤
);

148359 
sql™e3_ä“
(
pC¤
->
aPošt
);

148360 
	gii
=0; ii<
	gRTREE_CACHE_SZ
; ii++è
nodeR–—£
(
pRŒ“
, 
pC¤
->
aNode
[
ii
]);

148361 
sql™e3_ä“
(
pC¤
);

148362  
	gSQLITE_OK
;

148371 
¹»eEof
(
sql™e3_vb_cursÜ
 *
cur
){

148372 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
cur
;

148373  
	gpC¤
->
	g©EOF
;

148392 #ià
defšed
(
SQLITE_BYTEORDER
) && SQLITE_BYTEORDER==1234

148393 
	#RTREE_DECODE_COORD
(
eIÁ
, 
a
, 
r
) { \

148394 
RŒ“CoÜd
 
c
; \

148395 
	`memýy
(&
c
.
u
,
a
,4); \

148396 
c
.
u
 = ((c.u>>24)&0xff)|((c.u>>8)&0xff00)| \

148397 ((
c
.
u
&0xff)<<24)|((c.u&0xff00)<<8); \

148398 
r
 = 
eIÁ
 ? (
sql™e3_¹»e_dbl
)
c
.
i
 : (sql™e3_¹»e_dbl)c.
f
; \

148399 }

	)

148400 #–ià
defšed
(
SQLITE_BYTEORDER
) && SQLITE_BYTEORDER==4321

148401 
	#RTREE_DECODE_COORD
(
eIÁ
, 
a
, 
r
) { \

148402 
RŒ“CoÜd
 
c
; \

148403 
	`memýy
(&
c
.
u
,
a
,4); \

148404 
r
 = 
eIÁ
 ? (
sql™e3_¹»e_dbl
)
c
.
i
 : (sql™e3_¹»e_dbl)c.
f
; \

148405 }

	)

148407 
	#RTREE_DECODE_COORD
(
eIÁ
, 
a
, 
r
) { \

148408 
RŒ“CoÜd
 
c
; \

148409 
c
.
u
 = ((
u32
)
a
[0]<<24) + ((u32)a[1]<<16) \

148410 +((
u32
)
a
[2]<<8) +‡[3]; \

148411 
r
 = 
eIÁ
 ? (
sql™e3_¹»e_dbl
)
c
.
i
 : (sql™e3_¹»e_dbl)c.
f
; \

148412 }

	)

148419 
¹»eC®lbackCÚ¡¿št
(

148420 
RŒ“CÚ¡¿št
 *
pCÚ¡¿št
,

148421 
eIÁ
,

148422 
u8
 *
pC–lD©a
,

148423 
RŒ“S—rchPošt
 *
pS—rch
,

148424 
sql™e3_¹»e_dbl
 *
´ScÜe
,

148425 *
³W™hš


148427 
	gi
;

148428 
sql™e3_¹»e_qu”y_šfo
 *
	gpInfo
 = 
pCÚ¡¿št
->
pInfo
;

148429 
	gnCoÜd
 = 
pInfo
->
nCoÜd
;

148430 
	grc
;

148431 
sql™e3_¹»e_dbl
 
	gaCoÜd
[
RTREE_MAX_DIMENSIONS
*2];

148433 
as£¹
Ð
pCÚ¡¿št
->
Ý
==
RTREE_MATCH
 ||…CÚ¡¿št->Ý==
RTREE_QUERY
 );

148434 
as£¹
Ð
nCoÜd
==2 ||‚Coord==4 ||‚Coord==6 ||‚Coord==8 ||‚Coord==10 );

148436 ifÐ
	gpCÚ¡¿št
->
	gÝ
==
RTREE_QUERY
 && 
pS—rch
->
iLev–
==1 ){

148437 
pInfo
->
iRowid
 = 
»adIÁ64
(
pC–lD©a
);

148439 
	gpC–lD©a
 += 8;

148440 
	gi
=0; i<
	gnCoÜd
; i++, 
	gpC–lD©a
 += 4){

148441 
RTREE_DECODE_COORD
(
eIÁ
, 
pC–lD©a
, 
aCoÜd
[
i
]);

148443 ifÐ
	gpCÚ¡¿št
->
	gÝ
==
RTREE_MATCH
 ){

148444 
rc
 = 
pCÚ¡¿št
->
u
.
xGeom
((
sql™e3_¹»e_geom‘ry
*)
pInfo
,

148445 
nCoÜd
, 
aCoÜd
, &
i
);

148446 ifÐ
	gi
==0 ) *
³W™hš
 = 
NOT_WITHIN
;

148447 *
	g´ScÜe
 = 
RTREE_ZERO
;

148449 
	gpInfo
->
	gaCoÜd
 = 
aCoÜd
;

148450 
	gpInfo
->
	giLev–
 = 
pS—rch
->
iLev–
 - 1;

148451 
	gpInfo
->
	grScÜe
 = 
pInfo
->
rP¬’tScÜe
 = 
pS—rch
->
rScÜe
;

148452 
	gpInfo
->
	geW™hš
 = 
pInfo
->
eP¬’tW™hš
 = 
pS—rch
->
eW™hš
;

148453 
	grc
 = 
pCÚ¡¿št
->
u
.
xQu”yFunc
(
pInfo
);

148454 ifÐ
	gpInfo
->
	geW™hš
<*
	g³W™hš
 ) *³W™hš = 
pInfo
->
eW™hš
;

148455 ifÐ
	gpInfo
->
	grScÜe
<*
	g´ScÜe
 || *´ScÜe<
	gRTREE_ZERO
 ){

148456 *
	g´ScÜe
 = 
pInfo
->
rScÜe
;

148459  
	grc
;

148467 
¹»eNÚËafCÚ¡¿št
(

148468 
RŒ“CÚ¡¿št
 *
p
,

148469 
eIÁ
,

148470 
u8
 *
pC–lD©a
,

148471 *
³W™hš


148473 
sql™e3_¹»e_dbl
 
	gv®
;

148478 
	gpC–lD©a
 +ð8 + 4*(
p
->
iCoÜd
&0xfe);

148480 
as£¹
(
p
->
Ý
==
RTREE_LE
 ||…->Ý==
RTREE_LT
 ||…->Ý==
RTREE_GE


148481 || 
p
->
Ý
==
RTREE_GT
 ||…->Ý==
RTREE_EQ
 );

148482  
	gp
->
	gÝ
 ){

148483 
	gRTREE_LE
:

148484 
RTREE_LT
:

148485 
RTREE_EQ
:

148486 
RTREE_DECODE_COORD
(
eIÁ
, 
pC–lD©a
, 
v®
);

148488 ifÐ
	gp
->
	gu
.
	grV®ue
>=
v®
 ) ;

148489 ifÐ
	gp
->
	gÝ
!=
RTREE_EQ
 ) ;

148493 
pC–lD©a
 += 4;

148494 
RTREE_DECODE_COORD
(
eIÁ
, 
pC–lD©a
, 
v®
);

148496 ifÐ
	gp
->
	gu
.
	grV®ue
<=
v®
 ) ;

148498 *
	g³W™hš
 = 
NOT_WITHIN
;

148511 
¹»eL—fCÚ¡¿št
(

148512 
RŒ“CÚ¡¿št
 *
p
,

148513 
eIÁ
,

148514 
u8
 *
pC–lD©a
,

148515 *
³W™hš


148517 
RŒ“DV®ue
 
	gxN
;

148519 
as£¹
(
p
->
Ý
==
RTREE_LE
 ||…->Ý==
RTREE_LT
 ||…->Ý==
RTREE_GE


148520 || 
p
->
Ý
==
RTREE_GT
 ||…->Ý==
RTREE_EQ
 );

148521 
	gpC–lD©a
 +ð8 + 
p
->
iCoÜd
*4;

148522 
RTREE_DECODE_COORD
(
eIÁ
, 
pC–lD©a
, 
xN
);

148523  
	gp
->
	gÝ
 ){

148524 
	gRTREE_LE
: ifÐ
xN
 <ð
p
->
u
.
rV®ue
 ) ; ;

148525 
	gRTREE_LT
: ifÐ
xN
 < 
p
->
u
.
rV®ue
 ) ; ;

148526 
	gRTREE_GE
: ifÐ
xN
 >ð
p
->
u
.
rV®ue
 ) ; ;

148527 
	gRTREE_GT
: ifÐ
xN
 > 
p
->
u
.
rV®ue
 ) ; ;

148528 : ifÐ
xN
 =ð
p
->
u
.
rV®ue
 ) ; ;

148530 *
	g³W™hš
 = 
NOT_WITHIN
;

148537 
nodeRowidIndex
(

148538 
RŒ“
 *
pRŒ“
,

148539 
RŒ“Node
 *
pNode
,

148540 
i64
 
iRowid
,

148541 *
piIndex


148543 
	gii
;

148544 
	gnC–l
 = 
NCELL
(
pNode
);

148545 
as£¹
Ð
nC–l
<200 );

148546 
	gii
=0; ii<
	gnC–l
; ii++){

148547 ifÐ
nodeG‘Rowid
(
pRŒ“
, 
pNode
, 
ii
)==
iRowid
 ){

148548 *
piIndex
 = 
ii
;

148549  
	gSQLITE_OK
;

148552  
	gSQLITE_CORRUPT_VTAB
;

148559 
nodeP¬’tIndex
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
, *
piIndex
){

148560 
RŒ“Node
 *
	gpP¬’t
 = 
pNode
->
pP¬’t
;

148561 ifÐ
	gpP¬’t
 ){

148562  
nodeRowidIndex
(
pRŒ“
, 
pP¬’t
, 
pNode
->
iNode
, 
piIndex
);

148564 *
	gpiIndex
 = -1;

148565  
	gSQLITE_OK
;

148578 
¹»eS—rchPoštCom·»
(

148579 cÚ¡ 
RŒ“S—rchPošt
 *
pA
,

148580 cÚ¡ 
RŒ“S—rchPošt
 *
pB


148582 ifÐ
	gpA
->
	grScÜe
<
	gpB
->rScore )  -1;

148583 ifÐ
	gpA
->
	grScÜe
>
	gpB
->rScore )  +1;

148584 ifÐ
	gpA
->
	giLev–
<
	gpB
->iLevel )  -1;

148585 ifÐ
	gpA
->
	giLev–
>
	gpB
->iLevel )  +1;

148592 
¹»eS—rchPoštSw­
(
RŒ“CursÜ
 *
p
, 
i
, 
j
){

148593 
RŒ“S—rchPošt
 
	gt
 = 
p
->
aPošt
[
i
];

148594 
as£¹
Ð
i
<
j
 );

148595 
	gp
->
	gaPošt
[
i
] = 
p
->
aPošt
[
j
];

148596 
	gp
->
	gaPošt
[
j
] = 
t
;

148597 
	gi
++; 
	gj
++;

148598 ifÐ
	gi
<
	gRTREE_CACHE_SZ
 ){

148599 ifÐ
	gj
>=
RTREE_CACHE_SZ
 ){

148600 
nodeR–—£
(
RTREE_OF_CURSOR
(
p
),…->
aNode
[
i
]);

148601 
	gp
->
	gaNode
[
i
] = 0;

148603 
RŒ“Node
 *
	gpTemp
 = 
p
->
aNode
[
i
];

148604 
	gp
->
	gaNode
[
i
] = 
p
->
aNode
[
j
];

148605 
	gp
->
	gaNode
[
j
] = 
pTemp
;

148613 
RŒ“S—rchPošt
 *
¹»eS—rchPoštFœ¡
(
RŒ“CursÜ
 *
pCur
){

148614  
	gpCur
->
	gbPošt
 ? &pCur->
	gsPošt
 : 
pCur
->
nPošt
 ?…Cur->
aPošt
 : 0;

148620 
RŒ“Node
 *
¹»eNodeOfFœ¡S—rchPošt
(
RŒ“CursÜ
 *
pCur
, *
pRC
){

148621 
sql™e3_št64
 
	gid
;

148622 
	gii
 = 1 - 
pCur
->
bPošt
;

148623 
as£¹
Ð
ii
==0 || ii==1 );

148624 
as£¹
Ð
pCur
->
bPošt
 ||…Cur->
nPošt
 );

148625 ifÐ
	gpCur
->
	gaNode
[
ii
]==0 ){

148626 
as£¹
Ð
pRC
!=0 );

148627 
	gid
 = 
ii
 ? 
pCur
->
aPošt
[0].
id
 :…Cur->
sPošt
.id;

148628 *
	gpRC
 = 
nodeAcquœe
(
RTREE_OF_CURSOR
(
pCur
), 
id
, 0, &pCur->
aNode
[
ii
]);

148630  
	gpCur
->
	gaNode
[
ii
];

148636 
RŒ“S—rchPošt
 *
¹»eEnqueue
(

148637 
RŒ“CursÜ
 *
pCur
,

148638 
RŒ“DV®ue
 
rScÜe
,

148639 
u8
 
iLev–


148641 
	gi
, 
	gj
;

148642 
RŒ“S—rchPošt
 *
	gpNew
;

148643 ifÐ
	gpCur
->
	gnPošt
>=
pCur
->
nPoštAÎoc
 ){

148644 
nNew
 = 
pCur
->
nPoštAÎoc
*2 + 8;

148645 
	gpNew
 = 
sql™e3_»®loc
(
pCur
->
aPošt
, 
nNew
*(pCur->aPoint[0]));

148646 ifÐ
	gpNew
==0 )  0;

148647 
	gpCur
->
	gaPošt
 = 
pNew
;

148648 
	gpCur
->
	gnPoštAÎoc
 = 
nNew
;

148650 
	gi
 = 
pCur
->
nPošt
++;

148651 
	gpNew
 = 
pCur
->
aPošt
 + 
i
;

148652 
	gpNew
->
	grScÜe
 = 
rScÜe
;

148653 
	gpNew
->
	giLev–
 = 
iLev–
;

148654 
as£¹
Ð
iLev–
>=0 && iLev–<=
RTREE_MAX_DEPTH
 );

148655  
	gi
>0 ){

148656 
RŒ“S—rchPošt
 *
	gpP¬’t
;

148657 
	gj
 = (
i
-1)/2;

148658 
	gpP¬’t
 = 
pCur
->
aPošt
 + 
j
;

148659 ifÐ
¹»eS—rchPoštCom·»
(
pNew
, 
pP¬’t
)>=0 ) ;

148660 
¹»eS—rchPoštSw­
(
pCur
, 
j
, 
i
);

148661 
	gi
 = 
j
;

148662 
	gpNew
 = 
pP¬’t
;

148664  
	gpNew
;

148671 
RŒ“S—rchPošt
 *
¹»eS—rchPoštNew
(

148672 
RŒ“CursÜ
 *
pCur
,

148673 
RŒ“DV®ue
 
rScÜe
,

148674 
u8
 
iLev–


148676 
RŒ“S—rchPošt
 *
	gpNew
, *
	gpFœ¡
;

148677 
	gpFœ¡
 = 
¹»eS—rchPoštFœ¡
(
pCur
);

148678 
	gpCur
->
	gªQueue
[
iLev–
]++;

148679 ifÐ
	gpFœ¡
==0

148680 || 
pFœ¡
->
rScÜe
>rScore

148681 || (
pFœ¡
->
rScÜe
=ôScÜ&&…Fœ¡->
iLev–
>iLevel)

148683 ifÐ
pCur
->
bPošt
 ){

148684 
ii
;

148685 
	gpNew
 = 
¹»eEnqueue
(
pCur
, 
rScÜe
, 
iLev–
);

148686 ifÐ
	gpNew
==0 )  0;

148687 
	gii
 = ()(
pNew
 - 
pCur
->
aPošt
) + 1;

148688 ifÐ
	gii
<
	gRTREE_CACHE_SZ
 ){

148689 
as£¹
Ð
pCur
->
aNode
[
ii
]==0 );

148690 
	gpCur
->
	gaNode
[
ii
] = 
pCur
->
aNode
[0];

148692 
nodeR–—£
(
RTREE_OF_CURSOR
(
pCur
),…Cur->
aNode
[0]);

148694 
	gpCur
->
	gaNode
[0] = 0;

148695 *
	gpNew
 = 
pCur
->
sPošt
;

148697 
	gpCur
->
	gsPošt
.
	grScÜe
 = 
rScÜe
;

148698 
	gpCur
->
	gsPošt
.
	giLev–
 = 
iLev–
;

148699 
	gpCur
->
	gbPošt
 = 1;

148700  &
	gpCur
->
	gsPošt
;

148702  
¹»eEnqueue
(
pCur
, 
rScÜe
, 
iLev–
);

148708 
ŒaûPošt
(
RŒ“S—rchPošt
 *
p
, 
idx
, 
RŒ“CursÜ
 *
pCur
){

148709 ifÐ
	gidx
<0 ){ 
´štf
(" s"); }{…rštf("%2d", 
idx
); }

148710 
´štf
(" %d.%05lld.%02d %g %d",

148711 
p
->
iLev–
,…->
id
,…->
iC–l
,…->
rScÜe
,…->
eW™hš


148713 
	gidx
++;

148714 ifÐ
	gidx
<
	gRTREE_CACHE_SZ
 ){

148715 
´štf
(" %p\n", 
pCur
->
aNode
[
idx
]);

148717 
´štf
("\n");

148720 
ŒaûQueue
(
RŒ“CursÜ
 *
pCur
, cÚ¡ *
zP»fix
){

148721 
	gii
;

148722 
´štf
("==ð%9 ", 
zP»fix
);

148723 ifÐ
	gpCur
->
	gbPošt
 ){

148724 
ŒaûPošt
(&
pCur
->
sPošt
, -1,…Cur);

148726 
	gii
=0; ii<
	gpCur
->
	gnPošt
; ii++){

148727 ifÐ
	gii
>0 || 
	gpCur
->
	gbPošt
 ) 
´štf
(" ");

148728 
ŒaûPošt
(&
pCur
->
aPošt
[
ii
], ii,…Cur);

148731 
	#RTREE_QUEUE_TRACE
(
A
,
B
è
	`ŒaûQueue
(A,B)

	)

148733 
	#RTREE_QUEUE_TRACE
(
A
,
B
è

	)

148738 
¹»eS—rchPoštPÝ
(
RŒ“CursÜ
 *
p
){

148739 
	gi
, 
	gj
, 
	gk
, 
	gn
;

148740 
	gi
 = 1 - 
p
->
bPošt
;

148741 
as£¹
Ð
i
==0 || i==1 );

148742 ifÐ
	gp
->
	gaNode
[
i
] ){

148743 
nodeR–—£
(
RTREE_OF_CURSOR
(
p
),…->
aNode
[
i
]);

148744 
	gp
->
	gaNode
[
i
] = 0;

148746 ifÐ
	gp
->
	gbPošt
 ){

148747 
	gp
->
	gªQueue
[
p
->
sPošt
.
iLev–
]--;

148748 
	gp
->
	gbPošt
 = 0;

148749 }ifÐ
	gp
->
	gnPošt
 ){

148750 
	gp
->
	gªQueue
[
p
->
aPošt
[0].
	giLev–
]--;

148751 
	gn
 = --
p
->
nPošt
;

148752 
	gp
->
	gaPošt
[0] = 
p
->
aPošt
[
n
];

148753 ifÐ
	gn
<
	gRTREE_CACHE_SZ
-1 ){

148754 
	gp
->
	gaNode
[1] = 
p
->
aNode
[
n
+1];

148755 
	gp
->
	gaNode
[
n
+1] = 0;

148757 
	gi
 = 0;

148758  (
	gj
 = 
i
*2+1)<
n
 ){

148759 
k
 = 
j
+1;

148760 ifÐ
	gk
<
	gn
 && 
¹»eS—rchPoštCom·»
(&
p
->
aPošt
[
k
], &p->aPošt[
j
])<0 ){

148761 ifÐ
¹»eS—rchPoštCom·»
(&
p
->
aPošt
[
k
], &p->aPošt[
i
])<0 ){

148762 
¹»eS—rchPoštSw­
(
p
, 
i
, 
k
);

148763 
	gi
 = 
k
;

148768 ifÐ
¹»eS—rchPoštCom·»
(&
p
->
aPošt
[
j
], &p->aPošt[
i
])<0 ){

148769 
¹»eS—rchPoštSw­
(
p
, 
i
, 
j
);

148770 
	gi
 = 
j
;

148786 
¹»eS‹pToL—f
(
RŒ“CursÜ
 *
pCur
){

148787 
RŒ“S—rchPošt
 *
	gp
;

148788 
RŒ“
 *
	gpRŒ“
 = 
RTREE_OF_CURSOR
(
pCur
);

148789 
RŒ“Node
 *
	gpNode
;

148790 
	geW™hš
;

148791 
	grc
 = 
SQLITE_OK
;

148792 
	gnC–l
;

148793 
	gnCÚ¡¿št
 = 
pCur
->
nCÚ¡¿št
;

148794 
	gii
;

148795 
	geIÁ
;

148796 
RŒ“S—rchPošt
 
	gx
;

148798 
	geIÁ
 = 
pRŒ“
->
eCoÜdTy³
==
RTREE_COORD_INT32
;

148799  (
	gp
 = 
¹»eS—rchPoštFœ¡
(
pCur
))!=0 && 
p
->
iLev–
>0 ){

148800 
pNode
 = 
¹»eNodeOfFœ¡S—rchPošt
(
pCur
, &
rc
);

148801 ifÐ
	grc
 ) „c;

148802 
	gnC–l
 = 
NCELL
(
pNode
);

148803 
as£¹
Ð
nC–l
<200 );

148804  
	gp
->
	giC–l
<
	gnC–l
 ){

148805 
sql™e3_¹»e_dbl
 
	grScÜe
 = (sqlite3_rtree_dbl)-1;

148806 
u8
 *
	gpC–lD©a
 = 
pNode
->
zD©a
 + (4+
pRŒ“
->
nBy‹sP”C–l
*
p
->
iC–l
);

148807 
	geW™hš
 = 
FULLY_WITHIN
;

148808 
	gii
=0; ii<
	gnCÚ¡¿št
; ii++){

148809 
RŒ“CÚ¡¿št
 *
	gpCÚ¡¿št
 = 
pCur
->
aCÚ¡¿št
 + 
ii
;

148810 ifÐ
	gpCÚ¡¿št
->
	gÝ
>=
RTREE_MATCH
 ){

148811 
rc
 = 
¹»eC®lbackCÚ¡¿št
(
pCÚ¡¿št
, 
eIÁ
, 
pC–lD©a
, 
p
,

148812 &
rScÜe
, &
eW™hš
);

148813 ifÐ
	grc
 ) „c;

148814 }ifÐ
	gp
->
	giLev–
==1 ){

148815 
¹»eL—fCÚ¡¿št
(
pCÚ¡¿št
, 
eIÁ
, 
pC–lD©a
, &
eW™hš
);

148817 
¹»eNÚËafCÚ¡¿št
(
pCÚ¡¿št
, 
eIÁ
, 
pC–lD©a
, &
eW™hš
);

148819 ifÐ
	geW™hš
==
NOT_WITHIN
 ) ;

148821 
	gp
->
	giC–l
++;

148822 ifÐ
	geW™hš
==
NOT_WITHIN
 ) ;

148823 
	gx
.
	giLev–
 = 
p
->
iLev–
 - 1;

148824 ifÐ
	gx
.
	giLev–
 ){

148825 
	gx
.
	gid
 = 
»adIÁ64
(
pC–lD©a
);

148826 
	gx
.
	giC–l
 = 0;

148828 
	gx
.
	gid
 = 
p
->
id
;

148829 
	gx
.
	giC–l
 = 
p
->
iC–l
 - 1;

148831 ifÐ
	gp
->
	giC–l
>=
nC–l
 ){

148832 
RTREE_QUEUE_TRACE
(
pCur
, "POP-S:");

148833 
¹»eS—rchPoštPÝ
(
pCur
);

148835 ifÐ
	grScÜe
<
	gRTREE_ZERO
 )„ScÜð
RTREE_ZERO
;

148836 
	gp
 = 
¹»eS—rchPoštNew
(
pCur
, 
rScÜe
, 
x
.
iLev–
);

148837 ifÐ
	gp
==0 )  
SQLITE_NOMEM
;

148838 
	gp
->
	geW™hš
 = 
eW™hš
;

148839 
	gp
->
	gid
 = 
x
.
id
;

148840 
	gp
->
	giC–l
 = 
x
.
iC–l
;

148841 
RTREE_QUEUE_TRACE
(
pCur
, "PUSH-S:");

148844 ifÐ
	gp
->
	giC–l
>=
nC–l
 ){

148845 
RTREE_QUEUE_TRACE
(
pCur
, "POP-Se:");

148846 
¹»eS—rchPoštPÝ
(
pCur
);

148849 
	gpCur
->
	g©EOF
 = 
p
==0;

148850  
	gSQLITE_OK
;

148856 
¹»eNext
(
sql™e3_vb_cursÜ
 *
pVbCursÜ
){

148857 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
pVbCursÜ
;

148858 
	grc
 = 
SQLITE_OK
;

148861 
RTREE_QUEUE_TRACE
(
pC¤
, "POP-Nx:");

148862 
¹»eS—rchPoštPÝ
(
pC¤
);

148863 
	grc
 = 
¹»eS‹pToL—f
(
pC¤
);

148864  
	grc
;

148870 
¹»eRowid
(
sql™e3_vb_cursÜ
 *
pVbCursÜ
, 
sql™e_št64
 *
pRowid
){

148871 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
pVbCursÜ
;

148872 
RŒ“S—rchPošt
 *
	gp
 = 
¹»eS—rchPoštFœ¡
(
pC¤
);

148873 
	grc
 = 
SQLITE_OK
;

148874 
RŒ“Node
 *
	gpNode
 = 
¹»eNodeOfFœ¡S—rchPošt
(
pC¤
, &
rc
);

148875 ifÐ
	grc
==
SQLITE_OK
 && 
p
 ){

148876 *
pRowid
 = 
nodeG‘Rowid
(
RTREE_OF_CURSOR
(
pC¤
), 
pNode
, 
p
->
iC–l
);

148878  
	grc
;

148884 
¹»eCÞumn
(
sql™e3_vb_cursÜ
 *
cur
, 
sql™e3_cÚ‹xt
 *
ùx
, 
i
){

148885 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)
cur
->
pVb
;

148886 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
cur
;

148887 
RŒ“S—rchPošt
 *
	gp
 = 
¹»eS—rchPoštFœ¡
(
pC¤
);

148888 
RŒ“CoÜd
 
	gc
;

148889 
	grc
 = 
SQLITE_OK
;

148890 
RŒ“Node
 *
	gpNode
 = 
¹»eNodeOfFœ¡S—rchPošt
(
pC¤
, &
rc
);

148892 ifÐ
	grc
 ) „c;

148893 ifÐ
	gp
==0 )  
SQLITE_OK
;

148894 ifÐ
	gi
==0 ){

148895 
sql™e3_»suÉ_št64
(
ùx
, 
nodeG‘Rowid
(
pRŒ“
, 
pNode
, 
p
->
iC–l
));

148897 ifÐ
	grc
 ) „c;

148898 
nodeG‘CoÜd
(
pRŒ“
, 
pNode
, 
p
->
iC–l
, 
i
-1, &
c
);

148899 #iâdeà
SQLITE_RTREE_INT_ONLY


148900 ifÐ
	gpRŒ“
->
	geCoÜdTy³
==
RTREE_COORD_REAL32
 ){

148901 
sql™e3_»suÉ_doubË
(
ùx
, 
c
.
f
);

148905 
as£¹
Ð
pRŒ“
->
eCoÜdTy³
==
RTREE_COORD_INT32
 );

148906 
sql™e3_»suÉ_št
(
ùx
, 
c
.
i
);

148909  
	gSQLITE_OK
;

148919 
fšdL—fNode
(

148920 
RŒ“
 *
pRŒ“
,

148921 
i64
 
iRowid
,

148922 
RŒ“Node
 **
µL—f
,

148923 
sql™e3_št64
 *
piNode


148925 
	grc
;

148926 *
	gµL—f
 = 0;

148927 
sql™e3_bšd_št64
(
pRŒ“
->
pR—dRowid
, 1, 
iRowid
);

148928 ifÐ
sql™e3_¡•
(
pRŒ“
->
pR—dRowid
)==
SQLITE_ROW
 ){

148929 
i64
 
iNode
 = 
sql™e3_cÞumn_št64
(
pRŒ“
->
pR—dRowid
, 0);

148930 ifÐ
	gpiNode
 ) *piNodð
iNode
;

148931 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 
iNode
, 0, 
µL—f
);

148932 
sql™e3_»£t
(
pRŒ“
->
pR—dRowid
);

148934 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pR—dRowid
);

148936  
	grc
;

148945 
de£rŸlizeGeom‘ry
(
sql™e3_v®ue
 *
pV®ue
, 
RŒ“CÚ¡¿št
 *
pCÚs
){

148946 
RŒ“M©chArg
 *
	gpBlob
;

148947 
sql™e3_¹»e_qu”y_šfo
 *
	gpInfo
;

148948 
	gnBlob
;

148949 
	gnEx³ùed
;

148952 ifÐ
sql™e3_v®ue_ty³
(
pV®ue
)!=
SQLITE_BLOB
 )  
SQLITE_ERROR
;

148955 
	gnBlob
 = 
sql™e3_v®ue_by‹s
(
pV®ue
);

148956 ifÐ
	gnBlob
<()(
	gRŒ“M©chArg
)

148957 || ((
	gnBlob
-(
	gRŒ“M©chArg
))%(
	gRŒ“DV®ue
))!=0

148959  
SQLITE_ERROR
;

148962 
	gpInfo
 = (
sql™e3_¹»e_qu”y_šfo
*)
sql™e3_m®loc
Ð(*
pInfo
)+
nBlob
 );

148963 ifÐ!
	gpInfo
 )  
	gSQLITE_NOMEM
;

148964 
mem£t
(
pInfo
, 0, (*pInfo));

148965 
	gpBlob
 = (
RŒ“M©chArg
*)&
pInfo
[1];

148967 
memýy
(
pBlob
, 
sql™e3_v®ue_blob
(
pV®ue
), 
nBlob
);

148968 
	gnEx³ùed
 = ()((
RŒ“M©chArg
) +

148969 (
pBlob
->
nP¬am
-1)*(
RŒ“DV®ue
));

148970 ifÐ
	gpBlob
->
	gmagic
!=
RTREE_GEOMETRY_MAGIC
 || 
nBlob
!=
nEx³ùed
 ){

148971 
sql™e3_ä“
(
pInfo
);

148972  
	gSQLITE_ERROR
;

148974 
	gpInfo
->
	gpCÚ‹xt
 = 
pBlob
->
cb
.
pCÚ‹xt
;

148975 
	gpInfo
->
	gnP¬am
 = 
pBlob
->
nP¬am
;

148976 
	gpInfo
->
	gaP¬am
 = 
pBlob
->
aP¬am
;

148978 ifÐ
	gpBlob
->
	gcb
.
	gxGeom
 ){

148979 
	gpCÚs
->
	gu
.
	gxGeom
 = 
pBlob
->
cb
.
xGeom
;

148981 
	gpCÚs
->
	gÝ
 = 
RTREE_QUERY
;

148982 
	gpCÚs
->
	gu
.
	gxQu”yFunc
 = 
pBlob
->
cb
.
xQu”yFunc
;

148984 
	gpCÚs
->
	gpInfo
 = 
pInfo
;

148985  
	gSQLITE_OK
;

148991 
¹»eFž‹r
(

148992 
sql™e3_vb_cursÜ
 *
pVbCursÜ
,

148993 
idxNum
, cÚ¡ *
idxSŒ
,

148994 
¬gc
, 
sql™e3_v®ue
 **
¬gv


148996 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)
pVbCursÜ
->
pVb
;

148997 
RŒ“CursÜ
 *
	gpC¤
 = (RŒ“CursÜ *)
pVbCursÜ
;

148998 
RŒ“Node
 *
	gpRoÙ
 = 0;

148999 
	gii
;

149000 
	grc
 = 
SQLITE_OK
;

149001 
	giC–l
 = 0;

149003 
¹»eReã»nû
(
pRŒ“
);

149006 
ä“CursÜCÚ¡¿šts
(
pC¤
);

149007 
sql™e3_ä“
(
pC¤
->
aPošt
);

149008 
mem£t
(
pC¤
, 0, (
RŒ“CursÜ
));

149009 
	gpC¤
->
	gba£
.
	gpVb
 = (
sql™e3_vb
*)
pRŒ“
;

149011 
	gpC¤
->
	giSŒ©egy
 = 
idxNum
;

149012 ifÐ
	gidxNum
==1 ){

149014 
RŒ“Node
 *
pL—f
;

149015 
RŒ“S—rchPošt
 *
	gp
;

149016 
i64
 
	giRowid
 = 
sql™e3_v®ue_št64
(
¬gv
[0]);

149017 
i64
 
	giNode
 = 0;

149018 
	grc
 = 
fšdL—fNode
(
pRŒ“
, 
iRowid
, &
pL—f
, &
iNode
);

149019 ifÐ
	grc
==
SQLITE_OK
 && 
pL—f
!=0 ){

149020 
p
 = 
¹»eS—rchPoštNew
(
pC¤
, 
RTREE_ZERO
, 0);

149021 
as£¹
Ð
p
!=0 );

149022 
	gpC¤
->
	gaNode
[0] = 
pL—f
;

149023 
	gp
->
	gid
 = 
iNode
;

149024 
	gp
->
	geW™hš
 = 
PARTLY_WITHIN
;

149025 
	grc
 = 
nodeRowidIndex
(
pRŒ“
, 
pL—f
, 
iRowid
, &
iC–l
);

149026 
	gp
->
	giC–l
 = 
iC–l
;

149027 
RTREE_QUEUE_TRACE
(
pC¤
, "PUSH-F1:");

149029 
	gpC¤
->
	g©EOF
 = 1;

149035 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 1, 0, &
pRoÙ
);

149036 ifÐ
	grc
==
SQLITE_OK
 && 
¬gc
>0 ){

149037 
pC¤
->
aCÚ¡¿št
 = 
sql™e3_m®loc
((
RŒ“CÚ¡¿št
)*
¬gc
);

149038 
	gpC¤
->
	gnCÚ¡¿št
 = 
¬gc
;

149039 ifÐ!
	gpC¤
->
	gaCÚ¡¿št
 ){

149040 
	grc
 = 
SQLITE_NOMEM
;

149042 
mem£t
(
pC¤
->
aCÚ¡¿št
, 0, (
RŒ“CÚ¡¿št
)*
¬gc
);

149043 
mem£t
(
pC¤
->
ªQueue
, 0, (
u32
)*(
pRŒ“
->
iD•th
 + 1));

149044 
as£¹
Ð(
idxSŒ
==0 && 
¬gc
==0)

149045 || (
idxSŒ
 && ()
¡¾’
(idxSŒ)==
¬gc
*2) );

149046 
	gii
=0; ii<
	g¬gc
; ii++){

149047 
RŒ“CÚ¡¿št
 *
	gp
 = &
pC¤
->
aCÚ¡¿št
[
ii
];

149048 
	gp
->
	gÝ
 = 
idxSŒ
[
ii
*2];

149049 
	gp
->
	giCoÜd
 = 
idxSŒ
[
ii
*2+1]-'0';

149050 ifÐ
	gp
->
	gÝ
>=
RTREE_MATCH
 ){

149055 
rc
 = 
de£rŸlizeGeom‘ry
(
¬gv
[
ii
], 
p
);

149056 ifÐ
	grc
!=
SQLITE_OK
 ){

149059 
	gp
->
	gpInfo
->
	gnCoÜd
 = 
pRŒ“
->
nDim
*2;

149060 
	gp
->
	gpInfo
->
	gªQueue
 = 
pC¤
->
ªQueue
;

149061 
	gp
->
	gpInfo
->
	gmxLev–
 = 
pRŒ“
->
iD•th
 + 1;

149063 #ifdeà
SQLITE_RTREE_INT_ONLY


149064 
	gp
->
	gu
.
	grV®ue
 = 
sql™e3_v®ue_št64
(
¬gv
[
ii
]);

149066 
	gp
->
	gu
.
	grV®ue
 = 
sql™e3_v®ue_doubË
(
¬gv
[
ii
]);

149072 ifÐ
	grc
==
SQLITE_OK
 ){

149073 
RŒ“S—rchPošt
 *
pNew
;

149074 
	gpNew
 = 
¹»eS—rchPoštNew
(
pC¤
, 
RTREE_ZERO
, 
pRŒ“
->
iD•th
+1);

149075 ifÐ
	gpNew
==0 )  
SQLITE_NOMEM
;

149076 
	gpNew
->
	gid
 = 1;

149077 
	gpNew
->
	giC–l
 = 0;

149078 
	gpNew
->
	geW™hš
 = 
PARTLY_WITHIN
;

149079 
as£¹
Ð
pC¤
->
bPošt
==1 );

149080 
	gpC¤
->
	gaNode
[0] = 
pRoÙ
;

149081 
	gpRoÙ
 = 0;

149082 
RTREE_QUEUE_TRACE
(
pC¤
, "PUSH-Fm:");

149083 
	grc
 = 
¹»eS‹pToL—f
(
pC¤
);

149087 
nodeR–—£
(
pRŒ“
, 
pRoÙ
);

149088 
¹»eR–—£
(
pRŒ“
);

149089  
	grc
;

149097 
£tE¡im©edRows
(
sql™e3_šdex_šfo
 *
pIdxInfo
, 
i64
 
nRow
){

149098 #ià
SQLITE_VERSION_NUMBER
>=3008002

149099 ifÐ
sql™e3_libv”siÚ_numb”
()>=3008002 ){

149100 
pIdxInfo
->
e¡im©edRows
 = 
nRow
;

149139 
¹»eBe¡Index
(
sql™e3_vb
 *
b
, 
sql™e3_šdex_šfo
 *
pIdxInfo
){

149140 
RŒ“
 *
	gpRŒ“
 = (RŒ“*)
b
;

149141 
	grc
 = 
SQLITE_OK
;

149142 
	gii
;

149143 
i64
 
	gnRow
;

149145 
	giIdx
 = 0;

149146 
	gzIdxSŒ
[
RTREE_MAX_DIMENSIONS
*8+1];

149147 
mem£t
(
zIdxSŒ
, 0, (zIdxStr));

149149 
as£¹
Ð
pIdxInfo
->
idxSŒ
==0 );

149150 
	gii
=0; ii<
	gpIdxInfo
->
	gnCÚ¡¿št
 && 
	giIdx
<()((
	gzIdxSŒ
)-1); ii++){

149151 
sql™e3_šdex_cÚ¡¿št
 *
	gp
 = &
pIdxInfo
->
aCÚ¡¿št
[
ii
];

149153 ifÐ
	gp
->
	gu§bË
 &&…->
	giCÞumn
==0 && 
p
->
Ý
==
SQLITE_INDEX_CONSTRAINT_EQ
 ){

149155 
jj
;

149156 
	gjj
=0; jj<
	gii
; jj++){

149157 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
jj
].
	g¬gvIndex
 = 0;

149158 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
jj
].
	gom™
 = 0;

149160 
	gpIdxInfo
->
	gidxNum
 = 1;

149161 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
ii
].
	g¬gvIndex
 = 1;

149162 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
jj
].
	gom™
 = 1;

149170 
	gpIdxInfo
->
	ge¡im©edCo¡
 = 30.0;

149171 
£tE¡im©edRows
(
pIdxInfo
, 1);

149172  
	gSQLITE_OK
;

149175 ifÐ
	gp
->
	gu§bË
 && (p->
	giCÞumn
>0 ||…->
	gÝ
==
SQLITE_INDEX_CONSTRAINT_MATCH
) ){

149176 
u8
 
Ý
;

149177  
	gp
->
	gÝ
 ){

149178 
	gSQLITE_INDEX_CONSTRAINT_EQ
: 
Ý
 = 
RTREE_EQ
; ;

149179 
	gSQLITE_INDEX_CONSTRAINT_GT
: 
Ý
 = 
RTREE_GT
; ;

149180 
	gSQLITE_INDEX_CONSTRAINT_LE
: 
Ý
 = 
RTREE_LE
; ;

149181 
	gSQLITE_INDEX_CONSTRAINT_LT
: 
Ý
 = 
RTREE_LT
; ;

149182 
	gSQLITE_INDEX_CONSTRAINT_GE
: 
Ý
 = 
RTREE_GE
; ;

149184 
as£¹
Ð
p
->
Ý
==
SQLITE_INDEX_CONSTRAINT_MATCH
 );

149185 
	gÝ
 = 
RTREE_MATCH
;

149188 
	gzIdxSŒ
[
iIdx
++] = 
Ý
;

149189 
	gzIdxSŒ
[
iIdx
++] = 
p
->
iCÞumn
 - 1 + '0';

149190 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
ii
].
	g¬gvIndex
 = (
iIdx
/2);

149191 
	gpIdxInfo
->
	gaCÚ¡¿štU§ge
[
ii
].
	gom™
 = 1;

149195 
	gpIdxInfo
->
	gidxNum
 = 2;

149196 
	gpIdxInfo
->
	gÃedToF»eIdxSŒ
 = 1;

149197 ifÐ
	giIdx
>0 && 0==(
pIdxInfo
->
idxSŒ
 = 
sql™e3_m´štf
("%s", 
zIdxSŒ
)) ){

149198  
	gSQLITE_NOMEM
;

149201 
	gnRow
 = 
pRŒ“
->
nRowE¡
 / (
iIdx
 + 1);

149202 
	gpIdxInfo
->
	ge¡im©edCo¡
 = ()6.0 * ()
nRow
;

149203 
£tE¡im©edRows
(
pIdxInfo
, 
nRow
);

149205  
	grc
;

149211 
RŒ“DV®ue
 
ûÎA»a
(
RŒ“
 *
pRŒ“
, 
RŒ“C–l
 *
p
){

149212 
RŒ“DV®ue
 
	g¬—
 = (RtreeDValue)1;

149213 
	gii
;

149214 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

149215 
¬—
 = (¬— * (
DCOORD
(
p
->
aCoÜd
[
ii
+1]) - DCOORD(p->aCoord[ii])));

149217  
	g¬—
;

149224 
RŒ“DV®ue
 
ûÎM¬gš
(
RŒ“
 *
pRŒ“
, 
RŒ“C–l
 *
p
){

149225 
RŒ“DV®ue
 
	gm¬gš
 = (RtreeDValue)0;

149226 
	gii
;

149227 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

149228 
m¬gš
 +ð(
DCOORD
(
p
->
aCoÜd
[
ii
+1]) - DCOORD(p->aCoord[ii]));

149230  
	gm¬gš
;

149236 
ûÎUniÚ
(
RŒ“
 *
pRŒ“
, 
RŒ“C–l
 *
p1
, RŒ“C–È*
p2
){

149237 
	gii
;

149238 ifÐ
	gpRŒ“
->
	geCoÜdTy³
==
RTREE_COORD_REAL32
 ){

149239 
ii
=0; 
	gii
<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

149240 
p1
->
aCoÜd
[
ii
].
f
 = 
MIN
Õ1->aCoÜd[ii].f, 
p2
->aCoord[ii].f);

149241 
	gp1
->
	gaCoÜd
[
ii
+1].
	gf
 = 
MAX
(
p1
->
aCoÜd
[ii+1].
f
, 
p2
->aCoord[ii+1].f);

149244 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

149245 
p1
->
aCoÜd
[
ii
].
i
 = 
MIN
Õ1->aCoÜd[ii].i, 
p2
->aCoord[ii].i);

149246 
	gp1
->
	gaCoÜd
[
ii
+1].
	gi
 = 
MAX
(
p1
->
aCoÜd
[ii+1].
i
, 
p2
->aCoord[ii+1].i);

149255 
ûÎCÚšs
(
RŒ“
 *
pRŒ“
, 
RŒ“C–l
 *
p1
, RŒ“C–È*
p2
){

149256 
	gii
;

149257 
	gisIÁ
 = (
pRŒ“
->
eCoÜdTy³
==
RTREE_COORD_INT32
);

149258 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

149259 
RŒ“CoÜd
 *
a1
 = &
p1
->
aCoÜd
[
ii
];

149260 
RŒ“CoÜd
 *
	ga2
 = &
p2
->
aCoÜd
[
ii
];

149261 ifÐ(!
	gisIÁ
 && (
	ga2
[0].
	gf
<
	ga1
[0].f ||‡2[1].f>a1[1].f))

149262 || ( 
	gisIÁ
 && (
	ga2
[0].
	gi
<
	ga1
[0].i ||‡2[1].i>a1[1].i))

149273 
RŒ“DV®ue
 
ûÎGrowth
(
RŒ“
 *
pRŒ“
, 
RŒ“C–l
 *
p
, RŒ“C–È*
pC–l
){

149274 
RŒ“DV®ue
 
	g¬—
;

149275 
RŒ“C–l
 
	gûÎ
;

149276 
memýy
(&
ûÎ
, 
p
, (
RŒ“C–l
));

149277 
	g¬—
 = 
ûÎA»a
(
pRŒ“
, &
ûÎ
);

149278 
ûÎUniÚ
(
pRŒ“
, &
ûÎ
, 
pC–l
);

149279  (
ûÎA»a
(
pRŒ“
, &
ûÎ
)-
	g¬—
);

149282 
RŒ“DV®ue
 
ûÎOv”Ïp
(

149283 
RŒ“
 *
pRŒ“
,

149284 
RŒ“C–l
 *
p
,

149285 
RŒ“C–l
 *
aC–l
,

149286 
nC–l


149288 
	gii
;

149289 
RŒ“DV®ue
 
	gov”Ïp
 = 
RTREE_ZERO
;

149290 
	gii
=0; ii<
	gnC–l
; ii++){

149291 
	gjj
;

149292 
RŒ“DV®ue
 
	go
 = (RtreeDValue)1;

149293 
	gjj
=0; jj<(
	gpRŒ“
->
	gnDim
*2); jj+=2){

149294 
RŒ“DV®ue
 
x1
, 
x2
;

149295 
	gx1
 = 
MAX
(
DCOORD
(
p
->
aCoÜd
[
jj
]), DCOORD(
aC–l
[
ii
].aCoord[jj]));

149296 
	gx2
 = 
MIN
(
DCOORD
(
p
->
aCoÜd
[
jj
+1]), DCOORD(
aC–l
[
ii
].aCoord[jj+1]));

149297 ifÐ
	gx2
<
	gx1
 ){

149298 
	go
 = (
RŒ“DV®ue
)0;

149301 
	go
 = 
o
 * (
x2
-
x1
);

149304 
	gov”Ïp
 +ð
o
;

149306  
	gov”Ïp
;

149314 
Choo£L—f
(

149315 
RŒ“
 *
pRŒ“
,

149316 
RŒ“C–l
 *
pC–l
,

149317 
iHeight
,

149318 
RŒ“Node
 **
µL—f


149320 
	grc
;

149321 
	gii
;

149322 
RŒ“Node
 *
	gpNode
;

149323 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 1, 0, &
pNode
);

149325 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<(
pRŒ“
->
iD•th
-
iHeight
); ii++){

149326 
	giC–l
;

149327 
sql™e3_št64
 
	giBe¡
 = 0;

149329 
RŒ“DV®ue
 
	gfMšGrowth
 = 
RTREE_ZERO
;

149330 
RŒ“DV®ue
 
	gfMšA»a
 = 
RTREE_ZERO
;

149332 
	gnC–l
 = 
NCELL
(
pNode
);

149333 
RŒ“C–l
 
	gûÎ
;

149334 
RŒ“Node
 *
	gpChžd
;

149336 
RŒ“C–l
 *
	gaC–l
 = 0;

149342 
	giC–l
=0; iC–l<
	gnC–l
; iCell++){

149343 
	gbBe¡
 = 0;

149344 
RŒ“DV®ue
 
	ggrowth
;

149345 
RŒ“DV®ue
 
	g¬—
;

149346 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 
iC–l
, &
ûÎ
);

149347 
	ggrowth
 = 
ûÎGrowth
(
pRŒ“
, &
ûÎ
, 
pC–l
);

149348 
	g¬—
 = 
ûÎA»a
(
pRŒ“
, &
ûÎ
);

149349 ifÐ
	giC–l
==0||
growth
<
fMšGrowth
||(growth==fMšGrowth && 
¬—
<
fMšA»a
) ){

149350 
bBe¡
 = 1;

149352 ifÐ
	gbBe¡
 ){

149353 
	gfMšGrowth
 = 
growth
;

149354 
	gfMšA»a
 = 
¬—
;

149355 
	giBe¡
 = 
ûÎ
.
iRowid
;

149359 
sql™e3_ä“
(
aC–l
);

149360 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 
iBe¡
, 
pNode
, &
pChžd
);

149361 
nodeR–—£
(
pRŒ“
, 
pNode
);

149362 
	gpNode
 = 
pChžd
;

149365 *
	gµL—f
 = 
pNode
;

149366  
	grc
;

149374 
Adju¡T»e
(

149375 
RŒ“
 *
pRŒ“
,

149376 
RŒ“Node
 *
pNode
,

149377 
RŒ“C–l
 *
pC–l


149379 
RŒ“Node
 *
	gp
 = 
pNode
;

149380  
	gp
->
	gpP¬’t
 ){

149381 
RŒ“Node
 *
	gpP¬’t
 = 
p
->
pP¬’t
;

149382 
RŒ“C–l
 
	gûÎ
;

149383 
	giC–l
;

149385 ifÐ
nodeP¬’tIndex
(
pRŒ“
, 
p
, &
iC–l
) ){

149386  
	gSQLITE_CORRUPT_VTAB
;

149389 
nodeG‘C–l
(
pRŒ“
, 
pP¬’t
, 
iC–l
, &
ûÎ
);

149390 ifÐ!
ûÎCÚšs
(
pRŒ“
, &
ûÎ
, 
pC–l
) ){

149391 
ûÎUniÚ
(
pRŒ“
, &
ûÎ
, 
pC–l
);

149392 
nodeOv”wr™eC–l
(
pRŒ“
, 
pP¬’t
, &
ûÎ
, 
iC–l
);

149395 
	gp
 = 
pP¬’t
;

149397  
	gSQLITE_OK
;

149403 
rowidWr™e
(
RŒ“
 *
pRŒ“
, 
sql™e3_št64
 
iRowid
, sql™e3_št64 
iNode
){

149404 
sql™e3_bšd_št64
(
pRŒ“
->
pWr™eRowid
, 1, 
iRowid
);

149405 
sql™e3_bšd_št64
(
pRŒ“
->
pWr™eRowid
, 2, 
iNode
);

149406 
sql™e3_¡•
(
pRŒ“
->
pWr™eRowid
);

149407  
sql™e3_»£t
(
pRŒ“
->
pWr™eRowid
);

149413 
·»ÁWr™e
(
RŒ“
 *
pRŒ“
, 
sql™e3_št64
 
iNode
, sql™e3_št64 
iP¬
){

149414 
sql™e3_bšd_št64
(
pRŒ“
->
pWr™eP¬’t
, 1, 
iNode
);

149415 
sql™e3_bšd_št64
(
pRŒ“
->
pWr™eP¬’t
, 2, 
iP¬
);

149416 
sql™e3_¡•
(
pRŒ“
->
pWr™eP¬’t
);

149417  
sql™e3_»£t
(
pRŒ“
->
pWr™eP¬’t
);

149420 
¹»eIn£¹C–l
(
RŒ“
 *, 
RŒ“Node
 *, 
RŒ“C–l
 *, );

149440 
SÜtByDi¡ªû
(

149441 *
aIdx
,

149442 
nIdx
,

149443 
RŒ“DV®ue
 *
aDi¡ªû
,

149444 *
aS·»


149446 ifÐ
	gnIdx
>1 ){

149447 
	giLeá
 = 0;

149448 
	giRight
 = 0;

149450 
	gnLeá
 = 
nIdx
/2;

149451 
	gnRight
 = 
nIdx
-
nLeá
;

149452 *
	gaLeá
 = 
aIdx
;

149453 *
	gaRight
 = &
aIdx
[
nLeá
];

149455 
SÜtByDi¡ªû
(
aLeá
, 
nLeá
, 
aDi¡ªû
, 
aS·»
);

149456 
SÜtByDi¡ªû
(
aRight
, 
nRight
, 
aDi¡ªû
, 
aS·»
);

149458 
memýy
(
aS·»
, 
aLeá
, ()*
nLeá
);

149459 
	gaLeá
 = 
aS·»
;

149461  
	giLeá
<
	gnLeá
 || 
	giRight
<
	gnRight
 ){

149462 ifÐ
	giLeá
==
nLeá
 ){

149463 
aIdx
[
iLeá
+
iRight
] = 
aRight
[iRight];

149464 
	giRight
++;

149465 }ifÐ
	giRight
==
nRight
 ){

149466 
aIdx
[
iLeá
+
iRight
] = 
aLeá
[iLeft];

149467 
	giLeá
++;

149469 
RŒ“DV®ue
 
	gfLeá
 = 
aDi¡ªû
[
aLeá
[
iLeá
]];

149470 
RŒ“DV®ue
 
	gfRight
 = 
aDi¡ªû
[
aRight
[
iRight
]];

149471 ifÐ
	gfLeá
<
	gfRight
 ){

149472 
	gaIdx
[
iLeá
+
iRight
] = 
aLeá
[iLeft];

149473 
	giLeá
++;

149475 
	gaIdx
[
iLeá
+
iRight
] = 
aRight
[iRight];

149476 
	giRight
++;

149484 
	gjj
;

149485 
	gjj
=1; jj<
	gnIdx
; jj++){

149486 
RŒ“DV®ue
 
	gËá
 = 
aDi¡ªû
[
aIdx
[
jj
-1]];

149487 
RŒ“DV®ue
 
	gright
 = 
aDi¡ªû
[
aIdx
[
jj
]];

149488 
as£¹
Ð
Ëá
<=
right
 );

149506 
SÜtByDim’siÚ
(

149507 
RŒ“
 *
pRŒ“
,

149508 *
aIdx
,

149509 
nIdx
,

149510 
iDim
,

149511 
RŒ“C–l
 *
aC–l
,

149512 *
aS·»


149514 ifÐ
	gnIdx
>1 ){

149516 
	giLeá
 = 0;

149517 
	giRight
 = 0;

149519 
	gnLeá
 = 
nIdx
/2;

149520 
	gnRight
 = 
nIdx
-
nLeá
;

149521 *
	gaLeá
 = 
aIdx
;

149522 *
	gaRight
 = &
aIdx
[
nLeá
];

149524 
SÜtByDim’siÚ
(
pRŒ“
, 
aLeá
, 
nLeá
, 
iDim
, 
aC–l
, 
aS·»
);

149525 
SÜtByDim’siÚ
(
pRŒ“
, 
aRight
, 
nRight
, 
iDim
, 
aC–l
, 
aS·»
);

149527 
memýy
(
aS·»
, 
aLeá
, ()*
nLeá
);

149528 
	gaLeá
 = 
aS·»
;

149529  
	giLeá
<
	gnLeá
 || 
	giRight
<
	gnRight
 ){

149530 
RŒ“DV®ue
 
	gxËá1
 = 
DCOORD
(
aC–l
[
aLeá
[
iLeá
]].
aCoÜd
[
iDim
*2]);

149531 
RŒ“DV®ue
 
	gxËá2
 = 
DCOORD
(
aC–l
[
aLeá
[
iLeá
]].
aCoÜd
[
iDim
*2+1]);

149532 
RŒ“DV®ue
 
	gxright1
 = 
DCOORD
(
aC–l
[
aRight
[
iRight
]].
aCoÜd
[
iDim
*2]);

149533 
RŒ“DV®ue
 
	gxright2
 = 
DCOORD
(
aC–l
[
aRight
[
iRight
]].
aCoÜd
[
iDim
*2+1]);

149534 ifÐ(
	giLeá
!=
nLeá
è&& ((
iRight
==
nRight
)

149535 || (
xËá1
<
xright1
)

149536 || (
xËá1
==
xright1
 && 
xËá2
<
xright2
)

149538 
aIdx
[
iLeá
+
iRight
] = 
aLeá
[iLeft];

149539 
	giLeá
++;

149541 
	gaIdx
[
iLeá
+
iRight
] = 
aRight
[iRight];

149542 
	giRight
++;

149549 
	gjj
;

149550 
	gjj
=1; jj<
	gnIdx
; jj++){

149551 
RŒ“DV®ue
 
	gxËá1
 = 
aC–l
[
aIdx
[
jj
-1]].
aCoÜd
[
iDim
*2];

149552 
RŒ“DV®ue
 
	gxËá2
 = 
aC–l
[
aIdx
[
jj
-1]].
aCoÜd
[
iDim
*2+1];

149553 
RŒ“DV®ue
 
	gxright1
 = 
aC–l
[
aIdx
[
jj
]].
aCoÜd
[
iDim
*2];

149554 
RŒ“DV®ue
 
	gxright2
 = 
aC–l
[
aIdx
[
jj
]].
aCoÜd
[
iDim
*2+1];

149555 
as£¹
Ð
xËá1
<=
xright1
 && (xËá1<xright1 || 
xËá2
<=
xright2
) );

149565 
¥l™NodeS¹»e
(

149566 
RŒ“
 *
pRŒ“
,

149567 
RŒ“C–l
 *
aC–l
,

149568 
nC–l
,

149569 
RŒ“Node
 *
pLeá
,

149570 
RŒ“Node
 *
pRight
,

149571 
RŒ“C–l
 *
pBboxLeá
,

149572 
RŒ“C–l
 *
pBboxRight


149574 **
	g¯SÜ‹d
;

149575 *
	gaS·»
;

149576 
	gii
;

149578 
	giBe¡Dim
 = 0;

149579 
	giBe¡S¶™
 = 0;

149580 
RŒ“DV®ue
 
	gfBe¡M¬gš
 = 
RTREE_ZERO
;

149582 
	gnBy‹
 = (
pRŒ“
->
nDim
+1)*((*)+
nC–l
*());

149584 
	g¯SÜ‹d
 = (**)
sql™e3_m®loc
(
nBy‹
);

149585 ifÐ!
	g¯SÜ‹d
 ){

149586  
	gSQLITE_NOMEM
;

149589 
	gaS·»
 = &((*)&
¯SÜ‹d
[
pRŒ“
->
nDim
])[pRŒ“->nDim*
nC–l
];

149590 
mem£t
(
¯SÜ‹d
, 0, 
nBy‹
);

149591 
	gii
=0; ii<
	gpRŒ“
->
	gnDim
; ii++){

149592 
	gjj
;

149593 
	g¯SÜ‹d
[
ii
] = &((*)&
¯SÜ‹d
[
pRŒ“
->
nDim
])[ii*
nC–l
];

149594 
	gjj
=0; jj<
	gnC–l
; jj++){

149595 
	g¯SÜ‹d
[
ii
][
jj
] = jj;

149597 
SÜtByDim’siÚ
(
pRŒ“
, 
¯SÜ‹d
[
ii
], 
nC–l
, ii, 
aC–l
, 
aS·»
);

149600 
	gii
=0; ii<
	gpRŒ“
->
	gnDim
; ii++){

149601 
RŒ“DV®ue
 
	gm¬gš
 = 
RTREE_ZERO
;

149602 
RŒ“DV®ue
 
	gfBe¡Ov”Ïp
 = 
RTREE_ZERO
;

149603 
RŒ“DV®ue
 
	gfBe¡A»a
 = 
RTREE_ZERO
;

149604 
	giBe¡Leá
 = 0;

149605 
	gnLeá
;

149608 
	gnLeá
=
RTREE_MINCELLS
(
pRŒ“
);

149609 
	gnLeá
<=(
nC–l
-
RTREE_MINCELLS
(
pRŒ“
));

149610 
	gnLeá
++

149612 
RŒ“C–l
 
	gËá
;

149613 
RŒ“C–l
 
	gright
;

149614 
	gkk
;

149615 
RŒ“DV®ue
 
	gov”Ïp
;

149616 
RŒ“DV®ue
 
	g¬—
;

149618 
memýy
(&
Ëá
, &
aC–l
[
¯SÜ‹d
[
ii
][0]], (
RŒ“C–l
));

149619 
memýy
(&
right
, &
aC–l
[
¯SÜ‹d
[
ii
][
nC–l
-1]], (
RŒ“C–l
));

149620 
	gkk
=1; kk<(
	gnC–l
-1); kk++){

149621 ifÐ
	gkk
<
	gnLeá
 ){

149622 
ûÎUniÚ
(
pRŒ“
, &
Ëá
, &
aC–l
[
¯SÜ‹d
[
ii
][
kk
]]);

149624 
ûÎUniÚ
(
pRŒ“
, &
right
, &
aC–l
[
¯SÜ‹d
[
ii
][
kk
]]);

149627 
	gm¬gš
 +ð
ûÎM¬gš
(
pRŒ“
, &
Ëá
);

149628 
	gm¬gš
 +ð
ûÎM¬gš
(
pRŒ“
, &
right
);

149629 
	gov”Ïp
 = 
ûÎOv”Ïp
(
pRŒ“
, &
Ëá
, &
right
, 1);

149630 
	g¬—
 = 
ûÎA»a
(
pRŒ“
, &
Ëá
è+ c–lA»aÕRŒ“, &
right
);

149631 ifÐ(
	gnLeá
==
RTREE_MINCELLS
(
pRŒ“
))

149632 || (
ov”Ïp
<
fBe¡Ov”Ïp
)

149633 || (
ov”Ïp
==
fBe¡Ov”Ïp
 && 
¬—
<
fBe¡A»a
)

149635 
iBe¡Leá
 = 
nLeá
;

149636 
	gfBe¡Ov”Ïp
 = 
ov”Ïp
;

149637 
	gfBe¡A»a
 = 
¬—
;

149641 ifÐ
	gii
==0 || 
m¬gš
<
fBe¡M¬gš
 ){

149642 
iBe¡Dim
 = 
ii
;

149643 
	gfBe¡M¬gš
 = 
m¬gš
;

149644 
	giBe¡S¶™
 = 
iBe¡Leá
;

149648 
memýy
(
pBboxLeá
, &
aC–l
[
¯SÜ‹d
[
iBe¡Dim
][0]], (
RŒ“C–l
));

149649 
memýy
(
pBboxRight
, &
aC–l
[
¯SÜ‹d
[
iBe¡Dim
][
iBe¡S¶™
]], (
RŒ“C–l
));

149650 
	gii
=0; ii<
	gnC–l
; ii++){

149651 
RŒ“Node
 *
	gpT¬g‘
 = (
ii
<
iBe¡S¶™
)?
pLeá
:
pRight
;

149652 
RŒ“C–l
 *
	gpBbox
 = (
ii
<
iBe¡S¶™
)?
pBboxLeá
:
pBboxRight
;

149653 
RŒ“C–l
 *
	gpC–l
 = &
aC–l
[
¯SÜ‹d
[
iBe¡Dim
][
ii
]];

149654 
nodeIn£¹C–l
(
pRŒ“
, 
pT¬g‘
, 
pC–l
);

149655 
ûÎUniÚ
(
pRŒ“
, 
pBbox
, 
pC–l
);

149658 
sql™e3_ä“
(
¯SÜ‹d
);

149659  
	gSQLITE_OK
;

149663 
upd©eM­pšg
(

149664 
RŒ“
 *
pRŒ“
,

149665 
i64
 
iRowid
,

149666 
RŒ“Node
 *
pNode
,

149667 
iHeight


149669 (*
	gxS‘M­pšg
)(
	gRŒ“
 *, 
	gsql™e3_št64
, sqlite3_int64);

149670 
	gxS‘M­pšg
 = ((
iHeight
==0)?
rowidWr™e
:
·»ÁWr™e
);

149671 ifÐ
	giHeight
>0 ){

149672 
RŒ“Node
 *
	gpChžd
 = 
nodeHashLookup
(
pRŒ“
, 
iRowid
);

149673 ifÐ
	gpChžd
 ){

149674 
nodeR–—£
(
pRŒ“
, 
pChžd
->
pP¬’t
);

149675 
nodeReã»nû
(
pNode
);

149676 
	gpChžd
->
	gpP¬’t
 = 
pNode
;

149679  
xS‘M­pšg
(
pRŒ“
, 
iRowid
, 
pNode
->
iNode
);

149682 
S¶™Node
(

149683 
RŒ“
 *
pRŒ“
,

149684 
RŒ“Node
 *
pNode
,

149685 
RŒ“C–l
 *
pC–l
,

149686 
iHeight


149688 
	gi
;

149689 
	gÃwC–lIsRight
 = 0;

149691 
	grc
 = 
SQLITE_OK
;

149692 
	gnC–l
 = 
NCELL
(
pNode
);

149693 
RŒ“C–l
 *
	gaC–l
;

149694 *
	gaiU£d
;

149696 
RŒ“Node
 *
	gpLeá
 = 0;

149697 
RŒ“Node
 *
	gpRight
 = 0;

149699 
RŒ“C–l
 
	gËábbox
;

149700 
RŒ“C–l
 
	grightbbox
;

149705 
	gaC–l
 = 
sql™e3_m®loc
(((
RŒ“C–l
)+())*(
nC–l
+1));

149706 ifÐ!
	gaC–l
 ){

149707 
	grc
 = 
SQLITE_NOMEM
;

149708 
	g¥l™node_out
;

149710 
	gaiU£d
 = (*)&
aC–l
[
nC–l
+1];

149711 
mem£t
(
aiU£d
, 0, ()*(
nC–l
+1));

149712 
	gi
=0; i<
	gnC–l
; i++){

149713 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 
i
, &
aC–l
[i]);

149715 
nodeZ”o
(
pRŒ“
, 
pNode
);

149716 
memýy
(&
aC–l
[
nC–l
], 
pC–l
, (
RŒ“C–l
));

149717 
	gnC–l
++;

149719 ifÐ
	gpNode
->
	giNode
==1 ){

149720 
pRight
 = 
nodeNew
(
pRŒ“
, 
pNode
);

149721 
	gpLeá
 = 
nodeNew
(
pRŒ“
, 
pNode
);

149722 
	gpRŒ“
->
	giD•th
++;

149723 
	gpNode
->
	gisDœty
 = 1;

149724 
wr™eIÁ16
(
pNode
->
zD©a
, 
pRŒ“
->
iD•th
);

149726 
	gpLeá
 = 
pNode
;

149727 
	gpRight
 = 
nodeNew
(
pRŒ“
, 
pLeá
->
pP¬’t
);

149728 
nodeReã»nû
(
pLeá
);

149731 ifÐ!
	gpLeá
 || !
	gpRight
 ){

149732 
	grc
 = 
SQLITE_NOMEM
;

149733 
	g¥l™node_out
;

149736 
mem£t
(
pLeá
->
zD©a
, 0, 
pRŒ“
->
iNodeSize
);

149737 
mem£t
(
pRight
->
zD©a
, 0, 
pRŒ“
->
iNodeSize
);

149739 
	grc
 = 
¥l™NodeS¹»e
(
pRŒ“
, 
aC–l
, 
nC–l
, 
pLeá
, 
pRight
,

149740 &
Ëábbox
, &
rightbbox
);

149741 ifÐ
	grc
!=
SQLITE_OK
 ){

149742 
¥l™node_out
;

149750 ifÐ
	gSQLITE_OK
!=(
rc
 = 
nodeWr™e
(
pRŒ“
, 
pRight
))

149751 || (0==
pLeá
->
iNode
 && 
SQLITE_OK
!=(
rc
 = 
nodeWr™e
(
pRŒ“
,…Left)))

149753 
	g¥l™node_out
;

149756 
	grightbbox
.
	giRowid
 = 
pRight
->
iNode
;

149757 
	gËábbox
.
	giRowid
 = 
pLeá
->
iNode
;

149759 ifÐ
	gpNode
->
	giNode
==1 ){

149760 
rc
 = 
¹»eIn£¹C–l
(
pRŒ“
, 
pLeá
->
pP¬’t
, &
Ëábbox
, 
iHeight
+1);

149761 ifÐ
	grc
!=
SQLITE_OK
 ){

149762 
¥l™node_out
;

149765 
RŒ“Node
 *
	gpP¬’t
 = 
pLeá
->
pP¬’t
;

149766 
	giC–l
;

149767 
	grc
 = 
nodeP¬’tIndex
(
pRŒ“
, 
pLeá
, &
iC–l
);

149768 ifÐ
	grc
==
SQLITE_OK
 ){

149769 
nodeOv”wr™eC–l
(
pRŒ“
, 
pP¬’t
, &
Ëábbox
, 
iC–l
);

149770 
	grc
 = 
Adju¡T»e
(
pRŒ“
, 
pP¬’t
, &
Ëábbox
);

149772 ifÐ
	grc
!=
SQLITE_OK
 ){

149773 
¥l™node_out
;

149776 ifÐ(
	grc
 = 
¹»eIn£¹C–l
(
pRŒ“
, 
pRight
->
pP¬’t
, &
rightbbox
, 
iHeight
+1)) ){

149777 
	g¥l™node_out
;

149780 
	gi
=0; i<
NCELL
(
pRight
); i++){

149781 
i64
 
	giRowid
 = 
nodeG‘Rowid
(
pRŒ“
, 
pRight
, 
i
);

149782 
	grc
 = 
upd©eM­pšg
(
pRŒ“
, 
iRowid
, 
pRight
, 
iHeight
);

149783 ifÐ
	giRowid
==
pC–l
->
iRowid
 ){

149784 
ÃwC–lIsRight
 = 1;

149786 ifÐ
	grc
!=
SQLITE_OK
 ){

149787 
¥l™node_out
;

149790 ifÐ
	gpNode
->
	giNode
==1 ){

149791 
i
=0; 
	gi
<
NCELL
(
pLeá
); i++){

149792 
i64
 
	giRowid
 = 
nodeG‘Rowid
(
pRŒ“
, 
pLeá
, 
i
);

149793 
	grc
 = 
upd©eM­pšg
(
pRŒ“
, 
iRowid
, 
pLeá
, 
iHeight
);

149794 ifÐ
	grc
!=
SQLITE_OK
 ){

149795 
¥l™node_out
;

149798 }ifÐ
	gÃwC–lIsRight
==0 ){

149799 
rc
 = 
upd©eM­pšg
(
pRŒ“
, 
pC–l
->
iRowid
, 
pLeá
, 
iHeight
);

149802 ifÐ
	grc
==
SQLITE_OK
 ){

149803 
rc
 = 
nodeR–—£
(
pRŒ“
, 
pRight
);

149804 
	gpRight
 = 0;

149806 ifÐ
	grc
==
SQLITE_OK
 ){

149807 
rc
 = 
nodeR–—£
(
pRŒ“
, 
pLeá
);

149808 
	gpLeá
 = 0;

149811 
	g¥l™node_out
:

149812 
nodeR–—£
(
pRŒ“
, 
pRight
);

149813 
nodeR–—£
(
pRŒ“
, 
pLeá
);

149814 
sql™e3_ä“
(
aC–l
);

149815  
	grc
;

149829 
fixL—fP¬’t
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pL—f
){

149830 
	grc
 = 
SQLITE_OK
;

149831 
RŒ“Node
 *
	gpChžd
 = 
pL—f
;

149832  
	grc
==
SQLITE_OK
 && 
pChžd
->
iNode
!=1 &&…Chžd->
pP¬’t
==0 ){

149833 
rc2
 = 
SQLITE_OK
;

149834 
sql™e3_bšd_št64
(
pRŒ“
->
pR—dP¬’t
, 1, 
pChžd
->
iNode
);

149835 
	grc
 = 
sql™e3_¡•
(
pRŒ“
->
pR—dP¬’t
);

149836 ifÐ
	grc
==
SQLITE_ROW
 ){

149837 
RŒ“Node
 *
pTe¡
;

149838 
i64
 
	giNode
;

149845 
	giNode
 = 
sql™e3_cÞumn_št64
(
pRŒ“
->
pR—dP¬’t
, 0);

149846 
	gpTe¡
=
pL—f
;…Te¡ &&…Te¡->
	giNode
!=
iNode
;…Te¡=
pTe¡
->
pP¬’t
);

149847 ifÐ!
	gpTe¡
 ){

149848 
	grc2
 = 
nodeAcquœe
(
pRŒ“
, 
iNode
, 0, &
pChžd
->
pP¬’t
);

149851 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pR—dP¬’t
);

149852 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

149853 ifÐ
	grc
==
SQLITE_OK
 && !
pChžd
->
pP¬’t
 ) 
rc
 = 
SQLITE_CORRUPT_VTAB
;

149854 
	gpChžd
 = 
pChžd
->
pP¬’t
;

149856  
	grc
;

149859 
d–‘eC–l
(
RŒ“
 *, 
RŒ“Node
 *, , );

149861 
»moveNode
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
, 
iHeight
){

149862 
	grc
;

149863 
	grc2
;

149864 
RŒ“Node
 *
	gpP¬’t
 = 0;

149865 
	giC–l
;

149867 
as£¹
Ð
pNode
->
nRef
==1 );

149870 
	grc
 = 
nodeP¬’tIndex
(
pRŒ“
, 
pNode
, &
iC–l
);

149871 ifÐ
	grc
==
SQLITE_OK
 ){

149872 
pP¬’t
 = 
pNode
->pParent;

149873 
	gpNode
->
	gpP¬’t
 = 0;

149874 
	grc
 = 
d–‘eC–l
(
pRŒ“
, 
pP¬’t
, 
iC–l
, 
iHeight
+1);

149876 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pP¬’t
);

149877 ifÐ
	grc
==
SQLITE_OK
 ){

149878 
rc
 = 
rc2
;

149880 ifÐ
	grc
!=
SQLITE_OK
 ){

149881  
rc
;

149885 
sql™e3_bšd_št64
(
pRŒ“
->
pD–‘eNode
, 1, 
pNode
->
iNode
);

149886 
sql™e3_¡•
(
pRŒ“
->
pD–‘eNode
);

149887 ifÐ
	gSQLITE_OK
!=(
rc
 = 
sql™e3_»£t
(
pRŒ“
->
pD–‘eNode
)) ){

149888  
rc
;

149892 
sql™e3_bšd_št64
(
pRŒ“
->
pD–‘eP¬’t
, 1, 
pNode
->
iNode
);

149893 
sql™e3_¡•
(
pRŒ“
->
pD–‘eP¬’t
);

149894 ifÐ
	gSQLITE_OK
!=(
rc
 = 
sql™e3_»£t
(
pRŒ“
->
pD–‘eP¬’t
)) ){

149895  
rc
;

149901 
nodeHashD–‘e
(
pRŒ“
, 
pNode
);

149902 
	gpNode
->
	giNode
 = 
iHeight
;

149903 
	gpNode
->
	gpNext
 = 
pRŒ“
->
pD–‘ed
;

149904 
	gpNode
->
	gnRef
++;

149905 
	gpRŒ“
->
	gpD–‘ed
 = 
pNode
;

149907  
	gSQLITE_OK
;

149910 
fixBoundšgBox
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

149911 
RŒ“Node
 *
	gpP¬’t
 = 
pNode
->
pP¬’t
;

149912 
	grc
 = 
SQLITE_OK
;

149913 ifÐ
	gpP¬’t
 ){

149914 
	gii
;

149915 
	gnC–l
 = 
NCELL
(
pNode
);

149916 
RŒ“C–l
 
	gbox
;

149917 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 0, &
box
);

149918 
	gii
=1; ii<
	gnC–l
; ii++){

149919 
RŒ“C–l
 
	gûÎ
;

149920 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 
ii
, &
ûÎ
);

149921 
ûÎUniÚ
(
pRŒ“
, &
box
, &
ûÎ
);

149923 
	gbox
.
	giRowid
 = 
pNode
->
iNode
;

149924 
	grc
 = 
nodeP¬’tIndex
(
pRŒ“
, 
pNode
, &
ii
);

149925 ifÐ
	grc
==
SQLITE_OK
 ){

149926 
nodeOv”wr™eC–l
(
pRŒ“
, 
pP¬’t
, &
box
, 
ii
);

149927 
	grc
 = 
fixBoundšgBox
(
pRŒ“
, 
pP¬’t
);

149930  
	grc
;

149937 
d–‘eC–l
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
, 
iC–l
, 
iHeight
){

149938 
RŒ“Node
 *
	gpP¬’t
;

149939 
	grc
;

149941 ifÐ
	gSQLITE_OK
!=(
rc
 = 
fixL—fP¬’t
(
pRŒ“
, 
pNode
)) ){

149942  
	grc
;

149948 
nodeD–‘eC–l
(
pRŒ“
, 
pNode
, 
iC–l
);

149955 
	gpP¬’t
 = 
pNode
->
pP¬’t
;

149956 
as£¹
Ð
pP¬’t
 || 
pNode
->
iNode
==1 );

149957 ifÐ
	gpP¬’t
 ){

149958 ifÐ
NCELL
(
pNode
)<
RTREE_MINCELLS
(
pRŒ“
) ){

149959 
	grc
 = 
»moveNode
(
pRŒ“
, 
pNode
, 
iHeight
);

149961 
	grc
 = 
fixBoundšgBox
(
pRŒ“
, 
pNode
);

149965  
	grc
;

149968 
Reš£¹
(

149969 
RŒ“
 *
pRŒ“
,

149970 
RŒ“Node
 *
pNode
,

149971 
RŒ“C–l
 *
pC–l
,

149972 
iHeight


149974 *
	gaOrd”
;

149975 *
	gaS·»
;

149976 
RŒ“C–l
 *
	gaC–l
;

149977 
RŒ“DV®ue
 *
	gaDi¡ªû
;

149978 
	gnC–l
;

149979 
RŒ“DV®ue
 
	gaC’‹rCoÜd
[
RTREE_MAX_DIMENSIONS
];

149980 
	giDim
;

149981 
	gii
;

149982 
	grc
 = 
SQLITE_OK
;

149983 
	gn
;

149985 
mem£t
(
aC’‹rCoÜd
, 0, (
RŒ“DV®ue
)*
RTREE_MAX_DIMENSIONS
);

149987 
	gnC–l
 = 
NCELL
(
pNode
)+1;

149988 
	gn
 = (
nC–l
+1)&(~1);

149993 
	gaC–l
 = (
RŒ“C–l
 *)
sql™e3_m®loc
(
n
 * (

149994 (
RŒ“C–l
) +

149997 (
RŒ“DV®ue
)

149999 ifÐ!
	gaC–l
 ){

150000  
	gSQLITE_NOMEM
;

150002 
	gaOrd”
 = (*)&
aC–l
[
n
];

150003 
	gaS·»
 = (*)&
aOrd”
[
n
];

150004 
	gaDi¡ªû
 = (
RŒ“DV®ue
 *)&
aS·»
[
n
];

150006 
	gii
=0; ii<
	gnC–l
; ii++){

150007 ifÐ
	gii
==(
nC–l
-1) ){

150008 
memýy
(&
aC–l
[
ii
], 
pC–l
, (
RŒ“C–l
));

150010 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 
ii
, &
aC–l
[ii]);

150012 
	gaOrd”
[
ii
] = ii;

150013 
	giDim
=0; iDim<
	gpRŒ“
->
	gnDim
; iDim++){

150014 
	gaC’‹rCoÜd
[
iDim
] +ð
DCOORD
(
aC–l
[
ii
].
aCoÜd
[iDim*2]);

150015 
	gaC’‹rCoÜd
[
iDim
] +ð
DCOORD
(
aC–l
[
ii
].
aCoÜd
[iDim*2+1]);

150018 
	giDim
=0; iDim<
	gpRŒ“
->
	gnDim
; iDim++){

150019 
	gaC’‹rCoÜd
[
iDim
] = (
aC’‹rCoÜd
[iDim]/(
nC–l
*(
RŒ“DV®ue
)2));

150022 
	gii
=0; ii<
	gnC–l
; ii++){

150023 
	gaDi¡ªû
[
ii
] = 
RTREE_ZERO
;

150024 
	giDim
=0; iDim<
	gpRŒ“
->
	gnDim
; iDim++){

150025 
RŒ“DV®ue
 
	gcoÜd
 = (
DCOORD
(
aC–l
[
ii
].
aCoÜd
[
iDim
*2+1]) -

150026 
DCOORD
(
aC–l
[
ii
].
aCoÜd
[
iDim
*2]));

150027 
	gaDi¡ªû
[
ii
] +ð(
coÜd
-
aC’‹rCoÜd
[
iDim
])*(coord-aCenterCoord[iDim]);

150031 
SÜtByDi¡ªû
(
aOrd”
, 
nC–l
, 
aDi¡ªû
, 
aS·»
);

150032 
nodeZ”o
(
pRŒ“
, 
pNode
);

150034 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<(
nC–l
-(
RTREE_MINCELLS
(
pRŒ“
)+1)); ii++){

150035 
RŒ“C–l
 *
	gp
 = &
aC–l
[
aOrd”
[
ii
]];

150036 
nodeIn£¹C–l
(
pRŒ“
, 
pNode
, 
p
);

150037 ifÐ
	gp
->
	giRowid
==
pC–l
->
iRowid
 ){

150038 ifÐ
iHeight
==0 ){

150039 
rc
 = 
rowidWr™e
(
pRŒ“
, 
p
->
iRowid
, 
pNode
->
iNode
);

150041 
	grc
 = 
·»ÁWr™e
(
pRŒ“
, 
p
->
iRowid
, 
pNode
->
iNode
);

150045 ifÐ
	grc
==
SQLITE_OK
 ){

150046 
rc
 = 
fixBoundšgBox
(
pRŒ“
, 
pNode
);

150048 ; 
	grc
==
SQLITE_OK
 && 
ii
<
nC–l
; 
	gii
++){

150052 
RŒ“Node
 *
	gpIn£¹
;

150053 
RŒ“C–l
 *
	gp
 = &
aC–l
[
aOrd”
[
ii
]];

150054 
	grc
 = 
Choo£L—f
(
pRŒ“
, 
p
, 
iHeight
, &
pIn£¹
);

150055 ifÐ
	grc
==
SQLITE_OK
 ){

150056 
rc2
;

150057 
	grc
 = 
¹»eIn£¹C–l
(
pRŒ“
, 
pIn£¹
, 
p
, 
iHeight
);

150058 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pIn£¹
);

150059 ifÐ
	grc
==
SQLITE_OK
 ){

150060 
rc
 = 
rc2
;

150065 
sql™e3_ä“
(
aC–l
);

150066  
	grc
;

150073 
¹»eIn£¹C–l
(

150074 
RŒ“
 *
pRŒ“
,

150075 
RŒ“Node
 *
pNode
,

150076 
RŒ“C–l
 *
pC–l
,

150077 
iHeight


150079 
	grc
 = 
SQLITE_OK
;

150080 ifÐ
	giHeight
>0 ){

150081 
RŒ“Node
 *
	gpChžd
 = 
nodeHashLookup
(
pRŒ“
, 
pC–l
->
iRowid
);

150082 ifÐ
	gpChžd
 ){

150083 
nodeR–—£
(
pRŒ“
, 
pChžd
->
pP¬’t
);

150084 
nodeReã»nû
(
pNode
);

150085 
	gpChžd
->
	gpP¬’t
 = 
pNode
;

150088 ifÐ
nodeIn£¹C–l
(
pRŒ“
, 
pNode
, 
pC–l
) ){

150089 ifÐ
	giHeight
<=
pRŒ“
->
iReš£¹Height
 || 
pNode
->
iNode
==1){

150090 
rc
 = 
S¶™Node
(
pRŒ“
, 
pNode
, 
pC–l
, 
iHeight
);

150092 
	gpRŒ“
->
	giReš£¹Height
 = 
iHeight
;

150093 
	grc
 = 
Reš£¹
(
pRŒ“
, 
pNode
, 
pC–l
, 
iHeight
);

150096 
	grc
 = 
Adju¡T»e
(
pRŒ“
, 
pNode
, 
pC–l
);

150097 ifÐ
	grc
==
SQLITE_OK
 ){

150098 ifÐ
iHeight
==0 ){

150099 
rc
 = 
rowidWr™e
(
pRŒ“
, 
pC–l
->
iRowid
, 
pNode
->
iNode
);

150101 
	grc
 = 
·»ÁWr™e
(
pRŒ“
, 
pC–l
->
iRowid
, 
pNode
->
iNode
);

150105  
	grc
;

150108 
»š£¹NodeCÚ‹Á
(
RŒ“
 *
pRŒ“
, 
RŒ“Node
 *
pNode
){

150109 
	gii
;

150110 
	grc
 = 
SQLITE_OK
;

150111 
	gnC–l
 = 
NCELL
(
pNode
);

150113 
	gii
=0; 
	grc
==
SQLITE_OK
 && 
ii
<
nC–l
; ii++){

150114 
RŒ“Node
 *
	gpIn£¹
;

150115 
RŒ“C–l
 
	gûÎ
;

150116 
nodeG‘C–l
(
pRŒ“
, 
pNode
, 
ii
, &
ûÎ
);

150121 
	grc
 = 
Choo£L—f
(
pRŒ“
, &
ûÎ
, ()
pNode
->
iNode
, &
pIn£¹
);

150122 ifÐ
	grc
==
SQLITE_OK
 ){

150123 
rc2
;

150124 
	grc
 = 
¹»eIn£¹C–l
(
pRŒ“
, 
pIn£¹
, &
ûÎ
, ()
pNode
->
iNode
);

150125 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pIn£¹
);

150126 ifÐ
	grc
==
SQLITE_OK
 ){

150127 
rc
 = 
rc2
;

150131  
	grc
;

150137 
ÃwRowid
(
RŒ“
 *
pRŒ“
, 
i64
 *
piRowid
){

150138 
	grc
;

150139 
sql™e3_bšd_nuÎ
(
pRŒ“
->
pWr™eRowid
, 1);

150140 
sql™e3_bšd_nuÎ
(
pRŒ“
->
pWr™eRowid
, 2);

150141 
sql™e3_¡•
(
pRŒ“
->
pWr™eRowid
);

150142 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pWr™eRowid
);

150143 *
	gpiRowid
 = 
sql™e3_Ï¡_š£¹_rowid
(
pRŒ“
->
db
);

150144  
	grc
;

150150 
¹»eD–‘eRowid
(
RŒ“
 *
pRŒ“
, 
sql™e3_št64
 
iD–‘e
){

150151 
	grc
;

150152 
RŒ“Node
 *
	gpL—f
 = 0;

150153 
	giC–l
;

150154 
RŒ“Node
 *
	gpRoÙ
;

150158 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 1, 0, &
pRoÙ
);

150163 ifÐ
	grc
==
SQLITE_OK
 ){

150164 
rc
 = 
fšdL—fNode
(
pRŒ“
, 
iD–‘e
, &
pL—f
, 0);

150168 ifÐ
	grc
==
SQLITE_OK
 ){

150169 
rc2
;

150170 
	grc
 = 
nodeRowidIndex
(
pRŒ“
, 
pL—f
, 
iD–‘e
, &
iC–l
);

150171 ifÐ
	grc
==
SQLITE_OK
 ){

150172 
rc
 = 
d–‘eC–l
(
pRŒ“
, 
pL—f
, 
iC–l
, 0);

150174 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pL—f
);

150175 ifÐ
	grc
==
SQLITE_OK
 ){

150176 
rc
 = 
rc2
;

150181 ifÐ
	grc
==
SQLITE_OK
 ){

150182 
sql™e3_bšd_št64
(
pRŒ“
->
pD–‘eRowid
, 1, 
iD–‘e
);

150183 
sql™e3_¡•
(
pRŒ“
->
pD–‘eRowid
);

150184 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pD–‘eRowid
);

150195 ifÐ
	grc
==
SQLITE_OK
 && 
pRŒ“
->
iD•th
>0 && 
NCELL
(
pRoÙ
)==1 ){

150196 
rc2
;

150197 
RŒ“Node
 *
	gpChžd
;

150198 
i64
 
	giChžd
 = 
nodeG‘Rowid
(
pRŒ“
, 
pRoÙ
, 0);

150199 
	grc
 = 
nodeAcquœe
(
pRŒ“
, 
iChžd
, 
pRoÙ
, &
pChžd
);

150200 ifÐ
	grc
==
SQLITE_OK
 ){

150201 
rc
 = 
»moveNode
(
pRŒ“
, 
pChžd
,…RŒ“->
iD•th
-1);

150203 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pChžd
);

150204 ifÐ
	grc
==
SQLITE_OK
 ) 
rc
 = 
rc2
;

150205 ifÐ
	grc
==
SQLITE_OK
 ){

150206 
pRŒ“
->
iD•th
--;

150207 
wr™eIÁ16
(
pRoÙ
->
zD©a
, 
pRŒ“
->
iD•th
);

150208 
	gpRoÙ
->
	gisDœty
 = 1;

150213 
	gpL—f
=
pRŒ“
->
pD–‘ed
;…Leaf;…Leaf=pRtree->pDeleted){

150214 ifÐ
rc
==
SQLITE_OK
 ){

150215 
rc
 = 
»š£¹NodeCÚ‹Á
(
pRŒ“
, 
pL—f
);

150217 
	gpRŒ“
->
	gpD–‘ed
 = 
pL—f
->
pNext
;

150218 
sql™e3_ä“
(
pL—f
);

150222 ifÐ
	grc
==
SQLITE_OK
 ){

150223 
rc
 = 
nodeR–—£
(
pRŒ“
, 
pRoÙ
);

150225 
nodeR–—£
(
pRŒ“
, 
pRoÙ
);

150228  
	grc
;

150234 
	#RNDTOWARDS
 (1.0 - 1.0/8388608.0è

	)

150235 
	#RNDAWAY
 (1.0 + 1.0/8388608.0è

	)

150237 #ià!
defšed
(
SQLITE_RTREE_INT_ONLY
)

150242 
RŒ“V®ue
 
¹»eV®ueDown
(
sql™e3_v®ue
 *
v
){

150243 
	gd
 = 
sql™e3_v®ue_doubË
(
v
);

150244 
	gf
 = ()
d
;

150245 ifÐ
	gf
>
	gd
 ){

150246 
	gf
 = ()(
d
*(d<0 ? 
RNDAWAY
 : 
RNDTOWARDS
));

150248  
	gf
;

150250 
RŒ“V®ue
 
¹»eV®ueUp
(
sql™e3_v®ue
 *
v
){

150251 
	gd
 = 
sql™e3_v®ue_doubË
(
v
);

150252 
	gf
 = ()
d
;

150253 ifÐ
	gf
<
	gd
 ){

150254 
	gf
 = ()(
d
*(d<0 ? 
RNDTOWARDS
 : 
RNDAWAY
));

150256  
	gf
;

150264 
¹»eUpd©e
(

150265 
sql™e3_vb
 *
pVb
,

150266 
nD©a
,

150267 
sql™e3_v®ue
 **
azD©a
,

150268 
sql™e_št64
 *
pRowid


150270 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)
pVb
;

150271 
	grc
 = 
SQLITE_OK
;

150272 
RŒ“C–l
 
	gûÎ
;

150273 
	gbHaveRowid
 = 0;

150275 
¹»eReã»nû
(
pRŒ“
);

150276 
as£¹
(
nD©a
>=1);

150289 ifÐ
	gnD©a
>1 ){

150290 
	gii
;

150293 
as£¹
Ð
nD©a
==(
pRŒ“
->
nDim
*2 + 3) );

150294 #iâdeà
SQLITE_RTREE_INT_ONLY


150295 ifÐ
	gpRŒ“
->
	geCoÜdTy³
==
RTREE_COORD_REAL32
 ){

150296 
ii
=0; 
	gii
<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

150297 
ûÎ
.
aCoÜd
[
ii
].
f
 = 
¹»eV®ueDown
(
azD©a
[ii+3]);

150298 
	gûÎ
.
	gaCoÜd
[
ii
+1].
	gf
 = 
¹»eV®ueUp
(
azD©a
[ii+4]);

150299 ifÐ
	gûÎ
.
	gaCoÜd
[
ii
].
	gf
>cell.aCoord[ii+1].f ){

150300 
	grc
 = 
SQLITE_CONSTRAINT
;

150301 
	gcÚ¡¿št
;

150307 
	gii
=0; ii<(
	gpRŒ“
->
	gnDim
*2); ii+=2){

150308 
ûÎ
.
aCoÜd
[
ii
].
i
 = 
sql™e3_v®ue_št
(
azD©a
[ii+3]);

150309 
	gûÎ
.
	gaCoÜd
[
ii
+1].
	gi
 = 
sql™e3_v®ue_št
(
azD©a
[ii+4]);

150310 ifÐ
	gûÎ
.
	gaCoÜd
[
ii
].
	gi
>cell.aCoord[ii+1].i ){

150311 
	grc
 = 
SQLITE_CONSTRAINT
;

150312 
	gcÚ¡¿št
;

150319 ifÐ
sql™e3_v®ue_ty³
(
azD©a
[2])!=
SQLITE_NULL
 ){

150320 
ûÎ
.
iRowid
 = 
sql™e3_v®ue_št64
(
azD©a
[2]);

150321 ifÐ
sql™e3_v®ue_ty³
(
azD©a
[0])==
SQLITE_NULL


150322 || 
sql™e3_v®ue_št64
(
azD©a
[0])!=
ûÎ
.
iRowid


150324 
¡•rc
;

150325 
sql™e3_bšd_št64
(
pRŒ“
->
pR—dRowid
, 1, 
ûÎ
.
iRowid
);

150326 
	g¡•rc
 = 
sql™e3_¡•
(
pRŒ“
->
pR—dRowid
);

150327 
	grc
 = 
sql™e3_»£t
(
pRŒ“
->
pR—dRowid
);

150328 ifÐ
	gSQLITE_ROW
==
¡•rc
 ){

150329 ifÐ
sql™e3_vb_Ú_cÚæiù
(
pRŒ“
->
db
)==
SQLITE_REPLACE
 ){

150330 
rc
 = 
¹»eD–‘eRowid
(
pRŒ“
, 
ûÎ
.
iRowid
);

150332 
	grc
 = 
SQLITE_CONSTRAINT
;

150333 
	gcÚ¡¿št
;

150337 
	gbHaveRowid
 = 1;

150345 ifÐ
sql™e3_v®ue_ty³
(
azD©a
[0])!=
SQLITE_NULL
 ){

150346 
rc
 = 
¹»eD–‘eRowid
(
pRŒ“
, 
sql™e3_v®ue_št64
(
azD©a
[0]));

150353 ifÐ
	grc
==
SQLITE_OK
 && 
nD©a
>1 ){

150355 
RŒ“Node
 *
pL—f
 = 0;

150358 ifÐ
	gbHaveRowid
==0 ){

150359 
rc
 = 
ÃwRowid
(
pRŒ“
, &
ûÎ
.
iRowid
);

150361 *
	gpRowid
 = 
ûÎ
.
iRowid
;

150363 ifÐ
	grc
==
SQLITE_OK
 ){

150364 
rc
 = 
Choo£L—f
(
pRŒ“
, &
ûÎ
, 0, &
pL—f
);

150366 ifÐ
	grc
==
SQLITE_OK
 ){

150367 
rc2
;

150368 
	gpRŒ“
->
	giReš£¹Height
 = -1;

150369 
	grc
 = 
¹»eIn£¹C–l
(
pRŒ“
, 
pL—f
, &
ûÎ
, 0);

150370 
	grc2
 = 
nodeR–—£
(
pRŒ“
, 
pL—f
);

150371 ifÐ
	grc
==
SQLITE_OK
 ){

150372 
rc
 = 
rc2
;

150377 
	gcÚ¡¿št
:

150378 
¹»eR–—£
(
pRŒ“
);

150379  
	grc
;

150385 
¹»eR’ame
(
sql™e3_vb
 *
pVb
, cÚ¡ *
zNewName
){

150386 
RŒ“
 *
	gpRŒ“
 = (RŒ“ *)
pVb
;

150387 
	grc
 = 
SQLITE_NOMEM
;

150388 *
	gzSql
 = 
sql™e3_m´štf
(

150392 , 
pRŒ“
->
zDb
,…RŒ“->
zName
, 
zNewName


150393 , 
pRŒ“
->
zDb
,…RŒ“->
zName
, 
zNewName


150394 , 
pRŒ“
->
zDb
,…RŒ“->
zName
, 
zNewName


150396 ifÐ
	gzSql
 ){

150397 
	grc
 = 
sql™e3_exec
(
pRŒ“
->
db
, 
zSql
, 0, 0, 0);

150398 
sql™e3_ä“
(
zSql
);

150400  
	grc
;

150408 
¹»eQu”ySt1
(
sql™e3
 *
db
, 
RŒ“
 *
pRŒ“
){

150409 cÚ¡ *
	gzFmt
 = "SELECT stat FROM %Q.sqlite_stat1 WHEREbl = '%q_rowid'";

150410 *
	gzSql
;

150411 
sql™e3_¡mt
 *
	gp
;

150412 
	grc
;

150413 
i64
 
	gnRow
 = 0;

150415 
	gzSql
 = 
sql™e3_m´štf
(
zFmt
, 
pRŒ“
->
zDb
,…RŒ“->
zName
);

150416 ifÐ
	gzSql
==0 ){

150417 
rc
 = 
SQLITE_NOMEM
;

150419 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
p
, 0);

150420 ifÐ
	grc
==
SQLITE_OK
 ){

150421 ifÐ
sql™e3_¡•
(
p
)==
SQLITE_ROW
 ) 
nRow
 = 
sql™e3_cÞumn_št64
(p, 0);

150422 
	grc
 = 
sql™e3_fš®ize
(
p
);

150423 }ifÐ
	grc
!=
SQLITE_NOMEM
 ){

150424 
rc
 = 
SQLITE_OK
;

150427 ifÐ
	grc
==
SQLITE_OK
 ){

150428 ifÐ
nRow
==0 ){

150429 
pRŒ“
->
nRowE¡
 = 
RTREE_DEFAULT_ROWEST
;

150431 
	gpRŒ“
->
	gnRowE¡
 = 
MAX
(
nRow
, 
RTREE_MIN_ROWEST
);

150434 
sql™e3_ä“
(
zSql
);

150437  
	grc
;

150440 
sql™e3_moduË
 
	g¹»eModuË
 = {

150442 
¹»eC»©e
,

150443 
¹»eCÚÃù
,

150444 
¹»eBe¡Index
,

150445 
¹»eDiscÚÃù
,

150446 
¹»eDe¡roy
,

150447 
¹»eO³n
,

150448 
¹»eClo£
,

150449 
¹»eFž‹r
,

150450 
¹»eNext
,

150451 
¹»eEof
,

150452 
¹»eCÞumn
,

150453 
¹»eRowid
,

150454 
¹»eUpd©e
,

150460 
¹»eR’ame
,

150466 
¹»eSqlIn™
(

150467 
RŒ“
 *
pRŒ“
,

150468 
sql™e3
 *
db
,

150469 cÚ¡ *
zDb
,

150470 cÚ¡ *
zP»fix
,

150471 
isC»©e


150473 
	grc
 = 
SQLITE_OK
;

150475 
	#N_STATEMENT
 9

	)

150476 cÚ¡ *
	gazSql
[
N_STATEMENT
] = {

150492 
sql™e3_¡mt
 **
	g­pStmt
[
N_STATEMENT
];

150493 
	gi
;

150495 
	gpRŒ“
->
	gdb
 = 
db
;

150497 ifÐ
	gisC»©e
 ){

150498 *
	gzC»©e
 = 
sql™e3_m´štf
(

150504 
zDb
, 
zP»fix
, zDb, zP»fix, zDb, zP»fix, zDb, zP»fix, 
pRŒ“
->
iNodeSize


150506 ifÐ!
	gzC»©e
 ){

150507  
	gSQLITE_NOMEM
;

150509 
	grc
 = 
sql™e3_exec
(
db
, 
zC»©e
, 0, 0, 0);

150510 
sql™e3_ä“
(
zC»©e
);

150511 ifÐ
	grc
!=
SQLITE_OK
 ){

150512  
rc
;

150516 
	g­pStmt
[0] = &
pRŒ“
->
pR—dNode
;

150517 
	g­pStmt
[1] = &
pRŒ“
->
pWr™eNode
;

150518 
	g­pStmt
[2] = &
pRŒ“
->
pD–‘eNode
;

150519 
	g­pStmt
[3] = &
pRŒ“
->
pR—dRowid
;

150520 
	g­pStmt
[4] = &
pRŒ“
->
pWr™eRowid
;

150521 
	g­pStmt
[5] = &
pRŒ“
->
pD–‘eRowid
;

150522 
	g­pStmt
[6] = &
pRŒ“
->
pR—dP¬’t
;

150523 
	g­pStmt
[7] = &
pRŒ“
->
pWr™eP¬’t
;

150524 
	g­pStmt
[8] = &
pRŒ“
->
pD–‘eP¬’t
;

150526 
	grc
 = 
¹»eQu”ySt1
(
db
, 
pRŒ“
);

150527 
	gi
=0; i<
	gN_STATEMENT
 && 
	grc
==
SQLITE_OK
; i++){

150528 *
	gzSql
 = 
sql™e3_m´štf
(
azSql
[
i
], 
zDb
, 
zP»fix
);

150529 ifÐ
	gzSql
 ){

150530 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, 
­pStmt
[
i
], 0);

150532 
	grc
 = 
SQLITE_NOMEM
;

150534 
sql™e3_ä“
(
zSql
);

150537  
	grc
;

150547 
g‘IÁFromStmt
(
sql™e3
 *
db
, cÚ¡ *
zSql
, *
piV®
){

150548 
	grc
 = 
SQLITE_NOMEM
;

150549 ifÐ
	gzSql
 ){

150550 
sql™e3_¡mt
 *
	gpStmt
 = 0;

150551 
	grc
 = 
sql™e3_´•¬e_v2
(
db
, 
zSql
, -1, &
pStmt
, 0);

150552 ifÐ
	grc
==
SQLITE_OK
 ){

150553 ifÐ
SQLITE_ROW
==
sql™e3_¡•
(
pStmt
) ){

150554 *
piV®
 = 
sql™e3_cÞumn_št
(
pStmt
, 0);

150556 
	grc
 = 
sql™e3_fš®ize
(
pStmt
);

150559  
	grc
;

150577 
g‘NodeSize
(

150578 
sql™e3
 *
db
,

150579 
RŒ“
 *
pRŒ“
,

150580 
isC»©e
,

150581 **
pzE¼


150583 
	grc
;

150584 *
	gzSql
;

150585 ifÐ
	gisC»©e
 ){

150586 
	giPageSize
 = 0;

150587 
	gzSql
 = 
sql™e3_m´štf
("PRAGMA %Q.·ge_size", 
pRŒ“
->
zDb
);

150588 
	grc
 = 
g‘IÁFromStmt
(
db
, 
zSql
, &
iPageSize
);

150589 ifÐ
	grc
==
SQLITE_OK
 ){

150590 
pRŒ“
->
iNodeSize
 = 
iPageSize
-64;

150591 ifÐ(4+
	gpRŒ“
->
nBy‹sP”C–l
*
	gRTREE_MAXCELLS
)<pRŒ“->
	giNodeSize
 ){

150592 
	gpRŒ“
->
	giNodeSize
 = 4+
pRŒ“
->
nBy‹sP”C–l
*
RTREE_MAXCELLS
;

150595 *
	gpzE¼
 = 
sql™e3_m´štf
("%s", 
sql™e3_”rmsg
(
db
));

150598 
	gzSql
 = 
sql™e3_m´štf
(

150600 
pRŒ“
->
zDb
,…RŒ“->
zName


150602 
	grc
 = 
g‘IÁFromStmt
(
db
, 
zSql
, &
pRŒ“
->
iNodeSize
);

150603 ifÐ
	grc
!=
SQLITE_OK
 ){

150604 *
pzE¼
 = 
sql™e3_m´štf
("%s", 
sql™e3_”rmsg
(
db
));

150608 
sql™e3_ä“
(
zSql
);

150609  
	grc
;

150621 
¹»eIn™
(

150622 
sql™e3
 *
db
,

150623 *
pAux
,

150624 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

150625 
sql™e3_vb
 **
µVb
,

150626 **
pzE¼
,

150627 
isC»©e


150629 
	grc
 = 
SQLITE_OK
;

150630 
RŒ“
 *
	gpRŒ“
;

150631 
	gnDb
;

150632 
	gnName
;

150633 
	geCoÜdTy³
 = (
pAux
 ? 
RTREE_COORD_INT32
 : 
RTREE_COORD_REAL32
);

150635 cÚ¡ *
	gaE¼Msg
[] = {

150642 
	giE¼
 = (
¬gc
<6è? 2 :‡rgc>(
RTREE_MAX_DIMENSIONS
*2+4) ? 3 :‡rgc%2;

150643 ifÐ
	gaE¼Msg
[
iE¼
] ){

150644 *
	gpzE¼
 = 
sql™e3_m´štf
("%s", 
aE¼Msg
[
iE¼
]);

150645  
	gSQLITE_ERROR
;

150648 
sql™e3_vb_cÚfig
(
db
, 
SQLITE_VTAB_CONSTRAINT_SUPPORT
, 1);

150651 
	gnDb
 = ()
¡¾’
(
¬gv
[1]);

150652 
	gnName
 = ()
¡¾’
(
¬gv
[2]);

150653 
	gpRŒ“
 = (
RŒ“
 *)
sql™e3_m®loc
((RŒ“)+
nDb
+
nName
+2);

150654 ifÐ!
	gpRŒ“
 ){

150655  
	gSQLITE_NOMEM
;

150657 
mem£t
(
pRŒ“
, 0, (
RŒ“
)+
nDb
+
nName
+2);

150658 
	gpRŒ“
->
	gnBusy
 = 1;

150659 
	gpRŒ“
->
	gba£
.
	gpModuË
 = &
¹»eModuË
;

150660 
	gpRŒ“
->
	gzDb
 = (*)&
pRŒ“
[1];

150661 
	gpRŒ“
->
	gzName
 = &
pRŒ“
->
zDb
[
nDb
+1];

150662 
	gpRŒ“
->
	gnDim
 = (
¬gc
-4)/2;

150663 
	gpRŒ“
->
	gnBy‹sP”C–l
 = 8 + 
pRŒ“
->
nDim
*4*2;

150664 
	gpRŒ“
->
	geCoÜdTy³
 = 
eCoÜdTy³
;

150665 
memýy
(
pRŒ“
->
zDb
, 
¬gv
[1], 
nDb
);

150666 
memýy
(
pRŒ“
->
zName
, 
¬gv
[2], 
nName
);

150669 
	grc
 = 
g‘NodeSize
(
db
, 
pRŒ“
, 
isC»©e
, 
pzE¼
);

150675 ifÐ
	grc
==
SQLITE_OK
 ){

150676 ifÐ(
rc
 = 
¹»eSqlIn™
(
pRŒ“
, 
db
, 
¬gv
[1],‡rgv[2], 
isC»©e
)) ){

150677 *
	gpzE¼
 = 
sql™e3_m´štf
("%s", 
sql™e3_”rmsg
(
db
));

150679 *
	gzSql
 = 
sql™e3_m´štf
("CREATE TABLE x(%s", 
¬gv
[3]);

150680 *
	gzTmp
;

150681 
	gii
;

150682 
	gii
=4; 
	gzSql
 && ii<
	g¬gc
; ii++){

150683 
	gzTmp
 = 
zSql
;

150684 
	gzSql
 = 
sql™e3_m´štf
("%s, %s", 
zTmp
, 
¬gv
[
ii
]);

150685 
sql™e3_ä“
(
zTmp
);

150687 ifÐ
	gzSql
 ){

150688 
	gzTmp
 = 
zSql
;

150689 
	gzSql
 = 
sql™e3_m´štf
("%s);", 
zTmp
);

150690 
sql™e3_ä“
(
zTmp
);

150692 ifÐ!
	gzSql
 ){

150693 
	grc
 = 
SQLITE_NOMEM
;

150694 }ifÐ
	gSQLITE_OK
!=(
rc
 = 
sql™e3_deþ¬e_vb
(
db
, 
zSql
)) ){

150695 *
	gpzE¼
 = 
sql™e3_m´štf
("%s", 
sql™e3_”rmsg
(
db
));

150697 
sql™e3_ä“
(
zSql
);

150701 ifÐ
	grc
==
SQLITE_OK
 ){

150702 *
µVb
 = (
sql™e3_vb
 *)
pRŒ“
;

150704 
as£¹
Ð*
µVb
==0 );

150705 
as£¹
Ð
pRŒ“
->
nBusy
==1 );

150706 
¹»eR–—£
(
pRŒ“
);

150708  
	grc
;

150728 
¹»’ode
(
sql™e3_cÚ‹xt
 *
ùx
, 
nArg
, 
sql™e3_v®ue
 **
­Arg
){

150729 *
	gzText
 = 0;

150730 
RŒ“Node
 
	gnode
;

150731 
RŒ“
 
	gŒ“
;

150732 
	gii
;

150734 
UNUSED_PARAMETER
(
nArg
);

150735 
mem£t
(&
node
, 0, (
RŒ“Node
));

150736 
mem£t
(&
Œ“
, 0, (
RŒ“
));

150737 
	gŒ“
.
	gnDim
 = 
sql™e3_v®ue_št
(
­Arg
[0]);

150738 
	gŒ“
.
	gnBy‹sP”C–l
 = 8 + 8 * 
Œ“
.
nDim
;

150739 
	gnode
.
	gzD©a
 = (
u8
 *)
sql™e3_v®ue_blob
(
­Arg
[1]);

150741 
	gii
=0; ii<
NCELL
(&
node
); ii++){

150742 
	gzC–l
[512];

150743 
	gnC–l
 = 0;

150744 
RŒ“C–l
 
	gûÎ
;

150745 
	gjj
;

150747 
nodeG‘C–l
(&
Œ“
, &
node
, 
ii
, &
ûÎ
);

150748 
sql™e3_¢´štf
(512-
nC–l
,&
zC–l
[nC–l],"%Îd", 
ûÎ
.
iRowid
);

150749 
	gnC–l
 = ()
¡¾’
(
zC–l
);

150750 
	gjj
=0; jj<
	gŒ“
.
	gnDim
*2; jj++){

150751 #iâdeà
SQLITE_RTREE_INT_ONLY


150752 
sql™e3_¢´štf
(512-
nC–l
,&
zC–l
[nCell], " %g",

150753 ()
ûÎ
.
aCoÜd
[
jj
].
f
);

150755 
sql™e3_¢´štf
(512-
nC–l
,&
zC–l
[nCell], " %d",

150756 
ûÎ
.
aCoÜd
[
jj
].
i
);

150758 
	gnC–l
 = ()
¡¾’
(
zC–l
);

150761 ifÐ
	gzText
 ){

150762 *
	gzTextNew
 = 
sql™e3_m´štf
("% {%s}", 
zText
, 
zC–l
);

150763 
sql™e3_ä“
(
zText
);

150764 
	gzText
 = 
zTextNew
;

150766 
	gzText
 = 
sql™e3_m´štf
("{%s}", 
zC–l
);

150770 
sql™e3_»suÉ_‹xt
(
ùx
, 
zText
, -1, 
sql™e3_ä“
);

150782 
¹»ed•th
(
sql™e3_cÚ‹xt
 *
ùx
, 
nArg
, 
sql™e3_v®ue
 **
­Arg
){

150783 
UNUSED_PARAMETER
(
nArg
);

150784 ifÐ
sql™e3_v®ue_ty³
(
­Arg
[0])!=
SQLITE_BLOB


150785 || 
sql™e3_v®ue_by‹s
(
­Arg
[0])<2

150787 
sql™e3_»suÉ_”rÜ
(
ùx
, "Invalid‡rgumento„treedepth()", -1);

150789 
u8
 *
	gzBlob
 = (u8 *)
sql™e3_v®ue_blob
(
­Arg
[0]);

150790 
sql™e3_»suÉ_št
(
ùx
, 
»adIÁ16
(
zBlob
));

150799 
SQLITE_PRIVATE
 
sql™e3RŒ“In™
(
sql™e3
 *
db
){

150800 cÚ¡ 
	gutf8
 = 
SQLITE_UTF8
;

150801 
	grc
;

150803 
	grc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, "¹»’ode", 2, 
utf8
, 0, 
¹»’ode
, 0, 0);

150804 ifÐ
	grc
==
SQLITE_OK
 ){

150805 
rc
 = 
sql™e3_ü—‹_funùiÚ
(
db
, "¹»ed•th", 1, 
utf8
, 0,
¹»ed•th
, 0, 0);

150807 ifÐ
	grc
==
SQLITE_OK
 ){

150808 #ifdeà
SQLITE_RTREE_INT_ONLY


150809 *
c
 = (*)
RTREE_COORD_INT32
;

150811 *
	gc
 = (*)
RTREE_COORD_REAL32
;

150813 
	grc
 = 
sql™e3_ü—‹_moduË_v2
(
db
, "¹»e", &
¹»eModuË
, 
c
, 0);

150815 ifÐ
	grc
==
SQLITE_OK
 ){

150816 *
c
 = (*)
RTREE_COORD_INT32
;

150817 
	grc
 = 
sql™e3_ü—‹_moduË_v2
(
db
, "¹»e_i32", &
¹»eModuË
, 
c
, 0);

150820  
	grc
;

150830 
¹»eF»eC®lback
(*
p
){

150831 
RŒ“GeomC®lback
 *
	gpInfo
 = (RŒ“GeomC®lback*)
p
;

150832 ifÐ
	gpInfo
->
	gxDe¡ruùÜ
 )…Info->
xDe¡ruùÜ
(
pInfo
->
pCÚ‹xt
);

150833 
sql™e3_ä“
(
p
);

150850 
geomC®lback
(
sql™e3_cÚ‹xt
 *
ùx
, 
nArg
, 
sql™e3_v®ue
 **
aArg
){

150851 
RŒ“GeomC®lback
 *
	gpGeomCtx
 = (RŒ“GeomC®lback *)
sql™e3_u£r_d©a
(
ùx
);

150852 
RŒ“M©chArg
 *
	gpBlob
;

150853 
	gnBlob
;

150855 
	gnBlob
 = (
RŒ“M©chArg
è+ (
nArg
-1)*(
RŒ“DV®ue
);

150856 
	gpBlob
 = (
RŒ“M©chArg
 *)
sql™e3_m®loc
(
nBlob
);

150857 ifÐ!
	gpBlob
 ){

150858 
sql™e3_»suÉ_”rÜ_nomem
(
ùx
);

150860 
	gi
;

150861 
	gpBlob
->
	gmagic
 = 
RTREE_GEOMETRY_MAGIC
;

150862 
	gpBlob
->
	gcb
 = 
pGeomCtx
[0];

150863 
	gpBlob
->
	gnP¬am
 = 
nArg
;

150864 
	gi
=0; i<
	gnArg
; i++){

150865 #ifdeà
SQLITE_RTREE_INT_ONLY


150866 
	gpBlob
->
	gaP¬am
[
i
] = 
sql™e3_v®ue_št64
(
aArg
[i]);

150868 
	gpBlob
->
	gaP¬am
[
i
] = 
sql™e3_v®ue_doubË
(
aArg
[i]);

150871 
sql™e3_»suÉ_blob
(
ùx
, 
pBlob
, 
nBlob
, 
sql™e3_ä“
);

150878 
SQLITE_API
 
sql™e3_¹»e_geom‘ry_ÿÎback
(

150879 
sql™e3
 *
db
,

150880 cÚ¡ *
zGeom
,

150881 (*
xGeom
)(
sql™e3_¹»e_geom‘ry
*,,
RŒ“DV®ue
*,*),

150882 *
pCÚ‹xt


150884 
RŒ“GeomC®lback
 *
	gpGeomCtx
;

150887 
	gpGeomCtx
 = (
RŒ“GeomC®lback
 *)
sql™e3_m®loc
((RtreeGeomCallback));

150888 ifÐ!
	gpGeomCtx
 )  
	gSQLITE_NOMEM
;

150889 
	gpGeomCtx
->
	gxGeom
 = 
xGeom
;

150890 
	gpGeomCtx
->
	gxQu”yFunc
 = 0;

150891 
	gpGeomCtx
->
	gxDe¡ruùÜ
 = 0;

150892 
	gpGeomCtx
->
	gpCÚ‹xt
 = 
pCÚ‹xt
;

150893  
sql™e3_ü—‹_funùiÚ_v2
(
db
, 
zGeom
, -1, 
SQLITE_ANY
,

150894 (*)
pGeomCtx
, 
geomC®lback
, 0, 0, 
¹»eF»eC®lback


150902 
SQLITE_API
 
sql™e3_¹»e_qu”y_ÿÎback
(

150903 
sql™e3
 *
db
,

150904 cÚ¡ *
zQu”yFunc
,

150905 (*
xQu”yFunc
)(
sql™e3_¹»e_qu”y_šfo
*),

150906 *
pCÚ‹xt
,

150907 (*
xDe¡ruùÜ
)(*)

150909 
RŒ“GeomC®lback
 *
	gpGeomCtx
;

150912 
	gpGeomCtx
 = (
RŒ“GeomC®lback
 *)
sql™e3_m®loc
((RtreeGeomCallback));

150913 ifÐ!
	gpGeomCtx
 )  
	gSQLITE_NOMEM
;

150914 
	gpGeomCtx
->
	gxGeom
 = 0;

150915 
	gpGeomCtx
->
	gxQu”yFunc
 = 
xQu”yFunc
;

150916 
	gpGeomCtx
->
	gxDe¡ruùÜ
 = 
xDe¡ruùÜ
;

150917 
	gpGeomCtx
->
	gpCÚ‹xt
 = 
pCÚ‹xt
;

150918  
sql™e3_ü—‹_funùiÚ_v2
(
db
, 
zQu”yFunc
, -1, 
SQLITE_ANY
,

150919 (*)
pGeomCtx
, 
geomC®lback
, 0, 0, 
¹»eF»eC®lback


150923 #ià!
SQLITE_CORE


150924 #ifdeà
_WIN32


150925 
__deþ¥ec
(
dÎexpÜt
)

150927 
SQLITE_API
 
sql™e3_¹»e_š™
(

150928 
sql™e3
 *
db
,

150929 **
pzE¼Msg
,

150930 cÚ¡ 
sql™e3_­i_routšes
 *
pApi


150932 
SQLITE_EXTENSION_INIT2
(
pApi
)

150933  
sql™e3RŒ“In™
(
db
);

150971 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_ICU
)

150974 
	~<unicode/uty³s.h
>

150975 
	~<unicode/u»gex.h
>

150976 
	~<unicode/u¡ršg.h
>

150977 
	~<unicode/ucÞ.h
>

150981 #iâdeà
SQLITE_CORE


150982 
	gSQLITE_EXTENSION_INIT1


150990 #iâdeà
SQLITE_MAX_LIKE_PATTERN_LENGTH


150991 
	#SQLITE_MAX_LIKE_PATTERN_LENGTH
 50000

	)

150997 
xF»e
(*
p
){

150998 
sql™e3_ä“
(
p
);

151006 
icuLikeCom·»
(

151007 cÚ¡ 
ušt8_t
 *
zP©‹º
,

151008 cÚ¡ 
ušt8_t
 *
zSŒšg
,

151009 cÚ¡ 
UCh¬32
 
uEsc


151011 cÚ¡ 
	gMATCH_ONE
 = (
UCh¬32
)'_';

151012 cÚ¡ 
	gMATCH_ALL
 = (
UCh¬32
)'%';

151014 
	giP©‹º
 = 0;

151015 
	giSŒšg
 = 0;

151017 
	g´evEsÿ³
 = 0;

151019  
	gzP©‹º
[
iP©‹º
]!=0 ){

151022 
UCh¬32
 
uP©‹º
;

151023 
U8_NEXT_UNSAFE
(
zP©‹º
, 
iP©‹º
, 
uP©‹º
);

151024 
as£¹
(
uP©‹º
!=0);

151033 ifÐ!
	g´evEsÿ³
 && 
	guP©‹º
==
MATCH_ALL
 ){

151035 
ušt8_t
 
c
;

151041  (
	gc
=
zP©‹º
[
iP©‹º
]è=ð
MATCH_ALL
 || 
c
 =ð
MATCH_ONE
 ){

151042 ifÐ
c
==
MATCH_ONE
 ){

151043 ifÐ
zSŒšg
[
iSŒšg
]==0 )  0;

151044 
U8_FWD_1_UNSAFE
(
zSŒšg
, 
iSŒšg
);

151046 
	giP©‹º
++;

151049 ifÐ
	gzP©‹º
[
iP©‹º
]==0 )  1;

151051  
	gzSŒšg
[
iSŒšg
] ){

151052 ifÐ
icuLikeCom·»
(&
zP©‹º
[
iP©‹º
], &
zSŒšg
[
iSŒšg
], 
uEsc
) ){

151055 
U8_FWD_1_UNSAFE
(
zSŒšg
, 
iSŒšg
);

151059 }ifÐ!
	g´evEsÿ³
 && 
	guP©‹º
==
MATCH_ONE
 ){

151061 ifÐ
zSŒšg
[
iSŒšg
]==0 )  0;

151062 
U8_FWD_1_UNSAFE
(
zSŒšg
, 
iSŒšg
);

151064 }ifÐ!
	g´evEsÿ³
 && 
	guP©‹º
==
uEsc
){

151066 
´evEsÿ³
 = 1;

151070 
UCh¬32
 
	guSŒšg
;

151071 
U8_NEXT_UNSAFE
(
zSŒšg
, 
iSŒšg
, 
uSŒšg
);

151072 
	guSŒšg
 = 
u_fÞdCa£
(
uSŒšg
, 
U_FOLD_CASE_DEFAULT
);

151073 
	guP©‹º
 = 
u_fÞdCa£
(
uP©‹º
, 
U_FOLD_CASE_DEFAULT
);

151074 ifÐ
	guSŒšg
!=
uP©‹º
 ){

151077 
	g´evEsÿ³
 = 0;

151081  
	gzSŒšg
[
iSŒšg
]==0;

151097 
icuLikeFunc
(

151098 
sql™e3_cÚ‹xt
 *
cÚ‹xt
,

151099 
¬gc
,

151100 
sql™e3_v®ue
 **
¬gv


151102 cÚ¡ *
	gzA
 = 
sql™e3_v®ue_‹xt
(
¬gv
[0]);

151103 cÚ¡ *
	gzB
 = 
sql™e3_v®ue_‹xt
(
¬gv
[1]);

151104 
UCh¬32
 
	guEsc
 = 0;

151109 ifÐ
sql™e3_v®ue_by‹s
(
¬gv
[0])>
	gSQLITE_MAX_LIKE_PATTERN_LENGTH
 ){

151110 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
, "LIKE or GLOB…atternoo complex", -1);

151115 ifÐ
	g¬gc
==3 ){

151119 
nE
ð
sql™e3_v®ue_by‹s
(
¬gv
[2]);

151120 cÚ¡ *
	gzE
 = 
sql™e3_v®ue_‹xt
(
¬gv
[2]);

151121 
	gi
 = 0;

151122 ifÐ
	gzE
==0 ) ;

151123 
U8_NEXT
(
zE
, 
i
, 
nE
, 
uEsc
);

151124 ifÐ
	gi
!=
nE
){

151125 
sql™e3_»suÉ_”rÜ
(
cÚ‹xt
,

151131 ifÐ
	gzA
 && 
	gzB
 ){

151132 
sql™e3_»suÉ_št
(
cÚ‹xt
, 
icuLikeCom·»
(
zA
, 
zB
, 
uEsc
));

151143 
icuFunùiÚE¼Ü
(

151144 
sql™e3_cÚ‹xt
 *
pCtx
,

151145 cÚ¡ *
zName
,

151146 
UE¼ÜCode
 
e


151148 
	gzBuf
[128];

151149 
sql™e3_¢´štf
(128, 
zBuf
, "ICUƒ¼Ü: %s(): %s", 
zName
, 
u_”rÜName
(
e
));

151150 
	gzBuf
[127] = '\0';

151151 
sql™e3_»suÉ_”rÜ
(
pCtx
, 
zBuf
, -1);

151158 
icuRegexpD–‘e
(*
p
){

151159 
UReguÏrEx´essiÚ
 *
	gpEx´
 = (UReguÏrEx´essiÚ *)
p
;

151160 
u»gex_þo£
(
pEx´
);

151182 
icuRegexpFunc
(
sql™e3_cÚ‹xt
 *
p
, 
nArg
, 
sql™e3_v®ue
 **
­Arg
){

151183 
UE¼ÜCode
 
	g¡©us
 = 
U_ZERO_ERROR
;

151184 
UReguÏrEx´essiÚ
 *
	gpEx´
;

151185 
UBoÞ
 
	g»s
;

151186 cÚ¡ 
UCh¬
 *
	gzSŒšg
 = 
sql™e3_v®ue_‹xt16
(
­Arg
[1]);

151188 ()
	gnArg
;

151193 ifÐ!
	gzSŒšg
 ){

151197 
	gpEx´
 = 
sql™e3_g‘_auxd©a
(
p
, 0);

151198 ifÐ!
	gpEx´
 ){

151199 cÚ¡ 
UCh¬
 *
	gzP©‹º
 = 
sql™e3_v®ue_‹xt16
(
­Arg
[0]);

151200 ifÐ!
	gzP©‹º
 ){

151203 
	gpEx´
 = 
u»gex_Ý’
(
zP©‹º
, -1, 0, 0, &
¡©us
);

151205 ifÐ
U_SUCCESS
(
¡©us
) ){

151206 
sql™e3_£t_auxd©a
(
p
, 0, 
pEx´
, 
icuRegexpD–‘e
);

151208 
as£¹
(!
pEx´
);

151209 
icuFunùiÚE¼Ü
(
p
, "u»gex_Ý’", 
¡©us
);

151215 
u»gex_£tText
(
pEx´
, 
zSŒšg
, -1, &
¡©us
);

151216 ifÐ!
U_SUCCESS
(
¡©us
) ){

151217 
icuFunùiÚE¼Ü
(
p
, "u»gex_£tText", 
¡©us
);

151222 
	g»s
 = 
u»gex_m©ches
(
pEx´
, 0, &
¡©us
);

151223 ifÐ!
U_SUCCESS
(
¡©us
) ){

151224 
icuFunùiÚE¼Ü
(
p
, "u»gex_m©ches", 
¡©us
);

151233 
u»gex_£tText
(
pEx´
, 0, 0, &
¡©us
);

151236 
sql™e3_»suÉ_št
(
p
, 
»s
 ? 1 : 0);

151265 
icuCa£Func16
(
sql™e3_cÚ‹xt
 *
p
, 
nArg
, 
sql™e3_v®ue
 **
­Arg
){

151266 cÚ¡ 
UCh¬
 *
	gzIÅut
;

151267 
UCh¬
 *
	gzOuut
;

151268 
	gnIÅut
;

151269 
	gnOuut
;

151271 
UE¼ÜCode
 
	g¡©us
 = 
U_ZERO_ERROR
;

151272 cÚ¡ *
	gzLoÿË
 = 0;

151274 
as£¹
(
nArg
==1 ||‚Arg==2);

151275 ifÐ
	gnArg
==2 ){

151276 
zLoÿË
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­Arg
[1]);

151279 
	gzIÅut
 = 
sql™e3_v®ue_‹xt16
(
­Arg
[0]);

151280 ifÐ!
	gzIÅut
 ){

151283 
	gnIÅut
 = 
sql™e3_v®ue_by‹s16
(
­Arg
[0]);

151285 
	gnOuut
 = 
nIÅut
 * 2 + 2;

151286 
	gzOuut
 = 
sql™e3_m®loc
(
nOuut
);

151287 ifÐ!
	gzOuut
 ){

151291 ifÐ
sql™e3_u£r_d©a
(
p
) ){

151292 
u_¡rToUµ”
(
zOuut
, 
nOuut
/2, 
zIÅut
, 
nIÅut
/2, 
zLoÿË
, &
¡©us
);

151294 
u_¡rToLow”
(
zOuut
, 
nOuut
/2, 
zIÅut
, 
nIÅut
/2, 
zLoÿË
, &
¡©us
);

151297 ifÐ!
U_SUCCESS
(
¡©us
) ){

151298 
icuFunùiÚE¼Ü
(
p
, "u_¡rToLow”()/u_¡rToUµ”", 
¡©us
);

151302 
sql™e3_»suÉ_‹xt16
(
p
, 
zOuut
, -1, 
xF»e
);

151309 
icuCÞÏtiÚD–
(*
pCtx
){

151310 
UCÞÏtÜ
 *
	gp
 = (UCÞÏtÜ *)
pCtx
;

151311 
ucÞ_þo£
(
p
);

151318 
icuCÞÏtiÚCÞl
(

151319 *
pCtx
,

151320 
nLeá
,

151321 cÚ¡ *
zLeá
,

151322 
nRight
,

151323 cÚ¡ *
zRight


151325 
UCÞÏtiÚResuÉ
 
	g»s
;

151326 
UCÞÏtÜ
 *
	gp
 = (UCÞÏtÜ *)
pCtx
;

151327 
	g»s
 = 
ucÞ_¡rcÞl
(
p
, (
UCh¬
 *)
zLeá
, 
nLeá
/2, (UCh¬ *)
zRight
, 
nRight
/2);

151328  
	g»s
 ){

151329 
	gUCOL_LESS
:  -1;

151330 
	gUCOL_GREATER
:  +1;

151331 
	gUCOL_EQUAL
:  0;

151333 
as£¹
(!"Unexpected„eturn value from ucol_strcoll()");

151350 
icuLßdCÞÏtiÚ
(

151351 
sql™e3_cÚ‹xt
 *
p
,

151352 
nArg
,

151353 
sql™e3_v®ue
 **
­Arg


151355 
sql™e3
 *
	gdb
 = (sql™e3 *)
sql™e3_u£r_d©a
(
p
);

151356 
UE¼ÜCode
 
	g¡©us
 = 
U_ZERO_ERROR
;

151357 cÚ¡ *
	gzLoÿË
;

151358 cÚ¡ *
	gzName
;

151359 
UCÞÏtÜ
 *
	gpUCÞÏtÜ
;

151360 
	grc
;

151362 
as£¹
(
nArg
==2);

151363 
	gzLoÿË
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­Arg
[0]);

151364 
	gzName
 = (cÚ¡ *)
sql™e3_v®ue_‹xt
(
­Arg
[1]);

151366 ifÐ!
	gzLoÿË
 || !
	gzName
 ){

151370 
	gpUCÞÏtÜ
 = 
ucÞ_Ý’
(
zLoÿË
, &
¡©us
);

151371 ifÐ!
U_SUCCESS
(
¡©us
) ){

151372 
icuFunùiÚE¼Ü
(
p
, "ucÞ_Ý’", 
¡©us
);

151375 
as£¹
(
p
);

151377 
	grc
 = 
sql™e3_ü—‹_cÞÏtiÚ_v2
(
db
, 
zName
, 
SQLITE_UTF16
, (*)
pUCÞÏtÜ
,

151378 
icuCÞÏtiÚCÞl
, 
icuCÞÏtiÚD–


151380 ifÐ
	grc
!=
SQLITE_OK
 ){

151381 
ucÞ_þo£
(
pUCÞÏtÜ
);

151382 
sql™e3_»suÉ_”rÜ
(
p
, "Error„egistering collation function", -1);

151389 
SQLITE_PRIVATE
 
sql™e3IcuIn™
(
sql™e3
 *
db
){

151390 
	sIcuSÿÏr
 {

151391 cÚ¡ *
	gzName
;

151392 
	gnArg
;

151393 
	g’c
;

151394 *
	gpCÚ‹xt
;

151395 (*
	gxFunc
)(
	gsql™e3_cÚ‹xt
*,,
	gsql™e3_v®ue
**);

151396 } 
	gsÿÏrs
[] = {

151397 {"»gexp", 2, 
SQLITE_ANY
, 0, 
icuRegexpFunc
},

151399 {"low”", 1, 
SQLITE_UTF16
, 0, 
icuCa£Func16
},

151400 {"low”", 2, 
SQLITE_UTF16
, 0, 
icuCa£Func16
},

151401 {"uµ”", 1, 
SQLITE_UTF16
, (*)1, 
icuCa£Func16
},

151402 {"uµ”", 2, 
SQLITE_UTF16
, (*)1, 
icuCa£Func16
},

151404 {"low”", 1, 
SQLITE_UTF8
, 0, 
icuCa£Func16
},

151405 {"low”", 2, 
SQLITE_UTF8
, 0, 
icuCa£Func16
},

151406 {"uµ”", 1, 
SQLITE_UTF8
, (*)1, 
icuCa£Func16
},

151407 {"uµ”", 2, 
SQLITE_UTF8
, (*)1, 
icuCa£Func16
},

151409 {"like", 2, 
SQLITE_UTF8
, 0, 
icuLikeFunc
},

151410 {"like", 3, 
SQLITE_UTF8
, 0, 
icuLikeFunc
},

151412 {"icu_lßd_cÞÏtiÚ", 2, 
SQLITE_UTF8
, (*)
db
, 
icuLßdCÞÏtiÚ
},

151415 
	grc
 = 
SQLITE_OK
;

151416 
	gi
;

151418 
	gi
=0; 
	grc
==
SQLITE_OK
 && 
i
<()((
sÿÏrs
)/(scalars[0])); i++){

151419 
IcuSÿÏr
 *
	gp
 = &
sÿÏrs
[
i
];

151420 
	grc
 = 
sql™e3_ü—‹_funùiÚ
(

151421 
db
, 
p
->
zName
,…->
nArg
,…->
’c
,…->
pCÚ‹xt
,…->
xFunc
, 0, 0

151425  
	grc
;

151428 #ià!
SQLITE_CORE


151429 #ifdeà
_WIN32


151430 
__deþ¥ec
(
dÎexpÜt
)

151432 
SQLITE_API
 
sql™e3_icu_š™
(

151433 
sql™e3
 *
db
,

151434 **
pzE¼Msg
,

151435 cÚ¡ 
sql™e3_­i_routšes
 *
pApi


151437 
SQLITE_EXTENSION_INIT2
(
pApi
)

151438  
sql™e3IcuIn™
(
db
);

151459 #ià!
defšed
(
SQLITE_CORE
è|| defšed(
SQLITE_ENABLE_FTS3
)

151460 #ifdeà
SQLITE_ENABLE_ICU


151465 
	~<unicode/ubrk.h
>

151468 
	~<unicode/utf16.h
>

151470 
IcuTok’iz”
 
	tIcuTok’iz”
;

151471 
IcuCursÜ
 
	tIcuCursÜ
;

151473 
	sIcuTok’iz”
 {

151474 
sql™e3_tok’iz”
 
	gba£
;

151475 *
	gzLoÿË
;

151478 
	sIcuCursÜ
 {

151479 
sql™e3_tok’iz”_cursÜ
 
	gba£
;

151481 
UB»akI‹¿tÜ
 *
	gpI‹r
;

151482 
	gnCh¬
;

151483 
UCh¬
 *
	gaCh¬
;

151484 *
	gaOff£t
;

151486 
	gnBufãr
;

151487 *
	gzBufãr
;

151489 
	giTok’
;

151495 
icuC»©e
(

151496 
¬gc
,

151497 cÚ¡ * cÚ¡ *
¬gv
,

151498 
sql™e3_tok’iz”
 **
µTok’iz”


151500 
IcuTok’iz”
 *
	gp
;

151501 
	gn
 = 0;

151503 ifÐ
	g¬gc
>0 ){

151504 
	gn
 = 
¡¾’
(
¬gv
[0])+1;

151506 
	gp
 = (
IcuTok’iz”
 *)
sql™e3_m®loc
((IcuTok’iz”)+
n
);

151507 ifÐ!
	gp
 ){

151508  
	gSQLITE_NOMEM
;

151510 
mem£t
(
p
, 0, (
IcuTok’iz”
));

151512 ifÐ
	gn
 ){

151513 
	gp
->
	gzLoÿË
 = (*)&
p
[1];

151514 
memýy
(
p
->
zLoÿË
, 
¬gv
[0], 
n
);

151517 *
	gµTok’iz”
 = (
sql™e3_tok’iz”
 *)
p
;

151519  
	gSQLITE_OK
;

151525 
icuDe¡roy
(
sql™e3_tok’iz”
 *
pTok’iz”
){

151526 
IcuTok’iz”
 *
	gp
 = (IcuTok’iz” *)
pTok’iz”
;

151527 
sql™e3_ä“
(
p
);

151528  
	gSQLITE_OK
;

151537 
icuO³n
(

151538 
sql™e3_tok’iz”
 *
pTok’iz”
,

151539 cÚ¡ *
zIÅut
,

151540 
nIÅut
,

151541 
sql™e3_tok’iz”_cursÜ
 **
µCursÜ


151543 
IcuTok’iz”
 *
	gp
 = (IcuTok’iz” *)
pTok’iz”
;

151544 
IcuCursÜ
 *
	gpC¤
;

151546 cÚ¡ 
št32_t
 
	gÝt
 = 
U_FOLD_CASE_DEFAULT
;

151547 
UE¼ÜCode
 
	g¡©us
 = 
U_ZERO_ERROR
;

151548 
	gnCh¬
;

151550 
UCh¬32
 
	gc
;

151551 
	giIÅut
 = 0;

151552 
	giOut
 = 0;

151554 *
	gµCursÜ
 = 0;

151556 ifÐ
	gzIÅut
==0 ){

151557 
nIÅut
 = 0;

151558 
	gzIÅut
 = "";

151559 }ifÐ
	gnIÅut
<0 ){

151560 
	gnIÅut
 = 
¡¾’
(
zIÅut
);

151562 
	gnCh¬
 = 
nIÅut
+1;

151563 
	gpC¤
 = (
IcuCursÜ
 *)
sql™e3_m®loc
(

151564 (
IcuCursÜ
) +

151565 ((
nCh¬
+3)&~3è* (
UCh¬
) +

151566 (
nCh¬
+1) * ()

151568 ifÐ!
	gpC¤
 ){

151569  
	gSQLITE_NOMEM
;

151571 
mem£t
(
pC¤
, 0, (
IcuCursÜ
));

151572 
	gpC¤
->
	gaCh¬
 = (
UCh¬
 *)&
pC¤
[1];

151573 
	gpC¤
->
	gaOff£t
 = (*)&
pC¤
->
aCh¬
[(
nCh¬
+3)&~3];

151575 
	gpC¤
->
	gaOff£t
[
iOut
] = 
iIÅut
;

151576 
U8_NEXT
(
zIÅut
, 
iIÅut
, 
nIÅut
, 
c
);

151577  
	gc
>0 ){

151578 
	gisE¼Ü
 = 0;

151579 
	gc
 = 
u_fÞdCa£
(
c
, 
Ýt
);

151580 
U16_APPEND
(
pC¤
->
aCh¬
, 
iOut
, 
nCh¬
, 
c
, 
isE¼Ü
);

151581 ifÐ
	gisE¼Ü
 ){

151582 
sql™e3_ä“
(
pC¤
);

151583  
	gSQLITE_ERROR
;

151585 
	gpC¤
->
	gaOff£t
[
iOut
] = 
iIÅut
;

151587 ifÐ
	giIÅut
<
	gnIÅut
 ){

151588 
U8_NEXT
(
zIÅut
, 
iIÅut
, 
nIÅut
, 
c
);

151590 
	gc
 = 0;

151594 
	gpC¤
->
	gpI‹r
 = 
ubrk_Ý’
(
UBRK_WORD
, 
p
->
zLoÿË
, 
pC¤
->
aCh¬
, 
iOut
, &
¡©us
);

151595 ifÐ!
U_SUCCESS
(
¡©us
) ){

151596 
sql™e3_ä“
(
pC¤
);

151597  
	gSQLITE_ERROR
;

151599 
	gpC¤
->
	gnCh¬
 = 
iOut
;

151601 
ubrk_fœ¡
(
pC¤
->
pI‹r
);

151602 *
	gµCursÜ
 = (
sql™e3_tok’iz”_cursÜ
 *)
pC¤
;

151603  
	gSQLITE_OK
;

151609 
icuClo£
(
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
){

151610 
IcuCursÜ
 *
	gpC¤
 = (IcuCursÜ *)
pCursÜ
;

151611 
ubrk_þo£
(
pC¤
->
pI‹r
);

151612 
sql™e3_ä“
(
pC¤
->
zBufãr
);

151613 
sql™e3_ä“
(
pC¤
);

151614  
	gSQLITE_OK
;

151620 
icuNext
(

151621 
sql™e3_tok’iz”_cursÜ
 *
pCursÜ
,

151622 cÚ¡ **
µTok’
,

151623 *
²By‹s
,

151624 *
piS¹Off£t
,

151625 *
piEndOff£t
,

151626 *
piPos™iÚ


151628 
IcuCursÜ
 *
	gpC¤
 = (IcuCursÜ *)
pCursÜ
;

151630 
	giS¹
 = 0;

151631 
	giEnd
 = 0;

151632 
	gnBy‹
 = 0;

151634  
	giS¹
==
iEnd
 ){

151635 
UCh¬32
 
c
;

151637 
	giS¹
 = 
ubrk_cu¼’t
(
pC¤
->
pI‹r
);

151638 
	giEnd
 = 
ubrk_Ãxt
(
pC¤
->
pI‹r
);

151639 ifÐ
	giEnd
==
UBRK_DONE
 ){

151640  
SQLITE_DONE
;

151643  
	giS¹
<
	giEnd
 ){

151644 
	giWh™e
 = 
iS¹
;

151645 
U16_NEXT
(
pC¤
->
aCh¬
, 
iWh™e
,…C¤->
nCh¬
, 
c
);

151646 ifÐ
u_is¥aû
(
c
) ){

151647 
	giS¹
 = 
iWh™e
;

151652 
as£¹
(
iS¹
<=
iEnd
);

151656 
UE¼ÜCode
 
	g¡©us
 = 
U_ZERO_ERROR
;

151657 ifÐ
	gnBy‹
 ){

151658 *
	gzNew
 = 
sql™e3_»®loc
(
pC¤
->
zBufãr
, 
nBy‹
);

151659 ifÐ!
	gzNew
 ){

151660  
	gSQLITE_NOMEM
;

151662 
	gpC¤
->
	gzBufãr
 = 
zNew
;

151663 
	gpC¤
->
	gnBufãr
 = 
nBy‹
;

151666 
u_¡rToUTF8
(

151667 
pC¤
->
zBufãr
,…C¤->
nBufãr
, &
nBy‹
,

151668 &
pC¤
->
aCh¬
[
iS¹
], 
iEnd
-iStart,

151669 &
¡©us


151671 }  
	gnBy‹
>
	gpC¤
->
	gnBufãr
 );

151673 *
	gµTok’
 = 
pC¤
->
zBufãr
;

151674 *
	g²By‹s
 = 
nBy‹
;

151675 *
	gpiS¹Off£t
 = 
pC¤
->
aOff£t
[
iS¹
];

151676 *
	gpiEndOff£t
 = 
pC¤
->
aOff£t
[
iEnd
];

151677 *
	gpiPos™iÚ
 = 
pC¤
->
iTok’
++;

151679  
	gSQLITE_OK
;

151685 cÚ¡ 
sql™e3_tok’iz”_moduË
 
	gicuTok’iz”ModuË
 = {

151687 
icuC»©e
,

151688 
icuDe¡roy
,

151689 
icuO³n
,

151690 
icuClo£
,

151691 
icuNext
,

151697 
SQLITE_PRIVATE
 
sql™e3Fts3IcuTok’iz”ModuË
(

151698 
sql™e3_tok’iz”_moduË
 cÚ¡**
µModuË


151700 *
	gµModuË
 = &
icuTok’iz”ModuË
;

	@sqlite3.h

33 #iâdeà
_SQLITE3_H_


34 
	#_SQLITE3_H_


	)

35 
	~<¡d¬g.h
>

40 #ifdeà
__ýlu¥lus


48 #iâdeà
SQLITE_EXTERN


49 
	#SQLITE_EXTERN
 

	)

52 #iâdeà
SQLITE_API


53 
	#SQLITE_API


	)

70 
	#SQLITE_DEPRECATED


	)

71 
	#SQLITE_EXPERIMENTAL


	)

76 #ifdeà
SQLITE_VERSION


77 #undeà
SQLITE_VERSION


79 #ifdeà
SQLITE_VERSION_NUMBER


80 #undeà
SQLITE_VERSION_NUMBER


110 
	#SQLITE_VERSION
 "3.8.7.4"

	)

111 
	#SQLITE_VERSION_NUMBER
 3008007

	)

112 
	#SQLITE_SOURCE_ID
 "2014-12-09 01:34:36 f66f7a17b78ba617acde90fc810107f34f1a1f2e"

	)

144 
SQLITE_API
 
SQLITE_EXTERN
 cÚ¡ 
sql™e3_v”siÚ
[];

145 
SQLITE_API
 cÚ¡ *
sql™e3_libv”siÚ
();

146 
SQLITE_API
 cÚ¡ *
sql™e3_sourûid
();

147 
SQLITE_API
 
sql™e3_libv”siÚ_numb”
();

171 #iâdeà
SQLITE_OMIT_COMPILEOPTION_DIAGS


172 
SQLITE_API
 
sql™e3_compžeÝtiÚ_u£d
(cÚ¡ *
zO±Name
);

173 
SQLITE_API
 cÚ¡ *
sql™e3_compžeÝtiÚ_g‘
(
N
);

212 
SQLITE_API
 
sql™e3_th»ad§ã
();

228 
sql™e3
 
	tsql™e3
;

246 #ifdeà
SQLITE_INT64_TYPE


247 
SQLITE_INT64_TYPE
 
	tsql™e_št64
;

248 
	tSQLITE_INT64_TYPE
 
	tsql™e_ušt64
;

249 #–ià
defšed
(
_MSC_VER
è|| defšed(
__BORLANDC__
)

250 
__št64
 
	tsql™e_št64
;

251 
	t__št64
 
	tsql™e_ušt64
;

253 
	tsql™e_št64
;

254 
	tsql™e_ušt64
;

256 
sql™e_št64
 
	tsql™e3_št64
;

257 
sql™e_ušt64
 
	tsql™e3_ušt64
;

263 #ifdeà
SQLITE_OMIT_FLOATING_POINT


264 
sql™e3_št64


	)

308 
SQLITE_API
 
sql™e3_þo£
(
sql™e3
*);

309 
SQLITE_API
 
sql™e3_þo£_v2
(
sql™e3
*);

316 (*
sql™e3_ÿÎback
)(*,,**, **);

379 
SQLITE_API
 
sql™e3_exec
(

380 
sql™e3
*,

381 cÚ¡ *
sql
,

382 (*
ÿÎback
)(*,,**,**),

384 **
”rmsg


398 
	#SQLITE_OK
 0

	)

400 
	#SQLITE_ERROR
 1

	)

401 
	#SQLITE_INTERNAL
 2

	)

402 
	#SQLITE_PERM
 3

	)

403 
	#SQLITE_ABORT
 4

	)

404 
	#SQLITE_BUSY
 5

	)

405 
	#SQLITE_LOCKED
 6

	)

406 
	#SQLITE_NOMEM
 7

	)

407 
	#SQLITE_READONLY
 8

	)

408 
	#SQLITE_INTERRUPT
 9

	)

409 
	#SQLITE_IOERR
 10

	)

410 
	#SQLITE_CORRUPT
 11

	)

411 
	#SQLITE_NOTFOUND
 12

	)

412 
	#SQLITE_FULL
 13

	)

413 
	#SQLITE_CANTOPEN
 14

	)

414 
	#SQLITE_PROTOCOL
 15

	)

415 
	#SQLITE_EMPTY
 16

	)

416 
	#SQLITE_SCHEMA
 17

	)

417 
	#SQLITE_TOOBIG
 18

	)

418 
	#SQLITE_CONSTRAINT
 19

	)

419 
	#SQLITE_MISMATCH
 20

	)

420 
	#SQLITE_MISUSE
 21

	)

421 
	#SQLITE_NOLFS
 22

	)

422 
	#SQLITE_AUTH
 23

	)

423 
	#SQLITE_FORMAT
 24

	)

424 
	#SQLITE_RANGE
 25

	)

425 
	#SQLITE_NOTADB
 26

	)

426 
	#SQLITE_NOTICE
 27

	)

427 
	#SQLITE_WARNING
 28

	)

428 
	#SQLITE_ROW
 100

	)

429 
	#SQLITE_DONE
 101

	)

448 
	#SQLITE_IOERR_READ
 (
SQLITE_IOERR
 | (1<<8))

	)

449 
	#SQLITE_IOERR_SHORT_READ
 (
SQLITE_IOERR
 | (2<<8))

	)

450 
	#SQLITE_IOERR_WRITE
 (
SQLITE_IOERR
 | (3<<8))

	)

451 
	#SQLITE_IOERR_FSYNC
 (
SQLITE_IOERR
 | (4<<8))

	)

452 
	#SQLITE_IOERR_DIR_FSYNC
 (
SQLITE_IOERR
 | (5<<8))

	)

453 
	#SQLITE_IOERR_TRUNCATE
 (
SQLITE_IOERR
 | (6<<8))

	)

454 
	#SQLITE_IOERR_FSTAT
 (
SQLITE_IOERR
 | (7<<8))

	)

455 
	#SQLITE_IOERR_UNLOCK
 (
SQLITE_IOERR
 | (8<<8))

	)

456 
	#SQLITE_IOERR_RDLOCK
 (
SQLITE_IOERR
 | (9<<8))

	)

457 
	#SQLITE_IOERR_DELETE
 (
SQLITE_IOERR
 | (10<<8))

	)

458 
	#SQLITE_IOERR_BLOCKED
 (
SQLITE_IOERR
 | (11<<8))

	)

459 
	#SQLITE_IOERR_NOMEM
 (
SQLITE_IOERR
 | (12<<8))

	)

460 
	#SQLITE_IOERR_ACCESS
 (
SQLITE_IOERR
 | (13<<8))

	)

461 
	#SQLITE_IOERR_CHECKRESERVEDLOCK
 (
SQLITE_IOERR
 | (14<<8))

	)

462 
	#SQLITE_IOERR_LOCK
 (
SQLITE_IOERR
 | (15<<8))

	)

463 
	#SQLITE_IOERR_CLOSE
 (
SQLITE_IOERR
 | (16<<8))

	)

464 
	#SQLITE_IOERR_DIR_CLOSE
 (
SQLITE_IOERR
 | (17<<8))

	)

465 
	#SQLITE_IOERR_SHMOPEN
 (
SQLITE_IOERR
 | (18<<8))

	)

466 
	#SQLITE_IOERR_SHMSIZE
 (
SQLITE_IOERR
 | (19<<8))

	)

467 
	#SQLITE_IOERR_SHMLOCK
 (
SQLITE_IOERR
 | (20<<8))

	)

468 
	#SQLITE_IOERR_SHMMAP
 (
SQLITE_IOERR
 | (21<<8))

	)

469 
	#SQLITE_IOERR_SEEK
 (
SQLITE_IOERR
 | (22<<8))

	)

470 
	#SQLITE_IOERR_DELETE_NOENT
 (
SQLITE_IOERR
 | (23<<8))

	)

471 
	#SQLITE_IOERR_MMAP
 (
SQLITE_IOERR
 | (24<<8))

	)

472 
	#SQLITE_IOERR_GETTEMPPATH
 (
SQLITE_IOERR
 | (25<<8))

	)

473 
	#SQLITE_IOERR_CONVPATH
 (
SQLITE_IOERR
 | (26<<8))

	)

474 
	#SQLITE_LOCKED_SHAREDCACHE
 (
SQLITE_LOCKED
 | (1<<8))

	)

475 
	#SQLITE_BUSY_RECOVERY
 (
SQLITE_BUSY
 | (1<<8))

	)

476 
	#SQLITE_BUSY_SNAPSHOT
 (
SQLITE_BUSY
 | (2<<8))

	)

477 
	#SQLITE_CANTOPEN_NOTEMPDIR
 (
SQLITE_CANTOPEN
 | (1<<8))

	)

478 
	#SQLITE_CANTOPEN_ISDIR
 (
SQLITE_CANTOPEN
 | (2<<8))

	)

479 
	#SQLITE_CANTOPEN_FULLPATH
 (
SQLITE_CANTOPEN
 | (3<<8))

	)

480 
	#SQLITE_CANTOPEN_CONVPATH
 (
SQLITE_CANTOPEN
 | (4<<8))

	)

481 
	#SQLITE_CORRUPT_VTAB
 (
SQLITE_CORRUPT
 | (1<<8))

	)

482 
	#SQLITE_READONLY_RECOVERY
 (
SQLITE_READONLY
 | (1<<8))

	)

483 
	#SQLITE_READONLY_CANTLOCK
 (
SQLITE_READONLY
 | (2<<8))

	)

484 
	#SQLITE_READONLY_ROLLBACK
 (
SQLITE_READONLY
 | (3<<8))

	)

485 
	#SQLITE_READONLY_DBMOVED
 (
SQLITE_READONLY
 | (4<<8))

	)

486 
	#SQLITE_ABORT_ROLLBACK
 (
SQLITE_ABORT
 | (2<<8))

	)

487 
	#SQLITE_CONSTRAINT_CHECK
 (
SQLITE_CONSTRAINT
 | (1<<8))

	)

488 
	#SQLITE_CONSTRAINT_COMMITHOOK
 (
SQLITE_CONSTRAINT
 | (2<<8))

	)

489 
	#SQLITE_CONSTRAINT_FOREIGNKEY
 (
SQLITE_CONSTRAINT
 | (3<<8))

	)

490 
	#SQLITE_CONSTRAINT_FUNCTION
 (
SQLITE_CONSTRAINT
 | (4<<8))

	)

491 
	#SQLITE_CONSTRAINT_NOTNULL
 (
SQLITE_CONSTRAINT
 | (5<<8))

	)

492 
	#SQLITE_CONSTRAINT_PRIMARYKEY
 (
SQLITE_CONSTRAINT
 | (6<<8))

	)

493 
	#SQLITE_CONSTRAINT_TRIGGER
 (
SQLITE_CONSTRAINT
 | (7<<8))

	)

494 
	#SQLITE_CONSTRAINT_UNIQUE
 (
SQLITE_CONSTRAINT
 | (8<<8))

	)

495 
	#SQLITE_CONSTRAINT_VTAB
 (
SQLITE_CONSTRAINT
 | (9<<8))

	)

496 
	#SQLITE_CONSTRAINT_ROWID
 (
SQLITE_CONSTRAINT
 |(10<<8))

	)

497 
	#SQLITE_NOTICE_RECOVER_WAL
 (
SQLITE_NOTICE
 | (1<<8))

	)

498 
	#SQLITE_NOTICE_RECOVER_ROLLBACK
 (
SQLITE_NOTICE
 | (2<<8))

	)

499 
	#SQLITE_WARNING_AUTOINDEX
 (
SQLITE_WARNING
 | (1<<8))

	)

500 
	#SQLITE_AUTH_USER
 (
SQLITE_AUTH
 | (1<<8))

	)

509 
	#SQLITE_OPEN_READONLY
 0x00000001

	)

510 
	#SQLITE_OPEN_READWRITE
 0x00000002

	)

511 
	#SQLITE_OPEN_CREATE
 0x00000004

	)

512 
	#SQLITE_OPEN_DELETEONCLOSE
 0x00000008

	)

513 
	#SQLITE_OPEN_EXCLUSIVE
 0x00000010

	)

514 
	#SQLITE_OPEN_AUTOPROXY
 0x00000020

	)

515 
	#SQLITE_OPEN_URI
 0x00000040

	)

516 
	#SQLITE_OPEN_MEMORY
 0x00000080

	)

517 
	#SQLITE_OPEN_MAIN_DB
 0x00000100

	)

518 
	#SQLITE_OPEN_TEMP_DB
 0x00000200

	)

519 
	#SQLITE_OPEN_TRANSIENT_DB
 0x00000400

	)

520 
	#SQLITE_OPEN_MAIN_JOURNAL
 0x00000800

	)

521 
	#SQLITE_OPEN_TEMP_JOURNAL
 0x00001000

	)

522 
	#SQLITE_OPEN_SUBJOURNAL
 0x00002000

	)

523 
	#SQLITE_OPEN_MASTER_JOURNAL
 0x00004000

	)

524 
	#SQLITE_OPEN_NOMUTEX
 0x00008000

	)

525 
	#SQLITE_OPEN_FULLMUTEX
 0x00010000

	)

526 
	#SQLITE_OPEN_SHAREDCACHE
 0x00020000

	)

527 
	#SQLITE_OPEN_PRIVATECACHE
 0x00040000

	)

528 
	#SQLITE_OPEN_WAL
 0x00080000

	)

560 
	#SQLITE_IOCAP_ATOMIC
 0x00000001

	)

561 
	#SQLITE_IOCAP_ATOMIC512
 0x00000002

	)

562 
	#SQLITE_IOCAP_ATOMIC1K
 0x00000004

	)

563 
	#SQLITE_IOCAP_ATOMIC2K
 0x00000008

	)

564 
	#SQLITE_IOCAP_ATOMIC4K
 0x00000010

	)

565 
	#SQLITE_IOCAP_ATOMIC8K
 0x00000020

	)

566 
	#SQLITE_IOCAP_ATOMIC16K
 0x00000040

	)

567 
	#SQLITE_IOCAP_ATOMIC32K
 0x00000080

	)

568 
	#SQLITE_IOCAP_ATOMIC64K
 0x00000100

	)

569 
	#SQLITE_IOCAP_SAFE_APPEND
 0x00000200

	)

570 
	#SQLITE_IOCAP_SEQUENTIAL
 0x00000400

	)

571 
	#SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
 0x00000800

	)

572 
	#SQLITE_IOCAP_POWERSAFE_OVERWRITE
 0x00001000

	)

573 
	#SQLITE_IOCAP_IMMUTABLE
 0x00002000

	)

582 
	#SQLITE_LOCK_NONE
 0

	)

583 
	#SQLITE_LOCK_SHARED
 1

	)

584 
	#SQLITE_LOCK_RESERVED
 2

	)

585 
	#SQLITE_LOCK_PENDING
 3

	)

586 
	#SQLITE_LOCK_EXCLUSIVE
 4

	)

614 
	#SQLITE_SYNC_NORMAL
 0x00002

	)

615 
	#SQLITE_SYNC_FULL
 0x00003

	)

616 
	#SQLITE_SYNC_DATAONLY
 0x00010

	)

629 
sql™e3_fže
 
	tsql™e3_fže
;

630 
	ssql™e3_fže
 {

631 cÚ¡ 
sql™e3_io_m‘hods
 *
pM‘hods
;

724 
sql™e3_io_m‘hods
 
	tsql™e3_io_m‘hods
;

725 
	ssql™e3_io_m‘hods
 {

726 
iV”siÚ
;

727 (*
xClo£
)(
sql™e3_fže
*);

728 (*
xR—d
)(
sql™e3_fže
*, *, 
iAmt
, 
sql™e3_št64
 
iOf¡
);

729 (*
xWr™e
)(
sql™e3_fže
*, cÚ¡ *, 
iAmt
, 
sql™e3_št64
 
iOf¡
);

730 (*
xTrunÿ‹
)(
sql™e3_fže
*, 
sql™e3_št64
 
size
);

731 (*
xSync
)(
sql™e3_fže
*, 
æags
);

732 (*
xFžeSize
)(
sql™e3_fže
*, 
sql™e3_št64
 *
pSize
);

733 (*
xLock
)(
sql™e3_fže
*, );

734 (*
xUÆock
)(
sql™e3_fže
*, );

735 (*
xCheckRe£rvedLock
)(
sql™e3_fže
*, *
pResOut
);

736 (*
xFžeCÚŒÞ
)(
sql™e3_fže
*, 
Ý
, *
pArg
);

737 (*
xSeùÜSize
)(
sql™e3_fže
*);

738 (*
xDeviûCh¬aù”i¡ics
)(
sql™e3_fže
*);

740 (*
xShmM­
)(
sql™e3_fže
*, 
iPg
, 
pgsz
, , volatile**);

741 (*
xShmLock
)(
sql™e3_fže
*, 
off£t
, 
n
, 
æags
);

742 (*
xShmB¬r›r
)(
sql™e3_fže
*);

743 (*
xShmUnm­
)(
sql™e3_fže
*, 
d–‘eFÏg
);

745 (*
xF‘ch
)(
sql™e3_fže
*, 
sql™e3_št64
 
iOf¡
, 
iAmt
, **
µ
);

746 (*
xUnãtch
)(
sql™e3_fže
*, 
sql™e3_št64
 
iOf¡
, *
p
);

951 
	#SQLITE_FCNTL_LOCKSTATE
 1

	)

952 
	#SQLITE_GET_LOCKPROXYFILE
 2

	)

953 
	#SQLITE_SET_LOCKPROXYFILE
 3

	)

954 
	#SQLITE_LAST_ERRNO
 4

	)

955 
	#SQLITE_FCNTL_SIZE_HINT
 5

	)

956 
	#SQLITE_FCNTL_CHUNK_SIZE
 6

	)

957 
	#SQLITE_FCNTL_FILE_POINTER
 7

	)

958 
	#SQLITE_FCNTL_SYNC_OMITTED
 8

	)

959 
	#SQLITE_FCNTL_WIN32_AV_RETRY
 9

	)

960 
	#SQLITE_FCNTL_PERSIST_WAL
 10

	)

961 
	#SQLITE_FCNTL_OVERWRITE
 11

	)

962 
	#SQLITE_FCNTL_VFSNAME
 12

	)

963 
	#SQLITE_FCNTL_POWERSAFE_OVERWRITE
 13

	)

964 
	#SQLITE_FCNTL_PRAGMA
 14

	)

965 
	#SQLITE_FCNTL_BUSYHANDLER
 15

	)

966 
	#SQLITE_FCNTL_TEMPFILENAME
 16

	)

967 
	#SQLITE_FCNTL_MMAP_SIZE
 18

	)

968 
	#SQLITE_FCNTL_TRACE
 19

	)

969 
	#SQLITE_FCNTL_HAS_MOVED
 20

	)

970 
	#SQLITE_FCNTL_SYNC
 21

	)

971 
	#SQLITE_FCNTL_COMMIT_PHASETWO
 22

	)

972 
	#SQLITE_FCNTL_WIN32_SET_HANDLE
 23

	)

984 
sql™e3_mu‹x
 
	tsql™e3_mu‹x
;

1143 
sql™e3_vfs
 
	tsql™e3_vfs
;

1144 (*
sql™e3_sysÿÎ_±r
)();

1145 
	ssql™e3_vfs
 {

1146 
iV”siÚ
;

1147 
szOsFže
;

1148 
mxP©hÇme
;

1149 
sql™e3_vfs
 *
pNext
;

1150 cÚ¡ *
zName
;

1151 *
pAµD©a
;

1152 (*
xO³n
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
sql™e3_fže
*,

1153 
æags
, *
pOutFÏgs
);

1154 (*
xD–‘e
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
syncDœ
);

1155 (*
xAcûss
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
æags
, *
pResOut
);

1156 (*
xFuÎP©hÇme
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
nOut
, *
zOut
);

1157 *(*
xDlO³n
)(
sql™e3_vfs
*, cÚ¡ *
zFž’ame
);

1158 (*
xDlE¼Ü
)(
sql™e3_vfs
*, 
nBy‹
, *
zE¼Msg
);

1159 (*(*
xDlSym
)(
sql™e3_vfs
*,*, cÚ¡ *
zSymbÞ
))();

1160 (*
xDlClo£
)(
sql™e3_vfs
*, *);

1161 (*
xRªdomÃss
)(
sql™e3_vfs
*, 
nBy‹
, *
zOut
);

1162 (*
xSË•
)(
sql™e3_vfs
*, 
miüo£cÚds
);

1163 (*
xCu¼’tTime
)(
sql™e3_vfs
*, *);

1164 (*
xG‘La¡E¼Ü
)(
sql™e3_vfs
*, , *);

1169 (*
xCu¼’tTimeIÁ64
)(
sql™e3_vfs
*, 
sql™e3_št64
*);

1174 (*
xS‘Sy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
, 
sql™e3_sysÿÎ_±r
);

1175 
sql™e3_sysÿÎ_±r
 (*
xG‘Sy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
);

1176 cÚ¡ *(*
xNextSy¡emC®l
)(
sql™e3_vfs
*, cÚ¡ *
zName
);

1204 
	#SQLITE_ACCESS_EXISTS
 0

	)

1205 
	#SQLITE_ACCESS_READWRITE
 1

	)

1206 
	#SQLITE_ACCESS_READ
 2

	)

1230 
	#SQLITE_SHM_UNLOCK
 1

	)

1231 
	#SQLITE_SHM_LOCK
 2

	)

1232 
	#SQLITE_SHM_SHARED
 4

	)

1233 
	#SQLITE_SHM_EXCLUSIVE
 8

	)

1243 
	#SQLITE_SHM_NLOCK
 8

	)

1321 
SQLITE_API
 
sql™e3_š™Ÿlize
();

1322 
SQLITE_API
 
sql™e3_shutdown
();

1323 
SQLITE_API
 
sql™e3_os_š™
();

1324 
SQLITE_API
 
sql™e3_os_’d
();

1355 
SQLITE_API
 
sql™e3_cÚfig
(, ...);

1373 
SQLITE_API
 
sql™e3_db_cÚfig
(
sql™e3
*, 
Ý
, ...);

1438 
sql™e3_mem_m‘hods
 
	tsql™e3_mem_m‘hods
;

1439 
	ssql™e3_mem_m‘hods
 {

1440 *(*
xM®loc
)();

1441 (*
xF»e
)(*);

1442 *(*
xR—Îoc
)(*,);

1443 (*
xSize
)(*);

1444 (*
xRoundup
)();

1445 (*
xIn™
)(*);

1446 (*
xShutdown
)(*);

1447 *
pAµD©a
;

1728 
	#SQLITE_CONFIG_SINGLETHREAD
 1

	)

1729 
	#SQLITE_CONFIG_MULTITHREAD
 2

	)

1730 
	#SQLITE_CONFIG_SERIALIZED
 3

	)

1731 
	#SQLITE_CONFIG_MALLOC
 4

	)

1732 
	#SQLITE_CONFIG_GETMALLOC
 5

	)

1733 
	#SQLITE_CONFIG_SCRATCH
 6

	)

1734 
	#SQLITE_CONFIG_PAGECACHE
 7

	)

1735 
	#SQLITE_CONFIG_HEAP
 8

	)

1736 
	#SQLITE_CONFIG_MEMSTATUS
 9

	)

1737 
	#SQLITE_CONFIG_MUTEX
 10

	)

1738 
	#SQLITE_CONFIG_GETMUTEX
 11

	)

1740 
	#SQLITE_CONFIG_LOOKASIDE
 13

	)

1741 
	#SQLITE_CONFIG_PCACHE
 14

	)

1742 
	#SQLITE_CONFIG_GETPCACHE
 15

	)

1743 
	#SQLITE_CONFIG_LOG
 16

	)

1744 
	#SQLITE_CONFIG_URI
 17

	)

1745 
	#SQLITE_CONFIG_PCACHE2
 18

	)

1746 
	#SQLITE_CONFIG_GETPCACHE2
 19

	)

1747 
	#SQLITE_CONFIG_COVERING_INDEX_SCAN
 20

	)

1748 
	#SQLITE_CONFIG_SQLLOG
 21

	)

1749 
	#SQLITE_CONFIG_MMAP_SIZE
 22

	)

1750 
	#SQLITE_CONFIG_WIN32_HEAPSIZE
 23

	)

1810 
	#SQLITE_DBCONFIG_LOOKASIDE
 1001

	)

1811 
	#SQLITE_DBCONFIG_ENABLE_FKEY
 1002

	)

1812 
	#SQLITE_DBCONFIG_ENABLE_TRIGGER
 1003

	)

1822 
SQLITE_API
 
sql™e3_ex‹nded_»suÉ_codes
(
sql™e3
*, 
Úoff
);

1873 
SQLITE_API
 
sql™e3_št64
 
sql™e3_Ï¡_š£¹_rowid
(
sql™e3
*);

1927 
SQLITE_API
 
sql™e3_chªges
(
sql™e3
*);

1953 
SQLITE_API
 
sql™e3_tÙ®_chªges
(
sql™e3
*);

1992 
SQLITE_API
 
sql™e3_š‹¼u±
(
sql™e3
*);

2027 
SQLITE_API
 
sql™e3_com¶‘e
(cÚ¡ *
sql
);

2028 
SQLITE_API
 
sql™e3_com¶‘e16
(cÚ¡ *
sql
);

2087 
SQLITE_API
 
sql™e3_busy_hªdËr
(
sql™e3
*, (*)(*,), *);

2109 
SQLITE_API
 
sql™e3_busy_timeout
(
sql™e3
*, 
ms
);

2183 
SQLITE_API
 
sql™e3_g‘_bË
(

2184 
sql™e3
 *
db
,

2185 cÚ¡ *
zSql
,

2186 ***
·zResuÉ
,

2187 *
²Row
,

2188 *
²CÞumn
,

2189 **
pzE¼msg


2191 
SQLITE_API
 
sql™e3_ä“_bË
(**
»suÉ
);

2287 
SQLITE_API
 *
sql™e3_m´štf
(const *,...);

2288 
SQLITE_API
 *
sql™e3_vm´štf
(cÚ¡ *, 
va_li¡
);

2289 
SQLITE_API
 *
sql™e3_¢´štf
(,*,const *, ...);

2290 
SQLITE_API
 *
sql™e3_v¢´štf
(,*,cÚ¡ *, 
va_li¡
);

2380 
SQLITE_API
 *
sql™e3_m®loc
();

2381 
SQLITE_API
 *
sql™e3_m®loc64
(
sql™e3_ušt64
);

2382 
SQLITE_API
 *
sql™e3_»®loc
(*, );

2383 
SQLITE_API
 *
sql™e3_»®loc64
(*, 
sql™e3_ušt64
);

2384 
SQLITE_API
 
sql™e3_ä“
(*);

2385 
SQLITE_API
 
sql™e3_ušt64
 
sql™e3_msize
(*);

2410 
SQLITE_API
 
sql™e3_št64
 
sql™e3_memÜy_u£d
();

2411 
SQLITE_API
 
sql™e3_št64
 
sql™e3_memÜy_highw©”
(
»£tFÏg
);

2433 
SQLITE_API
 
sql™e3_¿ndomÃss
(
N
, *
P
);

2515 
SQLITE_API
 
sql™e3_£t_authÜiz”
(

2516 
sql™e3
*,

2517 (*
xAuth
)(*,,const *,const *,const *,const *),

2518 *
pU£rD©a


2533 
	#SQLITE_DENY
 1

	)

2534 
	#SQLITE_IGNORE
 2

	)

2556 
	#SQLITE_CREATE_INDEX
 1

	)

2557 
	#SQLITE_CREATE_TABLE
 2

	)

2558 
	#SQLITE_CREATE_TEMP_INDEX
 3

	)

2559 
	#SQLITE_CREATE_TEMP_TABLE
 4

	)

2560 
	#SQLITE_CREATE_TEMP_TRIGGER
 5

	)

2561 
	#SQLITE_CREATE_TEMP_VIEW
 6

	)

2562 
	#SQLITE_CREATE_TRIGGER
 7

	)

2563 
	#SQLITE_CREATE_VIEW
 8

	)

2564 
	#SQLITE_DELETE
 9

	)

2565 
	#SQLITE_DROP_INDEX
 10

	)

2566 
	#SQLITE_DROP_TABLE
 11

	)

2567 
	#SQLITE_DROP_TEMP_INDEX
 12

	)

2568 
	#SQLITE_DROP_TEMP_TABLE
 13

	)

2569 
	#SQLITE_DROP_TEMP_TRIGGER
 14

	)

2570 
	#SQLITE_DROP_TEMP_VIEW
 15

	)

2571 
	#SQLITE_DROP_TRIGGER
 16

	)

2572 
	#SQLITE_DROP_VIEW
 17

	)

2573 
	#SQLITE_INSERT
 18

	)

2574 
	#SQLITE_PRAGMA
 19

	)

2575 
	#SQLITE_READ
 20

	)

2576 
	#SQLITE_SELECT
 21

	)

2577 
	#SQLITE_TRANSACTION
 22

	)

2578 
	#SQLITE_UPDATE
 23

	)

2579 
	#SQLITE_ATTACH
 24

	)

2580 
	#SQLITE_DETACH
 25

	)

2581 
	#SQLITE_ALTER_TABLE
 26

	)

2582 
	#SQLITE_REINDEX
 27

	)

2583 
	#SQLITE_ANALYZE
 28

	)

2584 
	#SQLITE_CREATE_VTABLE
 29

	)

2585 
	#SQLITE_DROP_VTABLE
 30

	)

2586 
	#SQLITE_FUNCTION
 31

	)

2587 
	#SQLITE_SAVEPOINT
 32

	)

2588 
	#SQLITE_COPY
 0

	)

2589 
	#SQLITE_RECURSIVE
 33

	)

2619 
SQLITE_API
 *
sql™e3_Œaû
(
sql™e3
*, (*
xT¿û
)(*,const *), *);

2620 
SQLITE_API
 
SQLITE_EXPERIMENTAL
 *
sql™e3_´ofže
(
sql™e3
*,

2621 (*
xProfže
)(*,cÚ¡ *,
sql™e3_ušt64
), *);

2654 
SQLITE_API
 
sql™e3_´og»ss_hªdËr
(
sql™e3
*, , (*)(*), *);

2882 
SQLITE_API
 
sql™e3_Ý’
(

2883 cÚ¡ *
fž’ame
,

2884 
sql™e3
 **
µDb


2886 
SQLITE_API
 
sql™e3_Ý’16
(

2887 cÚ¡ *
fž’ame
,

2888 
sql™e3
 **
µDb


2890 
SQLITE_API
 
sql™e3_Ý’_v2
(

2891 cÚ¡ *
fž’ame
,

2892 
sql™e3
 **
µDb
,

2893 
æags
,

2894 cÚ¡ *
zVfs


2936 
SQLITE_API
 cÚ¡ *
sql™e3_uri_·¿m‘”
(cÚ¡ *
zFž’ame
, cÚ¡ *
zP¬am
);

2937 
SQLITE_API
 
sql™e3_uri_boÞ—n
(cÚ¡ *
zFže
, cÚ¡ *
zP¬am
, 
bDeçuÉ
);

2938 
SQLITE_API
 
sql™e3_št64
 
sql™e3_uri_št64
(const *, const *, sqlite3_int64);

2979 
SQLITE_API
 
sql™e3_”rcode
(
sql™e3
 *
db
);

2980 
SQLITE_API
 
sql™e3_ex‹nded_”rcode
(
sql™e3
 *
db
);

2981 
SQLITE_API
 cÚ¡ *
sql™e3_”rmsg
(
sql™e3
*);

2982 
SQLITE_API
 cÚ¡ *
sql™e3_”rmsg16
(
sql™e3
*);

2983 
SQLITE_API
 cÚ¡ *
sql™e3_”r¡r
();

3009 
sql™e3_¡mt
 
	tsql™e3_¡mt
;

3050 
SQLITE_API
 
sql™e3_lim™
(
sql™e3
*, 
id
, 
ÃwV®
);

3108 
	#SQLITE_LIMIT_LENGTH
 0

	)

3109 
	#SQLITE_LIMIT_SQL_LENGTH
 1

	)

3110 
	#SQLITE_LIMIT_COLUMN
 2

	)

3111 
	#SQLITE_LIMIT_EXPR_DEPTH
 3

	)

3112 
	#SQLITE_LIMIT_COMPOUND_SELECT
 4

	)

3113 
	#SQLITE_LIMIT_VDBE_OP
 5

	)

3114 
	#SQLITE_LIMIT_FUNCTION_ARG
 6

	)

3115 
	#SQLITE_LIMIT_ATTACHED
 7

	)

3116 
	#SQLITE_LIMIT_LIKE_PATTERN_LENGTH
 8

	)

3117 
	#SQLITE_LIMIT_VARIABLE_NUMBER
 9

	)

3118 
	#SQLITE_LIMIT_TRIGGER_DEPTH
 10

	)

3119 
	#SQLITE_LIMIT_WORKER_THREADS
 11

	)

3202 
SQLITE_API
 
sql™e3_´•¬e
(

3203 
sql™e3
 *
db
,

3204 cÚ¡ *
zSql
,

3205 
nBy‹
,

3206 
sql™e3_¡mt
 **
µStmt
,

3207 cÚ¡ **
pzTaž


3209 
SQLITE_API
 
sql™e3_´•¬e_v2
(

3210 
sql™e3
 *
db
,

3211 cÚ¡ *
zSql
,

3212 
nBy‹
,

3213 
sql™e3_¡mt
 **
µStmt
,

3214 cÚ¡ **
pzTaž


3216 
SQLITE_API
 
sql™e3_´•¬e16
(

3217 
sql™e3
 *
db
,

3218 cÚ¡ *
zSql
,

3219 
nBy‹
,

3220 
sql™e3_¡mt
 **
µStmt
,

3221 cÚ¡ **
pzTaž


3223 
SQLITE_API
 
sql™e3_´•¬e16_v2
(

3224 
sql™e3
 *
db
,

3225 cÚ¡ *
zSql
,

3226 
nBy‹
,

3227 
sql™e3_¡mt
 **
µStmt
,

3228 cÚ¡ **
pzTaž


3238 
SQLITE_API
 cÚ¡ *
sql™e3_sql
(
sql™e3_¡mt
 *
pStmt
);

3269 
SQLITE_API
 
sql™e3_¡mt_»adÚly
(
sql™e3_¡mt
 *
pStmt
);

3288 
SQLITE_API
 
sql™e3_¡mt_busy
(
sql™e3_¡mt
*);

3327 
Mem
 
	tsql™e3_v®ue
;

3341 
sql™e3_cÚ‹xt
 
	tsql™e3_cÚ‹xt
;

3449 
SQLITE_API
 
sql™e3_bšd_blob
(
sql™e3_¡mt
*, , cÚ¡ *, 
n
, (*)(*));

3450 
SQLITE_API
 
sql™e3_bšd_blob64
(
sql™e3_¡mt
*, , cÚ¡ *, 
sql™e3_ušt64
,

3452 
SQLITE_API
 
sql™e3_bšd_doubË
(
sql™e3_¡mt
*, , );

3453 
SQLITE_API
 
sql™e3_bšd_št
(
sql™e3_¡mt
*, , );

3454 
SQLITE_API
 
sql™e3_bšd_št64
(
sql™e3_¡mt
*, , 
sql™e3_št64
);

3455 
SQLITE_API
 
sql™e3_bšd_nuÎ
(
sql™e3_¡mt
*, );

3456 
SQLITE_API
 
sql™e3_bšd_‹xt
(
sql™e3_¡mt
*,,const *,,(*)(*));

3457 
SQLITE_API
 
sql™e3_bšd_‹xt16
(
sql™e3_¡mt
*, , const *, , (*)(*));

3458 
SQLITE_API
 
sql™e3_bšd_‹xt64
(
sql™e3_¡mt
*, , cÚ¡ *, 
sql™e3_ušt64
,

3459 (*)(*), 
’codšg
);

3460 
SQLITE_API
 
sql™e3_bšd_v®ue
(
sql™e3_¡mt
*, , cÚ¡ 
sql™e3_v®ue
*);

3461 
SQLITE_API
 
sql™e3_bšd_z”oblob
(
sql™e3_¡mt
*, , 
n
);

3481 
SQLITE_API
 
sql™e3_bšd_·¿m‘”_couÁ
(
sql™e3_¡mt
*);

3508 
SQLITE_API
 cÚ¡ *
sql™e3_bšd_·¿m‘”_Çme
(
sql™e3_¡mt
*, );

3524 
SQLITE_API
 
sql™e3_bšd_·¿m‘”_šdex
(
sql™e3_¡mt
*, cÚ¡ *
zName
);

3533 
SQLITE_API
 
sql™e3_þ—r_bšdšgs
(
sql™e3_¡mt
*);

3544 
SQLITE_API
 
sql™e3_cÞumn_couÁ
(
sql™e3_¡mt
 *
pStmt
);

3572 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Çme
(
sql™e3_¡mt
*, 
N
);

3573 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Çme16
(
sql™e3_¡mt
*, 
N
);

3620 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_d©aba£_Çme
(
sql™e3_¡mt
*,);

3621 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_d©aba£_Çme16
(
sql™e3_¡mt
*,);

3622 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_bË_Çme
(
sql™e3_¡mt
*,);

3623 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_bË_Çme16
(
sql™e3_¡mt
*,);

3624 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Üigš_Çme
(
sql™e3_¡mt
*,);

3625 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_Üigš_Çme16
(
sql™e3_¡mt
*,);

3656 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_deþty³
(
sql™e3_¡mt
*,);

3657 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_deþty³16
(
sql™e3_¡mt
*,);

3736 
SQLITE_API
 
sql™e3_¡•
(
sql™e3_¡mt
*);

3756 
SQLITE_API
 
sql™e3_d©a_couÁ
(
sql™e3_¡mt
 *
pStmt
);

3779 
	#SQLITE_INTEGER
 1

	)

3780 
	#SQLITE_FLOAT
 2

	)

3781 
	#SQLITE_BLOB
 4

	)

3782 
	#SQLITE_NULL
 5

	)

3783 #ifdeà
SQLITE_TEXT


3784 #undeà
SQLITE_TEXT


3786 
	#SQLITE_TEXT
 3

	)

3788 
	#SQLITE3_TEXT
 3

	)

3952 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_blob
(
sql™e3_¡mt
*, 
iCÞ
);

3953 
SQLITE_API
 
sql™e3_cÞumn_by‹s
(
sql™e3_¡mt
*, 
iCÞ
);

3954 
SQLITE_API
 
sql™e3_cÞumn_by‹s16
(
sql™e3_¡mt
*, 
iCÞ
);

3955 
SQLITE_API
 
sql™e3_cÞumn_doubË
(
sql™e3_¡mt
*, 
iCÞ
);

3956 
SQLITE_API
 
sql™e3_cÞumn_št
(
sql™e3_¡mt
*, 
iCÞ
);

3957 
SQLITE_API
 
sql™e3_št64
 
sql™e3_cÞumn_št64
(
sql™e3_¡mt
*, 
iCÞ
);

3958 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_‹xt
(
sql™e3_¡mt
*, 
iCÞ
);

3959 
SQLITE_API
 cÚ¡ *
sql™e3_cÞumn_‹xt16
(
sql™e3_¡mt
*, 
iCÞ
);

3960 
SQLITE_API
 
sql™e3_cÞumn_ty³
(
sql™e3_¡mt
*, 
iCÞ
);

3961 
SQLITE_API
 
sql™e3_v®ue
 *
sql™e3_cÞumn_v®ue
(
sql™e3_¡mt
*, 
iCÞ
);

3988 
SQLITE_API
 
sql™e3_fš®ize
(
sql™e3_¡mt
 *
pStmt
);

4014 
SQLITE_API
 
sql™e3_»£t
(
sql™e3_¡mt
 *
pStmt
);

4113 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ
(

4114 
sql™e3
 *
db
,

4115 cÚ¡ *
zFunùiÚName
,

4116 
nArg
,

4117 
eTextR•
,

4118 *
pAµ
,

4119 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4120 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4121 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

4123 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ16
(

4124 
sql™e3
 *
db
,

4125 cÚ¡ *
zFunùiÚName
,

4126 
nArg
,

4127 
eTextR•
,

4128 *
pAµ
,

4129 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4130 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4131 (*
xFš®
)(
sql™e3_cÚ‹xt
*)

4133 
SQLITE_API
 
sql™e3_ü—‹_funùiÚ_v2
(

4134 
sql™e3
 *
db
,

4135 cÚ¡ *
zFunùiÚName
,

4136 
nArg
,

4137 
eTextR•
,

4138 *
pAµ
,

4139 (*
xFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4140 (*
xS‹p
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

4141 (*
xFš®
)(
sql™e3_cÚ‹xt
*),

4142 (*
xDe¡roy
)(*)

4151 
	#SQLITE_UTF8
 1

	)

4152 
	#SQLITE_UTF16LE
 2

	)

4153 
	#SQLITE_UTF16BE
 3

	)

4154 
	#SQLITE_UTF16
 4

	)

4155 
	#SQLITE_ANY
 5

	)

4156 
	#SQLITE_UTF16_ALIGNED
 8

	)

4166 
	#SQLITE_DETERMINISTIC
 0x800

	)

4178 #iâdeà
SQLITE_OMIT_DEPRECATED


4179 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_agg»g©e_couÁ
(
sql™e3_cÚ‹xt
*);

4180 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_expœed
(
sql™e3_¡mt
*);

4181 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_Œªsãr_bšdšgs
(
sql™e3_¡mt
*, sqlite3_stmt*);

4182 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_glob®_»cov”
();

4183 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_th»ad_þ—nup
();

4184 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_memÜy_®¬m
((*)(*,
sql™e3_št64
,),

4185 *,
sql™e3_št64
);

4233 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_blob
(
sql™e3_v®ue
*);

4234 
SQLITE_API
 
sql™e3_v®ue_by‹s
(
sql™e3_v®ue
*);

4235 
SQLITE_API
 
sql™e3_v®ue_by‹s16
(
sql™e3_v®ue
*);

4236 
SQLITE_API
 
sql™e3_v®ue_doubË
(
sql™e3_v®ue
*);

4237 
SQLITE_API
 
sql™e3_v®ue_št
(
sql™e3_v®ue
*);

4238 
SQLITE_API
 
sql™e3_št64
 
sql™e3_v®ue_št64
(
sql™e3_v®ue
*);

4239 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt
(
sql™e3_v®ue
*);

4240 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16
(
sql™e3_v®ue
*);

4241 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16Ë
(
sql™e3_v®ue
*);

4242 
SQLITE_API
 cÚ¡ *
sql™e3_v®ue_‹xt16be
(
sql™e3_v®ue
*);

4243 
SQLITE_API
 
sql™e3_v®ue_ty³
(
sql™e3_v®ue
*);

4244 
SQLITE_API
 
sql™e3_v®ue_num”ic_ty³
(
sql™e3_v®ue
*);

4288 
SQLITE_API
 *
sql™e3_agg»g©e_cÚ‹xt
(
sql™e3_cÚ‹xt
*, 
nBy‹s
);

4302 
SQLITE_API
 *
sql™e3_u£r_d©a
(
sql™e3_cÚ‹xt
*);

4313 
SQLITE_API
 
sql™e3
 *
sql™e3_cÚ‹xt_db_hªdË
(
sql™e3_cÚ‹xt
*);

4365 
SQLITE_API
 *
sql™e3_g‘_auxd©a
(
sql™e3_cÚ‹xt
*, 
N
);

4366 
SQLITE_API
 
sql™e3_£t_auxd©a
(
sql™e3_cÚ‹xt
*, 
N
, *, (*)(*));

4383 (*
sql™e3_de¡ruùÜ_ty³
)(*);

4384 
	#SQLITE_STATIC
 ((
sql™e3_de¡ruùÜ_ty³
)0)

	)

4385 
	#SQLITE_TRANSIENT
 ((
sql™e3_de¡ruùÜ_ty³
)-1)

	)

4501 
SQLITE_API
 
sql™e3_»suÉ_blob
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4502 
SQLITE_API
 
sql™e3_»suÉ_blob64
(
sql™e3_cÚ‹xt
*,cÚ¡ *,
sql™e3_ušt64
,(*)(*));

4503 
SQLITE_API
 
sql™e3_»suÉ_doubË
(
sql™e3_cÚ‹xt
*, );

4504 
SQLITE_API
 
sql™e3_»suÉ_”rÜ
(
sql™e3_cÚ‹xt
*, const *, );

4505 
SQLITE_API
 
sql™e3_»suÉ_”rÜ16
(
sql™e3_cÚ‹xt
*, const *, );

4506 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_toobig
(
sql™e3_cÚ‹xt
*);

4507 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_nomem
(
sql™e3_cÚ‹xt
*);

4508 
SQLITE_API
 
sql™e3_»suÉ_”rÜ_code
(
sql™e3_cÚ‹xt
*, );

4509 
SQLITE_API
 
sql™e3_»suÉ_št
(
sql™e3_cÚ‹xt
*, );

4510 
SQLITE_API
 
sql™e3_»suÉ_št64
(
sql™e3_cÚ‹xt
*, 
sql™e3_št64
);

4511 
SQLITE_API
 
sql™e3_»suÉ_nuÎ
(
sql™e3_cÚ‹xt
*);

4512 
SQLITE_API
 
sql™e3_»suÉ_‹xt
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4513 
SQLITE_API
 
sql™e3_»suÉ_‹xt64
(
sql™e3_cÚ‹xt
*, cÚ¡ *,
sql™e3_ušt64
,

4514 (*)(*), 
’codšg
);

4515 
SQLITE_API
 
sql™e3_»suÉ_‹xt16
(
sql™e3_cÚ‹xt
*, const *, , (*)(*));

4516 
SQLITE_API
 
sql™e3_»suÉ_‹xt16Ë
(
sql™e3_cÚ‹xt
*, const *, ,(*)(*));

4517 
SQLITE_API
 
sql™e3_»suÉ_‹xt16be
(
sql™e3_cÚ‹xt
*, const *, ,(*)(*));

4518 
SQLITE_API
 
sql™e3_»suÉ_v®ue
(
sql™e3_cÚ‹xt
*, 
sql™e3_v®ue
*);

4519 
SQLITE_API
 
sql™e3_»suÉ_z”oblob
(
sql™e3_cÚ‹xt
*, 
n
);

4600 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ
(

4601 
sql™e3
*,

4602 cÚ¡ *
zName
,

4603 
eTextR•
,

4604 *
pArg
,

4605 (*
xCom·»
)(*,,const *,,const *)

4607 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ_v2
(

4608 
sql™e3
*,

4609 cÚ¡ *
zName
,

4610 
eTextR•
,

4611 *
pArg
,

4612 (*
xCom·»
)(*,,const *,,const *),

4613 (*
xDe¡roy
)(*)

4615 
SQLITE_API
 
sql™e3_ü—‹_cÞÏtiÚ16
(

4616 
sql™e3
*,

4617 cÚ¡ *
zName
,

4618 
eTextR•
,

4619 *
pArg
,

4620 (*
xCom·»
)(*,,const *,,const *)

4649 
SQLITE_API
 
sql™e3_cÞÏtiÚ_Ãeded
(

4650 
sql™e3
*,

4652 (*)(*,
sql™e3
*,
eTextR•
,const *)

4654 
SQLITE_API
 
sql™e3_cÞÏtiÚ_Ãeded16
(

4655 
sql™e3
*,

4657 (*)(*,
sql™e3
*,
eTextR•
,const *)

4660 #ifdeà
SQLITE_HAS_CODEC


4668 
SQLITE_API
 
sql™e3_key
(

4669 
sql™e3
 *
db
,

4670 cÚ¡ *
pKey
, 
nKey


4672 
SQLITE_API
 
sql™e3_key_v2
(

4673 
sql™e3
 *
db
,

4674 cÚ¡ *
zDbName
,

4675 cÚ¡ *
pKey
, 
nKey


4686 
SQLITE_API
 
sql™e3_»key
(

4687 
sql™e3
 *
db
,

4688 cÚ¡ *
pKey
, 
nKey


4690 
SQLITE_API
 
sql™e3_»key_v2
(

4691 
sql™e3
 *
db
,

4692 cÚ¡ *
zDbName
,

4693 cÚ¡ *
pKey
, 
nKey


4700 
SQLITE_API
 
sql™e3_aùiv©e_£e
(

4701 cÚ¡ *
zPassPh¿£


4705 #ifdeà
SQLITE_ENABLE_CEROD


4710 
SQLITE_API
 
sql™e3_aùiv©e_ûrod
(

4711 cÚ¡ *
zPassPh¿£


4732 
SQLITE_API
 
sql™e3_¦“p
();

4790 
SQLITE_API
 
SQLITE_EXTERN
 *
sql™e3_‹mp_dœeùÜy
;

4827 
SQLITE_API
 
SQLITE_EXTERN
 *
sql™e3_d©a_dœeùÜy
;

4850 
SQLITE_API
 
sql™e3_g‘_autocomm™
(
sql™e3
*);

4862 
SQLITE_API
 
sql™e3
 *
sql™e3_db_hªdË
(
sql™e3_¡mt
*);

4878 
SQLITE_API
 cÚ¡ *
sql™e3_db_fž’ame
(
sql™e3
 *
db
, cÚ¡ *
zDbName
);

4887 
SQLITE_API
 
sql™e3_db_»adÚly
(
sql™e3
 *
db
, cÚ¡ *
zDbName
);

4902 
SQLITE_API
 
sql™e3_¡mt
 *
sql™e3_Ãxt_¡mt
(
sql™e3
 *
pDb
, sql™e3_¡mˆ*
pStmt
);

4950 
SQLITE_API
 *
sql™e3_comm™_hook
(
sql™e3
*, (*)(*), *);

4951 
SQLITE_API
 *
sql™e3_rÞlback_hook
(
sql™e3
*, (*)(*), *);

5001 
SQLITE_API
 *
sql™e3_upd©e_hook
(

5002 
sql™e3
*,

5003 (*)(*,,cÚ¡ *,cÚ¡ *,
sql™e3_št64
),

5036 
SQLITE_API
 
sql™e3_’abË_sh¬ed_ÿche
();

5052 
SQLITE_API
 
sql™e3_»Ëa£_memÜy
();

5065 
SQLITE_API
 
sql™e3_db_»Ëa£_memÜy
(
sql™e3
*);

5117 
SQLITE_API
 
sql™e3_št64
 
sql™e3_soá_h—p_lim™64
(sql™e3_št64 
N
);

5128 
SQLITE_API
 
SQLITE_DEPRECATED
 
sql™e3_soá_h—p_lim™
(
N
);

5193 
SQLITE_API
 
sql™e3_bË_cÞumn_m‘ad©a
(

5194 
sql™e3
 *
db
,

5195 cÚ¡ *
zDbName
,

5196 cÚ¡ *
zTabËName
,

5197 cÚ¡ *
zCÞumnName
,

5198 cÚ¡ **
pzD©aTy³
,

5199 cÚ¡ **
pzCÞlSeq
,

5200 *
pNÙNuÎ
,

5201 *
pPrim¬yKey
,

5202 *
pAutošc


5239 
SQLITE_API
 
sql™e3_lßd_ex‹nsiÚ
(

5240 
sql™e3
 *
db
,

5241 cÚ¡ *
zFže
,

5242 cÚ¡ *
zProc
,

5243 **
pzE¼Msg


5259 
SQLITE_API
 
sql™e3_’abË_lßd_ex‹nsiÚ
(
sql™e3
 *
db
, 
Úoff
);

5297 
SQLITE_API
 
sql™e3_auto_ex‹nsiÚ
((*
xEÁryPošt
)());

5309 
SQLITE_API
 
sql™e3_ÿnûl_auto_ex‹nsiÚ
((*
xEÁryPošt
)());

5317 
SQLITE_API
 
sql™e3_»£t_auto_ex‹nsiÚ
();

5331 
sql™e3_vb
 
	tsql™e3_vb
;

5332 
sql™e3_šdex_šfo
 
	tsql™e3_šdex_šfo
;

5333 
sql™e3_vb_cursÜ
 
	tsql™e3_vb_cursÜ
;

5334 
sql™e3_moduË
 
	tsql™e3_moduË
;

5352 
	ssql™e3_moduË
 {

5353 
iV”siÚ
;

5354 (*
xC»©e
)(
sql™e3
*, *
pAux
,

5355 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

5356 
sql™e3_vb
 **
µVTab
, **);

5357 (*
xCÚÃù
)(
sql™e3
*, *
pAux
,

5358 
¬gc
, cÚ¡ *cÚ¡*
¬gv
,

5359 
sql™e3_vb
 **
µVTab
, **);

5360 (*
xBe¡Index
)(
sql™e3_vb
 *
pVTab
, 
sql™e3_šdex_šfo
*);

5361 (*
xDiscÚÃù
)(
sql™e3_vb
 *
pVTab
);

5362 (*
xDe¡roy
)(
sql™e3_vb
 *
pVTab
);

5363 (*
xO³n
)(
sql™e3_vb
 *
pVTab
, 
sql™e3_vb_cursÜ
 **
µCursÜ
);

5364 (*
xClo£
)(
sql™e3_vb_cursÜ
*);

5365 (*
xFž‹r
)(
sql™e3_vb_cursÜ
*, 
idxNum
, cÚ¡ *
idxSŒ
,

5366 
¬gc
, 
sql™e3_v®ue
 **
¬gv
);

5367 (*
xNext
)(
sql™e3_vb_cursÜ
*);

5368 (*
xEof
)(
sql™e3_vb_cursÜ
*);

5369 (*
xCÞumn
)(
sql™e3_vb_cursÜ
*, 
sql™e3_cÚ‹xt
*, );

5370 (*
xRowid
)(
sql™e3_vb_cursÜ
*, 
sql™e3_št64
 *
pRowid
);

5371 (*
xUpd©e
)(
sql™e3_vb
 *, , 
sql™e3_v®ue
 **, 
sql™e3_št64
 *);

5372 (*
xBegš
)(
sql™e3_vb
 *
pVTab
);

5373 (*
xSync
)(
sql™e3_vb
 *
pVTab
);

5374 (*
xComm™
)(
sql™e3_vb
 *
pVTab
);

5375 (*
xRÞlback
)(
sql™e3_vb
 *
pVTab
);

5376 (*
xFšdFunùiÚ
)(
sql™e3_vb
 *
pVb
, 
nArg
, cÚ¡ *
zName
,

5377 (**
pxFunc
)(
sql™e3_cÚ‹xt
*,,
sql™e3_v®ue
**),

5378 **
µArg
);

5379 (*
xR’ame
)(
sql™e3_vb
 *
pVb
, cÚ¡ *
zNew
);

5382 (*
xSav•ošt
)(
sql™e3_vb
 *
pVTab
, );

5383 (*
xR–—£
)(
sql™e3_vb
 *
pVTab
, );

5384 (*
xRÞlbackTo
)(
sql™e3_vb
 *
pVTab
, );

5452 
	ssql™e3_šdex_šfo
 {

5454 
nCÚ¡¿št
;

5455 
	ssql™e3_šdex_cÚ¡¿št
 {

5456 
iCÞumn
;

5457 
Ý
;

5458 
u§bË
;

5459 
iT”mOff£t
;

5460 } *
aCÚ¡¿št
;

5461 
nOrd”By
;

5462 
	ssql™e3_šdex_Üd”by
 {

5463 
iCÞumn
;

5464 
desc
;

5465 } *
aOrd”By
;

5467 
	ssql™e3_šdex_cÚ¡¿št_u§ge
 {

5468 
¬gvIndex
;

5469 
om™
;

5470 } *
aCÚ¡¿štU§ge
;

5471 
idxNum
;

5472 *
idxSŒ
;

5473 
ÃedToF»eIdxSŒ
;

5474 
Üd”ByCÚsumed
;

5475 
e¡im©edCo¡
;

5477 
sql™e3_št64
 
e¡im©edRows
;

5488 
	#SQLITE_INDEX_CONSTRAINT_EQ
 2

	)

5489 
	#SQLITE_INDEX_CONSTRAINT_GT
 4

	)

5490 
	#SQLITE_INDEX_CONSTRAINT_LE
 8

	)

5491 
	#SQLITE_INDEX_CONSTRAINT_LT
 16

	)

5492 
	#SQLITE_INDEX_CONSTRAINT_GE
 32

	)

5493 
	#SQLITE_INDEX_CONSTRAINT_MATCH
 64

	)

5520 
SQLITE_API
 
sql™e3_ü—‹_moduË
(

5521 
sql™e3
 *
db
,

5522 cÚ¡ *
zName
,

5523 cÚ¡ 
sql™e3_moduË
 *
p
,

5524 *
pCl›ÁD©a


5526 
SQLITE_API
 
sql™e3_ü—‹_moduË_v2
(

5527 
sql™e3
 *
db
,

5528 cÚ¡ *
zName
,

5529 cÚ¡ 
sql™e3_moduË
 *
p
,

5530 *
pCl›ÁD©a
,

5531 (*
xDe¡roy
)(*)

5552 
	ssql™e3_vb
 {

5553 cÚ¡ 
sql™e3_moduË
 *
pModuË
;

5554 
nRef
;

5555 *
zE¼Msg
;

5576 
	ssql™e3_vb_cursÜ
 {

5577 
sql™e3_vb
 *
pVb
;

5589 
SQLITE_API
 
sql™e3_deþ¬e_vb
(
sql™e3
*, cÚ¡ *
zSQL
);

5607 
SQLITE_API
 
sql™e3_ov”lßd_funùiÚ
(
sql™e3
*, cÚ¡ *
zFuncName
, 
nArg
);

5631 
sql™e3_blob
 
	tsql™e3_blob
;

5692 
SQLITE_API
 
sql™e3_blob_Ý’
(

5693 
sql™e3
*,

5694 cÚ¡ *
zDb
,

5695 cÚ¡ *
zTabË
,

5696 cÚ¡ *
zCÞumn
,

5697 
sql™e3_št64
 
iRow
,

5698 
æags
,

5699 
sql™e3_blob
 **
µBlob


5724 
SQLITE_API
 
SQLITE_EXPERIMENTAL
 
sql™e3_blob_»Ý’
(
sql™e3_blob
 *, 
sql™e3_št64
);

5748 
SQLITE_API
 
sql™e3_blob_þo£
(
sql™e3_blob
 *);

5763 
SQLITE_API
 
sql™e3_blob_by‹s
(
sql™e3_blob
 *);

5791 
SQLITE_API
 
sql™e3_blob_»ad
(
sql™e3_blob
 *, *
Z
, 
N
, 
iOff£t
);

5829 
SQLITE_API
 
sql™e3_blob_wr™e
(
sql™e3_blob
 *, cÚ¡ *
z
, 
n
, 
iOff£t
);

5860 
SQLITE_API
 
sql™e3_vfs
 *
sql™e3_vfs_fšd
(cÚ¡ *
zVfsName
);

5861 
SQLITE_API
 
sql™e3_vfs_»gi¡”
(
sql™e3_vfs
*, 
makeDæt
);

5862 
SQLITE_API
 
sql™e3_vfs_uÄegi¡”
(
sql™e3_vfs
*);

5979 
SQLITE_API
 
sql™e3_mu‹x
 *
sql™e3_mu‹x_®loc
();

5980 
SQLITE_API
 
sql™e3_mu‹x_ä“
(
sql™e3_mu‹x
*);

5981 
SQLITE_API
 
sql™e3_mu‹x_’‹r
(
sql™e3_mu‹x
*);

5982 
SQLITE_API
 
sql™e3_mu‹x_Œy
(
sql™e3_mu‹x
*);

5983 
SQLITE_API
 
sql™e3_mu‹x_Ëave
(
sql™e3_mu‹x
*);

6050 
sql™e3_mu‹x_m‘hods
 
	tsql™e3_mu‹x_m‘hods
;

6051 
	ssql™e3_mu‹x_m‘hods
 {

6052 (*
xMu‹xIn™
)();

6053 (*
xMu‹xEnd
)();

6054 
sql™e3_mu‹x
 *(*
xMu‹xAÎoc
)();

6055 (*
xMu‹xF»e
)(
sql™e3_mu‹x
 *);

6056 (*
xMu‹xEÁ”
)(
sql™e3_mu‹x
 *);

6057 (*
xMu‹xTry
)(
sql™e3_mu‹x
 *);

6058 (*
xMu‹xL—ve
)(
sql™e3_mu‹x
 *);

6059 (*
xMu‹xH–d
)(
sql™e3_mu‹x
 *);

6060 (*
xMu‹xNÙh–d
)(
sql™e3_mu‹x
 *);

6092 #iâdeà
NDEBUG


6093 
SQLITE_API
 
sql™e3_mu‹x_h–d
(
sql™e3_mu‹x
*);

6094 
SQLITE_API
 
sql™e3_mu‹x_nÙh–d
(
sql™e3_mu‹x
*);

6107 
	#SQLITE_MUTEX_FAST
 0

	)

6108 
	#SQLITE_MUTEX_RECURSIVE
 1

	)

6109 
	#SQLITE_MUTEX_STATIC_MASTER
 2

	)

6110 
	#SQLITE_MUTEX_STATIC_MEM
 3

	)

6111 
	#SQLITE_MUTEX_STATIC_MEM2
 4

	)

6112 
	#SQLITE_MUTEX_STATIC_OPEN
 4

	)

6113 
	#SQLITE_MUTEX_STATIC_PRNG
 5

	)

6114 
	#SQLITE_MUTEX_STATIC_LRU
 6

	)

6115 
	#SQLITE_MUTEX_STATIC_LRU2
 7

	)

6116 
	#SQLITE_MUTEX_STATIC_PMEM
 7

	)

6117 
	#SQLITE_MUTEX_STATIC_APP1
 8

	)

6118 
	#SQLITE_MUTEX_STATIC_APP2
 9

	)

6119 
	#SQLITE_MUTEX_STATIC_APP3
 10

	)

6130 
SQLITE_API
 
sql™e3_mu‹x
 *
sql™e3_db_mu‹x
(
sql™e3
*);

6164 
SQLITE_API
 
sql™e3_fže_cÚŒÞ
(
sql™e3
*, cÚ¡ *
zDbName
, 
Ý
, *);

6183 
SQLITE_API
 
sql™e3_‹¡_cÚŒÞ
(
Ý
, ...);

6196 
	#SQLITE_TESTCTRL_FIRST
 5

	)

6197 
	#SQLITE_TESTCTRL_PRNG_SAVE
 5

	)

6198 
	#SQLITE_TESTCTRL_PRNG_RESTORE
 6

	)

6199 
	#SQLITE_TESTCTRL_PRNG_RESET
 7

	)

6200 
	#SQLITE_TESTCTRL_BITVEC_TEST
 8

	)

6201 
	#SQLITE_TESTCTRL_FAULT_INSTALL
 9

	)

6202 
	#SQLITE_TESTCTRL_BENIGN_MALLOC_HOOKS
 10

	)

6203 
	#SQLITE_TESTCTRL_PENDING_BYTE
 11

	)

6204 
	#SQLITE_TESTCTRL_ASSERT
 12

	)

6205 
	#SQLITE_TESTCTRL_ALWAYS
 13

	)

6206 
	#SQLITE_TESTCTRL_RESERVE
 14

	)

6207 
	#SQLITE_TESTCTRL_OPTIMIZATIONS
 15

	)

6208 
	#SQLITE_TESTCTRL_ISKEYWORD
 16

	)

6209 
	#SQLITE_TESTCTRL_SCRATCHMALLOC
 17

	)

6210 
	#SQLITE_TESTCTRL_LOCALTIME_FAULT
 18

	)

6211 
	#SQLITE_TESTCTRL_EXPLAIN_STMT
 19

	)

6212 
	#SQLITE_TESTCTRL_NEVER_CORRUPT
 20

	)

6213 
	#SQLITE_TESTCTRL_VDBE_COVERAGE
 21

	)

6214 
	#SQLITE_TESTCTRL_BYTEORDER
 22

	)

6215 
	#SQLITE_TESTCTRL_ISINIT
 23

	)

6216 
	#SQLITE_TESTCTRL_SORTER_MMAP
 24

	)

6217 
	#SQLITE_TESTCTRL_LAST
 24

	)

6248 
SQLITE_API
 
sql™e3_¡©us
(
Ý
, *
pCu¼’t
, *
pHighw©”
, 
»£tFÏg
);

6333 
	#SQLITE_STATUS_MEMORY_USED
 0

	)

6334 
	#SQLITE_STATUS_PAGECACHE_USED
 1

	)

6335 
	#SQLITE_STATUS_PAGECACHE_OVERFLOW
 2

	)

6336 
	#SQLITE_STATUS_SCRATCH_USED
 3

	)

6337 
	#SQLITE_STATUS_SCRATCH_OVERFLOW
 4

	)

6338 
	#SQLITE_STATUS_MALLOC_SIZE
 5

	)

6339 
	#SQLITE_STATUS_PARSER_STACK
 6

	)

6340 
	#SQLITE_STATUS_PAGECACHE_SIZE
 7

	)

6341 
	#SQLITE_STATUS_SCRATCH_SIZE
 8

	)

6342 
	#SQLITE_STATUS_MALLOC_COUNT
 9

	)

6366 
SQLITE_API
 
sql™e3_db_¡©us
(
sql™e3
*, 
Ý
, *
pCur
, *
pHiwŒ
, 
»£tFlg
);

6458 
	#SQLITE_DBSTATUS_LOOKASIDE_USED
 0

	)

6459 
	#SQLITE_DBSTATUS_CACHE_USED
 1

	)

6460 
	#SQLITE_DBSTATUS_SCHEMA_USED
 2

	)

6461 
	#SQLITE_DBSTATUS_STMT_USED
 3

	)

6462 
	#SQLITE_DBSTATUS_LOOKASIDE_HIT
 4

	)

6463 
	#SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE
 5

	)

6464 
	#SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL
 6

	)

6465 
	#SQLITE_DBSTATUS_CACHE_HIT
 7

	)

6466 
	#SQLITE_DBSTATUS_CACHE_MISS
 8

	)

6467 
	#SQLITE_DBSTATUS_CACHE_WRITE
 9

	)

6468 
	#SQLITE_DBSTATUS_DEFERRED_FKS
 10

	)

6469 
	#SQLITE_DBSTATUS_MAX
 10

	)

6495 
SQLITE_API
 
sql™e3_¡mt_¡©us
(
sql™e3_¡mt
*, 
Ý
,
»£tFlg
);

6534 
	#SQLITE_STMTSTATUS_FULLSCAN_STEP
 1

	)

6535 
	#SQLITE_STMTSTATUS_SORT
 2

	)

6536 
	#SQLITE_STMTSTATUS_AUTOINDEX
 3

	)

6537 
	#SQLITE_STMTSTATUS_VM_STEP
 4

	)

6550 
sql™e3_pÿche
 
	tsql™e3_pÿche
;

6562 
sql™e3_pÿche_·ge
 
	tsql™e3_pÿche_·ge
;

6563 
	ssql™e3_pÿche_·ge
 {

6564 *
pBuf
;

6565 *
pExŒa
;

6727 
sql™e3_pÿche_m‘hods2
 
	tsql™e3_pÿche_m‘hods2
;

6728 
	ssql™e3_pÿche_m‘hods2
 {

6729 
iV”siÚ
;

6730 *
pArg
;

6731 (*
xIn™
)(*);

6732 (*
xShutdown
)(*);

6733 
sql™e3_pÿche
 *(*
xC»©e
)(
szPage
, 
szExŒa
, 
bPurg—bË
);

6734 (*
xCachesize
)(
sql™e3_pÿche
*, 
nCachesize
);

6735 (*
xPagecouÁ
)(
sql™e3_pÿche
*);

6736 
sql™e3_pÿche_·ge
 *(*
xF‘ch
)(
sql™e3_pÿche
*, 
key
, 
ü—‹FÏg
);

6737 (*
xUÅš
)(
sql™e3_pÿche
*, 
sql™e3_pÿche_·ge
*, 
disÿrd
);

6738 (*
xRekey
)(
sql™e3_pÿche
*, 
sql™e3_pÿche_·ge
*,

6739 
ÞdKey
, 
ÃwKey
);

6740 (*
xTrunÿ‹
)(
sql™e3_pÿche
*, 
iLim™
);

6741 (*
xDe¡roy
)(
sql™e3_pÿche
*);

6742 (*
xShršk
)(
sql™e3_pÿche
*);

6750 
sql™e3_pÿche_m‘hods
 
	tsql™e3_pÿche_m‘hods
;

6751 
	ssql™e3_pÿche_m‘hods
 {

6752 *
pArg
;

6753 (*
xIn™
)(*);

6754 (*
xShutdown
)(*);

6755 
sql™e3_pÿche
 *(*
xC»©e
)(
szPage
, 
bPurg—bË
);

6756 (*
xCachesize
)(
sql™e3_pÿche
*, 
nCachesize
);

6757 (*
xPagecouÁ
)(
sql™e3_pÿche
*);

6758 *(*
xF‘ch
)(
sql™e3_pÿche
*, 
key
, 
ü—‹FÏg
);

6759 (*
xUÅš
)(
sql™e3_pÿche
*, *, 
disÿrd
);

6760 (*
xRekey
)(
sql™e3_pÿche
*, *, 
ÞdKey
, 
ÃwKey
);

6761 (*
xTrunÿ‹
)(
sql™e3_pÿche
*, 
iLim™
);

6762 (*
xDe¡roy
)(
sql™e3_pÿche
*);

6776 
sql™e3_backup
 
	tsql™e3_backup
;

6960 
SQLITE_API
 
sql™e3_backup
 *
sql™e3_backup_š™
(

6961 
sql™e3
 *
pDe¡
,

6962 cÚ¡ *
zDe¡Name
,

6963 
sql™e3
 *
pSourû
,

6964 cÚ¡ *
zSourûName


6966 
SQLITE_API
 
sql™e3_backup_¡•
(
sql™e3_backup
 *
p
, 
nPage
);

6967 
SQLITE_API
 
sql™e3_backup_fšish
(
sql™e3_backup
 *
p
);

6968 
SQLITE_API
 
sql™e3_backup_»maššg
(
sql™e3_backup
 *
p
);

6969 
SQLITE_API
 
sql™e3_backup_·gecouÁ
(
sql™e3_backup
 *
p
);

7085 
SQLITE_API
 
sql™e3_uÆock_nÙify
(

7086 
sql™e3
 *
pBlocked
,

7087 (*
xNÙify
)(**
­Arg
, 
nArg
),

7088 *
pNÙifyArg


7100 
SQLITE_API
 
sql™e3_¡ricmp
(const *, const *);

7101 
SQLITE_API
 
sql™e3_¡ºicmp
(const *, const *, );

7116 
SQLITE_API
 
sql™e3_¡rglob
(cÚ¡ *
zGlob
, cÚ¡ *
zSŒ
);

7139 
SQLITE_API
 
sql™e3_log
(
iE¼Code
, cÚ¡ *
zFÜm©
, ...);

7176 
SQLITE_API
 *
sql™e3_w®_hook
(

7177 
sql™e3
*,

7178 (*)(*,
sql™e3
*,const *,),

7210 
SQLITE_API
 
sql™e3_w®_autocheckpošt
(
sql™e3
 *
db
, 
N
);

7232 
SQLITE_API
 
sql™e3_w®_checkpošt
(
sql™e3
 *
db
, cÚ¡ *
zDb
);

7307 
SQLITE_API
 
sql™e3_w®_checkpošt_v2
(

7308 
sql™e3
 *
db
,

7309 cÚ¡ *
zDb
,

7310 
eMode
,

7311 *
²Log
,

7312 *
²Ck±


7323 
	#SQLITE_CHECKPOINT_PASSIVE
 0

	)

7324 
	#SQLITE_CHECKPOINT_FULL
 1

	)

7325 
	#SQLITE_CHECKPOINT_RESTART
 2

	)

7341 
SQLITE_API
 
sql™e3_vb_cÚfig
(
sql™e3
*, 
Ý
, ...);

7382 
	#SQLITE_VTAB_CONSTRAINT_SUPPORT
 1

	)

7394 
SQLITE_API
 
sql™e3_vb_Ú_cÚæiù
(
sql™e3
 *);

7408 
	#SQLITE_ROLLBACK
 1

	)

7410 
	#SQLITE_FAIL
 3

	)

7412 
	#SQLITE_REPLACE
 5

	)

7420 #ifdeà
SQLITE_OMIT_FLOATING_POINT


7424 #ifdeà
__ýlu¥lus


7442 #iâdeà
_SQLITE3RTREE_H_


7443 
	#_SQLITE3RTREE_H_


	)

7446 #ifdeà
__ýlu¥lus


7450 
sql™e3_¹»e_geom‘ry
 
	tsql™e3_¹»e_geom‘ry
;

7451 
sql™e3_¹»e_qu”y_šfo
 
	tsql™e3_¹»e_qu”y_šfo
;

7456 #ifdeà
SQLITE_RTREE_INT_ONLY


7457 
sql™e3_št64
 
	tsql™e3_¹»e_dbl
;

7459 
	tsql™e3_¹»e_dbl
;

7468 
SQLITE_API
 
sql™e3_¹»e_geom‘ry_ÿÎback
(

7469 
sql™e3
 *
db
,

7470 cÚ¡ *
zGeom
,

7471 (*
xGeom
)(
sql™e3_¹»e_geom‘ry
*, , 
sql™e3_¹»e_dbl
*,*),

7472 *
pCÚ‹xt


7480 
	ssql™e3_¹»e_geom‘ry
 {

7481 *
pCÚ‹xt
;

7482 
nP¬am
;

7483 
sql™e3_¹»e_dbl
 *
aP¬am
;

7484 *
pU£r
;

7485 (*
xD–U£r
)(*);

7494 
SQLITE_API
 
sql™e3_¹»e_qu”y_ÿÎback
(

7495 
sql™e3
 *
db
,

7496 cÚ¡ *
zQu”yFunc
,

7497 (*
xQu”yFunc
)(
sql™e3_¹»e_qu”y_šfo
*),

7498 *
pCÚ‹xt
,

7499 (*
xDe¡ruùÜ
)(*)

7512 
	ssql™e3_¹»e_qu”y_šfo
 {

7513 *
pCÚ‹xt
;

7514 
nP¬am
;

7515 
sql™e3_¹»e_dbl
 *
aP¬am
;

7516 *
pU£r
;

7517 (*
xD–U£r
)(*);

7518 
sql™e3_¹»e_dbl
 *
aCoÜd
;

7519 *
ªQueue
;

7520 
nCoÜd
;

7521 
iLev–
;

7522 
mxLev–
;

7523 
sql™e3_št64
 
iRowid
;

7524 
sql™e3_¹»e_dbl
 
rP¬’tScÜe
;

7525 
eP¬’tW™hš
;

7526 
eW™hš
;

7527 
sql™e3_¹»e_dbl
 
rScÜe
;

7533 
	#NOT_WITHIN
 0

	)

7534 
	#PARTLY_WITHIN
 1

	)

7535 
	#FULLY_WITHIN
 2

	)

7538 #ifdeà
__ýlu¥lus


	@
1
.
0
6
60
client.c
comm.h
loaddatabase.c
server.c
sqlite3.c
sqlite3.h
